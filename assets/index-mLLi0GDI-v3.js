function Nq(i,r){for(var a=0;a<r.length;a++){const c=r[a];if(typeof c!="string"&&!Array.isArray(c)){for(const l in c)if(l!=="default"&&!(l in i)){const h=Object.getOwnPropertyDescriptor(c,l);h&&Object.defineProperty(i,l,h.get?h:{enumerable:!0,get:()=>c[l]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))c(l);new MutationObserver(l=>{for(const h of l)if(h.type==="childList")for(const m of h.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&c(m)}).observe(document,{childList:!0,subtree:!0});function a(l){const h={};return l.integrity&&(h.integrity=l.integrity),l.referrerPolicy&&(h.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?h.credentials="include":l.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function c(l){if(l.ep)return;l.ep=!0;const h=a(l);fetch(l.href,h)}})();function gO(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var yx={exports:{}},g0={},vx={exports:{}},tr={};var Gz;function Qfe(){if(Gz)return tr;Gz=1;var i=Symbol.for("react.element"),r=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),c=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),h=Symbol.for("react.provider"),m=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),S=Symbol.for("react.suspense"),T=Symbol.for("react.memo"),C=Symbol.for("react.lazy"),I=Symbol.iterator;function N(ge){return ge===null||typeof ge!="object"?null:(ge=I&&ge[I]||ge["@@iterator"],typeof ge=="function"?ge:null)}var P={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},H=Object.assign,x={};function B(ge,Pe,ue){this.props=ge,this.context=Pe,this.refs=x,this.updater=ue||P}B.prototype.isReactComponent={},B.prototype.setState=function(ge,Pe){if(typeof ge!="object"&&typeof ge!="function"&&ge!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ge,Pe,"setState")},B.prototype.forceUpdate=function(ge){this.updater.enqueueForceUpdate(this,ge,"forceUpdate")};function X(){}X.prototype=B.prototype;function Z(ge,Pe,ue){this.props=ge,this.context=Pe,this.refs=x,this.updater=ue||P}var $=Z.prototype=new X;$.constructor=Z,H($,B.prototype),$.isPureReactComponent=!0;var le=Array.isArray,re=Object.prototype.hasOwnProperty,ce={current:null},te={key:!0,ref:!0,__self:!0,__source:!0};function pe(ge,Pe,ue){var it,yt={},Dt=null,At=null;if(Pe!=null)for(it in Pe.ref!==void 0&&(At=Pe.ref),Pe.key!==void 0&&(Dt=""+Pe.key),Pe)re.call(Pe,it)&&!te.hasOwnProperty(it)&&(yt[it]=Pe[it]);var dn=arguments.length-2;if(dn===1)yt.children=ue;else if(1<dn){for(var Cn=Array(dn),fr=0;fr<dn;fr++)Cn[fr]=arguments[fr+2];yt.children=Cn}if(ge&&ge.defaultProps)for(it in dn=ge.defaultProps,dn)yt[it]===void 0&&(yt[it]=dn[it]);return{$$typeof:i,type:ge,key:Dt,ref:At,props:yt,_owner:ce.current}}function Ee(ge,Pe){return{$$typeof:i,type:ge.type,key:Pe,ref:ge.ref,props:ge.props,_owner:ge._owner}}function Ne(ge){return typeof ge=="object"&&ge!==null&&ge.$$typeof===i}function Ue(ge){var Pe={"=":"=0",":":"=2"};return"$"+ge.replace(/[=:]/g,function(ue){return Pe[ue]})}var Se=/\/+/g;function Xe(ge,Pe){return typeof ge=="object"&&ge!==null&&ge.key!=null?Ue(""+ge.key):Pe.toString(36)}function Re(ge,Pe,ue,it,yt){var Dt=typeof ge;(Dt==="undefined"||Dt==="boolean")&&(ge=null);var At=!1;if(ge===null)At=!0;else switch(Dt){case"string":case"number":At=!0;break;case"object":switch(ge.$$typeof){case i:case r:At=!0}}if(At)return At=ge,yt=yt(At),ge=it===""?"."+Xe(At,0):it,le(yt)?(ue="",ge!=null&&(ue=ge.replace(Se,"$&/")+"/"),Re(yt,Pe,ue,"",function(fr){return fr})):yt!=null&&(Ne(yt)&&(yt=Ee(yt,ue+(!yt.key||At&&At.key===yt.key?"":(""+yt.key).replace(Se,"$&/")+"/")+ge)),Pe.push(yt)),1;if(At=0,it=it===""?".":it+":",le(ge))for(var dn=0;dn<ge.length;dn++){Dt=ge[dn];var Cn=it+Xe(Dt,dn);At+=Re(Dt,Pe,ue,Cn,yt)}else if(Cn=N(ge),typeof Cn=="function")for(ge=Cn.call(ge),dn=0;!(Dt=ge.next()).done;)Dt=Dt.value,Cn=it+Xe(Dt,dn++),At+=Re(Dt,Pe,ue,Cn,yt);else if(Dt==="object")throw Pe=String(ge),Error("Objects are not valid as a React child (found: "+(Pe==="[object Object]"?"object with keys {"+Object.keys(ge).join(", ")+"}":Pe)+"). If you meant to render a collection of children, use an array instead.");return At}function Be(ge,Pe,ue){if(ge==null)return ge;var it=[],yt=0;return Re(ge,it,"","",function(Dt){return Pe.call(ue,Dt,yt++)}),it}function $e(ge){if(ge._status===-1){var Pe=ge._result;Pe=Pe(),Pe.then(function(ue){(ge._status===0||ge._status===-1)&&(ge._status=1,ge._result=ue)},function(ue){(ge._status===0||ge._status===-1)&&(ge._status=2,ge._result=ue)}),ge._status===-1&&(ge._status=0,ge._result=Pe)}if(ge._status===1)return ge._result.default;throw ge._result}var Ge={current:null},Ie={transition:null},Ke={ReactCurrentDispatcher:Ge,ReactCurrentBatchConfig:Ie,ReactCurrentOwner:ce};function ae(){throw Error("act(...) is not supported in production builds of React.")}return tr.Children={map:Be,forEach:function(ge,Pe,ue){Be(ge,function(){Pe.apply(this,arguments)},ue)},count:function(ge){var Pe=0;return Be(ge,function(){Pe++}),Pe},toArray:function(ge){return Be(ge,function(Pe){return Pe})||[]},only:function(ge){if(!Ne(ge))throw Error("React.Children.only expected to receive a single React element child.");return ge}},tr.Component=B,tr.Fragment=a,tr.Profiler=l,tr.PureComponent=Z,tr.StrictMode=c,tr.Suspense=S,tr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ke,tr.act=ae,tr.cloneElement=function(ge,Pe,ue){if(ge==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+ge+".");var it=H({},ge.props),yt=ge.key,Dt=ge.ref,At=ge._owner;if(Pe!=null){if(Pe.ref!==void 0&&(Dt=Pe.ref,At=ce.current),Pe.key!==void 0&&(yt=""+Pe.key),ge.type&&ge.type.defaultProps)var dn=ge.type.defaultProps;for(Cn in Pe)re.call(Pe,Cn)&&!te.hasOwnProperty(Cn)&&(it[Cn]=Pe[Cn]===void 0&&dn!==void 0?dn[Cn]:Pe[Cn])}var Cn=arguments.length-2;if(Cn===1)it.children=ue;else if(1<Cn){dn=Array(Cn);for(var fr=0;fr<Cn;fr++)dn[fr]=arguments[fr+2];it.children=dn}return{$$typeof:i,type:ge.type,key:yt,ref:Dt,props:it,_owner:At}},tr.createContext=function(ge){return ge={$$typeof:m,_currentValue:ge,_currentValue2:ge,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},ge.Provider={$$typeof:h,_context:ge},ge.Consumer=ge},tr.createElement=pe,tr.createFactory=function(ge){var Pe=pe.bind(null,ge);return Pe.type=ge,Pe},tr.createRef=function(){return{current:null}},tr.forwardRef=function(ge){return{$$typeof:E,render:ge}},tr.isValidElement=Ne,tr.lazy=function(ge){return{$$typeof:C,_payload:{_status:-1,_result:ge},_init:$e}},tr.memo=function(ge,Pe){return{$$typeof:T,type:ge,compare:Pe===void 0?null:Pe}},tr.startTransition=function(ge){var Pe=Ie.transition;Ie.transition={};try{ge()}finally{Ie.transition=Pe}},tr.unstable_act=ae,tr.useCallback=function(ge,Pe){return Ge.current.useCallback(ge,Pe)},tr.useContext=function(ge){return Ge.current.useContext(ge)},tr.useDebugValue=function(){},tr.useDeferredValue=function(ge){return Ge.current.useDeferredValue(ge)},tr.useEffect=function(ge,Pe){return Ge.current.useEffect(ge,Pe)},tr.useId=function(){return Ge.current.useId()},tr.useImperativeHandle=function(ge,Pe,ue){return Ge.current.useImperativeHandle(ge,Pe,ue)},tr.useInsertionEffect=function(ge,Pe){return Ge.current.useInsertionEffect(ge,Pe)},tr.useLayoutEffect=function(ge,Pe){return Ge.current.useLayoutEffect(ge,Pe)},tr.useMemo=function(ge,Pe){return Ge.current.useMemo(ge,Pe)},tr.useReducer=function(ge,Pe,ue){return Ge.current.useReducer(ge,Pe,ue)},tr.useRef=function(ge){return Ge.current.useRef(ge)},tr.useState=function(ge){return Ge.current.useState(ge)},tr.useSyncExternalStore=function(ge,Pe,ue){return Ge.current.useSyncExternalStore(ge,Pe,ue)},tr.useTransition=function(){return Ge.current.useTransition()},tr.version="18.3.1",tr}var Hz;function l2(){return Hz||(Hz=1,vx.exports=Qfe()),vx.exports}var zz;function Zfe(){if(zz)return g0;zz=1;var i=l2(),r=Symbol.for("react.element"),a=Symbol.for("react.fragment"),c=Object.prototype.hasOwnProperty,l=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,h={key:!0,ref:!0,__self:!0,__source:!0};function m(E,S,T){var C,I={},N=null,P=null;T!==void 0&&(N=""+T),S.key!==void 0&&(N=""+S.key),S.ref!==void 0&&(P=S.ref);for(C in S)c.call(S,C)&&!h.hasOwnProperty(C)&&(I[C]=S[C]);if(E&&E.defaultProps)for(C in S=E.defaultProps,S)I[C]===void 0&&(I[C]=S[C]);return{$$typeof:r,type:E,key:N,ref:P,props:I,_owner:l.current}}return g0.Fragment=a,g0.jsx=m,g0.jsxs=m,g0}var Kz;function eme(){return Kz||(Kz=1,yx.exports=Zfe()),yx.exports}var D=eme(),GI={},Sx={exports:{}},Co={},Tx={exports:{}},wx={};var Yz;function tme(){return Yz||(Yz=1,(function(i){function r(Ie,Ke){var ae=Ie.length;Ie.push(Ke);e:for(;0<ae;){var ge=ae-1>>>1,Pe=Ie[ge];if(0<l(Pe,Ke))Ie[ge]=Ke,Ie[ae]=Pe,ae=ge;else break e}}function a(Ie){return Ie.length===0?null:Ie[0]}function c(Ie){if(Ie.length===0)return null;var Ke=Ie[0],ae=Ie.pop();if(ae!==Ke){Ie[0]=ae;e:for(var ge=0,Pe=Ie.length,ue=Pe>>>1;ge<ue;){var it=2*(ge+1)-1,yt=Ie[it],Dt=it+1,At=Ie[Dt];if(0>l(yt,ae))Dt<Pe&&0>l(At,yt)?(Ie[ge]=At,Ie[Dt]=ae,ge=Dt):(Ie[ge]=yt,Ie[it]=ae,ge=it);else if(Dt<Pe&&0>l(At,ae))Ie[ge]=At,Ie[Dt]=ae,ge=Dt;else break e}}return Ke}function l(Ie,Ke){var ae=Ie.sortIndex-Ke.sortIndex;return ae!==0?ae:Ie.id-Ke.id}if(typeof performance=="object"&&typeof performance.now=="function"){var h=performance;i.unstable_now=function(){return h.now()}}else{var m=Date,E=m.now();i.unstable_now=function(){return m.now()-E}}var S=[],T=[],C=1,I=null,N=3,P=!1,H=!1,x=!1,B=typeof setTimeout=="function"?setTimeout:null,X=typeof clearTimeout=="function"?clearTimeout:null,Z=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function $(Ie){for(var Ke=a(T);Ke!==null;){if(Ke.callback===null)c(T);else if(Ke.startTime<=Ie)c(T),Ke.sortIndex=Ke.expirationTime,r(S,Ke);else break;Ke=a(T)}}function le(Ie){if(x=!1,$(Ie),!H)if(a(S)!==null)H=!0,$e(re);else{var Ke=a(T);Ke!==null&&Ge(le,Ke.startTime-Ie)}}function re(Ie,Ke){H=!1,x&&(x=!1,X(pe),pe=-1),P=!0;var ae=N;try{for($(Ke),I=a(S);I!==null&&(!(I.expirationTime>Ke)||Ie&&!Ue());){var ge=I.callback;if(typeof ge=="function"){I.callback=null,N=I.priorityLevel;var Pe=ge(I.expirationTime<=Ke);Ke=i.unstable_now(),typeof Pe=="function"?I.callback=Pe:I===a(S)&&c(S),$(Ke)}else c(S);I=a(S)}if(I!==null)var ue=!0;else{var it=a(T);it!==null&&Ge(le,it.startTime-Ke),ue=!1}return ue}finally{I=null,N=ae,P=!1}}var ce=!1,te=null,pe=-1,Ee=5,Ne=-1;function Ue(){return!(i.unstable_now()-Ne<Ee)}function Se(){if(te!==null){var Ie=i.unstable_now();Ne=Ie;var Ke=!0;try{Ke=te(!0,Ie)}finally{Ke?Xe():(ce=!1,te=null)}}else ce=!1}var Xe;if(typeof Z=="function")Xe=function(){Z(Se)};else if(typeof MessageChannel<"u"){var Re=new MessageChannel,Be=Re.port2;Re.port1.onmessage=Se,Xe=function(){Be.postMessage(null)}}else Xe=function(){B(Se,0)};function $e(Ie){te=Ie,ce||(ce=!0,Xe())}function Ge(Ie,Ke){pe=B(function(){Ie(i.unstable_now())},Ke)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(Ie){Ie.callback=null},i.unstable_continueExecution=function(){H||P||(H=!0,$e(re))},i.unstable_forceFrameRate=function(Ie){0>Ie||125<Ie?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ee=0<Ie?Math.floor(1e3/Ie):5},i.unstable_getCurrentPriorityLevel=function(){return N},i.unstable_getFirstCallbackNode=function(){return a(S)},i.unstable_next=function(Ie){switch(N){case 1:case 2:case 3:var Ke=3;break;default:Ke=N}var ae=N;N=Ke;try{return Ie()}finally{N=ae}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(Ie,Ke){switch(Ie){case 1:case 2:case 3:case 4:case 5:break;default:Ie=3}var ae=N;N=Ie;try{return Ke()}finally{N=ae}},i.unstable_scheduleCallback=function(Ie,Ke,ae){var ge=i.unstable_now();switch(typeof ae=="object"&&ae!==null?(ae=ae.delay,ae=typeof ae=="number"&&0<ae?ge+ae:ge):ae=ge,Ie){case 1:var Pe=-1;break;case 2:Pe=250;break;case 5:Pe=1073741823;break;case 4:Pe=1e4;break;default:Pe=5e3}return Pe=ae+Pe,Ie={id:C++,callback:Ke,priorityLevel:Ie,startTime:ae,expirationTime:Pe,sortIndex:-1},ae>ge?(Ie.sortIndex=ae,r(T,Ie),a(S)===null&&Ie===a(T)&&(x?(X(pe),pe=-1):x=!0,Ge(le,ae-ge))):(Ie.sortIndex=Pe,r(S,Ie),H||P||(H=!0,$e(re))),Ie},i.unstable_shouldYield=Ue,i.unstable_wrapCallback=function(Ie){var Ke=N;return function(){var ae=N;N=Ke;try{return Ie.apply(this,arguments)}finally{N=ae}}}})(wx)),wx}var qz;function nme(){return qz||(qz=1,Tx.exports=tme()),Tx.exports}var Xz;function rme(){if(Xz)return Co;Xz=1;var i=l2(),r=nme();function a(p){for(var _="https://reactjs.org/docs/error-decoder.html?invariant="+p,w=1;w<arguments.length;w++)_+="&args[]="+encodeURIComponent(arguments[w]);return"Minified React error #"+p+"; visit "+_+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var c=new Set,l={};function h(p,_){m(p,_),m(p+"Capture",_)}function m(p,_){for(l[p]=_,p=0;p<_.length;p++)c.add(_[p])}var E=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),S=Object.prototype.hasOwnProperty,T=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,C={},I={};function N(p){return S.call(I,p)?!0:S.call(C,p)?!1:T.test(p)?I[p]=!0:(C[p]=!0,!1)}function P(p,_,w,O){if(w!==null&&w.type===0)return!1;switch(typeof _){case"function":case"symbol":return!0;case"boolean":return O?!1:w!==null?!w.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function H(p,_,w,O){if(_===null||typeof _>"u"||P(p,_,w,O))return!0;if(O)return!1;if(w!==null)switch(w.type){case 3:return!_;case 4:return _===!1;case 5:return isNaN(_);case 6:return isNaN(_)||1>_}return!1}function x(p,_,w,O,U,W,ee){this.acceptsBooleans=_===2||_===3||_===4,this.attributeName=O,this.attributeNamespace=U,this.mustUseProperty=w,this.propertyName=p,this.type=_,this.sanitizeURL=W,this.removeEmptyString=ee}var B={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){B[p]=new x(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var _=p[0];B[_]=new x(_,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){B[p]=new x(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){B[p]=new x(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){B[p]=new x(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){B[p]=new x(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){B[p]=new x(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){B[p]=new x(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){B[p]=new x(p,5,!1,p.toLowerCase(),null,!1,!1)});var X=/[\-:]([a-z])/g;function Z(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var _=p.replace(X,Z);B[_]=new x(_,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var _=p.replace(X,Z);B[_]=new x(_,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var _=p.replace(X,Z);B[_]=new x(_,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){B[p]=new x(p,1,!1,p.toLowerCase(),null,!1,!1)}),B.xlinkHref=new x("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){B[p]=new x(p,1,!1,p.toLowerCase(),null,!0,!0)});function $(p,_,w,O){var U=B.hasOwnProperty(_)?B[_]:null;(U!==null?U.type!==0:O||!(2<_.length)||_[0]!=="o"&&_[0]!=="O"||_[1]!=="n"&&_[1]!=="N")&&(H(_,w,U,O)&&(w=null),O||U===null?N(_)&&(w===null?p.removeAttribute(_):p.setAttribute(_,""+w)):U.mustUseProperty?p[U.propertyName]=w===null?U.type===3?!1:"":w:(_=U.attributeName,O=U.attributeNamespace,w===null?p.removeAttribute(_):(U=U.type,w=U===3||U===4&&w===!0?"":""+w,O?p.setAttributeNS(O,_,w):p.setAttribute(_,w))))}var le=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,re=Symbol.for("react.element"),ce=Symbol.for("react.portal"),te=Symbol.for("react.fragment"),pe=Symbol.for("react.strict_mode"),Ee=Symbol.for("react.profiler"),Ne=Symbol.for("react.provider"),Ue=Symbol.for("react.context"),Se=Symbol.for("react.forward_ref"),Xe=Symbol.for("react.suspense"),Re=Symbol.for("react.suspense_list"),Be=Symbol.for("react.memo"),$e=Symbol.for("react.lazy"),Ge=Symbol.for("react.offscreen"),Ie=Symbol.iterator;function Ke(p){return p===null||typeof p!="object"?null:(p=Ie&&p[Ie]||p["@@iterator"],typeof p=="function"?p:null)}var ae=Object.assign,ge;function Pe(p){if(ge===void 0)try{throw Error()}catch(w){var _=w.stack.trim().match(/\n( *(at )?)/);ge=_&&_[1]||""}return`
`+ge+p}var ue=!1;function it(p,_){if(!p||ue)return"";ue=!0;var w=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(_)if(_=function(){throw Error()},Object.defineProperty(_.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(_,[])}catch(He){var O=He}Reflect.construct(p,[],_)}else{try{_.call()}catch(He){O=He}p.call(_.prototype)}else{try{throw Error()}catch(He){O=He}p()}}catch(He){if(He&&O&&typeof He.stack=="string"){for(var U=He.stack.split(`
`),W=O.stack.split(`
`),ee=U.length-1,me=W.length-1;1<=ee&&0<=me&&U[ee]!==W[me];)me--;for(;1<=ee&&0<=me;ee--,me--)if(U[ee]!==W[me]){if(ee!==1||me!==1)do if(ee--,me--,0>me||U[ee]!==W[me]){var ve=`
`+U[ee].replace(" at new "," at ");return p.displayName&&ve.includes("<anonymous>")&&(ve=ve.replace("<anonymous>",p.displayName)),ve}while(1<=ee&&0<=me);break}}}finally{ue=!1,Error.prepareStackTrace=w}return(p=p?p.displayName||p.name:"")?Pe(p):""}function yt(p){switch(p.tag){case 5:return Pe(p.type);case 16:return Pe("Lazy");case 13:return Pe("Suspense");case 19:return Pe("SuspenseList");case 0:case 2:case 15:return p=it(p.type,!1),p;case 11:return p=it(p.type.render,!1),p;case 1:return p=it(p.type,!0),p;default:return""}}function Dt(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case te:return"Fragment";case ce:return"Portal";case Ee:return"Profiler";case pe:return"StrictMode";case Xe:return"Suspense";case Re:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case Ue:return(p.displayName||"Context")+".Consumer";case Ne:return(p._context.displayName||"Context")+".Provider";case Se:var _=p.render;return p=p.displayName,p||(p=_.displayName||_.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case Be:return _=p.displayName||null,_!==null?_:Dt(p.type)||"Memo";case $e:_=p._payload,p=p._init;try{return Dt(p(_))}catch{}}return null}function At(p){var _=p.type;switch(p.tag){case 24:return"Cache";case 9:return(_.displayName||"Context")+".Consumer";case 10:return(_._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=_.render,p=p.displayName||p.name||"",_.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return _;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Dt(_);case 8:return _===pe?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof _=="function")return _.displayName||_.name||null;if(typeof _=="string")return _}return null}function dn(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function Cn(p){var _=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(_==="checkbox"||_==="radio")}function fr(p){var _=Cn(p)?"checked":"value",w=Object.getOwnPropertyDescriptor(p.constructor.prototype,_),O=""+p[_];if(!p.hasOwnProperty(_)&&typeof w<"u"&&typeof w.get=="function"&&typeof w.set=="function"){var U=w.get,W=w.set;return Object.defineProperty(p,_,{configurable:!0,get:function(){return U.call(this)},set:function(ee){O=""+ee,W.call(this,ee)}}),Object.defineProperty(p,_,{enumerable:w.enumerable}),{getValue:function(){return O},setValue:function(ee){O=""+ee},stopTracking:function(){p._valueTracker=null,delete p[_]}}}}function os(p){p._valueTracker||(p._valueTracker=fr(p))}function Jr(p){if(!p)return!1;var _=p._valueTracker;if(!_)return!0;var w=_.getValue(),O="";return p&&(O=Cn(p)?p.checked?"true":"false":p.value),p=O,p!==w?(_.setValue(p),!0):!1}function Mr(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function Tc(p,_){var w=_.checked;return ae({},_,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:w??p._wrapperState.initialChecked})}function pl(p,_){var w=_.defaultValue==null?"":_.defaultValue,O=_.checked!=null?_.checked:_.defaultChecked;w=dn(_.value!=null?_.value:w),p._wrapperState={initialChecked:O,initialValue:w,controlled:_.type==="checkbox"||_.type==="radio"?_.checked!=null:_.value!=null}}function yi(p,_){_=_.checked,_!=null&&$(p,"checked",_,!1)}function wc(p,_){yi(p,_);var w=dn(_.value),O=_.type;if(w!=null)O==="number"?(w===0&&p.value===""||p.value!=w)&&(p.value=""+w):p.value!==""+w&&(p.value=""+w);else if(O==="submit"||O==="reset"){p.removeAttribute("value");return}_.hasOwnProperty("value")?fi(p,_.type,w):_.hasOwnProperty("defaultValue")&&fi(p,_.type,dn(_.defaultValue)),_.checked==null&&_.defaultChecked!=null&&(p.defaultChecked=!!_.defaultChecked)}function Wr(p,_,w){if(_.hasOwnProperty("value")||_.hasOwnProperty("defaultValue")){var O=_.type;if(!(O!=="submit"&&O!=="reset"||_.value!==void 0&&_.value!==null))return;_=""+p._wrapperState.initialValue,w||_===p.value||(p.value=_),p.defaultValue=_}w=p.name,w!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,w!==""&&(p.name=w)}function fi(p,_,w){(_!=="number"||Mr(p.ownerDocument)!==p)&&(w==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+w&&(p.defaultValue=""+w))}var $s=Array.isArray;function gs(p,_,w,O){if(p=p.options,_){_={};for(var U=0;U<w.length;U++)_["$"+w[U]]=!0;for(w=0;w<p.length;w++)U=_.hasOwnProperty("$"+p[w].value),p[w].selected!==U&&(p[w].selected=U),U&&O&&(p[w].defaultSelected=!0)}else{for(w=""+dn(w),_=null,U=0;U<p.length;U++){if(p[U].value===w){p[U].selected=!0,O&&(p[U].defaultSelected=!0);return}_!==null||p[U].disabled||(_=p[U])}_!==null&&(_.selected=!0)}}function Cc(p,_){if(_.dangerouslySetInnerHTML!=null)throw Error(a(91));return ae({},_,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function Qs(p,_){var w=_.value;if(w==null){if(w=_.children,_=_.defaultValue,w!=null){if(_!=null)throw Error(a(92));if($s(w)){if(1<w.length)throw Error(a(93));w=w[0]}_=w}_==null&&(_=""),w=_}p._wrapperState={initialValue:dn(w)}}function Ir(p,_){var w=dn(_.value),O=dn(_.defaultValue);w!=null&&(w=""+w,w!==p.value&&(p.value=w),_.defaultValue==null&&p.defaultValue!==w&&(p.defaultValue=w)),O!=null&&(p.defaultValue=""+O)}function Ua(p){var _=p.textContent;_===p._wrapperState.initialValue&&_!==""&&_!==null&&(p.value=_)}function qe(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lt(p,_){return p==null||p==="http://www.w3.org/1999/xhtml"?qe(_):p==="http://www.w3.org/2000/svg"&&_==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var Kt,on=(function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(_,w,O,U){MSApp.execUnsafeLocalFunction(function(){return p(_,w,O,U)})}:p})(function(p,_){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=_;else{for(Kt=Kt||document.createElement("div"),Kt.innerHTML="<svg>"+_.valueOf().toString()+"</svg>",_=Kt.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;_.firstChild;)p.appendChild(_.firstChild)}});function Nn(p,_){if(_){var w=p.firstChild;if(w&&w===p.lastChild&&w.nodeType===3){w.nodeValue=_;return}}p.textContent=_}var ii={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Zs=["Webkit","ms","Moz","O"];Object.keys(ii).forEach(function(p){Zs.forEach(function(_){_=_+p.charAt(0).toUpperCase()+p.substring(1),ii[_]=ii[p]})});function $r(p,_,w){return _==null||typeof _=="boolean"||_===""?"":w||typeof _!="number"||_===0||ii.hasOwnProperty(p)&&ii[p]?(""+_).trim():_+"px"}function mi(p,_){p=p.style;for(var w in _)if(_.hasOwnProperty(w)){var O=w.indexOf("--")===0,U=$r(w,_[w],O);w==="float"&&(w="cssFloat"),O?p.setProperty(w,U):p[w]=U}}var _a=ae({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Gr(p,_){if(_){if(_a[p]&&(_.children!=null||_.dangerouslySetInnerHTML!=null))throw Error(a(137,p));if(_.dangerouslySetInnerHTML!=null){if(_.children!=null)throw Error(a(60));if(typeof _.dangerouslySetInnerHTML!="object"||!("__html"in _.dangerouslySetInnerHTML))throw Error(a(61))}if(_.style!=null&&typeof _.style!="object")throw Error(a(62))}}function Ea(p,_){if(p.indexOf("-")===-1)return typeof _.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var vi=null;function no(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var fl=null,ro=null,ya=null;function Va(p){if(p=Hf(p)){if(typeof fl!="function")throw Error(a(280));var _=p.stateNode;_&&(_=p_(_),fl(p.stateNode,p.type,_))}}function Fo(p){ro?ya?ya.push(p):ya=[p]:ro=p}function mn(){if(ro){var p=ro,_=ya;if(ya=ro=null,Va(p),_)for(p=0;p<_.length;p++)Va(_[p])}}function Bn(p,_){return p(_)}function mr(){}var $i=!1;function Ls(p,_,w){if($i)return p(_,w);$i=!0;try{return Bn(p,_,w)}finally{$i=!1,(ro!==null||ya!==null)&&(mr(),mn())}}function kr(p,_){var w=p.stateNode;if(w===null)return null;var O=p_(w);if(O===null)return null;w=O[_];e:switch(_){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(O=!O.disabled)||(p=p.type,O=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!O;break e;default:p=!1}if(p)return null;if(w&&typeof w!="function")throw Error(a(231,_,typeof w));return w}var ye=!1;if(E)try{var be={};Object.defineProperty(be,"passive",{get:function(){ye=!0}}),window.addEventListener("test",be,be),window.removeEventListener("test",be,be)}catch{ye=!1}function je(p,_,w,O,U,W,ee,me,ve){var He=Array.prototype.slice.call(arguments,3);try{_.apply(w,He)}catch(ut){this.onError(ut)}}var st=!1,St=null,Yt=!1,hn=null,Ut={onError:function(p){st=!0,St=p}};function Wt(p,_,w,O,U,W,ee,me,ve){st=!1,St=null,je.apply(Ut,arguments)}function xt(p,_,w,O,U,W,ee,me,ve){if(Wt.apply(this,arguments),st){if(st){var He=St;st=!1,St=null}else throw Error(a(198));Yt||(Yt=!0,hn=He)}}function Vt(p){var _=p,w=p;if(p.alternate)for(;_.return;)_=_.return;else{p=_;do _=p,(_.flags&4098)!==0&&(w=_.return),p=_.return;while(p)}return _.tag===3?w:null}function Rn(p){if(p.tag===13){var _=p.memoizedState;if(_===null&&(p=p.alternate,p!==null&&(_=p.memoizedState)),_!==null)return _.dehydrated}return null}function Kn(p){if(Vt(p)!==p)throw Error(a(188))}function Qi(p){var _=p.alternate;if(!_){if(_=Vt(p),_===null)throw Error(a(188));return _!==p?null:p}for(var w=p,O=_;;){var U=w.return;if(U===null)break;var W=U.alternate;if(W===null){if(O=U.return,O!==null){w=O;continue}break}if(U.child===W.child){for(W=U.child;W;){if(W===w)return Kn(U),p;if(W===O)return Kn(U),_;W=W.sibling}throw Error(a(188))}if(w.return!==O.return)w=U,O=W;else{for(var ee=!1,me=U.child;me;){if(me===w){ee=!0,w=U,O=W;break}if(me===O){ee=!0,O=U,w=W;break}me=me.sibling}if(!ee){for(me=W.child;me;){if(me===w){ee=!0,w=W,O=U;break}if(me===O){ee=!0,O=W,w=U;break}me=me.sibling}if(!ee)throw Error(a(189))}}if(w.alternate!==O)throw Error(a(190))}if(w.tag!==3)throw Error(a(188));return w.stateNode.current===w?p:_}function Sr(p){return p=Qi(p),p!==null?ir(p):null}function ir(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var _=ir(p);if(_!==null)return _;p=p.sibling}return null}var Ar=r.unstable_scheduleCallback,ml=r.unstable_cancelCallback,Nd=r.unstable_shouldYield,Zi=r.unstable_requestPaint,gr=r.unstable_now,Cf=r.unstable_getCurrentPriorityLevel,Ur=r.unstable_ImmediatePriority,Rc=r.unstable_UserBlockingPriority,gl=r.unstable_NormalPriority,Ah=r.unstable_LowPriority,sr=r.unstable_IdlePriority,Dr=null,bs=null;function fu(p){if(bs&&typeof bs.onCommitFiberRoot=="function")try{bs.onCommitFiberRoot(Dr,p,void 0,(p.current.flags&128)===128)}catch{}}var _r=Math.clz32?Math.clz32:gu,mu=Math.log,Yg=Math.LN2;function gu(p){return p>>>=0,p===0?32:31-(mu(p)/Yg|0)|0}var Oh=64,qg=4194304;function Er(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function Xg(p,_){var w=p.pendingLanes;if(w===0)return 0;var O=0,U=p.suspendedLanes,W=p.pingedLanes,ee=w&268435455;if(ee!==0){var me=ee&~U;me!==0?O=Er(me):(W&=ee,W!==0&&(O=Er(W)))}else ee=w&~U,ee!==0?O=Er(ee):W!==0&&(O=Er(W));if(O===0)return 0;if(_!==0&&_!==O&&(_&U)===0&&(U=O&-O,W=_&-_,U>=W||U===16&&(W&4194240)!==0))return _;if((O&4)!==0&&(O|=w&16),_=p.entangledLanes,_!==0)for(p=p.entanglements,_&=O;0<_;)w=31-_r(_),U=1<<w,O|=p[w],_&=~U;return O}function Yw(p,_){switch(p){case 1:case 2:case 4:return _+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function qw(p,_){for(var w=p.suspendedLanes,O=p.pingedLanes,U=p.expirationTimes,W=p.pendingLanes;0<W;){var ee=31-_r(W),me=1<<ee,ve=U[ee];ve===-1?((me&w)===0||(me&O)!==0)&&(U[ee]=Yw(me,_)):ve<=_&&(p.expiredLanes|=me),W&=~me}}function Ev(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function Xw(){var p=Oh;return Oh<<=1,(Oh&4194240)===0&&(Oh=64),p}function yv(p){for(var _=[],w=0;31>w;w++)_.push(p);return _}function Rf(p,_,w){p.pendingLanes|=_,_!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,_=31-_r(_),p[_]=w}function sN(p,_){var w=p.pendingLanes&~_;p.pendingLanes=_,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=_,p.mutableReadLanes&=_,p.entangledLanes&=_,_=p.entanglements;var O=p.eventTimes;for(p=p.expirationTimes;0<w;){var U=31-_r(w),W=1<<U;_[U]=0,O[U]=-1,p[U]=-1,w&=~W}}function vv(p,_){var w=p.entangledLanes|=_;for(p=p.entanglements;w;){var O=31-_r(w),U=1<<O;U&_|p[O]&_&&(p[O]|=_),w&=~U}}var Tr=0;function Sv(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var Jg,Tv,$g,Jw,wv,Cv=!1,Qg=[],_u=null,Eu=null,yu=null,bf=new Map,If=new Map,vu=[],$w="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Qw(p,_){switch(p){case"focusin":case"focusout":_u=null;break;case"dragenter":case"dragleave":Eu=null;break;case"mouseover":case"mouseout":yu=null;break;case"pointerover":case"pointerout":bf.delete(_.pointerId);break;case"gotpointercapture":case"lostpointercapture":If.delete(_.pointerId)}}function Af(p,_,w,O,U,W){return p===null||p.nativeEvent!==W?(p={blockedOn:_,domEventName:w,eventSystemFlags:O,nativeEvent:W,targetContainers:[U]},_!==null&&(_=Hf(_),_!==null&&Tv(_)),p):(p.eventSystemFlags|=O,_=p.targetContainers,U!==null&&_.indexOf(U)===-1&&_.push(U),p)}function aN(p,_,w,O,U){switch(_){case"focusin":return _u=Af(_u,p,_,w,O,U),!0;case"dragenter":return Eu=Af(Eu,p,_,w,O,U),!0;case"mouseover":return yu=Af(yu,p,_,w,O,U),!0;case"pointerover":var W=U.pointerId;return bf.set(W,Af(bf.get(W)||null,p,_,w,O,U)),!0;case"gotpointercapture":return W=U.pointerId,If.set(W,Af(If.get(W)||null,p,_,w,O,U)),!0}return!1}function Nh(p){var _=Dd(p.target);if(_!==null){var w=Vt(_);if(w!==null){if(_=w.tag,_===13){if(_=Rn(w),_!==null){p.blockedOn=_,wv(p.priority,function(){$g(w)});return}}else if(_===3&&w.stateNode.current.memoizedState.isDehydrated){p.blockedOn=w.tag===3?w.stateNode.containerInfo:null;return}}}p.blockedOn=null}function Zg(p){if(p.blockedOn!==null)return!1;for(var _=p.targetContainers;0<_.length;){var w=Rv(p.domEventName,p.eventSystemFlags,_[0],p.nativeEvent);if(w===null){w=p.nativeEvent;var O=new w.constructor(w.type,w);vi=O,w.target.dispatchEvent(O),vi=null}else return _=Hf(w),_!==null&&Tv(_),p.blockedOn=w,!1;_.shift()}return!0}function Zw(p,_,w){Zg(p)&&w.delete(_)}function oN(){Cv=!1,_u!==null&&Zg(_u)&&(_u=null),Eu!==null&&Zg(Eu)&&(Eu=null),yu!==null&&Zg(yu)&&(yu=null),bf.forEach(Zw),If.forEach(Zw)}function Of(p,_){p.blockedOn===_&&(p.blockedOn=null,Cv||(Cv=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,oN)))}function Ph(p){function _(U){return Of(U,p)}if(0<Qg.length){Of(Qg[0],p);for(var w=1;w<Qg.length;w++){var O=Qg[w];O.blockedOn===p&&(O.blockedOn=null)}}for(_u!==null&&Of(_u,p),Eu!==null&&Of(Eu,p),yu!==null&&Of(yu,p),bf.forEach(_),If.forEach(_),w=0;w<vu.length;w++)O=vu[w],O.blockedOn===p&&(O.blockedOn=null);for(;0<vu.length&&(w=vu[0],w.blockedOn===null);)Nh(w),w.blockedOn===null&&vu.shift()}var kh=le.ReactCurrentBatchConfig,e_=!0;function cN(p,_,w,O){var U=Tr,W=kh.transition;kh.transition=null;try{Tr=1,va(p,_,w,O)}finally{Tr=U,kh.transition=W}}function Su(p,_,w,O){var U=Tr,W=kh.transition;kh.transition=null;try{Tr=4,va(p,_,w,O)}finally{Tr=U,kh.transition=W}}function va(p,_,w,O){if(e_){var U=Rv(p,_,w,O);if(U===null)Hv(p,_,O,Nf,w),Qw(p,O);else if(aN(U,p,_,w,O))O.stopPropagation();else if(Qw(p,O),_&4&&-1<$w.indexOf(p)){for(;U!==null;){var W=Hf(U);if(W!==null&&Jg(W),W=Rv(p,_,w,O),W===null&&Hv(p,_,O,Nf,w),W===U)break;U=W}U!==null&&O.stopPropagation()}else Hv(p,_,O,null,w)}}var Nf=null;function Rv(p,_,w,O){if(Nf=null,p=no(O),p=Dd(p),p!==null)if(_=Vt(p),_===null)p=null;else if(w=_.tag,w===13){if(p=Rn(_),p!==null)return p;p=null}else if(w===3){if(_.stateNode.current.memoizedState.isDehydrated)return _.tag===3?_.stateNode.containerInfo:null;p=null}else _!==p&&(p=null);return Nf=p,null}function eC(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Cf()){case Ur:return 1;case Rc:return 4;case gl:case Ah:return 16;case sr:return 536870912;default:return 16}default:return 16}}var Tu=null,Is=null,t_=null;function tC(){if(t_)return t_;var p,_=Is,w=_.length,O,U="value"in Tu?Tu.value:Tu.textContent,W=U.length;for(p=0;p<w&&_[p]===U[p];p++);var ee=w-p;for(O=1;O<=ee&&_[w-O]===U[W-O];O++);return t_=U.slice(p,1<O?1-O:void 0)}function n_(p){var _=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&_===13&&(p=13)):p=_,p===10&&(p=13),32<=p||p===13?p:0}function Pd(){return!0}function bv(){return!1}function Fa(p){function _(w,O,U,W,ee){this._reactName=w,this._targetInst=U,this.type=O,this.nativeEvent=W,this.target=ee,this.currentTarget=null;for(var me in p)p.hasOwnProperty(me)&&(w=p[me],this[me]=w?w(W):W[me]);return this.isDefaultPrevented=(W.defaultPrevented!=null?W.defaultPrevented:W.returnValue===!1)?Pd:bv,this.isPropagationStopped=bv,this}return ae(_.prototype,{preventDefault:function(){this.defaultPrevented=!0;var w=this.nativeEvent;w&&(w.preventDefault?w.preventDefault():typeof w.returnValue!="unknown"&&(w.returnValue=!1),this.isDefaultPrevented=Pd)},stopPropagation:function(){var w=this.nativeEvent;w&&(w.stopPropagation?w.stopPropagation():typeof w.cancelBubble!="unknown"&&(w.cancelBubble=!0),this.isPropagationStopped=Pd)},persist:function(){},isPersistent:Pd}),_}var wu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Iv=Fa(wu),kd=ae({},wu,{view:0,detail:0}),Av=Fa(kd),Pf,Ov,kf,bc=ae({},kd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Pv,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==kf&&(kf&&p.type==="mousemove"?(Pf=p.screenX-kf.screenX,Ov=p.screenY-kf.screenY):Ov=Pf=0,kf=p),Pf)},movementY:function(p){return"movementY"in p?p.movementY:Ov}}),Dh=Fa(bc),lN=ae({},bc,{dataTransfer:0}),uN=Fa(lN),dN=ae({},kd,{relatedTarget:0}),Nv=Fa(dN),hN=ae({},wu,{animationName:0,elapsedTime:0,pseudoElement:0}),xh=Fa(hN),pN=ae({},wu,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),Lh=Fa(pN),nC=ae({},wu,{data:0}),rC=Fa(nC),Sn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fN={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},mN={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function gN(p){var _=this.nativeEvent;return _.getModifierState?_.getModifierState(p):(p=mN[p])?!!_[p]:!1}function Pv(){return gN}var kv=ae({},kd,{key:function(p){if(p.key){var _=Sn[p.key]||p.key;if(_!=="Unidentified")return _}return p.type==="keypress"?(p=n_(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?fN[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Pv,charCode:function(p){return p.type==="keypress"?n_(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?n_(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),_N=Fa(kv),EN=ae({},bc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),iC=Fa(EN),Dv=ae({},kd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Pv}),yN=Fa(Dv),vN=ae({},wu,{propertyName:0,elapsedTime:0,pseudoElement:0}),sC=Fa(vN),SN=ae({},bc,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),Cu=Fa(SN),TN=[9,13,27,32],xv=E&&"CompositionEvent"in window,Df=null;E&&"documentMode"in document&&(Df=document.documentMode);var aC=E&&"TextEvent"in window&&!Df,r_=E&&(!xv||Df&&8<Df&&11>=Df),oC=" ",cC=!1;function lC(p,_){switch(p){case"keyup":return TN.indexOf(_.keyCode)!==-1;case"keydown":return _.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Sa(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var Mh=!1;function wN(p,_){switch(p){case"compositionend":return Sa(_);case"keypress":return _.which!==32?null:(cC=!0,oC);case"textInput":return p=_.data,p===oC&&cC?null:p;default:return null}}function CN(p,_){if(Mh)return p==="compositionend"||!xv&&lC(p,_)?(p=tC(),t_=Is=Tu=null,Mh=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(_.ctrlKey||_.altKey||_.metaKey)||_.ctrlKey&&_.altKey){if(_.char&&1<_.char.length)return _.char;if(_.which)return String.fromCharCode(_.which)}return null;case"compositionend":return r_&&_.locale!=="ko"?null:_.data;default:return null}}var RN={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function i_(p){var _=p&&p.nodeName&&p.nodeName.toLowerCase();return _==="input"?!!RN[p.type]:_==="textarea"}function uC(p,_,w,O){Fo(O),_=jf(_,"onChange"),0<_.length&&(w=new Iv("onChange","change",null,w,O),p.push({event:w,listeners:_}))}var xf=null,Uh=null;function Lv(p){SC(p,0)}function s_(p){var _=Hh(p);if(Jr(_))return p}function bN(p,_){if(p==="change")return _}var Lf=!1;if(E){var Mv;if(E){var Uv="oninput"in document;if(!Uv){var dC=document.createElement("div");dC.setAttribute("oninput","return;"),Uv=typeof dC.oninput=="function"}Mv=Uv}else Mv=!1;Lf=Mv&&(!document.documentMode||9<document.documentMode)}function _l(){xf&&(xf.detachEvent("onpropertychange",hC),Uh=xf=null)}function hC(p){if(p.propertyName==="value"&&s_(Uh)){var _=[];uC(_,Uh,p,no(p)),Ls(Lv,_)}}function IN(p,_,w){p==="focusin"?(_l(),xf=_,Uh=w,xf.attachEvent("onpropertychange",hC)):p==="focusout"&&_l()}function ea(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return s_(Uh)}function AN(p,_){if(p==="click")return s_(_)}function ON(p,_){if(p==="input"||p==="change")return s_(_)}function NN(p,_){return p===_&&(p!==0||1/p===1/_)||p!==p&&_!==_}var jo=typeof Object.is=="function"?Object.is:NN;function Vh(p,_){if(jo(p,_))return!0;if(typeof p!="object"||p===null||typeof _!="object"||_===null)return!1;var w=Object.keys(p),O=Object.keys(_);if(w.length!==O.length)return!1;for(O=0;O<w.length;O++){var U=w[O];if(!S.call(_,U)||!jo(p[U],_[U]))return!1}return!0}function pC(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function fC(p,_){var w=pC(p);p=0;for(var O;w;){if(w.nodeType===3){if(O=p+w.textContent.length,p<=_&&O>=_)return{node:w,offset:_-p};p=O}e:{for(;w;){if(w.nextSibling){w=w.nextSibling;break e}w=w.parentNode}w=void 0}w=pC(w)}}function mC(p,_){return p&&_?p===_?!0:p&&p.nodeType===3?!1:_&&_.nodeType===3?mC(p,_.parentNode):"contains"in p?p.contains(_):p.compareDocumentPosition?!!(p.compareDocumentPosition(_)&16):!1:!1}function Vv(){for(var p=window,_=Mr();_ instanceof p.HTMLIFrameElement;){try{var w=typeof _.contentWindow.location.href=="string"}catch{w=!1}if(w)p=_.contentWindow;else break;_=Mr(p.document)}return _}function Fv(p){var _=p&&p.nodeName&&p.nodeName.toLowerCase();return _&&(_==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||_==="textarea"||p.contentEditable==="true")}function PN(p){var _=Vv(),w=p.focusedElem,O=p.selectionRange;if(_!==w&&w&&w.ownerDocument&&mC(w.ownerDocument.documentElement,w)){if(O!==null&&Fv(w)){if(_=O.start,p=O.end,p===void 0&&(p=_),"selectionStart"in w)w.selectionStart=_,w.selectionEnd=Math.min(p,w.value.length);else if(p=(_=w.ownerDocument||document)&&_.defaultView||window,p.getSelection){p=p.getSelection();var U=w.textContent.length,W=Math.min(O.start,U);O=O.end===void 0?W:Math.min(O.end,U),!p.extend&&W>O&&(U=O,O=W,W=U),U=fC(w,W);var ee=fC(w,O);U&&ee&&(p.rangeCount!==1||p.anchorNode!==U.node||p.anchorOffset!==U.offset||p.focusNode!==ee.node||p.focusOffset!==ee.offset)&&(_=_.createRange(),_.setStart(U.node,U.offset),p.removeAllRanges(),W>O?(p.addRange(_),p.extend(ee.node,ee.offset)):(_.setEnd(ee.node,ee.offset),p.addRange(_)))}}for(_=[],p=w;p=p.parentNode;)p.nodeType===1&&_.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof w.focus=="function"&&w.focus(),w=0;w<_.length;w++)p=_[w],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var jv=E&&"documentMode"in document&&11>=document.documentMode,Ru=null,Bv=null,ke=null,Wv=!1;function gC(p,_,w){var O=w.window===w?w.document:w.nodeType===9?w:w.ownerDocument;Wv||Ru==null||Ru!==Mr(O)||(O=Ru,"selectionStart"in O&&Fv(O)?O={start:O.selectionStart,end:O.selectionEnd}:(O=(O.ownerDocument&&O.ownerDocument.defaultView||window).getSelection(),O={anchorNode:O.anchorNode,anchorOffset:O.anchorOffset,focusNode:O.focusNode,focusOffset:O.focusOffset}),ke&&Vh(ke,O)||(ke=O,O=jf(Bv,"onSelect"),0<O.length&&(_=new Iv("onSelect","select",null,_,w),p.push({event:_,listeners:O}),_.target=Ru)))}function a_(p,_){var w={};return w[p.toLowerCase()]=_.toLowerCase(),w["Webkit"+p]="webkit"+_,w["Moz"+p]="moz"+_,w}var Fh={animationend:a_("Animation","AnimationEnd"),animationiteration:a_("Animation","AnimationIteration"),animationstart:a_("Animation","AnimationStart"),transitionend:a_("Transition","TransitionEnd")},o_={},Gv={};E&&(Gv=document.createElement("div").style,"AnimationEvent"in window||(delete Fh.animationend.animation,delete Fh.animationiteration.animation,delete Fh.animationstart.animation),"TransitionEvent"in window||delete Fh.transitionend.transition);function c_(p){if(o_[p])return o_[p];if(!Fh[p])return p;var _=Fh[p],w;for(w in _)if(_.hasOwnProperty(w)&&w in Gv)return o_[p]=_[w];return p}var _C=c_("animationend"),EC=c_("animationiteration"),Mf=c_("animationstart"),jh=c_("transitionend"),yC=new Map,vC="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Bo(p,_){yC.set(p,_),h(_,[p])}for(var Uf=0;Uf<vC.length;Uf++){var Bh=vC[Uf],kN=Bh.toLowerCase(),DN=Bh[0].toUpperCase()+Bh.slice(1);Bo(kN,"on"+DN)}Bo(_C,"onAnimationEnd"),Bo(EC,"onAnimationIteration"),Bo(Mf,"onAnimationStart"),Bo("dblclick","onDoubleClick"),Bo("focusin","onFocus"),Bo("focusout","onBlur"),Bo(jh,"onTransitionEnd"),m("onMouseEnter",["mouseout","mouseover"]),m("onMouseLeave",["mouseout","mouseover"]),m("onPointerEnter",["pointerout","pointerover"]),m("onPointerLeave",["pointerout","pointerover"]),h("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),h("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),h("onBeforeInput",["compositionend","keypress","textInput","paste"]),h("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),h("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),h("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Vf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),xN=new Set("cancel close invalid load scroll toggle".split(" ").concat(Vf));function l_(p,_,w){var O=p.type||"unknown-event";p.currentTarget=w,xt(O,_,void 0,p),p.currentTarget=null}function SC(p,_){_=(_&4)!==0;for(var w=0;w<p.length;w++){var O=p[w],U=O.event;O=O.listeners;e:{var W=void 0;if(_)for(var ee=O.length-1;0<=ee;ee--){var me=O[ee],ve=me.instance,He=me.currentTarget;if(me=me.listener,ve!==W&&U.isPropagationStopped())break e;l_(U,me,He),W=ve}else for(ee=0;ee<O.length;ee++){if(me=O[ee],ve=me.instance,He=me.currentTarget,me=me.listener,ve!==W&&U.isPropagationStopped())break e;l_(U,me,He),W=ve}}}if(Yt)throw p=hn,Yt=!1,hn=null,p}function Qr(p,_){var w=_[qv];w===void 0&&(w=_[qv]=new Set);var O=p+"__bubble";w.has(O)||(TC(_,p,2,!1),w.add(O))}function ta(p,_,w){var O=0;_&&(O|=4),TC(w,p,O,_)}var u_="_reactListening"+Math.random().toString(36).slice(2);function El(p){if(!p[u_]){p[u_]=!0,c.forEach(function(w){w!=="selectionchange"&&(xN.has(w)||ta(w,!1,p),ta(w,!0,p))});var _=p.nodeType===9?p:p.ownerDocument;_===null||_[u_]||(_[u_]=!0,ta("selectionchange",!1,_))}}function TC(p,_,w,O){switch(eC(_)){case 1:var U=cN;break;case 4:U=Su;break;default:U=va}w=U.bind(null,_,w,p),U=void 0,!ye||_!=="touchstart"&&_!=="touchmove"&&_!=="wheel"||(U=!0),O?U!==void 0?p.addEventListener(_,w,{capture:!0,passive:U}):p.addEventListener(_,w,!0):U!==void 0?p.addEventListener(_,w,{passive:U}):p.addEventListener(_,w,!1)}function Hv(p,_,w,O,U){var W=O;if((_&1)===0&&(_&2)===0&&O!==null)e:for(;;){if(O===null)return;var ee=O.tag;if(ee===3||ee===4){var me=O.stateNode.containerInfo;if(me===U||me.nodeType===8&&me.parentNode===U)break;if(ee===4)for(ee=O.return;ee!==null;){var ve=ee.tag;if((ve===3||ve===4)&&(ve=ee.stateNode.containerInfo,ve===U||ve.nodeType===8&&ve.parentNode===U))return;ee=ee.return}for(;me!==null;){if(ee=Dd(me),ee===null)return;if(ve=ee.tag,ve===5||ve===6){O=W=ee;continue e}me=me.parentNode}}O=O.return}Ls(function(){var He=W,ut=no(w),ht=[];e:{var ot=yC.get(p);if(ot!==void 0){var bt=Iv,Bt=p;switch(p){case"keypress":if(n_(w)===0)break e;case"keydown":case"keyup":bt=_N;break;case"focusin":Bt="focus",bt=Nv;break;case"focusout":Bt="blur",bt=Nv;break;case"beforeblur":case"afterblur":bt=Nv;break;case"click":if(w.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":bt=Dh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":bt=uN;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":bt=yN;break;case _C:case EC:case Mf:bt=xh;break;case jh:bt=sC;break;case"scroll":bt=Av;break;case"wheel":bt=Cu;break;case"copy":case"cut":case"paste":bt=Lh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":bt=iC}var Gt=(_&4)!==0,Wi=!Gt&&p==="scroll",xe=Gt?ot!==null?ot+"Capture":null:ot;Gt=[];for(var Te=He,Fe;Te!==null;){Fe=Te;var ft=Fe.stateNode;if(Fe.tag===5&&ft!==null&&(Fe=ft,xe!==null&&(ft=kr(Te,xe),ft!=null&&Gt.push(Ff(Te,ft,Fe)))),Wi)break;Te=Te.return}0<Gt.length&&(ot=new bt(ot,Bt,null,w,ut),ht.push({event:ot,listeners:Gt}))}}if((_&7)===0){e:{if(ot=p==="mouseover"||p==="pointerover",bt=p==="mouseout"||p==="pointerout",ot&&w!==vi&&(Bt=w.relatedTarget||w.fromElement)&&(Dd(Bt)||Bt[yl]))break e;if((bt||ot)&&(ot=ut.window===ut?ut:(ot=ut.ownerDocument)?ot.defaultView||ot.parentWindow:window,bt?(Bt=w.relatedTarget||w.toElement,bt=He,Bt=Bt?Dd(Bt):null,Bt!==null&&(Wi=Vt(Bt),Bt!==Wi||Bt.tag!==5&&Bt.tag!==6)&&(Bt=null)):(bt=null,Bt=He),bt!==Bt)){if(Gt=Dh,ft="onMouseLeave",xe="onMouseEnter",Te="mouse",(p==="pointerout"||p==="pointerover")&&(Gt=iC,ft="onPointerLeave",xe="onPointerEnter",Te="pointer"),Wi=bt==null?ot:Hh(bt),Fe=Bt==null?ot:Hh(Bt),ot=new Gt(ft,Te+"leave",bt,w,ut),ot.target=Wi,ot.relatedTarget=Fe,ft=null,Dd(ut)===He&&(Gt=new Gt(xe,Te+"enter",Bt,w,ut),Gt.target=Fe,Gt.relatedTarget=Wi,ft=Gt),Wi=ft,bt&&Bt)t:{for(Gt=bt,xe=Bt,Te=0,Fe=Gt;Fe;Fe=Wh(Fe))Te++;for(Fe=0,ft=xe;ft;ft=Wh(ft))Fe++;for(;0<Te-Fe;)Gt=Wh(Gt),Te--;for(;0<Fe-Te;)xe=Wh(xe),Fe--;for(;Te--;){if(Gt===xe||xe!==null&&Gt===xe.alternate)break t;Gt=Wh(Gt),xe=Wh(xe)}Gt=null}else Gt=null;bt!==null&&wC(ht,ot,bt,Gt,!1),Bt!==null&&Wi!==null&&wC(ht,Wi,Bt,Gt,!0)}}e:{if(ot=He?Hh(He):window,bt=ot.nodeName&&ot.nodeName.toLowerCase(),bt==="select"||bt==="input"&&ot.type==="file")var qt=bN;else if(i_(ot))if(Lf)qt=ON;else{qt=ea;var sn=IN}else(bt=ot.nodeName)&&bt.toLowerCase()==="input"&&(ot.type==="checkbox"||ot.type==="radio")&&(qt=AN);if(qt&&(qt=qt(p,He))){uC(ht,qt,w,ut);break e}sn&&sn(p,ot,He),p==="focusout"&&(sn=ot._wrapperState)&&sn.controlled&&ot.type==="number"&&fi(ot,"number",ot.value)}switch(sn=He?Hh(He):window,p){case"focusin":(i_(sn)||sn.contentEditable==="true")&&(Ru=sn,Bv=He,ke=null);break;case"focusout":ke=Bv=Ru=null;break;case"mousedown":Wv=!0;break;case"contextmenu":case"mouseup":case"dragend":Wv=!1,gC(ht,w,ut);break;case"selectionchange":if(jv)break;case"keydown":case"keyup":gC(ht,w,ut)}var rn;if(xv)e:{switch(p){case"compositionstart":var gn="onCompositionStart";break e;case"compositionend":gn="onCompositionEnd";break e;case"compositionupdate":gn="onCompositionUpdate";break e}gn=void 0}else Mh?lC(p,w)&&(gn="onCompositionEnd"):p==="keydown"&&w.keyCode===229&&(gn="onCompositionStart");gn&&(r_&&w.locale!=="ko"&&(Mh||gn!=="onCompositionStart"?gn==="onCompositionEnd"&&Mh&&(rn=tC()):(Tu=ut,Is="value"in Tu?Tu.value:Tu.textContent,Mh=!0)),sn=jf(He,gn),0<sn.length&&(gn=new rC(gn,p,null,w,ut),ht.push({event:gn,listeners:sn}),rn?gn.data=rn:(rn=Sa(w),rn!==null&&(gn.data=rn)))),(rn=aC?wN(p,w):CN(p,w))&&(He=jf(He,"onBeforeInput"),0<He.length&&(ut=new rC("onBeforeInput","beforeinput",null,w,ut),ht.push({event:ut,listeners:He}),ut.data=rn))}SC(ht,_)})}function Ff(p,_,w){return{instance:p,listener:_,currentTarget:w}}function jf(p,_){for(var w=_+"Capture",O=[];p!==null;){var U=p,W=U.stateNode;U.tag===5&&W!==null&&(U=W,W=kr(p,w),W!=null&&O.unshift(Ff(p,W,U)),W=kr(p,_),W!=null&&O.push(Ff(p,W,U))),p=p.return}return O}function Wh(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function wC(p,_,w,O,U){for(var W=_._reactName,ee=[];w!==null&&w!==O;){var me=w,ve=me.alternate,He=me.stateNode;if(ve!==null&&ve===O)break;me.tag===5&&He!==null&&(me=He,U?(ve=kr(w,W),ve!=null&&ee.unshift(Ff(w,ve,me))):U||(ve=kr(w,W),ve!=null&&ee.push(Ff(w,ve,me)))),w=w.return}ee.length!==0&&p.push({event:_,listeners:ee})}var LN=/\r\n?/g,zv=/\u0000|\uFFFD/g;function CC(p){return(typeof p=="string"?p:""+p).replace(LN,`
`).replace(zv,"")}function Bf(p,_,w){if(_=CC(_),CC(p)!==_&&w)throw Error(a(425))}function Wf(){}var Kv=null,d_=null;function Gh(p,_){return p==="textarea"||p==="noscript"||typeof _.children=="string"||typeof _.children=="number"||typeof _.dangerouslySetInnerHTML=="object"&&_.dangerouslySetInnerHTML!==null&&_.dangerouslySetInnerHTML.__html!=null}var Yv=typeof setTimeout=="function"?setTimeout:void 0,MN=typeof clearTimeout=="function"?clearTimeout:void 0,RC=typeof Promise=="function"?Promise:void 0,UN=typeof queueMicrotask=="function"?queueMicrotask:typeof RC<"u"?function(p){return RC.resolve(null).then(p).catch(VN)}:Yv;function VN(p){setTimeout(function(){throw p})}function h_(p,_){var w=_,O=0;do{var U=w.nextSibling;if(p.removeChild(w),U&&U.nodeType===8)if(w=U.data,w==="/$"){if(O===0){p.removeChild(U),Ph(_);return}O--}else w!=="$"&&w!=="$?"&&w!=="$!"||O++;w=U}while(w);Ph(_)}function Ic(p){for(;p!=null;p=p.nextSibling){var _=p.nodeType;if(_===1||_===3)break;if(_===8){if(_=p.data,_==="$"||_==="$!"||_==="$?")break;if(_==="/$")return null}}return p}function bC(p){p=p.previousSibling;for(var _=0;p;){if(p.nodeType===8){var w=p.data;if(w==="$"||w==="$!"||w==="$?"){if(_===0)return p;_--}else w==="/$"&&_++}p=p.previousSibling}return null}var bu=Math.random().toString(36).slice(2),Ac="__reactFiber$"+bu,Gf="__reactProps$"+bu,yl="__reactContainer$"+bu,qv="__reactEvents$"+bu,FN="__reactListeners$"+bu,jN="__reactHandles$"+bu;function Dd(p){var _=p[Ac];if(_)return _;for(var w=p.parentNode;w;){if(_=w[yl]||w[Ac]){if(w=_.alternate,_.child!==null||w!==null&&w.child!==null)for(p=bC(p);p!==null;){if(w=p[Ac])return w;p=bC(p)}return _}p=w,w=p.parentNode}return null}function Hf(p){return p=p[Ac]||p[yl],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function Hh(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(a(33))}function p_(p){return p[Gf]||null}var Xv=[],vl=-1;function Wo(p){return{current:p}}function Hr(p){0>vl||(p.current=Xv[vl],Xv[vl]=null,vl--)}function Zr(p,_){vl++,Xv[vl]=p.current,p.current=_}var Iu={},Ms=Wo(Iu),na=Wo(!1),Au=Iu;function Ou(p,_){var w=p.type.contextTypes;if(!w)return Iu;var O=p.stateNode;if(O&&O.__reactInternalMemoizedUnmaskedChildContext===_)return O.__reactInternalMemoizedMaskedChildContext;var U={},W;for(W in w)U[W]=_[W];return O&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=_,p.__reactInternalMemoizedMaskedChildContext=U),U}function Ta(p){return p=p.childContextTypes,p!=null}function f_(){Hr(na),Hr(Ms)}function zh(p,_,w){if(Ms.current!==Iu)throw Error(a(168));Zr(Ms,_),Zr(na,w)}function IC(p,_,w){var O=p.stateNode;if(_=_.childContextTypes,typeof O.getChildContext!="function")return w;O=O.getChildContext();for(var U in O)if(!(U in _))throw Error(a(108,At(p)||"Unknown",U));return ae({},w,O)}function m_(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||Iu,Au=Ms.current,Zr(Ms,p),Zr(na,na.current),!0}function AC(p,_,w){var O=p.stateNode;if(!O)throw Error(a(169));w?(p=IC(p,_,Au),O.__reactInternalMemoizedMergedChildContext=p,Hr(na),Hr(Ms),Zr(Ms,p)):Hr(na),Zr(na,w)}var Sl=null,g_=!1,Jv=!1;function $v(p){Sl===null?Sl=[p]:Sl.push(p)}function BN(p){g_=!0,$v(p)}function Nu(){if(!Jv&&Sl!==null){Jv=!0;var p=0,_=Tr;try{var w=Sl;for(Tr=1;p<w.length;p++){var O=w[p];do O=O(!0);while(O!==null)}Sl=null,g_=!1}catch(U){throw Sl!==null&&(Sl=Sl.slice(p+1)),Ar(Ur,Nu),U}finally{Tr=_,Jv=!1}}return null}var Kh=[],Pu=0,__=null,E_=0,ra=[],io=0,xd=null,Tl=1,wl="";function Ld(p,_){Kh[Pu++]=E_,Kh[Pu++]=__,__=p,E_=_}function OC(p,_,w){ra[io++]=Tl,ra[io++]=wl,ra[io++]=xd,xd=p;var O=Tl;p=wl;var U=32-_r(O)-1;O&=~(1<<U),w+=1;var W=32-_r(_)+U;if(30<W){var ee=U-U%5;W=(O&(1<<ee)-1).toString(32),O>>=ee,U-=ee,Tl=1<<32-_r(_)+U|w<<U|O,wl=W+p}else Tl=1<<W|w<<U|O,wl=p}function Yh(p){p.return!==null&&(Ld(p,1),OC(p,1,0))}function y_(p){for(;p===__;)__=Kh[--Pu],Kh[Pu]=null,E_=Kh[--Pu],Kh[Pu]=null;for(;p===xd;)xd=ra[--io],ra[io]=null,wl=ra[--io],ra[io]=null,Tl=ra[--io],ra[io]=null}var ja=null,Ba=null,si=!1,Go=null;function NC(p,_){var w=lo(5,null,null,0);w.elementType="DELETED",w.stateNode=_,w.return=p,_=p.deletions,_===null?(p.deletions=[w],p.flags|=16):_.push(w)}function PC(p,_){switch(p.tag){case 5:var w=p.type;return _=_.nodeType!==1||w.toLowerCase()!==_.nodeName.toLowerCase()?null:_,_!==null?(p.stateNode=_,ja=p,Ba=Ic(_.firstChild),!0):!1;case 6:return _=p.pendingProps===""||_.nodeType!==3?null:_,_!==null?(p.stateNode=_,ja=p,Ba=null,!0):!1;case 13:return _=_.nodeType!==8?null:_,_!==null?(w=xd!==null?{id:Tl,overflow:wl}:null,p.memoizedState={dehydrated:_,treeContext:w,retryLane:1073741824},w=lo(18,null,null,0),w.stateNode=_,w.return=p,p.child=w,ja=p,Ba=null,!0):!1;default:return!1}}function zf(p){return(p.mode&1)!==0&&(p.flags&128)===0}function Kf(p){if(si){var _=Ba;if(_){var w=_;if(!PC(p,_)){if(zf(p))throw Error(a(418));_=Ic(w.nextSibling);var O=ja;_&&PC(p,_)?NC(O,w):(p.flags=p.flags&-4097|2,si=!1,ja=p)}}else{if(zf(p))throw Error(a(418));p.flags=p.flags&-4097|2,si=!1,ja=p}}}function Qv(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;ja=p}function qh(p){if(p!==ja)return!1;if(!si)return Qv(p),si=!0,!1;var _;if((_=p.tag!==3)&&!(_=p.tag!==5)&&(_=p.type,_=_!=="head"&&_!=="body"&&!Gh(p.type,p.memoizedProps)),_&&(_=Ba)){if(zf(p))throw Zv(),Error(a(418));for(;_;)NC(p,_),_=Ic(_.nextSibling)}if(Qv(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(a(317));e:{for(p=p.nextSibling,_=0;p;){if(p.nodeType===8){var w=p.data;if(w==="/$"){if(_===0){Ba=Ic(p.nextSibling);break e}_--}else w!=="$"&&w!=="$!"&&w!=="$?"||_++}p=p.nextSibling}Ba=null}}else Ba=ja?Ic(p.stateNode.nextSibling):null;return!0}function Zv(){for(var p=Ba;p;)p=Ic(p.nextSibling)}function Md(){Ba=ja=null,si=!1}function Xh(p){Go===null?Go=[p]:Go.push(p)}var Yf=le.ReactCurrentBatchConfig;function qf(p,_,w){if(p=w.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(w._owner){if(w=w._owner,w){if(w.tag!==1)throw Error(a(309));var O=w.stateNode}if(!O)throw Error(a(147,p));var U=O,W=""+p;return _!==null&&_.ref!==null&&typeof _.ref=="function"&&_.ref._stringRef===W?_.ref:(_=function(ee){var me=U.refs;ee===null?delete me[W]:me[W]=ee},_._stringRef=W,_)}if(typeof p!="string")throw Error(a(284));if(!w._owner)throw Error(a(290,p))}return p}function v_(p,_){throw p=Object.prototype.toString.call(_),Error(a(31,p==="[object Object]"?"object with keys {"+Object.keys(_).join(", ")+"}":p))}function eS(p){var _=p._init;return _(p._payload)}function kC(p){function _(xe,Te){if(p){var Fe=xe.deletions;Fe===null?(xe.deletions=[Te],xe.flags|=16):Fe.push(Te)}}function w(xe,Te){if(!p)return null;for(;Te!==null;)_(xe,Te),Te=Te.sibling;return null}function O(xe,Te){for(xe=new Map;Te!==null;)Te.key!==null?xe.set(Te.key,Te):xe.set(Te.index,Te),Te=Te.sibling;return xe}function U(xe,Te){return xe=Gu(xe,Te),xe.index=0,xe.sibling=null,xe}function W(xe,Te,Fe){return xe.index=Fe,p?(Fe=xe.alternate,Fe!==null?(Fe=Fe.index,Fe<Te?(xe.flags|=2,Te):Fe):(xe.flags|=2,Te)):(xe.flags|=1048576,Te)}function ee(xe){return p&&xe.alternate===null&&(xe.flags|=2),xe}function me(xe,Te,Fe,ft){return Te===null||Te.tag!==6?(Te=J_(Fe,xe.mode,ft),Te.return=xe,Te):(Te=U(Te,Fe),Te.return=xe,Te)}function ve(xe,Te,Fe,ft){var qt=Fe.type;return qt===te?ut(xe,Te,Fe.props.children,ft,Fe.key):Te!==null&&(Te.elementType===qt||typeof qt=="object"&&qt!==null&&qt.$$typeof===$e&&eS(qt)===Te.type)?(ft=U(Te,Fe.props),ft.ref=qf(xe,Te,Fe),ft.return=xe,ft):(ft=op(Fe.type,Fe.key,Fe.props,null,xe.mode,ft),ft.ref=qf(xe,Te,Fe),ft.return=xe,ft)}function He(xe,Te,Fe,ft){return Te===null||Te.tag!==4||Te.stateNode.containerInfo!==Fe.containerInfo||Te.stateNode.implementation!==Fe.implementation?(Te=cp(Fe,xe.mode,ft),Te.return=xe,Te):(Te=U(Te,Fe.children||[]),Te.return=xe,Te)}function ut(xe,Te,Fe,ft,qt){return Te===null||Te.tag!==7?(Te=Hu(Fe,xe.mode,ft,qt),Te.return=xe,Te):(Te=U(Te,Fe),Te.return=xe,Te)}function ht(xe,Te,Fe){if(typeof Te=="string"&&Te!==""||typeof Te=="number")return Te=J_(""+Te,xe.mode,Fe),Te.return=xe,Te;if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case re:return Fe=op(Te.type,Te.key,Te.props,null,xe.mode,Fe),Fe.ref=qf(xe,null,Te),Fe.return=xe,Fe;case ce:return Te=cp(Te,xe.mode,Fe),Te.return=xe,Te;case $e:var ft=Te._init;return ht(xe,ft(Te._payload),Fe)}if($s(Te)||Ke(Te))return Te=Hu(Te,xe.mode,Fe,null),Te.return=xe,Te;v_(xe,Te)}return null}function ot(xe,Te,Fe,ft){var qt=Te!==null?Te.key:null;if(typeof Fe=="string"&&Fe!==""||typeof Fe=="number")return qt!==null?null:me(xe,Te,""+Fe,ft);if(typeof Fe=="object"&&Fe!==null){switch(Fe.$$typeof){case re:return Fe.key===qt?ve(xe,Te,Fe,ft):null;case ce:return Fe.key===qt?He(xe,Te,Fe,ft):null;case $e:return qt=Fe._init,ot(xe,Te,qt(Fe._payload),ft)}if($s(Fe)||Ke(Fe))return qt!==null?null:ut(xe,Te,Fe,ft,null);v_(xe,Fe)}return null}function bt(xe,Te,Fe,ft,qt){if(typeof ft=="string"&&ft!==""||typeof ft=="number")return xe=xe.get(Fe)||null,me(Te,xe,""+ft,qt);if(typeof ft=="object"&&ft!==null){switch(ft.$$typeof){case re:return xe=xe.get(ft.key===null?Fe:ft.key)||null,ve(Te,xe,ft,qt);case ce:return xe=xe.get(ft.key===null?Fe:ft.key)||null,He(Te,xe,ft,qt);case $e:var sn=ft._init;return bt(xe,Te,Fe,sn(ft._payload),qt)}if($s(ft)||Ke(ft))return xe=xe.get(Fe)||null,ut(Te,xe,ft,qt,null);v_(Te,ft)}return null}function Bt(xe,Te,Fe,ft){for(var qt=null,sn=null,rn=Te,gn=Te=0,ds=null;rn!==null&&gn<Fe.length;gn++){rn.index>gn?(ds=rn,rn=null):ds=rn.sibling;var ar=ot(xe,rn,Fe[gn],ft);if(ar===null){rn===null&&(rn=ds);break}p&&rn&&ar.alternate===null&&_(xe,rn),Te=W(ar,Te,gn),sn===null?qt=ar:sn.sibling=ar,sn=ar,rn=ds}if(gn===Fe.length)return w(xe,rn),si&&Ld(xe,gn),qt;if(rn===null){for(;gn<Fe.length;gn++)rn=ht(xe,Fe[gn],ft),rn!==null&&(Te=W(rn,Te,gn),sn===null?qt=rn:sn.sibling=rn,sn=rn);return si&&Ld(xe,gn),qt}for(rn=O(xe,rn);gn<Fe.length;gn++)ds=bt(rn,xe,gn,Fe[gn],ft),ds!==null&&(p&&ds.alternate!==null&&rn.delete(ds.key===null?gn:ds.key),Te=W(ds,Te,gn),sn===null?qt=ds:sn.sibling=ds,sn=ds);return p&&rn.forEach(function(kl){return _(xe,kl)}),si&&Ld(xe,gn),qt}function Gt(xe,Te,Fe,ft){var qt=Ke(Fe);if(typeof qt!="function")throw Error(a(150));if(Fe=qt.call(Fe),Fe==null)throw Error(a(151));for(var sn=qt=null,rn=Te,gn=Te=0,ds=null,ar=Fe.next();rn!==null&&!ar.done;gn++,ar=Fe.next()){rn.index>gn?(ds=rn,rn=null):ds=rn.sibling;var kl=ot(xe,rn,ar.value,ft);if(kl===null){rn===null&&(rn=ds);break}p&&rn&&kl.alternate===null&&_(xe,rn),Te=W(kl,Te,gn),sn===null?qt=kl:sn.sibling=kl,sn=kl,rn=ds}if(ar.done)return w(xe,rn),si&&Ld(xe,gn),qt;if(rn===null){for(;!ar.done;gn++,ar=Fe.next())ar=ht(xe,ar.value,ft),ar!==null&&(Te=W(ar,Te,gn),sn===null?qt=ar:sn.sibling=ar,sn=ar);return si&&Ld(xe,gn),qt}for(rn=O(xe,rn);!ar.done;gn++,ar=Fe.next())ar=bt(rn,xe,gn,ar.value,ft),ar!==null&&(p&&ar.alternate!==null&&rn.delete(ar.key===null?gn:ar.key),Te=W(ar,Te,gn),sn===null?qt=ar:sn.sibling=ar,sn=ar);return p&&rn.forEach(function(iP){return _(xe,iP)}),si&&Ld(xe,gn),qt}function Wi(xe,Te,Fe,ft){if(typeof Fe=="object"&&Fe!==null&&Fe.type===te&&Fe.key===null&&(Fe=Fe.props.children),typeof Fe=="object"&&Fe!==null){switch(Fe.$$typeof){case re:e:{for(var qt=Fe.key,sn=Te;sn!==null;){if(sn.key===qt){if(qt=Fe.type,qt===te){if(sn.tag===7){w(xe,sn.sibling),Te=U(sn,Fe.props.children),Te.return=xe,xe=Te;break e}}else if(sn.elementType===qt||typeof qt=="object"&&qt!==null&&qt.$$typeof===$e&&eS(qt)===sn.type){w(xe,sn.sibling),Te=U(sn,Fe.props),Te.ref=qf(xe,sn,Fe),Te.return=xe,xe=Te;break e}w(xe,sn);break}else _(xe,sn);sn=sn.sibling}Fe.type===te?(Te=Hu(Fe.props.children,xe.mode,ft,Fe.key),Te.return=xe,xe=Te):(ft=op(Fe.type,Fe.key,Fe.props,null,xe.mode,ft),ft.ref=qf(xe,Te,Fe),ft.return=xe,xe=ft)}return ee(xe);case ce:e:{for(sn=Fe.key;Te!==null;){if(Te.key===sn)if(Te.tag===4&&Te.stateNode.containerInfo===Fe.containerInfo&&Te.stateNode.implementation===Fe.implementation){w(xe,Te.sibling),Te=U(Te,Fe.children||[]),Te.return=xe,xe=Te;break e}else{w(xe,Te);break}else _(xe,Te);Te=Te.sibling}Te=cp(Fe,xe.mode,ft),Te.return=xe,xe=Te}return ee(xe);case $e:return sn=Fe._init,Wi(xe,Te,sn(Fe._payload),ft)}if($s(Fe))return Bt(xe,Te,Fe,ft);if(Ke(Fe))return Gt(xe,Te,Fe,ft);v_(xe,Fe)}return typeof Fe=="string"&&Fe!==""||typeof Fe=="number"?(Fe=""+Fe,Te!==null&&Te.tag===6?(w(xe,Te.sibling),Te=U(Te,Fe),Te.return=xe,xe=Te):(w(xe,Te),Te=J_(Fe,xe.mode,ft),Te.return=xe,xe=Te),ee(xe)):w(xe,Te)}return Wi}var Jh=kC(!0),tS=kC(!1),S_=Wo(null),T_=null,$h=null,nS=null;function rS(){nS=$h=T_=null}function iS(p){var _=S_.current;Hr(S_),p._currentValue=_}function w_(p,_,w){for(;p!==null;){var O=p.alternate;if((p.childLanes&_)!==_?(p.childLanes|=_,O!==null&&(O.childLanes|=_)):O!==null&&(O.childLanes&_)!==_&&(O.childLanes|=_),p===w)break;p=p.return}}function Ho(p,_){T_=p,nS=$h=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&_)!==0&&(Ca=!0),p.firstContext=null)}function so(p){var _=p._currentValue;if(nS!==p)if(p={context:p,memoizedValue:_,next:null},$h===null){if(T_===null)throw Error(a(308));$h=p,T_.dependencies={lanes:0,firstContext:p}}else $h=$h.next=p;return _}var Ud=null;function sS(p){Ud===null?Ud=[p]:Ud.push(p)}function aS(p,_,w,O){var U=_.interleaved;return U===null?(w.next=w,sS(_)):(w.next=U.next,U.next=w),_.interleaved=w,Cl(p,O)}function Cl(p,_){p.lanes|=_;var w=p.alternate;for(w!==null&&(w.lanes|=_),w=p,p=p.return;p!==null;)p.childLanes|=_,w=p.alternate,w!==null&&(w.childLanes|=_),w=p,p=p.return;return w.tag===3?w.stateNode:null}var Rl=!1;function oS(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function DC(p,_){p=p.updateQueue,_.updateQueue===p&&(_.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function bl(p,_){return{eventTime:p,lane:_,tag:0,payload:null,callback:null,next:null}}function zo(p,_,w){var O=p.updateQueue;if(O===null)return null;if(O=O.shared,(Yn&2)!==0){var U=O.pending;return U===null?_.next=_:(_.next=U.next,U.next=_),O.pending=_,Cl(p,w)}return U=O.interleaved,U===null?(_.next=_,sS(O)):(_.next=U.next,U.next=_),O.interleaved=_,Cl(p,w)}function C_(p,_,w){if(_=_.updateQueue,_!==null&&(_=_.shared,(w&4194240)!==0)){var O=_.lanes;O&=p.pendingLanes,w|=O,_.lanes=w,vv(p,w)}}function xC(p,_){var w=p.updateQueue,O=p.alternate;if(O!==null&&(O=O.updateQueue,w===O)){var U=null,W=null;if(w=w.firstBaseUpdate,w!==null){do{var ee={eventTime:w.eventTime,lane:w.lane,tag:w.tag,payload:w.payload,callback:w.callback,next:null};W===null?U=W=ee:W=W.next=ee,w=w.next}while(w!==null);W===null?U=W=_:W=W.next=_}else U=W=_;w={baseState:O.baseState,firstBaseUpdate:U,lastBaseUpdate:W,shared:O.shared,effects:O.effects},p.updateQueue=w;return}p=w.lastBaseUpdate,p===null?w.firstBaseUpdate=_:p.next=_,w.lastBaseUpdate=_}function R_(p,_,w,O){var U=p.updateQueue;Rl=!1;var W=U.firstBaseUpdate,ee=U.lastBaseUpdate,me=U.shared.pending;if(me!==null){U.shared.pending=null;var ve=me,He=ve.next;ve.next=null,ee===null?W=He:ee.next=He,ee=ve;var ut=p.alternate;ut!==null&&(ut=ut.updateQueue,me=ut.lastBaseUpdate,me!==ee&&(me===null?ut.firstBaseUpdate=He:me.next=He,ut.lastBaseUpdate=ve))}if(W!==null){var ht=U.baseState;ee=0,ut=He=ve=null,me=W;do{var ot=me.lane,bt=me.eventTime;if((O&ot)===ot){ut!==null&&(ut=ut.next={eventTime:bt,lane:0,tag:me.tag,payload:me.payload,callback:me.callback,next:null});e:{var Bt=p,Gt=me;switch(ot=_,bt=w,Gt.tag){case 1:if(Bt=Gt.payload,typeof Bt=="function"){ht=Bt.call(bt,ht,ot);break e}ht=Bt;break e;case 3:Bt.flags=Bt.flags&-65537|128;case 0:if(Bt=Gt.payload,ot=typeof Bt=="function"?Bt.call(bt,ht,ot):Bt,ot==null)break e;ht=ae({},ht,ot);break e;case 2:Rl=!0}}me.callback!==null&&me.lane!==0&&(p.flags|=64,ot=U.effects,ot===null?U.effects=[me]:ot.push(me))}else bt={eventTime:bt,lane:ot,tag:me.tag,payload:me.payload,callback:me.callback,next:null},ut===null?(He=ut=bt,ve=ht):ut=ut.next=bt,ee|=ot;if(me=me.next,me===null){if(me=U.shared.pending,me===null)break;ot=me,me=ot.next,ot.next=null,U.lastBaseUpdate=ot,U.shared.pending=null}}while(!0);if(ut===null&&(ve=ht),U.baseState=ve,U.firstBaseUpdate=He,U.lastBaseUpdate=ut,_=U.shared.interleaved,_!==null){U=_;do ee|=U.lane,U=U.next;while(U!==_)}else W===null&&(U.shared.lanes=0);zd|=ee,p.lanes=ee,p.memoizedState=ht}}function LC(p,_,w){if(p=_.effects,_.effects=null,p!==null)for(_=0;_<p.length;_++){var O=p[_],U=O.callback;if(U!==null){if(O.callback=null,O=w,typeof U!="function")throw Error(a(191,U));U.call(O)}}}var Xf={},Oc=Wo(Xf),Vd=Wo(Xf),Jf=Wo(Xf);function ku(p){if(p===Xf)throw Error(a(174));return p}function cS(p,_){switch(Zr(Jf,_),Zr(Vd,p),Zr(Oc,Xf),p=_.nodeType,p){case 9:case 11:_=(_=_.documentElement)?_.namespaceURI:lt(null,"");break;default:p=p===8?_.parentNode:_,_=p.namespaceURI||null,p=p.tagName,_=lt(_,p)}Hr(Oc),Zr(Oc,_)}function Fd(){Hr(Oc),Hr(Vd),Hr(Jf)}function MC(p){ku(Jf.current);var _=ku(Oc.current),w=lt(_,p.type);_!==w&&(Zr(Vd,p),Zr(Oc,w))}function lS(p){Vd.current===p&&(Hr(Oc),Hr(Vd))}var Si=Wo(0);function b_(p){for(var _=p;_!==null;){if(_.tag===13){var w=_.memoizedState;if(w!==null&&(w=w.dehydrated,w===null||w.data==="$?"||w.data==="$!"))return _}else if(_.tag===19&&_.memoizedProps.revealOrder!==void 0){if((_.flags&128)!==0)return _}else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===p)break;for(;_.sibling===null;){if(_.return===null||_.return===p)return null;_=_.return}_.sibling.return=_.return,_=_.sibling}return null}var uS=[];function dS(){for(var p=0;p<uS.length;p++)uS[p]._workInProgressVersionPrimary=null;uS.length=0}var $f=le.ReactCurrentDispatcher,hS=le.ReactCurrentBatchConfig,jd=0,gi=null,cs=null,ji=null,Qf=!1,Il=!1,Zf=0,WN=0;function Us(){throw Error(a(321))}function pS(p,_){if(_===null)return!1;for(var w=0;w<_.length&&w<p.length;w++)if(!jo(p[w],_[w]))return!1;return!0}function Qh(p,_,w,O,U,W){if(jd=W,gi=_,_.memoizedState=null,_.updateQueue=null,_.lanes=0,$f.current=p===null||p.memoizedState===null?HN:zC,p=w(O,U),Il){W=0;do{if(Il=!1,Zf=0,25<=W)throw Error(a(301));W+=1,ji=cs=null,_.updateQueue=null,$f.current=zN,p=w(O,U)}while(Il)}if($f.current=ep,_=cs!==null&&cs.next!==null,jd=0,ji=cs=gi=null,Qf=!1,_)throw Error(a(300));return p}function fS(){var p=Zf!==0;return Zf=0,p}function Ko(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ji===null?gi.memoizedState=ji=p:ji=ji.next=p,ji}function wa(){if(cs===null){var p=gi.alternate;p=p!==null?p.memoizedState:null}else p=cs.next;var _=ji===null?gi.memoizedState:ji.next;if(_!==null)ji=_,cs=p;else{if(p===null)throw Error(a(310));cs=p,p={memoizedState:cs.memoizedState,baseState:cs.baseState,baseQueue:cs.baseQueue,queue:cs.queue,next:null},ji===null?gi.memoizedState=ji=p:ji=ji.next=p}return ji}function Bd(p,_){return typeof _=="function"?_(p):_}function mS(p){var _=wa(),w=_.queue;if(w===null)throw Error(a(311));w.lastRenderedReducer=p;var O=cs,U=O.baseQueue,W=w.pending;if(W!==null){if(U!==null){var ee=U.next;U.next=W.next,W.next=ee}O.baseQueue=U=W,w.pending=null}if(U!==null){W=U.next,O=O.baseState;var me=ee=null,ve=null,He=W;do{var ut=He.lane;if((jd&ut)===ut)ve!==null&&(ve=ve.next={lane:0,action:He.action,hasEagerState:He.hasEagerState,eagerState:He.eagerState,next:null}),O=He.hasEagerState?He.eagerState:p(O,He.action);else{var ht={lane:ut,action:He.action,hasEagerState:He.hasEagerState,eagerState:He.eagerState,next:null};ve===null?(me=ve=ht,ee=O):ve=ve.next=ht,gi.lanes|=ut,zd|=ut}He=He.next}while(He!==null&&He!==W);ve===null?ee=O:ve.next=me,jo(O,_.memoizedState)||(Ca=!0),_.memoizedState=O,_.baseState=ee,_.baseQueue=ve,w.lastRenderedState=O}if(p=w.interleaved,p!==null){U=p;do W=U.lane,gi.lanes|=W,zd|=W,U=U.next;while(U!==p)}else U===null&&(w.lanes=0);return[_.memoizedState,w.dispatch]}function gS(p){var _=wa(),w=_.queue;if(w===null)throw Error(a(311));w.lastRenderedReducer=p;var O=w.dispatch,U=w.pending,W=_.memoizedState;if(U!==null){w.pending=null;var ee=U=U.next;do W=p(W,ee.action),ee=ee.next;while(ee!==U);jo(W,_.memoizedState)||(Ca=!0),_.memoizedState=W,_.baseQueue===null&&(_.baseState=W),w.lastRenderedState=W}return[W,O]}function UC(){}function VC(p,_){var w=gi,O=wa(),U=_(),W=!jo(O.memoizedState,U);if(W&&(O.memoizedState=U,Ca=!0),O=O.queue,O_(jC.bind(null,w,O,p),[p]),O.getSnapshot!==_||W||ji!==null&&ji.memoizedState.tag&1){if(w.flags|=2048,Al(9,em.bind(null,w,O,U,_),void 0,null),ls===null)throw Error(a(349));(jd&30)!==0||FC(w,_,U)}return U}function FC(p,_,w){p.flags|=16384,p={getSnapshot:_,value:w},_=gi.updateQueue,_===null?(_={lastEffect:null,stores:null},gi.updateQueue=_,_.stores=[p]):(w=_.stores,w===null?_.stores=[p]:w.push(p))}function em(p,_,w,O){_.value=w,_.getSnapshot=O,Wd(_)&&I_(p)}function jC(p,_,w){return w(function(){Wd(_)&&I_(p)})}function Wd(p){var _=p.getSnapshot;p=p.value;try{var w=_();return!jo(p,w)}catch{return!0}}function I_(p){var _=Cl(p,1);_!==null&&Ha(_,p,1,-1)}function tm(p){var _=Ko();return typeof p=="function"&&(p=p()),_.memoizedState=_.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Bd,lastRenderedState:p},_.queue=p,p=p.dispatch=Gd.bind(null,gi,p),[_.memoizedState,p]}function Al(p,_,w,O){return p={tag:p,create:_,destroy:w,deps:O,next:null},_=gi.updateQueue,_===null?(_={lastEffect:null,stores:null},gi.updateQueue=_,_.lastEffect=p.next=p):(w=_.lastEffect,w===null?_.lastEffect=p.next=p:(O=w.next,w.next=p,p.next=O,_.lastEffect=p)),p}function nm(){return wa().memoizedState}function A_(p,_,w,O){var U=Ko();gi.flags|=p,U.memoizedState=Al(1|_,w,void 0,O===void 0?null:O)}function rm(p,_,w,O){var U=wa();O=O===void 0?null:O;var W=void 0;if(cs!==null){var ee=cs.memoizedState;if(W=ee.destroy,O!==null&&pS(O,ee.deps)){U.memoizedState=Al(_,w,W,O);return}}gi.flags|=p,U.memoizedState=Al(1|_,w,W,O)}function BC(p,_){return A_(8390656,8,p,_)}function O_(p,_){return rm(2048,8,p,_)}function WC(p,_){return rm(4,2,p,_)}function GC(p,_){return rm(4,4,p,_)}function N_(p,_){if(typeof _=="function")return p=p(),_(p),function(){_(null)};if(_!=null)return p=p(),_.current=p,function(){_.current=null}}function P_(p,_,w){return w=w!=null?w.concat([p]):null,rm(4,4,N_.bind(null,_,p),w)}function _S(){}function HC(p,_){var w=wa();_=_===void 0?null:_;var O=w.memoizedState;return O!==null&&_!==null&&pS(_,O[1])?O[0]:(w.memoizedState=[p,_],p)}function ES(p,_){var w=wa();_=_===void 0?null:_;var O=w.memoizedState;return O!==null&&_!==null&&pS(_,O[1])?O[0]:(p=p(),w.memoizedState=[p,_],p)}function k_(p,_,w){return(jd&21)===0?(p.baseState&&(p.baseState=!1,Ca=!0),p.memoizedState=w):(jo(w,_)||(w=Xw(),gi.lanes|=w,zd|=w,p.baseState=!0),_)}function GN(p,_){var w=Tr;Tr=w!==0&&4>w?w:4,p(!0);var O=hS.transition;hS.transition={};try{p(!1),_()}finally{Tr=w,hS.transition=O}}function Yo(){return wa().memoizedState}function Zh(p,_,w){var O=Fu(p);if(w={lane:O,action:w,hasEagerState:!1,eagerState:null,next:null},yS(p))vS(_,w);else if(w=aS(p,_,w,O),w!==null){var U=sa();Ha(w,p,O,U),Du(w,_,O)}}function Gd(p,_,w){var O=Fu(p),U={lane:O,action:w,hasEagerState:!1,eagerState:null,next:null};if(yS(p))vS(_,U);else{var W=p.alternate;if(p.lanes===0&&(W===null||W.lanes===0)&&(W=_.lastRenderedReducer,W!==null))try{var ee=_.lastRenderedState,me=W(ee,w);if(U.hasEagerState=!0,U.eagerState=me,jo(me,ee)){var ve=_.interleaved;ve===null?(U.next=U,sS(_)):(U.next=ve.next,ve.next=U),_.interleaved=U;return}}catch{}w=aS(p,_,U,O),w!==null&&(U=sa(),Ha(w,p,O,U),Du(w,_,O))}}function yS(p){var _=p.alternate;return p===gi||_!==null&&_===gi}function vS(p,_){Il=Qf=!0;var w=p.pending;w===null?_.next=_:(_.next=w.next,w.next=_),p.pending=_}function Du(p,_,w){if((w&4194240)!==0){var O=_.lanes;O&=p.pendingLanes,w|=O,_.lanes=w,vv(p,w)}}var ep={readContext:so,useCallback:Us,useContext:Us,useEffect:Us,useImperativeHandle:Us,useInsertionEffect:Us,useLayoutEffect:Us,useMemo:Us,useReducer:Us,useRef:Us,useState:Us,useDebugValue:Us,useDeferredValue:Us,useTransition:Us,useMutableSource:Us,useSyncExternalStore:Us,useId:Us,unstable_isNewReconciler:!1},HN={readContext:so,useCallback:function(p,_){return Ko().memoizedState=[p,_===void 0?null:_],p},useContext:so,useEffect:BC,useImperativeHandle:function(p,_,w){return w=w!=null?w.concat([p]):null,A_(4194308,4,N_.bind(null,_,p),w)},useLayoutEffect:function(p,_){return A_(4194308,4,p,_)},useInsertionEffect:function(p,_){return A_(4,2,p,_)},useMemo:function(p,_){var w=Ko();return _=_===void 0?null:_,p=p(),w.memoizedState=[p,_],p},useReducer:function(p,_,w){var O=Ko();return _=w!==void 0?w(_):_,O.memoizedState=O.baseState=_,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:_},O.queue=p,p=p.dispatch=Zh.bind(null,gi,p),[O.memoizedState,p]},useRef:function(p){var _=Ko();return p={current:p},_.memoizedState=p},useState:tm,useDebugValue:_S,useDeferredValue:function(p){return Ko().memoizedState=p},useTransition:function(){var p=tm(!1),_=p[0];return p=GN.bind(null,p[1]),Ko().memoizedState=p,[_,p]},useMutableSource:function(){},useSyncExternalStore:function(p,_,w){var O=gi,U=Ko();if(si){if(w===void 0)throw Error(a(407));w=w()}else{if(w=_(),ls===null)throw Error(a(349));(jd&30)!==0||FC(O,_,w)}U.memoizedState=w;var W={value:w,getSnapshot:_};return U.queue=W,BC(jC.bind(null,O,W,p),[p]),O.flags|=2048,Al(9,em.bind(null,O,W,w,_),void 0,null),w},useId:function(){var p=Ko(),_=ls.identifierPrefix;if(si){var w=wl,O=Tl;w=(O&~(1<<32-_r(O)-1)).toString(32)+w,_=":"+_+"R"+w,w=Zf++,0<w&&(_+="H"+w.toString(32)),_+=":"}else w=WN++,_=":"+_+"r"+w.toString(32)+":";return p.memoizedState=_},unstable_isNewReconciler:!1},zC={readContext:so,useCallback:HC,useContext:so,useEffect:O_,useImperativeHandle:P_,useInsertionEffect:WC,useLayoutEffect:GC,useMemo:ES,useReducer:mS,useRef:nm,useState:function(){return mS(Bd)},useDebugValue:_S,useDeferredValue:function(p){var _=wa();return k_(_,cs.memoizedState,p)},useTransition:function(){var p=mS(Bd)[0],_=wa().memoizedState;return[p,_]},useMutableSource:UC,useSyncExternalStore:VC,useId:Yo,unstable_isNewReconciler:!1},zN={readContext:so,useCallback:HC,useContext:so,useEffect:O_,useImperativeHandle:P_,useInsertionEffect:WC,useLayoutEffect:GC,useMemo:ES,useReducer:gS,useRef:nm,useState:function(){return gS(Bd)},useDebugValue:_S,useDeferredValue:function(p){var _=wa();return cs===null?_.memoizedState=p:k_(_,cs.memoizedState,p)},useTransition:function(){var p=gS(Bd)[0],_=wa().memoizedState;return[p,_]},useMutableSource:UC,useSyncExternalStore:VC,useId:Yo,unstable_isNewReconciler:!1};function ao(p,_){if(p&&p.defaultProps){_=ae({},_),p=p.defaultProps;for(var w in p)_[w]===void 0&&(_[w]=p[w]);return _}return _}function D_(p,_,w,O){_=p.memoizedState,w=w(O,_),w=w==null?_:ae({},_,w),p.memoizedState=w,p.lanes===0&&(p.updateQueue.baseState=w)}var x_={isMounted:function(p){return(p=p._reactInternals)?Vt(p)===p:!1},enqueueSetState:function(p,_,w){p=p._reactInternals;var O=sa(),U=Fu(p),W=bl(O,U);W.payload=_,w!=null&&(W.callback=w),_=zo(p,W,U),_!==null&&(Ha(_,p,U,O),C_(_,p,U))},enqueueReplaceState:function(p,_,w){p=p._reactInternals;var O=sa(),U=Fu(p),W=bl(O,U);W.tag=1,W.payload=_,w!=null&&(W.callback=w),_=zo(p,W,U),_!==null&&(Ha(_,p,U,O),C_(_,p,U))},enqueueForceUpdate:function(p,_){p=p._reactInternals;var w=sa(),O=Fu(p),U=bl(w,O);U.tag=2,_!=null&&(U.callback=_),_=zo(p,U,O),_!==null&&(Ha(_,p,O,w),C_(_,p,O))}};function Ol(p,_,w,O,U,W,ee){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(O,W,ee):_.prototype&&_.prototype.isPureReactComponent?!Vh(w,O)||!Vh(U,W):!0}function KC(p,_,w){var O=!1,U=Iu,W=_.contextType;return typeof W=="object"&&W!==null?W=so(W):(U=Ta(_)?Au:Ms.current,O=_.contextTypes,W=(O=O!=null)?Ou(p,U):Iu),_=new _(w,W),p.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,_.updater=x_,p.stateNode=_,_._reactInternals=p,O&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=U,p.__reactInternalMemoizedMaskedChildContext=W),_}function YC(p,_,w,O){p=_.state,typeof _.componentWillReceiveProps=="function"&&_.componentWillReceiveProps(w,O),typeof _.UNSAFE_componentWillReceiveProps=="function"&&_.UNSAFE_componentWillReceiveProps(w,O),_.state!==p&&x_.enqueueReplaceState(_,_.state,null)}function SS(p,_,w,O){var U=p.stateNode;U.props=w,U.state=p.memoizedState,U.refs={},oS(p);var W=_.contextType;typeof W=="object"&&W!==null?U.context=so(W):(W=Ta(_)?Au:Ms.current,U.context=Ou(p,W)),U.state=p.memoizedState,W=_.getDerivedStateFromProps,typeof W=="function"&&(D_(p,_,W,w),U.state=p.memoizedState),typeof _.getDerivedStateFromProps=="function"||typeof U.getSnapshotBeforeUpdate=="function"||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(_=U.state,typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount(),_!==U.state&&x_.enqueueReplaceState(U,U.state,null),R_(p,w,U,O),U.state=p.memoizedState),typeof U.componentDidMount=="function"&&(p.flags|=4194308)}function tp(p,_){try{var w="",O=_;do w+=yt(O),O=O.return;while(O);var U=w}catch(W){U=`
Error generating stack: `+W.message+`
`+W.stack}return{value:p,source:_,stack:U,digest:null}}function L_(p,_,w){return{value:p,source:null,stack:w??null,digest:_??null}}function TS(p,_){try{console.error(_.value)}catch(w){setTimeout(function(){throw w})}}var wS=typeof WeakMap=="function"?WeakMap:Map;function CS(p,_,w){w=bl(-1,w),w.tag=3,w.payload={element:null};var O=_.value;return w.callback=function(){Fs||(Fs=!0,GS=O),TS(p,_)},w}function qC(p,_,w){w=bl(-1,w),w.tag=3;var O=p.type.getDerivedStateFromError;if(typeof O=="function"){var U=_.value;w.payload=function(){return O(U)},w.callback=function(){TS(p,_)}}var W=p.stateNode;return W!==null&&typeof W.componentDidCatch=="function"&&(w.callback=function(){TS(p,_),typeof O!="function"&&(Uu===null?Uu=new Set([this]):Uu.add(this));var ee=_.stack;this.componentDidCatch(_.value,{componentStack:ee!==null?ee:""})}),w}function RS(p,_,w){var O=p.pingCache;if(O===null){O=p.pingCache=new wS;var U=new Set;O.set(_,U)}else U=O.get(_),U===void 0&&(U=new Set,O.set(_,U));U.has(w)||(U.add(w),p=hR.bind(null,p,_,w),_.then(p,p))}function XC(p){do{var _;if((_=p.tag===13)&&(_=p.memoizedState,_=_!==null?_.dehydrated!==null:!0),_)return p;p=p.return}while(p!==null);return null}function JC(p,_,w,O,U){return(p.mode&1)===0?(p===_?p.flags|=65536:(p.flags|=128,w.flags|=131072,w.flags&=-52805,w.tag===1&&(w.alternate===null?w.tag=17:(_=bl(-1,1),_.tag=2,zo(w,_,1))),w.lanes|=1),p):(p.flags|=65536,p.lanes=U,p)}var KN=le.ReactCurrentOwner,Ca=!1;function ia(p,_,w,O){_.child=p===null?tS(_,null,w,O):Jh(_,p.child,w,O)}function $C(p,_,w,O,U){w=w.render;var W=_.ref;return Ho(_,U),O=Qh(p,_,w,O,W,U),w=fS(),p!==null&&!Ca?(_.updateQueue=p.updateQueue,_.flags&=-2053,p.lanes&=~U,Nl(p,_,U)):(si&&w&&Yh(_),_.flags|=1,ia(p,_,O,U),_.child)}function QC(p,_,w,O,U){if(p===null){var W=w.type;return typeof W=="function"&&!ZS(W)&&W.defaultProps===void 0&&w.compare===null&&w.defaultProps===void 0?(_.tag=15,_.type=W,bS(p,_,W,O,U)):(p=op(w.type,null,O,_,_.mode,U),p.ref=_.ref,p.return=_,_.child=p)}if(W=p.child,(p.lanes&U)===0){var ee=W.memoizedProps;if(w=w.compare,w=w!==null?w:Vh,w(ee,O)&&p.ref===_.ref)return Nl(p,_,U)}return _.flags|=1,p=Gu(W,O),p.ref=_.ref,p.return=_,_.child=p}function bS(p,_,w,O,U){if(p!==null){var W=p.memoizedProps;if(Vh(W,O)&&p.ref===_.ref)if(Ca=!1,_.pendingProps=O=W,(p.lanes&U)!==0)(p.flags&131072)!==0&&(Ca=!0);else return _.lanes=p.lanes,Nl(p,_,U)}return IS(p,_,w,O,U)}function Nc(p,_,w){var O=_.pendingProps,U=O.children,W=p!==null?p.memoizedState:null;if(O.mode==="hidden")if((_.mode&1)===0)_.memoizedState={baseLanes:0,cachePool:null,transitions:null},Zr(np,Ga),Ga|=w;else{if((w&1073741824)===0)return p=W!==null?W.baseLanes|w:w,_.lanes=_.childLanes=1073741824,_.memoizedState={baseLanes:p,cachePool:null,transitions:null},_.updateQueue=null,Zr(np,Ga),Ga|=p,null;_.memoizedState={baseLanes:0,cachePool:null,transitions:null},O=W!==null?W.baseLanes:w,Zr(np,Ga),Ga|=O}else W!==null?(O=W.baseLanes|w,_.memoizedState=null):O=w,Zr(np,Ga),Ga|=O;return ia(p,_,U,w),_.child}function ZC(p,_){var w=_.ref;(p===null&&w!==null||p!==null&&p.ref!==w)&&(_.flags|=512,_.flags|=2097152)}function IS(p,_,w,O,U){var W=Ta(w)?Au:Ms.current;return W=Ou(_,W),Ho(_,U),w=Qh(p,_,w,O,W,U),O=fS(),p!==null&&!Ca?(_.updateQueue=p.updateQueue,_.flags&=-2053,p.lanes&=~U,Nl(p,_,U)):(si&&O&&Yh(_),_.flags|=1,ia(p,_,w,U),_.child)}function eR(p,_,w,O,U){if(Ta(w)){var W=!0;m_(_)}else W=!1;if(Ho(_,U),_.stateNode===null)V_(p,_),KC(_,w,O),SS(_,w,O,U),O=!0;else if(p===null){var ee=_.stateNode,me=_.memoizedProps;ee.props=me;var ve=ee.context,He=w.contextType;typeof He=="object"&&He!==null?He=so(He):(He=Ta(w)?Au:Ms.current,He=Ou(_,He));var ut=w.getDerivedStateFromProps,ht=typeof ut=="function"||typeof ee.getSnapshotBeforeUpdate=="function";ht||typeof ee.UNSAFE_componentWillReceiveProps!="function"&&typeof ee.componentWillReceiveProps!="function"||(me!==O||ve!==He)&&YC(_,ee,O,He),Rl=!1;var ot=_.memoizedState;ee.state=ot,R_(_,O,ee,U),ve=_.memoizedState,me!==O||ot!==ve||na.current||Rl?(typeof ut=="function"&&(D_(_,w,ut,O),ve=_.memoizedState),(me=Rl||Ol(_,w,me,O,ot,ve,He))?(ht||typeof ee.UNSAFE_componentWillMount!="function"&&typeof ee.componentWillMount!="function"||(typeof ee.componentWillMount=="function"&&ee.componentWillMount(),typeof ee.UNSAFE_componentWillMount=="function"&&ee.UNSAFE_componentWillMount()),typeof ee.componentDidMount=="function"&&(_.flags|=4194308)):(typeof ee.componentDidMount=="function"&&(_.flags|=4194308),_.memoizedProps=O,_.memoizedState=ve),ee.props=O,ee.state=ve,ee.context=He,O=me):(typeof ee.componentDidMount=="function"&&(_.flags|=4194308),O=!1)}else{ee=_.stateNode,DC(p,_),me=_.memoizedProps,He=_.type===_.elementType?me:ao(_.type,me),ee.props=He,ht=_.pendingProps,ot=ee.context,ve=w.contextType,typeof ve=="object"&&ve!==null?ve=so(ve):(ve=Ta(w)?Au:Ms.current,ve=Ou(_,ve));var bt=w.getDerivedStateFromProps;(ut=typeof bt=="function"||typeof ee.getSnapshotBeforeUpdate=="function")||typeof ee.UNSAFE_componentWillReceiveProps!="function"&&typeof ee.componentWillReceiveProps!="function"||(me!==ht||ot!==ve)&&YC(_,ee,O,ve),Rl=!1,ot=_.memoizedState,ee.state=ot,R_(_,O,ee,U);var Bt=_.memoizedState;me!==ht||ot!==Bt||na.current||Rl?(typeof bt=="function"&&(D_(_,w,bt,O),Bt=_.memoizedState),(He=Rl||Ol(_,w,He,O,ot,Bt,ve)||!1)?(ut||typeof ee.UNSAFE_componentWillUpdate!="function"&&typeof ee.componentWillUpdate!="function"||(typeof ee.componentWillUpdate=="function"&&ee.componentWillUpdate(O,Bt,ve),typeof ee.UNSAFE_componentWillUpdate=="function"&&ee.UNSAFE_componentWillUpdate(O,Bt,ve)),typeof ee.componentDidUpdate=="function"&&(_.flags|=4),typeof ee.getSnapshotBeforeUpdate=="function"&&(_.flags|=1024)):(typeof ee.componentDidUpdate!="function"||me===p.memoizedProps&&ot===p.memoizedState||(_.flags|=4),typeof ee.getSnapshotBeforeUpdate!="function"||me===p.memoizedProps&&ot===p.memoizedState||(_.flags|=1024),_.memoizedProps=O,_.memoizedState=Bt),ee.props=O,ee.state=Bt,ee.context=ve,O=He):(typeof ee.componentDidUpdate!="function"||me===p.memoizedProps&&ot===p.memoizedState||(_.flags|=4),typeof ee.getSnapshotBeforeUpdate!="function"||me===p.memoizedProps&&ot===p.memoizedState||(_.flags|=1024),O=!1)}return AS(p,_,w,O,W,U)}function AS(p,_,w,O,U,W){ZC(p,_);var ee=(_.flags&128)!==0;if(!O&&!ee)return U&&AC(_,w,!1),Nl(p,_,W);O=_.stateNode,KN.current=_;var me=ee&&typeof w.getDerivedStateFromError!="function"?null:O.render();return _.flags|=1,p!==null&&ee?(_.child=Jh(_,p.child,null,W),_.child=Jh(_,null,me,W)):ia(p,_,me,W),_.memoizedState=O.state,U&&AC(_,w,!0),_.child}function tR(p){var _=p.stateNode;_.pendingContext?zh(p,_.pendingContext,_.pendingContext!==_.context):_.context&&zh(p,_.context,!1),cS(p,_.containerInfo)}function nR(p,_,w,O,U){return Md(),Xh(U),_.flags|=256,ia(p,_,w,O),_.child}var im={dehydrated:null,treeContext:null,retryLane:0};function OS(p){return{baseLanes:p,cachePool:null,transitions:null}}function rR(p,_,w){var O=_.pendingProps,U=Si.current,W=!1,ee=(_.flags&128)!==0,me;if((me=ee)||(me=p!==null&&p.memoizedState===null?!1:(U&2)!==0),me?(W=!0,_.flags&=-129):(p===null||p.memoizedState!==null)&&(U|=1),Zr(Si,U&1),p===null)return Kf(_),p=_.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((_.mode&1)===0?_.lanes=1:p.data==="$!"?_.lanes=8:_.lanes=1073741824,null):(ee=O.children,p=O.fallback,W?(O=_.mode,W=_.child,ee={mode:"hidden",children:ee},(O&1)===0&&W!==null?(W.childLanes=0,W.pendingProps=ee):W=mm(ee,O,0,null),p=Hu(p,O,w,null),W.return=_,p.return=_,W.sibling=p,_.child=W,_.child.memoizedState=OS(w),_.memoizedState=im,p):NS(_,ee));if(U=p.memoizedState,U!==null&&(me=U.dehydrated,me!==null))return YN(p,_,ee,O,me,U,w);if(W){W=O.fallback,ee=_.mode,U=p.child,me=U.sibling;var ve={mode:"hidden",children:O.children};return(ee&1)===0&&_.child!==U?(O=_.child,O.childLanes=0,O.pendingProps=ve,_.deletions=null):(O=Gu(U,ve),O.subtreeFlags=U.subtreeFlags&14680064),me!==null?W=Gu(me,W):(W=Hu(W,ee,w,null),W.flags|=2),W.return=_,O.return=_,O.sibling=W,_.child=O,O=W,W=_.child,ee=p.child.memoizedState,ee=ee===null?OS(w):{baseLanes:ee.baseLanes|w,cachePool:null,transitions:ee.transitions},W.memoizedState=ee,W.childLanes=p.childLanes&~w,_.memoizedState=im,O}return W=p.child,p=W.sibling,O=Gu(W,{mode:"visible",children:O.children}),(_.mode&1)===0&&(O.lanes=w),O.return=_,O.sibling=null,p!==null&&(w=_.deletions,w===null?(_.deletions=[p],_.flags|=16):w.push(p)),_.child=O,_.memoizedState=null,O}function NS(p,_){return _=mm({mode:"visible",children:_},p.mode,0,null),_.return=p,p.child=_}function M_(p,_,w,O){return O!==null&&Xh(O),Jh(_,p.child,null,w),p=NS(_,_.pendingProps.children),p.flags|=2,_.memoizedState=null,p}function YN(p,_,w,O,U,W,ee){if(w)return _.flags&256?(_.flags&=-257,O=L_(Error(a(422))),M_(p,_,ee,O)):_.memoizedState!==null?(_.child=p.child,_.flags|=128,null):(W=O.fallback,U=_.mode,O=mm({mode:"visible",children:O.children},U,0,null),W=Hu(W,U,ee,null),W.flags|=2,O.return=_,W.return=_,O.sibling=W,_.child=O,(_.mode&1)!==0&&Jh(_,p.child,null,ee),_.child.memoizedState=OS(ee),_.memoizedState=im,W);if((_.mode&1)===0)return M_(p,_,ee,null);if(U.data==="$!"){if(O=U.nextSibling&&U.nextSibling.dataset,O)var me=O.dgst;return O=me,W=Error(a(419)),O=L_(W,O,void 0),M_(p,_,ee,O)}if(me=(ee&p.childLanes)!==0,Ca||me){if(O=ls,O!==null){switch(ee&-ee){case 4:U=2;break;case 16:U=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:U=32;break;case 536870912:U=268435456;break;default:U=0}U=(U&(O.suspendedLanes|ee))!==0?0:U,U!==0&&U!==W.retryLane&&(W.retryLane=U,Cl(p,U),Ha(O,p,U,-1))}return sp(),O=L_(Error(a(421))),M_(p,_,ee,O)}return U.data==="$?"?(_.flags|=128,_.child=p.child,_=tP.bind(null,p),U._reactRetry=_,null):(p=W.treeContext,Ba=Ic(U.nextSibling),ja=_,si=!0,Go=null,p!==null&&(ra[io++]=Tl,ra[io++]=wl,ra[io++]=xd,Tl=p.id,wl=p.overflow,xd=_),_=NS(_,O.children),_.flags|=4096,_)}function iR(p,_,w){p.lanes|=_;var O=p.alternate;O!==null&&(O.lanes|=_),w_(p.return,_,w)}function U_(p,_,w,O,U){var W=p.memoizedState;W===null?p.memoizedState={isBackwards:_,rendering:null,renderingStartTime:0,last:O,tail:w,tailMode:U}:(W.isBackwards=_,W.rendering=null,W.renderingStartTime=0,W.last=O,W.tail=w,W.tailMode=U)}function PS(p,_,w){var O=_.pendingProps,U=O.revealOrder,W=O.tail;if(ia(p,_,O.children,w),O=Si.current,(O&2)!==0)O=O&1|2,_.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=_.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&iR(p,w,_);else if(p.tag===19)iR(p,w,_);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===_)break e;for(;p.sibling===null;){if(p.return===null||p.return===_)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}O&=1}if(Zr(Si,O),(_.mode&1)===0)_.memoizedState=null;else switch(U){case"forwards":for(w=_.child,U=null;w!==null;)p=w.alternate,p!==null&&b_(p)===null&&(U=w),w=w.sibling;w=U,w===null?(U=_.child,_.child=null):(U=w.sibling,w.sibling=null),U_(_,!1,U,w,W);break;case"backwards":for(w=null,U=_.child,_.child=null;U!==null;){if(p=U.alternate,p!==null&&b_(p)===null){_.child=U;break}p=U.sibling,U.sibling=w,w=U,U=p}U_(_,!0,w,null,W);break;case"together":U_(_,!1,null,null,void 0);break;default:_.memoizedState=null}return _.child}function V_(p,_){(_.mode&1)===0&&p!==null&&(p.alternate=null,_.alternate=null,_.flags|=2)}function Nl(p,_,w){if(p!==null&&(_.dependencies=p.dependencies),zd|=_.lanes,(w&_.childLanes)===0)return null;if(p!==null&&_.child!==p.child)throw Error(a(153));if(_.child!==null){for(p=_.child,w=Gu(p,p.pendingProps),_.child=w,w.return=_;p.sibling!==null;)p=p.sibling,w=w.sibling=Gu(p,p.pendingProps),w.return=_;w.sibling=null}return _.child}function F_(p,_,w){switch(_.tag){case 3:tR(_),Md();break;case 5:MC(_);break;case 1:Ta(_.type)&&m_(_);break;case 4:cS(_,_.stateNode.containerInfo);break;case 10:var O=_.type._context,U=_.memoizedProps.value;Zr(S_,O._currentValue),O._currentValue=U;break;case 13:if(O=_.memoizedState,O!==null)return O.dehydrated!==null?(Zr(Si,Si.current&1),_.flags|=128,null):(w&_.child.childLanes)!==0?rR(p,_,w):(Zr(Si,Si.current&1),p=Nl(p,_,w),p!==null?p.sibling:null);Zr(Si,Si.current&1);break;case 19:if(O=(w&_.childLanes)!==0,(p.flags&128)!==0){if(O)return PS(p,_,w);_.flags|=128}if(U=_.memoizedState,U!==null&&(U.rendering=null,U.tail=null,U.lastEffect=null),Zr(Si,Si.current),O)break;return null;case 22:case 23:return _.lanes=0,Nc(p,_,w)}return Nl(p,_,w)}var j_,B_,sm,kS;j_=function(p,_){for(var w=_.child;w!==null;){if(w.tag===5||w.tag===6)p.appendChild(w.stateNode);else if(w.tag!==4&&w.child!==null){w.child.return=w,w=w.child;continue}if(w===_)break;for(;w.sibling===null;){if(w.return===null||w.return===_)return;w=w.return}w.sibling.return=w.return,w=w.sibling}},B_=function(){},sm=function(p,_,w,O){var U=p.memoizedProps;if(U!==O){p=_.stateNode,ku(Oc.current);var W=null;switch(w){case"input":U=Tc(p,U),O=Tc(p,O),W=[];break;case"select":U=ae({},U,{value:void 0}),O=ae({},O,{value:void 0}),W=[];break;case"textarea":U=Cc(p,U),O=Cc(p,O),W=[];break;default:typeof U.onClick!="function"&&typeof O.onClick=="function"&&(p.onclick=Wf)}Gr(w,O);var ee;w=null;for(He in U)if(!O.hasOwnProperty(He)&&U.hasOwnProperty(He)&&U[He]!=null)if(He==="style"){var me=U[He];for(ee in me)me.hasOwnProperty(ee)&&(w||(w={}),w[ee]="")}else He!=="dangerouslySetInnerHTML"&&He!=="children"&&He!=="suppressContentEditableWarning"&&He!=="suppressHydrationWarning"&&He!=="autoFocus"&&(l.hasOwnProperty(He)?W||(W=[]):(W=W||[]).push(He,null));for(He in O){var ve=O[He];if(me=U?.[He],O.hasOwnProperty(He)&&ve!==me&&(ve!=null||me!=null))if(He==="style")if(me){for(ee in me)!me.hasOwnProperty(ee)||ve&&ve.hasOwnProperty(ee)||(w||(w={}),w[ee]="");for(ee in ve)ve.hasOwnProperty(ee)&&me[ee]!==ve[ee]&&(w||(w={}),w[ee]=ve[ee])}else w||(W||(W=[]),W.push(He,w)),w=ve;else He==="dangerouslySetInnerHTML"?(ve=ve?ve.__html:void 0,me=me?me.__html:void 0,ve!=null&&me!==ve&&(W=W||[]).push(He,ve)):He==="children"?typeof ve!="string"&&typeof ve!="number"||(W=W||[]).push(He,""+ve):He!=="suppressContentEditableWarning"&&He!=="suppressHydrationWarning"&&(l.hasOwnProperty(He)?(ve!=null&&He==="onScroll"&&Qr("scroll",p),W||me===ve||(W=[])):(W=W||[]).push(He,ve))}w&&(W=W||[]).push("style",w);var He=W;(_.updateQueue=He)&&(_.flags|=4)}},kS=function(p,_,w,O){w!==O&&(_.flags|=4)};function am(p,_){if(!si)switch(p.tailMode){case"hidden":_=p.tail;for(var w=null;_!==null;)_.alternate!==null&&(w=_),_=_.sibling;w===null?p.tail=null:w.sibling=null;break;case"collapsed":w=p.tail;for(var O=null;w!==null;)w.alternate!==null&&(O=w),w=w.sibling;O===null?_||p.tail===null?p.tail=null:p.tail.sibling=null:O.sibling=null}}function As(p){var _=p.alternate!==null&&p.alternate.child===p.child,w=0,O=0;if(_)for(var U=p.child;U!==null;)w|=U.lanes|U.childLanes,O|=U.subtreeFlags&14680064,O|=U.flags&14680064,U.return=p,U=U.sibling;else for(U=p.child;U!==null;)w|=U.lanes|U.childLanes,O|=U.subtreeFlags,O|=U.flags,U.return=p,U=U.sibling;return p.subtreeFlags|=O,p.childLanes=w,_}function W_(p,_,w){var O=_.pendingProps;switch(y_(_),_.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return As(_),null;case 1:return Ta(_.type)&&f_(),As(_),null;case 3:return O=_.stateNode,Fd(),Hr(na),Hr(Ms),dS(),O.pendingContext&&(O.context=O.pendingContext,O.pendingContext=null),(p===null||p.child===null)&&(qh(_)?_.flags|=4:p===null||p.memoizedState.isDehydrated&&(_.flags&256)===0||(_.flags|=1024,Go!==null&&(zS(Go),Go=null))),B_(p,_),As(_),null;case 5:lS(_);var U=ku(Jf.current);if(w=_.type,p!==null&&_.stateNode!=null)sm(p,_,w,O,U),p.ref!==_.ref&&(_.flags|=512,_.flags|=2097152);else{if(!O){if(_.stateNode===null)throw Error(a(166));return As(_),null}if(p=ku(Oc.current),qh(_)){O=_.stateNode,w=_.type;var W=_.memoizedProps;switch(O[Ac]=_,O[Gf]=W,p=(_.mode&1)!==0,w){case"dialog":Qr("cancel",O),Qr("close",O);break;case"iframe":case"object":case"embed":Qr("load",O);break;case"video":case"audio":for(U=0;U<Vf.length;U++)Qr(Vf[U],O);break;case"source":Qr("error",O);break;case"img":case"image":case"link":Qr("error",O),Qr("load",O);break;case"details":Qr("toggle",O);break;case"input":pl(O,W),Qr("invalid",O);break;case"select":O._wrapperState={wasMultiple:!!W.multiple},Qr("invalid",O);break;case"textarea":Qs(O,W),Qr("invalid",O)}Gr(w,W),U=null;for(var ee in W)if(W.hasOwnProperty(ee)){var me=W[ee];ee==="children"?typeof me=="string"?O.textContent!==me&&(W.suppressHydrationWarning!==!0&&Bf(O.textContent,me,p),U=["children",me]):typeof me=="number"&&O.textContent!==""+me&&(W.suppressHydrationWarning!==!0&&Bf(O.textContent,me,p),U=["children",""+me]):l.hasOwnProperty(ee)&&me!=null&&ee==="onScroll"&&Qr("scroll",O)}switch(w){case"input":os(O),Wr(O,W,!0);break;case"textarea":os(O),Ua(O);break;case"select":case"option":break;default:typeof W.onClick=="function"&&(O.onclick=Wf)}O=U,_.updateQueue=O,O!==null&&(_.flags|=4)}else{ee=U.nodeType===9?U:U.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=qe(w)),p==="http://www.w3.org/1999/xhtml"?w==="script"?(p=ee.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof O.is=="string"?p=ee.createElement(w,{is:O.is}):(p=ee.createElement(w),w==="select"&&(ee=p,O.multiple?ee.multiple=!0:O.size&&(ee.size=O.size))):p=ee.createElementNS(p,w),p[Ac]=_,p[Gf]=O,j_(p,_,!1,!1),_.stateNode=p;e:{switch(ee=Ea(w,O),w){case"dialog":Qr("cancel",p),Qr("close",p),U=O;break;case"iframe":case"object":case"embed":Qr("load",p),U=O;break;case"video":case"audio":for(U=0;U<Vf.length;U++)Qr(Vf[U],p);U=O;break;case"source":Qr("error",p),U=O;break;case"img":case"image":case"link":Qr("error",p),Qr("load",p),U=O;break;case"details":Qr("toggle",p),U=O;break;case"input":pl(p,O),U=Tc(p,O),Qr("invalid",p);break;case"option":U=O;break;case"select":p._wrapperState={wasMultiple:!!O.multiple},U=ae({},O,{value:void 0}),Qr("invalid",p);break;case"textarea":Qs(p,O),U=Cc(p,O),Qr("invalid",p);break;default:U=O}Gr(w,U),me=U;for(W in me)if(me.hasOwnProperty(W)){var ve=me[W];W==="style"?mi(p,ve):W==="dangerouslySetInnerHTML"?(ve=ve?ve.__html:void 0,ve!=null&&on(p,ve)):W==="children"?typeof ve=="string"?(w!=="textarea"||ve!=="")&&Nn(p,ve):typeof ve=="number"&&Nn(p,""+ve):W!=="suppressContentEditableWarning"&&W!=="suppressHydrationWarning"&&W!=="autoFocus"&&(l.hasOwnProperty(W)?ve!=null&&W==="onScroll"&&Qr("scroll",p):ve!=null&&$(p,W,ve,ee))}switch(w){case"input":os(p),Wr(p,O,!1);break;case"textarea":os(p),Ua(p);break;case"option":O.value!=null&&p.setAttribute("value",""+dn(O.value));break;case"select":p.multiple=!!O.multiple,W=O.value,W!=null?gs(p,!!O.multiple,W,!1):O.defaultValue!=null&&gs(p,!!O.multiple,O.defaultValue,!0);break;default:typeof U.onClick=="function"&&(p.onclick=Wf)}switch(w){case"button":case"input":case"select":case"textarea":O=!!O.autoFocus;break e;case"img":O=!0;break e;default:O=!1}}O&&(_.flags|=4)}_.ref!==null&&(_.flags|=512,_.flags|=2097152)}return As(_),null;case 6:if(p&&_.stateNode!=null)kS(p,_,p.memoizedProps,O);else{if(typeof O!="string"&&_.stateNode===null)throw Error(a(166));if(w=ku(Jf.current),ku(Oc.current),qh(_)){if(O=_.stateNode,w=_.memoizedProps,O[Ac]=_,(W=O.nodeValue!==w)&&(p=ja,p!==null))switch(p.tag){case 3:Bf(O.nodeValue,w,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&Bf(O.nodeValue,w,(p.mode&1)!==0)}W&&(_.flags|=4)}else O=(w.nodeType===9?w:w.ownerDocument).createTextNode(O),O[Ac]=_,_.stateNode=O}return As(_),null;case 13:if(Hr(Si),O=_.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(si&&Ba!==null&&(_.mode&1)!==0&&(_.flags&128)===0)Zv(),Md(),_.flags|=98560,W=!1;else if(W=qh(_),O!==null&&O.dehydrated!==null){if(p===null){if(!W)throw Error(a(318));if(W=_.memoizedState,W=W!==null?W.dehydrated:null,!W)throw Error(a(317));W[Ac]=_}else Md(),(_.flags&128)===0&&(_.memoizedState=null),_.flags|=4;As(_),W=!1}else Go!==null&&(zS(Go),Go=null),W=!0;if(!W)return _.flags&65536?_:null}return(_.flags&128)!==0?(_.lanes=w,_):(O=O!==null,O!==(p!==null&&p.memoizedState!==null)&&O&&(_.child.flags|=8192,(_.mode&1)!==0&&(p===null||(Si.current&1)!==0?us===0&&(us=3):sp())),_.updateQueue!==null&&(_.flags|=4),As(_),null);case 4:return Fd(),B_(p,_),p===null&&El(_.stateNode.containerInfo),As(_),null;case 10:return iS(_.type._context),As(_),null;case 17:return Ta(_.type)&&f_(),As(_),null;case 19:if(Hr(Si),W=_.memoizedState,W===null)return As(_),null;if(O=(_.flags&128)!==0,ee=W.rendering,ee===null)if(O)am(W,!1);else{if(us!==0||p!==null&&(p.flags&128)!==0)for(p=_.child;p!==null;){if(ee=b_(p),ee!==null){for(_.flags|=128,am(W,!1),O=ee.updateQueue,O!==null&&(_.updateQueue=O,_.flags|=4),_.subtreeFlags=0,O=w,w=_.child;w!==null;)W=w,p=O,W.flags&=14680066,ee=W.alternate,ee===null?(W.childLanes=0,W.lanes=p,W.child=null,W.subtreeFlags=0,W.memoizedProps=null,W.memoizedState=null,W.updateQueue=null,W.dependencies=null,W.stateNode=null):(W.childLanes=ee.childLanes,W.lanes=ee.lanes,W.child=ee.child,W.subtreeFlags=0,W.deletions=null,W.memoizedProps=ee.memoizedProps,W.memoizedState=ee.memoizedState,W.updateQueue=ee.updateQueue,W.type=ee.type,p=ee.dependencies,W.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),w=w.sibling;return Zr(Si,Si.current&1|2),_.child}p=p.sibling}W.tail!==null&&gr()>oo&&(_.flags|=128,O=!0,am(W,!1),_.lanes=4194304)}else{if(!O)if(p=b_(ee),p!==null){if(_.flags|=128,O=!0,w=p.updateQueue,w!==null&&(_.updateQueue=w,_.flags|=4),am(W,!0),W.tail===null&&W.tailMode==="hidden"&&!ee.alternate&&!si)return As(_),null}else 2*gr()-W.renderingStartTime>oo&&w!==1073741824&&(_.flags|=128,O=!0,am(W,!1),_.lanes=4194304);W.isBackwards?(ee.sibling=_.child,_.child=ee):(w=W.last,w!==null?w.sibling=ee:_.child=ee,W.last=ee)}return W.tail!==null?(_=W.tail,W.rendering=_,W.tail=_.sibling,W.renderingStartTime=gr(),_.sibling=null,w=Si.current,Zr(Si,O?w&1|2:w&1),_):(As(_),null);case 22:case 23:return pm(),O=_.memoizedState!==null,p!==null&&p.memoizedState!==null!==O&&(_.flags|=8192),O&&(_.mode&1)!==0?(Ga&1073741824)!==0&&(As(_),_.subtreeFlags&6&&(_.flags|=8192)):As(_),null;case 24:return null;case 25:return null}throw Error(a(156,_.tag))}function qN(p,_){switch(y_(_),_.tag){case 1:return Ta(_.type)&&f_(),p=_.flags,p&65536?(_.flags=p&-65537|128,_):null;case 3:return Fd(),Hr(na),Hr(Ms),dS(),p=_.flags,(p&65536)!==0&&(p&128)===0?(_.flags=p&-65537|128,_):null;case 5:return lS(_),null;case 13:if(Hr(Si),p=_.memoizedState,p!==null&&p.dehydrated!==null){if(_.alternate===null)throw Error(a(340));Md()}return p=_.flags,p&65536?(_.flags=p&-65537|128,_):null;case 19:return Hr(Si),null;case 4:return Fd(),null;case 10:return iS(_.type._context),null;case 22:case 23:return pm(),null;case 24:return null;default:return null}}var om=!1,Os=!1,XN=typeof WeakSet=="function"?WeakSet:Set,Nt=null;function Hd(p,_){var w=p.ref;if(w!==null)if(typeof w=="function")try{w(null)}catch(O){Ti(p,_,O)}else w.current=null}function DS(p,_,w){try{w()}catch(O){Ti(p,_,O)}}var sR=!1;function JN(p,_){if(Kv=e_,p=Vv(),Fv(p)){if("selectionStart"in p)var w={start:p.selectionStart,end:p.selectionEnd};else e:{w=(w=p.ownerDocument)&&w.defaultView||window;var O=w.getSelection&&w.getSelection();if(O&&O.rangeCount!==0){w=O.anchorNode;var U=O.anchorOffset,W=O.focusNode;O=O.focusOffset;try{w.nodeType,W.nodeType}catch{w=null;break e}var ee=0,me=-1,ve=-1,He=0,ut=0,ht=p,ot=null;t:for(;;){for(var bt;ht!==w||U!==0&&ht.nodeType!==3||(me=ee+U),ht!==W||O!==0&&ht.nodeType!==3||(ve=ee+O),ht.nodeType===3&&(ee+=ht.nodeValue.length),(bt=ht.firstChild)!==null;)ot=ht,ht=bt;for(;;){if(ht===p)break t;if(ot===w&&++He===U&&(me=ee),ot===W&&++ut===O&&(ve=ee),(bt=ht.nextSibling)!==null)break;ht=ot,ot=ht.parentNode}ht=bt}w=me===-1||ve===-1?null:{start:me,end:ve}}else w=null}w=w||{start:0,end:0}}else w=null;for(d_={focusedElem:p,selectionRange:w},e_=!1,Nt=_;Nt!==null;)if(_=Nt,p=_.child,(_.subtreeFlags&1028)!==0&&p!==null)p.return=_,Nt=p;else for(;Nt!==null;){_=Nt;try{var Bt=_.alternate;if((_.flags&1024)!==0)switch(_.tag){case 0:case 11:case 15:break;case 1:if(Bt!==null){var Gt=Bt.memoizedProps,Wi=Bt.memoizedState,xe=_.stateNode,Te=xe.getSnapshotBeforeUpdate(_.elementType===_.type?Gt:ao(_.type,Gt),Wi);xe.__reactInternalSnapshotBeforeUpdate=Te}break;case 3:var Fe=_.stateNode.containerInfo;Fe.nodeType===1?Fe.textContent="":Fe.nodeType===9&&Fe.documentElement&&Fe.removeChild(Fe.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(a(163))}}catch(ft){Ti(_,_.return,ft)}if(p=_.sibling,p!==null){p.return=_.return,Nt=p;break}Nt=_.return}return Bt=sR,sR=!1,Bt}function xu(p,_,w){var O=_.updateQueue;if(O=O!==null?O.lastEffect:null,O!==null){var U=O=O.next;do{if((U.tag&p)===p){var W=U.destroy;U.destroy=void 0,W!==void 0&&DS(_,w,W)}U=U.next}while(U!==O)}}function G_(p,_){if(_=_.updateQueue,_=_!==null?_.lastEffect:null,_!==null){var w=_=_.next;do{if((w.tag&p)===p){var O=w.create;w.destroy=O()}w=w.next}while(w!==_)}}function xS(p){var _=p.ref;if(_!==null){var w=p.stateNode;p.tag,p=w,typeof _=="function"?_(p):_.current=p}}function aR(p){var _=p.alternate;_!==null&&(p.alternate=null,aR(_)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(_=p.stateNode,_!==null&&(delete _[Ac],delete _[Gf],delete _[qv],delete _[FN],delete _[jN])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function LS(p){return p.tag===5||p.tag===3||p.tag===4}function oR(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||LS(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function MS(p,_,w){var O=p.tag;if(O===5||O===6)p=p.stateNode,_?w.nodeType===8?w.parentNode.insertBefore(p,_):w.insertBefore(p,_):(w.nodeType===8?(_=w.parentNode,_.insertBefore(p,w)):(_=w,_.appendChild(p)),w=w._reactRootContainer,w!=null||_.onclick!==null||(_.onclick=Wf));else if(O!==4&&(p=p.child,p!==null))for(MS(p,_,w),p=p.sibling;p!==null;)MS(p,_,w),p=p.sibling}function cm(p,_,w){var O=p.tag;if(O===5||O===6)p=p.stateNode,_?w.insertBefore(p,_):w.appendChild(p);else if(O!==4&&(p=p.child,p!==null))for(cm(p,_,w),p=p.sibling;p!==null;)cm(p,_,w),p=p.sibling}var Ns=null,Wa=!1;function Lu(p,_,w){for(w=w.child;w!==null;)US(p,_,w),w=w.sibling}function US(p,_,w){if(bs&&typeof bs.onCommitFiberUnmount=="function")try{bs.onCommitFiberUnmount(Dr,w)}catch{}switch(w.tag){case 5:Os||Hd(w,_);case 6:var O=Ns,U=Wa;Ns=null,Lu(p,_,w),Ns=O,Wa=U,Ns!==null&&(Wa?(p=Ns,w=w.stateNode,p.nodeType===8?p.parentNode.removeChild(w):p.removeChild(w)):Ns.removeChild(w.stateNode));break;case 18:Ns!==null&&(Wa?(p=Ns,w=w.stateNode,p.nodeType===8?h_(p.parentNode,w):p.nodeType===1&&h_(p,w),Ph(p)):h_(Ns,w.stateNode));break;case 4:O=Ns,U=Wa,Ns=w.stateNode.containerInfo,Wa=!0,Lu(p,_,w),Ns=O,Wa=U;break;case 0:case 11:case 14:case 15:if(!Os&&(O=w.updateQueue,O!==null&&(O=O.lastEffect,O!==null))){U=O=O.next;do{var W=U,ee=W.destroy;W=W.tag,ee!==void 0&&((W&2)!==0||(W&4)!==0)&&DS(w,_,ee),U=U.next}while(U!==O)}Lu(p,_,w);break;case 1:if(!Os&&(Hd(w,_),O=w.stateNode,typeof O.componentWillUnmount=="function"))try{O.props=w.memoizedProps,O.state=w.memoizedState,O.componentWillUnmount()}catch(me){Ti(w,_,me)}Lu(p,_,w);break;case 21:Lu(p,_,w);break;case 22:w.mode&1?(Os=(O=Os)||w.memoizedState!==null,Lu(p,_,w),Os=O):Lu(p,_,w);break;default:Lu(p,_,w)}}function cR(p){var _=p.updateQueue;if(_!==null){p.updateQueue=null;var w=p.stateNode;w===null&&(w=p.stateNode=new XN),_.forEach(function(O){var U=ap.bind(null,p,O);w.has(O)||(w.add(O),O.then(U,U))})}}function qo(p,_){var w=_.deletions;if(w!==null)for(var O=0;O<w.length;O++){var U=w[O];try{var W=p,ee=_,me=ee;e:for(;me!==null;){switch(me.tag){case 5:Ns=me.stateNode,Wa=!1;break e;case 3:Ns=me.stateNode.containerInfo,Wa=!0;break e;case 4:Ns=me.stateNode.containerInfo,Wa=!0;break e}me=me.return}if(Ns===null)throw Error(a(160));US(W,ee,U),Ns=null,Wa=!1;var ve=U.alternate;ve!==null&&(ve.return=null),U.return=null}catch(He){Ti(U,_,He)}}if(_.subtreeFlags&12854)for(_=_.child;_!==null;)VS(_,p),_=_.sibling}function VS(p,_){var w=p.alternate,O=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(qo(_,p),Pc(p),O&4){try{xu(3,p,p.return),G_(3,p)}catch(Gt){Ti(p,p.return,Gt)}try{xu(5,p,p.return)}catch(Gt){Ti(p,p.return,Gt)}}break;case 1:qo(_,p),Pc(p),O&512&&w!==null&&Hd(w,w.return);break;case 5:if(qo(_,p),Pc(p),O&512&&w!==null&&Hd(w,w.return),p.flags&32){var U=p.stateNode;try{Nn(U,"")}catch(Gt){Ti(p,p.return,Gt)}}if(O&4&&(U=p.stateNode,U!=null)){var W=p.memoizedProps,ee=w!==null?w.memoizedProps:W,me=p.type,ve=p.updateQueue;if(p.updateQueue=null,ve!==null)try{me==="input"&&W.type==="radio"&&W.name!=null&&yi(U,W),Ea(me,ee);var He=Ea(me,W);for(ee=0;ee<ve.length;ee+=2){var ut=ve[ee],ht=ve[ee+1];ut==="style"?mi(U,ht):ut==="dangerouslySetInnerHTML"?on(U,ht):ut==="children"?Nn(U,ht):$(U,ut,ht,He)}switch(me){case"input":wc(U,W);break;case"textarea":Ir(U,W);break;case"select":var ot=U._wrapperState.wasMultiple;U._wrapperState.wasMultiple=!!W.multiple;var bt=W.value;bt!=null?gs(U,!!W.multiple,bt,!1):ot!==!!W.multiple&&(W.defaultValue!=null?gs(U,!!W.multiple,W.defaultValue,!0):gs(U,!!W.multiple,W.multiple?[]:"",!1))}U[Gf]=W}catch(Gt){Ti(p,p.return,Gt)}}break;case 6:if(qo(_,p),Pc(p),O&4){if(p.stateNode===null)throw Error(a(162));U=p.stateNode,W=p.memoizedProps;try{U.nodeValue=W}catch(Gt){Ti(p,p.return,Gt)}}break;case 3:if(qo(_,p),Pc(p),O&4&&w!==null&&w.memoizedState.isDehydrated)try{Ph(_.containerInfo)}catch(Gt){Ti(p,p.return,Gt)}break;case 4:qo(_,p),Pc(p);break;case 13:qo(_,p),Pc(p),U=p.child,U.flags&8192&&(W=U.memoizedState!==null,U.stateNode.isHidden=W,!W||U.alternate!==null&&U.alternate.memoizedState!==null||(WS=gr())),O&4&&cR(p);break;case 22:if(ut=w!==null&&w.memoizedState!==null,p.mode&1?(Os=(He=Os)||ut,qo(_,p),Os=He):qo(_,p),Pc(p),O&8192){if(He=p.memoizedState!==null,(p.stateNode.isHidden=He)&&!ut&&(p.mode&1)!==0)for(Nt=p,ut=p.child;ut!==null;){for(ht=Nt=ut;Nt!==null;){switch(ot=Nt,bt=ot.child,ot.tag){case 0:case 11:case 14:case 15:xu(4,ot,ot.return);break;case 1:Hd(ot,ot.return);var Bt=ot.stateNode;if(typeof Bt.componentWillUnmount=="function"){O=ot,w=ot.return;try{_=O,Bt.props=_.memoizedProps,Bt.state=_.memoizedState,Bt.componentWillUnmount()}catch(Gt){Ti(O,w,Gt)}}break;case 5:Hd(ot,ot.return);break;case 22:if(ot.memoizedState!==null){H_(ht);continue}}bt!==null?(bt.return=ot,Nt=bt):H_(ht)}ut=ut.sibling}e:for(ut=null,ht=p;;){if(ht.tag===5){if(ut===null){ut=ht;try{U=ht.stateNode,He?(W=U.style,typeof W.setProperty=="function"?W.setProperty("display","none","important"):W.display="none"):(me=ht.stateNode,ve=ht.memoizedProps.style,ee=ve!=null&&ve.hasOwnProperty("display")?ve.display:null,me.style.display=$r("display",ee))}catch(Gt){Ti(p,p.return,Gt)}}}else if(ht.tag===6){if(ut===null)try{ht.stateNode.nodeValue=He?"":ht.memoizedProps}catch(Gt){Ti(p,p.return,Gt)}}else if((ht.tag!==22&&ht.tag!==23||ht.memoizedState===null||ht===p)&&ht.child!==null){ht.child.return=ht,ht=ht.child;continue}if(ht===p)break e;for(;ht.sibling===null;){if(ht.return===null||ht.return===p)break e;ut===ht&&(ut=null),ht=ht.return}ut===ht&&(ut=null),ht.sibling.return=ht.return,ht=ht.sibling}}break;case 19:qo(_,p),Pc(p),O&4&&cR(p);break;case 21:break;default:qo(_,p),Pc(p)}}function Pc(p){var _=p.flags;if(_&2){try{e:{for(var w=p.return;w!==null;){if(LS(w)){var O=w;break e}w=w.return}throw Error(a(160))}switch(O.tag){case 5:var U=O.stateNode;O.flags&32&&(Nn(U,""),O.flags&=-33);var W=oR(p);cm(p,W,U);break;case 3:case 4:var ee=O.stateNode.containerInfo,me=oR(p);MS(p,me,ee);break;default:throw Error(a(161))}}catch(ve){Ti(p,p.return,ve)}p.flags&=-3}_&4096&&(p.flags&=-4097)}function $N(p,_,w){Nt=p,FS(p)}function FS(p,_,w){for(var O=(p.mode&1)!==0;Nt!==null;){var U=Nt,W=U.child;if(U.tag===22&&O){var ee=U.memoizedState!==null||om;if(!ee){var me=U.alternate,ve=me!==null&&me.memoizedState!==null||Os;me=om;var He=Os;if(om=ee,(Os=ve)&&!He)for(Nt=U;Nt!==null;)ee=Nt,ve=ee.child,ee.tag===22&&ee.memoizedState!==null?lR(U):ve!==null?(ve.return=ee,Nt=ve):lR(U);for(;W!==null;)Nt=W,FS(W),W=W.sibling;Nt=U,om=me,Os=He}jS(p)}else(U.subtreeFlags&8772)!==0&&W!==null?(W.return=U,Nt=W):jS(p)}}function jS(p){for(;Nt!==null;){var _=Nt;if((_.flags&8772)!==0){var w=_.alternate;try{if((_.flags&8772)!==0)switch(_.tag){case 0:case 11:case 15:Os||G_(5,_);break;case 1:var O=_.stateNode;if(_.flags&4&&!Os)if(w===null)O.componentDidMount();else{var U=_.elementType===_.type?w.memoizedProps:ao(_.type,w.memoizedProps);O.componentDidUpdate(U,w.memoizedState,O.__reactInternalSnapshotBeforeUpdate)}var W=_.updateQueue;W!==null&&LC(_,W,O);break;case 3:var ee=_.updateQueue;if(ee!==null){if(w=null,_.child!==null)switch(_.child.tag){case 5:w=_.child.stateNode;break;case 1:w=_.child.stateNode}LC(_,ee,w)}break;case 5:var me=_.stateNode;if(w===null&&_.flags&4){w=me;var ve=_.memoizedProps;switch(_.type){case"button":case"input":case"select":case"textarea":ve.autoFocus&&w.focus();break;case"img":ve.src&&(w.src=ve.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(_.memoizedState===null){var He=_.alternate;if(He!==null){var ut=He.memoizedState;if(ut!==null){var ht=ut.dehydrated;ht!==null&&Ph(ht)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(a(163))}Os||_.flags&512&&xS(_)}catch(ot){Ti(_,_.return,ot)}}if(_===p){Nt=null;break}if(w=_.sibling,w!==null){w.return=_.return,Nt=w;break}Nt=_.return}}function H_(p){for(;Nt!==null;){var _=Nt;if(_===p){Nt=null;break}var w=_.sibling;if(w!==null){w.return=_.return,Nt=w;break}Nt=_.return}}function lR(p){for(;Nt!==null;){var _=Nt;try{switch(_.tag){case 0:case 11:case 15:var w=_.return;try{G_(4,_)}catch(ve){Ti(_,w,ve)}break;case 1:var O=_.stateNode;if(typeof O.componentDidMount=="function"){var U=_.return;try{O.componentDidMount()}catch(ve){Ti(_,U,ve)}}var W=_.return;try{xS(_)}catch(ve){Ti(_,W,ve)}break;case 5:var ee=_.return;try{xS(_)}catch(ve){Ti(_,ee,ve)}}}catch(ve){Ti(_,_.return,ve)}if(_===p){Nt=null;break}var me=_.sibling;if(me!==null){me.return=_.return,Nt=me;break}Nt=_.return}}var QN=Math.ceil,Mu=le.ReactCurrentDispatcher,z_=le.ReactCurrentOwner,Vs=le.ReactCurrentBatchConfig,Yn=0,ls=null,Ni=null,es=0,Ga=0,np=Wo(0),us=0,rp=null,zd=0,K_=0,BS=0,Kd=null,Bi=null,WS=0,oo=1/0,kc=null,Fs=!1,GS=null,Uu=null,lm=!1,Vu=null,um=0,ip=0,HS=null,dm=-1,Y_=0;function sa(){return(Yn&6)!==0?gr():dm!==-1?dm:dm=gr()}function Fu(p){return(p.mode&1)===0?1:(Yn&2)!==0&&es!==0?es&-es:Yf.transition!==null?(Y_===0&&(Y_=Xw()),Y_):(p=Tr,p!==0||(p=window.event,p=p===void 0?16:eC(p.type)),p)}function Ha(p,_,w,O){if(50<ip)throw ip=0,HS=null,Error(a(185));Rf(p,w,O),((Yn&2)===0||p!==ls)&&(p===ls&&((Yn&2)===0&&(K_|=w),us===4&&ju(p,es)),js(p,O),w===1&&Yn===0&&(_.mode&1)===0&&(oo=gr()+500,g_&&Nu()))}function js(p,_){var w=p.callbackNode;qw(p,_);var O=Xg(p,p===ls?es:0);if(O===0)w!==null&&ml(w),p.callbackNode=null,p.callbackPriority=0;else if(_=O&-O,p.callbackPriority!==_){if(w!=null&&ml(w),_===1)p.tag===0?BN(q_.bind(null,p)):$v(q_.bind(null,p)),UN(function(){(Yn&6)===0&&Nu()}),w=null;else{switch(Sv(O)){case 1:w=Ur;break;case 4:w=Rc;break;case 16:w=gl;break;case 536870912:w=sr;break;default:w=gl}w=$S(w,uR.bind(null,p))}p.callbackPriority=_,p.callbackNode=w}}function uR(p,_){if(dm=-1,Y_=0,(Yn&6)!==0)throw Error(a(327));var w=p.callbackNode;if(Wu()&&p.callbackNode!==w)return null;var O=Xg(p,p===ls?es:0);if(O===0)return null;if((O&30)!==0||(O&p.expiredLanes)!==0||_)_=fm(p,O);else{_=O;var U=Yn;Yn|=2;var W=YS();(ls!==p||es!==_)&&(kc=null,oo=gr()+500,Pl(p,_));do try{eP();break}catch(me){KS(p,me)}while(!0);rS(),Mu.current=W,Yn=U,Ni!==null?_=0:(ls=null,es=0,_=us)}if(_!==0){if(_===2&&(U=Ev(p),U!==0&&(O=U,_=hm(p,U))),_===1)throw w=rp,Pl(p,0),ju(p,O),js(p,gr()),w;if(_===6)ju(p,O);else{if(U=p.current.alternate,(O&30)===0&&!dR(U)&&(_=fm(p,O),_===2&&(W=Ev(p),W!==0&&(O=W,_=hm(p,W))),_===1))throw w=rp,Pl(p,0),ju(p,O),js(p,gr()),w;switch(p.finishedWork=U,p.finishedLanes=O,_){case 0:case 1:throw Error(a(345));case 2:co(p,Bi,kc);break;case 3:if(ju(p,O),(O&130023424)===O&&(_=WS+500-gr(),10<_)){if(Xg(p,0)!==0)break;if(U=p.suspendedLanes,(U&O)!==O){sa(),p.pingedLanes|=p.suspendedLanes&U;break}p.timeoutHandle=Yv(co.bind(null,p,Bi,kc),_);break}co(p,Bi,kc);break;case 4:if(ju(p,O),(O&4194240)===O)break;for(_=p.eventTimes,U=-1;0<O;){var ee=31-_r(O);W=1<<ee,ee=_[ee],ee>U&&(U=ee),O&=~W}if(O=U,O=gr()-O,O=(120>O?120:480>O?480:1080>O?1080:1920>O?1920:3e3>O?3e3:4320>O?4320:1960*QN(O/1960))-O,10<O){p.timeoutHandle=Yv(co.bind(null,p,Bi,kc),O);break}co(p,Bi,kc);break;case 5:co(p,Bi,kc);break;default:throw Error(a(329))}}}return js(p,gr()),p.callbackNode===w?uR.bind(null,p):null}function hm(p,_){var w=Kd;return p.current.memoizedState.isDehydrated&&(Pl(p,_).flags|=256),p=fm(p,_),p!==2&&(_=Bi,Bi=w,_!==null&&zS(_)),p}function zS(p){Bi===null?Bi=p:Bi.push.apply(Bi,p)}function dR(p){for(var _=p;;){if(_.flags&16384){var w=_.updateQueue;if(w!==null&&(w=w.stores,w!==null))for(var O=0;O<w.length;O++){var U=w[O],W=U.getSnapshot;U=U.value;try{if(!jo(W(),U))return!1}catch{return!1}}}if(w=_.child,_.subtreeFlags&16384&&w!==null)w.return=_,_=w;else{if(_===p)break;for(;_.sibling===null;){if(_.return===null||_.return===p)return!0;_=_.return}_.sibling.return=_.return,_=_.sibling}}return!0}function ju(p,_){for(_&=~BS,_&=~K_,p.suspendedLanes|=_,p.pingedLanes&=~_,p=p.expirationTimes;0<_;){var w=31-_r(_),O=1<<w;p[w]=-1,_&=~O}}function q_(p){if((Yn&6)!==0)throw Error(a(327));Wu();var _=Xg(p,0);if((_&1)===0)return js(p,gr()),null;var w=fm(p,_);if(p.tag!==0&&w===2){var O=Ev(p);O!==0&&(_=O,w=hm(p,O))}if(w===1)throw w=rp,Pl(p,0),ju(p,_),js(p,gr()),w;if(w===6)throw Error(a(345));return p.finishedWork=p.current.alternate,p.finishedLanes=_,co(p,Bi,kc),js(p,gr()),null}function Yd(p,_){var w=Yn;Yn|=1;try{return p(_)}finally{Yn=w,Yn===0&&(oo=gr()+500,g_&&Nu())}}function Bu(p){Vu!==null&&Vu.tag===0&&(Yn&6)===0&&Wu();var _=Yn;Yn|=1;var w=Vs.transition,O=Tr;try{if(Vs.transition=null,Tr=1,p)return p()}finally{Tr=O,Vs.transition=w,Yn=_,(Yn&6)===0&&Nu()}}function pm(){Ga=np.current,Hr(np)}function Pl(p,_){p.finishedWork=null,p.finishedLanes=0;var w=p.timeoutHandle;if(w!==-1&&(p.timeoutHandle=-1,MN(w)),Ni!==null)for(w=Ni.return;w!==null;){var O=w;switch(y_(O),O.tag){case 1:O=O.type.childContextTypes,O!=null&&f_();break;case 3:Fd(),Hr(na),Hr(Ms),dS();break;case 5:lS(O);break;case 4:Fd();break;case 13:Hr(Si);break;case 19:Hr(Si);break;case 10:iS(O.type._context);break;case 22:case 23:pm()}w=w.return}if(ls=p,Ni=p=Gu(p.current,null),es=Ga=_,us=0,rp=null,BS=K_=zd=0,Bi=Kd=null,Ud!==null){for(_=0;_<Ud.length;_++)if(w=Ud[_],O=w.interleaved,O!==null){w.interleaved=null;var U=O.next,W=w.pending;if(W!==null){var ee=W.next;W.next=U,O.next=ee}w.pending=O}Ud=null}return p}function KS(p,_){do{var w=Ni;try{if(rS(),$f.current=ep,Qf){for(var O=gi.memoizedState;O!==null;){var U=O.queue;U!==null&&(U.pending=null),O=O.next}Qf=!1}if(jd=0,ji=cs=gi=null,Il=!1,Zf=0,z_.current=null,w===null||w.return===null){us=1,rp=_,Ni=null;break}e:{var W=p,ee=w.return,me=w,ve=_;if(_=es,me.flags|=32768,ve!==null&&typeof ve=="object"&&typeof ve.then=="function"){var He=ve,ut=me,ht=ut.tag;if((ut.mode&1)===0&&(ht===0||ht===11||ht===15)){var ot=ut.alternate;ot?(ut.updateQueue=ot.updateQueue,ut.memoizedState=ot.memoizedState,ut.lanes=ot.lanes):(ut.updateQueue=null,ut.memoizedState=null)}var bt=XC(ee);if(bt!==null){bt.flags&=-257,JC(bt,ee,me,W,_),bt.mode&1&&RS(W,He,_),_=bt,ve=He;var Bt=_.updateQueue;if(Bt===null){var Gt=new Set;Gt.add(ve),_.updateQueue=Gt}else Bt.add(ve);break e}else{if((_&1)===0){RS(W,He,_),sp();break e}ve=Error(a(426))}}else if(si&&me.mode&1){var Wi=XC(ee);if(Wi!==null){(Wi.flags&65536)===0&&(Wi.flags|=256),JC(Wi,ee,me,W,_),Xh(tp(ve,me));break e}}W=ve=tp(ve,me),us!==4&&(us=2),Kd===null?Kd=[W]:Kd.push(W),W=ee;do{switch(W.tag){case 3:W.flags|=65536,_&=-_,W.lanes|=_;var xe=CS(W,ve,_);xC(W,xe);break e;case 1:me=ve;var Te=W.type,Fe=W.stateNode;if((W.flags&128)===0&&(typeof Te.getDerivedStateFromError=="function"||Fe!==null&&typeof Fe.componentDidCatch=="function"&&(Uu===null||!Uu.has(Fe)))){W.flags|=65536,_&=-_,W.lanes|=_;var ft=qC(W,me,_);xC(W,ft);break e}}W=W.return}while(W!==null)}XS(w)}catch(qt){_=qt,Ni===w&&w!==null&&(Ni=w=w.return);continue}break}while(!0)}function YS(){var p=Mu.current;return Mu.current=ep,p===null?ep:p}function sp(){(us===0||us===3||us===2)&&(us=4),ls===null||(zd&268435455)===0&&(K_&268435455)===0||ju(ls,es)}function fm(p,_){var w=Yn;Yn|=2;var O=YS();(ls!==p||es!==_)&&(kc=null,Pl(p,_));do try{ZN();break}catch(U){KS(p,U)}while(!0);if(rS(),Yn=w,Mu.current=O,Ni!==null)throw Error(a(261));return ls=null,es=0,us}function ZN(){for(;Ni!==null;)qS(Ni)}function eP(){for(;Ni!==null&&!Nd();)qS(Ni)}function qS(p){var _=fR(p.alternate,p,Ga);p.memoizedProps=p.pendingProps,_===null?XS(p):Ni=_,z_.current=null}function XS(p){var _=p;do{var w=_.alternate;if(p=_.return,(_.flags&32768)===0){if(w=W_(w,_,Ga),w!==null){Ni=w;return}}else{if(w=qN(w,_),w!==null){w.flags&=32767,Ni=w;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{us=6,Ni=null;return}}if(_=_.sibling,_!==null){Ni=_;return}Ni=_=p}while(_!==null);us===0&&(us=5)}function co(p,_,w){var O=Tr,U=Vs.transition;try{Vs.transition=null,Tr=1,JS(p,_,w,O)}finally{Vs.transition=U,Tr=O}return null}function JS(p,_,w,O){do Wu();while(Vu!==null);if((Yn&6)!==0)throw Error(a(327));w=p.finishedWork;var U=p.finishedLanes;if(w===null)return null;if(p.finishedWork=null,p.finishedLanes=0,w===p.current)throw Error(a(177));p.callbackNode=null,p.callbackPriority=0;var W=w.lanes|w.childLanes;if(sN(p,W),p===ls&&(Ni=ls=null,es=0),(w.subtreeFlags&2064)===0&&(w.flags&2064)===0||lm||(lm=!0,$S(gl,function(){return Wu(),null})),W=(w.flags&15990)!==0,(w.subtreeFlags&15990)!==0||W){W=Vs.transition,Vs.transition=null;var ee=Tr;Tr=1;var me=Yn;Yn|=4,z_.current=null,JN(p,w),VS(w,p),PN(d_),e_=!!Kv,d_=Kv=null,p.current=w,$N(w),Zi(),Yn=me,Tr=ee,Vs.transition=W}else p.current=w;if(lm&&(lm=!1,Vu=p,um=U),W=p.pendingLanes,W===0&&(Uu=null),fu(w.stateNode),js(p,gr()),_!==null)for(O=p.onRecoverableError,w=0;w<_.length;w++)U=_[w],O(U.value,{componentStack:U.stack,digest:U.digest});if(Fs)throw Fs=!1,p=GS,GS=null,p;return(um&1)!==0&&p.tag!==0&&Wu(),W=p.pendingLanes,(W&1)!==0?p===HS?ip++:(ip=0,HS=p):ip=0,Nu(),null}function Wu(){if(Vu!==null){var p=Sv(um),_=Vs.transition,w=Tr;try{if(Vs.transition=null,Tr=16>p?16:p,Vu===null)var O=!1;else{if(p=Vu,Vu=null,um=0,(Yn&6)!==0)throw Error(a(331));var U=Yn;for(Yn|=4,Nt=p.current;Nt!==null;){var W=Nt,ee=W.child;if((Nt.flags&16)!==0){var me=W.deletions;if(me!==null){for(var ve=0;ve<me.length;ve++){var He=me[ve];for(Nt=He;Nt!==null;){var ut=Nt;switch(ut.tag){case 0:case 11:case 15:xu(8,ut,W)}var ht=ut.child;if(ht!==null)ht.return=ut,Nt=ht;else for(;Nt!==null;){ut=Nt;var ot=ut.sibling,bt=ut.return;if(aR(ut),ut===He){Nt=null;break}if(ot!==null){ot.return=bt,Nt=ot;break}Nt=bt}}}var Bt=W.alternate;if(Bt!==null){var Gt=Bt.child;if(Gt!==null){Bt.child=null;do{var Wi=Gt.sibling;Gt.sibling=null,Gt=Wi}while(Gt!==null)}}Nt=W}}if((W.subtreeFlags&2064)!==0&&ee!==null)ee.return=W,Nt=ee;else e:for(;Nt!==null;){if(W=Nt,(W.flags&2048)!==0)switch(W.tag){case 0:case 11:case 15:xu(9,W,W.return)}var xe=W.sibling;if(xe!==null){xe.return=W.return,Nt=xe;break e}Nt=W.return}}var Te=p.current;for(Nt=Te;Nt!==null;){ee=Nt;var Fe=ee.child;if((ee.subtreeFlags&2064)!==0&&Fe!==null)Fe.return=ee,Nt=Fe;else e:for(ee=Te;Nt!==null;){if(me=Nt,(me.flags&2048)!==0)try{switch(me.tag){case 0:case 11:case 15:G_(9,me)}}catch(qt){Ti(me,me.return,qt)}if(me===ee){Nt=null;break e}var ft=me.sibling;if(ft!==null){ft.return=me.return,Nt=ft;break e}Nt=me.return}}if(Yn=U,Nu(),bs&&typeof bs.onPostCommitFiberRoot=="function")try{bs.onPostCommitFiberRoot(Dr,p)}catch{}O=!0}return O}finally{Tr=w,Vs.transition=_}}return!1}function X_(p,_,w){_=tp(w,_),_=CS(p,_,1),p=zo(p,_,1),_=sa(),p!==null&&(Rf(p,1,_),js(p,_))}function Ti(p,_,w){if(p.tag===3)X_(p,p,w);else for(;_!==null;){if(_.tag===3){X_(_,p,w);break}else if(_.tag===1){var O=_.stateNode;if(typeof _.type.getDerivedStateFromError=="function"||typeof O.componentDidCatch=="function"&&(Uu===null||!Uu.has(O))){p=tp(w,p),p=qC(_,p,1),_=zo(_,p,1),p=sa(),_!==null&&(Rf(_,1,p),js(_,p));break}}_=_.return}}function hR(p,_,w){var O=p.pingCache;O!==null&&O.delete(_),_=sa(),p.pingedLanes|=p.suspendedLanes&w,ls===p&&(es&w)===w&&(us===4||us===3&&(es&130023424)===es&&500>gr()-WS?Pl(p,0):BS|=w),js(p,_)}function pR(p,_){_===0&&((p.mode&1)===0?_=1:(_=qg,qg<<=1,(qg&130023424)===0&&(qg=4194304)));var w=sa();p=Cl(p,_),p!==null&&(Rf(p,_,w),js(p,w))}function tP(p){var _=p.memoizedState,w=0;_!==null&&(w=_.retryLane),pR(p,w)}function ap(p,_){var w=0;switch(p.tag){case 13:var O=p.stateNode,U=p.memoizedState;U!==null&&(w=U.retryLane);break;case 19:O=p.stateNode;break;default:throw Error(a(314))}O!==null&&O.delete(_),pR(p,w)}var fR;fR=function(p,_,w){if(p!==null)if(p.memoizedProps!==_.pendingProps||na.current)Ca=!0;else{if((p.lanes&w)===0&&(_.flags&128)===0)return Ca=!1,F_(p,_,w);Ca=(p.flags&131072)!==0}else Ca=!1,si&&(_.flags&1048576)!==0&&OC(_,E_,_.index);switch(_.lanes=0,_.tag){case 2:var O=_.type;V_(p,_),p=_.pendingProps;var U=Ou(_,Ms.current);Ho(_,w),U=Qh(null,_,O,p,U,w);var W=fS();return _.flags|=1,typeof U=="object"&&U!==null&&typeof U.render=="function"&&U.$$typeof===void 0?(_.tag=1,_.memoizedState=null,_.updateQueue=null,Ta(O)?(W=!0,m_(_)):W=!1,_.memoizedState=U.state!==null&&U.state!==void 0?U.state:null,oS(_),U.updater=x_,_.stateNode=U,U._reactInternals=_,SS(_,O,p,w),_=AS(null,_,O,!0,W,w)):(_.tag=0,si&&W&&Yh(_),ia(null,_,U,w),_=_.child),_;case 16:O=_.elementType;e:{switch(V_(p,_),p=_.pendingProps,U=O._init,O=U(O._payload),_.type=O,U=_.tag=nP(O),p=ao(O,p),U){case 0:_=IS(null,_,O,p,w);break e;case 1:_=eR(null,_,O,p,w);break e;case 11:_=$C(null,_,O,p,w);break e;case 14:_=QC(null,_,O,ao(O.type,p),w);break e}throw Error(a(306,O,""))}return _;case 0:return O=_.type,U=_.pendingProps,U=_.elementType===O?U:ao(O,U),IS(p,_,O,U,w);case 1:return O=_.type,U=_.pendingProps,U=_.elementType===O?U:ao(O,U),eR(p,_,O,U,w);case 3:e:{if(tR(_),p===null)throw Error(a(387));O=_.pendingProps,W=_.memoizedState,U=W.element,DC(p,_),R_(_,O,null,w);var ee=_.memoizedState;if(O=ee.element,W.isDehydrated)if(W={element:O,isDehydrated:!1,cache:ee.cache,pendingSuspenseBoundaries:ee.pendingSuspenseBoundaries,transitions:ee.transitions},_.updateQueue.baseState=W,_.memoizedState=W,_.flags&256){U=tp(Error(a(423)),_),_=nR(p,_,O,w,U);break e}else if(O!==U){U=tp(Error(a(424)),_),_=nR(p,_,O,w,U);break e}else for(Ba=Ic(_.stateNode.containerInfo.firstChild),ja=_,si=!0,Go=null,w=tS(_,null,O,w),_.child=w;w;)w.flags=w.flags&-3|4096,w=w.sibling;else{if(Md(),O===U){_=Nl(p,_,w);break e}ia(p,_,O,w)}_=_.child}return _;case 5:return MC(_),p===null&&Kf(_),O=_.type,U=_.pendingProps,W=p!==null?p.memoizedProps:null,ee=U.children,Gh(O,U)?ee=null:W!==null&&Gh(O,W)&&(_.flags|=32),ZC(p,_),ia(p,_,ee,w),_.child;case 6:return p===null&&Kf(_),null;case 13:return rR(p,_,w);case 4:return cS(_,_.stateNode.containerInfo),O=_.pendingProps,p===null?_.child=Jh(_,null,O,w):ia(p,_,O,w),_.child;case 11:return O=_.type,U=_.pendingProps,U=_.elementType===O?U:ao(O,U),$C(p,_,O,U,w);case 7:return ia(p,_,_.pendingProps,w),_.child;case 8:return ia(p,_,_.pendingProps.children,w),_.child;case 12:return ia(p,_,_.pendingProps.children,w),_.child;case 10:e:{if(O=_.type._context,U=_.pendingProps,W=_.memoizedProps,ee=U.value,Zr(S_,O._currentValue),O._currentValue=ee,W!==null)if(jo(W.value,ee)){if(W.children===U.children&&!na.current){_=Nl(p,_,w);break e}}else for(W=_.child,W!==null&&(W.return=_);W!==null;){var me=W.dependencies;if(me!==null){ee=W.child;for(var ve=me.firstContext;ve!==null;){if(ve.context===O){if(W.tag===1){ve=bl(-1,w&-w),ve.tag=2;var He=W.updateQueue;if(He!==null){He=He.shared;var ut=He.pending;ut===null?ve.next=ve:(ve.next=ut.next,ut.next=ve),He.pending=ve}}W.lanes|=w,ve=W.alternate,ve!==null&&(ve.lanes|=w),w_(W.return,w,_),me.lanes|=w;break}ve=ve.next}}else if(W.tag===10)ee=W.type===_.type?null:W.child;else if(W.tag===18){if(ee=W.return,ee===null)throw Error(a(341));ee.lanes|=w,me=ee.alternate,me!==null&&(me.lanes|=w),w_(ee,w,_),ee=W.sibling}else ee=W.child;if(ee!==null)ee.return=W;else for(ee=W;ee!==null;){if(ee===_){ee=null;break}if(W=ee.sibling,W!==null){W.return=ee.return,ee=W;break}ee=ee.return}W=ee}ia(p,_,U.children,w),_=_.child}return _;case 9:return U=_.type,O=_.pendingProps.children,Ho(_,w),U=so(U),O=O(U),_.flags|=1,ia(p,_,O,w),_.child;case 14:return O=_.type,U=ao(O,_.pendingProps),U=ao(O.type,U),QC(p,_,O,U,w);case 15:return bS(p,_,_.type,_.pendingProps,w);case 17:return O=_.type,U=_.pendingProps,U=_.elementType===O?U:ao(O,U),V_(p,_),_.tag=1,Ta(O)?(p=!0,m_(_)):p=!1,Ho(_,w),KC(_,O,U),SS(_,O,U,w),AS(null,_,O,!0,p,w);case 19:return PS(p,_,w);case 22:return Nc(p,_,w)}throw Error(a(156,_.tag))};function $S(p,_){return Ar(p,_)}function QS(p,_,w,O){this.tag=p,this.key=w,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=_,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=O,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function lo(p,_,w,O){return new QS(p,_,w,O)}function ZS(p){return p=p.prototype,!(!p||!p.isReactComponent)}function nP(p){if(typeof p=="function")return ZS(p)?1:0;if(p!=null){if(p=p.$$typeof,p===Se)return 11;if(p===Be)return 14}return 2}function Gu(p,_){var w=p.alternate;return w===null?(w=lo(p.tag,_,p.key,p.mode),w.elementType=p.elementType,w.type=p.type,w.stateNode=p.stateNode,w.alternate=p,p.alternate=w):(w.pendingProps=_,w.type=p.type,w.flags=0,w.subtreeFlags=0,w.deletions=null),w.flags=p.flags&14680064,w.childLanes=p.childLanes,w.lanes=p.lanes,w.child=p.child,w.memoizedProps=p.memoizedProps,w.memoizedState=p.memoizedState,w.updateQueue=p.updateQueue,_=p.dependencies,w.dependencies=_===null?null:{lanes:_.lanes,firstContext:_.firstContext},w.sibling=p.sibling,w.index=p.index,w.ref=p.ref,w}function op(p,_,w,O,U,W){var ee=2;if(O=p,typeof p=="function")ZS(p)&&(ee=1);else if(typeof p=="string")ee=5;else e:switch(p){case te:return Hu(w.children,U,W,_);case pe:ee=8,U|=8;break;case Ee:return p=lo(12,w,_,U|2),p.elementType=Ee,p.lanes=W,p;case Xe:return p=lo(13,w,_,U),p.elementType=Xe,p.lanes=W,p;case Re:return p=lo(19,w,_,U),p.elementType=Re,p.lanes=W,p;case Ge:return mm(w,U,W,_);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case Ne:ee=10;break e;case Ue:ee=9;break e;case Se:ee=11;break e;case Be:ee=14;break e;case $e:ee=16,O=null;break e}throw Error(a(130,p==null?p:typeof p,""))}return _=lo(ee,w,_,U),_.elementType=p,_.type=O,_.lanes=W,_}function Hu(p,_,w,O){return p=lo(7,p,O,_),p.lanes=w,p}function mm(p,_,w,O){return p=lo(22,p,O,_),p.elementType=Ge,p.lanes=w,p.stateNode={isHidden:!1},p}function J_(p,_,w){return p=lo(6,p,null,_),p.lanes=w,p}function cp(p,_,w){return _=lo(4,p.children!==null?p.children:[],p.key,_),_.lanes=w,_.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},_}function eT(p,_,w,O,U){this.tag=_,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=yv(0),this.expirationTimes=yv(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=yv(0),this.identifierPrefix=O,this.onRecoverableError=U,this.mutableSourceEagerHydrationData=null}function lp(p,_,w,O,U,W,ee,me,ve){return p=new eT(p,_,w,me,ve),_===1?(_=1,W===!0&&(_|=8)):_=0,W=lo(3,null,null,_),p.current=W,W.stateNode=p,W.memoizedState={element:O,isDehydrated:w,cache:null,transitions:null,pendingSuspenseBoundaries:null},oS(W),p}function $_(p,_,w){var O=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ce,key:O==null?null:""+O,children:p,containerInfo:_,implementation:w}}function tT(p){if(!p)return Iu;p=p._reactInternals;e:{if(Vt(p)!==p||p.tag!==1)throw Error(a(170));var _=p;do{switch(_.tag){case 3:_=_.stateNode.context;break e;case 1:if(Ta(_.type)){_=_.stateNode.__reactInternalMemoizedMergedChildContext;break e}}_=_.return}while(_!==null);throw Error(a(171))}if(p.tag===1){var w=p.type;if(Ta(w))return IC(p,w,_)}return _}function qd(p,_,w,O,U,W,ee,me,ve){return p=lp(w,O,!0,p,U,W,ee,me,ve),p.context=tT(null),w=p.current,O=sa(),U=Fu(w),W=bl(O,U),W.callback=_??null,zo(w,W,U),p.current.lanes=U,Rf(p,U,O),js(p,O),p}function Dc(p,_,w,O){var U=_.current,W=sa(),ee=Fu(U);return w=tT(w),_.context===null?_.context=w:_.pendingContext=w,_=bl(W,ee),_.payload={element:p},O=O===void 0?null:O,O!==null&&(_.callback=O),p=zo(U,_,ee),p!==null&&(Ha(p,U,ee,W),C_(p,U,ee)),ee}function Q_(p){return p=p.current,p.child?(p.child.tag===5,p.child.stateNode):null}function up(p,_){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var w=p.retryLane;p.retryLane=w!==0&&w<_?w:_}}function nT(p,_){up(p,_),(p=p.alternate)&&up(p,_)}function rP(){return null}var mR=typeof reportError=="function"?reportError:function(p){console.error(p)};function rT(p){this._internalRoot=p}gm.prototype.render=rT.prototype.render=function(p){var _=this._internalRoot;if(_===null)throw Error(a(409));Dc(p,_,null,null)},gm.prototype.unmount=rT.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var _=p.containerInfo;Bu(function(){Dc(null,p,null,null)}),_[yl]=null}};function gm(p){this._internalRoot=p}gm.prototype.unstable_scheduleHydration=function(p){if(p){var _=Jw();p={blockedOn:null,target:p,priority:_};for(var w=0;w<vu.length&&_!==0&&_<vu[w].priority;w++);vu.splice(w,0,p),w===0&&Nh(p)}};function _m(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function Em(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function gR(){}function _R(p,_,w,O,U){if(U){if(typeof O=="function"){var W=O;O=function(){var He=Q_(ee);W.call(He)}}var ee=qd(_,O,p,0,null,!1,!1,"",gR);return p._reactRootContainer=ee,p[yl]=ee.current,El(p.nodeType===8?p.parentNode:p),Bu(),ee}for(;U=p.lastChild;)p.removeChild(U);if(typeof O=="function"){var me=O;O=function(){var He=Q_(ve);me.call(He)}}var ve=lp(p,0,!1,null,null,!1,!1,"",gR);return p._reactRootContainer=ve,p[yl]=ve.current,El(p.nodeType===8?p.parentNode:p),Bu(function(){Dc(_,ve,w,O)}),ve}function Z_(p,_,w,O,U){var W=w._reactRootContainer;if(W){var ee=W;if(typeof U=="function"){var me=U;U=function(){var ve=Q_(ee);me.call(ve)}}Dc(_,ee,p,U)}else ee=_R(w,_,p,U,O);return Q_(ee)}Jg=function(p){switch(p.tag){case 3:var _=p.stateNode;if(_.current.memoizedState.isDehydrated){var w=Er(_.pendingLanes);w!==0&&(vv(_,w|1),js(_,gr()),(Yn&6)===0&&(oo=gr()+500,Nu()))}break;case 13:Bu(function(){var O=Cl(p,1);if(O!==null){var U=sa();Ha(O,p,1,U)}}),nT(p,1)}},Tv=function(p){if(p.tag===13){var _=Cl(p,134217728);if(_!==null){var w=sa();Ha(_,p,134217728,w)}nT(p,134217728)}},$g=function(p){if(p.tag===13){var _=Fu(p),w=Cl(p,_);if(w!==null){var O=sa();Ha(w,p,_,O)}nT(p,_)}},Jw=function(){return Tr},wv=function(p,_){var w=Tr;try{return Tr=p,_()}finally{Tr=w}},fl=function(p,_,w){switch(_){case"input":if(wc(p,w),_=w.name,w.type==="radio"&&_!=null){for(w=p;w.parentNode;)w=w.parentNode;for(w=w.querySelectorAll("input[name="+JSON.stringify(""+_)+'][type="radio"]'),_=0;_<w.length;_++){var O=w[_];if(O!==p&&O.form===p.form){var U=p_(O);if(!U)throw Error(a(90));Jr(O),wc(O,U)}}}break;case"textarea":Ir(p,w);break;case"select":_=w.value,_!=null&&gs(p,!!w.multiple,_,!1)}},Bn=Yd,mr=Bu;var ym={usingClientEntryPoint:!1,Events:[Hf,Hh,p_,Fo,mn,Yd]},Ra={findFiberByHostInstance:Dd,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ER={bundleType:Ra.bundleType,version:Ra.version,rendererPackageName:Ra.rendererPackageName,rendererConfig:Ra.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:le.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=Sr(p),p===null?null:p.stateNode},findFiberByHostInstance:Ra.findFiberByHostInstance||rP,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var eE=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!eE.isDisabled&&eE.supportsFiber)try{Dr=eE.inject(ER),bs=eE}catch{}}return Co.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ym,Co.createPortal=function(p,_){var w=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!_m(_))throw Error(a(200));return $_(p,_,null,w)},Co.createRoot=function(p,_){if(!_m(p))throw Error(a(299));var w=!1,O="",U=mR;return _!=null&&(_.unstable_strictMode===!0&&(w=!0),_.identifierPrefix!==void 0&&(O=_.identifierPrefix),_.onRecoverableError!==void 0&&(U=_.onRecoverableError)),_=lp(p,1,!1,null,null,w,!1,O,U),p[yl]=_.current,El(p.nodeType===8?p.parentNode:p),new rT(_)},Co.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var _=p._reactInternals;if(_===void 0)throw typeof p.render=="function"?Error(a(188)):(p=Object.keys(p).join(","),Error(a(268,p)));return p=Sr(_),p=p===null?null:p.stateNode,p},Co.flushSync=function(p){return Bu(p)},Co.hydrate=function(p,_,w){if(!Em(_))throw Error(a(200));return Z_(null,p,_,!0,w)},Co.hydrateRoot=function(p,_,w){if(!_m(p))throw Error(a(405));var O=w!=null&&w.hydratedSources||null,U=!1,W="",ee=mR;if(w!=null&&(w.unstable_strictMode===!0&&(U=!0),w.identifierPrefix!==void 0&&(W=w.identifierPrefix),w.onRecoverableError!==void 0&&(ee=w.onRecoverableError)),_=qd(_,null,p,1,w??null,U,!1,W,ee),p[yl]=_.current,El(p),O)for(p=0;p<O.length;p++)w=O[p],U=w._getVersion,U=U(w._source),_.mutableSourceEagerHydrationData==null?_.mutableSourceEagerHydrationData=[w,U]:_.mutableSourceEagerHydrationData.push(w,U);return new gm(_)},Co.render=function(p,_,w){if(!Em(_))throw Error(a(200));return Z_(null,p,_,!1,w)},Co.unmountComponentAtNode=function(p){if(!Em(p))throw Error(a(40));return p._reactRootContainer?(Bu(function(){Z_(null,null,p,!1,function(){p._reactRootContainer=null,p[yl]=null})}),!0):!1},Co.unstable_batchedUpdates=Yd,Co.unstable_renderSubtreeIntoContainer=function(p,_,w,O){if(!Em(w))throw Error(a(200));if(p==null||p._reactInternals===void 0)throw Error(a(38));return Z_(p,_,w,!1,O)},Co.version="18.3.1-next-f1338f8080-20240426",Co}var Jz;function Pq(){if(Jz)return Sx.exports;Jz=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(r){console.error(r)}}return i(),Sx.exports=rme(),Sx.exports}var $z;function ime(){if($z)return GI;$z=1;var i=Pq();return GI.createRoot=i.createRoot,GI.hydrateRoot=i.hydrateRoot,GI}var sme=ime(),G=l2();const vt=gO(G),u2=Nq({__proto__:null,default:vt},[G]),ame=1,ome=1e6;let Cx=0;function cme(){return Cx=(Cx+1)%Number.MAX_SAFE_INTEGER,Cx.toString()}const Rx=new Map,Qz=i=>{if(Rx.has(i))return;const r=setTimeout(()=>{Rx.delete(i),V0({type:"REMOVE_TOAST",toastId:i})},ome);Rx.set(i,r)},lme=(i,r)=>{switch(r.type){case"ADD_TOAST":return{...i,toasts:[r.toast,...i.toasts].slice(0,ame)};case"UPDATE_TOAST":return{...i,toasts:i.toasts.map(a=>a.id===r.toast.id?{...a,...r.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=r;return a?Qz(a):i.toasts.forEach(c=>{Qz(c.id)}),{...i,toasts:i.toasts.map(c=>c.id===a||a===void 0?{...c,open:!1}:c)}}case"REMOVE_TOAST":return r.toastId===void 0?{...i,toasts:[]}:{...i,toasts:i.toasts.filter(a=>a.id!==r.toastId)}}},cA=[];let lA={toasts:[]};function V0(i){lA=lme(lA,i),cA.forEach(r=>{r(lA)})}function ume({...i}){const r=cme(),a=l=>V0({type:"UPDATE_TOAST",toast:{...l,id:r}}),c=()=>V0({type:"DISMISS_TOAST",toastId:r});return V0({type:"ADD_TOAST",toast:{...i,id:r,open:!0,onOpenChange:l=>{l||c()}}}),{id:r,dismiss:c,update:a}}function d2(){const[i,r]=G.useState(lA);return G.useEffect(()=>(cA.push(r),()=>{const a=cA.indexOf(r);a>-1&&cA.splice(a,1)}),[i]),{...i,toast:ume,dismiss:a=>V0({type:"DISMISS_TOAST",toastId:a})}}var Ow=Pq();const h2=gO(Ow),dme=Nq({__proto__:null,default:h2},[Ow]);function vr(i,r,{checkForDefaultPrevented:a=!0}={}){return function(l){if(i?.(l),a===!1||!l.defaultPrevented)return r?.(l)}}function Zz(i,r){if(typeof i=="function")return i(r);i!=null&&(i.current=r)}function kq(...i){return r=>{let a=!1;const c=i.map(l=>{const h=Zz(l,r);return!a&&typeof h=="function"&&(a=!0),h});if(a)return()=>{for(let l=0;l<c.length;l++){const h=c[l];typeof h=="function"?h():Zz(i[l],null)}}}}function Xs(...i){return G.useCallback(kq(...i),i)}function hme(i,r){const a=G.createContext(r),c=h=>{const{children:m,...E}=h,S=G.useMemo(()=>E,Object.values(E));return D.jsx(a.Provider,{value:S,children:m})};c.displayName=i+"Provider";function l(h){const m=G.useContext(a);if(m)return m;if(r!==void 0)return r;throw new Error(`\`${h}\` must be used within \`${i}\``)}return[c,l]}function mf(i,r=[]){let a=[];function c(h,m){const E=G.createContext(m),S=a.length;a=[...a,m];const T=I=>{const{scope:N,children:P,...H}=I,x=N?.[i]?.[S]||E,B=G.useMemo(()=>H,Object.values(H));return D.jsx(x.Provider,{value:B,children:P})};T.displayName=h+"Provider";function C(I,N){const P=N?.[i]?.[S]||E,H=G.useContext(P);if(H)return H;if(m!==void 0)return m;throw new Error(`\`${I}\` must be used within \`${h}\``)}return[T,C]}const l=()=>{const h=a.map(m=>G.createContext(m));return function(E){const S=E?.[i]||h;return G.useMemo(()=>({[`__scope${i}`]:{...E,[i]:S}}),[E,S])}};return l.scopeName=i,[c,pme(l,...r)]}function pme(...i){const r=i[0];if(i.length===1)return r;const a=()=>{const c=i.map(l=>({useScope:l(),scopeName:l.scopeName}));return function(h){const m=c.reduce((E,{useScope:S,scopeName:T})=>{const I=S(h)[`__scope${T}`];return{...E,...I}},{});return G.useMemo(()=>({[`__scope${r.scopeName}`]:m}),[m])}};return a.scopeName=r.scopeName,a}function nw(i){const r=mme(i),a=G.forwardRef((c,l)=>{const{children:h,...m}=c,E=G.Children.toArray(h),S=E.find(_me);if(S){const T=S.props.children,C=E.map(I=>I===S?G.Children.count(T)>1?G.Children.only(null):G.isValidElement(T)?T.props.children:null:I);return D.jsx(r,{...m,ref:l,children:G.isValidElement(T)?G.cloneElement(T,void 0,C):null})}return D.jsx(r,{...m,ref:l,children:h})});return a.displayName=`${i}.Slot`,a}var fme=nw("Slot");function mme(i){const r=G.forwardRef((a,c)=>{const{children:l,...h}=a;if(G.isValidElement(l)){const m=yme(l),E=Eme(h,l.props);return l.type!==G.Fragment&&(E.ref=c?kq(c,m):m),G.cloneElement(l,E)}return G.Children.count(l)>1?G.Children.only(null):null});return r.displayName=`${i}.SlotClone`,r}var Dq=Symbol("radix.slottable");function gme(i){const r=({children:a})=>D.jsx(D.Fragment,{children:a});return r.displayName=`${i}.Slottable`,r.__radixId=Dq,r}function _me(i){return G.isValidElement(i)&&typeof i.type=="function"&&"__radixId"in i.type&&i.type.__radixId===Dq}function Eme(i,r){const a={...r};for(const c in r){const l=i[c],h=r[c];/^on[A-Z]/.test(c)?l&&h?a[c]=(...E)=>{const S=h(...E);return l(...E),S}:l&&(a[c]=l):c==="style"?a[c]={...l,...h}:c==="className"&&(a[c]=[l,h].filter(Boolean).join(" "))}return{...i,...a}}function yme(i){let r=Object.getOwnPropertyDescriptor(i.props,"ref")?.get,a=r&&"isReactWarning"in r&&r.isReactWarning;return a?i.ref:(r=Object.getOwnPropertyDescriptor(i,"ref")?.get,a=r&&"isReactWarning"in r&&r.isReactWarning,a?i.props.ref:i.props.ref||i.ref)}function xq(i){const r=i+"CollectionProvider",[a,c]=mf(r),[l,h]=a(r,{collectionRef:{current:null},itemMap:new Map}),m=x=>{const{scope:B,children:X}=x,Z=vt.useRef(null),$=vt.useRef(new Map).current;return D.jsx(l,{scope:B,itemMap:$,collectionRef:Z,children:X})};m.displayName=r;const E=i+"CollectionSlot",S=nw(E),T=vt.forwardRef((x,B)=>{const{scope:X,children:Z}=x,$=h(E,X),le=Xs(B,$.collectionRef);return D.jsx(S,{ref:le,children:Z})});T.displayName=E;const C=i+"CollectionItemSlot",I="data-radix-collection-item",N=nw(C),P=vt.forwardRef((x,B)=>{const{scope:X,children:Z,...$}=x,le=vt.useRef(null),re=Xs(B,le),ce=h(C,X);return vt.useEffect(()=>(ce.itemMap.set(le,{ref:le,...$}),()=>{ce.itemMap.delete(le)})),D.jsx(N,{[I]:"",ref:re,children:Z})});P.displayName=C;function H(x){const B=h(i+"CollectionConsumer",x);return vt.useCallback(()=>{const Z=B.collectionRef.current;if(!Z)return[];const $=Array.from(Z.querySelectorAll(`[${I}]`));return Array.from(B.itemMap.values()).sort((ce,te)=>$.indexOf(ce.ref.current)-$.indexOf(te.ref.current))},[B.collectionRef,B.itemMap])}return[{Provider:m,Slot:T,ItemSlot:P},H,c]}var vme=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],ri=vme.reduce((i,r)=>{const a=nw(`Primitive.${r}`),c=G.forwardRef((l,h)=>{const{asChild:m,...E}=l,S=m?a:r;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),D.jsx(S,{...E,ref:h})});return c.displayName=`Primitive.${r}`,{...i,[r]:c}},{});function Lq(i,r){i&&Ow.flushSync(()=>i.dispatchEvent(r))}function lu(i){const r=G.useRef(i);return G.useEffect(()=>{r.current=i}),G.useMemo(()=>(...a)=>r.current?.(...a),[])}function Sme(i,r=globalThis?.document){const a=lu(i);G.useEffect(()=>{const c=l=>{l.key==="Escape"&&a(l)};return r.addEventListener("keydown",c,{capture:!0}),()=>r.removeEventListener("keydown",c,{capture:!0})},[a,r])}var Tme="DismissableLayer",ML="dismissableLayer.update",wme="dismissableLayer.pointerDownOutside",Cme="dismissableLayer.focusOutside",eK,Mq=G.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),_O=G.forwardRef((i,r)=>{const{disableOutsidePointerEvents:a=!1,onEscapeKeyDown:c,onPointerDownOutside:l,onFocusOutside:h,onInteractOutside:m,onDismiss:E,...S}=i,T=G.useContext(Mq),[C,I]=G.useState(null),N=C?.ownerDocument??globalThis?.document,[,P]=G.useState({}),H=Xs(r,te=>I(te)),x=Array.from(T.layers),[B]=[...T.layersWithOutsidePointerEventsDisabled].slice(-1),X=x.indexOf(B),Z=C?x.indexOf(C):-1,$=T.layersWithOutsidePointerEventsDisabled.size>0,le=Z>=X,re=bme(te=>{const pe=te.target,Ee=[...T.branches].some(Ne=>Ne.contains(pe));!le||Ee||(l?.(te),m?.(te),te.defaultPrevented||E?.())},N),ce=Ime(te=>{const pe=te.target;[...T.branches].some(Ne=>Ne.contains(pe))||(h?.(te),m?.(te),te.defaultPrevented||E?.())},N);return Sme(te=>{Z===T.layers.size-1&&(c?.(te),!te.defaultPrevented&&E&&(te.preventDefault(),E()))},N),G.useEffect(()=>{if(C)return a&&(T.layersWithOutsidePointerEventsDisabled.size===0&&(eK=N.body.style.pointerEvents,N.body.style.pointerEvents="none"),T.layersWithOutsidePointerEventsDisabled.add(C)),T.layers.add(C),tK(),()=>{a&&T.layersWithOutsidePointerEventsDisabled.size===1&&(N.body.style.pointerEvents=eK)}},[C,N,a,T]),G.useEffect(()=>()=>{C&&(T.layers.delete(C),T.layersWithOutsidePointerEventsDisabled.delete(C),tK())},[C,T]),G.useEffect(()=>{const te=()=>P({});return document.addEventListener(ML,te),()=>document.removeEventListener(ML,te)},[]),D.jsx(ri.div,{...S,ref:H,style:{pointerEvents:$?le?"auto":"none":void 0,...i.style},onFocusCapture:vr(i.onFocusCapture,ce.onFocusCapture),onBlurCapture:vr(i.onBlurCapture,ce.onBlurCapture),onPointerDownCapture:vr(i.onPointerDownCapture,re.onPointerDownCapture)})});_O.displayName=Tme;var Rme="DismissableLayerBranch",Uq=G.forwardRef((i,r)=>{const a=G.useContext(Mq),c=G.useRef(null),l=Xs(r,c);return G.useEffect(()=>{const h=c.current;if(h)return a.branches.add(h),()=>{a.branches.delete(h)}},[a.branches]),D.jsx(ri.div,{...i,ref:l})});Uq.displayName=Rme;function bme(i,r=globalThis?.document){const a=lu(i),c=G.useRef(!1),l=G.useRef(()=>{});return G.useEffect(()=>{const h=E=>{if(E.target&&!c.current){let S=function(){Vq(wme,a,T,{discrete:!0})};const T={originalEvent:E};E.pointerType==="touch"?(r.removeEventListener("click",l.current),l.current=S,r.addEventListener("click",l.current,{once:!0})):S()}else r.removeEventListener("click",l.current);c.current=!1},m=window.setTimeout(()=>{r.addEventListener("pointerdown",h)},0);return()=>{window.clearTimeout(m),r.removeEventListener("pointerdown",h),r.removeEventListener("click",l.current)}},[r,a]),{onPointerDownCapture:()=>c.current=!0}}function Ime(i,r=globalThis?.document){const a=lu(i),c=G.useRef(!1);return G.useEffect(()=>{const l=h=>{h.target&&!c.current&&Vq(Cme,a,{originalEvent:h},{discrete:!1})};return r.addEventListener("focusin",l),()=>r.removeEventListener("focusin",l)},[r,a]),{onFocusCapture:()=>c.current=!0,onBlurCapture:()=>c.current=!1}}function tK(){const i=new CustomEvent(ML);document.dispatchEvent(i)}function Vq(i,r,a,{discrete:c}){const l=a.originalEvent.target,h=new CustomEvent(i,{bubbles:!1,cancelable:!0,detail:a});r&&l.addEventListener(i,r,{once:!0}),c?Lq(l,h):l.dispatchEvent(h)}var Ame=_O,Ome=Uq,gh=globalThis?.document?G.useLayoutEffect:()=>{},Nme="Portal",p2=G.forwardRef((i,r)=>{const{container:a,...c}=i,[l,h]=G.useState(!1);gh(()=>h(!0),[]);const m=a||l&&globalThis?.document?.body;return m?h2.createPortal(D.jsx(ri.div,{...c,ref:r}),m):null});p2.displayName=Nme;function Pme(i,r){return G.useReducer((a,c)=>r[a][c]??a,i)}var Fg=i=>{const{present:r,children:a}=i,c=kme(r),l=typeof a=="function"?a({present:c.isPresent}):G.Children.only(a),h=Xs(c.ref,Dme(l));return typeof a=="function"||c.isPresent?G.cloneElement(l,{ref:h}):null};Fg.displayName="Presence";function kme(i){const[r,a]=G.useState(),c=G.useRef(null),l=G.useRef(i),h=G.useRef("none"),m=i?"mounted":"unmounted",[E,S]=Pme(m,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return G.useEffect(()=>{const T=HI(c.current);h.current=E==="mounted"?T:"none"},[E]),gh(()=>{const T=c.current,C=l.current;if(C!==i){const N=h.current,P=HI(T);i?S("MOUNT"):P==="none"||T?.display==="none"?S("UNMOUNT"):S(C&&N!==P?"ANIMATION_OUT":"UNMOUNT"),l.current=i}},[i,S]),gh(()=>{if(r){let T;const C=r.ownerDocument.defaultView??window,I=P=>{const x=HI(c.current).includes(P.animationName);if(P.target===r&&x&&(S("ANIMATION_END"),!l.current)){const B=r.style.animationFillMode;r.style.animationFillMode="forwards",T=C.setTimeout(()=>{r.style.animationFillMode==="forwards"&&(r.style.animationFillMode=B)})}},N=P=>{P.target===r&&(h.current=HI(c.current))};return r.addEventListener("animationstart",N),r.addEventListener("animationcancel",I),r.addEventListener("animationend",I),()=>{C.clearTimeout(T),r.removeEventListener("animationstart",N),r.removeEventListener("animationcancel",I),r.removeEventListener("animationend",I)}}else S("ANIMATION_END")},[r,S]),{isPresent:["mounted","unmountSuspended"].includes(E),ref:G.useCallback(T=>{c.current=T?getComputedStyle(T):null,a(T)},[])}}function HI(i){return i?.animationName||"none"}function Dme(i){let r=Object.getOwnPropertyDescriptor(i.props,"ref")?.get,a=r&&"isReactWarning"in r&&r.isReactWarning;return a?i.ref:(r=Object.getOwnPropertyDescriptor(i,"ref")?.get,a=r&&"isReactWarning"in r&&r.isReactWarning,a?i.props.ref:i.props.ref||i.ref)}var xme=u2[" useInsertionEffect ".trim().toString()]||gh;function Nw({prop:i,defaultProp:r,onChange:a=()=>{},caller:c}){const[l,h,m]=Lme({defaultProp:r,onChange:a}),E=i!==void 0,S=E?i:l;{const C=G.useRef(i!==void 0);G.useEffect(()=>{const I=C.current;I!==E&&console.warn(`${c} is changing from ${I?"controlled":"uncontrolled"} to ${E?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),C.current=E},[E,c])}const T=G.useCallback(C=>{if(E){const I=Mme(C)?C(i):C;I!==i&&m.current?.(I)}else h(C)},[E,i,h,m]);return[S,T]}function Lme({defaultProp:i,onChange:r}){const[a,c]=G.useState(i),l=G.useRef(a),h=G.useRef(r);return xme(()=>{h.current=r},[r]),G.useEffect(()=>{l.current!==a&&(h.current?.(a),l.current=a)},[a,l]),[a,c,h]}function Mme(i){return typeof i=="function"}var Ume=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Vme="VisuallyHidden",EO=G.forwardRef((i,r)=>D.jsx(ri.span,{...i,ref:r,style:{...Ume,...i.style}}));EO.displayName=Vme;var Fme=EO,f2="ToastProvider",[m2,jme,Bme]=xq("Toast"),[Fq]=mf("Toast",[Bme]),[Wme,yO]=Fq(f2),jq=i=>{const{__scopeToast:r,label:a="Notification",duration:c=5e3,swipeDirection:l="right",swipeThreshold:h=50,children:m}=i,[E,S]=G.useState(null),[T,C]=G.useState(0),I=G.useRef(!1),N=G.useRef(!1);return a.trim()||console.error(`Invalid prop \`label\` supplied to \`${f2}\`. Expected non-empty \`string\`.`),D.jsx(m2.Provider,{scope:r,children:D.jsx(Wme,{scope:r,label:a,duration:c,swipeDirection:l,swipeThreshold:h,toastCount:T,viewport:E,onViewportChange:S,onToastAdd:G.useCallback(()=>C(P=>P+1),[]),onToastRemove:G.useCallback(()=>C(P=>P-1),[]),isFocusedToastEscapeKeyDownRef:I,isClosePausedRef:N,children:m})})};jq.displayName=f2;var Bq="ToastViewport",Gme=["F8"],UL="toast.viewportPause",VL="toast.viewportResume",Wq=G.forwardRef((i,r)=>{const{__scopeToast:a,hotkey:c=Gme,label:l="Notifications ({hotkey})",...h}=i,m=yO(Bq,a),E=jme(a),S=G.useRef(null),T=G.useRef(null),C=G.useRef(null),I=G.useRef(null),N=Xs(r,I,m.onViewportChange),P=c.join("+").replace(/Key/g,"").replace(/Digit/g,""),H=m.toastCount>0;G.useEffect(()=>{const B=X=>{c.length!==0&&c.every($=>X[$]||X.code===$)&&I.current?.focus()};return document.addEventListener("keydown",B),()=>document.removeEventListener("keydown",B)},[c]),G.useEffect(()=>{const B=S.current,X=I.current;if(H&&B&&X){const Z=()=>{if(!m.isClosePausedRef.current){const ce=new CustomEvent(UL);X.dispatchEvent(ce),m.isClosePausedRef.current=!0}},$=()=>{if(m.isClosePausedRef.current){const ce=new CustomEvent(VL);X.dispatchEvent(ce),m.isClosePausedRef.current=!1}},le=ce=>{!B.contains(ce.relatedTarget)&&$()},re=()=>{B.contains(document.activeElement)||$()};return B.addEventListener("focusin",Z),B.addEventListener("focusout",le),B.addEventListener("pointermove",Z),B.addEventListener("pointerleave",re),window.addEventListener("blur",Z),window.addEventListener("focus",$),()=>{B.removeEventListener("focusin",Z),B.removeEventListener("focusout",le),B.removeEventListener("pointermove",Z),B.removeEventListener("pointerleave",re),window.removeEventListener("blur",Z),window.removeEventListener("focus",$)}}},[H,m.isClosePausedRef]);const x=G.useCallback(({tabbingDirection:B})=>{const Z=E().map($=>{const le=$.ref.current,re=[le,...nge(le)];return B==="forwards"?re:re.reverse()});return(B==="forwards"?Z.reverse():Z).flat()},[E]);return G.useEffect(()=>{const B=I.current;if(B){const X=Z=>{const $=Z.altKey||Z.ctrlKey||Z.metaKey;if(Z.key==="Tab"&&!$){const re=document.activeElement,ce=Z.shiftKey;if(Z.target===B&&ce){T.current?.focus();return}const Ee=x({tabbingDirection:ce?"backwards":"forwards"}),Ne=Ee.findIndex(Ue=>Ue===re);bx(Ee.slice(Ne+1))?Z.preventDefault():ce?T.current?.focus():C.current?.focus()}};return B.addEventListener("keydown",X),()=>B.removeEventListener("keydown",X)}},[E,x]),D.jsxs(Ome,{ref:S,role:"region","aria-label":l.replace("{hotkey}",P),tabIndex:-1,style:{pointerEvents:H?void 0:"none"},children:[H&&D.jsx(FL,{ref:T,onFocusFromOutsideViewport:()=>{const B=x({tabbingDirection:"forwards"});bx(B)}}),D.jsx(m2.Slot,{scope:a,children:D.jsx(ri.ol,{tabIndex:-1,...h,ref:N})}),H&&D.jsx(FL,{ref:C,onFocusFromOutsideViewport:()=>{const B=x({tabbingDirection:"backwards"});bx(B)}})]})});Wq.displayName=Bq;var Gq="ToastFocusProxy",FL=G.forwardRef((i,r)=>{const{__scopeToast:a,onFocusFromOutsideViewport:c,...l}=i,h=yO(Gq,a);return D.jsx(EO,{"aria-hidden":!0,tabIndex:0,...l,ref:r,style:{position:"fixed"},onFocus:m=>{const E=m.relatedTarget;!h.viewport?.contains(E)&&c()}})});FL.displayName=Gq;var Pw="Toast",Hme="toast.swipeStart",zme="toast.swipeMove",Kme="toast.swipeCancel",Yme="toast.swipeEnd",Hq=G.forwardRef((i,r)=>{const{forceMount:a,open:c,defaultOpen:l,onOpenChange:h,...m}=i,[E,S]=Nw({prop:c,defaultProp:l??!0,onChange:h,caller:Pw});return D.jsx(Fg,{present:a||E,children:D.jsx(Jme,{open:E,...m,ref:r,onClose:()=>S(!1),onPause:lu(i.onPause),onResume:lu(i.onResume),onSwipeStart:vr(i.onSwipeStart,T=>{T.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:vr(i.onSwipeMove,T=>{const{x:C,y:I}=T.detail.delta;T.currentTarget.setAttribute("data-swipe","move"),T.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${C}px`),T.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${I}px`)}),onSwipeCancel:vr(i.onSwipeCancel,T=>{T.currentTarget.setAttribute("data-swipe","cancel"),T.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),T.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),T.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),T.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:vr(i.onSwipeEnd,T=>{const{x:C,y:I}=T.detail.delta;T.currentTarget.setAttribute("data-swipe","end"),T.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),T.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),T.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${C}px`),T.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${I}px`),S(!1)})})})});Hq.displayName=Pw;var[qme,Xme]=Fq(Pw,{onClose(){}}),Jme=G.forwardRef((i,r)=>{const{__scopeToast:a,type:c="foreground",duration:l,open:h,onClose:m,onEscapeKeyDown:E,onPause:S,onResume:T,onSwipeStart:C,onSwipeMove:I,onSwipeCancel:N,onSwipeEnd:P,...H}=i,x=yO(Pw,a),[B,X]=G.useState(null),Z=Xs(r,Re=>X(Re)),$=G.useRef(null),le=G.useRef(null),re=l||x.duration,ce=G.useRef(0),te=G.useRef(re),pe=G.useRef(0),{onToastAdd:Ee,onToastRemove:Ne}=x,Ue=lu(()=>{B?.contains(document.activeElement)&&x.viewport?.focus(),m()}),Se=G.useCallback(Re=>{!Re||Re===1/0||(window.clearTimeout(pe.current),ce.current=new Date().getTime(),pe.current=window.setTimeout(Ue,Re))},[Ue]);G.useEffect(()=>{const Re=x.viewport;if(Re){const Be=()=>{Se(te.current),T?.()},$e=()=>{const Ge=new Date().getTime()-ce.current;te.current=te.current-Ge,window.clearTimeout(pe.current),S?.()};return Re.addEventListener(UL,$e),Re.addEventListener(VL,Be),()=>{Re.removeEventListener(UL,$e),Re.removeEventListener(VL,Be)}}},[x.viewport,re,S,T,Se]),G.useEffect(()=>{h&&!x.isClosePausedRef.current&&Se(re)},[h,re,x.isClosePausedRef,Se]),G.useEffect(()=>(Ee(),()=>Ne()),[Ee,Ne]);const Xe=G.useMemo(()=>B?$q(B):null,[B]);return x.viewport?D.jsxs(D.Fragment,{children:[Xe&&D.jsx($me,{__scopeToast:a,role:"status","aria-live":c==="foreground"?"assertive":"polite","aria-atomic":!0,children:Xe}),D.jsx(qme,{scope:a,onClose:Ue,children:Ow.createPortal(D.jsx(m2.ItemSlot,{scope:a,children:D.jsx(Ame,{asChild:!0,onEscapeKeyDown:vr(E,()=>{x.isFocusedToastEscapeKeyDownRef.current||Ue(),x.isFocusedToastEscapeKeyDownRef.current=!1}),children:D.jsx(ri.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":h?"open":"closed","data-swipe-direction":x.swipeDirection,...H,ref:Z,style:{userSelect:"none",touchAction:"none",...i.style},onKeyDown:vr(i.onKeyDown,Re=>{Re.key==="Escape"&&(E?.(Re.nativeEvent),Re.nativeEvent.defaultPrevented||(x.isFocusedToastEscapeKeyDownRef.current=!0,Ue()))}),onPointerDown:vr(i.onPointerDown,Re=>{Re.button===0&&($.current={x:Re.clientX,y:Re.clientY})}),onPointerMove:vr(i.onPointerMove,Re=>{if(!$.current)return;const Be=Re.clientX-$.current.x,$e=Re.clientY-$.current.y,Ge=!!le.current,Ie=["left","right"].includes(x.swipeDirection),Ke=["left","up"].includes(x.swipeDirection)?Math.min:Math.max,ae=Ie?Ke(0,Be):0,ge=Ie?0:Ke(0,$e),Pe=Re.pointerType==="touch"?10:2,ue={x:ae,y:ge},it={originalEvent:Re,delta:ue};Ge?(le.current=ue,zI(zme,I,it,{discrete:!1})):nK(ue,x.swipeDirection,Pe)?(le.current=ue,zI(Hme,C,it,{discrete:!1}),Re.target.setPointerCapture(Re.pointerId)):(Math.abs(Be)>Pe||Math.abs($e)>Pe)&&($.current=null)}),onPointerUp:vr(i.onPointerUp,Re=>{const Be=le.current,$e=Re.target;if($e.hasPointerCapture(Re.pointerId)&&$e.releasePointerCapture(Re.pointerId),le.current=null,$.current=null,Be){const Ge=Re.currentTarget,Ie={originalEvent:Re,delta:Be};nK(Be,x.swipeDirection,x.swipeThreshold)?zI(Yme,P,Ie,{discrete:!0}):zI(Kme,N,Ie,{discrete:!0}),Ge.addEventListener("click",Ke=>Ke.preventDefault(),{once:!0})}})})})}),x.viewport)})]}):null}),$me=i=>{const{__scopeToast:r,children:a,...c}=i,l=yO(Pw,r),[h,m]=G.useState(!1),[E,S]=G.useState(!1);return ege(()=>m(!0)),G.useEffect(()=>{const T=window.setTimeout(()=>S(!0),1e3);return()=>window.clearTimeout(T)},[]),E?null:D.jsx(p2,{asChild:!0,children:D.jsx(EO,{...c,children:h&&D.jsxs(D.Fragment,{children:[l.label," ",a]})})})},Qme="ToastTitle",zq=G.forwardRef((i,r)=>{const{__scopeToast:a,...c}=i;return D.jsx(ri.div,{...c,ref:r})});zq.displayName=Qme;var Zme="ToastDescription",Kq=G.forwardRef((i,r)=>{const{__scopeToast:a,...c}=i;return D.jsx(ri.div,{...c,ref:r})});Kq.displayName=Zme;var Yq="ToastAction",qq=G.forwardRef((i,r)=>{const{altText:a,...c}=i;return a.trim()?D.jsx(Jq,{altText:a,asChild:!0,children:D.jsx(g2,{...c,ref:r})}):(console.error(`Invalid prop \`altText\` supplied to \`${Yq}\`. Expected non-empty \`string\`.`),null)});qq.displayName=Yq;var Xq="ToastClose",g2=G.forwardRef((i,r)=>{const{__scopeToast:a,...c}=i,l=Xme(Xq,a);return D.jsx(Jq,{asChild:!0,children:D.jsx(ri.button,{type:"button",...c,ref:r,onClick:vr(i.onClick,l.onClose)})})});g2.displayName=Xq;var Jq=G.forwardRef((i,r)=>{const{__scopeToast:a,altText:c,...l}=i;return D.jsx(ri.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":c||void 0,...l,ref:r})});function $q(i){const r=[];return Array.from(i.childNodes).forEach(c=>{if(c.nodeType===c.TEXT_NODE&&c.textContent&&r.push(c.textContent),tge(c)){const l=c.ariaHidden||c.hidden||c.style.display==="none",h=c.dataset.radixToastAnnounceExclude==="";if(!l)if(h){const m=c.dataset.radixToastAnnounceAlt;m&&r.push(m)}else r.push(...$q(c))}}),r}function zI(i,r,a,{discrete:c}){const l=a.originalEvent.currentTarget,h=new CustomEvent(i,{bubbles:!0,cancelable:!0,detail:a});r&&l.addEventListener(i,r,{once:!0}),c?Lq(l,h):l.dispatchEvent(h)}var nK=(i,r,a=0)=>{const c=Math.abs(i.x),l=Math.abs(i.y),h=c>l;return r==="left"||r==="right"?h&&c>a:!h&&l>a};function ege(i=()=>{}){const r=lu(i);gh(()=>{let a=0,c=0;return a=window.requestAnimationFrame(()=>c=window.requestAnimationFrame(r)),()=>{window.cancelAnimationFrame(a),window.cancelAnimationFrame(c)}},[r])}function tge(i){return i.nodeType===i.ELEMENT_NODE}function nge(i){const r=[],a=document.createTreeWalker(i,NodeFilter.SHOW_ELEMENT,{acceptNode:c=>{const l=c.tagName==="INPUT"&&c.type==="hidden";return c.disabled||c.hidden||l?NodeFilter.FILTER_SKIP:c.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;a.nextNode();)r.push(a.currentNode);return r}function bx(i){const r=document.activeElement;return i.some(a=>a===r?!0:(a.focus(),document.activeElement!==r))}var rge=jq,Qq=Wq,Zq=Hq,eX=zq,tX=Kq,nX=qq,rX=g2;function iX(i){var r,a,c="";if(typeof i=="string"||typeof i=="number")c+=i;else if(typeof i=="object")if(Array.isArray(i)){var l=i.length;for(r=0;r<l;r++)i[r]&&(a=iX(i[r]))&&(c&&(c+=" "),c+=a)}else for(a in i)i[a]&&(c&&(c+=" "),c+=a);return c}function sX(){for(var i,r,a=0,c="",l=arguments.length;a<l;a++)(i=arguments[a])&&(r=iX(i))&&(c&&(c+=" "),c+=r);return c}const rK=i=>typeof i=="boolean"?`${i}`:i===0?"0":i,iK=sX,_2=(i,r)=>a=>{var c;if(r?.variants==null)return iK(i,a?.class,a?.className);const{variants:l,defaultVariants:h}=r,m=Object.keys(l).map(T=>{const C=a?.[T],I=h?.[T];if(C===null)return null;const N=rK(C)||rK(I);return l[T][N]}),E=a&&Object.entries(a).reduce((T,C)=>{let[I,N]=C;return N===void 0||(T[I]=N),T},{}),S=r==null||(c=r.compoundVariants)===null||c===void 0?void 0:c.reduce((T,C)=>{let{class:I,className:N,...P}=C;return Object.entries(P).every(H=>{let[x,B]=H;return Array.isArray(B)?B.includes({...h,...E}[x]):{...h,...E}[x]===B})?[...T,I,N]:T},[]);return iK(i,m,S,a?.class,a?.className)};const ige=i=>i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),aX=(...i)=>i.filter((r,a,c)=>!!r&&r.trim()!==""&&c.indexOf(r)===a).join(" ").trim();var sge={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const age=G.forwardRef(({color:i="currentColor",size:r=24,strokeWidth:a=2,absoluteStrokeWidth:c,className:l="",children:h,iconNode:m,...E},S)=>G.createElement("svg",{ref:S,...sge,width:r,height:r,stroke:i,strokeWidth:c?Number(a)*24/Number(r):a,className:aX("lucide",l),...E},[...m.map(([T,C])=>G.createElement(T,C)),...Array.isArray(h)?h:[h]]));const zt=(i,r)=>{const a=G.forwardRef(({className:c,...l},h)=>G.createElement(age,{ref:h,iconNode:r,className:aX(`lucide-${ige(i)}`,c),...l}));return a.displayName=`${i}`,a};const oge=zt("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const cge=zt("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);const lge=zt("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);const uge=zt("BookHeart",[["path",{d:"M16 8.2A2.22 2.22 0 0 0 13.8 6c-.8 0-1.4.3-1.8.9-.4-.6-1-.9-1.8-.9A2.22 2.22 0 0 0 8 8.2c0 .6.3 1.2.7 1.6A226.652 226.652 0 0 0 12 13a404 404 0 0 0 3.3-3.1 2.413 2.413 0 0 0 .7-1.7",key:"1t75a8"}],["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]);const NA=zt("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);const Ay=zt("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);const E2=zt("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]);const dge=zt("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);const hge=zt("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);const uA=zt("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);const oX=zt("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const pge=zt("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]);const fge=zt("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);const rw=zt("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);const sK=zt("Coffee",[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]]);const mge=zt("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);const aK=zt("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);const gge=zt("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const oK=zt("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);const _ge=zt("Github",[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]]);const vO=zt("GraduationCap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]);const Ege=zt("HandCoins",[["path",{d:"M11 15h2a2 2 0 1 0 0-4h-3c-.6 0-1.1.2-1.4.6L3 17",key:"geh8rc"}],["path",{d:"m7 21 1.6-1.4c.3-.4.8-.6 1.4-.6h4c1.1 0 2.1-.4 2.8-1.2l4.6-4.4a2 2 0 0 0-2.75-2.91l-4.2 3.9",key:"1fto5m"}],["path",{d:"m2 16 6 6",key:"1pfhp9"}],["circle",{cx:"16",cy:"9",r:"2.9",key:"1n0dlu"}],["circle",{cx:"6",cy:"5",r:"3",key:"151irh"}]]);const yge=zt("HandHeart",[["path",{d:"M11 14h2a2 2 0 1 0 0-4h-3c-.6 0-1.1.2-1.4.6L3 16",key:"1ifwr1"}],["path",{d:"m7 20 1.6-1.4c.3-.4.8-.6 1.4-.6h4c1.1 0 2.1-.4 2.8-1.2l4.6-4.4a2 2 0 0 0-2.75-2.91l-4.2 3.9",key:"17abbs"}],["path",{d:"m2 15 6 6",key:"10dquu"}],["path",{d:"M19.5 8.5c.7-.7 1.5-1.6 1.5-2.7A2.73 2.73 0 0 0 16 4a2.78 2.78 0 0 0-5 1.8c0 1.2.8 2 1.5 2.8L16 12Z",key:"1h3036"}]]);const cX=zt("HeartHandshake",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}],["path",{d:"M12 5 9.04 7.96a2.17 2.17 0 0 0 0 3.08c.82.82 2.13.85 3 .07l2.07-1.9a2.82 2.82 0 0 1 3.79 0l2.96 2.66",key:"4oyue0"}],["path",{d:"m18 15-2-2",key:"60u0ii"}],["path",{d:"m15 18-2-2",key:"6p76be"}]]);const jL=zt("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);const vge=zt("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);const Sge=zt("Instagram",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]]);const lX=zt("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);const Tge=zt("Linkedin",[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]]);const Oy=zt("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);const cK=zt("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);const wge=zt("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);const Cge=zt("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);const Rge=zt("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);const BL=zt("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);const WL=zt("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);const bge=zt("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);const uX=zt("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);const dX=zt("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);const hX=zt("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);const pX=zt("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);const lK=zt("MonitorUp",[["path",{d:"m9 10 3-3 3 3",key:"11gsxs"}],["path",{d:"M12 13V7",key:"h0r20n"}],["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["path",{d:"M12 17v4",key:"1riwvh"}],["path",{d:"M8 21h8",key:"1ev6f3"}]]);const Ige=zt("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);const Age=zt("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);const Oge=zt("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]);const Nge=zt("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);const fX=zt("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);const uK=zt("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);const Pge=zt("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);const mX=zt("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);const gX=zt("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const dK=zt("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);const kge=zt("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);const _X=zt("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);const Dge=zt("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);const hK=zt("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);const xge=zt("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]);const Lge=zt("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);const Mge=zt("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);const SO=zt("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);const kw=zt("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);const EX=zt("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);const PA=zt("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);const TO=zt("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),y2="-",Uge=i=>{const r=Fge(i),{conflictingClassGroups:a,conflictingClassGroupModifiers:c}=i;return{getClassGroupId:m=>{const E=m.split(y2);return E[0]===""&&E.length!==1&&E.shift(),yX(E,r)||Vge(m)},getConflictingClassGroupIds:(m,E)=>{const S=a[m]||[];return E&&c[m]?[...S,...c[m]]:S}}},yX=(i,r)=>{if(i.length===0)return r.classGroupId;const a=i[0],c=r.nextPart.get(a),l=c?yX(i.slice(1),c):void 0;if(l)return l;if(r.validators.length===0)return;const h=i.join(y2);return r.validators.find(({validator:m})=>m(h))?.classGroupId},pK=/^\[(.+)\]$/,Vge=i=>{if(pK.test(i)){const r=pK.exec(i)[1],a=r?.substring(0,r.indexOf(":"));if(a)return"arbitrary.."+a}},Fge=i=>{const{theme:r,prefix:a}=i,c={nextPart:new Map,validators:[]};return Bge(Object.entries(i.classGroups),a).forEach(([h,m])=>{GL(m,c,h,r)}),c},GL=(i,r,a,c)=>{i.forEach(l=>{if(typeof l=="string"){const h=l===""?r:fK(r,l);h.classGroupId=a;return}if(typeof l=="function"){if(jge(l)){GL(l(c),r,a,c);return}r.validators.push({validator:l,classGroupId:a});return}Object.entries(l).forEach(([h,m])=>{GL(m,fK(r,h),a,c)})})},fK=(i,r)=>{let a=i;return r.split(y2).forEach(c=>{a.nextPart.has(c)||a.nextPart.set(c,{nextPart:new Map,validators:[]}),a=a.nextPart.get(c)}),a},jge=i=>i.isThemeGetter,Bge=(i,r)=>r?i.map(([a,c])=>{const l=c.map(h=>typeof h=="string"?r+h:typeof h=="object"?Object.fromEntries(Object.entries(h).map(([m,E])=>[r+m,E])):h);return[a,l]}):i,Wge=i=>{if(i<1)return{get:()=>{},set:()=>{}};let r=0,a=new Map,c=new Map;const l=(h,m)=>{a.set(h,m),r++,r>i&&(r=0,c=a,a=new Map)};return{get(h){let m=a.get(h);if(m!==void 0)return m;if((m=c.get(h))!==void 0)return l(h,m),m},set(h,m){a.has(h)?a.set(h,m):l(h,m)}}},vX="!",Gge=i=>{const{separator:r,experimentalParseClassName:a}=i,c=r.length===1,l=r[0],h=r.length,m=E=>{const S=[];let T=0,C=0,I;for(let B=0;B<E.length;B++){let X=E[B];if(T===0){if(X===l&&(c||E.slice(B,B+h)===r)){S.push(E.slice(C,B)),C=B+h;continue}if(X==="/"){I=B;continue}}X==="["?T++:X==="]"&&T--}const N=S.length===0?E:E.substring(C),P=N.startsWith(vX),H=P?N.substring(1):N,x=I&&I>C?I-C:void 0;return{modifiers:S,hasImportantModifier:P,baseClassName:H,maybePostfixModifierPosition:x}};return a?E=>a({className:E,parseClassName:m}):m},Hge=i=>{if(i.length<=1)return i;const r=[];let a=[];return i.forEach(c=>{c[0]==="["?(r.push(...a.sort(),c),a=[]):a.push(c)}),r.push(...a.sort()),r},zge=i=>({cache:Wge(i.cacheSize),parseClassName:Gge(i),...Uge(i)}),Kge=/\s+/,Yge=(i,r)=>{const{parseClassName:a,getClassGroupId:c,getConflictingClassGroupIds:l}=r,h=[],m=i.trim().split(Kge);let E="";for(let S=m.length-1;S>=0;S-=1){const T=m[S],{modifiers:C,hasImportantModifier:I,baseClassName:N,maybePostfixModifierPosition:P}=a(T);let H=!!P,x=c(H?N.substring(0,P):N);if(!x){if(!H){E=T+(E.length>0?" "+E:E);continue}if(x=c(N),!x){E=T+(E.length>0?" "+E:E);continue}H=!1}const B=Hge(C).join(":"),X=I?B+vX:B,Z=X+x;if(h.includes(Z))continue;h.push(Z);const $=l(x,H);for(let le=0;le<$.length;++le){const re=$[le];h.push(X+re)}E=T+(E.length>0?" "+E:E)}return E};function qge(){let i=0,r,a,c="";for(;i<arguments.length;)(r=arguments[i++])&&(a=SX(r))&&(c&&(c+=" "),c+=a);return c}const SX=i=>{if(typeof i=="string")return i;let r,a="";for(let c=0;c<i.length;c++)i[c]&&(r=SX(i[c]))&&(a&&(a+=" "),a+=r);return a};function Xge(i,...r){let a,c,l,h=m;function m(S){const T=r.reduce((C,I)=>I(C),i());return a=zge(T),c=a.cache.get,l=a.cache.set,h=E,E(S)}function E(S){const T=c(S);if(T)return T;const C=Yge(S,a);return l(S,C),C}return function(){return h(qge.apply(null,arguments))}}const Oi=i=>{const r=a=>a[i]||[];return r.isThemeGetter=!0,r},TX=/^\[(?:([a-z-]+):)?(.+)\]$/i,Jge=/^\d+\/\d+$/,$ge=new Set(["px","full","screen"]),Qge=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Zge=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,e_e=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,t_e=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,n_e=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,lh=i=>Ny(i)||$ge.has(i)||Jge.test(i),Up=i=>iv(i,"length",u_e),Ny=i=>!!i&&!Number.isNaN(Number(i)),Ix=i=>iv(i,"number",Ny),_0=i=>!!i&&Number.isInteger(Number(i)),r_e=i=>i.endsWith("%")&&Ny(i.slice(0,-1)),Hn=i=>TX.test(i),Vp=i=>Qge.test(i),i_e=new Set(["length","size","percentage"]),s_e=i=>iv(i,i_e,wX),a_e=i=>iv(i,"position",wX),o_e=new Set(["image","url"]),c_e=i=>iv(i,o_e,h_e),l_e=i=>iv(i,"",d_e),E0=()=>!0,iv=(i,r,a)=>{const c=TX.exec(i);return c?c[1]?typeof r=="string"?c[1]===r:r.has(c[1]):a(c[2]):!1},u_e=i=>Zge.test(i)&&!e_e.test(i),wX=()=>!1,d_e=i=>t_e.test(i),h_e=i=>n_e.test(i),p_e=()=>{const i=Oi("colors"),r=Oi("spacing"),a=Oi("blur"),c=Oi("brightness"),l=Oi("borderColor"),h=Oi("borderRadius"),m=Oi("borderSpacing"),E=Oi("borderWidth"),S=Oi("contrast"),T=Oi("grayscale"),C=Oi("hueRotate"),I=Oi("invert"),N=Oi("gap"),P=Oi("gradientColorStops"),H=Oi("gradientColorStopPositions"),x=Oi("inset"),B=Oi("margin"),X=Oi("opacity"),Z=Oi("padding"),$=Oi("saturate"),le=Oi("scale"),re=Oi("sepia"),ce=Oi("skew"),te=Oi("space"),pe=Oi("translate"),Ee=()=>["auto","contain","none"],Ne=()=>["auto","hidden","clip","visible","scroll"],Ue=()=>["auto",Hn,r],Se=()=>[Hn,r],Xe=()=>["",lh,Up],Re=()=>["auto",Ny,Hn],Be=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],$e=()=>["solid","dashed","dotted","double","none"],Ge=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Ie=()=>["start","end","center","between","around","evenly","stretch"],Ke=()=>["","0",Hn],ae=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ge=()=>[Ny,Hn];return{cacheSize:500,separator:":",theme:{colors:[E0],spacing:[lh,Up],blur:["none","",Vp,Hn],brightness:ge(),borderColor:[i],borderRadius:["none","","full",Vp,Hn],borderSpacing:Se(),borderWidth:Xe(),contrast:ge(),grayscale:Ke(),hueRotate:ge(),invert:Ke(),gap:Se(),gradientColorStops:[i],gradientColorStopPositions:[r_e,Up],inset:Ue(),margin:Ue(),opacity:ge(),padding:Se(),saturate:ge(),scale:ge(),sepia:Ke(),skew:ge(),space:Se(),translate:Se()},classGroups:{aspect:[{aspect:["auto","square","video",Hn]}],container:["container"],columns:[{columns:[Vp]}],"break-after":[{"break-after":ae()}],"break-before":[{"break-before":ae()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Be(),Hn]}],overflow:[{overflow:Ne()}],"overflow-x":[{"overflow-x":Ne()}],"overflow-y":[{"overflow-y":Ne()}],overscroll:[{overscroll:Ee()}],"overscroll-x":[{"overscroll-x":Ee()}],"overscroll-y":[{"overscroll-y":Ee()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[x]}],"inset-x":[{"inset-x":[x]}],"inset-y":[{"inset-y":[x]}],start:[{start:[x]}],end:[{end:[x]}],top:[{top:[x]}],right:[{right:[x]}],bottom:[{bottom:[x]}],left:[{left:[x]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",_0,Hn]}],basis:[{basis:Ue()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Hn]}],grow:[{grow:Ke()}],shrink:[{shrink:Ke()}],order:[{order:["first","last","none",_0,Hn]}],"grid-cols":[{"grid-cols":[E0]}],"col-start-end":[{col:["auto",{span:["full",_0,Hn]},Hn]}],"col-start":[{"col-start":Re()}],"col-end":[{"col-end":Re()}],"grid-rows":[{"grid-rows":[E0]}],"row-start-end":[{row:["auto",{span:[_0,Hn]},Hn]}],"row-start":[{"row-start":Re()}],"row-end":[{"row-end":Re()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Hn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Hn]}],gap:[{gap:[N]}],"gap-x":[{"gap-x":[N]}],"gap-y":[{"gap-y":[N]}],"justify-content":[{justify:["normal",...Ie()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Ie(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Ie(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[Z]}],px:[{px:[Z]}],py:[{py:[Z]}],ps:[{ps:[Z]}],pe:[{pe:[Z]}],pt:[{pt:[Z]}],pr:[{pr:[Z]}],pb:[{pb:[Z]}],pl:[{pl:[Z]}],m:[{m:[B]}],mx:[{mx:[B]}],my:[{my:[B]}],ms:[{ms:[B]}],me:[{me:[B]}],mt:[{mt:[B]}],mr:[{mr:[B]}],mb:[{mb:[B]}],ml:[{ml:[B]}],"space-x":[{"space-x":[te]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[te]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Hn,r]}],"min-w":[{"min-w":[Hn,r,"min","max","fit"]}],"max-w":[{"max-w":[Hn,r,"none","full","min","max","fit","prose",{screen:[Vp]},Vp]}],h:[{h:[Hn,r,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Hn,r,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Hn,r,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Hn,r,"auto","min","max","fit"]}],"font-size":[{text:["base",Vp,Up]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Ix]}],"font-family":[{font:[E0]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Hn]}],"line-clamp":[{"line-clamp":["none",Ny,Ix]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",lh,Hn]}],"list-image":[{"list-image":["none",Hn]}],"list-style-type":[{list:["none","disc","decimal",Hn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[i]}],"placeholder-opacity":[{"placeholder-opacity":[X]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[i]}],"text-opacity":[{"text-opacity":[X]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...$e(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",lh,Up]}],"underline-offset":[{"underline-offset":["auto",lh,Hn]}],"text-decoration-color":[{decoration:[i]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Se()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Hn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Hn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[X]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Be(),a_e]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",s_e]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},c_e]}],"bg-color":[{bg:[i]}],"gradient-from-pos":[{from:[H]}],"gradient-via-pos":[{via:[H]}],"gradient-to-pos":[{to:[H]}],"gradient-from":[{from:[P]}],"gradient-via":[{via:[P]}],"gradient-to":[{to:[P]}],rounded:[{rounded:[h]}],"rounded-s":[{"rounded-s":[h]}],"rounded-e":[{"rounded-e":[h]}],"rounded-t":[{"rounded-t":[h]}],"rounded-r":[{"rounded-r":[h]}],"rounded-b":[{"rounded-b":[h]}],"rounded-l":[{"rounded-l":[h]}],"rounded-ss":[{"rounded-ss":[h]}],"rounded-se":[{"rounded-se":[h]}],"rounded-ee":[{"rounded-ee":[h]}],"rounded-es":[{"rounded-es":[h]}],"rounded-tl":[{"rounded-tl":[h]}],"rounded-tr":[{"rounded-tr":[h]}],"rounded-br":[{"rounded-br":[h]}],"rounded-bl":[{"rounded-bl":[h]}],"border-w":[{border:[E]}],"border-w-x":[{"border-x":[E]}],"border-w-y":[{"border-y":[E]}],"border-w-s":[{"border-s":[E]}],"border-w-e":[{"border-e":[E]}],"border-w-t":[{"border-t":[E]}],"border-w-r":[{"border-r":[E]}],"border-w-b":[{"border-b":[E]}],"border-w-l":[{"border-l":[E]}],"border-opacity":[{"border-opacity":[X]}],"border-style":[{border:[...$e(),"hidden"]}],"divide-x":[{"divide-x":[E]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[E]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[X]}],"divide-style":[{divide:$e()}],"border-color":[{border:[l]}],"border-color-x":[{"border-x":[l]}],"border-color-y":[{"border-y":[l]}],"border-color-s":[{"border-s":[l]}],"border-color-e":[{"border-e":[l]}],"border-color-t":[{"border-t":[l]}],"border-color-r":[{"border-r":[l]}],"border-color-b":[{"border-b":[l]}],"border-color-l":[{"border-l":[l]}],"divide-color":[{divide:[l]}],"outline-style":[{outline:["",...$e()]}],"outline-offset":[{"outline-offset":[lh,Hn]}],"outline-w":[{outline:[lh,Up]}],"outline-color":[{outline:[i]}],"ring-w":[{ring:Xe()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[i]}],"ring-opacity":[{"ring-opacity":[X]}],"ring-offset-w":[{"ring-offset":[lh,Up]}],"ring-offset-color":[{"ring-offset":[i]}],shadow:[{shadow:["","inner","none",Vp,l_e]}],"shadow-color":[{shadow:[E0]}],opacity:[{opacity:[X]}],"mix-blend":[{"mix-blend":[...Ge(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Ge()}],filter:[{filter:["","none"]}],blur:[{blur:[a]}],brightness:[{brightness:[c]}],contrast:[{contrast:[S]}],"drop-shadow":[{"drop-shadow":["","none",Vp,Hn]}],grayscale:[{grayscale:[T]}],"hue-rotate":[{"hue-rotate":[C]}],invert:[{invert:[I]}],saturate:[{saturate:[$]}],sepia:[{sepia:[re]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[a]}],"backdrop-brightness":[{"backdrop-brightness":[c]}],"backdrop-contrast":[{"backdrop-contrast":[S]}],"backdrop-grayscale":[{"backdrop-grayscale":[T]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[C]}],"backdrop-invert":[{"backdrop-invert":[I]}],"backdrop-opacity":[{"backdrop-opacity":[X]}],"backdrop-saturate":[{"backdrop-saturate":[$]}],"backdrop-sepia":[{"backdrop-sepia":[re]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[m]}],"border-spacing-x":[{"border-spacing-x":[m]}],"border-spacing-y":[{"border-spacing-y":[m]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Hn]}],duration:[{duration:ge()}],ease:[{ease:["linear","in","out","in-out",Hn]}],delay:[{delay:ge()}],animate:[{animate:["none","spin","ping","pulse","bounce",Hn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[le]}],"scale-x":[{"scale-x":[le]}],"scale-y":[{"scale-y":[le]}],rotate:[{rotate:[_0,Hn]}],"translate-x":[{"translate-x":[pe]}],"translate-y":[{"translate-y":[pe]}],"skew-x":[{"skew-x":[ce]}],"skew-y":[{"skew-y":[ce]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Hn]}],accent:[{accent:["auto",i]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Hn]}],"caret-color":[{caret:[i]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Se()}],"scroll-mx":[{"scroll-mx":Se()}],"scroll-my":[{"scroll-my":Se()}],"scroll-ms":[{"scroll-ms":Se()}],"scroll-me":[{"scroll-me":Se()}],"scroll-mt":[{"scroll-mt":Se()}],"scroll-mr":[{"scroll-mr":Se()}],"scroll-mb":[{"scroll-mb":Se()}],"scroll-ml":[{"scroll-ml":Se()}],"scroll-p":[{"scroll-p":Se()}],"scroll-px":[{"scroll-px":Se()}],"scroll-py":[{"scroll-py":Se()}],"scroll-ps":[{"scroll-ps":Se()}],"scroll-pe":[{"scroll-pe":Se()}],"scroll-pt":[{"scroll-pt":Se()}],"scroll-pr":[{"scroll-pr":Se()}],"scroll-pb":[{"scroll-pb":Se()}],"scroll-pl":[{"scroll-pl":Se()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Hn]}],fill:[{fill:[i,"none"]}],"stroke-w":[{stroke:[lh,Up,Ix]}],stroke:[{stroke:[i,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},f_e=Xge(p_e);function Br(...i){return f_e(sX(i))}const m_e=rge,CX=G.forwardRef(({className:i,...r},a)=>D.jsx(Qq,{ref:a,className:Br("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",i),...r}));CX.displayName=Qq.displayName;const g_e=_2("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),RX=G.forwardRef(({className:i,variant:r,...a},c)=>D.jsx(Zq,{ref:c,className:Br(g_e({variant:r}),i),...a}));RX.displayName=Zq.displayName;const __e=G.forwardRef(({className:i,...r},a)=>D.jsx(nX,{ref:a,className:Br("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",i),...r}));__e.displayName=nX.displayName;const bX=G.forwardRef(({className:i,...r},a)=>D.jsx(rX,{ref:a,className:Br("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",i),"toast-close":"",...r,children:D.jsx(TO,{className:"h-4 w-4"})}));bX.displayName=rX.displayName;const IX=G.forwardRef(({className:i,...r},a)=>D.jsx(eX,{ref:a,className:Br("text-sm font-semibold",i),...r}));IX.displayName=eX.displayName;const AX=G.forwardRef(({className:i,...r},a)=>D.jsx(tX,{ref:a,className:Br("text-sm opacity-90",i),...r}));AX.displayName=tX.displayName;function E_e(){const{toasts:i}=d2();return D.jsxs(m_e,{children:[i.map(function({id:r,title:a,description:c,action:l,...h}){return D.jsxs(RX,{...h,children:[D.jsxs("div",{className:"grid gap-1",children:[a&&D.jsx(IX,{children:a}),c&&D.jsx(AX,{children:c})]}),l,D.jsx(bX,{})]},r)}),D.jsx(CX,{})]})}var mK=["light","dark"],y_e="(prefers-color-scheme: dark)",v_e=G.createContext(void 0),S_e={setTheme:i=>{},themes:[]},T_e=()=>{var i;return(i=G.useContext(v_e))!=null?i:S_e};G.memo(({forcedTheme:i,storageKey:r,attribute:a,enableSystem:c,enableColorScheme:l,defaultTheme:h,value:m,attrs:E,nonce:S})=>{let T=h==="system",C=a==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${E.map(H=>`'${H}'`).join(",")})`};`:`var d=document.documentElement,n='${a}',s='setAttribute';`,I=l?mK.includes(h)&&h?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${h}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",N=(H,x=!1,B=!0)=>{let X=m?m[H]:H,Z=x?H+"|| ''":`'${X}'`,$="";return l&&B&&!x&&mK.includes(H)&&($+=`d.style.colorScheme = '${H}';`),a==="class"?x||X?$+=`c.add(${Z})`:$+="null":X&&($+=`d[s](n,${Z})`),$},P=i?`!function(){${C}${N(i)}}()`:c?`!function(){try{${C}var e=localStorage.getItem('${r}');if('system'===e||(!e&&${T})){var t='${y_e}',m=window.matchMedia(t);if(m.media!==t||m.matches){${N("dark")}}else{${N("light")}}}else if(e){${m?`var x=${JSON.stringify(m)};`:""}${N(m?"x[e]":"e",!0)}}${T?"":"else{"+N(h,!1,!1)+"}"}${I}}catch(e){}}()`:`!function(){try{${C}var e=localStorage.getItem('${r}');if(e){${m?`var x=${JSON.stringify(m)};`:""}${N(m?"x[e]":"e",!0)}}else{${N(h,!1,!1)};}${I}}catch(t){}}();`;return G.createElement("script",{nonce:S,dangerouslySetInnerHTML:{__html:P}})});var w_e=i=>{switch(i){case"success":return b_e;case"info":return A_e;case"warning":return I_e;case"error":return O_e;default:return null}},C_e=Array(12).fill(0),R_e=({visible:i,className:r})=>vt.createElement("div",{className:["sonner-loading-wrapper",r].filter(Boolean).join(" "),"data-visible":i},vt.createElement("div",{className:"sonner-spinner"},C_e.map((a,c)=>vt.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${c}`})))),b_e=vt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},vt.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),I_e=vt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},vt.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),A_e=vt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},vt.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),O_e=vt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},vt.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),N_e=vt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},vt.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),vt.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),P_e=()=>{let[i,r]=vt.useState(document.hidden);return vt.useEffect(()=>{let a=()=>{r(document.hidden)};return document.addEventListener("visibilitychange",a),()=>window.removeEventListener("visibilitychange",a)},[]),i},HL=1,k_e=class{constructor(){this.subscribe=i=>(this.subscribers.push(i),()=>{let r=this.subscribers.indexOf(i);this.subscribers.splice(r,1)}),this.publish=i=>{this.subscribers.forEach(r=>r(i))},this.addToast=i=>{this.publish(i),this.toasts=[...this.toasts,i]},this.create=i=>{var r;let{message:a,...c}=i,l=typeof i?.id=="number"||((r=i.id)==null?void 0:r.length)>0?i.id:HL++,h=this.toasts.find(E=>E.id===l),m=i.dismissible===void 0?!0:i.dismissible;return this.dismissedToasts.has(l)&&this.dismissedToasts.delete(l),h?this.toasts=this.toasts.map(E=>E.id===l?(this.publish({...E,...i,id:l,title:a}),{...E,...i,id:l,dismissible:m,title:a}):E):this.addToast({title:a,...c,dismissible:m,id:l}),l},this.dismiss=i=>(this.dismissedToasts.add(i),i||this.toasts.forEach(r=>{this.subscribers.forEach(a=>a({id:r.id,dismiss:!0}))}),this.subscribers.forEach(r=>r({id:i,dismiss:!0})),i),this.message=(i,r)=>this.create({...r,message:i}),this.error=(i,r)=>this.create({...r,message:i,type:"error"}),this.success=(i,r)=>this.create({...r,type:"success",message:i}),this.info=(i,r)=>this.create({...r,type:"info",message:i}),this.warning=(i,r)=>this.create({...r,type:"warning",message:i}),this.loading=(i,r)=>this.create({...r,type:"loading",message:i}),this.promise=(i,r)=>{if(!r)return;let a;r.loading!==void 0&&(a=this.create({...r,promise:i,type:"loading",message:r.loading,description:typeof r.description!="function"?r.description:void 0}));let c=i instanceof Promise?i:i(),l=a!==void 0,h,m=c.then(async S=>{if(h=["resolve",S],vt.isValidElement(S))l=!1,this.create({id:a,type:"default",message:S});else if(x_e(S)&&!S.ok){l=!1;let T=typeof r.error=="function"?await r.error(`HTTP error! status: ${S.status}`):r.error,C=typeof r.description=="function"?await r.description(`HTTP error! status: ${S.status}`):r.description;this.create({id:a,type:"error",message:T,description:C})}else if(r.success!==void 0){l=!1;let T=typeof r.success=="function"?await r.success(S):r.success,C=typeof r.description=="function"?await r.description(S):r.description;this.create({id:a,type:"success",message:T,description:C})}}).catch(async S=>{if(h=["reject",S],r.error!==void 0){l=!1;let T=typeof r.error=="function"?await r.error(S):r.error,C=typeof r.description=="function"?await r.description(S):r.description;this.create({id:a,type:"error",message:T,description:C})}}).finally(()=>{var S;l&&(this.dismiss(a),a=void 0),(S=r.finally)==null||S.call(r)}),E=()=>new Promise((S,T)=>m.then(()=>h[0]==="reject"?T(h[1]):S(h[1])).catch(T));return typeof a!="string"&&typeof a!="number"?{unwrap:E}:Object.assign(a,{unwrap:E})},this.custom=(i,r)=>{let a=r?.id||HL++;return this.create({jsx:i(a),id:a,...r}),a},this.getActiveToasts=()=>this.toasts.filter(i=>!this.dismissedToasts.has(i.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},Io=new k_e,D_e=(i,r)=>{let a=r?.id||HL++;return Io.addToast({title:i,...r,id:a}),a},x_e=i=>i&&typeof i=="object"&&"ok"in i&&typeof i.ok=="boolean"&&"status"in i&&typeof i.status=="number",L_e=D_e,M_e=()=>Io.toasts,U_e=()=>Io.getActiveToasts(),gK=Object.assign(L_e,{success:Io.success,info:Io.info,warning:Io.warning,error:Io.error,custom:Io.custom,message:Io.message,promise:Io.promise,dismiss:Io.dismiss,loading:Io.loading},{getHistory:M_e,getToasts:U_e});function V_e(i,{insertAt:r}={}){if(typeof document>"u")return;let a=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css",r==="top"&&a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c),c.styleSheet?c.styleSheet.cssText=i:c.appendChild(document.createTextNode(i))}V_e(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function KI(i){return i.label!==void 0}var F_e=3,j_e="32px",B_e="16px",_K=4e3,W_e=356,G_e=14,H_e=20,z_e=200;function ru(...i){return i.filter(Boolean).join(" ")}function K_e(i){let[r,a]=i.split("-"),c=[];return r&&c.push(r),a&&c.push(a),c}var Y_e=i=>{var r,a,c,l,h,m,E,S,T,C,I;let{invert:N,toast:P,unstyled:H,interacting:x,setHeights:B,visibleToasts:X,heights:Z,index:$,toasts:le,expanded:re,removeToast:ce,defaultRichColors:te,closeButton:pe,style:Ee,cancelButtonStyle:Ne,actionButtonStyle:Ue,className:Se="",descriptionClassName:Xe="",duration:Re,position:Be,gap:$e,loadingIcon:Ge,expandByDefault:Ie,classNames:Ke,icons:ae,closeButtonAriaLabel:ge="Close toast",pauseWhenPageIsHidden:Pe}=i,[ue,it]=vt.useState(null),[yt,Dt]=vt.useState(null),[At,dn]=vt.useState(!1),[Cn,fr]=vt.useState(!1),[os,Jr]=vt.useState(!1),[Mr,Tc]=vt.useState(!1),[pl,yi]=vt.useState(!1),[wc,Wr]=vt.useState(0),[fi,$s]=vt.useState(0),gs=vt.useRef(P.duration||Re||_K),Cc=vt.useRef(null),Qs=vt.useRef(null),Ir=$===0,Ua=$+1<=X,qe=P.type,lt=P.dismissible!==!1,Kt=P.className||"",on=P.descriptionClassName||"",Nn=vt.useMemo(()=>Z.findIndex(mn=>mn.toastId===P.id)||0,[Z,P.id]),ii=vt.useMemo(()=>{var mn;return(mn=P.closeButton)!=null?mn:pe},[P.closeButton,pe]),Zs=vt.useMemo(()=>P.duration||Re||_K,[P.duration,Re]),$r=vt.useRef(0),mi=vt.useRef(0),_a=vt.useRef(0),Gr=vt.useRef(null),[Ea,vi]=Be.split("-"),no=vt.useMemo(()=>Z.reduce((mn,Bn,mr)=>mr>=Nn?mn:mn+Bn.height,0),[Z,Nn]),fl=P_e(),ro=P.invert||N,ya=qe==="loading";mi.current=vt.useMemo(()=>Nn*$e+no,[Nn,no]),vt.useEffect(()=>{gs.current=Zs},[Zs]),vt.useEffect(()=>{dn(!0)},[]),vt.useEffect(()=>{let mn=Qs.current;if(mn){let Bn=mn.getBoundingClientRect().height;return $s(Bn),B(mr=>[{toastId:P.id,height:Bn,position:P.position},...mr]),()=>B(mr=>mr.filter($i=>$i.toastId!==P.id))}},[B,P.id]),vt.useLayoutEffect(()=>{if(!At)return;let mn=Qs.current,Bn=mn.style.height;mn.style.height="auto";let mr=mn.getBoundingClientRect().height;mn.style.height=Bn,$s(mr),B($i=>$i.find(Ls=>Ls.toastId===P.id)?$i.map(Ls=>Ls.toastId===P.id?{...Ls,height:mr}:Ls):[{toastId:P.id,height:mr,position:P.position},...$i])},[At,P.title,P.description,B,P.id]);let Va=vt.useCallback(()=>{fr(!0),Wr(mi.current),B(mn=>mn.filter(Bn=>Bn.toastId!==P.id)),setTimeout(()=>{ce(P)},z_e)},[P,ce,B,mi]);vt.useEffect(()=>{if(P.promise&&qe==="loading"||P.duration===1/0||P.type==="loading")return;let mn;return re||x||Pe&&fl?(()=>{if(_a.current<$r.current){let Bn=new Date().getTime()-$r.current;gs.current=gs.current-Bn}_a.current=new Date().getTime()})():gs.current!==1/0&&($r.current=new Date().getTime(),mn=setTimeout(()=>{var Bn;(Bn=P.onAutoClose)==null||Bn.call(P,P),Va()},gs.current)),()=>clearTimeout(mn)},[re,x,P,qe,Pe,fl,Va]),vt.useEffect(()=>{P.delete&&Va()},[Va,P.delete]);function Fo(){var mn,Bn,mr;return ae!=null&&ae.loading?vt.createElement("div",{className:ru(Ke?.loader,(mn=P?.classNames)==null?void 0:mn.loader,"sonner-loader"),"data-visible":qe==="loading"},ae.loading):Ge?vt.createElement("div",{className:ru(Ke?.loader,(Bn=P?.classNames)==null?void 0:Bn.loader,"sonner-loader"),"data-visible":qe==="loading"},Ge):vt.createElement(R_e,{className:ru(Ke?.loader,(mr=P?.classNames)==null?void 0:mr.loader),visible:qe==="loading"})}return vt.createElement("li",{tabIndex:0,ref:Qs,className:ru(Se,Kt,Ke?.toast,(r=P?.classNames)==null?void 0:r.toast,Ke?.default,Ke?.[qe],(a=P?.classNames)==null?void 0:a[qe]),"data-sonner-toast":"","data-rich-colors":(c=P.richColors)!=null?c:te,"data-styled":!(P.jsx||P.unstyled||H),"data-mounted":At,"data-promise":!!P.promise,"data-swiped":pl,"data-removed":Cn,"data-visible":Ua,"data-y-position":Ea,"data-x-position":vi,"data-index":$,"data-front":Ir,"data-swiping":os,"data-dismissible":lt,"data-type":qe,"data-invert":ro,"data-swipe-out":Mr,"data-swipe-direction":yt,"data-expanded":!!(re||Ie&&At),style:{"--index":$,"--toasts-before":$,"--z-index":le.length-$,"--offset":`${Cn?wc:mi.current}px`,"--initial-height":Ie?"auto":`${fi}px`,...Ee,...P.style},onDragEnd:()=>{Jr(!1),it(null),Gr.current=null},onPointerDown:mn=>{ya||!lt||(Cc.current=new Date,Wr(mi.current),mn.target.setPointerCapture(mn.pointerId),mn.target.tagName!=="BUTTON"&&(Jr(!0),Gr.current={x:mn.clientX,y:mn.clientY}))},onPointerUp:()=>{var mn,Bn,mr,$i;if(Mr||!lt)return;Gr.current=null;let Ls=Number(((mn=Qs.current)==null?void 0:mn.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),kr=Number(((Bn=Qs.current)==null?void 0:Bn.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),ye=new Date().getTime()-((mr=Cc.current)==null?void 0:mr.getTime()),be=ue==="x"?Ls:kr,je=Math.abs(be)/ye;if(Math.abs(be)>=H_e||je>.11){Wr(mi.current),($i=P.onDismiss)==null||$i.call(P,P),Dt(ue==="x"?Ls>0?"right":"left":kr>0?"down":"up"),Va(),Tc(!0),yi(!1);return}Jr(!1),it(null)},onPointerMove:mn=>{var Bn,mr,$i,Ls;if(!Gr.current||!lt||((Bn=window.getSelection())==null?void 0:Bn.toString().length)>0)return;let kr=mn.clientY-Gr.current.y,ye=mn.clientX-Gr.current.x,be=(mr=i.swipeDirections)!=null?mr:K_e(Be);!ue&&(Math.abs(ye)>1||Math.abs(kr)>1)&&it(Math.abs(ye)>Math.abs(kr)?"x":"y");let je={x:0,y:0};ue==="y"?(be.includes("top")||be.includes("bottom"))&&(be.includes("top")&&kr<0||be.includes("bottom")&&kr>0)&&(je.y=kr):ue==="x"&&(be.includes("left")||be.includes("right"))&&(be.includes("left")&&ye<0||be.includes("right")&&ye>0)&&(je.x=ye),(Math.abs(je.x)>0||Math.abs(je.y)>0)&&yi(!0),($i=Qs.current)==null||$i.style.setProperty("--swipe-amount-x",`${je.x}px`),(Ls=Qs.current)==null||Ls.style.setProperty("--swipe-amount-y",`${je.y}px`)}},ii&&!P.jsx?vt.createElement("button",{"aria-label":ge,"data-disabled":ya,"data-close-button":!0,onClick:ya||!lt?()=>{}:()=>{var mn;Va(),(mn=P.onDismiss)==null||mn.call(P,P)},className:ru(Ke?.closeButton,(l=P?.classNames)==null?void 0:l.closeButton)},(h=ae?.close)!=null?h:N_e):null,P.jsx||G.isValidElement(P.title)?P.jsx?P.jsx:typeof P.title=="function"?P.title():P.title:vt.createElement(vt.Fragment,null,qe||P.icon||P.promise?vt.createElement("div",{"data-icon":"",className:ru(Ke?.icon,(m=P?.classNames)==null?void 0:m.icon)},P.promise||P.type==="loading"&&!P.icon?P.icon||Fo():null,P.type!=="loading"?P.icon||ae?.[qe]||w_e(qe):null):null,vt.createElement("div",{"data-content":"",className:ru(Ke?.content,(E=P?.classNames)==null?void 0:E.content)},vt.createElement("div",{"data-title":"",className:ru(Ke?.title,(S=P?.classNames)==null?void 0:S.title)},typeof P.title=="function"?P.title():P.title),P.description?vt.createElement("div",{"data-description":"",className:ru(Xe,on,Ke?.description,(T=P?.classNames)==null?void 0:T.description)},typeof P.description=="function"?P.description():P.description):null),G.isValidElement(P.cancel)?P.cancel:P.cancel&&KI(P.cancel)?vt.createElement("button",{"data-button":!0,"data-cancel":!0,style:P.cancelButtonStyle||Ne,onClick:mn=>{var Bn,mr;KI(P.cancel)&&lt&&((mr=(Bn=P.cancel).onClick)==null||mr.call(Bn,mn),Va())},className:ru(Ke?.cancelButton,(C=P?.classNames)==null?void 0:C.cancelButton)},P.cancel.label):null,G.isValidElement(P.action)?P.action:P.action&&KI(P.action)?vt.createElement("button",{"data-button":!0,"data-action":!0,style:P.actionButtonStyle||Ue,onClick:mn=>{var Bn,mr;KI(P.action)&&((mr=(Bn=P.action).onClick)==null||mr.call(Bn,mn),!mn.defaultPrevented&&Va())},className:ru(Ke?.actionButton,(I=P?.classNames)==null?void 0:I.actionButton)},P.action.label):null))};function EK(){if(typeof window>"u"||typeof document>"u")return"ltr";let i=document.documentElement.getAttribute("dir");return i==="auto"||!i?window.getComputedStyle(document.documentElement).direction:i}function q_e(i,r){let a={};return[i,r].forEach((c,l)=>{let h=l===1,m=h?"--mobile-offset":"--offset",E=h?B_e:j_e;function S(T){["top","right","bottom","left"].forEach(C=>{a[`${m}-${C}`]=typeof T=="number"?`${T}px`:T})}typeof c=="number"||typeof c=="string"?S(c):typeof c=="object"?["top","right","bottom","left"].forEach(T=>{c[T]===void 0?a[`${m}-${T}`]=E:a[`${m}-${T}`]=typeof c[T]=="number"?`${c[T]}px`:c[T]}):S(E)}),a}var X_e=G.forwardRef(function(i,r){let{invert:a,position:c="bottom-right",hotkey:l=["altKey","KeyT"],expand:h,closeButton:m,className:E,offset:S,mobileOffset:T,theme:C="light",richColors:I,duration:N,style:P,visibleToasts:H=F_e,toastOptions:x,dir:B=EK(),gap:X=G_e,loadingIcon:Z,icons:$,containerAriaLabel:le="Notifications",pauseWhenPageIsHidden:re}=i,[ce,te]=vt.useState([]),pe=vt.useMemo(()=>Array.from(new Set([c].concat(ce.filter(Pe=>Pe.position).map(Pe=>Pe.position)))),[ce,c]),[Ee,Ne]=vt.useState([]),[Ue,Se]=vt.useState(!1),[Xe,Re]=vt.useState(!1),[Be,$e]=vt.useState(C!=="system"?C:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Ge=vt.useRef(null),Ie=l.join("+").replace(/Key/g,"").replace(/Digit/g,""),Ke=vt.useRef(null),ae=vt.useRef(!1),ge=vt.useCallback(Pe=>{te(ue=>{var it;return(it=ue.find(yt=>yt.id===Pe.id))!=null&&it.delete||Io.dismiss(Pe.id),ue.filter(({id:yt})=>yt!==Pe.id)})},[]);return vt.useEffect(()=>Io.subscribe(Pe=>{if(Pe.dismiss){te(ue=>ue.map(it=>it.id===Pe.id?{...it,delete:!0}:it));return}setTimeout(()=>{h2.flushSync(()=>{te(ue=>{let it=ue.findIndex(yt=>yt.id===Pe.id);return it!==-1?[...ue.slice(0,it),{...ue[it],...Pe},...ue.slice(it+1)]:[Pe,...ue]})})})}),[]),vt.useEffect(()=>{if(C!=="system"){$e(C);return}if(C==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?$e("dark"):$e("light")),typeof window>"u")return;let Pe=window.matchMedia("(prefers-color-scheme: dark)");try{Pe.addEventListener("change",({matches:ue})=>{$e(ue?"dark":"light")})}catch{Pe.addListener(({matches:it})=>{try{$e(it?"dark":"light")}catch(yt){console.error(yt)}})}},[C]),vt.useEffect(()=>{ce.length<=1&&Se(!1)},[ce]),vt.useEffect(()=>{let Pe=ue=>{var it,yt;l.every(Dt=>ue[Dt]||ue.code===Dt)&&(Se(!0),(it=Ge.current)==null||it.focus()),ue.code==="Escape"&&(document.activeElement===Ge.current||(yt=Ge.current)!=null&&yt.contains(document.activeElement))&&Se(!1)};return document.addEventListener("keydown",Pe),()=>document.removeEventListener("keydown",Pe)},[l]),vt.useEffect(()=>{if(Ge.current)return()=>{Ke.current&&(Ke.current.focus({preventScroll:!0}),Ke.current=null,ae.current=!1)}},[Ge.current]),vt.createElement("section",{ref:r,"aria-label":`${le} ${Ie}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},pe.map((Pe,ue)=>{var it;let[yt,Dt]=Pe.split("-");return ce.length?vt.createElement("ol",{key:Pe,dir:B==="auto"?EK():B,tabIndex:-1,ref:Ge,className:E,"data-sonner-toaster":!0,"data-theme":Be,"data-y-position":yt,"data-lifted":Ue&&ce.length>1&&!h,"data-x-position":Dt,style:{"--front-toast-height":`${((it=Ee[0])==null?void 0:it.height)||0}px`,"--width":`${W_e}px`,"--gap":`${X}px`,...P,...q_e(S,T)},onBlur:At=>{ae.current&&!At.currentTarget.contains(At.relatedTarget)&&(ae.current=!1,Ke.current&&(Ke.current.focus({preventScroll:!0}),Ke.current=null))},onFocus:At=>{At.target instanceof HTMLElement&&At.target.dataset.dismissible==="false"||ae.current||(ae.current=!0,Ke.current=At.relatedTarget)},onMouseEnter:()=>Se(!0),onMouseMove:()=>Se(!0),onMouseLeave:()=>{Xe||Se(!1)},onDragEnd:()=>Se(!1),onPointerDown:At=>{At.target instanceof HTMLElement&&At.target.dataset.dismissible==="false"||Re(!0)},onPointerUp:()=>Re(!1)},ce.filter(At=>!At.position&&ue===0||At.position===Pe).map((At,dn)=>{var Cn,fr;return vt.createElement(Y_e,{key:At.id,icons:$,index:dn,toast:At,defaultRichColors:I,duration:(Cn=x?.duration)!=null?Cn:N,className:x?.className,descriptionClassName:x?.descriptionClassName,invert:a,visibleToasts:H,closeButton:(fr=x?.closeButton)!=null?fr:m,interacting:Xe,position:Pe,style:x?.style,unstyled:x?.unstyled,classNames:x?.classNames,cancelButtonStyle:x?.cancelButtonStyle,actionButtonStyle:x?.actionButtonStyle,removeToast:ge,toasts:ce.filter(os=>os.position==At.position),heights:Ee.filter(os=>os.position==At.position),setHeights:Ne,expandByDefault:h,gap:X,loadingIcon:Z,expanded:Ue,pauseWhenPageIsHidden:re,swipeDirections:i.swipeDirections})})):null}))});const J_e=({...i})=>{const{theme:r="system"}=T_e();return D.jsx(X_e,{theme:r,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...i})};var $_e=u2[" useId ".trim().toString()]||(()=>{}),Q_e=0;function F0(i){const[r,a]=G.useState($_e());return gh(()=>{a(c=>c??String(Q_e++))},[i]),r?`radix-${r}`:""}const Z_e=["top","right","bottom","left"],af=Math.min,lc=Math.max,kA=Math.round,YI=Math.floor,Ed=i=>({x:i,y:i}),eEe={left:"right",right:"left",bottom:"top",top:"bottom"},tEe={start:"end",end:"start"};function zL(i,r,a){return lc(i,af(r,a))}function _h(i,r){return typeof i=="function"?i(r):i}function Eh(i){return i.split("-")[0]}function sv(i){return i.split("-")[1]}function v2(i){return i==="x"?"y":"x"}function S2(i){return i==="y"?"height":"width"}const nEe=new Set(["top","bottom"]);function gd(i){return nEe.has(Eh(i))?"y":"x"}function T2(i){return v2(gd(i))}function rEe(i,r,a){a===void 0&&(a=!1);const c=sv(i),l=T2(i),h=S2(l);let m=l==="x"?c===(a?"end":"start")?"right":"left":c==="start"?"bottom":"top";return r.reference[h]>r.floating[h]&&(m=DA(m)),[m,DA(m)]}function iEe(i){const r=DA(i);return[KL(i),r,KL(r)]}function KL(i){return i.replace(/start|end/g,r=>tEe[r])}const yK=["left","right"],vK=["right","left"],sEe=["top","bottom"],aEe=["bottom","top"];function oEe(i,r,a){switch(i){case"top":case"bottom":return a?r?vK:yK:r?yK:vK;case"left":case"right":return r?sEe:aEe;default:return[]}}function cEe(i,r,a,c){const l=sv(i);let h=oEe(Eh(i),a==="start",c);return l&&(h=h.map(m=>m+"-"+l),r&&(h=h.concat(h.map(KL)))),h}function DA(i){return i.replace(/left|right|bottom|top/g,r=>eEe[r])}function lEe(i){return{top:0,right:0,bottom:0,left:0,...i}}function OX(i){return typeof i!="number"?lEe(i):{top:i,right:i,bottom:i,left:i}}function xA(i){const{x:r,y:a,width:c,height:l}=i;return{width:c,height:l,top:a,left:r,right:r+c,bottom:a+l,x:r,y:a}}function SK(i,r,a){let{reference:c,floating:l}=i;const h=gd(r),m=T2(r),E=S2(m),S=Eh(r),T=h==="y",C=c.x+c.width/2-l.width/2,I=c.y+c.height/2-l.height/2,N=c[E]/2-l[E]/2;let P;switch(S){case"top":P={x:C,y:c.y-l.height};break;case"bottom":P={x:C,y:c.y+c.height};break;case"right":P={x:c.x+c.width,y:I};break;case"left":P={x:c.x-l.width,y:I};break;default:P={x:c.x,y:c.y}}switch(sv(r)){case"start":P[m]-=N*(a&&T?-1:1);break;case"end":P[m]+=N*(a&&T?-1:1);break}return P}const uEe=async(i,r,a)=>{const{placement:c="bottom",strategy:l="absolute",middleware:h=[],platform:m}=a,E=h.filter(Boolean),S=await(m.isRTL==null?void 0:m.isRTL(r));let T=await m.getElementRects({reference:i,floating:r,strategy:l}),{x:C,y:I}=SK(T,c,S),N=c,P={},H=0;for(let x=0;x<E.length;x++){const{name:B,fn:X}=E[x],{x:Z,y:$,data:le,reset:re}=await X({x:C,y:I,initialPlacement:c,placement:N,strategy:l,middlewareData:P,rects:T,platform:m,elements:{reference:i,floating:r}});C=Z??C,I=$??I,P={...P,[B]:{...P[B],...le}},re&&H<=50&&(H++,typeof re=="object"&&(re.placement&&(N=re.placement),re.rects&&(T=re.rects===!0?await m.getElementRects({reference:i,floating:r,strategy:l}):re.rects),{x:C,y:I}=SK(T,N,S)),x=-1)}return{x:C,y:I,placement:N,strategy:l,middlewareData:P}};async function iw(i,r){var a;r===void 0&&(r={});const{x:c,y:l,platform:h,rects:m,elements:E,strategy:S}=i,{boundary:T="clippingAncestors",rootBoundary:C="viewport",elementContext:I="floating",altBoundary:N=!1,padding:P=0}=_h(r,i),H=OX(P),B=E[N?I==="floating"?"reference":"floating":I],X=xA(await h.getClippingRect({element:(a=await(h.isElement==null?void 0:h.isElement(B)))==null||a?B:B.contextElement||await(h.getDocumentElement==null?void 0:h.getDocumentElement(E.floating)),boundary:T,rootBoundary:C,strategy:S})),Z=I==="floating"?{x:c,y:l,width:m.floating.width,height:m.floating.height}:m.reference,$=await(h.getOffsetParent==null?void 0:h.getOffsetParent(E.floating)),le=await(h.isElement==null?void 0:h.isElement($))?await(h.getScale==null?void 0:h.getScale($))||{x:1,y:1}:{x:1,y:1},re=xA(h.convertOffsetParentRelativeRectToViewportRelativeRect?await h.convertOffsetParentRelativeRectToViewportRelativeRect({elements:E,rect:Z,offsetParent:$,strategy:S}):Z);return{top:(X.top-re.top+H.top)/le.y,bottom:(re.bottom-X.bottom+H.bottom)/le.y,left:(X.left-re.left+H.left)/le.x,right:(re.right-X.right+H.right)/le.x}}const dEe=i=>({name:"arrow",options:i,async fn(r){const{x:a,y:c,placement:l,rects:h,platform:m,elements:E,middlewareData:S}=r,{element:T,padding:C=0}=_h(i,r)||{};if(T==null)return{};const I=OX(C),N={x:a,y:c},P=T2(l),H=S2(P),x=await m.getDimensions(T),B=P==="y",X=B?"top":"left",Z=B?"bottom":"right",$=B?"clientHeight":"clientWidth",le=h.reference[H]+h.reference[P]-N[P]-h.floating[H],re=N[P]-h.reference[P],ce=await(m.getOffsetParent==null?void 0:m.getOffsetParent(T));let te=ce?ce[$]:0;(!te||!await(m.isElement==null?void 0:m.isElement(ce)))&&(te=E.floating[$]||h.floating[H]);const pe=le/2-re/2,Ee=te/2-x[H]/2-1,Ne=af(I[X],Ee),Ue=af(I[Z],Ee),Se=Ne,Xe=te-x[H]-Ue,Re=te/2-x[H]/2+pe,Be=zL(Se,Re,Xe),$e=!S.arrow&&sv(l)!=null&&Re!==Be&&h.reference[H]/2-(Re<Se?Ne:Ue)-x[H]/2<0,Ge=$e?Re<Se?Re-Se:Re-Xe:0;return{[P]:N[P]+Ge,data:{[P]:Be,centerOffset:Re-Be-Ge,...$e&&{alignmentOffset:Ge}},reset:$e}}}),hEe=function(i){return i===void 0&&(i={}),{name:"flip",options:i,async fn(r){var a,c;const{placement:l,middlewareData:h,rects:m,initialPlacement:E,platform:S,elements:T}=r,{mainAxis:C=!0,crossAxis:I=!0,fallbackPlacements:N,fallbackStrategy:P="bestFit",fallbackAxisSideDirection:H="none",flipAlignment:x=!0,...B}=_h(i,r);if((a=h.arrow)!=null&&a.alignmentOffset)return{};const X=Eh(l),Z=gd(E),$=Eh(E)===E,le=await(S.isRTL==null?void 0:S.isRTL(T.floating)),re=N||($||!x?[DA(E)]:iEe(E)),ce=H!=="none";!N&&ce&&re.push(...cEe(E,x,H,le));const te=[E,...re],pe=await iw(r,B),Ee=[];let Ne=((c=h.flip)==null?void 0:c.overflows)||[];if(C&&Ee.push(pe[X]),I){const Re=rEe(l,m,le);Ee.push(pe[Re[0]],pe[Re[1]])}if(Ne=[...Ne,{placement:l,overflows:Ee}],!Ee.every(Re=>Re<=0)){var Ue,Se;const Re=(((Ue=h.flip)==null?void 0:Ue.index)||0)+1,Be=te[Re];if(Be&&(!(I==="alignment"?Z!==gd(Be):!1)||Ne.every(Ie=>Ie.overflows[0]>0&&gd(Ie.placement)===Z)))return{data:{index:Re,overflows:Ne},reset:{placement:Be}};let $e=(Se=Ne.filter(Ge=>Ge.overflows[0]<=0).sort((Ge,Ie)=>Ge.overflows[1]-Ie.overflows[1])[0])==null?void 0:Se.placement;if(!$e)switch(P){case"bestFit":{var Xe;const Ge=(Xe=Ne.filter(Ie=>{if(ce){const Ke=gd(Ie.placement);return Ke===Z||Ke==="y"}return!0}).map(Ie=>[Ie.placement,Ie.overflows.filter(Ke=>Ke>0).reduce((Ke,ae)=>Ke+ae,0)]).sort((Ie,Ke)=>Ie[1]-Ke[1])[0])==null?void 0:Xe[0];Ge&&($e=Ge);break}case"initialPlacement":$e=E;break}if(l!==$e)return{reset:{placement:$e}}}return{}}}};function TK(i,r){return{top:i.top-r.height,right:i.right-r.width,bottom:i.bottom-r.height,left:i.left-r.width}}function wK(i){return Z_e.some(r=>i[r]>=0)}const pEe=function(i){return i===void 0&&(i={}),{name:"hide",options:i,async fn(r){const{rects:a}=r,{strategy:c="referenceHidden",...l}=_h(i,r);switch(c){case"referenceHidden":{const h=await iw(r,{...l,elementContext:"reference"}),m=TK(h,a.reference);return{data:{referenceHiddenOffsets:m,referenceHidden:wK(m)}}}case"escaped":{const h=await iw(r,{...l,altBoundary:!0}),m=TK(h,a.floating);return{data:{escapedOffsets:m,escaped:wK(m)}}}default:return{}}}}},NX=new Set(["left","top"]);async function fEe(i,r){const{placement:a,platform:c,elements:l}=i,h=await(c.isRTL==null?void 0:c.isRTL(l.floating)),m=Eh(a),E=sv(a),S=gd(a)==="y",T=NX.has(m)?-1:1,C=h&&S?-1:1,I=_h(r,i);let{mainAxis:N,crossAxis:P,alignmentAxis:H}=typeof I=="number"?{mainAxis:I,crossAxis:0,alignmentAxis:null}:{mainAxis:I.mainAxis||0,crossAxis:I.crossAxis||0,alignmentAxis:I.alignmentAxis};return E&&typeof H=="number"&&(P=E==="end"?H*-1:H),S?{x:P*C,y:N*T}:{x:N*T,y:P*C}}const mEe=function(i){return i===void 0&&(i=0),{name:"offset",options:i,async fn(r){var a,c;const{x:l,y:h,placement:m,middlewareData:E}=r,S=await fEe(r,i);return m===((a=E.offset)==null?void 0:a.placement)&&(c=E.arrow)!=null&&c.alignmentOffset?{}:{x:l+S.x,y:h+S.y,data:{...S,placement:m}}}}},gEe=function(i){return i===void 0&&(i={}),{name:"shift",options:i,async fn(r){const{x:a,y:c,placement:l}=r,{mainAxis:h=!0,crossAxis:m=!1,limiter:E={fn:B=>{let{x:X,y:Z}=B;return{x:X,y:Z}}},...S}=_h(i,r),T={x:a,y:c},C=await iw(r,S),I=gd(Eh(l)),N=v2(I);let P=T[N],H=T[I];if(h){const B=N==="y"?"top":"left",X=N==="y"?"bottom":"right",Z=P+C[B],$=P-C[X];P=zL(Z,P,$)}if(m){const B=I==="y"?"top":"left",X=I==="y"?"bottom":"right",Z=H+C[B],$=H-C[X];H=zL(Z,H,$)}const x=E.fn({...r,[N]:P,[I]:H});return{...x,data:{x:x.x-a,y:x.y-c,enabled:{[N]:h,[I]:m}}}}}},_Ee=function(i){return i===void 0&&(i={}),{options:i,fn(r){const{x:a,y:c,placement:l,rects:h,middlewareData:m}=r,{offset:E=0,mainAxis:S=!0,crossAxis:T=!0}=_h(i,r),C={x:a,y:c},I=gd(l),N=v2(I);let P=C[N],H=C[I];const x=_h(E,r),B=typeof x=="number"?{mainAxis:x,crossAxis:0}:{mainAxis:0,crossAxis:0,...x};if(S){const $=N==="y"?"height":"width",le=h.reference[N]-h.floating[$]+B.mainAxis,re=h.reference[N]+h.reference[$]-B.mainAxis;P<le?P=le:P>re&&(P=re)}if(T){var X,Z;const $=N==="y"?"width":"height",le=NX.has(Eh(l)),re=h.reference[I]-h.floating[$]+(le&&((X=m.offset)==null?void 0:X[I])||0)+(le?0:B.crossAxis),ce=h.reference[I]+h.reference[$]+(le?0:((Z=m.offset)==null?void 0:Z[I])||0)-(le?B.crossAxis:0);H<re?H=re:H>ce&&(H=ce)}return{[N]:P,[I]:H}}}},EEe=function(i){return i===void 0&&(i={}),{name:"size",options:i,async fn(r){var a,c;const{placement:l,rects:h,platform:m,elements:E}=r,{apply:S=()=>{},...T}=_h(i,r),C=await iw(r,T),I=Eh(l),N=sv(l),P=gd(l)==="y",{width:H,height:x}=h.floating;let B,X;I==="top"||I==="bottom"?(B=I,X=N===(await(m.isRTL==null?void 0:m.isRTL(E.floating))?"start":"end")?"left":"right"):(X=I,B=N==="end"?"top":"bottom");const Z=x-C.top-C.bottom,$=H-C.left-C.right,le=af(x-C[B],Z),re=af(H-C[X],$),ce=!r.middlewareData.shift;let te=le,pe=re;if((a=r.middlewareData.shift)!=null&&a.enabled.x&&(pe=$),(c=r.middlewareData.shift)!=null&&c.enabled.y&&(te=Z),ce&&!N){const Ne=lc(C.left,0),Ue=lc(C.right,0),Se=lc(C.top,0),Xe=lc(C.bottom,0);P?pe=H-2*(Ne!==0||Ue!==0?Ne+Ue:lc(C.left,C.right)):te=x-2*(Se!==0||Xe!==0?Se+Xe:lc(C.top,C.bottom))}await S({...r,availableWidth:pe,availableHeight:te});const Ee=await m.getDimensions(E.floating);return H!==Ee.width||x!==Ee.height?{reset:{rects:!0}}:{}}}};function wO(){return typeof window<"u"}function av(i){return PX(i)?(i.nodeName||"").toLowerCase():"#document"}function fc(i){var r;return(i==null||(r=i.ownerDocument)==null?void 0:r.defaultView)||window}function Ad(i){var r;return(r=(PX(i)?i.ownerDocument:i.document)||window.document)==null?void 0:r.documentElement}function PX(i){return wO()?i instanceof Node||i instanceof fc(i).Node:!1}function uu(i){return wO()?i instanceof Element||i instanceof fc(i).Element:!1}function wd(i){return wO()?i instanceof HTMLElement||i instanceof fc(i).HTMLElement:!1}function CK(i){return!wO()||typeof ShadowRoot>"u"?!1:i instanceof ShadowRoot||i instanceof fc(i).ShadowRoot}const yEe=new Set(["inline","contents"]);function Dw(i){const{overflow:r,overflowX:a,overflowY:c,display:l}=du(i);return/auto|scroll|overlay|hidden|clip/.test(r+c+a)&&!yEe.has(l)}const vEe=new Set(["table","td","th"]);function SEe(i){return vEe.has(av(i))}const TEe=[":popover-open",":modal"];function CO(i){return TEe.some(r=>{try{return i.matches(r)}catch{return!1}})}const wEe=["transform","translate","scale","rotate","perspective"],CEe=["transform","translate","scale","rotate","perspective","filter"],REe=["paint","layout","strict","content"];function w2(i){const r=C2(),a=uu(i)?du(i):i;return wEe.some(c=>a[c]?a[c]!=="none":!1)||(a.containerType?a.containerType!=="normal":!1)||!r&&(a.backdropFilter?a.backdropFilter!=="none":!1)||!r&&(a.filter?a.filter!=="none":!1)||CEe.some(c=>(a.willChange||"").includes(c))||REe.some(c=>(a.contain||"").includes(c))}function bEe(i){let r=of(i);for(;wd(r)&&!Hy(r);){if(w2(r))return r;if(CO(r))return null;r=of(r)}return null}function C2(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const IEe=new Set(["html","body","#document"]);function Hy(i){return IEe.has(av(i))}function du(i){return fc(i).getComputedStyle(i)}function RO(i){return uu(i)?{scrollLeft:i.scrollLeft,scrollTop:i.scrollTop}:{scrollLeft:i.scrollX,scrollTop:i.scrollY}}function of(i){if(av(i)==="html")return i;const r=i.assignedSlot||i.parentNode||CK(i)&&i.host||Ad(i);return CK(r)?r.host:r}function kX(i){const r=of(i);return Hy(r)?i.ownerDocument?i.ownerDocument.body:i.body:wd(r)&&Dw(r)?r:kX(r)}function sw(i,r,a){var c;r===void 0&&(r=[]),a===void 0&&(a=!0);const l=kX(i),h=l===((c=i.ownerDocument)==null?void 0:c.body),m=fc(l);if(h){const E=YL(m);return r.concat(m,m.visualViewport||[],Dw(l)?l:[],E&&a?sw(E):[])}return r.concat(l,sw(l,[],a))}function YL(i){return i.parent&&Object.getPrototypeOf(i.parent)?i.frameElement:null}function DX(i){const r=du(i);let a=parseFloat(r.width)||0,c=parseFloat(r.height)||0;const l=wd(i),h=l?i.offsetWidth:a,m=l?i.offsetHeight:c,E=kA(a)!==h||kA(c)!==m;return E&&(a=h,c=m),{width:a,height:c,$:E}}function R2(i){return uu(i)?i:i.contextElement}function Py(i){const r=R2(i);if(!wd(r))return Ed(1);const a=r.getBoundingClientRect(),{width:c,height:l,$:h}=DX(r);let m=(h?kA(a.width):a.width)/c,E=(h?kA(a.height):a.height)/l;return(!m||!Number.isFinite(m))&&(m=1),(!E||!Number.isFinite(E))&&(E=1),{x:m,y:E}}const AEe=Ed(0);function xX(i){const r=fc(i);return!C2()||!r.visualViewport?AEe:{x:r.visualViewport.offsetLeft,y:r.visualViewport.offsetTop}}function OEe(i,r,a){return r===void 0&&(r=!1),!a||r&&a!==fc(i)?!1:r}function Ng(i,r,a,c){r===void 0&&(r=!1),a===void 0&&(a=!1);const l=i.getBoundingClientRect(),h=R2(i);let m=Ed(1);r&&(c?uu(c)&&(m=Py(c)):m=Py(i));const E=OEe(h,a,c)?xX(h):Ed(0);let S=(l.left+E.x)/m.x,T=(l.top+E.y)/m.y,C=l.width/m.x,I=l.height/m.y;if(h){const N=fc(h),P=c&&uu(c)?fc(c):c;let H=N,x=YL(H);for(;x&&c&&P!==H;){const B=Py(x),X=x.getBoundingClientRect(),Z=du(x),$=X.left+(x.clientLeft+parseFloat(Z.paddingLeft))*B.x,le=X.top+(x.clientTop+parseFloat(Z.paddingTop))*B.y;S*=B.x,T*=B.y,C*=B.x,I*=B.y,S+=$,T+=le,H=fc(x),x=YL(H)}}return xA({width:C,height:I,x:S,y:T})}function b2(i,r){const a=RO(i).scrollLeft;return r?r.left+a:Ng(Ad(i)).left+a}function LX(i,r,a){a===void 0&&(a=!1);const c=i.getBoundingClientRect(),l=c.left+r.scrollLeft-(a?0:b2(i,c)),h=c.top+r.scrollTop;return{x:l,y:h}}function NEe(i){let{elements:r,rect:a,offsetParent:c,strategy:l}=i;const h=l==="fixed",m=Ad(c),E=r?CO(r.floating):!1;if(c===m||E&&h)return a;let S={scrollLeft:0,scrollTop:0},T=Ed(1);const C=Ed(0),I=wd(c);if((I||!I&&!h)&&((av(c)!=="body"||Dw(m))&&(S=RO(c)),wd(c))){const P=Ng(c);T=Py(c),C.x=P.x+c.clientLeft,C.y=P.y+c.clientTop}const N=m&&!I&&!h?LX(m,S,!0):Ed(0);return{width:a.width*T.x,height:a.height*T.y,x:a.x*T.x-S.scrollLeft*T.x+C.x+N.x,y:a.y*T.y-S.scrollTop*T.y+C.y+N.y}}function PEe(i){return Array.from(i.getClientRects())}function kEe(i){const r=Ad(i),a=RO(i),c=i.ownerDocument.body,l=lc(r.scrollWidth,r.clientWidth,c.scrollWidth,c.clientWidth),h=lc(r.scrollHeight,r.clientHeight,c.scrollHeight,c.clientHeight);let m=-a.scrollLeft+b2(i);const E=-a.scrollTop;return du(c).direction==="rtl"&&(m+=lc(r.clientWidth,c.clientWidth)-l),{width:l,height:h,x:m,y:E}}function DEe(i,r){const a=fc(i),c=Ad(i),l=a.visualViewport;let h=c.clientWidth,m=c.clientHeight,E=0,S=0;if(l){h=l.width,m=l.height;const T=C2();(!T||T&&r==="fixed")&&(E=l.offsetLeft,S=l.offsetTop)}return{width:h,height:m,x:E,y:S}}const xEe=new Set(["absolute","fixed"]);function LEe(i,r){const a=Ng(i,!0,r==="fixed"),c=a.top+i.clientTop,l=a.left+i.clientLeft,h=wd(i)?Py(i):Ed(1),m=i.clientWidth*h.x,E=i.clientHeight*h.y,S=l*h.x,T=c*h.y;return{width:m,height:E,x:S,y:T}}function RK(i,r,a){let c;if(r==="viewport")c=DEe(i,a);else if(r==="document")c=kEe(Ad(i));else if(uu(r))c=LEe(r,a);else{const l=xX(i);c={x:r.x-l.x,y:r.y-l.y,width:r.width,height:r.height}}return xA(c)}function MX(i,r){const a=of(i);return a===r||!uu(a)||Hy(a)?!1:du(a).position==="fixed"||MX(a,r)}function MEe(i,r){const a=r.get(i);if(a)return a;let c=sw(i,[],!1).filter(E=>uu(E)&&av(E)!=="body"),l=null;const h=du(i).position==="fixed";let m=h?of(i):i;for(;uu(m)&&!Hy(m);){const E=du(m),S=w2(m);!S&&E.position==="fixed"&&(l=null),(h?!S&&!l:!S&&E.position==="static"&&!!l&&xEe.has(l.position)||Dw(m)&&!S&&MX(i,m))?c=c.filter(C=>C!==m):l=E,m=of(m)}return r.set(i,c),c}function UEe(i){let{element:r,boundary:a,rootBoundary:c,strategy:l}=i;const m=[...a==="clippingAncestors"?CO(r)?[]:MEe(r,this._c):[].concat(a),c],E=m[0],S=m.reduce((T,C)=>{const I=RK(r,C,l);return T.top=lc(I.top,T.top),T.right=af(I.right,T.right),T.bottom=af(I.bottom,T.bottom),T.left=lc(I.left,T.left),T},RK(r,E,l));return{width:S.right-S.left,height:S.bottom-S.top,x:S.left,y:S.top}}function VEe(i){const{width:r,height:a}=DX(i);return{width:r,height:a}}function FEe(i,r,a){const c=wd(r),l=Ad(r),h=a==="fixed",m=Ng(i,!0,h,r);let E={scrollLeft:0,scrollTop:0};const S=Ed(0);function T(){S.x=b2(l)}if(c||!c&&!h)if((av(r)!=="body"||Dw(l))&&(E=RO(r)),c){const P=Ng(r,!0,h,r);S.x=P.x+r.clientLeft,S.y=P.y+r.clientTop}else l&&T();h&&!c&&l&&T();const C=l&&!c&&!h?LX(l,E):Ed(0),I=m.left+E.scrollLeft-S.x-C.x,N=m.top+E.scrollTop-S.y-C.y;return{x:I,y:N,width:m.width,height:m.height}}function Ax(i){return du(i).position==="static"}function bK(i,r){if(!wd(i)||du(i).position==="fixed")return null;if(r)return r(i);let a=i.offsetParent;return Ad(i)===a&&(a=a.ownerDocument.body),a}function UX(i,r){const a=fc(i);if(CO(i))return a;if(!wd(i)){let l=of(i);for(;l&&!Hy(l);){if(uu(l)&&!Ax(l))return l;l=of(l)}return a}let c=bK(i,r);for(;c&&SEe(c)&&Ax(c);)c=bK(c,r);return c&&Hy(c)&&Ax(c)&&!w2(c)?a:c||bEe(i)||a}const jEe=async function(i){const r=this.getOffsetParent||UX,a=this.getDimensions,c=await a(i.floating);return{reference:FEe(i.reference,await r(i.floating),i.strategy),floating:{x:0,y:0,width:c.width,height:c.height}}};function BEe(i){return du(i).direction==="rtl"}const WEe={convertOffsetParentRelativeRectToViewportRelativeRect:NEe,getDocumentElement:Ad,getClippingRect:UEe,getOffsetParent:UX,getElementRects:jEe,getClientRects:PEe,getDimensions:VEe,getScale:Py,isElement:uu,isRTL:BEe};function VX(i,r){return i.x===r.x&&i.y===r.y&&i.width===r.width&&i.height===r.height}function GEe(i,r){let a=null,c;const l=Ad(i);function h(){var E;clearTimeout(c),(E=a)==null||E.disconnect(),a=null}function m(E,S){E===void 0&&(E=!1),S===void 0&&(S=1),h();const T=i.getBoundingClientRect(),{left:C,top:I,width:N,height:P}=T;if(E||r(),!N||!P)return;const H=YI(I),x=YI(l.clientWidth-(C+N)),B=YI(l.clientHeight-(I+P)),X=YI(C),$={rootMargin:-H+"px "+-x+"px "+-B+"px "+-X+"px",threshold:lc(0,af(1,S))||1};let le=!0;function re(ce){const te=ce[0].intersectionRatio;if(te!==S){if(!le)return m();te?m(!1,te):c=setTimeout(()=>{m(!1,1e-7)},1e3)}te===1&&!VX(T,i.getBoundingClientRect())&&m(),le=!1}try{a=new IntersectionObserver(re,{...$,root:l.ownerDocument})}catch{a=new IntersectionObserver(re,$)}a.observe(i)}return m(!0),h}function HEe(i,r,a,c){c===void 0&&(c={});const{ancestorScroll:l=!0,ancestorResize:h=!0,elementResize:m=typeof ResizeObserver=="function",layoutShift:E=typeof IntersectionObserver=="function",animationFrame:S=!1}=c,T=R2(i),C=l||h?[...T?sw(T):[],...sw(r)]:[];C.forEach(X=>{l&&X.addEventListener("scroll",a,{passive:!0}),h&&X.addEventListener("resize",a)});const I=T&&E?GEe(T,a):null;let N=-1,P=null;m&&(P=new ResizeObserver(X=>{let[Z]=X;Z&&Z.target===T&&P&&(P.unobserve(r),cancelAnimationFrame(N),N=requestAnimationFrame(()=>{var $;($=P)==null||$.observe(r)})),a()}),T&&!S&&P.observe(T),P.observe(r));let H,x=S?Ng(i):null;S&&B();function B(){const X=Ng(i);x&&!VX(x,X)&&a(),x=X,H=requestAnimationFrame(B)}return a(),()=>{var X;C.forEach(Z=>{l&&Z.removeEventListener("scroll",a),h&&Z.removeEventListener("resize",a)}),I?.(),(X=P)==null||X.disconnect(),P=null,S&&cancelAnimationFrame(H)}}const zEe=mEe,KEe=gEe,YEe=hEe,qEe=EEe,XEe=pEe,IK=dEe,JEe=_Ee,$Ee=(i,r,a)=>{const c=new Map,l={platform:WEe,...a},h={...l.platform,_c:c};return uEe(i,r,{...l,platform:h})};var QEe=typeof document<"u",ZEe=function(){},dA=QEe?G.useLayoutEffect:ZEe;function LA(i,r){if(i===r)return!0;if(typeof i!=typeof r)return!1;if(typeof i=="function"&&i.toString()===r.toString())return!0;let a,c,l;if(i&&r&&typeof i=="object"){if(Array.isArray(i)){if(a=i.length,a!==r.length)return!1;for(c=a;c--!==0;)if(!LA(i[c],r[c]))return!1;return!0}if(l=Object.keys(i),a=l.length,a!==Object.keys(r).length)return!1;for(c=a;c--!==0;)if(!{}.hasOwnProperty.call(r,l[c]))return!1;for(c=a;c--!==0;){const h=l[c];if(!(h==="_owner"&&i.$$typeof)&&!LA(i[h],r[h]))return!1}return!0}return i!==i&&r!==r}function FX(i){return typeof window>"u"?1:(i.ownerDocument.defaultView||window).devicePixelRatio||1}function AK(i,r){const a=FX(i);return Math.round(r*a)/a}function Ox(i){const r=G.useRef(i);return dA(()=>{r.current=i}),r}function eye(i){i===void 0&&(i={});const{placement:r="bottom",strategy:a="absolute",middleware:c=[],platform:l,elements:{reference:h,floating:m}={},transform:E=!0,whileElementsMounted:S,open:T}=i,[C,I]=G.useState({x:0,y:0,strategy:a,placement:r,middlewareData:{},isPositioned:!1}),[N,P]=G.useState(c);LA(N,c)||P(c);const[H,x]=G.useState(null),[B,X]=G.useState(null),Z=G.useCallback(Ie=>{Ie!==ce.current&&(ce.current=Ie,x(Ie))},[]),$=G.useCallback(Ie=>{Ie!==te.current&&(te.current=Ie,X(Ie))},[]),le=h||H,re=m||B,ce=G.useRef(null),te=G.useRef(null),pe=G.useRef(C),Ee=S!=null,Ne=Ox(S),Ue=Ox(l),Se=Ox(T),Xe=G.useCallback(()=>{if(!ce.current||!te.current)return;const Ie={placement:r,strategy:a,middleware:N};Ue.current&&(Ie.platform=Ue.current),$Ee(ce.current,te.current,Ie).then(Ke=>{const ae={...Ke,isPositioned:Se.current!==!1};Re.current&&!LA(pe.current,ae)&&(pe.current=ae,Ow.flushSync(()=>{I(ae)}))})},[N,r,a,Ue,Se]);dA(()=>{T===!1&&pe.current.isPositioned&&(pe.current.isPositioned=!1,I(Ie=>({...Ie,isPositioned:!1})))},[T]);const Re=G.useRef(!1);dA(()=>(Re.current=!0,()=>{Re.current=!1}),[]),dA(()=>{if(le&&(ce.current=le),re&&(te.current=re),le&&re){if(Ne.current)return Ne.current(le,re,Xe);Xe()}},[le,re,Xe,Ne,Ee]);const Be=G.useMemo(()=>({reference:ce,floating:te,setReference:Z,setFloating:$}),[Z,$]),$e=G.useMemo(()=>({reference:le,floating:re}),[le,re]),Ge=G.useMemo(()=>{const Ie={position:a,left:0,top:0};if(!$e.floating)return Ie;const Ke=AK($e.floating,C.x),ae=AK($e.floating,C.y);return E?{...Ie,transform:"translate("+Ke+"px, "+ae+"px)",...FX($e.floating)>=1.5&&{willChange:"transform"}}:{position:a,left:Ke,top:ae}},[a,E,$e.floating,C.x,C.y]);return G.useMemo(()=>({...C,update:Xe,refs:Be,elements:$e,floatingStyles:Ge}),[C,Xe,Be,$e,Ge])}const tye=i=>{function r(a){return{}.hasOwnProperty.call(a,"current")}return{name:"arrow",options:i,fn(a){const{element:c,padding:l}=typeof i=="function"?i(a):i;return c&&r(c)?c.current!=null?IK({element:c.current,padding:l}).fn(a):{}:c?IK({element:c,padding:l}).fn(a):{}}}},nye=(i,r)=>({...zEe(i),options:[i,r]}),rye=(i,r)=>({...KEe(i),options:[i,r]}),iye=(i,r)=>({...JEe(i),options:[i,r]}),sye=(i,r)=>({...YEe(i),options:[i,r]}),aye=(i,r)=>({...qEe(i),options:[i,r]}),oye=(i,r)=>({...XEe(i),options:[i,r]}),cye=(i,r)=>({...tye(i),options:[i,r]});var lye="Arrow",jX=G.forwardRef((i,r)=>{const{children:a,width:c=10,height:l=5,...h}=i;return D.jsx(ri.svg,{...h,ref:r,width:c,height:l,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:i.asChild?a:D.jsx("polygon",{points:"0,0 30,0 15,10"})})});jX.displayName=lye;var uye=jX;function BX(i){const[r,a]=G.useState(void 0);return gh(()=>{if(i){a({width:i.offsetWidth,height:i.offsetHeight});const c=new ResizeObserver(l=>{if(!Array.isArray(l)||!l.length)return;const h=l[0];let m,E;if("borderBoxSize"in h){const S=h.borderBoxSize,T=Array.isArray(S)?S[0]:S;m=T.inlineSize,E=T.blockSize}else m=i.offsetWidth,E=i.offsetHeight;a({width:m,height:E})});return c.observe(i,{box:"border-box"}),()=>c.unobserve(i)}else a(void 0)},[i]),r}var WX="Popper",[GX,HX]=mf(WX),[KUe,zX]=GX(WX),KX="PopperAnchor",YX=G.forwardRef((i,r)=>{const{__scopePopper:a,virtualRef:c,...l}=i,h=zX(KX,a),m=G.useRef(null),E=Xs(r,m);return G.useEffect(()=>{h.onAnchorChange(c?.current||m.current)}),c?null:D.jsx(ri.div,{...l,ref:E})});YX.displayName=KX;var I2="PopperContent",[dye,hye]=GX(I2),qX=G.forwardRef((i,r)=>{const{__scopePopper:a,side:c="bottom",sideOffset:l=0,align:h="center",alignOffset:m=0,arrowPadding:E=0,avoidCollisions:S=!0,collisionBoundary:T=[],collisionPadding:C=0,sticky:I="partial",hideWhenDetached:N=!1,updatePositionStrategy:P="optimized",onPlaced:H,...x}=i,B=zX(I2,a),[X,Z]=G.useState(null),$=Xs(r,At=>Z(At)),[le,re]=G.useState(null),ce=BX(le),te=ce?.width??0,pe=ce?.height??0,Ee=c+(h!=="center"?"-"+h:""),Ne=typeof C=="number"?C:{top:0,right:0,bottom:0,left:0,...C},Ue=Array.isArray(T)?T:[T],Se=Ue.length>0,Xe={padding:Ne,boundary:Ue.filter(fye),altBoundary:Se},{refs:Re,floatingStyles:Be,placement:$e,isPositioned:Ge,middlewareData:Ie}=eye({strategy:"fixed",placement:Ee,whileElementsMounted:(...At)=>HEe(...At,{animationFrame:P==="always"}),elements:{reference:B.anchor},middleware:[nye({mainAxis:l+pe,alignmentAxis:m}),S&&rye({mainAxis:!0,crossAxis:!1,limiter:I==="partial"?iye():void 0,...Xe}),S&&sye({...Xe}),aye({...Xe,apply:({elements:At,rects:dn,availableWidth:Cn,availableHeight:fr})=>{const{width:os,height:Jr}=dn.reference,Mr=At.floating.style;Mr.setProperty("--radix-popper-available-width",`${Cn}px`),Mr.setProperty("--radix-popper-available-height",`${fr}px`),Mr.setProperty("--radix-popper-anchor-width",`${os}px`),Mr.setProperty("--radix-popper-anchor-height",`${Jr}px`)}}),le&&cye({element:le,padding:E}),mye({arrowWidth:te,arrowHeight:pe}),N&&oye({strategy:"referenceHidden",...Xe})]}),[Ke,ae]=$X($e),ge=lu(H);gh(()=>{Ge&&ge?.()},[Ge,ge]);const Pe=Ie.arrow?.x,ue=Ie.arrow?.y,it=Ie.arrow?.centerOffset!==0,[yt,Dt]=G.useState();return gh(()=>{X&&Dt(window.getComputedStyle(X).zIndex)},[X]),D.jsx("div",{ref:Re.setFloating,"data-radix-popper-content-wrapper":"",style:{...Be,transform:Ge?Be.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:yt,"--radix-popper-transform-origin":[Ie.transformOrigin?.x,Ie.transformOrigin?.y].join(" "),...Ie.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:i.dir,children:D.jsx(dye,{scope:a,placedSide:Ke,onArrowChange:re,arrowX:Pe,arrowY:ue,shouldHideArrow:it,children:D.jsx(ri.div,{"data-side":Ke,"data-align":ae,...x,ref:$,style:{...x.style,animation:Ge?void 0:"none"}})})})});qX.displayName=I2;var XX="PopperArrow",pye={top:"bottom",right:"left",bottom:"top",left:"right"},JX=G.forwardRef(function(r,a){const{__scopePopper:c,...l}=r,h=hye(XX,c),m=pye[h.placedSide];return D.jsx("span",{ref:h.onArrowChange,style:{position:"absolute",left:h.arrowX,top:h.arrowY,[m]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[h.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[h.placedSide],visibility:h.shouldHideArrow?"hidden":void 0},children:D.jsx(uye,{...l,ref:a,style:{...l.style,display:"block"}})})});JX.displayName=XX;function fye(i){return i!==null}var mye=i=>({name:"transformOrigin",options:i,fn(r){const{placement:a,rects:c,middlewareData:l}=r,m=l.arrow?.centerOffset!==0,E=m?0:i.arrowWidth,S=m?0:i.arrowHeight,[T,C]=$X(a),I={start:"0%",center:"50%",end:"100%"}[C],N=(l.arrow?.x??0)+E/2,P=(l.arrow?.y??0)+S/2;let H="",x="";return T==="bottom"?(H=m?I:`${N}px`,x=`${-S}px`):T==="top"?(H=m?I:`${N}px`,x=`${c.floating.height+S}px`):T==="right"?(H=`${-S}px`,x=m?I:`${P}px`):T==="left"&&(H=`${c.floating.width+S}px`,x=m?I:`${P}px`),{data:{x:H,y:x}}}});function $X(i){const[r,a="center"]=i.split("-");return[r,a]}var gye=YX,_ye=qX,Eye=JX,[bO]=mf("Tooltip",[HX]),A2=HX(),QX="TooltipProvider",yye=700,OK="tooltip.open",[vye,ZX]=bO(QX),eJ=i=>{const{__scopeTooltip:r,delayDuration:a=yye,skipDelayDuration:c=300,disableHoverableContent:l=!1,children:h}=i,m=G.useRef(!0),E=G.useRef(!1),S=G.useRef(0);return G.useEffect(()=>{const T=S.current;return()=>window.clearTimeout(T)},[]),D.jsx(vye,{scope:r,isOpenDelayedRef:m,delayDuration:a,onOpen:G.useCallback(()=>{window.clearTimeout(S.current),m.current=!1},[]),onClose:G.useCallback(()=>{window.clearTimeout(S.current),S.current=window.setTimeout(()=>m.current=!0,c)},[c]),isPointerInTransitRef:E,onPointerInTransitChange:G.useCallback(T=>{E.current=T},[]),disableHoverableContent:l,children:h})};eJ.displayName=QX;var tJ="Tooltip",[YUe,IO]=bO(tJ),qL="TooltipTrigger",Sye=G.forwardRef((i,r)=>{const{__scopeTooltip:a,...c}=i,l=IO(qL,a),h=ZX(qL,a),m=A2(a),E=G.useRef(null),S=Xs(r,E,l.onTriggerChange),T=G.useRef(!1),C=G.useRef(!1),I=G.useCallback(()=>T.current=!1,[]);return G.useEffect(()=>()=>document.removeEventListener("pointerup",I),[I]),D.jsx(gye,{asChild:!0,...m,children:D.jsx(ri.button,{"aria-describedby":l.open?l.contentId:void 0,"data-state":l.stateAttribute,...c,ref:S,onPointerMove:vr(i.onPointerMove,N=>{N.pointerType!=="touch"&&!C.current&&!h.isPointerInTransitRef.current&&(l.onTriggerEnter(),C.current=!0)}),onPointerLeave:vr(i.onPointerLeave,()=>{l.onTriggerLeave(),C.current=!1}),onPointerDown:vr(i.onPointerDown,()=>{l.open&&l.onClose(),T.current=!0,document.addEventListener("pointerup",I,{once:!0})}),onFocus:vr(i.onFocus,()=>{T.current||l.onOpen()}),onBlur:vr(i.onBlur,l.onClose),onClick:vr(i.onClick,l.onClose)})})});Sye.displayName=qL;var Tye="TooltipPortal",[qUe,wye]=bO(Tye,{forceMount:void 0}),zy="TooltipContent",nJ=G.forwardRef((i,r)=>{const a=wye(zy,i.__scopeTooltip),{forceMount:c=a.forceMount,side:l="top",...h}=i,m=IO(zy,i.__scopeTooltip);return D.jsx(Fg,{present:c||m.open,children:m.disableHoverableContent?D.jsx(rJ,{side:l,...h,ref:r}):D.jsx(Cye,{side:l,...h,ref:r})})}),Cye=G.forwardRef((i,r)=>{const a=IO(zy,i.__scopeTooltip),c=ZX(zy,i.__scopeTooltip),l=G.useRef(null),h=Xs(r,l),[m,E]=G.useState(null),{trigger:S,onClose:T}=a,C=l.current,{onPointerInTransitChange:I}=c,N=G.useCallback(()=>{E(null),I(!1)},[I]),P=G.useCallback((H,x)=>{const B=H.currentTarget,X={x:H.clientX,y:H.clientY},Z=Oye(X,B.getBoundingClientRect()),$=Nye(X,Z),le=Pye(x.getBoundingClientRect()),re=Dye([...$,...le]);E(re),I(!0)},[I]);return G.useEffect(()=>()=>N(),[N]),G.useEffect(()=>{if(S&&C){const H=B=>P(B,C),x=B=>P(B,S);return S.addEventListener("pointerleave",H),C.addEventListener("pointerleave",x),()=>{S.removeEventListener("pointerleave",H),C.removeEventListener("pointerleave",x)}}},[S,C,P,N]),G.useEffect(()=>{if(m){const H=x=>{const B=x.target,X={x:x.clientX,y:x.clientY},Z=S?.contains(B)||C?.contains(B),$=!kye(X,m);Z?N():$&&(N(),T())};return document.addEventListener("pointermove",H),()=>document.removeEventListener("pointermove",H)}},[S,C,m,T,N]),D.jsx(rJ,{...i,ref:h})}),[Rye,bye]=bO(tJ,{isInside:!1}),Iye=gme("TooltipContent"),rJ=G.forwardRef((i,r)=>{const{__scopeTooltip:a,children:c,"aria-label":l,onEscapeKeyDown:h,onPointerDownOutside:m,...E}=i,S=IO(zy,a),T=A2(a),{onClose:C}=S;return G.useEffect(()=>(document.addEventListener(OK,C),()=>document.removeEventListener(OK,C)),[C]),G.useEffect(()=>{if(S.trigger){const I=N=>{N.target?.contains(S.trigger)&&C()};return window.addEventListener("scroll",I,{capture:!0}),()=>window.removeEventListener("scroll",I,{capture:!0})}},[S.trigger,C]),D.jsx(_O,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:h,onPointerDownOutside:m,onFocusOutside:I=>I.preventDefault(),onDismiss:C,children:D.jsxs(_ye,{"data-state":S.stateAttribute,...T,...E,ref:r,style:{...E.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[D.jsx(Iye,{children:c}),D.jsx(Rye,{scope:a,isInside:!0,children:D.jsx(Fme,{id:S.contentId,role:"tooltip",children:l||c})})]})})});nJ.displayName=zy;var iJ="TooltipArrow",Aye=G.forwardRef((i,r)=>{const{__scopeTooltip:a,...c}=i,l=A2(a);return bye(iJ,a).isInside?null:D.jsx(Eye,{...l,...c,ref:r})});Aye.displayName=iJ;function Oye(i,r){const a=Math.abs(r.top-i.y),c=Math.abs(r.bottom-i.y),l=Math.abs(r.right-i.x),h=Math.abs(r.left-i.x);switch(Math.min(a,c,l,h)){case h:return"left";case l:return"right";case a:return"top";case c:return"bottom";default:throw new Error("unreachable")}}function Nye(i,r,a=5){const c=[];switch(r){case"top":c.push({x:i.x-a,y:i.y+a},{x:i.x+a,y:i.y+a});break;case"bottom":c.push({x:i.x-a,y:i.y-a},{x:i.x+a,y:i.y-a});break;case"left":c.push({x:i.x+a,y:i.y-a},{x:i.x+a,y:i.y+a});break;case"right":c.push({x:i.x-a,y:i.y-a},{x:i.x-a,y:i.y+a});break}return c}function Pye(i){const{top:r,right:a,bottom:c,left:l}=i;return[{x:l,y:r},{x:a,y:r},{x:a,y:c},{x:l,y:c}]}function kye(i,r){const{x:a,y:c}=i;let l=!1;for(let h=0,m=r.length-1;h<r.length;m=h++){const E=r[h],S=r[m],T=E.x,C=E.y,I=S.x,N=S.y;C>c!=N>c&&a<(I-T)*(c-C)/(N-C)+T&&(l=!l)}return l}function Dye(i){const r=i.slice();return r.sort((a,c)=>a.x<c.x?-1:a.x>c.x?1:a.y<c.y?-1:a.y>c.y?1:0),xye(r)}function xye(i){if(i.length<=1)return i.slice();const r=[];for(let c=0;c<i.length;c++){const l=i[c];for(;r.length>=2;){const h=r[r.length-1],m=r[r.length-2];if((h.x-m.x)*(l.y-m.y)>=(h.y-m.y)*(l.x-m.x))r.pop();else break}r.push(l)}r.pop();const a=[];for(let c=i.length-1;c>=0;c--){const l=i[c];for(;a.length>=2;){const h=a[a.length-1],m=a[a.length-2];if((h.x-m.x)*(l.y-m.y)>=(h.y-m.y)*(l.x-m.x))a.pop();else break}a.push(l)}return a.pop(),r.length===1&&a.length===1&&r[0].x===a[0].x&&r[0].y===a[0].y?r:r.concat(a)}var Lye=eJ,sJ=nJ;const Mye=Lye,Uye=G.forwardRef(({className:i,sideOffset:r=4,...a},c)=>D.jsx(sJ,{ref:c,sideOffset:r,className:Br("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",i),...a}));Uye.displayName=sJ.displayName;function Ui(){return Ui=Object.assign?Object.assign.bind():function(i){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(i[c]=a[c])}return i},Ui.apply(this,arguments)}var Ss;(function(i){i.Pop="POP",i.Push="PUSH",i.Replace="REPLACE"})(Ss||(Ss={}));const NK="popstate";function Vye(i){i===void 0&&(i={});function r(l,h){let{pathname:m="/",search:E="",hash:S=""}=Ih(l.location.hash.substr(1));return!m.startsWith("/")&&!m.startsWith(".")&&(m="/"+m),aw("",{pathname:m,search:E,hash:S},h.state&&h.state.usr||null,h.state&&h.state.key||"default")}function a(l,h){let m=l.document.querySelector("base"),E="";if(m&&m.getAttribute("href")){let S=l.location.href,T=S.indexOf("#");E=T===-1?S:S.slice(0,T)}return E+"#"+(typeof h=="string"?h:kg(h))}function c(l,h){Pg(l.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(h)+")")}return jye(r,a,c,i)}function ur(i,r){if(i===!1||i===null||typeof i>"u")throw new Error(r)}function Pg(i,r){if(!i){typeof console<"u"&&console.warn(r);try{throw new Error(r)}catch{}}}function Fye(){return Math.random().toString(36).substr(2,8)}function PK(i,r){return{usr:i.state,key:i.key,idx:r}}function aw(i,r,a,c){return a===void 0&&(a=null),Ui({pathname:typeof i=="string"?i:i.pathname,search:"",hash:""},typeof r=="string"?Ih(r):r,{state:a,key:r&&r.key||c||Fye()})}function kg(i){let{pathname:r="/",search:a="",hash:c=""}=i;return a&&a!=="?"&&(r+=a.charAt(0)==="?"?a:"?"+a),c&&c!=="#"&&(r+=c.charAt(0)==="#"?c:"#"+c),r}function Ih(i){let r={};if(i){let a=i.indexOf("#");a>=0&&(r.hash=i.substr(a),i=i.substr(0,a));let c=i.indexOf("?");c>=0&&(r.search=i.substr(c),i=i.substr(0,c)),i&&(r.pathname=i)}return r}function jye(i,r,a,c){c===void 0&&(c={});let{window:l=document.defaultView,v5Compat:h=!1}=c,m=l.history,E=Ss.Pop,S=null,T=C();T==null&&(T=0,m.replaceState(Ui({},m.state,{idx:T}),""));function C(){return(m.state||{idx:null}).idx}function I(){E=Ss.Pop;let B=C(),X=B==null?null:B-T;T=B,S&&S({action:E,location:x.location,delta:X})}function N(B,X){E=Ss.Push;let Z=aw(x.location,B,X);a&&a(Z,B),T=C()+1;let $=PK(Z,T),le=x.createHref(Z);try{m.pushState($,"",le)}catch(re){if(re instanceof DOMException&&re.name==="DataCloneError")throw re;l.location.assign(le)}h&&S&&S({action:E,location:x.location,delta:1})}function P(B,X){E=Ss.Replace;let Z=aw(x.location,B,X);a&&a(Z,B),T=C();let $=PK(Z,T),le=x.createHref(Z);m.replaceState($,"",le),h&&S&&S({action:E,location:x.location,delta:0})}function H(B){let X=l.location.origin!=="null"?l.location.origin:l.location.href,Z=typeof B=="string"?B:kg(B);return Z=Z.replace(/ $/,"%20"),ur(X,"No window.location.(origin|href) available to create URL for href: "+Z),new URL(Z,X)}let x={get action(){return E},get location(){return i(l,m)},listen(B){if(S)throw new Error("A history only accepts one active listener");return l.addEventListener(NK,I),S=B,()=>{l.removeEventListener(NK,I),S=null}},createHref(B){return r(l,B)},createURL:H,encodeLocation(B){let X=H(B);return{pathname:X.pathname,search:X.search,hash:X.hash}},push:N,replace:P,go(B){return m.go(B)}};return x}var Xr;(function(i){i.data="data",i.deferred="deferred",i.redirect="redirect",i.error="error"})(Xr||(Xr={}));const Bye=new Set(["lazy","caseSensitive","path","id","index","children"]);function Wye(i){return i.index===!0}function MA(i,r,a,c){return a===void 0&&(a=[]),c===void 0&&(c={}),i.map((l,h)=>{let m=[...a,String(h)],E=typeof l.id=="string"?l.id:m.join("-");if(ur(l.index!==!0||!l.children,"Cannot specify children on an index route"),ur(!c[E],'Found a route id collision on id "'+E+`".  Route id's must be globally unique within Data Router usages`),Wye(l)){let S=Ui({},l,r(l),{id:E});return c[E]=S,S}else{let S=Ui({},l,r(l),{id:E,children:void 0});return c[E]=S,l.children&&(S.children=MA(l.children,r,m,c)),S}})}function gg(i,r,a){return a===void 0&&(a="/"),hA(i,r,a,!1)}function hA(i,r,a,c){let l=typeof r=="string"?Ih(r):r,h=ov(l.pathname||"/",a);if(h==null)return null;let m=aJ(i);Hye(m);let E=null;for(let S=0;E==null&&S<m.length;++S){let T=tve(h);E=Zye(m[S],T,c)}return E}function Gye(i,r){let{route:a,pathname:c,params:l}=i;return{id:a.id,pathname:c,params:l,data:r[a.id],handle:a.handle}}function aJ(i,r,a,c){r===void 0&&(r=[]),a===void 0&&(a=[]),c===void 0&&(c="");let l=(h,m,E)=>{let S={relativePath:E===void 0?h.path||"":E,caseSensitive:h.caseSensitive===!0,childrenIndex:m,route:h};S.relativePath.startsWith("/")&&(ur(S.relativePath.startsWith(c),'Absolute route path "'+S.relativePath+'" nested under path '+('"'+c+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),S.relativePath=S.relativePath.slice(c.length));let T=mh([c,S.relativePath]),C=a.concat(S);h.children&&h.children.length>0&&(ur(h.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+T+'".')),aJ(h.children,r,C,T)),!(h.path==null&&!h.index)&&r.push({path:T,score:$ye(T,h.index),routesMeta:C})};return i.forEach((h,m)=>{var E;if(h.path===""||!((E=h.path)!=null&&E.includes("?")))l(h,m);else for(let S of oJ(h.path))l(h,m,S)}),r}function oJ(i){let r=i.split("/");if(r.length===0)return[];let[a,...c]=r,l=a.endsWith("?"),h=a.replace(/\?$/,"");if(c.length===0)return l?[h,""]:[h];let m=oJ(c.join("/")),E=[];return E.push(...m.map(S=>S===""?h:[h,S].join("/"))),l&&E.push(...m),E.map(S=>i.startsWith("/")&&S===""?"/":S)}function Hye(i){i.sort((r,a)=>r.score!==a.score?a.score-r.score:Qye(r.routesMeta.map(c=>c.childrenIndex),a.routesMeta.map(c=>c.childrenIndex)))}const zye=/^:[\w-]+$/,Kye=3,Yye=2,qye=1,Xye=10,Jye=-2,kK=i=>i==="*";function $ye(i,r){let a=i.split("/"),c=a.length;return a.some(kK)&&(c+=Jye),r&&(c+=Yye),a.filter(l=>!kK(l)).reduce((l,h)=>l+(zye.test(h)?Kye:h===""?qye:Xye),c)}function Qye(i,r){return i.length===r.length&&i.slice(0,-1).every((c,l)=>c===r[l])?i[i.length-1]-r[r.length-1]:0}function Zye(i,r,a){a===void 0&&(a=!1);let{routesMeta:c}=i,l={},h="/",m=[];for(let E=0;E<c.length;++E){let S=c[E],T=E===c.length-1,C=h==="/"?r:r.slice(h.length)||"/",I=DK({path:S.relativePath,caseSensitive:S.caseSensitive,end:T},C),N=S.route;if(!I&&T&&a&&!c[c.length-1].route.index&&(I=DK({path:S.relativePath,caseSensitive:S.caseSensitive,end:!1},C)),!I)return null;Object.assign(l,I.params),m.push({params:l,pathname:mh([h,I.pathname]),pathnameBase:ive(mh([h,I.pathnameBase])),route:N}),I.pathnameBase!=="/"&&(h=mh([h,I.pathnameBase]))}return m}function DK(i,r){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[a,c]=eve(i.path,i.caseSensitive,i.end),l=r.match(a);if(!l)return null;let h=l[0],m=h.replace(/(.)\/+$/,"$1"),E=l.slice(1);return{params:c.reduce((T,C,I)=>{let{paramName:N,isOptional:P}=C;if(N==="*"){let x=E[I]||"";m=h.slice(0,h.length-x.length).replace(/(.)\/+$/,"$1")}const H=E[I];return P&&!H?T[N]=void 0:T[N]=(H||"").replace(/%2F/g,"/"),T},{}),pathname:h,pathnameBase:m,pattern:i}}function eve(i,r,a){r===void 0&&(r=!1),a===void 0&&(a=!0),Pg(i==="*"||!i.endsWith("*")||i.endsWith("/*"),'Route path "'+i+'" will be treated as if it were '+('"'+i.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+i.replace(/\*$/,"/*")+'".'));let c=[],l="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(m,E,S)=>(c.push({paramName:E,isOptional:S!=null}),S?"/?([^\\/]+)?":"/([^\\/]+)"));return i.endsWith("*")?(c.push({paramName:"*"}),l+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):a?l+="\\/*$":i!==""&&i!=="/"&&(l+="(?:(?=\\/|$))"),[new RegExp(l,r?void 0:"i"),c]}function tve(i){try{return i.split("/").map(r=>decodeURIComponent(r).replace(/\//g,"%2F")).join("/")}catch(r){return Pg(!1,'The URL path "'+i+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+r+").")),i}}function ov(i,r){if(r==="/")return i;if(!i.toLowerCase().startsWith(r.toLowerCase()))return null;let a=r.endsWith("/")?r.length-1:r.length,c=i.charAt(a);return c&&c!=="/"?null:i.slice(a)||"/"}function nve(i,r){r===void 0&&(r="/");let{pathname:a,search:c="",hash:l=""}=typeof i=="string"?Ih(i):i;return{pathname:a?a.startsWith("/")?a:rve(a,r):r,search:sve(c),hash:ave(l)}}function rve(i,r){let a=r.replace(/\/+$/,"").split("/");return i.split("/").forEach(l=>{l===".."?a.length>1&&a.pop():l!=="."&&a.push(l)}),a.length>1?a.join("/"):"/"}function Nx(i,r,a,c){return"Cannot include a '"+i+"' character in a manually specified "+("`to."+r+"` field ["+JSON.stringify(c)+"].  Please separate it out to the ")+("`to."+a+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function cJ(i){return i.filter((r,a)=>a===0||r.route.path&&r.route.path.length>0)}function AO(i,r){let a=cJ(i);return r?a.map((c,l)=>l===a.length-1?c.pathname:c.pathnameBase):a.map(c=>c.pathnameBase)}function OO(i,r,a,c){c===void 0&&(c=!1);let l;typeof i=="string"?l=Ih(i):(l=Ui({},i),ur(!l.pathname||!l.pathname.includes("?"),Nx("?","pathname","search",l)),ur(!l.pathname||!l.pathname.includes("#"),Nx("#","pathname","hash",l)),ur(!l.search||!l.search.includes("#"),Nx("#","search","hash",l)));let h=i===""||l.pathname==="",m=h?"/":l.pathname,E;if(m==null)E=a;else{let I=r.length-1;if(!c&&m.startsWith("..")){let N=m.split("/");for(;N[0]==="..";)N.shift(),I-=1;l.pathname=N.join("/")}E=I>=0?r[I]:"/"}let S=nve(l,E),T=m&&m!=="/"&&m.endsWith("/"),C=(h||m===".")&&a.endsWith("/");return!S.pathname.endsWith("/")&&(T||C)&&(S.pathname+="/"),S}const mh=i=>i.join("/").replace(/\/\/+/g,"/"),ive=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),sve=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,ave=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i;class UA{constructor(r,a,c,l){l===void 0&&(l=!1),this.status=r,this.statusText=a||"",this.internal=l,c instanceof Error?(this.data=c.toString(),this.error=c):this.data=c}}function ow(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}const lJ=["post","put","patch","delete"],ove=new Set(lJ),cve=["get",...lJ],lve=new Set(cve),uve=new Set([301,302,303,307,308]),dve=new Set([307,308]),Px={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},hve={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},y0={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},O2=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,pve=i=>({hasErrorBoundary:!!i.hasErrorBoundary}),uJ="remix-router-transitions";function fve(i){const r=i.window?i.window:typeof window<"u"?window:void 0,a=typeof r<"u"&&typeof r.document<"u"&&typeof r.document.createElement<"u",c=!a;ur(i.routes.length>0,"You must provide a non-empty routes array to createRouter");let l;if(i.mapRouteProperties)l=i.mapRouteProperties;else if(i.detectErrorBoundary){let ye=i.detectErrorBoundary;l=be=>({hasErrorBoundary:ye(be)})}else l=pve;let h={},m=MA(i.routes,l,void 0,h),E,S=i.basename||"/",T=i.dataStrategy||Eve,C=i.patchRoutesOnNavigation,I=Ui({v7_fetcherPersist:!1,v7_normalizeFormMethod:!1,v7_partialHydration:!1,v7_prependBasename:!1,v7_relativeSplatPath:!1,v7_skipActionErrorRevalidation:!1},i.future),N=null,P=new Set,H=null,x=null,B=null,X=i.hydrationData!=null,Z=gg(m,i.history.location,S),$=!1,le=null;if(Z==null&&!C){let ye=bo(404,{pathname:i.history.location.pathname}),{matches:be,route:je}=HK(m);Z=be,le={[je.id]:ye}}Z&&!i.hydrationData&&mr(Z,m,i.history.location.pathname).active&&(Z=null);let re;if(Z)if(Z.some(ye=>ye.route.lazy))re=!1;else if(!Z.some(ye=>ye.route.loader))re=!0;else if(I.v7_partialHydration){let ye=i.hydrationData?i.hydrationData.loaderData:null,be=i.hydrationData?i.hydrationData.errors:null;if(be){let je=Z.findIndex(st=>be[st.route.id]!==void 0);re=Z.slice(0,je+1).every(st=>!JL(st.route,ye,be))}else re=Z.every(je=>!JL(je.route,ye,be))}else re=i.hydrationData!=null;else if(re=!1,Z=[],I.v7_partialHydration){let ye=mr(null,m,i.history.location.pathname);ye.active&&ye.matches&&($=!0,Z=ye.matches)}let ce,te={historyAction:i.history.action,location:i.history.location,matches:Z,initialized:re,navigation:Px,restoreScrollPosition:i.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:i.hydrationData&&i.hydrationData.loaderData||{},actionData:i.hydrationData&&i.hydrationData.actionData||null,errors:i.hydrationData&&i.hydrationData.errors||le,fetchers:new Map,blockers:new Map},pe=Ss.Pop,Ee=!1,Ne,Ue=!1,Se=new Map,Xe=null,Re=!1,Be=!1,$e=[],Ge=new Set,Ie=new Map,Ke=0,ae=-1,ge=new Map,Pe=new Set,ue=new Map,it=new Map,yt=new Set,Dt=new Map,At=new Map,dn;function Cn(){if(N=i.history.listen(ye=>{let{action:be,location:je,delta:st}=ye;if(dn){dn(),dn=void 0;return}Pg(At.size===0||st!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let St=fl({currentLocation:te.location,nextLocation:je,historyAction:be});if(St&&st!=null){let Yt=new Promise(hn=>{dn=hn});i.history.go(st*-1),no(St,{state:"blocked",location:je,proceed(){no(St,{state:"proceeding",proceed:void 0,reset:void 0,location:je}),Yt.then(()=>i.history.go(st))},reset(){let hn=new Map(te.blockers);hn.set(St,y0),Jr({blockers:hn})}});return}return yi(be,je)}),a){kve(r,Se);let ye=()=>Dve(r,Se);r.addEventListener("pagehide",ye),Xe=()=>r.removeEventListener("pagehide",ye)}return te.initialized||yi(Ss.Pop,te.location,{initialHydration:!0}),ce}function fr(){N&&N(),Xe&&Xe(),P.clear(),Ne&&Ne.abort(),te.fetchers.forEach((ye,be)=>ii(be)),te.blockers.forEach((ye,be)=>vi(be))}function os(ye){return P.add(ye),()=>P.delete(ye)}function Jr(ye,be){be===void 0&&(be={}),te=Ui({},te,ye);let je=[],st=[];I.v7_fetcherPersist&&te.fetchers.forEach((St,Yt)=>{St.state==="idle"&&(yt.has(Yt)?st.push(Yt):je.push(Yt))}),yt.forEach(St=>{!te.fetchers.has(St)&&!Ie.has(St)&&st.push(St)}),[...P].forEach(St=>St(te,{deletedFetchers:st,viewTransitionOpts:be.viewTransitionOpts,flushSync:be.flushSync===!0})),I.v7_fetcherPersist?(je.forEach(St=>te.fetchers.delete(St)),st.forEach(St=>ii(St))):st.forEach(St=>yt.delete(St))}function Mr(ye,be,je){var st,St;let{flushSync:Yt}=je===void 0?{}:je,hn=te.actionData!=null&&te.navigation.formMethod!=null&&au(te.navigation.formMethod)&&te.navigation.state==="loading"&&((st=ye.state)==null?void 0:st._isRedirect)!==!0,Ut;be.actionData?Object.keys(be.actionData).length>0?Ut=be.actionData:Ut=null:hn?Ut=te.actionData:Ut=null;let Wt=be.loaderData?WK(te.loaderData,be.loaderData,be.matches||[],be.errors):te.loaderData,xt=te.blockers;xt.size>0&&(xt=new Map(xt),xt.forEach((Kn,Qi)=>xt.set(Qi,y0)));let Vt=Ee===!0||te.navigation.formMethod!=null&&au(te.navigation.formMethod)&&((St=ye.state)==null?void 0:St._isRedirect)!==!0;E&&(m=E,E=void 0),Re||pe===Ss.Pop||(pe===Ss.Push?i.history.push(ye,ye.state):pe===Ss.Replace&&i.history.replace(ye,ye.state));let Rn;if(pe===Ss.Pop){let Kn=Se.get(te.location.pathname);Kn&&Kn.has(ye.pathname)?Rn={currentLocation:te.location,nextLocation:ye}:Se.has(ye.pathname)&&(Rn={currentLocation:ye,nextLocation:te.location})}else if(Ue){let Kn=Se.get(te.location.pathname);Kn?Kn.add(ye.pathname):(Kn=new Set([ye.pathname]),Se.set(te.location.pathname,Kn)),Rn={currentLocation:te.location,nextLocation:ye}}Jr(Ui({},be,{actionData:Ut,loaderData:Wt,historyAction:pe,location:ye,initialized:!0,navigation:Px,revalidation:"idle",restoreScrollPosition:Bn(ye,be.matches||te.matches),preventScrollReset:Vt,blockers:xt}),{viewTransitionOpts:Rn,flushSync:Yt===!0}),pe=Ss.Pop,Ee=!1,Ue=!1,Re=!1,Be=!1,$e=[]}async function Tc(ye,be){if(typeof ye=="number"){i.history.go(ye);return}let je=XL(te.location,te.matches,S,I.v7_prependBasename,ye,I.v7_relativeSplatPath,be?.fromRouteId,be?.relative),{path:st,submission:St,error:Yt}=xK(I.v7_normalizeFormMethod,!1,je,be),hn=te.location,Ut=aw(te.location,st,be&&be.state);Ut=Ui({},Ut,i.history.encodeLocation(Ut));let Wt=be&&be.replace!=null?be.replace:void 0,xt=Ss.Push;Wt===!0?xt=Ss.Replace:Wt===!1||St!=null&&au(St.formMethod)&&St.formAction===te.location.pathname+te.location.search&&(xt=Ss.Replace);let Vt=be&&"preventScrollReset"in be?be.preventScrollReset===!0:void 0,Rn=(be&&be.flushSync)===!0,Kn=fl({currentLocation:hn,nextLocation:Ut,historyAction:xt});if(Kn){no(Kn,{state:"blocked",location:Ut,proceed(){no(Kn,{state:"proceeding",proceed:void 0,reset:void 0,location:Ut}),Tc(ye,be)},reset(){let Qi=new Map(te.blockers);Qi.set(Kn,y0),Jr({blockers:Qi})}});return}return await yi(xt,Ut,{submission:St,pendingError:Yt,preventScrollReset:Vt,replace:be&&be.replace,enableViewTransition:be&&be.viewTransition,flushSync:Rn})}function pl(){if(lt(),Jr({revalidation:"loading"}),te.navigation.state!=="submitting"){if(te.navigation.state==="idle"){yi(te.historyAction,te.location,{startUninterruptedRevalidation:!0});return}yi(pe||te.historyAction,te.navigation.location,{overrideNavigation:te.navigation,enableViewTransition:Ue===!0})}}async function yi(ye,be,je){Ne&&Ne.abort(),Ne=null,pe=ye,Re=(je&&je.startUninterruptedRevalidation)===!0,mn(te.location,te.matches),Ee=(je&&je.preventScrollReset)===!0,Ue=(je&&je.enableViewTransition)===!0;let st=E||m,St=je&&je.overrideNavigation,Yt=je!=null&&je.initialHydration&&te.matches&&te.matches.length>0&&!$?te.matches:gg(st,be,S),hn=(je&&je.flushSync)===!0;if(Yt&&te.initialized&&!Be&&Cve(te.location,be)&&!(je&&je.submission&&au(je.submission.formMethod))){Mr(be,{matches:Yt},{flushSync:hn});return}let Ut=mr(Yt,st,be.pathname);if(Ut.active&&Ut.matches&&(Yt=Ut.matches),!Yt){let{error:Sr,notFoundMatches:ir,route:Ar}=ro(be.pathname);Mr(be,{matches:ir,loaderData:{},errors:{[Ar.id]:Sr}},{flushSync:hn});return}Ne=new AbortController;let Wt=uy(i.history,be,Ne.signal,je&&je.submission),xt;if(je&&je.pendingError)xt=[_g(Yt).route.id,{type:Xr.error,error:je.pendingError}];else if(je&&je.submission&&au(je.submission.formMethod)){let Sr=await wc(Wt,be,je.submission,Yt,Ut.active,{replace:je.replace,flushSync:hn});if(Sr.shortCircuited)return;if(Sr.pendingActionResult){let[ir,Ar]=Sr.pendingActionResult;if(oc(Ar)&&ow(Ar.error)&&Ar.error.status===404){Ne=null,Mr(be,{matches:Sr.matches,loaderData:{},errors:{[ir]:Ar.error}});return}}Yt=Sr.matches||Yt,xt=Sr.pendingActionResult,St=kx(be,je.submission),hn=!1,Ut.active=!1,Wt=uy(i.history,Wt.url,Wt.signal)}let{shortCircuited:Vt,matches:Rn,loaderData:Kn,errors:Qi}=await Wr(Wt,be,Yt,Ut.active,St,je&&je.submission,je&&je.fetcherSubmission,je&&je.replace,je&&je.initialHydration===!0,hn,xt);Vt||(Ne=null,Mr(be,Ui({matches:Rn||Yt},GK(xt),{loaderData:Kn,errors:Qi})))}async function wc(ye,be,je,st,St,Yt){Yt===void 0&&(Yt={}),lt();let hn=Nve(be,je);if(Jr({navigation:hn},{flushSync:Yt.flushSync===!0}),St){let xt=await $i(st,be.pathname,ye.signal);if(xt.type==="aborted")return{shortCircuited:!0};if(xt.type==="error"){let Vt=_g(xt.partialMatches).route.id;return{matches:xt.partialMatches,pendingActionResult:[Vt,{type:Xr.error,error:xt.error}]}}else if(xt.matches)st=xt.matches;else{let{notFoundMatches:Vt,error:Rn,route:Kn}=ro(be.pathname);return{matches:Vt,pendingActionResult:[Kn.id,{type:Xr.error,error:Rn}]}}}let Ut,Wt=O0(st,be);if(!Wt.route.action&&!Wt.route.lazy)Ut={type:Xr.error,error:bo(405,{method:ye.method,pathname:be.pathname,routeId:Wt.route.id})};else if(Ut=(await Ua("action",te,ye,[Wt],st,null))[Wt.route.id],ye.signal.aborted)return{shortCircuited:!0};if(Eg(Ut)){let xt;return Yt&&Yt.replace!=null?xt=Yt.replace:xt=FK(Ut.response.headers.get("Location"),new URL(ye.url),S)===te.location.pathname+te.location.search,await Ir(ye,Ut,!0,{submission:je,replace:xt}),{shortCircuited:!0}}if(Xp(Ut))throw bo(400,{type:"defer-action"});if(oc(Ut)){let xt=_g(st,Wt.route.id);return(Yt&&Yt.replace)!==!0&&(pe=Ss.Push),{matches:st,pendingActionResult:[xt.route.id,Ut]}}return{matches:st,pendingActionResult:[Wt.route.id,Ut]}}async function Wr(ye,be,je,st,St,Yt,hn,Ut,Wt,xt,Vt){let Rn=St||kx(be,Yt),Kn=Yt||hn||KK(Rn),Qi=!Re&&(!I.v7_partialHydration||!Wt);if(st){if(Qi){let Dr=fi(Vt);Jr(Ui({navigation:Rn},Dr!==void 0?{actionData:Dr}:{}),{flushSync:xt})}let sr=await $i(je,be.pathname,ye.signal);if(sr.type==="aborted")return{shortCircuited:!0};if(sr.type==="error"){let Dr=_g(sr.partialMatches).route.id;return{matches:sr.partialMatches,loaderData:{},errors:{[Dr]:sr.error}}}else if(sr.matches)je=sr.matches;else{let{error:Dr,notFoundMatches:bs,route:fu}=ro(be.pathname);return{matches:bs,loaderData:{},errors:{[fu.id]:Dr}}}}let Sr=E||m,[ir,Ar]=MK(i.history,te,je,Kn,be,I.v7_partialHydration&&Wt===!0,I.v7_skipActionErrorRevalidation,Be,$e,Ge,yt,ue,Pe,Sr,S,Vt);if(ya(sr=>!(je&&je.some(Dr=>Dr.route.id===sr))||ir&&ir.some(Dr=>Dr.route.id===sr)),ae=++Ke,ir.length===0&&Ar.length===0){let sr=_a();return Mr(be,Ui({matches:je,loaderData:{},errors:Vt&&oc(Vt[1])?{[Vt[0]]:Vt[1].error}:null},GK(Vt),sr?{fetchers:new Map(te.fetchers)}:{}),{flushSync:xt}),{shortCircuited:!0}}if(Qi){let sr={};if(!st){sr.navigation=Rn;let Dr=fi(Vt);Dr!==void 0&&(sr.actionData=Dr)}Ar.length>0&&(sr.fetchers=$s(Ar)),Jr(sr,{flushSync:xt})}Ar.forEach(sr=>{$r(sr.key),sr.controller&&Ie.set(sr.key,sr.controller)});let ml=()=>Ar.forEach(sr=>$r(sr.key));Ne&&Ne.signal.addEventListener("abort",ml);let{loaderResults:Nd,fetcherResults:Zi}=await qe(te,je,ir,Ar,ye);if(ye.signal.aborted)return{shortCircuited:!0};Ne&&Ne.signal.removeEventListener("abort",ml),Ar.forEach(sr=>Ie.delete(sr.key));let gr=qI(Nd);if(gr)return await Ir(ye,gr.result,!0,{replace:Ut}),{shortCircuited:!0};if(gr=qI(Zi),gr)return Pe.add(gr.key),await Ir(ye,gr.result,!0,{replace:Ut}),{shortCircuited:!0};let{loaderData:Cf,errors:Ur}=BK(te,je,Nd,Vt,Ar,Zi,Dt);Dt.forEach((sr,Dr)=>{sr.subscribe(bs=>{(bs||sr.done)&&Dt.delete(Dr)})}),I.v7_partialHydration&&Wt&&te.errors&&(Ur=Ui({},te.errors,Ur));let Rc=_a(),gl=Gr(ae),Ah=Rc||gl||Ar.length>0;return Ui({matches:je,loaderData:Cf,errors:Ur},Ah?{fetchers:new Map(te.fetchers)}:{})}function fi(ye){if(ye&&!oc(ye[1]))return{[ye[0]]:ye[1].data};if(te.actionData)return Object.keys(te.actionData).length===0?null:te.actionData}function $s(ye){return ye.forEach(be=>{let je=te.fetchers.get(be.key),st=v0(void 0,je?je.data:void 0);te.fetchers.set(be.key,st)}),new Map(te.fetchers)}function gs(ye,be,je,st){if(c)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");$r(ye);let St=(st&&st.flushSync)===!0,Yt=E||m,hn=XL(te.location,te.matches,S,I.v7_prependBasename,je,I.v7_relativeSplatPath,be,st?.relative),Ut=gg(Yt,hn,S),Wt=mr(Ut,Yt,hn);if(Wt.active&&Wt.matches&&(Ut=Wt.matches),!Ut){on(ye,be,bo(404,{pathname:hn}),{flushSync:St});return}let{path:xt,submission:Vt,error:Rn}=xK(I.v7_normalizeFormMethod,!0,hn,st);if(Rn){on(ye,be,Rn,{flushSync:St});return}let Kn=O0(Ut,xt),Qi=(st&&st.preventScrollReset)===!0;if(Vt&&au(Vt.formMethod)){Cc(ye,be,xt,Kn,Ut,Wt.active,St,Qi,Vt);return}ue.set(ye,{routeId:be,path:xt}),Qs(ye,be,xt,Kn,Ut,Wt.active,St,Qi,Vt)}async function Cc(ye,be,je,st,St,Yt,hn,Ut,Wt){lt(),ue.delete(ye);function xt(_r){if(!_r.route.action&&!_r.route.lazy){let mu=bo(405,{method:Wt.formMethod,pathname:je,routeId:be});return on(ye,be,mu,{flushSync:hn}),!0}return!1}if(!Yt&&xt(st))return;let Vt=te.fetchers.get(ye);Kt(ye,Pve(Wt,Vt),{flushSync:hn});let Rn=new AbortController,Kn=uy(i.history,je,Rn.signal,Wt);if(Yt){let _r=await $i(St,new URL(Kn.url).pathname,Kn.signal,ye);if(_r.type==="aborted")return;if(_r.type==="error"){on(ye,be,_r.error,{flushSync:hn});return}else if(_r.matches){if(St=_r.matches,st=O0(St,je),xt(st))return}else{on(ye,be,bo(404,{pathname:je}),{flushSync:hn});return}}Ie.set(ye,Rn);let Qi=Ke,ir=(await Ua("action",te,Kn,[st],St,ye))[st.route.id];if(Kn.signal.aborted){Ie.get(ye)===Rn&&Ie.delete(ye);return}if(I.v7_fetcherPersist&&yt.has(ye)){if(Eg(ir)||oc(ir)){Kt(ye,Wp(void 0));return}}else{if(Eg(ir))if(Ie.delete(ye),ae>Qi){Kt(ye,Wp(void 0));return}else return Pe.add(ye),Kt(ye,v0(Wt)),Ir(Kn,ir,!1,{fetcherSubmission:Wt,preventScrollReset:Ut});if(oc(ir)){on(ye,be,ir.error);return}}if(Xp(ir))throw bo(400,{type:"defer-action"});let Ar=te.navigation.location||te.location,ml=uy(i.history,Ar,Rn.signal),Nd=E||m,Zi=te.navigation.state!=="idle"?gg(Nd,te.navigation.location,S):te.matches;ur(Zi,"Didn't find any matches after fetcher action");let gr=++Ke;ge.set(ye,gr);let Cf=v0(Wt,ir.data);te.fetchers.set(ye,Cf);let[Ur,Rc]=MK(i.history,te,Zi,Wt,Ar,!1,I.v7_skipActionErrorRevalidation,Be,$e,Ge,yt,ue,Pe,Nd,S,[st.route.id,ir]);Rc.filter(_r=>_r.key!==ye).forEach(_r=>{let mu=_r.key,Yg=te.fetchers.get(mu),gu=v0(void 0,Yg?Yg.data:void 0);te.fetchers.set(mu,gu),$r(mu),_r.controller&&Ie.set(mu,_r.controller)}),Jr({fetchers:new Map(te.fetchers)});let gl=()=>Rc.forEach(_r=>$r(_r.key));Rn.signal.addEventListener("abort",gl);let{loaderResults:Ah,fetcherResults:sr}=await qe(te,Zi,Ur,Rc,ml);if(Rn.signal.aborted)return;Rn.signal.removeEventListener("abort",gl),ge.delete(ye),Ie.delete(ye),Rc.forEach(_r=>Ie.delete(_r.key));let Dr=qI(Ah);if(Dr)return Ir(ml,Dr.result,!1,{preventScrollReset:Ut});if(Dr=qI(sr),Dr)return Pe.add(Dr.key),Ir(ml,Dr.result,!1,{preventScrollReset:Ut});let{loaderData:bs,errors:fu}=BK(te,Zi,Ah,void 0,Rc,sr,Dt);if(te.fetchers.has(ye)){let _r=Wp(ir.data);te.fetchers.set(ye,_r)}Gr(gr),te.navigation.state==="loading"&&gr>ae?(ur(pe,"Expected pending action"),Ne&&Ne.abort(),Mr(te.navigation.location,{matches:Zi,loaderData:bs,errors:fu,fetchers:new Map(te.fetchers)})):(Jr({errors:fu,loaderData:WK(te.loaderData,bs,Zi,fu),fetchers:new Map(te.fetchers)}),Be=!1)}async function Qs(ye,be,je,st,St,Yt,hn,Ut,Wt){let xt=te.fetchers.get(ye);Kt(ye,v0(Wt,xt?xt.data:void 0),{flushSync:hn});let Vt=new AbortController,Rn=uy(i.history,je,Vt.signal);if(Yt){let ir=await $i(St,new URL(Rn.url).pathname,Rn.signal,ye);if(ir.type==="aborted")return;if(ir.type==="error"){on(ye,be,ir.error,{flushSync:hn});return}else if(ir.matches)St=ir.matches,st=O0(St,je);else{on(ye,be,bo(404,{pathname:je}),{flushSync:hn});return}}Ie.set(ye,Vt);let Kn=Ke,Sr=(await Ua("loader",te,Rn,[st],St,ye))[st.route.id];if(Xp(Sr)&&(Sr=await N2(Sr,Rn.signal,!0)||Sr),Ie.get(ye)===Vt&&Ie.delete(ye),!Rn.signal.aborted){if(yt.has(ye)){Kt(ye,Wp(void 0));return}if(Eg(Sr))if(ae>Kn){Kt(ye,Wp(void 0));return}else{Pe.add(ye),await Ir(Rn,Sr,!1,{preventScrollReset:Ut});return}if(oc(Sr)){on(ye,be,Sr.error);return}ur(!Xp(Sr),"Unhandled fetcher deferred data"),Kt(ye,Wp(Sr.data))}}async function Ir(ye,be,je,st){let{submission:St,fetcherSubmission:Yt,preventScrollReset:hn,replace:Ut}=st===void 0?{}:st;be.response.headers.has("X-Remix-Revalidate")&&(Be=!0);let Wt=be.response.headers.get("Location");ur(Wt,"Expected a Location header on the redirect Response"),Wt=FK(Wt,new URL(ye.url),S);let xt=aw(te.location,Wt,{_isRedirect:!0});if(a){let ir=!1;if(be.response.headers.has("X-Remix-Reload-Document"))ir=!0;else if(O2.test(Wt)){const Ar=i.history.createURL(Wt);ir=Ar.origin!==r.location.origin||ov(Ar.pathname,S)==null}if(ir){Ut?r.location.replace(Wt):r.location.assign(Wt);return}}Ne=null;let Vt=Ut===!0||be.response.headers.has("X-Remix-Replace")?Ss.Replace:Ss.Push,{formMethod:Rn,formAction:Kn,formEncType:Qi}=te.navigation;!St&&!Yt&&Rn&&Kn&&Qi&&(St=KK(te.navigation));let Sr=St||Yt;if(dve.has(be.response.status)&&Sr&&au(Sr.formMethod))await yi(Vt,xt,{submission:Ui({},Sr,{formAction:Wt}),preventScrollReset:hn||Ee,enableViewTransition:je?Ue:void 0});else{let ir=kx(xt,St);await yi(Vt,xt,{overrideNavigation:ir,fetcherSubmission:Yt,preventScrollReset:hn||Ee,enableViewTransition:je?Ue:void 0})}}async function Ua(ye,be,je,st,St,Yt){let hn,Ut={};try{hn=await yve(T,ye,be,je,st,St,Yt,h,l)}catch(Wt){return st.forEach(xt=>{Ut[xt.route.id]={type:Xr.error,error:Wt}}),Ut}for(let[Wt,xt]of Object.entries(hn))if(Rve(xt)){let Vt=xt.result;Ut[Wt]={type:Xr.redirect,response:Tve(Vt,je,Wt,St,S,I.v7_relativeSplatPath)}}else Ut[Wt]=await Sve(xt);return Ut}async function qe(ye,be,je,st,St){let Yt=ye.matches,hn=Ua("loader",ye,St,je,be,null),Ut=Promise.all(st.map(async Vt=>{if(Vt.matches&&Vt.match&&Vt.controller){let Kn=(await Ua("loader",ye,uy(i.history,Vt.path,Vt.controller.signal),[Vt.match],Vt.matches,Vt.key))[Vt.match.route.id];return{[Vt.key]:Kn}}else return Promise.resolve({[Vt.key]:{type:Xr.error,error:bo(404,{pathname:Vt.path})}})})),Wt=await hn,xt=(await Ut).reduce((Vt,Rn)=>Object.assign(Vt,Rn),{});return await Promise.all([Ave(be,Wt,St.signal,Yt,ye.loaderData),Ove(be,xt,st)]),{loaderResults:Wt,fetcherResults:xt}}function lt(){Be=!0,$e.push(...ya()),ue.forEach((ye,be)=>{Ie.has(be)&&Ge.add(be),$r(be)})}function Kt(ye,be,je){je===void 0&&(je={}),te.fetchers.set(ye,be),Jr({fetchers:new Map(te.fetchers)},{flushSync:(je&&je.flushSync)===!0})}function on(ye,be,je,st){st===void 0&&(st={});let St=_g(te.matches,be);ii(ye),Jr({errors:{[St.route.id]:je},fetchers:new Map(te.fetchers)},{flushSync:(st&&st.flushSync)===!0})}function Nn(ye){return it.set(ye,(it.get(ye)||0)+1),yt.has(ye)&&yt.delete(ye),te.fetchers.get(ye)||hve}function ii(ye){let be=te.fetchers.get(ye);Ie.has(ye)&&!(be&&be.state==="loading"&&ge.has(ye))&&$r(ye),ue.delete(ye),ge.delete(ye),Pe.delete(ye),I.v7_fetcherPersist&&yt.delete(ye),Ge.delete(ye),te.fetchers.delete(ye)}function Zs(ye){let be=(it.get(ye)||0)-1;be<=0?(it.delete(ye),yt.add(ye),I.v7_fetcherPersist||ii(ye)):it.set(ye,be),Jr({fetchers:new Map(te.fetchers)})}function $r(ye){let be=Ie.get(ye);be&&(be.abort(),Ie.delete(ye))}function mi(ye){for(let be of ye){let je=Nn(be),st=Wp(je.data);te.fetchers.set(be,st)}}function _a(){let ye=[],be=!1;for(let je of Pe){let st=te.fetchers.get(je);ur(st,"Expected fetcher: "+je),st.state==="loading"&&(Pe.delete(je),ye.push(je),be=!0)}return mi(ye),be}function Gr(ye){let be=[];for(let[je,st]of ge)if(st<ye){let St=te.fetchers.get(je);ur(St,"Expected fetcher: "+je),St.state==="loading"&&($r(je),ge.delete(je),be.push(je))}return mi(be),be.length>0}function Ea(ye,be){let je=te.blockers.get(ye)||y0;return At.get(ye)!==be&&At.set(ye,be),je}function vi(ye){te.blockers.delete(ye),At.delete(ye)}function no(ye,be){let je=te.blockers.get(ye)||y0;ur(je.state==="unblocked"&&be.state==="blocked"||je.state==="blocked"&&be.state==="blocked"||je.state==="blocked"&&be.state==="proceeding"||je.state==="blocked"&&be.state==="unblocked"||je.state==="proceeding"&&be.state==="unblocked","Invalid blocker state transition: "+je.state+" -> "+be.state);let st=new Map(te.blockers);st.set(ye,be),Jr({blockers:st})}function fl(ye){let{currentLocation:be,nextLocation:je,historyAction:st}=ye;if(At.size===0)return;At.size>1&&Pg(!1,"A router only supports one blocker at a time");let St=Array.from(At.entries()),[Yt,hn]=St[St.length-1],Ut=te.blockers.get(Yt);if(!(Ut&&Ut.state==="proceeding")&&hn({currentLocation:be,nextLocation:je,historyAction:st}))return Yt}function ro(ye){let be=bo(404,{pathname:ye}),je=E||m,{matches:st,route:St}=HK(je);return ya(),{notFoundMatches:st,route:St,error:be}}function ya(ye){let be=[];return Dt.forEach((je,st)=>{(!ye||ye(st))&&(je.cancel(),be.push(st),Dt.delete(st))}),be}function Va(ye,be,je){if(H=ye,B=be,x=je||null,!X&&te.navigation===Px){X=!0;let st=Bn(te.location,te.matches);st!=null&&Jr({restoreScrollPosition:st})}return()=>{H=null,B=null,x=null}}function Fo(ye,be){return x&&x(ye,be.map(st=>Gye(st,te.loaderData)))||ye.key}function mn(ye,be){if(H&&B){let je=Fo(ye,be);H[je]=B()}}function Bn(ye,be){if(H){let je=Fo(ye,be),st=H[je];if(typeof st=="number")return st}return null}function mr(ye,be,je){if(C)if(ye){if(Object.keys(ye[0].params).length>0)return{active:!0,matches:hA(be,je,S,!0)}}else return{active:!0,matches:hA(be,je,S,!0)||[]};return{active:!1,matches:null}}async function $i(ye,be,je,st){if(!C)return{type:"success",matches:ye};let St=ye;for(;;){let Yt=E==null,hn=E||m,Ut=h;try{await C({signal:je,path:be,matches:St,fetcherKey:st,patch:(Vt,Rn)=>{je.aborted||VK(Vt,Rn,hn,Ut,l)}})}catch(Vt){return{type:"error",error:Vt,partialMatches:St}}finally{Yt&&!je.aborted&&(m=[...m])}if(je.aborted)return{type:"aborted"};let Wt=gg(hn,be,S);if(Wt)return{type:"success",matches:Wt};let xt=hA(hn,be,S,!0);if(!xt||St.length===xt.length&&St.every((Vt,Rn)=>Vt.route.id===xt[Rn].route.id))return{type:"success",matches:null};St=xt}}function Ls(ye){h={},E=MA(ye,l,void 0,h)}function kr(ye,be){let je=E==null;VK(ye,be,E||m,h,l),je&&(m=[...m],Jr({}))}return ce={get basename(){return S},get future(){return I},get state(){return te},get routes(){return m},get window(){return r},initialize:Cn,subscribe:os,enableScrollRestoration:Va,navigate:Tc,fetch:gs,revalidate:pl,createHref:ye=>i.history.createHref(ye),encodeLocation:ye=>i.history.encodeLocation(ye),getFetcher:Nn,deleteFetcher:Zs,dispose:fr,getBlocker:Ea,deleteBlocker:vi,patchRoutes:kr,_internalFetchControllers:Ie,_internalActiveDeferreds:Dt,_internalSetRoutes:Ls},ce}function mve(i){return i!=null&&("formData"in i&&i.formData!=null||"body"in i&&i.body!==void 0)}function XL(i,r,a,c,l,h,m,E){let S,T;if(m){S=[];for(let I of r)if(S.push(I),I.route.id===m){T=I;break}}else S=r,T=r[r.length-1];let C=OO(l||".",AO(S,h),ov(i.pathname,a)||i.pathname,E==="path");if(l==null&&(C.search=i.search,C.hash=i.hash),(l==null||l===""||l===".")&&T){let I=P2(C.search);if(T.route.index&&!I)C.search=C.search?C.search.replace(/^\?/,"?index&"):"?index";else if(!T.route.index&&I){let N=new URLSearchParams(C.search),P=N.getAll("index");N.delete("index"),P.filter(x=>x).forEach(x=>N.append("index",x));let H=N.toString();C.search=H?"?"+H:""}}return c&&a!=="/"&&(C.pathname=C.pathname==="/"?a:mh([a,C.pathname])),kg(C)}function xK(i,r,a,c){if(!c||!mve(c))return{path:a};if(c.formMethod&&!Ive(c.formMethod))return{path:a,error:bo(405,{method:c.formMethod})};let l=()=>({path:a,error:bo(400,{type:"invalid-body"})}),h=c.formMethod||"get",m=i?h.toUpperCase():h.toLowerCase(),E=pJ(a);if(c.body!==void 0){if(c.formEncType==="text/plain"){if(!au(m))return l();let N=typeof c.body=="string"?c.body:c.body instanceof FormData||c.body instanceof URLSearchParams?Array.from(c.body.entries()).reduce((P,H)=>{let[x,B]=H;return""+P+x+"="+B+`
`},""):String(c.body);return{path:a,submission:{formMethod:m,formAction:E,formEncType:c.formEncType,formData:void 0,json:void 0,text:N}}}else if(c.formEncType==="application/json"){if(!au(m))return l();try{let N=typeof c.body=="string"?JSON.parse(c.body):c.body;return{path:a,submission:{formMethod:m,formAction:E,formEncType:c.formEncType,formData:void 0,json:N,text:void 0}}}catch{return l()}}}ur(typeof FormData=="function","FormData is not available in this environment");let S,T;if(c.formData)S=$L(c.formData),T=c.formData;else if(c.body instanceof FormData)S=$L(c.body),T=c.body;else if(c.body instanceof URLSearchParams)S=c.body,T=jK(S);else if(c.body==null)S=new URLSearchParams,T=new FormData;else try{S=new URLSearchParams(c.body),T=jK(S)}catch{return l()}let C={formMethod:m,formAction:E,formEncType:c&&c.formEncType||"application/x-www-form-urlencoded",formData:T,json:void 0,text:void 0};if(au(C.formMethod))return{path:a,submission:C};let I=Ih(a);return r&&I.search&&P2(I.search)&&S.append("index",""),I.search="?"+S,{path:kg(I),submission:C}}function LK(i,r,a){a===void 0&&(a=!1);let c=i.findIndex(l=>l.route.id===r);return c>=0?i.slice(0,a?c+1:c):i}function MK(i,r,a,c,l,h,m,E,S,T,C,I,N,P,H,x){let B=x?oc(x[1])?x[1].error:x[1].data:void 0,X=i.createURL(r.location),Z=i.createURL(l),$=a;h&&r.errors?$=LK(a,Object.keys(r.errors)[0],!0):x&&oc(x[1])&&($=LK(a,x[0]));let le=x?x[1].statusCode:void 0,re=m&&le&&le>=400,ce=$.filter((pe,Ee)=>{let{route:Ne}=pe;if(Ne.lazy)return!0;if(Ne.loader==null)return!1;if(h)return JL(Ne,r.loaderData,r.errors);if(gve(r.loaderData,r.matches[Ee],pe)||S.some(Xe=>Xe===pe.route.id))return!0;let Ue=r.matches[Ee],Se=pe;return UK(pe,Ui({currentUrl:X,currentParams:Ue.params,nextUrl:Z,nextParams:Se.params},c,{actionResult:B,actionStatus:le,defaultShouldRevalidate:re?!1:E||X.pathname+X.search===Z.pathname+Z.search||X.search!==Z.search||dJ(Ue,Se)}))}),te=[];return I.forEach((pe,Ee)=>{if(h||!a.some(Re=>Re.route.id===pe.routeId)||C.has(Ee))return;let Ne=gg(P,pe.path,H);if(!Ne){te.push({key:Ee,routeId:pe.routeId,path:pe.path,matches:null,match:null,controller:null});return}let Ue=r.fetchers.get(Ee),Se=O0(Ne,pe.path),Xe=!1;N.has(Ee)?Xe=!1:T.has(Ee)?(T.delete(Ee),Xe=!0):Ue&&Ue.state!=="idle"&&Ue.data===void 0?Xe=E:Xe=UK(Se,Ui({currentUrl:X,currentParams:r.matches[r.matches.length-1].params,nextUrl:Z,nextParams:a[a.length-1].params},c,{actionResult:B,actionStatus:le,defaultShouldRevalidate:re?!1:E})),Xe&&te.push({key:Ee,routeId:pe.routeId,path:pe.path,matches:Ne,match:Se,controller:new AbortController})}),[ce,te]}function JL(i,r,a){if(i.lazy)return!0;if(!i.loader)return!1;let c=r!=null&&r[i.id]!==void 0,l=a!=null&&a[i.id]!==void 0;return!c&&l?!1:typeof i.loader=="function"&&i.loader.hydrate===!0?!0:!c&&!l}function gve(i,r,a){let c=!r||a.route.id!==r.route.id,l=i[a.route.id]===void 0;return c||l}function dJ(i,r){let a=i.route.path;return i.pathname!==r.pathname||a!=null&&a.endsWith("*")&&i.params["*"]!==r.params["*"]}function UK(i,r){if(i.route.shouldRevalidate){let a=i.route.shouldRevalidate(r);if(typeof a=="boolean")return a}return r.defaultShouldRevalidate}function VK(i,r,a,c,l){var h;let m;if(i){let T=c[i];ur(T,"No route found to patch children into: routeId = "+i),T.children||(T.children=[]),m=T.children}else m=a;let E=r.filter(T=>!m.some(C=>hJ(T,C))),S=MA(E,l,[i||"_","patch",String(((h=m)==null?void 0:h.length)||"0")],c);m.push(...S)}function hJ(i,r){return"id"in i&&"id"in r&&i.id===r.id?!0:i.index===r.index&&i.path===r.path&&i.caseSensitive===r.caseSensitive?(!i.children||i.children.length===0)&&(!r.children||r.children.length===0)?!0:i.children.every((a,c)=>{var l;return(l=r.children)==null?void 0:l.some(h=>hJ(a,h))}):!1}async function _ve(i,r,a){if(!i.lazy)return;let c=await i.lazy();if(!i.lazy)return;let l=a[i.id];ur(l,"No route found in manifest");let h={};for(let m in c){let S=l[m]!==void 0&&m!=="hasErrorBoundary";Pg(!S,'Route "'+l.id+'" has a static property "'+m+'" defined but its lazy function is also returning a value for this property. '+('The lazy route property "'+m+'" will be ignored.')),!S&&!Bye.has(m)&&(h[m]=c[m])}Object.assign(l,h),Object.assign(l,Ui({},r(l),{lazy:void 0}))}async function Eve(i){let{matches:r}=i,a=r.filter(l=>l.shouldLoad);return(await Promise.all(a.map(l=>l.resolve()))).reduce((l,h,m)=>Object.assign(l,{[a[m].route.id]:h}),{})}async function yve(i,r,a,c,l,h,m,E,S,T){let C=h.map(P=>P.route.lazy?_ve(P.route,S,E):void 0),I=h.map((P,H)=>{let x=C[H],B=l.some(Z=>Z.route.id===P.route.id);return Ui({},P,{shouldLoad:B,resolve:async Z=>(Z&&c.method==="GET"&&(P.route.lazy||P.route.loader)&&(B=!0),B?vve(r,c,P,x,Z,T):Promise.resolve({type:Xr.data,result:void 0}))})}),N=await i({matches:I,request:c,params:h[0].params,fetcherKey:m,context:T});try{await Promise.all(C)}catch{}return N}async function vve(i,r,a,c,l,h){let m,E,S=T=>{let C,I=new Promise((H,x)=>C=x);E=()=>C(),r.signal.addEventListener("abort",E);let N=H=>typeof T!="function"?Promise.reject(new Error("You cannot call the handler for a route which defines a boolean "+('"'+i+'" [routeId: '+a.route.id+"]"))):T({request:r,params:a.params,context:h},...H!==void 0?[H]:[]),P=(async()=>{try{return{type:"data",result:await(l?l(x=>N(x)):N())}}catch(H){return{type:"error",result:H}}})();return Promise.race([P,I])};try{let T=a.route[i];if(c)if(T){let C,[I]=await Promise.all([S(T).catch(N=>{C=N}),c]);if(C!==void 0)throw C;m=I}else if(await c,T=a.route[i],T)m=await S(T);else if(i==="action"){let C=new URL(r.url),I=C.pathname+C.search;throw bo(405,{method:r.method,pathname:I,routeId:a.route.id})}else return{type:Xr.data,result:void 0};else if(T)m=await S(T);else{let C=new URL(r.url),I=C.pathname+C.search;throw bo(404,{pathname:I})}ur(m.result!==void 0,"You defined "+(i==="action"?"an action":"a loader")+" for route "+('"'+a.route.id+"\" but didn't return anything from your `"+i+"` ")+"function. Please return a value or `null`.")}catch(T){return{type:Xr.error,result:T}}finally{E&&r.signal.removeEventListener("abort",E)}return m}async function Sve(i){let{result:r,type:a}=i;if(fJ(r)){let I;try{let N=r.headers.get("Content-Type");N&&/\bapplication\/json\b/.test(N)?r.body==null?I=null:I=await r.json():I=await r.text()}catch(N){return{type:Xr.error,error:N}}return a===Xr.error?{type:Xr.error,error:new UA(r.status,r.statusText,I),statusCode:r.status,headers:r.headers}:{type:Xr.data,data:I,statusCode:r.status,headers:r.headers}}if(a===Xr.error){if(zK(r)){var c,l;if(r.data instanceof Error){var h,m;return{type:Xr.error,error:r.data,statusCode:(h=r.init)==null?void 0:h.status,headers:(m=r.init)!=null&&m.headers?new Headers(r.init.headers):void 0}}return{type:Xr.error,error:new UA(((c=r.init)==null?void 0:c.status)||500,void 0,r.data),statusCode:ow(r)?r.status:void 0,headers:(l=r.init)!=null&&l.headers?new Headers(r.init.headers):void 0}}return{type:Xr.error,error:r,statusCode:ow(r)?r.status:void 0}}if(bve(r)){var E,S;return{type:Xr.deferred,deferredData:r,statusCode:(E=r.init)==null?void 0:E.status,headers:((S=r.init)==null?void 0:S.headers)&&new Headers(r.init.headers)}}if(zK(r)){var T,C;return{type:Xr.data,data:r.data,statusCode:(T=r.init)==null?void 0:T.status,headers:(C=r.init)!=null&&C.headers?new Headers(r.init.headers):void 0}}return{type:Xr.data,data:r}}function Tve(i,r,a,c,l,h){let m=i.headers.get("Location");if(ur(m,"Redirects returned/thrown from loaders/actions must have a Location header"),!O2.test(m)){let E=c.slice(0,c.findIndex(S=>S.route.id===a)+1);m=XL(new URL(r.url),E,l,!0,m,h),i.headers.set("Location",m)}return i}function FK(i,r,a){if(O2.test(i)){let c=i,l=c.startsWith("//")?new URL(r.protocol+c):new URL(c),h=ov(l.pathname,a)!=null;if(l.origin===r.origin&&h)return l.pathname+l.search+l.hash}return i}function uy(i,r,a,c){let l=i.createURL(pJ(r)).toString(),h={signal:a};if(c&&au(c.formMethod)){let{formMethod:m,formEncType:E}=c;h.method=m.toUpperCase(),E==="application/json"?(h.headers=new Headers({"Content-Type":E}),h.body=JSON.stringify(c.json)):E==="text/plain"?h.body=c.text:E==="application/x-www-form-urlencoded"&&c.formData?h.body=$L(c.formData):h.body=c.formData}return new Request(l,h)}function $L(i){let r=new URLSearchParams;for(let[a,c]of i.entries())r.append(a,typeof c=="string"?c:c.name);return r}function jK(i){let r=new FormData;for(let[a,c]of i.entries())r.append(a,c);return r}function wve(i,r,a,c,l){let h={},m=null,E,S=!1,T={},C=a&&oc(a[1])?a[1].error:void 0;return i.forEach(I=>{if(!(I.route.id in r))return;let N=I.route.id,P=r[N];if(ur(!Eg(P),"Cannot handle redirect results in processLoaderData"),oc(P)){let H=P.error;C!==void 0&&(H=C,C=void 0),m=m||{};{let x=_g(i,N);m[x.route.id]==null&&(m[x.route.id]=H)}h[N]=void 0,S||(S=!0,E=ow(P.error)?P.error.status:500),P.headers&&(T[N]=P.headers)}else Xp(P)?(c.set(N,P.deferredData),h[N]=P.deferredData.data,P.statusCode!=null&&P.statusCode!==200&&!S&&(E=P.statusCode),P.headers&&(T[N]=P.headers)):(h[N]=P.data,P.statusCode&&P.statusCode!==200&&!S&&(E=P.statusCode),P.headers&&(T[N]=P.headers))}),C!==void 0&&a&&(m={[a[0]]:C},h[a[0]]=void 0),{loaderData:h,errors:m,statusCode:E||200,loaderHeaders:T}}function BK(i,r,a,c,l,h,m){let{loaderData:E,errors:S}=wve(r,a,c,m);return l.forEach(T=>{let{key:C,match:I,controller:N}=T,P=h[C];if(ur(P,"Did not find corresponding fetcher result"),!(N&&N.signal.aborted))if(oc(P)){let H=_g(i.matches,I?.route.id);S&&S[H.route.id]||(S=Ui({},S,{[H.route.id]:P.error})),i.fetchers.delete(C)}else if(Eg(P))ur(!1,"Unhandled fetcher revalidation redirect");else if(Xp(P))ur(!1,"Unhandled fetcher deferred data");else{let H=Wp(P.data);i.fetchers.set(C,H)}}),{loaderData:E,errors:S}}function WK(i,r,a,c){let l=Ui({},r);for(let h of a){let m=h.route.id;if(r.hasOwnProperty(m)?r[m]!==void 0&&(l[m]=r[m]):i[m]!==void 0&&h.route.loader&&(l[m]=i[m]),c&&c.hasOwnProperty(m))break}return l}function GK(i){return i?oc(i[1])?{actionData:{}}:{actionData:{[i[0]]:i[1].data}}:{}}function _g(i,r){return(r?i.slice(0,i.findIndex(c=>c.route.id===r)+1):[...i]).reverse().find(c=>c.route.hasErrorBoundary===!0)||i[0]}function HK(i){let r=i.length===1?i[0]:i.find(a=>a.index||!a.path||a.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:r}],route:r}}function bo(i,r){let{pathname:a,routeId:c,method:l,type:h,message:m}=r===void 0?{}:r,E="Unknown Server Error",S="Unknown @remix-run/router error";return i===400?(E="Bad Request",l&&a&&c?S="You made a "+l+' request to "'+a+'" but '+('did not provide a `loader` for route "'+c+'", ')+"so there is no way to handle the request.":h==="defer-action"?S="defer() is not supported in actions":h==="invalid-body"&&(S="Unable to encode submission body")):i===403?(E="Forbidden",S='Route "'+c+'" does not match URL "'+a+'"'):i===404?(E="Not Found",S='No route matches URL "'+a+'"'):i===405&&(E="Method Not Allowed",l&&a&&c?S="You made a "+l.toUpperCase()+' request to "'+a+'" but '+('did not provide an `action` for route "'+c+'", ')+"so there is no way to handle the request.":l&&(S='Invalid request method "'+l.toUpperCase()+'"')),new UA(i||500,E,new Error(S),!0)}function qI(i){let r=Object.entries(i);for(let a=r.length-1;a>=0;a--){let[c,l]=r[a];if(Eg(l))return{key:c,result:l}}}function pJ(i){let r=typeof i=="string"?Ih(i):i;return kg(Ui({},r,{hash:""}))}function Cve(i,r){return i.pathname!==r.pathname||i.search!==r.search?!1:i.hash===""?r.hash!=="":i.hash===r.hash?!0:r.hash!==""}function Rve(i){return fJ(i.result)&&uve.has(i.result.status)}function Xp(i){return i.type===Xr.deferred}function oc(i){return i.type===Xr.error}function Eg(i){return(i&&i.type)===Xr.redirect}function zK(i){return typeof i=="object"&&i!=null&&"type"in i&&"data"in i&&"init"in i&&i.type==="DataWithResponseInit"}function bve(i){let r=i;return r&&typeof r=="object"&&typeof r.data=="object"&&typeof r.subscribe=="function"&&typeof r.cancel=="function"&&typeof r.resolveData=="function"}function fJ(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.headers=="object"&&typeof i.body<"u"}function Ive(i){return lve.has(i.toLowerCase())}function au(i){return ove.has(i.toLowerCase())}async function Ave(i,r,a,c,l){let h=Object.entries(r);for(let m=0;m<h.length;m++){let[E,S]=h[m],T=i.find(N=>N?.route.id===E);if(!T)continue;let C=c.find(N=>N.route.id===T.route.id),I=C!=null&&!dJ(C,T)&&(l&&l[T.route.id])!==void 0;Xp(S)&&I&&await N2(S,a,!1).then(N=>{N&&(r[E]=N)})}}async function Ove(i,r,a){for(let c=0;c<a.length;c++){let{key:l,routeId:h,controller:m}=a[c],E=r[l];i.find(T=>T?.route.id===h)&&Xp(E)&&(ur(m,"Expected an AbortController for revalidating fetcher deferred result"),await N2(E,m.signal,!0).then(T=>{T&&(r[l]=T)}))}}async function N2(i,r,a){if(a===void 0&&(a=!1),!await i.deferredData.resolveData(r)){if(a)try{return{type:Xr.data,data:i.deferredData.unwrappedData}}catch(l){return{type:Xr.error,error:l}}return{type:Xr.data,data:i.deferredData.data}}}function P2(i){return new URLSearchParams(i).getAll("index").some(r=>r==="")}function O0(i,r){let a=typeof r=="string"?Ih(r).search:r.search;if(i[i.length-1].route.index&&P2(a||""))return i[i.length-1];let c=cJ(i);return c[c.length-1]}function KK(i){let{formMethod:r,formAction:a,formEncType:c,text:l,formData:h,json:m}=i;if(!(!r||!a||!c)){if(l!=null)return{formMethod:r,formAction:a,formEncType:c,formData:void 0,json:void 0,text:l};if(h!=null)return{formMethod:r,formAction:a,formEncType:c,formData:h,json:void 0,text:void 0};if(m!==void 0)return{formMethod:r,formAction:a,formEncType:c,formData:void 0,json:m,text:void 0}}}function kx(i,r){return r?{state:"loading",location:i,formMethod:r.formMethod,formAction:r.formAction,formEncType:r.formEncType,formData:r.formData,json:r.json,text:r.text}:{state:"loading",location:i,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function Nve(i,r){return{state:"submitting",location:i,formMethod:r.formMethod,formAction:r.formAction,formEncType:r.formEncType,formData:r.formData,json:r.json,text:r.text}}function v0(i,r){return i?{state:"loading",formMethod:i.formMethod,formAction:i.formAction,formEncType:i.formEncType,formData:i.formData,json:i.json,text:i.text,data:r}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:r}}function Pve(i,r){return{state:"submitting",formMethod:i.formMethod,formAction:i.formAction,formEncType:i.formEncType,formData:i.formData,json:i.json,text:i.text,data:r?r.data:void 0}}function Wp(i){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:i}}function kve(i,r){try{let a=i.sessionStorage.getItem(uJ);if(a){let c=JSON.parse(a);for(let[l,h]of Object.entries(c||{}))h&&Array.isArray(h)&&r.set(l,new Set(h||[]))}}catch{}}function Dve(i,r){if(r.size>0){let a={};for(let[c,l]of r)a[c]=[...l];try{i.sessionStorage.setItem(uJ,JSON.stringify(a))}catch(c){Pg(!1,"Failed to save applied view transitions in sessionStorage ("+c+").")}}}function VA(){return VA=Object.assign?Object.assign.bind():function(i){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(i[c]=a[c])}return i},VA.apply(this,arguments)}const NO=G.createContext(null),mJ=G.createContext(null),gf=G.createContext(null),k2=G.createContext(null),_f=G.createContext({outlet:null,matches:[],isDataRoute:!1}),gJ=G.createContext(null);function xve(i,r){let{relative:a}=r===void 0?{}:r;cv()||ur(!1);let{basename:c,navigator:l}=G.useContext(gf),{hash:h,pathname:m,search:E}=EJ(i,{relative:a}),S=m;return c!=="/"&&(S=m==="/"?c:mh([c,m])),l.createHref({pathname:S,search:E,hash:h})}function cv(){return G.useContext(k2)!=null}function Ef(){return cv()||ur(!1),G.useContext(k2).location}function _J(i){G.useContext(gf).static||G.useLayoutEffect(i)}function D2(){let{isDataRoute:i}=G.useContext(_f);return i?Kve():Lve()}function Lve(){cv()||ur(!1);let i=G.useContext(NO),{basename:r,future:a,navigator:c}=G.useContext(gf),{matches:l}=G.useContext(_f),{pathname:h}=Ef(),m=JSON.stringify(AO(l,a.v7_relativeSplatPath)),E=G.useRef(!1);return _J(()=>{E.current=!0}),G.useCallback(function(T,C){if(C===void 0&&(C={}),!E.current)return;if(typeof T=="number"){c.go(T);return}let I=OO(T,JSON.parse(m),h,C.relative==="path");i==null&&r!=="/"&&(I.pathname=I.pathname==="/"?r:mh([r,I.pathname])),(C.replace?c.replace:c.push)(I,C.state,C)},[r,c,m,h,i])}function EJ(i,r){let{relative:a}=r===void 0?{}:r,{future:c}=G.useContext(gf),{matches:l}=G.useContext(_f),{pathname:h}=Ef(),m=JSON.stringify(AO(l,c.v7_relativeSplatPath));return G.useMemo(()=>OO(i,JSON.parse(m),h,a==="path"),[i,m,h,a])}function Mve(i,r,a,c){cv()||ur(!1);let{navigator:l}=G.useContext(gf),{matches:h}=G.useContext(_f),m=h[h.length-1],E=m?m.params:{};m&&m.pathname;let S=m?m.pathnameBase:"/";m&&m.route;let T=Ef(),C;C=T;let I=C.pathname||"/",N=I;if(S!=="/"){let x=S.replace(/^\//,"").split("/");N="/"+I.replace(/^\//,"").split("/").slice(x.length).join("/")}let P=gg(i,{pathname:N});return Bve(P&&P.map(x=>Object.assign({},x,{params:Object.assign({},E,x.params),pathname:mh([S,l.encodeLocation?l.encodeLocation(x.pathname).pathname:x.pathname]),pathnameBase:x.pathnameBase==="/"?S:mh([S,l.encodeLocation?l.encodeLocation(x.pathnameBase).pathname:x.pathnameBase])})),h,a,c)}function Uve(){let i=zve(),r=ow(i)?i.status+" "+i.statusText:i instanceof Error?i.message:JSON.stringify(i),a=i instanceof Error?i.stack:null,l={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return G.createElement(G.Fragment,null,G.createElement("h2",null,"Unexpected Application Error!"),G.createElement("h3",{style:{fontStyle:"italic"}},r),a?G.createElement("pre",{style:l},a):null,null)}const Vve=G.createElement(Uve,null);class Fve extends G.Component{constructor(r){super(r),this.state={location:r.location,revalidation:r.revalidation,error:r.error}}static getDerivedStateFromError(r){return{error:r}}static getDerivedStateFromProps(r,a){return a.location!==r.location||a.revalidation!=="idle"&&r.revalidation==="idle"?{error:r.error,location:r.location,revalidation:r.revalidation}:{error:r.error!==void 0?r.error:a.error,location:a.location,revalidation:r.revalidation||a.revalidation}}componentDidCatch(r,a){console.error("React Router caught the following error during render",r,a)}render(){return this.state.error!==void 0?G.createElement(_f.Provider,{value:this.props.routeContext},G.createElement(gJ.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function jve(i){let{routeContext:r,match:a,children:c}=i,l=G.useContext(NO);return l&&l.static&&l.staticContext&&(a.route.errorElement||a.route.ErrorBoundary)&&(l.staticContext._deepestRenderedBoundaryId=a.route.id),G.createElement(_f.Provider,{value:r},c)}function Bve(i,r,a,c){var l;if(r===void 0&&(r=[]),a===void 0&&(a=null),c===void 0&&(c=null),i==null){var h;if(!a)return null;if(a.errors)i=a.matches;else if((h=c)!=null&&h.v7_partialHydration&&r.length===0&&!a.initialized&&a.matches.length>0)i=a.matches;else return null}let m=i,E=(l=a)==null?void 0:l.errors;if(E!=null){let C=m.findIndex(I=>I.route.id&&E?.[I.route.id]!==void 0);C>=0||ur(!1),m=m.slice(0,Math.min(m.length,C+1))}let S=!1,T=-1;if(a&&c&&c.v7_partialHydration)for(let C=0;C<m.length;C++){let I=m[C];if((I.route.HydrateFallback||I.route.hydrateFallbackElement)&&(T=C),I.route.id){let{loaderData:N,errors:P}=a,H=I.route.loader&&N[I.route.id]===void 0&&(!P||P[I.route.id]===void 0);if(I.route.lazy||H){S=!0,T>=0?m=m.slice(0,T+1):m=[m[0]];break}}}return m.reduceRight((C,I,N)=>{let P,H=!1,x=null,B=null;a&&(P=E&&I.route.id?E[I.route.id]:void 0,x=I.route.errorElement||Vve,S&&(T<0&&N===0?(Yve("route-fallback"),H=!0,B=null):T===N&&(H=!0,B=I.route.hydrateFallbackElement||null)));let X=r.concat(m.slice(0,N+1)),Z=()=>{let $;return P?$=x:H?$=B:I.route.Component?$=G.createElement(I.route.Component,null):I.route.element?$=I.route.element:$=C,G.createElement(jve,{match:I,routeContext:{outlet:C,matches:X,isDataRoute:a!=null},children:$})};return a&&(I.route.ErrorBoundary||I.route.errorElement||N===0)?G.createElement(Fve,{location:a.location,revalidation:a.revalidation,component:x,error:P,children:Z(),routeContext:{outlet:null,matches:X,isDataRoute:!0}}):Z()},null)}var yJ=(function(i){return i.UseBlocker="useBlocker",i.UseRevalidator="useRevalidator",i.UseNavigateStable="useNavigate",i})(yJ||{}),vJ=(function(i){return i.UseBlocker="useBlocker",i.UseLoaderData="useLoaderData",i.UseActionData="useActionData",i.UseRouteError="useRouteError",i.UseNavigation="useNavigation",i.UseRouteLoaderData="useRouteLoaderData",i.UseMatches="useMatches",i.UseRevalidator="useRevalidator",i.UseNavigateStable="useNavigate",i.UseRouteId="useRouteId",i})(vJ||{});function Wve(i){let r=G.useContext(NO);return r||ur(!1),r}function Gve(i){let r=G.useContext(mJ);return r||ur(!1),r}function Hve(i){let r=G.useContext(_f);return r||ur(!1),r}function SJ(i){let r=Hve(),a=r.matches[r.matches.length-1];return a.route.id||ur(!1),a.route.id}function zve(){var i;let r=G.useContext(gJ),a=Gve(),c=SJ();return r!==void 0?r:(i=a.errors)==null?void 0:i[c]}function Kve(){let{router:i}=Wve(yJ.UseNavigateStable),r=SJ(vJ.UseNavigateStable),a=G.useRef(!1);return _J(()=>{a.current=!0}),G.useCallback(function(l,h){h===void 0&&(h={}),a.current&&(typeof l=="number"?i.navigate(l):i.navigate(l,VA({fromRouteId:r},h)))},[i,r])}const YK={};function Yve(i,r,a){YK[i]||(YK[i]=!0)}function qve(i,r){i?.v7_startTransition,i?.v7_relativeSplatPath===void 0&&(!r||r.v7_relativeSplatPath),r&&(r.v7_fetcherPersist,r.v7_normalizeFormMethod,r.v7_partialHydration,r.v7_skipActionErrorRevalidation)}function Xve(i){let{to:r,replace:a,state:c,relative:l}=i;cv()||ur(!1);let{future:h,static:m}=G.useContext(gf),{matches:E}=G.useContext(_f),{pathname:S}=Ef(),T=D2(),C=OO(r,AO(E,h.v7_relativeSplatPath),S,l==="path"),I=JSON.stringify(C);return G.useEffect(()=>T(JSON.parse(I),{replace:a,state:c,relative:l}),[T,I,l,a,c]),null}function Jve(i){let{basename:r="/",children:a=null,location:c,navigationType:l=Ss.Pop,navigator:h,static:m=!1,future:E}=i;cv()&&ur(!1);let S=r.replace(/^\/*/,"/"),T=G.useMemo(()=>({basename:S,navigator:h,static:m,future:VA({v7_relativeSplatPath:!1},E)}),[S,E,h,m]);typeof c=="string"&&(c=Ih(c));let{pathname:C="/",search:I="",hash:N="",state:P=null,key:H="default"}=c,x=G.useMemo(()=>{let B=ov(C,S);return B==null?null:{location:{pathname:B,search:I,hash:N,state:P,key:H},navigationType:l}},[S,C,I,N,P,H,l]);return x==null?null:G.createElement(gf.Provider,{value:T},G.createElement(k2.Provider,{children:a,value:x}))}new Promise(()=>{});function $ve(i){let r={hasErrorBoundary:i.ErrorBoundary!=null||i.errorElement!=null};return i.Component&&Object.assign(r,{element:G.createElement(i.Component),Component:void 0}),i.HydrateFallback&&Object.assign(r,{hydrateFallbackElement:G.createElement(i.HydrateFallback),HydrateFallback:void 0}),i.ErrorBoundary&&Object.assign(r,{errorElement:G.createElement(i.ErrorBoundary),ErrorBoundary:void 0}),r}function cw(){return cw=Object.assign?Object.assign.bind():function(i){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(i[c]=a[c])}return i},cw.apply(this,arguments)}function Qve(i,r){if(i==null)return{};var a={},c=Object.keys(i),l,h;for(h=0;h<c.length;h++)l=c[h],!(r.indexOf(l)>=0)&&(a[l]=i[l]);return a}function Zve(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function eSe(i,r){return i.button===0&&(!r||r==="_self")&&!Zve(i)}const tSe=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],nSe="6";try{window.__reactRouterVersion=nSe}catch{}function rSe(i,r){return fve({basename:r?.basename,future:cw({},r?.future,{v7_prependBasename:!0}),history:Vye({window:r?.window}),hydrationData:r?.hydrationData||iSe(),routes:i,mapRouteProperties:$ve,dataStrategy:r?.dataStrategy,patchRoutesOnNavigation:r?.patchRoutesOnNavigation,window:r?.window}).initialize()}function iSe(){var i;let r=(i=window)==null?void 0:i.__staticRouterHydrationData;return r&&r.errors&&(r=cw({},r,{errors:sSe(r.errors)})),r}function sSe(i){if(!i)return null;let r=Object.entries(i),a={};for(let[c,l]of r)if(l&&l.__type==="RouteErrorResponse")a[c]=new UA(l.status,l.statusText,l.data,l.internal===!0);else if(l&&l.__type==="Error"){if(l.__subType){let h=window[l.__subType];if(typeof h=="function")try{let m=new h(l.message);m.stack="",a[c]=m}catch{}}if(a[c]==null){let h=new Error(l.message);h.stack="",a[c]=h}}else a[c]=l;return a}const aSe=G.createContext({isTransitioning:!1}),oSe=G.createContext(new Map),cSe="startTransition",qK=u2[cSe],lSe="flushSync",XK=dme[lSe];function uSe(i){qK?qK(i):i()}function S0(i){XK?XK(i):i()}let dSe=class{constructor(){this.status="pending",this.promise=new Promise((r,a)=>{this.resolve=c=>{this.status==="pending"&&(this.status="resolved",r(c))},this.reject=c=>{this.status==="pending"&&(this.status="rejected",a(c))}})}};function hSe(i){let{fallbackElement:r,router:a,future:c}=i,[l,h]=G.useState(a.state),[m,E]=G.useState(),[S,T]=G.useState({isTransitioning:!1}),[C,I]=G.useState(),[N,P]=G.useState(),[H,x]=G.useState(),B=G.useRef(new Map),{v7_startTransition:X}=c||{},Z=G.useCallback(pe=>{X?uSe(pe):pe()},[X]),$=G.useCallback((pe,Ee)=>{let{deletedFetchers:Ne,flushSync:Ue,viewTransitionOpts:Se}=Ee;pe.fetchers.forEach((Re,Be)=>{Re.data!==void 0&&B.current.set(Be,Re.data)}),Ne.forEach(Re=>B.current.delete(Re));let Xe=a.window==null||a.window.document==null||typeof a.window.document.startViewTransition!="function";if(!Se||Xe){Ue?S0(()=>h(pe)):Z(()=>h(pe));return}if(Ue){S0(()=>{N&&(C&&C.resolve(),N.skipTransition()),T({isTransitioning:!0,flushSync:!0,currentLocation:Se.currentLocation,nextLocation:Se.nextLocation})});let Re=a.window.document.startViewTransition(()=>{S0(()=>h(pe))});Re.finished.finally(()=>{S0(()=>{I(void 0),P(void 0),E(void 0),T({isTransitioning:!1})})}),S0(()=>P(Re));return}N?(C&&C.resolve(),N.skipTransition(),x({state:pe,currentLocation:Se.currentLocation,nextLocation:Se.nextLocation})):(E(pe),T({isTransitioning:!0,flushSync:!1,currentLocation:Se.currentLocation,nextLocation:Se.nextLocation}))},[a.window,N,C,B,Z]);G.useLayoutEffect(()=>a.subscribe($),[a,$]),G.useEffect(()=>{S.isTransitioning&&!S.flushSync&&I(new dSe)},[S]),G.useEffect(()=>{if(C&&m&&a.window){let pe=m,Ee=C.promise,Ne=a.window.document.startViewTransition(async()=>{Z(()=>h(pe)),await Ee});Ne.finished.finally(()=>{I(void 0),P(void 0),E(void 0),T({isTransitioning:!1})}),P(Ne)}},[Z,m,C,a.window]),G.useEffect(()=>{C&&m&&l.location.key===m.location.key&&C.resolve()},[C,N,l.location,m]),G.useEffect(()=>{!S.isTransitioning&&H&&(E(H.state),T({isTransitioning:!0,flushSync:!1,currentLocation:H.currentLocation,nextLocation:H.nextLocation}),x(void 0))},[S.isTransitioning,H]),G.useEffect(()=>{},[]);let le=G.useMemo(()=>({createHref:a.createHref,encodeLocation:a.encodeLocation,go:pe=>a.navigate(pe),push:(pe,Ee,Ne)=>a.navigate(pe,{state:Ee,preventScrollReset:Ne?.preventScrollReset}),replace:(pe,Ee,Ne)=>a.navigate(pe,{replace:!0,state:Ee,preventScrollReset:Ne?.preventScrollReset})}),[a]),re=a.basename||"/",ce=G.useMemo(()=>({router:a,navigator:le,static:!1,basename:re}),[a,le,re]),te=G.useMemo(()=>({v7_relativeSplatPath:a.future.v7_relativeSplatPath}),[a.future.v7_relativeSplatPath]);return G.useEffect(()=>qve(c,a.future),[c,a.future]),G.createElement(G.Fragment,null,G.createElement(NO.Provider,{value:ce},G.createElement(mJ.Provider,{value:l},G.createElement(oSe.Provider,{value:B.current},G.createElement(aSe.Provider,{value:S},G.createElement(Jve,{basename:re,location:l.location,navigationType:l.historyAction,navigator:le,future:te},l.initialized||a.future.v7_partialHydration?G.createElement(pSe,{routes:a.routes,future:a.future,state:l}):r))))),null)}const pSe=G.memo(fSe);function fSe(i){let{routes:r,future:a,state:c}=i;return Mve(r,void 0,c,a)}const mSe=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",gSe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,lw=G.forwardRef(function(r,a){let{onClick:c,relative:l,reloadDocument:h,replace:m,state:E,target:S,to:T,preventScrollReset:C,viewTransition:I}=r,N=Qve(r,tSe),{basename:P}=G.useContext(gf),H,x=!1;if(typeof T=="string"&&gSe.test(T)&&(H=T,mSe))try{let $=new URL(window.location.href),le=T.startsWith("//")?new URL($.protocol+T):new URL(T),re=ov(le.pathname,P);le.origin===$.origin&&re!=null?T=re+le.search+le.hash:x=!0}catch{}let B=xve(T,{relative:l}),X=_Se(T,{replace:m,state:E,target:S,preventScrollReset:C,relative:l,viewTransition:I});function Z($){c&&c($),$.defaultPrevented||X($)}return G.createElement("a",cw({},N,{href:H||B,onClick:x||h?c:Z,ref:a,target:S}))});var JK;(function(i){i.UseScrollRestoration="useScrollRestoration",i.UseSubmit="useSubmit",i.UseSubmitFetcher="useSubmitFetcher",i.UseFetcher="useFetcher",i.useViewTransitionState="useViewTransitionState"})(JK||(JK={}));var $K;(function(i){i.UseFetcher="useFetcher",i.UseFetchers="useFetchers",i.UseScrollRestoration="useScrollRestoration"})($K||($K={}));function _Se(i,r){let{target:a,replace:c,state:l,preventScrollReset:h,relative:m,viewTransition:E}=r===void 0?{}:r,S=D2(),T=Ef(),C=EJ(i,{relative:m});return G.useCallback(I=>{if(eSe(I,a)){I.preventDefault();let N=c!==void 0?c:kg(T)===kg(C);S(i,{replace:N,state:l,preventScrollReset:h,relative:m,viewTransition:E})}},[T,S,C,c,l,a,i,h,m,E])}const ESe=()=>{};var QK={};const TJ=function(i){const r=[];let a=0;for(let c=0;c<i.length;c++){let l=i.charCodeAt(c);l<128?r[a++]=l:l<2048?(r[a++]=l>>6|192,r[a++]=l&63|128):(l&64512)===55296&&c+1<i.length&&(i.charCodeAt(c+1)&64512)===56320?(l=65536+((l&1023)<<10)+(i.charCodeAt(++c)&1023),r[a++]=l>>18|240,r[a++]=l>>12&63|128,r[a++]=l>>6&63|128,r[a++]=l&63|128):(r[a++]=l>>12|224,r[a++]=l>>6&63|128,r[a++]=l&63|128)}return r},ySe=function(i){const r=[];let a=0,c=0;for(;a<i.length;){const l=i[a++];if(l<128)r[c++]=String.fromCharCode(l);else if(l>191&&l<224){const h=i[a++];r[c++]=String.fromCharCode((l&31)<<6|h&63)}else if(l>239&&l<365){const h=i[a++],m=i[a++],E=i[a++],S=((l&7)<<18|(h&63)<<12|(m&63)<<6|E&63)-65536;r[c++]=String.fromCharCode(55296+(S>>10)),r[c++]=String.fromCharCode(56320+(S&1023))}else{const h=i[a++],m=i[a++];r[c++]=String.fromCharCode((l&15)<<12|(h&63)<<6|m&63)}}return r.join("")},wJ={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(i,r){if(!Array.isArray(i))throw Error("encodeByteArray takes an array as a parameter");this.init_();const a=r?this.byteToCharMapWebSafe_:this.byteToCharMap_,c=[];for(let l=0;l<i.length;l+=3){const h=i[l],m=l+1<i.length,E=m?i[l+1]:0,S=l+2<i.length,T=S?i[l+2]:0,C=h>>2,I=(h&3)<<4|E>>4;let N=(E&15)<<2|T>>6,P=T&63;S||(P=64,m||(N=64)),c.push(a[C],a[I],a[N],a[P])}return c.join("")},encodeString(i,r){return this.HAS_NATIVE_SUPPORT&&!r?btoa(i):this.encodeByteArray(TJ(i),r)},decodeString(i,r){return this.HAS_NATIVE_SUPPORT&&!r?atob(i):ySe(this.decodeStringToByteArray(i,r))},decodeStringToByteArray(i,r){this.init_();const a=r?this.charToByteMapWebSafe_:this.charToByteMap_,c=[];for(let l=0;l<i.length;){const h=a[i.charAt(l++)],E=l<i.length?a[i.charAt(l)]:0;++l;const T=l<i.length?a[i.charAt(l)]:64;++l;const I=l<i.length?a[i.charAt(l)]:64;if(++l,h==null||E==null||T==null||I==null)throw new vSe;const N=h<<2|E>>4;if(c.push(N),T!==64){const P=E<<4&240|T>>2;if(c.push(P),I!==64){const H=T<<6&192|I;c.push(H)}}}return c},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let i=0;i<this.ENCODED_VALS.length;i++)this.byteToCharMap_[i]=this.ENCODED_VALS.charAt(i),this.charToByteMap_[this.byteToCharMap_[i]]=i,this.byteToCharMapWebSafe_[i]=this.ENCODED_VALS_WEBSAFE.charAt(i),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]]=i,i>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)]=i,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)]=i)}}};class vSe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const SSe=function(i){const r=TJ(i);return wJ.encodeByteArray(r,!0)},CJ=function(i){return SSe(i).replace(/\./g,"")},RJ=function(i){try{return wJ.decodeString(i,!0)}catch(r){console.error("base64Decode failed: ",r)}return null};function TSe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const wSe=()=>TSe().__FIREBASE_DEFAULTS__,CSe=()=>{if(typeof process>"u"||typeof QK>"u")return;const i=QK.__FIREBASE_DEFAULTS__;if(i)return JSON.parse(i)},RSe=()=>{if(typeof document>"u")return;let i;try{i=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const r=i&&RJ(i[1]);return r&&JSON.parse(r)},x2=()=>{try{return ESe()||wSe()||CSe()||RSe()}catch(i){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${i}`);return}},bSe=i=>x2()?.emulatorHosts?.[i],bJ=()=>x2()?.config,IJ=i=>x2()?.[`_${i}`];class ISe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((r,a)=>{this.resolve=r,this.reject=a})}wrapCallback(r){return(a,c)=>{a?this.reject(a):this.resolve(c),typeof r=="function"&&(this.promise.catch(()=>{}),r.length===1?r(a):r(a,c))}}}function PO(i){try{return(i.startsWith("http://")||i.startsWith("https://")?new URL(i).hostname:i).endsWith(".cloudworkstations.dev")}catch{return!1}}async function ASe(i){return(await fetch(i,{credentials:"include"})).ok}const j0={};function OSe(){const i={prod:[],emulator:[]};for(const r of Object.keys(j0))j0[r]?i.emulator.push(r):i.prod.push(r);return i}function NSe(i){let r=document.getElementById(i),a=!1;return r||(r=document.createElement("div"),r.setAttribute("id",i),a=!0),{created:a,element:r}}let ZK=!1;function PSe(i,r){if(typeof window>"u"||typeof document>"u"||!PO(window.location.host)||j0[i]===r||j0[i]||ZK)return;j0[i]=r;function a(N){return`__firebase__banner__${N}`}const c="__firebase__banner",h=OSe().prod.length>0;function m(){const N=document.getElementById(c);N&&N.remove()}function E(N){N.style.display="flex",N.style.background="#7faaf0",N.style.position="fixed",N.style.bottom="5px",N.style.left="5px",N.style.padding=".5em",N.style.borderRadius="5px",N.style.alignItems="center"}function S(N,P){N.setAttribute("width","24"),N.setAttribute("id",P),N.setAttribute("height","24"),N.setAttribute("viewBox","0 0 24 24"),N.setAttribute("fill","none"),N.style.marginLeft="-6px"}function T(){const N=document.createElement("span");return N.style.cursor="pointer",N.style.marginLeft="16px",N.style.fontSize="24px",N.innerHTML=" &times;",N.onclick=()=>{ZK=!0,m()},N}function C(N,P){N.setAttribute("id",P),N.innerText="Learn more",N.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",N.setAttribute("target","__blank"),N.style.paddingLeft="5px",N.style.textDecoration="underline"}function I(){const N=NSe(c),P=a("text"),H=document.getElementById(P)||document.createElement("span"),x=a("learnmore"),B=document.getElementById(x)||document.createElement("a"),X=a("preprendIcon"),Z=document.getElementById(X)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(N.created){const $=N.element;E($),C(B,x);const le=T();S(Z,X),$.append(Z,H,B,le),document.body.appendChild($)}h?(H.innerText="Preview backend disconnected.",Z.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(Z.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,H.innerText="Preview backend running in this workspace."),H.setAttribute("id",P)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",I):I()}function to(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function kSe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(to())}function DSe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function AJ(){const i=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof i=="object"&&i.id!==void 0}function xSe(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function LSe(){const i=to();return i.indexOf("MSIE ")>=0||i.indexOf("Trident/")>=0}function OJ(){try{return typeof indexedDB=="object"}catch{return!1}}function NJ(){return new Promise((i,r)=>{try{let a=!0;const c="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(c);l.onsuccess=()=>{l.result.close(),a||self.indexedDB.deleteDatabase(c),i(!0)},l.onupgradeneeded=()=>{a=!1},l.onerror=()=>{r(l.error?.message||"")}}catch(a){r(a)}})}function MSe(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}const USe="FirebaseError";class Od extends Error{constructor(r,a,c){super(a),this.code=r,this.customData=c,this.name=USe,Object.setPrototypeOf(this,Od.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,jg.prototype.create)}}class jg{constructor(r,a,c){this.service=r,this.serviceName=a,this.errors=c}create(r,...a){const c=a[0]||{},l=`${this.service}/${r}`,h=this.errors[r],m=h?VSe(h,c):"Error",E=`${this.serviceName}: ${m} (${l}).`;return new Od(l,E,c)}}function VSe(i,r){return i.replace(FSe,(a,c)=>{const l=r[c];return l!=null?String(l):`<${c}?>`})}const FSe=/\{\$([^}]+)}/g;function jSe(i){for(const r in i)if(Object.prototype.hasOwnProperty.call(i,r))return!1;return!0}function Dg(i,r){if(i===r)return!0;const a=Object.keys(i),c=Object.keys(r);for(const l of a){if(!c.includes(l))return!1;const h=i[l],m=r[l];if(e9(h)&&e9(m)){if(!Dg(h,m))return!1}else if(h!==m)return!1}for(const l of c)if(!a.includes(l))return!1;return!0}function e9(i){return i!==null&&typeof i=="object"}function lv(i){const r=[];for(const[a,c]of Object.entries(i))Array.isArray(c)?c.forEach(l=>{r.push(encodeURIComponent(a)+"="+encodeURIComponent(l))}):r.push(encodeURIComponent(a)+"="+encodeURIComponent(c));return r.length?"&"+r.join("&"):""}function N0(i){const r={};return i.replace(/^\?/,"").split("&").forEach(c=>{if(c){const[l,h]=c.split("=");r[decodeURIComponent(l)]=decodeURIComponent(h)}}),r}function P0(i){const r=i.indexOf("?");if(!r)return"";const a=i.indexOf("#",r);return i.substring(r,a>0?a:void 0)}function BSe(i,r){const a=new WSe(i,r);return a.subscribe.bind(a)}class WSe{constructor(r,a){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=a,this.task.then(()=>{r(this)}).catch(c=>{this.error(c)})}next(r){this.forEachObserver(a=>{a.next(r)})}error(r){this.forEachObserver(a=>{a.error(r)}),this.close(r)}complete(){this.forEachObserver(r=>{r.complete()}),this.close()}subscribe(r,a,c){let l;if(r===void 0&&a===void 0&&c===void 0)throw new Error("Missing Observer.");GSe(r,["next","error","complete"])?l=r:l={next:r,error:a,complete:c},l.next===void 0&&(l.next=Dx),l.error===void 0&&(l.error=Dx),l.complete===void 0&&(l.complete=Dx);const h=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),h}unsubscribeOne(r){this.observers===void 0||this.observers[r]===void 0||(delete this.observers[r],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(r){if(!this.finalized)for(let a=0;a<this.observers.length;a++)this.sendOne(a,r)}sendOne(r,a){this.task.then(()=>{if(this.observers!==void 0&&this.observers[r]!==void 0)try{a(this.observers[r])}catch(c){typeof console<"u"&&console.error&&console.error(c)}})}close(r){this.finalized||(this.finalized=!0,r!==void 0&&(this.finalError=r),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function GSe(i,r){if(typeof i!="object"||i===null)return!1;for(const a of r)if(a in i&&typeof i[a]=="function")return!0;return!1}function Dx(){}const HSe=1e3,zSe=2,KSe=14400*1e3,YSe=.5;function t9(i,r=HSe,a=zSe){const c=r*Math.pow(a,i),l=Math.round(YSe*c*(Math.random()-.5)*2);return Math.min(KSe,c+l)}function vc(i){return i&&i._delegate?i._delegate:i}class Cd{constructor(r,a,c){this.name=r,this.instanceFactory=a,this.type=c,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(r){return this.instantiationMode=r,this}setMultipleInstances(r){return this.multipleInstances=r,this}setServiceProps(r){return this.serviceProps=r,this}setInstanceCreatedCallback(r){return this.onInstanceCreated=r,this}}const hg="[DEFAULT]";class qSe{constructor(r,a){this.name=r,this.container=a,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(r){const a=this.normalizeInstanceIdentifier(r);if(!this.instancesDeferred.has(a)){const c=new ISe;if(this.instancesDeferred.set(a,c),this.isInitialized(a)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:a});l&&c.resolve(l)}catch{}}return this.instancesDeferred.get(a).promise}getImmediate(r){const a=this.normalizeInstanceIdentifier(r?.identifier),c=r?.optional??!1;if(this.isInitialized(a)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:a})}catch(l){if(c)return null;throw l}else{if(c)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(r){if(r.name!==this.name)throw Error(`Mismatching Component ${r.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=r,!!this.shouldAutoInitialize()){if(JSe(r))try{this.getOrInitializeService({instanceIdentifier:hg})}catch{}for(const[a,c]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(a);try{const h=this.getOrInitializeService({instanceIdentifier:l});c.resolve(h)}catch{}}}}clearInstance(r=hg){this.instancesDeferred.delete(r),this.instancesOptions.delete(r),this.instances.delete(r)}async delete(){const r=Array.from(this.instances.values());await Promise.all([...r.filter(a=>"INTERNAL"in a).map(a=>a.INTERNAL.delete()),...r.filter(a=>"_delete"in a).map(a=>a._delete())])}isComponentSet(){return this.component!=null}isInitialized(r=hg){return this.instances.has(r)}getOptions(r=hg){return this.instancesOptions.get(r)||{}}initialize(r={}){const{options:a={}}=r,c=this.normalizeInstanceIdentifier(r.instanceIdentifier);if(this.isInitialized(c))throw Error(`${this.name}(${c}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:c,options:a});for(const[h,m]of this.instancesDeferred.entries()){const E=this.normalizeInstanceIdentifier(h);c===E&&m.resolve(l)}return l}onInit(r,a){const c=this.normalizeInstanceIdentifier(a),l=this.onInitCallbacks.get(c)??new Set;l.add(r),this.onInitCallbacks.set(c,l);const h=this.instances.get(c);return h&&r(h,c),()=>{l.delete(r)}}invokeOnInitCallbacks(r,a){const c=this.onInitCallbacks.get(a);if(c)for(const l of c)try{l(r,a)}catch{}}getOrInitializeService({instanceIdentifier:r,options:a={}}){let c=this.instances.get(r);if(!c&&this.component&&(c=this.component.instanceFactory(this.container,{instanceIdentifier:XSe(r),options:a}),this.instances.set(r,c),this.instancesOptions.set(r,a),this.invokeOnInitCallbacks(c,r),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,r,c)}catch{}return c||null}normalizeInstanceIdentifier(r=hg){return this.component?this.component.multipleInstances?r:hg:r}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function XSe(i){return i===hg?void 0:i}function JSe(i){return i.instantiationMode==="EAGER"}class $Se{constructor(r){this.name=r,this.providers=new Map}addComponent(r){const a=this.getProvider(r.name);if(a.isComponentSet())throw new Error(`Component ${r.name} has already been registered with ${this.name}`);a.setComponent(r)}addOrOverwriteComponent(r){this.getProvider(r.name).isComponentSet()&&this.providers.delete(r.name),this.addComponent(r)}getProvider(r){if(this.providers.has(r))return this.providers.get(r);const a=new qSe(r,this);return this.providers.set(r,a),a}getProviders(){return Array.from(this.providers.values())}}var hi;(function(i){i[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT"})(hi||(hi={}));const QSe={debug:hi.DEBUG,verbose:hi.VERBOSE,info:hi.INFO,warn:hi.WARN,error:hi.ERROR,silent:hi.SILENT},ZSe=hi.INFO,eTe={[hi.DEBUG]:"log",[hi.VERBOSE]:"log",[hi.INFO]:"info",[hi.WARN]:"warn",[hi.ERROR]:"error"},tTe=(i,r,...a)=>{if(r<i.logLevel)return;const c=new Date().toISOString(),l=eTe[r];if(l)console[l](`[${c}]  ${i.name}:`,...a);else throw new Error(`Attempted to log a message with an invalid logType (value: ${r})`)};class L2{constructor(r){this.name=r,this._logLevel=ZSe,this._logHandler=tTe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(r){if(!(r in hi))throw new TypeError(`Invalid value "${r}" assigned to \`logLevel\``);this._logLevel=r}setLogLevel(r){this._logLevel=typeof r=="string"?QSe[r]:r}get logHandler(){return this._logHandler}set logHandler(r){if(typeof r!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=r}get userLogHandler(){return this._userLogHandler}set userLogHandler(r){this._userLogHandler=r}debug(...r){this._userLogHandler&&this._userLogHandler(this,hi.DEBUG,...r),this._logHandler(this,hi.DEBUG,...r)}log(...r){this._userLogHandler&&this._userLogHandler(this,hi.VERBOSE,...r),this._logHandler(this,hi.VERBOSE,...r)}info(...r){this._userLogHandler&&this._userLogHandler(this,hi.INFO,...r),this._logHandler(this,hi.INFO,...r)}warn(...r){this._userLogHandler&&this._userLogHandler(this,hi.WARN,...r),this._logHandler(this,hi.WARN,...r)}error(...r){this._userLogHandler&&this._userLogHandler(this,hi.ERROR,...r),this._logHandler(this,hi.ERROR,...r)}}const nTe=(i,r)=>r.some(a=>i instanceof a);let n9,r9;function rTe(){return n9||(n9=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function iTe(){return r9||(r9=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const PJ=new WeakMap,QL=new WeakMap,kJ=new WeakMap,xx=new WeakMap,M2=new WeakMap;function sTe(i){const r=new Promise((a,c)=>{const l=()=>{i.removeEventListener("success",h),i.removeEventListener("error",m)},h=()=>{a(ef(i.result)),l()},m=()=>{c(i.error),l()};i.addEventListener("success",h),i.addEventListener("error",m)});return r.then(a=>{a instanceof IDBCursor&&PJ.set(a,i)}).catch(()=>{}),M2.set(r,i),r}function aTe(i){if(QL.has(i))return;const r=new Promise((a,c)=>{const l=()=>{i.removeEventListener("complete",h),i.removeEventListener("error",m),i.removeEventListener("abort",m)},h=()=>{a(),l()},m=()=>{c(i.error||new DOMException("AbortError","AbortError")),l()};i.addEventListener("complete",h),i.addEventListener("error",m),i.addEventListener("abort",m)});QL.set(i,r)}let ZL={get(i,r,a){if(i instanceof IDBTransaction){if(r==="done")return QL.get(i);if(r==="objectStoreNames")return i.objectStoreNames||kJ.get(i);if(r==="store")return a.objectStoreNames[1]?void 0:a.objectStore(a.objectStoreNames[0])}return ef(i[r])},set(i,r,a){return i[r]=a,!0},has(i,r){return i instanceof IDBTransaction&&(r==="done"||r==="store")?!0:r in i}};function oTe(i){ZL=i(ZL)}function cTe(i){return i===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(r,...a){const c=i.call(Lx(this),r,...a);return kJ.set(c,r.sort?r.sort():[r]),ef(c)}:iTe().includes(i)?function(...r){return i.apply(Lx(this),r),ef(PJ.get(this))}:function(...r){return ef(i.apply(Lx(this),r))}}function lTe(i){return typeof i=="function"?cTe(i):(i instanceof IDBTransaction&&aTe(i),nTe(i,rTe())?new Proxy(i,ZL):i)}function ef(i){if(i instanceof IDBRequest)return sTe(i);if(xx.has(i))return xx.get(i);const r=lTe(i);return r!==i&&(xx.set(i,r),M2.set(r,i)),r}const Lx=i=>M2.get(i);function DJ(i,r,{blocked:a,upgrade:c,blocking:l,terminated:h}={}){const m=indexedDB.open(i,r),E=ef(m);return c&&m.addEventListener("upgradeneeded",S=>{c(ef(m.result),S.oldVersion,S.newVersion,ef(m.transaction),S)}),a&&m.addEventListener("blocked",S=>a(S.oldVersion,S.newVersion,S)),E.then(S=>{h&&S.addEventListener("close",()=>h()),l&&S.addEventListener("versionchange",T=>l(T.oldVersion,T.newVersion,T))}).catch(()=>{}),E}const uTe=["get","getKey","getAll","getAllKeys","count"],dTe=["put","add","delete","clear"],Mx=new Map;function i9(i,r){if(!(i instanceof IDBDatabase&&!(r in i)&&typeof r=="string"))return;if(Mx.get(r))return Mx.get(r);const a=r.replace(/FromIndex$/,""),c=r!==a,l=dTe.includes(a);if(!(a in(c?IDBIndex:IDBObjectStore).prototype)||!(l||uTe.includes(a)))return;const h=async function(m,...E){const S=this.transaction(m,l?"readwrite":"readonly");let T=S.store;return c&&(T=T.index(E.shift())),(await Promise.all([T[a](...E),l&&S.done]))[0]};return Mx.set(r,h),h}oTe(i=>({...i,get:(r,a,c)=>i9(r,a)||i.get(r,a,c),has:(r,a)=>!!i9(r,a)||i.has(r,a)}));class hTe{constructor(r){this.container=r}getPlatformInfoString(){return this.container.getProviders().map(a=>{if(pTe(a)){const c=a.getImmediate();return`${c.library}/${c.version}`}else return null}).filter(a=>a).join(" ")}}function pTe(i){return i.getComponent()?.type==="VERSION"}const eM="@firebase/app",s9="0.14.6";const yh=new L2("@firebase/app"),fTe="@firebase/app-compat",mTe="@firebase/analytics-compat",gTe="@firebase/analytics",_Te="@firebase/app-check-compat",ETe="@firebase/app-check",yTe="@firebase/auth",vTe="@firebase/auth-compat",STe="@firebase/database",TTe="@firebase/data-connect",wTe="@firebase/database-compat",CTe="@firebase/functions",RTe="@firebase/functions-compat",bTe="@firebase/installations",ITe="@firebase/installations-compat",ATe="@firebase/messaging",OTe="@firebase/messaging-compat",NTe="@firebase/performance",PTe="@firebase/performance-compat",kTe="@firebase/remote-config",DTe="@firebase/remote-config-compat",xTe="@firebase/storage",LTe="@firebase/storage-compat",MTe="@firebase/firestore",UTe="@firebase/ai",VTe="@firebase/firestore-compat",FTe="firebase",jTe="12.6.0";const tM="[DEFAULT]",BTe={[eM]:"fire-core",[fTe]:"fire-core-compat",[gTe]:"fire-analytics",[mTe]:"fire-analytics-compat",[ETe]:"fire-app-check",[_Te]:"fire-app-check-compat",[yTe]:"fire-auth",[vTe]:"fire-auth-compat",[STe]:"fire-rtdb",[TTe]:"fire-data-connect",[wTe]:"fire-rtdb-compat",[CTe]:"fire-fn",[RTe]:"fire-fn-compat",[bTe]:"fire-iid",[ITe]:"fire-iid-compat",[ATe]:"fire-fcm",[OTe]:"fire-fcm-compat",[NTe]:"fire-perf",[PTe]:"fire-perf-compat",[kTe]:"fire-rc",[DTe]:"fire-rc-compat",[xTe]:"fire-gcs",[LTe]:"fire-gcs-compat",[MTe]:"fire-fst",[VTe]:"fire-fst-compat",[UTe]:"fire-vertex","fire-js":"fire-js",[FTe]:"fire-js-all"};const FA=new Map,WTe=new Map,nM=new Map;function a9(i,r){try{i.container.addComponent(r)}catch(a){yh.debug(`Component ${r.name} failed to register with FirebaseApp ${i.name}`,a)}}function vh(i){const r=i.name;if(nM.has(r))return yh.debug(`There were multiple attempts to register component ${r}.`),!1;nM.set(r,i);for(const a of FA.values())a9(a,i);for(const a of WTe.values())a9(a,i);return!0}function uv(i,r){const a=i.container.getProvider("heartbeat").getImmediate({optional:!0});return a&&a.triggerHeartbeat(),i.container.getProvider(r)}function Ao(i){return i==null?!1:i.settings!==void 0}const GTe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},tf=new jg("app","Firebase",GTe);class HTe{constructor(r,a,c){this._isDeleted=!1,this._options={...r},this._config={...a},this._name=a.name,this._automaticDataCollectionEnabled=a.automaticDataCollectionEnabled,this._container=c,this.container.addComponent(new Cd("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(r){this.checkDestroyed(),this._automaticDataCollectionEnabled=r}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(r){this._isDeleted=r}checkDestroyed(){if(this.isDeleted)throw tf.create("app-deleted",{appName:this._name})}}const xw=jTe;function xJ(i,r={}){let a=i;typeof r!="object"&&(r={name:r});const c={name:tM,automaticDataCollectionEnabled:!0,...r},l=c.name;if(typeof l!="string"||!l)throw tf.create("bad-app-name",{appName:String(l)});if(a||(a=bJ()),!a)throw tf.create("no-options");const h=FA.get(l);if(h){if(Dg(a,h.options)&&Dg(c,h.config))return h;throw tf.create("duplicate-app",{appName:l})}const m=new $Se(l);for(const S of nM.values())m.addComponent(S);const E=new HTe(a,c,m);return FA.set(l,E),E}function LJ(i=tM){const r=FA.get(i);if(!r&&i===tM&&bJ())return xJ();if(!r)throw tf.create("no-app",{appName:i});return r}function yd(i,r,a){let c=BTe[i]??i;a&&(c+=`-${a}`);const l=c.match(/\s|\//),h=r.match(/\s|\//);if(l||h){const m=[`Unable to register library "${c}" with version "${r}":`];l&&m.push(`library name "${c}" contains illegal characters (whitespace or "/")`),l&&h&&m.push("and"),h&&m.push(`version name "${r}" contains illegal characters (whitespace or "/")`),yh.warn(m.join(" "));return}vh(new Cd(`${c}-version`,()=>({library:c,version:r}),"VERSION"))}const zTe="firebase-heartbeat-database",KTe=1,uw="firebase-heartbeat-store";let Ux=null;function MJ(){return Ux||(Ux=DJ(zTe,KTe,{upgrade:(i,r)=>{switch(r){case 0:try{i.createObjectStore(uw)}catch(a){console.warn(a)}}}}).catch(i=>{throw tf.create("idb-open",{originalErrorMessage:i.message})})),Ux}async function YTe(i){try{const a=(await MJ()).transaction(uw),c=await a.objectStore(uw).get(UJ(i));return await a.done,c}catch(r){if(r instanceof Od)yh.warn(r.message);else{const a=tf.create("idb-get",{originalErrorMessage:r?.message});yh.warn(a.message)}}}async function o9(i,r){try{const c=(await MJ()).transaction(uw,"readwrite");await c.objectStore(uw).put(r,UJ(i)),await c.done}catch(a){if(a instanceof Od)yh.warn(a.message);else{const c=tf.create("idb-set",{originalErrorMessage:a?.message});yh.warn(c.message)}}}function UJ(i){return`${i.name}!${i.options.appId}`}const qTe=1024,XTe=30;class JTe{constructor(r){this.container=r,this._heartbeatsCache=null;const a=this.container.getProvider("app").getImmediate();this._storage=new QTe(a),this._heartbeatsCachePromise=this._storage.read().then(c=>(this._heartbeatsCache=c,c))}async triggerHeartbeat(){try{const a=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),c=c9();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===c||this._heartbeatsCache.heartbeats.some(l=>l.date===c))return;if(this._heartbeatsCache.heartbeats.push({date:c,agent:a}),this._heartbeatsCache.heartbeats.length>XTe){const l=ZTe(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(l,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){yh.warn(r)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const r=c9(),{heartbeatsToSend:a,unsentEntries:c}=$Te(this._heartbeatsCache.heartbeats),l=CJ(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=r,c.length>0?(this._heartbeatsCache.heartbeats=c,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),l}catch(r){return yh.warn(r),""}}}function c9(){return new Date().toISOString().substring(0,10)}function $Te(i,r=qTe){const a=[];let c=i.slice();for(const l of i){const h=a.find(m=>m.agent===l.agent);if(h){if(h.dates.push(l.date),l9(a)>r){h.dates.pop();break}}else if(a.push({agent:l.agent,dates:[l.date]}),l9(a)>r){a.pop();break}c=c.slice(1)}return{heartbeatsToSend:a,unsentEntries:c}}class QTe{constructor(r){this.app=r,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return OJ()?NJ().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const a=await YTe(this.app);return a?.heartbeats?a:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(r){if(await this._canUseIndexedDBPromise){const c=await this.read();return o9(this.app,{lastSentHeartbeatDate:r.lastSentHeartbeatDate??c.lastSentHeartbeatDate,heartbeats:r.heartbeats})}else return}async add(r){if(await this._canUseIndexedDBPromise){const c=await this.read();return o9(this.app,{lastSentHeartbeatDate:r.lastSentHeartbeatDate??c.lastSentHeartbeatDate,heartbeats:[...c.heartbeats,...r.heartbeats]})}else return}}function l9(i){return CJ(JSON.stringify({version:2,heartbeats:i})).length}function ZTe(i){if(i.length===0)return-1;let r=0,a=i[0].date;for(let c=1;c<i.length;c++)i[c].date<a&&(a=i[c].date,r=c);return r}function e0e(i){vh(new Cd("platform-logger",r=>new hTe(r),"PRIVATE")),vh(new Cd("heartbeat",r=>new JTe(r),"PRIVATE")),yd(eM,s9,i),yd(eM,s9,"esm2020"),yd("fire-js","")}e0e("");function VJ(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const t0e=VJ,FJ=new jg("auth","Firebase",VJ());const jA=new L2("@firebase/auth");function n0e(i,...r){jA.logLevel<=hi.WARN&&jA.warn(`Auth (${xw}): ${i}`,...r)}function pA(i,...r){jA.logLevel<=hi.ERROR&&jA.error(`Auth (${xw}): ${i}`,...r)}function cl(i,...r){throw V2(i,...r)}function No(i,...r){return V2(i,...r)}function U2(i,r,a){const c={...t0e(),[r]:a};return new jg("auth","Firebase",c).create(r,{appName:i.name})}function cu(i){return U2(i,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function r0e(i,r,a){const c=a;if(!(r instanceof c))throw c.name!==r.constructor.name&&cl(i,"argument-error"),U2(i,"argument-error",`Type of ${r.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function V2(i,...r){if(typeof i!="string"){const a=r[0],c=[...r.slice(1)];return c[0]&&(c[0].appName=i.name),i._errorFactory.create(a,...c)}return FJ.create(i,...r)}function Mt(i,r,...a){if(!i)throw V2(r,...a)}function ph(i){const r="INTERNAL ASSERTION FAILED: "+i;throw pA(r),new Error(r)}function Sh(i,r){i||ph(r)}function rM(){return typeof self<"u"&&self.location?.href||""}function jJ(){return u9()==="http:"||u9()==="https:"}function u9(){return typeof self<"u"&&self.location?.protocol||null}function i0e(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(jJ()||AJ()||"connection"in navigator)?navigator.onLine:!0}function s0e(){if(typeof navigator>"u")return null;const i=navigator;return i.languages&&i.languages[0]||i.language||null}class Lw{constructor(r,a){this.shortDelay=r,this.longDelay=a,Sh(a>r,"Short delay should be less than long delay!"),this.isMobile=kSe()||xSe()}get(){return i0e()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function F2(i,r){Sh(i.emulator,"Emulator should always be set here");const{url:a}=i.emulator;return r?`${a}${r.startsWith("/")?r.slice(1):r}`:a}class BJ{static initialize(r,a,c){this.fetchImpl=r,a&&(this.headersImpl=a),c&&(this.responseImpl=c)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ph("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ph("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ph("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const a0e={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const o0e=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],c0e=new Lw(3e4,6e4);function Uo(i,r){return i.tenantId&&!r.tenantId?{...r,tenantId:i.tenantId}:r}async function ll(i,r,a,c,l={}){return WJ(i,l,async()=>{let h={},m={};c&&(r==="GET"?m=c:h={body:JSON.stringify(c)});const E=lv({key:i.config.apiKey,...m}).slice(1),S=await i._getAdditionalHeaders();S["Content-Type"]="application/json",i.languageCode&&(S["X-Firebase-Locale"]=i.languageCode);const T={method:r,headers:S,...h};return DSe()||(T.referrerPolicy="no-referrer"),i.emulatorConfig&&PO(i.emulatorConfig.host)&&(T.credentials="include"),BJ.fetch()(await GJ(i,i.config.apiHost,a,E),T)})}async function WJ(i,r,a){i._canInitEmulator=!1;const c={...a0e,...r};try{const l=new u0e(i),h=await Promise.race([a(),l.promise]);l.clearNetworkTimeout();const m=await h.json();if("needConfirmation"in m)throw k0(i,"account-exists-with-different-credential",m);if(h.ok&&!("errorMessage"in m))return m;{const E=h.ok?m.errorMessage:m.error.message,[S,T]=E.split(" : ");if(S==="FEDERATED_USER_ID_ALREADY_LINKED")throw k0(i,"credential-already-in-use",m);if(S==="EMAIL_EXISTS")throw k0(i,"email-already-in-use",m);if(S==="USER_DISABLED")throw k0(i,"user-disabled",m);const C=c[S]||S.toLowerCase().replace(/[_\s]+/g,"-");if(T)throw U2(i,C,T);cl(i,C)}}catch(l){if(l instanceof Od)throw l;cl(i,"network-request-failed",{message:String(l)})}}async function yf(i,r,a,c,l={}){const h=await ll(i,r,a,c,l);return"mfaPendingCredential"in h&&cl(i,"multi-factor-auth-required",{_serverResponse:h}),h}async function GJ(i,r,a,c){const l=`${r}${a}?${c}`,h=i,m=h.config.emulator?F2(i.config,l):`${i.config.apiScheme}://${l}`;return o0e.includes(a)&&(await h._persistenceManagerAvailable,h._getPersistenceType()==="COOKIE")?h._getPersistence()._getFinalTarget(m).toString():m}function l0e(i){switch(i){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class u0e{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(r){this.auth=r,this.timer=null,this.promise=new Promise((a,c)=>{this.timer=setTimeout(()=>c(No(this.auth,"network-request-failed")),c0e.get())})}}function k0(i,r,a){const c={appName:i.name};a.email&&(c.email=a.email),a.phoneNumber&&(c.phoneNumber=a.phoneNumber);const l=No(i,r,c);return l.customData._tokenResponse=a,l}function d9(i){return i!==void 0&&i.getResponse!==void 0}function h9(i){return i!==void 0&&i.enterprise!==void 0}class HJ{constructor(r){if(this.siteKey="",this.recaptchaEnforcementState=[],r.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=r.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=r.recaptchaEnforcementState}getProviderEnforcementState(r){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const a of this.recaptchaEnforcementState)if(a.provider&&a.provider===r)return l0e(a.enforcementState);return null}isProviderEnabled(r){return this.getProviderEnforcementState(r)==="ENFORCE"||this.getProviderEnforcementState(r)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function d0e(i){return(await ll(i,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function zJ(i,r){return ll(i,"GET","/v2/recaptchaConfig",Uo(i,r))}async function h0e(i,r){return ll(i,"POST","/v1/accounts:delete",r)}async function BA(i,r){return ll(i,"POST","/v1/accounts:lookup",r)}function B0(i){if(i)try{const r=new Date(Number(i));if(!isNaN(r.getTime()))return r.toUTCString()}catch{}}async function p0e(i,r=!1){const a=vc(i),c=await a.getIdToken(r),l=j2(c);Mt(l&&l.exp&&l.auth_time&&l.iat,a.auth,"internal-error");const h=typeof l.firebase=="object"?l.firebase:void 0,m=h?.sign_in_provider;return{claims:l,token:c,authTime:B0(Vx(l.auth_time)),issuedAtTime:B0(Vx(l.iat)),expirationTime:B0(Vx(l.exp)),signInProvider:m||null,signInSecondFactor:h?.sign_in_second_factor||null}}function Vx(i){return Number(i)*1e3}function j2(i){const[r,a,c]=i.split(".");if(r===void 0||a===void 0||c===void 0)return pA("JWT malformed, contained fewer than 3 sections"),null;try{const l=RJ(a);return l?JSON.parse(l):(pA("Failed to decode base64 JWT payload"),null)}catch(l){return pA("Caught error parsing JWT payload as JSON",l?.toString()),null}}function p9(i){const r=j2(i);return Mt(r,"internal-error"),Mt(typeof r.exp<"u","internal-error"),Mt(typeof r.iat<"u","internal-error"),Number(r.exp)-Number(r.iat)}async function dw(i,r,a=!1){if(a)return r;try{return await r}catch(c){throw c instanceof Od&&f0e(c)&&i.auth.currentUser===i&&await i.auth.signOut(),c}}function f0e({code:i}){return i==="auth/user-disabled"||i==="auth/user-token-expired"}class m0e{constructor(r){this.user=r,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(r){if(r){const a=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),a}else{this.errorBackoff=3e4;const c=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,c)}}schedule(r=!1){if(!this.isRunning)return;const a=this.getInterval(r);this.timerId=setTimeout(async()=>{await this.iteration()},a)}async iteration(){try{await this.user.getIdToken(!0)}catch(r){r?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class iM{constructor(r,a){this.createdAt=r,this.lastLoginAt=a,this._initializeTime()}_initializeTime(){this.lastSignInTime=B0(this.lastLoginAt),this.creationTime=B0(this.createdAt)}_copy(r){this.createdAt=r.createdAt,this.lastLoginAt=r.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function WA(i){const r=i.auth,a=await i.getIdToken(),c=await dw(i,BA(r,{idToken:a}));Mt(c?.users.length,r,"internal-error");const l=c.users[0];i._notifyReloadListener(l);const h=l.providerUserInfo?.length?KJ(l.providerUserInfo):[],m=_0e(i.providerData,h),E=i.isAnonymous,S=!(i.email&&l.passwordHash)&&!m?.length,T=E?S:!1,C={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:m,metadata:new iM(l.createdAt,l.lastLoginAt),isAnonymous:T};Object.assign(i,C)}async function g0e(i){const r=vc(i);await WA(r),await r.auth._persistUserIfCurrent(r),r.auth._notifyListenersIfCurrent(r)}function _0e(i,r){return[...i.filter(c=>!r.some(l=>l.providerId===c.providerId)),...r]}function KJ(i){return i.map(({providerId:r,...a})=>({providerId:r,uid:a.rawId||"",displayName:a.displayName||null,email:a.email||null,phoneNumber:a.phoneNumber||null,photoURL:a.photoUrl||null}))}async function E0e(i,r){const a=await WJ(i,{},async()=>{const c=lv({grant_type:"refresh_token",refresh_token:r}).slice(1),{tokenApiHost:l,apiKey:h}=i.config,m=await GJ(i,l,"/v1/token",`key=${h}`),E=await i._getAdditionalHeaders();E["Content-Type"]="application/x-www-form-urlencoded";const S={method:"POST",headers:E,body:c};return i.emulatorConfig&&PO(i.emulatorConfig.host)&&(S.credentials="include"),BJ.fetch()(m,S)});return{accessToken:a.access_token,expiresIn:a.expires_in,refreshToken:a.refresh_token}}async function y0e(i,r){return ll(i,"POST","/v2/accounts:revokeToken",Uo(i,r))}class ky{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(r){Mt(r.idToken,"internal-error"),Mt(typeof r.idToken<"u","internal-error"),Mt(typeof r.refreshToken<"u","internal-error");const a="expiresIn"in r&&typeof r.expiresIn<"u"?Number(r.expiresIn):p9(r.idToken);this.updateTokensAndExpiration(r.idToken,r.refreshToken,a)}updateFromIdToken(r){Mt(r.length!==0,"internal-error");const a=p9(r);this.updateTokensAndExpiration(r,null,a)}async getToken(r,a=!1){return!a&&this.accessToken&&!this.isExpired?this.accessToken:(Mt(this.refreshToken,r,"user-token-expired"),this.refreshToken?(await this.refresh(r,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(r,a){const{accessToken:c,refreshToken:l,expiresIn:h}=await E0e(r,a);this.updateTokensAndExpiration(c,l,Number(h))}updateTokensAndExpiration(r,a,c){this.refreshToken=a||null,this.accessToken=r||null,this.expirationTime=Date.now()+c*1e3}static fromJSON(r,a){const{refreshToken:c,accessToken:l,expirationTime:h}=a,m=new ky;return c&&(Mt(typeof c=="string","internal-error",{appName:r}),m.refreshToken=c),l&&(Mt(typeof l=="string","internal-error",{appName:r}),m.accessToken=l),h&&(Mt(typeof h=="number","internal-error",{appName:r}),m.expirationTime=h),m}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(r){this.accessToken=r.accessToken,this.refreshToken=r.refreshToken,this.expirationTime=r.expirationTime}_clone(){return Object.assign(new ky,this.toJSON())}_performRefresh(){return ph("not implemented")}}function Fp(i,r){Mt(typeof i=="string"||typeof i>"u","internal-error",{appName:r})}class ou{constructor({uid:r,auth:a,stsTokenManager:c,...l}){this.providerId="firebase",this.proactiveRefresh=new m0e(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=r,this.auth=a,this.stsTokenManager=c,this.accessToken=c.accessToken,this.displayName=l.displayName||null,this.email=l.email||null,this.emailVerified=l.emailVerified||!1,this.phoneNumber=l.phoneNumber||null,this.photoURL=l.photoURL||null,this.isAnonymous=l.isAnonymous||!1,this.tenantId=l.tenantId||null,this.providerData=l.providerData?[...l.providerData]:[],this.metadata=new iM(l.createdAt||void 0,l.lastLoginAt||void 0)}async getIdToken(r){const a=await dw(this,this.stsTokenManager.getToken(this.auth,r));return Mt(a,this.auth,"internal-error"),this.accessToken!==a&&(this.accessToken=a,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),a}getIdTokenResult(r){return p0e(this,r)}reload(){return g0e(this)}_assign(r){this!==r&&(Mt(this.uid===r.uid,this.auth,"internal-error"),this.displayName=r.displayName,this.photoURL=r.photoURL,this.email=r.email,this.emailVerified=r.emailVerified,this.phoneNumber=r.phoneNumber,this.isAnonymous=r.isAnonymous,this.tenantId=r.tenantId,this.providerData=r.providerData.map(a=>({...a})),this.metadata._copy(r.metadata),this.stsTokenManager._assign(r.stsTokenManager))}_clone(r){const a=new ou({...this,auth:r,stsTokenManager:this.stsTokenManager._clone()});return a.metadata._copy(this.metadata),a}_onReload(r){Mt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=r,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(r){this.reloadListener?this.reloadListener(r):this.reloadUserInfo=r}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(r,a=!1){let c=!1;r.idToken&&r.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(r),c=!0),a&&await WA(this),await this.auth._persistUserIfCurrent(this),c&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ao(this.auth.app))return Promise.reject(cu(this.auth));const r=await this.getIdToken();return await dw(this,h0e(this.auth,{idToken:r})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(r=>({...r})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(r,a){const c=a.displayName??void 0,l=a.email??void 0,h=a.phoneNumber??void 0,m=a.photoURL??void 0,E=a.tenantId??void 0,S=a._redirectEventId??void 0,T=a.createdAt??void 0,C=a.lastLoginAt??void 0,{uid:I,emailVerified:N,isAnonymous:P,providerData:H,stsTokenManager:x}=a;Mt(I&&x,r,"internal-error");const B=ky.fromJSON(this.name,x);Mt(typeof I=="string",r,"internal-error"),Fp(c,r.name),Fp(l,r.name),Mt(typeof N=="boolean",r,"internal-error"),Mt(typeof P=="boolean",r,"internal-error"),Fp(h,r.name),Fp(m,r.name),Fp(E,r.name),Fp(S,r.name),Fp(T,r.name),Fp(C,r.name);const X=new ou({uid:I,auth:r,email:l,emailVerified:N,displayName:c,isAnonymous:P,photoURL:m,phoneNumber:h,tenantId:E,stsTokenManager:B,createdAt:T,lastLoginAt:C});return H&&Array.isArray(H)&&(X.providerData=H.map(Z=>({...Z}))),S&&(X._redirectEventId=S),X}static async _fromIdTokenResponse(r,a,c=!1){const l=new ky;l.updateFromServerResponse(a);const h=new ou({uid:a.localId,auth:r,stsTokenManager:l,isAnonymous:c});return await WA(h),h}static async _fromGetAccountInfoResponse(r,a,c){const l=a.users[0];Mt(l.localId!==void 0,"internal-error");const h=l.providerUserInfo!==void 0?KJ(l.providerUserInfo):[],m=!(l.email&&l.passwordHash)&&!h?.length,E=new ky;E.updateFromIdToken(c);const S=new ou({uid:l.localId,auth:r,stsTokenManager:E,isAnonymous:m}),T={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:h,metadata:new iM(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!h?.length};return Object.assign(S,T),S}}const f9=new Map;function fh(i){Sh(i instanceof Function,"Expected a class definition");let r=f9.get(i);return r?(Sh(r instanceof i,"Instance stored in cache mismatched with class"),r):(r=new i,f9.set(i,r),r)}class YJ{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(r,a){this.storage[r]=a}async _get(r){const a=this.storage[r];return a===void 0?null:a}async _remove(r){delete this.storage[r]}_addListener(r,a){}_removeListener(r,a){}}YJ.type="NONE";const m9=YJ;function fA(i,r,a){return`firebase:${i}:${r}:${a}`}class Dy{constructor(r,a,c){this.persistence=r,this.auth=a,this.userKey=c;const{config:l,name:h}=this.auth;this.fullUserKey=fA(this.userKey,l.apiKey,h),this.fullPersistenceKey=fA("persistence",l.apiKey,h),this.boundEventHandler=a._onStorageEvent.bind(a),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(r){return this.persistence._set(this.fullUserKey,r.toJSON())}async getCurrentUser(){const r=await this.persistence._get(this.fullUserKey);if(!r)return null;if(typeof r=="string"){const a=await BA(this.auth,{idToken:r}).catch(()=>{});return a?ou._fromGetAccountInfoResponse(this.auth,a,r):null}return ou._fromJSON(this.auth,r)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(r){if(this.persistence===r)return;const a=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=r,a)return this.setCurrentUser(a)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(r,a,c="authUser"){if(!a.length)return new Dy(fh(m9),r,c);const l=(await Promise.all(a.map(async T=>{if(await T._isAvailable())return T}))).filter(T=>T);let h=l[0]||fh(m9);const m=fA(c,r.config.apiKey,r.name);let E=null;for(const T of a)try{const C=await T._get(m);if(C){let I;if(typeof C=="string"){const N=await BA(r,{idToken:C}).catch(()=>{});if(!N)break;I=await ou._fromGetAccountInfoResponse(r,N,C)}else I=ou._fromJSON(r,C);T!==h&&(E=I),h=T;break}}catch{}const S=l.filter(T=>T._shouldAllowMigration);return!h._shouldAllowMigration||!S.length?new Dy(h,r,c):(h=S[0],E&&await h._set(m,E.toJSON()),await Promise.all(a.map(async T=>{if(T!==h)try{await T._remove(m)}catch{}})),new Dy(h,r,c))}}function g9(i){const r=i.toLowerCase();if(r.includes("opera/")||r.includes("opr/")||r.includes("opios/"))return"Opera";if($J(r))return"IEMobile";if(r.includes("msie")||r.includes("trident/"))return"IE";if(r.includes("edge/"))return"Edge";if(qJ(r))return"Firefox";if(r.includes("silk/"))return"Silk";if(ZJ(r))return"Blackberry";if(e$(r))return"Webos";if(XJ(r))return"Safari";if((r.includes("chrome/")||JJ(r))&&!r.includes("edge/"))return"Chrome";if(QJ(r))return"Android";{const a=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,c=i.match(a);if(c?.length===2)return c[1]}return"Other"}function qJ(i=to()){return/firefox\//i.test(i)}function XJ(i=to()){const r=i.toLowerCase();return r.includes("safari/")&&!r.includes("chrome/")&&!r.includes("crios/")&&!r.includes("android")}function JJ(i=to()){return/crios\//i.test(i)}function $J(i=to()){return/iemobile/i.test(i)}function QJ(i=to()){return/android/i.test(i)}function ZJ(i=to()){return/blackberry/i.test(i)}function e$(i=to()){return/webos/i.test(i)}function B2(i=to()){return/iphone|ipad|ipod/i.test(i)||/macintosh/i.test(i)&&/mobile/i.test(i)}function v0e(i=to()){return B2(i)&&!!window.navigator?.standalone}function S0e(){return LSe()&&document.documentMode===10}function t$(i=to()){return B2(i)||QJ(i)||e$(i)||ZJ(i)||/windows phone/i.test(i)||$J(i)}function n$(i,r=[]){let a;switch(i){case"Browser":a=g9(to());break;case"Worker":a=`${g9(to())}-${i}`;break;default:a=i}const c=r.length?r.join(","):"FirebaseCore-web";return`${a}/JsCore/${xw}/${c}`}class T0e{constructor(r){this.auth=r,this.queue=[]}pushCallback(r,a){const c=h=>new Promise((m,E)=>{try{const S=r(h);m(S)}catch(S){E(S)}});c.onAbort=a,this.queue.push(c);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(r){if(this.auth.currentUser===r)return;const a=[];try{for(const c of this.queue)await c(r),c.onAbort&&a.push(c.onAbort)}catch(c){a.reverse();for(const l of a)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:c?.message})}}}async function w0e(i,r={}){return ll(i,"GET","/v2/passwordPolicy",Uo(i,r))}const C0e=6;class R0e{constructor(r){const a=r.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=a.minPasswordLength??C0e,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=r.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=r.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=r.forceUpgradeOnSignin??!1,this.schemaVersion=r.schemaVersion}validatePassword(r){const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(r,a),this.validatePasswordCharacterOptions(r,a),a.isValid&&(a.isValid=a.meetsMinPasswordLength??!0),a.isValid&&(a.isValid=a.meetsMaxPasswordLength??!0),a.isValid&&(a.isValid=a.containsLowercaseLetter??!0),a.isValid&&(a.isValid=a.containsUppercaseLetter??!0),a.isValid&&(a.isValid=a.containsNumericCharacter??!0),a.isValid&&(a.isValid=a.containsNonAlphanumericCharacter??!0),a}validatePasswordLengthOptions(r,a){const c=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;c&&(a.meetsMinPasswordLength=r.length>=c),l&&(a.meetsMaxPasswordLength=r.length<=l)}validatePasswordCharacterOptions(r,a){this.updatePasswordCharacterOptionsStatuses(a,!1,!1,!1,!1);let c;for(let l=0;l<r.length;l++)c=r.charAt(l),this.updatePasswordCharacterOptionsStatuses(a,c>="a"&&c<="z",c>="A"&&c<="Z",c>="0"&&c<="9",this.allowedNonAlphanumericCharacters.includes(c))}updatePasswordCharacterOptionsStatuses(r,a,c,l,h){this.customStrengthOptions.containsLowercaseLetter&&(r.containsLowercaseLetter||(r.containsLowercaseLetter=a)),this.customStrengthOptions.containsUppercaseLetter&&(r.containsUppercaseLetter||(r.containsUppercaseLetter=c)),this.customStrengthOptions.containsNumericCharacter&&(r.containsNumericCharacter||(r.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(r.containsNonAlphanumericCharacter||(r.containsNonAlphanumericCharacter=h))}}class b0e{constructor(r,a,c,l){this.app=r,this.heartbeatServiceProvider=a,this.appCheckServiceProvider=c,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new _9(this),this.idTokenSubscription=new _9(this),this.beforeStateQueue=new T0e(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=FJ,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=r.name,this.clientVersion=l.sdkClientVersion,this._persistenceManagerAvailable=new Promise(h=>this._resolvePersistenceManagerAvailable=h)}_initializeWithPersistence(r,a){return a&&(this._popupRedirectResolver=fh(a)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Dy.create(this,r),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(a),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const r=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!r)){if(this.currentUser&&r&&this.currentUser.uid===r.uid){this._currentUser._assign(r),await this.currentUser.getIdToken();return}await this._updateCurrentUser(r,!0)}}async initializeCurrentUserFromIdToken(r){try{const a=await BA(this,{idToken:r}),c=await ou._fromGetAccountInfoResponse(this,a,r);await this.directlySetCurrentUser(c)}catch(a){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",a),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(r){if(Ao(this.app)){const h=this.app.settings.authIdToken;return h?new Promise(m=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(h).then(m,m))}):this.directlySetCurrentUser(null)}const a=await this.assertedPersistence.getCurrentUser();let c=a,l=!1;if(r&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const h=this.redirectUser?._redirectEventId,m=c?._redirectEventId,E=await this.tryRedirectSignIn(r);(!h||h===m)&&E?.user&&(c=E.user,l=!0)}if(!c)return this.directlySetCurrentUser(null);if(!c._redirectEventId){if(l)try{await this.beforeStateQueue.runMiddleware(c)}catch(h){c=a,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(h))}return c?this.reloadAndSetCurrentUserOrClear(c):this.directlySetCurrentUser(null)}return Mt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===c._redirectEventId?this.directlySetCurrentUser(c):this.reloadAndSetCurrentUserOrClear(c)}async tryRedirectSignIn(r){let a=null;try{a=await this._popupRedirectResolver._completeRedirectFn(this,r,!0)}catch{await this._setRedirectUser(null)}return a}async reloadAndSetCurrentUserOrClear(r){try{await WA(r)}catch(a){if(a?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(r)}useDeviceLanguage(){this.languageCode=s0e()}async _delete(){this._deleted=!0}async updateCurrentUser(r){if(Ao(this.app))return Promise.reject(cu(this));const a=r?vc(r):null;return a&&Mt(a.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(a&&a._clone(this))}async _updateCurrentUser(r,a=!1){if(!this._deleted)return r&&Mt(this.tenantId===r.tenantId,this,"tenant-id-mismatch"),a||await this.beforeStateQueue.runMiddleware(r),this.queue(async()=>{await this.directlySetCurrentUser(r),this.notifyAuthListeners()})}async signOut(){return Ao(this.app)?Promise.reject(cu(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(r){return Ao(this.app)?Promise.reject(cu(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(fh(r))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(r){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const a=this._getPasswordPolicyInternal();return a.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):a.validatePassword(r)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const r=await w0e(this),a=new R0e(r);this.tenantId===null?this._projectPasswordPolicy=a:this._tenantPasswordPolicies[this.tenantId]=a}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(r){this._errorFactory=new jg("auth","Firebase",r())}onAuthStateChanged(r,a,c){return this.registerStateListener(this.authStateSubscription,r,a,c)}beforeAuthStateChanged(r,a){return this.beforeStateQueue.pushCallback(r,a)}onIdTokenChanged(r,a,c){return this.registerStateListener(this.idTokenSubscription,r,a,c)}authStateReady(){return new Promise((r,a)=>{if(this.currentUser)r();else{const c=this.onAuthStateChanged(()=>{c(),r()},a)}})}async revokeAccessToken(r){if(this.currentUser){const a=await this.currentUser.getIdToken(),c={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:r,idToken:a};this.tenantId!=null&&(c.tenantId=this.tenantId),await y0e(this,c)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(r,a){const c=await this.getOrInitRedirectPersistenceManager(a);return r===null?c.removeCurrentUser():c.setCurrentUser(r)}async getOrInitRedirectPersistenceManager(r){if(!this.redirectPersistenceManager){const a=r&&fh(r)||this._popupRedirectResolver;Mt(a,this,"argument-error"),this.redirectPersistenceManager=await Dy.create(this,[fh(a._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(r){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===r?this._currentUser:this.redirectUser?._redirectEventId===r?this.redirectUser:null}async _persistUserIfCurrent(r){if(r===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(r))}_notifyListenersIfCurrent(r){r===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=this.currentUser?.uid??null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(r,a,c,l){if(this._deleted)return()=>{};const h=typeof a=="function"?a:a.next.bind(a);let m=!1;const E=this._isInitialized?Promise.resolve():this._initializationPromise;if(Mt(E,this,"internal-error"),E.then(()=>{m||h(this.currentUser)}),typeof a=="function"){const S=r.addObserver(a,c,l);return()=>{m=!0,S()}}else{const S=r.addObserver(a);return()=>{m=!0,S()}}}async directlySetCurrentUser(r){this.currentUser&&this.currentUser!==r&&this._currentUser._stopProactiveRefresh(),r&&this.isProactiveRefreshEnabled&&r._startProactiveRefresh(),this.currentUser=r,r?await this.assertedPersistence.setCurrentUser(r):await this.assertedPersistence.removeCurrentUser()}queue(r){return this.operations=this.operations.then(r,r),this.operations}get assertedPersistence(){return Mt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(r){!r||this.frameworks.includes(r)||(this.frameworks.push(r),this.frameworks.sort(),this.clientVersion=n$(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const r={"X-Client-Version":this.clientVersion};this.app.options.appId&&(r["X-Firebase-gmpid"]=this.app.options.appId);const a=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();a&&(r["X-Firebase-Client"]=a);const c=await this._getAppCheckToken();return c&&(r["X-Firebase-AppCheck"]=c),r}async _getAppCheckToken(){if(Ao(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const r=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return r?.error&&n0e(`Error while retrieving App Check token: ${r.error}`),r?.token}}function ul(i){return vc(i)}class _9{constructor(r){this.auth=r,this.observer=null,this.addObserver=BSe(a=>this.observer=a)}get next(){return Mt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Mw={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function I0e(i){Mw=i}function W2(i){return Mw.loadJS(i)}function A0e(){return Mw.recaptchaV2Script}function O0e(){return Mw.recaptchaEnterpriseScript}function N0e(){return Mw.gapiScript}function r$(i){return`__${i}${Math.floor(Math.random()*1e6)}`}const P0e=500,k0e=6e4,XI=1e12;class D0e{constructor(r){this.auth=r,this.counter=XI,this._widgets=new Map}render(r,a){const c=this.counter;return this._widgets.set(c,new M0e(r,this.auth.name,a||{})),this.counter++,c}reset(r){const a=r||XI;this._widgets.get(a)?.delete(),this._widgets.delete(a)}getResponse(r){const a=r||XI;return this._widgets.get(a)?.getResponse()||""}async execute(r){const a=r||XI;return this._widgets.get(a)?.execute(),""}}class x0e{constructor(){this.enterprise=new L0e}ready(r){r()}execute(r,a){return Promise.resolve("token")}render(r,a){return""}}class L0e{ready(r){r()}execute(r,a){return Promise.resolve("token")}render(r,a){return""}}class M0e{constructor(r,a,c){this.params=c,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const l=typeof r=="string"?document.getElementById(r):r;Mt(l,"argument-error",{appName:a}),this.container=l,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=U0e(50);const{callback:r,"expired-callback":a}=this.params;if(r)try{r(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,a)try{a()}catch{}this.isVisible&&this.execute()},k0e)},P0e))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function U0e(i){const r=[],a="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let c=0;c<i;c++)r.push(a.charAt(Math.floor(Math.random()*a.length)));return r.join("")}const V0e="recaptcha-enterprise",W0="NO_RECAPTCHA";class i${constructor(r){this.type=V0e,this.auth=ul(r)}async verify(r="verify",a=!1){async function c(h){if(!a){if(h.tenantId==null&&h._agentRecaptchaConfig!=null)return h._agentRecaptchaConfig.siteKey;if(h.tenantId!=null&&h._tenantRecaptchaConfigs[h.tenantId]!==void 0)return h._tenantRecaptchaConfigs[h.tenantId].siteKey}return new Promise(async(m,E)=>{zJ(h,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(S=>{if(S.recaptchaKey===void 0)E(new Error("recaptcha Enterprise site key undefined"));else{const T=new HJ(S);return h.tenantId==null?h._agentRecaptchaConfig=T:h._tenantRecaptchaConfigs[h.tenantId]=T,m(T.siteKey)}}).catch(S=>{E(S)})})}function l(h,m,E){const S=window.grecaptcha;h9(S)?S.enterprise.ready(()=>{S.enterprise.execute(h,{action:r}).then(T=>{m(T)}).catch(()=>{m(W0)})}):E(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new x0e().execute("siteKey",{action:"verify"}):new Promise((h,m)=>{c(this.auth).then(E=>{if(!a&&h9(window.grecaptcha))l(E,h,m);else{if(typeof window>"u"){m(new Error("RecaptchaVerifier is only supported in browser"));return}let S=O0e();S.length!==0&&(S+=E),W2(S).then(()=>{l(E,h,m)}).catch(T=>{m(T)})}}).catch(E=>{m(E)})})}}async function T0(i,r,a,c=!1,l=!1){const h=new i$(i);let m;if(l)m=W0;else try{m=await h.verify(a)}catch{m=await h.verify(a,!0)}const E={...r};if(a==="mfaSmsEnrollment"||a==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in E){const S=E.phoneEnrollmentInfo.phoneNumber,T=E.phoneEnrollmentInfo.recaptchaToken;Object.assign(E,{phoneEnrollmentInfo:{phoneNumber:S,recaptchaToken:T,captchaResponse:m,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in E){const S=E.phoneSignInInfo.recaptchaToken;Object.assign(E,{phoneSignInInfo:{recaptchaToken:S,captchaResponse:m,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return E}return c?Object.assign(E,{captchaResp:m}):Object.assign(E,{captchaResponse:m}),Object.assign(E,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(E,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),E}async function xy(i,r,a,c,l){if(l==="EMAIL_PASSWORD_PROVIDER")if(i._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const h=await T0(i,r,a,a==="getOobCode");return c(i,h)}else return c(i,r).catch(async h=>{if(h.code==="auth/missing-recaptcha-token"){console.log(`${a} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const m=await T0(i,r,a,a==="getOobCode");return c(i,m)}else return Promise.reject(h)});else if(l==="PHONE_PROVIDER")if(i._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){const h=await T0(i,r,a);return c(i,h).catch(async m=>{if(i._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&(m.code==="auth/missing-recaptcha-token"||m.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${a} flow.`);const E=await T0(i,r,a,!1,!0);return c(i,E)}return Promise.reject(m)})}else{const h=await T0(i,r,a,!1,!0);return c(i,h)}else return Promise.reject(l+" provider is not supported.")}async function F0e(i){const r=ul(i),a=await zJ(r,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),c=new HJ(a);r.tenantId==null?r._agentRecaptchaConfig=c:r._tenantRecaptchaConfigs[r.tenantId]=c,c.isAnyProviderEnabled()&&new i$(r).verify()}function j0e(i,r){const a=uv(i,"auth");if(a.isInitialized()){const l=a.getImmediate(),h=a.getOptions();if(Dg(h,r??{}))return l;cl(l,"already-initialized")}return a.initialize({options:r})}function B0e(i,r){const a=r?.persistence||[],c=(Array.isArray(a)?a:[a]).map(fh);r?.errorMap&&i._updateErrorMap(r.errorMap),i._initializeWithPersistence(c,r?.popupRedirectResolver)}function W0e(i,r,a){const c=ul(i);Mt(/^https?:\/\//.test(r),c,"invalid-emulator-scheme");const l=!1,h=s$(r),{host:m,port:E}=G0e(r),S=E===null?"":`:${E}`,T={url:`${h}//${m}${S}/`},C=Object.freeze({host:m,port:E,protocol:h.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!c._canInitEmulator){Mt(c.config.emulator&&c.emulatorConfig,c,"emulator-config-failed"),Mt(Dg(T,c.config.emulator)&&Dg(C,c.emulatorConfig),c,"emulator-config-failed");return}c.config.emulator=T,c.emulatorConfig=C,c.settings.appVerificationDisabledForTesting=!0,PO(m)?(ASe(`${h}//${m}${S}`),PSe("Auth",!0)):H0e()}function s$(i){const r=i.indexOf(":");return r<0?"":i.substr(0,r+1)}function G0e(i){const r=s$(i),a=/(\/\/)?([^?#/]+)/.exec(i.substr(r.length));if(!a)return{host:"",port:null};const c=a[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(c);if(l){const h=l[1];return{host:h,port:E9(c.substr(h.length+1))}}else{const[h,m]=c.split(":");return{host:h,port:E9(m)}}}function E9(i){if(!i)return null;const r=Number(i);return isNaN(r)?null:r}function H0e(){function i(){const r=document.createElement("p"),a=r.style;r.innerText="Running in emulator mode. Do not use with production credentials.",a.position="fixed",a.width="100%",a.backgroundColor="#ffffff",a.border=".1em solid #000000",a.color="#b50000",a.bottom="0px",a.left="0px",a.margin="0px",a.zIndex="10000",a.textAlign="center",r.classList.add("firebase-emulator-warning"),document.body.appendChild(r)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",i):i())}class kO{constructor(r,a){this.providerId=r,this.signInMethod=a}toJSON(){return ph("not implemented")}_getIdTokenResponse(r){return ph("not implemented")}_linkToIdToken(r,a){return ph("not implemented")}_getReauthenticationResolver(r){return ph("not implemented")}}async function z0e(i,r){return ll(i,"POST","/v1/accounts:signUp",r)}async function K0e(i,r){return yf(i,"POST","/v1/accounts:signInWithPassword",Uo(i,r))}async function Y0e(i,r){return yf(i,"POST","/v1/accounts:signInWithEmailLink",Uo(i,r))}async function q0e(i,r){return yf(i,"POST","/v1/accounts:signInWithEmailLink",Uo(i,r))}class hw extends kO{constructor(r,a,c,l=null){super("password",c),this._email=r,this._password=a,this._tenantId=l}static _fromEmailAndPassword(r,a){return new hw(r,a,"password")}static _fromEmailAndCode(r,a,c=null){return new hw(r,a,"emailLink",c)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(r){const a=typeof r=="string"?JSON.parse(r):r;if(a?.email&&a?.password){if(a.signInMethod==="password")return this._fromEmailAndPassword(a.email,a.password);if(a.signInMethod==="emailLink")return this._fromEmailAndCode(a.email,a.password,a.tenantId)}return null}async _getIdTokenResponse(r){switch(this.signInMethod){case"password":const a={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return xy(r,a,"signInWithPassword",K0e,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return Y0e(r,{email:this._email,oobCode:this._password});default:cl(r,"internal-error")}}async _linkToIdToken(r,a){switch(this.signInMethod){case"password":const c={idToken:a,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return xy(r,c,"signUpPassword",z0e,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return q0e(r,{idToken:a,email:this._email,oobCode:this._password});default:cl(r,"internal-error")}}_getReauthenticationResolver(r){return this._getIdTokenResponse(r)}}async function Ly(i,r){return yf(i,"POST","/v1/accounts:signInWithIdp",Uo(i,r))}const X0e="http://localhost";class xg extends kO{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(r){const a=new xg(r.providerId,r.signInMethod);return r.idToken||r.accessToken?(r.idToken&&(a.idToken=r.idToken),r.accessToken&&(a.accessToken=r.accessToken),r.nonce&&!r.pendingToken&&(a.nonce=r.nonce),r.pendingToken&&(a.pendingToken=r.pendingToken)):r.oauthToken&&r.oauthTokenSecret?(a.accessToken=r.oauthToken,a.secret=r.oauthTokenSecret):cl("argument-error"),a}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(r){const a=typeof r=="string"?JSON.parse(r):r,{providerId:c,signInMethod:l,...h}=a;if(!c||!l)return null;const m=new xg(c,l);return m.idToken=h.idToken||void 0,m.accessToken=h.accessToken||void 0,m.secret=h.secret,m.nonce=h.nonce,m.pendingToken=h.pendingToken||null,m}_getIdTokenResponse(r){const a=this.buildRequest();return Ly(r,a)}_linkToIdToken(r,a){const c=this.buildRequest();return c.idToken=a,Ly(r,c)}_getReauthenticationResolver(r){const a=this.buildRequest();return a.autoCreate=!1,Ly(r,a)}buildRequest(){const r={requestUri:X0e,returnSecureToken:!0};if(this.pendingToken)r.pendingToken=this.pendingToken;else{const a={};this.idToken&&(a.id_token=this.idToken),this.accessToken&&(a.access_token=this.accessToken),this.secret&&(a.oauth_token_secret=this.secret),a.providerId=this.providerId,this.nonce&&!this.pendingToken&&(a.nonce=this.nonce),r.postBody=lv(a)}return r}}async function y9(i,r){return ll(i,"POST","/v1/accounts:sendVerificationCode",Uo(i,r))}async function J0e(i,r){return yf(i,"POST","/v1/accounts:signInWithPhoneNumber",Uo(i,r))}async function $0e(i,r){const a=await yf(i,"POST","/v1/accounts:signInWithPhoneNumber",Uo(i,r));if(a.temporaryProof)throw k0(i,"account-exists-with-different-credential",a);return a}const Q0e={USER_NOT_FOUND:"user-not-found"};async function Z0e(i,r){const a={...r,operation:"REAUTH"};return yf(i,"POST","/v1/accounts:signInWithPhoneNumber",Uo(i,a),Q0e)}class G0 extends kO{constructor(r){super("phone","phone"),this.params=r}static _fromVerification(r,a){return new G0({verificationId:r,verificationCode:a})}static _fromTokenResponse(r,a){return new G0({phoneNumber:r,temporaryProof:a})}_getIdTokenResponse(r){return J0e(r,this._makeVerificationRequest())}_linkToIdToken(r,a){return $0e(r,{idToken:a,...this._makeVerificationRequest()})}_getReauthenticationResolver(r){return Z0e(r,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:r,phoneNumber:a,verificationId:c,verificationCode:l}=this.params;return r&&a?{temporaryProof:r,phoneNumber:a}:{sessionInfo:c,code:l}}toJSON(){const r={providerId:this.providerId};return this.params.phoneNumber&&(r.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(r.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(r.verificationCode=this.params.verificationCode),this.params.verificationId&&(r.verificationId=this.params.verificationId),r}static fromJSON(r){typeof r=="string"&&(r=JSON.parse(r));const{verificationId:a,verificationCode:c,phoneNumber:l,temporaryProof:h}=r;return!c&&!a&&!l&&!h?null:new G0({verificationId:a,verificationCode:c,phoneNumber:l,temporaryProof:h})}}function ewe(i){switch(i){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function twe(i){const r=N0(P0(i)).link,a=r?N0(P0(r)).deep_link_id:null,c=N0(P0(i)).deep_link_id;return(c?N0(P0(c)).link:null)||c||a||r||i}class G2{constructor(r){const a=N0(P0(r)),c=a.apiKey??null,l=a.oobCode??null,h=ewe(a.mode??null);Mt(c&&l&&h,"argument-error"),this.apiKey=c,this.operation=h,this.code=l,this.continueUrl=a.continueUrl??null,this.languageCode=a.lang??null,this.tenantId=a.tenantId??null}static parseLink(r){const a=twe(r);try{return new G2(a)}catch{return null}}}class dv{constructor(){this.providerId=dv.PROVIDER_ID}static credential(r,a){return hw._fromEmailAndPassword(r,a)}static credentialWithLink(r,a){const c=G2.parseLink(a);return Mt(c,"argument-error"),hw._fromEmailAndCode(r,c.code,c.tenantId)}}dv.PROVIDER_ID="password";dv.EMAIL_PASSWORD_SIGN_IN_METHOD="password";dv.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class H2{constructor(r){this.providerId=r,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(r){this.defaultLanguageCode=r}setCustomParameters(r){return this.customParameters=r,this}getCustomParameters(){return this.customParameters}}class Uw extends H2{constructor(){super(...arguments),this.scopes=[]}addScope(r){return this.scopes.includes(r)||this.scopes.push(r),this}getScopes(){return[...this.scopes]}}class Kp extends Uw{constructor(){super("facebook.com")}static credential(r){return xg._fromParams({providerId:Kp.PROVIDER_ID,signInMethod:Kp.FACEBOOK_SIGN_IN_METHOD,accessToken:r})}static credentialFromResult(r){return Kp.credentialFromTaggedObject(r)}static credentialFromError(r){return Kp.credentialFromTaggedObject(r.customData||{})}static credentialFromTaggedObject({_tokenResponse:r}){if(!r||!("oauthAccessToken"in r)||!r.oauthAccessToken)return null;try{return Kp.credential(r.oauthAccessToken)}catch{return null}}}Kp.FACEBOOK_SIGN_IN_METHOD="facebook.com";Kp.PROVIDER_ID="facebook.com";class hh extends Uw{constructor(){super("google.com"),this.addScope("profile")}static credential(r,a){return xg._fromParams({providerId:hh.PROVIDER_ID,signInMethod:hh.GOOGLE_SIGN_IN_METHOD,idToken:r,accessToken:a})}static credentialFromResult(r){return hh.credentialFromTaggedObject(r)}static credentialFromError(r){return hh.credentialFromTaggedObject(r.customData||{})}static credentialFromTaggedObject({_tokenResponse:r}){if(!r)return null;const{oauthIdToken:a,oauthAccessToken:c}=r;if(!a&&!c)return null;try{return hh.credential(a,c)}catch{return null}}}hh.GOOGLE_SIGN_IN_METHOD="google.com";hh.PROVIDER_ID="google.com";class Yp extends Uw{constructor(){super("github.com")}static credential(r){return xg._fromParams({providerId:Yp.PROVIDER_ID,signInMethod:Yp.GITHUB_SIGN_IN_METHOD,accessToken:r})}static credentialFromResult(r){return Yp.credentialFromTaggedObject(r)}static credentialFromError(r){return Yp.credentialFromTaggedObject(r.customData||{})}static credentialFromTaggedObject({_tokenResponse:r}){if(!r||!("oauthAccessToken"in r)||!r.oauthAccessToken)return null;try{return Yp.credential(r.oauthAccessToken)}catch{return null}}}Yp.GITHUB_SIGN_IN_METHOD="github.com";Yp.PROVIDER_ID="github.com";class qp extends Uw{constructor(){super("twitter.com")}static credential(r,a){return xg._fromParams({providerId:qp.PROVIDER_ID,signInMethod:qp.TWITTER_SIGN_IN_METHOD,oauthToken:r,oauthTokenSecret:a})}static credentialFromResult(r){return qp.credentialFromTaggedObject(r)}static credentialFromError(r){return qp.credentialFromTaggedObject(r.customData||{})}static credentialFromTaggedObject({_tokenResponse:r}){if(!r)return null;const{oauthAccessToken:a,oauthTokenSecret:c}=r;if(!a||!c)return null;try{return qp.credential(a,c)}catch{return null}}}qp.TWITTER_SIGN_IN_METHOD="twitter.com";qp.PROVIDER_ID="twitter.com";async function a$(i,r){return yf(i,"POST","/v1/accounts:signUp",Uo(i,r))}class Th{constructor(r){this.user=r.user,this.providerId=r.providerId,this._tokenResponse=r._tokenResponse,this.operationType=r.operationType}static async _fromIdTokenResponse(r,a,c,l=!1){const h=await ou._fromIdTokenResponse(r,c,l),m=v9(c);return new Th({user:h,providerId:m,_tokenResponse:c,operationType:a})}static async _forOperation(r,a,c){await r._updateTokensIfNecessary(c,!0);const l=v9(c);return new Th({user:r,providerId:l,_tokenResponse:c,operationType:a})}}function v9(i){return i.providerId?i.providerId:"phoneNumber"in i?"phone":null}async function nwe(i){if(Ao(i.app))return Promise.reject(cu(i));const r=ul(i);if(await r._initializationPromise,r.currentUser?.isAnonymous)return new Th({user:r.currentUser,providerId:null,operationType:"signIn"});const a=await a$(r,{returnSecureToken:!0}),c=await Th._fromIdTokenResponse(r,"signIn",a,!0);return await r._updateCurrentUser(c.user),c}class GA extends Od{constructor(r,a,c,l){super(a.code,a.message),this.operationType=c,this.user=l,Object.setPrototypeOf(this,GA.prototype),this.customData={appName:r.name,tenantId:r.tenantId??void 0,_serverResponse:a.customData._serverResponse,operationType:c}}static _fromErrorAndOperation(r,a,c,l){return new GA(r,a,c,l)}}function o$(i,r,a,c){return(r==="reauthenticate"?a._getReauthenticationResolver(i):a._getIdTokenResponse(i)).catch(h=>{throw h.code==="auth/multi-factor-auth-required"?GA._fromErrorAndOperation(i,h,r,c):h})}async function rwe(i,r,a=!1){const c=await dw(i,r._linkToIdToken(i.auth,await i.getIdToken()),a);return Th._forOperation(i,"link",c)}async function iwe(i,r,a=!1){const{auth:c}=i;if(Ao(c.app))return Promise.reject(cu(c));const l="reauthenticate";try{const h=await dw(i,o$(c,l,r,i),a);Mt(h.idToken,c,"internal-error");const m=j2(h.idToken);Mt(m,c,"internal-error");const{sub:E}=m;return Mt(i.uid===E,c,"user-mismatch"),Th._forOperation(i,l,h)}catch(h){throw h?.code==="auth/user-not-found"&&cl(c,"user-mismatch"),h}}async function c$(i,r,a=!1){if(Ao(i.app))return Promise.reject(cu(i));const c="signIn",l=await o$(i,c,r),h=await Th._fromIdTokenResponse(i,c,l);return a||await i._updateCurrentUser(h.user),h}async function l$(i,r){return c$(ul(i),r)}async function u$(i){const r=ul(i);r._getPasswordPolicyInternal()&&await r._updatePasswordPolicy()}async function swe(i,r,a){if(Ao(i.app))return Promise.reject(cu(i));const c=ul(i),m=await xy(c,{returnSecureToken:!0,email:r,password:a,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",a$,"EMAIL_PASSWORD_PROVIDER").catch(S=>{throw S.code==="auth/password-does-not-meet-requirements"&&u$(i),S}),E=await Th._fromIdTokenResponse(c,"signIn",m);return await c._updateCurrentUser(E.user),E}function awe(i,r,a){return Ao(i.app)?Promise.reject(cu(i)):l$(vc(i),dv.credential(r,a)).catch(async c=>{throw c.code==="auth/password-does-not-meet-requirements"&&u$(i),c})}function owe(i,r,a,c){return vc(i).onIdTokenChanged(r,a,c)}function cwe(i,r,a){return vc(i).beforeAuthStateChanged(r,a)}function lwe(i,r,a,c){return vc(i).onAuthStateChanged(r,a,c)}function uwe(i){return vc(i).signOut()}function S9(i,r){return ll(i,"POST","/v2/accounts/mfaEnrollment:start",Uo(i,r))}const HA="__sak";class d${constructor(r,a){this.storageRetriever=r,this.type=a}_isAvailable(){try{return this.storage?(this.storage.setItem(HA,"1"),this.storage.removeItem(HA),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(r,a){return this.storage.setItem(r,JSON.stringify(a)),Promise.resolve()}_get(r){const a=this.storage.getItem(r);return Promise.resolve(a?JSON.parse(a):null)}_remove(r){return this.storage.removeItem(r),Promise.resolve()}get storage(){return this.storageRetriever()}}const dwe=1e3,hwe=10;class h$ extends d${constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(r,a)=>this.onStorageEvent(r,a),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=t$(),this._shouldAllowMigration=!0}forAllChangedKeys(r){for(const a of Object.keys(this.listeners)){const c=this.storage.getItem(a),l=this.localCache[a];c!==l&&r(a,l,c)}}onStorageEvent(r,a=!1){if(!r.key){this.forAllChangedKeys((m,E,S)=>{this.notifyListeners(m,S)});return}const c=r.key;a?this.detachListener():this.stopPolling();const l=()=>{const m=this.storage.getItem(c);!a&&this.localCache[c]===m||this.notifyListeners(c,m)},h=this.storage.getItem(c);S0e()&&h!==r.newValue&&r.newValue!==r.oldValue?setTimeout(l,hwe):l()}notifyListeners(r,a){this.localCache[r]=a;const c=this.listeners[r];if(c)for(const l of Array.from(c))l(a&&JSON.parse(a))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((r,a,c)=>{this.onStorageEvent(new StorageEvent("storage",{key:r,oldValue:a,newValue:c}),!0)})},dwe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(r,a){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[r]||(this.listeners[r]=new Set,this.localCache[r]=this.storage.getItem(r)),this.listeners[r].add(a)}_removeListener(r,a){this.listeners[r]&&(this.listeners[r].delete(a),this.listeners[r].size===0&&delete this.listeners[r]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(r,a){await super._set(r,a),this.localCache[r]=JSON.stringify(a)}async _get(r){const a=await super._get(r);return this.localCache[r]=JSON.stringify(a),a}async _remove(r){await super._remove(r),delete this.localCache[r]}}h$.type="LOCAL";const pwe=h$;class p$ extends d${constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(r,a){}_removeListener(r,a){}}p$.type="SESSION";const f$=p$;function fwe(i){return Promise.all(i.map(async r=>{try{return{fulfilled:!0,value:await r}}catch(a){return{fulfilled:!1,reason:a}}}))}class DO{constructor(r){this.eventTarget=r,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(r){const a=this.receivers.find(l=>l.isListeningto(r));if(a)return a;const c=new DO(r);return this.receivers.push(c),c}isListeningto(r){return this.eventTarget===r}async handleEvent(r){const a=r,{eventId:c,eventType:l,data:h}=a.data,m=this.handlersMap[l];if(!m?.size)return;a.ports[0].postMessage({status:"ack",eventId:c,eventType:l});const E=Array.from(m).map(async T=>T(a.origin,h)),S=await fwe(E);a.ports[0].postMessage({status:"done",eventId:c,eventType:l,response:S})}_subscribe(r,a){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[r]||(this.handlersMap[r]=new Set),this.handlersMap[r].add(a)}_unsubscribe(r,a){this.handlersMap[r]&&a&&this.handlersMap[r].delete(a),(!a||this.handlersMap[r].size===0)&&delete this.handlersMap[r],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}DO.receivers=[];function z2(i="",r=10){let a="";for(let c=0;c<r;c++)a+=Math.floor(Math.random()*10);return i+a}class mwe{constructor(r){this.target=r,this.handlers=new Set}removeMessageHandler(r){r.messageChannel&&(r.messageChannel.port1.removeEventListener("message",r.onMessage),r.messageChannel.port1.close()),this.handlers.delete(r)}async _send(r,a,c=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let h,m;return new Promise((E,S)=>{const T=z2("",20);l.port1.start();const C=setTimeout(()=>{S(new Error("unsupported_event"))},c);m={messageChannel:l,onMessage(I){const N=I;if(N.data.eventId===T)switch(N.data.status){case"ack":clearTimeout(C),h=setTimeout(()=>{S(new Error("timeout"))},3e3);break;case"done":clearTimeout(h),E(N.data.response);break;default:clearTimeout(C),clearTimeout(h),S(new Error("invalid_response"));break}}},this.handlers.add(m),l.port1.addEventListener("message",m.onMessage),this.target.postMessage({eventType:r,eventId:T,data:a},[l.port2])}).finally(()=>{m&&this.removeMessageHandler(m)})}}function Cs(){return window}function gwe(i){Cs().location.href=i}function K2(){return typeof Cs().WorkerGlobalScope<"u"&&typeof Cs().importScripts=="function"}async function _we(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Ewe(){return navigator?.serviceWorker?.controller||null}function ywe(){return K2()?self:null}const m$="firebaseLocalStorageDb",vwe=1,zA="firebaseLocalStorage",g$="fbase_key";class Vw{constructor(r){this.request=r}toPromise(){return new Promise((r,a)=>{this.request.addEventListener("success",()=>{r(this.request.result)}),this.request.addEventListener("error",()=>{a(this.request.error)})})}}function xO(i,r){return i.transaction([zA],r?"readwrite":"readonly").objectStore(zA)}function Swe(){const i=indexedDB.deleteDatabase(m$);return new Vw(i).toPromise()}function sM(){const i=indexedDB.open(m$,vwe);return new Promise((r,a)=>{i.addEventListener("error",()=>{a(i.error)}),i.addEventListener("upgradeneeded",()=>{const c=i.result;try{c.createObjectStore(zA,{keyPath:g$})}catch(l){a(l)}}),i.addEventListener("success",async()=>{const c=i.result;c.objectStoreNames.contains(zA)?r(c):(c.close(),await Swe(),r(await sM()))})})}async function T9(i,r,a){const c=xO(i,!0).put({[g$]:r,value:a});return new Vw(c).toPromise()}async function Twe(i,r){const a=xO(i,!1).get(r),c=await new Vw(a).toPromise();return c===void 0?null:c.value}function w9(i,r){const a=xO(i,!0).delete(r);return new Vw(a).toPromise()}const wwe=800,Cwe=3;class _${constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await sM(),this.db)}async _withRetries(r){let a=0;for(;;)try{const c=await this._openDb();return await r(c)}catch(c){if(a++>Cwe)throw c;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return K2()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=DO._getInstance(ywe()),this.receiver._subscribe("keyChanged",async(r,a)=>({keyProcessed:(await this._poll()).includes(a.key)})),this.receiver._subscribe("ping",async(r,a)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await _we(),!this.activeServiceWorker)return;this.sender=new mwe(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&r[0]?.fulfilled&&r[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(r){if(!(!this.sender||!this.activeServiceWorker||Ewe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:r},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const r=await sM();return await T9(r,HA,"1"),await w9(r,HA),!0}catch{}return!1}async _withPendingWrite(r){this.pendingWrites++;try{await r()}finally{this.pendingWrites--}}async _set(r,a){return this._withPendingWrite(async()=>(await this._withRetries(c=>T9(c,r,a)),this.localCache[r]=a,this.notifyServiceWorker(r)))}async _get(r){const a=await this._withRetries(c=>Twe(c,r));return this.localCache[r]=a,a}async _remove(r){return this._withPendingWrite(async()=>(await this._withRetries(a=>w9(a,r)),delete this.localCache[r],this.notifyServiceWorker(r)))}async _poll(){const r=await this._withRetries(l=>{const h=xO(l,!1).getAll();return new Vw(h).toPromise()});if(!r)return[];if(this.pendingWrites!==0)return[];const a=[],c=new Set;if(r.length!==0)for(const{fbase_key:l,value:h}of r)c.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(h)&&(this.notifyListeners(l,h),a.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!c.has(l)&&(this.notifyListeners(l,null),a.push(l));return a}notifyListeners(r,a){this.localCache[r]=a;const c=this.listeners[r];if(c)for(const l of Array.from(c))l(a)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),wwe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(r,a){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[r]||(this.listeners[r]=new Set,this._get(r)),this.listeners[r].add(a)}_removeListener(r,a){this.listeners[r]&&(this.listeners[r].delete(a),this.listeners[r].size===0&&delete this.listeners[r]),Object.keys(this.listeners).length===0&&this.stopPolling()}}_$.type="LOCAL";const Rwe=_$;function C9(i,r){return ll(i,"POST","/v2/accounts/mfaSignIn:start",Uo(i,r))}const Fx=r$("rcb"),bwe=new Lw(3e4,6e4);class Iwe{constructor(){this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!Cs().grecaptcha?.render}load(r,a=""){return Mt(Awe(a),r,"argument-error"),this.shouldResolveImmediately(a)&&d9(Cs().grecaptcha)?Promise.resolve(Cs().grecaptcha):new Promise((c,l)=>{const h=Cs().setTimeout(()=>{l(No(r,"network-request-failed"))},bwe.get());Cs()[Fx]=()=>{Cs().clearTimeout(h),delete Cs()[Fx];const E=Cs().grecaptcha;if(!E||!d9(E)){l(No(r,"internal-error"));return}const S=E.render;E.render=(T,C)=>{const I=S(T,C);return this.counter++,I},this.hostLanguage=a,c(E)};const m=`${A0e()}?${lv({onload:Fx,render:"explicit",hl:a})}`;W2(m).catch(()=>{clearTimeout(h),l(No(r,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(r){return!!Cs().grecaptcha?.render&&(r===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function Awe(i){return i.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(i)}class Owe{async load(r){return new D0e(r)}clearedOneInstance(){}}const H0="recaptcha",Nwe={theme:"light",type:"image"};class Pwe{constructor(r,a,c={...Nwe}){this.parameters=c,this.type=H0,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=ul(r),this.isInvisible=this.parameters.size==="invisible",Mt(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const l=typeof a=="string"?document.getElementById(a):a;Mt(l,this.auth,"argument-error"),this.container=l,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Owe:new Iwe,this.validateStartingState()}async verify(){this.assertNotDestroyed();const r=await this.render(),a=this.getAssertedRecaptcha(),c=a.getResponse(r);return c||new Promise(l=>{const h=m=>{m&&(this.tokenChangeListeners.delete(h),l(m))};this.tokenChangeListeners.add(h),this.isInvisible&&a.execute(r)})}render(){try{this.assertNotDestroyed()}catch(r){return Promise.reject(r)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(r=>{throw this.renderPromise=null,r}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(r=>{this.container.removeChild(r)})}validateStartingState(){Mt(!this.parameters.sitekey,this.auth,"argument-error"),Mt(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),Mt(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(r){return a=>{if(this.tokenChangeListeners.forEach(c=>c(a)),typeof r=="function")r(a);else if(typeof r=="string"){const c=Cs()[r];typeof c=="function"&&c(a)}}}assertNotDestroyed(){Mt(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let r=this.container;if(!this.isInvisible){const a=document.createElement("div");r.appendChild(a),r=a}this.widgetId=this.getAssertedRecaptcha().render(r,this.parameters)}return this.widgetId}async init(){Mt(jJ()&&!K2(),this.auth,"internal-error"),await kwe(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const r=await d0e(this.auth);Mt(r,this.auth,"internal-error"),this.parameters.sitekey=r}getAssertedRecaptcha(){return Mt(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function kwe(){let i=null;return new Promise(r=>{if(document.readyState==="complete"){r();return}i=()=>r(),window.addEventListener("load",i)}).catch(r=>{throw i&&window.removeEventListener("load",i),r})}class Dwe{constructor(r,a){this.verificationId=r,this.onConfirmation=a}confirm(r){const a=G0._fromVerification(this.verificationId,r);return this.onConfirmation(a)}}async function xwe(i,r,a){if(Ao(i.app))return Promise.reject(cu(i));const c=ul(i),l=await Lwe(c,r,vc(a));return new Dwe(l,h=>l$(c,h))}async function Lwe(i,r,a){if(!i._getRecaptchaConfig())try{await F0e(i)}catch{console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let c;if(typeof r=="string"?c={phoneNumber:r}:c=r,"session"in c){const l=c.session;if("phoneNumber"in c){Mt(l.type==="enroll",i,"internal-error");const h={idToken:l.credential,phoneEnrollmentInfo:{phoneNumber:c.phoneNumber,clientType:"CLIENT_TYPE_WEB"}};return(await xy(i,h,"mfaSmsEnrollment",async(T,C)=>{if(C.phoneEnrollmentInfo.captchaResponse===W0){Mt(a?.type===H0,T,"argument-error");const I=await jx(T,C,a);return S9(T,I)}return S9(T,C)},"PHONE_PROVIDER").catch(T=>Promise.reject(T))).phoneSessionInfo.sessionInfo}else{Mt(l.type==="signin",i,"internal-error");const h=c.multiFactorHint?.uid||c.multiFactorUid;Mt(h,i,"missing-multi-factor-info");const m={mfaPendingCredential:l.credential,mfaEnrollmentId:h,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}};return(await xy(i,m,"mfaSmsSignIn",async(C,I)=>{if(I.phoneSignInInfo.captchaResponse===W0){Mt(a?.type===H0,C,"argument-error");const N=await jx(C,I,a);return C9(C,N)}return C9(C,I)},"PHONE_PROVIDER").catch(C=>Promise.reject(C))).phoneResponseInfo.sessionInfo}}else{const l={phoneNumber:c.phoneNumber,clientType:"CLIENT_TYPE_WEB"};return(await xy(i,l,"sendVerificationCode",async(S,T)=>{if(T.captchaResponse===W0){Mt(a?.type===H0,S,"argument-error");const C=await jx(S,T,a);return y9(S,C)}return y9(S,T)},"PHONE_PROVIDER").catch(S=>Promise.reject(S))).sessionInfo}}finally{a?._reset()}}async function jx(i,r,a){Mt(a.type===H0,i,"argument-error");const c=await a.verify();Mt(typeof c=="string",i,"argument-error");const l={...r};if("phoneEnrollmentInfo"in l){const h=l.phoneEnrollmentInfo.phoneNumber,m=l.phoneEnrollmentInfo.captchaResponse,E=l.phoneEnrollmentInfo.clientType,S=l.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:h,recaptchaToken:c,captchaResponse:m,clientType:E,recaptchaVersion:S}}),l}else if("phoneSignInInfo"in l){const h=l.phoneSignInInfo.captchaResponse,m=l.phoneSignInInfo.clientType,E=l.phoneSignInInfo.recaptchaVersion;return Object.assign(l,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:h,clientType:m,recaptchaVersion:E}}),l}else return Object.assign(l,{recaptchaToken:c}),l}function E$(i,r){return r?fh(r):(Mt(i._popupRedirectResolver,i,"argument-error"),i._popupRedirectResolver)}class Y2 extends kO{constructor(r){super("custom","custom"),this.params=r}_getIdTokenResponse(r){return Ly(r,this._buildIdpRequest())}_linkToIdToken(r,a){return Ly(r,this._buildIdpRequest(a))}_getReauthenticationResolver(r){return Ly(r,this._buildIdpRequest())}_buildIdpRequest(r){const a={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return r&&(a.idToken=r),a}}function Mwe(i){return c$(i.auth,new Y2(i),i.bypassAuthState)}function Uwe(i){const{auth:r,user:a}=i;return Mt(a,r,"internal-error"),iwe(a,new Y2(i),i.bypassAuthState)}async function Vwe(i){const{auth:r,user:a}=i;return Mt(a,r,"internal-error"),rwe(a,new Y2(i),i.bypassAuthState)}class y${constructor(r,a,c,l,h=!1){this.auth=r,this.resolver=c,this.user=l,this.bypassAuthState=h,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(a)?a:[a]}execute(){return new Promise(async(r,a)=>{this.pendingPromise={resolve:r,reject:a};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(c){this.reject(c)}})}async onAuthEvent(r){const{urlResponse:a,sessionId:c,postBody:l,tenantId:h,error:m,type:E}=r;if(m){this.reject(m);return}const S={auth:this.auth,requestUri:a,sessionId:c,tenantId:h||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(E)(S))}catch(T){this.reject(T)}}onError(r){this.reject(r)}getIdpTask(r){switch(r){case"signInViaPopup":case"signInViaRedirect":return Mwe;case"linkViaPopup":case"linkViaRedirect":return Vwe;case"reauthViaPopup":case"reauthViaRedirect":return Uwe;default:cl(this.auth,"internal-error")}}resolve(r){Sh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(r),this.unregisterAndCleanUp()}reject(r){Sh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(r),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Fwe=new Lw(2e3,1e4);async function jwe(i,r,a){if(Ao(i.app))return Promise.reject(No(i,"operation-not-supported-in-this-environment"));const c=ul(i);r0e(i,r,H2);const l=E$(c,a);return new yg(c,"signInViaPopup",r,l).executeNotNull()}class yg extends y${constructor(r,a,c,l,h){super(r,a,l,h),this.provider=c,this.authWindow=null,this.pollId=null,yg.currentPopupAction&&yg.currentPopupAction.cancel(),yg.currentPopupAction=this}async executeNotNull(){const r=await this.execute();return Mt(r,this.auth,"internal-error"),r}async onExecution(){Sh(this.filter.length===1,"Popup operations only handle one event");const r=z2();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],r),this.authWindow.associatedEvent=r,this.resolver._originValidation(this.auth).catch(a=>{this.reject(a)}),this.resolver._isIframeWebStorageSupported(this.auth,a=>{a||this.reject(No(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(No(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,yg.currentPopupAction=null}pollUserCancellation(){const r=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(No(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(r,Fwe.get())};r()}}yg.currentPopupAction=null;const Bwe="pendingRedirect",mA=new Map;class Wwe extends y${constructor(r,a,c=!1){super(r,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],a,void 0,c),this.eventId=null}async execute(){let r=mA.get(this.auth._key());if(!r){try{const c=await Gwe(this.resolver,this.auth)?await super.execute():null;r=()=>Promise.resolve(c)}catch(a){r=()=>Promise.reject(a)}mA.set(this.auth._key(),r)}return this.bypassAuthState||mA.set(this.auth._key(),()=>Promise.resolve(null)),r()}async onAuthEvent(r){if(r.type==="signInViaRedirect")return super.onAuthEvent(r);if(r.type==="unknown"){this.resolve(null);return}if(r.eventId){const a=await this.auth._redirectUserForId(r.eventId);if(a)return this.user=a,super.onAuthEvent(r);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Gwe(i,r){const a=Kwe(r),c=zwe(i);if(!await c._isAvailable())return!1;const l=await c._get(a)==="true";return await c._remove(a),l}function Hwe(i,r){mA.set(i._key(),r)}function zwe(i){return fh(i._redirectPersistence)}function Kwe(i){return fA(Bwe,i.config.apiKey,i.name)}async function Ywe(i,r,a=!1){if(Ao(i.app))return Promise.reject(cu(i));const c=ul(i),l=E$(c,r),m=await new Wwe(c,l,a).execute();return m&&!a&&(delete m.user._redirectEventId,await c._persistUserIfCurrent(m.user),await c._setRedirectUser(null,r)),m}const qwe=600*1e3;class Xwe{constructor(r){this.auth=r,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(r){this.consumers.add(r),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,r)&&(this.sendToConsumer(this.queuedRedirectEvent,r),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(r){this.consumers.delete(r)}onEvent(r){if(this.hasEventBeenHandled(r))return!1;let a=!1;return this.consumers.forEach(c=>{this.isEventForConsumer(r,c)&&(a=!0,this.sendToConsumer(r,c),this.saveEventToCache(r))}),this.hasHandledPotentialRedirect||!Jwe(r)||(this.hasHandledPotentialRedirect=!0,a||(this.queuedRedirectEvent=r,a=!0)),a}sendToConsumer(r,a){if(r.error&&!v$(r)){const c=r.error.code?.split("auth/")[1]||"internal-error";a.onError(No(this.auth,c))}else a.onAuthEvent(r)}isEventForConsumer(r,a){const c=a.eventId===null||!!r.eventId&&r.eventId===a.eventId;return a.filter.includes(r.type)&&c}hasEventBeenHandled(r){return Date.now()-this.lastProcessedEventTime>=qwe&&this.cachedEventUids.clear(),this.cachedEventUids.has(R9(r))}saveEventToCache(r){this.cachedEventUids.add(R9(r)),this.lastProcessedEventTime=Date.now()}}function R9(i){return[i.type,i.eventId,i.sessionId,i.tenantId].filter(r=>r).join("-")}function v$({type:i,error:r}){return i==="unknown"&&r?.code==="auth/no-auth-event"}function Jwe(i){switch(i.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return v$(i);default:return!1}}async function $we(i,r={}){return ll(i,"GET","/v1/projects",r)}const Qwe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Zwe=/^https?/;async function eCe(i){if(i.config.emulator)return;const{authorizedDomains:r}=await $we(i);for(const a of r)try{if(tCe(a))return}catch{}cl(i,"unauthorized-domain")}function tCe(i){const r=rM(),{protocol:a,hostname:c}=new URL(r);if(i.startsWith("chrome-extension://")){const m=new URL(i);return m.hostname===""&&c===""?a==="chrome-extension:"&&i.replace("chrome-extension://","")===r.replace("chrome-extension://",""):a==="chrome-extension:"&&m.hostname===c}if(!Zwe.test(a))return!1;if(Qwe.test(i))return c===i;const l=i.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(c)}const nCe=new Lw(3e4,6e4);function b9(){const i=Cs().___jsl;if(i?.H){for(const r of Object.keys(i.H))if(i.H[r].r=i.H[r].r||[],i.H[r].L=i.H[r].L||[],i.H[r].r=[...i.H[r].L],i.CP)for(let a=0;a<i.CP.length;a++)i.CP[a]=null}}function rCe(i){return new Promise((r,a)=>{function c(){b9(),gapi.load("gapi.iframes",{callback:()=>{r(gapi.iframes.getContext())},ontimeout:()=>{b9(),a(No(i,"network-request-failed"))},timeout:nCe.get()})}if(Cs().gapi?.iframes?.Iframe)r(gapi.iframes.getContext());else if(Cs().gapi?.load)c();else{const l=r$("iframefcb");return Cs()[l]=()=>{gapi.load?c():a(No(i,"network-request-failed"))},W2(`${N0e()}?onload=${l}`).catch(h=>a(h))}}).catch(r=>{throw gA=null,r})}let gA=null;function iCe(i){return gA=gA||rCe(i),gA}const sCe=new Lw(5e3,15e3),aCe="__/auth/iframe",oCe="emulator/auth/iframe",cCe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},lCe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function uCe(i){const r=i.config;Mt(r.authDomain,i,"auth-domain-config-required");const a=r.emulator?F2(r,oCe):`https://${i.config.authDomain}/${aCe}`,c={apiKey:r.apiKey,appName:i.name,v:xw},l=lCe.get(i.config.apiHost);l&&(c.eid=l);const h=i._getFrameworks();return h.length&&(c.fw=h.join(",")),`${a}?${lv(c).slice(1)}`}async function dCe(i){const r=await iCe(i),a=Cs().gapi;return Mt(a,i,"internal-error"),r.open({where:document.body,url:uCe(i),messageHandlersFilter:a.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:cCe,dontclear:!0},c=>new Promise(async(l,h)=>{await c.restyle({setHideOnLeave:!1});const m=No(i,"network-request-failed"),E=Cs().setTimeout(()=>{h(m)},sCe.get());function S(){Cs().clearTimeout(E),l(c)}c.ping(S).then(S,()=>{h(m)})}))}const hCe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},pCe=500,fCe=600,mCe="_blank",gCe="http://localhost";class I9{constructor(r){this.window=r,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function _Ce(i,r,a,c=pCe,l=fCe){const h=Math.max((window.screen.availHeight-l)/2,0).toString(),m=Math.max((window.screen.availWidth-c)/2,0).toString();let E="";const S={...hCe,width:c.toString(),height:l.toString(),top:h,left:m},T=to().toLowerCase();a&&(E=JJ(T)?mCe:a),qJ(T)&&(r=r||gCe,S.scrollbars="yes");const C=Object.entries(S).reduce((N,[P,H])=>`${N}${P}=${H},`,"");if(v0e(T)&&E!=="_self")return ECe(r||"",E),new I9(null);const I=window.open(r||"",E,C);Mt(I,i,"popup-blocked");try{I.focus()}catch{}return new I9(I)}function ECe(i,r){const a=document.createElement("a");a.href=i,a.target=r;const c=document.createEvent("MouseEvent");c.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),a.dispatchEvent(c)}const yCe="__/auth/handler",vCe="emulator/auth/handler",SCe=encodeURIComponent("fac");async function A9(i,r,a,c,l,h){Mt(i.config.authDomain,i,"auth-domain-config-required"),Mt(i.config.apiKey,i,"invalid-api-key");const m={apiKey:i.config.apiKey,appName:i.name,authType:a,redirectUrl:c,v:xw,eventId:l};if(r instanceof H2){r.setDefaultLanguage(i.languageCode),m.providerId=r.providerId||"",jSe(r.getCustomParameters())||(m.customParameters=JSON.stringify(r.getCustomParameters()));for(const[C,I]of Object.entries({}))m[C]=I}if(r instanceof Uw){const C=r.getScopes().filter(I=>I!=="");C.length>0&&(m.scopes=C.join(","))}i.tenantId&&(m.tid=i.tenantId);const E=m;for(const C of Object.keys(E))E[C]===void 0&&delete E[C];const S=await i._getAppCheckToken(),T=S?`#${SCe}=${encodeURIComponent(S)}`:"";return`${TCe(i)}?${lv(E).slice(1)}${T}`}function TCe({config:i}){return i.emulator?F2(i,vCe):`https://${i.authDomain}/${yCe}`}const Bx="webStorageSupport";class wCe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=f$,this._completeRedirectFn=Ywe,this._overrideRedirectResult=Hwe}async _openPopup(r,a,c,l){Sh(this.eventManagers[r._key()]?.manager,"_initialize() not called before _openPopup()");const h=await A9(r,a,c,rM(),l);return _Ce(r,h,z2())}async _openRedirect(r,a,c,l){await this._originValidation(r);const h=await A9(r,a,c,rM(),l);return gwe(h),new Promise(()=>{})}_initialize(r){const a=r._key();if(this.eventManagers[a]){const{manager:l,promise:h}=this.eventManagers[a];return l?Promise.resolve(l):(Sh(h,"If manager is not set, promise should be"),h)}const c=this.initAndGetManager(r);return this.eventManagers[a]={promise:c},c.catch(()=>{delete this.eventManagers[a]}),c}async initAndGetManager(r){const a=await dCe(r),c=new Xwe(r);return a.register("authEvent",l=>(Mt(l?.authEvent,r,"invalid-auth-event"),{status:c.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[r._key()]={manager:c},this.iframes[r._key()]=a,c}_isIframeWebStorageSupported(r,a){this.iframes[r._key()].send(Bx,{type:Bx},l=>{const h=l?.[0]?.[Bx];h!==void 0&&a(!!h),cl(r,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(r){const a=r._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=eCe(r)),this.originValidationPromises[a]}get _shouldInitProactively(){return t$()||XJ()||B2()}}const CCe=wCe;var O9="@firebase/auth",N9="1.12.0";class RCe{constructor(r){this.auth=r,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(r){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(r)}:null}addAuthTokenListener(r){if(this.assertAuthConfigured(),this.internalListeners.has(r))return;const a=this.auth.onIdTokenChanged(c=>{r(c?.stsTokenManager.accessToken||null)});this.internalListeners.set(r,a),this.updateProactiveRefresh()}removeAuthTokenListener(r){this.assertAuthConfigured();const a=this.internalListeners.get(r);a&&(this.internalListeners.delete(r),a(),this.updateProactiveRefresh())}assertAuthConfigured(){Mt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function bCe(i){switch(i){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function ICe(i){vh(new Cd("auth",(r,{options:a})=>{const c=r.getProvider("app").getImmediate(),l=r.getProvider("heartbeat"),h=r.getProvider("app-check-internal"),{apiKey:m,authDomain:E}=c.options;Mt(m&&!m.includes(":"),"invalid-api-key",{appName:c.name});const S={apiKey:m,authDomain:E,clientPlatform:i,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:n$(i)},T=new b0e(c,l,h,S);return B0e(T,a),T},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((r,a,c)=>{r.getProvider("auth-internal").initialize()})),vh(new Cd("auth-internal",r=>{const a=ul(r.getProvider("auth").getImmediate());return(c=>new RCe(c))(a)},"PRIVATE").setInstantiationMode("EXPLICIT")),yd(O9,N9,bCe(i)),yd(O9,N9,"esm2020")}const ACe=300,OCe=IJ("authIdTokenMaxAge")||ACe;let P9=null;const NCe=i=>async r=>{const a=r&&await r.getIdTokenResult(),c=a&&(new Date().getTime()-Date.parse(a.issuedAtTime))/1e3;if(c&&c>OCe)return;const l=a?.token;P9!==l&&(P9=l,await fetch(i,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function PCe(i=LJ()){const r=uv(i,"auth");if(r.isInitialized())return r.getImmediate();const a=j0e(i,{popupRedirectResolver:CCe,persistence:[Rwe,pwe,f$]}),c=IJ("authTokenSyncURL");if(c&&typeof isSecureContext=="boolean"&&isSecureContext){const h=new URL(c,location.origin);if(location.origin===h.origin){const m=NCe(h.toString());cwe(a,m,()=>m(a.currentUser)),owe(a,E=>m(E))}}const l=bSe("auth");return l&&W0e(a,`http://${l}`),a}function kCe(){return document.getElementsByTagName("head")?.[0]??document}I0e({loadJS(i){return new Promise((r,a)=>{const c=document.createElement("script");c.setAttribute("src",i),c.onload=r,c.onerror=l=>{const h=No("internal-error");h.customData=l,a(h)},c.type="text/javascript",c.charset="UTF-8",kCe().appendChild(c)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});ICe("Browser");var DCe="firebase",xCe="12.7.0";yd(DCe,xCe,"app");const S$="@firebase/installations",q2="0.6.19";const T$=1e4,w$=`w:${q2}`,C$="FIS_v2",LCe="https://firebaseinstallations.googleapis.com/v1",MCe=3600*1e3,UCe="installations",VCe="Installations";const FCe={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Lg=new jg(UCe,VCe,FCe);function R$(i){return i instanceof Od&&i.code.includes("request-failed")}function b$({projectId:i}){return`${LCe}/projects/${i}/installations`}function I$(i){return{token:i.token,requestStatus:2,expiresIn:BCe(i.expiresIn),creationTime:Date.now()}}async function A$(i,r){const c=(await r.json()).error;return Lg.create("request-failed",{requestName:i,serverCode:c.code,serverMessage:c.message,serverStatus:c.status})}function O$({apiKey:i}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":i})}function jCe(i,{refreshToken:r}){const a=O$(i);return a.append("Authorization",WCe(r)),a}async function N$(i){const r=await i();return r.status>=500&&r.status<600?i():r}function BCe(i){return Number(i.replace("s","000"))}function WCe(i){return`${C$} ${i}`}async function GCe({appConfig:i,heartbeatServiceProvider:r},{fid:a}){const c=b$(i),l=O$(i),h=r.getImmediate({optional:!0});if(h){const T=await h.getHeartbeatsHeader();T&&l.append("x-firebase-client",T)}const m={fid:a,authVersion:C$,appId:i.appId,sdkVersion:w$},E={method:"POST",headers:l,body:JSON.stringify(m)},S=await N$(()=>fetch(c,E));if(S.ok){const T=await S.json();return{fid:T.fid||a,registrationStatus:2,refreshToken:T.refreshToken,authToken:I$(T.authToken)}}else throw await A$("Create Installation",S)}function P$(i){return new Promise(r=>{setTimeout(r,i)})}function HCe(i){return btoa(String.fromCharCode(...i)).replace(/\+/g,"-").replace(/\//g,"_")}const zCe=/^[cdef][\w-]{21}$/,aM="";function KCe(){try{const i=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(i),i[0]=112+i[0]%16;const a=YCe(i);return zCe.test(a)?a:aM}catch{return aM}}function YCe(i){return HCe(i).substr(0,22)}function LO(i){return`${i.appName}!${i.appId}`}const k$=new Map;function D$(i,r){const a=LO(i);x$(a,r),qCe(a,r)}function x$(i,r){const a=k$.get(i);if(a)for(const c of a)c(r)}function qCe(i,r){const a=XCe();a&&a.postMessage({key:i,fid:r}),JCe()}let vg=null;function XCe(){return!vg&&"BroadcastChannel"in self&&(vg=new BroadcastChannel("[Firebase] FID Change"),vg.onmessage=i=>{x$(i.data.key,i.data.fid)}),vg}function JCe(){k$.size===0&&vg&&(vg.close(),vg=null)}const $Ce="firebase-installations-database",QCe=1,Mg="firebase-installations-store";let Wx=null;function X2(){return Wx||(Wx=DJ($Ce,QCe,{upgrade:(i,r)=>{r===0&&i.createObjectStore(Mg)}})),Wx}async function KA(i,r){const a=LO(i),l=(await X2()).transaction(Mg,"readwrite"),h=l.objectStore(Mg),m=await h.get(a);return await h.put(r,a),await l.done,(!m||m.fid!==r.fid)&&D$(i,r.fid),r}async function L$(i){const r=LO(i),c=(await X2()).transaction(Mg,"readwrite");await c.objectStore(Mg).delete(r),await c.done}async function MO(i,r){const a=LO(i),l=(await X2()).transaction(Mg,"readwrite"),h=l.objectStore(Mg),m=await h.get(a),E=r(m);return E===void 0?await h.delete(a):await h.put(E,a),await l.done,E&&(!m||m.fid!==E.fid)&&D$(i,E.fid),E}async function J2(i){let r;const a=await MO(i.appConfig,c=>{const l=ZCe(c),h=eRe(i,l);return r=h.registrationPromise,h.installationEntry});return a.fid===aM?{installationEntry:await r}:{installationEntry:a,registrationPromise:r}}function ZCe(i){const r=i||{fid:KCe(),registrationStatus:0};return M$(r)}function eRe(i,r){if(r.registrationStatus===0){if(!navigator.onLine){const l=Promise.reject(Lg.create("app-offline"));return{installationEntry:r,registrationPromise:l}}const a={fid:r.fid,registrationStatus:1,registrationTime:Date.now()},c=tRe(i,a);return{installationEntry:a,registrationPromise:c}}else return r.registrationStatus===1?{installationEntry:r,registrationPromise:nRe(i)}:{installationEntry:r}}async function tRe(i,r){try{const a=await GCe(i,r);return KA(i.appConfig,a)}catch(a){throw R$(a)&&a.customData.serverCode===409?await L$(i.appConfig):await KA(i.appConfig,{fid:r.fid,registrationStatus:0}),a}}async function nRe(i){let r=await k9(i.appConfig);for(;r.registrationStatus===1;)await P$(100),r=await k9(i.appConfig);if(r.registrationStatus===0){const{installationEntry:a,registrationPromise:c}=await J2(i);return c||a}return r}function k9(i){return MO(i,r=>{if(!r)throw Lg.create("installation-not-found");return M$(r)})}function M$(i){return rRe(i)?{fid:i.fid,registrationStatus:0}:i}function rRe(i){return i.registrationStatus===1&&i.registrationTime+T$<Date.now()}async function iRe({appConfig:i,heartbeatServiceProvider:r},a){const c=sRe(i,a),l=jCe(i,a),h=r.getImmediate({optional:!0});if(h){const T=await h.getHeartbeatsHeader();T&&l.append("x-firebase-client",T)}const m={installation:{sdkVersion:w$,appId:i.appId}},E={method:"POST",headers:l,body:JSON.stringify(m)},S=await N$(()=>fetch(c,E));if(S.ok){const T=await S.json();return I$(T)}else throw await A$("Generate Auth Token",S)}function sRe(i,{fid:r}){return`${b$(i)}/${r}/authTokens:generate`}async function $2(i,r=!1){let a;const c=await MO(i.appConfig,h=>{if(!U$(h))throw Lg.create("not-registered");const m=h.authToken;if(!r&&cRe(m))return h;if(m.requestStatus===1)return a=aRe(i,r),h;{if(!navigator.onLine)throw Lg.create("app-offline");const E=uRe(h);return a=oRe(i,E),E}});return a?await a:c.authToken}async function aRe(i,r){let a=await D9(i.appConfig);for(;a.authToken.requestStatus===1;)await P$(100),a=await D9(i.appConfig);const c=a.authToken;return c.requestStatus===0?$2(i,r):c}function D9(i){return MO(i,r=>{if(!U$(r))throw Lg.create("not-registered");const a=r.authToken;return dRe(a)?{...r,authToken:{requestStatus:0}}:r})}async function oRe(i,r){try{const a=await iRe(i,r),c={...r,authToken:a};return await KA(i.appConfig,c),a}catch(a){if(R$(a)&&(a.customData.serverCode===401||a.customData.serverCode===404))await L$(i.appConfig);else{const c={...r,authToken:{requestStatus:0}};await KA(i.appConfig,c)}throw a}}function U$(i){return i!==void 0&&i.registrationStatus===2}function cRe(i){return i.requestStatus===2&&!lRe(i)}function lRe(i){const r=Date.now();return r<i.creationTime||i.creationTime+i.expiresIn<r+MCe}function uRe(i){const r={requestStatus:1,requestTime:Date.now()};return{...i,authToken:r}}function dRe(i){return i.requestStatus===1&&i.requestTime+T$<Date.now()}async function hRe(i){const r=i,{installationEntry:a,registrationPromise:c}=await J2(r);return c?c.catch(console.error):$2(r).catch(console.error),a.fid}async function pRe(i,r=!1){const a=i;return await fRe(a),(await $2(a,r)).token}async function fRe(i){const{registrationPromise:r}=await J2(i);r&&await r}function mRe(i){if(!i||!i.options)throw Gx("App Configuration");if(!i.name)throw Gx("App Name");const r=["projectId","apiKey","appId"];for(const a of r)if(!i.options[a])throw Gx(a);return{appName:i.name,projectId:i.options.projectId,apiKey:i.options.apiKey,appId:i.options.appId}}function Gx(i){return Lg.create("missing-app-config-values",{valueName:i})}const V$="installations",gRe="installations-internal",_Re=i=>{const r=i.getProvider("app").getImmediate(),a=mRe(r),c=uv(r,"heartbeat");return{app:r,appConfig:a,heartbeatServiceProvider:c,_delete:()=>Promise.resolve()}},ERe=i=>{const r=i.getProvider("app").getImmediate(),a=uv(r,V$).getImmediate();return{getId:()=>hRe(a),getToken:l=>pRe(a,l)}};function yRe(){vh(new Cd(V$,_Re,"PUBLIC")),vh(new Cd(gRe,ERe,"PRIVATE"))}yRe();yd(S$,q2);yd(S$,q2,"esm2020");const YA="analytics",vRe="firebase_id",SRe="origin",TRe=60*1e3,wRe="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Q2="https://www.googletagmanager.com/gtag/js";const Za=new L2("@firebase/analytics");const CRe={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},mc=new jg("analytics","Analytics",CRe);function RRe(i){if(!i.startsWith(Q2)){const r=mc.create("invalid-gtag-resource",{gtagURL:i});return Za.warn(r.message),""}return i}function F$(i){return Promise.all(i.map(r=>r.catch(a=>a)))}function bRe(i,r){let a;return window.trustedTypes&&(a=window.trustedTypes.createPolicy(i,r)),a}function IRe(i,r){const a=bRe("firebase-js-sdk-policy",{createScriptURL:RRe}),c=document.createElement("script"),l=`${Q2}?l=${i}&id=${r}`;c.src=a?a?.createScriptURL(l):l,c.async=!0,document.head.appendChild(c)}function ARe(i){let r=[];return Array.isArray(window[i])?r=window[i]:window[i]=r,r}async function ORe(i,r,a,c,l,h){const m=c[l];try{if(m)await r[m];else{const S=(await F$(a)).find(T=>T.measurementId===l);S&&await r[S.appId]}}catch(E){Za.error(E)}i("config",l,h)}async function NRe(i,r,a,c,l){try{let h=[];if(l&&l.send_to){let m=l.send_to;Array.isArray(m)||(m=[m]);const E=await F$(a);for(const S of m){const T=E.find(I=>I.measurementId===S),C=T&&r[T.appId];if(C)h.push(C);else{h=[];break}}}h.length===0&&(h=Object.values(r)),await Promise.all(h),i("event",c,l||{})}catch(h){Za.error(h)}}function PRe(i,r,a,c){async function l(h,...m){try{if(h==="event"){const[E,S]=m;await NRe(i,r,a,E,S)}else if(h==="config"){const[E,S]=m;await ORe(i,r,a,c,E,S)}else if(h==="consent"){const[E,S]=m;i("consent",E,S)}else if(h==="get"){const[E,S,T]=m;i("get",E,S,T)}else if(h==="set"){const[E]=m;i("set",E)}else i(h,...m)}catch(E){Za.error(E)}}return l}function kRe(i,r,a,c,l){let h=function(...m){window[c].push(arguments)};return window[l]&&typeof window[l]=="function"&&(h=window[l]),window[l]=PRe(h,i,r,a),{gtagCore:h,wrappedGtag:window[l]}}function DRe(i){const r=window.document.getElementsByTagName("script");for(const a of Object.values(r))if(a.src&&a.src.includes(Q2)&&a.src.includes(i))return a;return null}const xRe=30,LRe=1e3;class MRe{constructor(r={},a=LRe){this.throttleMetadata=r,this.intervalMillis=a}getThrottleMetadata(r){return this.throttleMetadata[r]}setThrottleMetadata(r,a){this.throttleMetadata[r]=a}deleteThrottleMetadata(r){delete this.throttleMetadata[r]}}const j$=new MRe;function URe(i){return new Headers({Accept:"application/json","x-goog-api-key":i})}async function VRe(i){const{appId:r,apiKey:a}=i,c={method:"GET",headers:URe(a)},l=wRe.replace("{app-id}",r),h=await fetch(l,c);if(h.status!==200&&h.status!==304){let m="";try{const E=await h.json();E.error?.message&&(m=E.error.message)}catch{}throw mc.create("config-fetch-failed",{httpStatus:h.status,responseMessage:m})}return h.json()}async function FRe(i,r=j$,a){const{appId:c,apiKey:l,measurementId:h}=i.options;if(!c)throw mc.create("no-app-id");if(!l){if(h)return{measurementId:h,appId:c};throw mc.create("no-api-key")}const m=r.getThrottleMetadata(c)||{backoffCount:0,throttleEndTimeMillis:Date.now()},E=new WRe;return setTimeout(async()=>{E.abort()},TRe),B$({appId:c,apiKey:l,measurementId:h},m,E,r)}async function B$(i,{throttleEndTimeMillis:r,backoffCount:a},c,l=j$){const{appId:h,measurementId:m}=i;try{await jRe(c,r)}catch(E){if(m)return Za.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${m} provided in the "measurementId" field in the local Firebase config. [${E?.message}]`),{appId:h,measurementId:m};throw E}try{const E=await VRe(i);return l.deleteThrottleMetadata(h),E}catch(E){const S=E;if(!BRe(S)){if(l.deleteThrottleMetadata(h),m)return Za.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${m} provided in the "measurementId" field in the local Firebase config. [${S?.message}]`),{appId:h,measurementId:m};throw E}const T=Number(S?.customData?.httpStatus)===503?t9(a,l.intervalMillis,xRe):t9(a,l.intervalMillis),C={throttleEndTimeMillis:Date.now()+T,backoffCount:a+1};return l.setThrottleMetadata(h,C),Za.debug(`Calling attemptFetch again in ${T} millis`),B$(i,C,c,l)}}function jRe(i,r){return new Promise((a,c)=>{const l=Math.max(r-Date.now(),0),h=setTimeout(a,l);i.addEventListener(()=>{clearTimeout(h),c(mc.create("fetch-throttle",{throttleEndTimeMillis:r}))})})}function BRe(i){if(!(i instanceof Od)||!i.customData)return!1;const r=Number(i.customData.httpStatus);return r===429||r===500||r===503||r===504}class WRe{constructor(){this.listeners=[]}addEventListener(r){this.listeners.push(r)}abort(){this.listeners.forEach(r=>r())}}async function GRe(i,r,a,c,l){if(l&&l.global){i("event",a,c);return}else{const h=await r,m={...c,send_to:h};i("event",a,m)}}async function HRe(i,r,a,c){if(c&&c.global){const l={};for(const h of Object.keys(a))l[`user_properties.${h}`]=a[h];return i("set",l),Promise.resolve()}else{const l=await r;i("config",l,{update:!0,user_properties:a})}}async function zRe(){if(OJ())try{await NJ()}catch(i){return Za.warn(mc.create("indexeddb-unavailable",{errorInfo:i?.toString()}).message),!1}else return Za.warn(mc.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function KRe(i,r,a,c,l,h,m){const E=FRe(i);E.then(N=>{a[N.measurementId]=N.appId,i.options.measurementId&&N.measurementId!==i.options.measurementId&&Za.warn(`The measurement ID in the local Firebase config (${i.options.measurementId}) does not match the measurement ID fetched from the server (${N.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(N=>Za.error(N)),r.push(E);const S=zRe().then(N=>{if(N)return c.getId()}),[T,C]=await Promise.all([E,S]);DRe(h)||IRe(h,T.measurementId),l("js",new Date);const I=m?.config??{};return I[SRe]="firebase",I.update=!0,C!=null&&(I[vRe]=C),l("config",T.measurementId,I),T.measurementId}class YRe{constructor(r){this.app=r}_delete(){return delete My[this.app.options.appId],Promise.resolve()}}let My={},x9=[];const L9={};let Hx="dataLayer",qRe="gtag",M9,Z2,U9=!1;function XRe(){const i=[];if(AJ()&&i.push("This is a browser extension environment."),MSe()||i.push("Cookies are not available."),i.length>0){const r=i.map((c,l)=>`(${l+1}) ${c}`).join(" "),a=mc.create("invalid-analytics-context",{errorInfo:r});Za.warn(a.message)}}function JRe(i,r,a){XRe();const c=i.options.appId;if(!c)throw mc.create("no-app-id");if(!i.options.apiKey)if(i.options.measurementId)Za.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${i.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw mc.create("no-api-key");if(My[c]!=null)throw mc.create("already-exists",{id:c});if(!U9){ARe(Hx);const{wrappedGtag:h,gtagCore:m}=kRe(My,x9,L9,Hx,qRe);Z2=h,M9=m,U9=!0}return My[c]=KRe(i,x9,L9,r,M9,Hx,a),new YRe(i)}function $Re(i=LJ()){i=vc(i);const r=uv(i,YA);return r.isInitialized()?r.getImmediate():QRe(i)}function QRe(i,r={}){const a=uv(i,YA);if(a.isInitialized()){const l=a.getImmediate();if(Dg(r,a.getOptions()))return l;throw mc.create("already-initialized")}return a.initialize({options:r})}function ZRe(i,r,a){i=vc(i),HRe(Z2,My[i.app.options.appId],r,a).catch(c=>Za.error(c))}function ebe(i,r,a,c){i=vc(i),GRe(Z2,My[i.app.options.appId],r,a,c).catch(l=>Za.error(l))}const V9="@firebase/analytics",F9="0.10.19";function tbe(){vh(new Cd(YA,(r,{options:a})=>{const c=r.getProvider("app").getImmediate(),l=r.getProvider("installations-internal").getImmediate();return JRe(c,l,a)},"PUBLIC")),vh(new Cd("analytics-internal",i,"PRIVATE")),yd(V9,F9),yd(V9,F9,"esm2020");function i(r){try{const a=r.getProvider(YA).getImmediate();return{logEvent:(c,l,h)=>ebe(a,c,l,h),setUserProperties:(c,l)=>ZRe(a,c,l)}}catch(a){throw mc.create("interop-component-reg-failed",{reason:a})}}}tbe();const nbe={apiKey:"AIzaSyAMMzRab6OCXICjmAlnN-maJXRGEEgWdaE",authDomain:"kle-connect.firebaseapp.com",projectId:"kle-connect",storageBucket:"kle-connect.firebasestorage.app",messagingSenderId:"939070940474",appId:"1:939070940474:web:5a0b7a45c7fe345fbddc03",measurementId:"G-9T43NDMQVS"},W$=xJ(nbe),jp=PCe(W$),rbe=new hh;$Re(W$);const G$=G.createContext(void 0),UO=()=>{const i=G.useContext(G$);if(!i)throw new Error("useAuth must be used within an AuthProvider");return i},ibe=({children:i})=>{const[r,a]=G.useState(null),[c,l]=G.useState(!0);G.useEffect(()=>{const N=lwe(jp,P=>{a(P),l(!1)});return()=>N()},[]);const h=async(N,P,H)=>{try{return await swe(jp,N,P),{error:null}}catch(x){return{error:x}}},m=async(N,P)=>{try{return await awe(jp,N,P),{error:null}}catch(H){return{error:H}}},E=async()=>{try{return await jwe(jp,rbe),{error:null}}catch(N){return{error:N}}},S=async()=>{try{return await nwe(jp),{error:null}}catch(N){return{error:N}}},T=N=>new Pwe(jp,N,{size:"invisible",callback:()=>{}}),C=async(N,P)=>{try{return{confirmationResult:await xwe(jp,N,P),error:null}}catch(H){return{confirmationResult:null,error:H}}},I=async()=>{await uwe(jp)};return D.jsx(G$.Provider,{value:{user:r,loading:c,signUp:h,signIn:m,signInWithGoogle:E,signInAnonymously:S,setUpRecaptcha:T,signInWithPhone:C,signOut:I},children:i})},eU=G.createContext({});function tU(i){const r=G.useRef(null);return r.current===null&&(r.current=i()),r.current}const nU=typeof window<"u",H$=nU?G.useLayoutEffect:G.useEffect,VO=G.createContext(null);function rU(i,r){i.indexOf(r)===-1&&i.push(r)}function iU(i,r){const a=i.indexOf(r);a>-1&&i.splice(a,1)}const wh=(i,r,a)=>a>r?r:a<i?i:a;let sU=()=>{};const Ch={},z$=i=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(i);function K$(i){return typeof i=="object"&&i!==null}const Y$=i=>/^0[^.\s]+$/u.test(i);function aU(i){let r;return()=>(r===void 0&&(r=i()),r)}const ol=i=>i,sbe=(i,r)=>a=>r(i(a)),Fw=(...i)=>i.reduce(sbe),pw=(i,r,a)=>{const c=r-i;return c===0?1:(a-i)/c};class oU{constructor(){this.subscriptions=[]}add(r){return rU(this.subscriptions,r),()=>iU(this.subscriptions,r)}notify(r,a,c){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](r,a,c);else for(let h=0;h<l;h++){const m=this.subscriptions[h];m&&m(r,a,c)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const vd=i=>i*1e3,il=i=>i/1e3;function q$(i,r){return r?i*(1e3/r):0}const X$=(i,r,a)=>(((1-3*a+3*r)*i+(3*a-6*r))*i+3*r)*i,abe=1e-7,obe=12;function cbe(i,r,a,c,l){let h,m,E=0;do m=r+(a-r)/2,h=X$(m,c,l)-i,h>0?a=m:r=m;while(Math.abs(h)>abe&&++E<obe);return m}function jw(i,r,a,c){if(i===r&&a===c)return ol;const l=h=>cbe(h,0,1,i,a);return h=>h===0||h===1?h:X$(l(h),r,c)}const J$=i=>r=>r<=.5?i(2*r)/2:(2-i(2*(1-r)))/2,$$=i=>r=>1-i(1-r),Q$=jw(.33,1.53,.69,.99),cU=$$(Q$),Z$=J$(cU),eQ=i=>(i*=2)<1?.5*cU(i):.5*(2-Math.pow(2,-10*(i-1))),lU=i=>1-Math.sin(Math.acos(i)),tQ=$$(lU),nQ=J$(lU),lbe=jw(.42,0,1,1),ube=jw(0,0,.58,1),rQ=jw(.42,0,.58,1),dbe=i=>Array.isArray(i)&&typeof i[0]!="number",iQ=i=>Array.isArray(i)&&typeof i[0]=="number",hbe={linear:ol,easeIn:lbe,easeInOut:rQ,easeOut:ube,circIn:lU,circInOut:nQ,circOut:tQ,backIn:cU,backInOut:Z$,backOut:Q$,anticipate:eQ},pbe=i=>typeof i=="string",j9=i=>{if(iQ(i)){sU(i.length===4);const[r,a,c,l]=i;return jw(r,a,c,l)}else if(pbe(i))return hbe[i];return i},JI=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function fbe(i,r){let a=new Set,c=new Set,l=!1,h=!1;const m=new WeakSet;let E={delta:0,timestamp:0,isProcessing:!1};function S(C){m.has(C)&&(T.schedule(C),i()),C(E)}const T={schedule:(C,I=!1,N=!1)=>{const H=N&&l?a:c;return I&&m.add(C),H.has(C)||H.add(C),C},cancel:C=>{c.delete(C),m.delete(C)},process:C=>{if(E=C,l){h=!0;return}l=!0,[a,c]=[c,a],a.forEach(S),a.clear(),l=!1,h&&(h=!1,T.process(C))}};return T}const mbe=40;function sQ(i,r){let a=!1,c=!0;const l={delta:0,timestamp:0,isProcessing:!1},h=()=>a=!0,m=JI.reduce(($,le)=>($[le]=fbe(h),$),{}),{setup:E,read:S,resolveKeyframes:T,preUpdate:C,update:I,preRender:N,render:P,postRender:H}=m,x=()=>{const $=Ch.useManualTiming?l.timestamp:performance.now();a=!1,Ch.useManualTiming||(l.delta=c?1e3/60:Math.max(Math.min($-l.timestamp,mbe),1)),l.timestamp=$,l.isProcessing=!0,E.process(l),S.process(l),T.process(l),C.process(l),I.process(l),N.process(l),P.process(l),H.process(l),l.isProcessing=!1,a&&r&&(c=!1,i(x))},B=()=>{a=!0,c=!0,l.isProcessing||i(x)};return{schedule:JI.reduce(($,le)=>{const re=m[le];return $[le]=(ce,te=!1,pe=!1)=>(a||B(),re.schedule(ce,te,pe)),$},{}),cancel:$=>{for(let le=0;le<JI.length;le++)m[JI[le]].cancel($)},state:l,steps:m}}const{schedule:Fi,cancel:cf,state:ma,steps:zx}=sQ(typeof requestAnimationFrame<"u"?requestAnimationFrame:ol,!0);let _A;function gbe(){_A=void 0}const Oo={now:()=>(_A===void 0&&Oo.set(ma.isProcessing||Ch.useManualTiming?ma.timestamp:performance.now()),_A),set:i=>{_A=i,queueMicrotask(gbe)}},aQ=i=>r=>typeof r=="string"&&r.startsWith(i),oQ=aQ("--"),_be=aQ("var(--"),uU=i=>_be(i)?Ebe.test(i.split("/*")[0].trim()):!1,Ebe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,hv={test:i=>typeof i=="number",parse:parseFloat,transform:i=>i},fw={...hv,transform:i=>wh(0,1,i)},$I={...hv,default:1},z0=i=>Math.round(i*1e5)/1e5,dU=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function ybe(i){return i==null}const vbe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,hU=(i,r)=>a=>!!(typeof a=="string"&&vbe.test(a)&&a.startsWith(i)||r&&!ybe(a)&&Object.prototype.hasOwnProperty.call(a,r)),cQ=(i,r,a)=>c=>{if(typeof c!="string")return c;const[l,h,m,E]=c.match(dU);return{[i]:parseFloat(l),[r]:parseFloat(h),[a]:parseFloat(m),alpha:E!==void 0?parseFloat(E):1}},Sbe=i=>wh(0,255,i),Kx={...hv,transform:i=>Math.round(Sbe(i))},Sg={test:hU("rgb","red"),parse:cQ("red","green","blue"),transform:({red:i,green:r,blue:a,alpha:c=1})=>"rgba("+Kx.transform(i)+", "+Kx.transform(r)+", "+Kx.transform(a)+", "+z0(fw.transform(c))+")"};function Tbe(i){let r="",a="",c="",l="";return i.length>5?(r=i.substring(1,3),a=i.substring(3,5),c=i.substring(5,7),l=i.substring(7,9)):(r=i.substring(1,2),a=i.substring(2,3),c=i.substring(3,4),l=i.substring(4,5),r+=r,a+=a,c+=c,l+=l),{red:parseInt(r,16),green:parseInt(a,16),blue:parseInt(c,16),alpha:l?parseInt(l,16)/255:1}}const oM={test:hU("#"),parse:Tbe,transform:Sg.transform},Bw=i=>({test:r=>typeof r=="string"&&r.endsWith(i)&&r.split(" ").length===1,parse:parseFloat,transform:r=>`${r}${i}`}),Gp=Bw("deg"),Sd=Bw("%"),vn=Bw("px"),wbe=Bw("vh"),Cbe=Bw("vw"),B9={...Sd,parse:i=>Sd.parse(i)/100,transform:i=>Sd.transform(i*100)},Sy={test:hU("hsl","hue"),parse:cQ("hue","saturation","lightness"),transform:({hue:i,saturation:r,lightness:a,alpha:c=1})=>"hsla("+Math.round(i)+", "+Sd.transform(z0(r))+", "+Sd.transform(z0(a))+", "+z0(fw.transform(c))+")"},Ts={test:i=>Sg.test(i)||oM.test(i)||Sy.test(i),parse:i=>Sg.test(i)?Sg.parse(i):Sy.test(i)?Sy.parse(i):oM.parse(i),transform:i=>typeof i=="string"?i:i.hasOwnProperty("red")?Sg.transform(i):Sy.transform(i),getAnimatableNone:i=>{const r=Ts.parse(i);return r.alpha=0,Ts.transform(r)}},Rbe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function bbe(i){return isNaN(i)&&typeof i=="string"&&(i.match(dU)?.length||0)+(i.match(Rbe)?.length||0)>0}const lQ="number",uQ="color",Ibe="var",Abe="var(",W9="${}",Obe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function mw(i){const r=i.toString(),a=[],c={color:[],number:[],var:[]},l=[];let h=0;const E=r.replace(Obe,S=>(Ts.test(S)?(c.color.push(h),l.push(uQ),a.push(Ts.parse(S))):S.startsWith(Abe)?(c.var.push(h),l.push(Ibe),a.push(S)):(c.number.push(h),l.push(lQ),a.push(parseFloat(S))),++h,W9)).split(W9);return{values:a,split:E,indexes:c,types:l}}function dQ(i){return mw(i).values}function hQ(i){const{split:r,types:a}=mw(i),c=r.length;return l=>{let h="";for(let m=0;m<c;m++)if(h+=r[m],l[m]!==void 0){const E=a[m];E===lQ?h+=z0(l[m]):E===uQ?h+=Ts.transform(l[m]):h+=l[m]}return h}}const Nbe=i=>typeof i=="number"?0:Ts.test(i)?Ts.getAnimatableNone(i):i;function Pbe(i){const r=dQ(i);return hQ(i)(r.map(Nbe))}const lf={test:bbe,parse:dQ,createTransformer:hQ,getAnimatableNone:Pbe};function Yx(i,r,a){return a<0&&(a+=1),a>1&&(a-=1),a<1/6?i+(r-i)*6*a:a<1/2?r:a<2/3?i+(r-i)*(2/3-a)*6:i}function kbe({hue:i,saturation:r,lightness:a,alpha:c}){i/=360,r/=100,a/=100;let l=0,h=0,m=0;if(!r)l=h=m=a;else{const E=a<.5?a*(1+r):a+r-a*r,S=2*a-E;l=Yx(S,E,i+1/3),h=Yx(S,E,i),m=Yx(S,E,i-1/3)}return{red:Math.round(l*255),green:Math.round(h*255),blue:Math.round(m*255),alpha:c}}function qA(i,r){return a=>a>0?r:i}const Xi=(i,r,a)=>i+(r-i)*a,qx=(i,r,a)=>{const c=i*i,l=a*(r*r-c)+c;return l<0?0:Math.sqrt(l)},Dbe=[oM,Sg,Sy],xbe=i=>Dbe.find(r=>r.test(i));function G9(i){const r=xbe(i);if(!r)return!1;let a=r.parse(i);return r===Sy&&(a=kbe(a)),a}const H9=(i,r)=>{const a=G9(i),c=G9(r);if(!a||!c)return qA(i,r);const l={...a};return h=>(l.red=qx(a.red,c.red,h),l.green=qx(a.green,c.green,h),l.blue=qx(a.blue,c.blue,h),l.alpha=Xi(a.alpha,c.alpha,h),Sg.transform(l))},cM=new Set(["none","hidden"]);function Lbe(i,r){return cM.has(i)?a=>a<=0?i:r:a=>a>=1?r:i}function Mbe(i,r){return a=>Xi(i,r,a)}function pU(i){return typeof i=="number"?Mbe:typeof i=="string"?uU(i)?qA:Ts.test(i)?H9:Fbe:Array.isArray(i)?pQ:typeof i=="object"?Ts.test(i)?H9:Ube:qA}function pQ(i,r){const a=[...i],c=a.length,l=i.map((h,m)=>pU(h)(h,r[m]));return h=>{for(let m=0;m<c;m++)a[m]=l[m](h);return a}}function Ube(i,r){const a={...i,...r},c={};for(const l in a)i[l]!==void 0&&r[l]!==void 0&&(c[l]=pU(i[l])(i[l],r[l]));return l=>{for(const h in c)a[h]=c[h](l);return a}}function Vbe(i,r){const a=[],c={color:0,var:0,number:0};for(let l=0;l<r.values.length;l++){const h=r.types[l],m=i.indexes[h][c[h]],E=i.values[m]??0;a[l]=E,c[h]++}return a}const Fbe=(i,r)=>{const a=lf.createTransformer(r),c=mw(i),l=mw(r);return c.indexes.var.length===l.indexes.var.length&&c.indexes.color.length===l.indexes.color.length&&c.indexes.number.length>=l.indexes.number.length?cM.has(i)&&!l.values.length||cM.has(r)&&!c.values.length?Lbe(i,r):Fw(pQ(Vbe(c,l),l.values),a):qA(i,r)};function fQ(i,r,a){return typeof i=="number"&&typeof r=="number"&&typeof a=="number"?Xi(i,r,a):pU(i)(i,r)}const jbe=i=>{const r=({timestamp:a})=>i(a);return{start:(a=!0)=>Fi.update(r,a),stop:()=>cf(r),now:()=>ma.isProcessing?ma.timestamp:Oo.now()}},mQ=(i,r,a=10)=>{let c="";const l=Math.max(Math.round(r/a),2);for(let h=0;h<l;h++)c+=Math.round(i(h/(l-1))*1e4)/1e4+", ";return`linear(${c.substring(0,c.length-2)})`},XA=2e4;function fU(i){let r=0;const a=50;let c=i.next(r);for(;!c.done&&r<XA;)r+=a,c=i.next(r);return r>=XA?1/0:r}function Bbe(i,r=100,a){const c=a({...i,keyframes:[0,r]}),l=Math.min(fU(c),XA);return{type:"keyframes",ease:h=>c.next(l*h).value/r,duration:il(l)}}const Wbe=5;function gQ(i,r,a){const c=Math.max(r-Wbe,0);return q$(a-i(c),r-c)}const ss={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Xx=.001;function Gbe({duration:i=ss.duration,bounce:r=ss.bounce,velocity:a=ss.velocity,mass:c=ss.mass}){let l,h,m=1-r;m=wh(ss.minDamping,ss.maxDamping,m),i=wh(ss.minDuration,ss.maxDuration,il(i)),m<1?(l=T=>{const C=T*m,I=C*i,N=C-a,P=lM(T,m),H=Math.exp(-I);return Xx-N/P*H},h=T=>{const I=T*m*i,N=I*a+a,P=Math.pow(m,2)*Math.pow(T,2)*i,H=Math.exp(-I),x=lM(Math.pow(T,2),m);return(-l(T)+Xx>0?-1:1)*((N-P)*H)/x}):(l=T=>{const C=Math.exp(-T*i),I=(T-a)*i+1;return-Xx+C*I},h=T=>{const C=Math.exp(-T*i),I=(a-T)*(i*i);return C*I});const E=5/i,S=zbe(l,h,E);if(i=vd(i),isNaN(S))return{stiffness:ss.stiffness,damping:ss.damping,duration:i};{const T=Math.pow(S,2)*c;return{stiffness:T,damping:m*2*Math.sqrt(c*T),duration:i}}}const Hbe=12;function zbe(i,r,a){let c=a;for(let l=1;l<Hbe;l++)c=c-i(c)/r(c);return c}function lM(i,r){return i*Math.sqrt(1-r*r)}const Kbe=["duration","bounce"],Ybe=["stiffness","damping","mass"];function z9(i,r){return r.some(a=>i[a]!==void 0)}function qbe(i){let r={velocity:ss.velocity,stiffness:ss.stiffness,damping:ss.damping,mass:ss.mass,isResolvedFromDuration:!1,...i};if(!z9(i,Ybe)&&z9(i,Kbe))if(i.visualDuration){const a=i.visualDuration,c=2*Math.PI/(a*1.2),l=c*c,h=2*wh(.05,1,1-(i.bounce||0))*Math.sqrt(l);r={...r,mass:ss.mass,stiffness:l,damping:h}}else{const a=Gbe(i);r={...r,...a,mass:ss.mass},r.isResolvedFromDuration=!0}return r}function JA(i=ss.visualDuration,r=ss.bounce){const a=typeof i!="object"?{visualDuration:i,keyframes:[0,1],bounce:r}:i;let{restSpeed:c,restDelta:l}=a;const h=a.keyframes[0],m=a.keyframes[a.keyframes.length-1],E={done:!1,value:h},{stiffness:S,damping:T,mass:C,duration:I,velocity:N,isResolvedFromDuration:P}=qbe({...a,velocity:-il(a.velocity||0)}),H=N||0,x=T/(2*Math.sqrt(S*C)),B=m-h,X=il(Math.sqrt(S/C)),Z=Math.abs(B)<5;c||(c=Z?ss.restSpeed.granular:ss.restSpeed.default),l||(l=Z?ss.restDelta.granular:ss.restDelta.default);let $;if(x<1){const re=lM(X,x);$=ce=>{const te=Math.exp(-x*X*ce);return m-te*((H+x*X*B)/re*Math.sin(re*ce)+B*Math.cos(re*ce))}}else if(x===1)$=re=>m-Math.exp(-X*re)*(B+(H+X*B)*re);else{const re=X*Math.sqrt(x*x-1);$=ce=>{const te=Math.exp(-x*X*ce),pe=Math.min(re*ce,300);return m-te*((H+x*X*B)*Math.sinh(pe)+re*B*Math.cosh(pe))/re}}const le={calculatedDuration:P&&I||null,next:re=>{const ce=$(re);if(P)E.done=re>=I;else{let te=re===0?H:0;x<1&&(te=re===0?vd(H):gQ($,re,ce));const pe=Math.abs(te)<=c,Ee=Math.abs(m-ce)<=l;E.done=pe&&Ee}return E.value=E.done?m:ce,E},toString:()=>{const re=Math.min(fU(le),XA),ce=mQ(te=>le.next(re*te).value,re,30);return re+"ms "+ce},toTransition:()=>{}};return le}JA.applyToOptions=i=>{const r=Bbe(i,100,JA);return i.ease=r.ease,i.duration=vd(r.duration),i.type="keyframes",i};function uM({keyframes:i,velocity:r=0,power:a=.8,timeConstant:c=325,bounceDamping:l=10,bounceStiffness:h=500,modifyTarget:m,min:E,max:S,restDelta:T=.5,restSpeed:C}){const I=i[0],N={done:!1,value:I},P=pe=>E!==void 0&&pe<E||S!==void 0&&pe>S,H=pe=>E===void 0?S:S===void 0||Math.abs(E-pe)<Math.abs(S-pe)?E:S;let x=a*r;const B=I+x,X=m===void 0?B:m(B);X!==B&&(x=X-I);const Z=pe=>-x*Math.exp(-pe/c),$=pe=>X+Z(pe),le=pe=>{const Ee=Z(pe),Ne=$(pe);N.done=Math.abs(Ee)<=T,N.value=N.done?X:Ne};let re,ce;const te=pe=>{P(N.value)&&(re=pe,ce=JA({keyframes:[N.value,H(N.value)],velocity:gQ($,pe,N.value),damping:l,stiffness:h,restDelta:T,restSpeed:C}))};return te(0),{calculatedDuration:null,next:pe=>{let Ee=!1;return!ce&&re===void 0&&(Ee=!0,le(pe),te(pe)),re!==void 0&&pe>=re?ce.next(pe-re):(!Ee&&le(pe),N)}}}function Xbe(i,r,a){const c=[],l=a||Ch.mix||fQ,h=i.length-1;for(let m=0;m<h;m++){let E=l(i[m],i[m+1]);if(r){const S=Array.isArray(r)?r[m]||ol:r;E=Fw(S,E)}c.push(E)}return c}function Jbe(i,r,{clamp:a=!0,ease:c,mixer:l}={}){const h=i.length;if(sU(h===r.length),h===1)return()=>r[0];if(h===2&&r[0]===r[1])return()=>r[1];const m=i[0]===i[1];i[0]>i[h-1]&&(i=[...i].reverse(),r=[...r].reverse());const E=Xbe(r,c,l),S=E.length,T=C=>{if(m&&C<i[0])return r[0];let I=0;if(S>1)for(;I<i.length-2&&!(C<i[I+1]);I++);const N=pw(i[I],i[I+1],C);return E[I](N)};return a?C=>T(wh(i[0],i[h-1],C)):T}function $be(i,r){const a=i[i.length-1];for(let c=1;c<=r;c++){const l=pw(0,r,c);i.push(Xi(a,1,l))}}function Qbe(i){const r=[0];return $be(r,i.length-1),r}function Zbe(i,r){return i.map(a=>a*r)}function eIe(i,r){return i.map(()=>r||rQ).splice(0,i.length-1)}function K0({duration:i=300,keyframes:r,times:a,ease:c="easeInOut"}){const l=dbe(c)?c.map(j9):j9(c),h={done:!1,value:r[0]},m=Zbe(a&&a.length===r.length?a:Qbe(r),i),E=Jbe(m,r,{ease:Array.isArray(l)?l:eIe(r,l)});return{calculatedDuration:i,next:S=>(h.value=E(S),h.done=S>=i,h)}}const tIe=i=>i!==null;function mU(i,{repeat:r,repeatType:a="loop"},c,l=1){const h=i.filter(tIe),E=l<0||r&&a!=="loop"&&r%2===1?0:h.length-1;return!E||c===void 0?h[E]:c}const nIe={decay:uM,inertia:uM,tween:K0,keyframes:K0,spring:JA};function _Q(i){typeof i.type=="string"&&(i.type=nIe[i.type])}class gU{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(r=>{this.resolve=r})}notifyFinished(){this.resolve()}then(r,a){return this.finished.then(r,a)}}const rIe=i=>i/100;class _U extends gU{constructor(r){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:a}=this.options;a&&a.updatedAt!==Oo.now()&&this.tick(Oo.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=r,this.initAnimation(),this.play(),r.autoplay===!1&&this.pause()}initAnimation(){const{options:r}=this;_Q(r);const{type:a=K0,repeat:c=0,repeatDelay:l=0,repeatType:h,velocity:m=0}=r;let{keyframes:E}=r;const S=a||K0;S!==K0&&typeof E[0]!="number"&&(this.mixKeyframes=Fw(rIe,fQ(E[0],E[1])),E=[0,100]);const T=S({...r,keyframes:E});h==="mirror"&&(this.mirroredGenerator=S({...r,keyframes:[...E].reverse(),velocity:-m})),T.calculatedDuration===null&&(T.calculatedDuration=fU(T));const{calculatedDuration:C}=T;this.calculatedDuration=C,this.resolvedDuration=C+l,this.totalDuration=this.resolvedDuration*(c+1)-l,this.generator=T}updateTime(r){const a=Math.round(r-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=a}tick(r,a=!1){const{generator:c,totalDuration:l,mixKeyframes:h,mirroredGenerator:m,resolvedDuration:E,calculatedDuration:S}=this;if(this.startTime===null)return c.next(0);const{delay:T=0,keyframes:C,repeat:I,repeatType:N,repeatDelay:P,type:H,onUpdate:x,finalKeyframe:B}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,r):this.speed<0&&(this.startTime=Math.min(r-l/this.speed,this.startTime)),a?this.currentTime=r:this.updateTime(r);const X=this.currentTime-T*(this.playbackSpeed>=0?1:-1),Z=this.playbackSpeed>=0?X<0:X>l;this.currentTime=Math.max(X,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=l);let $=this.currentTime,le=c;if(I){const pe=Math.min(this.currentTime,l)/E;let Ee=Math.floor(pe),Ne=pe%1;!Ne&&pe>=1&&(Ne=1),Ne===1&&Ee--,Ee=Math.min(Ee,I+1),Ee%2&&(N==="reverse"?(Ne=1-Ne,P&&(Ne-=P/E)):N==="mirror"&&(le=m)),$=wh(0,1,Ne)*E}const re=Z?{done:!1,value:C[0]}:le.next($);h&&(re.value=h(re.value));let{done:ce}=re;!Z&&S!==null&&(ce=this.playbackSpeed>=0?this.currentTime>=l:this.currentTime<=0);const te=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&ce);return te&&H!==uM&&(re.value=mU(C,this.options,B,this.speed)),x&&x(re.value),te&&this.finish(),re}then(r,a){return this.finished.then(r,a)}get duration(){return il(this.calculatedDuration)}get iterationDuration(){const{delay:r=0}=this.options||{};return this.duration+il(r)}get time(){return il(this.currentTime)}set time(r){r=vd(r),this.currentTime=r,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=r:this.driver&&(this.startTime=this.driver.now()-r/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(r){this.updateTime(Oo.now());const a=this.playbackSpeed!==r;this.playbackSpeed=r,a&&(this.time=il(this.currentTime))}play(){if(this.isStopped)return;const{driver:r=jbe,startTime:a}=this.options;this.driver||(this.driver=r(l=>this.tick(l))),this.options.onPlay?.();const c=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=c):this.holdTime!==null?this.startTime=c-this.holdTime:this.startTime||(this.startTime=a??c),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Oo.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(r){return this.startTime=0,this.tick(r,!0)}attachTimeline(r){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),r.observe(this)}}function iIe(i){for(let r=1;r<i.length;r++)i[r]??(i[r]=i[r-1])}const Tg=i=>i*180/Math.PI,dM=i=>{const r=Tg(Math.atan2(i[1],i[0]));return hM(r)},sIe={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:i=>(Math.abs(i[0])+Math.abs(i[3]))/2,rotate:dM,rotateZ:dM,skewX:i=>Tg(Math.atan(i[1])),skewY:i=>Tg(Math.atan(i[2])),skew:i=>(Math.abs(i[1])+Math.abs(i[2]))/2},hM=i=>(i=i%360,i<0&&(i+=360),i),K9=dM,Y9=i=>Math.sqrt(i[0]*i[0]+i[1]*i[1]),q9=i=>Math.sqrt(i[4]*i[4]+i[5]*i[5]),aIe={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:Y9,scaleY:q9,scale:i=>(Y9(i)+q9(i))/2,rotateX:i=>hM(Tg(Math.atan2(i[6],i[5]))),rotateY:i=>hM(Tg(Math.atan2(-i[2],i[0]))),rotateZ:K9,rotate:K9,skewX:i=>Tg(Math.atan(i[4])),skewY:i=>Tg(Math.atan(i[1])),skew:i=>(Math.abs(i[1])+Math.abs(i[4]))/2};function pM(i){return i.includes("scale")?1:0}function fM(i,r){if(!i||i==="none")return pM(r);const a=i.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let c,l;if(a)c=aIe,l=a;else{const E=i.match(/^matrix\(([-\d.e\s,]+)\)$/u);c=sIe,l=E}if(!l)return pM(r);const h=c[r],m=l[1].split(",").map(cIe);return typeof h=="function"?h(m):m[h]}const oIe=(i,r)=>{const{transform:a="none"}=getComputedStyle(i);return fM(a,r)};function cIe(i){return parseFloat(i.trim())}const pv=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],fv=new Set(pv),X9=i=>i===hv||i===vn,lIe=new Set(["x","y","z"]),uIe=pv.filter(i=>!lIe.has(i));function dIe(i){const r=[];return uIe.forEach(a=>{const c=i.getValue(a);c!==void 0&&(r.push([a,c.get()]),c.set(a.startsWith("scale")?1:0))}),r}const Cg={width:({x:i},{paddingLeft:r="0",paddingRight:a="0"})=>i.max-i.min-parseFloat(r)-parseFloat(a),height:({y:i},{paddingTop:r="0",paddingBottom:a="0"})=>i.max-i.min-parseFloat(r)-parseFloat(a),top:(i,{top:r})=>parseFloat(r),left:(i,{left:r})=>parseFloat(r),bottom:({y:i},{top:r})=>parseFloat(r)+(i.max-i.min),right:({x:i},{left:r})=>parseFloat(r)+(i.max-i.min),x:(i,{transform:r})=>fM(r,"x"),y:(i,{transform:r})=>fM(r,"y")};Cg.translateX=Cg.x;Cg.translateY=Cg.y;const Rg=new Set;let mM=!1,gM=!1,_M=!1;function EQ(){if(gM){const i=Array.from(Rg).filter(c=>c.needsMeasurement),r=new Set(i.map(c=>c.element)),a=new Map;r.forEach(c=>{const l=dIe(c);l.length&&(a.set(c,l),c.render())}),i.forEach(c=>c.measureInitialState()),r.forEach(c=>{c.render();const l=a.get(c);l&&l.forEach(([h,m])=>{c.getValue(h)?.set(m)})}),i.forEach(c=>c.measureEndState()),i.forEach(c=>{c.suspendedScrollY!==void 0&&window.scrollTo(0,c.suspendedScrollY)})}gM=!1,mM=!1,Rg.forEach(i=>i.complete(_M)),Rg.clear()}function yQ(){Rg.forEach(i=>{i.readKeyframes(),i.needsMeasurement&&(gM=!0)})}function hIe(){_M=!0,yQ(),EQ(),_M=!1}class EU{constructor(r,a,c,l,h,m=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...r],this.onComplete=a,this.name=c,this.motionValue=l,this.element=h,this.isAsync=m}scheduleResolve(){this.state="scheduled",this.isAsync?(Rg.add(this),mM||(mM=!0,Fi.read(yQ),Fi.resolveKeyframes(EQ))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:r,name:a,element:c,motionValue:l}=this;if(r[0]===null){const h=l?.get(),m=r[r.length-1];if(h!==void 0)r[0]=h;else if(c&&a){const E=c.readValue(a,m);E!=null&&(r[0]=E)}r[0]===void 0&&(r[0]=m),l&&h===void 0&&l.set(r[0])}iIe(r)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(r=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,r),Rg.delete(this)}cancel(){this.state==="scheduled"&&(Rg.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const pIe=i=>i.startsWith("--");function fIe(i,r,a){pIe(r)?i.style.setProperty(r,a):i.style[r]=a}const mIe=aU(()=>window.ScrollTimeline!==void 0),gIe={};function _Ie(i,r){const a=aU(i);return()=>gIe[r]??a()}const vQ=_Ie(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),D0=([i,r,a,c])=>`cubic-bezier(${i}, ${r}, ${a}, ${c})`,J9={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:D0([0,.65,.55,1]),circOut:D0([.55,0,1,.45]),backIn:D0([.31,.01,.66,-.59]),backOut:D0([.33,1.53,.69,.99])};function SQ(i,r){if(i)return typeof i=="function"?vQ()?mQ(i,r):"ease-out":iQ(i)?D0(i):Array.isArray(i)?i.map(a=>SQ(a,r)||J9.easeOut):J9[i]}function EIe(i,r,a,{delay:c=0,duration:l=300,repeat:h=0,repeatType:m="loop",ease:E="easeOut",times:S}={},T=void 0){const C={[r]:a};S&&(C.offset=S);const I=SQ(E,l);Array.isArray(I)&&(C.easing=I);const N={delay:c,duration:l,easing:Array.isArray(I)?"linear":I,fill:"both",iterations:h+1,direction:m==="reverse"?"alternate":"normal"};return T&&(N.pseudoElement=T),i.animate(C,N)}function TQ(i){return typeof i=="function"&&"applyToOptions"in i}function yIe({type:i,...r}){return TQ(i)&&vQ()?i.applyToOptions(r):(r.duration??(r.duration=300),r.ease??(r.ease="easeOut"),r)}class vIe extends gU{constructor(r){if(super(),this.finishedTime=null,this.isStopped=!1,!r)return;const{element:a,name:c,keyframes:l,pseudoElement:h,allowFlatten:m=!1,finalKeyframe:E,onComplete:S}=r;this.isPseudoElement=!!h,this.allowFlatten=m,this.options=r,sU(typeof r.type!="string");const T=yIe(r);this.animation=EIe(a,c,l,T,h),T.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!h){const C=mU(l,this.options,E,this.speed);this.updateMotionValue?this.updateMotionValue(C):fIe(a,c,C),this.animation.cancel()}S?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:r}=this;r==="idle"||r==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const r=this.animation.effect?.getComputedTiming?.().duration||0;return il(Number(r))}get iterationDuration(){const{delay:r=0}=this.options||{};return this.duration+il(r)}get time(){return il(Number(this.animation.currentTime)||0)}set time(r){this.finishedTime=null,this.animation.currentTime=vd(r)}get speed(){return this.animation.playbackRate}set speed(r){r<0&&(this.finishedTime=null),this.animation.playbackRate=r}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(r){this.animation.startTime=r}attachTimeline({timeline:r,observe:a}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,r&&mIe()?(this.animation.timeline=r,ol):a(this)}}const wQ={anticipate:eQ,backInOut:Z$,circInOut:nQ};function SIe(i){return i in wQ}function TIe(i){typeof i.ease=="string"&&SIe(i.ease)&&(i.ease=wQ[i.ease])}const $9=10;class wIe extends vIe{constructor(r){TIe(r),_Q(r),super(r),r.startTime&&(this.startTime=r.startTime),this.options=r}updateMotionValue(r){const{motionValue:a,onUpdate:c,onComplete:l,element:h,...m}=this.options;if(!a)return;if(r!==void 0){a.set(r);return}const E=new _U({...m,autoplay:!1}),S=vd(this.finishedTime??this.time);a.setWithVelocity(E.sample(S-$9).value,E.sample(S).value,$9),E.stop()}}const Q9=(i,r)=>r==="zIndex"?!1:!!(typeof i=="number"||Array.isArray(i)||typeof i=="string"&&(lf.test(i)||i==="0")&&!i.startsWith("url("));function CIe(i){const r=i[0];if(i.length===1)return!0;for(let a=0;a<i.length;a++)if(i[a]!==r)return!0}function RIe(i,r,a,c){const l=i[0];if(l===null)return!1;if(r==="display"||r==="visibility")return!0;const h=i[i.length-1],m=Q9(l,r),E=Q9(h,r);return!m||!E?!1:CIe(i)||(a==="spring"||TQ(a))&&c}function EM(i){i.duration=0,i.type="keyframes"}const bIe=new Set(["opacity","clipPath","filter","transform"]),IIe=aU(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function AIe(i){const{motionValue:r,name:a,repeatDelay:c,repeatType:l,damping:h,type:m}=i;if(!(r?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:S,transformTemplate:T}=r.owner.getProps();return IIe()&&a&&bIe.has(a)&&(a!=="transform"||!T)&&!S&&!c&&l!=="mirror"&&h!==0&&m!=="inertia"}const OIe=40;class NIe extends gU{constructor({autoplay:r=!0,delay:a=0,type:c="keyframes",repeat:l=0,repeatDelay:h=0,repeatType:m="loop",keyframes:E,name:S,motionValue:T,element:C,...I}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Oo.now();const N={autoplay:r,delay:a,type:c,repeat:l,repeatDelay:h,repeatType:m,name:S,motionValue:T,element:C,...I},P=C?.KeyframeResolver||EU;this.keyframeResolver=new P(E,(H,x,B)=>this.onKeyframesResolved(H,x,N,!B),S,T,C),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(r,a,c,l){this.keyframeResolver=void 0;const{name:h,type:m,velocity:E,delay:S,isHandoff:T,onUpdate:C}=c;this.resolvedAt=Oo.now(),RIe(r,h,m,E)||((Ch.instantAnimations||!S)&&C?.(mU(r,c,a)),r[0]=r[r.length-1],EM(c),c.repeat=0);const N={startTime:l?this.resolvedAt?this.resolvedAt-this.createdAt>OIe?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:a,...c,keyframes:r},P=!T&&AIe(N)?new wIe({...N,element:N.motionValue.owner.current}):new _U(N);P.finished.then(()=>this.notifyFinished()).catch(ol),this.pendingTimeline&&(this.stopTimeline=P.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=P}get finished(){return this._animation?this.animation.finished:this._finished}then(r,a){return this.finished.finally(r).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),hIe()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(r){this.animation.time=r}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(r){this.animation.speed=r}get startTime(){return this.animation.startTime}attachTimeline(r){return this._animation?this.stopTimeline=this.animation.attachTimeline(r):this.pendingTimeline=r,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const PIe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function kIe(i){const r=PIe.exec(i);if(!r)return[,];const[,a,c,l]=r;return[`--${a??c}`,l]}function CQ(i,r,a=1){const[c,l]=kIe(i);if(!c)return;const h=window.getComputedStyle(r).getPropertyValue(c);if(h){const m=h.trim();return z$(m)?parseFloat(m):m}return uU(l)?CQ(l,r,a+1):l}function yU(i,r){return i?.[r]??i?.default??i}const RQ=new Set(["width","height","top","left","right","bottom",...pv]),DIe={test:i=>i==="auto",parse:i=>i},bQ=i=>r=>r.test(i),IQ=[hv,vn,Sd,Gp,Cbe,wbe,DIe],Z9=i=>IQ.find(bQ(i));function xIe(i){return typeof i=="number"?i===0:i!==null?i==="none"||i==="0"||Y$(i):!0}const LIe=new Set(["brightness","contrast","saturate","opacity"]);function MIe(i){const[r,a]=i.slice(0,-1).split("(");if(r==="drop-shadow")return i;const[c]=a.match(dU)||[];if(!c)return i;const l=a.replace(c,"");let h=LIe.has(r)?1:0;return c!==a&&(h*=100),r+"("+h+l+")"}const UIe=/\b([a-z-]*)\(.*?\)/gu,yM={...lf,getAnimatableNone:i=>{const r=i.match(UIe);return r?r.map(MIe).join(" "):i}},e7={...hv,transform:Math.round},VIe={rotate:Gp,rotateX:Gp,rotateY:Gp,rotateZ:Gp,scale:$I,scaleX:$I,scaleY:$I,scaleZ:$I,skew:Gp,skewX:Gp,skewY:Gp,distance:vn,translateX:vn,translateY:vn,translateZ:vn,x:vn,y:vn,z:vn,perspective:vn,transformPerspective:vn,opacity:fw,originX:B9,originY:B9,originZ:vn},vU={borderWidth:vn,borderTopWidth:vn,borderRightWidth:vn,borderBottomWidth:vn,borderLeftWidth:vn,borderRadius:vn,radius:vn,borderTopLeftRadius:vn,borderTopRightRadius:vn,borderBottomRightRadius:vn,borderBottomLeftRadius:vn,width:vn,maxWidth:vn,height:vn,maxHeight:vn,top:vn,right:vn,bottom:vn,left:vn,padding:vn,paddingTop:vn,paddingRight:vn,paddingBottom:vn,paddingLeft:vn,margin:vn,marginTop:vn,marginRight:vn,marginBottom:vn,marginLeft:vn,backgroundPositionX:vn,backgroundPositionY:vn,...VIe,zIndex:e7,fillOpacity:fw,strokeOpacity:fw,numOctaves:e7},FIe={...vU,color:Ts,backgroundColor:Ts,outlineColor:Ts,fill:Ts,stroke:Ts,borderColor:Ts,borderTopColor:Ts,borderRightColor:Ts,borderBottomColor:Ts,borderLeftColor:Ts,filter:yM,WebkitFilter:yM},AQ=i=>FIe[i];function OQ(i,r){let a=AQ(i);return a!==yM&&(a=lf),a.getAnimatableNone?a.getAnimatableNone(r):void 0}const jIe=new Set(["auto","none","0"]);function BIe(i,r,a){let c=0,l;for(;c<i.length&&!l;){const h=i[c];typeof h=="string"&&!jIe.has(h)&&mw(h).values.length&&(l=i[c]),c++}if(l&&a)for(const h of r)i[h]=OQ(a,l)}class WIe extends EU{constructor(r,a,c,l,h){super(r,a,c,l,h,!0)}readKeyframes(){const{unresolvedKeyframes:r,element:a,name:c}=this;if(!a||!a.current)return;super.readKeyframes();for(let S=0;S<r.length;S++){let T=r[S];if(typeof T=="string"&&(T=T.trim(),uU(T))){const C=CQ(T,a.current);C!==void 0&&(r[S]=C),S===r.length-1&&(this.finalKeyframe=T)}}if(this.resolveNoneKeyframes(),!RQ.has(c)||r.length!==2)return;const[l,h]=r,m=Z9(l),E=Z9(h);if(m!==E)if(X9(m)&&X9(E))for(let S=0;S<r.length;S++){const T=r[S];typeof T=="string"&&(r[S]=parseFloat(T))}else Cg[c]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:r,name:a}=this,c=[];for(let l=0;l<r.length;l++)(r[l]===null||xIe(r[l]))&&c.push(l);c.length&&BIe(r,c,a)}measureInitialState(){const{element:r,unresolvedKeyframes:a,name:c}=this;if(!r||!r.current)return;c==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Cg[c](r.measureViewportBox(),window.getComputedStyle(r.current)),a[0]=this.measuredOrigin;const l=a[a.length-1];l!==void 0&&r.getValue(c,l).jump(l,!1)}measureEndState(){const{element:r,name:a,unresolvedKeyframes:c}=this;if(!r||!r.current)return;const l=r.getValue(a);l&&l.jump(this.measuredOrigin,!1);const h=c.length-1,m=c[h];c[h]=Cg[a](r.measureViewportBox(),window.getComputedStyle(r.current)),m!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=m),this.removedTransforms?.length&&this.removedTransforms.forEach(([E,S])=>{r.getValue(E).set(S)}),this.resolveNoneKeyframes()}}function GIe(i,r,a){if(i instanceof EventTarget)return[i];if(typeof i=="string"){let c=document;const l=a?.[i]??c.querySelectorAll(i);return l?Array.from(l):[]}return Array.from(i)}const NQ=(i,r)=>r&&typeof i=="number"?r.transform(i):i;function PQ(i){return K$(i)&&"offsetHeight"in i}const t7=30,HIe=i=>!isNaN(parseFloat(i));class zIe{constructor(r,a={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=c=>{const l=Oo.now();if(this.updatedAt!==l&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(c),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const h of this.dependents)h.dirty()},this.hasAnimated=!1,this.setCurrent(r),this.owner=a.owner}setCurrent(r){this.current=r,this.updatedAt=Oo.now(),this.canTrackVelocity===null&&r!==void 0&&(this.canTrackVelocity=HIe(this.current))}setPrevFrameValue(r=this.current){this.prevFrameValue=r,this.prevUpdatedAt=this.updatedAt}onChange(r){return this.on("change",r)}on(r,a){this.events[r]||(this.events[r]=new oU);const c=this.events[r].add(a);return r==="change"?()=>{c(),Fi.read(()=>{this.events.change.getSize()||this.stop()})}:c}clearListeners(){for(const r in this.events)this.events[r].clear()}attach(r,a){this.passiveEffect=r,this.stopPassiveEffect=a}set(r){this.passiveEffect?this.passiveEffect(r,this.updateAndNotify):this.updateAndNotify(r)}setWithVelocity(r,a,c){this.set(a),this.prev=void 0,this.prevFrameValue=r,this.prevUpdatedAt=this.updatedAt-c}jump(r,a=!0){this.updateAndNotify(r),this.prev=r,this.prevUpdatedAt=this.prevFrameValue=void 0,a&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(r){this.dependents||(this.dependents=new Set),this.dependents.add(r)}removeDependent(r){this.dependents&&this.dependents.delete(r)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const r=Oo.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||r-this.updatedAt>t7)return 0;const a=Math.min(this.updatedAt-this.prevUpdatedAt,t7);return q$(parseFloat(this.current)-parseFloat(this.prevFrameValue),a)}start(r){return this.stop(),new Promise(a=>{this.hasAnimated=!0,this.animation=r(a),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Ky(i,r){return new zIe(i,r)}const{schedule:SU}=sQ(queueMicrotask,!1),su={x:!1,y:!1};function kQ(){return su.x||su.y}function KIe(i){return i==="x"||i==="y"?su[i]?null:(su[i]=!0,()=>{su[i]=!1}):su.x||su.y?null:(su.x=su.y=!0,()=>{su.x=su.y=!1})}function DQ(i,r){const a=GIe(i),c=new AbortController,l={passive:!0,...r,signal:c.signal};return[a,l,()=>c.abort()]}function n7(i){return!(i.pointerType==="touch"||kQ())}function YIe(i,r,a={}){const[c,l,h]=DQ(i,a),m=E=>{if(!n7(E))return;const{target:S}=E,T=r(S,E);if(typeof T!="function"||!S)return;const C=I=>{n7(I)&&(T(I),S.removeEventListener("pointerleave",C))};S.addEventListener("pointerleave",C,l)};return c.forEach(E=>{E.addEventListener("pointerenter",m,l)}),h}const xQ=(i,r)=>r?i===r?!0:xQ(i,r.parentElement):!1,TU=i=>i.pointerType==="mouse"?typeof i.button!="number"||i.button<=0:i.isPrimary!==!1,qIe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function XIe(i){return qIe.has(i.tagName)||i.tabIndex!==-1}const EA=new WeakSet;function r7(i){return r=>{r.key==="Enter"&&i(r)}}function Jx(i,r){i.dispatchEvent(new PointerEvent("pointer"+r,{isPrimary:!0,bubbles:!0}))}const JIe=(i,r)=>{const a=i.currentTarget;if(!a)return;const c=r7(()=>{if(EA.has(a))return;Jx(a,"down");const l=r7(()=>{Jx(a,"up")}),h=()=>Jx(a,"cancel");a.addEventListener("keyup",l,r),a.addEventListener("blur",h,r)});a.addEventListener("keydown",c,r),a.addEventListener("blur",()=>a.removeEventListener("keydown",c),r)};function i7(i){return TU(i)&&!kQ()}function $Ie(i,r,a={}){const[c,l,h]=DQ(i,a),m=E=>{const S=E.currentTarget;if(!i7(E))return;EA.add(S);const T=r(S,E),C=(P,H)=>{window.removeEventListener("pointerup",I),window.removeEventListener("pointercancel",N),EA.has(S)&&EA.delete(S),i7(P)&&typeof T=="function"&&T(P,{success:H})},I=P=>{C(P,S===window||S===document||a.useGlobalTarget||xQ(S,P.target))},N=P=>{C(P,!1)};window.addEventListener("pointerup",I,l),window.addEventListener("pointercancel",N,l)};return c.forEach(E=>{(a.useGlobalTarget?window:E).addEventListener("pointerdown",m,l),PQ(E)&&(E.addEventListener("focus",T=>JIe(T,l)),!XIe(E)&&!E.hasAttribute("tabindex")&&(E.tabIndex=0))}),h}function LQ(i){return K$(i)&&"ownerSVGElement"in i}function QIe(i){return LQ(i)&&i.tagName==="svg"}const Da=i=>!!(i&&i.getVelocity),ZIe=[...IQ,Ts,lf],eAe=i=>ZIe.find(bQ(i)),wU=G.createContext({transformPagePoint:i=>i,isStatic:!1,reducedMotion:"never"});function s7(i,r){if(typeof i=="function")return i(r);i!=null&&(i.current=r)}function tAe(...i){return r=>{let a=!1;const c=i.map(l=>{const h=s7(l,r);return!a&&typeof h=="function"&&(a=!0),h});if(a)return()=>{for(let l=0;l<c.length;l++){const h=c[l];typeof h=="function"?h():s7(i[l],null)}}}}function nAe(...i){return G.useCallback(tAe(...i),i)}class rAe extends G.Component{getSnapshotBeforeUpdate(r){const a=this.props.childRef.current;if(a&&r.isPresent&&!this.props.isPresent){const c=a.offsetParent,l=PQ(c)&&c.offsetWidth||0,h=this.props.sizeRef.current;h.height=a.offsetHeight||0,h.width=a.offsetWidth||0,h.top=a.offsetTop,h.left=a.offsetLeft,h.right=l-h.width-h.left}return null}componentDidUpdate(){}render(){return this.props.children}}function iAe({children:i,isPresent:r,anchorX:a,root:c}){const l=G.useId(),h=G.useRef(null),m=G.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:E}=G.useContext(wU),S=nAe(h,i?.ref);return G.useInsertionEffect(()=>{const{width:T,height:C,top:I,left:N,right:P}=m.current;if(r||!h.current||!T||!C)return;const H=a==="left"?`left: ${N}`:`right: ${P}`;h.current.dataset.motionPopId=l;const x=document.createElement("style");E&&(x.nonce=E);const B=c??document.head;return B.appendChild(x),x.sheet&&x.sheet.insertRule(`
          [data-motion-pop-id="${l}"] {
            position: absolute !important;
            width: ${T}px !important;
            height: ${C}px !important;
            ${H}px !important;
            top: ${I}px !important;
          }
        `),()=>{B.contains(x)&&B.removeChild(x)}},[r]),D.jsx(rAe,{isPresent:r,childRef:h,sizeRef:m,children:G.cloneElement(i,{ref:S})})}const sAe=({children:i,initial:r,isPresent:a,onExitComplete:c,custom:l,presenceAffectsLayout:h,mode:m,anchorX:E,root:S})=>{const T=tU(aAe),C=G.useId();let I=!0,N=G.useMemo(()=>(I=!1,{id:C,initial:r,isPresent:a,custom:l,onExitComplete:P=>{T.set(P,!0);for(const H of T.values())if(!H)return;c&&c()},register:P=>(T.set(P,!1),()=>T.delete(P))}),[a,T,c]);return h&&I&&(N={...N}),G.useMemo(()=>{T.forEach((P,H)=>T.set(H,!1))},[a]),G.useEffect(()=>{!a&&!T.size&&c&&c()},[a]),m==="popLayout"&&(i=D.jsx(iAe,{isPresent:a,anchorX:E,root:S,children:i})),D.jsx(VO.Provider,{value:N,children:i})};function aAe(){return new Map}function MQ(i=!0){const r=G.useContext(VO);if(r===null)return[!0,null];const{isPresent:a,onExitComplete:c,register:l}=r,h=G.useId();G.useEffect(()=>{if(i)return l(h)},[i]);const m=G.useCallback(()=>i&&c&&c(h),[h,c,i]);return!a&&c?[!1,m]:[!0]}const QI=i=>i.key||"";function a7(i){const r=[];return G.Children.forEach(i,a=>{G.isValidElement(a)&&r.push(a)}),r}const UQ=({children:i,custom:r,initial:a=!0,onExitComplete:c,presenceAffectsLayout:l=!0,mode:h="sync",propagate:m=!1,anchorX:E="left",root:S})=>{const[T,C]=MQ(m),I=G.useMemo(()=>a7(i),[i]),N=m&&!T?[]:I.map(QI),P=G.useRef(!0),H=G.useRef(I),x=tU(()=>new Map),[B,X]=G.useState(I),[Z,$]=G.useState(I);H$(()=>{P.current=!1,H.current=I;for(let ce=0;ce<Z.length;ce++){const te=QI(Z[ce]);N.includes(te)?x.delete(te):x.get(te)!==!0&&x.set(te,!1)}},[Z,N.length,N.join("-")]);const le=[];if(I!==B){let ce=[...I];for(let te=0;te<Z.length;te++){const pe=Z[te],Ee=QI(pe);N.includes(Ee)||(ce.splice(te,0,pe),le.push(pe))}return h==="wait"&&le.length&&(ce=le),$(a7(ce)),X(I),null}const{forceRender:re}=G.useContext(eU);return D.jsx(D.Fragment,{children:Z.map(ce=>{const te=QI(ce),pe=m&&!T?!1:I===Z||N.includes(te),Ee=()=>{if(x.has(te))x.set(te,!0);else return;let Ne=!0;x.forEach(Ue=>{Ue||(Ne=!1)}),Ne&&(re?.(),$(H.current),m&&C?.(),c&&c())};return D.jsx(sAe,{isPresent:pe,initial:!P.current||a?void 0:!1,custom:r,presenceAffectsLayout:l,mode:h,root:S,onExitComplete:pe?void 0:Ee,anchorX:E,children:ce},te)})})},VQ=G.createContext({strict:!1}),o7={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Yy={};for(const i in o7)Yy[i]={isEnabled:r=>o7[i].some(a=>!!r[a])};function oAe(i){for(const r in i)Yy[r]={...Yy[r],...i[r]}}const cAe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function $A(i){return i.startsWith("while")||i.startsWith("drag")&&i!=="draggable"||i.startsWith("layout")||i.startsWith("onTap")||i.startsWith("onPan")||i.startsWith("onLayout")||cAe.has(i)}let FQ=i=>!$A(i);function lAe(i){typeof i=="function"&&(FQ=r=>r.startsWith("on")?!$A(r):i(r))}try{lAe(require("@emotion/is-prop-valid").default)}catch{}function uAe(i,r,a){const c={};for(const l in i)l==="values"&&typeof i.values=="object"||(FQ(l)||a===!0&&$A(l)||!r&&!$A(l)||i.draggable&&l.startsWith("onDrag"))&&(c[l]=i[l]);return c}const FO=G.createContext({});function jO(i){return i!==null&&typeof i=="object"&&typeof i.start=="function"}function gw(i){return typeof i=="string"||Array.isArray(i)}const CU=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],RU=["initial",...CU];function BO(i){return jO(i.animate)||RU.some(r=>gw(i[r]))}function jQ(i){return!!(BO(i)||i.variants)}function dAe(i,r){if(BO(i)){const{initial:a,animate:c}=i;return{initial:a===!1||gw(a)?a:void 0,animate:gw(c)?c:void 0}}return i.inherit!==!1?r:{}}function hAe(i){const{initial:r,animate:a}=dAe(i,G.useContext(FO));return G.useMemo(()=>({initial:r,animate:a}),[c7(r),c7(a)])}function c7(i){return Array.isArray(i)?i.join(" "):i}function l7(i,r){return r.max===r.min?0:i/(r.max-r.min)*100}const w0={correct:(i,r)=>{if(!r.target)return i;if(typeof i=="string")if(vn.test(i))i=parseFloat(i);else return i;const a=l7(i,r.target.x),c=l7(i,r.target.y);return`${a}% ${c}%`}},pAe={correct:(i,{treeScale:r,projectionDelta:a})=>{const c=i,l=lf.parse(i);if(l.length>5)return c;const h=lf.createTransformer(i),m=typeof l[0]!="number"?1:0,E=a.x.scale*r.x,S=a.y.scale*r.y;l[0+m]/=E,l[1+m]/=S;const T=Xi(E,S,.5);return typeof l[2+m]=="number"&&(l[2+m]/=T),typeof l[3+m]=="number"&&(l[3+m]/=T),h(l)}},vM={borderRadius:{...w0,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:w0,borderTopRightRadius:w0,borderBottomLeftRadius:w0,borderBottomRightRadius:w0,boxShadow:pAe};function BQ(i,{layout:r,layoutId:a}){return fv.has(i)||i.startsWith("origin")||(r||a!==void 0)&&(!!vM[i]||i==="opacity")}const fAe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},mAe=pv.length;function gAe(i,r,a){let c="",l=!0;for(let h=0;h<mAe;h++){const m=pv[h],E=i[m];if(E===void 0)continue;let S=!0;if(typeof E=="number"?S=E===(m.startsWith("scale")?1:0):S=parseFloat(E)===0,!S||a){const T=NQ(E,vU[m]);if(!S){l=!1;const C=fAe[m]||m;c+=`${C}(${T}) `}a&&(r[m]=T)}}return c=c.trim(),a?c=a(r,l?"":c):l&&(c="none"),c}function bU(i,r,a){const{style:c,vars:l,transformOrigin:h}=i;let m=!1,E=!1;for(const S in r){const T=r[S];if(fv.has(S)){m=!0;continue}else if(oQ(S)){l[S]=T;continue}else{const C=NQ(T,vU[S]);S.startsWith("origin")?(E=!0,h[S]=C):c[S]=C}}if(r.transform||(m||a?c.transform=gAe(r,i.transform,a):c.transform&&(c.transform="none")),E){const{originX:S="50%",originY:T="50%",originZ:C=0}=h;c.transformOrigin=`${S} ${T} ${C}`}}const IU=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function WQ(i,r,a){for(const c in r)!Da(r[c])&&!BQ(c,a)&&(i[c]=r[c])}function _Ae({transformTemplate:i},r){return G.useMemo(()=>{const a=IU();return bU(a,r,i),Object.assign({},a.vars,a.style)},[r])}function EAe(i,r){const a=i.style||{},c={};return WQ(c,a,i),Object.assign(c,_Ae(i,r)),c}function yAe(i,r){const a={},c=EAe(i,r);return i.drag&&i.dragListener!==!1&&(a.draggable=!1,c.userSelect=c.WebkitUserSelect=c.WebkitTouchCallout="none",c.touchAction=i.drag===!0?"none":`pan-${i.drag==="x"?"y":"x"}`),i.tabIndex===void 0&&(i.onTap||i.onTapStart||i.whileTap)&&(a.tabIndex=0),a.style=c,a}const vAe={offset:"stroke-dashoffset",array:"stroke-dasharray"},SAe={offset:"strokeDashoffset",array:"strokeDasharray"};function TAe(i,r,a=1,c=0,l=!0){i.pathLength=1;const h=l?vAe:SAe;i[h.offset]=vn.transform(-c);const m=vn.transform(r),E=vn.transform(a);i[h.array]=`${m} ${E}`}function GQ(i,{attrX:r,attrY:a,attrScale:c,pathLength:l,pathSpacing:h=1,pathOffset:m=0,...E},S,T,C){if(bU(i,E,T),S){i.style.viewBox&&(i.attrs.viewBox=i.style.viewBox);return}i.attrs=i.style,i.style={};const{attrs:I,style:N}=i;I.transform&&(N.transform=I.transform,delete I.transform),(N.transform||I.transformOrigin)&&(N.transformOrigin=I.transformOrigin??"50% 50%",delete I.transformOrigin),N.transform&&(N.transformBox=C?.transformBox??"fill-box",delete I.transformBox),r!==void 0&&(I.x=r),a!==void 0&&(I.y=a),c!==void 0&&(I.scale=c),l!==void 0&&TAe(I,l,h,m,!1)}const HQ=()=>({...IU(),attrs:{}}),zQ=i=>typeof i=="string"&&i.toLowerCase()==="svg";function wAe(i,r,a,c){const l=G.useMemo(()=>{const h=HQ();return GQ(h,r,zQ(c),i.transformTemplate,i.style),{...h.attrs,style:{...h.style}}},[r]);if(i.style){const h={};WQ(h,i.style,i),l.style={...h,...l.style}}return l}const CAe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function AU(i){return typeof i!="string"||i.includes("-")?!1:!!(CAe.indexOf(i)>-1||/[A-Z]/u.test(i))}function RAe(i,r,a,{latestValues:c},l,h=!1){const E=(AU(i)?wAe:yAe)(r,c,l,i),S=uAe(r,typeof i=="string",h),T=i!==G.Fragment?{...S,...E,ref:a}:{},{children:C}=r,I=G.useMemo(()=>Da(C)?C.get():C,[C]);return G.createElement(i,{...T,children:I})}function u7(i){const r=[{},{}];return i?.values.forEach((a,c)=>{r[0][c]=a.get(),r[1][c]=a.getVelocity()}),r}function OU(i,r,a,c){if(typeof r=="function"){const[l,h]=u7(c);r=r(a!==void 0?a:i.custom,l,h)}if(typeof r=="string"&&(r=i.variants&&i.variants[r]),typeof r=="function"){const[l,h]=u7(c);r=r(a!==void 0?a:i.custom,l,h)}return r}function yA(i){return Da(i)?i.get():i}function bAe({scrapeMotionValuesFromProps:i,createRenderState:r},a,c,l){return{latestValues:IAe(a,c,l,i),renderState:r()}}function IAe(i,r,a,c){const l={},h=c(i,{});for(const N in h)l[N]=yA(h[N]);let{initial:m,animate:E}=i;const S=BO(i),T=jQ(i);r&&T&&!S&&i.inherit!==!1&&(m===void 0&&(m=r.initial),E===void 0&&(E=r.animate));let C=a?a.initial===!1:!1;C=C||m===!1;const I=C?E:m;if(I&&typeof I!="boolean"&&!jO(I)){const N=Array.isArray(I)?I:[I];for(let P=0;P<N.length;P++){const H=OU(i,N[P]);if(H){const{transitionEnd:x,transition:B,...X}=H;for(const Z in X){let $=X[Z];if(Array.isArray($)){const le=C?$.length-1:0;$=$[le]}$!==null&&(l[Z]=$)}for(const Z in x)l[Z]=x[Z]}}}return l}const KQ=i=>(r,a)=>{const c=G.useContext(FO),l=G.useContext(VO),h=()=>bAe(i,r,c,l);return a?h():tU(h)};function NU(i,r,a){const{style:c}=i,l={};for(const h in c)(Da(c[h])||r.style&&Da(r.style[h])||BQ(h,i)||a?.getValue(h)?.liveStyle!==void 0)&&(l[h]=c[h]);return l}const AAe=KQ({scrapeMotionValuesFromProps:NU,createRenderState:IU});function YQ(i,r,a){const c=NU(i,r,a);for(const l in i)if(Da(i[l])||Da(r[l])){const h=pv.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;c[h]=i[l]}return c}const OAe=KQ({scrapeMotionValuesFromProps:YQ,createRenderState:HQ}),NAe=Symbol.for("motionComponentSymbol");function Ty(i){return i&&typeof i=="object"&&Object.prototype.hasOwnProperty.call(i,"current")}function PAe(i,r,a){return G.useCallback(c=>{c&&i.onMount&&i.onMount(c),r&&(c?r.mount(c):r.unmount()),a&&(typeof a=="function"?a(c):Ty(a)&&(a.current=c))},[r])}const PU=i=>i.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),kAe="framerAppearId",qQ="data-"+PU(kAe),XQ=G.createContext({});function DAe(i,r,a,c,l){const{visualElement:h}=G.useContext(FO),m=G.useContext(VQ),E=G.useContext(VO),S=G.useContext(wU).reducedMotion,T=G.useRef(null);c=c||m.renderer,!T.current&&c&&(T.current=c(i,{visualState:r,parent:h,props:a,presenceContext:E,blockInitialAnimation:E?E.initial===!1:!1,reducedMotionConfig:S}));const C=T.current,I=G.useContext(XQ);C&&!C.projection&&l&&(C.type==="html"||C.type==="svg")&&xAe(T.current,a,l,I);const N=G.useRef(!1);G.useInsertionEffect(()=>{C&&N.current&&C.update(a,E)});const P=a[qQ],H=G.useRef(!!P&&!window.MotionHandoffIsComplete?.(P)&&window.MotionHasOptimisedAnimation?.(P));return H$(()=>{C&&(N.current=!0,window.MotionIsMounted=!0,C.updateFeatures(),C.scheduleRenderMicrotask(),H.current&&C.animationState&&C.animationState.animateChanges())}),G.useEffect(()=>{C&&(!H.current&&C.animationState&&C.animationState.animateChanges(),H.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(P)}),H.current=!1),C.enteringChildren=void 0)}),C}function xAe(i,r,a,c){const{layoutId:l,layout:h,drag:m,dragConstraints:E,layoutScroll:S,layoutRoot:T,layoutCrossfade:C}=r;i.projection=new a(i.latestValues,r["data-framer-portal-id"]?void 0:JQ(i.parent)),i.projection.setOptions({layoutId:l,layout:h,alwaysMeasureLayout:!!m||E&&Ty(E),visualElement:i,animationType:typeof h=="string"?h:"both",initialPromotionConfig:c,crossfade:C,layoutScroll:S,layoutRoot:T})}function JQ(i){if(i)return i.options.allowProjection!==!1?i.projection:JQ(i.parent)}function $x(i,{forwardMotionProps:r=!1}={},a,c){a&&oAe(a);const l=AU(i)?OAe:AAe;function h(E,S){let T;const C={...G.useContext(wU),...E,layoutId:LAe(E)},{isStatic:I}=C,N=hAe(E),P=l(E,I);if(!I&&nU){MAe();const H=UAe(C);T=H.MeasureLayout,N.visualElement=DAe(i,P,C,c,H.ProjectionNode)}return D.jsxs(FO.Provider,{value:N,children:[T&&N.visualElement?D.jsx(T,{visualElement:N.visualElement,...C}):null,RAe(i,E,PAe(P,N.visualElement,S),P,I,r)]})}h.displayName=`motion.${typeof i=="string"?i:`create(${i.displayName??i.name??""})`}`;const m=G.forwardRef(h);return m[NAe]=i,m}function LAe({layoutId:i}){const r=G.useContext(eU).id;return r&&i!==void 0?r+"-"+i:i}function MAe(i,r){G.useContext(VQ).strict}function UAe(i){const{drag:r,layout:a}=Yy;if(!r&&!a)return{};const c={...r,...a};return{MeasureLayout:r?.isEnabled(i)||a?.isEnabled(i)?c.MeasureLayout:void 0,ProjectionNode:c.ProjectionNode}}function VAe(i,r){if(typeof Proxy>"u")return $x;const a=new Map,c=(h,m)=>$x(h,m,i,r),l=(h,m)=>c(h,m);return new Proxy(l,{get:(h,m)=>m==="create"?c:(a.has(m)||a.set(m,$x(m,void 0,i,r)),a.get(m))})}function $Q({top:i,left:r,right:a,bottom:c}){return{x:{min:r,max:a},y:{min:i,max:c}}}function FAe({x:i,y:r}){return{top:r.min,right:i.max,bottom:r.max,left:i.min}}function jAe(i,r){if(!r)return i;const a=r({x:i.left,y:i.top}),c=r({x:i.right,y:i.bottom});return{top:a.y,left:a.x,bottom:c.y,right:c.x}}function Qx(i){return i===void 0||i===1}function SM({scale:i,scaleX:r,scaleY:a}){return!Qx(i)||!Qx(r)||!Qx(a)}function pg(i){return SM(i)||QQ(i)||i.z||i.rotate||i.rotateX||i.rotateY||i.skewX||i.skewY}function QQ(i){return d7(i.x)||d7(i.y)}function d7(i){return i&&i!=="0%"}function QA(i,r,a){const c=i-a,l=r*c;return a+l}function h7(i,r,a,c,l){return l!==void 0&&(i=QA(i,l,c)),QA(i,a,c)+r}function TM(i,r=0,a=1,c,l){i.min=h7(i.min,r,a,c,l),i.max=h7(i.max,r,a,c,l)}function ZQ(i,{x:r,y:a}){TM(i.x,r.translate,r.scale,r.originPoint),TM(i.y,a.translate,a.scale,a.originPoint)}const p7=.999999999999,f7=1.0000000000001;function BAe(i,r,a,c=!1){const l=a.length;if(!l)return;r.x=r.y=1;let h,m;for(let E=0;E<l;E++){h=a[E],m=h.projectionDelta;const{visualElement:S}=h.options;S&&S.props.style&&S.props.style.display==="contents"||(c&&h.options.layoutScroll&&h.scroll&&h!==h.root&&Cy(i,{x:-h.scroll.offset.x,y:-h.scroll.offset.y}),m&&(r.x*=m.x.scale,r.y*=m.y.scale,ZQ(i,m)),c&&pg(h.latestValues)&&Cy(i,h.latestValues))}r.x<f7&&r.x>p7&&(r.x=1),r.y<f7&&r.y>p7&&(r.y=1)}function wy(i,r){i.min=i.min+r,i.max=i.max+r}function m7(i,r,a,c,l=.5){const h=Xi(i.min,i.max,l);TM(i,r,a,h,c)}function Cy(i,r){m7(i.x,r.x,r.scaleX,r.scale,r.originX),m7(i.y,r.y,r.scaleY,r.scale,r.originY)}function eZ(i,r){return $Q(jAe(i.getBoundingClientRect(),r))}function WAe(i,r,a){const c=eZ(i,a),{scroll:l}=r;return l&&(wy(c.x,l.offset.x),wy(c.y,l.offset.y)),c}const g7=()=>({translate:0,scale:1,origin:0,originPoint:0}),Ry=()=>({x:g7(),y:g7()}),_7=()=>({min:0,max:0}),xs=()=>({x:_7(),y:_7()}),wM={current:null},tZ={current:!1};function GAe(){if(tZ.current=!0,!!nU)if(window.matchMedia){const i=window.matchMedia("(prefers-reduced-motion)"),r=()=>wM.current=i.matches;i.addEventListener("change",r),r()}else wM.current=!1}const HAe=new WeakMap;function zAe(i,r,a){for(const c in r){const l=r[c],h=a[c];if(Da(l))i.addValue(c,l);else if(Da(h))i.addValue(c,Ky(l,{owner:i}));else if(h!==l)if(i.hasValue(c)){const m=i.getValue(c);m.liveStyle===!0?m.jump(l):m.hasAnimated||m.set(l)}else{const m=i.getStaticValue(c);i.addValue(c,Ky(m!==void 0?m:l,{owner:i}))}}for(const c in a)r[c]===void 0&&i.removeValue(c);return r}const E7=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class KAe{scrapeMotionValuesFromProps(r,a,c){return{}}constructor({parent:r,props:a,presenceContext:c,reducedMotionConfig:l,blockInitialAnimation:h,visualState:m},E={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=EU,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const N=Oo.now();this.renderScheduledAt<N&&(this.renderScheduledAt=N,Fi.render(this.render,!1,!0))};const{latestValues:S,renderState:T}=m;this.latestValues=S,this.baseTarget={...S},this.initialValues=a.initial?{...S}:{},this.renderState=T,this.parent=r,this.props=a,this.presenceContext=c,this.depth=r?r.depth+1:0,this.reducedMotionConfig=l,this.options=E,this.blockInitialAnimation=!!h,this.isControllingVariants=BO(a),this.isVariantNode=jQ(a),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(r&&r.current);const{willChange:C,...I}=this.scrapeMotionValuesFromProps(a,{},this);for(const N in I){const P=I[N];S[N]!==void 0&&Da(P)&&P.set(S[N])}}mount(r){this.current=r,HAe.set(r,this),this.projection&&!this.projection.instance&&this.projection.mount(r),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((a,c)=>this.bindToMotionValue(c,a)),tZ.current||GAe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:wM.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),cf(this.notifyUpdate),cf(this.render),this.valueSubscriptions.forEach(r=>r()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const r in this.events)this.events[r].clear();for(const r in this.features){const a=this.features[r];a&&(a.unmount(),a.isMounted=!1)}this.current=null}addChild(r){this.children.add(r),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(r)}removeChild(r){this.children.delete(r),this.enteringChildren&&this.enteringChildren.delete(r)}bindToMotionValue(r,a){this.valueSubscriptions.has(r)&&this.valueSubscriptions.get(r)();const c=fv.has(r);c&&this.onBindTransform&&this.onBindTransform();const l=a.on("change",m=>{this.latestValues[r]=m,this.props.onUpdate&&Fi.preRender(this.notifyUpdate),c&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let h;window.MotionCheckAppearSync&&(h=window.MotionCheckAppearSync(this,r,a)),this.valueSubscriptions.set(r,()=>{l(),h&&h(),a.owner&&a.stop()})}sortNodePosition(r){return!this.current||!this.sortInstanceNodePosition||this.type!==r.type?0:this.sortInstanceNodePosition(this.current,r.current)}updateFeatures(){let r="animation";for(r in Yy){const a=Yy[r];if(!a)continue;const{isEnabled:c,Feature:l}=a;if(!this.features[r]&&l&&c(this.props)&&(this.features[r]=new l(this)),this.features[r]){const h=this.features[r];h.isMounted?h.update():(h.mount(),h.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):xs()}getStaticValue(r){return this.latestValues[r]}setStaticValue(r,a){this.latestValues[r]=a}update(r,a){(r.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=r,this.prevPresenceContext=this.presenceContext,this.presenceContext=a;for(let c=0;c<E7.length;c++){const l=E7[c];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const h="on"+l,m=r[h];m&&(this.propEventSubscriptions[l]=this.on(l,m))}this.prevMotionValues=zAe(this,this.scrapeMotionValuesFromProps(r,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(r){return this.props.variants?this.props.variants[r]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(r){const a=this.getClosestVariantNode();if(a)return a.variantChildren&&a.variantChildren.add(r),()=>a.variantChildren.delete(r)}addValue(r,a){const c=this.values.get(r);a!==c&&(c&&this.removeValue(r),this.bindToMotionValue(r,a),this.values.set(r,a),this.latestValues[r]=a.get())}removeValue(r){this.values.delete(r);const a=this.valueSubscriptions.get(r);a&&(a(),this.valueSubscriptions.delete(r)),delete this.latestValues[r],this.removeValueFromRenderState(r,this.renderState)}hasValue(r){return this.values.has(r)}getValue(r,a){if(this.props.values&&this.props.values[r])return this.props.values[r];let c=this.values.get(r);return c===void 0&&a!==void 0&&(c=Ky(a===null?void 0:a,{owner:this}),this.addValue(r,c)),c}readValue(r,a){let c=this.latestValues[r]!==void 0||!this.current?this.latestValues[r]:this.getBaseTargetFromProps(this.props,r)??this.readValueFromInstance(this.current,r,this.options);return c!=null&&(typeof c=="string"&&(z$(c)||Y$(c))?c=parseFloat(c):!eAe(c)&&lf.test(a)&&(c=OQ(r,a)),this.setBaseTarget(r,Da(c)?c.get():c)),Da(c)?c.get():c}setBaseTarget(r,a){this.baseTarget[r]=a}getBaseTarget(r){const{initial:a}=this.props;let c;if(typeof a=="string"||typeof a=="object"){const h=OU(this.props,a,this.presenceContext?.custom);h&&(c=h[r])}if(a&&c!==void 0)return c;const l=this.getBaseTargetFromProps(this.props,r);return l!==void 0&&!Da(l)?l:this.initialValues[r]!==void 0&&c===void 0?void 0:this.baseTarget[r]}on(r,a){return this.events[r]||(this.events[r]=new oU),this.events[r].add(a)}notify(r,...a){this.events[r]&&this.events[r].notify(...a)}scheduleRenderMicrotask(){SU.render(this.render)}}class nZ extends KAe{constructor(){super(...arguments),this.KeyframeResolver=WIe}sortInstanceNodePosition(r,a){return r.compareDocumentPosition(a)&2?1:-1}getBaseTargetFromProps(r,a){return r.style?r.style[a]:void 0}removeValueFromRenderState(r,{vars:a,style:c}){delete a[r],delete c[r]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:r}=this.props;Da(r)&&(this.childSubscription=r.on("change",a=>{this.current&&(this.current.textContent=`${a}`)}))}}function rZ(i,{style:r,vars:a},c,l){const h=i.style;let m;for(m in r)h[m]=r[m];l?.applyProjectionStyles(h,c);for(m in a)h.setProperty(m,a[m])}function YAe(i){return window.getComputedStyle(i)}class qAe extends nZ{constructor(){super(...arguments),this.type="html",this.renderInstance=rZ}readValueFromInstance(r,a){if(fv.has(a))return this.projection?.isProjecting?pM(a):oIe(r,a);{const c=YAe(r),l=(oQ(a)?c.getPropertyValue(a):c[a])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(r,{transformPagePoint:a}){return eZ(r,a)}build(r,a,c){bU(r,a,c.transformTemplate)}scrapeMotionValuesFromProps(r,a,c){return NU(r,a,c)}}const iZ=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function XAe(i,r,a,c){rZ(i,r,void 0,c);for(const l in r.attrs)i.setAttribute(iZ.has(l)?l:PU(l),r.attrs[l])}class JAe extends nZ{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=xs}getBaseTargetFromProps(r,a){return r[a]}readValueFromInstance(r,a){if(fv.has(a)){const c=AQ(a);return c&&c.default||0}return a=iZ.has(a)?a:PU(a),r.getAttribute(a)}scrapeMotionValuesFromProps(r,a,c){return YQ(r,a,c)}build(r,a,c){GQ(r,a,this.isSVGTag,c.transformTemplate,c.style)}renderInstance(r,a,c,l){XAe(r,a,c,l)}mount(r){this.isSVGTag=zQ(r.tagName),super.mount(r)}}const $Ae=(i,r)=>AU(i)?new JAe(r):new qAe(r,{allowProjection:i!==G.Fragment});function Uy(i,r,a){const c=i.getProps();return OU(c,r,a!==void 0?a:c.custom,i)}const CM=i=>Array.isArray(i);function QAe(i,r,a){i.hasValue(r)?i.getValue(r).set(a):i.addValue(r,Ky(a))}function ZAe(i){return CM(i)?i[i.length-1]||0:i}function eOe(i,r){const a=Uy(i,r);let{transitionEnd:c={},transition:l={},...h}=a||{};h={...h,...c};for(const m in h){const E=ZAe(h[m]);QAe(i,m,E)}}function tOe(i){return!!(Da(i)&&i.add)}function RM(i,r){const a=i.getValue("willChange");if(tOe(a))return a.add(r);if(!a&&Ch.WillChange){const c=new Ch.WillChange("auto");i.addValue("willChange",c),c.add(r)}}function sZ(i){return i.props[qQ]}const nOe=i=>i!==null;function rOe(i,{repeat:r,repeatType:a="loop"},c){const l=i.filter(nOe),h=r&&a!=="loop"&&r%2===1?0:l.length-1;return l[h]}const iOe={type:"spring",stiffness:500,damping:25,restSpeed:10},sOe=i=>({type:"spring",stiffness:550,damping:i===0?2*Math.sqrt(550):30,restSpeed:10}),aOe={type:"keyframes",duration:.8},oOe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},cOe=(i,{keyframes:r})=>r.length>2?aOe:fv.has(i)?i.startsWith("scale")?sOe(r[1]):iOe:oOe;function lOe({when:i,delay:r,delayChildren:a,staggerChildren:c,staggerDirection:l,repeat:h,repeatType:m,repeatDelay:E,from:S,elapsed:T,...C}){return!!Object.keys(C).length}const kU=(i,r,a,c={},l,h)=>m=>{const E=yU(c,i)||{},S=E.delay||c.delay||0;let{elapsed:T=0}=c;T=T-vd(S);const C={keyframes:Array.isArray(a)?a:[null,a],ease:"easeOut",velocity:r.getVelocity(),...E,delay:-T,onUpdate:N=>{r.set(N),E.onUpdate&&E.onUpdate(N)},onComplete:()=>{m(),E.onComplete&&E.onComplete()},name:i,motionValue:r,element:h?void 0:l};lOe(E)||Object.assign(C,cOe(i,C)),C.duration&&(C.duration=vd(C.duration)),C.repeatDelay&&(C.repeatDelay=vd(C.repeatDelay)),C.from!==void 0&&(C.keyframes[0]=C.from);let I=!1;if((C.type===!1||C.duration===0&&!C.repeatDelay)&&(EM(C),C.delay===0&&(I=!0)),(Ch.instantAnimations||Ch.skipAnimations)&&(I=!0,EM(C),C.delay=0),C.allowFlatten=!E.type&&!E.ease,I&&!h&&r.get()!==void 0){const N=rOe(C.keyframes,E);if(N!==void 0){Fi.update(()=>{C.onUpdate(N),C.onComplete()});return}}return E.isSync?new _U(C):new NIe(C)};function uOe({protectedKeys:i,needsAnimating:r},a){const c=i.hasOwnProperty(a)&&r[a]!==!0;return r[a]=!1,c}function aZ(i,r,{delay:a=0,transitionOverride:c,type:l}={}){let{transition:h=i.getDefaultTransition(),transitionEnd:m,...E}=r;c&&(h=c);const S=[],T=l&&i.animationState&&i.animationState.getState()[l];for(const C in E){const I=i.getValue(C,i.latestValues[C]??null),N=E[C];if(N===void 0||T&&uOe(T,C))continue;const P={delay:a,...yU(h||{},C)},H=I.get();if(H!==void 0&&!I.isAnimating&&!Array.isArray(N)&&N===H&&!P.velocity)continue;let x=!1;if(window.MotionHandoffAnimation){const X=sZ(i);if(X){const Z=window.MotionHandoffAnimation(X,C,Fi);Z!==null&&(P.startTime=Z,x=!0)}}RM(i,C),I.start(kU(C,I,N,i.shouldReduceMotion&&RQ.has(C)?{type:!1}:P,i,x));const B=I.animation;B&&S.push(B)}return m&&Promise.all(S).then(()=>{Fi.update(()=>{m&&eOe(i,m)})}),S}function oZ(i,r,a,c=0,l=1){const h=Array.from(i).sort((T,C)=>T.sortNodePosition(C)).indexOf(r),m=i.size,E=(m-1)*c;return typeof a=="function"?a(h,m):l===1?h*c:E-h*c}function bM(i,r,a={}){const c=Uy(i,r,a.type==="exit"?i.presenceContext?.custom:void 0);let{transition:l=i.getDefaultTransition()||{}}=c||{};a.transitionOverride&&(l=a.transitionOverride);const h=c?()=>Promise.all(aZ(i,c,a)):()=>Promise.resolve(),m=i.variantChildren&&i.variantChildren.size?(S=0)=>{const{delayChildren:T=0,staggerChildren:C,staggerDirection:I}=l;return dOe(i,r,S,T,C,I,a)}:()=>Promise.resolve(),{when:E}=l;if(E){const[S,T]=E==="beforeChildren"?[h,m]:[m,h];return S().then(()=>T())}else return Promise.all([h(),m(a.delay)])}function dOe(i,r,a=0,c=0,l=0,h=1,m){const E=[];for(const S of i.variantChildren)S.notify("AnimationStart",r),E.push(bM(S,r,{...m,delay:a+(typeof c=="function"?0:c)+oZ(i.variantChildren,S,c,l,h)}).then(()=>S.notify("AnimationComplete",r)));return Promise.all(E)}function hOe(i,r,a={}){i.notify("AnimationStart",r);let c;if(Array.isArray(r)){const l=r.map(h=>bM(i,h,a));c=Promise.all(l)}else if(typeof r=="string")c=bM(i,r,a);else{const l=typeof r=="function"?Uy(i,r,a.custom):r;c=Promise.all(aZ(i,l,a))}return c.then(()=>{i.notify("AnimationComplete",r)})}function cZ(i,r){if(!Array.isArray(r))return!1;const a=r.length;if(a!==i.length)return!1;for(let c=0;c<a;c++)if(r[c]!==i[c])return!1;return!0}const pOe=RU.length;function lZ(i){if(!i)return;if(!i.isControllingVariants){const a=i.parent?lZ(i.parent)||{}:{};return i.props.initial!==void 0&&(a.initial=i.props.initial),a}const r={};for(let a=0;a<pOe;a++){const c=RU[a],l=i.props[c];(gw(l)||l===!1)&&(r[c]=l)}return r}const fOe=[...CU].reverse(),mOe=CU.length;function gOe(i){return r=>Promise.all(r.map(({animation:a,options:c})=>hOe(i,a,c)))}function _Oe(i){let r=gOe(i),a=y7(),c=!0;const l=S=>(T,C)=>{const I=Uy(i,C,S==="exit"?i.presenceContext?.custom:void 0);if(I){const{transition:N,transitionEnd:P,...H}=I;T={...T,...H,...P}}return T};function h(S){r=S(i)}function m(S){const{props:T}=i,C=lZ(i.parent)||{},I=[],N=new Set;let P={},H=1/0;for(let B=0;B<mOe;B++){const X=fOe[B],Z=a[X],$=T[X]!==void 0?T[X]:C[X],le=gw($),re=X===S?Z.isActive:null;re===!1&&(H=B);let ce=$===C[X]&&$!==T[X]&&le;if(ce&&c&&i.manuallyAnimateOnMount&&(ce=!1),Z.protectedKeys={...P},!Z.isActive&&re===null||!$&&!Z.prevProp||jO($)||typeof $=="boolean")continue;const te=EOe(Z.prevProp,$);let pe=te||X===S&&Z.isActive&&!ce&&le||B>H&&le,Ee=!1;const Ne=Array.isArray($)?$:[$];let Ue=Ne.reduce(l(X),{});re===!1&&(Ue={});const{prevResolvedValues:Se={}}=Z,Xe={...Se,...Ue},Re=Ge=>{pe=!0,N.has(Ge)&&(Ee=!0,N.delete(Ge)),Z.needsAnimating[Ge]=!0;const Ie=i.getValue(Ge);Ie&&(Ie.liveStyle=!1)};for(const Ge in Xe){const Ie=Ue[Ge],Ke=Se[Ge];if(P.hasOwnProperty(Ge))continue;let ae=!1;CM(Ie)&&CM(Ke)?ae=!cZ(Ie,Ke):ae=Ie!==Ke,ae?Ie!=null?Re(Ge):N.add(Ge):Ie!==void 0&&N.has(Ge)?Re(Ge):Z.protectedKeys[Ge]=!0}Z.prevProp=$,Z.prevResolvedValues=Ue,Z.isActive&&(P={...P,...Ue}),c&&i.blockInitialAnimation&&(pe=!1);const Be=ce&&te;pe&&(!Be||Ee)&&I.push(...Ne.map(Ge=>{const Ie={type:X};if(typeof Ge=="string"&&c&&!Be&&i.manuallyAnimateOnMount&&i.parent){const{parent:Ke}=i,ae=Uy(Ke,Ge);if(Ke.enteringChildren&&ae){const{delayChildren:ge}=ae.transition||{};Ie.delay=oZ(Ke.enteringChildren,i,ge)}}return{animation:Ge,options:Ie}}))}if(N.size){const B={};if(typeof T.initial!="boolean"){const X=Uy(i,Array.isArray(T.initial)?T.initial[0]:T.initial);X&&X.transition&&(B.transition=X.transition)}N.forEach(X=>{const Z=i.getBaseTarget(X),$=i.getValue(X);$&&($.liveStyle=!0),B[X]=Z??null}),I.push({animation:B})}let x=!!I.length;return c&&(T.initial===!1||T.initial===T.animate)&&!i.manuallyAnimateOnMount&&(x=!1),c=!1,x?r(I):Promise.resolve()}function E(S,T){if(a[S].isActive===T)return Promise.resolve();i.variantChildren?.forEach(I=>I.animationState?.setActive(S,T)),a[S].isActive=T;const C=m(S);for(const I in a)a[I].protectedKeys={};return C}return{animateChanges:m,setActive:E,setAnimateFunction:h,getState:()=>a,reset:()=>{a=y7()}}}function EOe(i,r){return typeof r=="string"?r!==i:Array.isArray(r)?!cZ(r,i):!1}function lg(i=!1){return{isActive:i,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function y7(){return{animate:lg(!0),whileInView:lg(),whileHover:lg(),whileTap:lg(),whileDrag:lg(),whileFocus:lg(),exit:lg()}}class vf{constructor(r){this.isMounted=!1,this.node=r}update(){}}class yOe extends vf{constructor(r){super(r),r.animationState||(r.animationState=_Oe(r))}updateAnimationControlsSubscription(){const{animate:r}=this.node.getProps();jO(r)&&(this.unmountControls=r.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:r}=this.node.getProps(),{animate:a}=this.node.prevProps||{};r!==a&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let vOe=0;class SOe extends vf{constructor(){super(...arguments),this.id=vOe++}update(){if(!this.node.presenceContext)return;const{isPresent:r,onExitComplete:a}=this.node.presenceContext,{isPresent:c}=this.node.prevPresenceContext||{};if(!this.node.animationState||r===c)return;const l=this.node.animationState.setActive("exit",!r);a&&!r&&l.then(()=>{a(this.id)})}mount(){const{register:r,onExitComplete:a}=this.node.presenceContext||{};a&&a(this.id),r&&(this.unmount=r(this.id))}unmount(){}}const TOe={animation:{Feature:yOe},exit:{Feature:SOe}};function _w(i,r,a,c={passive:!0}){return i.addEventListener(r,a,c),()=>i.removeEventListener(r,a)}function Ww(i){return{point:{x:i.pageX,y:i.pageY}}}const wOe=i=>r=>TU(r)&&i(r,Ww(r));function Y0(i,r,a,c){return _w(i,r,wOe(a),c)}const uZ=1e-4,COe=1-uZ,ROe=1+uZ,dZ=.01,bOe=0-dZ,IOe=0+dZ;function Qa(i){return i.max-i.min}function AOe(i,r,a){return Math.abs(i-r)<=a}function v7(i,r,a,c=.5){i.origin=c,i.originPoint=Xi(r.min,r.max,i.origin),i.scale=Qa(a)/Qa(r),i.translate=Xi(a.min,a.max,i.origin)-i.originPoint,(i.scale>=COe&&i.scale<=ROe||isNaN(i.scale))&&(i.scale=1),(i.translate>=bOe&&i.translate<=IOe||isNaN(i.translate))&&(i.translate=0)}function q0(i,r,a,c){v7(i.x,r.x,a.x,c?c.originX:void 0),v7(i.y,r.y,a.y,c?c.originY:void 0)}function S7(i,r,a){i.min=a.min+r.min,i.max=i.min+Qa(r)}function OOe(i,r,a){S7(i.x,r.x,a.x),S7(i.y,r.y,a.y)}function T7(i,r,a){i.min=r.min-a.min,i.max=i.min+Qa(r)}function ZA(i,r,a){T7(i.x,r.x,a.x),T7(i.y,r.y,a.y)}function tl(i){return[i("x"),i("y")]}const hZ=({current:i})=>i?i.ownerDocument.defaultView:null,w7=(i,r)=>Math.abs(i-r);function NOe(i,r){const a=w7(i.x,r.x),c=w7(i.y,r.y);return Math.sqrt(a**2+c**2)}class pZ{constructor(r,a,{transformPagePoint:c,contextWindow:l=window,dragSnapToOrigin:h=!1,distanceThreshold:m=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const N=eL(this.lastMoveEventInfo,this.history),P=this.startEvent!==null,H=NOe(N.offset,{x:0,y:0})>=this.distanceThreshold;if(!P&&!H)return;const{point:x}=N,{timestamp:B}=ma;this.history.push({...x,timestamp:B});const{onStart:X,onMove:Z}=this.handlers;P||(X&&X(this.lastMoveEvent,N),this.startEvent=this.lastMoveEvent),Z&&Z(this.lastMoveEvent,N)},this.handlePointerMove=(N,P)=>{this.lastMoveEvent=N,this.lastMoveEventInfo=Zx(P,this.transformPagePoint),Fi.update(this.updatePoint,!0)},this.handlePointerUp=(N,P)=>{this.end();const{onEnd:H,onSessionEnd:x,resumeAnimation:B}=this.handlers;if(this.dragSnapToOrigin&&B&&B(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const X=eL(N.type==="pointercancel"?this.lastMoveEventInfo:Zx(P,this.transformPagePoint),this.history);this.startEvent&&H&&H(N,X),x&&x(N,X)},!TU(r))return;this.dragSnapToOrigin=h,this.handlers=a,this.transformPagePoint=c,this.distanceThreshold=m,this.contextWindow=l||window;const E=Ww(r),S=Zx(E,this.transformPagePoint),{point:T}=S,{timestamp:C}=ma;this.history=[{...T,timestamp:C}];const{onSessionStart:I}=a;I&&I(r,eL(S,this.history)),this.removeListeners=Fw(Y0(this.contextWindow,"pointermove",this.handlePointerMove),Y0(this.contextWindow,"pointerup",this.handlePointerUp),Y0(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(r){this.handlers=r}end(){this.removeListeners&&this.removeListeners(),cf(this.updatePoint)}}function Zx(i,r){return r?{point:r(i.point)}:i}function C7(i,r){return{x:i.x-r.x,y:i.y-r.y}}function eL({point:i},r){return{point:i,delta:C7(i,fZ(r)),offset:C7(i,POe(r)),velocity:kOe(r,.1)}}function POe(i){return i[0]}function fZ(i){return i[i.length-1]}function kOe(i,r){if(i.length<2)return{x:0,y:0};let a=i.length-1,c=null;const l=fZ(i);for(;a>=0&&(c=i[a],!(l.timestamp-c.timestamp>vd(r)));)a--;if(!c)return{x:0,y:0};const h=il(l.timestamp-c.timestamp);if(h===0)return{x:0,y:0};const m={x:(l.x-c.x)/h,y:(l.y-c.y)/h};return m.x===1/0&&(m.x=0),m.y===1/0&&(m.y=0),m}function DOe(i,{min:r,max:a},c){return r!==void 0&&i<r?i=c?Xi(r,i,c.min):Math.max(i,r):a!==void 0&&i>a&&(i=c?Xi(a,i,c.max):Math.min(i,a)),i}function R7(i,r,a){return{min:r!==void 0?i.min+r:void 0,max:a!==void 0?i.max+a-(i.max-i.min):void 0}}function xOe(i,{top:r,left:a,bottom:c,right:l}){return{x:R7(i.x,a,l),y:R7(i.y,r,c)}}function b7(i,r){let a=r.min-i.min,c=r.max-i.max;return r.max-r.min<i.max-i.min&&([a,c]=[c,a]),{min:a,max:c}}function LOe(i,r){return{x:b7(i.x,r.x),y:b7(i.y,r.y)}}function MOe(i,r){let a=.5;const c=Qa(i),l=Qa(r);return l>c?a=pw(r.min,r.max-c,i.min):c>l&&(a=pw(i.min,i.max-l,r.min)),wh(0,1,a)}function UOe(i,r){const a={};return r.min!==void 0&&(a.min=r.min-i.min),r.max!==void 0&&(a.max=r.max-i.min),a}const IM=.35;function VOe(i=IM){return i===!1?i=0:i===!0&&(i=IM),{x:I7(i,"left","right"),y:I7(i,"top","bottom")}}function I7(i,r,a){return{min:A7(i,r),max:A7(i,a)}}function A7(i,r){return typeof i=="number"?i:i[r]||0}const FOe=new WeakMap;class jOe{constructor(r){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=xs(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=r}start(r,{snapToCursor:a=!1,distanceThreshold:c}={}){const{presenceContext:l}=this.visualElement;if(l&&l.isPresent===!1)return;const h=I=>{const{dragSnapToOrigin:N}=this.getProps();N?this.pauseAnimation():this.stopAnimation(),a&&this.snapToCursor(Ww(I).point)},m=(I,N)=>{const{drag:P,dragPropagation:H,onDragStart:x}=this.getProps();if(P&&!H&&(this.openDragLock&&this.openDragLock(),this.openDragLock=KIe(P),!this.openDragLock))return;this.latestPointerEvent=I,this.latestPanInfo=N,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),tl(X=>{let Z=this.getAxisMotionValue(X).get()||0;if(Sd.test(Z)){const{projection:$}=this.visualElement;if($&&$.layout){const le=$.layout.layoutBox[X];le&&(Z=Qa(le)*(parseFloat(Z)/100))}}this.originPoint[X]=Z}),x&&Fi.postRender(()=>x(I,N)),RM(this.visualElement,"transform");const{animationState:B}=this.visualElement;B&&B.setActive("whileDrag",!0)},E=(I,N)=>{this.latestPointerEvent=I,this.latestPanInfo=N;const{dragPropagation:P,dragDirectionLock:H,onDirectionLock:x,onDrag:B}=this.getProps();if(!P&&!this.openDragLock)return;const{offset:X}=N;if(H&&this.currentDirection===null){this.currentDirection=BOe(X),this.currentDirection!==null&&x&&x(this.currentDirection);return}this.updateAxis("x",N.point,X),this.updateAxis("y",N.point,X),this.visualElement.render(),B&&B(I,N)},S=(I,N)=>{this.latestPointerEvent=I,this.latestPanInfo=N,this.stop(I,N),this.latestPointerEvent=null,this.latestPanInfo=null},T=()=>tl(I=>this.getAnimationState(I)==="paused"&&this.getAxisMotionValue(I).animation?.play()),{dragSnapToOrigin:C}=this.getProps();this.panSession=new pZ(r,{onSessionStart:h,onStart:m,onMove:E,onSessionEnd:S,resumeAnimation:T},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:C,distanceThreshold:c,contextWindow:hZ(this.visualElement)})}stop(r,a){const c=r||this.latestPointerEvent,l=a||this.latestPanInfo,h=this.isDragging;if(this.cancel(),!h||!l||!c)return;const{velocity:m}=l;this.startAnimation(m);const{onDragEnd:E}=this.getProps();E&&Fi.postRender(()=>E(c,l))}cancel(){this.isDragging=!1;const{projection:r,animationState:a}=this.visualElement;r&&(r.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:c}=this.getProps();!c&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),a&&a.setActive("whileDrag",!1)}updateAxis(r,a,c){const{drag:l}=this.getProps();if(!c||!ZI(r,l,this.currentDirection))return;const h=this.getAxisMotionValue(r);let m=this.originPoint[r]+c[r];this.constraints&&this.constraints[r]&&(m=DOe(m,this.constraints[r],this.elastic[r])),h.set(m)}resolveConstraints(){const{dragConstraints:r,dragElastic:a}=this.getProps(),c=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,l=this.constraints;r&&Ty(r)?this.constraints||(this.constraints=this.resolveRefConstraints()):r&&c?this.constraints=xOe(c.layoutBox,r):this.constraints=!1,this.elastic=VOe(a),l!==this.constraints&&c&&this.constraints&&!this.hasMutatedConstraints&&tl(h=>{this.constraints!==!1&&this.getAxisMotionValue(h)&&(this.constraints[h]=UOe(c.layoutBox[h],this.constraints[h]))})}resolveRefConstraints(){const{dragConstraints:r,onMeasureDragConstraints:a}=this.getProps();if(!r||!Ty(r))return!1;const c=r.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const h=WAe(c,l.root,this.visualElement.getTransformPagePoint());let m=LOe(l.layout.layoutBox,h);if(a){const E=a(FAe(m));this.hasMutatedConstraints=!!E,E&&(m=$Q(E))}return m}startAnimation(r){const{drag:a,dragMomentum:c,dragElastic:l,dragTransition:h,dragSnapToOrigin:m,onDragTransitionEnd:E}=this.getProps(),S=this.constraints||{},T=tl(C=>{if(!ZI(C,a,this.currentDirection))return;let I=S&&S[C]||{};m&&(I={min:0,max:0});const N=l?200:1e6,P=l?40:1e7,H={type:"inertia",velocity:c?r[C]:0,bounceStiffness:N,bounceDamping:P,timeConstant:750,restDelta:1,restSpeed:10,...h,...I};return this.startAxisValueAnimation(C,H)});return Promise.all(T).then(E)}startAxisValueAnimation(r,a){const c=this.getAxisMotionValue(r);return RM(this.visualElement,r),c.start(kU(r,c,0,a,this.visualElement,!1))}stopAnimation(){tl(r=>this.getAxisMotionValue(r).stop())}pauseAnimation(){tl(r=>this.getAxisMotionValue(r).animation?.pause())}getAnimationState(r){return this.getAxisMotionValue(r).animation?.state}getAxisMotionValue(r){const a=`_drag${r.toUpperCase()}`,c=this.visualElement.getProps(),l=c[a];return l||this.visualElement.getValue(r,(c.initial?c.initial[r]:void 0)||0)}snapToCursor(r){tl(a=>{const{drag:c}=this.getProps();if(!ZI(a,c,this.currentDirection))return;const{projection:l}=this.visualElement,h=this.getAxisMotionValue(a);if(l&&l.layout){const{min:m,max:E}=l.layout.layoutBox[a];h.set(r[a]-Xi(m,E,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:r,dragConstraints:a}=this.getProps(),{projection:c}=this.visualElement;if(!Ty(a)||!c||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};tl(m=>{const E=this.getAxisMotionValue(m);if(E&&this.constraints!==!1){const S=E.get();l[m]=MOe({min:S,max:S},this.constraints[m])}});const{transformTemplate:h}=this.visualElement.getProps();this.visualElement.current.style.transform=h?h({},""):"none",c.root&&c.root.updateScroll(),c.updateLayout(),this.resolveConstraints(),tl(m=>{if(!ZI(m,r,null))return;const E=this.getAxisMotionValue(m),{min:S,max:T}=this.constraints[m];E.set(Xi(S,T,l[m]))})}addListeners(){if(!this.visualElement.current)return;FOe.set(this.visualElement,this);const r=this.visualElement.current,a=Y0(r,"pointerdown",S=>{const{drag:T,dragListener:C=!0}=this.getProps();T&&C&&this.start(S)}),c=()=>{const{dragConstraints:S}=this.getProps();Ty(S)&&S.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,h=l.addEventListener("measure",c);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),Fi.read(c);const m=_w(window,"resize",()=>this.scalePositionWithinConstraints()),E=l.addEventListener("didUpdate",(({delta:S,hasLayoutChanged:T})=>{this.isDragging&&T&&(tl(C=>{const I=this.getAxisMotionValue(C);I&&(this.originPoint[C]+=S[C].translate,I.set(I.get()+S[C].translate))}),this.visualElement.render())}));return()=>{m(),a(),h(),E&&E()}}getProps(){const r=this.visualElement.getProps(),{drag:a=!1,dragDirectionLock:c=!1,dragPropagation:l=!1,dragConstraints:h=!1,dragElastic:m=IM,dragMomentum:E=!0}=r;return{...r,drag:a,dragDirectionLock:c,dragPropagation:l,dragConstraints:h,dragElastic:m,dragMomentum:E}}}function ZI(i,r,a){return(r===!0||r===i)&&(a===null||a===i)}function BOe(i,r=10){let a=null;return Math.abs(i.y)>r?a="y":Math.abs(i.x)>r&&(a="x"),a}class WOe extends vf{constructor(r){super(r),this.removeGroupControls=ol,this.removeListeners=ol,this.controls=new jOe(r)}mount(){const{dragControls:r}=this.node.getProps();r&&(this.removeGroupControls=r.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||ol}unmount(){this.removeGroupControls(),this.removeListeners()}}const O7=i=>(r,a)=>{i&&Fi.postRender(()=>i(r,a))};class GOe extends vf{constructor(){super(...arguments),this.removePointerDownListener=ol}onPointerDown(r){this.session=new pZ(r,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:hZ(this.node)})}createPanHandlers(){const{onPanSessionStart:r,onPanStart:a,onPan:c,onPanEnd:l}=this.node.getProps();return{onSessionStart:O7(r),onStart:O7(a),onMove:c,onEnd:(h,m)=>{delete this.session,l&&Fi.postRender(()=>l(h,m))}}}mount(){this.removePointerDownListener=Y0(this.node.current,"pointerdown",r=>this.onPointerDown(r))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const vA={hasAnimatedSinceResize:!0,hasEverUpdated:!1};let tL=!1;class HOe extends G.Component{componentDidMount(){const{visualElement:r,layoutGroup:a,switchLayoutGroup:c,layoutId:l}=this.props,{projection:h}=r;h&&(a.group&&a.group.add(h),c&&c.register&&l&&c.register(h),tL&&h.root.didUpdate(),h.addEventListener("animationComplete",()=>{this.safeToRemove()}),h.setOptions({...h.options,onExitComplete:()=>this.safeToRemove()})),vA.hasEverUpdated=!0}getSnapshotBeforeUpdate(r){const{layoutDependency:a,visualElement:c,drag:l,isPresent:h}=this.props,{projection:m}=c;return m&&(m.isPresent=h,tL=!0,l||r.layoutDependency!==a||a===void 0||r.isPresent!==h?m.willUpdate():this.safeToRemove(),r.isPresent!==h&&(h?m.promote():m.relegate()||Fi.postRender(()=>{const E=m.getStack();(!E||!E.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:r}=this.props.visualElement;r&&(r.root.didUpdate(),SU.postRender(()=>{!r.currentAnimation&&r.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:r,layoutGroup:a,switchLayoutGroup:c}=this.props,{projection:l}=r;tL=!0,l&&(l.scheduleCheckAfterUnmount(),a&&a.group&&a.group.remove(l),c&&c.deregister&&c.deregister(l))}safeToRemove(){const{safeToRemove:r}=this.props;r&&r()}render(){return null}}function mZ(i){const[r,a]=MQ(),c=G.useContext(eU);return D.jsx(HOe,{...i,layoutGroup:c,switchLayoutGroup:G.useContext(XQ),isPresent:r,safeToRemove:a})}function zOe(i,r,a){const c=Da(i)?i:Ky(i);return c.start(kU("",c,r,a)),c.animation}const KOe=(i,r)=>i.depth-r.depth;class YOe{constructor(){this.children=[],this.isDirty=!1}add(r){rU(this.children,r),this.isDirty=!0}remove(r){iU(this.children,r),this.isDirty=!0}forEach(r){this.isDirty&&this.children.sort(KOe),this.isDirty=!1,this.children.forEach(r)}}function qOe(i,r){const a=Oo.now(),c=({timestamp:l})=>{const h=l-a;h>=r&&(cf(c),i(h-r))};return Fi.setup(c,!0),()=>cf(c)}const gZ=["TopLeft","TopRight","BottomLeft","BottomRight"],XOe=gZ.length,N7=i=>typeof i=="string"?parseFloat(i):i,P7=i=>typeof i=="number"||vn.test(i);function JOe(i,r,a,c,l,h){l?(i.opacity=Xi(0,a.opacity??1,$Oe(c)),i.opacityExit=Xi(r.opacity??1,0,QOe(c))):h&&(i.opacity=Xi(r.opacity??1,a.opacity??1,c));for(let m=0;m<XOe;m++){const E=`border${gZ[m]}Radius`;let S=k7(r,E),T=k7(a,E);if(S===void 0&&T===void 0)continue;S||(S=0),T||(T=0),S===0||T===0||P7(S)===P7(T)?(i[E]=Math.max(Xi(N7(S),N7(T),c),0),(Sd.test(T)||Sd.test(S))&&(i[E]+="%")):i[E]=T}(r.rotate||a.rotate)&&(i.rotate=Xi(r.rotate||0,a.rotate||0,c))}function k7(i,r){return i[r]!==void 0?i[r]:i.borderRadius}const $Oe=_Z(0,.5,tQ),QOe=_Z(.5,.95,ol);function _Z(i,r,a){return c=>c<i?0:c>r?1:a(pw(i,r,c))}function D7(i,r){i.min=r.min,i.max=r.max}function iu(i,r){D7(i.x,r.x),D7(i.y,r.y)}function x7(i,r){i.translate=r.translate,i.scale=r.scale,i.originPoint=r.originPoint,i.origin=r.origin}function L7(i,r,a,c,l){return i-=r,i=QA(i,1/a,c),l!==void 0&&(i=QA(i,1/l,c)),i}function ZOe(i,r=0,a=1,c=.5,l,h=i,m=i){if(Sd.test(r)&&(r=parseFloat(r),r=Xi(m.min,m.max,r/100)-m.min),typeof r!="number")return;let E=Xi(h.min,h.max,c);i===h&&(E-=r),i.min=L7(i.min,r,a,E,l),i.max=L7(i.max,r,a,E,l)}function M7(i,r,[a,c,l],h,m){ZOe(i,r[a],r[c],r[l],r.scale,h,m)}const eNe=["x","scaleX","originX"],tNe=["y","scaleY","originY"];function U7(i,r,a,c){M7(i.x,r,eNe,a?a.x:void 0,c?c.x:void 0),M7(i.y,r,tNe,a?a.y:void 0,c?c.y:void 0)}function V7(i){return i.translate===0&&i.scale===1}function EZ(i){return V7(i.x)&&V7(i.y)}function F7(i,r){return i.min===r.min&&i.max===r.max}function nNe(i,r){return F7(i.x,r.x)&&F7(i.y,r.y)}function j7(i,r){return Math.round(i.min)===Math.round(r.min)&&Math.round(i.max)===Math.round(r.max)}function yZ(i,r){return j7(i.x,r.x)&&j7(i.y,r.y)}function B7(i){return Qa(i.x)/Qa(i.y)}function W7(i,r){return i.translate===r.translate&&i.scale===r.scale&&i.originPoint===r.originPoint}class rNe{constructor(){this.members=[]}add(r){rU(this.members,r),r.scheduleRender()}remove(r){if(iU(this.members,r),r===this.prevLead&&(this.prevLead=void 0),r===this.lead){const a=this.members[this.members.length-1];a&&this.promote(a)}}relegate(r){const a=this.members.findIndex(l=>r===l);if(a===0)return!1;let c;for(let l=a;l>=0;l--){const h=this.members[l];if(h.isPresent!==!1){c=h;break}}return c?(this.promote(c),!0):!1}promote(r,a){const c=this.lead;if(r!==c&&(this.prevLead=c,this.lead=r,r.show(),c)){c.instance&&c.scheduleRender(),r.scheduleRender(),r.resumeFrom=c,a&&(r.resumeFrom.preserveOpacity=!0),c.snapshot&&(r.snapshot=c.snapshot,r.snapshot.latestValues=c.animationValues||c.latestValues),r.root&&r.root.isUpdating&&(r.isLayoutDirty=!0);const{crossfade:l}=r.options;l===!1&&c.hide()}}exitAnimationComplete(){this.members.forEach(r=>{const{options:a,resumingFrom:c}=r;a.onExitComplete&&a.onExitComplete(),c&&c.options.onExitComplete&&c.options.onExitComplete()})}scheduleRender(){this.members.forEach(r=>{r.instance&&r.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function iNe(i,r,a){let c="";const l=i.x.translate/r.x,h=i.y.translate/r.y,m=a?.z||0;if((l||h||m)&&(c=`translate3d(${l}px, ${h}px, ${m}px) `),(r.x!==1||r.y!==1)&&(c+=`scale(${1/r.x}, ${1/r.y}) `),a){const{transformPerspective:T,rotate:C,rotateX:I,rotateY:N,skewX:P,skewY:H}=a;T&&(c=`perspective(${T}px) ${c}`),C&&(c+=`rotate(${C}deg) `),I&&(c+=`rotateX(${I}deg) `),N&&(c+=`rotateY(${N}deg) `),P&&(c+=`skewX(${P}deg) `),H&&(c+=`skewY(${H}deg) `)}const E=i.x.scale*r.x,S=i.y.scale*r.y;return(E!==1||S!==1)&&(c+=`scale(${E}, ${S})`),c||"none"}const nL=["","X","Y","Z"],sNe=1e3;let aNe=0;function rL(i,r,a,c){const{latestValues:l}=r;l[i]&&(a[i]=l[i],r.setStaticValue(i,0),c&&(c[i]=0))}function vZ(i){if(i.hasCheckedOptimisedAppear=!0,i.root===i)return;const{visualElement:r}=i.options;if(!r)return;const a=sZ(r);if(window.MotionHasOptimisedAnimation(a,"transform")){const{layout:l,layoutId:h}=i.options;window.MotionCancelOptimisedAnimation(a,"transform",Fi,!(l||h))}const{parent:c}=i;c&&!c.hasCheckedOptimisedAppear&&vZ(c)}function SZ({attachResizeListener:i,defaultParent:r,measureScroll:a,checkIsScrollRoot:c,resetTransform:l}){return class{constructor(m={},E=r?.()){this.id=aNe++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(lNe),this.nodes.forEach(pNe),this.nodes.forEach(fNe),this.nodes.forEach(uNe)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=m,this.root=E?E.root||E:this,this.path=E?[...E.path,E]:[],this.parent=E,this.depth=E?E.depth+1:0;for(let S=0;S<this.path.length;S++)this.path[S].shouldResetTransform=!0;this.root===this&&(this.nodes=new YOe)}addEventListener(m,E){return this.eventHandlers.has(m)||this.eventHandlers.set(m,new oU),this.eventHandlers.get(m).add(E)}notifyListeners(m,...E){const S=this.eventHandlers.get(m);S&&S.notify(...E)}hasListeners(m){return this.eventHandlers.has(m)}mount(m){if(this.instance)return;this.isSVG=LQ(m)&&!QIe(m),this.instance=m;const{layoutId:E,layout:S,visualElement:T}=this.options;if(T&&!T.current&&T.mount(m),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(S||E)&&(this.isLayoutDirty=!0),i){let C,I=0;const N=()=>this.root.updateBlockedByResize=!1;Fi.read(()=>{I=window.innerWidth}),i(m,()=>{const P=window.innerWidth;P!==I&&(I=P,this.root.updateBlockedByResize=!0,C&&C(),C=qOe(N,250),vA.hasAnimatedSinceResize&&(vA.hasAnimatedSinceResize=!1,this.nodes.forEach(z7)))})}E&&this.root.registerSharedNode(E,this),this.options.animate!==!1&&T&&(E||S)&&this.addEventListener("didUpdate",({delta:C,hasLayoutChanged:I,hasRelativeLayoutChanged:N,layout:P})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const H=this.options.transition||T.getDefaultTransition()||yNe,{onLayoutAnimationStart:x,onLayoutAnimationComplete:B}=T.getProps(),X=!this.targetLayout||!yZ(this.targetLayout,P),Z=!I&&N;if(this.options.layoutRoot||this.resumeFrom||Z||I&&(X||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const $={...yU(H,"layout"),onPlay:x,onComplete:B};(T.shouldReduceMotion||this.options.layoutRoot)&&($.delay=0,$.type=!1),this.startAnimation($),this.setAnimationOrigin(C,Z)}else I||z7(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=P})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const m=this.getStack();m&&m.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),cf(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(mNe),this.animationId++)}getTransformTemplate(){const{visualElement:m}=this.options;return m&&m.getProps().transformTemplate}willUpdate(m=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&vZ(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let C=0;C<this.path.length;C++){const I=this.path[C];I.shouldResetTransform=!0,I.updateScroll("snapshot"),I.options.layoutRoot&&I.willUpdate(!1)}const{layoutId:E,layout:S}=this.options;if(E===void 0&&!S)return;const T=this.getTransformTemplate();this.prevTransformTemplateValue=T?T(this.latestValues,""):void 0,this.updateSnapshot(),m&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(G7);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(H7);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(hNe),this.nodes.forEach(oNe),this.nodes.forEach(cNe)):this.nodes.forEach(H7),this.clearAllSnapshots();const E=Oo.now();ma.delta=wh(0,1e3/60,E-ma.timestamp),ma.timestamp=E,ma.isProcessing=!0,zx.update.process(ma),zx.preRender.process(ma),zx.render.process(ma),ma.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,SU.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(dNe),this.sharedNodes.forEach(gNe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Fi.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Fi.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Qa(this.snapshot.measuredBox.x)&&!Qa(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let S=0;S<this.path.length;S++)this.path[S].updateScroll();const m=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=xs(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:E}=this.options;E&&E.notify("LayoutMeasure",this.layout.layoutBox,m?m.layoutBox:void 0)}updateScroll(m="measure"){let E=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===m&&(E=!1),E&&this.instance){const S=c(this.instance);this.scroll={animationId:this.root.animationId,phase:m,isRoot:S,offset:a(this.instance),wasRoot:this.scroll?this.scroll.isRoot:S}}}resetTransform(){if(!l)return;const m=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,E=this.projectionDelta&&!EZ(this.projectionDelta),S=this.getTransformTemplate(),T=S?S(this.latestValues,""):void 0,C=T!==this.prevTransformTemplateValue;m&&this.instance&&(E||pg(this.latestValues)||C)&&(l(this.instance,T),this.shouldResetTransform=!1,this.scheduleRender())}measure(m=!0){const E=this.measurePageBox();let S=this.removeElementScroll(E);return m&&(S=this.removeTransform(S)),vNe(S),{animationId:this.root.animationId,measuredBox:E,layoutBox:S,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:m}=this.options;if(!m)return xs();const E=m.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(SNe))){const{scroll:T}=this.root;T&&(wy(E.x,T.offset.x),wy(E.y,T.offset.y))}return E}removeElementScroll(m){const E=xs();if(iu(E,m),this.scroll?.wasRoot)return E;for(let S=0;S<this.path.length;S++){const T=this.path[S],{scroll:C,options:I}=T;T!==this.root&&C&&I.layoutScroll&&(C.wasRoot&&iu(E,m),wy(E.x,C.offset.x),wy(E.y,C.offset.y))}return E}applyTransform(m,E=!1){const S=xs();iu(S,m);for(let T=0;T<this.path.length;T++){const C=this.path[T];!E&&C.options.layoutScroll&&C.scroll&&C!==C.root&&Cy(S,{x:-C.scroll.offset.x,y:-C.scroll.offset.y}),pg(C.latestValues)&&Cy(S,C.latestValues)}return pg(this.latestValues)&&Cy(S,this.latestValues),S}removeTransform(m){const E=xs();iu(E,m);for(let S=0;S<this.path.length;S++){const T=this.path[S];if(!T.instance||!pg(T.latestValues))continue;SM(T.latestValues)&&T.updateSnapshot();const C=xs(),I=T.measurePageBox();iu(C,I),U7(E,T.latestValues,T.snapshot?T.snapshot.layoutBox:void 0,C)}return pg(this.latestValues)&&U7(E,this.latestValues),E}setTargetDelta(m){this.targetDelta=m,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(m){this.options={...this.options,...m,crossfade:m.crossfade!==void 0?m.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==ma.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(m=!1){const E=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=E.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=E.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=E.isSharedProjectionDirty);const S=!!this.resumingFrom||this!==E;if(!(m||S&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:C,layoutId:I}=this.options;if(!this.layout||!(C||I))return;this.resolvedRelativeTargetAt=ma.timestamp;const N=this.getClosestProjectingParent();N&&this.linkedParentVersion!==N.layoutVersion&&!N.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(N&&N.layout?this.createRelativeTarget(N,this.layout.layoutBox,N.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=xs(),this.targetWithTransforms=xs()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),OOe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):iu(this.target,this.layout.layoutBox),ZQ(this.target,this.targetDelta)):iu(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,N&&!!N.resumingFrom==!!this.resumingFrom&&!N.options.layoutScroll&&N.target&&this.animationProgress!==1?this.createRelativeTarget(N,this.target,N.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||SM(this.parent.latestValues)||QQ(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(m,E,S){this.relativeParent=m,this.linkedParentVersion=m.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=xs(),this.relativeTargetOrigin=xs(),ZA(this.relativeTargetOrigin,E,S),iu(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){const m=this.getLead(),E=!!this.resumingFrom||this!==m;let S=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(S=!1),E&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(S=!1),this.resolvedRelativeTargetAt===ma.timestamp&&(S=!1),S)return;const{layout:T,layoutId:C}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(T||C))return;iu(this.layoutCorrected,this.layout.layoutBox);const I=this.treeScale.x,N=this.treeScale.y;BAe(this.layoutCorrected,this.treeScale,this.path,E),m.layout&&!m.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(m.target=m.layout.layoutBox,m.targetWithTransforms=xs());const{target:P}=m;if(!P){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(x7(this.prevProjectionDelta.x,this.projectionDelta.x),x7(this.prevProjectionDelta.y,this.projectionDelta.y)),q0(this.projectionDelta,this.layoutCorrected,P,this.latestValues),(this.treeScale.x!==I||this.treeScale.y!==N||!W7(this.projectionDelta.x,this.prevProjectionDelta.x)||!W7(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",P))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(m=!0){if(this.options.visualElement?.scheduleRender(),m){const E=this.getStack();E&&E.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Ry(),this.projectionDelta=Ry(),this.projectionDeltaWithTransform=Ry()}setAnimationOrigin(m,E=!1){const S=this.snapshot,T=S?S.latestValues:{},C={...this.latestValues},I=Ry();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!E;const N=xs(),P=S?S.source:void 0,H=this.layout?this.layout.source:void 0,x=P!==H,B=this.getStack(),X=!B||B.members.length<=1,Z=!!(x&&!X&&this.options.crossfade===!0&&!this.path.some(ENe));this.animationProgress=0;let $;this.mixTargetDelta=le=>{const re=le/1e3;K7(I.x,m.x,re),K7(I.y,m.y,re),this.setTargetDelta(I),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(ZA(N,this.layout.layoutBox,this.relativeParent.layout.layoutBox),_Ne(this.relativeTarget,this.relativeTargetOrigin,N,re),$&&nNe(this.relativeTarget,$)&&(this.isProjectionDirty=!1),$||($=xs()),iu($,this.relativeTarget)),x&&(this.animationValues=C,JOe(C,T,this.latestValues,re,Z,X)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=re},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(m){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(cf(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Fi.update(()=>{vA.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Ky(0)),this.currentAnimation=zOe(this.motionValue,[0,1e3],{...m,velocity:0,isSync:!0,onUpdate:E=>{this.mixTargetDelta(E),m.onUpdate&&m.onUpdate(E)},onStop:()=>{},onComplete:()=>{m.onComplete&&m.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const m=this.getStack();m&&m.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(sNe),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const m=this.getLead();let{targetWithTransforms:E,target:S,layout:T,latestValues:C}=m;if(!(!E||!S||!T)){if(this!==m&&this.layout&&T&&TZ(this.options.animationType,this.layout.layoutBox,T.layoutBox)){S=this.target||xs();const I=Qa(this.layout.layoutBox.x);S.x.min=m.target.x.min,S.x.max=S.x.min+I;const N=Qa(this.layout.layoutBox.y);S.y.min=m.target.y.min,S.y.max=S.y.min+N}iu(E,S),Cy(E,C),q0(this.projectionDeltaWithTransform,this.layoutCorrected,E,C)}}registerSharedNode(m,E){this.sharedNodes.has(m)||this.sharedNodes.set(m,new rNe),this.sharedNodes.get(m).add(E);const T=E.options.initialPromotionConfig;E.promote({transition:T?T.transition:void 0,preserveFollowOpacity:T&&T.shouldPreserveFollowOpacity?T.shouldPreserveFollowOpacity(E):void 0})}isLead(){const m=this.getStack();return m?m.lead===this:!0}getLead(){const{layoutId:m}=this.options;return m?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:m}=this.options;return m?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:m}=this.options;if(m)return this.root.sharedNodes.get(m)}promote({needsReset:m,transition:E,preserveFollowOpacity:S}={}){const T=this.getStack();T&&T.promote(this,S),m&&(this.projectionDelta=void 0,this.needsReset=!0),E&&this.setOptions({transition:E})}relegate(){const m=this.getStack();return m?m.relegate(this):!1}resetSkewAndRotation(){const{visualElement:m}=this.options;if(!m)return;let E=!1;const{latestValues:S}=m;if((S.z||S.rotate||S.rotateX||S.rotateY||S.rotateZ||S.skewX||S.skewY)&&(E=!0),!E)return;const T={};S.z&&rL("z",m,T,this.animationValues);for(let C=0;C<nL.length;C++)rL(`rotate${nL[C]}`,m,T,this.animationValues),rL(`skew${nL[C]}`,m,T,this.animationValues);m.render();for(const C in T)m.setStaticValue(C,T[C]),this.animationValues&&(this.animationValues[C]=T[C]);m.scheduleRender()}applyProjectionStyles(m,E){if(!this.instance||this.isSVG)return;if(!this.isVisible){m.visibility="hidden";return}const S=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,m.visibility="",m.opacity="",m.pointerEvents=yA(E?.pointerEvents)||"",m.transform=S?S(this.latestValues,""):"none";return}const T=this.getLead();if(!this.projectionDelta||!this.layout||!T.target){this.options.layoutId&&(m.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,m.pointerEvents=yA(E?.pointerEvents)||""),this.hasProjected&&!pg(this.latestValues)&&(m.transform=S?S({},""):"none",this.hasProjected=!1);return}m.visibility="";const C=T.animationValues||T.latestValues;this.applyTransformsToTarget();let I=iNe(this.projectionDeltaWithTransform,this.treeScale,C);S&&(I=S(C,I)),m.transform=I;const{x:N,y:P}=this.projectionDelta;m.transformOrigin=`${N.origin*100}% ${P.origin*100}% 0`,T.animationValues?m.opacity=T===this?C.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:C.opacityExit:m.opacity=T===this?C.opacity!==void 0?C.opacity:"":C.opacityExit!==void 0?C.opacityExit:0;for(const H in vM){if(C[H]===void 0)continue;const{correct:x,applyTo:B,isCSSVariable:X}=vM[H],Z=I==="none"?C[H]:x(C[H],T);if(B){const $=B.length;for(let le=0;le<$;le++)m[B[le]]=Z}else X?this.options.visualElement.renderState.vars[H]=Z:m[H]=Z}this.options.layoutId&&(m.pointerEvents=T===this?yA(E?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(m=>m.currentAnimation?.stop()),this.root.nodes.forEach(G7),this.root.sharedNodes.clear()}}}function oNe(i){i.updateLayout()}function cNe(i){const r=i.resumeFrom?.snapshot||i.snapshot;if(i.isLead()&&i.layout&&r&&i.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:c}=i.layout,{animationType:l}=i.options,h=r.source!==i.layout.source;l==="size"?tl(C=>{const I=h?r.measuredBox[C]:r.layoutBox[C],N=Qa(I);I.min=a[C].min,I.max=I.min+N}):TZ(l,r.layoutBox,a)&&tl(C=>{const I=h?r.measuredBox[C]:r.layoutBox[C],N=Qa(a[C]);I.max=I.min+N,i.relativeTarget&&!i.currentAnimation&&(i.isProjectionDirty=!0,i.relativeTarget[C].max=i.relativeTarget[C].min+N)});const m=Ry();q0(m,a,r.layoutBox);const E=Ry();h?q0(E,i.applyTransform(c,!0),r.measuredBox):q0(E,a,r.layoutBox);const S=!EZ(m);let T=!1;if(!i.resumeFrom){const C=i.getClosestProjectingParent();if(C&&!C.resumeFrom){const{snapshot:I,layout:N}=C;if(I&&N){const P=xs();ZA(P,r.layoutBox,I.layoutBox);const H=xs();ZA(H,a,N.layoutBox),yZ(P,H)||(T=!0),C.options.layoutRoot&&(i.relativeTarget=H,i.relativeTargetOrigin=P,i.relativeParent=C)}}}i.notifyListeners("didUpdate",{layout:a,snapshot:r,delta:E,layoutDelta:m,hasLayoutChanged:S,hasRelativeLayoutChanged:T})}else if(i.isLead()){const{onExitComplete:a}=i.options;a&&a()}i.options.transition=void 0}function lNe(i){i.parent&&(i.isProjecting()||(i.isProjectionDirty=i.parent.isProjectionDirty),i.isSharedProjectionDirty||(i.isSharedProjectionDirty=!!(i.isProjectionDirty||i.parent.isProjectionDirty||i.parent.isSharedProjectionDirty)),i.isTransformDirty||(i.isTransformDirty=i.parent.isTransformDirty))}function uNe(i){i.isProjectionDirty=i.isSharedProjectionDirty=i.isTransformDirty=!1}function dNe(i){i.clearSnapshot()}function G7(i){i.clearMeasurements()}function H7(i){i.isLayoutDirty=!1}function hNe(i){const{visualElement:r}=i.options;r&&r.getProps().onBeforeLayoutMeasure&&r.notify("BeforeLayoutMeasure"),i.resetTransform()}function z7(i){i.finishAnimation(),i.targetDelta=i.relativeTarget=i.target=void 0,i.isProjectionDirty=!0}function pNe(i){i.resolveTargetDelta()}function fNe(i){i.calcProjection()}function mNe(i){i.resetSkewAndRotation()}function gNe(i){i.removeLeadSnapshot()}function K7(i,r,a){i.translate=Xi(r.translate,0,a),i.scale=Xi(r.scale,1,a),i.origin=r.origin,i.originPoint=r.originPoint}function Y7(i,r,a,c){i.min=Xi(r.min,a.min,c),i.max=Xi(r.max,a.max,c)}function _Ne(i,r,a,c){Y7(i.x,r.x,a.x,c),Y7(i.y,r.y,a.y,c)}function ENe(i){return i.animationValues&&i.animationValues.opacityExit!==void 0}const yNe={duration:.45,ease:[.4,0,.1,1]},q7=i=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(i),X7=q7("applewebkit/")&&!q7("chrome/")?Math.round:ol;function J7(i){i.min=X7(i.min),i.max=X7(i.max)}function vNe(i){J7(i.x),J7(i.y)}function TZ(i,r,a){return i==="position"||i==="preserve-aspect"&&!AOe(B7(r),B7(a),.2)}function SNe(i){return i!==i.root&&i.scroll?.wasRoot}const TNe=SZ({attachResizeListener:(i,r)=>_w(i,"resize",r),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),iL={current:void 0},wZ=SZ({measureScroll:i=>({x:i.scrollLeft,y:i.scrollTop}),defaultParent:()=>{if(!iL.current){const i=new TNe({});i.mount(window),i.setOptions({layoutScroll:!0}),iL.current=i}return iL.current},resetTransform:(i,r)=>{i.style.transform=r!==void 0?r:"none"},checkIsScrollRoot:i=>window.getComputedStyle(i).position==="fixed"}),wNe={pan:{Feature:GOe},drag:{Feature:WOe,ProjectionNode:wZ,MeasureLayout:mZ}};function $7(i,r,a){const{props:c}=i;i.animationState&&c.whileHover&&i.animationState.setActive("whileHover",a==="Start");const l="onHover"+a,h=c[l];h&&Fi.postRender(()=>h(r,Ww(r)))}class CNe extends vf{mount(){const{current:r}=this.node;r&&(this.unmount=YIe(r,(a,c)=>($7(this.node,c,"Start"),l=>$7(this.node,l,"End"))))}unmount(){}}class RNe extends vf{constructor(){super(...arguments),this.isActive=!1}onFocus(){let r=!1;try{r=this.node.current.matches(":focus-visible")}catch{r=!0}!r||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Fw(_w(this.node.current,"focus",()=>this.onFocus()),_w(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function Q7(i,r,a){const{props:c}=i;if(i.current instanceof HTMLButtonElement&&i.current.disabled)return;i.animationState&&c.whileTap&&i.animationState.setActive("whileTap",a==="Start");const l="onTap"+(a==="End"?"":a),h=c[l];h&&Fi.postRender(()=>h(r,Ww(r)))}class bNe extends vf{mount(){const{current:r}=this.node;r&&(this.unmount=$Ie(r,(a,c)=>(Q7(this.node,c,"Start"),(l,{success:h})=>Q7(this.node,l,h?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const AM=new WeakMap,sL=new WeakMap,INe=i=>{const r=AM.get(i.target);r&&r(i)},ANe=i=>{i.forEach(INe)};function ONe({root:i,...r}){const a=i||document;sL.has(a)||sL.set(a,{});const c=sL.get(a),l=JSON.stringify(r);return c[l]||(c[l]=new IntersectionObserver(ANe,{root:i,...r})),c[l]}function NNe(i,r,a){const c=ONe(r);return AM.set(i,a),c.observe(i),()=>{AM.delete(i),c.unobserve(i)}}const PNe={some:0,all:1};class kNe extends vf{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:r={}}=this.node.getProps(),{root:a,margin:c,amount:l="some",once:h}=r,m={root:a?a.current:void 0,rootMargin:c,threshold:typeof l=="number"?l:PNe[l]},E=S=>{const{isIntersecting:T}=S;if(this.isInView===T||(this.isInView=T,h&&!T&&this.hasEnteredView))return;T&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",T);const{onViewportEnter:C,onViewportLeave:I}=this.node.getProps(),N=T?C:I;N&&N(S)};return NNe(this.node.current,m,E)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:r,prevProps:a}=this.node;["amount","margin","root"].some(DNe(r,a))&&this.startObserver()}unmount(){}}function DNe({viewport:i={}},{viewport:r={}}={}){return a=>i[a]!==r[a]}const xNe={inView:{Feature:kNe},tap:{Feature:bNe},focus:{Feature:RNe},hover:{Feature:CNe}},LNe={layout:{ProjectionNode:wZ,MeasureLayout:mZ}},MNe={...TOe,...xNe,...wNe,...LNe},Xn=VAe(MNe,$Ae);function uh(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function CZ(i,r){i.prototype=Object.create(r.prototype),i.prototype.constructor=i,i.__proto__=r}var gc={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},qy={duration:.5,overwrite:!1,delay:0},DU,ga,Vi,sl=1e8,pi=1/sl,OM=Math.PI*2,UNe=OM/4,VNe=0,RZ=Math.sqrt,FNe=Math.cos,jNe=Math.sin,Js=function(r){return typeof r=="string"},as=function(r){return typeof r=="function"},Rh=function(r){return typeof r=="number"},xU=function(r){return typeof r>"u"},Rd=function(r){return typeof r=="object"},Po=function(r){return r!==!1},LU=function(){return typeof window<"u"},eA=function(r){return as(r)||Js(r)},bZ=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},La=Array.isArray,BNe=/random\([^)]+\)/g,WNe=/,\s*/g,Z7=/(?:-?\.?\d|\.)+/gi,IZ=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,by=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,aL=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,AZ=/[+-]=-?[.\d]+/,GNe=/[^,'"\[\]\s]+/gi,HNe=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,qi,hd,NM,MU,_c={},eO={},OZ,NZ=function(r){return(eO=Xy(r,_c))&&Mo},UU=function(r,a){return console.warn("Invalid property",r,"set to",a,"Missing plugin? gsap.registerPlugin()")},Ew=function(r,a){return!a&&console.warn(r)},PZ=function(r,a){return r&&(_c[r]=a)&&eO&&(eO[r]=a)||_c},yw=function(){return 0},zNe={suppressEvents:!0,isStart:!0,kill:!1},SA={suppressEvents:!0,kill:!1},KNe={suppressEvents:!0},VU={},nf=[],PM={},kZ,cc={},oL={},eY=30,TA=[],FU="",jU=function(r){var a=r[0],c,l;if(Rd(a)||as(a)||(r=[r]),!(c=(a._gsap||{}).harness)){for(l=TA.length;l--&&!TA[l].targetTest(a););c=TA[l]}for(l=r.length;l--;)r[l]&&(r[l]._gsap||(r[l]._gsap=new nee(r[l],c)))||r.splice(l,1);return r},bg=function(r){return r._gsap||jU(al(r))[0]._gsap},DZ=function(r,a,c){return(c=r[a])&&as(c)?r[a]():xU(c)&&r.getAttribute&&r.getAttribute(a)||c},ko=function(r,a){return(r=r.split(",")).forEach(a)||r},ms=function(r){return Math.round(r*1e5)/1e5||0},Yi=function(r){return Math.round(r*1e7)/1e7||0},Vy=function(r,a){var c=a.charAt(0),l=parseFloat(a.substr(2));return r=parseFloat(r),c==="+"?r+l:c==="-"?r-l:c==="*"?r*l:r/l},YNe=function(r,a){for(var c=a.length,l=0;r.indexOf(a[l])<0&&++l<c;);return l<c},tO=function(){var r=nf.length,a=nf.slice(0),c,l;for(PM={},nf.length=0,c=0;c<r;c++)l=a[c],l&&l._lazy&&(l.render(l._lazy[0],l._lazy[1],!0)._lazy=0)},BU=function(r){return!!(r._initted||r._startAt||r.add)},xZ=function(r,a,c,l){nf.length&&!ga&&tO(),r.render(a,c,!!(ga&&a<0&&BU(r))),nf.length&&!ga&&tO()},LZ=function(r){var a=parseFloat(r);return(a||a===0)&&(r+"").match(GNe).length<2?a:Js(r)?r.trim():r},MZ=function(r){return r},Ec=function(r,a){for(var c in a)c in r||(r[c]=a[c]);return r},qNe=function(r){return function(a,c){for(var l in c)l in a||l==="duration"&&r||l==="ease"||(a[l]=c[l])}},Xy=function(r,a){for(var c in a)r[c]=a[c];return r},tY=function i(r,a){for(var c in a)c!=="__proto__"&&c!=="constructor"&&c!=="prototype"&&(r[c]=Rd(a[c])?i(r[c]||(r[c]={}),a[c]):a[c]);return r},nO=function(r,a){var c={},l;for(l in r)l in a||(c[l]=r[l]);return c},X0=function(r){var a=r.parent||qi,c=r.keyframes?qNe(La(r.keyframes)):Ec;if(Po(r.inherit))for(;a;)c(r,a.vars.defaults),a=a.parent||a._dp;return r},XNe=function(r,a){for(var c=r.length,l=c===a.length;l&&c--&&r[c]===a[c];);return c<0},UZ=function(r,a,c,l,h){var m=r[l],E;if(h)for(E=a[h];m&&m[h]>E;)m=m._prev;return m?(a._next=m._next,m._next=a):(a._next=r[c],r[c]=a),a._next?a._next._prev=a:r[l]=a,a._prev=m,a.parent=a._dp=r,a},WO=function(r,a,c,l){c===void 0&&(c="_first"),l===void 0&&(l="_last");var h=a._prev,m=a._next;h?h._next=m:r[c]===a&&(r[c]=m),m?m._prev=h:r[l]===a&&(r[l]=h),a._next=a._prev=a.parent=null},uf=function(r,a){r.parent&&(!a||r.parent.autoRemoveChildren)&&r.parent.remove&&r.parent.remove(r),r._act=0},Ig=function(r,a){if(r&&(!a||a._end>r._dur||a._start<0))for(var c=r;c;)c._dirty=1,c=c.parent;return r},JNe=function(r){for(var a=r.parent;a&&a.parent;)a._dirty=1,a.totalDuration(),a=a.parent;return r},kM=function(r,a,c,l){return r._startAt&&(ga?r._startAt.revert(SA):r.vars.immediateRender&&!r.vars.autoRevert||r._startAt.render(a,!0,l))},$Ne=function i(r){return!r||r._ts&&i(r.parent)},nY=function(r){return r._repeat?Jy(r._tTime,r=r.duration()+r._rDelay)*r:0},Jy=function(r,a){var c=Math.floor(r=Yi(r/a));return r&&c===r?c-1:c},rO=function(r,a){return(r-a._start)*a._ts+(a._ts>=0?0:a._dirty?a.totalDuration():a._tDur)},GO=function(r){return r._end=Yi(r._start+(r._tDur/Math.abs(r._ts||r._rts||pi)||0))},HO=function(r,a){var c=r._dp;return c&&c.smoothChildTiming&&r._ts&&(r._start=Yi(c._time-(r._ts>0?a/r._ts:((r._dirty?r.totalDuration():r._tDur)-a)/-r._ts)),GO(r),c._dirty||Ig(c,r)),r},VZ=function(r,a){var c;if((a._time||!a._dur&&a._initted||a._start<r._time&&(a._dur||!a.add))&&(c=rO(r.rawTime(),a),(!a._dur||Gw(0,a.totalDuration(),c)-a._tTime>pi)&&a.render(c,!0)),Ig(r,a)._dp&&r._initted&&r._time>=r._dur&&r._ts){if(r._dur<r.duration())for(c=r;c._dp;)c.rawTime()>=0&&c.totalTime(c._tTime),c=c._dp;r._zTime=-pi}},pd=function(r,a,c,l){return a.parent&&uf(a),a._start=Yi((Rh(c)?c:c||r!==qi?nl(r,c,a):r._time)+a._delay),a._end=Yi(a._start+(a.totalDuration()/Math.abs(a.timeScale())||0)),UZ(r,a,"_first","_last",r._sort?"_start":0),DM(a)||(r._recent=a),l||VZ(r,a),r._ts<0&&HO(r,r._tTime),r},FZ=function(r,a){return(_c.ScrollTrigger||UU("scrollTrigger",a))&&_c.ScrollTrigger.create(a,r)},jZ=function(r,a,c,l,h){if(GU(r,a,h),!r._initted)return 1;if(!c&&r._pt&&!ga&&(r._dur&&r.vars.lazy!==!1||!r._dur&&r.vars.lazy)&&kZ!==uc.frame)return nf.push(r),r._lazy=[h,l],1},QNe=function i(r){var a=r.parent;return a&&a._ts&&a._initted&&!a._lock&&(a.rawTime()<0||i(a))},DM=function(r){var a=r.data;return a==="isFromStart"||a==="isStart"},ZNe=function(r,a,c,l){var h=r.ratio,m=a<0||!a&&(!r._start&&QNe(r)&&!(!r._initted&&DM(r))||(r._ts<0||r._dp._ts<0)&&!DM(r))?0:1,E=r._rDelay,S=0,T,C,I;if(E&&r._repeat&&(S=Gw(0,r._tDur,a),C=Jy(S,E),r._yoyo&&C&1&&(m=1-m),C!==Jy(r._tTime,E)&&(h=1-m,r.vars.repeatRefresh&&r._initted&&r.invalidate())),m!==h||ga||l||r._zTime===pi||!a&&r._zTime){if(!r._initted&&jZ(r,a,l,c,S))return;for(I=r._zTime,r._zTime=a||(c?pi:0),c||(c=a&&!I),r.ratio=m,r._from&&(m=1-m),r._time=0,r._tTime=S,T=r._pt;T;)T.r(m,T.d),T=T._next;a<0&&kM(r,a,c,!0),r._onUpdate&&!c&&dc(r,"onUpdate"),S&&r._repeat&&!c&&r.parent&&dc(r,"onRepeat"),(a>=r._tDur||a<0)&&r.ratio===m&&(m&&uf(r,1),!c&&!ga&&(dc(r,m?"onComplete":"onReverseComplete",!0),r._prom&&r._prom()))}else r._zTime||(r._zTime=a)},ePe=function(r,a,c){var l;if(c>a)for(l=r._first;l&&l._start<=c;){if(l.data==="isPause"&&l._start>a)return l;l=l._next}else for(l=r._last;l&&l._start>=c;){if(l.data==="isPause"&&l._start<a)return l;l=l._prev}},$y=function(r,a,c,l){var h=r._repeat,m=Yi(a)||0,E=r._tTime/r._tDur;return E&&!l&&(r._time*=m/r._dur),r._dur=m,r._tDur=h?h<0?1e10:Yi(m*(h+1)+r._rDelay*h):m,E>0&&!l&&HO(r,r._tTime=r._tDur*E),r.parent&&GO(r),c||Ig(r.parent,r),r},rY=function(r){return r instanceof $a?Ig(r):$y(r,r._dur)},tPe={_start:0,endTime:yw,totalDuration:yw},nl=function i(r,a,c){var l=r.labels,h=r._recent||tPe,m=r.duration()>=sl?h.endTime(!1):r._dur,E,S,T;return Js(a)&&(isNaN(a)||a in l)?(S=a.charAt(0),T=a.substr(-1)==="%",E=a.indexOf("="),S==="<"||S===">"?(E>=0&&(a=a.replace(/=/,"")),(S==="<"?h._start:h.endTime(h._repeat>=0))+(parseFloat(a.substr(1))||0)*(T?(E<0?h:c).totalDuration()/100:1)):E<0?(a in l||(l[a]=m),l[a]):(S=parseFloat(a.charAt(E-1)+a.substr(E+1)),T&&c&&(S=S/100*(La(c)?c[0]:c).totalDuration()),E>1?i(r,a.substr(0,E-1),c)+S:m+S)):a==null?m:+a},J0=function(r,a,c){var l=Rh(a[1]),h=(l?2:1)+(r<2?0:1),m=a[h],E,S;if(l&&(m.duration=a[1]),m.parent=c,r){for(E=m,S=c;S&&!("immediateRender"in E);)E=S.vars.defaults||{},S=Po(S.vars.inherit)&&S.parent;m.immediateRender=Po(E.immediateRender),r<2?m.runBackwards=1:m.startAt=a[h-1]}return new Rs(a[0],m,a[h+1])},Sf=function(r,a){return r||r===0?a(r):a},Gw=function(r,a,c){return c<r?r:c>a?a:c},ka=function(r,a){return!Js(r)||!(a=HNe.exec(r))?"":a[1]},nPe=function(r,a,c){return Sf(c,function(l){return Gw(r,a,l)})},xM=[].slice,BZ=function(r,a){return r&&Rd(r)&&"length"in r&&(!a&&!r.length||r.length-1 in r&&Rd(r[0]))&&!r.nodeType&&r!==hd},rPe=function(r,a,c){return c===void 0&&(c=[]),r.forEach(function(l){var h;return Js(l)&&!a||BZ(l,1)?(h=c).push.apply(h,al(l)):c.push(l)})||c},al=function(r,a,c){return Vi&&!a&&Vi.selector?Vi.selector(r):Js(r)&&!c&&(NM||!Qy())?xM.call((a||MU).querySelectorAll(r),0):La(r)?rPe(r,c):BZ(r)?xM.call(r,0):r?[r]:[]},LM=function(r){return r=al(r)[0]||Ew("Invalid scope")||{},function(a){var c=r.current||r.nativeElement||r;return al(a,c.querySelectorAll?c:c===r?Ew("Invalid scope")||MU.createElement("div"):r)}},WZ=function(r){return r.sort(function(){return .5-Math.random()})},GZ=function(r){if(as(r))return r;var a=Rd(r)?r:{each:r},c=Ag(a.ease),l=a.from||0,h=parseFloat(a.base)||0,m={},E=l>0&&l<1,S=isNaN(l)||E,T=a.axis,C=l,I=l;return Js(l)?C=I={center:.5,edges:.5,end:1}[l]||0:!E&&S&&(C=l[0],I=l[1]),function(N,P,H){var x=(H||a).length,B=m[x],X,Z,$,le,re,ce,te,pe,Ee;if(!B){if(Ee=a.grid==="auto"?0:(a.grid||[1,sl])[1],!Ee){for(te=-sl;te<(te=H[Ee++].getBoundingClientRect().left)&&Ee<x;);Ee<x&&Ee--}for(B=m[x]=[],X=S?Math.min(Ee,x)*C-.5:l%Ee,Z=Ee===sl?0:S?x*I/Ee-.5:l/Ee|0,te=0,pe=sl,ce=0;ce<x;ce++)$=ce%Ee-X,le=Z-(ce/Ee|0),B[ce]=re=T?Math.abs(T==="y"?le:$):RZ($*$+le*le),re>te&&(te=re),re<pe&&(pe=re);l==="random"&&WZ(B),B.max=te-pe,B.min=pe,B.v=x=(parseFloat(a.amount)||parseFloat(a.each)*(Ee>x?x-1:T?T==="y"?x/Ee:Ee:Math.max(Ee,x/Ee))||0)*(l==="edges"?-1:1),B.b=x<0?h-x:h,B.u=ka(a.amount||a.each)||0,c=c&&x<0?ZZ(c):c}return x=(B[N]-B.min)/B.max||0,Yi(B.b+(c?c(x):x)*B.v)+B.u}},MM=function(r){var a=Math.pow(10,((r+"").split(".")[1]||"").length);return function(c){var l=Yi(Math.round(parseFloat(c)/r)*r*a);return(l-l%1)/a+(Rh(c)?0:ka(c))}},HZ=function(r,a){var c=La(r),l,h;return!c&&Rd(r)&&(l=c=r.radius||sl,r.values?(r=al(r.values),(h=!Rh(r[0]))&&(l*=l)):r=MM(r.increment)),Sf(a,c?as(r)?function(m){return h=r(m),Math.abs(h-m)<=l?h:m}:function(m){for(var E=parseFloat(h?m.x:m),S=parseFloat(h?m.y:0),T=sl,C=0,I=r.length,N,P;I--;)h?(N=r[I].x-E,P=r[I].y-S,N=N*N+P*P):N=Math.abs(r[I]-E),N<T&&(T=N,C=I);return C=!l||T<=l?r[C]:m,h||C===m||Rh(m)?C:C+ka(m)}:MM(r))},zZ=function(r,a,c,l){return Sf(La(r)?!a:c===!0?!!(c=0):!l,function(){return La(r)?r[~~(Math.random()*r.length)]:(c=c||1e-5)&&(l=c<1?Math.pow(10,(c+"").length-2):1)&&Math.floor(Math.round((r-c/2+Math.random()*(a-r+c*.99))/c)*c*l)/l})},iPe=function(){for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];return function(l){return a.reduce(function(h,m){return m(h)},l)}},sPe=function(r,a){return function(c){return r(parseFloat(c))+(a||ka(c))}},aPe=function(r,a,c){return YZ(r,a,0,1,c)},KZ=function(r,a,c){return Sf(c,function(l){return r[~~a(l)]})},oPe=function i(r,a,c){var l=a-r;return La(r)?KZ(r,i(0,r.length),a):Sf(c,function(h){return(l+(h-r)%l)%l+r})},cPe=function i(r,a,c){var l=a-r,h=l*2;return La(r)?KZ(r,i(0,r.length-1),a):Sf(c,function(m){return m=(h+(m-r)%h)%h||0,r+(m>l?h-m:m)})},vw=function(r){return r.replace(BNe,function(a){var c=a.indexOf("[")+1,l=a.substring(c||7,c?a.indexOf("]"):a.length-1).split(WNe);return zZ(c?l:+l[0],c?0:+l[1],+l[2]||1e-5)})},YZ=function(r,a,c,l,h){var m=a-r,E=l-c;return Sf(h,function(S){return c+((S-r)/m*E||0)})},lPe=function i(r,a,c,l){var h=isNaN(r+a)?0:function(P){return(1-P)*r+P*a};if(!h){var m=Js(r),E={},S,T,C,I,N;if(c===!0&&(l=1)&&(c=null),m)r={p:r},a={p:a};else if(La(r)&&!La(a)){for(C=[],I=r.length,N=I-2,T=1;T<I;T++)C.push(i(r[T-1],r[T]));I--,h=function(H){H*=I;var x=Math.min(N,~~H);return C[x](H-x)},c=a}else l||(r=Xy(La(r)?[]:{},r));if(!C){for(S in a)WU.call(E,r,S,"get",a[S]);h=function(H){return KU(H,E)||(m?r.p:r)}}}return Sf(c,h)},iY=function(r,a,c){var l=r.labels,h=sl,m,E,S;for(m in l)E=l[m]-a,E<0==!!c&&E&&h>(E=Math.abs(E))&&(S=m,h=E);return S},dc=function(r,a,c){var l=r.vars,h=l[a],m=Vi,E=r._ctx,S,T,C;if(h)return S=l[a+"Params"],T=l.callbackScope||r,c&&nf.length&&tO(),E&&(Vi=E),C=S?h.apply(T,S):h.call(T),Vi=m,C},x0=function(r){return uf(r),r.scrollTrigger&&r.scrollTrigger.kill(!!ga),r.progress()<1&&dc(r,"onInterrupt"),r},Iy,qZ=[],XZ=function(r){if(r)if(r=!r.name&&r.default||r,LU()||r.headless){var a=r.name,c=as(r),l=a&&!c&&r.init?function(){this._props=[]}:r,h={init:yw,render:KU,add:WU,kill:RPe,modifier:CPe,rawVars:0},m={targetTest:0,get:0,getSetter:zU,aliases:{},register:0};if(Qy(),r!==l){if(cc[a])return;Ec(l,Ec(nO(r,h),m)),Xy(l.prototype,Xy(h,nO(r,m))),cc[l.prop=a]=l,r.targetTest&&(TA.push(l),VU[a]=1),a=(a==="css"?"CSS":a.charAt(0).toUpperCase()+a.substr(1))+"Plugin"}PZ(a,l),r.register&&r.register(Mo,l,Do)}else qZ.push(r)},di=255,L0={aqua:[0,di,di],lime:[0,di,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,di],navy:[0,0,128],white:[di,di,di],olive:[128,128,0],yellow:[di,di,0],orange:[di,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[di,0,0],pink:[di,192,203],cyan:[0,di,di],transparent:[di,di,di,0]},cL=function(r,a,c){return r+=r<0?1:r>1?-1:0,(r*6<1?a+(c-a)*r*6:r<.5?c:r*3<2?a+(c-a)*(2/3-r)*6:a)*di+.5|0},JZ=function(r,a,c){var l=r?Rh(r)?[r>>16,r>>8&di,r&di]:0:L0.black,h,m,E,S,T,C,I,N,P,H;if(!l){if(r.substr(-1)===","&&(r=r.substr(0,r.length-1)),L0[r])l=L0[r];else if(r.charAt(0)==="#"){if(r.length<6&&(h=r.charAt(1),m=r.charAt(2),E=r.charAt(3),r="#"+h+h+m+m+E+E+(r.length===5?r.charAt(4)+r.charAt(4):"")),r.length===9)return l=parseInt(r.substr(1,6),16),[l>>16,l>>8&di,l&di,parseInt(r.substr(7),16)/255];r=parseInt(r.substr(1),16),l=[r>>16,r>>8&di,r&di]}else if(r.substr(0,3)==="hsl"){if(l=H=r.match(Z7),!a)S=+l[0]%360/360,T=+l[1]/100,C=+l[2]/100,m=C<=.5?C*(T+1):C+T-C*T,h=C*2-m,l.length>3&&(l[3]*=1),l[0]=cL(S+1/3,h,m),l[1]=cL(S,h,m),l[2]=cL(S-1/3,h,m);else if(~r.indexOf("="))return l=r.match(IZ),c&&l.length<4&&(l[3]=1),l}else l=r.match(Z7)||L0.transparent;l=l.map(Number)}return a&&!H&&(h=l[0]/di,m=l[1]/di,E=l[2]/di,I=Math.max(h,m,E),N=Math.min(h,m,E),C=(I+N)/2,I===N?S=T=0:(P=I-N,T=C>.5?P/(2-I-N):P/(I+N),S=I===h?(m-E)/P+(m<E?6:0):I===m?(E-h)/P+2:(h-m)/P+4,S*=60),l[0]=~~(S+.5),l[1]=~~(T*100+.5),l[2]=~~(C*100+.5)),c&&l.length<4&&(l[3]=1),l},$Z=function(r){var a=[],c=[],l=-1;return r.split(rf).forEach(function(h){var m=h.match(by)||[];a.push.apply(a,m),c.push(l+=m.length+1)}),a.c=c,a},sY=function(r,a,c){var l="",h=(r+l).match(rf),m=a?"hsla(":"rgba(",E=0,S,T,C,I;if(!h)return r;if(h=h.map(function(N){return(N=JZ(N,a,1))&&m+(a?N[0]+","+N[1]+"%,"+N[2]+"%,"+N[3]:N.join(","))+")"}),c&&(C=$Z(r),S=c.c,S.join(l)!==C.c.join(l)))for(T=r.replace(rf,"1").split(by),I=T.length-1;E<I;E++)l+=T[E]+(~S.indexOf(E)?h.shift()||m+"0,0,0,0)":(C.length?C:h.length?h:c).shift());if(!T)for(T=r.split(rf),I=T.length-1;E<I;E++)l+=T[E]+h[E];return l+T[I]},rf=(function(){var i="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",r;for(r in L0)i+="|"+r+"\\b";return new RegExp(i+")","gi")})(),uPe=/hsl[a]?\(/,QZ=function(r){var a=r.join(" "),c;if(rf.lastIndex=0,rf.test(a))return c=uPe.test(a),r[1]=sY(r[1],c),r[0]=sY(r[0],c,$Z(r[1])),!0},Sw,uc=(function(){var i=Date.now,r=500,a=33,c=i(),l=c,h=1e3/240,m=h,E=[],S,T,C,I,N,P,H=function x(B){var X=i()-l,Z=B===!0,$,le,re,ce;if((X>r||X<0)&&(c+=X-a),l+=X,re=l-c,$=re-m,($>0||Z)&&(ce=++I.frame,N=re-I.time*1e3,I.time=re=re/1e3,m+=$+($>=h?4:h-$),le=1),Z||(S=T(x)),le)for(P=0;P<E.length;P++)E[P](re,N,ce,B)};return I={time:0,frame:0,tick:function(){H(!0)},deltaRatio:function(B){return N/(1e3/(B||60))},wake:function(){OZ&&(!NM&&LU()&&(hd=NM=window,MU=hd.document||{},_c.gsap=Mo,(hd.gsapVersions||(hd.gsapVersions=[])).push(Mo.version),NZ(eO||hd.GreenSockGlobals||!hd.gsap&&hd||{}),qZ.forEach(XZ)),C=typeof requestAnimationFrame<"u"&&requestAnimationFrame,S&&I.sleep(),T=C||function(B){return setTimeout(B,m-I.time*1e3+1|0)},Sw=1,H(2))},sleep:function(){(C?cancelAnimationFrame:clearTimeout)(S),Sw=0,T=yw},lagSmoothing:function(B,X){r=B||1/0,a=Math.min(X||33,r)},fps:function(B){h=1e3/(B||240),m=I.time*1e3+h},add:function(B,X,Z){var $=X?function(le,re,ce,te){B(le,re,ce,te),I.remove($)}:B;return I.remove(B),E[Z?"unshift":"push"]($),Qy(),$},remove:function(B,X){~(X=E.indexOf(B))&&E.splice(X,1)&&P>=X&&P--},_listeners:E},I})(),Qy=function(){return!Sw&&uc.wake()},pr={},dPe=/^[\d.\-M][\d.\-,\s]/,hPe=/["']/g,pPe=function(r){for(var a={},c=r.substr(1,r.length-3).split(":"),l=c[0],h=1,m=c.length,E,S,T;h<m;h++)S=c[h],E=h!==m-1?S.lastIndexOf(","):S.length,T=S.substr(0,E),a[l]=isNaN(T)?T.replace(hPe,"").trim():+T,l=S.substr(E+1).trim();return a},fPe=function(r){var a=r.indexOf("(")+1,c=r.indexOf(")"),l=r.indexOf("(",a);return r.substring(a,~l&&l<c?r.indexOf(")",c+1):c)},mPe=function(r){var a=(r+"").split("("),c=pr[a[0]];return c&&a.length>1&&c.config?c.config.apply(null,~r.indexOf("{")?[pPe(a[1])]:fPe(r).split(",").map(LZ)):pr._CE&&dPe.test(r)?pr._CE("",r):c},ZZ=function(r){return function(a){return 1-r(1-a)}},eee=function i(r,a){for(var c=r._first,l;c;)c instanceof $a?i(c,a):c.vars.yoyoEase&&(!c._yoyo||!c._repeat)&&c._yoyo!==a&&(c.timeline?i(c.timeline,a):(l=c._ease,c._ease=c._yEase,c._yEase=l,c._yoyo=a)),c=c._next},Ag=function(r,a){return r&&(as(r)?r:pr[r]||mPe(r))||a},Bg=function(r,a,c,l){c===void 0&&(c=function(S){return 1-a(1-S)}),l===void 0&&(l=function(S){return S<.5?a(S*2)/2:1-a((1-S)*2)/2});var h={easeIn:a,easeOut:c,easeInOut:l},m;return ko(r,function(E){pr[E]=_c[E]=h,pr[m=E.toLowerCase()]=c;for(var S in h)pr[m+(S==="easeIn"?".in":S==="easeOut"?".out":".inOut")]=pr[E+"."+S]=h[S]}),h},tee=function(r){return function(a){return a<.5?(1-r(1-a*2))/2:.5+r((a-.5)*2)/2}},lL=function i(r,a,c){var l=a>=1?a:1,h=(c||(r?.3:.45))/(a<1?a:1),m=h/OM*(Math.asin(1/l)||0),E=function(C){return C===1?1:l*Math.pow(2,-10*C)*jNe((C-m)*h)+1},S=r==="out"?E:r==="in"?function(T){return 1-E(1-T)}:tee(E);return h=OM/h,S.config=function(T,C){return i(r,T,C)},S},uL=function i(r,a){a===void 0&&(a=1.70158);var c=function(m){return m?--m*m*((a+1)*m+a)+1:0},l=r==="out"?c:r==="in"?function(h){return 1-c(1-h)}:tee(c);return l.config=function(h){return i(r,h)},l};ko("Linear,Quad,Cubic,Quart,Quint,Strong",function(i,r){var a=r<5?r+1:r;Bg(i+",Power"+(a-1),r?function(c){return Math.pow(c,a)}:function(c){return c},function(c){return 1-Math.pow(1-c,a)},function(c){return c<.5?Math.pow(c*2,a)/2:1-Math.pow((1-c)*2,a)/2})});pr.Linear.easeNone=pr.none=pr.Linear.easeIn;Bg("Elastic",lL("in"),lL("out"),lL());(function(i,r){var a=1/r,c=2*a,l=2.5*a,h=function(E){return E<a?i*E*E:E<c?i*Math.pow(E-1.5/r,2)+.75:E<l?i*(E-=2.25/r)*E+.9375:i*Math.pow(E-2.625/r,2)+.984375};Bg("Bounce",function(m){return 1-h(1-m)},h)})(7.5625,2.75);Bg("Expo",function(i){return Math.pow(2,10*(i-1))*i+i*i*i*i*i*i*(1-i)});Bg("Circ",function(i){return-(RZ(1-i*i)-1)});Bg("Sine",function(i){return i===1?1:-FNe(i*UNe)+1});Bg("Back",uL("in"),uL("out"),uL());pr.SteppedEase=pr.steps=_c.SteppedEase={config:function(r,a){r===void 0&&(r=1);var c=1/r,l=r+(a?0:1),h=a?1:0,m=1-pi;return function(E){return((l*Gw(0,m,E)|0)+h)*c}}};qy.ease=pr["quad.out"];ko("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(i){return FU+=i+","+i+"Params,"});var nee=function(r,a){this.id=VNe++,r._gsap=this,this.target=r,this.harness=a,this.get=a?a.get:DZ,this.set=a?a.getSetter:zU},Tw=(function(){function i(a){this.vars=a,this._delay=+a.delay||0,(this._repeat=a.repeat===1/0?-2:a.repeat||0)&&(this._rDelay=a.repeatDelay||0,this._yoyo=!!a.yoyo||!!a.yoyoEase),this._ts=1,$y(this,+a.duration,1,1),this.data=a.data,Vi&&(this._ctx=Vi,Vi.data.push(this)),Sw||uc.wake()}var r=i.prototype;return r.delay=function(c){return c||c===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+c-this._delay),this._delay=c,this):this._delay},r.duration=function(c){return arguments.length?this.totalDuration(this._repeat>0?c+(c+this._rDelay)*this._repeat:c):this.totalDuration()&&this._dur},r.totalDuration=function(c){return arguments.length?(this._dirty=0,$y(this,this._repeat<0?c:(c-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},r.totalTime=function(c,l){if(Qy(),!arguments.length)return this._tTime;var h=this._dp;if(h&&h.smoothChildTiming&&this._ts){for(HO(this,c),!h._dp||h.parent||VZ(h,this);h&&h.parent;)h.parent._time!==h._start+(h._ts>=0?h._tTime/h._ts:(h.totalDuration()-h._tTime)/-h._ts)&&h.totalTime(h._tTime,!0),h=h.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&c<this._tDur||this._ts<0&&c>0||!this._tDur&&!c)&&pd(this._dp,this,this._start-this._delay)}return(this._tTime!==c||!this._dur&&!l||this._initted&&Math.abs(this._zTime)===pi||!this._initted&&this._dur&&c||!c&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=c),xZ(this,c,l)),this},r.time=function(c,l){return arguments.length?this.totalTime(Math.min(this.totalDuration(),c+nY(this))%(this._dur+this._rDelay)||(c?this._dur:0),l):this._time},r.totalProgress=function(c,l){return arguments.length?this.totalTime(this.totalDuration()*c,l):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},r.progress=function(c,l){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-c:c)+nY(this),l):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},r.iteration=function(c,l){var h=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(c-1)*h,l):this._repeat?Jy(this._tTime,h)+1:1},r.timeScale=function(c,l){if(!arguments.length)return this._rts===-pi?0:this._rts;if(this._rts===c)return this;var h=this.parent&&this._ts?rO(this.parent._time,this):this._tTime;return this._rts=+c||0,this._ts=this._ps||c===-pi?0:this._rts,this.totalTime(Gw(-Math.abs(this._delay),this.totalDuration(),h),l!==!1),GO(this),JNe(this)},r.paused=function(c){return arguments.length?(this._ps!==c&&(this._ps=c,c?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Qy(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==pi&&(this._tTime-=pi)))),this):this._ps},r.startTime=function(c){if(arguments.length){this._start=Yi(c);var l=this.parent||this._dp;return l&&(l._sort||!this.parent)&&pd(l,this,this._start-this._delay),this}return this._start},r.endTime=function(c){return this._start+(Po(c)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},r.rawTime=function(c){var l=this.parent||this._dp;return l?c&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?rO(l.rawTime(c),this):this._tTime:this._tTime},r.revert=function(c){c===void 0&&(c=KNe);var l=ga;return ga=c,BU(this)&&(this.timeline&&this.timeline.revert(c),this.totalTime(-.01,c.suppressEvents)),this.data!=="nested"&&c.kill!==!1&&this.kill(),ga=l,this},r.globalTime=function(c){for(var l=this,h=arguments.length?c:l.rawTime();l;)h=l._start+h/(Math.abs(l._ts)||1),l=l._dp;return!this.parent&&this._sat?this._sat.globalTime(c):h},r.repeat=function(c){return arguments.length?(this._repeat=c===1/0?-2:c,rY(this)):this._repeat===-2?1/0:this._repeat},r.repeatDelay=function(c){if(arguments.length){var l=this._time;return this._rDelay=c,rY(this),l?this.time(l):this}return this._rDelay},r.yoyo=function(c){return arguments.length?(this._yoyo=c,this):this._yoyo},r.seek=function(c,l){return this.totalTime(nl(this,c),Po(l))},r.restart=function(c,l){return this.play().totalTime(c?-this._delay:0,Po(l)),this._dur||(this._zTime=-pi),this},r.play=function(c,l){return c!=null&&this.seek(c,l),this.reversed(!1).paused(!1)},r.reverse=function(c,l){return c!=null&&this.seek(c||this.totalDuration(),l),this.reversed(!0).paused(!1)},r.pause=function(c,l){return c!=null&&this.seek(c,l),this.paused(!0)},r.resume=function(){return this.paused(!1)},r.reversed=function(c){return arguments.length?(!!c!==this.reversed()&&this.timeScale(-this._rts||(c?-pi:0)),this):this._rts<0},r.invalidate=function(){return this._initted=this._act=0,this._zTime=-pi,this},r.isActive=function(){var c=this.parent||this._dp,l=this._start,h;return!!(!c||this._ts&&this._initted&&c.isActive()&&(h=c.rawTime(!0))>=l&&h<this.endTime(!0)-pi)},r.eventCallback=function(c,l,h){var m=this.vars;return arguments.length>1?(l?(m[c]=l,h&&(m[c+"Params"]=h),c==="onUpdate"&&(this._onUpdate=l)):delete m[c],this):m[c]},r.then=function(c){var l=this,h=l._prom;return new Promise(function(m){var E=as(c)?c:MZ,S=function(){var C=l.then;l.then=null,h&&h(),as(E)&&(E=E(l))&&(E.then||E===l)&&(l.then=C),m(E),l.then=C};l._initted&&l.totalProgress()===1&&l._ts>=0||!l._tTime&&l._ts<0?S():l._prom=S})},r.kill=function(){x0(this)},i})();Ec(Tw.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-pi,_prom:0,_ps:!1,_rts:1});var $a=(function(i){CZ(r,i);function r(c,l){var h;return c===void 0&&(c={}),h=i.call(this,c)||this,h.labels={},h.smoothChildTiming=!!c.smoothChildTiming,h.autoRemoveChildren=!!c.autoRemoveChildren,h._sort=Po(c.sortChildren),qi&&pd(c.parent||qi,uh(h),l),c.reversed&&h.reverse(),c.paused&&h.paused(!0),c.scrollTrigger&&FZ(uh(h),c.scrollTrigger),h}var a=r.prototype;return a.to=function(l,h,m){return J0(0,arguments,this),this},a.from=function(l,h,m){return J0(1,arguments,this),this},a.fromTo=function(l,h,m,E){return J0(2,arguments,this),this},a.set=function(l,h,m){return h.duration=0,h.parent=this,X0(h).repeatDelay||(h.repeat=0),h.immediateRender=!!h.immediateRender,new Rs(l,h,nl(this,m),1),this},a.call=function(l,h,m){return pd(this,Rs.delayedCall(0,l,h),m)},a.staggerTo=function(l,h,m,E,S,T,C){return m.duration=h,m.stagger=m.stagger||E,m.onComplete=T,m.onCompleteParams=C,m.parent=this,new Rs(l,m,nl(this,S)),this},a.staggerFrom=function(l,h,m,E,S,T,C){return m.runBackwards=1,X0(m).immediateRender=Po(m.immediateRender),this.staggerTo(l,h,m,E,S,T,C)},a.staggerFromTo=function(l,h,m,E,S,T,C,I){return E.startAt=m,X0(E).immediateRender=Po(E.immediateRender),this.staggerTo(l,h,E,S,T,C,I)},a.render=function(l,h,m){var E=this._time,S=this._dirty?this.totalDuration():this._tDur,T=this._dur,C=l<=0?0:Yi(l),I=this._zTime<0!=l<0&&(this._initted||!T),N,P,H,x,B,X,Z,$,le,re,ce,te;if(this!==qi&&C>S&&l>=0&&(C=S),C!==this._tTime||m||I){if(E!==this._time&&T&&(C+=this._time-E,l+=this._time-E),N=C,le=this._start,$=this._ts,X=!$,I&&(T||(E=this._zTime),(l||!h)&&(this._zTime=l)),this._repeat){if(ce=this._yoyo,B=T+this._rDelay,this._repeat<-1&&l<0)return this.totalTime(B*100+l,h,m);if(N=Yi(C%B),C===S?(x=this._repeat,N=T):(re=Yi(C/B),x=~~re,x&&x===re&&(N=T,x--),N>T&&(N=T)),re=Jy(this._tTime,B),!E&&this._tTime&&re!==x&&this._tTime-re*B-this._dur<=0&&(re=x),ce&&x&1&&(N=T-N,te=1),x!==re&&!this._lock){var pe=ce&&re&1,Ee=pe===(ce&&x&1);if(x<re&&(pe=!pe),E=pe?0:C%T?T:C,this._lock=1,this.render(E||(te?0:Yi(x*B)),h,!T)._lock=0,this._tTime=C,!h&&this.parent&&dc(this,"onRepeat"),this.vars.repeatRefresh&&!te&&(this.invalidate()._lock=1,re=x),E&&E!==this._time||X!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(T=this._dur,S=this._tDur,Ee&&(this._lock=2,E=pe?T:-1e-4,this.render(E,!0),this.vars.repeatRefresh&&!te&&this.invalidate()),this._lock=0,!this._ts&&!X)return this;eee(this,te)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(Z=ePe(this,Yi(E),Yi(N)),Z&&(C-=N-(N=Z._start))),this._tTime=C,this._time=N,this._act=!$,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=l,E=0),!E&&C&&T&&!h&&!re&&(dc(this,"onStart"),this._tTime!==C))return this;if(N>=E&&l>=0)for(P=this._first;P;){if(H=P._next,(P._act||N>=P._start)&&P._ts&&Z!==P){if(P.parent!==this)return this.render(l,h,m);if(P.render(P._ts>0?(N-P._start)*P._ts:(P._dirty?P.totalDuration():P._tDur)+(N-P._start)*P._ts,h,m),N!==this._time||!this._ts&&!X){Z=0,H&&(C+=this._zTime=-pi);break}}P=H}else{P=this._last;for(var Ne=l<0?l:N;P;){if(H=P._prev,(P._act||Ne<=P._end)&&P._ts&&Z!==P){if(P.parent!==this)return this.render(l,h,m);if(P.render(P._ts>0?(Ne-P._start)*P._ts:(P._dirty?P.totalDuration():P._tDur)+(Ne-P._start)*P._ts,h,m||ga&&BU(P)),N!==this._time||!this._ts&&!X){Z=0,H&&(C+=this._zTime=Ne?-pi:pi);break}}P=H}}if(Z&&!h&&(this.pause(),Z.render(N>=E?0:-pi)._zTime=N>=E?1:-1,this._ts))return this._start=le,GO(this),this.render(l,h,m);this._onUpdate&&!h&&dc(this,"onUpdate",!0),(C===S&&this._tTime>=this.totalDuration()||!C&&E)&&(le===this._start||Math.abs($)!==Math.abs(this._ts))&&(this._lock||((l||!T)&&(C===S&&this._ts>0||!C&&this._ts<0)&&uf(this,1),!h&&!(l<0&&!E)&&(C||E||!S)&&(dc(this,C===S&&l>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(C<S&&this.timeScale()>0)&&this._prom())))}return this},a.add=function(l,h){var m=this;if(Rh(h)||(h=nl(this,h,l)),!(l instanceof Tw)){if(La(l))return l.forEach(function(E){return m.add(E,h)}),this;if(Js(l))return this.addLabel(l,h);if(as(l))l=Rs.delayedCall(0,l);else return this}return this!==l?pd(this,l,h):this},a.getChildren=function(l,h,m,E){l===void 0&&(l=!0),h===void 0&&(h=!0),m===void 0&&(m=!0),E===void 0&&(E=-sl);for(var S=[],T=this._first;T;)T._start>=E&&(T instanceof Rs?h&&S.push(T):(m&&S.push(T),l&&S.push.apply(S,T.getChildren(!0,h,m)))),T=T._next;return S},a.getById=function(l){for(var h=this.getChildren(1,1,1),m=h.length;m--;)if(h[m].vars.id===l)return h[m]},a.remove=function(l){return Js(l)?this.removeLabel(l):as(l)?this.killTweensOf(l):(l.parent===this&&WO(this,l),l===this._recent&&(this._recent=this._last),Ig(this))},a.totalTime=function(l,h){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Yi(uc.time-(this._ts>0?l/this._ts:(this.totalDuration()-l)/-this._ts))),i.prototype.totalTime.call(this,l,h),this._forcing=0,this):this._tTime},a.addLabel=function(l,h){return this.labels[l]=nl(this,h),this},a.removeLabel=function(l){return delete this.labels[l],this},a.addPause=function(l,h,m){var E=Rs.delayedCall(0,h||yw,m);return E.data="isPause",this._hasPause=1,pd(this,E,nl(this,l))},a.removePause=function(l){var h=this._first;for(l=nl(this,l);h;)h._start===l&&h.data==="isPause"&&uf(h),h=h._next},a.killTweensOf=function(l,h,m){for(var E=this.getTweensOf(l,m),S=E.length;S--;)Jp!==E[S]&&E[S].kill(l,h);return this},a.getTweensOf=function(l,h){for(var m=[],E=al(l),S=this._first,T=Rh(h),C;S;)S instanceof Rs?YNe(S._targets,E)&&(T?(!Jp||S._initted&&S._ts)&&S.globalTime(0)<=h&&S.globalTime(S.totalDuration())>h:!h||S.isActive())&&m.push(S):(C=S.getTweensOf(E,h)).length&&m.push.apply(m,C),S=S._next;return m},a.tweenTo=function(l,h){h=h||{};var m=this,E=nl(m,l),S=h,T=S.startAt,C=S.onStart,I=S.onStartParams,N=S.immediateRender,P,H=Rs.to(m,Ec({ease:h.ease||"none",lazy:!1,immediateRender:!1,time:E,overwrite:"auto",duration:h.duration||Math.abs((E-(T&&"time"in T?T.time:m._time))/m.timeScale())||pi,onStart:function(){if(m.pause(),!P){var B=h.duration||Math.abs((E-(T&&"time"in T?T.time:m._time))/m.timeScale());H._dur!==B&&$y(H,B,0,1).render(H._time,!0,!0),P=1}C&&C.apply(H,I||[])}},h));return N?H.render(0):H},a.tweenFromTo=function(l,h,m){return this.tweenTo(h,Ec({startAt:{time:nl(this,l)}},m))},a.recent=function(){return this._recent},a.nextLabel=function(l){return l===void 0&&(l=this._time),iY(this,nl(this,l))},a.previousLabel=function(l){return l===void 0&&(l=this._time),iY(this,nl(this,l),1)},a.currentLabel=function(l){return arguments.length?this.seek(l,!0):this.previousLabel(this._time+pi)},a.shiftChildren=function(l,h,m){m===void 0&&(m=0);var E=this._first,S=this.labels,T;for(l=Yi(l);E;)E._start>=m&&(E._start+=l,E._end+=l),E=E._next;if(h)for(T in S)S[T]>=m&&(S[T]+=l);return Ig(this)},a.invalidate=function(l){var h=this._first;for(this._lock=0;h;)h.invalidate(l),h=h._next;return i.prototype.invalidate.call(this,l)},a.clear=function(l){l===void 0&&(l=!0);for(var h=this._first,m;h;)m=h._next,this.remove(h),h=m;return this._dp&&(this._time=this._tTime=this._pTime=0),l&&(this.labels={}),Ig(this)},a.totalDuration=function(l){var h=0,m=this,E=m._last,S=sl,T,C,I;if(arguments.length)return m.timeScale((m._repeat<0?m.duration():m.totalDuration())/(m.reversed()?-l:l));if(m._dirty){for(I=m.parent;E;)T=E._prev,E._dirty&&E.totalDuration(),C=E._start,C>S&&m._sort&&E._ts&&!m._lock?(m._lock=1,pd(m,E,C-E._delay,1)._lock=0):S=C,C<0&&E._ts&&(h-=C,(!I&&!m._dp||I&&I.smoothChildTiming)&&(m._start+=Yi(C/m._ts),m._time-=C,m._tTime-=C),m.shiftChildren(-C,!1,-1/0),S=0),E._end>h&&E._ts&&(h=E._end),E=T;$y(m,m===qi&&m._time>h?m._time:h,1,1),m._dirty=0}return m._tDur},r.updateRoot=function(l){if(qi._ts&&(xZ(qi,rO(l,qi)),kZ=uc.frame),uc.frame>=eY){eY+=gc.autoSleep||120;var h=qi._first;if((!h||!h._ts)&&gc.autoSleep&&uc._listeners.length<2){for(;h&&!h._ts;)h=h._next;h||uc.sleep()}}},r})(Tw);Ec($a.prototype,{_lock:0,_hasPause:0,_forcing:0});var gPe=function(r,a,c,l,h,m,E){var S=new Do(this._pt,r,a,0,1,cee,null,h),T=0,C=0,I,N,P,H,x,B,X,Z;for(S.b=c,S.e=l,c+="",l+="",(X=~l.indexOf("random("))&&(l=vw(l)),m&&(Z=[c,l],m(Z,r,a),c=Z[0],l=Z[1]),N=c.match(aL)||[];I=aL.exec(l);)H=I[0],x=l.substring(T,I.index),P?P=(P+1)%5:x.substr(-5)==="rgba("&&(P=1),H!==N[C++]&&(B=parseFloat(N[C-1])||0,S._pt={_next:S._pt,p:x||C===1?x:",",s:B,c:H.charAt(1)==="="?Vy(B,H)-B:parseFloat(H)-B,m:P&&P<4?Math.round:0},T=aL.lastIndex);return S.c=T<l.length?l.substring(T,l.length):"",S.fp=E,(AZ.test(l)||X)&&(S.e=0),this._pt=S,S},WU=function(r,a,c,l,h,m,E,S,T,C){as(l)&&(l=l(h||0,r,m));var I=r[a],N=c!=="get"?c:as(I)?T?r[a.indexOf("set")||!as(r["get"+a.substr(3)])?a:"get"+a.substr(3)](T):r[a]():I,P=as(I)?T?SPe:aee:HU,H;if(Js(l)&&(~l.indexOf("random(")&&(l=vw(l)),l.charAt(1)==="="&&(H=Vy(N,l)+(ka(N)||0),(H||H===0)&&(l=H))),!C||N!==l||UM)return!isNaN(N*l)&&l!==""?(H=new Do(this._pt,r,a,+N||0,l-(N||0),typeof I=="boolean"?wPe:oee,0,P),T&&(H.fp=T),E&&H.modifier(E,this,r),this._pt=H):(!I&&!(a in r)&&UU(a,l),gPe.call(this,r,a,N,l,P,S||gc.stringFilter,T))},_Pe=function(r,a,c,l,h){if(as(r)&&(r=$0(r,h,a,c,l)),!Rd(r)||r.style&&r.nodeType||La(r)||bZ(r))return Js(r)?$0(r,h,a,c,l):r;var m={},E;for(E in r)m[E]=$0(r[E],h,a,c,l);return m},ree=function(r,a,c,l,h,m){var E,S,T,C;if(cc[r]&&(E=new cc[r]).init(h,E.rawVars?a[r]:_Pe(a[r],l,h,m,c),c,l,m)!==!1&&(c._pt=S=new Do(c._pt,h,r,0,1,E.render,E,0,E.priority),c!==Iy))for(T=c._ptLookup[c._targets.indexOf(h)],C=E._props.length;C--;)T[E._props[C]]=S;return E},Jp,UM,GU=function i(r,a,c){var l=r.vars,h=l.ease,m=l.startAt,E=l.immediateRender,S=l.lazy,T=l.onUpdate,C=l.runBackwards,I=l.yoyoEase,N=l.keyframes,P=l.autoRevert,H=r._dur,x=r._startAt,B=r._targets,X=r.parent,Z=X&&X.data==="nested"?X.vars.targets:B,$=r._overwrite==="auto"&&!DU,le=r.timeline,re,ce,te,pe,Ee,Ne,Ue,Se,Xe,Re,Be,$e,Ge;if(le&&(!N||!h)&&(h="none"),r._ease=Ag(h,qy.ease),r._yEase=I?ZZ(Ag(I===!0?h:I,qy.ease)):0,I&&r._yoyo&&!r._repeat&&(I=r._yEase,r._yEase=r._ease,r._ease=I),r._from=!le&&!!l.runBackwards,!le||N&&!l.stagger){if(Se=B[0]?bg(B[0]).harness:0,$e=Se&&l[Se.prop],re=nO(l,VU),x&&(x._zTime<0&&x.progress(1),a<0&&C&&E&&!P?x.render(-1,!0):x.revert(C&&H?SA:zNe),x._lazy=0),m){if(uf(r._startAt=Rs.set(B,Ec({data:"isStart",overwrite:!1,parent:X,immediateRender:!0,lazy:!x&&Po(S),startAt:null,delay:0,onUpdate:T&&function(){return dc(r,"onUpdate")},stagger:0},m))),r._startAt._dp=0,r._startAt._sat=r,a<0&&(ga||!E&&!P)&&r._startAt.revert(SA),E&&H&&a<=0&&c<=0){a&&(r._zTime=a);return}}else if(C&&H&&!x){if(a&&(E=!1),te=Ec({overwrite:!1,data:"isFromStart",lazy:E&&!x&&Po(S),immediateRender:E,stagger:0,parent:X},re),$e&&(te[Se.prop]=$e),uf(r._startAt=Rs.set(B,te)),r._startAt._dp=0,r._startAt._sat=r,a<0&&(ga?r._startAt.revert(SA):r._startAt.render(-1,!0)),r._zTime=a,!E)i(r._startAt,pi,pi);else if(!a)return}for(r._pt=r._ptCache=0,S=H&&Po(S)||S&&!H,ce=0;ce<B.length;ce++){if(Ee=B[ce],Ue=Ee._gsap||jU(B)[ce]._gsap,r._ptLookup[ce]=Re={},PM[Ue.id]&&nf.length&&tO(),Be=Z===B?ce:Z.indexOf(Ee),Se&&(Xe=new Se).init(Ee,$e||re,r,Be,Z)!==!1&&(r._pt=pe=new Do(r._pt,Ee,Xe.name,0,1,Xe.render,Xe,0,Xe.priority),Xe._props.forEach(function(Ie){Re[Ie]=pe}),Xe.priority&&(Ne=1)),!Se||$e)for(te in re)cc[te]&&(Xe=ree(te,re,r,Be,Ee,Z))?Xe.priority&&(Ne=1):Re[te]=pe=WU.call(r,Ee,te,"get",re[te],Be,Z,0,l.stringFilter);r._op&&r._op[ce]&&r.kill(Ee,r._op[ce]),$&&r._pt&&(Jp=r,qi.killTweensOf(Ee,Re,r.globalTime(a)),Ge=!r.parent,Jp=0),r._pt&&S&&(PM[Ue.id]=1)}Ne&&lee(r),r._onInit&&r._onInit(r)}r._onUpdate=T,r._initted=(!r._op||r._pt)&&!Ge,N&&a<=0&&le.render(sl,!0,!0)},EPe=function(r,a,c,l,h,m,E,S){var T=(r._pt&&r._ptCache||(r._ptCache={}))[a],C,I,N,P;if(!T)for(T=r._ptCache[a]=[],N=r._ptLookup,P=r._targets.length;P--;){if(C=N[P][a],C&&C.d&&C.d._pt)for(C=C.d._pt;C&&C.p!==a&&C.fp!==a;)C=C._next;if(!C)return UM=1,r.vars[a]="+=0",GU(r,E),UM=0,S?Ew(a+" not eligible for reset"):1;T.push(C)}for(P=T.length;P--;)I=T[P],C=I._pt||I,C.s=(l||l===0)&&!h?l:C.s+(l||0)+m*C.c,C.c=c-C.s,I.e&&(I.e=ms(c)+ka(I.e)),I.b&&(I.b=C.s+ka(I.b))},yPe=function(r,a){var c=r[0]?bg(r[0]).harness:0,l=c&&c.aliases,h,m,E,S;if(!l)return a;h=Xy({},a);for(m in l)if(m in h)for(S=l[m].split(","),E=S.length;E--;)h[S[E]]=h[m];return h},vPe=function(r,a,c,l){var h=a.ease||l||"power1.inOut",m,E;if(La(a))E=c[r]||(c[r]=[]),a.forEach(function(S,T){return E.push({t:T/(a.length-1)*100,v:S,e:h})});else for(m in a)E=c[m]||(c[m]=[]),m==="ease"||E.push({t:parseFloat(r),v:a[m],e:h})},$0=function(r,a,c,l,h){return as(r)?r.call(a,c,l,h):Js(r)&&~r.indexOf("random(")?vw(r):r},iee=FU+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",see={};ko(iee+",id,stagger,delay,duration,paused,scrollTrigger",function(i){return see[i]=1});var Rs=(function(i){CZ(r,i);function r(c,l,h,m){var E;typeof l=="number"&&(h.duration=l,l=h,h=null),E=i.call(this,m?l:X0(l))||this;var S=E.vars,T=S.duration,C=S.delay,I=S.immediateRender,N=S.stagger,P=S.overwrite,H=S.keyframes,x=S.defaults,B=S.scrollTrigger,X=S.yoyoEase,Z=l.parent||qi,$=(La(c)||bZ(c)?Rh(c[0]):"length"in l)?[c]:al(c),le,re,ce,te,pe,Ee,Ne,Ue;if(E._targets=$.length?jU($):Ew("GSAP target "+c+" not found. https://gsap.com",!gc.nullTargetWarn)||[],E._ptLookup=[],E._overwrite=P,H||N||eA(T)||eA(C)){if(l=E.vars,le=E.timeline=new $a({data:"nested",defaults:x||{},targets:Z&&Z.data==="nested"?Z.vars.targets:$}),le.kill(),le.parent=le._dp=uh(E),le._start=0,N||eA(T)||eA(C)){if(te=$.length,Ne=N&&GZ(N),Rd(N))for(pe in N)~iee.indexOf(pe)&&(Ue||(Ue={}),Ue[pe]=N[pe]);for(re=0;re<te;re++)ce=nO(l,see),ce.stagger=0,X&&(ce.yoyoEase=X),Ue&&Xy(ce,Ue),Ee=$[re],ce.duration=+$0(T,uh(E),re,Ee,$),ce.delay=(+$0(C,uh(E),re,Ee,$)||0)-E._delay,!N&&te===1&&ce.delay&&(E._delay=C=ce.delay,E._start+=C,ce.delay=0),le.to(Ee,ce,Ne?Ne(re,Ee,$):0),le._ease=pr.none;le.duration()?T=C=0:E.timeline=0}else if(H){X0(Ec(le.vars.defaults,{ease:"none"})),le._ease=Ag(H.ease||l.ease||"none");var Se=0,Xe,Re,Be;if(La(H))H.forEach(function($e){return le.to($,$e,">")}),le.duration();else{ce={};for(pe in H)pe==="ease"||pe==="easeEach"||vPe(pe,H[pe],ce,H.easeEach);for(pe in ce)for(Xe=ce[pe].sort(function($e,Ge){return $e.t-Ge.t}),Se=0,re=0;re<Xe.length;re++)Re=Xe[re],Be={ease:Re.e,duration:(Re.t-(re?Xe[re-1].t:0))/100*T},Be[pe]=Re.v,le.to($,Be,Se),Se+=Be.duration;le.duration()<T&&le.to({},{duration:T-le.duration()})}}T||E.duration(T=le.duration())}else E.timeline=0;return P===!0&&!DU&&(Jp=uh(E),qi.killTweensOf($),Jp=0),pd(Z,uh(E),h),l.reversed&&E.reverse(),l.paused&&E.paused(!0),(I||!T&&!H&&E._start===Yi(Z._time)&&Po(I)&&$Ne(uh(E))&&Z.data!=="nested")&&(E._tTime=-pi,E.render(Math.max(0,-C)||0)),B&&FZ(uh(E),B),E}var a=r.prototype;return a.render=function(l,h,m){var E=this._time,S=this._tDur,T=this._dur,C=l<0,I=l>S-pi&&!C?S:l<pi?0:l,N,P,H,x,B,X,Z,$,le;if(!T)ZNe(this,l,h,m);else if(I!==this._tTime||!l||m||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==C||this._lazy){if(N=I,$=this.timeline,this._repeat){if(x=T+this._rDelay,this._repeat<-1&&C)return this.totalTime(x*100+l,h,m);if(N=Yi(I%x),I===S?(H=this._repeat,N=T):(B=Yi(I/x),H=~~B,H&&H===B?(N=T,H--):N>T&&(N=T)),X=this._yoyo&&H&1,X&&(le=this._yEase,N=T-N),B=Jy(this._tTime,x),N===E&&!m&&this._initted&&H===B)return this._tTime=I,this;H!==B&&($&&this._yEase&&eee($,X),this.vars.repeatRefresh&&!X&&!this._lock&&N!==x&&this._initted&&(this._lock=m=1,this.render(Yi(x*H),!0).invalidate()._lock=0))}if(!this._initted){if(jZ(this,C?l:N,m,h,I))return this._tTime=0,this;if(E!==this._time&&!(m&&this.vars.repeatRefresh&&H!==B))return this;if(T!==this._dur)return this.render(l,h,m)}if(this._tTime=I,this._time=N,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=Z=(le||this._ease)(N/T),this._from&&(this.ratio=Z=1-Z),!E&&I&&!h&&!B&&(dc(this,"onStart"),this._tTime!==I))return this;for(P=this._pt;P;)P.r(Z,P.d),P=P._next;$&&$.render(l<0?l:$._dur*$._ease(N/this._dur),h,m)||this._startAt&&(this._zTime=l),this._onUpdate&&!h&&(C&&kM(this,l,h,m),dc(this,"onUpdate")),this._repeat&&H!==B&&this.vars.onRepeat&&!h&&this.parent&&dc(this,"onRepeat"),(I===this._tDur||!I)&&this._tTime===I&&(C&&!this._onUpdate&&kM(this,l,!0,!0),(l||!T)&&(I===this._tDur&&this._ts>0||!I&&this._ts<0)&&uf(this,1),!h&&!(C&&!E)&&(I||E||X)&&(dc(this,I===S?"onComplete":"onReverseComplete",!0),this._prom&&!(I<S&&this.timeScale()>0)&&this._prom()))}return this},a.targets=function(){return this._targets},a.invalidate=function(l){return(!l||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(l),i.prototype.invalidate.call(this,l)},a.resetTo=function(l,h,m,E,S){Sw||uc.wake(),this._ts||this.play();var T=Math.min(this._dur,(this._dp._time-this._start)*this._ts),C;return this._initted||GU(this,T),C=this._ease(T/this._dur),EPe(this,l,h,m,E,C,T,S)?this.resetTo(l,h,m,E,1):(HO(this,0),this.parent||UZ(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},a.kill=function(l,h){if(h===void 0&&(h="all"),!l&&(!h||h==="all"))return this._lazy=this._pt=0,this.parent?x0(this):this.scrollTrigger&&this.scrollTrigger.kill(!!ga),this;if(this.timeline){var m=this.timeline.totalDuration();return this.timeline.killTweensOf(l,h,Jp&&Jp.vars.overwrite!==!0)._first||x0(this),this.parent&&m!==this.timeline.totalDuration()&&$y(this,this._dur*this.timeline._tDur/m,0,1),this}var E=this._targets,S=l?al(l):E,T=this._ptLookup,C=this._pt,I,N,P,H,x,B,X;if((!h||h==="all")&&XNe(E,S))return h==="all"&&(this._pt=0),x0(this);for(I=this._op=this._op||[],h!=="all"&&(Js(h)&&(x={},ko(h,function(Z){return x[Z]=1}),h=x),h=yPe(E,h)),X=E.length;X--;)if(~S.indexOf(E[X])){N=T[X],h==="all"?(I[X]=h,H=N,P={}):(P=I[X]=I[X]||{},H=h);for(x in H)B=N&&N[x],B&&((!("kill"in B.d)||B.d.kill(x)===!0)&&WO(this,B,"_pt"),delete N[x]),P!=="all"&&(P[x]=1)}return this._initted&&!this._pt&&C&&x0(this),this},r.to=function(l,h){return new r(l,h,arguments[2])},r.from=function(l,h){return J0(1,arguments)},r.delayedCall=function(l,h,m,E){return new r(h,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:l,onComplete:h,onReverseComplete:h,onCompleteParams:m,onReverseCompleteParams:m,callbackScope:E})},r.fromTo=function(l,h,m){return J0(2,arguments)},r.set=function(l,h){return h.duration=0,h.repeatDelay||(h.repeat=0),new r(l,h)},r.killTweensOf=function(l,h,m){return qi.killTweensOf(l,h,m)},r})(Tw);Ec(Rs.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});ko("staggerTo,staggerFrom,staggerFromTo",function(i){Rs[i]=function(){var r=new $a,a=xM.call(arguments,0);return a.splice(i==="staggerFromTo"?5:4,0,0),r[i].apply(r,a)}});var HU=function(r,a,c){return r[a]=c},aee=function(r,a,c){return r[a](c)},SPe=function(r,a,c,l){return r[a](l.fp,c)},TPe=function(r,a,c){return r.setAttribute(a,c)},zU=function(r,a){return as(r[a])?aee:xU(r[a])&&r.setAttribute?TPe:HU},oee=function(r,a){return a.set(a.t,a.p,Math.round((a.s+a.c*r)*1e6)/1e6,a)},wPe=function(r,a){return a.set(a.t,a.p,!!(a.s+a.c*r),a)},cee=function(r,a){var c=a._pt,l="";if(!r&&a.b)l=a.b;else if(r===1&&a.e)l=a.e;else{for(;c;)l=c.p+(c.m?c.m(c.s+c.c*r):Math.round((c.s+c.c*r)*1e4)/1e4)+l,c=c._next;l+=a.c}a.set(a.t,a.p,l,a)},KU=function(r,a){for(var c=a._pt;c;)c.r(r,c.d),c=c._next},CPe=function(r,a,c,l){for(var h=this._pt,m;h;)m=h._next,h.p===l&&h.modifier(r,a,c),h=m},RPe=function(r){for(var a=this._pt,c,l;a;)l=a._next,a.p===r&&!a.op||a.op===r?WO(this,a,"_pt"):a.dep||(c=1),a=l;return!c},bPe=function(r,a,c,l){l.mSet(r,a,l.m.call(l.tween,c,l.mt),l)},lee=function(r){for(var a=r._pt,c,l,h,m;a;){for(c=a._next,l=h;l&&l.pr>a.pr;)l=l._next;(a._prev=l?l._prev:m)?a._prev._next=a:h=a,(a._next=l)?l._prev=a:m=a,a=c}r._pt=h},Do=(function(){function i(a,c,l,h,m,E,S,T,C){this.t=c,this.s=h,this.c=m,this.p=l,this.r=E||oee,this.d=S||this,this.set=T||HU,this.pr=C||0,this._next=a,a&&(a._prev=this)}var r=i.prototype;return r.modifier=function(c,l,h){this.mSet=this.mSet||this.set,this.set=bPe,this.m=c,this.mt=h,this.tween=l},i})();ko(FU+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(i){return VU[i]=1});_c.TweenMax=_c.TweenLite=Rs;_c.TimelineLite=_c.TimelineMax=$a;qi=new $a({sortChildren:!1,defaults:qy,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});gc.stringFilter=QZ;var Og=[],wA={},IPe=[],aY=0,APe=0,dL=function(r){return(wA[r]||IPe).map(function(a){return a()})},VM=function(){var r=Date.now(),a=[];r-aY>2&&(dL("matchMediaInit"),Og.forEach(function(c){var l=c.queries,h=c.conditions,m,E,S,T;for(E in l)m=hd.matchMedia(l[E]).matches,m&&(S=1),m!==h[E]&&(h[E]=m,T=1);T&&(c.revert(),S&&a.push(c))}),dL("matchMediaRevert"),a.forEach(function(c){return c.onMatch(c,function(l){return c.add(null,l)})}),aY=r,dL("matchMedia"))},uee=(function(){function i(a,c){this.selector=c&&LM(c),this.data=[],this._r=[],this.isReverted=!1,this.id=APe++,a&&this.add(a)}var r=i.prototype;return r.add=function(c,l,h){as(c)&&(h=l,l=c,c=as);var m=this,E=function(){var T=Vi,C=m.selector,I;return T&&T!==m&&T.data.push(m),h&&(m.selector=LM(h)),Vi=m,I=l.apply(m,arguments),as(I)&&m._r.push(I),Vi=T,m.selector=C,m.isReverted=!1,I};return m.last=E,c===as?E(m,function(S){return m.add(null,S)}):c?m[c]=E:E},r.ignore=function(c){var l=Vi;Vi=null,c(this),Vi=l},r.getTweens=function(){var c=[];return this.data.forEach(function(l){return l instanceof i?c.push.apply(c,l.getTweens()):l instanceof Rs&&!(l.parent&&l.parent.data==="nested")&&c.push(l)}),c},r.clear=function(){this._r.length=this.data.length=0},r.kill=function(c,l){var h=this;if(c?(function(){for(var E=h.getTweens(),S=h.data.length,T;S--;)T=h.data[S],T.data==="isFlip"&&(T.revert(),T.getChildren(!0,!0,!1).forEach(function(C){return E.splice(E.indexOf(C),1)}));for(E.map(function(C){return{g:C._dur||C._delay||C._sat&&!C._sat.vars.immediateRender?C.globalTime(0):-1/0,t:C}}).sort(function(C,I){return I.g-C.g||-1/0}).forEach(function(C){return C.t.revert(c)}),S=h.data.length;S--;)T=h.data[S],T instanceof $a?T.data!=="nested"&&(T.scrollTrigger&&T.scrollTrigger.revert(),T.kill()):!(T instanceof Rs)&&T.revert&&T.revert(c);h._r.forEach(function(C){return C(c,h)}),h.isReverted=!0})():this.data.forEach(function(E){return E.kill&&E.kill()}),this.clear(),l)for(var m=Og.length;m--;)Og[m].id===this.id&&Og.splice(m,1)},r.revert=function(c){this.kill(c||{})},i})(),OPe=(function(){function i(a){this.contexts=[],this.scope=a,Vi&&Vi.data.push(this)}var r=i.prototype;return r.add=function(c,l,h){Rd(c)||(c={matches:c});var m=new uee(0,h||this.scope),E=m.conditions={},S,T,C;Vi&&!m.selector&&(m.selector=Vi.selector),this.contexts.push(m),l=m.add("onMatch",l),m.queries=c;for(T in c)T==="all"?C=1:(S=hd.matchMedia(c[T]),S&&(Og.indexOf(m)<0&&Og.push(m),(E[T]=S.matches)&&(C=1),S.addListener?S.addListener(VM):S.addEventListener("change",VM)));return C&&l(m,function(I){return m.add(null,I)}),this},r.revert=function(c){this.kill(c||{})},r.kill=function(c){this.contexts.forEach(function(l){return l.kill(c,!0)})},i})(),iO={registerPlugin:function(){for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];a.forEach(function(l){return XZ(l)})},timeline:function(r){return new $a(r)},getTweensOf:function(r,a){return qi.getTweensOf(r,a)},getProperty:function(r,a,c,l){Js(r)&&(r=al(r)[0]);var h=bg(r||{}).get,m=c?MZ:LZ;return c==="native"&&(c=""),r&&(a?m((cc[a]&&cc[a].get||h)(r,a,c,l)):function(E,S,T){return m((cc[E]&&cc[E].get||h)(r,E,S,T))})},quickSetter:function(r,a,c){if(r=al(r),r.length>1){var l=r.map(function(C){return Mo.quickSetter(C,a,c)}),h=l.length;return function(C){for(var I=h;I--;)l[I](C)}}r=r[0]||{};var m=cc[a],E=bg(r),S=E.harness&&(E.harness.aliases||{})[a]||a,T=m?function(C){var I=new m;Iy._pt=0,I.init(r,c?C+c:C,Iy,0,[r]),I.render(1,I),Iy._pt&&KU(1,Iy)}:E.set(r,S);return m?T:function(C){return T(r,S,c?C+c:C,E,1)}},quickTo:function(r,a,c){var l,h=Mo.to(r,Ec((l={},l[a]="+=0.1",l.paused=!0,l.stagger=0,l),c||{})),m=function(S,T,C){return h.resetTo(a,S,T,C)};return m.tween=h,m},isTweening:function(r){return qi.getTweensOf(r,!0).length>0},defaults:function(r){return r&&r.ease&&(r.ease=Ag(r.ease,qy.ease)),tY(qy,r||{})},config:function(r){return tY(gc,r||{})},registerEffect:function(r){var a=r.name,c=r.effect,l=r.plugins,h=r.defaults,m=r.extendTimeline;(l||"").split(",").forEach(function(E){return E&&!cc[E]&&!_c[E]&&Ew(a+" effect requires "+E+" plugin.")}),oL[a]=function(E,S,T){return c(al(E),Ec(S||{},h),T)},m&&($a.prototype[a]=function(E,S,T){return this.add(oL[a](E,Rd(S)?S:(T=S)&&{},this),T)})},registerEase:function(r,a){pr[r]=Ag(a)},parseEase:function(r,a){return arguments.length?Ag(r,a):pr},getById:function(r){return qi.getById(r)},exportRoot:function(r,a){r===void 0&&(r={});var c=new $a(r),l,h;for(c.smoothChildTiming=Po(r.smoothChildTiming),qi.remove(c),c._dp=0,c._time=c._tTime=qi._time,l=qi._first;l;)h=l._next,(a||!(!l._dur&&l instanceof Rs&&l.vars.onComplete===l._targets[0]))&&pd(c,l,l._start-l._delay),l=h;return pd(qi,c,0),c},context:function(r,a){return r?new uee(r,a):Vi},matchMedia:function(r){return new OPe(r)},matchMediaRefresh:function(){return Og.forEach(function(r){var a=r.conditions,c,l;for(l in a)a[l]&&(a[l]=!1,c=1);c&&r.revert()})||VM()},addEventListener:function(r,a){var c=wA[r]||(wA[r]=[]);~c.indexOf(a)||c.push(a)},removeEventListener:function(r,a){var c=wA[r],l=c&&c.indexOf(a);l>=0&&c.splice(l,1)},utils:{wrap:oPe,wrapYoyo:cPe,distribute:GZ,random:zZ,snap:HZ,normalize:aPe,getUnit:ka,clamp:nPe,splitColor:JZ,toArray:al,selector:LM,mapRange:YZ,pipe:iPe,unitize:sPe,interpolate:lPe,shuffle:WZ},install:NZ,effects:oL,ticker:uc,updateRoot:$a.updateRoot,plugins:cc,globalTimeline:qi,core:{PropTween:Do,globals:PZ,Tween:Rs,Timeline:$a,Animation:Tw,getCache:bg,_removeLinkedListItem:WO,reverting:function(){return ga},context:function(r){return r&&Vi&&(Vi.data.push(r),r._ctx=Vi),Vi},suppressOverwrites:function(r){return DU=r}}};ko("to,from,fromTo,delayedCall,set,killTweensOf",function(i){return iO[i]=Rs[i]});uc.add($a.updateRoot);Iy=iO.to({},{duration:0});var NPe=function(r,a){for(var c=r._pt;c&&c.p!==a&&c.op!==a&&c.fp!==a;)c=c._next;return c},PPe=function(r,a){var c=r._targets,l,h,m;for(l in a)for(h=c.length;h--;)m=r._ptLookup[h][l],m&&(m=m.d)&&(m._pt&&(m=NPe(m,l)),m&&m.modifier&&m.modifier(a[l],r,c[h],l))},hL=function(r,a){return{name:r,headless:1,rawVars:1,init:function(l,h,m){m._onInit=function(E){var S,T;if(Js(h)&&(S={},ko(h,function(C){return S[C]=1}),h=S),a){S={};for(T in h)S[T]=a(h[T]);h=S}PPe(E,h)}}}},Mo=iO.registerPlugin({name:"attr",init:function(r,a,c,l,h){var m,E,S;this.tween=c;for(m in a)S=r.getAttribute(m)||"",E=this.add(r,"setAttribute",(S||0)+"",a[m],l,h,0,0,m),E.op=m,E.b=S,this._props.push(m)},render:function(r,a){for(var c=a._pt;c;)ga?c.set(c.t,c.p,c.b,c):c.r(r,c.d),c=c._next}},{name:"endArray",headless:1,init:function(r,a){for(var c=a.length;c--;)this.add(r,c,r[c]||0,a[c],0,0,0,0,0,1)}},hL("roundProps",MM),hL("modifiers"),hL("snap",HZ))||iO;Rs.version=$a.version=Mo.version="3.14.2";OZ=1;LU()&&Qy();pr.Power0;pr.Power1;pr.Power2;pr.Power3;pr.Power4;pr.Linear;pr.Quad;pr.Cubic;pr.Quart;pr.Quint;pr.Strong;pr.Elastic;pr.Back;pr.SteppedEase;pr.Bounce;pr.Sine;pr.Expo;pr.Circ;var oY,$p,Fy,YU,wg,cY,qU,kPe=function(){return typeof window<"u"},bh={},fg=180/Math.PI,jy=Math.PI/180,dy=Math.atan2,lY=1e8,XU=/([A-Z])/g,DPe=/(left|right|width|margin|padding|x)/i,xPe=/[\s,\(]\S/,_d={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},FM=function(r,a){return a.set(a.t,a.p,Math.round((a.s+a.c*r)*1e4)/1e4+a.u,a)},LPe=function(r,a){return a.set(a.t,a.p,r===1?a.e:Math.round((a.s+a.c*r)*1e4)/1e4+a.u,a)},MPe=function(r,a){return a.set(a.t,a.p,r?Math.round((a.s+a.c*r)*1e4)/1e4+a.u:a.b,a)},UPe=function(r,a){return a.set(a.t,a.p,r===1?a.e:r?Math.round((a.s+a.c*r)*1e4)/1e4+a.u:a.b,a)},VPe=function(r,a){var c=a.s+a.c*r;a.set(a.t,a.p,~~(c+(c<0?-.5:.5))+a.u,a)},dee=function(r,a){return a.set(a.t,a.p,r?a.e:a.b,a)},hee=function(r,a){return a.set(a.t,a.p,r!==1?a.b:a.e,a)},FPe=function(r,a,c){return r.style[a]=c},jPe=function(r,a,c){return r.style.setProperty(a,c)},BPe=function(r,a,c){return r._gsap[a]=c},WPe=function(r,a,c){return r._gsap.scaleX=r._gsap.scaleY=c},GPe=function(r,a,c,l,h){var m=r._gsap;m.scaleX=m.scaleY=c,m.renderTransform(h,m)},HPe=function(r,a,c,l,h){var m=r._gsap;m[a]=c,m.renderTransform(h,m)},Ji="transform",xo=Ji+"Origin",zPe=function i(r,a){var c=this,l=this.target,h=l.style,m=l._gsap;if(r in bh&&h){if(this.tfm=this.tfm||{},r!=="transform")r=_d[r]||r,~r.indexOf(",")?r.split(",").forEach(function(E){return c.tfm[E]=dh(l,E)}):this.tfm[r]=m.x?m[r]:dh(l,r),r===xo&&(this.tfm.zOrigin=m.zOrigin);else return _d.transform.split(",").forEach(function(E){return i.call(c,E,a)});if(this.props.indexOf(Ji)>=0)return;m.svg&&(this.svgo=l.getAttribute("data-svg-origin"),this.props.push(xo,a,"")),r=Ji}(h||a)&&this.props.push(r,a,h[r])},pee=function(r){r.translate&&(r.removeProperty("translate"),r.removeProperty("scale"),r.removeProperty("rotate"))},KPe=function(){var r=this.props,a=this.target,c=a.style,l=a._gsap,h,m;for(h=0;h<r.length;h+=3)r[h+1]?r[h+1]===2?a[r[h]](r[h+2]):a[r[h]]=r[h+2]:r[h+2]?c[r[h]]=r[h+2]:c.removeProperty(r[h].substr(0,2)==="--"?r[h]:r[h].replace(XU,"-$1").toLowerCase());if(this.tfm){for(m in this.tfm)l[m]=this.tfm[m];l.svg&&(l.renderTransform(),a.setAttribute("data-svg-origin",this.svgo||"")),h=qU(),(!h||!h.isStart)&&!c[Ji]&&(pee(c),l.zOrigin&&c[xo]&&(c[xo]+=" "+l.zOrigin+"px",l.zOrigin=0,l.renderTransform()),l.uncache=1)}},fee=function(r,a){var c={target:r,props:[],revert:KPe,save:zPe};return r._gsap||Mo.core.getCache(r),a&&r.style&&r.nodeType&&a.split(",").forEach(function(l){return c.save(l)}),c},mee,jM=function(r,a){var c=$p.createElementNS?$p.createElementNS((a||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),r):$p.createElement(r);return c&&c.style?c:$p.createElement(r)},hc=function i(r,a,c){var l=getComputedStyle(r);return l[a]||l.getPropertyValue(a.replace(XU,"-$1").toLowerCase())||l.getPropertyValue(a)||!c&&i(r,Zy(a)||a,1)||""},uY="O,Moz,ms,Ms,Webkit".split(","),Zy=function(r,a,c){var l=a||wg,h=l.style,m=5;if(r in h&&!c)return r;for(r=r.charAt(0).toUpperCase()+r.substr(1);m--&&!(uY[m]+r in h););return m<0?null:(m===3?"ms":m>=0?uY[m]:"")+r},BM=function(){kPe()&&window.document&&(oY=window,$p=oY.document,Fy=$p.documentElement,wg=jM("div")||{style:{}},jM("div"),Ji=Zy(Ji),xo=Ji+"Origin",wg.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",mee=!!Zy("perspective"),qU=Mo.core.reverting,YU=1)},dY=function(r){var a=r.ownerSVGElement,c=jM("svg",a&&a.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),l=r.cloneNode(!0),h;l.style.display="block",c.appendChild(l),Fy.appendChild(c);try{h=l.getBBox()}catch{}return c.removeChild(l),Fy.removeChild(c),h},hY=function(r,a){for(var c=a.length;c--;)if(r.hasAttribute(a[c]))return r.getAttribute(a[c])},gee=function(r){var a,c;try{a=r.getBBox()}catch{a=dY(r),c=1}return a&&(a.width||a.height)||c||(a=dY(r)),a&&!a.width&&!a.x&&!a.y?{x:+hY(r,["x","cx","x1"])||0,y:+hY(r,["y","cy","y1"])||0,width:0,height:0}:a},_ee=function(r){return!!(r.getCTM&&(!r.parentNode||r.ownerSVGElement)&&gee(r))},df=function(r,a){if(a){var c=r.style,l;a in bh&&a!==xo&&(a=Ji),c.removeProperty?(l=a.substr(0,2),(l==="ms"||a.substr(0,6)==="webkit")&&(a="-"+a),c.removeProperty(l==="--"?a:a.replace(XU,"-$1").toLowerCase())):c.removeAttribute(a)}},Qp=function(r,a,c,l,h,m){var E=new Do(r._pt,a,c,0,1,m?hee:dee);return r._pt=E,E.b=l,E.e=h,r._props.push(c),E},pY={deg:1,rad:1,turn:1},YPe={grid:1,flex:1},hf=function i(r,a,c,l){var h=parseFloat(c)||0,m=(c+"").trim().substr((h+"").length)||"px",E=wg.style,S=DPe.test(a),T=r.tagName.toLowerCase()==="svg",C=(T?"client":"offset")+(S?"Width":"Height"),I=100,N=l==="px",P=l==="%",H,x,B,X;if(l===m||!h||pY[l]||pY[m])return h;if(m!=="px"&&!N&&(h=i(r,a,c,"px")),X=r.getCTM&&_ee(r),(P||m==="%")&&(bh[a]||~a.indexOf("adius")))return H=X?r.getBBox()[S?"width":"height"]:r[C],ms(P?h/H*I:h/100*H);if(E[S?"width":"height"]=I+(N?m:l),x=l!=="rem"&&~a.indexOf("adius")||l==="em"&&r.appendChild&&!T?r:r.parentNode,X&&(x=(r.ownerSVGElement||{}).parentNode),(!x||x===$p||!x.appendChild)&&(x=$p.body),B=x._gsap,B&&P&&B.width&&S&&B.time===uc.time&&!B.uncache)return ms(h/B.width*I);if(P&&(a==="height"||a==="width")){var Z=r.style[a];r.style[a]=I+l,H=r[C],Z?r.style[a]=Z:df(r,a)}else(P||m==="%")&&!YPe[hc(x,"display")]&&(E.position=hc(r,"position")),x===r&&(E.position="static"),x.appendChild(wg),H=wg[C],x.removeChild(wg),E.position="absolute";return S&&P&&(B=bg(x),B.time=uc.time,B.width=x[C]),ms(N?H*h/I:H&&h?I/H*h:0)},dh=function(r,a,c,l){var h;return YU||BM(),a in _d&&a!=="transform"&&(a=_d[a],~a.indexOf(",")&&(a=a.split(",")[0])),bh[a]&&a!=="transform"?(h=Cw(r,l),h=a!=="transformOrigin"?h[a]:h.svg?h.origin:aO(hc(r,xo))+" "+h.zOrigin+"px"):(h=r.style[a],(!h||h==="auto"||l||~(h+"").indexOf("calc("))&&(h=sO[a]&&sO[a](r,a,c)||hc(r,a)||DZ(r,a)||(a==="opacity"?1:0))),c&&!~(h+"").trim().indexOf(" ")?hf(r,a,h,c)+c:h},qPe=function(r,a,c,l){if(!c||c==="none"){var h=Zy(a,r,1),m=h&&hc(r,h,1);m&&m!==c?(a=h,c=m):a==="borderColor"&&(c=hc(r,"borderTopColor"))}var E=new Do(this._pt,r.style,a,0,1,cee),S=0,T=0,C,I,N,P,H,x,B,X,Z,$,le,re;if(E.b=c,E.e=l,c+="",l+="",l.substring(0,6)==="var(--"&&(l=hc(r,l.substring(4,l.indexOf(")")))),l==="auto"&&(x=r.style[a],r.style[a]=l,l=hc(r,a)||l,x?r.style[a]=x:df(r,a)),C=[c,l],QZ(C),c=C[0],l=C[1],N=c.match(by)||[],re=l.match(by)||[],re.length){for(;I=by.exec(l);)B=I[0],Z=l.substring(S,I.index),H?H=(H+1)%5:(Z.substr(-5)==="rgba("||Z.substr(-5)==="hsla(")&&(H=1),B!==(x=N[T++]||"")&&(P=parseFloat(x)||0,le=x.substr((P+"").length),B.charAt(1)==="="&&(B=Vy(P,B)+le),X=parseFloat(B),$=B.substr((X+"").length),S=by.lastIndex-$.length,$||($=$||gc.units[a]||le,S===l.length&&(l+=$,E.e+=$)),le!==$&&(P=hf(r,a,x,$)||0),E._pt={_next:E._pt,p:Z||T===1?Z:",",s:P,c:X-P,m:H&&H<4||a==="zIndex"?Math.round:0});E.c=S<l.length?l.substring(S,l.length):""}else E.r=a==="display"&&l==="none"?hee:dee;return AZ.test(l)&&(E.e=0),this._pt=E,E},fY={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},XPe=function(r){var a=r.split(" "),c=a[0],l=a[1]||"50%";return(c==="top"||c==="bottom"||l==="left"||l==="right")&&(r=c,c=l,l=r),a[0]=fY[c]||c,a[1]=fY[l]||l,a.join(" ")},JPe=function(r,a){if(a.tween&&a.tween._time===a.tween._dur){var c=a.t,l=c.style,h=a.u,m=c._gsap,E,S,T;if(h==="all"||h===!0)l.cssText="",S=1;else for(h=h.split(","),T=h.length;--T>-1;)E=h[T],bh[E]&&(S=1,E=E==="transformOrigin"?xo:Ji),df(c,E);S&&(df(c,Ji),m&&(m.svg&&c.removeAttribute("transform"),l.scale=l.rotate=l.translate="none",Cw(c,1),m.uncache=1,pee(l)))}},sO={clearProps:function(r,a,c,l,h){if(h.data!=="isFromStart"){var m=r._pt=new Do(r._pt,a,c,0,0,JPe);return m.u=l,m.pr=-10,m.tween=h,r._props.push(c),1}}},ww=[1,0,0,1,0,0],Eee={},yee=function(r){return r==="matrix(1, 0, 0, 1, 0, 0)"||r==="none"||!r},mY=function(r){var a=hc(r,Ji);return yee(a)?ww:a.substr(7).match(IZ).map(ms)},JU=function(r,a){var c=r._gsap||bg(r),l=r.style,h=mY(r),m,E,S,T;return c.svg&&r.getAttribute("transform")?(S=r.transform.baseVal.consolidate().matrix,h=[S.a,S.b,S.c,S.d,S.e,S.f],h.join(",")==="1,0,0,1,0,0"?ww:h):(h===ww&&!r.offsetParent&&r!==Fy&&!c.svg&&(S=l.display,l.display="block",m=r.parentNode,(!m||!r.offsetParent&&!r.getBoundingClientRect().width)&&(T=1,E=r.nextElementSibling,Fy.appendChild(r)),h=mY(r),S?l.display=S:df(r,"display"),T&&(E?m.insertBefore(r,E):m?m.appendChild(r):Fy.removeChild(r))),a&&h.length>6?[h[0],h[1],h[4],h[5],h[12],h[13]]:h)},WM=function(r,a,c,l,h,m){var E=r._gsap,S=h||JU(r,!0),T=E.xOrigin||0,C=E.yOrigin||0,I=E.xOffset||0,N=E.yOffset||0,P=S[0],H=S[1],x=S[2],B=S[3],X=S[4],Z=S[5],$=a.split(" "),le=parseFloat($[0])||0,re=parseFloat($[1])||0,ce,te,pe,Ee;c?S!==ww&&(te=P*B-H*x)&&(pe=le*(B/te)+re*(-x/te)+(x*Z-B*X)/te,Ee=le*(-H/te)+re*(P/te)-(P*Z-H*X)/te,le=pe,re=Ee):(ce=gee(r),le=ce.x+(~$[0].indexOf("%")?le/100*ce.width:le),re=ce.y+(~($[1]||$[0]).indexOf("%")?re/100*ce.height:re)),l||l!==!1&&E.smooth?(X=le-T,Z=re-C,E.xOffset=I+(X*P+Z*x)-X,E.yOffset=N+(X*H+Z*B)-Z):E.xOffset=E.yOffset=0,E.xOrigin=le,E.yOrigin=re,E.smooth=!!l,E.origin=a,E.originIsAbsolute=!!c,r.style[xo]="0px 0px",m&&(Qp(m,E,"xOrigin",T,le),Qp(m,E,"yOrigin",C,re),Qp(m,E,"xOffset",I,E.xOffset),Qp(m,E,"yOffset",N,E.yOffset)),r.setAttribute("data-svg-origin",le+" "+re)},Cw=function(r,a){var c=r._gsap||new nee(r);if("x"in c&&!a&&!c.uncache)return c;var l=r.style,h=c.scaleX<0,m="px",E="deg",S=getComputedStyle(r),T=hc(r,xo)||"0",C,I,N,P,H,x,B,X,Z,$,le,re,ce,te,pe,Ee,Ne,Ue,Se,Xe,Re,Be,$e,Ge,Ie,Ke,ae,ge,Pe,ue,it,yt;return C=I=N=x=B=X=Z=$=le=0,P=H=1,c.svg=!!(r.getCTM&&_ee(r)),S.translate&&((S.translate!=="none"||S.scale!=="none"||S.rotate!=="none")&&(l[Ji]=(S.translate!=="none"?"translate3d("+(S.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(S.rotate!=="none"?"rotate("+S.rotate+") ":"")+(S.scale!=="none"?"scale("+S.scale.split(" ").join(",")+") ":"")+(S[Ji]!=="none"?S[Ji]:"")),l.scale=l.rotate=l.translate="none"),te=JU(r,c.svg),c.svg&&(c.uncache?(Ie=r.getBBox(),T=c.xOrigin-Ie.x+"px "+(c.yOrigin-Ie.y)+"px",Ge=""):Ge=!a&&r.getAttribute("data-svg-origin"),WM(r,Ge||T,!!Ge||c.originIsAbsolute,c.smooth!==!1,te)),re=c.xOrigin||0,ce=c.yOrigin||0,te!==ww&&(Ue=te[0],Se=te[1],Xe=te[2],Re=te[3],C=Be=te[4],I=$e=te[5],te.length===6?(P=Math.sqrt(Ue*Ue+Se*Se),H=Math.sqrt(Re*Re+Xe*Xe),x=Ue||Se?dy(Se,Ue)*fg:0,Z=Xe||Re?dy(Xe,Re)*fg+x:0,Z&&(H*=Math.abs(Math.cos(Z*jy))),c.svg&&(C-=re-(re*Ue+ce*Xe),I-=ce-(re*Se+ce*Re))):(yt=te[6],ue=te[7],ae=te[8],ge=te[9],Pe=te[10],it=te[11],C=te[12],I=te[13],N=te[14],pe=dy(yt,Pe),B=pe*fg,pe&&(Ee=Math.cos(-pe),Ne=Math.sin(-pe),Ge=Be*Ee+ae*Ne,Ie=$e*Ee+ge*Ne,Ke=yt*Ee+Pe*Ne,ae=Be*-Ne+ae*Ee,ge=$e*-Ne+ge*Ee,Pe=yt*-Ne+Pe*Ee,it=ue*-Ne+it*Ee,Be=Ge,$e=Ie,yt=Ke),pe=dy(-Xe,Pe),X=pe*fg,pe&&(Ee=Math.cos(-pe),Ne=Math.sin(-pe),Ge=Ue*Ee-ae*Ne,Ie=Se*Ee-ge*Ne,Ke=Xe*Ee-Pe*Ne,it=Re*Ne+it*Ee,Ue=Ge,Se=Ie,Xe=Ke),pe=dy(Se,Ue),x=pe*fg,pe&&(Ee=Math.cos(pe),Ne=Math.sin(pe),Ge=Ue*Ee+Se*Ne,Ie=Be*Ee+$e*Ne,Se=Se*Ee-Ue*Ne,$e=$e*Ee-Be*Ne,Ue=Ge,Be=Ie),B&&Math.abs(B)+Math.abs(x)>359.9&&(B=x=0,X=180-X),P=ms(Math.sqrt(Ue*Ue+Se*Se+Xe*Xe)),H=ms(Math.sqrt($e*$e+yt*yt)),pe=dy(Be,$e),Z=Math.abs(pe)>2e-4?pe*fg:0,le=it?1/(it<0?-it:it):0),c.svg&&(Ge=r.getAttribute("transform"),c.forceCSS=r.setAttribute("transform","")||!yee(hc(r,Ji)),Ge&&r.setAttribute("transform",Ge))),Math.abs(Z)>90&&Math.abs(Z)<270&&(h?(P*=-1,Z+=x<=0?180:-180,x+=x<=0?180:-180):(H*=-1,Z+=Z<=0?180:-180)),a=a||c.uncache,c.x=C-((c.xPercent=C&&(!a&&c.xPercent||(Math.round(r.offsetWidth/2)===Math.round(-C)?-50:0)))?r.offsetWidth*c.xPercent/100:0)+m,c.y=I-((c.yPercent=I&&(!a&&c.yPercent||(Math.round(r.offsetHeight/2)===Math.round(-I)?-50:0)))?r.offsetHeight*c.yPercent/100:0)+m,c.z=N+m,c.scaleX=ms(P),c.scaleY=ms(H),c.rotation=ms(x)+E,c.rotationX=ms(B)+E,c.rotationY=ms(X)+E,c.skewX=Z+E,c.skewY=$+E,c.transformPerspective=le+m,(c.zOrigin=parseFloat(T.split(" ")[2])||!a&&c.zOrigin||0)&&(l[xo]=aO(T)),c.xOffset=c.yOffset=0,c.force3D=gc.force3D,c.renderTransform=c.svg?QPe:mee?vee:$Pe,c.uncache=0,c},aO=function(r){return(r=r.split(" "))[0]+" "+r[1]},pL=function(r,a,c){var l=ka(a);return ms(parseFloat(a)+parseFloat(hf(r,"x",c+"px",l)))+l},$Pe=function(r,a){a.z="0px",a.rotationY=a.rotationX="0deg",a.force3D=0,vee(r,a)},ug="0deg",C0="0px",dg=") ",vee=function(r,a){var c=a||this,l=c.xPercent,h=c.yPercent,m=c.x,E=c.y,S=c.z,T=c.rotation,C=c.rotationY,I=c.rotationX,N=c.skewX,P=c.skewY,H=c.scaleX,x=c.scaleY,B=c.transformPerspective,X=c.force3D,Z=c.target,$=c.zOrigin,le="",re=X==="auto"&&r&&r!==1||X===!0;if($&&(I!==ug||C!==ug)){var ce=parseFloat(C)*jy,te=Math.sin(ce),pe=Math.cos(ce),Ee;ce=parseFloat(I)*jy,Ee=Math.cos(ce),m=pL(Z,m,te*Ee*-$),E=pL(Z,E,-Math.sin(ce)*-$),S=pL(Z,S,pe*Ee*-$+$)}B!==C0&&(le+="perspective("+B+dg),(l||h)&&(le+="translate("+l+"%, "+h+"%) "),(re||m!==C0||E!==C0||S!==C0)&&(le+=S!==C0||re?"translate3d("+m+", "+E+", "+S+") ":"translate("+m+", "+E+dg),T!==ug&&(le+="rotate("+T+dg),C!==ug&&(le+="rotateY("+C+dg),I!==ug&&(le+="rotateX("+I+dg),(N!==ug||P!==ug)&&(le+="skew("+N+", "+P+dg),(H!==1||x!==1)&&(le+="scale("+H+", "+x+dg),Z.style[Ji]=le||"translate(0, 0)"},QPe=function(r,a){var c=a||this,l=c.xPercent,h=c.yPercent,m=c.x,E=c.y,S=c.rotation,T=c.skewX,C=c.skewY,I=c.scaleX,N=c.scaleY,P=c.target,H=c.xOrigin,x=c.yOrigin,B=c.xOffset,X=c.yOffset,Z=c.forceCSS,$=parseFloat(m),le=parseFloat(E),re,ce,te,pe,Ee;S=parseFloat(S),T=parseFloat(T),C=parseFloat(C),C&&(C=parseFloat(C),T+=C,S+=C),S||T?(S*=jy,T*=jy,re=Math.cos(S)*I,ce=Math.sin(S)*I,te=Math.sin(S-T)*-N,pe=Math.cos(S-T)*N,T&&(C*=jy,Ee=Math.tan(T-C),Ee=Math.sqrt(1+Ee*Ee),te*=Ee,pe*=Ee,C&&(Ee=Math.tan(C),Ee=Math.sqrt(1+Ee*Ee),re*=Ee,ce*=Ee)),re=ms(re),ce=ms(ce),te=ms(te),pe=ms(pe)):(re=I,pe=N,ce=te=0),($&&!~(m+"").indexOf("px")||le&&!~(E+"").indexOf("px"))&&($=hf(P,"x",m,"px"),le=hf(P,"y",E,"px")),(H||x||B||X)&&($=ms($+H-(H*re+x*te)+B),le=ms(le+x-(H*ce+x*pe)+X)),(l||h)&&(Ee=P.getBBox(),$=ms($+l/100*Ee.width),le=ms(le+h/100*Ee.height)),Ee="matrix("+re+","+ce+","+te+","+pe+","+$+","+le+")",P.setAttribute("transform",Ee),Z&&(P.style[Ji]=Ee)},ZPe=function(r,a,c,l,h){var m=360,E=Js(h),S=parseFloat(h)*(E&&~h.indexOf("rad")?fg:1),T=S-l,C=l+T+"deg",I,N;return E&&(I=h.split("_")[1],I==="short"&&(T%=m,T!==T%(m/2)&&(T+=T<0?m:-m)),I==="cw"&&T<0?T=(T+m*lY)%m-~~(T/m)*m:I==="ccw"&&T>0&&(T=(T-m*lY)%m-~~(T/m)*m)),r._pt=N=new Do(r._pt,a,c,l,T,LPe),N.e=C,N.u="deg",r._props.push(c),N},gY=function(r,a){for(var c in a)r[c]=a[c];return r},e1e=function(r,a,c){var l=gY({},c._gsap),h="perspective,force3D,transformOrigin,svgOrigin",m=c.style,E,S,T,C,I,N,P,H;l.svg?(T=c.getAttribute("transform"),c.setAttribute("transform",""),m[Ji]=a,E=Cw(c,1),df(c,Ji),c.setAttribute("transform",T)):(T=getComputedStyle(c)[Ji],m[Ji]=a,E=Cw(c,1),m[Ji]=T);for(S in bh)T=l[S],C=E[S],T!==C&&h.indexOf(S)<0&&(P=ka(T),H=ka(C),I=P!==H?hf(c,S,T,H):parseFloat(T),N=parseFloat(C),r._pt=new Do(r._pt,E,S,I,N-I,FM),r._pt.u=H||0,r._props.push(S));gY(E,l)};ko("padding,margin,Width,Radius",function(i,r){var a="Top",c="Right",l="Bottom",h="Left",m=(r<3?[a,c,l,h]:[a+h,a+c,l+c,l+h]).map(function(E){return r<2?i+E:"border"+E+i});sO[r>1?"border"+i:i]=function(E,S,T,C,I){var N,P;if(arguments.length<4)return N=m.map(function(H){return dh(E,H,T)}),P=N.join(" "),P.split(N[0]).length===5?N[0]:P;N=(C+"").split(" "),P={},m.forEach(function(H,x){return P[H]=N[x]=N[x]||N[(x-1)/2|0]}),E.init(S,P,I)}});var See={name:"css",register:BM,targetTest:function(r){return r.style&&r.nodeType},init:function(r,a,c,l,h){var m=this._props,E=r.style,S=c.vars.startAt,T,C,I,N,P,H,x,B,X,Z,$,le,re,ce,te,pe,Ee;YU||BM(),this.styles=this.styles||fee(r),pe=this.styles.props,this.tween=c;for(x in a)if(x!=="autoRound"&&(C=a[x],!(cc[x]&&ree(x,a,c,l,r,h)))){if(P=typeof C,H=sO[x],P==="function"&&(C=C.call(c,l,r,h),P=typeof C),P==="string"&&~C.indexOf("random(")&&(C=vw(C)),H)H(this,r,x,C,c)&&(te=1);else if(x.substr(0,2)==="--")T=(getComputedStyle(r).getPropertyValue(x)+"").trim(),C+="",rf.lastIndex=0,rf.test(T)||(B=ka(T),X=ka(C),X?B!==X&&(T=hf(r,x,T,X)+X):B&&(C+=B)),this.add(E,"setProperty",T,C,l,h,0,0,x),m.push(x),pe.push(x,0,E[x]);else if(P!=="undefined"){if(S&&x in S?(T=typeof S[x]=="function"?S[x].call(c,l,r,h):S[x],Js(T)&&~T.indexOf("random(")&&(T=vw(T)),ka(T+"")||T==="auto"||(T+=gc.units[x]||ka(dh(r,x))||""),(T+"").charAt(1)==="="&&(T=dh(r,x))):T=dh(r,x),N=parseFloat(T),Z=P==="string"&&C.charAt(1)==="="&&C.substr(0,2),Z&&(C=C.substr(2)),I=parseFloat(C),x in _d&&(x==="autoAlpha"&&(N===1&&dh(r,"visibility")==="hidden"&&I&&(N=0),pe.push("visibility",0,E.visibility),Qp(this,E,"visibility",N?"inherit":"hidden",I?"inherit":"hidden",!I)),x!=="scale"&&x!=="transform"&&(x=_d[x],~x.indexOf(",")&&(x=x.split(",")[0]))),$=x in bh,$){if(this.styles.save(x),Ee=C,P==="string"&&C.substring(0,6)==="var(--"){if(C=hc(r,C.substring(4,C.indexOf(")"))),C.substring(0,5)==="calc("){var Ne=r.style.perspective;r.style.perspective=C,C=hc(r,"perspective"),Ne?r.style.perspective=Ne:df(r,"perspective")}I=parseFloat(C)}if(le||(re=r._gsap,re.renderTransform&&!a.parseTransform||Cw(r,a.parseTransform),ce=a.smoothOrigin!==!1&&re.smooth,le=this._pt=new Do(this._pt,E,Ji,0,1,re.renderTransform,re,0,-1),le.dep=1),x==="scale")this._pt=new Do(this._pt,re,"scaleY",re.scaleY,(Z?Vy(re.scaleY,Z+I):I)-re.scaleY||0,FM),this._pt.u=0,m.push("scaleY",x),x+="X";else if(x==="transformOrigin"){pe.push(xo,0,E[xo]),C=XPe(C),re.svg?WM(r,C,0,ce,0,this):(X=parseFloat(C.split(" ")[2])||0,X!==re.zOrigin&&Qp(this,re,"zOrigin",re.zOrigin,X),Qp(this,E,x,aO(T),aO(C)));continue}else if(x==="svgOrigin"){WM(r,C,1,ce,0,this);continue}else if(x in Eee){ZPe(this,re,x,N,Z?Vy(N,Z+C):C);continue}else if(x==="smoothOrigin"){Qp(this,re,"smooth",re.smooth,C);continue}else if(x==="force3D"){re[x]=C;continue}else if(x==="transform"){e1e(this,C,r);continue}}else x in E||(x=Zy(x)||x);if($||(I||I===0)&&(N||N===0)&&!xPe.test(C)&&x in E)B=(T+"").substr((N+"").length),I||(I=0),X=ka(C)||(x in gc.units?gc.units[x]:B),B!==X&&(N=hf(r,x,T,X)),this._pt=new Do(this._pt,$?re:E,x,N,(Z?Vy(N,Z+I):I)-N,!$&&(X==="px"||x==="zIndex")&&a.autoRound!==!1?VPe:FM),this._pt.u=X||0,$&&Ee!==C?(this._pt.b=T,this._pt.e=Ee,this._pt.r=UPe):B!==X&&X!=="%"&&(this._pt.b=T,this._pt.r=MPe);else if(x in E)qPe.call(this,r,x,T,Z?Z+C:C);else if(x in r)this.add(r,x,T||r[x],Z?Z+C:C,l,h);else if(x!=="parseTransform"){UU(x,C);continue}$||(x in E?pe.push(x,0,E[x]):typeof r[x]=="function"?pe.push(x,2,r[x]()):pe.push(x,1,T||r[x])),m.push(x)}}te&&lee(this)},render:function(r,a){if(a.tween._time||!qU())for(var c=a._pt;c;)c.r(r,c.d),c=c._next;else a.styles.revert()},get:dh,aliases:_d,getSetter:function(r,a,c){var l=_d[a];return l&&l.indexOf(",")<0&&(a=l),a in bh&&a!==xo&&(r._gsap.x||dh(r,"x"))?c&&cY===c?a==="scale"?WPe:BPe:(cY=c||{})&&(a==="scale"?GPe:HPe):r.style&&!xU(r.style[a])?FPe:~a.indexOf("-")?jPe:zU(r,a)},core:{_removeProperty:df,_getMatrix:JU}};Mo.utils.checkPrefix=Zy;Mo.core.getStyleSaver=fee;(function(i,r,a,c){var l=ko(i+","+r+","+a,function(h){bh[h]=1});ko(r,function(h){gc.units[h]="deg",Eee[h]=1}),_d[l[13]]=i+","+r,ko(c,function(h){var m=h.split(":");_d[m[1]]=l[m[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");ko("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(i){gc.units[i]="px"});Mo.registerPlugin(See);var CA=Mo.registerPlugin(See)||Mo;CA.core.Tween;const t1e=(i,r={baseSize:48,maxScale:1.5,maxDistance:120})=>{const a=G.useRef(null),c=G.useRef(new Map),l=G.useCallback((S,T)=>{T?c.current.set(S,T):c.current.delete(S)},[]),h=G.useCallback(S=>{const{maxScale:T,maxDistance:C}=r;if(S>=C)return 1;const I=S/C,N=Math.cos(I*Math.PI/2),P=1+(T-1)*N;return Math.max(1,Math.min(T,P))},[r]),m=G.useCallback(S=>{const T=a.current;if(!T)return;const C=T.getBoundingClientRect(),I=S.clientX,N=S.clientY,P=window.innerHeight-N,H=C.height+50;if(P>H+r.maxDistance){c.current.forEach(x=>{CA.to(x,{scale:1,y:0,duration:.4,ease:"power3.out"})});return}c.current.forEach((x,B)=>{const X=x.getBoundingClientRect(),Z=X.left+X.width/2,$=Math.abs(I-Z),le=h($),re=r.baseSize,ce=-((le-1)*re*.5);CA.to(x,{scale:le,y:ce,duration:.2,ease:"power2.out",overwrite:"auto"})})},[h,r]),E=G.useCallback(()=>{c.current.forEach((S,T)=>{CA.to(S,{scale:1,y:0,duration:.5,ease:"elastic.out(1, 0.4)",delay:T*.015})})},[]);return G.useEffect(()=>{const S=a.current;if(S)return S.addEventListener("mousemove",m),S.addEventListener("mouseleave",E),()=>{S.removeEventListener("mousemove",m),S.removeEventListener("mouseleave",E)}},[m,E]),{dockRef:a,setItemRef:l}},n1e=({icon:i,label:r,to:a,gradient:c,onSetRef:l})=>{const[h,m]=G.useState(!1),S=Ef().pathname===a,T=G.useCallback(C=>{l(C)},[l]);return D.jsxs("div",{ref:T,className:"dock-item relative origin-bottom",onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),style:{willChange:"transform"},children:[D.jsx(UQ,{children:h&&D.jsx(Xn.div,{initial:{opacity:0,y:8,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:4,scale:.95},transition:{duration:.12,ease:"easeOut"},className:"absolute -top-10 left-1/2 -translate-x-1/2 z-50 pointer-events-none",children:D.jsx("div",{className:"glass px-3 py-1.5 rounded-lg whitespace-nowrap shadow-lg",children:D.jsx("span",{className:"text-xs font-medium text-foreground",children:r})})})}),D.jsxs(lw,{to:a,className:`
          relative flex items-center justify-center w-12 h-12 rounded-xl
          transition-colors duration-200 group
          ${S?"active":""}
        `,"aria-label":r,children:[D.jsx("div",{className:`
            absolute inset-0 rounded-xl opacity-0 transition-opacity duration-300
            ${S?"opacity-100":"group-hover:opacity-70"}
          `,style:{background:c||"linear-gradient(135deg, hsl(199 89% 48% / 0.25), hsl(263 70% 58% / 0.25))"}}),D.jsx(i,{className:`
            w-6 h-6 relative z-10 transition-colors duration-200
            ${S?"text-primary":"text-muted-foreground group-hover:text-foreground"}
          `}),S&&D.jsx(Xn.div,{layoutId:"activeIndicator",className:"absolute -bottom-1.5 w-1 h-1 rounded-full bg-primary",transition:{type:"spring",stiffness:500,damping:30}})]})]})},_Y=[{icon:lX,label:"Dashboard",to:"/",gradient:"linear-gradient(135deg, hsl(199 89% 48% / 0.3), hsl(199 89% 48% / 0.1))"},{icon:Ay,label:"AI Tutor",to:"/ai-tutor",gradient:"linear-gradient(135deg, hsl(263 70% 58% / 0.3), hsl(263 70% 58% / 0.1))"},{icon:NA,label:"Notes & PYQs",to:"/notes",gradient:"linear-gradient(135deg, hsl(142 76% 36% / 0.3), hsl(142 76% 36% / 0.1))"},{icon:E2,label:"Study Planner",to:"/planner",gradient:"linear-gradient(135deg, hsl(45 93% 47% / 0.3), hsl(45 93% 47% / 0.1))"},{icon:vO,label:"Study Rooms",to:"/study-rooms",gradient:"linear-gradient(135deg, hsl(330 80% 55% / 0.3), hsl(330 80% 55% / 0.1))"},{icon:WL,label:"Campus Map",to:"/campus-map",gradient:"linear-gradient(135deg, hsl(15 90% 55% / 0.3), hsl(15 90% 55% / 0.1))"},{icon:uA,label:"Events",to:"/events",gradient:"linear-gradient(135deg, hsl(280 70% 50% / 0.3), hsl(280 70% 50% / 0.1))"},{icon:uX,label:"Doubts",to:"/doubts",gradient:"linear-gradient(135deg, hsl(180 70% 45% / 0.3), hsl(180 70% 45% / 0.1))"},{icon:kw,label:"Senior Connect",to:"/senior-connect",gradient:"linear-gradient(135deg, hsl(220 70% 55% / 0.3), hsl(220 70% 55% / 0.1))"},{icon:jL,label:"Student Help",to:"/student-help",gradient:"linear-gradient(135deg, hsl(350 80% 50% / 0.3), hsl(350 80% 50% / 0.1))"},{icon:cX,label:"Support",to:"/support",gradient:"linear-gradient(135deg, hsl(35 90% 55% / 0.3), hsl(35 90% 55% / 0.1))"},{icon:gX,label:"Settings",to:"/settings",gradient:"linear-gradient(135deg, hsl(217 20% 50% / 0.3), hsl(217 20% 50% / 0.1))"}],r1e=()=>{const{dockRef:i,setItemRef:r}=t1e(_Y.length,{baseSize:48,maxScale:1.6,maxDistance:100}),a=G.useCallback(c=>l=>r(c,l),[r]);return D.jsxs("div",{className:"fixed bottom-4 left-1/2 -translate-x-1/2 z-50",children:[D.jsx("div",{ref:i,className:"glass-dock rounded-2xl px-3 py-2.5 flex items-end gap-1",children:_Y.map((c,l)=>D.jsx(n1e,{icon:c.icon,label:c.label,to:c.to,gradient:c.gradient,onSetRef:a(l)},c.to))}),D.jsx("div",{className:"absolute -bottom-4 left-1/2 -translate-x-1/2 w-3/4 h-8 opacity-20 blur-xl pointer-events-none",style:{background:"linear-gradient(to bottom, hsl(199 89% 48% / 0.3), transparent)"}})]})},Sc=({children:i})=>D.jsxs("div",{className:"min-h-screen bg-background relative overflow-hidden",children:[D.jsxs("div",{className:"fixed inset-0 pointer-events-none overflow-hidden",children:[D.jsx("div",{className:"absolute -top-1/2 -left-1/2 w-full h-full opacity-30",style:{background:"radial-gradient(circle, hsl(199 89% 48% / 0.15) 0%, transparent 50%)"}}),D.jsx("div",{className:"absolute -bottom-1/2 -right-1/2 w-full h-full opacity-20",style:{background:"radial-gradient(circle, hsl(263 70% 58% / 0.15) 0%, transparent 50%)"}})]}),D.jsx(Xn.main,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3,ease:"easeOut"},className:"page-container relative z-10",children:i}),D.jsx(r1e,{})]}),i1e=({icon:i,title:r,description:a,gradient:c,delay:l=0,children:h})=>D.jsxs(Xn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:l,ease:"easeOut"},className:"module-card group",children:[D.jsx("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center mb-4 transition-transform duration-300 group-hover:scale-110",style:{background:c},children:D.jsx(i,{className:"w-7 h-7 text-foreground"})}),D.jsx("h3",{className:"text-xl font-semibold text-foreground mb-2 font-display",children:r}),D.jsx("p",{className:"text-muted-foreground text-sm leading-relaxed mb-4",children:a}),h]}),s1e=_2("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),nr=G.forwardRef(({className:i,variant:r,size:a,asChild:c=!1,...l},h)=>{const m=c?fme:"button";return D.jsx(m,{className:Br(s1e({variant:r,size:a,className:i})),ref:h,...l})});nr.displayName="Button";const a1e=()=>{const{user:i,loading:r,signOut:a}=UO(),[c,l]=G.useState([{label:"AI Chats",value:"0",icon:Ay,change:"Start Now"},{label:"Study Hours",value:"0",icon:rw,change:"Track"},{label:"Tasks",value:"0",icon:hK,change:"Plan"}]);G.useEffect(()=>{const m=localStorage.getItem("aitutor-conversations"),E=m?JSON.parse(m).length:0;l([{label:"AI Sessions",value:E.toString(),icon:Ay,change:E>0?"Active":"Start now"},{label:"Study Hours",value:"12.5",icon:rw,change:"+2.5h"},{label:"Pending Tasks",value:"3",icon:hK,change:"-1"}])},[]);const h=[{icon:Ay,title:"AI Tutor",description:"Get instant help with your assignments and concepts",gradient:"linear-gradient(135deg, hsl(263 70% 58% / 0.3), hsl(263 70% 58% / 0.1))",path:"/ai-tutor"},{icon:NA,title:"Notes & PYQs",description:"Access curated study materials and past papers",gradient:"linear-gradient(135deg, hsl(142 76% 36% / 0.3), hsl(142 76% 36% / 0.1))",path:"/notes"},{icon:E2,title:"Study Planner",description:"Plan your study sessions and track progress",gradient:"linear-gradient(135deg, hsl(45 93% 47% / 0.3), hsl(45 93% 47% / 0.1))",path:"/planner"},{icon:vO,title:"Study Rooms",description:"Join virtual study sessions with classmates",gradient:"linear-gradient(135deg, hsl(330 80% 55% / 0.3), hsl(330 80% 55% / 0.1))",path:"/study-rooms"}];return D.jsxs(Sc,{children:[D.jsx(Xn.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"mb-8",children:D.jsxs("div",{className:"flex items-center justify-between mb-4",children:[D.jsxs("div",{className:"flex items-center gap-4",children:[D.jsx("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center",style:{background:"linear-gradient(135deg, hsl(199 89% 48% / 0.3), hsl(263 70% 58% / 0.3))"},children:D.jsx(lX,{className:"w-7 h-7 text-primary"})}),D.jsxs("div",{children:[D.jsxs("h1",{className:"text-4xl font-bold font-display",children:[D.jsx("span",{className:"text-gradient",children:"KLE"}),D.jsx("span",{className:"text-foreground",children:" CONNECT"})]}),D.jsx("p",{className:"text-muted-foreground",children:i?`Welcome back, ${i.user_metadata?.full_name||i.email}!`:"Your college companion, powered by AI"})]})]}),D.jsx("div",{className:"flex items-center gap-3",children:r?D.jsx(nr,{variant:"ghost",disabled:!0,size:"sm",children:"Loading..."}):i?D.jsxs("div",{className:"flex items-center gap-3",children:[D.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[D.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center",children:D.jsx(SO,{className:"w-4 h-4 text-primary"})}),D.jsx("span",{className:"text-muted-foreground hidden md:inline",children:i.displayName||i.email||"Student"})]}),D.jsx(nr,{variant:"outline",size:"sm",onClick:async()=>{await a(),window.location.href="/#/auth"},children:"Sign Out"})]}):D.jsx(lw,{to:"/auth",children:D.jsxs(nr,{className:"gap-2 bg-primary hover:bg-primary/90",children:[D.jsx(wge,{className:"w-4 h-4"}),"Sign In"]})})})]})}),D.jsx(Xn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:c.map((m,E)=>D.jsxs("div",{className:"glass rounded-2xl p-5 flex items-center gap-4 hover:bg-white/5 transition-colors",children:[D.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center",style:{background:"linear-gradient(135deg, hsl(199 89% 48% / 0.2), hsl(199 89% 48% / 0.05))"},children:D.jsx(m.icon,{className:"w-6 h-6 text-primary"})}),D.jsxs("div",{children:[D.jsx("p",{className:"text-2xl font-bold text-foreground font-display",children:m.value}),D.jsx("p",{className:"text-sm text-muted-foreground",children:m.label})]}),D.jsx("span",{className:"ml-auto text-xs text-primary font-medium px-2 py-1 rounded-full bg-primary/10",children:m.change})]},m.label))}),D.jsx(Xn.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.2},className:"mb-4",children:D.jsx("h2",{className:"text-xl font-semibold text-foreground mb-4 font-display",children:"Quick Actions"})}),D.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:h.map((m,E)=>D.jsx(lw,{to:m.path,children:D.jsx(i1e,{icon:m.icon,title:m.title,description:m.description,gradient:m.gradient,delay:.3+E*.1})},m.title))}),D.jsxs(Xn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.6},className:"mt-8",children:[D.jsx("h2",{className:"text-xl font-semibold text-foreground mb-4 font-display",children:"Recent Activity"}),D.jsx("div",{className:"glass rounded-2xl p-6",children:D.jsx("div",{className:"space-y-4",children:[{action:"Completed",item:"Data Structures Quiz",time:"2 hours ago"},{action:"Joined",item:"Study Room: Algorithm Design",time:"5 hours ago"},{action:"Downloaded",item:"Operating Systems Notes",time:"Yesterday"}].map((m,E)=>D.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-border last:border-0",children:[D.jsxs("div",{children:[D.jsx("span",{className:"text-primary text-sm font-medium",children:m.action}),D.jsx("span",{className:"text-foreground text-sm ml-2",children:m.item})]}),D.jsx("span",{className:"text-muted-foreground text-xs",children:m.time})]},E))})})]})]})},_y=G.forwardRef(({className:i,type:r,...a},c)=>D.jsx("input",{type:r,className:Br("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",i),ref:c,...a}));_y.displayName="Input";var o1e=G.createContext(void 0);function Tee(i){const r=G.useContext(o1e);return i||r||"ltr"}var fL="rovingFocusGroup.onEntryFocus",c1e={bubbles:!1,cancelable:!0},Hw="RovingFocusGroup",[GM,wee,l1e]=xq(Hw),[u1e,Cee]=mf(Hw,[l1e]),[d1e,h1e]=u1e(Hw),Ree=G.forwardRef((i,r)=>D.jsx(GM.Provider,{scope:i.__scopeRovingFocusGroup,children:D.jsx(GM.Slot,{scope:i.__scopeRovingFocusGroup,children:D.jsx(p1e,{...i,ref:r})})}));Ree.displayName=Hw;var p1e=G.forwardRef((i,r)=>{const{__scopeRovingFocusGroup:a,orientation:c,loop:l=!1,dir:h,currentTabStopId:m,defaultCurrentTabStopId:E,onCurrentTabStopIdChange:S,onEntryFocus:T,preventScrollOnEntryFocus:C=!1,...I}=i,N=G.useRef(null),P=Xs(r,N),H=Tee(h),[x,B]=Nw({prop:m,defaultProp:E??null,onChange:S,caller:Hw}),[X,Z]=G.useState(!1),$=lu(T),le=wee(a),re=G.useRef(!1),[ce,te]=G.useState(0);return G.useEffect(()=>{const pe=N.current;if(pe)return pe.addEventListener(fL,$),()=>pe.removeEventListener(fL,$)},[$]),D.jsx(d1e,{scope:a,orientation:c,dir:H,loop:l,currentTabStopId:x,onItemFocus:G.useCallback(pe=>B(pe),[B]),onItemShiftTab:G.useCallback(()=>Z(!0),[]),onFocusableItemAdd:G.useCallback(()=>te(pe=>pe+1),[]),onFocusableItemRemove:G.useCallback(()=>te(pe=>pe-1),[]),children:D.jsx(ri.div,{tabIndex:X||ce===0?-1:0,"data-orientation":c,...I,ref:P,style:{outline:"none",...i.style},onMouseDown:vr(i.onMouseDown,()=>{re.current=!0}),onFocus:vr(i.onFocus,pe=>{const Ee=!re.current;if(pe.target===pe.currentTarget&&Ee&&!X){const Ne=new CustomEvent(fL,c1e);if(pe.currentTarget.dispatchEvent(Ne),!Ne.defaultPrevented){const Ue=le().filter($e=>$e.focusable),Se=Ue.find($e=>$e.active),Xe=Ue.find($e=>$e.id===x),Be=[Se,Xe,...Ue].filter(Boolean).map($e=>$e.ref.current);Aee(Be,C)}}re.current=!1}),onBlur:vr(i.onBlur,()=>Z(!1))})})}),bee="RovingFocusGroupItem",Iee=G.forwardRef((i,r)=>{const{__scopeRovingFocusGroup:a,focusable:c=!0,active:l=!1,tabStopId:h,children:m,...E}=i,S=F0(),T=h||S,C=h1e(bee,a),I=C.currentTabStopId===T,N=wee(a),{onFocusableItemAdd:P,onFocusableItemRemove:H,currentTabStopId:x}=C;return G.useEffect(()=>{if(c)return P(),()=>H()},[c,P,H]),D.jsx(GM.ItemSlot,{scope:a,id:T,focusable:c,active:l,children:D.jsx(ri.span,{tabIndex:I?0:-1,"data-orientation":C.orientation,...E,ref:r,onMouseDown:vr(i.onMouseDown,B=>{c?C.onItemFocus(T):B.preventDefault()}),onFocus:vr(i.onFocus,()=>C.onItemFocus(T)),onKeyDown:vr(i.onKeyDown,B=>{if(B.key==="Tab"&&B.shiftKey){C.onItemShiftTab();return}if(B.target!==B.currentTarget)return;const X=g1e(B,C.orientation,C.dir);if(X!==void 0){if(B.metaKey||B.ctrlKey||B.altKey||B.shiftKey)return;B.preventDefault();let $=N().filter(le=>le.focusable).map(le=>le.ref.current);if(X==="last")$.reverse();else if(X==="prev"||X==="next"){X==="prev"&&$.reverse();const le=$.indexOf(B.currentTarget);$=C.loop?_1e($,le+1):$.slice(le+1)}setTimeout(()=>Aee($))}}),children:typeof m=="function"?m({isCurrentTabStop:I,hasTabStop:x!=null}):m})})});Iee.displayName=bee;var f1e={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function m1e(i,r){return r!=="rtl"?i:i==="ArrowLeft"?"ArrowRight":i==="ArrowRight"?"ArrowLeft":i}function g1e(i,r,a){const c=m1e(i.key,a);if(!(r==="vertical"&&["ArrowLeft","ArrowRight"].includes(c))&&!(r==="horizontal"&&["ArrowUp","ArrowDown"].includes(c)))return f1e[c]}function Aee(i,r=!1){const a=document.activeElement;for(const c of i)if(c===a||(c.focus({preventScroll:r}),document.activeElement!==a))return}function _1e(i,r){return i.map((a,c)=>i[(r+c)%i.length])}var E1e=Ree,y1e=Iee,zO="Tabs",[v1e]=mf(zO,[Cee]),Oee=Cee(),[S1e,$U]=v1e(zO),Nee=G.forwardRef((i,r)=>{const{__scopeTabs:a,value:c,onValueChange:l,defaultValue:h,orientation:m="horizontal",dir:E,activationMode:S="automatic",...T}=i,C=Tee(E),[I,N]=Nw({prop:c,onChange:l,defaultProp:h??"",caller:zO});return D.jsx(S1e,{scope:a,baseId:F0(),value:I,onValueChange:N,orientation:m,dir:C,activationMode:S,children:D.jsx(ri.div,{dir:C,"data-orientation":m,...T,ref:r})})});Nee.displayName=zO;var Pee="TabsList",kee=G.forwardRef((i,r)=>{const{__scopeTabs:a,loop:c=!0,...l}=i,h=$U(Pee,a),m=Oee(a);return D.jsx(E1e,{asChild:!0,...m,orientation:h.orientation,dir:h.dir,loop:c,children:D.jsx(ri.div,{role:"tablist","aria-orientation":h.orientation,...l,ref:r})})});kee.displayName=Pee;var Dee="TabsTrigger",xee=G.forwardRef((i,r)=>{const{__scopeTabs:a,value:c,disabled:l=!1,...h}=i,m=$U(Dee,a),E=Oee(a),S=Uee(m.baseId,c),T=Vee(m.baseId,c),C=c===m.value;return D.jsx(y1e,{asChild:!0,...E,focusable:!l,active:C,children:D.jsx(ri.button,{type:"button",role:"tab","aria-selected":C,"aria-controls":T,"data-state":C?"active":"inactive","data-disabled":l?"":void 0,disabled:l,id:S,...h,ref:r,onMouseDown:vr(i.onMouseDown,I=>{!l&&I.button===0&&I.ctrlKey===!1?m.onValueChange(c):I.preventDefault()}),onKeyDown:vr(i.onKeyDown,I=>{[" ","Enter"].includes(I.key)&&m.onValueChange(c)}),onFocus:vr(i.onFocus,()=>{const I=m.activationMode!=="manual";!C&&!l&&I&&m.onValueChange(c)})})})});xee.displayName=Dee;var Lee="TabsContent",Mee=G.forwardRef((i,r)=>{const{__scopeTabs:a,value:c,forceMount:l,children:h,...m}=i,E=$U(Lee,a),S=Uee(E.baseId,c),T=Vee(E.baseId,c),C=c===E.value,I=G.useRef(C);return G.useEffect(()=>{const N=requestAnimationFrame(()=>I.current=!1);return()=>cancelAnimationFrame(N)},[]),D.jsx(Fg,{present:l||C,children:({present:N})=>D.jsx(ri.div,{"data-state":C?"active":"inactive","data-orientation":E.orientation,role:"tabpanel","aria-labelledby":S,hidden:!N,id:T,tabIndex:0,...m,ref:r,style:{...i.style,animationDuration:I.current?"0s":void 0},children:N&&h})})});Mee.displayName=Lee;function Uee(i,r){return`${i}-trigger-${r}`}function Vee(i,r){return`${i}-content-${r}`}var T1e=Nee,Fee=kee,jee=xee,Bee=Mee;const w1e=T1e,Wee=G.forwardRef(({className:i,...r},a)=>D.jsx(Fee,{ref:a,className:Br("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",i),...r}));Wee.displayName=Fee.displayName;const HM=G.forwardRef(({className:i,...r},a)=>D.jsx(jee,{ref:a,className:Br("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",i),...r}));HM.displayName=jee.displayName;const zM=G.forwardRef(({className:i,...r},a)=>D.jsx(Bee,{ref:a,className:Br("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",i),...r}));zM.displayName=Bee.displayName;var Pr;(function(i){i.assertEqual=l=>{};function r(l){}i.assertIs=r;function a(l){throw new Error}i.assertNever=a,i.arrayToEnum=l=>{const h={};for(const m of l)h[m]=m;return h},i.getValidEnumValues=l=>{const h=i.objectKeys(l).filter(E=>typeof l[l[E]]!="number"),m={};for(const E of h)m[E]=l[E];return i.objectValues(m)},i.objectValues=l=>i.objectKeys(l).map(function(h){return l[h]}),i.objectKeys=typeof Object.keys=="function"?l=>Object.keys(l):l=>{const h=[];for(const m in l)Object.prototype.hasOwnProperty.call(l,m)&&h.push(m);return h},i.find=(l,h)=>{for(const m of l)if(h(m))return m},i.isInteger=typeof Number.isInteger=="function"?l=>Number.isInteger(l):l=>typeof l=="number"&&Number.isFinite(l)&&Math.floor(l)===l;function c(l,h=" | "){return l.map(m=>typeof m=="string"?`'${m}'`:m).join(h)}i.joinValues=c,i.jsonStringifyReplacer=(l,h)=>typeof h=="bigint"?h.toString():h})(Pr||(Pr={}));var EY;(function(i){i.mergeShapes=(r,a)=>({...r,...a})})(EY||(EY={}));const Jt=Pr.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),zp=i=>{switch(typeof i){case"undefined":return Jt.undefined;case"string":return Jt.string;case"number":return Number.isNaN(i)?Jt.nan:Jt.number;case"boolean":return Jt.boolean;case"function":return Jt.function;case"bigint":return Jt.bigint;case"symbol":return Jt.symbol;case"object":return Array.isArray(i)?Jt.array:i===null?Jt.null:i.then&&typeof i.then=="function"&&i.catch&&typeof i.catch=="function"?Jt.promise:typeof Map<"u"&&i instanceof Map?Jt.map:typeof Set<"u"&&i instanceof Set?Jt.set:typeof Date<"u"&&i instanceof Date?Jt.date:Jt.object;default:return Jt.unknown}},Et=Pr.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class bd extends Error{get errors(){return this.issues}constructor(r){super(),this.issues=[],this.addIssue=c=>{this.issues=[...this.issues,c]},this.addIssues=(c=[])=>{this.issues=[...this.issues,...c]};const a=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,a):this.__proto__=a,this.name="ZodError",this.issues=r}format(r){const a=r||function(h){return h.message},c={_errors:[]},l=h=>{for(const m of h.issues)if(m.code==="invalid_union")m.unionErrors.map(l);else if(m.code==="invalid_return_type")l(m.returnTypeError);else if(m.code==="invalid_arguments")l(m.argumentsError);else if(m.path.length===0)c._errors.push(a(m));else{let E=c,S=0;for(;S<m.path.length;){const T=m.path[S];S===m.path.length-1?(E[T]=E[T]||{_errors:[]},E[T]._errors.push(a(m))):E[T]=E[T]||{_errors:[]},E=E[T],S++}}};return l(this),c}static assert(r){if(!(r instanceof bd))throw new Error(`Not a ZodError: ${r}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Pr.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(r=a=>a.message){const a={},c=[];for(const l of this.issues)if(l.path.length>0){const h=l.path[0];a[h]=a[h]||[],a[h].push(r(l))}else c.push(r(l));return{formErrors:c,fieldErrors:a}}get formErrors(){return this.flatten()}}bd.create=i=>new bd(i);const KM=(i,r)=>{let a;switch(i.code){case Et.invalid_type:i.received===Jt.undefined?a="Required":a=`Expected ${i.expected}, received ${i.received}`;break;case Et.invalid_literal:a=`Invalid literal value, expected ${JSON.stringify(i.expected,Pr.jsonStringifyReplacer)}`;break;case Et.unrecognized_keys:a=`Unrecognized key(s) in object: ${Pr.joinValues(i.keys,", ")}`;break;case Et.invalid_union:a="Invalid input";break;case Et.invalid_union_discriminator:a=`Invalid discriminator value. Expected ${Pr.joinValues(i.options)}`;break;case Et.invalid_enum_value:a=`Invalid enum value. Expected ${Pr.joinValues(i.options)}, received '${i.received}'`;break;case Et.invalid_arguments:a="Invalid function arguments";break;case Et.invalid_return_type:a="Invalid function return type";break;case Et.invalid_date:a="Invalid date";break;case Et.invalid_string:typeof i.validation=="object"?"includes"in i.validation?(a=`Invalid input: must include "${i.validation.includes}"`,typeof i.validation.position=="number"&&(a=`${a} at one or more positions greater than or equal to ${i.validation.position}`)):"startsWith"in i.validation?a=`Invalid input: must start with "${i.validation.startsWith}"`:"endsWith"in i.validation?a=`Invalid input: must end with "${i.validation.endsWith}"`:Pr.assertNever(i.validation):i.validation!=="regex"?a=`Invalid ${i.validation}`:a="Invalid";break;case Et.too_small:i.type==="array"?a=`Array must contain ${i.exact?"exactly":i.inclusive?"at least":"more than"} ${i.minimum} element(s)`:i.type==="string"?a=`String must contain ${i.exact?"exactly":i.inclusive?"at least":"over"} ${i.minimum} character(s)`:i.type==="number"?a=`Number must be ${i.exact?"exactly equal to ":i.inclusive?"greater than or equal to ":"greater than "}${i.minimum}`:i.type==="bigint"?a=`Number must be ${i.exact?"exactly equal to ":i.inclusive?"greater than or equal to ":"greater than "}${i.minimum}`:i.type==="date"?a=`Date must be ${i.exact?"exactly equal to ":i.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(i.minimum))}`:a="Invalid input";break;case Et.too_big:i.type==="array"?a=`Array must contain ${i.exact?"exactly":i.inclusive?"at most":"less than"} ${i.maximum} element(s)`:i.type==="string"?a=`String must contain ${i.exact?"exactly":i.inclusive?"at most":"under"} ${i.maximum} character(s)`:i.type==="number"?a=`Number must be ${i.exact?"exactly":i.inclusive?"less than or equal to":"less than"} ${i.maximum}`:i.type==="bigint"?a=`BigInt must be ${i.exact?"exactly":i.inclusive?"less than or equal to":"less than"} ${i.maximum}`:i.type==="date"?a=`Date must be ${i.exact?"exactly":i.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(i.maximum))}`:a="Invalid input";break;case Et.custom:a="Invalid input";break;case Et.invalid_intersection_types:a="Intersection results could not be merged";break;case Et.not_multiple_of:a=`Number must be a multiple of ${i.multipleOf}`;break;case Et.not_finite:a="Number must be finite";break;default:a=r.defaultError,Pr.assertNever(i)}return{message:a}};let C1e=KM;function R1e(){return C1e}const b1e=i=>{const{data:r,path:a,errorMaps:c,issueData:l}=i,h=[...a,...l.path||[]],m={...l,path:h};if(l.message!==void 0)return{...l,path:h,message:l.message};let E="";const S=c.filter(T=>!!T).slice().reverse();for(const T of S)E=T(m,{data:r,defaultError:E}).message;return{...l,path:h,message:E}};function kt(i,r){const a=R1e(),c=b1e({issueData:r,data:i.data,path:i.path,errorMaps:[i.common.contextualErrorMap,i.schemaErrorMap,a,a===KM?void 0:KM].filter(l=>!!l)});i.common.issues.push(c)}class yc{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(r,a){const c=[];for(const l of a){if(l.status==="aborted")return Dn;l.status==="dirty"&&r.dirty(),c.push(l.value)}return{status:r.value,value:c}}static async mergeObjectAsync(r,a){const c=[];for(const l of a){const h=await l.key,m=await l.value;c.push({key:h,value:m})}return yc.mergeObjectSync(r,c)}static mergeObjectSync(r,a){const c={};for(const l of a){const{key:h,value:m}=l;if(h.status==="aborted"||m.status==="aborted")return Dn;h.status==="dirty"&&r.dirty(),m.status==="dirty"&&r.dirty(),h.value!=="__proto__"&&(typeof m.value<"u"||l.alwaysSet)&&(c[h.value]=m.value)}return{status:r.value,value:c}}}const Dn=Object.freeze({status:"aborted"}),M0=i=>({status:"dirty",value:i}),dl=i=>({status:"valid",value:i}),yY=i=>i.status==="aborted",vY=i=>i.status==="dirty",ev=i=>i.status==="valid",oO=i=>typeof Promise<"u"&&i instanceof Promise;var $t;(function(i){i.errToObj=r=>typeof r=="string"?{message:r}:r||{},i.toString=r=>typeof r=="string"?r:r?.message})($t||($t={}));class pf{constructor(r,a,c,l){this._cachedPath=[],this.parent=r,this.data=a,this._path=c,this._key=l}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const SY=(i,r)=>{if(ev(r))return{success:!0,data:r.value};if(!i.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const a=new bd(i.common.issues);return this._error=a,this._error}}};function rr(i){if(!i)return{};const{errorMap:r,invalid_type_error:a,required_error:c,description:l}=i;if(r&&(a||c))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return r?{errorMap:r,description:l}:{errorMap:(m,E)=>{const{message:S}=i;return m.code==="invalid_enum_value"?{message:S??E.defaultError}:typeof E.data>"u"?{message:S??c??E.defaultError}:m.code!=="invalid_type"?{message:E.defaultError}:{message:S??a??E.defaultError}},description:l}}class br{get description(){return this._def.description}_getType(r){return zp(r.data)}_getOrReturnCtx(r,a){return a||{common:r.parent.common,data:r.data,parsedType:zp(r.data),schemaErrorMap:this._def.errorMap,path:r.path,parent:r.parent}}_processInputParams(r){return{status:new yc,ctx:{common:r.parent.common,data:r.data,parsedType:zp(r.data),schemaErrorMap:this._def.errorMap,path:r.path,parent:r.parent}}}_parseSync(r){const a=this._parse(r);if(oO(a))throw new Error("Synchronous parse encountered promise.");return a}_parseAsync(r){const a=this._parse(r);return Promise.resolve(a)}parse(r,a){const c=this.safeParse(r,a);if(c.success)return c.data;throw c.error}safeParse(r,a){const c={common:{issues:[],async:a?.async??!1,contextualErrorMap:a?.errorMap},path:a?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:r,parsedType:zp(r)},l=this._parseSync({data:r,path:c.path,parent:c});return SY(c,l)}"~validate"(r){const a={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:r,parsedType:zp(r)};if(!this["~standard"].async)try{const c=this._parseSync({data:r,path:[],parent:a});return ev(c)?{value:c.value}:{issues:a.common.issues}}catch(c){c?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),a.common={issues:[],async:!0}}return this._parseAsync({data:r,path:[],parent:a}).then(c=>ev(c)?{value:c.value}:{issues:a.common.issues})}async parseAsync(r,a){const c=await this.safeParseAsync(r,a);if(c.success)return c.data;throw c.error}async safeParseAsync(r,a){const c={common:{issues:[],contextualErrorMap:a?.errorMap,async:!0},path:a?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:r,parsedType:zp(r)},l=this._parse({data:r,path:c.path,parent:c}),h=await(oO(l)?l:Promise.resolve(l));return SY(c,h)}refine(r,a){const c=l=>typeof a=="string"||typeof a>"u"?{message:a}:typeof a=="function"?a(l):a;return this._refinement((l,h)=>{const m=r(l),E=()=>h.addIssue({code:Et.custom,...c(l)});return typeof Promise<"u"&&m instanceof Promise?m.then(S=>S?!0:(E(),!1)):m?!0:(E(),!1)})}refinement(r,a){return this._refinement((c,l)=>r(c)?!0:(l.addIssue(typeof a=="function"?a(c,l):a),!1))}_refinement(r){return new nv({schema:this,typeName:xn.ZodEffects,effect:{type:"refinement",refinement:r}})}superRefine(r){return this._refinement(r)}constructor(r){this.spa=this.safeParseAsync,this._def=r,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:a=>this["~validate"](a)}}optional(){return sf.create(this,this._def)}nullable(){return rv.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Td.create(this)}promise(){return dO.create(this,this._def)}or(r){return lO.create([this,r],this._def)}and(r){return uO.create(this,r,this._def)}transform(r){return new nv({...rr(this._def),schema:this,typeName:xn.ZodEffects,effect:{type:"transform",transform:r}})}default(r){const a=typeof r=="function"?r:()=>r;return new qM({...rr(this._def),innerType:this,defaultValue:a,typeName:xn.ZodDefault})}brand(){return new X1e({typeName:xn.ZodBranded,type:this,...rr(this._def)})}catch(r){const a=typeof r=="function"?r:()=>r;return new XM({...rr(this._def),innerType:this,catchValue:a,typeName:xn.ZodCatch})}describe(r){const a=this.constructor;return new a({...this._def,description:r})}pipe(r){return QU.create(this,r)}readonly(){return JM.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const I1e=/^c[^\s-]{8,}$/i,A1e=/^[0-9a-z]+$/,O1e=/^[0-9A-HJKMNP-TV-Z]{26}$/i,N1e=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,P1e=/^[a-z0-9_-]{21}$/i,k1e=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,D1e=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,x1e=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,L1e="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let mL;const M1e=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,U1e=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,V1e=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,F1e=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,j1e=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,B1e=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Gee="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",W1e=new RegExp(`^${Gee}$`);function Hee(i){let r="[0-5]\\d";i.precision?r=`${r}\\.\\d{${i.precision}}`:i.precision==null&&(r=`${r}(\\.\\d+)?`);const a=i.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${r})${a}`}function G1e(i){return new RegExp(`^${Hee(i)}$`)}function H1e(i){let r=`${Gee}T${Hee(i)}`;const a=[];return a.push(i.local?"Z?":"Z"),i.offset&&a.push("([+-]\\d{2}:?\\d{2})"),r=`${r}(${a.join("|")})`,new RegExp(`^${r}$`)}function z1e(i,r){return!!((r==="v4"||!r)&&M1e.test(i)||(r==="v6"||!r)&&V1e.test(i))}function K1e(i,r){if(!k1e.test(i))return!1;try{const[a]=i.split(".");if(!a)return!1;const c=a.replace(/-/g,"+").replace(/_/g,"/").padEnd(a.length+(4-a.length%4)%4,"="),l=JSON.parse(atob(c));return!(typeof l!="object"||l===null||"typ"in l&&l?.typ!=="JWT"||!l.alg||r&&l.alg!==r)}catch{return!1}}function Y1e(i,r){return!!((r==="v4"||!r)&&U1e.test(i)||(r==="v6"||!r)&&F1e.test(i))}class Zp extends br{_parse(r){if(this._def.coerce&&(r.data=String(r.data)),this._getType(r)!==Jt.string){const h=this._getOrReturnCtx(r);return kt(h,{code:Et.invalid_type,expected:Jt.string,received:h.parsedType}),Dn}const c=new yc;let l;for(const h of this._def.checks)if(h.kind==="min")r.data.length<h.value&&(l=this._getOrReturnCtx(r,l),kt(l,{code:Et.too_small,minimum:h.value,type:"string",inclusive:!0,exact:!1,message:h.message}),c.dirty());else if(h.kind==="max")r.data.length>h.value&&(l=this._getOrReturnCtx(r,l),kt(l,{code:Et.too_big,maximum:h.value,type:"string",inclusive:!0,exact:!1,message:h.message}),c.dirty());else if(h.kind==="length"){const m=r.data.length>h.value,E=r.data.length<h.value;(m||E)&&(l=this._getOrReturnCtx(r,l),m?kt(l,{code:Et.too_big,maximum:h.value,type:"string",inclusive:!0,exact:!0,message:h.message}):E&&kt(l,{code:Et.too_small,minimum:h.value,type:"string",inclusive:!0,exact:!0,message:h.message}),c.dirty())}else if(h.kind==="email")x1e.test(r.data)||(l=this._getOrReturnCtx(r,l),kt(l,{validation:"email",code:Et.invalid_string,message:h.message}),c.dirty());else if(h.kind==="emoji")mL||(mL=new RegExp(L1e,"u")),mL.test(r.data)||(l=this._getOrReturnCtx(r,l),kt(l,{validation:"emoji",code:Et.invalid_string,message:h.message}),c.dirty());else if(h.kind==="uuid")N1e.test(r.data)||(l=this._getOrReturnCtx(r,l),kt(l,{validation:"uuid",code:Et.invalid_string,message:h.message}),c.dirty());else if(h.kind==="nanoid")P1e.test(r.data)||(l=this._getOrReturnCtx(r,l),kt(l,{validation:"nanoid",code:Et.invalid_string,message:h.message}),c.dirty());else if(h.kind==="cuid")I1e.test(r.data)||(l=this._getOrReturnCtx(r,l),kt(l,{validation:"cuid",code:Et.invalid_string,message:h.message}),c.dirty());else if(h.kind==="cuid2")A1e.test(r.data)||(l=this._getOrReturnCtx(r,l),kt(l,{validation:"cuid2",code:Et.invalid_string,message:h.message}),c.dirty());else if(h.kind==="ulid")O1e.test(r.data)||(l=this._getOrReturnCtx(r,l),kt(l,{validation:"ulid",code:Et.invalid_string,message:h.message}),c.dirty());else if(h.kind==="url")try{new URL(r.data)}catch{l=this._getOrReturnCtx(r,l),kt(l,{validation:"url",code:Et.invalid_string,message:h.message}),c.dirty()}else h.kind==="regex"?(h.regex.lastIndex=0,h.regex.test(r.data)||(l=this._getOrReturnCtx(r,l),kt(l,{validation:"regex",code:Et.invalid_string,message:h.message}),c.dirty())):h.kind==="trim"?r.data=r.data.trim():h.kind==="includes"?r.data.includes(h.value,h.position)||(l=this._getOrReturnCtx(r,l),kt(l,{code:Et.invalid_string,validation:{includes:h.value,position:h.position},message:h.message}),c.dirty()):h.kind==="toLowerCase"?r.data=r.data.toLowerCase():h.kind==="toUpperCase"?r.data=r.data.toUpperCase():h.kind==="startsWith"?r.data.startsWith(h.value)||(l=this._getOrReturnCtx(r,l),kt(l,{code:Et.invalid_string,validation:{startsWith:h.value},message:h.message}),c.dirty()):h.kind==="endsWith"?r.data.endsWith(h.value)||(l=this._getOrReturnCtx(r,l),kt(l,{code:Et.invalid_string,validation:{endsWith:h.value},message:h.message}),c.dirty()):h.kind==="datetime"?H1e(h).test(r.data)||(l=this._getOrReturnCtx(r,l),kt(l,{code:Et.invalid_string,validation:"datetime",message:h.message}),c.dirty()):h.kind==="date"?W1e.test(r.data)||(l=this._getOrReturnCtx(r,l),kt(l,{code:Et.invalid_string,validation:"date",message:h.message}),c.dirty()):h.kind==="time"?G1e(h).test(r.data)||(l=this._getOrReturnCtx(r,l),kt(l,{code:Et.invalid_string,validation:"time",message:h.message}),c.dirty()):h.kind==="duration"?D1e.test(r.data)||(l=this._getOrReturnCtx(r,l),kt(l,{validation:"duration",code:Et.invalid_string,message:h.message}),c.dirty()):h.kind==="ip"?z1e(r.data,h.version)||(l=this._getOrReturnCtx(r,l),kt(l,{validation:"ip",code:Et.invalid_string,message:h.message}),c.dirty()):h.kind==="jwt"?K1e(r.data,h.alg)||(l=this._getOrReturnCtx(r,l),kt(l,{validation:"jwt",code:Et.invalid_string,message:h.message}),c.dirty()):h.kind==="cidr"?Y1e(r.data,h.version)||(l=this._getOrReturnCtx(r,l),kt(l,{validation:"cidr",code:Et.invalid_string,message:h.message}),c.dirty()):h.kind==="base64"?j1e.test(r.data)||(l=this._getOrReturnCtx(r,l),kt(l,{validation:"base64",code:Et.invalid_string,message:h.message}),c.dirty()):h.kind==="base64url"?B1e.test(r.data)||(l=this._getOrReturnCtx(r,l),kt(l,{validation:"base64url",code:Et.invalid_string,message:h.message}),c.dirty()):Pr.assertNever(h);return{status:c.value,value:r.data}}_regex(r,a,c){return this.refinement(l=>r.test(l),{validation:a,code:Et.invalid_string,...$t.errToObj(c)})}_addCheck(r){return new Zp({...this._def,checks:[...this._def.checks,r]})}email(r){return this._addCheck({kind:"email",...$t.errToObj(r)})}url(r){return this._addCheck({kind:"url",...$t.errToObj(r)})}emoji(r){return this._addCheck({kind:"emoji",...$t.errToObj(r)})}uuid(r){return this._addCheck({kind:"uuid",...$t.errToObj(r)})}nanoid(r){return this._addCheck({kind:"nanoid",...$t.errToObj(r)})}cuid(r){return this._addCheck({kind:"cuid",...$t.errToObj(r)})}cuid2(r){return this._addCheck({kind:"cuid2",...$t.errToObj(r)})}ulid(r){return this._addCheck({kind:"ulid",...$t.errToObj(r)})}base64(r){return this._addCheck({kind:"base64",...$t.errToObj(r)})}base64url(r){return this._addCheck({kind:"base64url",...$t.errToObj(r)})}jwt(r){return this._addCheck({kind:"jwt",...$t.errToObj(r)})}ip(r){return this._addCheck({kind:"ip",...$t.errToObj(r)})}cidr(r){return this._addCheck({kind:"cidr",...$t.errToObj(r)})}datetime(r){return typeof r=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:r}):this._addCheck({kind:"datetime",precision:typeof r?.precision>"u"?null:r?.precision,offset:r?.offset??!1,local:r?.local??!1,...$t.errToObj(r?.message)})}date(r){return this._addCheck({kind:"date",message:r})}time(r){return typeof r=="string"?this._addCheck({kind:"time",precision:null,message:r}):this._addCheck({kind:"time",precision:typeof r?.precision>"u"?null:r?.precision,...$t.errToObj(r?.message)})}duration(r){return this._addCheck({kind:"duration",...$t.errToObj(r)})}regex(r,a){return this._addCheck({kind:"regex",regex:r,...$t.errToObj(a)})}includes(r,a){return this._addCheck({kind:"includes",value:r,position:a?.position,...$t.errToObj(a?.message)})}startsWith(r,a){return this._addCheck({kind:"startsWith",value:r,...$t.errToObj(a)})}endsWith(r,a){return this._addCheck({kind:"endsWith",value:r,...$t.errToObj(a)})}min(r,a){return this._addCheck({kind:"min",value:r,...$t.errToObj(a)})}max(r,a){return this._addCheck({kind:"max",value:r,...$t.errToObj(a)})}length(r,a){return this._addCheck({kind:"length",value:r,...$t.errToObj(a)})}nonempty(r){return this.min(1,$t.errToObj(r))}trim(){return new Zp({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Zp({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Zp({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(r=>r.kind==="datetime")}get isDate(){return!!this._def.checks.find(r=>r.kind==="date")}get isTime(){return!!this._def.checks.find(r=>r.kind==="time")}get isDuration(){return!!this._def.checks.find(r=>r.kind==="duration")}get isEmail(){return!!this._def.checks.find(r=>r.kind==="email")}get isURL(){return!!this._def.checks.find(r=>r.kind==="url")}get isEmoji(){return!!this._def.checks.find(r=>r.kind==="emoji")}get isUUID(){return!!this._def.checks.find(r=>r.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(r=>r.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(r=>r.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(r=>r.kind==="cuid2")}get isULID(){return!!this._def.checks.find(r=>r.kind==="ulid")}get isIP(){return!!this._def.checks.find(r=>r.kind==="ip")}get isCIDR(){return!!this._def.checks.find(r=>r.kind==="cidr")}get isBase64(){return!!this._def.checks.find(r=>r.kind==="base64")}get isBase64url(){return!!this._def.checks.find(r=>r.kind==="base64url")}get minLength(){let r=null;for(const a of this._def.checks)a.kind==="min"&&(r===null||a.value>r)&&(r=a.value);return r}get maxLength(){let r=null;for(const a of this._def.checks)a.kind==="max"&&(r===null||a.value<r)&&(r=a.value);return r}}Zp.create=i=>new Zp({checks:[],typeName:xn.ZodString,coerce:i?.coerce??!1,...rr(i)});function q1e(i,r){const a=(i.toString().split(".")[1]||"").length,c=(r.toString().split(".")[1]||"").length,l=a>c?a:c,h=Number.parseInt(i.toFixed(l).replace(".","")),m=Number.parseInt(r.toFixed(l).replace(".",""));return h%m/10**l}class Rw extends br{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(r){if(this._def.coerce&&(r.data=Number(r.data)),this._getType(r)!==Jt.number){const h=this._getOrReturnCtx(r);return kt(h,{code:Et.invalid_type,expected:Jt.number,received:h.parsedType}),Dn}let c;const l=new yc;for(const h of this._def.checks)h.kind==="int"?Pr.isInteger(r.data)||(c=this._getOrReturnCtx(r,c),kt(c,{code:Et.invalid_type,expected:"integer",received:"float",message:h.message}),l.dirty()):h.kind==="min"?(h.inclusive?r.data<h.value:r.data<=h.value)&&(c=this._getOrReturnCtx(r,c),kt(c,{code:Et.too_small,minimum:h.value,type:"number",inclusive:h.inclusive,exact:!1,message:h.message}),l.dirty()):h.kind==="max"?(h.inclusive?r.data>h.value:r.data>=h.value)&&(c=this._getOrReturnCtx(r,c),kt(c,{code:Et.too_big,maximum:h.value,type:"number",inclusive:h.inclusive,exact:!1,message:h.message}),l.dirty()):h.kind==="multipleOf"?q1e(r.data,h.value)!==0&&(c=this._getOrReturnCtx(r,c),kt(c,{code:Et.not_multiple_of,multipleOf:h.value,message:h.message}),l.dirty()):h.kind==="finite"?Number.isFinite(r.data)||(c=this._getOrReturnCtx(r,c),kt(c,{code:Et.not_finite,message:h.message}),l.dirty()):Pr.assertNever(h);return{status:l.value,value:r.data}}gte(r,a){return this.setLimit("min",r,!0,$t.toString(a))}gt(r,a){return this.setLimit("min",r,!1,$t.toString(a))}lte(r,a){return this.setLimit("max",r,!0,$t.toString(a))}lt(r,a){return this.setLimit("max",r,!1,$t.toString(a))}setLimit(r,a,c,l){return new Rw({...this._def,checks:[...this._def.checks,{kind:r,value:a,inclusive:c,message:$t.toString(l)}]})}_addCheck(r){return new Rw({...this._def,checks:[...this._def.checks,r]})}int(r){return this._addCheck({kind:"int",message:$t.toString(r)})}positive(r){return this._addCheck({kind:"min",value:0,inclusive:!1,message:$t.toString(r)})}negative(r){return this._addCheck({kind:"max",value:0,inclusive:!1,message:$t.toString(r)})}nonpositive(r){return this._addCheck({kind:"max",value:0,inclusive:!0,message:$t.toString(r)})}nonnegative(r){return this._addCheck({kind:"min",value:0,inclusive:!0,message:$t.toString(r)})}multipleOf(r,a){return this._addCheck({kind:"multipleOf",value:r,message:$t.toString(a)})}finite(r){return this._addCheck({kind:"finite",message:$t.toString(r)})}safe(r){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:$t.toString(r)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:$t.toString(r)})}get minValue(){let r=null;for(const a of this._def.checks)a.kind==="min"&&(r===null||a.value>r)&&(r=a.value);return r}get maxValue(){let r=null;for(const a of this._def.checks)a.kind==="max"&&(r===null||a.value<r)&&(r=a.value);return r}get isInt(){return!!this._def.checks.find(r=>r.kind==="int"||r.kind==="multipleOf"&&Pr.isInteger(r.value))}get isFinite(){let r=null,a=null;for(const c of this._def.checks){if(c.kind==="finite"||c.kind==="int"||c.kind==="multipleOf")return!0;c.kind==="min"?(a===null||c.value>a)&&(a=c.value):c.kind==="max"&&(r===null||c.value<r)&&(r=c.value)}return Number.isFinite(a)&&Number.isFinite(r)}}Rw.create=i=>new Rw({checks:[],typeName:xn.ZodNumber,coerce:i?.coerce||!1,...rr(i)});class bw extends br{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(r){if(this._def.coerce)try{r.data=BigInt(r.data)}catch{return this._getInvalidInput(r)}if(this._getType(r)!==Jt.bigint)return this._getInvalidInput(r);let c;const l=new yc;for(const h of this._def.checks)h.kind==="min"?(h.inclusive?r.data<h.value:r.data<=h.value)&&(c=this._getOrReturnCtx(r,c),kt(c,{code:Et.too_small,type:"bigint",minimum:h.value,inclusive:h.inclusive,message:h.message}),l.dirty()):h.kind==="max"?(h.inclusive?r.data>h.value:r.data>=h.value)&&(c=this._getOrReturnCtx(r,c),kt(c,{code:Et.too_big,type:"bigint",maximum:h.value,inclusive:h.inclusive,message:h.message}),l.dirty()):h.kind==="multipleOf"?r.data%h.value!==BigInt(0)&&(c=this._getOrReturnCtx(r,c),kt(c,{code:Et.not_multiple_of,multipleOf:h.value,message:h.message}),l.dirty()):Pr.assertNever(h);return{status:l.value,value:r.data}}_getInvalidInput(r){const a=this._getOrReturnCtx(r);return kt(a,{code:Et.invalid_type,expected:Jt.bigint,received:a.parsedType}),Dn}gte(r,a){return this.setLimit("min",r,!0,$t.toString(a))}gt(r,a){return this.setLimit("min",r,!1,$t.toString(a))}lte(r,a){return this.setLimit("max",r,!0,$t.toString(a))}lt(r,a){return this.setLimit("max",r,!1,$t.toString(a))}setLimit(r,a,c,l){return new bw({...this._def,checks:[...this._def.checks,{kind:r,value:a,inclusive:c,message:$t.toString(l)}]})}_addCheck(r){return new bw({...this._def,checks:[...this._def.checks,r]})}positive(r){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:$t.toString(r)})}negative(r){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:$t.toString(r)})}nonpositive(r){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:$t.toString(r)})}nonnegative(r){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:$t.toString(r)})}multipleOf(r,a){return this._addCheck({kind:"multipleOf",value:r,message:$t.toString(a)})}get minValue(){let r=null;for(const a of this._def.checks)a.kind==="min"&&(r===null||a.value>r)&&(r=a.value);return r}get maxValue(){let r=null;for(const a of this._def.checks)a.kind==="max"&&(r===null||a.value<r)&&(r=a.value);return r}}bw.create=i=>new bw({checks:[],typeName:xn.ZodBigInt,coerce:i?.coerce??!1,...rr(i)});class TY extends br{_parse(r){if(this._def.coerce&&(r.data=!!r.data),this._getType(r)!==Jt.boolean){const c=this._getOrReturnCtx(r);return kt(c,{code:Et.invalid_type,expected:Jt.boolean,received:c.parsedType}),Dn}return dl(r.data)}}TY.create=i=>new TY({typeName:xn.ZodBoolean,coerce:i?.coerce||!1,...rr(i)});class cO extends br{_parse(r){if(this._def.coerce&&(r.data=new Date(r.data)),this._getType(r)!==Jt.date){const h=this._getOrReturnCtx(r);return kt(h,{code:Et.invalid_type,expected:Jt.date,received:h.parsedType}),Dn}if(Number.isNaN(r.data.getTime())){const h=this._getOrReturnCtx(r);return kt(h,{code:Et.invalid_date}),Dn}const c=new yc;let l;for(const h of this._def.checks)h.kind==="min"?r.data.getTime()<h.value&&(l=this._getOrReturnCtx(r,l),kt(l,{code:Et.too_small,message:h.message,inclusive:!0,exact:!1,minimum:h.value,type:"date"}),c.dirty()):h.kind==="max"?r.data.getTime()>h.value&&(l=this._getOrReturnCtx(r,l),kt(l,{code:Et.too_big,message:h.message,inclusive:!0,exact:!1,maximum:h.value,type:"date"}),c.dirty()):Pr.assertNever(h);return{status:c.value,value:new Date(r.data.getTime())}}_addCheck(r){return new cO({...this._def,checks:[...this._def.checks,r]})}min(r,a){return this._addCheck({kind:"min",value:r.getTime(),message:$t.toString(a)})}max(r,a){return this._addCheck({kind:"max",value:r.getTime(),message:$t.toString(a)})}get minDate(){let r=null;for(const a of this._def.checks)a.kind==="min"&&(r===null||a.value>r)&&(r=a.value);return r!=null?new Date(r):null}get maxDate(){let r=null;for(const a of this._def.checks)a.kind==="max"&&(r===null||a.value<r)&&(r=a.value);return r!=null?new Date(r):null}}cO.create=i=>new cO({checks:[],coerce:i?.coerce||!1,typeName:xn.ZodDate,...rr(i)});class wY extends br{_parse(r){if(this._getType(r)!==Jt.symbol){const c=this._getOrReturnCtx(r);return kt(c,{code:Et.invalid_type,expected:Jt.symbol,received:c.parsedType}),Dn}return dl(r.data)}}wY.create=i=>new wY({typeName:xn.ZodSymbol,...rr(i)});class CY extends br{_parse(r){if(this._getType(r)!==Jt.undefined){const c=this._getOrReturnCtx(r);return kt(c,{code:Et.invalid_type,expected:Jt.undefined,received:c.parsedType}),Dn}return dl(r.data)}}CY.create=i=>new CY({typeName:xn.ZodUndefined,...rr(i)});class RY extends br{_parse(r){if(this._getType(r)!==Jt.null){const c=this._getOrReturnCtx(r);return kt(c,{code:Et.invalid_type,expected:Jt.null,received:c.parsedType}),Dn}return dl(r.data)}}RY.create=i=>new RY({typeName:xn.ZodNull,...rr(i)});class bY extends br{constructor(){super(...arguments),this._any=!0}_parse(r){return dl(r.data)}}bY.create=i=>new bY({typeName:xn.ZodAny,...rr(i)});class IY extends br{constructor(){super(...arguments),this._unknown=!0}_parse(r){return dl(r.data)}}IY.create=i=>new IY({typeName:xn.ZodUnknown,...rr(i)});class ff extends br{_parse(r){const a=this._getOrReturnCtx(r);return kt(a,{code:Et.invalid_type,expected:Jt.never,received:a.parsedType}),Dn}}ff.create=i=>new ff({typeName:xn.ZodNever,...rr(i)});class AY extends br{_parse(r){if(this._getType(r)!==Jt.undefined){const c=this._getOrReturnCtx(r);return kt(c,{code:Et.invalid_type,expected:Jt.void,received:c.parsedType}),Dn}return dl(r.data)}}AY.create=i=>new AY({typeName:xn.ZodVoid,...rr(i)});class Td extends br{_parse(r){const{ctx:a,status:c}=this._processInputParams(r),l=this._def;if(a.parsedType!==Jt.array)return kt(a,{code:Et.invalid_type,expected:Jt.array,received:a.parsedType}),Dn;if(l.exactLength!==null){const m=a.data.length>l.exactLength.value,E=a.data.length<l.exactLength.value;(m||E)&&(kt(a,{code:m?Et.too_big:Et.too_small,minimum:E?l.exactLength.value:void 0,maximum:m?l.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:l.exactLength.message}),c.dirty())}if(l.minLength!==null&&a.data.length<l.minLength.value&&(kt(a,{code:Et.too_small,minimum:l.minLength.value,type:"array",inclusive:!0,exact:!1,message:l.minLength.message}),c.dirty()),l.maxLength!==null&&a.data.length>l.maxLength.value&&(kt(a,{code:Et.too_big,maximum:l.maxLength.value,type:"array",inclusive:!0,exact:!1,message:l.maxLength.message}),c.dirty()),a.common.async)return Promise.all([...a.data].map((m,E)=>l.type._parseAsync(new pf(a,m,a.path,E)))).then(m=>yc.mergeArray(c,m));const h=[...a.data].map((m,E)=>l.type._parseSync(new pf(a,m,a.path,E)));return yc.mergeArray(c,h)}get element(){return this._def.type}min(r,a){return new Td({...this._def,minLength:{value:r,message:$t.toString(a)}})}max(r,a){return new Td({...this._def,maxLength:{value:r,message:$t.toString(a)}})}length(r,a){return new Td({...this._def,exactLength:{value:r,message:$t.toString(a)}})}nonempty(r){return this.min(1,r)}}Td.create=(i,r)=>new Td({type:i,minLength:null,maxLength:null,exactLength:null,typeName:xn.ZodArray,...rr(r)});function Ey(i){if(i instanceof ws){const r={};for(const a in i.shape){const c=i.shape[a];r[a]=sf.create(Ey(c))}return new ws({...i._def,shape:()=>r})}else return i instanceof Td?new Td({...i._def,type:Ey(i.element)}):i instanceof sf?sf.create(Ey(i.unwrap())):i instanceof rv?rv.create(Ey(i.unwrap())):i instanceof Ug?Ug.create(i.items.map(r=>Ey(r))):i}class ws extends br{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const r=this._def.shape(),a=Pr.objectKeys(r);return this._cached={shape:r,keys:a},this._cached}_parse(r){if(this._getType(r)!==Jt.object){const T=this._getOrReturnCtx(r);return kt(T,{code:Et.invalid_type,expected:Jt.object,received:T.parsedType}),Dn}const{status:c,ctx:l}=this._processInputParams(r),{shape:h,keys:m}=this._getCached(),E=[];if(!(this._def.catchall instanceof ff&&this._def.unknownKeys==="strip"))for(const T in l.data)m.includes(T)||E.push(T);const S=[];for(const T of m){const C=h[T],I=l.data[T];S.push({key:{status:"valid",value:T},value:C._parse(new pf(l,I,l.path,T)),alwaysSet:T in l.data})}if(this._def.catchall instanceof ff){const T=this._def.unknownKeys;if(T==="passthrough")for(const C of E)S.push({key:{status:"valid",value:C},value:{status:"valid",value:l.data[C]}});else if(T==="strict")E.length>0&&(kt(l,{code:Et.unrecognized_keys,keys:E}),c.dirty());else if(T!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const T=this._def.catchall;for(const C of E){const I=l.data[C];S.push({key:{status:"valid",value:C},value:T._parse(new pf(l,I,l.path,C)),alwaysSet:C in l.data})}}return l.common.async?Promise.resolve().then(async()=>{const T=[];for(const C of S){const I=await C.key,N=await C.value;T.push({key:I,value:N,alwaysSet:C.alwaysSet})}return T}).then(T=>yc.mergeObjectSync(c,T)):yc.mergeObjectSync(c,S)}get shape(){return this._def.shape()}strict(r){return $t.errToObj,new ws({...this._def,unknownKeys:"strict",...r!==void 0?{errorMap:(a,c)=>{const l=this._def.errorMap?.(a,c).message??c.defaultError;return a.code==="unrecognized_keys"?{message:$t.errToObj(r).message??l}:{message:l}}}:{}})}strip(){return new ws({...this._def,unknownKeys:"strip"})}passthrough(){return new ws({...this._def,unknownKeys:"passthrough"})}extend(r){return new ws({...this._def,shape:()=>({...this._def.shape(),...r})})}merge(r){return new ws({unknownKeys:r._def.unknownKeys,catchall:r._def.catchall,shape:()=>({...this._def.shape(),...r._def.shape()}),typeName:xn.ZodObject})}setKey(r,a){return this.augment({[r]:a})}catchall(r){return new ws({...this._def,catchall:r})}pick(r){const a={};for(const c of Pr.objectKeys(r))r[c]&&this.shape[c]&&(a[c]=this.shape[c]);return new ws({...this._def,shape:()=>a})}omit(r){const a={};for(const c of Pr.objectKeys(this.shape))r[c]||(a[c]=this.shape[c]);return new ws({...this._def,shape:()=>a})}deepPartial(){return Ey(this)}partial(r){const a={};for(const c of Pr.objectKeys(this.shape)){const l=this.shape[c];r&&!r[c]?a[c]=l:a[c]=l.optional()}return new ws({...this._def,shape:()=>a})}required(r){const a={};for(const c of Pr.objectKeys(this.shape))if(r&&!r[c])a[c]=this.shape[c];else{let h=this.shape[c];for(;h instanceof sf;)h=h._def.innerType;a[c]=h}return new ws({...this._def,shape:()=>a})}keyof(){return zee(Pr.objectKeys(this.shape))}}ws.create=(i,r)=>new ws({shape:()=>i,unknownKeys:"strip",catchall:ff.create(),typeName:xn.ZodObject,...rr(r)});ws.strictCreate=(i,r)=>new ws({shape:()=>i,unknownKeys:"strict",catchall:ff.create(),typeName:xn.ZodObject,...rr(r)});ws.lazycreate=(i,r)=>new ws({shape:i,unknownKeys:"strip",catchall:ff.create(),typeName:xn.ZodObject,...rr(r)});class lO extends br{_parse(r){const{ctx:a}=this._processInputParams(r),c=this._def.options;function l(h){for(const E of h)if(E.result.status==="valid")return E.result;for(const E of h)if(E.result.status==="dirty")return a.common.issues.push(...E.ctx.common.issues),E.result;const m=h.map(E=>new bd(E.ctx.common.issues));return kt(a,{code:Et.invalid_union,unionErrors:m}),Dn}if(a.common.async)return Promise.all(c.map(async h=>{const m={...a,common:{...a.common,issues:[]},parent:null};return{result:await h._parseAsync({data:a.data,path:a.path,parent:m}),ctx:m}})).then(l);{let h;const m=[];for(const S of c){const T={...a,common:{...a.common,issues:[]},parent:null},C=S._parseSync({data:a.data,path:a.path,parent:T});if(C.status==="valid")return C;C.status==="dirty"&&!h&&(h={result:C,ctx:T}),T.common.issues.length&&m.push(T.common.issues)}if(h)return a.common.issues.push(...h.ctx.common.issues),h.result;const E=m.map(S=>new bd(S));return kt(a,{code:Et.invalid_union,unionErrors:E}),Dn}}get options(){return this._def.options}}lO.create=(i,r)=>new lO({options:i,typeName:xn.ZodUnion,...rr(r)});function YM(i,r){const a=zp(i),c=zp(r);if(i===r)return{valid:!0,data:i};if(a===Jt.object&&c===Jt.object){const l=Pr.objectKeys(r),h=Pr.objectKeys(i).filter(E=>l.indexOf(E)!==-1),m={...i,...r};for(const E of h){const S=YM(i[E],r[E]);if(!S.valid)return{valid:!1};m[E]=S.data}return{valid:!0,data:m}}else if(a===Jt.array&&c===Jt.array){if(i.length!==r.length)return{valid:!1};const l=[];for(let h=0;h<i.length;h++){const m=i[h],E=r[h],S=YM(m,E);if(!S.valid)return{valid:!1};l.push(S.data)}return{valid:!0,data:l}}else return a===Jt.date&&c===Jt.date&&+i==+r?{valid:!0,data:i}:{valid:!1}}class uO extends br{_parse(r){const{status:a,ctx:c}=this._processInputParams(r),l=(h,m)=>{if(yY(h)||yY(m))return Dn;const E=YM(h.value,m.value);return E.valid?((vY(h)||vY(m))&&a.dirty(),{status:a.value,value:E.data}):(kt(c,{code:Et.invalid_intersection_types}),Dn)};return c.common.async?Promise.all([this._def.left._parseAsync({data:c.data,path:c.path,parent:c}),this._def.right._parseAsync({data:c.data,path:c.path,parent:c})]).then(([h,m])=>l(h,m)):l(this._def.left._parseSync({data:c.data,path:c.path,parent:c}),this._def.right._parseSync({data:c.data,path:c.path,parent:c}))}}uO.create=(i,r,a)=>new uO({left:i,right:r,typeName:xn.ZodIntersection,...rr(a)});class Ug extends br{_parse(r){const{status:a,ctx:c}=this._processInputParams(r);if(c.parsedType!==Jt.array)return kt(c,{code:Et.invalid_type,expected:Jt.array,received:c.parsedType}),Dn;if(c.data.length<this._def.items.length)return kt(c,{code:Et.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Dn;!this._def.rest&&c.data.length>this._def.items.length&&(kt(c,{code:Et.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),a.dirty());const h=[...c.data].map((m,E)=>{const S=this._def.items[E]||this._def.rest;return S?S._parse(new pf(c,m,c.path,E)):null}).filter(m=>!!m);return c.common.async?Promise.all(h).then(m=>yc.mergeArray(a,m)):yc.mergeArray(a,h)}get items(){return this._def.items}rest(r){return new Ug({...this._def,rest:r})}}Ug.create=(i,r)=>{if(!Array.isArray(i))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Ug({items:i,typeName:xn.ZodTuple,rest:null,...rr(r)})};class OY extends br{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(r){const{status:a,ctx:c}=this._processInputParams(r);if(c.parsedType!==Jt.map)return kt(c,{code:Et.invalid_type,expected:Jt.map,received:c.parsedType}),Dn;const l=this._def.keyType,h=this._def.valueType,m=[...c.data.entries()].map(([E,S],T)=>({key:l._parse(new pf(c,E,c.path,[T,"key"])),value:h._parse(new pf(c,S,c.path,[T,"value"]))}));if(c.common.async){const E=new Map;return Promise.resolve().then(async()=>{for(const S of m){const T=await S.key,C=await S.value;if(T.status==="aborted"||C.status==="aborted")return Dn;(T.status==="dirty"||C.status==="dirty")&&a.dirty(),E.set(T.value,C.value)}return{status:a.value,value:E}})}else{const E=new Map;for(const S of m){const T=S.key,C=S.value;if(T.status==="aborted"||C.status==="aborted")return Dn;(T.status==="dirty"||C.status==="dirty")&&a.dirty(),E.set(T.value,C.value)}return{status:a.value,value:E}}}}OY.create=(i,r,a)=>new OY({valueType:r,keyType:i,typeName:xn.ZodMap,...rr(a)});class Iw extends br{_parse(r){const{status:a,ctx:c}=this._processInputParams(r);if(c.parsedType!==Jt.set)return kt(c,{code:Et.invalid_type,expected:Jt.set,received:c.parsedType}),Dn;const l=this._def;l.minSize!==null&&c.data.size<l.minSize.value&&(kt(c,{code:Et.too_small,minimum:l.minSize.value,type:"set",inclusive:!0,exact:!1,message:l.minSize.message}),a.dirty()),l.maxSize!==null&&c.data.size>l.maxSize.value&&(kt(c,{code:Et.too_big,maximum:l.maxSize.value,type:"set",inclusive:!0,exact:!1,message:l.maxSize.message}),a.dirty());const h=this._def.valueType;function m(S){const T=new Set;for(const C of S){if(C.status==="aborted")return Dn;C.status==="dirty"&&a.dirty(),T.add(C.value)}return{status:a.value,value:T}}const E=[...c.data.values()].map((S,T)=>h._parse(new pf(c,S,c.path,T)));return c.common.async?Promise.all(E).then(S=>m(S)):m(E)}min(r,a){return new Iw({...this._def,minSize:{value:r,message:$t.toString(a)}})}max(r,a){return new Iw({...this._def,maxSize:{value:r,message:$t.toString(a)}})}size(r,a){return this.min(r,a).max(r,a)}nonempty(r){return this.min(1,r)}}Iw.create=(i,r)=>new Iw({valueType:i,minSize:null,maxSize:null,typeName:xn.ZodSet,...rr(r)});class NY extends br{get schema(){return this._def.getter()}_parse(r){const{ctx:a}=this._processInputParams(r);return this._def.getter()._parse({data:a.data,path:a.path,parent:a})}}NY.create=(i,r)=>new NY({getter:i,typeName:xn.ZodLazy,...rr(r)});class PY extends br{_parse(r){if(r.data!==this._def.value){const a=this._getOrReturnCtx(r);return kt(a,{received:a.data,code:Et.invalid_literal,expected:this._def.value}),Dn}return{status:"valid",value:r.data}}get value(){return this._def.value}}PY.create=(i,r)=>new PY({value:i,typeName:xn.ZodLiteral,...rr(r)});function zee(i,r){return new tv({values:i,typeName:xn.ZodEnum,...rr(r)})}class tv extends br{_parse(r){if(typeof r.data!="string"){const a=this._getOrReturnCtx(r),c=this._def.values;return kt(a,{expected:Pr.joinValues(c),received:a.parsedType,code:Et.invalid_type}),Dn}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(r.data)){const a=this._getOrReturnCtx(r),c=this._def.values;return kt(a,{received:a.data,code:Et.invalid_enum_value,options:c}),Dn}return dl(r.data)}get options(){return this._def.values}get enum(){const r={};for(const a of this._def.values)r[a]=a;return r}get Values(){const r={};for(const a of this._def.values)r[a]=a;return r}get Enum(){const r={};for(const a of this._def.values)r[a]=a;return r}extract(r,a=this._def){return tv.create(r,{...this._def,...a})}exclude(r,a=this._def){return tv.create(this.options.filter(c=>!r.includes(c)),{...this._def,...a})}}tv.create=zee;class kY extends br{_parse(r){const a=Pr.getValidEnumValues(this._def.values),c=this._getOrReturnCtx(r);if(c.parsedType!==Jt.string&&c.parsedType!==Jt.number){const l=Pr.objectValues(a);return kt(c,{expected:Pr.joinValues(l),received:c.parsedType,code:Et.invalid_type}),Dn}if(this._cache||(this._cache=new Set(Pr.getValidEnumValues(this._def.values))),!this._cache.has(r.data)){const l=Pr.objectValues(a);return kt(c,{received:c.data,code:Et.invalid_enum_value,options:l}),Dn}return dl(r.data)}get enum(){return this._def.values}}kY.create=(i,r)=>new kY({values:i,typeName:xn.ZodNativeEnum,...rr(r)});class dO extends br{unwrap(){return this._def.type}_parse(r){const{ctx:a}=this._processInputParams(r);if(a.parsedType!==Jt.promise&&a.common.async===!1)return kt(a,{code:Et.invalid_type,expected:Jt.promise,received:a.parsedType}),Dn;const c=a.parsedType===Jt.promise?a.data:Promise.resolve(a.data);return dl(c.then(l=>this._def.type.parseAsync(l,{path:a.path,errorMap:a.common.contextualErrorMap})))}}dO.create=(i,r)=>new dO({type:i,typeName:xn.ZodPromise,...rr(r)});class nv extends br{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===xn.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(r){const{status:a,ctx:c}=this._processInputParams(r),l=this._def.effect||null,h={addIssue:m=>{kt(c,m),m.fatal?a.abort():a.dirty()},get path(){return c.path}};if(h.addIssue=h.addIssue.bind(h),l.type==="preprocess"){const m=l.transform(c.data,h);if(c.common.async)return Promise.resolve(m).then(async E=>{if(a.value==="aborted")return Dn;const S=await this._def.schema._parseAsync({data:E,path:c.path,parent:c});return S.status==="aborted"?Dn:S.status==="dirty"||a.value==="dirty"?M0(S.value):S});{if(a.value==="aborted")return Dn;const E=this._def.schema._parseSync({data:m,path:c.path,parent:c});return E.status==="aborted"?Dn:E.status==="dirty"||a.value==="dirty"?M0(E.value):E}}if(l.type==="refinement"){const m=E=>{const S=l.refinement(E,h);if(c.common.async)return Promise.resolve(S);if(S instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return E};if(c.common.async===!1){const E=this._def.schema._parseSync({data:c.data,path:c.path,parent:c});return E.status==="aborted"?Dn:(E.status==="dirty"&&a.dirty(),m(E.value),{status:a.value,value:E.value})}else return this._def.schema._parseAsync({data:c.data,path:c.path,parent:c}).then(E=>E.status==="aborted"?Dn:(E.status==="dirty"&&a.dirty(),m(E.value).then(()=>({status:a.value,value:E.value}))))}if(l.type==="transform")if(c.common.async===!1){const m=this._def.schema._parseSync({data:c.data,path:c.path,parent:c});if(!ev(m))return Dn;const E=l.transform(m.value,h);if(E instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:a.value,value:E}}else return this._def.schema._parseAsync({data:c.data,path:c.path,parent:c}).then(m=>ev(m)?Promise.resolve(l.transform(m.value,h)).then(E=>({status:a.value,value:E})):Dn);Pr.assertNever(l)}}nv.create=(i,r,a)=>new nv({schema:i,typeName:xn.ZodEffects,effect:r,...rr(a)});nv.createWithPreprocess=(i,r,a)=>new nv({schema:r,effect:{type:"preprocess",transform:i},typeName:xn.ZodEffects,...rr(a)});class sf extends br{_parse(r){return this._getType(r)===Jt.undefined?dl(void 0):this._def.innerType._parse(r)}unwrap(){return this._def.innerType}}sf.create=(i,r)=>new sf({innerType:i,typeName:xn.ZodOptional,...rr(r)});class rv extends br{_parse(r){return this._getType(r)===Jt.null?dl(null):this._def.innerType._parse(r)}unwrap(){return this._def.innerType}}rv.create=(i,r)=>new rv({innerType:i,typeName:xn.ZodNullable,...rr(r)});class qM extends br{_parse(r){const{ctx:a}=this._processInputParams(r);let c=a.data;return a.parsedType===Jt.undefined&&(c=this._def.defaultValue()),this._def.innerType._parse({data:c,path:a.path,parent:a})}removeDefault(){return this._def.innerType}}qM.create=(i,r)=>new qM({innerType:i,typeName:xn.ZodDefault,defaultValue:typeof r.default=="function"?r.default:()=>r.default,...rr(r)});class XM extends br{_parse(r){const{ctx:a}=this._processInputParams(r),c={...a,common:{...a.common,issues:[]}},l=this._def.innerType._parse({data:c.data,path:c.path,parent:{...c}});return oO(l)?l.then(h=>({status:"valid",value:h.status==="valid"?h.value:this._def.catchValue({get error(){return new bd(c.common.issues)},input:c.data})})):{status:"valid",value:l.status==="valid"?l.value:this._def.catchValue({get error(){return new bd(c.common.issues)},input:c.data})}}removeCatch(){return this._def.innerType}}XM.create=(i,r)=>new XM({innerType:i,typeName:xn.ZodCatch,catchValue:typeof r.catch=="function"?r.catch:()=>r.catch,...rr(r)});class DY extends br{_parse(r){if(this._getType(r)!==Jt.nan){const c=this._getOrReturnCtx(r);return kt(c,{code:Et.invalid_type,expected:Jt.nan,received:c.parsedType}),Dn}return{status:"valid",value:r.data}}}DY.create=i=>new DY({typeName:xn.ZodNaN,...rr(i)});class X1e extends br{_parse(r){const{ctx:a}=this._processInputParams(r),c=a.data;return this._def.type._parse({data:c,path:a.path,parent:a})}unwrap(){return this._def.type}}class QU extends br{_parse(r){const{status:a,ctx:c}=this._processInputParams(r);if(c.common.async)return(async()=>{const h=await this._def.in._parseAsync({data:c.data,path:c.path,parent:c});return h.status==="aborted"?Dn:h.status==="dirty"?(a.dirty(),M0(h.value)):this._def.out._parseAsync({data:h.value,path:c.path,parent:c})})();{const l=this._def.in._parseSync({data:c.data,path:c.path,parent:c});return l.status==="aborted"?Dn:l.status==="dirty"?(a.dirty(),{status:"dirty",value:l.value}):this._def.out._parseSync({data:l.value,path:c.path,parent:c})}}static create(r,a){return new QU({in:r,out:a,typeName:xn.ZodPipeline})}}class JM extends br{_parse(r){const a=this._def.innerType._parse(r),c=l=>(ev(l)&&(l.value=Object.freeze(l.value)),l);return oO(a)?a.then(l=>c(l)):c(a)}unwrap(){return this._def.innerType}}JM.create=(i,r)=>new JM({innerType:i,typeName:xn.ZodReadonly,...rr(r)});var xn;(function(i){i.ZodString="ZodString",i.ZodNumber="ZodNumber",i.ZodNaN="ZodNaN",i.ZodBigInt="ZodBigInt",i.ZodBoolean="ZodBoolean",i.ZodDate="ZodDate",i.ZodSymbol="ZodSymbol",i.ZodUndefined="ZodUndefined",i.ZodNull="ZodNull",i.ZodAny="ZodAny",i.ZodUnknown="ZodUnknown",i.ZodNever="ZodNever",i.ZodVoid="ZodVoid",i.ZodArray="ZodArray",i.ZodObject="ZodObject",i.ZodUnion="ZodUnion",i.ZodDiscriminatedUnion="ZodDiscriminatedUnion",i.ZodIntersection="ZodIntersection",i.ZodTuple="ZodTuple",i.ZodRecord="ZodRecord",i.ZodMap="ZodMap",i.ZodSet="ZodSet",i.ZodFunction="ZodFunction",i.ZodLazy="ZodLazy",i.ZodLiteral="ZodLiteral",i.ZodEnum="ZodEnum",i.ZodEffects="ZodEffects",i.ZodNativeEnum="ZodNativeEnum",i.ZodOptional="ZodOptional",i.ZodNullable="ZodNullable",i.ZodDefault="ZodDefault",i.ZodCatch="ZodCatch",i.ZodPromise="ZodPromise",i.ZodBranded="ZodBranded",i.ZodPipeline="ZodPipeline",i.ZodReadonly="ZodReadonly"})(xn||(xn={}));const Q0=Zp.create;ff.create;Td.create;const Kee=ws.create;lO.create;uO.create;Ug.create;tv.create;dO.create;sf.create;rv.create;const J1e=Kee({fullName:Q0().min(2,"Name must be at least 2 characters").max(100),email:Q0().email("Invalid email address"),password:Q0().min(6,"Password must be at least 6 characters")}),$1e=Kee({email:Q0().email("Invalid email address"),password:Q0().min(1,"Password is required")}),Q1e=()=>{const[i,r]=G.useState(!1),[a,c]=G.useState(""),[l,h]=G.useState(""),[m,E]=G.useState(""),[S,T]=G.useState(""),[C,I]=G.useState(""),[N,P]=G.useState(null),[H,x]=G.useState(!1),B=G.useRef(null),[X,Z]=G.useState(!1),[$,le]=G.useState({}),{signUp:re,signIn:ce,signInWithGoogle:te,signInAnonymously:pe,setUpRecaptcha:Ee,signInWithPhone:Ne,user:Ue,loading:Se}=UO(),{toast:Xe}=d2(),Re=D2();G.useEffect(()=>{Ue&&!Se&&Re("/")},[Ue,Se,Re]);const Be=()=>{try{return i?J1e.parse({fullName:m,email:a,password:l}):$1e.parse({email:a,password:l}),le({}),!0}catch(ae){if(ae instanceof bd){const ge={};ae.errors.forEach(Pe=>{Pe.path[0]&&(ge[Pe.path[0]]=Pe.message)}),le(ge)}return!1}},$e=async ae=>{if(ae.preventDefault(),!!Be()){Z(!0);try{if(i){const{error:ge}=await re(a,l,m);ge?ge.message.includes("already registered")?Xe({title:"Account exists",description:"This email is already registered. Try signing in instead.",variant:"destructive"}):Xe({title:"Sign up failed",description:ge.message,variant:"destructive"}):(Xe({title:"Welcome to KLE CONNECT!",description:"Your account has been created successfully."}),Re("/"))}else{const{error:ge}=await ce(a,l);ge?Xe({title:"Sign in failed",description:"Invalid email or password. Please try again.",variant:"destructive"}):(Xe({title:"Welcome back!",description:"You have signed in successfully."}),Re("/"))}}finally{Z(!1)}}},Ge=async ae=>{if(ae.preventDefault(),!S){le({phoneNumber:"Phone number is required"});return}let ge=S.trim();if(ge.startsWith("+")||(ge.length===10?ge=`+91${ge}`:ge=`+91${ge}`),!/^\+[1-9]\d{1,14}$/.test(ge)){le({phoneNumber:"Invalid phone number format. Use E.164 format (e.g., +919876543210)"});return}Z(!0),le({});try{if(!B.current)if(document.getElementById("recaptcha-container"))B.current=Ee("recaptcha-container");else throw new Error("Recaptcha container not found");const{confirmationResult:ue,error:it}=await Ne(ge,B.current);if(it){console.error("OTP Send Error:",it),B.current&&(B.current.clear(),B.current=null);let yt=it.message;it.message.includes("auth/invalid-phone-number")?yt="Invalid phone number format. We added +91 automatically, but it still failed. Please check the number.":it.message.includes("reCAPTCHA")&&(yt="Verification failed. Please try again."),Xe({title:"Failed to send OTP",description:yt,variant:"destructive"})}else P(ue),Xe({title:"OTP Sent",description:`We've sent a code to ${ge}`})}catch(ue){console.error("Catch Error:",ue),B.current&&(B.current.clear(),B.current=null),Xe({title:"Error",description:ue.message,variant:"destructive"})}finally{Z(!1)}},Ie=async ae=>{if(ae.preventDefault(),!(!C||!N)){Z(!0);try{await N.confirm(C),Xe({title:"Success",description:"Phone number verified successfully!"}),Re("/")}catch{Xe({title:"Verification Failed",description:"Invalid OTP. Please try again.",variant:"destructive"})}finally{Z(!1)}}},Ke=async()=>{Z(!0);const{error:ae}=await pe();Z(!1),ae?Xe({title:"Guest Login Failed",description:ae.message,variant:"destructive"}):(Xe({title:"Welcome Guest!",description:"You are now logged in anonymously."}),Re("/"))};return D.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center p-4 relative overflow-hidden",children:[D.jsx("div",{className:"fixed inset-0 pointer-events-none overflow-hidden"}),D.jsx("div",{id:"recaptcha-container"}),D.jsxs(lw,{to:"/",className:"absolute top-6 left-6 flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors",children:[D.jsx(oge,{className:"w-4 h-4"}),D.jsx("span",{className:"text-sm",children:"Back to home"})]}),D.jsx(Xn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"w-full max-w-md",children:D.jsxs("div",{className:"glass rounded-2xl p-8",children:[D.jsxs("div",{className:"text-center mb-6",children:[D.jsx("div",{className:"flex justify-center mb-4",children:D.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center",style:{background:"linear-gradient(135deg, hsl(199 89% 48% / 0.3), hsl(263 70% 58% / 0.3))"},children:D.jsx(vO,{className:"w-8 h-8 text-primary"})})}),D.jsxs("h1",{className:"text-2xl font-bold font-display",children:[D.jsx("span",{className:"text-gradient",children:"KLE"}),D.jsx("span",{className:"text-foreground",children:" CONNECT"})]}),D.jsx("p",{className:"text-muted-foreground text-sm mt-2",children:"Welcome to the student portal"})]}),D.jsxs(w1e,{defaultValue:"email",className:"w-full",children:[D.jsxs(Wee,{className:"grid w-full grid-cols-2 mb-6",children:[D.jsx(HM,{value:"email",children:"Email"}),D.jsx(HM,{value:"phone",children:"Phone"})]}),D.jsx(zM,{value:"email",children:D.jsxs("form",{onSubmit:$e,className:"space-y-4",children:[i&&D.jsxs("div",{children:[D.jsxs("div",{className:"relative",children:[D.jsx(SO,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),D.jsx(_y,{type:"text",placeholder:"Full Name",value:m,onChange:ae=>E(ae.target.value),className:"pl-10 bg-muted border-border"})]}),$.fullName&&D.jsx("p",{className:"text-destructive text-xs mt-1",children:$.fullName})]}),D.jsxs("div",{children:[D.jsxs("div",{className:"relative",children:[D.jsx(Rge,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),D.jsx(_y,{type:"email",placeholder:"Email",value:a,onChange:ae=>c(ae.target.value),className:"pl-10 bg-muted border-border"})]}),$.email&&D.jsx("p",{className:"text-destructive text-xs mt-1",children:$.email})]}),D.jsxs("div",{children:[D.jsxs("div",{className:"relative",children:[D.jsx(cK,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),D.jsx(_y,{type:"password",placeholder:"Password",value:l,onChange:ae=>h(ae.target.value),className:"pl-10 bg-muted border-border"})]}),$.password&&D.jsx("p",{className:"text-destructive text-xs mt-1",children:$.password})]}),D.jsx(nr,{type:"submit",className:"w-full bg-primary hover:bg-primary/90",disabled:X,children:X?D.jsxs(D.Fragment,{children:[D.jsx(Oy,{className:"w-4 h-4 mr-2 animate-spin"}),i?"Creating account...":"Signing in..."]}):i?"Create Account":"Sign In"}),D.jsx("div",{className:"text-center mt-2",children:D.jsx("button",{type:"button",onClick:()=>{r(!i),le({})},className:"text-xs text-muted-foreground hover:text-primary transition-colors",children:i?"Already have an account? Sign in":"Don't have an account? Sign up"})})]})}),D.jsx(zM,{value:"phone",children:N?D.jsxs("form",{onSubmit:Ie,className:"space-y-4",children:[D.jsx("div",{children:D.jsxs("div",{className:"relative",children:[D.jsx(cK,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),D.jsx(_y,{type:"text",placeholder:"Enter 6-digit OTP",value:C,onChange:ae=>I(ae.target.value),className:"pl-10 bg-muted border-border"})]})}),D.jsx(nr,{type:"submit",className:"w-full bg-primary hover:bg-primary/90",disabled:X,children:X?D.jsx(Oy,{className:"w-4 h-4 animate-spin"}):"Verify OTP"}),D.jsx("button",{type:"button",onClick:()=>P(null),className:"w-full text-xs text-muted-foreground hover:text-primary mt-2",children:"Change phone number"})]}):D.jsxs("form",{onSubmit:Ge,className:"space-y-4",children:[D.jsxs("div",{children:[D.jsxs("div",{className:"relative",children:[D.jsx(Nge,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),D.jsx(_y,{type:"tel",placeholder:"+1 234 567 8900",value:S,onChange:ae=>T(ae.target.value),className:"pl-10 bg-muted border-border"})]}),D.jsx("p",{className:"text-xs text-muted-foreground mt-1 ml-1",children:"Include country code (e.g. +91 for India)"}),$.phoneNumber&&D.jsx("p",{className:"text-destructive text-xs mt-1",children:$.phoneNumber})]}),D.jsx(nr,{type:"submit",className:"w-full bg-primary hover:bg-primary/90",disabled:X,children:X?D.jsx(Oy,{className:"w-4 h-4 animate-spin"}):"Send OTP"})]})})]}),D.jsx("div",{className:"relative my-6",children:D.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:D.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with"})})}),D.jsxs("div",{className:"space-y-2",children:[D.jsxs(nr,{type:"button",variant:"outline",className:"w-full",disabled:X,onClick:async()=>{Z(!0);const{error:ae}=await te();Z(!1),ae?Xe({title:"Google Sign In failed",description:ae.message,variant:"destructive"}):(Xe({title:"Welcome!",description:"Successfully signed in with Google."}),Re("/"))},children:[D.jsx("svg",{className:"mr-2 h-4 w-4","aria-hidden":"true",focusable:"false","data-prefix":"fab","data-icon":"google",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 488 512",children:D.jsx("path",{fill:"currentColor",d:"M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2 0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"})}),"Google"]}),D.jsxs(nr,{type:"button",variant:"outline",className:"w-full",disabled:X,onClick:Ke,children:[D.jsx(pge,{className:"mr-2 h-4 w-4"}),"Continue as Guest"]})]})]})})]})},hu=({icon:i,title:r,subtitle:a,gradient:c})=>D.jsx(Xn.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},className:"mb-8",children:D.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[D.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center",style:{background:c},children:D.jsx(i,{className:"w-6 h-6 text-foreground"})}),D.jsxs("div",{children:[D.jsx("h1",{className:"text-3xl font-bold font-display text-foreground",children:r}),D.jsx("p",{className:"text-muted-foreground text-sm",children:a})]})]})}),ZU=G.forwardRef(({className:i,...r},a)=>D.jsx("textarea",{className:Br("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i),ref:a,...r}));ZU.displayName="Textarea";function Z1e(i,r){const a={};return(i[i.length-1]===""?[...i,""]:i).join((a.padRight?" ":"")+","+(a.padLeft===!1?"":" ")).trim()}const eke=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,tke=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,nke={};function xY(i,r){return(nke.jsx?tke:eke).test(i)}const rke=/[ \t\n\f\r]/g;function ike(i){return typeof i=="object"?i.type==="text"?LY(i.value):!1:LY(i)}function LY(i){return i.replace(rke,"")===""}class zw{constructor(r,a,c){this.normal=a,this.property=r,c&&(this.space=c)}}zw.prototype.normal={};zw.prototype.property={};zw.prototype.space=void 0;function Yee(i,r){const a={},c={};for(const l of i)Object.assign(a,l.property),Object.assign(c,l.normal);return new zw(a,c,r)}function $M(i){return i.toLowerCase()}class Vo{constructor(r,a){this.attribute=a,this.property=r}}Vo.prototype.attribute="";Vo.prototype.booleanish=!1;Vo.prototype.boolean=!1;Vo.prototype.commaOrSpaceSeparated=!1;Vo.prototype.commaSeparated=!1;Vo.prototype.defined=!1;Vo.prototype.mustUseProperty=!1;Vo.prototype.number=!1;Vo.prototype.overloadedBoolean=!1;Vo.prototype.property="";Vo.prototype.spaceSeparated=!1;Vo.prototype.space=void 0;let ske=0;const zn=Wg(),vs=Wg(),QM=Wg(),mt=Wg(),_i=Wg(),By=Wg(),ac=Wg();function Wg(){return 2**++ske}const ZM=Object.freeze(Object.defineProperty({__proto__:null,boolean:zn,booleanish:vs,commaOrSpaceSeparated:ac,commaSeparated:By,number:mt,overloadedBoolean:QM,spaceSeparated:_i},Symbol.toStringTag,{value:"Module"})),gL=Object.keys(ZM);class eV extends Vo{constructor(r,a,c,l){let h=-1;if(super(r,a),MY(this,"space",l),typeof c=="number")for(;++h<gL.length;){const m=gL[h];MY(this,gL[h],(c&ZM[m])===ZM[m])}}}eV.prototype.defined=!0;function MY(i,r,a){a&&(i[r]=a)}function mv(i){const r={},a={};for(const[c,l]of Object.entries(i.properties)){const h=new eV(c,i.transform(i.attributes||{},c),l,i.space);i.mustUseProperty&&i.mustUseProperty.includes(c)&&(h.mustUseProperty=!0),r[c]=h,a[$M(c)]=c,a[$M(h.attribute)]=c}return new zw(r,a,i.space)}const qee=mv({properties:{ariaActiveDescendant:null,ariaAtomic:vs,ariaAutoComplete:null,ariaBusy:vs,ariaChecked:vs,ariaColCount:mt,ariaColIndex:mt,ariaColSpan:mt,ariaControls:_i,ariaCurrent:null,ariaDescribedBy:_i,ariaDetails:null,ariaDisabled:vs,ariaDropEffect:_i,ariaErrorMessage:null,ariaExpanded:vs,ariaFlowTo:_i,ariaGrabbed:vs,ariaHasPopup:null,ariaHidden:vs,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:_i,ariaLevel:mt,ariaLive:null,ariaModal:vs,ariaMultiLine:vs,ariaMultiSelectable:vs,ariaOrientation:null,ariaOwns:_i,ariaPlaceholder:null,ariaPosInSet:mt,ariaPressed:vs,ariaReadOnly:vs,ariaRelevant:null,ariaRequired:vs,ariaRoleDescription:_i,ariaRowCount:mt,ariaRowIndex:mt,ariaRowSpan:mt,ariaSelected:vs,ariaSetSize:mt,ariaSort:null,ariaValueMax:mt,ariaValueMin:mt,ariaValueNow:mt,ariaValueText:null,role:null},transform(i,r){return r==="role"?r:"aria-"+r.slice(4).toLowerCase()}});function Xee(i,r){return r in i?i[r]:r}function Jee(i,r){return Xee(i,r.toLowerCase())}const ake=mv({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:By,acceptCharset:_i,accessKey:_i,action:null,allow:null,allowFullScreen:zn,allowPaymentRequest:zn,allowUserMedia:zn,alt:null,as:null,async:zn,autoCapitalize:null,autoComplete:_i,autoFocus:zn,autoPlay:zn,blocking:_i,capture:null,charSet:null,checked:zn,cite:null,className:_i,cols:mt,colSpan:null,content:null,contentEditable:vs,controls:zn,controlsList:_i,coords:mt|By,crossOrigin:null,data:null,dateTime:null,decoding:null,default:zn,defer:zn,dir:null,dirName:null,disabled:zn,download:QM,draggable:vs,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:zn,formTarget:null,headers:_i,height:mt,hidden:QM,high:mt,href:null,hrefLang:null,htmlFor:_i,httpEquiv:_i,id:null,imageSizes:null,imageSrcSet:null,inert:zn,inputMode:null,integrity:null,is:null,isMap:zn,itemId:null,itemProp:_i,itemRef:_i,itemScope:zn,itemType:_i,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:zn,low:mt,manifest:null,max:null,maxLength:mt,media:null,method:null,min:null,minLength:mt,multiple:zn,muted:zn,name:null,nonce:null,noModule:zn,noValidate:zn,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:zn,optimum:mt,pattern:null,ping:_i,placeholder:null,playsInline:zn,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:zn,referrerPolicy:null,rel:_i,required:zn,reversed:zn,rows:mt,rowSpan:mt,sandbox:_i,scope:null,scoped:zn,seamless:zn,selected:zn,shadowRootClonable:zn,shadowRootDelegatesFocus:zn,shadowRootMode:null,shape:null,size:mt,sizes:null,slot:null,span:mt,spellCheck:vs,src:null,srcDoc:null,srcLang:null,srcSet:null,start:mt,step:null,style:null,tabIndex:mt,target:null,title:null,translate:null,type:null,typeMustMatch:zn,useMap:null,value:vs,width:mt,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:_i,axis:null,background:null,bgColor:null,border:mt,borderColor:null,bottomMargin:mt,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:zn,declare:zn,event:null,face:null,frame:null,frameBorder:null,hSpace:mt,leftMargin:mt,link:null,longDesc:null,lowSrc:null,marginHeight:mt,marginWidth:mt,noResize:zn,noHref:zn,noShade:zn,noWrap:zn,object:null,profile:null,prompt:null,rev:null,rightMargin:mt,rules:null,scheme:null,scrolling:vs,standby:null,summary:null,text:null,topMargin:mt,valueType:null,version:null,vAlign:null,vLink:null,vSpace:mt,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:zn,disableRemotePlayback:zn,prefix:null,property:null,results:mt,security:null,unselectable:null},space:"html",transform:Jee}),oke=mv({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:ac,accentHeight:mt,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:mt,amplitude:mt,arabicForm:null,ascent:mt,attributeName:null,attributeType:null,azimuth:mt,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:mt,by:null,calcMode:null,capHeight:mt,className:_i,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:mt,diffuseConstant:mt,direction:null,display:null,dur:null,divisor:mt,dominantBaseline:null,download:zn,dx:null,dy:null,edgeMode:null,editable:null,elevation:mt,enableBackground:null,end:null,event:null,exponent:mt,externalResourcesRequired:null,fill:null,fillOpacity:mt,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:By,g2:By,glyphName:By,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:mt,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:mt,horizOriginX:mt,horizOriginY:mt,id:null,ideographic:mt,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:mt,k:mt,k1:mt,k2:mt,k3:mt,k4:mt,kernelMatrix:ac,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:mt,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:mt,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:mt,overlineThickness:mt,paintOrder:null,panose1:null,path:null,pathLength:mt,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:_i,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:mt,pointsAtY:mt,pointsAtZ:mt,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:ac,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:ac,rev:ac,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:ac,requiredFeatures:ac,requiredFonts:ac,requiredFormats:ac,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:mt,specularExponent:mt,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:mt,strikethroughThickness:mt,string:null,stroke:null,strokeDashArray:ac,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:mt,strokeOpacity:mt,strokeWidth:null,style:null,surfaceScale:mt,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:ac,tabIndex:mt,tableValues:null,target:null,targetX:mt,targetY:mt,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:ac,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:mt,underlineThickness:mt,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:mt,values:null,vAlphabetic:mt,vMathematical:mt,vectorEffect:null,vHanging:mt,vIdeographic:mt,version:null,vertAdvY:mt,vertOriginX:mt,vertOriginY:mt,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:mt,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:Xee}),$ee=mv({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(i,r){return"xlink:"+r.slice(5).toLowerCase()}}),Qee=mv({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:Jee}),Zee=mv({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(i,r){return"xml:"+r.slice(3).toLowerCase()}}),cke={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},lke=/[A-Z]/g,UY=/-[a-z]/g,uke=/^data[-\w.:]+$/i;function dke(i,r){const a=$M(r);let c=r,l=Vo;if(a in i.normal)return i.property[i.normal[a]];if(a.length>4&&a.slice(0,4)==="data"&&uke.test(r)){if(r.charAt(4)==="-"){const h=r.slice(5).replace(UY,pke);c="data"+h.charAt(0).toUpperCase()+h.slice(1)}else{const h=r.slice(4);if(!UY.test(h)){let m=h.replace(lke,hke);m.charAt(0)!=="-"&&(m="-"+m),r="data"+m}}l=eV}return new l(c,r)}function hke(i){return"-"+i.toLowerCase()}function pke(i){return i.charAt(1).toUpperCase()}const fke=Yee([qee,ake,$ee,Qee,Zee],"html"),tV=Yee([qee,oke,$ee,Qee,Zee],"svg");function mke(i){return i.join(" ").trim()}var hy={},_L,VY;function gke(){if(VY)return _L;VY=1;var i=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,r=/\n/g,a=/^\s*/,c=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,l=/^:\s*/,h=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,m=/^[;\s]*/,E=/^\s+|\s+$/g,S=`
`,T="/",C="*",I="",N="comment",P="declaration";function H(B,X){if(typeof B!="string")throw new TypeError("First argument must be a string");if(!B)return[];X=X||{};var Z=1,$=1;function le(Re){var Be=Re.match(r);Be&&(Z+=Be.length);var $e=Re.lastIndexOf(S);$=~$e?Re.length-$e:$+Re.length}function re(){var Re={line:Z,column:$};return function(Be){return Be.position=new ce(Re),Ee(),Be}}function ce(Re){this.start=Re,this.end={line:Z,column:$},this.source=X.source}ce.prototype.content=B;function te(Re){var Be=new Error(X.source+":"+Z+":"+$+": "+Re);if(Be.reason=Re,Be.filename=X.source,Be.line=Z,Be.column=$,Be.source=B,!X.silent)throw Be}function pe(Re){var Be=Re.exec(B);if(Be){var $e=Be[0];return le($e),B=B.slice($e.length),Be}}function Ee(){pe(a)}function Ne(Re){var Be;for(Re=Re||[];Be=Ue();)Be!==!1&&Re.push(Be);return Re}function Ue(){var Re=re();if(!(T!=B.charAt(0)||C!=B.charAt(1))){for(var Be=2;I!=B.charAt(Be)&&(C!=B.charAt(Be)||T!=B.charAt(Be+1));)++Be;if(Be+=2,I===B.charAt(Be-1))return te("End of comment missing");var $e=B.slice(2,Be-2);return $+=2,le($e),B=B.slice(Be),$+=2,Re({type:N,comment:$e})}}function Se(){var Re=re(),Be=pe(c);if(Be){if(Ue(),!pe(l))return te("property missing ':'");var $e=pe(h),Ge=Re({type:P,property:x(Be[0].replace(i,I)),value:$e?x($e[0].replace(i,I)):I});return pe(m),Ge}}function Xe(){var Re=[];Ne(Re);for(var Be;Be=Se();)Be!==!1&&(Re.push(Be),Ne(Re));return Re}return Ee(),Xe()}function x(B){return B?B.replace(E,I):I}return _L=H,_L}var FY;function _ke(){if(FY)return hy;FY=1;var i=hy&&hy.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(hy,"__esModule",{value:!0}),hy.default=a;const r=i(gke());function a(c,l){let h=null;if(!c||typeof c!="string")return h;const m=(0,r.default)(c),E=typeof l=="function";return m.forEach(S=>{if(S.type!=="declaration")return;const{property:T,value:C}=S;E?l(T,C,S):C&&(h=h||{},h[T]=C)}),h}return hy}var R0={},jY;function Eke(){if(jY)return R0;jY=1,Object.defineProperty(R0,"__esModule",{value:!0}),R0.camelCase=void 0;var i=/^--[a-zA-Z0-9_-]+$/,r=/-([a-z])/g,a=/^[^-]+$/,c=/^-(webkit|moz|ms|o|khtml)-/,l=/^-(ms)-/,h=function(T){return!T||a.test(T)||i.test(T)},m=function(T,C){return C.toUpperCase()},E=function(T,C){return"".concat(C,"-")},S=function(T,C){return C===void 0&&(C={}),h(T)?T:(T=T.toLowerCase(),C.reactCompat?T=T.replace(l,E):T=T.replace(c,E),T.replace(r,m))};return R0.camelCase=S,R0}var b0,BY;function yke(){if(BY)return b0;BY=1;var i=b0&&b0.__importDefault||function(l){return l&&l.__esModule?l:{default:l}},r=i(_ke()),a=Eke();function c(l,h){var m={};return!l||typeof l!="string"||(0,r.default)(l,function(E,S){E&&S&&(m[(0,a.camelCase)(E,h)]=S)}),m}return c.default=c,b0=c,b0}var vke=yke();const Ske=gO(vke),ete=tte("end"),nV=tte("start");function tte(i){return r;function r(a){const c=a&&a.position&&a.position[i]||{};if(typeof c.line=="number"&&c.line>0&&typeof c.column=="number"&&c.column>0)return{line:c.line,column:c.column,offset:typeof c.offset=="number"&&c.offset>-1?c.offset:void 0}}}function Tke(i){const r=nV(i),a=ete(i);if(r&&a)return{start:r,end:a}}function Z0(i){return!i||typeof i!="object"?"":"position"in i||"type"in i?WY(i.position):"start"in i||"end"in i?WY(i):"line"in i||"column"in i?e2(i):""}function e2(i){return GY(i&&i.line)+":"+GY(i&&i.column)}function WY(i){return e2(i&&i.start)+"-"+e2(i&&i.end)}function GY(i){return i&&typeof i=="number"?i:1}class Ma extends Error{constructor(r,a,c){super(),typeof a=="string"&&(c=a,a=void 0);let l="",h={},m=!1;if(a&&("line"in a&&"column"in a?h={place:a}:"start"in a&&"end"in a?h={place:a}:"type"in a?h={ancestors:[a],place:a.position}:h={...a}),typeof r=="string"?l=r:!h.cause&&r&&(m=!0,l=r.message,h.cause=r),!h.ruleId&&!h.source&&typeof c=="string"){const S=c.indexOf(":");S===-1?h.ruleId=c:(h.source=c.slice(0,S),h.ruleId=c.slice(S+1))}if(!h.place&&h.ancestors&&h.ancestors){const S=h.ancestors[h.ancestors.length-1];S&&(h.place=S.position)}const E=h.place&&"start"in h.place?h.place.start:h.place;this.ancestors=h.ancestors||void 0,this.cause=h.cause||void 0,this.column=E?E.column:void 0,this.fatal=void 0,this.file="",this.message=l,this.line=E?E.line:void 0,this.name=Z0(h.place)||"1:1",this.place=h.place||void 0,this.reason=this.message,this.ruleId=h.ruleId||void 0,this.source=h.source||void 0,this.stack=m&&h.cause&&typeof h.cause.stack=="string"?h.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}Ma.prototype.file="";Ma.prototype.name="";Ma.prototype.reason="";Ma.prototype.message="";Ma.prototype.stack="";Ma.prototype.column=void 0;Ma.prototype.line=void 0;Ma.prototype.ancestors=void 0;Ma.prototype.cause=void 0;Ma.prototype.fatal=void 0;Ma.prototype.place=void 0;Ma.prototype.ruleId=void 0;Ma.prototype.source=void 0;const rV={}.hasOwnProperty,wke=new Map,Cke=/[A-Z]/g,Rke=new Set(["table","tbody","thead","tfoot","tr"]),bke=new Set(["td","th"]),nte="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function Ike(i,r){if(!r||r.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const a=r.filePath||void 0;let c;if(r.development){if(typeof r.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");c=Lke(a,r.jsxDEV)}else{if(typeof r.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof r.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");c=xke(a,r.jsx,r.jsxs)}const l={Fragment:r.Fragment,ancestors:[],components:r.components||{},create:c,elementAttributeNameCase:r.elementAttributeNameCase||"react",evaluater:r.createEvaluater?r.createEvaluater():void 0,filePath:a,ignoreInvalidStyle:r.ignoreInvalidStyle||!1,passKeys:r.passKeys!==!1,passNode:r.passNode||!1,schema:r.space==="svg"?tV:fke,stylePropertyNameCase:r.stylePropertyNameCase||"dom",tableCellAlignToStyle:r.tableCellAlignToStyle!==!1},h=rte(l,i,void 0);return h&&typeof h!="string"?h:l.create(i,l.Fragment,{children:h||void 0},void 0)}function rte(i,r,a){if(r.type==="element")return Ake(i,r,a);if(r.type==="mdxFlowExpression"||r.type==="mdxTextExpression")return Oke(i,r);if(r.type==="mdxJsxFlowElement"||r.type==="mdxJsxTextElement")return Pke(i,r,a);if(r.type==="mdxjsEsm")return Nke(i,r);if(r.type==="root")return kke(i,r,a);if(r.type==="text")return Dke(i,r)}function Ake(i,r,a){const c=i.schema;let l=c;r.tagName.toLowerCase()==="svg"&&c.space==="html"&&(l=tV,i.schema=l),i.ancestors.push(r);const h=ste(i,r.tagName,!1),m=Mke(i,r);let E=sV(i,r);return Rke.has(r.tagName)&&(E=E.filter(function(S){return typeof S=="string"?!ike(S):!0})),ite(i,m,h,r),iV(m,E),i.ancestors.pop(),i.schema=c,i.create(r,h,m,a)}function Oke(i,r){if(r.data&&r.data.estree&&i.evaluater){const c=r.data.estree.body[0];return c.type,i.evaluater.evaluateExpression(c.expression)}Aw(i,r.position)}function Nke(i,r){if(r.data&&r.data.estree&&i.evaluater)return i.evaluater.evaluateProgram(r.data.estree);Aw(i,r.position)}function Pke(i,r,a){const c=i.schema;let l=c;r.name==="svg"&&c.space==="html"&&(l=tV,i.schema=l),i.ancestors.push(r);const h=r.name===null?i.Fragment:ste(i,r.name,!0),m=Uke(i,r),E=sV(i,r);return ite(i,m,h,r),iV(m,E),i.ancestors.pop(),i.schema=c,i.create(r,h,m,a)}function kke(i,r,a){const c={};return iV(c,sV(i,r)),i.create(r,i.Fragment,c,a)}function Dke(i,r){return r.value}function ite(i,r,a,c){typeof a!="string"&&a!==i.Fragment&&i.passNode&&(r.node=c)}function iV(i,r){if(r.length>0){const a=r.length>1?r:r[0];a&&(i.children=a)}}function xke(i,r,a){return c;function c(l,h,m,E){const T=Array.isArray(m.children)?a:r;return E?T(h,m,E):T(h,m)}}function Lke(i,r){return a;function a(c,l,h,m){const E=Array.isArray(h.children),S=nV(c);return r(l,h,m,E,{columnNumber:S?S.column-1:void 0,fileName:i,lineNumber:S?S.line:void 0},void 0)}}function Mke(i,r){const a={};let c,l;for(l in r.properties)if(l!=="children"&&rV.call(r.properties,l)){const h=Vke(i,l,r.properties[l]);if(h){const[m,E]=h;i.tableCellAlignToStyle&&m==="align"&&typeof E=="string"&&bke.has(r.tagName)?c=E:a[m]=E}}if(c){const h=a.style||(a.style={});h[i.stylePropertyNameCase==="css"?"text-align":"textAlign"]=c}return a}function Uke(i,r){const a={};for(const c of r.attributes)if(c.type==="mdxJsxExpressionAttribute")if(c.data&&c.data.estree&&i.evaluater){const h=c.data.estree.body[0];h.type;const m=h.expression;m.type;const E=m.properties[0];E.type,Object.assign(a,i.evaluater.evaluateExpression(E.argument))}else Aw(i,r.position);else{const l=c.name;let h;if(c.value&&typeof c.value=="object")if(c.value.data&&c.value.data.estree&&i.evaluater){const E=c.value.data.estree.body[0];E.type,h=i.evaluater.evaluateExpression(E.expression)}else Aw(i,r.position);else h=c.value===null?!0:c.value;a[l]=h}return a}function sV(i,r){const a=[];let c=-1;const l=i.passKeys?new Map:wke;for(;++c<r.children.length;){const h=r.children[c];let m;if(i.passKeys){const S=h.type==="element"?h.tagName:h.type==="mdxJsxFlowElement"||h.type==="mdxJsxTextElement"?h.name:void 0;if(S){const T=l.get(S)||0;m=S+"-"+T,l.set(S,T+1)}}const E=rte(i,h,m);E!==void 0&&a.push(E)}return a}function Vke(i,r,a){const c=dke(i.schema,r);if(!(a==null||typeof a=="number"&&Number.isNaN(a))){if(Array.isArray(a)&&(a=c.commaSeparated?Z1e(a):mke(a)),c.property==="style"){let l=typeof a=="object"?a:Fke(i,String(a));return i.stylePropertyNameCase==="css"&&(l=jke(l)),["style",l]}return[i.elementAttributeNameCase==="react"&&c.space?cke[c.property]||c.property:c.attribute,a]}}function Fke(i,r){try{return Ske(r,{reactCompat:!0})}catch(a){if(i.ignoreInvalidStyle)return{};const c=a,l=new Ma("Cannot parse `style` attribute",{ancestors:i.ancestors,cause:c,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw l.file=i.filePath||void 0,l.url=nte+"#cannot-parse-style-attribute",l}}function ste(i,r,a){let c;if(!a)c={type:"Literal",value:r};else if(r.includes(".")){const l=r.split(".");let h=-1,m;for(;++h<l.length;){const E=xY(l[h])?{type:"Identifier",name:l[h]}:{type:"Literal",value:l[h]};m=m?{type:"MemberExpression",object:m,property:E,computed:!!(h&&E.type==="Literal"),optional:!1}:E}c=m}else c=xY(r)&&!/^[a-z]/.test(r)?{type:"Identifier",name:r}:{type:"Literal",value:r};if(c.type==="Literal"){const l=c.value;return rV.call(i.components,l)?i.components[l]:l}if(i.evaluater)return i.evaluater.evaluateExpression(c);Aw(i)}function Aw(i,r){const a=new Ma("Cannot handle MDX estrees without `createEvaluater`",{ancestors:i.ancestors,place:r,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw a.file=i.filePath||void 0,a.url=nte+"#cannot-handle-mdx-estrees-without-createevaluater",a}function jke(i){const r={};let a;for(a in i)rV.call(i,a)&&(r[Bke(a)]=i[a]);return r}function Bke(i){let r=i.replace(Cke,Wke);return r.slice(0,3)==="ms-"&&(r="-"+r),r}function Wke(i){return"-"+i.toLowerCase()}const EL={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},Gke={};function Hke(i,r){const a=Gke,c=typeof a.includeImageAlt=="boolean"?a.includeImageAlt:!0,l=typeof a.includeHtml=="boolean"?a.includeHtml:!0;return ate(i,c,l)}function ate(i,r,a){if(zke(i)){if("value"in i)return i.type==="html"&&!a?"":i.value;if(r&&"alt"in i&&i.alt)return i.alt;if("children"in i)return HY(i.children,r,a)}return Array.isArray(i)?HY(i,r,a):""}function HY(i,r,a){const c=[];let l=-1;for(;++l<i.length;)c[l]=ate(i[l],r,a);return c.join("")}function zke(i){return!!(i&&typeof i=="object")}const zY=document.createElement("i");function aV(i){const r="&"+i+";";zY.innerHTML=r;const a=zY.textContent;return a.charCodeAt(a.length-1)===59&&i!=="semi"||a===r?!1:a}function Id(i,r,a,c){const l=i.length;let h=0,m;if(r<0?r=-r>l?0:l+r:r=r>l?l:r,a=a>0?a:0,c.length<1e4)m=Array.from(c),m.unshift(r,a),i.splice(...m);else for(a&&i.splice(r,a);h<c.length;)m=c.slice(h,h+1e4),m.unshift(r,0),i.splice(...m),h+=1e4,r+=1e4}function rl(i,r){return i.length>0?(Id(i,i.length,0,r),i):r}const KY={}.hasOwnProperty;function Kke(i){const r={};let a=-1;for(;++a<i.length;)Yke(r,i[a]);return r}function Yke(i,r){let a;for(a in r){const l=(KY.call(i,a)?i[a]:void 0)||(i[a]={}),h=r[a];let m;if(h)for(m in h){KY.call(l,m)||(l[m]=[]);const E=h[m];qke(l[m],Array.isArray(E)?E:E?[E]:[])}}}function qke(i,r){let a=-1;const c=[];for(;++a<r.length;)(r[a].add==="after"?i:c).push(r[a]);Id(i,0,0,c)}function ote(i,r){const a=Number.parseInt(i,r);return a<9||a===11||a>13&&a<32||a>126&&a<160||a>55295&&a<57344||a>64975&&a<65008||(a&65535)===65535||(a&65535)===65534||a>1114111?"":String.fromCodePoint(a)}function Wy(i){return i.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const fd=Tf(/[A-Za-z]/),pc=Tf(/[\dA-Za-z]/),Xke=Tf(/[#-'*+\--9=?A-Z^-~]/);function t2(i){return i!==null&&(i<32||i===127)}const n2=Tf(/\d/),Jke=Tf(/[\dA-Fa-f]/),$ke=Tf(/[!-/:-@[-`{-~]/);function wn(i){return i!==null&&i<-2}function Lo(i){return i!==null&&(i<0||i===32)}function Lr(i){return i===-2||i===-1||i===32}const Qke=Tf(new RegExp("\\p{P}|\\p{S}","u")),Zke=Tf(/\s/);function Tf(i){return r;function r(a){return a!==null&&a>-1&&i.test(String.fromCharCode(a))}}function gv(i){const r=[];let a=-1,c=0,l=0;for(;++a<i.length;){const h=i.charCodeAt(a);let m="";if(h===37&&pc(i.charCodeAt(a+1))&&pc(i.charCodeAt(a+2)))l=2;else if(h<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(h))||(m=String.fromCharCode(h));else if(h>55295&&h<57344){const E=i.charCodeAt(a+1);h<56320&&E>56319&&E<57344?(m=String.fromCharCode(h,E),l=1):m=""}else m=String.fromCharCode(h);m&&(r.push(i.slice(c,a),encodeURIComponent(m)),c=a+l+1,m=""),l&&(a+=l,l=0)}return r.join("")+i.slice(c)}function Ei(i,r,a,c){const l=c?c-1:Number.POSITIVE_INFINITY;let h=0;return m;function m(S){return Lr(S)?(i.enter(a),E(S)):r(S)}function E(S){return Lr(S)&&h++<l?(i.consume(S),E):(i.exit(a),r(S))}}const eDe={tokenize:tDe};function tDe(i){const r=i.attempt(this.parser.constructs.contentInitial,c,l);let a;return r;function c(E){if(E===null){i.consume(E);return}return i.enter("lineEnding"),i.consume(E),i.exit("lineEnding"),Ei(i,r,"linePrefix")}function l(E){return i.enter("paragraph"),h(E)}function h(E){const S=i.enter("chunkText",{contentType:"text",previous:a});return a&&(a.next=S),a=S,m(E)}function m(E){if(E===null){i.exit("chunkText"),i.exit("paragraph"),i.consume(E);return}return wn(E)?(i.consume(E),i.exit("chunkText"),h):(i.consume(E),m)}}const nDe={tokenize:rDe},YY={tokenize:iDe};function rDe(i){const r=this,a=[];let c=0,l,h,m;return E;function E($){if(c<a.length){const le=a[c];return r.containerState=le[1],i.attempt(le[0].continuation,S,T)($)}return T($)}function S($){if(c++,r.containerState._closeFlow){r.containerState._closeFlow=void 0,l&&Z();const le=r.events.length;let re=le,ce;for(;re--;)if(r.events[re][0]==="exit"&&r.events[re][1].type==="chunkFlow"){ce=r.events[re][1].end;break}X(c);let te=le;for(;te<r.events.length;)r.events[te][1].end={...ce},te++;return Id(r.events,re+1,0,r.events.slice(le)),r.events.length=te,T($)}return E($)}function T($){if(c===a.length){if(!l)return N($);if(l.currentConstruct&&l.currentConstruct.concrete)return H($);r.interrupt=!!(l.currentConstruct&&!l._gfmTableDynamicInterruptHack)}return r.containerState={},i.check(YY,C,I)($)}function C($){return l&&Z(),X(c),N($)}function I($){return r.parser.lazy[r.now().line]=c!==a.length,m=r.now().offset,H($)}function N($){return r.containerState={},i.attempt(YY,P,H)($)}function P($){return c++,a.push([r.currentConstruct,r.containerState]),N($)}function H($){if($===null){l&&Z(),X(0),i.consume($);return}return l=l||r.parser.flow(r.now()),i.enter("chunkFlow",{_tokenizer:l,contentType:"flow",previous:h}),x($)}function x($){if($===null){B(i.exit("chunkFlow"),!0),X(0),i.consume($);return}return wn($)?(i.consume($),B(i.exit("chunkFlow")),c=0,r.interrupt=void 0,E):(i.consume($),x)}function B($,le){const re=r.sliceStream($);if(le&&re.push(null),$.previous=h,h&&(h.next=$),h=$,l.defineSkip($.start),l.write(re),r.parser.lazy[$.start.line]){let ce=l.events.length;for(;ce--;)if(l.events[ce][1].start.offset<m&&(!l.events[ce][1].end||l.events[ce][1].end.offset>m))return;const te=r.events.length;let pe=te,Ee,Ne;for(;pe--;)if(r.events[pe][0]==="exit"&&r.events[pe][1].type==="chunkFlow"){if(Ee){Ne=r.events[pe][1].end;break}Ee=!0}for(X(c),ce=te;ce<r.events.length;)r.events[ce][1].end={...Ne},ce++;Id(r.events,pe+1,0,r.events.slice(te)),r.events.length=ce}}function X($){let le=a.length;for(;le-- >$;){const re=a[le];r.containerState=re[1],re[0].exit.call(r,i)}a.length=$}function Z(){l.write([null]),h=void 0,l=void 0,r.containerState._closeFlow=void 0}}function iDe(i,r,a){return Ei(i,i.attempt(this.parser.constructs.document,r,a),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function qY(i){if(i===null||Lo(i)||Zke(i))return 1;if(Qke(i))return 2}function oV(i,r,a){const c=[];let l=-1;for(;++l<i.length;){const h=i[l].resolveAll;h&&!c.includes(h)&&(r=h(r,a),c.push(h))}return r}const r2={name:"attention",resolveAll:sDe,tokenize:aDe};function sDe(i,r){let a=-1,c,l,h,m,E,S,T,C;for(;++a<i.length;)if(i[a][0]==="enter"&&i[a][1].type==="attentionSequence"&&i[a][1]._close){for(c=a;c--;)if(i[c][0]==="exit"&&i[c][1].type==="attentionSequence"&&i[c][1]._open&&r.sliceSerialize(i[c][1]).charCodeAt(0)===r.sliceSerialize(i[a][1]).charCodeAt(0)){if((i[c][1]._close||i[a][1]._open)&&(i[a][1].end.offset-i[a][1].start.offset)%3&&!((i[c][1].end.offset-i[c][1].start.offset+i[a][1].end.offset-i[a][1].start.offset)%3))continue;S=i[c][1].end.offset-i[c][1].start.offset>1&&i[a][1].end.offset-i[a][1].start.offset>1?2:1;const I={...i[c][1].end},N={...i[a][1].start};XY(I,-S),XY(N,S),m={type:S>1?"strongSequence":"emphasisSequence",start:I,end:{...i[c][1].end}},E={type:S>1?"strongSequence":"emphasisSequence",start:{...i[a][1].start},end:N},h={type:S>1?"strongText":"emphasisText",start:{...i[c][1].end},end:{...i[a][1].start}},l={type:S>1?"strong":"emphasis",start:{...m.start},end:{...E.end}},i[c][1].end={...m.start},i[a][1].start={...E.end},T=[],i[c][1].end.offset-i[c][1].start.offset&&(T=rl(T,[["enter",i[c][1],r],["exit",i[c][1],r]])),T=rl(T,[["enter",l,r],["enter",m,r],["exit",m,r],["enter",h,r]]),T=rl(T,oV(r.parser.constructs.insideSpan.null,i.slice(c+1,a),r)),T=rl(T,[["exit",h,r],["enter",E,r],["exit",E,r],["exit",l,r]]),i[a][1].end.offset-i[a][1].start.offset?(C=2,T=rl(T,[["enter",i[a][1],r],["exit",i[a][1],r]])):C=0,Id(i,c-1,a-c+3,T),a=c+T.length-C-2;break}}for(a=-1;++a<i.length;)i[a][1].type==="attentionSequence"&&(i[a][1].type="data");return i}function aDe(i,r){const a=this.parser.constructs.attentionMarkers.null,c=this.previous,l=qY(c);let h;return m;function m(S){return h=S,i.enter("attentionSequence"),E(S)}function E(S){if(S===h)return i.consume(S),E;const T=i.exit("attentionSequence"),C=qY(S),I=!C||C===2&&l||a.includes(S),N=!l||l===2&&C||a.includes(c);return T._open=!!(h===42?I:I&&(l||!N)),T._close=!!(h===42?N:N&&(C||!I)),r(S)}}function XY(i,r){i.column+=r,i.offset+=r,i._bufferIndex+=r}const oDe={name:"autolink",tokenize:cDe};function cDe(i,r,a){let c=0;return l;function l(P){return i.enter("autolink"),i.enter("autolinkMarker"),i.consume(P),i.exit("autolinkMarker"),i.enter("autolinkProtocol"),h}function h(P){return fd(P)?(i.consume(P),m):P===64?a(P):T(P)}function m(P){return P===43||P===45||P===46||pc(P)?(c=1,E(P)):T(P)}function E(P){return P===58?(i.consume(P),c=0,S):(P===43||P===45||P===46||pc(P))&&c++<32?(i.consume(P),E):(c=0,T(P))}function S(P){return P===62?(i.exit("autolinkProtocol"),i.enter("autolinkMarker"),i.consume(P),i.exit("autolinkMarker"),i.exit("autolink"),r):P===null||P===32||P===60||t2(P)?a(P):(i.consume(P),S)}function T(P){return P===64?(i.consume(P),C):Xke(P)?(i.consume(P),T):a(P)}function C(P){return pc(P)?I(P):a(P)}function I(P){return P===46?(i.consume(P),c=0,C):P===62?(i.exit("autolinkProtocol").type="autolinkEmail",i.enter("autolinkMarker"),i.consume(P),i.exit("autolinkMarker"),i.exit("autolink"),r):N(P)}function N(P){if((P===45||pc(P))&&c++<63){const H=P===45?N:I;return i.consume(P),H}return a(P)}}const KO={partial:!0,tokenize:lDe};function lDe(i,r,a){return c;function c(h){return Lr(h)?Ei(i,l,"linePrefix")(h):l(h)}function l(h){return h===null||wn(h)?r(h):a(h)}}const cte={continuation:{tokenize:dDe},exit:hDe,name:"blockQuote",tokenize:uDe};function uDe(i,r,a){const c=this;return l;function l(m){if(m===62){const E=c.containerState;return E.open||(i.enter("blockQuote",{_container:!0}),E.open=!0),i.enter("blockQuotePrefix"),i.enter("blockQuoteMarker"),i.consume(m),i.exit("blockQuoteMarker"),h}return a(m)}function h(m){return Lr(m)?(i.enter("blockQuotePrefixWhitespace"),i.consume(m),i.exit("blockQuotePrefixWhitespace"),i.exit("blockQuotePrefix"),r):(i.exit("blockQuotePrefix"),r(m))}}function dDe(i,r,a){const c=this;return l;function l(m){return Lr(m)?Ei(i,h,"linePrefix",c.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(m):h(m)}function h(m){return i.attempt(cte,r,a)(m)}}function hDe(i){i.exit("blockQuote")}const lte={name:"characterEscape",tokenize:pDe};function pDe(i,r,a){return c;function c(h){return i.enter("characterEscape"),i.enter("escapeMarker"),i.consume(h),i.exit("escapeMarker"),l}function l(h){return $ke(h)?(i.enter("characterEscapeValue"),i.consume(h),i.exit("characterEscapeValue"),i.exit("characterEscape"),r):a(h)}}const ute={name:"characterReference",tokenize:fDe};function fDe(i,r,a){const c=this;let l=0,h,m;return E;function E(I){return i.enter("characterReference"),i.enter("characterReferenceMarker"),i.consume(I),i.exit("characterReferenceMarker"),S}function S(I){return I===35?(i.enter("characterReferenceMarkerNumeric"),i.consume(I),i.exit("characterReferenceMarkerNumeric"),T):(i.enter("characterReferenceValue"),h=31,m=pc,C(I))}function T(I){return I===88||I===120?(i.enter("characterReferenceMarkerHexadecimal"),i.consume(I),i.exit("characterReferenceMarkerHexadecimal"),i.enter("characterReferenceValue"),h=6,m=Jke,C):(i.enter("characterReferenceValue"),h=7,m=n2,C(I))}function C(I){if(I===59&&l){const N=i.exit("characterReferenceValue");return m===pc&&!aV(c.sliceSerialize(N))?a(I):(i.enter("characterReferenceMarker"),i.consume(I),i.exit("characterReferenceMarker"),i.exit("characterReference"),r)}return m(I)&&l++<h?(i.consume(I),C):a(I)}}const JY={partial:!0,tokenize:gDe},$Y={concrete:!0,name:"codeFenced",tokenize:mDe};function mDe(i,r,a){const c=this,l={partial:!0,tokenize:re};let h=0,m=0,E;return S;function S(ce){return T(ce)}function T(ce){const te=c.events[c.events.length-1];return h=te&&te[1].type==="linePrefix"?te[2].sliceSerialize(te[1],!0).length:0,E=ce,i.enter("codeFenced"),i.enter("codeFencedFence"),i.enter("codeFencedFenceSequence"),C(ce)}function C(ce){return ce===E?(m++,i.consume(ce),C):m<3?a(ce):(i.exit("codeFencedFenceSequence"),Lr(ce)?Ei(i,I,"whitespace")(ce):I(ce))}function I(ce){return ce===null||wn(ce)?(i.exit("codeFencedFence"),c.interrupt?r(ce):i.check(JY,x,le)(ce)):(i.enter("codeFencedFenceInfo"),i.enter("chunkString",{contentType:"string"}),N(ce))}function N(ce){return ce===null||wn(ce)?(i.exit("chunkString"),i.exit("codeFencedFenceInfo"),I(ce)):Lr(ce)?(i.exit("chunkString"),i.exit("codeFencedFenceInfo"),Ei(i,P,"whitespace")(ce)):ce===96&&ce===E?a(ce):(i.consume(ce),N)}function P(ce){return ce===null||wn(ce)?I(ce):(i.enter("codeFencedFenceMeta"),i.enter("chunkString",{contentType:"string"}),H(ce))}function H(ce){return ce===null||wn(ce)?(i.exit("chunkString"),i.exit("codeFencedFenceMeta"),I(ce)):ce===96&&ce===E?a(ce):(i.consume(ce),H)}function x(ce){return i.attempt(l,le,B)(ce)}function B(ce){return i.enter("lineEnding"),i.consume(ce),i.exit("lineEnding"),X}function X(ce){return h>0&&Lr(ce)?Ei(i,Z,"linePrefix",h+1)(ce):Z(ce)}function Z(ce){return ce===null||wn(ce)?i.check(JY,x,le)(ce):(i.enter("codeFlowValue"),$(ce))}function $(ce){return ce===null||wn(ce)?(i.exit("codeFlowValue"),Z(ce)):(i.consume(ce),$)}function le(ce){return i.exit("codeFenced"),r(ce)}function re(ce,te,pe){let Ee=0;return Ne;function Ne(Be){return ce.enter("lineEnding"),ce.consume(Be),ce.exit("lineEnding"),Ue}function Ue(Be){return ce.enter("codeFencedFence"),Lr(Be)?Ei(ce,Se,"linePrefix",c.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(Be):Se(Be)}function Se(Be){return Be===E?(ce.enter("codeFencedFenceSequence"),Xe(Be)):pe(Be)}function Xe(Be){return Be===E?(Ee++,ce.consume(Be),Xe):Ee>=m?(ce.exit("codeFencedFenceSequence"),Lr(Be)?Ei(ce,Re,"whitespace")(Be):Re(Be)):pe(Be)}function Re(Be){return Be===null||wn(Be)?(ce.exit("codeFencedFence"),te(Be)):pe(Be)}}}function gDe(i,r,a){const c=this;return l;function l(m){return m===null?a(m):(i.enter("lineEnding"),i.consume(m),i.exit("lineEnding"),h)}function h(m){return c.parser.lazy[c.now().line]?a(m):r(m)}}const yL={name:"codeIndented",tokenize:EDe},_De={partial:!0,tokenize:yDe};function EDe(i,r,a){const c=this;return l;function l(T){return i.enter("codeIndented"),Ei(i,h,"linePrefix",5)(T)}function h(T){const C=c.events[c.events.length-1];return C&&C[1].type==="linePrefix"&&C[2].sliceSerialize(C[1],!0).length>=4?m(T):a(T)}function m(T){return T===null?S(T):wn(T)?i.attempt(_De,m,S)(T):(i.enter("codeFlowValue"),E(T))}function E(T){return T===null||wn(T)?(i.exit("codeFlowValue"),m(T)):(i.consume(T),E)}function S(T){return i.exit("codeIndented"),r(T)}}function yDe(i,r,a){const c=this;return l;function l(m){return c.parser.lazy[c.now().line]?a(m):wn(m)?(i.enter("lineEnding"),i.consume(m),i.exit("lineEnding"),l):Ei(i,h,"linePrefix",5)(m)}function h(m){const E=c.events[c.events.length-1];return E&&E[1].type==="linePrefix"&&E[2].sliceSerialize(E[1],!0).length>=4?r(m):wn(m)?l(m):a(m)}}const vDe={name:"codeText",previous:TDe,resolve:SDe,tokenize:wDe};function SDe(i){let r=i.length-4,a=3,c,l;if((i[a][1].type==="lineEnding"||i[a][1].type==="space")&&(i[r][1].type==="lineEnding"||i[r][1].type==="space")){for(c=a;++c<r;)if(i[c][1].type==="codeTextData"){i[a][1].type="codeTextPadding",i[r][1].type="codeTextPadding",a+=2,r-=2;break}}for(c=a-1,r++;++c<=r;)l===void 0?c!==r&&i[c][1].type!=="lineEnding"&&(l=c):(c===r||i[c][1].type==="lineEnding")&&(i[l][1].type="codeTextData",c!==l+2&&(i[l][1].end=i[c-1][1].end,i.splice(l+2,c-l-2),r-=c-l-2,c=l+2),l=void 0);return i}function TDe(i){return i!==96||this.events[this.events.length-1][1].type==="characterEscape"}function wDe(i,r,a){let c=0,l,h;return m;function m(I){return i.enter("codeText"),i.enter("codeTextSequence"),E(I)}function E(I){return I===96?(i.consume(I),c++,E):(i.exit("codeTextSequence"),S(I))}function S(I){return I===null?a(I):I===32?(i.enter("space"),i.consume(I),i.exit("space"),S):I===96?(h=i.enter("codeTextSequence"),l=0,C(I)):wn(I)?(i.enter("lineEnding"),i.consume(I),i.exit("lineEnding"),S):(i.enter("codeTextData"),T(I))}function T(I){return I===null||I===32||I===96||wn(I)?(i.exit("codeTextData"),S(I)):(i.consume(I),T)}function C(I){return I===96?(i.consume(I),l++,C):l===c?(i.exit("codeTextSequence"),i.exit("codeText"),r(I)):(h.type="codeTextData",T(I))}}class CDe{constructor(r){this.left=r?[...r]:[],this.right=[]}get(r){if(r<0||r>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+r+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return r<this.left.length?this.left[r]:this.right[this.right.length-r+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(r,a){const c=a??Number.POSITIVE_INFINITY;return c<this.left.length?this.left.slice(r,c):r>this.left.length?this.right.slice(this.right.length-c+this.left.length,this.right.length-r+this.left.length).reverse():this.left.slice(r).concat(this.right.slice(this.right.length-c+this.left.length).reverse())}splice(r,a,c){const l=a||0;this.setCursor(Math.trunc(r));const h=this.right.splice(this.right.length-l,Number.POSITIVE_INFINITY);return c&&I0(this.left,c),h.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(r){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(r)}pushMany(r){this.setCursor(Number.POSITIVE_INFINITY),I0(this.left,r)}unshift(r){this.setCursor(0),this.right.push(r)}unshiftMany(r){this.setCursor(0),I0(this.right,r.reverse())}setCursor(r){if(!(r===this.left.length||r>this.left.length&&this.right.length===0||r<0&&this.left.length===0))if(r<this.left.length){const a=this.left.splice(r,Number.POSITIVE_INFINITY);I0(this.right,a.reverse())}else{const a=this.right.splice(this.left.length+this.right.length-r,Number.POSITIVE_INFINITY);I0(this.left,a.reverse())}}}function I0(i,r){let a=0;if(r.length<1e4)i.push(...r);else for(;a<r.length;)i.push(...r.slice(a,a+1e4)),a+=1e4}function dte(i){const r={};let a=-1,c,l,h,m,E,S,T;const C=new CDe(i);for(;++a<C.length;){for(;a in r;)a=r[a];if(c=C.get(a),a&&c[1].type==="chunkFlow"&&C.get(a-1)[1].type==="listItemPrefix"&&(S=c[1]._tokenizer.events,h=0,h<S.length&&S[h][1].type==="lineEndingBlank"&&(h+=2),h<S.length&&S[h][1].type==="content"))for(;++h<S.length&&S[h][1].type!=="content";)S[h][1].type==="chunkText"&&(S[h][1]._isInFirstContentOfListItem=!0,h++);if(c[0]==="enter")c[1].contentType&&(Object.assign(r,RDe(C,a)),a=r[a],T=!0);else if(c[1]._container){for(h=a,l=void 0;h--;)if(m=C.get(h),m[1].type==="lineEnding"||m[1].type==="lineEndingBlank")m[0]==="enter"&&(l&&(C.get(l)[1].type="lineEndingBlank"),m[1].type="lineEnding",l=h);else if(!(m[1].type==="linePrefix"||m[1].type==="listItemIndent"))break;l&&(c[1].end={...C.get(l)[1].start},E=C.slice(l,a),E.unshift(c),C.splice(l,a-l+1,E))}}return Id(i,0,Number.POSITIVE_INFINITY,C.slice(0)),!T}function RDe(i,r){const a=i.get(r)[1],c=i.get(r)[2];let l=r-1;const h=[];let m=a._tokenizer;m||(m=c.parser[a.contentType](a.start),a._contentTypeTextTrailing&&(m._contentTypeTextTrailing=!0));const E=m.events,S=[],T={};let C,I,N=-1,P=a,H=0,x=0;const B=[x];for(;P;){for(;i.get(++l)[1]!==P;);h.push(l),P._tokenizer||(C=c.sliceStream(P),P.next||C.push(null),I&&m.defineSkip(P.start),P._isInFirstContentOfListItem&&(m._gfmTasklistFirstContentOfListItem=!0),m.write(C),P._isInFirstContentOfListItem&&(m._gfmTasklistFirstContentOfListItem=void 0)),I=P,P=P.next}for(P=a;++N<E.length;)E[N][0]==="exit"&&E[N-1][0]==="enter"&&E[N][1].type===E[N-1][1].type&&E[N][1].start.line!==E[N][1].end.line&&(x=N+1,B.push(x),P._tokenizer=void 0,P.previous=void 0,P=P.next);for(m.events=[],P?(P._tokenizer=void 0,P.previous=void 0):B.pop(),N=B.length;N--;){const X=E.slice(B[N],B[N+1]),Z=h.pop();S.push([Z,Z+X.length-1]),i.splice(Z,2,X)}for(S.reverse(),N=-1;++N<S.length;)T[H+S[N][0]]=H+S[N][1],H+=S[N][1]-S[N][0]-1;return T}const bDe={resolve:ADe,tokenize:ODe},IDe={partial:!0,tokenize:NDe};function ADe(i){return dte(i),i}function ODe(i,r){let a;return c;function c(E){return i.enter("content"),a=i.enter("chunkContent",{contentType:"content"}),l(E)}function l(E){return E===null?h(E):wn(E)?i.check(IDe,m,h)(E):(i.consume(E),l)}function h(E){return i.exit("chunkContent"),i.exit("content"),r(E)}function m(E){return i.consume(E),i.exit("chunkContent"),a.next=i.enter("chunkContent",{contentType:"content",previous:a}),a=a.next,l}}function NDe(i,r,a){const c=this;return l;function l(m){return i.exit("chunkContent"),i.enter("lineEnding"),i.consume(m),i.exit("lineEnding"),Ei(i,h,"linePrefix")}function h(m){if(m===null||wn(m))return a(m);const E=c.events[c.events.length-1];return!c.parser.constructs.disable.null.includes("codeIndented")&&E&&E[1].type==="linePrefix"&&E[2].sliceSerialize(E[1],!0).length>=4?r(m):i.interrupt(c.parser.constructs.flow,a,r)(m)}}function hte(i,r,a,c,l,h,m,E,S){const T=S||Number.POSITIVE_INFINITY;let C=0;return I;function I(X){return X===60?(i.enter(c),i.enter(l),i.enter(h),i.consume(X),i.exit(h),N):X===null||X===32||X===41||t2(X)?a(X):(i.enter(c),i.enter(m),i.enter(E),i.enter("chunkString",{contentType:"string"}),x(X))}function N(X){return X===62?(i.enter(h),i.consume(X),i.exit(h),i.exit(l),i.exit(c),r):(i.enter(E),i.enter("chunkString",{contentType:"string"}),P(X))}function P(X){return X===62?(i.exit("chunkString"),i.exit(E),N(X)):X===null||X===60||wn(X)?a(X):(i.consume(X),X===92?H:P)}function H(X){return X===60||X===62||X===92?(i.consume(X),P):P(X)}function x(X){return!C&&(X===null||X===41||Lo(X))?(i.exit("chunkString"),i.exit(E),i.exit(m),i.exit(c),r(X)):C<T&&X===40?(i.consume(X),C++,x):X===41?(i.consume(X),C--,x):X===null||X===32||X===40||t2(X)?a(X):(i.consume(X),X===92?B:x)}function B(X){return X===40||X===41||X===92?(i.consume(X),x):x(X)}}function pte(i,r,a,c,l,h){const m=this;let E=0,S;return T;function T(P){return i.enter(c),i.enter(l),i.consume(P),i.exit(l),i.enter(h),C}function C(P){return E>999||P===null||P===91||P===93&&!S||P===94&&!E&&"_hiddenFootnoteSupport"in m.parser.constructs?a(P):P===93?(i.exit(h),i.enter(l),i.consume(P),i.exit(l),i.exit(c),r):wn(P)?(i.enter("lineEnding"),i.consume(P),i.exit("lineEnding"),C):(i.enter("chunkString",{contentType:"string"}),I(P))}function I(P){return P===null||P===91||P===93||wn(P)||E++>999?(i.exit("chunkString"),C(P)):(i.consume(P),S||(S=!Lr(P)),P===92?N:I)}function N(P){return P===91||P===92||P===93?(i.consume(P),E++,I):I(P)}}function fte(i,r,a,c,l,h){let m;return E;function E(N){return N===34||N===39||N===40?(i.enter(c),i.enter(l),i.consume(N),i.exit(l),m=N===40?41:N,S):a(N)}function S(N){return N===m?(i.enter(l),i.consume(N),i.exit(l),i.exit(c),r):(i.enter(h),T(N))}function T(N){return N===m?(i.exit(h),S(m)):N===null?a(N):wn(N)?(i.enter("lineEnding"),i.consume(N),i.exit("lineEnding"),Ei(i,T,"linePrefix")):(i.enter("chunkString",{contentType:"string"}),C(N))}function C(N){return N===m||N===null||wn(N)?(i.exit("chunkString"),T(N)):(i.consume(N),N===92?I:C)}function I(N){return N===m||N===92?(i.consume(N),C):C(N)}}function ew(i,r){let a;return c;function c(l){return wn(l)?(i.enter("lineEnding"),i.consume(l),i.exit("lineEnding"),a=!0,c):Lr(l)?Ei(i,c,a?"linePrefix":"lineSuffix")(l):r(l)}}const PDe={name:"definition",tokenize:DDe},kDe={partial:!0,tokenize:xDe};function DDe(i,r,a){const c=this;let l;return h;function h(P){return i.enter("definition"),m(P)}function m(P){return pte.call(c,i,E,a,"definitionLabel","definitionLabelMarker","definitionLabelString")(P)}function E(P){return l=Wy(c.sliceSerialize(c.events[c.events.length-1][1]).slice(1,-1)),P===58?(i.enter("definitionMarker"),i.consume(P),i.exit("definitionMarker"),S):a(P)}function S(P){return Lo(P)?ew(i,T)(P):T(P)}function T(P){return hte(i,C,a,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(P)}function C(P){return i.attempt(kDe,I,I)(P)}function I(P){return Lr(P)?Ei(i,N,"whitespace")(P):N(P)}function N(P){return P===null||wn(P)?(i.exit("definition"),c.parser.defined.push(l),r(P)):a(P)}}function xDe(i,r,a){return c;function c(E){return Lo(E)?ew(i,l)(E):a(E)}function l(E){return fte(i,h,a,"definitionTitle","definitionTitleMarker","definitionTitleString")(E)}function h(E){return Lr(E)?Ei(i,m,"whitespace")(E):m(E)}function m(E){return E===null||wn(E)?r(E):a(E)}}const LDe={name:"hardBreakEscape",tokenize:MDe};function MDe(i,r,a){return c;function c(h){return i.enter("hardBreakEscape"),i.consume(h),l}function l(h){return wn(h)?(i.exit("hardBreakEscape"),r(h)):a(h)}}const UDe={name:"headingAtx",resolve:VDe,tokenize:FDe};function VDe(i,r){let a=i.length-2,c=3,l,h;return i[c][1].type==="whitespace"&&(c+=2),a-2>c&&i[a][1].type==="whitespace"&&(a-=2),i[a][1].type==="atxHeadingSequence"&&(c===a-1||a-4>c&&i[a-2][1].type==="whitespace")&&(a-=c+1===a?2:4),a>c&&(l={type:"atxHeadingText",start:i[c][1].start,end:i[a][1].end},h={type:"chunkText",start:i[c][1].start,end:i[a][1].end,contentType:"text"},Id(i,c,a-c+1,[["enter",l,r],["enter",h,r],["exit",h,r],["exit",l,r]])),i}function FDe(i,r,a){let c=0;return l;function l(C){return i.enter("atxHeading"),h(C)}function h(C){return i.enter("atxHeadingSequence"),m(C)}function m(C){return C===35&&c++<6?(i.consume(C),m):C===null||Lo(C)?(i.exit("atxHeadingSequence"),E(C)):a(C)}function E(C){return C===35?(i.enter("atxHeadingSequence"),S(C)):C===null||wn(C)?(i.exit("atxHeading"),r(C)):Lr(C)?Ei(i,E,"whitespace")(C):(i.enter("atxHeadingText"),T(C))}function S(C){return C===35?(i.consume(C),S):(i.exit("atxHeadingSequence"),E(C))}function T(C){return C===null||C===35||Lo(C)?(i.exit("atxHeadingText"),E(C)):(i.consume(C),T)}}const jDe=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],QY=["pre","script","style","textarea"],BDe={concrete:!0,name:"htmlFlow",resolveTo:HDe,tokenize:zDe},WDe={partial:!0,tokenize:YDe},GDe={partial:!0,tokenize:KDe};function HDe(i){let r=i.length;for(;r--&&!(i[r][0]==="enter"&&i[r][1].type==="htmlFlow"););return r>1&&i[r-2][1].type==="linePrefix"&&(i[r][1].start=i[r-2][1].start,i[r+1][1].start=i[r-2][1].start,i.splice(r-2,2)),i}function zDe(i,r,a){const c=this;let l,h,m,E,S;return T;function T(ue){return C(ue)}function C(ue){return i.enter("htmlFlow"),i.enter("htmlFlowData"),i.consume(ue),I}function I(ue){return ue===33?(i.consume(ue),N):ue===47?(i.consume(ue),h=!0,x):ue===63?(i.consume(ue),l=3,c.interrupt?r:ae):fd(ue)?(i.consume(ue),m=String.fromCharCode(ue),B):a(ue)}function N(ue){return ue===45?(i.consume(ue),l=2,P):ue===91?(i.consume(ue),l=5,E=0,H):fd(ue)?(i.consume(ue),l=4,c.interrupt?r:ae):a(ue)}function P(ue){return ue===45?(i.consume(ue),c.interrupt?r:ae):a(ue)}function H(ue){const it="CDATA[";return ue===it.charCodeAt(E++)?(i.consume(ue),E===it.length?c.interrupt?r:Se:H):a(ue)}function x(ue){return fd(ue)?(i.consume(ue),m=String.fromCharCode(ue),B):a(ue)}function B(ue){if(ue===null||ue===47||ue===62||Lo(ue)){const it=ue===47,yt=m.toLowerCase();return!it&&!h&&QY.includes(yt)?(l=1,c.interrupt?r(ue):Se(ue)):jDe.includes(m.toLowerCase())?(l=6,it?(i.consume(ue),X):c.interrupt?r(ue):Se(ue)):(l=7,c.interrupt&&!c.parser.lazy[c.now().line]?a(ue):h?Z(ue):$(ue))}return ue===45||pc(ue)?(i.consume(ue),m+=String.fromCharCode(ue),B):a(ue)}function X(ue){return ue===62?(i.consume(ue),c.interrupt?r:Se):a(ue)}function Z(ue){return Lr(ue)?(i.consume(ue),Z):Ne(ue)}function $(ue){return ue===47?(i.consume(ue),Ne):ue===58||ue===95||fd(ue)?(i.consume(ue),le):Lr(ue)?(i.consume(ue),$):Ne(ue)}function le(ue){return ue===45||ue===46||ue===58||ue===95||pc(ue)?(i.consume(ue),le):re(ue)}function re(ue){return ue===61?(i.consume(ue),ce):Lr(ue)?(i.consume(ue),re):$(ue)}function ce(ue){return ue===null||ue===60||ue===61||ue===62||ue===96?a(ue):ue===34||ue===39?(i.consume(ue),S=ue,te):Lr(ue)?(i.consume(ue),ce):pe(ue)}function te(ue){return ue===S?(i.consume(ue),S=null,Ee):ue===null||wn(ue)?a(ue):(i.consume(ue),te)}function pe(ue){return ue===null||ue===34||ue===39||ue===47||ue===60||ue===61||ue===62||ue===96||Lo(ue)?re(ue):(i.consume(ue),pe)}function Ee(ue){return ue===47||ue===62||Lr(ue)?$(ue):a(ue)}function Ne(ue){return ue===62?(i.consume(ue),Ue):a(ue)}function Ue(ue){return ue===null||wn(ue)?Se(ue):Lr(ue)?(i.consume(ue),Ue):a(ue)}function Se(ue){return ue===45&&l===2?(i.consume(ue),$e):ue===60&&l===1?(i.consume(ue),Ge):ue===62&&l===4?(i.consume(ue),ge):ue===63&&l===3?(i.consume(ue),ae):ue===93&&l===5?(i.consume(ue),Ke):wn(ue)&&(l===6||l===7)?(i.exit("htmlFlowData"),i.check(WDe,Pe,Xe)(ue)):ue===null||wn(ue)?(i.exit("htmlFlowData"),Xe(ue)):(i.consume(ue),Se)}function Xe(ue){return i.check(GDe,Re,Pe)(ue)}function Re(ue){return i.enter("lineEnding"),i.consume(ue),i.exit("lineEnding"),Be}function Be(ue){return ue===null||wn(ue)?Xe(ue):(i.enter("htmlFlowData"),Se(ue))}function $e(ue){return ue===45?(i.consume(ue),ae):Se(ue)}function Ge(ue){return ue===47?(i.consume(ue),m="",Ie):Se(ue)}function Ie(ue){if(ue===62){const it=m.toLowerCase();return QY.includes(it)?(i.consume(ue),ge):Se(ue)}return fd(ue)&&m.length<8?(i.consume(ue),m+=String.fromCharCode(ue),Ie):Se(ue)}function Ke(ue){return ue===93?(i.consume(ue),ae):Se(ue)}function ae(ue){return ue===62?(i.consume(ue),ge):ue===45&&l===2?(i.consume(ue),ae):Se(ue)}function ge(ue){return ue===null||wn(ue)?(i.exit("htmlFlowData"),Pe(ue)):(i.consume(ue),ge)}function Pe(ue){return i.exit("htmlFlow"),r(ue)}}function KDe(i,r,a){const c=this;return l;function l(m){return wn(m)?(i.enter("lineEnding"),i.consume(m),i.exit("lineEnding"),h):a(m)}function h(m){return c.parser.lazy[c.now().line]?a(m):r(m)}}function YDe(i,r,a){return c;function c(l){return i.enter("lineEnding"),i.consume(l),i.exit("lineEnding"),i.attempt(KO,r,a)}}const qDe={name:"htmlText",tokenize:XDe};function XDe(i,r,a){const c=this;let l,h,m;return E;function E(ae){return i.enter("htmlText"),i.enter("htmlTextData"),i.consume(ae),S}function S(ae){return ae===33?(i.consume(ae),T):ae===47?(i.consume(ae),re):ae===63?(i.consume(ae),$):fd(ae)?(i.consume(ae),pe):a(ae)}function T(ae){return ae===45?(i.consume(ae),C):ae===91?(i.consume(ae),h=0,H):fd(ae)?(i.consume(ae),Z):a(ae)}function C(ae){return ae===45?(i.consume(ae),P):a(ae)}function I(ae){return ae===null?a(ae):ae===45?(i.consume(ae),N):wn(ae)?(m=I,Ge(ae)):(i.consume(ae),I)}function N(ae){return ae===45?(i.consume(ae),P):I(ae)}function P(ae){return ae===62?$e(ae):ae===45?N(ae):I(ae)}function H(ae){const ge="CDATA[";return ae===ge.charCodeAt(h++)?(i.consume(ae),h===ge.length?x:H):a(ae)}function x(ae){return ae===null?a(ae):ae===93?(i.consume(ae),B):wn(ae)?(m=x,Ge(ae)):(i.consume(ae),x)}function B(ae){return ae===93?(i.consume(ae),X):x(ae)}function X(ae){return ae===62?$e(ae):ae===93?(i.consume(ae),X):x(ae)}function Z(ae){return ae===null||ae===62?$e(ae):wn(ae)?(m=Z,Ge(ae)):(i.consume(ae),Z)}function $(ae){return ae===null?a(ae):ae===63?(i.consume(ae),le):wn(ae)?(m=$,Ge(ae)):(i.consume(ae),$)}function le(ae){return ae===62?$e(ae):$(ae)}function re(ae){return fd(ae)?(i.consume(ae),ce):a(ae)}function ce(ae){return ae===45||pc(ae)?(i.consume(ae),ce):te(ae)}function te(ae){return wn(ae)?(m=te,Ge(ae)):Lr(ae)?(i.consume(ae),te):$e(ae)}function pe(ae){return ae===45||pc(ae)?(i.consume(ae),pe):ae===47||ae===62||Lo(ae)?Ee(ae):a(ae)}function Ee(ae){return ae===47?(i.consume(ae),$e):ae===58||ae===95||fd(ae)?(i.consume(ae),Ne):wn(ae)?(m=Ee,Ge(ae)):Lr(ae)?(i.consume(ae),Ee):$e(ae)}function Ne(ae){return ae===45||ae===46||ae===58||ae===95||pc(ae)?(i.consume(ae),Ne):Ue(ae)}function Ue(ae){return ae===61?(i.consume(ae),Se):wn(ae)?(m=Ue,Ge(ae)):Lr(ae)?(i.consume(ae),Ue):Ee(ae)}function Se(ae){return ae===null||ae===60||ae===61||ae===62||ae===96?a(ae):ae===34||ae===39?(i.consume(ae),l=ae,Xe):wn(ae)?(m=Se,Ge(ae)):Lr(ae)?(i.consume(ae),Se):(i.consume(ae),Re)}function Xe(ae){return ae===l?(i.consume(ae),l=void 0,Be):ae===null?a(ae):wn(ae)?(m=Xe,Ge(ae)):(i.consume(ae),Xe)}function Re(ae){return ae===null||ae===34||ae===39||ae===60||ae===61||ae===96?a(ae):ae===47||ae===62||Lo(ae)?Ee(ae):(i.consume(ae),Re)}function Be(ae){return ae===47||ae===62||Lo(ae)?Ee(ae):a(ae)}function $e(ae){return ae===62?(i.consume(ae),i.exit("htmlTextData"),i.exit("htmlText"),r):a(ae)}function Ge(ae){return i.exit("htmlTextData"),i.enter("lineEnding"),i.consume(ae),i.exit("lineEnding"),Ie}function Ie(ae){return Lr(ae)?Ei(i,Ke,"linePrefix",c.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(ae):Ke(ae)}function Ke(ae){return i.enter("htmlTextData"),m(ae)}}const cV={name:"labelEnd",resolveAll:ZDe,resolveTo:exe,tokenize:txe},JDe={tokenize:nxe},$De={tokenize:rxe},QDe={tokenize:ixe};function ZDe(i){let r=-1;const a=[];for(;++r<i.length;){const c=i[r][1];if(a.push(i[r]),c.type==="labelImage"||c.type==="labelLink"||c.type==="labelEnd"){const l=c.type==="labelImage"?4:2;c.type="data",r+=l}}return i.length!==a.length&&Id(i,0,i.length,a),i}function exe(i,r){let a=i.length,c=0,l,h,m,E;for(;a--;)if(l=i[a][1],h){if(l.type==="link"||l.type==="labelLink"&&l._inactive)break;i[a][0]==="enter"&&l.type==="labelLink"&&(l._inactive=!0)}else if(m){if(i[a][0]==="enter"&&(l.type==="labelImage"||l.type==="labelLink")&&!l._balanced&&(h=a,l.type!=="labelLink")){c=2;break}}else l.type==="labelEnd"&&(m=a);const S={type:i[h][1].type==="labelLink"?"link":"image",start:{...i[h][1].start},end:{...i[i.length-1][1].end}},T={type:"label",start:{...i[h][1].start},end:{...i[m][1].end}},C={type:"labelText",start:{...i[h+c+2][1].end},end:{...i[m-2][1].start}};return E=[["enter",S,r],["enter",T,r]],E=rl(E,i.slice(h+1,h+c+3)),E=rl(E,[["enter",C,r]]),E=rl(E,oV(r.parser.constructs.insideSpan.null,i.slice(h+c+4,m-3),r)),E=rl(E,[["exit",C,r],i[m-2],i[m-1],["exit",T,r]]),E=rl(E,i.slice(m+1)),E=rl(E,[["exit",S,r]]),Id(i,h,i.length,E),i}function txe(i,r,a){const c=this;let l=c.events.length,h,m;for(;l--;)if((c.events[l][1].type==="labelImage"||c.events[l][1].type==="labelLink")&&!c.events[l][1]._balanced){h=c.events[l][1];break}return E;function E(N){return h?h._inactive?I(N):(m=c.parser.defined.includes(Wy(c.sliceSerialize({start:h.end,end:c.now()}))),i.enter("labelEnd"),i.enter("labelMarker"),i.consume(N),i.exit("labelMarker"),i.exit("labelEnd"),S):a(N)}function S(N){return N===40?i.attempt(JDe,C,m?C:I)(N):N===91?i.attempt($De,C,m?T:I)(N):m?C(N):I(N)}function T(N){return i.attempt(QDe,C,I)(N)}function C(N){return r(N)}function I(N){return h._balanced=!0,a(N)}}function nxe(i,r,a){return c;function c(I){return i.enter("resource"),i.enter("resourceMarker"),i.consume(I),i.exit("resourceMarker"),l}function l(I){return Lo(I)?ew(i,h)(I):h(I)}function h(I){return I===41?C(I):hte(i,m,E,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(I)}function m(I){return Lo(I)?ew(i,S)(I):C(I)}function E(I){return a(I)}function S(I){return I===34||I===39||I===40?fte(i,T,a,"resourceTitle","resourceTitleMarker","resourceTitleString")(I):C(I)}function T(I){return Lo(I)?ew(i,C)(I):C(I)}function C(I){return I===41?(i.enter("resourceMarker"),i.consume(I),i.exit("resourceMarker"),i.exit("resource"),r):a(I)}}function rxe(i,r,a){const c=this;return l;function l(E){return pte.call(c,i,h,m,"reference","referenceMarker","referenceString")(E)}function h(E){return c.parser.defined.includes(Wy(c.sliceSerialize(c.events[c.events.length-1][1]).slice(1,-1)))?r(E):a(E)}function m(E){return a(E)}}function ixe(i,r,a){return c;function c(h){return i.enter("reference"),i.enter("referenceMarker"),i.consume(h),i.exit("referenceMarker"),l}function l(h){return h===93?(i.enter("referenceMarker"),i.consume(h),i.exit("referenceMarker"),i.exit("reference"),r):a(h)}}const sxe={name:"labelStartImage",resolveAll:cV.resolveAll,tokenize:axe};function axe(i,r,a){const c=this;return l;function l(E){return i.enter("labelImage"),i.enter("labelImageMarker"),i.consume(E),i.exit("labelImageMarker"),h}function h(E){return E===91?(i.enter("labelMarker"),i.consume(E),i.exit("labelMarker"),i.exit("labelImage"),m):a(E)}function m(E){return E===94&&"_hiddenFootnoteSupport"in c.parser.constructs?a(E):r(E)}}const oxe={name:"labelStartLink",resolveAll:cV.resolveAll,tokenize:cxe};function cxe(i,r,a){const c=this;return l;function l(m){return i.enter("labelLink"),i.enter("labelMarker"),i.consume(m),i.exit("labelMarker"),i.exit("labelLink"),h}function h(m){return m===94&&"_hiddenFootnoteSupport"in c.parser.constructs?a(m):r(m)}}const vL={name:"lineEnding",tokenize:lxe};function lxe(i,r){return a;function a(c){return i.enter("lineEnding"),i.consume(c),i.exit("lineEnding"),Ei(i,r,"linePrefix")}}const RA={name:"thematicBreak",tokenize:uxe};function uxe(i,r,a){let c=0,l;return h;function h(T){return i.enter("thematicBreak"),m(T)}function m(T){return l=T,E(T)}function E(T){return T===l?(i.enter("thematicBreakSequence"),S(T)):c>=3&&(T===null||wn(T))?(i.exit("thematicBreak"),r(T)):a(T)}function S(T){return T===l?(i.consume(T),c++,S):(i.exit("thematicBreakSequence"),Lr(T)?Ei(i,E,"whitespace")(T):E(T))}}const Ro={continuation:{tokenize:fxe},exit:gxe,name:"list",tokenize:pxe},dxe={partial:!0,tokenize:_xe},hxe={partial:!0,tokenize:mxe};function pxe(i,r,a){const c=this,l=c.events[c.events.length-1];let h=l&&l[1].type==="linePrefix"?l[2].sliceSerialize(l[1],!0).length:0,m=0;return E;function E(P){const H=c.containerState.type||(P===42||P===43||P===45?"listUnordered":"listOrdered");if(H==="listUnordered"?!c.containerState.marker||P===c.containerState.marker:n2(P)){if(c.containerState.type||(c.containerState.type=H,i.enter(H,{_container:!0})),H==="listUnordered")return i.enter("listItemPrefix"),P===42||P===45?i.check(RA,a,T)(P):T(P);if(!c.interrupt||P===49)return i.enter("listItemPrefix"),i.enter("listItemValue"),S(P)}return a(P)}function S(P){return n2(P)&&++m<10?(i.consume(P),S):(!c.interrupt||m<2)&&(c.containerState.marker?P===c.containerState.marker:P===41||P===46)?(i.exit("listItemValue"),T(P)):a(P)}function T(P){return i.enter("listItemMarker"),i.consume(P),i.exit("listItemMarker"),c.containerState.marker=c.containerState.marker||P,i.check(KO,c.interrupt?a:C,i.attempt(dxe,N,I))}function C(P){return c.containerState.initialBlankLine=!0,h++,N(P)}function I(P){return Lr(P)?(i.enter("listItemPrefixWhitespace"),i.consume(P),i.exit("listItemPrefixWhitespace"),N):a(P)}function N(P){return c.containerState.size=h+c.sliceSerialize(i.exit("listItemPrefix"),!0).length,r(P)}}function fxe(i,r,a){const c=this;return c.containerState._closeFlow=void 0,i.check(KO,l,h);function l(E){return c.containerState.furtherBlankLines=c.containerState.furtherBlankLines||c.containerState.initialBlankLine,Ei(i,r,"listItemIndent",c.containerState.size+1)(E)}function h(E){return c.containerState.furtherBlankLines||!Lr(E)?(c.containerState.furtherBlankLines=void 0,c.containerState.initialBlankLine=void 0,m(E)):(c.containerState.furtherBlankLines=void 0,c.containerState.initialBlankLine=void 0,i.attempt(hxe,r,m)(E))}function m(E){return c.containerState._closeFlow=!0,c.interrupt=void 0,Ei(i,i.attempt(Ro,r,a),"linePrefix",c.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(E)}}function mxe(i,r,a){const c=this;return Ei(i,l,"listItemIndent",c.containerState.size+1);function l(h){const m=c.events[c.events.length-1];return m&&m[1].type==="listItemIndent"&&m[2].sliceSerialize(m[1],!0).length===c.containerState.size?r(h):a(h)}}function gxe(i){i.exit(this.containerState.type)}function _xe(i,r,a){const c=this;return Ei(i,l,"listItemPrefixWhitespace",c.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function l(h){const m=c.events[c.events.length-1];return!Lr(h)&&m&&m[1].type==="listItemPrefixWhitespace"?r(h):a(h)}}const ZY={name:"setextUnderline",resolveTo:Exe,tokenize:yxe};function Exe(i,r){let a=i.length,c,l,h;for(;a--;)if(i[a][0]==="enter"){if(i[a][1].type==="content"){c=a;break}i[a][1].type==="paragraph"&&(l=a)}else i[a][1].type==="content"&&i.splice(a,1),!h&&i[a][1].type==="definition"&&(h=a);const m={type:"setextHeading",start:{...i[c][1].start},end:{...i[i.length-1][1].end}};return i[l][1].type="setextHeadingText",h?(i.splice(l,0,["enter",m,r]),i.splice(h+1,0,["exit",i[c][1],r]),i[c][1].end={...i[h][1].end}):i[c][1]=m,i.push(["exit",m,r]),i}function yxe(i,r,a){const c=this;let l;return h;function h(T){let C=c.events.length,I;for(;C--;)if(c.events[C][1].type!=="lineEnding"&&c.events[C][1].type!=="linePrefix"&&c.events[C][1].type!=="content"){I=c.events[C][1].type==="paragraph";break}return!c.parser.lazy[c.now().line]&&(c.interrupt||I)?(i.enter("setextHeadingLine"),l=T,m(T)):a(T)}function m(T){return i.enter("setextHeadingLineSequence"),E(T)}function E(T){return T===l?(i.consume(T),E):(i.exit("setextHeadingLineSequence"),Lr(T)?Ei(i,S,"lineSuffix")(T):S(T))}function S(T){return T===null||wn(T)?(i.exit("setextHeadingLine"),r(T)):a(T)}}const vxe={tokenize:Sxe};function Sxe(i){const r=this,a=i.attempt(KO,c,i.attempt(this.parser.constructs.flowInitial,l,Ei(i,i.attempt(this.parser.constructs.flow,l,i.attempt(bDe,l)),"linePrefix")));return a;function c(h){if(h===null){i.consume(h);return}return i.enter("lineEndingBlank"),i.consume(h),i.exit("lineEndingBlank"),r.currentConstruct=void 0,a}function l(h){if(h===null){i.consume(h);return}return i.enter("lineEnding"),i.consume(h),i.exit("lineEnding"),r.currentConstruct=void 0,a}}const Txe={resolveAll:gte()},wxe=mte("string"),Cxe=mte("text");function mte(i){return{resolveAll:gte(i==="text"?Rxe:void 0),tokenize:r};function r(a){const c=this,l=this.parser.constructs[i],h=a.attempt(l,m,E);return m;function m(C){return T(C)?h(C):E(C)}function E(C){if(C===null){a.consume(C);return}return a.enter("data"),a.consume(C),S}function S(C){return T(C)?(a.exit("data"),h(C)):(a.consume(C),S)}function T(C){if(C===null)return!0;const I=l[C];let N=-1;if(I)for(;++N<I.length;){const P=I[N];if(!P.previous||P.previous.call(c,c.previous))return!0}return!1}}}function gte(i){return r;function r(a,c){let l=-1,h;for(;++l<=a.length;)h===void 0?a[l]&&a[l][1].type==="data"&&(h=l,l++):(!a[l]||a[l][1].type!=="data")&&(l!==h+2&&(a[h][1].end=a[l-1][1].end,a.splice(h+2,l-h-2),l=h+2),h=void 0);return i?i(a,c):a}}function Rxe(i,r){let a=0;for(;++a<=i.length;)if((a===i.length||i[a][1].type==="lineEnding")&&i[a-1][1].type==="data"){const c=i[a-1][1],l=r.sliceStream(c);let h=l.length,m=-1,E=0,S;for(;h--;){const T=l[h];if(typeof T=="string"){for(m=T.length;T.charCodeAt(m-1)===32;)E++,m--;if(m)break;m=-1}else if(T===-2)S=!0,E++;else if(T!==-1){h++;break}}if(r._contentTypeTextTrailing&&a===i.length&&(E=0),E){const T={type:a===i.length||S||E<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:h?m:c.start._bufferIndex+m,_index:c.start._index+h,line:c.end.line,column:c.end.column-E,offset:c.end.offset-E},end:{...c.end}};c.end={...T.start},c.start.offset===c.end.offset?Object.assign(c,T):(i.splice(a,0,["enter",T,r],["exit",T,r]),a+=2)}a++}return i}const bxe={42:Ro,43:Ro,45:Ro,48:Ro,49:Ro,50:Ro,51:Ro,52:Ro,53:Ro,54:Ro,55:Ro,56:Ro,57:Ro,62:cte},Ixe={91:PDe},Axe={[-2]:yL,[-1]:yL,32:yL},Oxe={35:UDe,42:RA,45:[ZY,RA],60:BDe,61:ZY,95:RA,96:$Y,126:$Y},Nxe={38:ute,92:lte},Pxe={[-5]:vL,[-4]:vL,[-3]:vL,33:sxe,38:ute,42:r2,60:[oDe,qDe],91:oxe,92:[LDe,lte],93:cV,95:r2,96:vDe},kxe={null:[r2,Txe]},Dxe={null:[42,95]},xxe={null:[]},Lxe=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:Dxe,contentInitial:Ixe,disable:xxe,document:bxe,flow:Oxe,flowInitial:Axe,insideSpan:kxe,string:Nxe,text:Pxe},Symbol.toStringTag,{value:"Module"}));function Mxe(i,r,a){let c={_bufferIndex:-1,_index:0,line:a&&a.line||1,column:a&&a.column||1,offset:a&&a.offset||0};const l={},h=[];let m=[],E=[];const S={attempt:te(re),check:te(ce),consume:Z,enter:$,exit:le,interrupt:te(ce,{interrupt:!0})},T={code:null,containerState:{},defineSkip:x,events:[],now:H,parser:i,previous:null,sliceSerialize:N,sliceStream:P,write:I};let C=r.tokenize.call(T,S);return r.resolveAll&&h.push(r),T;function I(Ue){return m=rl(m,Ue),B(),m[m.length-1]!==null?[]:(pe(r,0),T.events=oV(h,T.events,T),T.events)}function N(Ue,Se){return Vxe(P(Ue),Se)}function P(Ue){return Uxe(m,Ue)}function H(){const{_bufferIndex:Ue,_index:Se,line:Xe,column:Re,offset:Be}=c;return{_bufferIndex:Ue,_index:Se,line:Xe,column:Re,offset:Be}}function x(Ue){l[Ue.line]=Ue.column,Ne()}function B(){let Ue;for(;c._index<m.length;){const Se=m[c._index];if(typeof Se=="string")for(Ue=c._index,c._bufferIndex<0&&(c._bufferIndex=0);c._index===Ue&&c._bufferIndex<Se.length;)X(Se.charCodeAt(c._bufferIndex));else X(Se)}}function X(Ue){C=C(Ue)}function Z(Ue){wn(Ue)?(c.line++,c.column=1,c.offset+=Ue===-3?2:1,Ne()):Ue!==-1&&(c.column++,c.offset++),c._bufferIndex<0?c._index++:(c._bufferIndex++,c._bufferIndex===m[c._index].length&&(c._bufferIndex=-1,c._index++)),T.previous=Ue}function $(Ue,Se){const Xe=Se||{};return Xe.type=Ue,Xe.start=H(),T.events.push(["enter",Xe,T]),E.push(Xe),Xe}function le(Ue){const Se=E.pop();return Se.end=H(),T.events.push(["exit",Se,T]),Se}function re(Ue,Se){pe(Ue,Se.from)}function ce(Ue,Se){Se.restore()}function te(Ue,Se){return Xe;function Xe(Re,Be,$e){let Ge,Ie,Ke,ae;return Array.isArray(Re)?Pe(Re):"tokenize"in Re?Pe([Re]):ge(Re);function ge(Dt){return At;function At(dn){const Cn=dn!==null&&Dt[dn],fr=dn!==null&&Dt.null,os=[...Array.isArray(Cn)?Cn:Cn?[Cn]:[],...Array.isArray(fr)?fr:fr?[fr]:[]];return Pe(os)(dn)}}function Pe(Dt){return Ge=Dt,Ie=0,Dt.length===0?$e:ue(Dt[Ie])}function ue(Dt){return At;function At(dn){return ae=Ee(),Ke=Dt,Dt.partial||(T.currentConstruct=Dt),Dt.name&&T.parser.constructs.disable.null.includes(Dt.name)?yt():Dt.tokenize.call(Se?Object.assign(Object.create(T),Se):T,S,it,yt)(dn)}}function it(Dt){return Ue(Ke,ae),Be}function yt(Dt){return ae.restore(),++Ie<Ge.length?ue(Ge[Ie]):$e}}}function pe(Ue,Se){Ue.resolveAll&&!h.includes(Ue)&&h.push(Ue),Ue.resolve&&Id(T.events,Se,T.events.length-Se,Ue.resolve(T.events.slice(Se),T)),Ue.resolveTo&&(T.events=Ue.resolveTo(T.events,T))}function Ee(){const Ue=H(),Se=T.previous,Xe=T.currentConstruct,Re=T.events.length,Be=Array.from(E);return{from:Re,restore:$e};function $e(){c=Ue,T.previous=Se,T.currentConstruct=Xe,T.events.length=Re,E=Be,Ne()}}function Ne(){c.line in l&&c.column<2&&(c.column=l[c.line],c.offset+=l[c.line]-1)}}function Uxe(i,r){const a=r.start._index,c=r.start._bufferIndex,l=r.end._index,h=r.end._bufferIndex;let m;if(a===l)m=[i[a].slice(c,h)];else{if(m=i.slice(a,l),c>-1){const E=m[0];typeof E=="string"?m[0]=E.slice(c):m.shift()}h>0&&m.push(i[l].slice(0,h))}return m}function Vxe(i,r){let a=-1;const c=[];let l;for(;++a<i.length;){const h=i[a];let m;if(typeof h=="string")m=h;else switch(h){case-5:{m="\r";break}case-4:{m=`
`;break}case-3:{m=`\r
`;break}case-2:{m=r?" ":"	";break}case-1:{if(!r&&l)continue;m=" ";break}default:m=String.fromCharCode(h)}l=h===-2,c.push(m)}return c.join("")}function Fxe(i){const c={constructs:Kke([Lxe,...(i||{}).extensions||[]]),content:l(eDe),defined:[],document:l(nDe),flow:l(vxe),lazy:{},string:l(wxe),text:l(Cxe)};return c;function l(h){return m;function m(E){return Mxe(c,h,E)}}}function jxe(i){for(;!dte(i););return i}const eq=/[\0\t\n\r]/g;function Bxe(){let i=1,r="",a=!0,c;return l;function l(h,m,E){const S=[];let T,C,I,N,P;for(h=r+(typeof h=="string"?h.toString():new TextDecoder(m||void 0).decode(h)),I=0,r="",a&&(h.charCodeAt(0)===65279&&I++,a=void 0);I<h.length;){if(eq.lastIndex=I,T=eq.exec(h),N=T&&T.index!==void 0?T.index:h.length,P=h.charCodeAt(N),!T){r=h.slice(I);break}if(P===10&&I===N&&c)S.push(-3),c=void 0;else switch(c&&(S.push(-5),c=void 0),I<N&&(S.push(h.slice(I,N)),i+=N-I),P){case 0:{S.push(65533),i++;break}case 9:{for(C=Math.ceil(i/4)*4,S.push(-2);i++<C;)S.push(-1);break}case 10:{S.push(-4),i=1;break}default:c=!0,i=1}I=N+1}return E&&(c&&S.push(-5),r&&S.push(r),S.push(null)),S}}const Wxe=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function Gxe(i){return i.replace(Wxe,Hxe)}function Hxe(i,r,a){if(r)return r;if(a.charCodeAt(0)===35){const l=a.charCodeAt(1),h=l===120||l===88;return ote(a.slice(h?2:1),h?16:10)}return aV(a)||i}const _te={}.hasOwnProperty;function zxe(i,r,a){return typeof r!="string"&&(a=r,r=void 0),Kxe(a)(jxe(Fxe(a).document().write(Bxe()(i,r,!0))))}function Kxe(i){const r={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:h(fi),autolinkProtocol:Ee,autolinkEmail:Ee,atxHeading:h(pl),blockQuote:h(fr),characterEscape:Ee,characterReference:Ee,codeFenced:h(os),codeFencedFenceInfo:m,codeFencedFenceMeta:m,codeIndented:h(os,m),codeText:h(Jr,m),codeTextData:Ee,data:Ee,codeFlowValue:Ee,definition:h(Mr),definitionDestinationString:m,definitionLabelString:m,definitionTitleString:m,emphasis:h(Tc),hardBreakEscape:h(yi),hardBreakTrailing:h(yi),htmlFlow:h(wc,m),htmlFlowData:Ee,htmlText:h(wc,m),htmlTextData:Ee,image:h(Wr),label:m,link:h(fi),listItem:h(gs),listItemValue:N,listOrdered:h($s,I),listUnordered:h($s),paragraph:h(Cc),reference:ue,referenceString:m,resourceDestinationString:m,resourceTitleString:m,setextHeading:h(pl),strong:h(Qs),thematicBreak:h(Ua)},exit:{atxHeading:S(),atxHeadingSequence:re,autolink:S(),autolinkEmail:Cn,autolinkProtocol:dn,blockQuote:S(),characterEscapeValue:Ne,characterReferenceMarkerHexadecimal:yt,characterReferenceMarkerNumeric:yt,characterReferenceValue:Dt,characterReference:At,codeFenced:S(B),codeFencedFence:x,codeFencedFenceInfo:P,codeFencedFenceMeta:H,codeFlowValue:Ne,codeIndented:S(X),codeText:S(Be),codeTextData:Ne,data:Ne,definition:S(),definitionDestinationString:le,definitionLabelString:Z,definitionTitleString:$,emphasis:S(),hardBreakEscape:S(Se),hardBreakTrailing:S(Se),htmlFlow:S(Xe),htmlFlowData:Ne,htmlText:S(Re),htmlTextData:Ne,image:S(Ge),label:Ke,labelText:Ie,lineEnding:Ue,link:S($e),listItem:S(),listOrdered:S(),listUnordered:S(),paragraph:S(),referenceString:it,resourceDestinationString:ae,resourceTitleString:ge,resource:Pe,setextHeading:S(pe),setextHeadingLineSequence:te,setextHeadingText:ce,strong:S(),thematicBreak:S()}};Ete(r,(i||{}).mdastExtensions||[]);const a={};return c;function c(qe){let lt={type:"root",children:[]};const Kt={stack:[lt],tokenStack:[],config:r,enter:E,exit:T,buffer:m,resume:C,data:a},on=[];let Nn=-1;for(;++Nn<qe.length;)if(qe[Nn][1].type==="listOrdered"||qe[Nn][1].type==="listUnordered")if(qe[Nn][0]==="enter")on.push(Nn);else{const ii=on.pop();Nn=l(qe,ii,Nn)}for(Nn=-1;++Nn<qe.length;){const ii=r[qe[Nn][0]];_te.call(ii,qe[Nn][1].type)&&ii[qe[Nn][1].type].call(Object.assign({sliceSerialize:qe[Nn][2].sliceSerialize},Kt),qe[Nn][1])}if(Kt.tokenStack.length>0){const ii=Kt.tokenStack[Kt.tokenStack.length-1];(ii[1]||tq).call(Kt,void 0,ii[0])}for(lt.position={start:Bp(qe.length>0?qe[0][1].start:{line:1,column:1,offset:0}),end:Bp(qe.length>0?qe[qe.length-2][1].end:{line:1,column:1,offset:0})},Nn=-1;++Nn<r.transforms.length;)lt=r.transforms[Nn](lt)||lt;return lt}function l(qe,lt,Kt){let on=lt-1,Nn=-1,ii=!1,Zs,$r,mi,_a;for(;++on<=Kt;){const Gr=qe[on];switch(Gr[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{Gr[0]==="enter"?Nn++:Nn--,_a=void 0;break}case"lineEndingBlank":{Gr[0]==="enter"&&(Zs&&!_a&&!Nn&&!mi&&(mi=on),_a=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:_a=void 0}if(!Nn&&Gr[0]==="enter"&&Gr[1].type==="listItemPrefix"||Nn===-1&&Gr[0]==="exit"&&(Gr[1].type==="listUnordered"||Gr[1].type==="listOrdered")){if(Zs){let Ea=on;for($r=void 0;Ea--;){const vi=qe[Ea];if(vi[1].type==="lineEnding"||vi[1].type==="lineEndingBlank"){if(vi[0]==="exit")continue;$r&&(qe[$r][1].type="lineEndingBlank",ii=!0),vi[1].type="lineEnding",$r=Ea}else if(!(vi[1].type==="linePrefix"||vi[1].type==="blockQuotePrefix"||vi[1].type==="blockQuotePrefixWhitespace"||vi[1].type==="blockQuoteMarker"||vi[1].type==="listItemIndent"))break}mi&&(!$r||mi<$r)&&(Zs._spread=!0),Zs.end=Object.assign({},$r?qe[$r][1].start:Gr[1].end),qe.splice($r||on,0,["exit",Zs,Gr[2]]),on++,Kt++}if(Gr[1].type==="listItemPrefix"){const Ea={type:"listItem",_spread:!1,start:Object.assign({},Gr[1].start),end:void 0};Zs=Ea,qe.splice(on,0,["enter",Ea,Gr[2]]),on++,Kt++,mi=void 0,_a=!0}}}return qe[lt][1]._spread=ii,Kt}function h(qe,lt){return Kt;function Kt(on){E.call(this,qe(on),on),lt&&lt.call(this,on)}}function m(){this.stack.push({type:"fragment",children:[]})}function E(qe,lt,Kt){this.stack[this.stack.length-1].children.push(qe),this.stack.push(qe),this.tokenStack.push([lt,Kt||void 0]),qe.position={start:Bp(lt.start),end:void 0}}function S(qe){return lt;function lt(Kt){qe&&qe.call(this,Kt),T.call(this,Kt)}}function T(qe,lt){const Kt=this.stack.pop(),on=this.tokenStack.pop();if(on)on[0].type!==qe.type&&(lt?lt.call(this,qe,on[0]):(on[1]||tq).call(this,qe,on[0]));else throw new Error("Cannot close `"+qe.type+"` ("+Z0({start:qe.start,end:qe.end})+"): its not open");Kt.position.end=Bp(qe.end)}function C(){return Hke(this.stack.pop())}function I(){this.data.expectingFirstListItemValue=!0}function N(qe){if(this.data.expectingFirstListItemValue){const lt=this.stack[this.stack.length-2];lt.start=Number.parseInt(this.sliceSerialize(qe),10),this.data.expectingFirstListItemValue=void 0}}function P(){const qe=this.resume(),lt=this.stack[this.stack.length-1];lt.lang=qe}function H(){const qe=this.resume(),lt=this.stack[this.stack.length-1];lt.meta=qe}function x(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function B(){const qe=this.resume(),lt=this.stack[this.stack.length-1];lt.value=qe.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function X(){const qe=this.resume(),lt=this.stack[this.stack.length-1];lt.value=qe.replace(/(\r?\n|\r)$/g,"")}function Z(qe){const lt=this.resume(),Kt=this.stack[this.stack.length-1];Kt.label=lt,Kt.identifier=Wy(this.sliceSerialize(qe)).toLowerCase()}function $(){const qe=this.resume(),lt=this.stack[this.stack.length-1];lt.title=qe}function le(){const qe=this.resume(),lt=this.stack[this.stack.length-1];lt.url=qe}function re(qe){const lt=this.stack[this.stack.length-1];if(!lt.depth){const Kt=this.sliceSerialize(qe).length;lt.depth=Kt}}function ce(){this.data.setextHeadingSlurpLineEnding=!0}function te(qe){const lt=this.stack[this.stack.length-1];lt.depth=this.sliceSerialize(qe).codePointAt(0)===61?1:2}function pe(){this.data.setextHeadingSlurpLineEnding=void 0}function Ee(qe){const Kt=this.stack[this.stack.length-1].children;let on=Kt[Kt.length-1];(!on||on.type!=="text")&&(on=Ir(),on.position={start:Bp(qe.start),end:void 0},Kt.push(on)),this.stack.push(on)}function Ne(qe){const lt=this.stack.pop();lt.value+=this.sliceSerialize(qe),lt.position.end=Bp(qe.end)}function Ue(qe){const lt=this.stack[this.stack.length-1];if(this.data.atHardBreak){const Kt=lt.children[lt.children.length-1];Kt.position.end=Bp(qe.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&r.canContainEols.includes(lt.type)&&(Ee.call(this,qe),Ne.call(this,qe))}function Se(){this.data.atHardBreak=!0}function Xe(){const qe=this.resume(),lt=this.stack[this.stack.length-1];lt.value=qe}function Re(){const qe=this.resume(),lt=this.stack[this.stack.length-1];lt.value=qe}function Be(){const qe=this.resume(),lt=this.stack[this.stack.length-1];lt.value=qe}function $e(){const qe=this.stack[this.stack.length-1];if(this.data.inReference){const lt=this.data.referenceType||"shortcut";qe.type+="Reference",qe.referenceType=lt,delete qe.url,delete qe.title}else delete qe.identifier,delete qe.label;this.data.referenceType=void 0}function Ge(){const qe=this.stack[this.stack.length-1];if(this.data.inReference){const lt=this.data.referenceType||"shortcut";qe.type+="Reference",qe.referenceType=lt,delete qe.url,delete qe.title}else delete qe.identifier,delete qe.label;this.data.referenceType=void 0}function Ie(qe){const lt=this.sliceSerialize(qe),Kt=this.stack[this.stack.length-2];Kt.label=Gxe(lt),Kt.identifier=Wy(lt).toLowerCase()}function Ke(){const qe=this.stack[this.stack.length-1],lt=this.resume(),Kt=this.stack[this.stack.length-1];if(this.data.inReference=!0,Kt.type==="link"){const on=qe.children;Kt.children=on}else Kt.alt=lt}function ae(){const qe=this.resume(),lt=this.stack[this.stack.length-1];lt.url=qe}function ge(){const qe=this.resume(),lt=this.stack[this.stack.length-1];lt.title=qe}function Pe(){this.data.inReference=void 0}function ue(){this.data.referenceType="collapsed"}function it(qe){const lt=this.resume(),Kt=this.stack[this.stack.length-1];Kt.label=lt,Kt.identifier=Wy(this.sliceSerialize(qe)).toLowerCase(),this.data.referenceType="full"}function yt(qe){this.data.characterReferenceType=qe.type}function Dt(qe){const lt=this.sliceSerialize(qe),Kt=this.data.characterReferenceType;let on;Kt?(on=ote(lt,Kt==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):on=aV(lt);const Nn=this.stack[this.stack.length-1];Nn.value+=on}function At(qe){const lt=this.stack.pop();lt.position.end=Bp(qe.end)}function dn(qe){Ne.call(this,qe);const lt=this.stack[this.stack.length-1];lt.url=this.sliceSerialize(qe)}function Cn(qe){Ne.call(this,qe);const lt=this.stack[this.stack.length-1];lt.url="mailto:"+this.sliceSerialize(qe)}function fr(){return{type:"blockquote",children:[]}}function os(){return{type:"code",lang:null,meta:null,value:""}}function Jr(){return{type:"inlineCode",value:""}}function Mr(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function Tc(){return{type:"emphasis",children:[]}}function pl(){return{type:"heading",depth:0,children:[]}}function yi(){return{type:"break"}}function wc(){return{type:"html",value:""}}function Wr(){return{type:"image",title:null,url:"",alt:null}}function fi(){return{type:"link",title:null,url:"",children:[]}}function $s(qe){return{type:"list",ordered:qe.type==="listOrdered",start:null,spread:qe._spread,children:[]}}function gs(qe){return{type:"listItem",spread:qe._spread,checked:null,children:[]}}function Cc(){return{type:"paragraph",children:[]}}function Qs(){return{type:"strong",children:[]}}function Ir(){return{type:"text",value:""}}function Ua(){return{type:"thematicBreak"}}}function Bp(i){return{line:i.line,column:i.column,offset:i.offset}}function Ete(i,r){let a=-1;for(;++a<r.length;){const c=r[a];Array.isArray(c)?Ete(i,c):Yxe(i,c)}}function Yxe(i,r){let a;for(a in r)if(_te.call(r,a))switch(a){case"canContainEols":{const c=r[a];c&&i[a].push(...c);break}case"transforms":{const c=r[a];c&&i[a].push(...c);break}case"enter":case"exit":{const c=r[a];c&&Object.assign(i[a],c);break}}}function tq(i,r){throw i?new Error("Cannot close `"+i.type+"` ("+Z0({start:i.start,end:i.end})+"): a different token (`"+r.type+"`, "+Z0({start:r.start,end:r.end})+") is open"):new Error("Cannot close document, a token (`"+r.type+"`, "+Z0({start:r.start,end:r.end})+") is still open")}function qxe(i){const r=this;r.parser=a;function a(c){return zxe(c,{...r.data("settings"),...i,extensions:r.data("micromarkExtensions")||[],mdastExtensions:r.data("fromMarkdownExtensions")||[]})}}function Xxe(i,r){const a={type:"element",tagName:"blockquote",properties:{},children:i.wrap(i.all(r),!0)};return i.patch(r,a),i.applyData(r,a)}function Jxe(i,r){const a={type:"element",tagName:"br",properties:{},children:[]};return i.patch(r,a),[i.applyData(r,a),{type:"text",value:`
`}]}function $xe(i,r){const a=r.value?r.value+`
`:"",c={},l=r.lang?r.lang.split(/\s+/):[];l.length>0&&(c.className=["language-"+l[0]]);let h={type:"element",tagName:"code",properties:c,children:[{type:"text",value:a}]};return r.meta&&(h.data={meta:r.meta}),i.patch(r,h),h=i.applyData(r,h),h={type:"element",tagName:"pre",properties:{},children:[h]},i.patch(r,h),h}function Qxe(i,r){const a={type:"element",tagName:"del",properties:{},children:i.all(r)};return i.patch(r,a),i.applyData(r,a)}function Zxe(i,r){const a={type:"element",tagName:"em",properties:{},children:i.all(r)};return i.patch(r,a),i.applyData(r,a)}function eLe(i,r){const a=typeof i.options.clobberPrefix=="string"?i.options.clobberPrefix:"user-content-",c=String(r.identifier).toUpperCase(),l=gv(c.toLowerCase()),h=i.footnoteOrder.indexOf(c);let m,E=i.footnoteCounts.get(c);E===void 0?(E=0,i.footnoteOrder.push(c),m=i.footnoteOrder.length):m=h+1,E+=1,i.footnoteCounts.set(c,E);const S={type:"element",tagName:"a",properties:{href:"#"+a+"fn-"+l,id:a+"fnref-"+l+(E>1?"-"+E:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(m)}]};i.patch(r,S);const T={type:"element",tagName:"sup",properties:{},children:[S]};return i.patch(r,T),i.applyData(r,T)}function tLe(i,r){const a={type:"element",tagName:"h"+r.depth,properties:{},children:i.all(r)};return i.patch(r,a),i.applyData(r,a)}function nLe(i,r){if(i.options.allowDangerousHtml){const a={type:"raw",value:r.value};return i.patch(r,a),i.applyData(r,a)}}function yte(i,r){const a=r.referenceType;let c="]";if(a==="collapsed"?c+="[]":a==="full"&&(c+="["+(r.label||r.identifier)+"]"),r.type==="imageReference")return[{type:"text",value:"!["+r.alt+c}];const l=i.all(r),h=l[0];h&&h.type==="text"?h.value="["+h.value:l.unshift({type:"text",value:"["});const m=l[l.length-1];return m&&m.type==="text"?m.value+=c:l.push({type:"text",value:c}),l}function rLe(i,r){const a=String(r.identifier).toUpperCase(),c=i.definitionById.get(a);if(!c)return yte(i,r);const l={src:gv(c.url||""),alt:r.alt};c.title!==null&&c.title!==void 0&&(l.title=c.title);const h={type:"element",tagName:"img",properties:l,children:[]};return i.patch(r,h),i.applyData(r,h)}function iLe(i,r){const a={src:gv(r.url)};r.alt!==null&&r.alt!==void 0&&(a.alt=r.alt),r.title!==null&&r.title!==void 0&&(a.title=r.title);const c={type:"element",tagName:"img",properties:a,children:[]};return i.patch(r,c),i.applyData(r,c)}function sLe(i,r){const a={type:"text",value:r.value.replace(/\r?\n|\r/g," ")};i.patch(r,a);const c={type:"element",tagName:"code",properties:{},children:[a]};return i.patch(r,c),i.applyData(r,c)}function aLe(i,r){const a=String(r.identifier).toUpperCase(),c=i.definitionById.get(a);if(!c)return yte(i,r);const l={href:gv(c.url||"")};c.title!==null&&c.title!==void 0&&(l.title=c.title);const h={type:"element",tagName:"a",properties:l,children:i.all(r)};return i.patch(r,h),i.applyData(r,h)}function oLe(i,r){const a={href:gv(r.url)};r.title!==null&&r.title!==void 0&&(a.title=r.title);const c={type:"element",tagName:"a",properties:a,children:i.all(r)};return i.patch(r,c),i.applyData(r,c)}function cLe(i,r,a){const c=i.all(r),l=a?lLe(a):vte(r),h={},m=[];if(typeof r.checked=="boolean"){const C=c[0];let I;C&&C.type==="element"&&C.tagName==="p"?I=C:(I={type:"element",tagName:"p",properties:{},children:[]},c.unshift(I)),I.children.length>0&&I.children.unshift({type:"text",value:" "}),I.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:r.checked,disabled:!0},children:[]}),h.className=["task-list-item"]}let E=-1;for(;++E<c.length;){const C=c[E];(l||E!==0||C.type!=="element"||C.tagName!=="p")&&m.push({type:"text",value:`
`}),C.type==="element"&&C.tagName==="p"&&!l?m.push(...C.children):m.push(C)}const S=c[c.length-1];S&&(l||S.type!=="element"||S.tagName!=="p")&&m.push({type:"text",value:`
`});const T={type:"element",tagName:"li",properties:h,children:m};return i.patch(r,T),i.applyData(r,T)}function lLe(i){let r=!1;if(i.type==="list"){r=i.spread||!1;const a=i.children;let c=-1;for(;!r&&++c<a.length;)r=vte(a[c])}return r}function vte(i){const r=i.spread;return r??i.children.length>1}function uLe(i,r){const a={},c=i.all(r);let l=-1;for(typeof r.start=="number"&&r.start!==1&&(a.start=r.start);++l<c.length;){const m=c[l];if(m.type==="element"&&m.tagName==="li"&&m.properties&&Array.isArray(m.properties.className)&&m.properties.className.includes("task-list-item")){a.className=["contains-task-list"];break}}const h={type:"element",tagName:r.ordered?"ol":"ul",properties:a,children:i.wrap(c,!0)};return i.patch(r,h),i.applyData(r,h)}function dLe(i,r){const a={type:"element",tagName:"p",properties:{},children:i.all(r)};return i.patch(r,a),i.applyData(r,a)}function hLe(i,r){const a={type:"root",children:i.wrap(i.all(r))};return i.patch(r,a),i.applyData(r,a)}function pLe(i,r){const a={type:"element",tagName:"strong",properties:{},children:i.all(r)};return i.patch(r,a),i.applyData(r,a)}function fLe(i,r){const a=i.all(r),c=a.shift(),l=[];if(c){const m={type:"element",tagName:"thead",properties:{},children:i.wrap([c],!0)};i.patch(r.children[0],m),l.push(m)}if(a.length>0){const m={type:"element",tagName:"tbody",properties:{},children:i.wrap(a,!0)},E=nV(r.children[1]),S=ete(r.children[r.children.length-1]);E&&S&&(m.position={start:E,end:S}),l.push(m)}const h={type:"element",tagName:"table",properties:{},children:i.wrap(l,!0)};return i.patch(r,h),i.applyData(r,h)}function mLe(i,r,a){const c=a?a.children:void 0,h=(c?c.indexOf(r):1)===0?"th":"td",m=a&&a.type==="table"?a.align:void 0,E=m?m.length:r.children.length;let S=-1;const T=[];for(;++S<E;){const I=r.children[S],N={},P=m?m[S]:void 0;P&&(N.align=P);let H={type:"element",tagName:h,properties:N,children:[]};I&&(H.children=i.all(I),i.patch(I,H),H=i.applyData(I,H)),T.push(H)}const C={type:"element",tagName:"tr",properties:{},children:i.wrap(T,!0)};return i.patch(r,C),i.applyData(r,C)}function gLe(i,r){const a={type:"element",tagName:"td",properties:{},children:i.all(r)};return i.patch(r,a),i.applyData(r,a)}const nq=9,rq=32;function _Le(i){const r=String(i),a=/\r?\n|\r/g;let c=a.exec(r),l=0;const h=[];for(;c;)h.push(iq(r.slice(l,c.index),l>0,!0),c[0]),l=c.index+c[0].length,c=a.exec(r);return h.push(iq(r.slice(l),l>0,!1)),h.join("")}function iq(i,r,a){let c=0,l=i.length;if(r){let h=i.codePointAt(c);for(;h===nq||h===rq;)c++,h=i.codePointAt(c)}if(a){let h=i.codePointAt(l-1);for(;h===nq||h===rq;)l--,h=i.codePointAt(l-1)}return l>c?i.slice(c,l):""}function ELe(i,r){const a={type:"text",value:_Le(String(r.value))};return i.patch(r,a),i.applyData(r,a)}function yLe(i,r){const a={type:"element",tagName:"hr",properties:{},children:[]};return i.patch(r,a),i.applyData(r,a)}const vLe={blockquote:Xxe,break:Jxe,code:$xe,delete:Qxe,emphasis:Zxe,footnoteReference:eLe,heading:tLe,html:nLe,imageReference:rLe,image:iLe,inlineCode:sLe,linkReference:aLe,link:oLe,listItem:cLe,list:uLe,paragraph:dLe,root:hLe,strong:pLe,table:fLe,tableCell:gLe,tableRow:mLe,text:ELe,thematicBreak:yLe,toml:tA,yaml:tA,definition:tA,footnoteDefinition:tA};function tA(){}const Ste=-1,YO=0,tw=1,hO=2,lV=3,uV=4,dV=5,hV=6,Tte=7,wte=8,sq=typeof self=="object"?self:globalThis,SLe=(i,r)=>{const a=(l,h)=>(i.set(h,l),l),c=l=>{if(i.has(l))return i.get(l);const[h,m]=r[l];switch(h){case YO:case Ste:return a(m,l);case tw:{const E=a([],l);for(const S of m)E.push(c(S));return E}case hO:{const E=a({},l);for(const[S,T]of m)E[c(S)]=c(T);return E}case lV:return a(new Date(m),l);case uV:{const{source:E,flags:S}=m;return a(new RegExp(E,S),l)}case dV:{const E=a(new Map,l);for(const[S,T]of m)E.set(c(S),c(T));return E}case hV:{const E=a(new Set,l);for(const S of m)E.add(c(S));return E}case Tte:{const{name:E,message:S}=m;return a(new sq[E](S),l)}case wte:return a(BigInt(m),l);case"BigInt":return a(Object(BigInt(m)),l);case"ArrayBuffer":return a(new Uint8Array(m).buffer,m);case"DataView":{const{buffer:E}=new Uint8Array(m);return a(new DataView(E),m)}}return a(new sq[h](m),l)};return c},aq=i=>SLe(new Map,i)(0),py="",{toString:TLe}={},{keys:wLe}=Object,A0=i=>{const r=typeof i;if(r!=="object"||!i)return[YO,r];const a=TLe.call(i).slice(8,-1);switch(a){case"Array":return[tw,py];case"Object":return[hO,py];case"Date":return[lV,py];case"RegExp":return[uV,py];case"Map":return[dV,py];case"Set":return[hV,py];case"DataView":return[tw,a]}return a.includes("Array")?[tw,a]:a.includes("Error")?[Tte,a]:[hO,a]},nA=([i,r])=>i===YO&&(r==="function"||r==="symbol"),CLe=(i,r,a,c)=>{const l=(m,E)=>{const S=c.push(m)-1;return a.set(E,S),S},h=m=>{if(a.has(m))return a.get(m);let[E,S]=A0(m);switch(E){case YO:{let C=m;switch(S){case"bigint":E=wte,C=m.toString();break;case"function":case"symbol":if(i)throw new TypeError("unable to serialize "+S);C=null;break;case"undefined":return l([Ste],m)}return l([E,C],m)}case tw:{if(S){let N=m;return S==="DataView"?N=new Uint8Array(m.buffer):S==="ArrayBuffer"&&(N=new Uint8Array(m)),l([S,[...N]],m)}const C=[],I=l([E,C],m);for(const N of m)C.push(h(N));return I}case hO:{if(S)switch(S){case"BigInt":return l([S,m.toString()],m);case"Boolean":case"Number":case"String":return l([S,m.valueOf()],m)}if(r&&"toJSON"in m)return h(m.toJSON());const C=[],I=l([E,C],m);for(const N of wLe(m))(i||!nA(A0(m[N])))&&C.push([h(N),h(m[N])]);return I}case lV:return l([E,m.toISOString()],m);case uV:{const{source:C,flags:I}=m;return l([E,{source:C,flags:I}],m)}case dV:{const C=[],I=l([E,C],m);for(const[N,P]of m)(i||!(nA(A0(N))||nA(A0(P))))&&C.push([h(N),h(P)]);return I}case hV:{const C=[],I=l([E,C],m);for(const N of m)(i||!nA(A0(N)))&&C.push(h(N));return I}}const{message:T}=m;return l([E,{name:S,message:T}],m)};return h},oq=(i,{json:r,lossy:a}={})=>{const c=[];return CLe(!(r||a),!!r,new Map,c)(i),c},pO=typeof structuredClone=="function"?(i,r)=>r&&("json"in r||"lossy"in r)?aq(oq(i,r)):structuredClone(i):(i,r)=>aq(oq(i,r));function RLe(i,r){const a=[{type:"text",value:""}];return r>1&&a.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(r)}]}),a}function bLe(i,r){return"Back to reference "+(i+1)+(r>1?"-"+r:"")}function ILe(i){const r=typeof i.options.clobberPrefix=="string"?i.options.clobberPrefix:"user-content-",a=i.options.footnoteBackContent||RLe,c=i.options.footnoteBackLabel||bLe,l=i.options.footnoteLabel||"Footnotes",h=i.options.footnoteLabelTagName||"h2",m=i.options.footnoteLabelProperties||{className:["sr-only"]},E=[];let S=-1;for(;++S<i.footnoteOrder.length;){const T=i.footnoteById.get(i.footnoteOrder[S]);if(!T)continue;const C=i.all(T),I=String(T.identifier).toUpperCase(),N=gv(I.toLowerCase());let P=0;const H=[],x=i.footnoteCounts.get(I);for(;x!==void 0&&++P<=x;){H.length>0&&H.push({type:"text",value:" "});let Z=typeof a=="string"?a:a(S,P);typeof Z=="string"&&(Z={type:"text",value:Z}),H.push({type:"element",tagName:"a",properties:{href:"#"+r+"fnref-"+N+(P>1?"-"+P:""),dataFootnoteBackref:"",ariaLabel:typeof c=="string"?c:c(S,P),className:["data-footnote-backref"]},children:Array.isArray(Z)?Z:[Z]})}const B=C[C.length-1];if(B&&B.type==="element"&&B.tagName==="p"){const Z=B.children[B.children.length-1];Z&&Z.type==="text"?Z.value+=" ":B.children.push({type:"text",value:" "}),B.children.push(...H)}else C.push(...H);const X={type:"element",tagName:"li",properties:{id:r+"fn-"+N},children:i.wrap(C,!0)};i.patch(T,X),E.push(X)}if(E.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:h,properties:{...pO(m),id:"footnote-label"},children:[{type:"text",value:l}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:i.wrap(E,!0)},{type:"text",value:`
`}]}}const Cte=(function(i){if(i==null)return PLe;if(typeof i=="function")return qO(i);if(typeof i=="object")return Array.isArray(i)?ALe(i):OLe(i);if(typeof i=="string")return NLe(i);throw new Error("Expected function, string, or object as test")});function ALe(i){const r=[];let a=-1;for(;++a<i.length;)r[a]=Cte(i[a]);return qO(c);function c(...l){let h=-1;for(;++h<r.length;)if(r[h].apply(this,l))return!0;return!1}}function OLe(i){const r=i;return qO(a);function a(c){const l=c;let h;for(h in i)if(l[h]!==r[h])return!1;return!0}}function NLe(i){return qO(r);function r(a){return a&&a.type===i}}function qO(i){return r;function r(a,c,l){return!!(kLe(a)&&i.call(this,a,typeof c=="number"?c:void 0,l||void 0))}}function PLe(){return!0}function kLe(i){return i!==null&&typeof i=="object"&&"type"in i}const Rte=[],DLe=!0,cq=!1,xLe="skip";function LLe(i,r,a,c){let l;typeof r=="function"&&typeof a!="function"?(c=a,a=r):l=r;const h=Cte(l),m=c?-1:1;E(i,void 0,[])();function E(S,T,C){const I=S&&typeof S=="object"?S:{};if(typeof I.type=="string"){const P=typeof I.tagName=="string"?I.tagName:typeof I.name=="string"?I.name:void 0;Object.defineProperty(N,"name",{value:"node ("+(S.type+(P?"<"+P+">":""))+")"})}return N;function N(){let P=Rte,H,x,B;if((!r||h(S,T,C[C.length-1]||void 0))&&(P=MLe(a(S,C)),P[0]===cq))return P;if("children"in S&&S.children){const X=S;if(X.children&&P[0]!==xLe)for(x=(c?X.children.length:-1)+m,B=C.concat(X);x>-1&&x<X.children.length;){const Z=X.children[x];if(H=E(Z,x,B)(),H[0]===cq)return H;x=typeof H[1]=="number"?H[1]:x+m}}return P}}}function MLe(i){return Array.isArray(i)?i:typeof i=="number"?[DLe,i]:i==null?Rte:[i]}function bte(i,r,a,c){let l,h,m;typeof r=="function"&&typeof a!="function"?(h=void 0,m=r,l=a):(h=r,m=a,l=c),LLe(i,h,E,l);function E(S,T){const C=T[T.length-1],I=C?C.children.indexOf(S):void 0;return m(S,I,C)}}const i2={}.hasOwnProperty,ULe={};function VLe(i,r){const a=r||ULe,c=new Map,l=new Map,h=new Map,m={...vLe,...a.handlers},E={all:T,applyData:jLe,definitionById:c,footnoteById:l,footnoteCounts:h,footnoteOrder:[],handlers:m,one:S,options:a,patch:FLe,wrap:WLe};return bte(i,function(C){if(C.type==="definition"||C.type==="footnoteDefinition"){const I=C.type==="definition"?c:l,N=String(C.identifier).toUpperCase();I.has(N)||I.set(N,C)}}),E;function S(C,I){const N=C.type,P=E.handlers[N];if(i2.call(E.handlers,N)&&P)return P(E,C,I);if(E.options.passThrough&&E.options.passThrough.includes(N)){if("children"in C){const{children:x,...B}=C,X=pO(B);return X.children=E.all(C),X}return pO(C)}return(E.options.unknownHandler||BLe)(E,C,I)}function T(C){const I=[];if("children"in C){const N=C.children;let P=-1;for(;++P<N.length;){const H=E.one(N[P],C);if(H){if(P&&N[P-1].type==="break"&&(!Array.isArray(H)&&H.type==="text"&&(H.value=lq(H.value)),!Array.isArray(H)&&H.type==="element")){const x=H.children[0];x&&x.type==="text"&&(x.value=lq(x.value))}Array.isArray(H)?I.push(...H):I.push(H)}}}return I}}function FLe(i,r){i.position&&(r.position=Tke(i))}function jLe(i,r){let a=r;if(i&&i.data){const c=i.data.hName,l=i.data.hChildren,h=i.data.hProperties;if(typeof c=="string")if(a.type==="element")a.tagName=c;else{const m="children"in a?a.children:[a];a={type:"element",tagName:c,properties:{},children:m}}a.type==="element"&&h&&Object.assign(a.properties,pO(h)),"children"in a&&a.children&&l!==null&&l!==void 0&&(a.children=l)}return a}function BLe(i,r){const a=r.data||{},c="value"in r&&!(i2.call(a,"hProperties")||i2.call(a,"hChildren"))?{type:"text",value:r.value}:{type:"element",tagName:"div",properties:{},children:i.all(r)};return i.patch(r,c),i.applyData(r,c)}function WLe(i,r){const a=[];let c=-1;for(r&&a.push({type:"text",value:`
`});++c<i.length;)c&&a.push({type:"text",value:`
`}),a.push(i[c]);return r&&i.length>0&&a.push({type:"text",value:`
`}),a}function lq(i){let r=0,a=i.charCodeAt(r);for(;a===9||a===32;)r++,a=i.charCodeAt(r);return i.slice(r)}function uq(i,r){const a=VLe(i,r),c=a.one(i,void 0),l=ILe(a),h=Array.isArray(c)?{type:"root",children:c}:c||{type:"root",children:[]};return l&&h.children.push({type:"text",value:`
`},l),h}function GLe(i,r){return i&&"run"in i?async function(a,c){const l=uq(a,{file:c,...r});await i.run(l,c)}:function(a,c){return uq(a,{file:c,...i||r})}}function dq(i){if(i)throw i}var SL,hq;function HLe(){if(hq)return SL;hq=1;var i=Object.prototype.hasOwnProperty,r=Object.prototype.toString,a=Object.defineProperty,c=Object.getOwnPropertyDescriptor,l=function(T){return typeof Array.isArray=="function"?Array.isArray(T):r.call(T)==="[object Array]"},h=function(T){if(!T||r.call(T)!=="[object Object]")return!1;var C=i.call(T,"constructor"),I=T.constructor&&T.constructor.prototype&&i.call(T.constructor.prototype,"isPrototypeOf");if(T.constructor&&!C&&!I)return!1;var N;for(N in T);return typeof N>"u"||i.call(T,N)},m=function(T,C){a&&C.name==="__proto__"?a(T,C.name,{enumerable:!0,configurable:!0,value:C.newValue,writable:!0}):T[C.name]=C.newValue},E=function(T,C){if(C==="__proto__")if(i.call(T,C)){if(c)return c(T,C).value}else return;return T[C]};return SL=function S(){var T,C,I,N,P,H,x=arguments[0],B=1,X=arguments.length,Z=!1;for(typeof x=="boolean"&&(Z=x,x=arguments[1]||{},B=2),(x==null||typeof x!="object"&&typeof x!="function")&&(x={});B<X;++B)if(T=arguments[B],T!=null)for(C in T)I=E(x,C),N=E(T,C),x!==N&&(Z&&N&&(h(N)||(P=l(N)))?(P?(P=!1,H=I&&l(I)?I:[]):H=I&&h(I)?I:{},m(x,{name:C,newValue:S(Z,H,N)})):typeof N<"u"&&m(x,{name:C,newValue:N}));return x},SL}var zLe=HLe();const TL=gO(zLe);function s2(i){if(typeof i!="object"||i===null)return!1;const r=Object.getPrototypeOf(i);return(r===null||r===Object.prototype||Object.getPrototypeOf(r)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)}function KLe(){const i=[],r={run:a,use:c};return r;function a(...l){let h=-1;const m=l.pop();if(typeof m!="function")throw new TypeError("Expected function as last argument, not "+m);E(null,...l);function E(S,...T){const C=i[++h];let I=-1;if(S){m(S);return}for(;++I<l.length;)(T[I]===null||T[I]===void 0)&&(T[I]=l[I]);l=T,C?YLe(C,E)(...T):m(null,...T)}}function c(l){if(typeof l!="function")throw new TypeError("Expected `middelware` to be a function, not "+l);return i.push(l),r}}function YLe(i,r){let a;return c;function c(...m){const E=i.length>m.length;let S;E&&m.push(l);try{S=i.apply(this,m)}catch(T){const C=T;if(E&&a)throw C;return l(C)}E||(S&&S.then&&typeof S.then=="function"?S.then(h,l):S instanceof Error?l(S):h(S))}function l(m,...E){a||(a=!0,r(m,...E))}function h(m){l(null,m)}}const dd={basename:qLe,dirname:XLe,extname:JLe,join:$Le,sep:"/"};function qLe(i,r){if(r!==void 0&&typeof r!="string")throw new TypeError('"ext" argument must be a string');Kw(i);let a=0,c=-1,l=i.length,h;if(r===void 0||r.length===0||r.length>i.length){for(;l--;)if(i.codePointAt(l)===47){if(h){a=l+1;break}}else c<0&&(h=!0,c=l+1);return c<0?"":i.slice(a,c)}if(r===i)return"";let m=-1,E=r.length-1;for(;l--;)if(i.codePointAt(l)===47){if(h){a=l+1;break}}else m<0&&(h=!0,m=l+1),E>-1&&(i.codePointAt(l)===r.codePointAt(E--)?E<0&&(c=l):(E=-1,c=m));return a===c?c=m:c<0&&(c=i.length),i.slice(a,c)}function XLe(i){if(Kw(i),i.length===0)return".";let r=-1,a=i.length,c;for(;--a;)if(i.codePointAt(a)===47){if(c){r=a;break}}else c||(c=!0);return r<0?i.codePointAt(0)===47?"/":".":r===1&&i.codePointAt(0)===47?"//":i.slice(0,r)}function JLe(i){Kw(i);let r=i.length,a=-1,c=0,l=-1,h=0,m;for(;r--;){const E=i.codePointAt(r);if(E===47){if(m){c=r+1;break}continue}a<0&&(m=!0,a=r+1),E===46?l<0?l=r:h!==1&&(h=1):l>-1&&(h=-1)}return l<0||a<0||h===0||h===1&&l===a-1&&l===c+1?"":i.slice(l,a)}function $Le(...i){let r=-1,a;for(;++r<i.length;)Kw(i[r]),i[r]&&(a=a===void 0?i[r]:a+"/"+i[r]);return a===void 0?".":QLe(a)}function QLe(i){Kw(i);const r=i.codePointAt(0)===47;let a=ZLe(i,!r);return a.length===0&&!r&&(a="."),a.length>0&&i.codePointAt(i.length-1)===47&&(a+="/"),r?"/"+a:a}function ZLe(i,r){let a="",c=0,l=-1,h=0,m=-1,E,S;for(;++m<=i.length;){if(m<i.length)E=i.codePointAt(m);else{if(E===47)break;E=47}if(E===47){if(!(l===m-1||h===1))if(l!==m-1&&h===2){if(a.length<2||c!==2||a.codePointAt(a.length-1)!==46||a.codePointAt(a.length-2)!==46){if(a.length>2){if(S=a.lastIndexOf("/"),S!==a.length-1){S<0?(a="",c=0):(a=a.slice(0,S),c=a.length-1-a.lastIndexOf("/")),l=m,h=0;continue}}else if(a.length>0){a="",c=0,l=m,h=0;continue}}r&&(a=a.length>0?a+"/..":"..",c=2)}else a.length>0?a+="/"+i.slice(l+1,m):a=i.slice(l+1,m),c=m-l-1;l=m,h=0}else E===46&&h>-1?h++:h=-1}return a}function Kw(i){if(typeof i!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(i))}const eMe={cwd:tMe};function tMe(){return"/"}function a2(i){return!!(i!==null&&typeof i=="object"&&"href"in i&&i.href&&"protocol"in i&&i.protocol&&i.auth===void 0)}function nMe(i){if(typeof i=="string")i=new URL(i);else if(!a2(i)){const r=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+i+"`");throw r.code="ERR_INVALID_ARG_TYPE",r}if(i.protocol!=="file:"){const r=new TypeError("The URL must be of scheme file");throw r.code="ERR_INVALID_URL_SCHEME",r}return rMe(i)}function rMe(i){if(i.hostname!==""){const c=new TypeError('File URL host must be "localhost" or empty on darwin');throw c.code="ERR_INVALID_FILE_URL_HOST",c}const r=i.pathname;let a=-1;for(;++a<r.length;)if(r.codePointAt(a)===37&&r.codePointAt(a+1)===50){const c=r.codePointAt(a+2);if(c===70||c===102){const l=new TypeError("File URL path must not include encoded / characters");throw l.code="ERR_INVALID_FILE_URL_PATH",l}}return decodeURIComponent(r)}const wL=["history","path","basename","stem","extname","dirname"];class Ite{constructor(r){let a;r?a2(r)?a={path:r}:typeof r=="string"||iMe(r)?a={value:r}:a=r:a={},this.cwd="cwd"in a?"":eMe.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let c=-1;for(;++c<wL.length;){const h=wL[c];h in a&&a[h]!==void 0&&a[h]!==null&&(this[h]=h==="history"?[...a[h]]:a[h])}let l;for(l in a)wL.includes(l)||(this[l]=a[l])}get basename(){return typeof this.path=="string"?dd.basename(this.path):void 0}set basename(r){RL(r,"basename"),CL(r,"basename"),this.path=dd.join(this.dirname||"",r)}get dirname(){return typeof this.path=="string"?dd.dirname(this.path):void 0}set dirname(r){pq(this.basename,"dirname"),this.path=dd.join(r||"",this.basename)}get extname(){return typeof this.path=="string"?dd.extname(this.path):void 0}set extname(r){if(CL(r,"extname"),pq(this.dirname,"extname"),r){if(r.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(r.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=dd.join(this.dirname,this.stem+(r||""))}get path(){return this.history[this.history.length-1]}set path(r){a2(r)&&(r=nMe(r)),RL(r,"path"),this.path!==r&&this.history.push(r)}get stem(){return typeof this.path=="string"?dd.basename(this.path,this.extname):void 0}set stem(r){RL(r,"stem"),CL(r,"stem"),this.path=dd.join(this.dirname||"",r+(this.extname||""))}fail(r,a,c){const l=this.message(r,a,c);throw l.fatal=!0,l}info(r,a,c){const l=this.message(r,a,c);return l.fatal=void 0,l}message(r,a,c){const l=new Ma(r,a,c);return this.path&&(l.name=this.path+":"+l.name,l.file=this.path),l.fatal=!1,this.messages.push(l),l}toString(r){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(r||void 0).decode(this.value)}}function CL(i,r){if(i&&i.includes(dd.sep))throw new Error("`"+r+"` cannot be a path: did not expect `"+dd.sep+"`")}function RL(i,r){if(!i)throw new Error("`"+r+"` cannot be empty")}function pq(i,r){if(!i)throw new Error("Setting `"+r+"` requires `path` to be set too")}function iMe(i){return!!(i&&typeof i=="object"&&"byteLength"in i&&"byteOffset"in i)}const sMe=(function(i){const c=this.constructor.prototype,l=c[i],h=function(){return l.apply(h,arguments)};return Object.setPrototypeOf(h,c),h}),aMe={}.hasOwnProperty;class pV extends sMe{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=KLe()}copy(){const r=new pV;let a=-1;for(;++a<this.attachers.length;){const c=this.attachers[a];r.use(...c)}return r.data(TL(!0,{},this.namespace)),r}data(r,a){return typeof r=="string"?arguments.length===2?(AL("data",this.frozen),this.namespace[r]=a,this):aMe.call(this.namespace,r)&&this.namespace[r]||void 0:r?(AL("data",this.frozen),this.namespace=r,this):this.namespace}freeze(){if(this.frozen)return this;const r=this;for(;++this.freezeIndex<this.attachers.length;){const[a,...c]=this.attachers[this.freezeIndex];if(c[0]===!1)continue;c[0]===!0&&(c[0]=void 0);const l=a.call(r,...c);typeof l=="function"&&this.transformers.use(l)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(r){this.freeze();const a=rA(r),c=this.parser||this.Parser;return bL("parse",c),c(String(a),a)}process(r,a){const c=this;return this.freeze(),bL("process",this.parser||this.Parser),IL("process",this.compiler||this.Compiler),a?l(void 0,a):new Promise(l);function l(h,m){const E=rA(r),S=c.parse(E);c.run(S,E,function(C,I,N){if(C||!I||!N)return T(C);const P=I,H=c.stringify(P,N);lMe(H)?N.value=H:N.result=H,T(C,N)});function T(C,I){C||!I?m(C):h?h(I):a(void 0,I)}}}processSync(r){let a=!1,c;return this.freeze(),bL("processSync",this.parser||this.Parser),IL("processSync",this.compiler||this.Compiler),this.process(r,l),mq("processSync","process",a),c;function l(h,m){a=!0,dq(h),c=m}}run(r,a,c){fq(r),this.freeze();const l=this.transformers;return!c&&typeof a=="function"&&(c=a,a=void 0),c?h(void 0,c):new Promise(h);function h(m,E){const S=rA(a);l.run(r,S,T);function T(C,I,N){const P=I||r;C?E(C):m?m(P):c(void 0,P,N)}}}runSync(r,a){let c=!1,l;return this.run(r,a,h),mq("runSync","run",c),l;function h(m,E){dq(m),l=E,c=!0}}stringify(r,a){this.freeze();const c=rA(a),l=this.compiler||this.Compiler;return IL("stringify",l),fq(r),l(r,c)}use(r,...a){const c=this.attachers,l=this.namespace;if(AL("use",this.frozen),r!=null)if(typeof r=="function")S(r,a);else if(typeof r=="object")Array.isArray(r)?E(r):m(r);else throw new TypeError("Expected usable value, not `"+r+"`");return this;function h(T){if(typeof T=="function")S(T,[]);else if(typeof T=="object")if(Array.isArray(T)){const[C,...I]=T;S(C,I)}else m(T);else throw new TypeError("Expected usable value, not `"+T+"`")}function m(T){if(!("plugins"in T)&&!("settings"in T))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");E(T.plugins),T.settings&&(l.settings=TL(!0,l.settings,T.settings))}function E(T){let C=-1;if(T!=null)if(Array.isArray(T))for(;++C<T.length;){const I=T[C];h(I)}else throw new TypeError("Expected a list of plugins, not `"+T+"`")}function S(T,C){let I=-1,N=-1;for(;++I<c.length;)if(c[I][0]===T){N=I;break}if(N===-1)c.push([T,...C]);else if(C.length>0){let[P,...H]=C;const x=c[N][1];s2(x)&&s2(P)&&(P=TL(!0,x,P)),c[N]=[T,P,...H]}}}}const oMe=new pV().freeze();function bL(i,r){if(typeof r!="function")throw new TypeError("Cannot `"+i+"` without `parser`")}function IL(i,r){if(typeof r!="function")throw new TypeError("Cannot `"+i+"` without `compiler`")}function AL(i,r){if(r)throw new Error("Cannot call `"+i+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function fq(i){if(!s2(i)||typeof i.type!="string")throw new TypeError("Expected node, got `"+i+"`")}function mq(i,r,a){if(!a)throw new Error("`"+i+"` finished async. Use `"+r+"` instead")}function rA(i){return cMe(i)?i:new Ite(i)}function cMe(i){return!!(i&&typeof i=="object"&&"message"in i&&"messages"in i)}function lMe(i){return typeof i=="string"||uMe(i)}function uMe(i){return!!(i&&typeof i=="object"&&"byteLength"in i&&"byteOffset"in i)}const dMe="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",gq=[],_q={allowDangerousHtml:!0},hMe=/^(https?|ircs?|mailto|xmpp)$/i,pMe=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function fMe(i){const r=mMe(i),a=gMe(i);return _Me(r.runSync(r.parse(a),a),i)}function mMe(i){const r=i.rehypePlugins||gq,a=i.remarkPlugins||gq,c=i.remarkRehypeOptions?{...i.remarkRehypeOptions,..._q}:_q;return oMe().use(qxe).use(a).use(GLe,c).use(r)}function gMe(i){const r=i.children||"",a=new Ite;return typeof r=="string"&&(a.value=r),a}function _Me(i,r){const a=r.allowedElements,c=r.allowElement,l=r.components,h=r.disallowedElements,m=r.skipHtml,E=r.unwrapDisallowed,S=r.urlTransform||EMe;for(const C of pMe)Object.hasOwn(r,C.from)&&(""+C.from+(C.to?"use `"+C.to+"` instead":"remove it")+dMe+C.id,void 0);return bte(i,T),Ike(i,{Fragment:D.Fragment,components:l,ignoreInvalidStyle:!0,jsx:D.jsx,jsxs:D.jsxs,passKeys:!0,passNode:!0});function T(C,I,N){if(C.type==="raw"&&N&&typeof I=="number")return m?N.children.splice(I,1):N.children[I]={type:"text",value:C.value},I;if(C.type==="element"){let P;for(P in EL)if(Object.hasOwn(EL,P)&&Object.hasOwn(C.properties,P)){const H=C.properties[P],x=EL[P];(x===null||x.includes(C.tagName))&&(C.properties[P]=S(String(H||""),P,C))}}if(C.type==="element"){let P=a?!a.includes(C.tagName):h?h.includes(C.tagName):!1;if(!P&&c&&typeof I=="number"&&(P=!c(C,I,N)),P&&N&&typeof I=="number")return E&&C.children?N.children.splice(I,1,...C.children):N.children.splice(I,1),I}}}function EMe(i){const r=i.indexOf(":"),a=i.indexOf("?"),c=i.indexOf("#"),l=i.indexOf("/");return r===-1||l!==-1&&r>l||a!==-1&&r>a||c!==-1&&r>c||hMe.test(i.slice(0,r))?i:""}var OL="focusScope.autoFocusOnMount",NL="focusScope.autoFocusOnUnmount",Eq={bubbles:!1,cancelable:!0},yMe="FocusScope",Ate=G.forwardRef((i,r)=>{const{loop:a=!1,trapped:c=!1,onMountAutoFocus:l,onUnmountAutoFocus:h,...m}=i,[E,S]=G.useState(null),T=lu(l),C=lu(h),I=G.useRef(null),N=Xs(r,x=>S(x)),P=G.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;G.useEffect(()=>{if(c){let x=function($){if(P.paused||!E)return;const le=$.target;E.contains(le)?I.current=le:Hp(I.current,{select:!0})},B=function($){if(P.paused||!E)return;const le=$.relatedTarget;le!==null&&(E.contains(le)||Hp(I.current,{select:!0}))},X=function($){if(document.activeElement===document.body)for(const re of $)re.removedNodes.length>0&&Hp(E)};document.addEventListener("focusin",x),document.addEventListener("focusout",B);const Z=new MutationObserver(X);return E&&Z.observe(E,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",x),document.removeEventListener("focusout",B),Z.disconnect()}}},[c,E,P.paused]),G.useEffect(()=>{if(E){vq.add(P);const x=document.activeElement;if(!E.contains(x)){const X=new CustomEvent(OL,Eq);E.addEventListener(OL,T),E.dispatchEvent(X),X.defaultPrevented||(vMe(RMe(Ote(E)),{select:!0}),document.activeElement===x&&Hp(E))}return()=>{E.removeEventListener(OL,T),setTimeout(()=>{const X=new CustomEvent(NL,Eq);E.addEventListener(NL,C),E.dispatchEvent(X),X.defaultPrevented||Hp(x??document.body,{select:!0}),E.removeEventListener(NL,C),vq.remove(P)},0)}}},[E,T,C,P]);const H=G.useCallback(x=>{if(!a&&!c||P.paused)return;const B=x.key==="Tab"&&!x.altKey&&!x.ctrlKey&&!x.metaKey,X=document.activeElement;if(B&&X){const Z=x.currentTarget,[$,le]=SMe(Z);$&&le?!x.shiftKey&&X===le?(x.preventDefault(),a&&Hp($,{select:!0})):x.shiftKey&&X===$&&(x.preventDefault(),a&&Hp(le,{select:!0})):X===Z&&x.preventDefault()}},[a,c,P.paused]);return D.jsx(ri.div,{tabIndex:-1,...m,ref:N,onKeyDown:H})});Ate.displayName=yMe;function vMe(i,{select:r=!1}={}){const a=document.activeElement;for(const c of i)if(Hp(c,{select:r}),document.activeElement!==a)return}function SMe(i){const r=Ote(i),a=yq(r,i),c=yq(r.reverse(),i);return[a,c]}function Ote(i){const r=[],a=document.createTreeWalker(i,NodeFilter.SHOW_ELEMENT,{acceptNode:c=>{const l=c.tagName==="INPUT"&&c.type==="hidden";return c.disabled||c.hidden||l?NodeFilter.FILTER_SKIP:c.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;a.nextNode();)r.push(a.currentNode);return r}function yq(i,r){for(const a of i)if(!TMe(a,{upTo:r}))return a}function TMe(i,{upTo:r}){if(getComputedStyle(i).visibility==="hidden")return!0;for(;i;){if(r!==void 0&&i===r)return!1;if(getComputedStyle(i).display==="none")return!0;i=i.parentElement}return!1}function wMe(i){return i instanceof HTMLInputElement&&"select"in i}function Hp(i,{select:r=!1}={}){if(i&&i.focus){const a=document.activeElement;i.focus({preventScroll:!0}),i!==a&&wMe(i)&&r&&i.select()}}var vq=CMe();function CMe(){let i=[];return{add(r){const a=i[0];r!==a&&a?.pause(),i=Sq(i,r),i.unshift(r)},remove(r){i=Sq(i,r),i[0]?.resume()}}}function Sq(i,r){const a=[...i],c=a.indexOf(r);return c!==-1&&a.splice(c,1),a}function RMe(i){return i.filter(r=>r.tagName!=="A")}var PL=0;function bMe(){G.useEffect(()=>{const i=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",i[0]??Tq()),document.body.insertAdjacentElement("beforeend",i[1]??Tq()),PL++,()=>{PL===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(r=>r.remove()),PL--}},[])}function Tq(){const i=document.createElement("span");return i.setAttribute("data-radix-focus-guard",""),i.tabIndex=0,i.style.outline="none",i.style.opacity="0",i.style.position="fixed",i.style.pointerEvents="none",i}var md=function(){return md=Object.assign||function(r){for(var a,c=1,l=arguments.length;c<l;c++){a=arguments[c];for(var h in a)Object.prototype.hasOwnProperty.call(a,h)&&(r[h]=a[h])}return r},md.apply(this,arguments)};function Nte(i,r){var a={};for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&r.indexOf(c)<0&&(a[c]=i[c]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,c=Object.getOwnPropertySymbols(i);l<c.length;l++)r.indexOf(c[l])<0&&Object.prototype.propertyIsEnumerable.call(i,c[l])&&(a[c[l]]=i[c[l]]);return a}function IMe(i,r,a){if(a||arguments.length===2)for(var c=0,l=r.length,h;c<l;c++)(h||!(c in r))&&(h||(h=Array.prototype.slice.call(r,0,c)),h[c]=r[c]);return i.concat(h||Array.prototype.slice.call(r))}var bA="right-scroll-bar-position",IA="width-before-scroll-bar",AMe="with-scroll-bars-hidden",OMe="--removed-body-scroll-bar-size";function kL(i,r){return typeof i=="function"?i(r):i&&(i.current=r),i}function NMe(i,r){var a=G.useState(function(){return{value:i,callback:r,facade:{get current(){return a.value},set current(c){var l=a.value;l!==c&&(a.value=c,a.callback(c,l))}}}})[0];return a.callback=r,a.facade}var PMe=typeof window<"u"?G.useLayoutEffect:G.useEffect,wq=new WeakMap;function kMe(i,r){var a=NMe(null,function(c){return i.forEach(function(l){return kL(l,c)})});return PMe(function(){var c=wq.get(a);if(c){var l=new Set(c),h=new Set(i),m=a.current;l.forEach(function(E){h.has(E)||kL(E,null)}),h.forEach(function(E){l.has(E)||kL(E,m)})}wq.set(a,i)},[i]),a}function DMe(i){return i}function xMe(i,r){r===void 0&&(r=DMe);var a=[],c=!1,l={read:function(){if(c)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return a.length?a[a.length-1]:i},useMedium:function(h){var m=r(h,c);return a.push(m),function(){a=a.filter(function(E){return E!==m})}},assignSyncMedium:function(h){for(c=!0;a.length;){var m=a;a=[],m.forEach(h)}a={push:function(E){return h(E)},filter:function(){return a}}},assignMedium:function(h){c=!0;var m=[];if(a.length){var E=a;a=[],E.forEach(h),m=a}var S=function(){var C=m;m=[],C.forEach(h)},T=function(){return Promise.resolve().then(S)};T(),a={push:function(C){m.push(C),T()},filter:function(C){return m=m.filter(C),a}}}};return l}function LMe(i){i===void 0&&(i={});var r=xMe(null);return r.options=md({async:!0,ssr:!1},i),r}var Pte=function(i){var r=i.sideCar,a=Nte(i,["sideCar"]);if(!r)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var c=r.read();if(!c)throw new Error("Sidecar medium not found");return G.createElement(c,md({},a))};Pte.isSideCarExport=!0;function MMe(i,r){return i.useMedium(r),Pte}var kte=LMe(),DL=function(){},XO=G.forwardRef(function(i,r){var a=G.useRef(null),c=G.useState({onScrollCapture:DL,onWheelCapture:DL,onTouchMoveCapture:DL}),l=c[0],h=c[1],m=i.forwardProps,E=i.children,S=i.className,T=i.removeScrollBar,C=i.enabled,I=i.shards,N=i.sideCar,P=i.noRelative,H=i.noIsolation,x=i.inert,B=i.allowPinchZoom,X=i.as,Z=X===void 0?"div":X,$=i.gapMode,le=Nte(i,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),re=N,ce=kMe([a,r]),te=md(md({},le),l);return G.createElement(G.Fragment,null,C&&G.createElement(re,{sideCar:kte,removeScrollBar:T,shards:I,noRelative:P,noIsolation:H,inert:x,setCallbacks:h,allowPinchZoom:!!B,lockRef:a,gapMode:$}),m?G.cloneElement(G.Children.only(E),md(md({},te),{ref:ce})):G.createElement(Z,md({},te,{className:S,ref:ce}),E))});XO.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};XO.classNames={fullWidth:IA,zeroRight:bA};var UMe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function VMe(){if(!document)return null;var i=document.createElement("style");i.type="text/css";var r=UMe();return r&&i.setAttribute("nonce",r),i}function FMe(i,r){i.styleSheet?i.styleSheet.cssText=r:i.appendChild(document.createTextNode(r))}function jMe(i){var r=document.head||document.getElementsByTagName("head")[0];r.appendChild(i)}var BMe=function(){var i=0,r=null;return{add:function(a){i==0&&(r=VMe())&&(FMe(r,a),jMe(r)),i++},remove:function(){i--,!i&&r&&(r.parentNode&&r.parentNode.removeChild(r),r=null)}}},WMe=function(){var i=BMe();return function(r,a){G.useEffect(function(){return i.add(r),function(){i.remove()}},[r&&a])}},Dte=function(){var i=WMe(),r=function(a){var c=a.styles,l=a.dynamic;return i(c,l),null};return r},GMe={left:0,top:0,right:0,gap:0},xL=function(i){return parseInt(i||"",10)||0},HMe=function(i){var r=window.getComputedStyle(document.body),a=r[i==="padding"?"paddingLeft":"marginLeft"],c=r[i==="padding"?"paddingTop":"marginTop"],l=r[i==="padding"?"paddingRight":"marginRight"];return[xL(a),xL(c),xL(l)]},zMe=function(i){if(i===void 0&&(i="margin"),typeof window>"u")return GMe;var r=HMe(i),a=document.documentElement.clientWidth,c=window.innerWidth;return{left:r[0],top:r[1],right:r[2],gap:Math.max(0,c-a+r[2]-r[0])}},KMe=Dte(),Gy="data-scroll-locked",YMe=function(i,r,a,c){var l=i.left,h=i.top,m=i.right,E=i.gap;return a===void 0&&(a="margin"),`
  .`.concat(AMe,` {
   overflow: hidden `).concat(c,`;
   padding-right: `).concat(E,"px ").concat(c,`;
  }
  body[`).concat(Gy,`] {
    overflow: hidden `).concat(c,`;
    overscroll-behavior: contain;
    `).concat([r&&"position: relative ".concat(c,";"),a==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(h,`px;
    padding-right: `).concat(m,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(E,"px ").concat(c,`;
    `),a==="padding"&&"padding-right: ".concat(E,"px ").concat(c,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(bA,` {
    right: `).concat(E,"px ").concat(c,`;
  }
  
  .`).concat(IA,` {
    margin-right: `).concat(E,"px ").concat(c,`;
  }
  
  .`).concat(bA," .").concat(bA,` {
    right: 0 `).concat(c,`;
  }
  
  .`).concat(IA," .").concat(IA,` {
    margin-right: 0 `).concat(c,`;
  }
  
  body[`).concat(Gy,`] {
    `).concat(OMe,": ").concat(E,`px;
  }
`)},Cq=function(){var i=parseInt(document.body.getAttribute(Gy)||"0",10);return isFinite(i)?i:0},qMe=function(){G.useEffect(function(){return document.body.setAttribute(Gy,(Cq()+1).toString()),function(){var i=Cq()-1;i<=0?document.body.removeAttribute(Gy):document.body.setAttribute(Gy,i.toString())}},[])},XMe=function(i){var r=i.noRelative,a=i.noImportant,c=i.gapMode,l=c===void 0?"margin":c;qMe();var h=G.useMemo(function(){return zMe(l)},[l]);return G.createElement(KMe,{styles:YMe(h,!r,l,a?"":"!important")})},o2=!1;if(typeof window<"u")try{var iA=Object.defineProperty({},"passive",{get:function(){return o2=!0,!0}});window.addEventListener("test",iA,iA),window.removeEventListener("test",iA,iA)}catch{o2=!1}var fy=o2?{passive:!1}:!1,JMe=function(i){return i.tagName==="TEXTAREA"},xte=function(i,r){if(!(i instanceof Element))return!1;var a=window.getComputedStyle(i);return a[r]!=="hidden"&&!(a.overflowY===a.overflowX&&!JMe(i)&&a[r]==="visible")},$Me=function(i){return xte(i,"overflowY")},QMe=function(i){return xte(i,"overflowX")},Rq=function(i,r){var a=r.ownerDocument,c=r;do{typeof ShadowRoot<"u"&&c instanceof ShadowRoot&&(c=c.host);var l=Lte(i,c);if(l){var h=Mte(i,c),m=h[1],E=h[2];if(m>E)return!0}c=c.parentNode}while(c&&c!==a.body);return!1},ZMe=function(i){var r=i.scrollTop,a=i.scrollHeight,c=i.clientHeight;return[r,a,c]},e2e=function(i){var r=i.scrollLeft,a=i.scrollWidth,c=i.clientWidth;return[r,a,c]},Lte=function(i,r){return i==="v"?$Me(r):QMe(r)},Mte=function(i,r){return i==="v"?ZMe(r):e2e(r)},t2e=function(i,r){return i==="h"&&r==="rtl"?-1:1},n2e=function(i,r,a,c,l){var h=t2e(i,window.getComputedStyle(r).direction),m=h*c,E=a.target,S=r.contains(E),T=!1,C=m>0,I=0,N=0;do{if(!E)break;var P=Mte(i,E),H=P[0],x=P[1],B=P[2],X=x-B-h*H;(H||X)&&Lte(i,E)&&(I+=X,N+=H);var Z=E.parentNode;E=Z&&Z.nodeType===Node.DOCUMENT_FRAGMENT_NODE?Z.host:Z}while(!S&&E!==document.body||S&&(r.contains(E)||r===E));return(C&&Math.abs(I)<1||!C&&Math.abs(N)<1)&&(T=!0),T},sA=function(i){return"changedTouches"in i?[i.changedTouches[0].clientX,i.changedTouches[0].clientY]:[0,0]},bq=function(i){return[i.deltaX,i.deltaY]},Iq=function(i){return i&&"current"in i?i.current:i},r2e=function(i,r){return i[0]===r[0]&&i[1]===r[1]},i2e=function(i){return`
  .block-interactivity-`.concat(i,` {pointer-events: none;}
  .allow-interactivity-`).concat(i,` {pointer-events: all;}
`)},s2e=0,my=[];function a2e(i){var r=G.useRef([]),a=G.useRef([0,0]),c=G.useRef(),l=G.useState(s2e++)[0],h=G.useState(Dte)[0],m=G.useRef(i);G.useEffect(function(){m.current=i},[i]),G.useEffect(function(){if(i.inert){document.body.classList.add("block-interactivity-".concat(l));var x=IMe([i.lockRef.current],(i.shards||[]).map(Iq),!0).filter(Boolean);return x.forEach(function(B){return B.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),x.forEach(function(B){return B.classList.remove("allow-interactivity-".concat(l))})}}},[i.inert,i.lockRef.current,i.shards]);var E=G.useCallback(function(x,B){if("touches"in x&&x.touches.length===2||x.type==="wheel"&&x.ctrlKey)return!m.current.allowPinchZoom;var X=sA(x),Z=a.current,$="deltaX"in x?x.deltaX:Z[0]-X[0],le="deltaY"in x?x.deltaY:Z[1]-X[1],re,ce=x.target,te=Math.abs($)>Math.abs(le)?"h":"v";if("touches"in x&&te==="h"&&ce.type==="range")return!1;var pe=Rq(te,ce);if(!pe)return!0;if(pe?re=te:(re=te==="v"?"h":"v",pe=Rq(te,ce)),!pe)return!1;if(!c.current&&"changedTouches"in x&&($||le)&&(c.current=re),!re)return!0;var Ee=c.current||re;return n2e(Ee,B,x,Ee==="h"?$:le)},[]),S=G.useCallback(function(x){var B=x;if(!(!my.length||my[my.length-1]!==h)){var X="deltaY"in B?bq(B):sA(B),Z=r.current.filter(function(re){return re.name===B.type&&(re.target===B.target||B.target===re.shadowParent)&&r2e(re.delta,X)})[0];if(Z&&Z.should){B.cancelable&&B.preventDefault();return}if(!Z){var $=(m.current.shards||[]).map(Iq).filter(Boolean).filter(function(re){return re.contains(B.target)}),le=$.length>0?E(B,$[0]):!m.current.noIsolation;le&&B.cancelable&&B.preventDefault()}}},[]),T=G.useCallback(function(x,B,X,Z){var $={name:x,delta:B,target:X,should:Z,shadowParent:o2e(X)};r.current.push($),setTimeout(function(){r.current=r.current.filter(function(le){return le!==$})},1)},[]),C=G.useCallback(function(x){a.current=sA(x),c.current=void 0},[]),I=G.useCallback(function(x){T(x.type,bq(x),x.target,E(x,i.lockRef.current))},[]),N=G.useCallback(function(x){T(x.type,sA(x),x.target,E(x,i.lockRef.current))},[]);G.useEffect(function(){return my.push(h),i.setCallbacks({onScrollCapture:I,onWheelCapture:I,onTouchMoveCapture:N}),document.addEventListener("wheel",S,fy),document.addEventListener("touchmove",S,fy),document.addEventListener("touchstart",C,fy),function(){my=my.filter(function(x){return x!==h}),document.removeEventListener("wheel",S,fy),document.removeEventListener("touchmove",S,fy),document.removeEventListener("touchstart",C,fy)}},[]);var P=i.removeScrollBar,H=i.inert;return G.createElement(G.Fragment,null,H?G.createElement(h,{styles:i2e(l)}):null,P?G.createElement(XMe,{noRelative:i.noRelative,gapMode:i.gapMode}):null)}function o2e(i){for(var r=null;i!==null;)i instanceof ShadowRoot&&(r=i.host,i=i.host),i=i.parentNode;return r}const c2e=MMe(kte,a2e);var Ute=G.forwardRef(function(i,r){return G.createElement(XO,md({},i,{ref:r,sideCar:c2e}))});Ute.classNames=XO.classNames;var l2e=function(i){if(typeof document>"u")return null;var r=Array.isArray(i)?i[0]:i;return r.ownerDocument.body},gy=new WeakMap,aA=new WeakMap,oA={},LL=0,Vte=function(i){return i&&(i.host||Vte(i.parentNode))},u2e=function(i,r){return r.map(function(a){if(i.contains(a))return a;var c=Vte(a);return c&&i.contains(c)?c:(console.error("aria-hidden",a,"in not contained inside",i,". Doing nothing"),null)}).filter(function(a){return!!a})},d2e=function(i,r,a,c){var l=u2e(r,Array.isArray(i)?i:[i]);oA[a]||(oA[a]=new WeakMap);var h=oA[a],m=[],E=new Set,S=new Set(l),T=function(I){!I||E.has(I)||(E.add(I),T(I.parentNode))};l.forEach(T);var C=function(I){!I||S.has(I)||Array.prototype.forEach.call(I.children,function(N){if(E.has(N))C(N);else try{var P=N.getAttribute(c),H=P!==null&&P!=="false",x=(gy.get(N)||0)+1,B=(h.get(N)||0)+1;gy.set(N,x),h.set(N,B),m.push(N),x===1&&H&&aA.set(N,!0),B===1&&N.setAttribute(a,"true"),H||N.setAttribute(c,"true")}catch(X){console.error("aria-hidden: cannot operate on ",N,X)}})};return C(r),E.clear(),LL++,function(){m.forEach(function(I){var N=gy.get(I)-1,P=h.get(I)-1;gy.set(I,N),h.set(I,P),N||(aA.has(I)||I.removeAttribute(c),aA.delete(I)),P||I.removeAttribute(a)}),LL--,LL||(gy=new WeakMap,gy=new WeakMap,aA=new WeakMap,oA={})}},h2e=function(i,r,a){a===void 0&&(a="data-aria-hidden");var c=Array.from(Array.isArray(i)?i:[i]),l=l2e(i);return l?(c.push.apply(c,Array.from(l.querySelectorAll("[aria-live]"))),d2e(c,l,a,"aria-hidden")):function(){return null}},JO="Dialog",[Fte]=mf(JO),[p2e,pu]=Fte(JO),jte=i=>{const{__scopeDialog:r,children:a,open:c,defaultOpen:l,onOpenChange:h,modal:m=!0}=i,E=G.useRef(null),S=G.useRef(null),[T,C]=Nw({prop:c,defaultProp:l??!1,onChange:h,caller:JO});return D.jsx(p2e,{scope:r,triggerRef:E,contentRef:S,contentId:F0(),titleId:F0(),descriptionId:F0(),open:T,onOpenChange:C,onOpenToggle:G.useCallback(()=>C(I=>!I),[C]),modal:m,children:a})};jte.displayName=JO;var Bte="DialogTrigger",Wte=G.forwardRef((i,r)=>{const{__scopeDialog:a,...c}=i,l=pu(Bte,a),h=Xs(r,l.triggerRef);return D.jsx(ri.button,{type:"button","aria-haspopup":"dialog","aria-expanded":l.open,"aria-controls":l.contentId,"data-state":gV(l.open),...c,ref:h,onClick:vr(i.onClick,l.onOpenToggle)})});Wte.displayName=Bte;var fV="DialogPortal",[f2e,Gte]=Fte(fV,{forceMount:void 0}),Hte=i=>{const{__scopeDialog:r,forceMount:a,children:c,container:l}=i,h=pu(fV,r);return D.jsx(f2e,{scope:r,forceMount:a,children:G.Children.map(c,m=>D.jsx(Fg,{present:a||h.open,children:D.jsx(p2,{asChild:!0,container:l,children:m})}))})};Hte.displayName=fV;var fO="DialogOverlay",zte=G.forwardRef((i,r)=>{const a=Gte(fO,i.__scopeDialog),{forceMount:c=a.forceMount,...l}=i,h=pu(fO,i.__scopeDialog);return h.modal?D.jsx(Fg,{present:c||h.open,children:D.jsx(g2e,{...l,ref:r})}):null});zte.displayName=fO;var m2e=nw("DialogOverlay.RemoveScroll"),g2e=G.forwardRef((i,r)=>{const{__scopeDialog:a,...c}=i,l=pu(fO,a);return D.jsx(Ute,{as:m2e,allowPinchZoom:!0,shards:[l.contentRef],children:D.jsx(ri.div,{"data-state":gV(l.open),...c,ref:r,style:{pointerEvents:"auto",...c.style}})})}),Vg="DialogContent",Kte=G.forwardRef((i,r)=>{const a=Gte(Vg,i.__scopeDialog),{forceMount:c=a.forceMount,...l}=i,h=pu(Vg,i.__scopeDialog);return D.jsx(Fg,{present:c||h.open,children:h.modal?D.jsx(_2e,{...l,ref:r}):D.jsx(E2e,{...l,ref:r})})});Kte.displayName=Vg;var _2e=G.forwardRef((i,r)=>{const a=pu(Vg,i.__scopeDialog),c=G.useRef(null),l=Xs(r,a.contentRef,c);return G.useEffect(()=>{const h=c.current;if(h)return h2e(h)},[]),D.jsx(Yte,{...i,ref:l,trapFocus:a.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:vr(i.onCloseAutoFocus,h=>{h.preventDefault(),a.triggerRef.current?.focus()}),onPointerDownOutside:vr(i.onPointerDownOutside,h=>{const m=h.detail.originalEvent,E=m.button===0&&m.ctrlKey===!0;(m.button===2||E)&&h.preventDefault()}),onFocusOutside:vr(i.onFocusOutside,h=>h.preventDefault())})}),E2e=G.forwardRef((i,r)=>{const a=pu(Vg,i.__scopeDialog),c=G.useRef(!1),l=G.useRef(!1);return D.jsx(Yte,{...i,ref:r,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:h=>{i.onCloseAutoFocus?.(h),h.defaultPrevented||(c.current||a.triggerRef.current?.focus(),h.preventDefault()),c.current=!1,l.current=!1},onInteractOutside:h=>{i.onInteractOutside?.(h),h.defaultPrevented||(c.current=!0,h.detail.originalEvent.type==="pointerdown"&&(l.current=!0));const m=h.target;a.triggerRef.current?.contains(m)&&h.preventDefault(),h.detail.originalEvent.type==="focusin"&&l.current&&h.preventDefault()}})}),Yte=G.forwardRef((i,r)=>{const{__scopeDialog:a,trapFocus:c,onOpenAutoFocus:l,onCloseAutoFocus:h,...m}=i,E=pu(Vg,a),S=G.useRef(null),T=Xs(r,S);return bMe(),D.jsxs(D.Fragment,{children:[D.jsx(Ate,{asChild:!0,loop:!0,trapped:c,onMountAutoFocus:l,onUnmountAutoFocus:h,children:D.jsx(_O,{role:"dialog",id:E.contentId,"aria-describedby":E.descriptionId,"aria-labelledby":E.titleId,"data-state":gV(E.open),...m,ref:T,onDismiss:()=>E.onOpenChange(!1)})}),D.jsxs(D.Fragment,{children:[D.jsx(y2e,{titleId:E.titleId}),D.jsx(S2e,{contentRef:S,descriptionId:E.descriptionId})]})]})}),mV="DialogTitle",qte=G.forwardRef((i,r)=>{const{__scopeDialog:a,...c}=i,l=pu(mV,a);return D.jsx(ri.h2,{id:l.titleId,...c,ref:r})});qte.displayName=mV;var Xte="DialogDescription",Jte=G.forwardRef((i,r)=>{const{__scopeDialog:a,...c}=i,l=pu(Xte,a);return D.jsx(ri.p,{id:l.descriptionId,...c,ref:r})});Jte.displayName=Xte;var $te="DialogClose",Qte=G.forwardRef((i,r)=>{const{__scopeDialog:a,...c}=i,l=pu($te,a);return D.jsx(ri.button,{type:"button",...c,ref:r,onClick:vr(i.onClick,()=>l.onOpenChange(!1))})});Qte.displayName=$te;function gV(i){return i?"open":"closed"}var Zte="DialogTitleWarning",[$Ue,ene]=hme(Zte,{contentName:Vg,titleName:mV,docsSlug:"dialog"}),y2e=({titleId:i})=>{const r=ene(Zte),a=`\`${r.contentName}\` requires a \`${r.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${r.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${r.docsSlug}`;return G.useEffect(()=>{i&&(document.getElementById(i)||console.error(a))},[a,i]),null},v2e="DialogDescriptionWarning",S2e=({contentRef:i,descriptionId:r})=>{const c=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${ene(v2e).contentName}}.`;return G.useEffect(()=>{const l=i.current?.getAttribute("aria-describedby");r&&l&&(document.getElementById(r)||console.warn(c))},[c,i,r]),null},tne=jte,T2e=Wte,nne=Hte,$O=zte,QO=Kte,ZO=qte,eN=Jte,rne=Qte;const w2e=tne,C2e=T2e,R2e=nne,ine=G.forwardRef(({className:i,...r},a)=>D.jsx($O,{className:Br("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",i),...r,ref:a}));ine.displayName=$O.displayName;const b2e=_2("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),sne=G.forwardRef(({side:i="right",className:r,children:a,...c},l)=>D.jsxs(R2e,{children:[D.jsx(ine,{}),D.jsxs(QO,{ref:l,className:Br(b2e({side:i}),r),...c,children:[a,D.jsxs(rne,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-secondary hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[D.jsx(TO,{className:"h-4 w-4"}),D.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));sne.displayName=QO.displayName;const I2e=G.forwardRef(({className:i,...r},a)=>D.jsx(ZO,{ref:a,className:Br("text-lg font-semibold text-foreground",i),...r}));I2e.displayName=ZO.displayName;const A2e=G.forwardRef(({className:i,...r},a)=>D.jsx(eN,{ref:a,className:Br("text-sm text-muted-foreground",i),...r}));A2e.displayName=eN.displayName;const O2e=()=>Math.random().toString(36).substring(2,9)+Date.now().toString(36),Aq=()=>{const[i,r]=G.useState([]),[a,c]=G.useState(null),[l,h]=G.useState([]),[m,E]=G.useState(""),[S,T]=G.useState(!1),C=G.useRef(!1),I=G.useRef(null);G.useEffect(()=>{const re=localStorage.getItem("aitutor-conversations");re&&r(JSON.parse(re))},[]),G.useEffect(()=>{localStorage.setItem("aitutor-conversations",JSON.stringify(i))},[i]),G.useEffect(()=>{if(a){if(C.current){C.current=!1;return}const re=localStorage.getItem(`aitutor-messages-${a}`);h(re?JSON.parse(re):[])}else l.length>0&&h([])},[a]);const N=(re,ce)=>{localStorage.setItem(`aitutor-messages-${re}`,JSON.stringify(ce))},P=()=>{c(null),h([]),E("")},H=(re,ce)=>{re.stopPropagation();const te=i.filter(pe=>pe.id!==ce);r(te),localStorage.removeItem(`aitutor-messages-${ce}`),a===ce&&P()},x=re=>{c(re)},B=()=>{I.current?.scrollIntoView({behavior:"smooth"})};G.useEffect(()=>{B()},[l,S]);const X=async(re,ce,te)=>{T(!0);try{const Ee=await fetch("https://kle-token-server-2n1o.onrender.com",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:re,history:te.slice(0,-1).map(Ue=>({role:Ue.role==="user"?"user":"model",parts:[{text:Ue.content}]}))})});if(!Ee.ok)throw new Error(`Server responded with ${Ee.status}`);const Ne=await Ee.json();h(Ue=>[...Ue,{role:"assistant",content:Ne.reply,timestamp:Date.now()}])}catch(pe){console.error("BACKEND CALL ERROR:",pe);let Ee=`**AI Connection Error**

Unable to reach the AI server at https://kle-token-server-2n1o.onrender.com. 

${pe.message}`;h(Ne=>[...Ne,{role:"assistant",content:Ee,timestamp:Date.now()}])}finally{T(!1),h(pe=>(N(ce,pe),pe))}},Z=async()=>{if(console.log("handleSend triggered with input:",m),!m.trim()||S)return;const re=m.trim(),ce=Date.now();let te=a;if(!te){te=O2e(),C.current=!0;const Ne={id:te,title:re.slice(0,30)+(re.length>30?"...":""),createdAt:ce};r(Ue=>[Ne,...Ue]),c(te)}const pe={role:"user",content:re,timestamp:ce},Ee=[...l,pe];h(Ee),E(""),N(te,Ee),await X(re,te,Ee)},$=["Explain Binary Search Trees","What is Big O notation?","Generate a study plan for DBMS","Quiz me on Operating Systems"],le=()=>D.jsxs("div",{className:"flex flex-col h-full bg-card/30 backdrop-blur-xl border-r border-border/50",children:[D.jsx("div",{className:"p-4",children:D.jsxs(nr,{onClick:P,className:"w-full justify-start gap-2 bg-primary/10 hover:bg-primary/20 text-primary border border-primary/20",variant:"ghost",children:[D.jsx(fX,{className:"w-4 h-4"}),"New Chat"]})}),D.jsxs("div",{className:"flex-1 overflow-y-auto px-2 space-y-1 custom-scrollbar",children:[i.length===0&&D.jsx("div",{className:"text-center text-xs text-muted-foreground p-4",children:"No history yet."}),i.map(re=>D.jsxs("div",{onClick:()=>x(re.id),className:Br("group flex items-center gap-3 p-3 rounded-xl cursor-pointer transition-all hover:bg-muted/50 text-sm",a===re.id?"bg-muted font-medium text-foreground":"text-muted-foreground"),children:[D.jsx(dX,{className:"w-4 h-4 shrink-0"}),D.jsx("span",{className:"truncate flex-1 text-left",children:re.title}),D.jsx("button",{onClick:ce=>H(ce,re.id),className:"opacity-0 group-hover:opacity-100 hover:text-destructive transition-opacity p-1",children:D.jsx(Lge,{className:"w-3 h-3"})})]},re.id))]})]});return D.jsx(Sc,{children:D.jsxs("div",{className:"flex h-[calc(100vh-140px)] gap-4 overflow-hidden",children:[D.jsx("div",{className:"hidden md:block w-64 glass rounded-2xl overflow-hidden shrink-0",children:D.jsx(le,{})}),D.jsx("div",{className:"md:hidden absolute top-24 left-4 z-50",children:D.jsxs(w2e,{children:[D.jsx(C2e,{asChild:!0,children:D.jsx(nr,{variant:"outline",size:"icon",className:"glass",children:D.jsx(bge,{className:"w-4 h-4"})})}),D.jsx(sne,{side:"left",className:"p-0 w-72 pt-10",children:D.jsx(le,{})})]})}),D.jsxs("div",{className:"flex-1 flex flex-col glass rounded-2xl relative overflow-hidden",children:[D.jsx("div",{className:"p-4 md:p-6 pb-2 md:pb-6",children:D.jsx(hu,{icon:Ay,title:"AI TUTOR",subtitle:"Your personal 24/7 study companion",gradient:"linear-gradient(135deg, hsl(263 70% 58% / 0.3), hsl(263 70% 58% / 0.1))"})}),D.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[!a&&l.length===0?D.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center p-8 opacity-80",children:[D.jsx("div",{className:"w-20 h-20 rounded-3xl bg-primary/10 flex items-center justify-center mb-6 animate-pulse",children:D.jsx(kge,{className:"w-10 h-10 text-primary"})}),D.jsx("h3",{className:"text-xl font-bold font-display mb-2",children:"Hello, Student! "}),D.jsx("p",{className:"text-muted-foreground max-w-sm mb-8",children:"I'm here to help you ace your exams. Ask me about concepts, code, or request a quick quiz!"}),D.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 w-full max-w-lg",children:$.map(re=>D.jsx("button",{onClick:()=>{E(re)},className:"text-sm p-3 rounded-xl bg-muted/50 hover:bg-primary/10 hover:border-primary/30 border border-transparent transition-all text-left truncate",children:re},re))})]}):D.jsx(D.Fragment,{children:l.map((re,ce)=>{const te=re.role==="user",pe=!te&&ce===l.length-1;return D.jsx(Xn.div,{initial:{opacity:0,y:10,scale:.98},animate:{opacity:1,y:0,scale:1},className:Br("flex w-full mb-4",te?"justify-end":"justify-start"),children:D.jsxs("div",{className:Br("flex gap-3 max-w-[85%] md:max-w-[75%]",te?"flex-row-reverse":"flex-row"),children:[D.jsx("div",{className:Br("min-w-8 w-8 h-8 rounded-full flex items-center justify-center mt-1 border shrink-0 shadow-sm",te?"bg-primary/20 border-primary/30":"bg-indigo-500/20 border-indigo-500/30"),children:te?D.jsx(SO,{className:"w-4 h-4 text-primary"}):D.jsx(Ay,{className:"w-4 h-4 text-indigo-500"})}),D.jsx("div",{className:Br("p-4 rounded-2xl text-sm leading-relaxed shadow-md transition-all hover:shadow-lg",te?"bg-primary text-primary-foreground rounded-tr-none shadow-primary/10":"ai-bubble-gradient border border-border/50 rounded-tl-none shadow-black/5"),children:D.jsxs("div",{className:Br("prose prose-sm max-w-none break-words",te?"prose-invert":"dark:prose-invert prose-p:text-foreground/90"),children:[D.jsx(fMe,{children:re.content}),pe&&S&&D.jsx("span",{className:"cursor-blink"})]})})]})},ce)})}),D.jsx("div",{ref:I})]}),D.jsxs("div",{className:"p-4 border-t border-border/40 bg-background/50 backdrop-blur-sm",children:[D.jsxs("div",{className:"flex gap-3 items-end max-w-4xl mx-auto",children:[D.jsxs("div",{className:"relative flex-1",children:[D.jsx(ZU,{value:m,onChange:re=>E(re.target.value),onKeyDown:re=>{re.key==="Enter"&&!re.shiftKey&&(re.preventDefault(),Z())},placeholder:"Type your question...",className:"min-h-[50px] max-h-[120px] pr-12 resize-none rounded-xl bg-muted/50 border-input focus:ring-primary/20"}),m&&D.jsx("button",{onClick:()=>E(""),className:"absolute top-3 right-3 text-muted-foreground hover:text-foreground",children:D.jsx(TO,{className:"w-4 h-4"})})]}),D.jsx(nr,{onClick:Z,disabled:!m.trim()||S,className:"h-[50px] w-[50px] rounded-xl bg-primary hover:bg-primary/90 shrink-0",children:D.jsx(mX,{className:"w-5 h-5"})})]}),D.jsx("p",{className:"text-center text-[10px] text-muted-foreground mt-2",children:"AI can make mistakes. Check important info."})]})]})]})})},N2e=()=>{const[i,r]=G.useState([]),[a,c]=G.useState(!1),[l,h]=G.useState({title:"",subject:"",link:""});G.useEffect(()=>{const I=localStorage.getItem("kle-connect-notes");r(I?JSON.parse(I):[])},[]),G.useEffect(()=>{localStorage.setItem("kle-connect-notes",JSON.stringify(i))},[i]);const m=()=>{if(!l.title||!l.subject)return;const I={id:crypto.randomUUID(),title:l.title,subject:l.subject,link:l.link||"#",rating:5,downloads:0};r([I,...i]),h({title:"",subject:"",link:""}),c(!1)},E=I=>{r(i.filter(N=>N.id!==I))},T=Array.from(new Set(i.map(I=>I.subject))).map(I=>({name:I,notes:i.filter(N=>N.subject===I).length,color:`hsl(${Math.random()*360} 70% 50%)`})),C=["Data Structures","Operating Systems","Computer Networks","Database Systems","Machine Learning"];return D.jsxs(Sc,{children:[D.jsx(hu,{icon:NA,title:"Notes & PYQs",subtitle:"Manage and share your study resources",gradient:"linear-gradient(135deg, hsl(142 76% 36% / 0.3), hsl(142 76% 36% / 0.1))"}),T.length>0&&D.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8",children:T.map((I,N)=>D.jsxs(Xn.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3,delay:N*.05},className:"glass rounded-2xl p-4 cursor-pointer hover:scale-105 transition-transform",children:[D.jsx("div",{className:"w-10 h-10 rounded-xl mb-3 flex items-center justify-center",style:{background:`${I.color}33`},children:D.jsx(gge,{className:"w-5 h-5",style:{color:I.color}})}),D.jsx("h3",{className:"text-sm font-medium text-foreground mb-1 line-clamp-2",children:I.name}),D.jsx("div",{className:"flex gap-2 text-xs text-muted-foreground",children:D.jsxs("span",{children:[I.notes," items"]})})]},I.name))}),D.jsxs("div",{className:"flex items-center justify-between mb-4",children:[D.jsx("h2",{className:"text-xl font-semibold text-foreground font-display",children:"Shared Resources"}),D.jsxs(nr,{onClick:()=>c(!a),className:"gap-2",children:[D.jsx(aK,{className:"w-4 h-4 rotate-180"})," Upload Resource"]})]}),a&&D.jsxs(Xn.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"glass p-6 rounded-xl mb-6 border border-primary/20",children:[D.jsx("h3",{className:"font-semibold mb-4",children:"Add New Material"}),D.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[D.jsx("input",{className:"p-3 bg-muted/50 rounded-lg border border-transparent focus:border-primary outline-none",placeholder:"Title (e.g. Unit 1 Notes)",value:l.title,onChange:I=>h({...l,title:I.target.value})}),D.jsxs("div",{className:"relative",children:[D.jsx("input",{className:"w-full p-3 bg-muted/50 rounded-lg border border-transparent focus:border-primary outline-none",placeholder:"Subject (e.g. AI)",value:l.subject,onChange:I=>h({...l,subject:I.target.value})}),D.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:C.map(I=>D.jsx("button",{onClick:()=>h(N=>({...N,subject:I})),className:"text-[10px] px-2 py-1 bg-primary/10 text-primary rounded-full hover:bg-primary/20",children:I},I))})]}),D.jsx("input",{className:"p-3 bg-muted/50 rounded-lg border border-transparent focus:border-primary outline-none",placeholder:"Link (Google Drive / URL)",value:l.link,onChange:I=>h({...l,link:I.target.value})})]}),D.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[D.jsx(nr,{variant:"ghost",onClick:()=>c(!1),children:"Cancel"}),D.jsx(nr,{onClick:m,disabled:!l.title||!l.subject,children:"Share Resource"})]})]}),D.jsxs("div",{className:"space-y-3",children:[i.length===0&&D.jsx("div",{className:"text-center py-12 text-muted-foreground",children:D.jsx("p",{children:"No notes shared yet. Key start the knowledge exchange! "})}),i.map((I,N)=>D.jsxs(Xn.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:N*.1},className:"glass rounded-xl p-4 flex items-center justify-between group",children:[D.jsxs("div",{className:"flex items-center gap-4",children:[D.jsx("div",{className:"w-12 h-12 rounded-xl bg-primary/10 flex items-center justify-center",children:D.jsx(NA,{className:"w-6 h-6 text-primary"})}),D.jsxs("div",{children:[D.jsx("h3",{className:"text-foreground font-medium",children:I.title}),D.jsx("p",{className:"text-sm text-muted-foreground",children:I.subject})]})]}),D.jsxs("div",{className:"flex items-center gap-4",children:[D.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[D.jsx(_X,{className:"w-4 h-4 text-yellow-500 fill-yellow-500"}),D.jsx("span",{className:"text-foreground",children:I.rating})]}),D.jsx(nr,{size:"sm",variant:"outline",className:"gap-2",asChild:!0,children:D.jsxs("a",{href:I.link,target:"_blank",rel:"noopener noreferrer",children:[D.jsx(aK,{className:"w-4 h-4"})," Open"]})}),D.jsx("button",{onClick:()=>E(I.id),className:"opacity-0 group-hover:opacity-100 text-muted-foreground hover:text-destructive transition-opacity px-2",children:""})]})]},I.id))]})]})},P2e=()=>{const[i,r]=G.useState([]),[a,c]=G.useState(""),[l,h]=G.useState(""),[m,E]=G.useState(!1);G.useEffect(()=>{const P=localStorage.getItem("study-planner-tasks");r(P?JSON.parse(P):[])},[]),G.useEffect(()=>{localStorage.setItem("study-planner-tasks",JSON.stringify(i))},[i]);const S=()=>{if(!a.trim())return;const P={id:crypto.randomUUID(),title:a,time:l||"Anytime",completed:!1};r([...i,P]),c(""),h(""),E(!1)},T=P=>{r(i.map(H=>H.id===P?{...H,completed:!H.completed}:H))},C=P=>{r(i.filter(H=>H.id!==P))},I=i.filter(P=>P.completed).length,N=i.length>0?Math.round(I/i.length*100):0;return D.jsxs(Sc,{children:[D.jsx(hu,{icon:E2,title:"Study Planner",subtitle:"Track your daily academic goals",gradient:"linear-gradient(135deg, hsl(45 93% 47% / 0.3), hsl(45 93% 47% / 0.1))"}),D.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[D.jsxs(Xn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"lg:col-span-2",children:[D.jsxs("div",{className:"flex items-center justify-between mb-4",children:[D.jsx("h2",{className:"text-xl font-semibold text-foreground font-display",children:"Today's Tasks"}),D.jsxs(nr,{size:"sm",onClick:()=>E(!m),className:"gap-2 bg-primary hover:bg-primary/90",children:[D.jsx(fX,{className:"w-4 h-4"}),"Add Task"]})]}),m&&D.jsx(Xn.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"glass p-4 rounded-xl mb-4 border border-primary/20",children:D.jsxs("div",{className:"flex gap-2",children:[D.jsx("input",{className:"flex-1 bg-transparent border-b border-border focus:border-primary outline-none px-2 py-1",placeholder:"Task description...",value:a,onChange:P=>c(P.target.value),autoFocus:!0}),D.jsx("input",{className:"w-24 bg-transparent border-b border-border focus:border-primary outline-none px-2 py-1 text-sm",placeholder:"Time (opt)",value:l,onChange:P=>h(P.target.value)}),D.jsx(nr,{size:"sm",onClick:S,children:"Save"})]})}),D.jsxs("div",{className:"glass rounded-2xl p-6 space-y-4 min-h-[300px]",children:[i.length===0&&D.jsx("div",{className:"text-center text-muted-foreground py-10",children:D.jsx("p",{children:"No tasks yet. Enjoy your free time! "})}),i.map((P,H)=>D.jsxs(Xn.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},layout:!0,className:`flex items-center gap-4 p-4 rounded-xl transition-colors group ${P.completed?"bg-primary/5 opacity-60":"bg-muted/50 hover:bg-muted/80"}`,children:[D.jsx("button",{onClick:()=>T(P.id),children:P.completed?D.jsx(oX,{className:"w-6 h-6 text-primary flex-shrink-0"}):D.jsx(fge,{className:"w-6 h-6 text-muted-foreground flex-shrink-0 hover:text-primary transition-colors"})}),D.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>T(P.id),children:[D.jsx("h3",{className:`font-medium ${P.completed?"line-through":""}`,children:P.title}),D.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[D.jsx(rw,{className:"w-3 h-3"}),D.jsx("span",{children:P.time})]})]}),D.jsx("button",{onClick:()=>C(P.id),className:"opacity-0 group-hover:opacity-100 text-muted-foreground hover:text-destructive transition-all p-2",children:""})]},P.id))]})]}),D.jsxs(Xn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:[D.jsx("h2",{className:"text-xl font-semibold text-foreground mb-4 font-display",children:"Daily Progress"}),D.jsxs("div",{className:"glass rounded-2xl p-6 flex flex-col items-center text-center",children:[D.jsxs("div",{className:"relative w-32 h-32 flex items-center justify-center mb-4",children:[D.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[D.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"currentColor",strokeWidth:"8",fill:"transparent",className:"text-muted/20"}),D.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"currentColor",strokeWidth:"8",fill:"transparent",strokeDasharray:351,strokeDashoffset:351-351*N/100,className:"text-primary transition-all duration-1000 ease-out",strokeLinecap:"round"})]}),D.jsxs("span",{className:"absolute text-2xl font-bold",children:[N,"%"]})]}),D.jsx("h3",{className:"text-lg font-medium mb-1",children:N===100?"All Done! ":N>50?"Great going!":"Keep pushing!"}),D.jsxs("p",{className:"text-sm text-muted-foreground",children:[I," of ",i.length," tasks completed"]})]})]})]})]})};var k2e=Object.create,_V=Object.defineProperty,D2e=Object.getOwnPropertyDescriptor,x2e=Object.getOwnPropertyNames,L2e=Object.getPrototypeOf,M2e=Object.prototype.hasOwnProperty,U2e=(i,r)=>()=>(r||i((r={exports:{}}).exports,r),r.exports),V2e=(i,r)=>{for(var a in r)_V(i,a,{get:r[a],enumerable:!0})},ane=(i,r,a,c)=>{if(r&&typeof r=="object"||typeof r=="function")for(let l of x2e(r))!M2e.call(i,l)&&l!==a&&_V(i,l,{get:()=>r[l],enumerable:!(c=D2e(r,l))||c.enumerable});return i},F2e=(i,r,a)=>(ane(i,r,"default"),a),Gg=(i,r,a)=>(a=i!=null?k2e(L2e(i)):{},ane(!i||!i.__esModule?_V(a,"default",{value:i,enumerable:!0}):a,i)),Hg=U2e((i,r)=>{(function(a,c){typeof i=="object"&&typeof r<"u"?r.exports=c():typeof define=="function"&&define.amd?define(c):(a=typeof globalThis<"u"?globalThis:a||self).AgoraRTC=c()})(i,function(){function a(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(s){if(s!=="default"&&!(s in e)){var o=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(e,s,o.get?o:{enumerable:!0,get:function(){return n[s]}})}})}),Object.freeze(e)}var c=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function l(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var h=function(e){try{return!!e()}catch{return!0}},m=!h(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),E=m,S=Function.prototype,T=S.call,C=E&&S.bind.bind(T,T),I=E?C:function(e){return function(){return T.apply(e,arguments)}},N=I({}.isPrototypeOf),P=function(e){return e&&e.Math===Math&&e},H=P(typeof globalThis=="object"&&globalThis)||P(typeof window=="object"&&window)||P(typeof self=="object"&&self)||P(typeof c=="object"&&c)||P(typeof c=="object"&&c)||(function(){return this})()||Function("return this")(),x=m,B=Function.prototype,X=B.apply,Z=B.call,$=typeof Reflect=="object"&&Reflect.apply||(x?Z.bind(X):function(){return Z.apply(X,arguments)}),le=I,re=le({}.toString),ce=le("".slice),te=function(e){return ce(re(e),8,-1)},pe=te,Ee=I,Ne=function(e){if(pe(e)==="Function")return Ee(e)},Ue=typeof document=="object"&&document.all,Se=Ue===void 0&&Ue!==void 0?function(e){return typeof e=="function"||e===Ue}:function(e){return typeof e=="function"},Xe={},Re=!h(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),Be=m,$e=Function.prototype.call,Ge=Be?$e.bind($e):function(){return $e.apply($e,arguments)},Ie={},Ke={}.propertyIsEnumerable,ae=Object.getOwnPropertyDescriptor,ge=ae&&!Ke.call({1:2},1);Ie.f=ge?function(e){var t=ae(this,e);return!!t&&t.enumerable}:Ke;var Pe,ue,it=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},yt=h,Dt=te,At=Object,dn=I("".split),Cn=yt(function(){return!At("z").propertyIsEnumerable(0)})?function(e){return Dt(e)==="String"?dn(e,""):At(e)}:At,fr=function(e){return e==null},os=fr,Jr=TypeError,Mr=function(e){if(os(e))throw new Jr("Can't call method on "+e);return e},Tc=Cn,pl=Mr,yi=function(e){return Tc(pl(e))},wc=Se,Wr=function(e){return typeof e=="object"?e!==null:wc(e)},fi={},$s=fi,gs=H,Cc=Se,Qs=function(e){return Cc(e)?e:void 0},Ir=function(e,t){return arguments.length<2?Qs($s[e])||Qs(gs[e]):$s[e]&&$s[e][t]||gs[e]&&gs[e][t]},Ua=H.navigator,qe=Ua&&Ua.userAgent,lt=qe?String(qe):"",Kt=H,on=lt,Nn=Kt.process,ii=Kt.Deno,Zs=Nn&&Nn.versions||ii&&ii.version,$r=Zs&&Zs.v8;$r&&(ue=(Pe=$r.split("."))[0]>0&&Pe[0]<4?1:+(Pe[0]+Pe[1])),!ue&&on&&(!(Pe=on.match(/Edge\/(\d+)/))||Pe[1]>=74)&&(Pe=on.match(/Chrome\/(\d+)/))&&(ue=+Pe[1]);var mi=ue,_a=mi,Gr=h,Ea=H.String,vi=!!Object.getOwnPropertySymbols&&!Gr(function(){var e=Symbol("symbol detection");return!Ea(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&_a&&_a<41}),no=vi&&!Symbol.sham&&typeof Symbol.iterator=="symbol",fl=Ir,ro=Se,ya=N,Va=Object,Fo=no?function(e){return typeof e=="symbol"}:function(e){var t=fl("Symbol");return ro(t)&&ya(t.prototype,Va(e))},mn=String,Bn=function(e){try{return mn(e)}catch{return"Object"}},mr=Se,$i=Bn,Ls=TypeError,kr=function(e){if(mr(e))return e;throw new Ls($i(e)+" is not a function")},ye=kr,be=fr,je=function(e,t){var n=e[t];return be(n)?void 0:ye(n)},st=Ge,St=Se,Yt=Wr,hn=TypeError,Ut={exports:{}},Wt=H,xt=Object.defineProperty,Vt=H,Rn=function(e,t){try{xt(Wt,e,{value:t,configurable:!0,writable:!0})}catch{Wt[e]=t}return t},Kn="__core-js_shared__",Qi=Ut.exports=Vt[Kn]||Rn(Kn,{});(Qi.versions||(Qi.versions=[])).push({version:"3.46.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.46.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Sr=Ut.exports,ir=Sr,Ar=function(e,t){return ir[e]||(ir[e]=t||{})},ml=Mr,Nd=Object,Zi=function(e){return Nd(ml(e))},gr=Zi,Cf=I({}.hasOwnProperty),Ur=Object.hasOwn||function(e,t){return Cf(gr(e),t)},Rc=I,gl=0,Ah=Math.random(),sr=Rc(1.1.toString),Dr=function(e){return"Symbol("+(e===void 0?"":e)+")_"+sr(++gl+Ah,36)},bs=Ar,fu=Ur,_r=Dr,mu=vi,Yg=no,gu=H.Symbol,Oh=bs("wks"),qg=Yg?gu.for||gu:gu&&gu.withoutSetter||_r,Er=function(e){return fu(Oh,e)||(Oh[e]=mu&&fu(gu,e)?gu[e]:qg("Symbol."+e)),Oh[e]},Xg=Ge,Yw=Wr,qw=Fo,Ev=je,Xw=function(e,t){var n,s;if(St(n=e.toString)&&!Yt(s=st(n,e))||St(n=e.valueOf)&&!Yt(s=st(n,e))||t!=="string")return s;throw new hn("Can't convert object to primitive value")},yv=TypeError,Rf=Er("toPrimitive"),sN=function(e,t){if(!Yw(e)||qw(e))return e;var n,s=Ev(e,Rf);if(s){if(n=Xg(s,e,t),!Yw(n)||qw(n))return n;throw new yv("Can't convert object to primitive value")}return Xw(e,t)},vv=Fo,Tr=function(e){var t=sN(e,"string");return vv(t)?t:t+""},Sv=Wr,Jg=H.document,Tv=Sv(Jg)&&Sv(Jg.createElement),$g=function(e){return Tv?Jg.createElement(e):{}},Jw=$g,wv=!Re&&!h(function(){return Object.defineProperty(Jw("div"),"a",{get:function(){return 7}}).a!==7}),Cv=Re,Qg=Ge,_u=Ie,Eu=it,yu=yi,bf=Tr,If=Ur,vu=wv,$w=Object.getOwnPropertyDescriptor;Xe.f=Cv?$w:function(e,t){if(e=yu(e),t=bf(t),vu)try{return $w(e,t)}catch{}if(If(e,t))return Eu(!Qg(_u.f,e,t),e[t])};var Qw=h,Af=Se,aN=/#|\.prototype\./,Nh=function(e,t){var n=Zw[Zg(e)];return n===Of||n!==oN&&(Af(t)?Qw(t):!!t)},Zg=Nh.normalize=function(e){return String(e).replace(aN,".").toLowerCase()},Zw=Nh.data={},oN=Nh.NATIVE="N",Of=Nh.POLYFILL="P",Ph=Nh,kh=kr,e_=m,cN=Ne(Ne.bind),Su=function(e,t){return kh(e),t===void 0?e:e_?cN(e,t):function(){return e.apply(t,arguments)}},va={},Nf=Re&&h(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),Rv=Wr,eC=String,Tu=TypeError,Is=function(e){if(Rv(e))return e;throw new Tu(eC(e)+" is not an object")},t_=Re,tC=wv,n_=Nf,Pd=Is,bv=Tr,Fa=TypeError,wu=Object.defineProperty,Iv=Object.getOwnPropertyDescriptor,kd="enumerable",Av="configurable",Pf="writable";va.f=t_?n_?function(e,t,n){if(Pd(e),t=bv(t),Pd(n),typeof e=="function"&&t==="prototype"&&"value"in n&&Pf in n&&!n[Pf]){var s=Iv(e,t);s&&s[Pf]&&(e[t]=n.value,n={configurable:Av in n?n[Av]:s[Av],enumerable:kd in n?n[kd]:s[kd],writable:!1})}return wu(e,t,n)}:wu:function(e,t,n){if(Pd(e),t=bv(t),Pd(n),tC)try{return wu(e,t,n)}catch{}if("get"in n||"set"in n)throw new Fa("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var Ov=va,kf=it,bc=Re?function(e,t,n){return Ov.f(e,t,kf(1,n))}:function(e,t,n){return e[t]=n,e},Dh=H,lN=$,uN=Ne,dN=Se,Nv=Xe.f,hN=Ph,xh=fi,pN=Su,Lh=bc,nC=Ur,rC=function(e){var t=function(n,s,o){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,s)}return new e(n,s,o)}return lN(e,this,arguments)};return t.prototype=e.prototype,t},Sn=function(e,t){var n,s,o,u,d,f,g,y,v,R=e.target,b=e.global,A=e.stat,F=e.proto,M=b?Dh:A?Dh[R]:Dh[R]&&Dh[R].prototype,j=b?xh:xh[R]||Lh(xh,R,{})[R],K=j.prototype;for(u in t)s=!(n=hN(b?u:R+(A?".":"#")+u,e.forced))&&M&&nC(M,u),f=j[u],s&&(g=e.dontCallGetSet?(v=Nv(M,u))&&v.value:M[u]),d=s&&g?g:t[u],(n||F||typeof f!=typeof d)&&(y=e.bind&&s?pN(d,Dh):e.wrap&&s?rC(d):F&&dN(d)?uN(d):d,(e.sham||d&&d.sham||f&&f.sham)&&Lh(y,"sham",!0),Lh(j,u,y),F&&(nC(xh,o=R+"Prototype")||Lh(xh,o,{}),Lh(xh[o],u,d),e.real&&K&&(n||!K[u])&&Lh(K,u,d)))},fN=Math.ceil,mN=Math.floor,gN=Math.trunc||function(e){var t=+e;return(t>0?mN:fN)(t)},Pv=gN,kv=function(e){var t=+e;return t!=t||t===0?0:Pv(t)},_N=kv,EN=Math.max,iC=Math.min,Dv=function(e,t){var n=_N(e);return n<0?EN(n+t,0):iC(n,t)},yN=kv,vN=Math.min,sC=function(e){var t=yN(e);return t>0?vN(t,9007199254740991):0},SN=sC,Cu=function(e){return SN(e.length)},TN=yi,xv=Dv,Df=Cu,aC=function(e){return function(t,n,s){var o=TN(t),u=Df(o);if(u===0)return!e&&-1;var d,f=xv(s,u);if(e&&n!=n){for(;u>f;)if((d=o[f++])!=d)return!0}else for(;u>f;f++)if((e||f in o)&&o[f]===n)return e||f||0;return!e&&-1}},r_={includes:aC(!0),indexOf:aC(!1)},oC=r_.includes;Sn({target:"Array",proto:!0,forced:h(function(){return!Array(1).includes()})},{includes:function(e){return oC(this,e,arguments.length>1?arguments[1]:void 0)}});var cC=H,lC=fi,Sa=function(e,t){var n=lC[e+"Prototype"],s=n&&n[t];if(s)return s;var o=cC[e],u=o&&o.prototype;return u&&u[t]},Mh=Sa("Array","includes"),wN=Wr,CN=te,RN=Er("match"),i_=function(e){var t;return wN(e)&&((t=e[RN])!==void 0?!!t:CN(e)==="RegExp")},uC=i_,xf=TypeError,Uh={};Uh[Er("toStringTag")]="z";var Lv=String(Uh)==="[object z]",s_=Lv,bN=Se,Lf=te,Mv=Er("toStringTag"),Uv=Object,dC=Lf((function(){return arguments})())==="Arguments",_l=s_?Lf:function(e){var t,n,s;return e===void 0?"Undefined":e===null?"Null":typeof(n=(function(o,u){try{return o[u]}catch{}})(t=Uv(e),Mv))=="string"?n:dC?Lf(t):(s=Lf(t))==="Object"&&bN(t.callee)?"Arguments":s},hC=_l,IN=String,ea=function(e){if(hC(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return IN(e)},AN=Er("match"),ON=Sn,NN=function(e){if(uC(e))throw new xf("The method doesn't accept regular expressions");return e},jo=Mr,Vh=ea,pC=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[AN]=!1,"/./"[e](t)}catch{}}return!1},fC=I("".indexOf);ON({target:"String",proto:!0,forced:!pC("includes")},{includes:function(e){return!!~fC(Vh(jo(this)),Vh(NN(e)),arguments.length>1?arguments[1]:void 0)}});var mC=Sa("String","includes"),Vv=N,Fv=Mh,PN=mC,jv=Array.prototype,Ru=String.prototype,Bv=function(e){var t=e.includes;return e===jv||Vv(jv,e)&&t===jv.includes?Fv:typeof e=="string"||e===Ru||Vv(Ru,e)&&t===Ru.includes?PN:t},ke=l(Bv),Wv=kr,gC=Zi,a_=Cn,Fh=Cu,o_=TypeError,Gv="Reduce of empty array with no initial value",c_=function(e){return function(t,n,s,o){var u=gC(t),d=a_(u),f=Fh(u);if(Wv(n),f===0&&s<2)throw new o_(Gv);var g=0,y=1;if(s<2)for(;;){if(g in d){o=d[g],g+=y;break}if(g+=y,f<=g)throw new o_(Gv)}for(;f>g;g+=y)g in d&&(o=n(o,d[g],g,u));return o}},_C={left:c_()},EC=h,Mf=function(e,t){var n=[][e];return!!n&&EC(function(){n.call(null,t||function(){return 1},1)})},jh=H,yC=lt,vC=te,Bo=function(e){return yC.slice(0,e.length)===e},Uf=Bo("Bun/")?"BUN":Bo("Cloudflare-Workers")?"CLOUDFLARE":Bo("Deno/")?"DENO":Bo("Node.js/")?"NODE":jh.Bun&&typeof Bun.version=="string"?"BUN":jh.Deno&&typeof Deno.version=="object"?"DENO":vC(jh.process)==="process"?"NODE":jh.window&&jh.document?"BROWSER":"REST",Bh=Uf==="NODE",kN=_C.left;Sn({target:"Array",proto:!0,forced:!Bh&&mi>79&&mi<83||!Mf("reduce")},{reduce:function(e){var t=arguments.length;return kN(this,e,t,t>1?arguments[1]:void 0)}});var DN=Sa("Array","reduce"),Vf=N,xN=DN,l_=Array.prototype,SC=function(e){var t=e.reduce;return e===l_||Vf(l_,e)&&t===l_.reduce?xN:t},Qr=SC,ta=l(Qr),u_=te,El=Array.isArray||function(e){return u_(e)==="Array"},TC=Sn,Hv=El,Ff=I([].reverse),jf=[1,2];TC({target:"Array",proto:!0,forced:String(jf)===String(jf.reverse())},{reverse:function(){return Hv(this)&&(this.length=this.length),Ff(this)}});var Wh=Sa("Array","reverse"),wC=N,LN=Wh,zv=Array.prototype,CC=function(e){var t=e.reverse;return e===zv||wC(zv,e)&&t===zv.reverse?LN:t},Bf=CC,Wf=l(Bf),Kv=Dr,d_=Ar("keys"),Gh=function(e){return d_[e]||(d_[e]=Kv(e))},Yv=!h(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),MN=Ur,RC=Se,UN=Zi,VN=Yv,h_=Gh("IE_PROTO"),Ic=Object,bC=Ic.prototype,bu=VN?Ic.getPrototypeOf:function(e){var t=UN(e);if(MN(t,h_))return t[h_];var n=t.constructor;return RC(n)&&t instanceof n?n.prototype:t instanceof Ic?bC:null},Ac=I,Gf=kr,yl=Wr,qv=function(e){return yl(e)||e===null},FN=String,jN=TypeError,Dd=function(e,t,n){try{return Ac(Gf(Object.getOwnPropertyDescriptor(e,t)[n]))}catch{}},Hf=Wr,Hh=Mr,p_=function(e){if(qv(e))return e;throw new jN("Can't set "+FN(e)+" as a prototype")},Xv=Object.setPrototypeOf||("__proto__"in{}?(function(){var e,t=!1,n={};try{(e=Dd(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(s,o){return Hh(s),p_(o),Hf(s)&&(t?e(s,o):s.__proto__=o),s}})():void 0),vl={},Wo={},Hr=Ur,Zr=yi,Iu=r_.indexOf,Ms=Wo,na=I([].push),Au=function(e,t){var n,s=Zr(e),o=0,u=[];for(n in s)!Hr(Ms,n)&&Hr(s,n)&&na(u,n);for(;t.length>o;)Hr(s,n=t[o++])&&(~Iu(u,n)||na(u,n));return u},Ou=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ta=Au,f_=Ou.concat("length","prototype");vl.f=Object.getOwnPropertyNames||function(e){return Ta(e,f_)};var zh={};zh.f=Object.getOwnPropertySymbols;var IC=Ir,m_=vl,AC=zh,Sl=Is,g_=I([].concat),Jv=IC("Reflect","ownKeys")||function(e){var t=m_.f(Sl(e)),n=AC.f;return n?g_(t,n(e)):t},$v=Ur,BN=Jv,Nu=Xe,Kh=va,Pu={},__=Au,E_=Ou,ra=Object.keys||function(e){return __(e,E_)},io=Re,xd=Nf,Tl=va,wl=Is,Ld=yi,OC=ra;Pu.f=io&&!xd?Object.defineProperties:function(e,t){wl(e);for(var n,s=Ld(t),o=OC(t),u=o.length,d=0;u>d;)Tl.f(e,n=o[d++],s[n]);return e};var Yh,y_=Ir("document","documentElement"),ja=Is,Ba=Pu,si=Ou,Go=Wo,NC=y_,PC=$g,zf="prototype",Kf="script",Qv=Gh("IE_PROTO"),qh=function(){},Zv=function(e){return"<"+Kf+">"+e+"</"+Kf+">"},Md=function(e){e.write(Zv("")),e.close();var t=e.parentWindow.Object;return e=null,t},Xh=function(){try{Yh=new ActiveXObject("htmlfile")}catch{}var e,t,n;Xh=typeof document<"u"?document.domain&&Yh?Md(Yh):(t=PC("iframe"),n="java"+Kf+":",t.style.display="none",NC.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(Zv("document.F=Object")),e.close(),e.F):Md(Yh);for(var s=si.length;s--;)delete Xh[zf][si[s]];return Xh()};Go[Qv]=!0;var Yf=Object.create||function(e,t){var n;return e!==null?(qh[zf]=ja(e),n=new qh,qh[zf]=null,n[Qv]=e):n=Xh(),t===void 0?n:Ba.f(n,t)},qf=Wr,v_=bc,eS=Error,kC=I("".replace),Jh=String(new eS("zxcasd").stack),tS=/\n\s*at [^:]*:[^\n]*/,S_=tS.test(Jh),T_=it,$h=!h(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",T_(1,7)),e.stack!==7)}),nS=bc,rS=function(e,t){if(S_&&typeof e=="string"&&!eS.prepareStackTrace)for(;t--;)e=kC(e,tS,"");return e},iS=$h,w_=Error.captureStackTrace,Ho={},so=Ho,Ud=Er("iterator"),sS=Array.prototype,aS=function(e){return e!==void 0&&(so.Array===e||sS[Ud]===e)},Cl=_l,Rl=je,oS=fr,DC=Ho,bl=Er("iterator"),zo=function(e){if(!oS(e))return Rl(e,bl)||Rl(e,"@@iterator")||DC[Cl(e)]},C_=Ge,xC=kr,R_=Is,LC=Bn,Xf=zo,Oc=TypeError,Vd=function(e,t){var n=arguments.length<2?Xf(e):t;if(xC(n))return R_(C_(n,e));throw new Oc(LC(e)+" is not iterable")},Jf=Ge,ku=Is,cS=je,Fd=function(e,t,n){var s,o;ku(e);try{if(!(s=cS(e,"return"))){if(t==="throw")throw n;return n}s=Jf(s,e)}catch(u){o=!0,s=u}if(t==="throw")throw n;if(o)throw s;return ku(s),n},MC=Su,lS=Ge,Si=Is,b_=Bn,uS=aS,dS=Cu,$f=N,hS=Vd,jd=zo,gi=Fd,cs=TypeError,ji=function(e,t){this.stopped=e,this.result=t},Qf=ji.prototype,Il=function(e,t,n){var s,o,u,d,f,g,y,v=n&&n.that,R=!(!n||!n.AS_ENTRIES),b=!(!n||!n.IS_RECORD),A=!(!n||!n.IS_ITERATOR),F=!(!n||!n.INTERRUPTED),M=MC(t,v),j=function(q){return s&&gi(s,"normal"),new ji(!0,q)},K=function(q){return R?(Si(q),F?M(q[0],q[1],j):M(q[0],q[1])):F?M(q,j):M(q)};if(b)s=e.iterator;else if(A)s=e;else{if(!(o=jd(e)))throw new cs(b_(e)+" is not iterable");if(uS(o)){for(u=0,d=dS(e);d>u;u++)if((f=K(e[u]))&&$f(Qf,f))return f;return new ji(!1)}s=hS(e,o)}for(g=b?e.next:s.next;!(y=lS(g,s)).done;){try{f=K(y.value)}catch(q){gi(s,"throw",q)}if(typeof f=="object"&&f&&$f(Qf,f))return f}return new ji(!1)},Zf=ea,WN=Sn,Us=N,pS=bu,Qh=Xv,fS=function(e,t,n){for(var s=BN(t),o=Kh.f,u=Nu.f,d=0;d<s.length;d++){var f=s[d];$v(e,f)||n&&$v(n,f)||o(e,f,u(t,f))}},Ko=Yf,wa=bc,Bd=it,mS=function(e,t){qf(t)&&"cause"in t&&v_(e,"cause",t.cause)},gS=function(e,t,n,s){iS&&(w_?w_(e,t):nS(e,"stack",rS(n,s)))},UC=Il,VC=function(e,t){return e===void 0?arguments.length<2?"":t:Zf(e)},FC=Er("toStringTag"),em=Error,jC=[].push,Wd=function(e,t){var n,s=Us(I_,this);Qh?n=Qh(new em,s?pS(this):I_):(n=s?this:Ko(I_),wa(n,FC,"Error")),t!==void 0&&wa(n,"message",VC(t)),gS(n,Wd,n.stack,1),arguments.length>2&&mS(n,arguments[2]);var o=[];return UC(e,jC,{that:o}),wa(n,"errors",o),n};Qh?Qh(Wd,em):fS(Wd,em,{name:!0});var I_=Wd.prototype=Ko(em.prototype,{constructor:Bd(1,Wd),message:Bd(1,""),name:Bd(1,"AggregateError")});WN({global:!0},{AggregateError:Wd});var tm,Al,nm,A_=Se,rm=H.WeakMap,BC=A_(rm)&&/native code/.test(String(rm)),O_=H,WC=Wr,GC=bc,N_=Ur,P_=Sr,_S=Gh,HC=Wo,ES="Object already initialized",k_=O_.TypeError,GN=O_.WeakMap;if(BC||P_.state){var Yo=P_.state||(P_.state=new GN);Yo.get=Yo.get,Yo.has=Yo.has,Yo.set=Yo.set,tm=function(e,t){if(Yo.has(e))throw new k_(ES);return t.facade=e,Yo.set(e,t),t},Al=function(e){return Yo.get(e)||{}},nm=function(e){return Yo.has(e)}}else{var Zh=_S("state");HC[Zh]=!0,tm=function(e,t){if(N_(e,Zh))throw new k_(ES);return t.facade=e,GC(e,Zh,t),t},Al=function(e){return N_(e,Zh)?e[Zh]:{}},nm=function(e){return N_(e,Zh)}}var Gd,yS,vS,Du={set:tm,get:Al,has:nm,enforce:function(e){return nm(e)?Al(e):tm(e,{})},getterFor:function(e){return function(t){var n;if(!WC(t)||(n=Al(t)).type!==e)throw new k_("Incompatible receiver, "+e+" required");return n}}},ep=Re,HN=Ur,zC=Function.prototype,zN=ep&&Object.getOwnPropertyDescriptor,ao=HN(zC,"name"),D_={PROPER:ao&&(function(){}).name==="something",CONFIGURABLE:ao&&(!ep||ep&&zN(zC,"name").configurable)},x_=bc,Ol=function(e,t,n,s){return s&&s.enumerable?e[t]=n:x_(e,t,n),e},KC=h,YC=Se,SS=Wr,tp=Yf,L_=bu,TS=Ol,wS=Er("iterator"),CS=!1;[].keys&&("next"in(vS=[].keys())?(yS=L_(L_(vS)))!==Object.prototype&&(Gd=yS):CS=!0);var qC=!SS(Gd)||KC(function(){var e={};return Gd[wS].call(e)!==e});YC((Gd=qC?{}:tp(Gd))[wS])||TS(Gd,wS,function(){return this});var RS={IteratorPrototype:Gd,BUGGY_SAFARI_ITERATORS:CS},XC=_l,JC=Lv?{}.toString:function(){return"[object "+XC(this)+"]"},KN=Lv,Ca=va.f,ia=bc,$C=Ur,QC=JC,bS=Er("toStringTag"),Nc=function(e,t,n,s){var o=n?e:e&&e.prototype;o&&($C(o,bS)||Ca(o,bS,{configurable:!0,value:t}),s&&!KN&&ia(o,"toString",QC))},ZC=RS.IteratorPrototype,IS=Yf,eR=it,AS=Nc,tR=Ho,nR=function(){return this},im=function(e,t,n,s){var o=t+" Iterator";return e.prototype=IS(ZC,{next:eR(+!s,n)}),AS(e,o,!1,!0),tR[o]=nR,e},OS=Sn,rR=Ge,NS=D_,M_=im,YN=bu,iR=Nc,U_=Ol,PS=Ho,V_=RS,Nl=NS.PROPER,F_=V_.BUGGY_SAFARI_ITERATORS,j_=Er("iterator"),B_="keys",sm="values",kS="entries",am=function(){return this},As=function(e,t,n,s,o,u,d){M_(n,t,s);var f,g,y,v=function(K){if(K===o&&M)return M;if(!F_&&K&&K in A)return A[K];switch(K){case B_:case sm:case kS:return function(){return new n(this,K)}}return function(){return new n(this)}},R=t+" Iterator",b=!1,A=e.prototype,F=A[j_]||A["@@iterator"]||o&&A[o],M=!F_&&F||v(o),j=t==="Array"&&A.entries||F;if(j&&(f=YN(j.call(new e)))!==Object.prototype&&f.next&&(iR(f,R,!0,!0),PS[R]=am),Nl&&o===sm&&F&&F.name!==sm&&(b=!0,M=function(){return rR(F,this)}),o)if(g={values:v(sm),keys:u?M:v(B_),entries:v(kS)},d)for(y in g)(F_||b||!(y in A))&&U_(A,y,g[y]);else OS({target:t,proto:!0,forced:F_||b},g);return d&&A[j_]!==M&&U_(A,j_,M,{}),PS[t]=M,g},W_=function(e,t){return{value:e,done:t}},qN=yi,om=Ho,Os=Du;va.f;var XN=As,Nt=W_,Hd="Array Iterator",DS=Os.set,sR=Os.getterFor(Hd);XN(Array,"Array",function(e,t){DS(this,{type:Hd,target:qN(e),index:0,kind:t})},function(){var e=sR(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,Nt(void 0,!0);switch(e.kind){case"keys":return Nt(n,!1);case"values":return Nt(t[n],!1)}return Nt([n,t[n]],!1)},"values"),om.Arguments=om.Array;var JN=va,xu=function(e,t,n){return JN.f(e,t,n)},G_=Ir,xS=xu,aR=Re,LS=Er("species"),oR=N,MS=TypeError,cm=function(e,t){if(oR(t,e))return e;throw new MS("Incorrect invocation")},Ns=Se,Wa=Sr,Lu=I(Function.toString);Ns(Wa.inspectSource)||(Wa.inspectSource=function(e){return Lu(e)});var US=Wa.inspectSource,cR=I,qo=h,VS=Se,Pc=_l,$N=US,FS=function(){},jS=Ir("Reflect","construct"),H_=/^\s*(?:class|function)\b/,lR=cR(H_.exec),QN=!H_.test(FS),Mu=function(e){if(!VS(e))return!1;try{return jS(FS,[],e),!0}catch{return!1}},z_=function(e){if(!VS(e))return!1;switch(Pc(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return QN||!!lR(H_,$N(e))}catch{return!0}};z_.sham=!0;var Vs,Yn,ls,Ni,es=!jS||qo(function(){var e;return Mu(Mu.call)||!Mu(Object)||!Mu(function(){e=!0})||e})?z_:Mu,Ga=es,np=Bn,us=TypeError,rp=Is,zd=function(e){if(Ga(e))return e;throw new us(np(e)+" is not a constructor")},K_=fr,BS=Er("species"),Kd=function(e,t){var n,s=rp(e).constructor;return s===void 0||K_(n=rp(s)[BS])?t:zd(n)},Bi=I([].slice),WS=TypeError,oo=function(e,t){if(e<t)throw new WS("Not enough arguments");return e},kc=/(?:ipad|iphone|ipod).*applewebkit/i.test(lt),Fs=H,GS=$,Uu=Su,lm=Se,Vu=Ur,um=h,ip=y_,HS=Bi,dm=$g,Y_=oo,sa=kc,Fu=Bh,Ha=Fs.setImmediate,js=Fs.clearImmediate,uR=Fs.process,hm=Fs.Dispatch,zS=Fs.Function,dR=Fs.MessageChannel,ju=Fs.String,q_=0,Yd={},Bu="onreadystatechange";um(function(){Vs=Fs.location});var pm=function(e){if(Vu(Yd,e)){var t=Yd[e];delete Yd[e],t()}},Pl=function(e){return function(){pm(e)}},KS=function(e){pm(e.data)},YS=function(e){Fs.postMessage(ju(e),Vs.protocol+"//"+Vs.host)};Ha&&js||(Ha=function(e){Y_(arguments.length,1);var t=lm(e)?e:zS(e),n=HS(arguments,1);return Yd[++q_]=function(){GS(t,void 0,n)},Yn(q_),q_},js=function(e){delete Yd[e]},Fu?Yn=function(e){uR.nextTick(Pl(e))}:hm&&hm.now?Yn=function(e){hm.now(Pl(e))}:dR&&!sa?(Ni=(ls=new dR).port2,ls.port1.onmessage=KS,Yn=Uu(Ni.postMessage,Ni)):Fs.addEventListener&&lm(Fs.postMessage)&&!Fs.importScripts&&Vs&&Vs.protocol!=="file:"&&!um(YS)?(Yn=YS,Fs.addEventListener("message",KS,!1)):Yn=Bu in dm("script")?function(e){ip.appendChild(dm("script"))[Bu]=function(){ip.removeChild(this),pm(e)}}:function(e){setTimeout(Pl(e),0)});var sp={set:Ha,clear:js},fm=H,ZN=Re,eP=Object.getOwnPropertyDescriptor,qS=function(e){if(!ZN)return fm[e];var t=eP(fm,e);return t&&t.value},XS=function(){this.head=null,this.tail=null};XS.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var co,JS,Wu,X_,Ti,hR=XS,pR=/ipad|iphone|ipod/i.test(lt)&&typeof Pebble<"u",tP=/web0s(?!.*chrome)/i.test(lt),ap=H,fR=qS,$S=Su,QS=sp.set,lo=hR,ZS=kc,nP=pR,Gu=tP,op=Bh,Hu=ap.MutationObserver||ap.WebKitMutationObserver,mm=ap.document,J_=ap.process,cp=ap.Promise,eT=fR("queueMicrotask");if(!eT){var lp=new lo,$_=function(){var e,t;for(op&&(e=J_.domain)&&e.exit();t=lp.get();)try{t()}catch(n){throw lp.head&&co(),n}e&&e.enter()};ZS||op||Gu||!Hu||!mm?!nP&&cp&&cp.resolve?((X_=cp.resolve(void 0)).constructor=cp,Ti=$S(X_.then,X_),co=function(){Ti($_)}):op?co=function(){J_.nextTick($_)}:(QS=$S(QS,ap),co=function(){QS($_)}):(JS=!0,Wu=mm.createTextNode(""),new Hu($_).observe(Wu,{characterData:!0}),co=function(){Wu.data=JS=!JS}),eT=function(e){lp.head||co(),lp.add(e)}}var tT=eT,qd=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Dc=H.Promise,Q_=H,up=Dc,nT=Se,rP=Ph,mR=US,rT=Er,gm=Uf,_m=mi,Em=up&&up.prototype,gR=rT("species"),_R=nT(Q_.PromiseRejectionEvent),Z_=rP("Promise",function(){var e=mR(up),t=e!==String(up);if(!t&&_m===66||!Em.catch||!Em.finally)return!0;if(!_m||_m<51||!/native code/.test(e)){var n=new up(function(o){o(1)}),s=function(o){o(function(){},function(){})};if((n.constructor={})[gR]=s,!(n.then(function(){})instanceof s))return!0}return!(t||gm!=="BROWSER"&&gm!=="DENO"||_R)}),ym={CONSTRUCTOR:Z_,REJECTION_EVENT:_R},Ra={},ER=kr,eE=TypeError,p=function(e){var t,n;this.promise=new e(function(s,o){if(t!==void 0||n!==void 0)throw new eE("Bad Promise constructor");t=s,n=o}),this.resolve=ER(t),this.reject=ER(n)};Ra.f=function(e){return new p(e)};var _,w,O,U=Sn,W=Bh,ee=H,me=fi,ve=Ge,He=Ol,ut=Nc,ht=function(e){var t=G_(e);aR&&t&&!t[LS]&&xS(t,LS,{configurable:!0,get:function(){return this}})},ot=kr,bt=Se,Bt=Wr,Gt=cm,Wi=Kd,xe=sp.set,Te=tT,Fe=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},ft=qd,qt=hR,sn=Du,rn=Dc,gn=ym,ds=Ra,ar="Promise",kl=gn.CONSTRUCTOR,iP=gn.REJECTION_EVENT,sP=sn.getterFor(ar),Vne=sn.set,Fne=rn&&rn.prototype,iT=rn,aP=Fne,RV=ee.TypeError,oP=ee.document,cP=ee.process,lP=ds.f,jne=lP,Bne=!!(oP&&oP.createEvent&&ee.dispatchEvent),bV="unhandledrejection",IV=function(e){var t;return!(!Bt(e)||!bt(t=e.then))&&t},AV=function(e,t){var n,s,o,u=t.value,d=t.state===1,f=d?e.ok:e.fail,g=e.resolve,y=e.reject,v=e.domain;try{f?(d||(t.rejection===2&&Gne(t),t.rejection=1),f===!0?n=u:(v&&v.enter(),n=f(u),v&&(v.exit(),o=!0)),n===e.promise?y(new RV("Promise-chain cycle")):(s=IV(n))?ve(s,n,g,y):g(n)):y(u)}catch(R){v&&!o&&v.exit(),y(R)}},OV=function(e,t){e.notified||(e.notified=!0,Te(function(){for(var n,s=e.reactions;n=s.get();)AV(n,e);e.notified=!1,t&&!e.rejection&&Wne(e)}))},NV=function(e,t,n){var s,o;Bne?((s=oP.createEvent("Event")).promise=t,s.reason=n,s.initEvent(e,!1,!0),ee.dispatchEvent(s)):s={promise:t,reason:n},!iP&&(o=ee["on"+e])?o(s):e===bV&&Fe("Unhandled promise rejection",n)},Wne=function(e){ve(xe,ee,function(){var t,n=e.facade,s=e.value;if(PV(e)&&(t=ft(function(){W?cP.emit("unhandledRejection",s,n):NV(bV,n,s)}),e.rejection=W||PV(e)?2:1,t.error))throw t.value})},PV=function(e){return e.rejection!==1&&!e.parent},Gne=function(e){ve(xe,ee,function(){var t=e.facade;W?cP.emit("rejectionHandled",t):NV("rejectionhandled",t,e.value)})},tE=function(e,t,n){return function(s){e(t,s,n)}},nE=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,OV(e,!0))},uP=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new RV("Promise can't be resolved itself");var s=IV(t);s?Te(function(){var o={done:!1};try{ve(s,t,tE(uP,o,e),tE(nE,o,e))}catch(u){nE(o,u,e)}}):(e.value=t,e.state=1,OV(e,!1))}catch(o){nE({done:!1},o,e)}}};kl&&(aP=(iT=function(e){Gt(this,aP),ot(e),ve(_,this);var t=sP(this);try{e(tE(uP,t),tE(nE,t))}catch(n){nE(t,n)}}).prototype,(_=function(e){Vne(this,{type:ar,done:!1,notified:!1,parent:!1,reactions:new qt,rejection:!1,state:0,value:null})}).prototype=He(aP,"then",function(e,t){var n=sP(this),s=lP(Wi(this,iT));return n.parent=!0,s.ok=!bt(e)||e,s.fail=bt(t)&&t,s.domain=W?cP.domain:void 0,n.state===0?n.reactions.add(s):Te(function(){AV(s,n)}),s.promise}),w=function(){var e=new _,t=sP(e);this.promise=e,this.resolve=tE(uP,t),this.reject=tE(nE,t)},ds.f=lP=function(e){return e===iT||e===O?new w(e):jne(e)}),U({global:!0,wrap:!0,forced:kl},{Promise:iT}),O=me.Promise,ut(iT,ar,!1,!0),ht(ar);var kV=Er("iterator"),DV=!1;try{var Hne=0,xV={next:function(){return{done:!!Hne++}},return:function(){DV=!0}};xV[kV]=function(){return this},Array.from(xV,function(){throw 2})}catch{}var zne=Dc,Kne=function(e,t){try{if(!t&&!DV)return!1}catch{return!1}var n=!1;try{var s={};s[kV]=function(){return{next:function(){return{done:n=!0}}}},e(s)}catch{}return n},yR=ym.CONSTRUCTOR||!Kne(function(e){zne.all(e).then(void 0,function(){})}),Yne=Ge,qne=kr,Xne=Ra,Jne=qd,$ne=Il;Sn({target:"Promise",stat:!0,forced:yR},{all:function(e){var t=this,n=Xne.f(t),s=n.resolve,o=n.reject,u=Jne(function(){var d=qne(t.resolve),f=[],g=0,y=1;$ne(e,function(v){var R=g++,b=!1;y++,Yne(d,t,v).then(function(A){b||(b=!0,f[R]=A,--y||s(f))},o)}),--y||s(f)});return u.error&&o(u.value),n.promise}});var Qne=Sn,Zne=ym.CONSTRUCTOR;Dc&&Dc.prototype,Qne({target:"Promise",proto:!0,forced:Zne,real:!0},{catch:function(e){return this.then(void 0,e)}});var ere=Ge,tre=kr,nre=Ra,rre=qd,ire=Il;Sn({target:"Promise",stat:!0,forced:yR},{race:function(e){var t=this,n=nre.f(t),s=n.reject,o=rre(function(){var u=tre(t.resolve);ire(e,function(d){ere(u,t,d).then(n.resolve,s)})});return o.error&&s(o.value),n.promise}});var sre=Ra;Sn({target:"Promise",stat:!0,forced:ym.CONSTRUCTOR},{reject:function(e){var t=sre.f(this);return(0,t.reject)(e),t.promise}});var are=Is,ore=Wr,cre=Ra,LV=function(e,t){if(are(e),ore(t)&&t.constructor===e)return t;var n=cre.f(e);return(0,n.resolve)(t),n.promise},lre=Sn,ure=Dc,dre=ym.CONSTRUCTOR,hre=LV,pre=Ir("Promise"),fre=!dre;lre({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return hre(fre&&this===pre?ure:this,e)}});var mre=Ge,gre=kr,_re=Ra,Ere=qd,yre=Il;Sn({target:"Promise",stat:!0,forced:yR},{allSettled:function(e){var t=this,n=_re.f(t),s=n.resolve,o=n.reject,u=Ere(function(){var d=gre(t.resolve),f=[],g=0,y=1;yre(e,function(v){var R=g++,b=!1;y++,mre(d,t,v).then(function(A){b||(b=!0,f[R]={status:"fulfilled",value:A},--y||s(f))},function(A){b||(b=!0,f[R]={status:"rejected",reason:A},--y||s(f))})}),--y||s(f)});return u.error&&o(u.value),n.promise}});var vre=Ge,Sre=kr,Tre=Ir,wre=Ra,Cre=qd,Rre=Il,MV="No one promise resolved";Sn({target:"Promise",stat:!0,forced:yR},{any:function(e){var t=this,n=Tre("AggregateError"),s=wre.f(t),o=s.resolve,u=s.reject,d=Cre(function(){var f=Sre(t.resolve),g=[],y=0,v=1,R=!1;Rre(e,function(b){var A=y++,F=!1;v++,vre(f,t,b).then(function(M){F||R||(R=!0,o(M))},function(M){F||R||(F=!0,g[A]=M,--v||u(new n(g,MV)))})}),--v||u(new n(g,MV))});return d.error&&u(d.value),s.promise}});var bre=Sn,Ire=$,Are=Bi,Ore=Ra,Nre=kr,UV=qd,dP=H.Promise,VV=!1;bre({target:"Promise",stat:!0,forced:!dP||!dP.try||UV(function(){dP.try(function(e){VV=e===8},8)}).error||!VV},{try:function(e){var t=arguments.length>1?Are(arguments,1):[],n=Ore.f(this),s=UV(function(){return Ire(Nre(e),void 0,t)});return(s.error?n.reject:n.resolve)(s.value),n.promise}});var Pre=Ra;Sn({target:"Promise",stat:!0},{withResolvers:function(){var e=Pre.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var kre=Sn,hP=Dc,Dre=h,xre=Ir,Lre=Se,Mre=Kd,FV=LV,Ure=hP&&hP.prototype;kre({target:"Promise",proto:!0,real:!0,forced:!!hP&&Dre(function(){Ure.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=Mre(this,xre("Promise")),n=Lre(e);return this.then(n?function(s){return FV(t,e()).then(function(){return s})}:e,n?function(s){return FV(t,e()).then(function(){throw s})}:e)}});var pP=I,Vre=kv,Fre=ea,jre=Mr,Bre=pP("".charAt),jV=pP("".charCodeAt),Wre=pP("".slice),BV=function(e){return function(t,n){var s,o,u=Fre(jre(t)),d=Vre(n),f=u.length;return d<0||d>=f?e?"":void 0:(s=jV(u,d))<55296||s>56319||d+1===f||(o=jV(u,d+1))<56320||o>57343?e?Bre(u,d):s:e?Wre(u,d,d+2):o-56320+(s-55296<<10)+65536}},fP={codeAt:BV(!1),charAt:BV(!0)},Gre=fP.charAt,Hre=ea,WV=Du,zre=As,GV=W_,HV="String Iterator",Kre=WV.set,Yre=WV.getterFor(HV);zre(String,"String",function(e){Kre(this,{type:HV,string:Hre(e),index:0})},function(){var e,t=Yre(this),n=t.string,s=t.index;return s>=n.length?GV(void 0,!0):(e=Gre(n,s),t.index+=e.length,GV(e,!1))});var qre=fi.Promise,Xre={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Jre=H,$re=Nc,zV=Ho;for(var mP in Xre)$re(Jre[mP],mP),zV[mP]=zV.Array;var KV=qre,We=l(KV),Qre=Sa("Array","values"),Zre=_l,eie=Ur,tie=N,nie=Qre,gP=Array.prototype,rie={DOMTokenList:!0,NodeList:!0},iie=function(e){var t=e.values;return e===gP||tie(gP,e)&&t===gP.values||eie(rie,Zre(e))?nie:t},za=l(iie),YV=Bn,sie=TypeError,qV=Bi,aie=Math.floor,_P=function(e,t){var n=e.length;if(n<8)for(var s,o,u=1;u<n;){for(o=u,s=e[u];o&&t(e[o-1],s)>0;)e[o]=e[--o];o!==u++&&(e[o]=s)}else for(var d=aie(n/2),f=_P(qV(e,0,d),t),g=_P(qV(e,d),t),y=f.length,v=g.length,R=0,b=0;R<y||b<v;)e[R+b]=R<y&&b<v?t(f[R],g[b])<=0?f[R++]:g[b++]:R<y?f[R++]:g[b++];return e},XV=_P,JV=lt.match(/firefox\/(\d+)/i),oie=!!JV&&+JV[1],cie=/MSIE|Trident/.test(lt),$V=lt.match(/AppleWebKit\/(\d+)\./),lie=!!$V&&+$V[1],uie=Sn,QV=I,die=kr,hie=Zi,ZV=Cu,pie=function(e,t){if(!delete e[t])throw new sie("Cannot delete property "+YV(t)+" of "+YV(e))},eF=ea,EP=h,fie=XV,mie=Mf,tF=oie,gie=cie,nF=mi,rF=lie,dp=[],iF=QV(dp.sort),_ie=QV(dp.push),Eie=EP(function(){dp.sort(void 0)}),yie=EP(function(){dp.sort(null)}),vie=mie("sort"),sF=!EP(function(){if(nF)return nF<70;if(!(tF&&tF>3)){if(gie)return!0;if(rF)return rF<603;var e,t,n,s,o="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(s=0;s<47;s++)dp.push({k:t+s,v:n})}for(dp.sort(function(u,d){return d.v-u.v}),s=0;s<dp.length;s++)t=dp[s].k.charAt(0),o.charAt(o.length-1)!==t&&(o+=t);return o!=="DGBEFHACIJK"}});uie({target:"Array",proto:!0,forced:Eie||!yie||!vie||!sF},{sort:function(e){e!==void 0&&die(e);var t=hie(this);if(sF)return e===void 0?iF(t):iF(t,e);var n,s,o=[],u=ZV(t);for(s=0;s<u;s++)s in t&&_ie(o,t[s]);for(fie(o,(function(d){return function(f,g){return g===void 0?-1:f===void 0?1:d!==void 0?+d(f,g)||0:eF(f)>eF(g)?1:-1}})(e)),n=ZV(o),s=0;s<n;)t[s]=o[s++];for(;s<u;)pie(t,s++);return t}});var Sie=Sa("Array","sort"),Tie=N,wie=Sie,yP=Array.prototype,Cie=function(e){var t=e.sort;return e===yP||Tie(yP,e)&&t===yP.sort?wie:t},vm=l(Cie),Rie=Sn,bie=I,Iie=Dv,Aie=RangeError,aF=String.fromCharCode,oF=String.fromCodePoint,Oie=bie([].join);Rie({target:"String",stat:!0,forced:!!oF&&oF.length!==1},{fromCodePoint:function(e){for(var t,n=[],s=arguments.length,o=0;s>o;){if(t=+arguments[o++],Iie(t,1114111)!==t)throw new Aie(t+" is not a valid code point");n[o]=t<65536?aF(t):aF(55296+((t-=65536)>>10),t%1024+56320)}return Oie(n,"")}});var Nie=h,Pie=Er("iterator"),vR=!Nie(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),s="";return e.pathname="c%20d",t.forEach(function(o,u){t.delete("b"),s+=u+o}),n.delete("a",2),n.delete("b",void 0),!e.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[Pie]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||s!=="a1c3"||new URL("https://x",void 0).host!=="x"}),kie=Ol,vP=Sn,cF=H,SP=qS,Die=Ir,SR=Ge,Dl=I,sT=Re,lF=vR,uF=Ol,xie=xu,Lie=function(e,t,n){for(var s in t)n&&n.unsafe&&e[s]?e[s]=t[s]:kie(e,s,t[s],n);return e},Mie=Nc,Uie=im,TP=Du,dF=cm,wP=Se,Vie=Ur,Fie=Su,jie=_l,Bie=Is,hF=Wr,Ka=ea,Wie=Yf,pF=it,fF=Vd,Gie=zo,TR=W_,rE=oo,Hie=XV,zie=Er("iterator"),iE="URLSearchParams",mF=iE+"Iterator",gF=TP.set,xc=TP.getterFor(iE),Kie=TP.getterFor(mF),_F=SP("fetch"),wR=SP("Request"),aT=SP("Headers"),CP=wR&&wR.prototype,EF=aT&&aT.prototype,Yie=cF.TypeError,qie=cF.encodeURIComponent,Xie=String.fromCharCode,Jie=Die("String","fromCodePoint"),$ie=parseInt,CR=Dl("".charAt),yF=Dl([].join),hp=Dl([].push),vF=Dl("".replace),Qie=Dl([].shift),SF=Dl([].splice),TF=Dl("".split),wF=Dl("".slice),Zie=Dl(/./.exec),ese=/\+/g,tse=/^[0-9a-f]+$/i,CF=function(e,t){var n=wF(e,t,t+2);return Zie(tse,n)?$ie(n,16):NaN},nse=function(e){for(var t=0,n=128;n>0&&e&n;n>>=1)t++;return t},rse=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},RF=function(e){for(var t=(e=vF(e,ese," ")).length,n="",s=0;s<t;){var o=CR(e,s);if(o==="%"){if(CR(e,s+1)==="%"||s+3>t){n+="%",s++;continue}var u=CF(e,s+1);if(u!=u){n+=o,s++;continue}s+=2;var d=nse(u);if(d===0)o=Xie(u);else{if(d===1||d>4){n+="",s++;continue}for(var f=[u],g=1;g<d&&!(++s+3>t||CR(e,s)!=="%");){var y=CF(e,s+1);if(y!=y){s+=3;break}if(y>191||y<128)break;hp(f,y),s+=2,g++}if(f.length!==d){n+="";continue}var v=rse(f);v===null?n+="":o=Jie(v)}}n+=o,s++}return n},ise=/[!'()~]|%20/g,sse={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},ase=function(e){return sse[e]},bF=function(e){return vF(qie(e),ise,ase)},RP=Uie(function(e,t){gF(this,{type:mF,target:xc(e).entries,index:0,kind:t})},iE,function(){var e=Kie(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,TR(void 0,!0);var s=t[n];switch(e.kind){case"keys":return TR(s.key,!1);case"values":return TR(s.value,!1)}return TR([s.key,s.value],!1)},!0),IF=function(e){this.entries=[],this.url=null,e!==void 0&&(hF(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?CR(e,0)==="?"?wF(e,1):e:Ka(e)))};IF.prototype={type:iE,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,s,o,u,d,f,g=this.entries,y=Gie(e);if(y)for(n=(t=fF(e,y)).next;!(s=SR(n,t)).done;){if(u=(o=fF(Bie(s.value))).next,(d=SR(u,o)).done||(f=SR(u,o)).done||!SR(u,o).done)throw new Yie("Expected sequence with length 2");hp(g,{key:Ka(d.value),value:Ka(f.value)})}else for(var v in e)Vie(e,v)&&hp(g,{key:v,value:Ka(e[v])})},parseQuery:function(e){if(e)for(var t,n,s=this.entries,o=TF(e,"&"),u=0;u<o.length;)(t=o[u++]).length&&(n=TF(t,"="),hp(s,{key:RF(Qie(n)),value:RF(yF(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],s=0;s<t.length;)e=t[s++],hp(n,bF(e.key)+"="+bF(e.value));return yF(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var RR=function(){dF(this,sE);var e=gF(this,new IF(arguments.length>0?arguments[0]:void 0));sT||(this.size=e.entries.length)},sE=RR.prototype;if(Lie(sE,{append:function(e,t){var n=xc(this);rE(arguments.length,2),hp(n.entries,{key:Ka(e),value:Ka(t)}),sT||this.length++,n.updateURL()},delete:function(e){for(var t=xc(this),n=rE(arguments.length,1),s=t.entries,o=Ka(e),u=n<2?void 0:arguments[1],d=u===void 0?u:Ka(u),f=0;f<s.length;){var g=s[f];if(g.key!==o||d!==void 0&&g.value!==d)f++;else if(SF(s,f,1),d!==void 0)break}sT||(this.size=s.length),t.updateURL()},get:function(e){var t=xc(this).entries;rE(arguments.length,1);for(var n=Ka(e),s=0;s<t.length;s++)if(t[s].key===n)return t[s].value;return null},getAll:function(e){var t=xc(this).entries;rE(arguments.length,1);for(var n=Ka(e),s=[],o=0;o<t.length;o++)t[o].key===n&&hp(s,t[o].value);return s},has:function(e){for(var t=xc(this).entries,n=rE(arguments.length,1),s=Ka(e),o=n<2?void 0:arguments[1],u=o===void 0?o:Ka(o),d=0;d<t.length;){var f=t[d++];if(f.key===s&&(u===void 0||f.value===u))return!0}return!1},set:function(e,t){var n=xc(this);rE(arguments.length,1);for(var s,o=n.entries,u=!1,d=Ka(e),f=Ka(t),g=0;g<o.length;g++)(s=o[g]).key===d&&(u?SF(o,g--,1):(u=!0,s.value=f));u||hp(o,{key:d,value:f}),sT||(this.size=o.length),n.updateURL()},sort:function(){var e=xc(this);Hie(e.entries,function(t,n){return t.key>n.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,n=xc(this).entries,s=Fie(e,arguments.length>1?arguments[1]:void 0),o=0;o<n.length;)s((t=n[o++]).value,t.key,this)},keys:function(){return new RP(this,"keys")},values:function(){return new RP(this,"values")},entries:function(){return new RP(this,"entries")}},{enumerable:!0}),uF(sE,zie,sE.entries,{}),uF(sE,"toString",function(){return xc(this).serialize()},{enumerable:!0}),sT&&xie(sE,"size",{get:function(){return xc(this).entries.length},configurable:!0,enumerable:!0}),Mie(RR,iE),vP({global:!0,forced:!lF},{URLSearchParams:RR}),!lF&&wP(aT)){var ose=Dl(EF.has),cse=Dl(EF.set),AF=function(e){if(hF(e)){var t,n=e.body;if(jie(n)===iE)return t=e.headers?new aT(e.headers):new aT,ose(t,"content-type")||cse(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Wie(e,{body:pF(0,Ka(n)),headers:pF(0,t)})}return e};if(wP(_F)&&vP({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return _F(e,arguments.length>1?AF(arguments[1]):{})}}),wP(wR)){var bP=function(e){return dF(this,CP),new wR(e,arguments.length>1?AF(arguments[1]):{})};CP.constructor=bP,bP.prototype=CP,vP({global:!0,dontCallGetSet:!0,forced:!0},{Request:bP})}}var Lc,lse={URLSearchParams:RR,getState:xc},use=fi.URLSearchParams,OF=Re,dse=I,hse=Ge,pse=h,IP=ra,fse=zh,mse=Ie,gse=Zi,_se=Cn,aE=Object.assign,NF=Object.defineProperty,Ese=dse([].concat),yse=!aE||pse(function(){if(OF&&aE({b:1},aE(NF({},"a",{enumerable:!0,get:function(){NF(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},n=Symbol("assign detection"),s="abcdefghijklmnopqrst";return e[n]=7,s.split("").forEach(function(o){t[o]=o}),aE({},e)[n]!==7||IP(aE({},t)).join("")!==s})?function(e,t){for(var n=gse(e),s=arguments.length,o=1,u=fse.f,d=mse.f;s>o;)for(var f,g=_se(arguments[o++]),y=u?Ese(IP(g),u(g)):IP(g),v=y.length,R=0;v>R;)f=y[R++],OF&&!hse(d,g,f)||(n[f]=g[f]);return n}:aE,vse=Is,Sse=Fd,Tse=Re,wse=va,Cse=it,AP=function(e,t,n){Tse?wse.f(e,t,Cse(0,n)):e[t]=n},Rse=Su,bse=Ge,Ise=Zi,Ase=function(e,t,n,s){try{return s?t(vse(n)[0],n[1]):t(n)}catch(o){Sse(e,"throw",o)}},Ose=aS,Nse=es,Pse=Cu,PF=AP,kse=Vd,Dse=zo,kF=Array,Sm=I,OP=2147483647,xse=/[^\0-\u007E]/,DF=/[.\u3002\uFF0E\uFF61]/g,xF="Overflow: input needs wider integers to process",LF=RangeError,Lse=Sm(DF.exec),oE=Math.floor,NP=String.fromCharCode,MF=Sm("".charCodeAt),UF=Sm([].join),pp=Sm([].push),Mse=Sm("".replace),Use=Sm("".split),Vse=Sm("".toLowerCase),VF=function(e){return e+22+75*(e<26)},Fse=function(e,t,n){var s=0;for(e=n?oE(e/700):e>>1,e+=oE(e/t);e>455;)e=oE(e/35),s+=36;return oE(s+36*e/(e+38))},jse=function(e){var t=[];e=(function(K){for(var q=[],Q=0,se=K.length;Q<se;){var oe=MF(K,Q++);if(oe>=55296&&oe<=56319&&Q<se){var ne=MF(K,Q++);(64512&ne)==56320?pp(q,((1023&oe)<<10)+(1023&ne)+65536):(pp(q,oe),Q--)}else pp(q,oe)}return q})(e);var n,s,o=e.length,u=128,d=0,f=72;for(n=0;n<e.length;n++)(s=e[n])<128&&pp(t,NP(s));var g=t.length,y=g;for(g&&pp(t,"-");y<o;){var v=OP;for(n=0;n<e.length;n++)(s=e[n])>=u&&s<v&&(v=s);var R=y+1;if(v-u>oE((OP-d)/R))throw new LF(xF);for(d+=(v-u)*R,u=v,n=0;n<e.length;n++){if((s=e[n])<u&&++d>OP)throw new LF(xF);if(s===u){for(var b=d,A=36;;){var F=A<=f?1:A>=f+26?26:A-f;if(b<F)break;var M=b-F,j=36-F;pp(t,NP(VF(F+M%j))),b=oE(M/j),A+=36}pp(t,NP(VF(b))),f=Fse(d,R,y===g),d=0,y++}}d++,u++}return UF(t,"")},Bse=Sn,PP=Re,Wse=vR,kP=H,FF=Su,Mc=I,bR=Ol,Uc=xu,Gse=cm,DP=Ur,xP=yse,cE=function(e){var t=Ise(e),n=Nse(this),s=arguments.length,o=s>1?arguments[1]:void 0,u=o!==void 0;u&&(o=Rse(o,s>2?arguments[2]:void 0));var d,f,g,y,v,R,b=Dse(t),A=0;if(!b||this===kF&&Ose(b))for(d=Pse(t),f=n?new this(d):kF(d);d>A;A++)R=u?o(t[A],A):t[A],PF(f,A,R);else for(f=n?new this:[],v=(y=kse(t,b)).next;!(g=bse(v,y)).done;A++)R=u?Ase(y,o,[g.value,A],!0):g.value,PF(f,A,R);return f.length=A,f},xl=Bi,Hse=fP.codeAt,zse=function(e){var t,n,s=[],o=Use(Mse(Vse(e),DF,"."),".");for(t=0;t<o.length;t++)n=o[t],pp(s,Lse(xse,n)?"xn--"+jse(n):n);return UF(s,".")},Xd=ea,Kse=Nc,Yse=oo,jF=lse,BF=Du,qse=BF.set,IR=BF.getterFor("URL"),Xse=jF.URLSearchParams,Jse=jF.getState,oT=kP.URL,LP=kP.TypeError,AR=kP.parseInt,$se=Math.floor,WF=Math.pow,Vc=Mc("".charAt),Ll=Mc(/./.exec),cT=Mc([].join),Qse=Mc(1.1.toString),Zse=Mc([].pop),lE=Mc([].push),MP=Mc("".replace),eae=Mc([].shift),tae=Mc("".split),lT=Mc("".slice),OR=Mc("".toLowerCase),nae=Mc([].unshift),UP="Invalid scheme",uT="Invalid host",GF="Invalid port",HF=/[a-z]/i,rae=/[\d+-.a-z]/i,VP=/\d/,iae=/^0x/i,sae=/^[0-7]+$/,aae=/^\d+$/,zF=/^[\da-f]+$/i,oae=/[\0\t\n\r #%/:<>?@[\\\]^|]/,cae=/[\0\t\n\r #/:<>?@[\\\]^|]/,lae=/^[\u0000-\u0020]+/,uae=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,dae=/[\t\n\r]/g,dT=function(e){var t,n,s,o;if(typeof e=="number"){for(t=[],n=0;n<4;n++)nae(t,e%256),e=$se(e/256);return cT(t,".")}if(typeof e=="object"){for(t="",s=(function(u){for(var d=null,f=1,g=null,y=0,v=0;v<8;v++)u[v]!==0?(y>f&&(d=g,f=y),g=null,y=0):(g===null&&(g=v),++y);return y>f?g:d})(e),n=0;n<8;n++)o&&e[n]===0||(o&&(o=!1),s===n?(t+=n?":":"::",o=!0):(t+=Qse(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},NR={},KF=xP({},NR,{" ":1,'"':1,"<":1,">":1,"`":1}),YF=xP({},KF,{"#":1,"?":1,"{":1,"}":1}),FP=xP({},YF,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),fp=function(e,t){var n=Hse(e,0);return n>32&&n<127&&!DP(t,e)?e:encodeURIComponent(e)},PR={ftp:21,file:null,http:80,https:443,ws:80,wss:443},hT=function(e,t){var n;return e.length===2&&Ll(HF,Vc(e,0))&&((n=Vc(e,1))===":"||!t&&n==="|")},qF=function(e){var t;return e.length>1&&hT(lT(e,0,2))&&(e.length===2||(t=Vc(e,2))==="/"||t==="\\"||t==="?"||t==="#")},hae=function(e){return e==="."||OR(e)==="%2e"},jP={},XF={},BP={},JF={},$F={},WP={},QF={},ZF={},kR={},DR={},GP={},HP={},zP={},KP={},ej={},YP={},uE={},zu={},tj={},Tm={},Jd={},qP=function(e,t,n){var s,o,u,d=Xd(e);if(t){if(o=this.parse(d))throw new LP(o);this.searchParams=null}else{if(n!==void 0&&(s=new qP(n,!0)),o=this.parse(d,null,s))throw new LP(o);(u=Jse(new Xse)).bindURL(this),this.searchParams=u}};qP.prototype={type:"URL",parse:function(e,t,n){var s,o,u,d,f,g=this,y=t||jP,v=0,R="",b=!1,A=!1,F=!1;for(e=Xd(e),t||(g.scheme="",g.username="",g.password="",g.host=null,g.port=null,g.path=[],g.query=null,g.fragment=null,g.cannotBeABaseURL=!1,e=MP(e,lae,""),e=MP(e,uae,"$1")),e=MP(e,dae,""),s=cE(e);v<=s.length;){switch(o=s[v],y){case jP:if(!o||!Ll(HF,o)){if(t)return UP;y=BP;continue}R+=OR(o),y=XF;break;case XF:if(o&&(Ll(rae,o)||o==="+"||o==="-"||o==="."))R+=OR(o);else{if(o!==":"){if(t)return UP;R="",y=BP,v=0;continue}if(t&&(g.isSpecial()!==DP(PR,R)||R==="file"&&(g.includesCredentials()||g.port!==null)||g.scheme==="file"&&!g.host))return;if(g.scheme=R,t)return void(g.isSpecial()&&PR[g.scheme]===g.port&&(g.port=null));R="",g.scheme==="file"?y=KP:g.isSpecial()&&n&&n.scheme===g.scheme?y=JF:g.isSpecial()?y=ZF:s[v+1]==="/"?(y=$F,v++):(g.cannotBeABaseURL=!0,lE(g.path,""),y=tj)}break;case BP:if(!n||n.cannotBeABaseURL&&o!=="#")return UP;if(n.cannotBeABaseURL&&o==="#"){g.scheme=n.scheme,g.path=xl(n.path),g.query=n.query,g.fragment="",g.cannotBeABaseURL=!0,y=Jd;break}y=n.scheme==="file"?KP:WP;continue;case JF:if(o!=="/"||s[v+1]!=="/"){y=WP;continue}y=kR,v++;break;case $F:if(o==="/"){y=DR;break}y=zu;continue;case WP:if(g.scheme=n.scheme,o===Lc)g.username=n.username,g.password=n.password,g.host=n.host,g.port=n.port,g.path=xl(n.path),g.query=n.query;else if(o==="/"||o==="\\"&&g.isSpecial())y=QF;else if(o==="?")g.username=n.username,g.password=n.password,g.host=n.host,g.port=n.port,g.path=xl(n.path),g.query="",y=Tm;else{if(o!=="#"){g.username=n.username,g.password=n.password,g.host=n.host,g.port=n.port,g.path=xl(n.path),g.path.length--,y=zu;continue}g.username=n.username,g.password=n.password,g.host=n.host,g.port=n.port,g.path=xl(n.path),g.query=n.query,g.fragment="",y=Jd}break;case QF:if(!g.isSpecial()||o!=="/"&&o!=="\\"){if(o!=="/"){g.username=n.username,g.password=n.password,g.host=n.host,g.port=n.port,y=zu;continue}y=DR}else y=kR;break;case ZF:if(y=kR,o!=="/"||Vc(R,v+1)!=="/")continue;v++;break;case kR:if(o!=="/"&&o!=="\\"){y=DR;continue}break;case DR:if(o==="@"){b&&(R="%40"+R),b=!0,u=cE(R);for(var M=0;M<u.length;M++){var j=u[M];if(j!==":"||F){var K=fp(j,FP);F?g.password+=K:g.username+=K}else F=!0}R=""}else if(o===Lc||o==="/"||o==="?"||o==="#"||o==="\\"&&g.isSpecial()){if(b&&R==="")return"Invalid authority";v-=cE(R).length+1,R="",y=GP}else R+=o;break;case GP:case HP:if(t&&g.scheme==="file"){y=YP;continue}if(o!==":"||A){if(o===Lc||o==="/"||o==="?"||o==="#"||o==="\\"&&g.isSpecial()){if(g.isSpecial()&&R==="")return uT;if(t&&R===""&&(g.includesCredentials()||g.port!==null))return;if(d=g.parseHost(R))return d;if(R="",y=uE,t)return;continue}o==="["?A=!0:o==="]"&&(A=!1),R+=o}else{if(R==="")return uT;if(d=g.parseHost(R))return d;if(R="",y=zP,t===HP)return}break;case zP:if(!Ll(VP,o)){if(o===Lc||o==="/"||o==="?"||o==="#"||o==="\\"&&g.isSpecial()||t){if(R!==""){var q=AR(R,10);if(q>65535)return GF;g.port=g.isSpecial()&&q===PR[g.scheme]?null:q,R=""}if(t)return;y=uE;continue}return GF}R+=o;break;case KP:if(g.scheme="file",o==="/"||o==="\\")y=ej;else{if(!n||n.scheme!=="file"){y=zu;continue}switch(o){case Lc:g.host=n.host,g.path=xl(n.path),g.query=n.query;break;case"?":g.host=n.host,g.path=xl(n.path),g.query="",y=Tm;break;case"#":g.host=n.host,g.path=xl(n.path),g.query=n.query,g.fragment="",y=Jd;break;default:qF(cT(xl(s,v),""))||(g.host=n.host,g.path=xl(n.path),g.shortenPath()),y=zu;continue}}break;case ej:if(o==="/"||o==="\\"){y=YP;break}n&&n.scheme==="file"&&!qF(cT(xl(s,v),""))&&(hT(n.path[0],!0)?lE(g.path,n.path[0]):g.host=n.host),y=zu;continue;case YP:if(o===Lc||o==="/"||o==="\\"||o==="?"||o==="#"){if(!t&&hT(R))y=zu;else if(R===""){if(g.host="",t)return;y=uE}else{if(d=g.parseHost(R))return d;if(g.host==="localhost"&&(g.host=""),t)return;R="",y=uE}continue}R+=o;break;case uE:if(g.isSpecial()){if(y=zu,o!=="/"&&o!=="\\")continue}else if(t||o!=="?")if(t||o!=="#"){if(o!==Lc&&(y=zu,o!=="/"))continue}else g.fragment="",y=Jd;else g.query="",y=Tm;break;case zu:if(o===Lc||o==="/"||o==="\\"&&g.isSpecial()||!t&&(o==="?"||o==="#")){if((f=OR(f=R))===".."||f==="%2e."||f===".%2e"||f==="%2e%2e"?(g.shortenPath(),o==="/"||o==="\\"&&g.isSpecial()||lE(g.path,"")):hae(R)?o==="/"||o==="\\"&&g.isSpecial()||lE(g.path,""):(g.scheme==="file"&&!g.path.length&&hT(R)&&(g.host&&(g.host=""),R=Vc(R,0)+":"),lE(g.path,R)),R="",g.scheme==="file"&&(o===Lc||o==="?"||o==="#"))for(;g.path.length>1&&g.path[0]==="";)eae(g.path);o==="?"?(g.query="",y=Tm):o==="#"&&(g.fragment="",y=Jd)}else R+=fp(o,YF);break;case tj:o==="?"?(g.query="",y=Tm):o==="#"?(g.fragment="",y=Jd):o!==Lc&&(g.path[0]+=fp(o,NR));break;case Tm:t||o!=="#"?o!==Lc&&(o==="'"&&g.isSpecial()?g.query+="%27":g.query+=o==="#"?"%23":fp(o,NR)):(g.fragment="",y=Jd);break;case Jd:o!==Lc&&(g.fragment+=fp(o,KF))}v++}},parseHost:function(e){var t,n,s;if(Vc(e,0)==="["){if(Vc(e,e.length-1)!=="]"||(t=(function(o){var u,d,f,g,y,v,R,b=[0,0,0,0,0,0,0,0],A=0,F=null,M=0,j=function(){return Vc(o,M)};if(j()===":"){if(Vc(o,1)!==":")return;M+=2,F=++A}for(;j();){if(A===8)return;if(j()!==":"){for(u=d=0;d<4&&Ll(zF,j());)u=16*u+AR(j(),16),M++,d++;if(j()==="."){if(d===0||(M-=d,A>6))return;for(f=0;j();){if(g=null,f>0){if(!(j()==="."&&f<4))return;M++}if(!Ll(VP,j()))return;for(;Ll(VP,j());){if(y=AR(j(),10),g===null)g=y;else{if(g===0)return;g=10*g+y}if(g>255)return;M++}b[A]=256*b[A]+g,++f!=2&&f!==4||A++}if(f!==4)return;break}if(j()===":"){if(M++,!j())return}else if(j())return;b[A++]=u}else{if(F!==null)return;M++,F=++A}}if(F!==null)for(v=A-F,A=7;A!==0&&v>0;)R=b[A],b[A--]=b[F+v-1],b[F+--v]=R;else if(A!==8)return;return b})(lT(e,1,-1)),!t))return uT;this.host=t}else if(this.isSpecial()){if(e=zse(e),Ll(oae,e)||(t=(function(o){var u,d,f,g,y,v,R,b=tae(o,".");if(b.length&&b[b.length-1]===""&&b.length--,(u=b.length)>4)return o;for(d=[],f=0;f<u;f++){if((g=b[f])==="")return o;if(y=10,g.length>1&&Vc(g,0)==="0"&&(y=Ll(iae,g)?16:8,g=lT(g,y===8?1:2)),g==="")v=0;else{if(!Ll(y===10?aae:y===8?sae:zF,g))return o;v=AR(g,y)}lE(d,v)}for(f=0;f<u;f++)if(v=d[f],f===u-1){if(v>=WF(256,5-u))return null}else if(v>255)return null;for(R=Zse(d),f=0;f<d.length;f++)R+=d[f]*WF(256,3-f);return R})(e),t===null))return uT;this.host=t}else{if(Ll(cae,e))return uT;for(t="",n=cE(e),s=0;s<n.length;s++)t+=fp(n[s],NR);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return DP(PR,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&hT(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,s=e.password,o=e.host,u=e.port,d=e.path,f=e.query,g=e.fragment,y=t+":";return o!==null?(y+="//",e.includesCredentials()&&(y+=n+(s?":"+s:"")+"@"),y+=dT(o),u!==null&&(y+=":"+u)):t==="file"&&(y+="//"),y+=e.cannotBeABaseURL?d[0]:d.length?"/"+cT(d,"/"):"",f!==null&&(y+="?"+f),g!==null&&(y+="#"+g),y},setHref:function(e){var t=this.parse(e);if(t)throw new LP(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new dE(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+dT(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Xd(e)+":",jP)},getUsername:function(){return this.username},setUsername:function(e){var t=cE(Xd(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=fp(t[n],FP)}},getPassword:function(){return this.password},setPassword:function(e){var t=cE(Xd(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=fp(t[n],FP)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?dT(e):dT(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,GP)},getHostname:function(){var e=this.host;return e===null?"":dT(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,HP)},getPort:function(){var e=this.port;return e===null?"":Xd(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Xd(e))===""?this.port=null:this.parse(e,zP))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+cT(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,uE))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Xd(e))===""?this.query=null:(Vc(e,0)==="?"&&(e=lT(e,1)),this.query="",this.parse(e,Tm)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Xd(e))!==""?(Vc(e,0)==="#"&&(e=lT(e,1)),this.fragment="",this.parse(e,Jd)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var dE=function(e){var t=Gse(this,Ya),n=Yse(arguments.length,1)>1?arguments[1]:void 0,s=qse(t,new qP(e,!1,n));PP||(t.href=s.serialize(),t.origin=s.getOrigin(),t.protocol=s.getProtocol(),t.username=s.getUsername(),t.password=s.getPassword(),t.host=s.getHost(),t.hostname=s.getHostname(),t.port=s.getPort(),t.pathname=s.getPathname(),t.search=s.getSearch(),t.searchParams=s.getSearchParams(),t.hash=s.getHash())},Ya=dE.prototype,Fc=function(e,t){return{get:function(){return IR(this)[e]()},set:t&&function(n){return IR(this)[t](n)},configurable:!0,enumerable:!0}};if(PP&&(Uc(Ya,"href",Fc("serialize","setHref")),Uc(Ya,"origin",Fc("getOrigin")),Uc(Ya,"protocol",Fc("getProtocol","setProtocol")),Uc(Ya,"username",Fc("getUsername","setUsername")),Uc(Ya,"password",Fc("getPassword","setPassword")),Uc(Ya,"host",Fc("getHost","setHost")),Uc(Ya,"hostname",Fc("getHostname","setHostname")),Uc(Ya,"port",Fc("getPort","setPort")),Uc(Ya,"pathname",Fc("getPathname","setPathname")),Uc(Ya,"search",Fc("getSearch","setSearch")),Uc(Ya,"searchParams",Fc("getSearchParams")),Uc(Ya,"hash",Fc("getHash","setHash"))),bR(Ya,"toJSON",function(){return IR(this).serialize()},{enumerable:!0}),bR(Ya,"toString",function(){return IR(this).serialize()},{enumerable:!0}),oT){var nj=oT.createObjectURL,rj=oT.revokeObjectURL;nj&&bR(dE,"createObjectURL",FF(nj,oT)),rj&&bR(dE,"revokeObjectURL",FF(rj,oT))}Kse(dE,"URL"),Bse({global:!0,forced:!Wse,sham:!PP},{URL:dE});var pae=Sn,ij=h,fae=oo,sj=ea,mae=vR,XP=Ir("URL"),gae=mae&&ij(function(){XP.canParse()}),_ae=ij(function(){return XP.canParse.length!==1});pae({target:"URL",stat:!0,forced:!gae||_ae},{canParse:function(e){var t=fae(arguments.length,1),n=sj(e),s=t<2||arguments[1]===void 0?void 0:sj(arguments[1]);try{return!!new XP(n,s)}catch{return!1}}});var Eae=Sn,yae=oo,aj=ea,vae=vR,Sae=Ir("URL");Eae({target:"URL",stat:!0,forced:!vae},{parse:function(e){var t=yae(arguments.length,1),n=aj(e),s=t<2||arguments[1]===void 0?void 0:aj(arguments[1]);try{return new Sae(n,s)}catch{return null}}});var xR=l(fi.URL);let oj=!0,cj=!0;function LR(e,t,n){let s=e.match(t);return s&&s.length>=n&&parseInt(s[n],10)}function wm(e,t,n){if(!e.RTCPeerConnection)return;let s=e.RTCPeerConnection.prototype,o=s.addEventListener;s.addEventListener=function(d,f){if(d!==t)return o.apply(this,arguments);let g=y=>{let v=n(y);v&&(f.handleEvent?f.handleEvent(v):f(v))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(f,g),o.apply(this,[d,g])};let u=s.removeEventListener;s.removeEventListener=function(d,f){if(d!==t||!this._eventMap||!this._eventMap[t])return u.apply(this,arguments);if(!this._eventMap[t].has(f))return u.apply(this,arguments);let g=this._eventMap[t].get(f);return this._eventMap[t].delete(f),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[d,g])},Object.defineProperty(s,"on"+t,{get(){return this["_on"+t]},set(d){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),d&&this.addEventListener(t,this["_on"+t]=d)},enumerable:!0,configurable:!0})}function Tae(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(oj=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function wae(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(cj=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function lj(){if(typeof window=="object"){if(oj)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function JP(e,t){cj&&console.warn(e+" is deprecated, please use "+t+" instead.")}function uj(e){return Object.prototype.toString.call(e)==="[object Object]"}function dj(e){var t;return uj(e)?ta(t=Object.keys(e)).call(t,function(n,s){let o=uj(e[s]),u=o?dj(e[s]):e[s],d=o&&!Object.keys(u).length;return u===void 0||d?n:Object.assign(n,{[s]:u})},{}):e}function $P(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(s=>{s.endsWith("Id")?$P(e,e.get(t[s]),n):s.endsWith("Ids")&&t[s].forEach(o=>{$P(e,e.get(o),n)})}))}function hj(e,t,n){let s=n?"outbound-rtp":"inbound-rtp",o=new Map;if(t===null)return o;let u=[];return e.forEach(d=>{d.type==="track"&&d.trackIdentifier===t.id&&u.push(d)}),u.forEach(d=>{e.forEach(f=>{f.type===s&&f.trackId===d.id&&$P(e,f,o)})}),o}let pj=lj;function fj(e,t){let n=e&&e.navigator;if(!n.mediaDevices)return;let s=function(d){if(typeof d!="object"||d.mandatory||d.optional)return d;let f={};return Object.keys(d).forEach(g=>{if(g==="require"||g==="advanced"||g==="mediaSource")return;let y=typeof d[g]=="object"?d[g]:{ideal:d[g]};y.exact!==void 0&&typeof y.exact=="number"&&(y.min=y.max=y.exact);let v=function(R,b){return R?R+b.charAt(0).toUpperCase()+b.slice(1):b==="deviceId"?"sourceId":b};if(y.ideal!==void 0){f.optional=f.optional||[];let R={};typeof y.ideal=="number"?(R[v("min",g)]=y.ideal,f.optional.push(R),R={},R[v("max",g)]=y.ideal,f.optional.push(R)):(R[v("",g)]=y.ideal,f.optional.push(R))}y.exact!==void 0&&typeof y.exact!="number"?(f.mandatory=f.mandatory||{},f.mandatory[v("",g)]=y.exact):["min","max"].forEach(R=>{y[R]!==void 0&&(f.mandatory=f.mandatory||{},f.mandatory[v(R,g)]=y[R])})}),d.advanced&&(f.optional=(f.optional||[]).concat(d.advanced)),f},o=function(d,f){if(t.version>=61)return f(d);if((d=JSON.parse(JSON.stringify(d)))&&typeof d.audio=="object"){let g=function(y,v,R){v in y&&!(R in y)&&(y[R]=y[v],delete y[v])};g((d=JSON.parse(JSON.stringify(d))).audio,"autoGainControl","googAutoGainControl"),g(d.audio,"noiseSuppression","googNoiseSuppression"),d.audio=s(d.audio)}if(d&&typeof d.video=="object"){let g=d.video.facingMode;g=g&&(typeof g=="object"?g:{ideal:g});let y=t.version<66;if(g&&(g.exact==="user"||g.exact==="environment"||g.ideal==="user"||g.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||y)){let v;if(delete d.video.facingMode,g.exact==="environment"||g.ideal==="environment"?v=["back","rear"]:g.exact!=="user"&&g.ideal!=="user"||(v=["front"]),v)return n.mediaDevices.enumerateDevices().then(R=>{R=R.filter(A=>A.kind==="videoinput");let b=R.find(A=>v.some(F=>{var M;return ke(M=A.label.toLowerCase()).call(M,F)}));return!b&&R.length&&ke(v).call(v,"back")&&(b=R[R.length-1]),b&&(d.video.deviceId=g.exact?{exact:b.deviceId}:{ideal:b.deviceId}),d.video=s(d.video),pj("chrome: "+JSON.stringify(d)),f(d)})}d.video=s(d.video)}return pj("chrome: "+JSON.stringify(d)),f(d)},u=function(d){return t.version>=64?d:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[d.name]||d.name,message:d.message,constraint:d.constraint||d.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(d,f,g){o(d,y=>{n.webkitGetUserMedia(y,f,v=>{g&&g(u(v))})})}).bind(n),n.mediaDevices.getUserMedia){let d=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(f){return o(f,g=>d(g).then(y=>{if(g.audio&&!y.getAudioTracks().length||g.video&&!y.getVideoTracks().length)throw y.getTracks().forEach(v=>{v.stop()}),new DOMException("","NotFoundError");return y},y=>We.reject(u(y))))}}}function mj(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function gj(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",s=>{let o;o=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(d=>d.track&&d.track.id===s.track.id):{track:s.track};let u=new Event("track");u.track=s.track,u.receiver=o,u.transceiver={receiver:o},u.streams=[n.stream],this.dispatchEvent(u)}),n.stream.getTracks().forEach(s=>{let o;o=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(d=>d.track&&d.track.id===s.id):{track:s};let u=new Event("track");u.track=s,u.receiver=o,u.transceiver={receiver:o},u.streams=[n.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else wm(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function _j(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(o,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=o.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:o}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let o=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(d,f){let g=o.apply(this,arguments);return g||(g=t(this,d),this._senders.push(g)),g};let u=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(d){u.apply(this,arguments);let f=this._senders.indexOf(d);f!==-1&&this._senders.splice(f,1)}}let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(u=>{this._senders.push(t(this,u))})};let s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],s.apply(this,[o]),o.getTracks().forEach(u=>{let d=this._senders.find(f=>f.track===u);d&&this._senders.splice(this._senders.indexOf(d),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let n=t.apply(this,[]);return n.forEach(s=>s._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Ej(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[n,s,o]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);let u=function(f){let g={};return f.result().forEach(y=>{let v={id:y.id,timestamp:y.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[y.type]||y.type};y.names().forEach(R=>{v[R]=y.stat(R)}),g[v.id]=v}),g},d=function(f){return new Map(Object.keys(f).map(g=>[g,f[g]]))};if(arguments.length>=2){let f=function(g){s(d(u(g)))};return t.apply(this,[f,n])}return new We((f,g)=>{t.apply(this,[function(y){f(d(u(y)))},g])}).then(s,o)}}function yj(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){let o=n.apply(this,[]);return o.forEach(u=>u._pc=this),o});let s=e.RTCPeerConnection.prototype.addTrack;s&&(e.RTCPeerConnection.prototype.addTrack=function(){let o=s.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){let o=this;return this._pc.getStats().then(u=>hj(u,o.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){let s=n.apply(this,[]);return s.forEach(o=>o._pc=this),s}),wm(e,"track",s=>(s.receiver._pc=s.srcElement,s)),e.RTCRtpReceiver.prototype.getStats=function(){let s=this;return this._pc.getStats().then(o=>hj(o,s.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let n=arguments[0],s,o,u;return this.getSenders().forEach(d=>{d.track===n&&(s?u=!0:s=d)}),this.getReceivers().forEach(d=>(d.track===n&&(o?u=!0:o=d),d.track===n)),u||s&&o?We.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():o?o.getStats():We.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function vj(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(u,d){if(!d)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let f=t.apply(this,arguments);return this._shimmedLocalStreams[d.id]?this._shimmedLocalStreams[d.id].indexOf(f)===-1&&this._shimmedLocalStreams[d.id].push(f):this._shimmedLocalStreams[d.id]=[d,f],f};let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(g=>{if(this.getSenders().find(y=>y.track===g))throw new DOMException("Track already exists.","InvalidAccessError")});let d=this.getSenders();n.apply(this,arguments);let f=this.getSenders().filter(g=>d.indexOf(g)===-1);this._shimmedLocalStreams[u.id]=[u].concat(f)};let s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],s.apply(this,arguments)};let o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(d=>{let f=this._shimmedLocalStreams[d].indexOf(u);f!==-1&&this._shimmedLocalStreams[d].splice(f,1),this._shimmedLocalStreams[d].length===1&&delete this._shimmedLocalStreams[d]}),o.apply(this,arguments)}}function Sj(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return vj(e);let n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let g=n.apply(this);return this._reverseStreams=this._reverseStreams||{},g.map(y=>this._reverseStreams[y.id])};let s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(g){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},g.getTracks().forEach(y=>{if(this.getSenders().find(v=>v.track===y))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[g.id]){let y=new e.MediaStream(g.getTracks());this._streams[g.id]=y,this._reverseStreams[y.id]=g,g=y}s.apply(this,[g])};let o=e.RTCPeerConnection.prototype.removeStream;function u(g,y){let v=y.sdp;return Object.keys(g._reverseStreams||[]).forEach(R=>{let b=g._reverseStreams[R],A=g._streams[b.id];v=v.replace(new RegExp(A.id,"g"),b.id)}),new RTCSessionDescription({type:y.type,sdp:v})}e.RTCPeerConnection.prototype.removeStream=function(g){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[g.id]||g]),delete this._reverseStreams[this._streams[g.id]?this._streams[g.id].id:g.id],delete this._streams[g.id]},e.RTCPeerConnection.prototype.addTrack=function(g,y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let v=[].slice.call(arguments,1);if(v.length!==1||!v[0].getTracks().find(b=>b===g))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(b=>b.track===g))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let R=this._streams[y.id];if(R)R.addTrack(g),We.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let b=new e.MediaStream([g]);this._streams[y.id]=b,this._reverseStreams[b.id]=y,this.addStream(b)}return this.getSenders().find(b=>b.track===g)},["createOffer","createAnswer"].forEach(function(g){let y=e.RTCPeerConnection.prototype[g],v={[g](){let R=arguments;return arguments.length&&typeof arguments[0]=="function"?y.apply(this,[b=>{let A=u(this,b);R[0].apply(null,[A])},b=>{R[1]&&R[1].apply(null,b)},arguments[2]]):y.apply(this,arguments).then(b=>u(this,b))}};e.RTCPeerConnection.prototype[g]=v[g]});let d=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(function(g,y){let v=y.sdp;return Object.keys(g._reverseStreams||[]).forEach(R=>{let b=g._reverseStreams[R],A=g._streams[b.id];v=v.replace(new RegExp(b.id,"g"),A.id)}),new RTCSessionDescription({type:y.type,sdp:v})})(this,arguments[0]),d.apply(this,arguments)):d.apply(this,arguments)};let f=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let g=f.get.apply(this);return g.type===""?g:u(this,g)}}),e.RTCPeerConnection.prototype.removeTrack=function(g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!g._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(g._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let y;this._streams=this._streams||{},Object.keys(this._streams).forEach(v=>{this._streams[v].getTracks().find(R=>g.track===R)&&(y=this._streams[v])}),y&&(y.getTracks().length===1?this.removeStream(this._reverseStreams[y.id]):y.removeTrack(g.track),this.dispatchEvent(new Event("negotiationneeded")))}}function QP(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){let s=e.RTCPeerConnection.prototype[n],o={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=o[n]})}function Tj(e,t){wm(e,"negotiationneeded",n=>{let s=n.target;if(!(t.version<72||s.getConfiguration&&s.getConfiguration().sdpSemantics==="plan-b")||s.signalingState==="stable")return n})}var wj=Object.freeze({__proto__:null,fixNegotiationNeeded:Tj,shimAddTrackRemoveTrack:Sj,shimAddTrackRemoveTrackWithNative:vj,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(s=>{let o=n.video&&n.video.width,u=n.video&&n.video.height,d=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxFrameRate:d||3}},o&&(n.video.mandatory.maxWidth=o),u&&(n.video.mandatory.maxHeight=u),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:_j,shimGetStats:Ej,shimGetUserMedia:fj,shimMediaStream:mj,shimOnTrack:gj,shimPeerConnection:QP,shimSenderReceiverGetStats:yj});function Cj(e,t){let n=e&&e.navigator,s=e&&e.MediaStreamTrack;if(n.getUserMedia=function(o,u,d){JP("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(o).then(u,d)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){let o=function(d,f,g){f in d&&!(g in d)&&(d[g]=d[f],delete d[f])},u=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(d){return typeof d=="object"&&typeof d.audio=="object"&&(d=JSON.parse(JSON.stringify(d)),o(d.audio,"autoGainControl","mozAutoGainControl"),o(d.audio,"noiseSuppression","mozNoiseSuppression")),u(d)},s&&s.prototype.getSettings){let d=s.prototype.getSettings;s.prototype.getSettings=function(){let f=d.apply(this,arguments);return o(f,"mozAutoGainControl","autoGainControl"),o(f,"mozNoiseSuppression","noiseSuppression"),f}}if(s&&s.prototype.applyConstraints){let d=s.prototype.applyConstraints;s.prototype.applyConstraints=function(f){return this.kind==="audio"&&typeof f=="object"&&(f=JSON.parse(JSON.stringify(f)),o(f,"autoGainControl","mozAutoGainControl"),o(f,"noiseSuppression","mozNoiseSuppression")),d.apply(this,[f])}}}}function Rj(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ZP(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){let u=e.RTCPeerConnection.prototype[o],d={[o](){return arguments[0]=new(o==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};e.RTCPeerConnection.prototype[o]=d[o]});let n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[o,u,d]=arguments;return s.apply(this,[o||null]).then(f=>{if(t.version<53&&!u)try{f.forEach(g=>{g.type=n[g.type]||g.type})}catch(g){if(g.name!=="TypeError")throw g;f.forEach((y,v)=>{f.set(v,Object.assign({},y,{type:n[y.type]||y.type}))})}return f}).then(u,d)}}function bj(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let s=t.apply(this,[]);return s.forEach(o=>o._pc=this),s});let n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){let s=n.apply(this,arguments);return s._pc=this,s}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):We.resolve(new Map)}}function Ij(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let n=t.apply(this,[]);return n.forEach(s=>s._pc=this),n}),wm(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Aj(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){JP("removeStream","removeTrack"),this.getSenders().forEach(n=>{var s;n.track&&ke(s=t.getTracks()).call(s,n.track)&&this.removeTrack(n)})})}function Oj(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Nj(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];let s=n.length>0;s&&n.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let o=t.apply(this,arguments);if(s){let{sender:u}=o,d=u.getParameters();(!("encodings"in d)||d.encodings.length===1&&Object.keys(d.encodings[0]).length===0)&&(d.encodings=n,u.sendEncodings=n,this.setParametersPromises.push(u.setParameters(d).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return o})}function Pj(e){if(typeof e!="object"||!e.RTCRtpSender)return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function kj(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?We.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function Dj(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?We.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var xj=Object.freeze({__proto__:null,shimAddTransceiver:Nj,shimCreateAnswer:Dj,shimCreateOffer:kj,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){let s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,We.reject(s)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:Pj,shimGetUserMedia:Cj,shimOnTrack:Rj,shimPeerConnection:ZP,shimRTCDataChannel:Oj,shimReceiverGetStats:Ij,shimRemoveStream:Aj,shimSenderGetStats:bj});function Lj(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){var s;this._localStreams||(this._localStreams=[]),ke(s=this._localStreams).call(s,n)||this._localStreams.push(n),n.getAudioTracks().forEach(o=>t.call(this,o,n)),n.getVideoTracks().forEach(o=>t.call(this,o,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var s=arguments.length,o=new Array(s>1?s-1:0),u=1;u<s;u++)o[u-1]=arguments[u];return o&&o.forEach(d=>{var f;this._localStreams?ke(f=this._localStreams).call(f,d)||this._localStreams.push(d):this._localStreams=[d]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);let n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);let s=t.getTracks();this.getSenders().forEach(o=>{ke(s).call(s,o.track)&&this.removeTrack(o)})})}}function Mj(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=s=>{s.streams.forEach(o=>{var u;if(this._remoteStreams||(this._remoteStreams=[]),ke(u=this._remoteStreams).call(u,o))return;this._remoteStreams.push(o);let d=new Event("addstream");d.stream=o,this.dispatchEvent(d)})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(o=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(o)>=0)return;n._remoteStreams.push(o);let u=new Event("addstream");u.stream=o,n.dispatchEvent(u)})}),t.apply(n,arguments)}}}function Uj(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,n=t.createOffer,s=t.createAnswer,o=t.setLocalDescription,u=t.setRemoteDescription,d=t.addIceCandidate;t.createOffer=function(g,y){let v=arguments.length>=2?arguments[2]:arguments[0],R=n.apply(this,[v]);return y?(R.then(g,y),We.resolve()):R},t.createAnswer=function(g,y){let v=arguments.length>=2?arguments[2]:arguments[0],R=s.apply(this,[v]);return y?(R.then(g,y),We.resolve()):R};let f=function(g,y,v){let R=o.apply(this,[g]);return v?(R.then(y,v),We.resolve()):R};t.setLocalDescription=f,f=function(g,y,v){let R=u.apply(this,[g]);return v?(R.then(y,v),We.resolve()):R},t.setRemoteDescription=f,f=function(g,y,v){let R=d.apply(this,[g]);return v?(R.then(y,v),We.resolve()):R},t.addIceCandidate=f}function Vj(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let n=t.mediaDevices,s=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=o=>s(Fj(o))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(n,s,o){t.mediaDevices.getUserMedia(n).then(s,o)}).bind(t))}function Fj(e){return e&&e.video!==void 0?Object.assign({},e,{video:dj(e.video)}):e}function jj(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,s){if(n&&n.iceServers){let o=[];for(let u=0;u<n.iceServers.length;u++){let d=n.iceServers[u];!d.hasOwnProperty("urls")&&d.hasOwnProperty("url")?(JP("RTCIceServer.url","RTCIceServer.urls"),d=JSON.parse(JSON.stringify(d)),d.urls=d.url,delete d.url,o.push(d)):o.push(n.iceServers[u])}n.iceServers=o}return new t(n,s)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Bj(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Wj(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);let s=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):n.offerToReceiveAudio!==!0||s||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);let o=this.getTransceivers().find(u=>u.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):n.offerToReceiveVideo!==!0||o||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Gj(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Hj=Object.freeze({__proto__:null,shimAudioContext:Gj,shimCallbacksAPI:Uj,shimConstraints:Fj,shimCreateOfferLegacy:Wj,shimGetUserMedia:Vj,shimLocalStreamsAPI:Lj,shimRTCIceServerUrls:jj,shimRemoteStreamsAPI:Mj,shimTrackEventTransceiver:Bj}),zj=`	
\v\f\r \u2028\u2029\uFEFF`,Cae=Mr,Rae=ea,e1=zj,Kj=I("".replace),bae=RegExp("^["+e1+"]+"),Iae=RegExp("(^|[^"+e1+"])["+e1+"]+$"),Aae=function(e){return function(t){var n=Rae(Cae(t));return n=Kj(n,bae,""),n=Kj(n,Iae,"$1"),n}},Oae={trim:Aae()},Nae=D_.PROPER,Pae=h,Yj=zj,kae=Oae.trim;Sn({target:"String",proto:!0,forced:(function(e){return Pae(function(){return!!Yj[e]()||""[e]()!==""||Nae&&Yj[e].name!==e})})("trim")},{trim:function(){return kae(this)}});var Dae=Sa("String","trim"),xae=N,Lae=Dae,t1=String.prototype,Mae=function(e){var t=e.trim;return typeof e=="string"||e===t1||xae(t1,e)&&t===t1.trim?Lae:t},Bs=l(Mae),qj={exports:{}};(function(e){let t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(s=>s.trim())},t.splitSections=function(n){return n.split(`
m=`).map((s,o)=>(o>0?"m="+s:s).trim()+`\r
`)},t.getDescription=function(n){let s=t.splitSections(n);return s&&s[0]},t.getMediaSections=function(n){let s=t.splitSections(n);return s.shift(),s},t.matchPrefix=function(n,s){return t.splitLines(n).filter(o=>o.indexOf(s)===0)},t.parseCandidate=function(n){let s;s=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");let o={foundation:s[0],component:{1:"rtp",2:"rtcp"}[s[1]]||s[1],protocol:s[2].toLowerCase(),priority:parseInt(s[3],10),ip:s[4],address:s[4],port:parseInt(s[5],10),type:s[7]};for(let u=8;u<s.length;u+=2)switch(s[u]){case"raddr":o.relatedAddress=s[u+1];break;case"rport":o.relatedPort=parseInt(s[u+1],10);break;case"tcptype":o.tcpType=s[u+1];break;case"ufrag":o.ufrag=s[u+1],o.usernameFragment=s[u+1];break;default:o[s[u]]===void 0&&(o[s[u]]=s[u+1])}return o},t.writeCandidate=function(n){let s=[];s.push(n.foundation);let o=n.component;o==="rtp"?s.push(1):o==="rtcp"?s.push(2):s.push(o),s.push(n.protocol.toUpperCase()),s.push(n.priority),s.push(n.address||n.ip),s.push(n.port);let u=n.type;return s.push("typ"),s.push(u),u!=="host"&&n.relatedAddress&&n.relatedPort&&(s.push("raddr"),s.push(n.relatedAddress),s.push("rport"),s.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(s.push("tcptype"),s.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(s.push("ufrag"),s.push(n.usernameFragment||n.ufrag)),"candidate:"+s.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let s=n.substring(9).split(" "),o={payloadType:parseInt(s.shift(),10)};return s=s[0].split("/"),o.name=s[0],o.clockRate=parseInt(s[1],10),o.channels=s.length===3?parseInt(s[2],10):1,o.numChannels=o.channels,o},t.writeRtpMap=function(n){let s=n.payloadType;n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType);let o=n.channels||n.numChannels||1;return"a=rtpmap:"+s+" "+n.name+"/"+n.clockRate+(o!==1?"/"+o:"")+`\r
`},t.parseExtmap=function(n){let s=n.substring(9).split(" ");return{id:parseInt(s[0],10),direction:s[0].indexOf("/")>0?s[0].split("/")[1]:"sendrecv",uri:s[1],attributes:s.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){let s={},o,u=n.substring(n.indexOf(" ")+1).split(";");for(let d=0;d<u.length;d++)o=u[d].trim().split("="),s[o[0].trim()]=o[1];return s},t.writeFmtp=function(n){let s="",o=n.payloadType;if(n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){let u=[];Object.keys(n.parameters).forEach(d=>{n.parameters[d]!==void 0?u.push(d+"="+n.parameters[d]):u.push(d)}),s+="a=fmtp:"+o+" "+u.join(";")+`\r
`}return s},t.parseRtcpFb=function(n){let s=n.substring(n.indexOf(" ")+1).split(" ");return{type:s.shift(),parameter:s.join(" ")}},t.writeRtcpFb=function(n){let s="",o=n.payloadType;return n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(u=>{s+="a=rtcp-fb:"+o+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),s},t.parseSsrcMedia=function(n){let s=n.indexOf(" "),o={ssrc:parseInt(n.substring(7,s),10)},u=n.indexOf(":",s);return u>-1?(o.attribute=n.substring(s+1,u),o.value=n.substring(u+1)):o.attribute=n.substring(s+1),o},t.parseSsrcGroup=function(n){let s=n.substring(13).split(" ");return{semantics:s.shift(),ssrcs:s.map(o=>parseInt(o,10))}},t.getMid=function(n){let s=t.matchPrefix(n,"a=mid:")[0];if(s)return s.substring(6)},t.parseFingerprint=function(n){let s=n.substring(14).split(" ");return{algorithm:s[0].toLowerCase(),value:s[1].toUpperCase()}},t.getDtlsParameters=function(n,s){return{role:"auto",fingerprints:t.matchPrefix(n+s,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,s){let o="a=setup:"+s+`\r
`;return n.fingerprints.forEach(u=>{o+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),o},t.parseCryptoLine=function(n){let s=n.substring(9).split(" ");return{tag:parseInt(s[0],10),cryptoSuite:s[1],keyParams:s[2],sessionParams:s.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;let s=n.substring(7).split("|");return{keyMethod:"inline",keySalt:s[0],lifeTime:s[1],mkiValue:s[2]?s[2].split(":")[0]:void 0,mkiLength:s[2]?s[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,s){return t.matchPrefix(n+s,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,s){let o=t.matchPrefix(n+s,"a=ice-ufrag:")[0],u=t.matchPrefix(n+s,"a=ice-pwd:")[0];return o&&u?{usernameFragment:o.substring(12),password:u.substring(10)}:null},t.writeIceParameters=function(n){let s="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(s+=`a=ice-lite\r
`),s},t.parseRtpParameters=function(n){let s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=t.splitLines(n)[0].split(" ");s.profile=o[2];for(let d=3;d<o.length;d++){let f=o[d],g=t.matchPrefix(n,"a=rtpmap:"+f+" ")[0];if(g){let y=t.parseRtpMap(g),v=t.matchPrefix(n,"a=fmtp:"+f+" ");switch(y.parameters=v.length?t.parseFmtp(v[0]):{},y.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+f+" ").map(t.parseRtcpFb),s.codecs.push(y),y.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(y.name.toUpperCase())}}}t.matchPrefix(n,"a=extmap:").forEach(d=>{s.headerExtensions.push(t.parseExtmap(d))});let u=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return s.codecs.forEach(d=>{u.forEach(f=>{d.rtcpFeedback.find(g=>g.type===f.type&&g.parameter===f.parameter)||d.rtcpFeedback.push(f)})}),s},t.writeRtpDescription=function(n,s){let o="";o+="m="+n+" ",o+=s.codecs.length>0?"9":"0",o+=" "+(s.profile||"UDP/TLS/RTP/SAVPF")+" ",o+=s.codecs.map(d=>d.preferredPayloadType!==void 0?d.preferredPayloadType:d.payloadType).join(" ")+`\r
`,o+=`c=IN IP4 0.0.0.0\r
`,o+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,s.codecs.forEach(d=>{o+=t.writeRtpMap(d),o+=t.writeFmtp(d),o+=t.writeRtcpFb(d)});let u=0;return s.codecs.forEach(d=>{d.maxptime>u&&(u=d.maxptime)}),u>0&&(o+="a=maxptime:"+u+`\r
`),s.headerExtensions&&s.headerExtensions.forEach(d=>{o+=t.writeExtmap(d)}),o},t.parseRtpEncodingParameters=function(n){let s=[],o=t.parseRtpParameters(n),u=o.fecMechanisms.indexOf("RED")!==-1,d=o.fecMechanisms.indexOf("ULPFEC")!==-1,f=t.matchPrefix(n,"a=ssrc:").map(b=>t.parseSsrcMedia(b)).filter(b=>b.attribute==="cname"),g=f.length>0&&f[0].ssrc,y,v=t.matchPrefix(n,"a=ssrc-group:FID").map(b=>b.substring(17).split(" ").map(A=>parseInt(A,10)));v.length>0&&v[0].length>1&&v[0][0]===g&&(y=v[0][1]),o.codecs.forEach(b=>{if(b.name.toUpperCase()==="RTX"&&b.parameters.apt){let A={ssrc:g,codecPayloadType:parseInt(b.parameters.apt,10)};g&&y&&(A.rtx={ssrc:y}),s.push(A),u&&(A=JSON.parse(JSON.stringify(A)),A.fec={ssrc:g,mechanism:d?"red+ulpfec":"red"},s.push(A))}}),s.length===0&&g&&s.push({ssrc:g});let R=t.matchPrefix(n,"b=");return R.length&&(R=R[0].indexOf("b=TIAS:")===0?parseInt(R[0].substring(7),10):R[0].indexOf("b=AS:")===0?1e3*parseInt(R[0].substring(5),10)*.95-16e3:void 0,s.forEach(b=>{b.maxBitrate=R})),s},t.parseRtcpParameters=function(n){let s={},o=t.matchPrefix(n,"a=ssrc:").map(f=>t.parseSsrcMedia(f)).filter(f=>f.attribute==="cname")[0];o&&(s.cname=o.value,s.ssrc=o.ssrc);let u=t.matchPrefix(n,"a=rtcp-rsize");s.reducedSize=u.length>0,s.compound=u.length===0;let d=t.matchPrefix(n,"a=rtcp-mux");return s.mux=d.length>0,s},t.writeRtcpParameters=function(n){let s="";return n.reducedSize&&(s+=`a=rtcp-rsize\r
`),n.mux&&(s+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(s+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),s},t.parseMsid=function(n){let s,o=t.matchPrefix(n,"a=msid:");if(o.length===1)return s=o[0].substring(7).split(" "),{stream:s[0],track:s[1]};let u=t.matchPrefix(n,"a=ssrc:").map(d=>t.parseSsrcMedia(d)).filter(d=>d.attribute==="msid");return u.length>0?(s=u[0].value.split(" "),{stream:s[0],track:s[1]}):void 0},t.parseSctpDescription=function(n){let s=t.parseMLine(n),o=t.matchPrefix(n,"a=max-message-size:"),u;o.length>0&&(u=parseInt(o[0].substring(19),10)),isNaN(u)&&(u=65536);let d=t.matchPrefix(n,"a=sctp-port:");if(d.length>0)return{port:parseInt(d[0].substring(12),10),protocol:s.fmt,maxMessageSize:u};let f=t.matchPrefix(n,"a=sctpmap:");if(f.length>0){let g=f[0].substring(10).split(" ");return{port:parseInt(g[0],10),protocol:g[1],maxMessageSize:u}}},t.writeSctpDescription=function(n,s){let o=[];return o=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+s.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+s.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+s.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+s.port+" "+s.protocol+` 65535\r
`],s.maxMessageSize!==void 0&&o.push("a=max-message-size:"+s.maxMessageSize+`\r
`),o.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,s,o){let u,d=s!==void 0?s:2;return u=n||t.generateSessionId(),`v=0\r
o=`+(o||"thisisadapterortc")+" "+u+" "+d+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,s){let o=t.splitLines(n);for(let u=0;u<o.length;u++)switch(o[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return o[u].substring(2)}return s?t.getDirection(s):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){let s=t.splitLines(n)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},t.parseOLine=function(n){let s=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;let s=t.splitLines(n);for(let o=0;o<s.length;o++)if(s[o].length<2||s[o].charAt(1)!=="=")return!1;return!0},e.exports=t})(qj);var Xj=qj.exports,hE=l(Xj),Uae=a({__proto__:null,default:hE},[Xj]);function MR(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){let s=new t(n),o=hE.parseCandidate(n.candidate),u=Object.assign(s,o);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,wm(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function n1(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||wm(e,"icecandidate",t=>{if(t.candidate){let n=hE.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function UR(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});let n=function(f){if(!f||!f.sdp)return!1;let g=hE.splitSections(f.sdp);return g.shift(),g.some(y=>{let v=hE.parseMLine(y);return v&&v.kind==="application"&&v.protocol.indexOf("SCTP")!==-1})},s=function(f){let g=f.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(g===null||g.length<2)return-1;let y=parseInt(g[1],10);return y!=y?-1:y},o=function(f){let g=65536;return t.browser==="firefox"&&(g=t.version<57?f===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),g},u=function(f,g){let y=65536;t.browser==="firefox"&&t.version===57&&(y=65535);let v=hE.matchPrefix(f.sdp,"a=max-message-size:");return v.length>0?y=parseInt(v[0].substr(19),10):t.browser==="firefox"&&g!==-1&&(y=2147483637),y},d=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){let{sdpSemantics:f}=this.getConfiguration();f==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){let f=s(arguments[0]),g=o(f),y=u(arguments[0],f),v;v=g===0&&y===0?Number.POSITIVE_INFINITY:g===0||y===0?Math.max(g,y):Math.min(g,y);let R={};Object.defineProperty(R,"maxMessageSize",{get:()=>v}),this._sctp=R}return d.apply(this,arguments)}}function VR(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(s,o){let u=s.send;s.send=function(){let d=arguments[0],f=d.length||d.size||d.byteLength;if(s.readyState==="open"&&o.sctp&&f>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return u.apply(s,arguments)}}let n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let s=n.apply(this,arguments);return t(s,this),s},wm(e,"datachannel",s=>(t(s.channel,s.target),s))}function r1(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{let s=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=o=>{let u=o.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;let d=new Event("connectionstatechange",o);u.dispatchEvent(d)}return o},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),s.apply(this,arguments)}})}function i1(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;let n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let o=s.sdp.split(`
`).filter(u=>Bs(u).call(u)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&s instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:s.type,sdp:o}):s.sdp=o}return n.apply(this,arguments)}}function FR(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?We.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),We.resolve())})}function jR(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return n.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer"}return s.sdp||s.type!=="offer"&&s.type!=="answer"?n.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}var Vae=Object.freeze({__proto__:null,removeExtmapAllowMixed:i1,shimAddIceCandidateNullOrEmpty:FR,shimConnectionState:r1,shimMaxMessageSize:UR,shimParameterlessSetLocalDescription:jR,shimRTCIceCandidate:MR,shimRTCIceCandidateRelayProtocol:n1,shimSendThrowTypeError:VR});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},n=lj,s=(function(u){let d={browser:null,version:null};if(u===void 0||!u.navigator)return d.browser="Not a browser.",d;let{navigator:f}=u;if(f.mozGetUserMedia)d.browser="firefox",d.version=LR(f.userAgent,/Firefox\/(\d+)\./,1);else if(f.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection)d.browser="chrome",d.version=LR(f.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!u.RTCPeerConnection||!f.userAgent.match(/AppleWebKit\/(\d+)\./))return d.browser="Not a supported browser.",d;d.browser="safari",d.version=LR(f.userAgent,/AppleWebKit\/(\d+)\./,1),d.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return d})(e),o={browserDetails:s,commonShim:Vae,extractVersion:LR,disableLog:Tae,disableWarnings:wae,sdp:Uae};switch(s.browser){case"chrome":if(!wj||!QP||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),o;if(s.version===null)return n("Chrome shim can not determine version, not shimming."),o;n("adapter.js shimming chrome."),o.browserShim=wj,FR(e,s),jR(e),fj(e,s),mj(e),QP(e,s),gj(e),Sj(e,s),_j(e),Ej(e),yj(e),Tj(e,s),MR(e),n1(e),r1(e),UR(e,s),VR(e),i1(e,s);break;case"firefox":if(!xj||!ZP||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),o;n("adapter.js shimming firefox."),o.browserShim=xj,FR(e,s),jR(e),Cj(e,s),ZP(e,s),Rj(e),Aj(e),bj(e),Ij(e),Oj(e),Nj(e),Pj(e),kj(e),Dj(e),MR(e),r1(e),UR(e,s),VR(e);break;case"safari":if(!Hj||!t.shimSafari)return n("Safari shim is not included in this adapter release."),o;n("adapter.js shimming safari."),o.browserShim=Hj,FR(e,s),jR(e),jj(e),Wj(e),Uj(e),Lj(e),Mj(e),Bj(e),Vj(e),Gj(e),MR(e),n1(e),UR(e,s),VR(e),i1(e,s);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var Fae=h,Jj=H.RegExp,jae=!Fae(function(){var e=!0;try{Jj(".","d")}catch{e=!1}var t={},n="",s=e?"dgimsy":"gimsy",o=function(f,g){Object.defineProperty(t,f,{get:function(){return n+=g,!0}})},u={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var d in e&&(u.hasIndices="d"),u)o(d,u[d]);return Object.getOwnPropertyDescriptor(Jj.prototype,"flags").get.call(t)!==s||n!==s}),Bae=Is,Wae=Ge,Gae=Ur,Hae=N,$j={correct:jae},zae=function(){var e=Bae(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},Kae=RegExp.prototype,s1=$j.correct?function(e){return e.flags}:function(e){return $j.correct||!Hae(Kae,e)||Gae(e,"flags")?e.flags:Wae(zae,e)},a1=I,Yae=Math.floor,o1=a1("".charAt),qae=a1("".replace),c1=a1("".slice),Xae=/\$([$&'`]|\d{1,2})/g,Jae=Sn,$ae=Ge,l1=I,Qj=Mr,Qae=Se,Zae=Wr,eoe=i_,pE=ea,toe=je,noe=s1,roe=function(e,t,n,s,o,u){var d=n+e.length,f=s.length,g=Xae;return qae(u,g,function(y,v){var R;switch(o1(v,0)){case"$":return"$";case"&":return e;case"`":return c1(t,0,n);case"'":return c1(t,d);case"<":R=o[c1(v,1,-1)];break;default:var b=+v;if(b===0)return y;if(b>f){var A=Yae(b/10);return A===0?y:A<=f?s[A-1]===void 0?o1(v,1):s[A-1]+o1(v,1):y}R=s[b-1]}return R===void 0?"":R})},ioe=Er("replace"),soe=TypeError,u1=l1("".indexOf),aoe=l1("".replace),Zj=l1("".slice),ooe=Math.max;Jae({target:"String",proto:!0},{replaceAll:function(e,t){var n,s,o,u,d,f,g,y,v,R,b=Qj(this),A=0,F="";if(Zae(e)){if((n=eoe(e))&&(s=pE(Qj(noe(e))),!~u1(s,"g")))throw new soe("`.replaceAll` does not allow non-global regexes");if(o=toe(e,ioe))return $ae(o,e,b,t);if(n)return aoe(pE(b),e,t)}for(u=pE(b),d=pE(e),(f=Qae(t))||(t=pE(t)),g=d.length,y=ooe(1,g),v=u1(u,d);v!==-1;)R=f?pE(t(d,v,u)):roe(d,u,v,[],void 0,t),F+=Zj(u,A,v)+R,A=v+g,v=v+y>u.length?-1:u1(u,d,v+y);return A<u.length&&(F+=Zj(u,A)),F}});var coe=Sa("String","replaceAll"),loe=N,uoe=coe,d1=String.prototype,doe=function(e){var t=e.replaceAll;return typeof e=="string"||e===d1||loe(d1,e)&&t===d1.replaceAll?uoe:t},hoe=l(doe),h1=H;Sn({global:!0,forced:h1.globalThis!==h1},{globalThis:h1});var e3=l(H),p1={exports:{}};(function(e,t){(function(n,s){var o="function",u="undefined",d="object",f="string",g="major",y="model",v="name",R="type",b="vendor",A="version",F="architecture",M="console",j="mobile",K="tablet",q="smarttv",Q="wearable",se="embedded",oe="Amazon",ne="Apple",de="ASUS",we="BlackBerry",Oe="Browser",Qe="Chrome",at="Firefox",Xt="Google",Lt="Honor",jt="Huawei",En="LG",lr="Microsoft",Ce="Motorola",Ve="Nvidia",Ze="OnePlus",Ae="Opera",L="OPPO",J="Samsung",ie="Sharp",Me="Sony",Rt="Xiaomi",Jn="Zebra",Ai="Facebook",ic="Chromium OS",Lp="Mac OS",jI=" Browser",cy=function(ni){for(var ui={},er=0;er<ni.length;er++)ui[ni[er].toUpperCase()]=ni[er];return ui},BI=function(ni,ui){return typeof ni===f&&ag(ui).indexOf(ag(ni))!==-1},ag=function(ni){return ni.toLowerCase()},m0=function(ni,ui){if(typeof ni===f)return ni=ni.replace(/^\s\s*/,""),typeof ui===u?ni:ni.substring(0,500)},og=function(ni,ui){for(var er,Pa,tu,jr,ch,un,nu=0;nu<ui.length&&!ch;){var cg=ui[nu],ud=ui[nu+1];for(er=Pa=0;er<cg.length&&!ch&&cg[er];)if(ch=cg[er++].exec(ni))for(tu=0;tu<ud.length;tu++)un=ch[++Pa],typeof(jr=ud[tu])===d&&jr.length>0?jr.length===2?typeof jr[1]==o?this[jr[0]]=jr[1].call(this,un):this[jr[0]]=jr[1]:jr.length===3?typeof jr[1]!==o||jr[1].exec&&jr[1].test?this[jr[0]]=un?un.replace(jr[1],jr[2]):s:this[jr[0]]=un?jr[1].call(this,un,jr[2]):s:jr.length===4&&(this[jr[0]]=un?jr[3].call(this,un.replace(jr[1],jr[2])):s):this[jr]=un||s;nu+=2}},Mp=function(ni,ui){for(var er in ui)if(typeof ui[er]===d&&ui[er].length>0){for(var Pa=0;Pa<ui[er].length;Pa++)if(BI(ui[er][Pa],ni))return er==="?"?s:er}else if(BI(ui[er],ni))return er==="?"?s:er;return ui.hasOwnProperty("*")?ui["*"]:ni},Bz={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Wz={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[A,[v,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[A,[v,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[v,A],[/opios[\/ ]+([\w\.]+)/i],[A,[v,Ae+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[A,[v,Ae+" GX"]],[/\bopr\/([\w\.]+)/i],[A,[v,Ae]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[A,[v,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[A,[v,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[v,A],[/quark(?:pc)?\/([-\w\.]+)/i],[A,[v,"Quark"]],[/\bddg\/([\w\.]+)/i],[A,[v,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[A,[v,"UC"+Oe]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[A,[v,"WeChat"]],[/konqueror\/([\w\.]+)/i],[A,[v,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[A,[v,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[A,[v,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[A,[v,"Smart Lenovo "+Oe]],[/(avast|avg)\/([\w\.]+)/i],[[v,/(.+)/,"$1 Secure "+Oe],A],[/\bfocus\/([\w\.]+)/i],[A,[v,at+" Focus"]],[/\bopt\/([\w\.]+)/i],[A,[v,Ae+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[A,[v,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[A,[v,"Dolphin"]],[/coast\/([\w\.]+)/i],[A,[v,Ae+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[A,[v,"MIUI"+jI]],[/fxios\/([\w\.-]+)/i],[A,[v,at]],[/\bqihoobrowser\/?([\w\.]*)/i],[A,[v,"360"]],[/\b(qq)\/([\w\.]+)/i],[[v,/(.+)/,"$1Browser"],A],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[v,/(.+)/,"$1"+jI],A],[/samsungbrowser\/([\w\.]+)/i],[A,[v,J+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[A,[v,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[v,"Sogou Mobile"],A],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[v,A],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[v],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[A,v],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[v,Ai],A],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[v,A],[/\bgsa\/([\w\.]+) .*safari\//i],[A,[v,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[A,[v,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[A,[v,Qe+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[v,Qe+" WebView"],A],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[A,[v,"Android "+Oe]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[v,A],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[A,[v,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[A,v],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[v,[A,Mp,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[v,A],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[v,"Netscape"],A],[/(wolvic|librewolf)\/([\w\.]+)/i],[v,A],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[A,[v,at+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[v,[A,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[v,[A,/master.|lts./,""]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[F,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[F,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[F,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[F,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[F,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[F,/ower/,"",ag]],[/ sun4\w[;\)]/i],[[F,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[F,ag]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[y,[b,J],[R,K]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[y,[b,J],[R,j]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[y,[b,ne],[R,j]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[y,[b,ne],[R,K]],[/(macintosh);/i],[y,[b,ne]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[y,[b,ie],[R,j]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[y,[b,Lt],[R,K]],[/honor([-\w ]+)[;\)]/i],[y,[b,Lt],[R,j]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[y,[b,jt],[R,K]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[y,[b,jt],[R,j]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[y,/_/g," "],[b,Rt],[R,K]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[y,/_/g," "],[b,Rt],[R,j]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[y,[b,L],[R,j]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[y,[b,Mp,{OnePlus:["304","403","203"],"*":L}],[R,K]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[y,[b,"Vivo"],[R,j]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[y,[b,"Realme"],[R,j]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[y,[b,Ce],[R,j]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[y,[b,Ce],[R,K]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[y,[b,En],[R,K]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv|watch)\w+)/i,/\blg-?([\d\w]+) bui/i],[y,[b,En],[R,j]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[y,[b,"Lenovo"],[R,K]],[/(nokia) (t[12][01])/i],[b,y,[R,K]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[y,/_/g," "],[R,j],[b,"Nokia"]],[/(pixel (c|tablet))\b/i],[y,[b,Xt],[R,K]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[y,[b,Xt],[R,j]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[y,[b,Me],[R,j]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[y,"Xperia Tablet"],[b,Me],[R,K]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[y,[b,Ze],[R,j]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[y,[b,oe],[R,K]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[y,/(.+)/g,"Fire Phone $1"],[b,oe],[R,j]],[/(playbook);[-\w\),; ]+(rim)/i],[y,b,[R,K]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[y,[b,we],[R,j]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[y,[b,de],[R,K]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[y,[b,de],[R,j]],[/(nexus 9)/i],[y,[b,"HTC"],[R,K]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[b,[y,/_/g," "],[R,j]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[y,[b,"TCL"],[R,K]],[/(itel) ((\w+))/i],[[b,ag],y,[R,Mp,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[y,[b,"Acer"],[R,K]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[y,[b,"Meizu"],[R,j]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[y,[b,"Ulefone"],[R,j]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[y,[b,"Energizer"],[R,j]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[y,[b,"Cat"],[R,j]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[y,[b,"Smartfren"],[R,j]],[/droid.+; (a(?:015|06[35]|142p?))/i],[y,[b,"Nothing"],[R,j]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[y,[b,"Archos"],[R,K]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[y,[b,"Archos"],[R,j]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[b,y,[R,K]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (hmd|imo) ([\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[b,y,[R,j]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[b,y,[R,K]],[/(surface duo)/i],[y,[b,lr],[R,K]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[y,[b,"Fairphone"],[R,j]],[/(u304aa)/i],[y,[b,"AT&T"],[R,j]],[/\bsie-(\w*)/i],[y,[b,"Siemens"],[R,j]],[/\b(rct\w+) b/i],[y,[b,"RCA"],[R,K]],[/\b(venue[\d ]{2,7}) b/i],[y,[b,"Dell"],[R,K]],[/\b(q(?:mv|ta)\w+) b/i],[y,[b,"Verizon"],[R,K]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[y,[b,"Barnes & Noble"],[R,K]],[/\b(tm\d{3}\w+) b/i],[y,[b,"NuVision"],[R,K]],[/\b(k88) b/i],[y,[b,"ZTE"],[R,K]],[/\b(nx\d{3}j) b/i],[y,[b,"ZTE"],[R,j]],[/\b(gen\d{3}) b.+49h/i],[y,[b,"Swiss"],[R,j]],[/\b(zur\d{3}) b/i],[y,[b,"Swiss"],[R,K]],[/\b((zeki)?tb.*\b) b/i],[y,[b,"Zeki"],[R,K]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[b,"Dragon Touch"],y,[R,K]],[/\b(ns-?\w{0,9}) b/i],[y,[b,"Insignia"],[R,K]],[/\b((nxa|next)-?\w{0,9}) b/i],[y,[b,"NextBook"],[R,K]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[b,"Voice"],y,[R,j]],[/\b(lvtel\-)?(v1[12]) b/i],[[b,"LvTel"],y,[R,j]],[/\b(ph-1) /i],[y,[b,"Essential"],[R,j]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[y,[b,"Envizen"],[R,K]],[/\b(trio[-\w\. ]+) b/i],[y,[b,"MachSpeed"],[R,K]],[/\btu_(1491) b/i],[y,[b,"Rotor"],[R,K]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[y,[b,Ve],[R,K]],[/(sprint) (\w+)/i],[b,y,[R,j]],[/(kin\.[onetw]{3})/i],[[y,/\./g," "],[b,lr],[R,j]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[y,[b,Jn],[R,K]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[y,[b,Jn],[R,j]],[/smart-tv.+(samsung)/i],[b,[R,q]],[/hbbtv.+maple;(\d+)/i],[[y,/^/,"SmartTV"],[b,J],[R,q]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[b,En],[R,q]],[/(apple) ?tv/i],[b,[y,ne+" TV"],[R,q]],[/crkey/i],[[y,Qe+"cast"],[b,Xt],[R,q]],[/droid.+aft(\w+)( bui|\))/i],[y,[b,oe],[R,q]],[/(shield \w+ tv)/i],[y,[b,Ve],[R,q]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[y,[b,ie],[R,q]],[/(bravia[\w ]+)( bui|\))/i],[y,[b,Me],[R,q]],[/(mi(tv|box)-?\w+) bui/i],[y,[b,Rt],[R,q]],[/Hbbtv.*(technisat) (.*);/i],[b,y,[R,q]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[b,m0],[y,m0],[R,q]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[y,[R,q]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[R,q]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[b,y,[R,M]],[/droid.+; (shield)( bui|\))/i],[y,[b,Ve],[R,M]],[/(playstation \w+)/i],[y,[b,Me],[R,M]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[y,[b,lr],[R,M]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[y,[b,J],[R,Q]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[b,y,[R,Q]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[y,[b,L],[R,Q]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[y,[b,ne],[R,Q]],[/(opwwe\d{3})/i],[y,[b,Ze],[R,Q]],[/(moto 360)/i],[y,[b,Ce],[R,Q]],[/(smartwatch 3)/i],[y,[b,Me],[R,Q]],[/(g watch r)/i],[y,[b,En],[R,Q]],[/droid.+; (wt63?0{2,3})\)/i],[y,[b,Jn],[R,Q]],[/droid.+; (glass) \d/i],[y,[b,Xt],[R,Q]],[/(pico) (4|neo3(?: link|pro)?)/i],[b,y,[R,Q]],[/; (quest( \d| pro)?)/i],[y,[b,Ai],[R,Q]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[b,[R,se]],[/(aeobc)\b/i],[y,[b,oe],[R,se]],[/(homepod).+mac os/i],[y,[b,ne],[R,se]],[/windows iot/i],[[R,se]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[y,[R,j]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[y,[R,K]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[R,K]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[R,j]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[y,[b,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[A,[v,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[v,A],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[A,[v,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[v,A],[/ladybird\//i],[[v,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[A,v]],os:[[/microsoft (windows) (vista|xp)/i],[v,A],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[v,[A,Mp,Bz]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[A,Mp,Bz],[v,"Windows"]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[A,/_/g,"."],[v,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[v,Lp],[A,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[A,v],[/(ubuntu) ([\w\.]+) like android/i],[[v,/(.+)/,"$1 Touch"],A],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/; ]?([\d\.]*)/i],[v,A],[/\(bb(10);/i],[A,[v,we]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[A,[v,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[A,[v,at+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[A,[v,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[A,[v,"watchOS"]],[/crkey\/([\d\.]+)/i],[A,[v,Qe+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[v,ic],A],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[v,A],[/(sunos) ?([\w\.\d]*)/i],[[v,"Solaris"],A],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[v,A]]},eu=function(ni,ui){if(typeof ni===d&&(ui=ni,ni=s),!(this instanceof eu))return new eu(ni,ui).getResult();var er=typeof n!==u&&n.navigator?n.navigator:s,Pa=ni||(er&&er.userAgent?er.userAgent:""),tu=er&&er.userAgentData?er.userAgentData:s,jr=ui?(function(un,nu){var cg={};for(var ud in un)nu[ud]&&nu[ud].length%2==0?cg[ud]=nu[ud].concat(un[ud]):cg[ud]=un[ud];return cg})(Wz,ui):Wz,ch=er&&er.userAgent==Pa;return this.getBrowser=function(){var un={};return un[v]=s,un[A]=s,og.call(un,Pa,jr.browser),un[g]=(function(nu){return typeof nu===f?nu.replace(/[^\d\.]/g,"").split(".")[0]:s})(un[A]),ch&&er&&er.brave&&typeof er.brave.isBrave==o&&(un[v]="Brave"),un},this.getCPU=function(){var un={};return un[F]=s,og.call(un,Pa,jr.cpu),un},this.getDevice=function(){var un={};return un[b]=s,un[y]=s,un[R]=s,og.call(un,Pa,jr.device),ch&&!un[R]&&tu&&tu.mobile&&(un[R]=j),ch&&un[y]=="Macintosh"&&er&&typeof er.standalone!==u&&er.maxTouchPoints&&er.maxTouchPoints>2&&(un[y]="iPad",un[R]=K),un},this.getEngine=function(){var un={};return un[v]=s,un[A]=s,og.call(un,Pa,jr.engine),un},this.getOS=function(){var un={};return un[v]=s,un[A]=s,og.call(un,Pa,jr.os),ch&&!un[v]&&tu&&tu.platform&&tu.platform!="Unknown"&&(un[v]=tu.platform.replace(/chrome os/i,ic).replace(/macos/i,Lp)),un},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Pa},this.setUA=function(un){return Pa=typeof un===f&&un.length>500?m0(un,500):un,this},this.setUA(Pa),this};eu.VERSION="0.7.41",eu.BROWSER=cy([v,A,g]),eu.CPU=cy([F]),eu.DEVICE=cy([y,b,R,M,j,q,K,Q,se]),eu.ENGINE=eu.OS=cy([v,A]),e.exports&&(t=e.exports=eu),t.UAParser=eu;var ly=typeof n!==u&&(n.jQuery||n.Zepto);if(ly&&!ly.ua){var WI=new eu;ly.ua=WI.getResult(),ly.ua.get=function(){return WI.getUA()},ly.ua.set=function(ni){WI.setUA(ni);var ui=WI.getResult();for(var er in ui)ly.ua[er]=ui[er]}}})(typeof window=="object"?window:c)})(p1,p1.exports);var poe=l(p1.exports),t3=sp.clear;Sn({global:!0,bind:!0,forced:H.clearImmediate!==t3},{clearImmediate:t3});var n3=H,foe=$,moe=Se,goe=Uf,_oe=lt,Eoe=Bi,yoe=oo,voe=n3.Function,Soe=/MSIE .\./.test(_oe)||goe==="BUN"&&(function(){var e=n3.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")})(),Toe=Sn,r3=H,i3=sp.set,woe=function(e,t){var n=1;return Soe?function(s,o){var u=yoe(arguments.length,1)>n,d=moe(s)?s:voe(s),f=u?Eoe(arguments,n):[],g=u?function(){foe(d,this,f)}:d;return e(g)}:e},s3=r3.setImmediate?woe(i3):i3;Toe({global:!0,bind:!0,forced:r3.setImmediate!==s3},{setImmediate:s3});var a3=l(fi.setImmediate),Coe=H,Roe=tT,boe=kr,Ioe=oo,Aoe=Re;Sn({global:!0,dontCallGetSet:!0,forced:h(function(){return Aoe&&Object.getOwnPropertyDescriptor(Coe,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){Ioe(arguments.length,1),Roe(boe(e))}});var o3=l(fi.queueMicrotask);function c3(e,t){return function(){return e.apply(t,arguments)}}let{toString:Ooe}=Object.prototype,{getPrototypeOf:f1}=Object,{iterator:BR,toStringTag:l3}=Symbol,WR=(m1=Object.create(null),e=>{let t=Ooe.call(e);return m1[t]||(m1[t]=t.slice(8,-1).toLowerCase())});var m1;let Ml=e=>(e=e.toLowerCase(),t=>WR(t)===e),GR=e=>t=>typeof t===e,{isArray:fE}=Array,mE=GR("undefined");function pT(e){return e!==null&&!mE(e)&&e.constructor!==null&&!mE(e.constructor)&&uo(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}let u3=Ml("ArrayBuffer"),Noe=GR("string"),uo=GR("function"),d3=GR("number"),fT=e=>e!==null&&typeof e=="object",HR=e=>{if(WR(e)!=="object")return!1;let t=f1(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||l3 in e||BR in e)},Poe=Ml("Date"),koe=Ml("File"),Doe=Ml("Blob"),xoe=Ml("FileList"),Loe=Ml("URLSearchParams"),[Moe,Uoe,Voe,Foe]=["ReadableStream","Request","Response","Headers"].map(Ml);function mT(e,t){let n,s,{allOwnKeys:o=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),fE(e))for(n=0,s=e.length;n<s;n++)t.call(null,e[n],n,e);else{if(pT(e))return;let u=o?Object.getOwnPropertyNames(e):Object.keys(e),d=u.length,f;for(n=0;n<d;n++)f=u[n],t.call(null,e[f],f,e)}}function h3(e,t){if(pT(e))return null;t=t.toLowerCase();let n=Object.keys(e),s,o=n.length;for(;o-- >0;)if(s=n[o],t===s.toLowerCase())return s;return null}let Cm=e3!==void 0?e3:typeof self<"u"?self:typeof window<"u"?window:global,p3=e=>!mE(e)&&e!==Cm,joe=(g1=typeof Uint8Array<"u"&&f1(Uint8Array),e=>g1&&e instanceof g1);var g1;let Boe=Ml("HTMLFormElement"),f3=(e=>{let{hasOwnProperty:t}=e;return(n,s)=>t.call(n,s)})(Object.prototype),Woe=Ml("RegExp"),m3=(e,t)=>{let n=Object.getOwnPropertyDescriptors(e),s={};mT(n,(o,u)=>{let d;(d=t(o,u,e))!==!1&&(s[u]=d||o)}),Object.defineProperties(e,s)},Goe=Ml("AsyncFunction"),g3=(_3=typeof a3=="function",E3=uo(Cm.postMessage),_3?a3:E3?(_1="axios@".concat(Math.random()),zR=[],Cm.addEventListener("message",e=>{let{source:t,data:n}=e;t===Cm&&n===_1&&zR.length&&zR.shift()()},!1),e=>{zR.push(e),Cm.postMessage(_1,"*")}):e=>setTimeout(e));var _3,E3,_1,zR;let Hoe=o3!==void 0?o3.bind(Cm):typeof process<"u"&&process.nextTick||g3;var Ye={isArray:fE,isArrayBuffer:u3,isBuffer:pT,isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||uo(e.append)&&((t=WR(e))==="formdata"||t==="object"&&uo(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&u3(e.buffer),t},isString:Noe,isNumber:d3,isBoolean:e=>e===!0||e===!1,isObject:fT,isPlainObject:HR,isEmptyObject:e=>{if(!fT(e)||pT(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},isReadableStream:Moe,isRequest:Uoe,isResponse:Voe,isHeaders:Foe,isUndefined:mE,isDate:Poe,isFile:koe,isBlob:Doe,isRegExp:Woe,isFunction:uo,isStream:e=>fT(e)&&uo(e.pipe),isURLSearchParams:Loe,isTypedArray:joe,isFileList:xoe,forEach:mT,merge:function e(){let{caseless:t,skipUndefined:n}=p3(this)&&this||{},s={},o=(u,d)=>{let f=t&&h3(s,d)||d;HR(s[f])&&HR(u)?s[f]=e(s[f],u):HR(u)?s[f]=e({},u):fE(u)?s[f]=u.slice():n&&mE(u)||(s[f]=u)};for(let u=0,d=arguments.length;u<d;u++)arguments[u]&&mT(arguments[u],o);return s},extend:function(e,t,n){let{allOwnKeys:s}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return mT(t,(o,u)=>{n&&uo(o)?e[u]=c3(o,n):e[u]=o},{allOwnKeys:s}),e},trim:e=>Bs(e)?Bs(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,n,s)=>{e.prototype=Object.create(t.prototype,s),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,s)=>{let o,u,d,f={};if(t=t||{},e==null)return t;do{for(o=Object.getOwnPropertyNames(e),u=o.length;u-- >0;)d=o[u],s&&!s(d,e,t)||f[d]||(t[d]=e[d],f[d]=!0);e=n!==!1&&f1(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:WR,kindOfTest:Ml,endsWith:(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;let s=e.indexOf(t,n);return s!==-1&&s===n},toArray:e=>{if(!e)return null;if(fE(e))return e;let t=e.length;if(!d3(t))return null;let n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{let n=(e&&e[BR]).call(e),s;for(;(s=n.next())&&!s.done;){let o=s.value;t.call(e,o[0],o[1])}},matchAll:(e,t)=>{let n,s=[];for(;(n=e.exec(t))!==null;)s.push(n);return s},isHTMLForm:Boe,hasOwnProperty:f3,hasOwnProp:f3,reduceDescriptors:m3,freezeMethods:e=>{m3(e,(t,n)=>{if(uo(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;let s=e[n];uo(s)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{let n={},s=o=>{o.forEach(u=>{n[u]=!0})};return fE(e)?s(e):s(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,s){return n.toUpperCase()+s}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:h3,global:Cm,isContextDefined:p3,isSpecCompliantForm:function(e){return!!(e&&uo(e.append)&&e[l3]==="FormData"&&e[BR])},toJSONObject:e=>{let t=new Array(10),n=(s,o)=>{if(fT(s)){if(t.indexOf(s)>=0)return;if(pT(s))return s;if(!("toJSON"in s)){t[o]=s;let u=fE(s)?[]:{};return mT(s,(d,f)=>{let g=n(d,o+1);!mE(g)&&(u[f]=g)}),t[o]=void 0,u}}return s};return n(e,0)},isAsyncFn:Goe,isThenable:e=>e&&(fT(e)||uo(e))&&uo(e.then)&&uo(e.catch),setImmediate:g3,asap:Hoe,isIterable:e=>e!=null&&uo(e[BR])};function Un(e,t,n,s,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),s&&(this.request=s),o&&(this.response=o,this.status=o.status?o.status:null)}Ye.inherits(Un,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ye.toJSONObject(this.config),code:this.code,status:this.status}}});let y3=Un.prototype,v3={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{v3[e]={value:e}}),Object.defineProperties(Un,v3),Object.defineProperty(y3,"isAxiosError",{value:!0}),Un.from=(e,t,n,s,o,u)=>{let d=Object.create(y3);Ye.toFlatObject(e,d,function(y){return y!==Error.prototype},y=>y!=="isAxiosError");let f=e&&e.message?e.message:"Error",g=t==null&&e?e.code:t;return Un.call(d,f,g,n,s,o),e&&d.cause==null&&Object.defineProperty(d,"cause",{value:e,configurable:!0}),d.name=e&&e.name||"Error",u&&Object.assign(d,u),d};function E1(e){return Ye.isPlainObject(e)||Ye.isArray(e)}function S3(e){return Ye.endsWith(e,"[]")?e.slice(0,-2):e}function T3(e,t,n){return e?e.concat(t).map(function(s,o){return s=S3(s),!n&&o?"["+s+"]":s}).join(n?".":""):t}let zoe=Ye.toFlatObject(Ye,{},null,function(e){return/^is[A-Z]/.test(e)});function KR(e,t,n){if(!Ye.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;let s=(n=Ye.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(b,A){return!Ye.isUndefined(A[b])})).metaTokens,o=n.visitor||y,u=n.dots,d=n.indexes,f=(n.Blob||typeof Blob<"u"&&Blob)&&Ye.isSpecCompliantForm(t);if(!Ye.isFunction(o))throw new TypeError("visitor must be a function");function g(b){if(b===null)return"";if(Ye.isDate(b))return b.toISOString();if(Ye.isBoolean(b))return b.toString();if(!f&&Ye.isBlob(b))throw new Un("Blob is not supported. Use a Buffer instead.");return Ye.isArrayBuffer(b)||Ye.isTypedArray(b)?f&&typeof Blob=="function"?new Blob([b]):Buffer.from(b):b}function y(b,A,F){let M=b;if(b&&!F&&typeof b=="object"){if(Ye.endsWith(A,"{}"))A=s?A:A.slice(0,-2),b=JSON.stringify(b);else if(Ye.isArray(b)&&(function(j){return Ye.isArray(j)&&!j.some(E1)})(b)||(Ye.isFileList(b)||Ye.endsWith(A,"[]"))&&(M=Ye.toArray(b)))return A=S3(A),M.forEach(function(j,K){!Ye.isUndefined(j)&&j!==null&&t.append(d===!0?T3([A],K,u):d===null?A:A+"[]",g(j))}),!1}return!!E1(b)||(t.append(T3(F,A,u),g(b)),!1)}let v=[],R=Object.assign(zoe,{defaultVisitor:y,convertValue:g,isVisitable:E1});if(!Ye.isObject(e))throw new TypeError("data must be an object");return(function b(A,F){if(!Ye.isUndefined(A)){if(v.indexOf(A)!==-1)throw Error("Circular reference detected in "+F.join("."));v.push(A),Ye.forEach(A,function(M,j){(!(Ye.isUndefined(M)||M===null)&&o.call(t,M,Ye.isString(j)?Bs(j).call(j):j,F,R))===!0&&b(M,F?F.concat(j):[j])}),v.pop()}})(e),t}function w3(e){let t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function y1(e,t){this._pairs=[],e&&KR(e,this,t)}let C3=y1.prototype;function Koe(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function R3(e,t,n){if(!t)return e;let s=n&&n.encode||Koe;Ye.isFunction(n)&&(n={serialize:n});let o=n&&n.serialize,u;if(u=o?o(t,n):Ye.isURLSearchParams(t)?t.toString():new y1(t,n).toString(s),u){let d=e.indexOf("#");d!==-1&&(e=e.slice(0,d)),e+=(e.indexOf("?")===-1?"?":"&")+u}return e}C3.append=function(e,t){this._pairs.push([e,t])},C3.toString=function(e){let t=e?function(n){return e.call(this,n,w3)}:w3;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};var b3=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Ye.forEach(this.handlers,function(t){t!==null&&e(t)})}},I3={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},A3={exports:{}},Yoe=Sn,qoe=Re,O3=va.f;Yoe({target:"Object",stat:!0,forced:Object.defineProperty!==O3,sham:!qoe},{defineProperty:O3});var N3=fi.Object,Xoe=A3.exports=function(e,t,n){return N3.defineProperty(e,t,n)};N3.defineProperty.sham&&(Xoe.sham=!0);var P3=l(A3.exports),Joe=TypeError,k3=El,$oe=es,Qoe=Wr,Zoe=Er("species"),D3=Array,ece=function(e){var t;return k3(e)&&(t=e.constructor,($oe(t)&&(t===D3||k3(t.prototype))||Qoe(t)&&(t=t[Zoe])===null)&&(t=void 0)),t===void 0?D3:t},x3=function(e,t){return new(ece(e))(t===0?0:t)},tce=h,nce=mi,rce=Er("species"),L3=function(e){return nce>=51||!tce(function(){var t=[];return(t.constructor={})[rce]=function(){return{foo:1}},t[e](Boolean).foo!==1})},ice=Sn,sce=h,ace=El,oce=Wr,cce=Zi,lce=Cu,M3=function(e){if(e>9007199254740991)throw Joe("Maximum allowed index exceeded");return e},U3=AP,uce=x3,dce=L3,hce=mi,V3=Er("isConcatSpreadable"),pce=hce>=51||!sce(function(){var e=[];return e[V3]=!1,e.concat()[0]!==e}),fce=function(e){if(!oce(e))return!1;var t=e[V3];return t!==void 0?!!t:ace(e)};ice({target:"Array",proto:!0,forced:!pce||!dce("concat")},{concat:function(e){var t,n,s,o,u,d=cce(this),f=uce(d,0),g=0;for(t=-1,s=arguments.length;t<s;t++)if(fce(u=t===-1?d:arguments[t]))for(o=lce(u),M3(g+o),n=0;n<o;n++,g++)n in u&&U3(f,g,u[n]);else M3(g+1),U3(f,g++,u);return f.length=g,f}});var F3={},mce=te,gce=yi,j3=vl.f,_ce=Bi,B3=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];F3.f=function(e){return B3&&mce(e)==="Window"?(function(t){try{return j3(t)}catch{return _ce(B3)}})(e):j3(gce(e))};var gE={},Ece=Er;gE.f=Ece;var W3=fi,yce=Ur,vce=gE,Sce=va.f,Gi=function(e){var t=W3.Symbol||(W3.Symbol={});yce(t,e)||Sce(t,e,{value:vce.f(e)})},Tce=Ge,wce=Ir,Cce=Er,Rce=Ol,G3=function(){var e=wce("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,s=Cce("toPrimitive");t&&!t[s]&&Rce(t,s,function(o){return Tce(n,this)},{})},bce=Su,Ice=Cn,Ace=Zi,Oce=Cu,Nce=x3;I([].push);var Pce=function(e){return function(t,n,s,o){for(var u,d,f=Ace(t),g=Ice(f),y=Oce(g),v=bce(n,s),R=0,b=o||Nce,A=void 0;y>R;R++)R in g&&(d=v(u=g[R],R,f));return A}},H3={forEach:Pce(0)},YR=Sn,gT=H,v1=Ge,kce=I,_E=Re,EE=vi,Dce=h,Ws=Ur,xce=N,S1=Is,qR=yi,T1=Tr,Lce=ea,w1=it,yE=Yf,z3=ra,Mce=vl,K3=F3,Uce=zh,Y3=Xe,q3=va,Vce=Pu,X3=Ie,J3=Ol,Fce=xu,C1=Ar,$3=Wo,Q3=Dr,jce=Er,Bce=gE,Wce=Gi,Gce=G3,Hce=Nc,Z3=Du,XR=H3.forEach,ho=Gh("hidden"),JR="Symbol",_T="prototype",zce=Z3.set,eB=Z3.getterFor(JR),Ul=Object[_T],Rm=gT.Symbol,$R=Rm&&Rm[_T],Kce=gT.RangeError,Yce=gT.TypeError,R1=gT.QObject,tB=Y3.f,bm=q3.f,nB=K3.f,qce=X3.f,rB=kce([].push),$d=C1("symbols"),ET=C1("op-symbols"),Xce=C1("wks"),b1=!R1||!R1[_T]||!R1[_T].findChild,iB=function(e,t,n){var s=tB(Ul,t);s&&delete Ul[t],bm(e,t,n),s&&e!==Ul&&bm(Ul,t,s)},I1=_E&&Dce(function(){return yE(bm({},"a",{get:function(){return bm(this,"a",{value:7}).a}})).a!==7})?iB:bm,A1=function(e,t){var n=$d[e]=yE($R);return zce(n,{type:JR,tag:e,description:t}),_E||(n.description=t),n},QR=function(e,t,n){e===Ul&&QR(ET,t,n),S1(e);var s=T1(t);return S1(n),Ws($d,s)?(n.enumerable?(Ws(e,ho)&&e[ho][s]&&(e[ho][s]=!1),n=yE(n,{enumerable:w1(0,!1)})):(Ws(e,ho)||bm(e,ho,w1(1,yE(null))),e[ho][s]=!0),I1(e,s,n)):bm(e,s,n)},O1=function(e,t){S1(e);var n=qR(t),s=z3(n).concat(cB(n));return XR(s,function(o){_E&&!v1(sB,n,o)||QR(e,o,n[o])}),e},sB=function(e){var t=T1(e),n=v1(qce,this,t);return!(this===Ul&&Ws($d,t)&&!Ws(ET,t))&&(!(n||!Ws(this,t)||!Ws($d,t)||Ws(this,ho)&&this[ho][t])||n)},aB=function(e,t){var n=qR(e),s=T1(t);if(n!==Ul||!Ws($d,s)||Ws(ET,s)){var o=tB(n,s);return!o||!Ws($d,s)||Ws(n,ho)&&n[ho][s]||(o.enumerable=!0),o}},oB=function(e){var t=nB(qR(e)),n=[];return XR(t,function(s){Ws($d,s)||Ws($3,s)||rB(n,s)}),n},cB=function(e){var t=e===Ul,n=nB(t?ET:qR(e)),s=[];return XR(n,function(o){!Ws($d,o)||t&&!Ws(Ul,o)||rB(s,$d[o])}),s};EE||(Rm=function(){if(xce($R,this))throw new Yce("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?Lce(arguments[0]):void 0,t=Q3(e),n=function(s){var o=this===void 0?gT:this;o===Ul&&v1(n,ET,s),Ws(o,ho)&&Ws(o[ho],t)&&(o[ho][t]=!1);var u=w1(1,s);try{I1(o,t,u)}catch(d){if(!(d instanceof Kce))throw d;iB(o,t,u)}};return _E&&b1&&I1(Ul,t,{configurable:!0,set:n}),A1(t,e)},J3($R=Rm[_T],"toString",function(){return eB(this).tag}),J3(Rm,"withoutSetter",function(e){return A1(Q3(e),e)}),X3.f=sB,q3.f=QR,Vce.f=O1,Y3.f=aB,Mce.f=K3.f=oB,Uce.f=cB,Bce.f=function(e){return A1(jce(e),e)},_E&&Fce($R,"description",{configurable:!0,get:function(){return eB(this).description}})),YR({global:!0,wrap:!0,forced:!EE,sham:!EE},{Symbol:Rm}),XR(z3(Xce),function(e){Wce(e)}),YR({target:JR,stat:!0,forced:!EE},{useSetter:function(){b1=!0},useSimple:function(){b1=!1}}),YR({target:"Object",stat:!0,forced:!EE,sham:!_E},{create:function(e,t){return t===void 0?yE(e):O1(yE(e),t)},defineProperty:QR,defineProperties:O1,getOwnPropertyDescriptor:aB}),YR({target:"Object",stat:!0,forced:!EE},{getOwnPropertyNames:oB}),Gce(),Hce(Rm,JR),$3[ho]=!0;var lB=vi&&!!Symbol.for&&!!Symbol.keyFor,Jce=Sn,$ce=Ir,Qce=Ur,Zce=ea,uB=Ar,ele=lB,N1=uB("string-to-symbol-registry"),tle=uB("symbol-to-string-registry");Jce({target:"Symbol",stat:!0,forced:!ele},{for:function(e){var t=Zce(e);if(Qce(N1,t))return N1[t];var n=$ce("Symbol")(t);return N1[t]=n,tle[n]=t,n}});var nle=Sn,rle=Ur,ile=Fo,sle=Bn,ale=lB,dB=Ar("symbol-to-string-registry");nle({target:"Symbol",stat:!0,forced:!ale},{keyFor:function(e){if(!ile(e))throw new TypeError(sle(e)+" is not a symbol");if(rle(dB,e))return dB[e]}});var hB=El,ole=Se,pB=te,cle=ea,fB=I([].push),lle=Sn,mB=Ir,gB=$,ule=Ge,yT=I,_B=h,EB=Se,yB=Fo,vB=Bi,dle=function(e){if(ole(e))return e;if(hB(e)){for(var t=e.length,n=[],s=0;s<t;s++){var o=e[s];typeof o=="string"?fB(n,o):typeof o!="number"&&pB(o)!=="Number"&&pB(o)!=="String"||fB(n,cle(o))}var u=n.length,d=!0;return function(f,g){if(d)return d=!1,g;if(hB(this))return g;for(var y=0;y<u;y++)if(n[y]===f)return g}}},hle=vi,ple=String,mp=mB("JSON","stringify"),ZR=yT(/./.exec),SB=yT("".charAt),fle=yT("".charCodeAt),mle=yT("".replace),gle=yT(1.1.toString),_le=/[\uD800-\uDFFF]/g,TB=/^[\uD800-\uDBFF]$/,wB=/^[\uDC00-\uDFFF]$/,CB=!hle||_B(function(){var e=mB("Symbol")("stringify detection");return mp([e])!=="[null]"||mp({a:e})!=="{}"||mp(Object(e))!=="{}"}),RB=_B(function(){return mp("\uDF06\uD834")!=='"\\udf06\\ud834"'||mp("\uDEAD")!=='"\\udead"'}),Ele=function(e,t){var n=vB(arguments),s=dle(t);if(EB(s)||e!==void 0&&!yB(e))return n[1]=function(o,u){if(EB(s)&&(u=ule(s,this,ple(o),u)),!yB(u))return u},gB(mp,null,n)},yle=function(e,t,n){var s=SB(n,t-1),o=SB(n,t+1);return ZR(TB,e)&&!ZR(wB,o)||ZR(wB,e)&&!ZR(TB,s)?"\\u"+gle(fle(e,0),16):e};mp&&lle({target:"JSON",stat:!0,forced:CB||RB},{stringify:function(e,t,n){var s=vB(arguments),o=gB(CB?Ele:mp,null,s);return RB&&typeof o=="string"?mle(o,_le,yle):o}});var bB=zh,vle=Zi;Sn({target:"Object",stat:!0,forced:!vi||h(function(){bB.f(1)})},{getOwnPropertySymbols:function(e){var t=bB.f;return t?t(vle(e)):[]}}),Gi("asyncDispose"),Gi("asyncIterator"),Gi("dispose"),Gi("hasInstance"),Gi("isConcatSpreadable"),Gi("iterator"),Gi("match"),Gi("matchAll"),Gi("replace"),Gi("search"),Gi("species"),Gi("split");var Sle=G3;Gi("toPrimitive"),Sle();var Tle=Ir,wle=Nc;Gi("toStringTag"),wle(Tle("Symbol"),"Symbol"),Gi("unscopables"),Nc(H.JSON,"JSON",!0);var Cle=fi.Symbol,Rle=Er,ble=va.f,IB=Rle("metadata"),AB=Function.prototype;AB[IB]===void 0&&ble(AB,IB,{value:null}),Gi("metadata");var Ile=Cle,Ale=I,P1=Ir("Symbol"),Ole=P1.keyFor,Nle=Ale(P1.prototype.valueOf),OB=P1.isRegisteredSymbol||function(e){try{return Ole(Nle(e))!==void 0}catch{return!1}};Sn({target:"Symbol",stat:!0},{isRegisteredSymbol:OB});for(var Ple=Ar,NB=Ir,kle=I,Dle=Fo,xle=Er,eb=NB("Symbol"),PB=eb.isWellKnownSymbol,kB=NB("Object","getOwnPropertyNames"),Lle=kle(eb.prototype.valueOf),DB=Ple("wks"),k1=0,xB=kB(eb),Mle=xB.length;k1<Mle;k1++)try{var LB=xB[k1];Dle(eb[LB])&&xle(LB)}catch{}var MB=function(e){if(PB&&PB(e))return!0;try{for(var t=Lle(e),n=0,s=kB(DB),o=s.length;n<o;n++)if(DB[s[n]]==t)return!0}catch{}return!1};Sn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:MB}),Gi("customMatcher"),Gi("observable"),Sn({target:"Symbol",stat:!0},{isRegistered:OB}),Sn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:MB}),Gi("matcher"),Gi("metadataKey"),Gi("patternMatch"),Gi("replaceAll");var vE=l(Ile),UB=l(gE.f("iterator"));function vT(e){return vT=typeof vE=="function"&&typeof UB=="symbol"?function(t){return typeof t}:function(t){return t&&typeof vE=="function"&&t.constructor===vE&&t!==vE.prototype?"symbol":typeof t},vT(e)}var Ule=l(gE.f("toPrimitive"));function Vle(e){var t=(function(n,s){if(vT(n)!="object"||!n)return n;var o=n[Ule];if(o!==void 0){var u=o.call(n,s);if(vT(u)!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(n)})(e,"string");return vT(t)=="symbol"?t:t+""}function V(e,t,n){return(t=Vle(t))in e?P3(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var VB=l(use),Fle={isBrowser:!0,classes:{URLSearchParams:VB!==void 0?VB:y1,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};let D1=typeof window<"u"&&typeof document<"u",x1=typeof navigator=="object"&&navigator||void 0,jle=D1&&(!x1||["ReactNative","NativeScript","NS"].indexOf(x1.product)<0),Ble=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Wle=D1&&window.location.href||"http://localhost";function FB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function jB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?FB(Object(n),!0).forEach(function(s){V(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):FB(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var ba=jB(jB({},Object.freeze({__proto__:null,hasBrowserEnv:D1,hasStandardBrowserEnv:jle,hasStandardBrowserWebWorkerEnv:Ble,navigator:x1,origin:Wle})),Fle);function BB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function Gle(e,t){return KR(e,new ba.classes.URLSearchParams,(function(n){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?arguments[s]:{};s%2?BB(Object(o),!0).forEach(function(u){V(n,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):BB(Object(o)).forEach(function(u){Object.defineProperty(n,u,Object.getOwnPropertyDescriptor(o,u))})}return n})({visitor:function(n,s,o,u){return ba.isNode&&Ye.isBuffer(n)?(this.append(s,n.toString("base64")),!1):u.defaultVisitor.apply(this,arguments)}},t))}var Hle=fP.charAt,WB=Ge,zle=Is,Kle=Se,Yle=te,qle=/./.exec,Xle=TypeError,Jle=Sn,GB=Ge,HB=Ne,$le=im,tb=W_,zB=Mr,KB=sC,ST=ea,Qle=Is,Zle=Wr,eue=te,tue=i_,YB=s1,nue=je,rue=h,iue=Kd,sue=function(e,t,n){return t+(n?Hle(e,t).length:1)},aue=function(e,t){var n=e.exec;if(Kle(n)){var s=WB(n,e,t);return s!==null&&zle(s),s}if(Yle(e)==="RegExp")return WB(qle,e,t);throw new Xle("RegExp#exec called on incompatible receiver")},qB=Du,oue=Er("matchAll"),XB="RegExp String",JB=XB+" Iterator",cue=qB.set,lue=qB.getterFor(JB),uue=TypeError,L1=HB("".indexOf),nb=HB("".matchAll),M1=!!nb&&!rue(function(){nb("a",/./)}),due=$le(function(e,t,n,s){cue(this,{type:JB,regexp:e,string:t,global:n,unicode:s,done:!1})},XB,function(){var e=lue(this);if(e.done)return tb(void 0,!0);var t=e.regexp,n=e.string,s=aue(t,n);return s===null?(e.done=!0,tb(void 0,!0)):e.global?(ST(s[0])===""&&(t.lastIndex=sue(n,KB(t.lastIndex),e.unicode)),tb(s,!1)):(e.done=!0,tb(s,!1))}),$B=function(e){var t,n,s,o=Qle(this),u=ST(e),d=iue(o,RegExp),f=ST(YB(o));return t=new d(d===RegExp?o.source:o,f),n=!!~L1(f,"g"),s=!!~L1(f,"u"),t.lastIndex=KB(o.lastIndex),new due(t,u,n,s)};Jle({target:"String",proto:!0,forced:M1},{matchAll:function(e){var t,n,s,o,u=zB(this);if(Zle(e)){if(tue(e)&&(t=ST(zB(YB(e))),!~L1(t,"g")))throw new uue("`.matchAll` does not allow non-global regexes");if(M1)return nb(u,e);if((s=nue(e,oue))===void 0&&eue(e)==="RegExp"&&(s=$B),s)return GB(s,e,u)}else if(M1)return nb(u,e);return n=ST(u),o=new RegExp(e,"g"),GB($B,o,n)}});var hue=Sa("String","matchAll"),pue=N,fue=hue,U1=String.prototype,mue=function(e){var t=e.matchAll;return typeof e=="string"||e===U1||pue(U1,e)&&t===U1.matchAll?fue:t},gue=l(mue);function QB(e){function t(n,s,o,u){let d=n[u++];if(d==="__proto__")return!0;let f=Number.isFinite(+d),g=u>=n.length;return d=!d&&Ye.isArray(o)?o.length:d,g?(Ye.hasOwnProp(o,d)?o[d]=[o[d],s]:o[d]=s,!f):(o[d]&&Ye.isObject(o[d])||(o[d]=[]),t(n,s,o[d],u)&&Ye.isArray(o[d])&&(o[d]=(function(y){let v={},R=Object.keys(y),b,A=R.length,F;for(b=0;b<A;b++)F=R[b],v[F]=y[F];return v})(o[d])),!f)}if(Ye.isFormData(e)&&Ye.isFunction(e.entries)){let n={};return Ye.forEachEntry(e,(s,o)=>{t((function(u){return gue(Ye).call(Ye,/\w+|\[(\w*)]/g,u).map(d=>d[0]==="[]"?"":d[1]||d[0])})(s),o,n,0)}),n}return null}let V1={transitional:I3,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){let n=t.getContentType()||"",s=n.indexOf("application/json")>-1,o=Ye.isObject(e);if(o&&Ye.isHTMLForm(e)&&(e=new FormData(e)),Ye.isFormData(e))return s?JSON.stringify(QB(e)):e;if(Ye.isArrayBuffer(e)||Ye.isBuffer(e)||Ye.isStream(e)||Ye.isFile(e)||Ye.isBlob(e)||Ye.isReadableStream(e))return e;if(Ye.isArrayBufferView(e))return e.buffer;if(Ye.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Gle(e,this.formSerializer).toString();if((u=Ye.isFileList(e))||n.indexOf("multipart/form-data")>-1){let d=this.env&&this.env.FormData;return KR(u?{"files[]":e}:e,d&&new d,this.formSerializer)}}return o||s?(t.setContentType("application/json",!1),(function(d,f,g){if(Ye.isString(d))try{return(f||JSON.parse)(d),Bs(Ye).call(Ye,d)}catch(y){if(y.name!=="SyntaxError")throw y}return(g||JSON.stringify)(d)})(e)):e}],transformResponse:[function(e){let t=this.transitional||V1.transitional,n=t&&t.forcedJSONParsing,s=this.responseType==="json";if(Ye.isResponse(e)||Ye.isReadableStream(e))return e;if(e&&Ye.isString(e)&&(n&&!this.responseType||s)){let o=!(t&&t.silentJSONParsing)&&s;try{return JSON.parse(e,this.parseReviver)}catch(u){if(o)throw u.name==="SyntaxError"?Un.from(u,Un.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ba.classes.FormData,Blob:ba.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ye.forEach(["delete","get","head","post","put","patch"],e=>{V1.headers[e]={}});var F1=V1;let _ue=Ye.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ZB=Symbol("internals");function TT(e){var t;return e&&Bs(t=String(e)).call(t).toLowerCase()}function rb(e){return e===!1||e==null?e:Ye.isArray(e)?e.map(rb):String(e)}function j1(e,t,n,s,o){return Ye.isFunction(s)?s.call(this,t,n):(o&&(t=n),Ye.isString(t)?Ye.isString(s)?t.indexOf(s)!==-1:Ye.isRegExp(s)?s.test(t):void 0:void 0)}class ib{constructor(t){t&&this.set(t)}set(t,n,s){let o=this;function u(g,y,v){let R=TT(y);if(!R)throw new Error("header name must be a non-empty string");let b=Ye.findKey(o,R);(!b||o[b]===void 0||v===!0||v===void 0&&o[b]!==!1)&&(o[b||y]=rb(g))}let d=(g,y)=>Ye.forEach(g,(v,R)=>u(v,R,y));if(Ye.isPlainObject(t)||t instanceof this.constructor)d(t,n);else if(Ye.isString(t)&&(t=Bs(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Bs(f=t).call(f)))d((g=>{let y={},v,R,b;return g&&g.split(`
`).forEach(function(A){var F,M;b=A.indexOf(":"),v=Bs(F=A.substring(0,b)).call(F).toLowerCase(),R=Bs(M=A.substring(b+1)).call(M),!v||y[v]&&_ue[v]||(v==="set-cookie"?y[v]?y[v].push(R):y[v]=[R]:y[v]=y[v]?y[v]+", "+R:R)}),y})(t),n);else if(Ye.isObject(t)&&Ye.isIterable(t)){let g,y,v={};for(let R of t){if(!Ye.isArray(R))throw TypeError("Object iterator must return a key-value pair");v[y=R[0]]=(g=v[y])?Ye.isArray(g)?[...g,R[1]]:[g,R[1]]:R[1]}d(v,n)}else t!=null&&u(n,t,s);var f;return this}get(t,n){if(t=TT(t)){let s=Ye.findKey(this,t);if(s){let o=this[s];if(!n)return o;if(n===!0)return(function(u){let d=Object.create(null),f=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,g;for(;g=f.exec(u);)d[g[1]]=g[2];return d})(o);if(Ye.isFunction(n))return n.call(this,o,s);if(Ye.isRegExp(n))return n.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=TT(t)){let s=Ye.findKey(this,t);return!(!s||this[s]===void 0||n&&!j1(0,this[s],s,n))}return!1}delete(t,n){let s=this,o=!1;function u(d){if(d=TT(d)){let f=Ye.findKey(s,d);!f||n&&!j1(0,s[f],f,n)||(delete s[f],o=!0)}}return Ye.isArray(t)?t.forEach(u):u(t),o}clear(t){let n=Object.keys(this),s=n.length,o=!1;for(;s--;){let u=n[s];t&&!j1(0,this[u],u,t,!0)||(delete this[u],o=!0)}return o}normalize(t){let n=this,s={};return Ye.forEach(this,(o,u)=>{var d;let f=Ye.findKey(s,u);if(f)return n[f]=rb(o),void delete n[u];let g=t?(function(y){return Bs(y).call(y).toLowerCase().replace(/([a-z\d])(\w*)/g,(v,R,b)=>R.toUpperCase()+b)})(u):Bs(d=String(u)).call(d);g!==u&&delete n[u],n[g]=rb(o),s[g]=!0}),this}concat(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return this.constructor.concat(this,...n)}toJSON(t){let n=Object.create(null);return Ye.forEach(this,(s,o)=>{s!=null&&s!==!1&&(n[o]=t&&Ye.isArray(s)?s.join(", "):s)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[n,s]=t;return n+": "+s}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){let n=new this(t);for(var s=arguments.length,o=new Array(s>1?s-1:0),u=1;u<s;u++)o[u-1]=arguments[u];return o.forEach(d=>n.set(d)),n}static accessor(t){let n=(this[ZB]=this[ZB]={accessors:{}}).accessors,s=this.prototype;function o(u){let d=TT(u);n[d]||((function(f,g){let y=Ye.toCamelCase(" "+g);["get","set","has"].forEach(v=>{Object.defineProperty(f,v+y,{value:function(R,b,A){return this[v].call(this,g,R,b,A)},configurable:!0})})})(s,u),n[d]=!0)}return Ye.isArray(t)?t.forEach(o):o(t),this}}ib.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Ye.reduceDescriptors(ib.prototype,(e,t)=>{let{value:n}=e,s=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(o){this[s]=o}}}),Ye.freezeMethods(ib);var Vl=ib;function B1(e,t){let n=this||F1,s=t||n,o=Vl.from(s.headers),u=s.data;return Ye.forEach(e,function(d){u=d.call(n,u,o.normalize(),t?t.status:void 0)}),o.normalize(),u}function e4(e){return!(!e||!e.__CANCEL__)}function SE(e,t,n){Un.call(this,e??"canceled",Un.ERR_CANCELED,t,n),this.name="CanceledError"}function t4(e,t,n){let s=n.config.validateStatus;n.status&&s&&!s(n.status)?t(new Un("Request failed with status code "+n.status,[Un.ERR_BAD_REQUEST,Un.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}Ye.inherits(SE,Un,{__CANCEL__:!0});let sb=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,s=0,o=(function(u,d){u=u||10;let f=new Array(u),g=new Array(u),y,v=0,R=0;return d=d!==void 0?d:1e3,function(b){let A=Date.now(),F=g[R];y||(y=A),f[v]=b,g[v]=A;let M=R,j=0;for(;M!==v;)j+=f[M++],M%=u;if(v=(v+1)%u,v===R&&(R=(R+1)%u),A-y<d)return;let K=F&&A-F;return K?Math.round(1e3*j/K):void 0}})(50,250);return(function(u,d){let f,g,y=0,v=1e3/d,R=function(b){y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),f=null,g&&(clearTimeout(g),g=null),u(...b)};return[function(){let b=Date.now(),A=b-y;for(var F=arguments.length,M=new Array(F),j=0;j<F;j++)M[j]=arguments[j];A>=v?R(M,b):(f=M,g||(g=setTimeout(()=>{g=null,R(f)},v-A)))},()=>f&&R(f)]})(u=>{let d=u.loaded,f=u.lengthComputable?u.total:void 0,g=d-s,y=o(g);s=d,e({loaded:d,total:f,progress:f?d/f:void 0,bytes:g,rate:y||void 0,estimated:y&&f&&d<=f?(f-d)/y:void 0,event:u,lengthComputable:f!=null,[t?"download":"upload"]:!0})},n)},n4=(e,t)=>{let n=e!=null;return[s=>t[0]({lengthComputable:n,total:e,loaded:s}),t[1]]},r4=e=>function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return Ye.asap(()=>e(...n))};var Eue=ba.hasStandardBrowserEnv?((e,t)=>n=>(n=new xR(n,ba.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new xR(ba.origin),ba.navigator&&/(msie|trident)/i.test(ba.navigator.userAgent)):()=>!0,yue=ba.hasStandardBrowserEnv?{write(e,t,n,s,o,u,d){if(typeof document>"u")return;let f=["".concat(e,"=").concat(encodeURIComponent(t))];Ye.isNumber(n)&&f.push("expires=".concat(new Date(n).toUTCString())),Ye.isString(s)&&f.push("path=".concat(s)),Ye.isString(o)&&f.push("domain=".concat(o)),u===!0&&f.push("secure"),Ye.isString(d)&&f.push("SameSite=".concat(d)),document.cookie=f.join("; ")},read(e){if(typeof document>"u")return null;let t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read:()=>null,remove(){}};function i4(e,t,n){let s=!(function(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)})(t);return e&&(s||n==0)?(function(o,u){return u?o.replace(/\/?\/$/,"")+"/"+u.replace(/^\/+/,""):o})(e,t):t}function s4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function W1(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?s4(Object(n),!0).forEach(function(s){V(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s4(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}let a4=e=>e instanceof Vl?W1({},e):e;function Im(e,t){t=t||{};let n={};function s(y,v,R,b){return Ye.isPlainObject(y)&&Ye.isPlainObject(v)?Ye.merge.call({caseless:b},y,v):Ye.isPlainObject(v)?Ye.merge({},v):Ye.isArray(v)?v.slice():v}function o(y,v,R,b){return Ye.isUndefined(v)?Ye.isUndefined(y)?void 0:s(void 0,y,0,b):s(y,v,0,b)}function u(y,v){if(!Ye.isUndefined(v))return s(void 0,v)}function d(y,v){return Ye.isUndefined(v)?Ye.isUndefined(y)?void 0:s(void 0,y):s(void 0,v)}function f(y,v,R){return R in t?s(y,v):R in e?s(void 0,y):void 0}let g={url:u,method:u,data:u,baseURL:d,transformRequest:d,transformResponse:d,paramsSerializer:d,timeout:d,timeoutMessage:d,withCredentials:d,withXSRFToken:d,adapter:d,responseType:d,xsrfCookieName:d,xsrfHeaderName:d,onUploadProgress:d,onDownloadProgress:d,decompress:d,maxContentLength:d,maxBodyLength:d,beforeRedirect:d,transport:d,httpAgent:d,httpsAgent:d,cancelToken:d,socketPath:d,responseEncoding:d,validateStatus:f,headers:(y,v,R)=>o(a4(y),a4(v),0,!0)};return Ye.forEach(Object.keys(W1(W1({},e),t)),function(y){let v=g[y]||o,R=v(e[y],t[y],y);Ye.isUndefined(R)&&v!==f||(n[y]=R)}),n}var o4=e=>{let t=Im({},e),{data:n,withXSRFToken:s,xsrfHeaderName:o,xsrfCookieName:u,headers:d,auth:f}=t;if(t.headers=d=Vl.from(d),t.url=R3(i4(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),f&&d.set("Authorization","Basic "+btoa((f.username||"")+":"+(f.password?unescape(encodeURIComponent(f.password)):""))),Ye.isFormData(n)){if(ba.hasStandardBrowserEnv||ba.hasStandardBrowserWebWorkerEnv)d.setContentType(void 0);else if(Ye.isFunction(n.getHeaders)){let g=n.getHeaders(),y=["content-type","content-length"];Object.entries(g).forEach(v=>{let[R,b]=v;ke(y).call(y,R.toLowerCase())&&d.set(R,b)})}}if(ba.hasStandardBrowserEnv&&(s&&Ye.isFunction(s)&&(s=s(t)),s||s!==!1&&Eue(t.url))){let g=o&&u&&yue.read(u);g&&d.set(o,g)}return t},vue=typeof XMLHttpRequest<"u"&&function(e){return new We(function(t,n){let s=o4(e),o=s.data,u=Vl.from(s.headers).normalize(),d,f,g,y,v,{responseType:R,onUploadProgress:b,onDownloadProgress:A}=s;function F(){y&&y(),v&&v(),s.cancelToken&&s.cancelToken.unsubscribe(d),s.signal&&s.signal.removeEventListener("abort",d)}let M=new XMLHttpRequest;function j(){if(!M)return;let q=Vl.from("getAllResponseHeaders"in M&&M.getAllResponseHeaders());t4(function(Q){t(Q),F()},function(Q){n(Q),F()},{data:R&&R!=="text"&&R!=="json"?M.response:M.responseText,status:M.status,statusText:M.statusText,headers:q,config:e,request:M}),M=null}M.open(s.method.toUpperCase(),s.url,!0),M.timeout=s.timeout,"onloadend"in M?M.onloadend=j:M.onreadystatechange=function(){M&&M.readyState===4&&(M.status!==0||M.responseURL&&M.responseURL.indexOf("file:")===0)&&setTimeout(j)},M.onabort=function(){M&&(n(new Un("Request aborted",Un.ECONNABORTED,e,M)),M=null)},M.onerror=function(q){let Q=new Un(q&&q.message?q.message:"Network Error",Un.ERR_NETWORK,e,M);Q.event=q||null,n(Q),M=null},M.ontimeout=function(){let q=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded",Q=s.transitional||I3;s.timeoutErrorMessage&&(q=s.timeoutErrorMessage),n(new Un(q,Q.clarifyTimeoutError?Un.ETIMEDOUT:Un.ECONNABORTED,e,M)),M=null},o===void 0&&u.setContentType(null),"setRequestHeader"in M&&Ye.forEach(u.toJSON(),function(q,Q){M.setRequestHeader(Q,q)}),Ye.isUndefined(s.withCredentials)||(M.withCredentials=!!s.withCredentials),R&&R!=="json"&&(M.responseType=s.responseType),A&&([g,v]=sb(A,!0),M.addEventListener("progress",g)),b&&M.upload&&([f,y]=sb(b),M.upload.addEventListener("progress",f),M.upload.addEventListener("loadend",y)),(s.cancelToken||s.signal)&&(d=q=>{M&&(n(!q||q.type?new SE(null,e,M):q),M.abort(),M=null)},s.cancelToken&&s.cancelToken.subscribe(d),s.signal&&(s.signal.aborted?d():s.signal.addEventListener("abort",d)));let K=(function(q){let Q=/^([-+\w]{1,25})(:?\/\/|:)/.exec(q);return Q&&Q[1]||""})(s.url);K&&ba.protocols.indexOf(K)===-1?n(new Un("Unsupported protocol "+K+":",Un.ERR_BAD_REQUEST,e)):M.send(o||null)})},Sue=(e,t)=>{let{length:n}=e=e?e.filter(Boolean):[];if(t||n){let s,o=new AbortController,u=function(y){if(!s){s=!0,f();let v=y instanceof Error?y:this.reason;o.abort(v instanceof Un?v:new SE(v instanceof Error?v.message:v))}},d=t&&setTimeout(()=>{d=null,u(new Un("timeout ".concat(t," of ms exceeded"),Un.ETIMEDOUT))},t),f=()=>{e&&(d&&clearTimeout(d),d=null,e.forEach(y=>{y.unsubscribe?y.unsubscribe(u):y.removeEventListener("abort",u)}),e=null)};e.forEach(y=>y.addEventListener("abort",u));let{signal:g}=o;return g.unsubscribe=()=>Ye.asap(f),g}},G1=l(KV),c4=gE.f("asyncIterator"),Tue=l(c4);function H1(e,t){this.v=e,this.k=t}function aa(e){return function(){return new wT(e.apply(this,arguments))}}function wT(e){var t,n;function s(u,d){try{var f=e[u](d),g=f.value,y=g instanceof H1;G1.resolve(y?g.v:g).then(function(v){if(y){var R=u==="return"?"return":"next";if(!g.k||v.done)return s(R,v);v=e[R](v).value}o(f.done?"return":"normal",v)},function(v){s("throw",v)})}catch(v){o("throw",v)}}function o(u,d){switch(u){case"return":t.resolve({value:d,done:!0});break;case"throw":t.reject(d);break;default:t.resolve({value:d,done:!1})}(t=t.next)?s(t.key,t.arg):n=null}this._invoke=function(u,d){return new G1(function(f,g){var y={key:u,arg:d,resolve:f,reject:g,next:null};n?n=n.next=y:(t=n=y,s(u,d))})},typeof e.return!="function"&&(this.return=void 0)}function Ft(e){return new H1(e,0)}function TE(e){var t={},n=!1;function s(o,u){return n=!0,u=new G1(function(d){d(e[o](u))}),{done:!1,value:new H1(u,1)}}return t[vE!==void 0&&UB||"@@iterator"]=function(){return this},t.next=function(o){return n?(n=!1,o):s("next",o)},typeof e.throw=="function"&&(t.throw=function(o){if(n)throw n=!1,o;return s("throw",o)}),typeof e.return=="function"&&(t.return=function(o){return n?(n=!1,o):s("return",o)}),t}wT.prototype[typeof vE=="function"&&Tue||"@@asyncIterator"]=function(){return this},wT.prototype.next=function(e){return this._invoke("next",e)},wT.prototype.throw=function(e){return this._invoke("throw",e)},wT.prototype.return=function(e){return this._invoke("return",e)};var ab=l(c4);function z1(e){var t,n,s,o=2;for(typeof Symbol<"u"&&(n=ab,s=Symbol.iterator);o--;){if(n&&(t=e[n])!=null)return t.call(e);if(s&&(t=e[s])!=null)return new ob(t.call(e));n="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function ob(e){function t(n){if(Object(n)!==n)return We.reject(new TypeError(n+" is not an object."));var s=n.done;return We.resolve(n.value).then(function(o){return{value:o,done:s}})}return ob=function(n){this.s=n,this.n=n.next},ob.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var s=this.s.return;return s===void 0?We.resolve({value:n,done:!0}):t(s.apply(this.s,arguments))},throw:function(n){var s=this.s.return;return s===void 0?We.reject(n):t(s.apply(this.s,arguments))}},new ob(e)}let wue=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let s,o=0;for(;o<n;)s=o+t,yield e.slice(o,s),o=s},Cue=(function(){var e=aa(function*(t,n){var s,o=!1,u=!1;try{for(var d,f=z1(Rue(t));o=!(d=yield Ft(f.next())).done;o=!1){let g=d.value;yield*TE(z1(wue(g,n)))}}catch(g){u=!0,s=g}finally{try{o&&f.return!=null&&(yield Ft(f.return()))}finally{if(u)throw s}}});return function(t,n){return e.apply(this,arguments)}})(),Rue=(function(){var e=aa(function*(t){if(t[ab])return void(yield*TE(z1(t)));let n=t.getReader();try{for(;;){let{done:s,value:o}=yield Ft(n.read());if(s)break;yield o}}finally{yield Ft(n.cancel())}});return function(t){return e.apply(this,arguments)}})(),l4=(e,t,n,s)=>{let o=Cue(e,t),u,d=0,f=g=>{u||(u=!0,s&&s(g))};return new ReadableStream({async pull(g){try{let{done:y,value:v}=await o.next();if(y)return f(),void g.close();let R=v.byteLength;if(n){let b=d+=R;n(b)}g.enqueue(new Uint8Array(v))}catch(y){throw f(y),y}},cancel:g=>(f(g),o.return())},{highWaterMark:2})};function u4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function d4(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?u4(Object(n),!0).forEach(function(s){V(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u4(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}let{isFunction:cb}=Ye,bue=(e=>{let{Request:t,Response:n}=e;return{Request:t,Response:n}})(Ye.global),{ReadableStream:h4,TextEncoder:p4}=Ye.global,f4=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];return!!e(...n)}catch{return!1}},Iue=e=>{e=Ye.merge.call({skipUndefined:!0},bue,e);let{fetch:t,Request:n,Response:s}=e,o=t?cb(t):typeof fetch=="function",u=cb(n),d=cb(s);if(!o)return!1;let f=o&&cb(h4),g=o&&(typeof p4=="function"?(y=new p4,F=>y.encode(F)):async F=>new Uint8Array(await new n(F).arrayBuffer()));var y;let v=u&&f&&f4(()=>{let F=!1,M=new n(ba.origin,{body:new h4,method:"POST",get duplex(){return F=!0,"half"}}).headers.has("Content-Type");return F&&!M}),R=d&&f&&f4(()=>Ye.isReadableStream(new s("").body)),b={stream:R&&(F=>F.body)};o&&["text","arrayBuffer","blob","formData","stream"].forEach(F=>{!b[F]&&(b[F]=(M,j)=>{let K=M&&M[F];if(K)return K.call(M);throw new Un("Response type '".concat(F,"' is not supported"),Un.ERR_NOT_SUPPORT,j)})});let A=async(F,M)=>Ye.toFiniteNumber(F.getContentLength())??(async K=>K==null?0:Ye.isBlob(K)?K.size:Ye.isSpecCompliantForm(K)?(await new n(ba.origin,{method:"POST",body:K}).arrayBuffer()).byteLength:Ye.isArrayBufferView(K)||Ye.isArrayBuffer(K)?K.byteLength:(Ye.isURLSearchParams(K)&&(K+=""),Ye.isString(K)?(await g(K)).byteLength:void 0))(M);return async F=>{let{url:M,method:j,data:K,signal:q,cancelToken:Q,timeout:se,onDownloadProgress:oe,onUploadProgress:ne,responseType:de,headers:we,withCredentials:Oe="same-origin",fetchOptions:Qe}=o4(F),at=t||fetch;de=de?(de+"").toLowerCase():"text";let Xt=Sue([q,Q&&Q.toAbortSignal()],se),Lt=null,jt=Xt&&Xt.unsubscribe&&(()=>{Xt.unsubscribe()}),En;try{if(ne&&v&&j!=="get"&&j!=="head"&&(En=await A(we,K))!==0){let L,J=new n(M,{method:"POST",body:K,duplex:"half"});if(Ye.isFormData(K)&&(L=J.headers.get("content-type"))&&we.setContentType(L),J.body){let[ie,Me]=n4(En,sb(r4(ne)));K=l4(J.body,65536,ie,Me)}}Ye.isString(Oe)||(Oe=Oe?"include":"omit");let lr=u&&"credentials"in n.prototype,Ce=d4(d4({},Qe),{},{signal:Xt,method:j.toUpperCase(),headers:we.normalize().toJSON(),body:K,duplex:"half",credentials:lr?Oe:void 0});Lt=u&&new n(M,Ce);let Ve=await(u?at(Lt,Qe):at(M,Ce)),Ze=R&&(de==="stream"||de==="response");if(R&&(oe||Ze&&jt)){let L={};["status","statusText","headers"].forEach(Rt=>{L[Rt]=Ve[Rt]});let J=Ye.toFiniteNumber(Ve.headers.get("content-length")),[ie,Me]=oe&&n4(J,sb(r4(oe),!0))||[];Ve=new s(l4(Ve.body,65536,ie,()=>{Me&&Me(),jt&&jt()}),L)}de=de||"text";let Ae=await b[Ye.findKey(b,de)||"text"](Ve,F);return!Ze&&jt&&jt(),await new We((L,J)=>{t4(L,J,{data:Ae,headers:Vl.from(Ve.headers),status:Ve.status,statusText:Ve.statusText,config:F,request:Lt})})}catch(lr){throw jt&&jt(),lr&&lr.name==="TypeError"&&/Load failed|fetch/i.test(lr.message)?Object.assign(new Un("Network Error",Un.ERR_NETWORK,F,Lt),{cause:lr.cause||lr}):Un.from(lr,lr&&lr.code,F,Lt)}}},Aue=new Map,m4=e=>{let t=e&&e.env||{},{fetch:n,Request:s,Response:o}=t,u=[s,o,n],d,f,g=u.length,y=Aue;for(;g--;)d=u[g],f=y.get(d),f===void 0&&y.set(d,f=g?new Map:Iue(t)),y=f;return f};m4();let K1={http:null,xhr:vue,fetch:{get:m4}};Ye.forEach(K1,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});let g4=e=>"- ".concat(e),Oue=e=>Ye.isFunction(e)||e===null||e===!1;var _4={getAdapter:function(e,t){e=Ye.isArray(e)?e:[e];let{length:n}=e,s,o,u={};for(let d=0;d<n;d++){let f;if(s=e[d],o=s,!Oue(s)&&(o=K1[(f=String(s)).toLowerCase()],o===void 0))throw new Un("Unknown adapter '".concat(f,"'"));if(o&&(Ye.isFunction(o)||(o=o.get(t))))break;u[f||"#"+d]=o}if(!o){let d=Object.entries(u).map(f=>{let[g,y]=f;return"adapter ".concat(g," ")+(y===!1?"is not supported by the environment":"is not available in the build")});throw new Un("There is no suitable adapter to dispatch the request "+(n?d.length>1?`since :
`+d.map(g4).join(`
`):" "+g4(d[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return o},adapters:K1};function Y1(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new SE(null,e)}function E4(e){return Y1(e),e.headers=Vl.from(e.headers),e.data=B1.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),_4.getAdapter(e.adapter||F1.adapter,e)(e).then(function(t){return Y1(e),t.data=B1.call(e,e.transformResponse,t),t.headers=Vl.from(t.headers),t},function(t){return e4(t)||(Y1(e),t&&t.response&&(t.response.data=B1.call(e,e.transformResponse,t.response),t.response.headers=Vl.from(t.response.headers))),We.reject(t)})}let y4="1.13.2",lb={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{lb[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});let v4={};lb.transitional=function(e,t,n){function s(o,u){return"[Axios v"+y4+"] Transitional option '"+o+"'"+u+(n?". "+n:"")}return(o,u,d)=>{if(e===!1)throw new Un(s(u," has been removed"+(t?" in "+t:"")),Un.ERR_DEPRECATED);return t&&!v4[u]&&(v4[u]=!0,console.warn(s(u," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(o,u,d)}},lb.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var ub={assertOptions:function(e,t,n){if(typeof e!="object")throw new Un("options must be an object",Un.ERR_BAD_OPTION_VALUE);let s=Object.keys(e),o=s.length;for(;o-- >0;){let u=s[o],d=t[u];if(d){let f=e[u],g=f===void 0||d(f,u,e);if(g!==!0)throw new Un("option "+u+" must be "+g,Un.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new Un("Unknown option "+u,Un.ERR_BAD_OPTION)}},validators:lb};let Ku=ub.validators,db=class{constructor(e){this.defaults=e||{},this.interceptors={request:new b3,response:new b3}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;let o=s.stack?s.stack.replace(/^.+\n/,""):"";try{n.stack?o&&!String(n.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+o):n.stack=o}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=Im(this.defaults,t);let{transitional:n,paramsSerializer:s,headers:o}=t;n!==void 0&&ub.assertOptions(n,{silentJSONParsing:Ku.transitional(Ku.boolean),forcedJSONParsing:Ku.transitional(Ku.boolean),clarifyTimeoutError:Ku.transitional(Ku.boolean)},!1),s!=null&&(Ye.isFunction(s)?t.paramsSerializer={serialize:s}:ub.assertOptions(s,{encode:Ku.function,serialize:Ku.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),ub.assertOptions(t,{baseUrl:Ku.spelling("baseURL"),withXsrfToken:Ku.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let u=o&&Ye.merge(o.common,o[t.method]);o&&Ye.forEach(["delete","get","head","post","put","patch","common"],A=>{delete o[A]}),t.headers=Vl.concat(u,o);let d=[],f=!0;this.interceptors.request.forEach(function(A){typeof A.runWhen=="function"&&A.runWhen(t)===!1||(f=f&&A.synchronous,d.unshift(A.fulfilled,A.rejected))});let g=[],y;this.interceptors.response.forEach(function(A){g.push(A.fulfilled,A.rejected)});let v,R=0;if(!f){let A=[E4.bind(this),void 0];for(A.unshift(...d),A.push(...g),v=A.length,y=We.resolve(t);R<v;)y=y.then(A[R++],A[R++]);return y}v=d.length;let b=t;for(;R<v;){let A=d[R++],F=d[R++];try{b=A(b)}catch(M){F.call(this,M);break}}try{y=E4.call(this,b)}catch(A){return We.reject(A)}for(R=0,v=g.length;R<v;)y=y.then(g[R++],g[R++]);return y}getUri(e){return R3(i4((e=Im(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Ye.forEach(["delete","get","head","options"],function(e){db.prototype[e]=function(t,n){return this.request(Im(n||{},{method:e,url:t,data:(n||{}).data}))}}),Ye.forEach(["post","put","patch"],function(e){function t(n){return function(s,o,u){return this.request(Im(u||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}db.prototype[e]=t(),db.prototype[e+"Form"]=t(!0)});var hb=db;class q1{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new We(function(o){n=o});let s=this;this.promise.then(o=>{if(!s._listeners)return;let u=s._listeners.length;for(;u-- >0;)s._listeners[u](o);s._listeners=null}),this.promise.then=o=>{let u,d=new We(f=>{s.subscribe(f),u=f}).then(o);return d.cancel=function(){s.unsubscribe(u)},d},t(function(o,u,d){s.reason||(s.reason=new SE(o,u,d),n(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;let n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){let t=new AbortController,n=s=>{t.abort(s)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new q1(function(n){t=n}),cancel:t}}}var Nue=q1;let X1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(X1).forEach(e=>{let[t,n]=e;X1[n]=t});var Pue=X1;let _s=(function e(t){let n=new hb(t),s=c3(hb.prototype.request,n);return Ye.extend(s,hb.prototype,n,{allOwnKeys:!0}),Ye.extend(s,n,null,{allOwnKeys:!0}),s.create=function(o){return e(Im(t,o))},s})(F1);_s.Axios=hb,_s.CanceledError=SE,_s.CancelToken=Nue,_s.isCancel=e4,_s.VERSION=y4,_s.toFormData=KR,_s.AxiosError=Un,_s.Cancel=_s.CanceledError,_s.all=function(e){return We.all(e)},_s.spread=function(e){return function(t){return e.apply(null,t)}},_s.isAxiosError=function(e){return Ye.isObject(e)&&e.isAxiosError===!0},_s.mergeConfig=Im,_s.AxiosHeaders=Vl,_s.formToJSON=e=>QB(Ye.isHTMLForm(e)?new FormData(e):e),_s.getAdapter=_4.getAdapter,_s.HttpStatusCode=Pue,_s.default=_s;var oa=_s;let kue=()=>{};function CT(){let e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:kue};return e.promise=new We((t,n)=>{e.resolve=s=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(s),e.value=s)},e.reject=s=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(s))}}),e}let pb=new Map,fb=new Map,Yu=new Map,wi=(function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e})({}),_n=(function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e})({}),S4=new poe,Fl=S4.getResult(),J1=null;function pn(e){if(!J1){Fl=S4.getResult();let t=(function(f){if(f.engine.name==="Blink"&&f.browser.name!=="WeChat")return _n.CHROME;switch(f.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return _n.CHROME;case"Safari":case"Mobile Safari":return _n.SAFARI;case"Edge":return _n.EDGE;case"Firefox":return _n.FIREFOX;case"QQ":case"QQBrowser":return _n.QQ;case"Opera":return _n.OPERA;case"WeChat":return _n.WECHAT;default:return f.browser.name||""}})(Fl),n=T4(Fl),s=(function(f){return f.os.name==="Windows"?f.os.version?f.os.name+" "+f.os.version:f.os.name:f.os.name||""})(Fl),o=Fl.os.version,u=T4(Fl,!1),d=Fl.device.type;if(!(t&&n&&s&&o))return{name:t,version:n,os:s,osVersion:o,browserVersion:u,deviceType:d};J1={name:t,version:n,os:s,osVersion:o,browserVersion:u,deviceType:d}}return J1}function T4(e){let t,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function mb(){return pn().os}function w4(){let e=pn();return"".concat(e.os," ").concat(e.osVersion)}function gb(){let e=pn();return!!(Fl.engine.name==="WebKit"&&e.os===wi.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==_n.SAFARI||Es()&&e.name!==_n.SAFARI)}function Qd(){return pn().name===_n.CHROME}function Pi(){return pn().name===_n.SAFARI}function C4(){let e=pn();if(e.name!==_n.SAFARI||!e.browserVersion)return!1;let t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function R4(){return pn().name===_n.EDGE}function $n(){return pn().name===_n.FIREFOX}function Es(){return pn().os===wi.IOS}function jl(e){let t=pn();return!(t.name!==_n.CHROME||!t.osVersion)&&Number(t.version)>=e}function b4(e){let t=pn();return!(t.name!==_n.CHROME||!t.osVersion)&&Number(t.version)<e}function $1(e,t,n){let s=pn();return!(s.name!==e||!s.osVersion)&&(n?Number(s.version)>=t&&Number(s.version)<=n:Number(s.version)===t)}function gp(e){let t=pn();return!(t.name!==_n.EDGE||!t.osVersion)&&Number(t.version)>=e}function Q1(e){let t=pn();return!(t.name!==_n.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function I4(e){let t=pn();return!(t.name!==_n.SAFARI||!t.osVersion)&&Number(t.version)>=e}function A4(e,t,n){let s=pn();if(s.os!==wi.IOS||!s.osVersion)return!1;let o=s.osVersion.split(".");return n?t&&Number(o[0])===e&&Number(o[1])>t||Number(o[0])>e:t?Number(o[0])===e&&Number(o[1])>=t||Number(o[0])>e:Number(o[0])>=e}function O4(e,t,n){let s=pn();if(s.os!==wi.IOS||!s.osVersion)return!1;let o=s.osVersion.split(".");return n?t&&Number(o[0])===e&&Number(o[1])<t||Number(o[0])<e:t?Number(o[0])===e&&Number(o[1])<=t||Number(o[0])<e:Number(o[0])<=e}function Z1(e,t,n){let s=pn();if(s.name!==_n.SAFARI||!s.osVersion||!s.browserVersion)return!1;let o=s.browserVersion.split(".");return n?t&&Number(o[0])===e&&Number(o[1])<t||Number(o[0])<e:t?Number(o[0])===e&&Number(o[1])<=t||Number(o[0])<e:Number(o[0])<=e}function Am(e){let t=pn();return!(t.name!==_n.OPERA||!t.osVersion)&&Number(t.version)>=e}function N4(){let e=pn();if(e.os!==wi.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function wE(){let e=pn();if(e.os!==wi.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15}function ek(){let e=pn();if(e.os!==wi.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===16}function P4(){let e=pn();if(e.os!==wi.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function jc(){return Pi()&&navigator.maxTouchPoints>0}function k4(){return pn().name===_n.WECHAT}function D4(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function x4(){let e=mb();return(function(){let{deviceType:t}=pn();return t==="mobile"||t==="tablet"})()||e===wi.ANDROID||e===wi.IOS||e===wi.HARMONY_OS}function qu(){let e=pn();return e.name!==_n.EDGE&&e.name!==_n.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function RT(){return mb()===wi.ANDROID}function bT(){let e=pn();return RT()&&(e.name===_n.CHROME||e.name===_n.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Ct(e,t,n){return(t=(function(s){var o=(function(u,d){if(typeof u!="object"||!u)return u;var f=u[Symbol.toPrimitive];if(f!==void 0){var g=f.call(u,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)})(s);return typeof o=="symbol"?o:o+""})(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function L4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function Le(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?L4(Object(n),!0).forEach(function(s){Ct(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L4(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}let Y=(function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e})({}),_e=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),Ct(this,"code",void 0),Ct(this,"message",void 0),Ct(this,"data",void 0),Ct(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Bc(e,t){if(typeof e!="boolean")throw new _e(Y.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function zr(e,t,n){if(!ke(n).call(n,e))throw new _e(Y.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function Vn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<n||e>s||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!(function(o){return typeof o=="number"&&o%1==0})(e))throw new _e(Y.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(s,"]. integer only"))}function tk(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new _e(Y.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&Vn(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&Vn(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&Vn(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&Vn(e.ideal,"".concat(t,".ideal"),1,1/0)}else Vn(e,t,1,1/0)}function Hi(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,o=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new _e(Y.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!M4(e,n,s,o))throw new _e(Y.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(s,"].").concat(o?" ASCII characters only.":""))}function Zd(e,t){if(!Array.isArray(e))throw new _e(Y.INVALID_PARAMS,"".concat(t," should be an array"))}function wr(e){return e==null}function M4(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,s=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!s||(function(o){if(typeof o!="string")return!1;for(let u=0;u<o.length;u+=1){let d=o.charCodeAt(u);if(d<0||d>255)return!1}return!0})(e))}function U4(e,t,n){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,n);let s=e.getUint32(t,n),o=e.getUint32(t+4,n),u=0,d=1;return BigInt(s*d+o*u)<<BigInt(32)|BigInt(s*u+o*d)}function V4(e,t,n,s){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,n,s);let o=Number(n>>BigInt(32)),u=Number(n&BigInt(4294967295));e.setUint32(t,o,s),e.setUint32(t+4,u,s)}var IT=(function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e})(IT||{}),nk=(function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e})(nk||{});let F4=new class{constructor(){Ct(this,"_clientSize",null),Ct(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Ct(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Ct(this,"getStyle",e=>window.getComputedStyle(e,null)),Ct(this,"checkCssVisibleProperty",e=>{var t;let n=!0,s=this.getStyle(e),{display:o,visibility:u,opacity:d,filter:f}=s;return(o==="none"||ke(t=["hidden","collapse"]).call(t,u)||Number(d)<.1)&&(n=!1),!!n&&(f&&f.split(" ").filter(g=>{var y;let v=g.split("(")[0];return ke(y=["brightness","blur","opacity"]).call(y,v)}).map(g=>{let[y,v]=g.split(/\(|\)/);return[y,Number(v.match(/^[0-9\.]+/))]}).forEach(g=>{let[y,v]=g;switch(y){case"brightness":(v<.1||v>3)&&(n=!1);break;case"blur":v>3&&(n=!1);break;case"opacity":v<.1&&(n=!1)}}),n)}),Ct(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,s=!0,o=d=>t(d),u=e;for(;u&&s;)o(u)||(n=!1,s=!1),u=u.parentElement,u||(s=!1);return n}),Ct(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),Ct(this,"getSizeAboutClient",e=>{let{width:t,height:n,left:s,right:o,top:u,bottom:d}=e.getBoundingClientRect(),f=this.getClientWidth(),g=this.getClientHeight();return{width:t,height:n,left:s,right:o,top:u,bottom:d,clientWidth:f,clientHeight:g,clientMin:Math.min(f,g)}}),Ct(this,"checkActualSize",()=>{let{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),Ct(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),Ct(this,"checkCoverForAPoint",(e,t,n)=>{let s=this.elementFromPoint(e,t);return s!==null&&s!==n}),Ct(this,"getPointPositionList",()=>{let{width:e,height:t,left:n,top:s}=this._clientSize,o=e/6,u=t/6,d=[],f=10**6;for(let g=0;g<5;g++)for(let y=0;y<5;y++){let v=(n*f+(g===0?.1:g===4?(o*g*f-1e5)/f:o*g)*f)/f,R=(s*f+(y===0?.1:y===4?(u*y*f-1e5)/f:u*y)*f)/f;d.push({x:v,y:R})}return[...d]}),Ct(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),Ct(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),Ct(this,"checkSizeOfPartInClient",()=>{let{left:e,right:t,top:n,bottom:s,clientHeight:o,clientWidth:u,clientMin:d}=this._clientSize,f,g,y,v;if(e<0)f=0;else{if(!(e<u))return!1;f=e}if(t<0)return!1;if(g=t<u?t:u,n<0)y=0;else{if(!(n<o))return!1;y=n}if(s<0)return!1;v=s<o?s:o;let R=g-f,b=v-y;return this.checkSizeIsVisible(R,b,d)}),Ct(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),Ct(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(IT.COVERED);{let t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(IT.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(IT.SIZE)}}return this.returnHiddenResult(IT.STYLE)}return this.returnHiddenResult(nk.UNMOUNTED)}return this.returnHiddenResult(nk.INVALID_HTML_ELEMENT)}),Ct(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function rk(e){return new TextEncoder().encode(e)}let j4=function(e,t){let n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},ik=async e=>(function(t,n){let s="";return new Uint8Array(t).forEach(o=>{s+=o.toString(n).padStart(2,"0")}),s})(await crypto.subtle.digest("SHA-256",rk(e)),16),dr=class{constructor(){Ct(this,"_events",{}),Ct(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);let n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);let n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;let n=this._events[e],s=this._indexOfListener(n,t);s!==-1&&n.splice(s,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);let t=this._events[e].map(u=>u);for(var n=arguments.length,s=new Array(n>1?n-1:0),o=1;o<n;o++)s[o-1]=arguments[o];for(let u=0;u<t.length;u+=1){let d=t[u];d.once&&this.off(e,d.listener),d.listener.apply(this,s||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];[...this._events[e]||[]].forEach(o=>{o.once&&this.off(e,o.listener);try{o.listener.apply(this,n)}catch(u){console.error("safeEmit event:".concat(e," error ").concat(u?.toString()))}})}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}},AT=null;function B4(){if(AT)return AT;if(window.electron)return AT=window.electron;if(!window.require)return null;try{return AT=window.require("electron"),AT}catch{return null}}let or=(function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e.VOS_FALLBACK_CN="vosFallbackCN",e.DATACHANNEL_FAILBACK="datachannelFailback",e})({}),Fn=(function(e){return e.TRACER="tracer",e})({});function W4(e){return Vn(e.timeout,"config.timeout",0,1e5),Vn(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Vn(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Vn(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Due=(function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e})({}),tn=(function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.FALLBACK_TO_HLS="FALLBACK_TO_HLS",e.UID_CONFLICT="UID_CONFLICT",e})({});function Om(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function G4(e){return Hi(e.turnServerURL,"turnServerURL"),Hi(e.username,"username"),Hi(e.password,"password"),e.udpport&&Vn(e.udpport,"udpport",1,99999,!0),e.forceturn&&Bc(e.forceturn,"forceturn"),e.security&&Bc(e.security,"security"),e.tcpport&&Vn(e.tcpport,"tcpport",1,99999,!0),!0}let CE=(function(e){return e[e.AUTO_SIMULCAST_STREAM=-1]="AUTO_SIMULCAST_STREAM",e[e.DISABLE_SIMULCAST_STREM=0]="DISABLE_SIMULCAST_STREM",e[e.ENABLE_SIMULCAST_STREAM=1]="ENABLE_SIMULCAST_STREAM",e})({});function sk(e){return e.level!==void 0&&zr(e.level,"level",[1,2,3]),e.delay!==void 0&&Vn(e.delay,"delay",0,3e3,!0),!0}let Ht=(function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e.FALLBACK_TO_HLS="fallback-to-hls",e.FIRST_VIDEO_BUFFER_READY="first-video-buffer-ready",e.FIRST_VIDEO_PRE_RENDER="first-video-pre-render",e.AV1_DECODABLE_RESULT="av1-decodable-result",e})({}),ak=(function(e){return e.CONFIG="config",e.VOSERROR="vos_error",e.AP_ERROR="ap_error",e})({}),ts=(function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e})({}),Gs=(function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e})({}),Nm=(function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e})({});function ei(e,t){for(var n=arguments.length,s=new Array(n>2?n-2:0),o=2;o<n;o++)s[o-2]=arguments[o];return e.getListeners(t).length===0?We.reject(new _e(Y.UNEXPECTED_ERROR,"can not emit promise")):new We((u,d)=>{e.emit(t,...s,u,d)})}function Wn(e,t){if(e.getListeners(t).length===0)return We.resolve();for(var n=arguments.length,s=new Array(n>2?n-2:0),o=2;o<n;o++)s[o-2]=arguments[o];return ei(e,t,...s)}function qa(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,s=new Array(n>2?n-2:0),o=2;o<n;o++)s[o-2]=arguments[o];return Pm(e,t,...s)}function Pm(e,t){let n=null,s=null;for(var o=arguments.length,u=new Array(o>2?o-2:0),d=2;d<o;d++)u[d-2]=arguments[d];if(e.emit(t,...u,f=>{n=f},f=>{s=f}),s!==null)throw s;if(n===null)throw new _e(Y.UNEXPECTED_ERROR,"handler is not sync");return n}let Cr=new class extends dr{set networkState(e){this.emit(Nm.NETWORK_STATE_CHANGE,e,this._networkState),e===Gs.ONLINE?this.emit(Nm.ONLINE):e===Gs.OFFLINE&&(this.onlineWaiter=new We(t=>{this.once(Nm.ONLINE,()=>{this.onlineWaiter=void 0,t(Gs.ONLINE)})}),this.emit(Nm.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===Gs.ONLINE}constructor(){super(),Ct(this,"_moduleName","network-indicator"),Ct(this,"_networkState",Gs.ONLINE),Ct(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Gs.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Gs.OFFLINE})}},ca=[];for(let e=0;e<256;++e)ca.push((e+256).toString(16).slice(1));let H4=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ok,xue=new Uint8Array(16);function Lue(){return H4?H4():(function(n,s,o){var u,d,f,g;let y=(u=(d=(n=n||{}).random)!==null&&d!==void 0?d:(f=(g=n).rng)===null||f===void 0?void 0:f.call(g))!==null&&u!==void 0?u:(function(){if(!ok){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ok=crypto.getRandomValues.bind(crypto)}return ok(xue)})();if(y.length<16)throw new Error("Random bytes length must be >= 16");if(y[6]=15&y[6]|64,y[8]=63&y[8]|128,s){if((o=o||0)<0||o+16>s.length)throw new RangeError("UUID byte range ".concat(o,":").concat(o+15," is out of buffer bounds"));for(let v=0;v<16;++v)s[o+v]=y[v];return s}return(function(v){let R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(ca[v[R+0]]+ca[v[R+1]]+ca[v[R+2]]+ca[v[R+3]]+"-"+ca[v[R+4]]+ca[v[R+5]]+"-"+ca[v[R+6]]+ca[v[R+7]]+"-"+ca[v[R+8]]+ca[v[R+9]]+"-"+ca[v[R+10]]+ca[v[R+11]]+ca[v[R+12]]+ca[v[R+13]]+ca[v[R+14]]+ca[v[R+15]]).toLowerCase()})(y)})(e,t,void 0);var e,t}function _b(e,t){let n=e.indexOf(t);n!==-1&&e.splice(n,1)}function RE(e){let t=[];return e.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),t}function Eb(e){We!==void 0?We.resolve().then(e):setTimeout(e,0)}function Qn(e){return JSON.parse(JSON.stringify(e))}function km(e){try{return Qn(e)}catch{return e}}let z4={};function _p(e,t){z4[t]||(z4[t]=!0,e())}function Dm(e){let t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let s=0;s<t.length;s+=1)n[s]=t.charCodeAt(s);return n}function Ep(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function K4(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){let s=new Uint8Array(t);s.set(n),n=s}return n}function Y4(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let s=ta(t).call(t,(d,f)=>d+f.length,0),o=new Uint8Array(new ArrayBuffer(s)),u=0;return t.forEach(d=>{o.set(d,u),u+=d.length}),o}function Xu(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function q4(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(n=>{t+=typeof n=="string"?Xu(n):n.size}),t+138}function Mue(e){let t=new _e(Y.TIMEOUT,"timeout");return new We((n,s)=>{window.setTimeout(()=>s(t),e)})}function Ci(e){return new We(t=>{window.setTimeout(t,e)})}function In(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0,n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+In(e-n.length,"")}function xm(){let e,t=!1;try{var n;e=hoe(n=Lue()).call(n,"-","")}catch{t=!0}return!t&&e&&e.length===32||(e=In(32,"")),e.toUpperCase()}let OT=()=>{},X4=new class{constructor(){Ct(this,"fnMap",new Map)}throttleByKey(e,t,n,s){for(var o=arguments.length,u=new Array(o>4?o-4:0),d=4;d<o;d++)u[d-4]=arguments[d];if(this.fnMap.has(t)){let f=this.fnMap.get(t);if(f.threshold!==n){f.fn(...f.args),clearTimeout(f.timer);let g=window.setTimeout(()=>{let y=this.fnMap.get(t);y&&y.fn(...y.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:g,args:u,skipFn:s})}else f.skipFn&&f.skipFn(...f.args),this.fnMap.set(t,Le(Le({},f),{},{fn:e,args:u,skipFn:s}))}else{let f=window.setTimeout(()=>{let g=this.fnMap.get(t);g&&g.fn(...g.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:f,args:u,skipFn:s})}}},J4=X4.throttleByKey.bind(X4);function $4(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function ck(e,t){if(!$4(e)||!$4(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){let n=[...e];for(let s=0;s<t.length;s++)n[s]=ck(e[s],t[s]);return n}{let n=Le({},e);for(let s in t)Object.prototype.hasOwnProperty.call(t,s)&&(Object.prototype.hasOwnProperty.call(e,s)?n[s]=ck(e[s],t[s]):n[s]=t[s]);return n}}function Q4(e,t){let n=[0];if(n=new Array(t).fill(0),e===0)return n;let s=0;for(;e>0&&(n[s]=255&e,e>>=8,s++,s!==t););return n}function bE(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function lk(e,t){try{return typeof e=="object"&&typeof t=="object"&&JSON.stringify(e)===JSON.stringify(t)}catch{return!1}}function uk(e){return ta(e).call(e,(t,n)=>t+n,0)}function Z4(e){let t="0123456789abcdef";function n(Q){let se,oe="";for(se=0;se<=3;se++)oe+=t.charAt(Q>>8*se+4&15)+t.charAt(Q>>8*se&15);return oe}function s(Q,se){let oe=(65535&Q)+(65535&se);return(Q>>16)+(se>>16)+(oe>>16)<<16|65535&oe}function o(Q,se,oe,ne,de,we){return s((function(Oe,Qe){return Oe<<Qe|Oe>>>32-Qe})(s(s(se,Q),s(ne,we)),de),oe)}function u(Q,se,oe,ne,de,we,Oe){return o(se&oe|~se&ne,Q,se,de,we,Oe)}function d(Q,se,oe,ne,de,we,Oe){return o(se&ne|oe&~ne,Q,se,de,we,Oe)}function f(Q,se,oe,ne,de,we,Oe){return o(se^oe^ne,Q,se,de,we,Oe)}function g(Q,se,oe,ne,de,we,Oe){return o(oe^(se|~ne),Q,se,de,we,Oe)}let y=(function(Q){let se,oe=1+(Q.length+8>>6),ne=new Array(16*oe);for(se=0;se<16*oe;se++)ne[se]=0;for(se=0;se<Q.length;se++)ne[se>>2]|=Q.charCodeAt(se)<<se%4*8;return ne[se>>2]|=128<<se%4*8,ne[16*oe-2]=8*Q.length,ne})(e),v,R,b,A,F,M=1732584193,j=-271733879,K=-1732584194,q=271733878;for(v=0;v<y.length;v+=16)R=M,b=j,A=K,F=q,M=u(M,j,K,q,y[v+0],7,-680876936),q=u(q,M,j,K,y[v+1],12,-389564586),K=u(K,q,M,j,y[v+2],17,606105819),j=u(j,K,q,M,y[v+3],22,-1044525330),M=u(M,j,K,q,y[v+4],7,-176418897),q=u(q,M,j,K,y[v+5],12,1200080426),K=u(K,q,M,j,y[v+6],17,-1473231341),j=u(j,K,q,M,y[v+7],22,-45705983),M=u(M,j,K,q,y[v+8],7,1770035416),q=u(q,M,j,K,y[v+9],12,-1958414417),K=u(K,q,M,j,y[v+10],17,-42063),j=u(j,K,q,M,y[v+11],22,-1990404162),M=u(M,j,K,q,y[v+12],7,1804603682),q=u(q,M,j,K,y[v+13],12,-40341101),K=u(K,q,M,j,y[v+14],17,-1502002290),j=u(j,K,q,M,y[v+15],22,1236535329),M=d(M,j,K,q,y[v+1],5,-165796510),q=d(q,M,j,K,y[v+6],9,-1069501632),K=d(K,q,M,j,y[v+11],14,643717713),j=d(j,K,q,M,y[v+0],20,-373897302),M=d(M,j,K,q,y[v+5],5,-701558691),q=d(q,M,j,K,y[v+10],9,38016083),K=d(K,q,M,j,y[v+15],14,-660478335),j=d(j,K,q,M,y[v+4],20,-405537848),M=d(M,j,K,q,y[v+9],5,568446438),q=d(q,M,j,K,y[v+14],9,-1019803690),K=d(K,q,M,j,y[v+3],14,-187363961),j=d(j,K,q,M,y[v+8],20,1163531501),M=d(M,j,K,q,y[v+13],5,-1444681467),q=d(q,M,j,K,y[v+2],9,-51403784),K=d(K,q,M,j,y[v+7],14,1735328473),j=d(j,K,q,M,y[v+12],20,-1926607734),M=f(M,j,K,q,y[v+5],4,-378558),q=f(q,M,j,K,y[v+8],11,-2022574463),K=f(K,q,M,j,y[v+11],16,1839030562),j=f(j,K,q,M,y[v+14],23,-35309556),M=f(M,j,K,q,y[v+1],4,-1530992060),q=f(q,M,j,K,y[v+4],11,1272893353),K=f(K,q,M,j,y[v+7],16,-155497632),j=f(j,K,q,M,y[v+10],23,-1094730640),M=f(M,j,K,q,y[v+13],4,681279174),q=f(q,M,j,K,y[v+0],11,-358537222),K=f(K,q,M,j,y[v+3],16,-722521979),j=f(j,K,q,M,y[v+6],23,76029189),M=f(M,j,K,q,y[v+9],4,-640364487),q=f(q,M,j,K,y[v+12],11,-421815835),K=f(K,q,M,j,y[v+15],16,530742520),j=f(j,K,q,M,y[v+2],23,-995338651),M=g(M,j,K,q,y[v+0],6,-198630844),q=g(q,M,j,K,y[v+7],10,1126891415),K=g(K,q,M,j,y[v+14],15,-1416354905),j=g(j,K,q,M,y[v+5],21,-57434055),M=g(M,j,K,q,y[v+12],6,1700485571),q=g(q,M,j,K,y[v+3],10,-1894986606),K=g(K,q,M,j,y[v+10],15,-1051523),j=g(j,K,q,M,y[v+1],21,-2054922799),M=g(M,j,K,q,y[v+8],6,1873313359),q=g(q,M,j,K,y[v+15],10,-30611744),K=g(K,q,M,j,y[v+6],15,-1560198380),j=g(j,K,q,M,y[v+13],21,1309151649),M=g(M,j,K,q,y[v+4],6,-145523070),q=g(q,M,j,K,y[v+11],10,-1120210379),K=g(K,q,M,j,y[v+2],15,718787259),j=g(j,K,q,M,y[v+9],21,-343485551),M=s(M,R),j=s(j,b),K=s(K,A),q=s(q,F);return n(M)+n(j)+n(K)+n(q)}let Uue=1,e5=console,ki=class{static setLogger(e){e5=e}constructor(e,t){Ct(this,"id",void 0),Ct(this,"lockingPromise",We.resolve()),Ct(this,"locks",0),Ct(this,"name",""),Ct(this,"lockId",void 0),this.lockId=Uue++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){let n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),s=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");e5.debug("".concat(n," ").concat(s))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);let n=new We(o=>{t=()=>{this.locks-=1,this.logger("unlocked",e),o()}}),s=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>n),s}};function IE(e,t){return function(n,s,o){let u=o.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){let d=this[t];if(!d)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));let f=await d.lock("From ".concat(e,".").concat(s));try{for(var g=arguments.length,y=new Array(g),v=0;v<g;v++)y[v]=arguments[v];return await u.apply(this,y)}finally{f()}},o}}let Kr={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function yb(e,t){let n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function Bl(e,t,n,s){let o=Object.assign({},Kr,s),u=o.timeout,d=async()=>{await(function(y){return new We(v=>{window.setTimeout(v,y)})})(u),u*=o.timeoutFactor,u=Math.min(o.maxRetryTimeout,u)},f=!1,g=new We(async(y,v)=>{t=t||(()=>!1),n=n||(()=>!0);for(let R=0;R<o.maxRetryCount;R+=1){if(f)return v(new _e(Y.OPERATION_ABORTED));try{let b=await e();if(!t(b,R)||R+1===o.maxRetryCount)return y(b);await d()}catch(b){if(!n(b,R)||R+1===o.maxRetryCount)return v(b);await d()}}});return g.cancel=()=>f=!0,g}let vb,dk=class{constructor(e){Ct(this,"input",[]),Ct(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:ta(e=this.input).call(e,(t,n)=>t+n)/this.input.length}},Sb=0,hk=0;function pk(e,t,n,s){return new We((o,u)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),Sb+=Xu(t.data)):n&&(t.data.size?Sb+=t.data.size:t.data instanceof FormData?Sb+=q4(t.data):Sb+=Xu(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,oa.request(t).then(d=>{typeof d.data=="string"?hk+=Xu(d.data):d.data instanceof ArrayBuffer||d.data instanceof Uint8Array?hk+=d.data.byteLength:hk+=Xu(JSON.stringify(d.data)),o(d.data)}).catch(d=>{oa.isCancel(d)?u(new _e(Y.OPERATION_ABORTED,"cancel token canceled")):d.code==="ECONNABORTED"?u(new _e(Y.NETWORK_TIMEOUT,d.message)):d.response?u(new _e(Y.NETWORK_RESPONSE_ERROR,d.response.status)):u(new _e(Y.NETWORK_ERROR,d.message))})})}async function Vue(e,t){let n=new Blob([t.data],{type:"buffer"});return await pk(e,Le(Le({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}let t5=()=>window.isSecureContext!==void 0;function Wc(e){if(Array.isArray(e))return e.map(n=>n);if(!n5(e))return e;let t={};for(let n in e){let s=e[n];n5(s)||Array.isArray(s)?t[n]=Wc(s):t[n]=s}return t}function n5(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let fk=class{constructor(e){Ct(this,"input",[]),Ct(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}},Gc={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},NT={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],transport:{bytesSent:0,bytesReceived:0,packetsSent:0,packetsReceived:0},selectedCandidatePair:{id:"unknown",localCandidate:Gc,remoteCandidate:Gc},updateInterval:0},r5={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},i5={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},s5={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},a5={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0},mk=class{constructor(e,t){Ct(this,"onFirstVideoReceived",void 0),Ct(this,"onFirstVideoDecoded",void 0),Ct(this,"onFirstAudioReceived",void 0),Ct(this,"onFirstVideoDecodedTimeout",void 0),Ct(this,"onFirstAudioDecoded",void 0),Ct(this,"onSelectedLocalCandidateChanged",void 0),Ct(this,"onSelectedRemoteCandidateChanged",void 0),Ct(this,"videoIsReady",!1),Ct(this,"videoIsReady2",{}),Ct(this,"pc",void 0),Ct(this,"options",void 0),Ct(this,"intervalTimer",void 0),Ct(this,"stats",Wc(NT)),Ct(this,"isFirstVideoReceived",{}),Ct(this,"isFirstVideoDecoded",{}),Ct(this,"isFirstAudioReceived",{}),Ct(this,"isFirstAudioDecoded",{}),Ct(this,"isFirstVideoDecodedTimeout",{}),Ct(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new We(e=>{e({local:Le({},Gc),remote:Le({},Gc)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);let t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"],s=0,o=0,u=0,d=0;for(let f of n)e[f].forEach((g,y)=>{if(!this.lossRateWindowStats[t-1][f][y]||!this.lossRateWindowStats[0][f][y])return;let v=this.lossRateWindowStats[t-1][f][y].packets-this.lossRateWindowStats[0][f][y].packets,R=this.lossRateWindowStats[t-1][f][y].packetsLost-this.lossRateWindowStats[0][f][y].packetsLost;f==="videoSend"||f==="audioSend"?(s+=v,u+=R):(o+=v,d+=R),Number.isNaN(v)||Number.isNaN(v)?g.packetLostRate=0:g.packetLostRate=v<=0||R<=0?0:R/(v+R)});e.sendPacketLossRate=s<=0||u<=0?0:u/(s+u),e.recvPacketLossRate=o<=0||d<=0?0:d/(o+d)}},Fue=class extends mk{constructor(){super(...arguments),Ct(this,"_stats",NT),Ct(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){let e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=Wc(NT);let n=t.filter(o=>o.type==="ssrc");this.processSSRCStats(n);let s=t.find(o=>o.type==="VideoBwe");s&&this.processBandwidthStats(s),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var n;let s=ke(n=t.id).call(n,"send");switch("".concat(t.mediaType,"_").concat(s?"send":"recv")){case"video_send":{let o=Wc(i5);o.codec=t.googCodecName,o.adaptionChangeReason="none",t.googCpuLimitedResolution&&(o.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(o.adaptionChangeReason="bandwidth"),o.avgEncodeMs=Number(t.googAvgEncodeMs),o.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},o.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},o.firsCount=Number(t.googFirReceived),o.nacksCount=Number(t.googNacksReceived),o.plisCount=Number(t.googPlisReceived),o.frameCount=Number(t.framesEncoded),o.bytes=Number(t.bytesSent),o.packets=Number(t.packetsSent),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(o),this._stats.rtt=o.rttMs;break}case"video_recv":{let o=Wc(r5),u=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(o.codec=t.googCodecName,o.targetDelayMs=Number(t.googTargetDelayMs),o.renderDelayMs=Number(t.googRenderDelayMs),o.currentDelayMs=Number(t.googCurrentDelayMs),o.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),o.decodeMs=Number(t.googDecodeMs),o.maxDecodeMs=Number(t.googMaxDecodeMs),o.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},o.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},o.decodeFrameRate=Number(t.googFrameRateDecoded),o.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},o.jitterBufferMs=Number(t.googJitterBufferMs),o.firsCount=Number(t.googFirsSent),o.nacksCount=Number(t.googNacksSent),o.plisCount=Number(t.googPlisSent),o.framesDecodeCount=Number(t.framesDecoded),o.bytes=Number(t.bytesReceived),o.packets=Number(t.packetsReceived),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.packets>0&&!this.isFirstVideoReceived[o.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(o.ssrc),this.isFirstVideoReceived[o.ssrc]=!0),o.framesDecodeCount>0&&!this.isFirstVideoDecoded[o.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(o.ssrc,o.decodedFrame.width,o.decodedFrame.height),this.isFirstVideoDecoded[o.ssrc]=!0),u){let d=u.stats,f=Date.now()-u.lts;o.framesDecodeFreezeTime=d.framesDecodeFreezeTime,o.framesDecodeInterval=d.framesDecodeInterval,o.framesDecodeCount>d.framesDecodeCount&&this.isFirstVideoDecoded[o.ssrc]?(u.lts=Date.now(),o.framesDecodeInterval=f,o.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?o.framesDecodeFreezeTime+=o.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):o.framesDecodeCount<u.stats.framesDecodeCount&&(o.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(o.ssrc,{stats:Le({},o),lts:Date.now()}),this._stats.videoRecv.push(o);break}case"audio_recv":{let o=Wc(a5);o.codec=t.googCodecName,o.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,o.decodingCNG=Number(t.googDecodingCNG),o.decodingCTN=Number(t.googDecodingCTN),o.decodingCTSG=Number(t.googDecodingCTSG),o.decodingNormal=Number(t.googDecodingNormal),o.decodingPLC=Number(t.googDecodingPLC),o.decodingPLCCNG=Number(t.googDecodingPLCCNG),o.expandRate=Number(t.googExpandRate),o.accelerateRate=Number(t.googAccelerateRate),o.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),o.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),o.speechExpandRate=Number(t.googSpeechExpandRate),o.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),o.jitterBufferMs=Number(t.googJitterBufferMs),o.jitterMs=Number(t.googJitterReceived),o.bytes=Number(t.bytesReceived),o.packets=Number(t.packetsReceived),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),o.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),o.receivedFrames>0&&!this.isFirstAudioReceived[o.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(o.ssrc),this.isFirstAudioReceived[o.ssrc]=!0),o.decodingNormal>0&&!this.isFirstAudioDecoded[o.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(o.ssrc),this.isFirstAudioDecoded[o.ssrc]=!0),this._stats.audioRecv.push(o);break}case"audio_send":{let o=Wc(s5);o.codec=t.googCodecName,o.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,o.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),o.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),o.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),o.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),o.bytes=Number(t.bytesSent),o.packets=Number(t.packetsSent),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.rttMs=Number(t.googRtt||0),this._stats.rtt=o.rttMs,this._stats.audioSend.push(o);break}}})}_getStats(){return new We((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){let t=[];return e.result().forEach(n=>{let s={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(o=>{s[o]=n.stat(o)}),t.push(s)}),t}},AE=(function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e})({}),Tb=(function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e})({}),gk=(function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e})({}),po=(function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e})({});var OE=(function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e})(OE||{});function PT(e,t,n,s){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:OE.kNone;if(!t)return;let u=Number(t[n]);if(typeof u!="number")return;let d=Number(t[s]);if(typeof d!="number")return;if(!e)return d?u/d*o:void 0;let f=Number(e[n]);if(typeof f!="number")return;let g=Number(e[s]);if(typeof g!="number")return;let y=d-g;return y?(u-f)/y*o:void 0}let o5=class extends mk{constructor(){super(...arguments),Ct(this,"_stats",NT),Ct(this,"report",void 0),Ct(this,"lastDecodeVideoReceiverStats",new Map),Ct(this,"lastVideoFramesRecv",new Map),Ct(this,"lastVideoFramesSent",new Map),Ct(this,"lastVideoFramesDecode",new Map),Ct(this,"lastVideoFramesOutput",new Map),Ct(this,"lastVideoJBDelay",new Map),Ct(this,"lastAudioJBDelay",new Map),Ct(this,"mediaBytesSent",new Map),Ct(this,"mediaBytesRetransmit",new Map),Ct(this,"mediaBytesTargetEncode",new Map),Ct(this,"lastDecodeAudioReceiverStats",new Map),Ct(this,"lastAudioConcealment",new Map),Ct(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Wc(NT),this.report.forEach(e=>{switch(e.type){case po.OUTBOUND:case po.INBOUND:{let t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,s=!t&&!("frameWidth"in e);e.type===po.OUTBOUND?t==="audio"||s?this.processAudioOutboundStats(e):(t==="video"||n)&&this.processVideoOutboundStats(e):e.type===po.INBOUND&&(t==="audio"||s?this.processAudioInboundStats(e):(t==="video"||n)&&this.processVideoInboundStats(e));break}case po.TRANSPORT:{this.processTransportStats(e);let t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case po.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){let e=await this.pc.getStats(),t={local:Le({},Gc),remote:Le({},Gc)};return e.forEach(n=>{let s;if(n.type===po.TRANSPORT&&(s=e.get(n.selectedCandidatePairId)),n.type===po.CANDIDATE_PAIR&&n.selected&&(s=n),s){let o=(u,d)=>{u.type=d.type,u.id=d.id,d.address&&(u.address=d.address),d.candidateType&&(u.candidateType=d.candidateType),d.port&&(u.port=d.port),d.priority&&(u.priority=d.priority),d.protocol&&(u.protocol=d.protocol),d.relayProtocol&&(u.relayProtocol=d.relayProtocol)};if(s.localCandidateId){let u=e.get(s.localCandidateId);u&&o(t.local,u)}if(s.remoteCandidateId){let u=e.get(s.remoteCandidateId);u&&o(t.remote,u)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){let t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){let t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===po.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===po.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===po.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Le({},t),Le({},this.stats.selectedCandidatePair.localCandidate)),e.type===po.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Le({},t),Le({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(s=>s.ssrc===e.ssrc);t||(t=Wc(a5),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount,t.estimatedPlayoutTimestamp=e.estimatedPlayoutTimestamp;let n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=PT(n,t,"totalProcessingDelay","jitterBufferEmittedCount",OE.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,n,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,Le({},t))}calculateAudioFreeze(e,t,n){let s=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&s!=null){let o=s.lts,u=n.timestamp,d=u-o;if(d<=0)return;let f=e.concealedSamples-t.concealedSamples-0,g=s.nonSilent+f,y=e.totalSamplesReceived-t.totalSamplesReceived;if(y<=0)return;let v=80*y/d,R=200*y/d,b=d/y,A=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,g>v&&(s.plc80>0?(e.freezeSamples80+=f,e.freezeMs80+=Math.round(f*b)):(e.freezeSamples80+=g,e.freezeMs80+=Math.round(g*b)),A=s.plc80+1);let F=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,g>R&&(s.plc200>0?(e.freezeSamples200+=f,e.freezeMs200+=Math.round(f*b)):(e.freezeSamples200+=g,e.freezeMs200+=Math.round(g*b)),F=s.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:f,lts:u,plc80:A,plc200:F})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:n.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(d=>d.ssrc===e.ssrc);t||(t=Wc(r5),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.estimatedPlayoutTimestamp=e.estimatedPlayoutTimestamp;let n=this.lastDecodeVideoReceiverStats.get(t.ssrc),s=this.lastVideoFramesDecode.get(t.ssrc),o=this.lastVideoFramesOutput.get(t.ssrc),u=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){let d=t.decodedFrame?t.decodedFrame.width:0,f=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,d,f),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){let d=n.stats,f=u-n.lts;t.framesDecodeFreezeTime=d.framesDecodeFreezeTime,t.framesDecodeInterval=d.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&f>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>d.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=f,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<d.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=PT(n?.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=PT(n?.stats,t,"totalProcessingDelay","framesDecodeCount",OE.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=PT(n?.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",OE.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=PT(n?.stats,t,"totalInterFrameDelay","framesDecodeCount",OE.kMillisecondsFromSeconds),s&&u-s.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-s.count)/((u-s.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:u,rate:t.decodeFrameRate})):s?t.decodeFrameRate=s.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:u,rate:0}),t.framesDroppedCount&&e.framesReceived&&(o&&u-o.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-o.count)/((u-o.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:u,rate:Math.max(t.outputFrameRate,0)})):o?t.outputFrameRate=o.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:u,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:Le({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(s=>s.ssrc===e.ssrc);t||(t=Wc(i5),this._stats.videoSend.push(t));let n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{let s=new fk(10);s.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,s)}if(e.retransmittedBytesSent!==void 0){let s=this.mediaBytesRetransmit.get(e.ssrc);if(s)s.add(e.retransmittedBytesSent);else{let o=new fk(10);o.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,o)}}if(e.totalEncodedBytesTarget){let s=this.mediaBytesTargetEncode.get(e.ssrc);if(s)s.add(e.totalEncodedBytesTarget);else{let o=new fk(10);o.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,o)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){let s=this.lastEncoderMs.get(e.ssrc);if(!s||s.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{let o=e.framesEncoded-s.lastFrameCount,u=e.totalEncodeTime-s.lastEncoderTime;t.avgEncodeMs=1e3*u/o}}if(e.framesEncoded&&e.qpSum){let s=this.lastEncoderMs.get(e.ssrc);!s||s.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-s.lastQpSum)/(e.framesEncoded-s.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let s=this.findRemoteStatsId(e.ssrc,po.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(n=>n.ssrc===e.ssrc);if(t||(t=Wc(s5),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let n=this.findRemoteStatsId(e.ssrc,po.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}processTransportStats(e){this._stats.transport.bytesReceived=e.bytesReceived||this._stats.transport.bytesReceived,this._stats.transport.bytesSent=e.bytesSent||this._stats.transport.bytesSent,this._stats.transport.packetsReceived=e.packetsReceived||this._stats.transport.packetsReceived,this._stats.transport.packetsSent=e.packetsSent||this._stats.transport.packetsSent}findRemoteStatsId(e,t){var n;let s=Array.from(za(n=this.report).call(n)).find(o=>o.type===t&&o.ssrc===e);return s?s.id:null}processVideoMediaSource(e,t){let n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){let n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var s,o,u,d;let f=t?this.report.get(t):void 0,g=(s=f?.framesSent)!==null&&s!==void 0?s:e.framesSent;if(typeof g!="number")return;let y=(o=f?.frameWidth)!==null&&o!==void 0?o:e.frameWidth,v=(u=f?.frameHeight)!==null&&u!==void 0?u:e.frameHeight,R=(d=f?.framesPerSecond)!==null&&d!==void 0?d:e.framesPerSecond;if(typeof y=="number"&&typeof v=="number"||(y=0,v=0),R==null){let b=Date.now(),A=this.lastVideoFramesSent.get(n.ssrc);A&&b-A.lts>=800?(R=Math.round((g-A.count)/((b-A.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:g,lts:b,rate:R})):A?R=A.rate:this.lastVideoFramesSent.set(n.ssrc,{count:g,lts:b,rate:0})}n.sentFrame={width:y,height:v,frameRate:Math.max(0,R)}}processVideoTrackReceiverStats(e,t,n){var s,o,u,d,f;let g=t?this.report.get(t):void 0,y=(s=g?.framesReceived)!==null&&s!==void 0?s:e.framesReceived,v=(o=g?.frameWidth)!==null&&o!==void 0?o:e.frameWidth,R=(u=g?.frameHeight)!==null&&u!==void 0?u:e.frameHeight,b=(d=g?.jitterBufferDelay)!==null&&d!==void 0?d:e.jitterBufferDelay,A=(f=g?.jitterBufferEmittedCount)!==null&&f!==void 0?f:e.jitterBufferEmittedCount;if(typeof y=="number"){let F=this.lastVideoFramesRecv.get(n.ssrc),M=Date.now();n.framesReceivedCount=y;let j=0;F&&M-F.lts>=800?(j=Math.round((y-F.count)/((M-F.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:y,lts:M,rate:j})):F?j=F.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:y,lts:M,rate:0}),n.receivedFrame={width:v||0,height:R||0,frameRate:j||0},n.decodedFrame={width:v||0,height:R||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:v||0,height:R||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(b&&A){let F=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},M=F.jitterBufferMs,j=A-F.jitterBufferEmittedCount;j>0&&(M=1e3*(b-F.jitterBufferDelay)/j),n.jitterBufferMs=M,n.currentDelayMs=Math.round(M),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:b,jitterBufferEmittedCount:A,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var s,o,u,d;let f=t?this.report.get(t):void 0,g=(s=(o=f?.echoReturnLoss)!==null&&o!==void 0?o:e.echoReturnLoss)!==null&&s!==void 0?s:0,y=(u=(d=f?.echoReturnLossEnhancement)!==null&&d!==void 0?d:e.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;n.aecReturnLoss=g,n.aecReturnLossEnhancement=y}processAudioTrackReceiverStats(e,t,n){var s,o,u,d,f,g,y,v,R;let b=t?this.report.get(t):void 0,A=(s=b?.removedSamplesForAcceleration)!==null&&s!==void 0?s:e.removedSamplesForAcceleration,F=(o=b?.totalSamplesReceived)!==null&&o!==void 0?o:e.totalSamplesReceived,M=(u=b?.jitterBufferDelay)!==null&&u!==void 0?u:e.jitterBufferDelay,j=(d=b?.jitterBufferEmittedCount)!==null&&d!==void 0?d:e.jitterBufferEmittedCount,K=(f=b?.audioLevel)!==null&&f!==void 0?f:e?.audioLevel,q=(g=b?.totalSamplesDuration)!==null&&g!==void 0?g:e?.totalSamplesDuration,Q=(y=b?.concealedSamples)!==null&&y!==void 0?y:e.concealedSamples,se=(v=b?.silentConcealedSamples)!==null&&v!==void 0?v:e.silentConcealedSamples,oe=(R=b?.concealmentEvents)!==null&&R!==void 0?R:e.concealmentEvents;if(typeof F=="number"&&(n.totalSamplesReceived=F),typeof se=="number"&&(n.silentConcealedSamples=se),typeof oe=="number"&&(n.concealmentEvents=oe),typeof Q=="number"&&(n.concealedSamples=Q),A&&F&&(n.accelerateRate=A/F),M&&j){let de=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},we=de.jitterBufferMs,Oe=j-de.jitterBufferEmittedCount;Oe>0&&(we=1e3*(M-de.jitterBufferDelay)/Oe),n.jitterBufferMs=Math.round(we),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:M,jitterBufferEmittedCount:j,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=K;let ne=1920;q&&F&&(ne=F/q/50,n.receivedFrames=Math.round(F/ne)),Q&&(n.droppedFrames=Math.round(Q/ne))}processRemoteInboundStats(e,t){let n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){let t=this.report.get(e);if(!t)return"";let n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach(o=>{e+=o.diffMean()}),this.mediaBytesRetransmit.forEach(o=>{t=t===null?o.diffMean():t+o.diffMean()}),this.mediaBytesTargetEncode.forEach(o=>{n=n===null?o.diffMean():n+o.diffMean()});let s=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*s/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},jue=class extends mk{updateStats(){return We.resolve()}};function wb(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4,u=(function(){let d=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return d&&d[0]?Number(d[0].split("/")[1]):null})();return u?u<76?new Fue(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:s,firstVideoDecodedTimeout:o}):new o5(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:s,firstVideoDecodedTimeout:o}):(function(d){if(!window.RTCStatsReport)return!1;let f=d.getStats();return!!(f instanceof We||(function(g){return!!g&&(typeof g=="object"||typeof g=="function")&&typeof g.then=="function"})(f))})(e)?new o5(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:s,firstVideoDecodedTimeout:o}):new jue(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:s,firstVideoDecodedTimeout:o})}let c5="websdk_ng_install_id";function _k(){try{if(z("INSTALL_ID"))return z("INSTALL_ID");let e=window.localStorage.getItem(c5);return e||(e=xm(),window.localStorage.setItem(c5,e)),Ln("INSTALL_ID",e),e}catch{return}}let Xo=(function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;let t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){let n=t[1],s=t[2];return"".concat(n,".").concat(s)}return"4.0.0.999"})("4.24.2"),Ek=(function(){try{return JSON.parse("true")===!0}catch{return!0}})(),Lm=(function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e})({}),ns=(function(){let e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");let s=n.join(""),o=[];for(let f=0;f<6;f++)o.push("1");let u=o.join(""),d={};return d[e]=s,d[t]=u,Object.assign(d,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})})();window.DEFAULT_TURN_CONFIG=ns;let Cb={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},yk={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},vk="v4.24.2-0-g002485b1-dirty(12/12/2025, 5:26:54 PM)",Sk={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",TURN_DOMAINS:["edge.agora.io"],USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,FLS_FALLBACK_TIMEOUT:3e4,RTE_DETAIL_REPORT_INTERVAL:6e4,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0,UPDATE_RTP_CAP_IN_HOST:!1,IOS_BG_TAG:!0,IOS_AUTO_RESTART_BG_TAG:!0,IGNORE_UID_CHECK:!1,ENABLE_UP_SPS_PPS:!1,ENABLE_DOWN_SPS_PPS:!1,NO_EDGES_RETRY:!0,BUFFER_READY_FRAMES:3,FLS_SYNC_AV_PLAY_LIMIT:0,FLS_BUFFER_WAIT_TIME:1500,VOS_CONFIGURE:void 0,ENABLE_QUALITY_FALLBACK:!1,QUALITY_FALLBACK_REHEARSAL:!0,ENABLE_FLS_AV1_FIRST:!1,ENABLE_AP_MULTI_IP:!0,FLS_ENABLE_AV1_DETECT:!0,FLS_ENABLE_AV1_DECODE_DETECT:!0},An=Le(Le(Le(Le({},Sk),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_MANAGER_WSS:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_WSS:"",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,DC_JOIN_WITH_FAILBACK:4e3,DC_CONNECTION_TIMEOUT:2e3,DC_PINGPONG_INTERVAL:2e3,DC_DEBUG_LOG:!1,UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:yk,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},Cb),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,REMOTE_VIDEO_STREAM_TYPE:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_FORCE_HLS:!1,MAX_WEBAUDIO_VOLUME:300,ENABLE_VOS_FALLBACK:!1,ENABLE_FALLBACK_TO_HLS:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!0,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1,IGNORE_RTC_DEVICE_CHECK:!1,FLS_AUTOPLAY_EMITS:!1,ENABLE_DUAL_STREAM_FLAG:!1,FORBID_MODIFY_LOCAL_OFFER_SDP:!1,RESERVE_MID_1_MLINE:!1});function Ln(e,t,n){var s,o,u;ke(s=Object.keys(An)).call(s,e)&&(!n&&ke(o=Object.keys(fo)).call(o,e)||(An[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(An.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(u=!!t,An.USE_NEW_NETWORK_CONFIG=u,u&&(An.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],An.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],An.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],An.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],An.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",An.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",An.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(An.ENABLE_INSTANT_VIDEO=!0,An.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(An.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(An.NEW_TURN_MODE||(An.NEW_TURN_MODE=4))))}function z(e){if(e==="TURN_DOMAINS"){let t=An.TURN_DOMAINS;return ke(t).call(t,z("TURN_DOMAIN"))?t:[z("TURN_DOMAIN")].concat(t)}return An[e]}Ek||(An.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],An.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],An.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],An.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],An.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],An.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],An.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",An.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",An.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",An.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",An.AREAS=["NORTH_AMERICA","OVERSEA"]);let l5=(function(e){return e[e.REALTIME=1]="REALTIME",e})({}),fo={};var Tt=(function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_RTE_URL="SET_RTE_URL",e.SET_RTE_SID="SET_RTE_SID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e})(Tt||{});let Mm=(function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e})({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});let u5=128,Bue=96,d5=1e3,NE=10,Wue=0;var h5=(()=>{var e={8:(s,o,u)=>{u.r(o),u.d(o,{Parser:()=>Oe,Printer:()=>jt,parse:()=>Ve,print:()=>Ze});let d=`
`,f="".concat("\r").concat(d),g=" ",y;function v(Ae){return Ae>="0"&&Ae<="9"}function R(Ae){return Ae>="!"&&Ae<="~"}function b(Ae){return R(Ae)||Ae>=""&&Ae<=""}function A(Ae){return Ae==="!"||Ae>="#"&&Ae<="'"||Ae>="*"&&Ae<="+"||Ae>="-"&&Ae<="."||Ae>="0"&&Ae<="9"||Ae>="A"&&Ae<="Z"||Ae>="^"&&Ae<="~"}function F(Ae){return Ae>="1"&&Ae<="9"}function M(Ae){return Ae>="A"&&Ae<="Z"||Ae>="a"&&Ae<="z"}function j(Ae){return Ae==="d"||Ae==="h"||Ae==="m"||Ae==="s"}function K(Ae){return Ae>""&&Ae<"	"||Ae>"\v"&&Ae<"\f"||Ae>""&&Ae<""}function q(Ae){return M(Ae)||v(Ae)||Ae==="+"||Ae==="/"}function Q(Ae){return v(Ae)||M(Ae)||Ae==="+"||Ae==="/"||Ae==="-"||Ae==="_"}function se(Ae){return M(Ae)||v(Ae)||Ae==="+"||Ae==="/"}function oe(Ae,L){var J=Object.keys(Ae);if(Object.getOwnPropertySymbols){var ie=Object.getOwnPropertySymbols(Ae);L&&(ie=ie.filter(function(Me){return Object.getOwnPropertyDescriptor(Ae,Me).enumerable})),J.push.apply(J,ie)}return J}function ne(Ae){for(var L=1;L<arguments.length;L++){var J=arguments[L]!=null?arguments[L]:{};L%2?oe(Object(J),!0).forEach(function(ie){de(Ae,ie,J[ie])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Ae,Object.getOwnPropertyDescriptors(J)):oe(Object(J)).forEach(function(ie){Object.defineProperty(Ae,ie,Object.getOwnPropertyDescriptor(J,ie))})}return Ae}function de(Ae,L,J){return L in Ae?Object.defineProperty(Ae,L,{value:J,enumerable:!0,configurable:!0,writable:!0}):Ae[L]=J,Ae}(function(Ae){Ae.VERSION="v",Ae.ORIGIN="o",Ae.SESSION_NAME="s",Ae.INFORMATION="i",Ae.URI="u",Ae.EMAIL="e",Ae.PHONE="p",Ae.CONNECTION="c",Ae.BANDWIDTH="b",Ae.TIME="t",Ae.REPEAT="r",Ae.ZONE_ADJUSTMENTS="z",Ae.KEY="k",Ae.ATTRIBUTE="a",Ae.MEDIA="m"})(y||(y={}));class we{consumeText(L,J){let ie=J;for(;ie<L.length;){let Me=L[ie];if(Me==="\0"||Me==="\r"||Me===d)break;ie+=1}if(ie-J==0)throw new Error("Invalid text, at ".concat(L));return ie}consumeUnicastAddress(L,J,ie){return this.consumeTill(L,J,g)}consumeOneOrMore(L,J,ie){let Me=J;for(;ie(L[Me]);)Me++;if(Me-J==0)throw new Error("Invalid rule at ".concat(J,"."));return Me}consumeSpace(L,J){if(L[J]===g)return J+1;throw new Error("Invalid space at ".concat(J,"."))}consumeIP4Address(L,J){let ie=J;for(let Me=0;Me<4;Me++)if(ie=this.consumeDecimalUChar(L,ie),Me!==3){if(L[ie]!==".")throw new Error("Invalid IP4 address.");ie++}return ie}consumeDecimalUChar(L,J){let ie=J;for(let Rt=0;Rt<3&&v(L[ie]);Rt++,ie++);if(ie-J==0)throw new Error("Invalid decimal uchar.");let Me=parseInt(L.slice(J,ie));if(Me>=0&&Me<=255)return ie;throw new Error("Invalid decimal uchar")}consumeIP6Address(L,J){let ie=this.consumeHexpart(L,J);return L[ie]===":"&&(ie+=1,ie=this.consumeIP4Address(L,ie)),ie}consumeHexpart(L,J){let ie=J;if(L[ie]===":"&&L[ie+1]===":"){ie+=2;try{ie=this.consumeHexseq(L,ie)}catch{}return ie}if(ie=this.consumeHexseq(L,ie),L[ie]===":"&&L[ie+1]===":"){ie+=2;try{ie=this.consumeHexseq(L,ie)}catch{}return ie}return ie}consumeHexseq(L,J){let ie=J;for(;ie=this.consumeHex4(L,ie),L[ie]===":"&&L[ie+1]!==":";)ie+=1;return ie}consumeHex4(L,J){let ie=0;for(;ie<4;ie++)if(!((Me=L[J+ie])>="0"&&Me<="9"||Me>="a"&&Me<="f"||Me>="A"&&Me<="F")){if(ie===0)throw new Error("Invalid hex 4");break}var Me;return J+ie}consumeFQDN(L,J){let ie=J;for(;v(L[ie])||M(L[ie])||L[ie]==="-"||L[ie]===".";)ie+=1;if(ie-J<4)throw new Error("Invalid FQDN");return ie}consumeExtnAddr(L,J){return this.consumeOneOrMore(L,J,b)}consumeMulticastAddress(L,J,ie){switch(ie){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(L,J);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(L,J);default:try{return this.consumeFQDN(L,J)}catch{return this.consumeExtnAddr(L,J)}}}consumeIP6MulticastAddress(L,J){let ie=this.consumeHexpart(L,J);return L[ie]==="/"?this.consumeInteger(L,ie+1):ie}consumeIP4MulticastAddress(L,J){let ie=J+3,Me=L.slice(J,ie),Rt=parseInt(Me);if(Rt<224||Rt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Jn=0;Jn<3;Jn++){if(L[ie]!==".")throw new Error("Invalid IP4 multicast address.");ie+=1,ie=this.consumeDecimalUChar(L,ie)}return L[ie]==="/"&&(ie+=1),ie=this.consumeTTL(L,ie),L[ie]==="/"&&(ie=this.consumeInteger(L,ie)),ie}consumeInteger(L,J){if(!F(L[J]))throw new Error("Invalid integer.");for(J+=1;v(L[J]);)J+=1;return J}consumeTTL(L,J){if(L[J]==="0")return J+1;if(!F(L[J]))throw new Error("Invalid TTL.");J+=1;for(let ie=0;ie<2&&v(L[J]);ie++)J+=1;return J}consumeToken(L,J){return this.consumeOneOrMore(L,J,A)}consumeTime(L,J){let ie=J;if(L[ie]==="0")return ie+1;for(F(L[ie])&&(ie+=1);v(L[ie]);)ie++;if(ie-J<10)throw new Error("Invalid time");return ie}consumeAddress(L,J){return this.consumeTill(L,J,g)}consumeTypedTime(L,J){let ie=J;return ie=this.consumeOneOrMore(L,ie,v),j(L[ie])?ie+1:ie}consumeRepeatInterval(L,J){if(!F(L[J]))throw new Error("Invalid repeat interval");for(J+=1;v(L[J]);)J+=1;return j(L[J])&&(J+=1),J}consumePort(L,J){return this.consumeOneOrMore(L,J,v)}consume(L,J,ie){for(let Me=0;Me<ie.length;Me++){if(J+Me>=L.length)throw new Error("consume exceeding value length");if(L[J+Me]!==ie[Me])throw new Error("consume ".concat(ie," failed at ").concat(Me))}return J+ie.length}consumeTill(L,J,ie){let Me=J;for(;Me<L.length&&(typeof ie!="string"||L[Me]!==ie)&&(typeof ie!="function"||!ie(L[Me]));)Me++;return Me}}class Oe extends we{constructor(){super(),de(this,"records",[]),de(this,"currentLine",0)}parse(L){let J=this.probeEOL(L);this.records=L.split(J).filter(Mp=>!!Bs(Mp).call(Mp)).map(this.parseLine),this.currentLine=0;let ie=this.parseVersion(),Me=this.parseOrigin(),Rt=this.parseSessionName(),Jn=this.parseInformation(),Ai=this.parseUri(),ic=this.parseEmail(),Lp=this.parsePhone(),jI=this.parseConnection(),cy=this.parseBandWidth(),BI=this.parseTimeFields(),ag=this.parseKey(),m0=this.parseSessionAttribute(),og=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:ie,origin:Me,sessionName:Rt,information:Jn,uri:Ai,emails:ic,phones:Lp,connection:jI,bandwidths:cy,timeFields:BI,key:ag,attributes:m0,mediaDescriptions:og}}getCurrentRecord(){let L=this.records[this.currentLine];if(!L)throw new Error("Record doesn't exit.");return L}probeEOL(L){for(let J=0;J<L.length;J++)if(L[J]===d)return L[J-1]==="\r"?f:d;throw new Error("Invalid newline character.")}parseLine(L,J){if(L.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");let ie=L[0];if(L[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:ie,value:L.slice(2),line:J,cur:0}}parseSessionAttribute(){let L=new at;for(;this.currentLine<this.records.length;){let J=this.getCurrentRecord();if(J.type!==y.ATTRIBUTE)break;let ie={attField:this.extractOneOrMore(J,Me=>A(Me)&&Me!==":"),_cur:0};J.value[J.cur]===":"&&(J.cur+=1,ie.attValue=this.extractOneOrMore(J,K)),L.parse(ie),this.currentLine++}return L.digest()}parseMediaAttributes(L){let J=new Xt(L);for(;this.currentLine<this.records.length;){let ie=this.getCurrentRecord();if(ie.type!==y.ATTRIBUTE)break;let Me={attField:this.extractOneOrMore(ie,Rt=>A(Rt)&&Rt!==":"),_cur:0};ie.value[ie.cur]===":"&&(ie.cur+=1,Me.attValue=this.extractOneOrMore(ie,K)),J.parse(Me),this.currentLine++}return J.digest()}parseKey(){let L=this.getCurrentRecord();if(L.type===y.KEY){if(L.value==="prompt"||L.value==="clear:"||L.value==="base64:"||L.value==="uri:")return L.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){let L=this.getCurrentRecord();if(L.type===y.ZONE_ADJUSTMENTS){let J=[];for(;;)try{let ie=this.extract(L,this.consumeTime);this.consumeSpaceForRecord(L);let Me=!1;L.value[L.cur]==="-"&&(Me=!0,L.cur+=1);let Rt=this.extract(L,this.consumeTypedTime);J.push({time:ie,typedTime:Rt,back:Me})}catch{break}if(J.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,J}return[]}parseRepeat(){let L=[];for(;;){let J=this.getCurrentRecord();if(J.type!==y.REPEAT)break;{let ie=this.extract(J,this.consumeRepeatInterval),Me=this.parseTypedTime(J);L.push({repeatInterval:ie,typedTimes:Me}),this.currentLine++}}return L}parseTypedTime(L){let J=[];for(;;)try{this.consumeSpaceForRecord(L),J.push(this.extract(L,this.consumeTypedTime))}catch{break}if(J.length===0)throw new Error("Invalid typed time.");return J}parseTime(){let L=this.getCurrentRecord(),J=this.extract(L,this.consumeTime);this.consumeSpaceForRecord(L);let ie=this.extract(L,this.consumeTime);return this.currentLine++,{startTime:J,stopTime:ie}}parseBandWidth(){let L=[];for(;this.currentLine<this.records.length;){let J=this.getCurrentRecord();if(J.type!==y.BANDWIDTH)break;{let ie=this.extractOneOrMore(J,A);if(J.value[J.cur]!==":")throw new Error("Invalid bandwidth field.");J.cur++;let Me=this.extractOneOrMore(J,v);L.push({bwtype:ie,bandwidth:Me}),this.currentLine++}}return L}parseVersion(){let L=this.getCurrentRecord();if(L.type!==y.VERSION)throw new Error("first sdp record must be version");let J=L.value.slice(0,this.consumeOneOrMore(L.value,0,v));if(J.length!==L.value.length)throw new Error('invalid proto version, "v='.concat(L.value,'"'));return this.currentLine++,J}parseOrigin(){let L=this.getCurrentRecord();if(L.type!==y.ORIGIN)throw new Error("second line of sdp must be origin");let J=this.extractOneOrMore(L,b);this.consumeSpaceForRecord(L);let ie=this.extractOneOrMore(L,v);this.consumeSpaceForRecord(L);let Me=this.extractOneOrMore(L,v);this.consumeSpaceForRecord(L);let Rt=this.extractOneOrMore(L,A);this.consumeSpaceForRecord(L);let Jn=this.extractOneOrMore(L,A);this.consumeSpaceForRecord(L);let Ai=this.extract(L,this.consumeUnicastAddress);return this.currentLine++,{username:J,sessId:ie,sessVersion:Me,nettype:Rt,addrtype:Jn,unicastAddress:Ai}}parseSessionName(){let L=this.getCurrentRecord();if(L.type===y.SESSION_NAME){let J=this.extract(L,this.consumeText);return this.currentLine++,J}}parseInformation(){let L=this.getCurrentRecord();if(L.type!==y.INFORMATION)return;let J=this.extract(L,this.consumeText);return this.currentLine++,J}parseUri(){let L=this.getCurrentRecord();if(L.type===y.URI)return this.currentLine++,L.value}parseEmail(){let L=[];for(;;){let J=this.getCurrentRecord();if(J.type!==y.EMAIL)break;L.push(J.value),this.currentLine++}return L}parsePhone(){let L=[];for(;;){let J=this.getCurrentRecord();if(J.type!==y.PHONE)break;L.push(J.value),this.currentLine++}return L}parseConnection(){let L=this.getCurrentRecord();if(L.type===y.CONNECTION){let J=this.extractOneOrMore(L,A);this.consumeSpaceForRecord(L);let ie=this.extractOneOrMore(L,A);this.consumeSpaceForRecord(L);let Me=this.extract(L,this.consumeAddress);return this.currentLine++,{nettype:J,addrtype:ie,address:Me}}}parseMedia(){let L=this.getCurrentRecord(),J=this.extract(L,this.consumeToken);this.consumeSpaceForRecord(L);let ie=this.extract(L,this.consumePort);L.value[L.cur]==="/"&&(L.cur+=1,ie+=this.extract(L,this.consumeInteger)),this.consumeSpaceForRecord(L);let Me=[];for(Me.push(this.extract(L,this.consumeToken));L.value[L.cur]==="/";)L.cur+=1,Me.push(this.extract(L,this.consumeToken));if(Me.length===0)throw new Error("Invalid proto");let Rt=this.parseFmt(L);return this.currentLine++,{mediaType:J,port:ie,protos:Me,fmts:Rt}}parseTimeFields(){let L=[];for(;this.getCurrentRecord().type===y.TIME;){let J=this.parseTime(),ie=this.parseRepeat(),Me=this.parseZone();L.push({time:J,repeats:ie,zones:Me})}return L}parseMediaDescription(){let L=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.MEDIA;){let J=this.parseMedia(),ie=this.parseInformation(),Me=this.parseConnections(),Rt=this.parseBandWidth(),Jn=this.parseKey(),Ai=this.parseMediaAttributes(J);L.push({media:J,information:ie,connections:Me,bandwidths:Rt,key:Jn,attributes:Ai})}return L}parseConnections(){let L=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.CONNECTION;)L.push(this.parseConnection());return L}parseFmt(L){let J=[];for(;;)try{this.consumeSpaceForRecord(L),J.push(this.extract(L,this.consumeToken))}catch{break}if(J.length===0)throw new Error("Invalid fmts");return J}extract(L,J){for(var ie=arguments.length,Me=new Array(ie>2?ie-2:0),Rt=2;Rt<ie;Rt++)Me[Rt-2]=arguments[Rt];let Jn=J.call(this,L.value,L.cur,...Me),Ai=L.value.slice(L.cur,Jn);return L.cur=Jn,Ai}extractOneOrMore(L,J){let ie=this.consumeOneOrMore(L.value,L.cur,J),Me=L.value.slice(L.cur,ie);return L.cur=ie,Me}consumeSpaceForRecord(L){if(L.value[L.cur]!==g)throw new Error("Invalid space at ".concat(L.cur,"."));L.cur+=1}}class Qe extends we{constructor(){super(...arguments),de(this,"attributes",void 0),de(this,"digested",!1)}extractOneOrMore(L,J,ie){let Me=this.consumeOneOrMore(L.attValue,L._cur,J),Rt=L.attValue.slice(L._cur,Me),[Jn,Ai]=ie||[];if(typeof Jn=="number"&&Rt.length<Jn)throw new Error("error in length, should be more or equal than ".concat(Jn," characters."));if(typeof Ai=="number"&&Rt.length>Ai)throw new Error("error in length, should be less or equal than ".concat(Ai," characters."));return L._cur=Me,Rt}consumeAttributeSpace(L){if(L.attValue[L._cur]!==g)throw new Error("Invalid space at ".concat(L._cur,"."));L._cur+=1}extract(L,J){if(!L.attValue)throw new Error("Nothing to extract from attValue.");for(var ie=arguments.length,Me=new Array(ie>2?ie-2:0),Rt=2;Rt<ie;Rt++)Me[Rt-2]=arguments[Rt];let Jn=J.call(this,L.attValue,L._cur,...Me),Ai=L.attValue.slice(L._cur,Jn);return L._cur=Jn,Ai}atEnd(L){if(!L.attValue)throw new Error;return L._cur>=L.attValue.length}peekChar(L){if(!L.attValue)throw new Error;return L.attValue[L._cur]}peek(L,J){if(!L.attValue)throw new Error;for(let ie=0;ie<J.length;ie++)if(J[ie]!==L.attValue[L._cur+ie])return!1;return!0}parseIceUfrag(L){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(L,q,[4,256])}parseIcePwd(L){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(L,q,[22,256])}parseIceOptions(L){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");let J=[];for(;!this.atEnd(L);){J.push(this.extractOneOrMore(L,q));try{this.consumeAttributeSpace(L)}catch(ie){if(this.atEnd(L))break;throw ie}}this.attributes.iceOptions=J}parseFingerprint(L){let J=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L);let ie=this.extract(L,this.consumeTill);this.attributes.fingerprints.push({hashFunction:J,fingerprint:ie})}parseExtmap(L){let J=this.extractOneOrMore(L,v),ie;this.peekChar(L)==="/"&&(this.extract(L,this.consume,"/"),ie=this.extract(L,this.consumeToken)),this.consumeAttributeSpace(L);let Me=this.extract(L,this.consumeTill,g),Rt=ne(ne({entry:parseInt(J,10)},ie&&{direction:ie}),{},{extensionName:Me});this.peekChar(L)===g&&(this.consumeAttributeSpace(L),Rt.extensionAttributes=this.extract(L,this.consumeTill)),this.attributes.extmaps.push(Rt)}parseSetup(L){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");let J=this.extract(L,this.consumeTill);if(J!=="active"&&J!=="passive"&&J!=="actpass"&&J!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=J}}class at extends Qe{constructor(){super(...arguments),de(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(L){if(this.digested)throw new Error("already digested");try{switch(L.attField){case"group":this.parseGroup(L);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(L);break;case"ice-pwd":this.parseIcePwd(L);break;case"ice-options":this.parseIceOptions(L);break;case"fingerprint":this.parseFingerprint(L);break;case"setup":this.parseSetup(L);break;case"tls-id":this.parseTlsId(L);break;case"identity":this.parseIdentity(L);break;case"extmap":this.parseExtmap(L);break;case"msid-semantic":this.parseMsidSemantic(L);break;default:L.ignored=!0,this.attributes.unrecognized.push(L)}}catch(J){throw console.error("parsing session attribute ".concat(L.attField,' error, "a=').concat(L.attField,":").concat(L.attValue,'"')),J}if(!L.ignored&&L.attValue&&!this.atEnd(L))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(L){let J=this.extract(L,this.consumeToken),ie=[];for(;!this.atEnd(L)&&this.peekChar(L)===g;)this.consumeAttributeSpace(L),ie.push(this.extract(L,this.consumeToken));this.attributes.groups.push({semantic:J,identificationTag:ie})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(L){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(L,Q)}parseIdentity(L){let J=this.extractOneOrMore(L,se),ie=[];for(;!this.atEnd(L)&&this.peekChar(L)===g;){this.consumeAttributeSpace(L);let Me=this.extract(L,this.consumeToken);this.extract(L,this.consume,"=");let Rt=this.extractOneOrMore(L,Jn=>Jn!==g&&K(Jn));ie.push({name:Me,value:Rt})}this.attributes.identities.push({assertionValue:J,extensions:ie})}parseMsidSemantic(L){this.peekChar(L)===g&&this.consumeAttributeSpace(L);let J={semantic:this.extract(L,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(L)}catch{break}if(this.peekChar(L)==="*"){this.extract(L,this.consume,"*"),J.applyForAll=!0;break}{let ie=this.extract(L,this.consumeTill,g);J.identifierList.push(ie)}}this.attributes.msidSemantic=J}}class Xt extends Qe{constructor(L){super(),de(this,"attributes",void 0),L.protos.indexOf("RTP")!==-1||L.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(L){if(this.digested)throw new Error("already digested");try{switch(L.attField){case"extmap":this.parseExtmap(L);break;case"setup":this.parseSetup(L);break;case"ice-ufrag":this.parseIceUfrag(L);break;case"ice-pwd":this.parseIcePwd(L);break;case"ice-options":this.parseIceOptions(L);break;case"candidate":this.parseCandidate(L);break;case"remote-candidate":this.parseRemoteCandidate(L);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(L);break;case"rtpmap":this.parseRtpmap(L);break;case"ptime":this.parsePtime(L);break;case"maxptime":this.parseMaxPtime(L);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(L);break;case"ssrc":this.parseSSRC(L);break;case"fmtp":this.parseFmtp(L);break;case"rtcp-fb":this.parseRtcpFb(L);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(L);break;case"mid":this.parseMid(L);break;case"msid":this.parseMsid(L);break;case"imageattr":this.parseImageAttr(L);break;case"rid":this.parseRid(L);break;case"simulcast":this.parseSimulcast(L);break;case"sctp-port":this.parseSctpPort(L);break;case"max-message-size":this.parseMaxMessageSize(L);break;case"ssrc-group":this.parseSSRCGroup(L);break;default:L.ignored=!0,this.attributes.unrecognized.push(L)}}catch(J){throw console.error("parsing media attribute ".concat(L.attField,' error, "a=').concat(L.attField,":").concat(L.attValue,'"')),J}if(!L.ignored&&L.attValue&&!this.atEnd(L))throw new Error("attribute parsing error")}parseCandidate(L){let J=this.extractOneOrMore(L,q,[1,32]);this.consumeAttributeSpace(L);let ie=this.extractOneOrMore(L,v,[1,5]);this.consumeAttributeSpace(L);let Me=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L);let Rt=this.extractOneOrMore(L,v,[1,10]);this.consumeAttributeSpace(L);let Jn=this.extract(L,this.consumeAddress);this.consumeAttributeSpace(L);let Ai=this.extract(L,this.consumePort);this.consumeAttributeSpace(L),this.extract(L,this.consume,"typ"),this.consumeAttributeSpace(L);let ic={foundation:J,componentId:ie,transport:Me,priority:Rt,connectionAddress:Jn,port:Ai,type:this.extract(L,this.consumeToken),extension:{}};for(this.peek(L," raddr")&&(this.extract(L,this.consume," raddr"),this.consumeAttributeSpace(L),ic.relAddr=this.extract(L,this.consumeAddress)),this.peek(L," rport")&&(this.extract(L,this.consume," rport"),this.consumeAttributeSpace(L),ic.relPort=this.extract(L,this.consumePort));this.peekChar(L)===g;){this.consumeAttributeSpace(L);let Lp=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L),ic.extension[Lp]=this.extractOneOrMore(L,R)}this.attributes.candidates.push(ic)}parseRemoteCandidate(L){let J=[];for(;;){let ie=this.extractOneOrMore(L,v,[1,5]);this.consumeAttributeSpace(L);let Me=this.extract(L,this.consumeAddress);this.consumeAttributeSpace(L);let Rt=this.extract(L,this.consumePort);J.push({componentId:ie,connectionAddress:Me,port:Rt});try{this.consumeAttributeSpace(L)}catch{break}}this.attributes.remoteCandidatesList.push(J)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(L){let J=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L);let ie=this.extract(L,this.consumeTill,"/");this.extract(L,this.consume,"/");let Me={encodingName:ie,clockRate:this.extractOneOrMore(L,v)};this.atEnd(L)||this.peekChar(L)!=="/"||(this.extract(L,this.consume,"/"),Me.encodingParameters=parseInt(this.extract(L,this.consumeTill),10));let Rt=this.attributes.payloads.find(Jn=>Jn.payloadType===parseInt(J,10));Rt?Rt.rtpMap=Me:this.attributes.payloads.push({payloadType:parseInt(J,10),rtpMap:Me,rtcpFeedbacks:[]})}parsePtime(L){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(L,this.consumeTill)}parseMaxPtime(L){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(L,this.consumeTill)}parseDirection(L){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=L.attField}parseSSRC(L){let J=this.extractOneOrMore(L,v);this.consumeAttributeSpace(L);let ie=this.extract(L,this.consumeTill,":"),Me;this.peekChar(L)===":"&&(this.extract(L,this.consume,":"),Me=this.extract(L,this.consumeTill));let Rt=this.attributes.ssrcs.find(Jn=>Jn.ssrcId===parseInt(J,10));Rt?Rt.attributes[ie]=Me:this.attributes.ssrcs.push({ssrcId:parseInt(J,10),attributes:{[ie]:Me}})}parseFmtp(L){let J=this.extract(L,this.consumeTill,g);this.consumeAttributeSpace(L);let ie=this.extract(L,this.consumeTill),Me={};ie.split(";").forEach(Jn=>{let[Ai,ic]=Jn.split("=");Ai=Bs(Ai).call(Ai);let Lp=typeof ic=="string"?Bs(ic).call(ic):null;typeof Ai=="string"&&Ai.length>0&&(Me[Ai]=Lp)});let Rt=this.attributes.payloads.find(Jn=>Jn.payloadType===parseInt(J,10));Rt?Rt.fmtp={parameters:Me}:this.attributes.payloads.push({payloadType:parseInt(J,10),rtcpFeedbacks:[],fmtp:{parameters:Me}})}parseFmtParameters(L){let J={},ie=this.extract(L,this.consumeTill,"=");L._cur++;let Me=this.extract(L,this.consumeTill,";");for(J[ie]=Me;L.attValue[L._cur]===";";){let Rt=this.extract(L,this.consumeTill,"=");L._cur++;let Jn=this.extract(L,this.consumeTill,";");J[Rt]=Jn}return J}parseRtcpFb(L){let J="";J=this.peekChar(L)==="*"?this.extract(L,this.consume,"*"):this.extract(L,this.consumeTill,g),this.consumeAttributeSpace(L);let ie=this.extract(L,this.consumeTill,g),Me;if(ie==="trr-int")Me={type:ie,interval:this.extract(L,this.consumeTill)};else{let Rt={type:ie};this.peekChar(L)===g&&(this.consumeAttributeSpace(L),Rt.parameter=this.extract(L,this.consumeToken),this.peekChar(L)===g&&(Rt.additional=this.extract(L,this.consumeTill))),Me=Rt}if(J==="*")this.attributes.rtcpFeedbackWildcards.push(Me);else{let Rt=this.attributes.payloads.find(Jn=>Jn.payloadType===parseInt(J,10));Rt?Rt.rtcpFeedbacks.push(Me):this.attributes.payloads.push({payloadType:parseInt(J,10),rtcpFeedbacks:[Me]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(L){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");let J={port:this.extract(L,this.consumePort)};this.peekChar(L)===g&&(this.consumeAttributeSpace(L),J.netType=this.extractOneOrMore(L,A),this.consumeAttributeSpace(L),J.addressType=this.extractOneOrMore(L,A),this.consumeAttributeSpace(L),J.address=this.extract(L,this.consumeAddress)),this.attributes.rtcp=J}parseMsid(L){let J={id:this.extractOneOrMore(L,A,[1,64])};this.peekChar(L)===g&&(this.consumeAttributeSpace(L),J.appdata=this.extractOneOrMore(L,A,[1,64])),this.attributes.msids.push(J)}parseImageAttr(L){this.attributes.imageattr.push(L.attValue)}parseRid(L){let J=this.extractOneOrMore(L,Me=>M(Me)||v(Me)||Me==="_"||Me==="-");this.consumeAttributeSpace(L);let ie={id:J,direction:this.extract(L,this.consumeToken),params:[]};if(this.peekChar(L)===g){if(this.consumeAttributeSpace(L),this.peek(L,"pt=")){this.extract(L,this.consume,"pt=");let Me=[];for(;;){let Rt=this.extract(L,this.consumeToken);Me.push(Rt);try{this.extract(L,this.consume,",")}catch{break}}ie.payloads=Me,this.peekChar(L)===g&&this.extract(L,this.consume,g)}for(;;){let Me=this.extract(L,this.consumeToken);if(Me==="depend"){let Rt={type:Me,rids:this.extract(L,this.consume,"=").split(",")};ie.params.push(Rt)}else{let Rt={type:Me};this.peekChar(L)==="="&&(this.extract(L,this.consume,"="),Rt.val=this.extract(L,this.consumeTill,";")),ie.params.push(Rt)}try{this.extract(L,this.consume,";")}catch{break}}}this.attributes.rids.push(ie)}parseSimulcast(L){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=L.attValue,this.extract(L,this.consumeTill)}parseSctpPort(L){this.attributes.sctpPort=this.extractOneOrMore(L,v,[1,5])}parseMaxMessageSize(L){this.attributes.maxMessageSize=this.extractOneOrMore(L,v,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(L){this.attributes.mid=this.extract(L,this.consumeToken)}parseSSRCGroup(L){let J=this.extract(L,this.consumeToken),ie=[];for(;;)try{this.consumeAttributeSpace(L);let Me=this.extract(L,this.consumeInteger);ie.push(parseInt(Me,10))}catch{break}this.attributes.ssrcGroups.push({semantic:J,ssrcIds:ie})}}function Lt(Ae,L,J){return L in Ae?Object.defineProperty(Ae,L,{value:J,enumerable:!0,configurable:!0,writable:!0}):Ae[L]=J,Ae}class jt{constructor(){Lt(this,"eol",f)}print(L,J){let ie="";return J&&(this.eol=J),ie+=this.printVersion(L.version),ie+=this.printOrigin(L.origin),ie+=this.printSessionName(L.sessionName),ie+=this.printInformation(L.information),ie+=this.printUri(L.uri),ie+=this.printEmail(L.emails),ie+=this.printPhone(L.phones),ie+=this.printConnection(L.connection),ie+=this.printBandwidth(L.bandwidths),ie+=this.printTimeFields(L.timeFields),ie+=this.printKey(L.key),ie+=this.printSessionAttributes(L.attributes),ie+=this.printMediaDescription(L.mediaDescriptions),ie}printVersion(L){return"v=".concat(L).concat(this.eol)}printOrigin(L){return"o=".concat(L.username," ").concat(L.sessId," ").concat(L.sessVersion," ").concat(L.nettype," ").concat(L.addrtype," ").concat(L.unicastAddress).concat(this.eol)}printSessionName(L){return L?"s=".concat(L).concat(this.eol):""}printInformation(L){return L?"i=".concat(L).concat(this.eol):""}printUri(L){return L?"u=".concat(L).concat(this.eol):""}printEmail(L){let J="";for(let ie of L)J+="e=".concat(ie).concat(this.eol);return J}printPhone(L){let J="";for(let ie of L)J+="e=".concat(ie).concat(this.eol);return J}printConnection(L){return L?"c=".concat(L.nettype," ").concat(L.addrtype," ").concat(L.address).concat(this.eol):""}printBandwidth(L){let J="";for(let ie of L)J+="b=".concat(ie.bwtype,":").concat(ie.bandwidth).concat(this.eol);return J}printTimeFields(L){let J="";for(let ie of L){J+="t=".concat(ie.time.startTime," ").concat(ie.time.startTime).concat(this.eol);for(let Me of ie.repeats)J+="r=".concat(Me.repeatInterval," ").concat(Me.typedTimes.join(" ")).concat(this.eol);ie.zoneAdjustments&&(J+="z=",J+="z=".concat(ie.zoneAdjustments.map(Me=>"".concat(Me.time," ").concat(Me.back?"-":""," ").concat(Me.typedTime)).join(" ")).concat(this.eol),J+=this.eol)}return J}printKey(L){return L?"k=".concat(L).concat(this.eol):""}printAttributes(L){let J="";for(let ie of L)J+="a=".concat(ie.attField).concat(ie.attValue?":".concat(ie.attValue):"").concat(this.eol);return J}printMediaDescription(L){let J="";for(let ie of L)J+=this.printMedia(ie.media),J+=this.printInformation(ie.information),J+=this.printConnections(ie.connections),J+=this.printBandwidth(ie.bandwidths),J+=this.printKey(ie.key),J+=this.printMediaAttributes(ie);return J}printConnections(L){let J="";for(let ie of L)J+=this.printConnection(ie);return J}printMedia(L){return"m=".concat(L.mediaType," ").concat(L.port," ").concat(L.protos.join("/")," ").concat(L.fmts.join(" ")).concat(this.eol)}printSessionAttributes(L){return new lr(this.eol).print(L)}printMediaAttributes(L){return new Ce(this.eol).print(L)}}class En{constructor(L){Lt(this,"eol",void 0),this.eol=L}printIceUfrag(L){return L===void 0?"":"a=ice-ufrag:".concat(L).concat(this.eol)}printIcePwd(L){return L===void 0?"":"a=ice-pwd:".concat(L).concat(this.eol)}printIceOptions(L){return L===void 0?"":"a=ice-options:".concat(L.join(g)).concat(this.eol)}printFingerprints(L){return L.length>0?L.map(J=>"a=fingerprint:".concat(J.hashFunction).concat(g).concat(J.fingerprint)).join(this.eol)+this.eol:""}printExtmap(L){return L.map(J=>"a=extmap:".concat(J.entry).concat(J.direction?"/".concat(J.direction):"").concat(g).concat(J.extensionName).concat(J.extensionAttributes?"".concat(g).concat(J.extensionAttributes):"").concat(this.eol)).join("")}printSetup(L){return L===void 0?"":"a=setup:".concat(L).concat(this.eol)}printUnrecognized(L){return L.map(J=>"a=".concat(J.attField).concat(J.attValue?":".concat(J.attValue):"").concat(this.eol)).join("")}}class lr extends En{print(L){let J="";return J+=this.printGroups(L.groups),J+=this.printMsidSemantic(L.msidSemantic),J+=this.printIceLite(L.iceLite),J+=this.printIceUfrag(L.iceUfrag),J+=this.printIcePwd(L.icePwd),J+=this.printIceOptions(L.iceOptions),J+=this.printFingerprints(L.fingerprints),J+=this.printSetup(L.setup),J+=this.printTlsId(L.tlsId),J+=this.printIdentity(L.identities),J+=this.printExtmap(L.extmaps),J+=this.printUnrecognized(L.unrecognized),J}printGroups(L){let J="";return L.length>0&&(J+=L.map(ie=>"a=group:".concat(ie.semantic).concat(ie.identificationTag.map(Me=>"".concat(g).concat(Me)).join("")).concat(this.eol)).join("")),J}printIceLite(L){return L===void 0?"":"a=ice-lite"+this.eol}printTlsId(L){return L?"a=tls-id:".concat(L).concat(this.eol):""}printIdentity(L){return L.length===0?"":L.map(J=>"a=identity:".concat(J.assertionValue).concat(J.extensions.map(ie=>"".concat(g).concat(ie.name).concat(ie.value?"=".concat(ie.value):"")))).join(this.eol)+this.eol}printMsidSemantic(L){if(!L)return"";let J="a=msid-semantic:".concat(L.semantic);return L.applyForAll?J+="".concat(g,"*"):L.identifierList.length>0&&(J+=L.identifierList.map(ie=>"".concat(g).concat(ie))),J+this.eol}}class Ce extends En{print(L){let J=L.attributes,ie="";return ie+=this.printRTCP(J.rtcp),ie+=this.printIceUfrag(J.iceUfrag),ie+=this.printIcePwd(J.icePwd),ie+=this.printIceOptions(J.iceOptions),ie+=this.printCandidates(J.candidates),ie+=this.printRemoteCandidatesList(J.remoteCandidatesList),ie+=this.printEndOfCandidates(J.endOfCandidates),ie+=this.printFingerprints(J.fingerprints),ie+=this.printSetup(J.setup),ie+=this.printMid(J.mid),ie+=this.printExtmap(J.extmaps),ie+=this.printRTPRelated(J),ie+=this.printPtime(J.ptime),ie+=this.printMaxPtime(J.maxPtime),ie+=this.printDirection(J.direction),ie+=this.printSSRCGroups(J.ssrcGroups),ie+=this.printSSRC(J.ssrcs),ie+=this.printRTCPMux(J.rtcpMux),ie+=this.printRTCPMuxOnly(J.rtcpMuxOnly),ie+=this.printRTCPRsize(J.rtcpRsize),ie+=this.printMSId(J.msids),ie+=this.printImageattr(J.imageattr),ie+=this.printRid(J.rids),ie+=this.printSimulcast(J.simulcast),ie+=this.printSCTPPort(J.sctpPort),ie+=this.printMaxMessageSize(J.maxMessageSize),ie+=this.printUnrecognized(J.unrecognized),ie}printCandidates(L){return L.map(J=>"a=candidate:".concat(J.foundation).concat(g).concat(J.componentId).concat(g).concat(J.transport).concat(g).concat(J.priority).concat(g).concat(J.connectionAddress).concat(g).concat(J.port).concat(g,"typ").concat(g).concat(J.type).concat(J.relAddr?"".concat(g,"raddr").concat(g).concat(J.relAddr):"").concat(J.relPort?"".concat(g,"rport").concat(g).concat(J.relPort):"").concat(Object.keys(J.extension).map(ie=>"".concat(g).concat(ie).concat(g).concat(J.extension[ie])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(L){return L.map(J=>"a=remote-candidates:".concat(J.join(g)).concat(this.eol)).join("")}printEndOfCandidates(L){return L===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(L){if(!L.payloads)return"";let J=L.payloads,ie="";ie+=L.rtcpFeedbackWildcards.map(Me=>this.printRTCPFeedback("*",Me)).join("");for(let Me of J)ie+=this.printRtpMap(Me.payloadType,Me.rtpMap),ie+=this.printFmtp(Me.payloadType,Me.fmtp),ie+=Me.rtcpFeedbacks.map(Rt=>this.printRTCPFeedback(Me.payloadType,Rt)).join("");return ie}printFmtp(L,J){if(!J)return"";let ie=Object.keys(J.parameters);return ie.length===1&&J.parameters[ie[0]]===null?"a=fmtp:".concat(L).concat(g).concat(ie[0]).concat(this.eol):"a=fmtp:".concat(L).concat(g).concat(Object.keys(J.parameters).map(Me=>"".concat(Me,"=").concat(J.parameters[Me])).join(";")).concat(this.eol)}printRtpMap(L,J){return J?"a=rtpmap:".concat(L).concat(g).concat(J.encodingName,"/").concat(J.clockRate).concat(J.encodingParameters?"/".concat(J.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(L,J){let ie="a=rtcp-fb:".concat(L).concat(g),Me=J;return Me.type==="trr-int"?ie+="ttr-int".concat(g).concat(Me.interval):(ie+="".concat(Me.type),Me.parameter&&(ie+="".concat(g).concat(Me.parameter),Me.additional&&(ie+="".concat(g).concat(Me.additional)))),ie+this.eol}printPtime(L){return L===void 0?"":"a=ptime:".concat(L).concat(this.eol)}printMaxPtime(L){return L===void 0?"":"a=maxptime:".concat(L).concat(this.eol)}printDirection(L){return L===void 0?"":"a=".concat(L).concat(this.eol)}printSSRC(L){return L.map(J=>Object.keys(J.attributes).map(ie=>"a=ssrc:".concat(J.ssrcId.toString(10)).concat(g).concat(ie).concat(J.attributes[ie]?":".concat(J.attributes[ie]):"").concat(this.eol)).join("")).join("")}printRTCPMux(L){return L===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(L){return L===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(L){return L===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(L){if(L===void 0)return"";let J="a=rtcp:".concat(L.port);return L.netType&&(J+="".concat(g).concat(L.netType)),L.addressType&&(J+="".concat(g).concat(L.addressType)),L.address&&(J+="".concat(g).concat(L.address)),J+this.eol}printMSId(L){return L.map(J=>"a=msid:".concat(J.id).concat(J.appdata?"".concat(g).concat(J.appdata):"").concat(this.eol)).join("")}printImageattr(L){return L.map(J=>"a=imageattr:".concat(J).concat(this.eol)).join("")}printRid(L){return L.map(J=>{let ie="a=rid:".concat(J.id).concat(g).concat(J.direction);return J.payloads&&(ie+="".concat(g,"pt=").concat(J.payloads.join(","))),J.params.length>0&&(ie+="".concat(g).concat(J.params.map(Me=>Me.type==="depend"?"depend=".concat(Me.rids.join(",")):"".concat(Me.type,"=").concat(Me.val)).join(";"))),ie+this.eol}).join("")}printSimulcast(L){return L===void 0?"":"a=simulcast:".concat(L).concat(this.eol)}printSCTPPort(L){return L===void 0?"":"a=sctp-port:".concat(L).concat(this.eol)}printMaxMessageSize(L){return L===void 0?"":"a=max-message-size:".concat(L).concat(this.eol)}printMid(L){return L===void 0?"":"a=mid:".concat(L).concat(this.eol)}printSSRCGroups(L){return L.map(J=>"a=ssrc-group:".concat(J.semantic).concat(J.ssrcIds.map(ie=>"".concat(g).concat(ie.toString(10))).join("")).concat(this.eol)).join("")}}function Ve(Ae){return new Oe().parse(Ae)}function Ze(Ae,L){return new jt().print(Ae,L)}}},t={};function n(s){if(t[s])return t[s].exports;var o=t[s]={exports:{}};return e[s](o,o.exports,n),o.exports}return n.d=(s,o)=>{for(var u in o)n.o(o,u)&&!n.o(s,u)&&Object.defineProperty(s,u,{enumerable:!0,get:o[u]})},n.o=(s,o)=>Object.prototype.hasOwnProperty.call(s,o),n.r=s=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},n(8)})();function Hs(e){return h5.parse(e)}function eh(e,t){return h5.print(e,t)}var Gue=Sa("Array","keys"),Hue=_l,zue=Ur,Kue=N,Yue=Gue,Tk=Array.prototype,que={DOMTokenList:!0,NodeList:!0},Xue=function(e){var t=e.keys;return e===Tk||Kue(Tk,e)&&t===Tk.keys||zue(que,Hue(e))?Yue:t},ys=l(Xue);function Rr(e,t,n){return(t=(function(s){var o=(function(u,d){if(typeof u!="object"||!u)return u;var f=u[Symbol.toPrimitive];if(f!==void 0){var g=f.call(u,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)})(s);return typeof o=="symbol"?o:o+""})(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function Pt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?p5(Object(n),!0).forEach(function(s){Rr(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p5(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function Rb(e,t){return Rb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},Rb(e,t)}function wk(){wk=function(o,u){return new n(o,void 0,u)};var e=RegExp.prototype,t=new WeakMap;function n(o,u,d){var f=RegExp(o,u);return t.set(f,d||t.get(o)),Rb(f,n.prototype)}function s(o,u){var d,f=t.get(u);return ta(d=Object.keys(f)).call(d,function(g,y){var v=f[y];if(typeof v=="number")g[y]=o[v];else{for(var R=0;o[v[R]]===void 0&&R+1<v.length;)R++;g[y]=o[v[R]]}return g},Object.create(null))}return(function(o,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function");o.prototype=Object.create(u&&u.prototype,{constructor:{value:o,writable:!0,configurable:!0}}),Object.defineProperty(o,"prototype",{writable:!1}),u&&Rb(o,u)})(n,RegExp),n.prototype.exec=function(o){var u=e.exec.call(this,o);if(u){u.groups=s(u,this);var d=u.indices;d&&(d.groups=s(d,this))}return u},n.prototype[Symbol.replace]=function(o,u){if(typeof u=="string"){var d=t.get(this);return e[Symbol.replace].call(this,o,u.replace(/\$<([^>]+)(>|$)/g,function(g,y,v){if(v==="")return g;var R=d[y];return Array.isArray(R)?"$"+R.join("$"):typeof R=="number"?"$"+R:""}))}if(typeof u=="function"){var f=this;return e[Symbol.replace].call(this,o,function(){var g=arguments;return typeof g[g.length-1]!="object"&&(g=[].slice.call(g)).push(s(g,f)),u.apply(this,g)})}return e[Symbol.replace].call(this,o,u)},wk.apply(this,arguments)}let f5=new class extends dr{constructor(){super(...arguments),Rr(this,"currentUploadLogID",0)}reportLogUploadError(e){let{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class Jue{constructor(t){Rr(this,"logger",void 0),Rr(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function Ck(){let e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function m5(){let e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?t?.[0]+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}let Jo={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},bb=Date.now(),kT=e=>{for(let t in Jo)if(Object.prototype.hasOwnProperty.call(Jo,t)&&Jo[t]===e)return t;return"DEFAULT"},k=new class{constructor(){Rr(this,"proxyServerURL",void 0),Rr(this,"logLevel",Jo.DEBUG),Rr(this,"uploadState","collecting"),Rr(this,"uploadLogWaitingList",[]),Rr(this,"uploadLogUploadingList",[]),Rr(this,"uploadErrorCount",0),Rr(this,"currentLogID",0),Rr(this,"url",void 0),Rr(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let s=[Jo.DEBUG].concat(t);this.log.apply(this,s)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let s=[Jo.INFO].concat(t);this.log.apply(this,s)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let s=[Jo.WARNING].concat(t);this.log.apply(this,s)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let s=[Jo.ERROR].concat(t);this.log.apply(this,s)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let s=[Jo.DEBUG].concat(t);this.uploadLog.apply(this,s)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Ln("UPLOAD_LOG",!0)}disableLogUpload(){Ln("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new Jue(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-bb<100)return void setTimeout(()=>{this.log(...t)},Date.now()-bb);let s=Math.max(0,Math.min(4,t[0]));if(t[0]=Ck()+" Agora-SDK [".concat(kT(s),"]:"),this.appendLogToWaitingList(s,...t),s<this.logLevel)return;let o=Ck()+" %cAgora-SDK [".concat(kT(s),"]:"),u=[];if(!z("USE_NEW_LOG"))switch(s){case Jo.DEBUG:u=[o,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,u);break;case Jo.INFO:u=[o,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,u);break;case Jo.WARNING:u=[o,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,u);break;case Jo.ERROR:u=[o,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-bb<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-bb);let s=Math.max(0,Math.min(4,t[0]));t[0]=Ck()+" Agora-SDK [".concat(kT(s),"]:"),this.appendLogToWaitingList(s,...t)}appendLogToWaitingList(e){if(!z("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];Array.isArray(n[0])?n[0][0]=m5()+" Agora-SDK [".concat(kT(e),"]:"):n[0]=m5()+" Agora-SDK [".concat(kT(e),"]:");let o="";n.forEach(u=>{typeof u=="object"&&(u=JSON.stringify(u)),o+="".concat(u," ")}),this.uploadLogWaitingList.push({payload_str:o,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){let e=this.uploadLogUploadingList,t={sdk_version:Xo,process_id:z("PROCESS_ID"),payload:JSON.stringify(e)};return Bl(async()=>{let n=await oa.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(z("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(z("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){let s=new Error("unexpected upload log response");throw s.response=n,s}},()=>(this.uploadLogUploadingList=[],!1),n=>{let s={status:-1,message:n.message,errorRange:e.map(o=>o.log_item_id)};return n.response?(s.status=n.response.status,s.data=n.response.data,s.headers=n.response.headers):n.request&&(s.status=n.request.status),f5.reportLogUploadError(s),!0},{timeout:z("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:z("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,z("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),z("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),z("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),z("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var g5;function $ue(e){return Hi(e.reportId,"params.reportId",0,100,!1),Hi(e.category,"params.category",0,100,!1),Hi(e.event,"params.event",0,100,!1),Hi(e.label,"params.label",0,100,!1),Vn(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(g5={}).FREE="free",g5.UPLOADING="uploading",(function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"})({});let Que={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},ai=(function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.RTE_DETAIL="rte_detail_stats",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e})({}),cr=(function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.RTE_DETAIL="io.agora.pb.Wrtc.RteDetailStats",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e})({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Zue=(function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e})({});function gt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,s){let o=s.value;if(typeof o=="function"){let u=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);s.value=function(){for(var d,f=arguments.length,g=new Array(f),y=0;y<f;y++)g[y]=arguments[y];let v=g;if(e.argsMap)try{v=e.argsMap(this,...g)}catch(b){k.warning(b),v=[]}try{JSON.stringify(v)}catch{k.warning("arguments for method ".concat(u,".").concat(String(n)," not serializable for apiInvoke.")),v=[]}let R=(e.report||tt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((d=this.store)===null||d===void 0?void 0:d.clientId)||this._ID,name:"".concat(u,".").concat(String(n)),options:v,tag:Fn.TRACER,reportResult:e.reportResult},e.throttleTime);try{let b=o.apply(this,g);return b instanceof We?b.then(A=>(R.onSuccess(e.reportResult&&A),A)).catch(A=>{throw R.onError(A),A}):(R.onSuccess(e.reportResult&&b),b)}catch(b){throw R.onError(b),b}}}return s}}let tt=new class{constructor(){Rr(this,"baseInfoMap",new Map),Rr(this,"proxyServer",void 0),Rr(this,"eventUploadTimer",void 0),Rr(this,"setSessionIdTimer",void 0),Rr(this,"url",void 0),Rr(this,"sids",new Set),Rr(this,"backupUrl",void 0),Rr(this,"_appId",void 0),Rr(this,"_aid",0),Rr(this,"keyEventUploadPendingItems",[]),Rr(this,"normalEventUploadPendingItems",[]),Rr(this,"apiInvokeUploadPendingItems",[]),Rr(this,"apiInvokeCount",0),Rr(this,"apiInvokeLoggedCount",0),Rr(this,"ltsList",[]),Rr(this,"lastSendNormalEventTime",Date.now()),Rr(this,"customReportCounterTimer",void 0),Rr(this,"customReportCount",0),Rr(this,"extApiInvoke",async e=>{for(let t of e){let n=Pt(Pt({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Fn.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),z("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),z("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[n,s]=t;return n+s}),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;let s=Date.now();this.apiInvokeCount+=1;let o=this.apiInvokeCount,u=!!z("SHOW_REPORT_INVOKER_LOG"),d=!!z("SHOW_REPORT_USER_INVOKER_LOG"),f=u||d&&t.id;f&&(this.apiInvokeLoggedCount+=1);let g=this.apiInvokeLoggedCount;function y(A,F){if(f){let M="[apiInvoke-".concat(g,"]");if(t.id&&(M+="[".concat(t.id,"]")),t.name&&(M+="[".concat(t.name,"]"),t.name===or.JOIN))return k.info("".concat(M," ").concat(A));k.info("".concat(M," ").concat(A),A==="start"?t.options:F||"")}}let v=()=>({tag:t.tag,invokeId:o,sid:e,name:t.name,apiInvokeTime:s,options:t.options,states:t.states||null});y("start");let R=!1;Ci(t.timeout).then(()=>{R||(this.sendApiInvoke(Pt(Pt({},v()),{},{error:Y.API_INVOKE_TIMEOUT,success:!1})),y("timeout"))});let b=new _e(Y.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:A=>{let F=()=>{if(R)throw b;return R=!0,this.sendApiInvoke(Pt(Pt({},v()),{},{success:!0},t.reportResult&&{result:A})),y("onSuccess"),A};return n?J4(F,t.name+"Success",n,()=>R=!0):F()},onError:A=>{let F=()=>{if(R)throw A;R=!0,this.sendApiInvoke(Pt(Pt({},v()),{},{success:!1,error:A})),y("onFailure",A.toString())};return n?J4(F,t.name+"Error",n,()=>R=!0):F()}}}_send(e,t,n){this.send({type:e,data:t},n)}_sendApiInvoke(e){return this.sendApiInvoke(e)}sessionInit(e,t){if(this.baseInfoMap.has(e))return;let n=Date.now(),s=this.createBaseInfo(e,n);s.cname=t.cname,s.rteUrl=t.rteUrl;let o=Object.assign({},{willUploadConsoleLog:z("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:Ek?"global":"oversea",areas:z("AREAS")&&z("AREAS").join(",")},t.extend),{stringUid:u,channelProfile:d,channelMode:f,isABTestSuccess:g,lsid:y,clientRole:v}=t,R=Date.now(),b=Pt(Pt({},s),{},{eventType:ai.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:vk,lts:R,elapse:R-n,extend:JSON.stringify(o),mode:t.mode,process:z("PROCESS_ID"),appType:z("APP_TYPE"),success:!0,version:Xo,stringUid:u,channelProfile:d,channelMode:f,isABTestSuccess:g,lsid:y,clientType:ke(A=window.navigator.userAgent).call(A,"AgoraWebView")?42:20,clientRole:v,serviceId:z("PROCESS_ID"),extensionID:z("PLUGIN_INFO").join(",")||"",rteUrl:t.rteUrl,rteSid:t.rteSid});var A;this.send({type:cr.SESSION,data:b},!0)}reportRteDetail(e){let t=this.baseInfoMap.get(e);if(!t)return;let n=t.info,s=Date.now(),o=Pt(Pt({},n),{},{eventType:ai.RTE_DETAIL,lts:s,success:!0,elapse:s-t.startTime,vid:n.vid===void 0?0:Number(n.vid),ua:navigator.userAgent});this.send({type:cr.RTE_DETAIL,data:o},!0)}joinChooseServer(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let s=n.info;t.vid&&(s.vid=t.vid);let o=Date.now(),u=Pt(Pt({},s),{},{role:t.role,eventType:ai.JOIN_CHOOSE_SERVER,lts:o,eventElapse:t.elapse||o-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:o-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,ua:navigator.userAgent,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:cr.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let s=n.info,o=Date.now(),u=Pt(Pt({},s),{},{eventType:ai.REQ_USER_ACCOUNT,lts:o,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||o-n.startTime,eventElapse:o-t.lts,extend:JSON.stringify(t.extend)});this.send({type:cr.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let s=n.info;t.vid&&(s.vid=t.vid),s.uid=t.uid,s.cid=t.cid;let o=Date.now(),{firstSuccess:u,addr:d,isProxy:f}=t,g=o-n.startTime,y=Pt(Pt({},s),{},{eventType:ai.JOIN_GATEWAY,lts:o,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:g,eventElapse:o-t.lts,firstSuccess:u,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:_k(),isABTestSuccess:t.isABTestSuccess?1:0,gatewayIp:null,gatewayPort:null,isProxy:f?1:0}),v=y.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=o),d)if(y.signalChannel==="1"){let R=wk(/(\d+\.\d+\.\d+\.\d+):(\d+)/,{ip:1,port:2}),b=d.match(R);y.gatewayIp=b&&b.groups?b.groups.ip:"",y.gatewayPort=b&&b.groups?b.groups.port:""}else if(f){let R=d.match(/h=(\d{1,3}-){3}\d{1,3}/g),b=d.match(/p=[0-9]{1,6}/g);y.gatewayIp=R&&R.length?R[0].split("=")[1].replace(/-/g,"."):"",y.gatewayPort=b&&b.length?b[0].split("=")[1]:""}else{let R=d.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),b=d.match(/(:|p=)[0-9]{1,6}/g);y.gatewayIp=R&&R.length?R[0].split("//")[1].replace(/-/g,"."):"",y.gatewayPort=b&&b.length?b[0].split(/:|p=/g)[1]:""}if(u)this.send({type:cr.JOIN_GATEWAY,data:y},!0);else{let R={isSuccess:v,port:y.gatewayPort};delete y.success,delete y.eventType,delete y.firstSuccess,delete y.gatewayPort,y.vid=Number(y.vid);let b=Object.assign({},y,R,{eventType:ai.REJOIN_GATEWAY});this.send({type:cr.RE_JOIN_GATEWAY,data:b},!0)}}joinChannelTimeout(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let s=Date.now(),o=Pt(Pt({},n.info),{},{lts:s,timeout:t,elapse:s-n.startTime});this.send({type:cr.JOIN_CHANNEL_TIMEOUT,data:o},!0)}publish(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let s=n.info,o=Date.now(),u=Pt(Pt({},s),{},{eventType:ai.PUBLISH,lts:o,eventElapse:t.eventElapse,elapse:o-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:cr.PUBLISH,data:u},!0)}subscribe(e,t,n){let s=this.baseInfoMap.get(e);if(!s)return;let o=s.info,u=Date.now(),d=Pt(Pt({},o),{},{eventType:ai.SUBSCRIBE,lts:u,eventElapse:t.eventElapse,elapse:u-s.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?d.peerSuid=t.peerid:d.peer=t.peerid,this.send({type:cr.SUBSCRIBE,data:d},!0)}wsCompressorInit(e){var t;let n=[...ys(t=this.baseInfoMap).call(t)],s=n.length?n[0]:"UnableToGetSid",o=this.baseInfoMap.get(s);if(!o)return;let u=o.info,d=Date.now(),f=Pt(Pt({},u),{},{eventType:ai.WS_COMPRESSOR_INIT,lts:d,eventElapse:e.eventElapse,elapse:d-o.startTime,status:e.status?1:2});this.send({type:cr.WS_COMPRESSOR_INIT,data:f},!0)}firstXLAPeerFirstVideoFrame(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let s=n.info,o=Date.now(),u=t.peerPubStatusMs-(n.lastJoinSuccessTime||o),d=Pt(Pt({},s),{},{elapse:o-n.startTime,eventType:ai.XLA_PEER_FIRST_VIDEO_FRAME,lts:o,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:u,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>u?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0,firstReceivedEncodedFrame:t.firstReceivedEncodedFrame?Math.max(t.firstReceivedEncodedFrame-t.joinChannelStart,0):void 0,frameType:t.frameType||"",rtpTimestamp:t.rtpTimestamp||0,framePayloadType:t.framePayloadType||0,frameDataLength:t.frameDataLength||0,mimeType:t.mimeType||""});this.send({type:cr.XLA_PEER_FIRST_VIDEO_FRAME,data:d},!0)}firstRemoteVideoDecode(e,t,n,s){let o=this.baseInfoMap.get(e);if(!o)return;let u=o.info,d=Date.now(),f=Pt(Pt(Pt({},u),s),{},{elapse:d-o.startTime,eventType:t,lts:d,firstDecodeFrame:Math.max((s.firstFrame||d)-o.startTime,0),apEnd:Math.max(s.apEnd-o.startTime,0),apStart:Math.max(s.apStart-o.startTime,0),joinGwEnd:Math.max(s.joinGwEnd-o.startTime,0),joinGwStart:Math.max(s.joinGwStart-o.startTime,0),pcEnd:Math.max(s.pcEnd-o.startTime,0),pcStart:Math.max(s.pcStart-o.startTime,0),subscriberEnd:Math.max(s.subscriberEnd-o.startTime,0),subscriberStart:Math.max(s.subscriberStart-o.startTime,0),videoAddNotify:Math.max(s.videoAddNotify-o.startTime,0)});this.send({type:n,data:f},!0)}firstRemoteFrame(e,t,n,s){let o=this.baseInfoMap.get(e);if(!o)return;let u=o.info,d=Date.now(),f=Pt(Pt(Pt({},u),s),{},{elapse:d-o.startTime,eventType:t,lts:d});this.send({type:n,data:f},!0)}abTest(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let s=n.info,o=Date.now(),u=Pt(Pt(Pt({},s),t),{},{vid:s.vid===void 0?0:Number(s.vid),elapse:o-n.startTime,eventType:ai.AB_TEST,lts:o});this.send({type:cr.AB_TEST,data:u},!0)}pcStats(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let s=n.info,o=Date.now(),u=Pt(Pt(Pt({},s),t),{},{vid:s.vid===void 0?0:Number(s.vid),elapse:o-n.startTime,eventType:ai.PC_STATS,lts:o,preallocation:t.preallocation?1:0});this.send({type:cr.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(e,t){if(e){let n=this.baseInfoMap.get(e);if(!n)return;let s=n.info,o=Date.now(),u=Pt(Pt(Pt({},s),t),{},{vid:s.vid===void 0?0:Number(s.vid),eventType:ai.UPDATE_REMOTE_RTPCAPABILITIES,lts:o});this.send({type:cr.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(e,t,n,s){let o=this.baseInfoMap.get(e);if(!o)return;let u=o.info,d=Date.now(),f=Pt(Pt(Pt({},u),s),{},{eventType:t,lts:d});this.send({type:n,data:f},!0)}streamSwitch(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let s=n.info,o=Date.now(),u=Pt(Pt({},s),{},{eventType:ai.STREAM_SWITCH,lts:o,isDual:t.isdual,elapse:o-n.startTime,success:t.succ});this.send({type:cr.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let s=n.info,o=Date.now(),u=Pt(Pt({},s),{},{eventType:ai.REQUEST_PROXY_APPCENTER,lts:o,eventElapse:o-t.lts,elapse:o-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:cr.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let s=n.info,o=Date.now(),u=Pt(Pt({},s),{},{eventType:ai.REQUEST_PROXY_WORKER_MANAGER,lts:o,eventElapse:o-t.lts,elapse:o-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:cr.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(e){this.proxyServer=e,e?k.debug("reportProxyServerurl: ".concat(e)):k.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let s=n.info,o=Date.now(),u=Pt(Pt({},s),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:o,elapse:o-n.startTime,joinChannelSuccessElapse:o-(n.lastJoinSuccessTime||o),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:cr.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let s=n.info,o=Date.now();(function(u,d,f){let g=u[d];if(!g||typeof g!="string")return[u];u[d]="";let y=Xu(JSON.stringify(u)),v=0,R=[],b=0;for(let A=0;A<g.length;A++)b+=g.charCodeAt(A)<=127?1:3,b<=f-y||(R[R.length]=Le(Le({},u),{},{[d]:g.substring(v,A)}),v=A,b=g.charCodeAt(A)<=127?1:3);return v!==g.length-1&&(R[R.length]=Le(Le({},u),{},{[d]:g.substring(v)})),R})(Pt(Pt(Pt({},s),t),{},{elapse:o-n.startTime,lts:o,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:cr.WORKER_EVENT,data:u},!0))}apworkerEvent(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let s=n.info,o=Date.now(),u=Pt(Pt(Pt({},s),t),{},{elapse:o-n.startTime,lts:o});this.send({type:cr.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let s=n.info,o=Date.now(),u=Pt(Pt(Pt({},s),t),{},{elapse:o-n.startTime,lts:o,extend:t.extend||void 0});this.send({type:cr.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let s=n.info,o=Date.now(),u=Pt(Pt(Pt({},s),t),{},{elapse:o-n.startTime,lts:o});this.send({type:cr.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>z("CUSTOM_REPORT_LIMIT"))throw new _e(Y.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));let n=Date.now(),s=t.map(o=>({type:cr.USER_ANALYTICS,data:Pt(Pt({sid:e},o),{},{lts:n})}));try{z("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(s):await this.postDataToStatsCollector(s)}catch(o){throw k.error("send custom report message failed",o.toString()),new _e(Y.CUSTOM_REPORT_SEND_FAILED,o.message)}}sendApiInvoke(e){let t=z("NOT_REPORT_EVENT");if(e.tag&&ke(t)&&ke(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;let n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;let{cname:s,uid:o,cid:u}=n.info,d;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof _e){let{code:g,message:y}=e.error;d=g||y||e.error.toString()}else d=e.error.toString();let f={invokeId:e.invokeId,sid:e.sid,cname:s,cid:u,uid:o,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?d:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:cr.API_INVOKE,data:f},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){let e=this.apiInvokeUploadPendingItems;if(e.length===0)return;let t=Array.from(this.sids).find(n=>n!==null);t&&e.forEach(n=>{n&&(n.sid=t,this.sendApiInvoke(Object.assign({},n)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>z("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){let n=[],s=[];for(;e.length;){let u=e.shift();n.length<20?n.push(u):s.push(u)}e.push(...s);for(let u of[...n]){var o;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),vm(o=this.ltsList).call(o,(d,f)=>d-f))}return t||(this.lastSendNormalEventTime=Date.now()),z("ENABLE_EVENT_REPORT")&&n.length&&(z("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((u=>d=>{z("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>z("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-z("NORMAL_EVENT_QUEUE_CAPACITY")),k.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){Cr.networkState===Gs.OFFLINE&&await We.race([Cr.onlineWaiter,Ci(2*Kr.maxRetryTimeout)]);let t=o=>{let u=new Uint8Array;return o.forEach(d=>{let f=rk(JSON.stringify(d.data)),g=new ArrayBuffer(5),y=(R=>{let b=0;return Object.entries(cr).forEach(A=>{let[F,M]=A;M===R.type&&(b=Zue[F])}),b})(d),v=new DataView(g);v.setUint16(0,f.byteLength,!0),v.setUint8(2,255&y),v.setUint8(3,y>>>8&255),v.setUint8(4,y>>>16&255),u=j4(u,new Uint8Array(g)),u=j4(u,f)}),u},n="event",s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(z("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(z("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let o=0;o<2;o+=1){o===1&&(s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(z("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(z("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await pk(s,{timeout:1e4,data:t(e),headers:Pt(Pt({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(o===1)throw u;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],n=(f=>{let g=f&&f.data.sid&&this.baseInfoMap.get(f.data.sid);return g&&g.info.vid&&+g.info.vid||0})(e[0]),s=n?void 0:this._aid,o={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(f=>JSON.stringify(f)),vid:n,aid:s};Cr.networkState===Gs.OFFLINE&&await We.race([Cr.onlineWaiter,Ci(2*Kr.maxRetryTimeout)]);let u=t?"/events/proto-raws":"/events/messages",d=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(z("EVENT_REPORT_DOMAIN"),"&p=").concat(z("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(z("EVENT_REPORT_DOMAIN"),":").concat(z("STATS_COLLECTOR_PORT")).concat(u));for(let f=0;f<2;f+=1){f===1&&(d=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(z("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(z("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(z("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(z("STATS_COLLECTOR_PORT")).concat(u)));try{t?await Vue(d,{timeout:1e4,data:o}):await pk(d,{timeout:1e4,data:o})}catch(g){if(f===1)throw g;continue}return}}createBaseInfo(e,t){let n=Object.assign({},Que);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){let n=performance.getEntriesByName(e),s=n[n.length-1];s&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:s,tag:Fn.TRACER}).onSuccess()}};f5.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Cr.networkState,tt.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Fn.TRACER}).onSuccess("logUploadError")});let he=class extends _e{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Rr(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,k)}throw(){super.throw(k)}},Ri={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1,supportSuppressLocalAudioPlayback:!1,supportRestrictOwnAudio:!1};function Qt(){return Ri}function _5(){return"setSinkId"in HTMLAudioElement.prototype&&(!z("RESTRICTION_SET_PLAYBACK_DEVICE")||(Qd()||R4())&&!x4())}function Ib(){return!Ri.supportUnifiedPlan||z("CHROME_FORCE_PLAN_B")&&qu()}function DT(e){return!($n()||b4(87)||Ib()||!z("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||z("FORCE_DISABLE_AUTO_SUB")))}function E5(e){return z("ENABLE_INSTANT_VIDEO")?z("ENABLE_INSTANT_VIDEO"):!(e==null||!e.autoSubscribe||z("FORCE_DISABLE_AUTO_SUB"))}function y5(){return navigator.mediaDevices&&"getSupportedConstraints"in navigator.mediaDevices}function v5(){if(y5()){let e=navigator.mediaDevices.getSupportedConstraints();return!(!("suppressLocalAudioPlayback"in e)||!e.suppressLocalAudioPlayback)}return jl(141)||gp(141)||Am(141)}function S5(){if(y5()){let e=navigator.mediaDevices.getSupportedConstraints();return!(!("restrictOwnAudio"in e)||!e.restrictOwnAudio)}return jl(141)||gp(141)||Am(125)}let zi=(function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e})({});function PE(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function fn(e,t,n,s,o){return{width:e,height:t,frameRate:n,bitrateMin:s,bitrateMax:o}}function Hc(e,t,n,s,o){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:s,bitrateMax:o}}function Rk(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}let ede={"90p":fn(160,90),"90p_1":fn(160,90),"120p":fn(160,120,15,30,65),"120p_1":fn(160,120,15,30,65),"120p_3":fn(120,120,15,30,50),"120p_4":fn(212,120),"180p":fn(320,180,15,30,140),"180p_1":fn(320,180,15,30,140),"180p_3":fn(180,180,15,30,100),"180p_4":fn(240,180,15,30,120),"240p":fn(320,240,15,40,200),"240p_1":fn(320,240,15,40,200),"240p_3":fn(240,240,15,40,140),"240p_4":fn(424,240,15,40,220),"360p":fn(640,360,15,80,400),"360p_1":fn(640,360,15,80,400),"360p_3":fn(360,360,15,80,260),"360p_4":fn(640,360,30,80,600),"360p_6":fn(360,360,30,80,400),"360p_7":fn(480,360,15,80,320),"360p_8":fn(480,360,30,80,490),"360p_9":fn(640,360,15,80,800),"360p_10":fn(640,360,24,80,800),"360p_11":fn(640,360,24,80,1e3),"480p":fn(640,480,15,100,500),"480p_1":fn(640,480,15,100,500),"480p_2":fn(640,480,30,100,1e3),"480p_3":fn(480,480,15,100,400),"480p_4":fn(640,480,30,100,750),"480p_6":fn(480,480,30,100,600),"480p_8":fn(848,480,15,100,610),"480p_9":fn(848,480,30,100,930),"480p_10":fn(640,480,10,100,400),"720p":fn(1280,720,15,120,1130),"720p_auto":fn(1280,720,30,900,3e3),"720p_1":fn(1280,720,15,120,1130),"720p_2":fn(1280,720,30,120,2e3),"720p_3":fn(1280,720,30,120,1710),"720p_5":fn(960,720,15,120,910),"720p_6":fn(960,720,30,120,1380),"1080p":fn(1920,1080,15,120,2080),"1080p_1":fn(1920,1080,15,120,2080),"1080p_2":fn(1920,1080,30,120,3e3),"1080p_3":fn(1920,1080,30,120,3150),"1080p_5":fn(1920,1080,60,120,4780),"1440p":fn(2560,1440,30,120,4850),"1440p_1":fn(2560,1440,30,120,4850),"1440p_2":fn(2560,1440,60,120,7350),"4k":fn(3840,2160,30,120,8910),"4k_1":fn(3840,2160,30,120,8910),"4k_3":fn(3840,2160,60,120,13500)},tde={"480p":Hc(640,480,5),"480p_1":Hc(640,480,5),"480p_2":Hc(640,480,30),"480p_3":Hc(640,480,15),"720p":Hc(1280,720,5),"720p_auto":fn(1280,720,30,900,3e3),"720p_1":Hc(1280,720,5),"720p_2":Hc(1280,720,30),"720p_3":Hc(1280,720,15),"1080p":Hc(1920,1080,5),"1080p_1":Hc(1920,1080,5),"1080p_2":Hc(1920,1080,30),"1080p_3":Hc(1920,1080,15)},nde={"1SL1TL":Rk(1,1),"3SL3TL":Rk(3,3),"2SL3TL":Rk(2,3)};function zc(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},ede[e]):e}function bk(e){return typeof e=="string"?Object.assign({},tde[e]):e}function Ab(e){return typeof e=="string"?Object.assign({},nde[e]):e}let rde={speech_low_quality:PE(16e3,!1),speech_standard:PE(32e3,!1,18),music_standard:PE(48e3,!1),standard_stereo:PE(48e3,!0,56),high_quality:PE(48e3,!1,128),high_quality_stereo:PE(48e3,!0,192)};function Ob(e){return typeof e=="string"?Object.assign({},rde[e]):e}let Um=[];function T5(e){return zr(e,"mediaSource",["screen","window","application"]),!0}let nt=(function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e})({}),bn=(function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e})({}),kE=(function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e})({}),ide=(function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e})({}),sde=(function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e})({}),Vm=(function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e})({}),DE=(function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e})({}),$o=(function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e})({}),xE=(function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e})({}),mo=(function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e})({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});let Ik={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},Ak={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},w5={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},ade={uplinkNetworkQuality:0,downlinkNetworkQuality:0},C5={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},zs=(function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e})({}),go=(function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e})({}),xT=(function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e})({}),Fm=(function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e})({}),hs=(function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e})({}),Ju=(function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e})({}),Ok={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370},Nb=(function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e})({});function an(e,t,n,s,o){var u,d,f={};return Object.keys(s).forEach(function(g){f[g]=s[g]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=ta(u=Wf(d=n.slice()).call(d)).call(u,function(g,y){return y(e,t,g)||g},f),o&&f.initializer!==void 0&&(f.value=f.initializer?f.initializer.call(o):void 0,f.initializer=void 0),f.initializer===void 0?(Object.defineProperty(e,t,f),null):f}function fe(e,t,n){return(t=(function(s){var o=(function(u,d){if(typeof u!="object"||!u)return u;var f=u[Symbol.toPrimitive];if(f!==void 0){var g=f.call(u,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)})(s);return typeof o=="symbol"?o:o+""})(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function R5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function qn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?R5(Object(n),!0).forEach(function(s){fe(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R5(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}class b5 extends dr{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(Vm.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,n){super(),fe(this,"trackMediaType",void 0),fe(this,"_ID",void 0),fe(this,"_rtpTransceiver",void 0),fe(this,"_lowRtpTransceiver",void 0),fe(this,"_hints",[]),fe(this,"_isClosed",!1),fe(this,"_originMediaStreamTrack",void 0),fe(this,"mediaStreamTrack",void 0),fe(this,"_external",{}),this._ID=n||In(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,(function(s){ke(Um).call(Um,s)||Um.push(s)})(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||_p(()=>{var n;tt.reportApiInvoke(null,{name:or.GET_MEDIA_STREAM_TRACK,options:[],tag:Fn.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===kE.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,(function(t){let n=Um.indexOf(t);n!==-1&&Um.splice(n,1)})(this),this.emit(DE.CLOSED),this.removeAllListeners(Vm.SEI_RECEIVED)}_updateRtpTransceiver(t,n){if(n===kE.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(Vm.TRANSCEIVER_UPDATED,t,n)}}class LE extends b5{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,n){super(t,n),fe(this,"_enabled",!0),fe(this,"_muted",!1),fe(this,"_isExternalTrack",!1),fe(this,"_isClosed",!1),fe(this,"_enabledMutex",void 0),fe(this,"processor",void 0),fe(this,"_processorContext",void 0),fe(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new ki("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,k.debug("[".concat(this.getTrackId(),"] close")),this.emit(nt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=s,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Wn(this,nt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){k.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(DE.TRACK_ENDED)}stateCheck(t,n){if(k.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),Bc(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new _e(Y.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",k);if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new _e(Y.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",k)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():We.resolve([])}}let I5=window.AudioContext||window.webkitAudioContext,Nk,_o=null,Mn=new class extends dr{constructor(){super(...arguments),fe(this,"prevState",void 0),fe(this,"curState",void 0),fe(this,"currentTime",void 0),fe(this,"currentTimeStuckAt",void 0),fe(this,"interruptDetectorTrack",void 0),fe(this,"onLocalAudioTrackMute",()=>{k.info("ios15-interruption-start"),this.emit(zi.IOS_15_16_INTERRUPTION_START)}),fe(this,"onLocalAudioTrackUnmute",async()=>{k.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?k.info("ios15-interruption-end-canceled"):(_o&&await _o.suspend(),this.emit(zi.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){k.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){k.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function ME(){if(!_o){if((function(){if(!I5)return void k.error("your browser is not support web audio");k.info("create audio context");let e=qn({},z("WEBAUDIO_INIT_OPTIONS"));k.debug("audio context init option:",JSON.stringify(e)),_o=new I5(e),Mn.curState=_o.state,_o.onstatechange=()=>{Mn.prevState=Mn.curState,Mn.curState=_o?_o.state:void 0;let{prevState:t,curState:n}=Mn,s=n==="running",o=n==="interrupted",u=t==="running",d=t==="suspended",f=t==="interrupted",g=pn().osVersion;(Es()||jc())&&u&&o&&(k.info("ios".concat(g,"-interruption-start")),Mn.emit(zi.IOS_INTERRUPTION_START)),(Es()||jc())&&(d||f)&&s&&(k.info("ios".concat(g,"-interruption-end")),Mn.emit(zi.IOS_INTERRUPTION_END)),t!==n&&Mn.emit(zi.STATE_CHANGE,n,t)},setInterval(()=>{var t;let n=(t=_o)===null||t===void 0?void 0:t.currentTime;Mn.currentTime!==n?(Mn.currentTimeStuckAt&&(k.debug("AudioContext current time resume at ".concat(n)),Mn.currentTimeStuckAt=void 0),Mn.currentTime=n):(n!==Mn.currentTimeStuckAt&&(tt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:Fn.TRACER}).onSuccess(),k.warning("AudioContext current time stuck at ".concat(n))),Mn.currentTimeStuckAt=n)},5e3),(async function(t){let n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],s,o,u=!1,d=!1,f=!1;function g(K){t.state==="running"?y(!1):Es()||jc()?t.state==="suspended"&&(y(!0),K&&t.resume().then(v,v)):t.state!=="closed"&&(y(!0),K&&t.resume().then(v,v))}function y(K){if(u!==K){u=K;for(let q=0,Q=n;q<Q.length;q+=1){let se=Q[q];K?window.addEventListener(se,R,{capture:!0,passive:!0}):window.removeEventListener(se,R,{capture:!0,passive:!0})}}}function v(){g(!1)}function R(){g(!0)}function b(){let K;try{K=s.play(),K?K.then(M,M):(s.addEventListener("playing",M),s.addEventListener("abort",M),s.addEventListener("error",M))}catch{M()}}function A(K){f||(s.paused?K?(F(!1),f=!0,b()):F(!0):F(!1))}function F(K){if(d!==K){d=K;for(let q=0,Q=n;q<Q.length;q++){let se=Q[q];K?window.addEventListener(se,j,{capture:!0,passive:!0}):window.removeEventListener(se,j,{capture:!0,passive:!0})}}}function M(){s.removeEventListener("playing",M),s.removeEventListener("abort",M),s.removeEventListener("error",M),f=!1,A(!1)}function j(){A(!0)}if(Es()&&z("IOS_BG_TAG")){let K=t.createMediaStreamDestination(),q=document.createElement("div");q.innerHTML="<audio x-webkit-airplay='deny'></audio>",s=q.children.item(0),s.controls=!1,s.disableRemotePlayback=!0,s.preload="auto",s.srcObject=K.stream,o=()=>{if(z("IOS_AUTO_RESTART_BG_TAG")&&s&&s.srcObject&&!f&&(!s.paused||d!==!0)){s.paused||s.pause();try{f=!0,b()}catch{f=!1}return!0}},A(!0)}return Mn.on(zi.STATE_CHANGE,function(){g(!0)}),g(!1),o})(_o).then(t=>{Nk=t})})(),!_o)throw new _e(Y.NOT_SUPPORTED,"can not create audio context");return _o}return _o}function jm(e){if((function(){if(Pk!==null)return Pk;let s=ME(),o=s.createBufferSource(),u=s.createGain(),d=s.createGain();o.connect(u),o.connect(d),o.disconnect(u);let f=!1;try{o.disconnect(u)}catch{f=!0}return o.disconnect(),Pk=f,f})())return;let t=e.connect,n=e.disconnect;e.connect=(s,o,u)=>{var d;return e._inputNodes||(e._inputNodes=[]),ke(d=e._inputNodes).call(d,s)||(s instanceof AudioNode?(e._inputNodes.push(s),t.call(e,s,o,u)):t.call(e,s,o)),e},e.disconnect=(s,o,u)=>{n.call(e),s?_b(e._inputNodes,s):e._inputNodes=[];for(let d of e._inputNodes)t.call(e,d)}}let Pk=null;function kk(e,t){let n=!1,s=1/t;if(z("DISABLE_WEBAUDIO")){let o=window.setInterval(()=>{n?window.clearInterval(o):e(performance.now()/1e3)},1e3*s)}else{let o=ME(),u=o.createGain();u.gain.value=0,u.connect(o.destination);let d=()=>{if(n)return void(u=null);let f=o.createOscillator();f.onended=d,f.connect(u),f.start(0),f.stop(o.currentTime+s),e(o.currentTime)};d()}return()=>{n=!0}}class A5{constructor(){fe(this,"context",void 0),fe(this,"analyserNode",void 0),fe(this,"sourceNode",void 0),this.context=ME(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Es()||jc()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;let t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{let s=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(s);for(let o=0;o<t.length;++o)t[o]=s[o]/128-1}let n=ta(t).call(t,(s,o)=>s+o*o,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{k.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class O5 extends dr{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var s;(s=this.sourceNode)===null||s===void 0||s.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),fe(this,"outputNode",void 0),fe(this,"outputTrack",void 0),fe(this,"isPlayed",!1),fe(this,"sourceNode",void 0),fe(this,"context",void 0),fe(this,"audioBufferNode",void 0),fe(this,"destNode",void 0),fe(this,"audioOutputLevel",0),fe(this,"volumeLevelAnalyser",void 0),fe(this,"_processedNode",void 0),fe(this,"playNode",void 0),fe(this,"isDestroyed",!1),fe(this,"onNoAudioInput",void 0),fe(this,"isNoAudioInput",!1),fe(this,"_noAudioInputCount",0),this.context=ME(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),jm(this.outputNode),this.volumeLevelAnalyser=new A5}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(mo.ON_AUDIO_BUFFER,(function(s){for(let o=0;o<s.outputBuffer.numberOfChannels;o+=1){let u=s.outputBuffer.getChannelData(o);for(let d=0;d<u.length;d+=1)u[d]=0}return s.inputBuffer})(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Qt().webAudioMediaStreamDest)throw new _e(Y.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&Eb(()=>{Mn.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Es()||jc()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();let n=this.volumeLevelAnalyser.getAnalyserNode(),s;n.getFloatTimeDomainData?(s=new Float32Array(n.fftSize),n.getFloatTimeDomainData(s)):(s=new Uint8Array(n.fftSize),n.getByteTimeDomainData(s));let o=!1;for(let u=0;u<s.length;u++)s[u]!==0&&(o=!0);return o?(this.isNoAudioInput=!1,!0):(await Ci(200),await this.checkHasAudioInput(t?t+1:1)&&o)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class Dk extends O5{get isFreeze(){return!1}constructor(t,n,s){var o;if(super(),fe(this,"sourceNode",void 0),fe(this,"track",void 0),fe(this,"clonedTrack",void 0),fe(this,"audioElement",void 0),fe(this,"isCurrentTrackCloned",!1),fe(this,"isRemoteTrack",!1),fe(this,"originVolumeLevelAnalyser",void 0),fe(this,"rebuildWebAudio",async()=>{if(k.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void k.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>k.info("resume success")),k.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();let f=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?f.stop():this.isCurrentTrackCloned=!0;let g=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(g),jm(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();let y=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(y,this.context.currentTime),jm(this.outputNode),this.emit(mo.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=g,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new _e(Y.UNEXPECTED_ERROR);this.track=t;let u=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(u),jm(this.sourceNode),s){let f=s.clone();f.enabled=!0,this.clonedTrack=f,k.debug("create an unmuted track ".concat(f.id," from the original track ").concat(s.id," to get the volume"));let g=this.context.createMediaStreamSource(new MediaStream([f]));jm(g),this.originVolumeLevelAnalyser=new A5,this.originVolumeLevelAnalyser.updateSource(g)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;let d=pn();n&&d.os===wi.IOS&&Number((o=d.osVersion)===null||o===void 0?void 0:o.split(".")[0])<15&&(Mn.on(zi.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(f=>{f||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;let n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),jm(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(mo.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),Mn.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){let n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),k.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));let s=this.context.createMediaStreamSource(new MediaStream([n]));jm(s),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(s)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function N5(e,t,n){let s=(u,d)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||d:u:d,o={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:s(t.height,1080),maxWidth:s(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(o.video.mandatory.maxFrameRate=t.frameRate.max,o.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(o.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(o)}async function ode(e,t){let n=await P5(e.mediaSource),{sourceId:s,audio:o}=await(function(u){let d=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new We((f,g)=>{let y=document.createElement("div");y.innerText="share screen",y.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");let v=document.createElement("div");v.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");let R=document.createElement("div");R.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",R.setAttribute("style","height: 12%;");let b=document.createElement("div");b.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");let A=document.createElement("div");A.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");let F=document.createElement("button");F.innerHTML="cancel",F.setAttribute("style","width: 85px;"),F.onclick=()=>{document.body.removeChild(K);let q=new Error("NotAllowedError");q.name="NotAllowedError",g(q)};let M=d,j=document.createElement("div");if(d){let q=document.createElement("input");q.setAttribute("type","checkbox");let Q=document.createElement("span");q.setAttribute("style","margin-right: 6px;"),Q.innerText="Share audio",q.checked=M,q.onchange=()=>{M=q.checked},j.appendChild(q),j.appendChild(Q)}A.appendChild(j),A.appendChild(F),v.appendChild(R),v.appendChild(b),v.appendChild(A);let K=document.createElement("div");K.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),K.appendChild(y),K.appendChild(v),document.body.appendChild(K),u.map(q=>{if(q.id){let Q=document.createElement("div");Q.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let se=q.thumbnail;try{let{width:oe}=se.getSize();oe>1920&&(se=se.resize({width:1920}))}catch(oe){throw oe&&oe.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),oe}Q.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+se.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+q.name.replace(/[\u00A0-\u9999<>\&]/g,function(oe){return"&#"+oe.charCodeAt(0)+";"})+"</span>",Q.onclick=()=>{document.body.removeChild(K),f({sourceId:q.id,audio:M})},b.appendChild(Q)}})})})(n,t);return await N5(s,e,o)}async function P5(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);let n=B4();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new _e(Y.ELECTRON_IS_NULL);let s=null;try{var o;s=((o=n.desktopCapturer)===null||o===void 0?void 0:o.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{s=null}s&&s.then||(s=new We((u,d)=>{n.desktopCapturer.getSources({types:t},(f,g)=>{f?d(f):u(g)})}));try{return await s}catch(u){throw new _e(Y.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}let xk=new ki("safari"),k5=!1,D5=!1;async function Eo(e,t){let n=0,s=null;for(;n<2;)try{s=await cde(e,t,n>0);break}catch(o){if(o instanceof _e)throw k.error("[".concat(t,"] ").concat(o.toString())),o;let u=Pb(o.name||o.code||o,o.message);if(u.code===Y.MEDIA_OPTION_INVALID){k.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await Ci(500);continue}throw k.error("[".concat(t,"] ").concat(u.toString())),u}if(!s)throw new _e(Y.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return s}async function cde(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new _e(Y.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));let s=Qt(),o=new MediaStream;if(e.audioSource&&o.addTrack(e.audioSource),e.videoSource&&o.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return k.debug("Using Video Source/ Audio Source"),o;if(e.screen)if(B4())e.screen.sourceId?UE(o,await N5(e.screen.sourceId,e.screen,!!e.screenAudio)):UE(o,await ode(e.screen,!!e.screenAudio));else if(Qd()&&e.screen.extensionId&&e.screen.mandatory){if(!s.getStreamFromExtension)throw new _e(Y.NOT_SUPPORTED,"This browser does not support screen sharing");k.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));let b=await(d=e.screen.extensionId,f=t,new We((A,F)=>{try{chrome.runtime.sendMessage(d,{getStream:!0},M=>{if(!M||!M.streamId)return k.error("[".concat(f,"] No response from Chrome Plugin. Plugin not installed properly"),M),void F(new _e(Y.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));A(M.streamId)})}catch(M){k.error("[".concat(f,"] AgoraRTC screensharing plugin is not accessible(").concat(d,")"),M.toString()),F(new _e(Y.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=b,UE(o,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(s.getDisplayMedia){var u;e.screen.mediaSource&&T5(e.screen.mediaSource);let b={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(u=e.screen.displaySurface)!==null&&u!==void 0?u:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:A,surfaceSwitching:F,systemAudio:M,preferCurrentTab:j,windowAudio:K,monitorTypeSurfaces:q}=e.screen,Q={selfBrowserSurface:A,surfaceSwitching:F,systemAudio:M,preferCurrentTab:j,windowAudio:K,monitorTypeSurfaces:q};!A&&delete Q.selfBrowserSurface,!F&&delete Q.surfaceSwitching,!M&&delete Q.systemAudio,!j&&delete Q.preferCurrentTab,!K&&delete Q.windowAudio,!q&&delete Q.monitorTypeSurfaces,k.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:b,audio:e.screenAudio,controls:Q})),UE(o,await navigator.mediaDevices.getDisplayMedia(qn({video:b,audio:e.screenAudio},Q)))}else{if(!$n())throw k.error("[".concat(t,"] This browser does not support screenSharing")),new _e(Y.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&T5(e.screen.mediaSource);let b={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};k.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(b))),UE(o,await navigator.mediaDevices.getUserMedia(b))}}var d,f;if(!e.video&&!e.audio)return o;let g={video:e.video,audio:e.audio},y=z("MEDIA_DEVICE_CONSTRAINTS");if(y)try{typeof y=="string"&&(y=JSON.parse(y)),g=ck(g,y)}catch{}k.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(g)),pn();let v,R=null;(Pi()||Es()||gb())&&(R=await xk.lock());try{v=await navigator.mediaDevices.getUserMedia(g)}catch(b){throw R&&R(),b}return g.audio&&(k5=!0),g.video&&(D5=!0),UE(o,v),R&&R(),o}function Pb(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new _e(Y.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new _e(Y.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new _e(Y.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new _e(Y.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new _e(Y.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new _e(Y.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return k.error("getUserMedia unexpected error",e),new _e(Y.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function UE(e,t){let n=e.getVideoTracks()[0],s=e.getAudioTracks()[0],o=t.getVideoTracks()[0],u=t.getAudioTracks()[0];u&&(s&&e.removeTrack(s),e.addTrack(u)),o&&(n&&e.removeTrack(n),e.addTrack(o))}let yo=new class extends dr{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Fm.STATE_CHANGE,e),this._state=e)}constructor(){super(),fe(this,"_state",xT.IDLE),fe(this,"isAccessMicrophonePermission",!1),fe(this,"isAccessCameraPermission",!1),fe(this,"lastAccessMicrophonePermission",!1),fe(this,"lastAccessCameraPermission",!1),fe(this,"checkdeviceMatched",!1),fe(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(z("ENUMERATE_DEVICES_INTERVAL")||(RT()||mb()===wi.HARMONY_OS)&&qu())&&this.updateDevicesInfo()},z("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>k.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new _e(Y.NOT_SUPPORTED,"enumerateDevices() not supported.");let s=await navigator.mediaDevices.enumerateDevices(),o=this.checkMediaDeviceInfoIsOk(s),u=!this.isAccessMicrophonePermission&&e,d=!this.isAccessCameraPermission&&t;o.audio&&(u=!1),o.video&&(d=!1);let f=null,g=null,y=null;if(!n&&(u||d)){if(xk.isLocked&&(k.debug("[device manager] wait GUM lock"),(await xk.lock())(),k.debug("[device manager] GUM unlock")),k5&&(u=!1,this.isAccessMicrophonePermission=!0),D5&&(d=!1,this.isAccessCameraPermission=!0),k.debug("[device manager] check media device permissions",e,t,u,d),u&&d){try{y=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(v){let R=Pb(v.name||v.code||v,v.message);if(R.code===Y.PERMISSION_DENIED)throw R;k.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{f=await navigator.mediaDevices.getUserMedia({audio:e})}catch(v){let R=Pb(v.name||v.code||v,v.message);if(R.code===Y.PERMISSION_DENIED)throw R;k.warning("getUserMedia failed in getDevices",R)}this.isAccessMicrophonePermission=!0}else if(d){try{g=await navigator.mediaDevices.getUserMedia({video:t})}catch(v){let R=Pb(v.name||v.code||v,v.message);if(R.code===Y.PERMISSION_DENIED)throw R;k.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0}k.debug("[device manager] mic permission",e,"cam permission",t)}try{let v=await navigator.mediaDevices.enumerateDevices();return f&&f.getTracks().forEach(R=>R.stop()),g&&g.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),f=null,g=null,y=null,v}catch(v){return f&&f.getTracks().forEach(R=>R.stop()),g&&g.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),f=null,g=null,y=null,new _e(Y.ENUMERATE_DEVICES_FAILED,v.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){let t=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===e);if(!t)throw new _e(Y.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=xT.INITING;try{await this.updateDevicesInfo(),this.state=xT.INITEND}catch(e){throw this.state=xT.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")?(k.warning("Device Detection functionality cannot start properly.",e.toString()),e):new _e(Y.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.")}}async updateDevicesInfo(){let e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;let o=e.find(d=>d.kind==="audioinput"&&d.deviceId==="default"),u=e.find(d=>d.kind==="audiooutput"&&d.deviceId==="default");o&&u?u.groupId===o.groupId?k.debug("[device-check] default input ".concat(o.label," and output ").concat(u.label," is the same group")):k.debug("[device-check] default input ".concat(o.label," and output ").concat(u.label," is not the same group")):k.debug("[device-check] default input or output not found")}let s=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(o=>{if(!o.deviceId)return;let u=this.deviceInfoMap.get("".concat(o.kind,"_").concat(o.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){let d={initAt:t,updateAt:t,device:o,state:"ACTIVE"};this.deviceInfoMap.set("".concat(o.kind,"_").concat(o.deviceId),d),n.push(d)}u&&(u.updateAt=t)}),this.deviceInfoMap.forEach((o,u)=>{o.state==="ACTIVE"&&o.updateAt!==t&&(o.state="INACTIVE",n.push(o))}),this.state!==xT.INITEND)return s.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(s.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(o=>{switch(o.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Fm.RECORDING_DEVICE_CHANGED,o);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Fm.CAMERA_DEVICE_CHANGED,o);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Fm.PLAYOUT_DEVICE_CHANGED,o)}}),s.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),s.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){let t=e.filter(o=>o.kind==="audioinput"),n=e.filter(o=>o.kind==="videoinput"),s={audio:!1,video:!1};for(let o of t)if(o.label&&o.deviceId){s.audio=!0;break}for(let o of n)if(o.label&&o.deviceId){s.video=!0;break}return s}},Lk=!1,la=new class extends dr{constructor(){super(...arguments),fe(this,"onAutoplayFailed",void 0),fe(this,"onAudioAutoplayFailed",void 0)}};function x5(){if(Lk)return z("FLS_AUTOPLAY_EMITS")?(la.onAutoplayFailed&&la.onAutoplayFailed(),la.emit("autoplay-failed")):void 0;{let e=t=>{t.preventDefault(),Lk=!1,bT()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};Lk=!0,bT()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),k.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),la.onAutoplayFailed?la.onAutoplayFailed():la.onAudioAutoplayFailed?k.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):k.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),la.emit("autoplay-failed")}}function L5(e,t,n,s){if(!e)return;let o=tt.getBaseInfoBySessionId(e);if(!o)return;let u=o.info,d=Date.now(),f=qn(qn({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:d,elapse:d-o.startTime,cbRegistered:la.onAutoplayFailed||la.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:s,extend:void 0});tt.send({type:cr.AUTOPLAY_FAILED,data:f},!0)}let lde=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Ps=new class{constructor(){fe(this,"onAutoplayFailed",void 0),fe(this,"elementMap",new Map),fe(this,"elementStateMap",new Map),fe(this,"elementsNeedToResume",[]),fe(this,"sinkIdMap",new Map),fe(this,"autoResumeAfterInterruption",e=>We.all(Array.from(this.elementMap.entries()).map(async t=>{let[n,s]=t,o=this.elementStateMap.get(n),u=s.srcObject.getAudioTracks()[0],d=u&&u.readyState;if(k.debug("resume after interrupted, ele: ".concat(o," audio: ").concat(d," ").concat(e)),d==="live"){if(e)return s.pause(),s.play();if(Mn.curState==="running")return wE()?(s.pause(),s.play()):o&&o==="paused"?s.play():void 0}}))),fe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e,s=n.srcObject.getAudioTracks()[0];s&&s.readyState==="live"&&(k.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),Mn.on(zi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Mn.on(zi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Mn.on(zi.STATE_CHANGE,()=>{Es()&&Mn.prevState==="suspended"&&Mn.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){let n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(s){throw new _e(Y.PERMISSION_DENIED,"can not set sink id: "+s.toString())}}play(e,t,n,s){if(this.elementMap.has(t))return;let o=document.createElement("audio");o.autoplay=!0,o.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,o),this.elementMap.set(t,o),this.elementStateMap.set(t,hs.INIT),this.setVolume(t,n);let u=this.sinkIdMap.get(t);if(u)try{o.setSinkId(u).catch(f=>{k.warning("[".concat(t,"] set sink id failed"),f.toString())})}catch(f){k.warning("[".concat(t,"] set sink id failed"),f.toString())}let d=o.play();d&&d.then&&d.catch(f=>{s&&L5(s,"audio",f.message,t),k.warning("audio element play warning",f.toString()),this.elementMap.has(t)&&f.name==="NotAllowedError"&&(k.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(o),Eb(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),x5()}))})}updateTrack(e,t){let n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){let n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}getVolume(e){let t=this.elementMap.get(e);return t?t.volume:0}stop(e){let t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;let n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){lde.forEach(n=>{t.addEventListener(n,s=>{let o=this.elementStateMap.get(e),u=s.type==="pause"?"paused":s.type;if(k.debug("[".concat(e,"] audio-element-status change ").concat(o," => ").concat(u)),s.type==="error"){let d=t?.error;d&&k.error("[".concat(e,"] media error, code: ").concat(d.code,", message: ").concat(d.message))}this.elementStateMap.set(e,u)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){let e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{k.debug("Auto resume audio element success")}).catch(n=>{k.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new We(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{bT()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Or(){return function(e,t,n){let s=n.value;return typeof s=="function"&&(n.value=function(){this._isClosed&&new _e(Y.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",k);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];let f=s.apply(this,u);return f instanceof We?new We((g,y)=>{f.then(g).catch(y)}):f}),n}}class M5 extends dr{constructor(t){super(),fe(this,"name","VideoProcessorDestination"),fe(this,"ID","0"),fe(this,"_source",void 0),fe(this,"videoContext",void 0),fe(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new _e(Y.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new _e(Y.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(zs.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(zs.ON_TRACK,void 0)}}class U5 extends dr{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),fe(this,"constraintsMap",new Map),fe(this,"statsRegistry",[]),fe(this,"usageRegistry",[]),fe(this,"trackId",void 0),fe(this,"direction",void 0),fe(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await ei(this,go.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var s;return k.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),Wn(this,go.REQUEST_UPDATE_CONSTRAINTS,Array.from(za(s=this.constraintsMap).call(s)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return k.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),Wn(this,go.REQUEST_UPDATE_CONSTRAINTS,Array.from(za(n=this.constraintsMap).call(n)))}registerStats(t,n,s){this.statsRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:s})}unregisterStats(t,n){let s=this.statsRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n);s!==-1&&this.statsRegistry.splice(s,1)}gatherStats(){let t=[];for(let{processorID:n,processorName:s,type:o,cb:u}of this.statsRegistry)try{let d=u();t.push({processorID:n,processorName:s,type:o,stats:d})}catch(d){k.error(new _e(Y.UNEXPECTED_ERROR,d.message))}return t}registerUsage(t,n){this.usageRegistry.find(s=>s.processorID===t.ID&&s.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){let n=this.usageRegistry.findIndex(s=>s.processorID===t.ID&&s.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){let t=[];if(!this.chained)return[];for(let{cb:n}of this.usageRegistry)try{let s=n();s instanceof We&&(s=await s),t.push(qn(qn({},s),{},{direction:this.direction}))}catch(s){k.error("gather extension usage error",s)}return t}getDirection(){return this.direction}}class V5 extends dr{constructor(t){super(),fe(this,"name","AudioProcessorDestination"),fe(this,"ID","0"),fe(this,"inputTrack",void 0),fe(this,"inputNode",void 0),fe(this,"audioProcessorContext",void 0),fe(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new _e(Y.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new _e(Y.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(zs.ON_TRACK,void 0),this.emit(zs.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(zs.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(zs.ON_NODE,this.inputNode))}}class F5 extends dr{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,s){super(),fe(this,"constraintsMap",new Map),fe(this,"statsRegistry",[]),fe(this,"audioContext",void 0),fe(this,"trackId",void 0),fe(this,"direction",void 0),fe(this,"usageRegistry",[]),fe(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=s}async getConstraints(){return ei(this,go.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var s;return k.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),Wn(this,go.REQUEST_UPDATE_CONSTRAINTS,Array.from(za(s=this.constraintsMap).call(s)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),Wn(this,go.REQUEST_UPDATE_CONSTRAINTS,Array.from(za(n=this.constraintsMap).call(n)))}registerStats(t,n,s){this.statsRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:s})}unregisterStats(t,n){let s=this.statsRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n);s!==-1&&this.statsRegistry.splice(s,1)}gatherStats(){let t=[];for(let{processorID:n,processorName:s,type:o,cb:u}of this.statsRegistry)try{let d=u();t.push({processorID:n,processorName:s,type:o,stats:d})}catch(d){k.error(new _e(Y.UNEXPECTED_ERROR,d.message))}return t}registerUsage(t,n){this.usageRegistry.find(s=>s.processorID===t.ID&&s.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){let n=this.usageRegistry.findIndex(s=>s.processorID===t.ID&&s.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){let t=[];if(!this.chained)return[];for(let{cb:n}of this.usageRegistry)try{let s=n();s instanceof We&&(s=await s),t.push(qn(qn({},s),{},{direction:this.direction}))}catch(s){k.error("gather extension usage error",s)}return t}getDirection(){return this.direction}}class Mk extends dr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),fe(this,"context",void 0),fe(this,"processSourceNode",void 0),fe(this,"outputTrack",void 0),fe(this,"processedNode",void 0),fe(this,"clonedTrack",void 0),fe(this,"outputNode",void 0),this.outputNode=new ude}setVolume(){}createOutputTrack(){throw new _e(Y.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class ude{disconnect(){}connect(){}}function j5(e){return new We((t,n)=>{let s=!1,o=document.createElement("video");o.setAttribute("autoplay",""),o.setAttribute("muted",""),o.muted=!0,o.autoplay=!0,o.setAttribute("playsinline",""),o.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(o);let u=Es()?"canplay":"playing";o.addEventListener(u,()=>{let d=o.videoWidth,f=o.videoHeight;!d&&$n()||(s=!0,o.srcObject=null,o.remove(),t([d,f]))}),o.srcObject=new MediaStream([e]),o.play().catch(OT),setTimeout(()=>{s||(o.srcObject=null,o.remove(),t([o.videoWidth,o.videoHeight]))},4e3)})}function kb(e){let t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});let n=zc(e.encoderConfig);return n.width!=null&&(t.width=n.width),n.height!=null&&(t.height=n.height),!D4()&&n.frameRate&&(t.frameRate=n.frameRate),R4()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),$n()&&(t.frameRate={ideal:30,max:30}),t}function B5(e){let t={};return D4()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,Qd()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function W5(e){let t=B5(e);if(e.encoderConfig){let n=Ob(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),RT()&&(t.sampleRate=void 0),t}let G5=e=>{let t=e._encoderConfig;if(!t)return;let{frameRate:n,width:s,height:o}=e.getMediaStreamTrackSettings(),{frameRate:u=n,width:d=s,height:f=o}=t;if(!u||!d||!f)return;d=bE(d),f=bE(f),u=bE(u);let{max:g,min:y}=(function(A,F,M){let j=200*Math.pow(M/15,.6)*Math.pow(A*F/640/360,.75);return{min:Math.floor(j),max:Math.floor(4*j)}})(d,f,u),{bitrateMax:v,bitrateMin:R}=t||{};v||k.debug("calculate bitrate: [w: ".concat(d,", h: ").concat(f,", fps: ").concat(u,"] => [brMax: ").concat(v,", brMin: ").concat(R,"]"));let{maxFramerate:b}=z("ENCODER_CONFIG_LIMIT");return b&&typeof b=="number"&&(u=Math.min(u,b)),{frameRate:u,bitrateMax:v||g,bitrateMin:R||y,scaleResolutionDownBy:1,scale:0}},H5=async(e,t,n)=>await(async(s,o,u)=>{let d=(function(y){let v=[];for(let R=0;R<y.length;R+=2)v.push(parseInt(y.slice(R,R+2),16));return Uint8Array.from(v)})(Z4(""+o+u)).slice(0,16),f=d.slice(0,12),g=await window.crypto.subtle.importKey("raw",d,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:f},g,s))})(e.buffer,t,n),Uk=e=>{let t=document.createElement("canvas");return t.width=2,t.height=2,new We((n,s)=>{t.toBlob(async o=>{if(t.remove(),o){let u=await z5(o);n({buffer:u,width:t.width,height:t.height})}else s(new _e(Y.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},z5=async e=>{let t=await e.arrayBuffer();return new Uint8Array(t)};var K5,Y5,q5,X5,J5,$5,Q5,Z5,e6,t6,n6,r6,i6,s6,a6,o6,c6,l6,yr,u6,d6,h6,p6,f6,m6,$u,g6,_6,E6,y6,v6,S6,T6,w6,C6,R6,b6,I6,A6,rs;let Nr=(K5=gt({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),Y5=gt({argsMap:(e,t)=>[e.getTrackId(),t]}),q5=Or(),X5=IE("LocalAudioTrack","_enabledMutex"),J5=gt({argsMap:(e,t)=>[e.getTrackId(),t]}),$5=Or(),Q5=IE("LocalAudioTrack","_enabledMutex"),Z5=gt({argsMap:(e,t)=>[e.getTrackId(),t]}),e6=Or(),t6=Or(),n6=Or(),r6=gt({argsMap:e=>[e.getTrackId()]}),i6=Or(),s6=gt({argsMap:e=>[e.getTrackId()]}),a6=Or(),o6=gt({argsMap:e=>[e.getTrackId()]}),c6=gt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),l6=gt({argsMap:e=>[e.getTrackId()]}),an((yr=class extends LE{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Ps.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,s){super(e,n),fe(this,"trackMediaType",xE.AUDIO),fe(this,"_encoderConfig",void 0),fe(this,"_trackSource",void 0),fe(this,"metadata",[]),fe(this,"_enabled",!0),fe(this,"_volume",100),fe(this,"_useAudioElement",!0),fe(this,"_bypassWebAudio",!1),fe(this,"processor",void 0),fe(this,"_processorContext",void 0),fe(this,"_processorDestination",void 0),fe(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!s,this._trackSource=new Mk,z("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),z("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Pi()&&!_o?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){Vn(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Ps.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void k.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,Wn(this,nt.NEED_REPLACE_TRACK,this).then(()=>{k.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{k.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!_5())throw new _e(Y.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ps.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await Wn(this,nt.NEED_ENABLE_TRACK,this),k.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(s){throw n||(this._enabled=!1),k.error("[".concat(this.getTrackId(),"] setEnabled to true error"),s.toString()),s}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await Wn(this,nt.NEED_DISABLE_TRACK,this)}catch(s){throw n||(this._enabled=!0),k.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,k.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Wn(this,nt.NEED_MUTE_TRACK,this):await Wn(this,nt.NEED_UNMUTE_TRACK,this))}getStats(){return _p(()=>{k.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),qa(this,nt.GET_STATS)||qn({},Ik)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(mo.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(mo.ON_AUDIO_BUFFER),this._source.on(mo.ON_AUDIO_BUFFER,n=>e(n))}play(){k.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(k.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Ps.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){k.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Ps.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];k.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ps.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Wn(this,nt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return We.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new _e(Y.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new _e(Y.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(zs.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await Wn(this,nt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Wn(this,nt.NEED_REPLACE_TRACK,this))}),e.on(zs.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(zs.ON_TRACK),e.removeAllListeners(zs.ON_NODE)}bindProcessorContextEvents(e){e.on(go.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(go.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof Mk&&(this._trackSource=new Dk(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){let e=new F5(this._source.context,this.getTrackId(),"local"),t=new V5(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(mo.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Ps.stop(this.getTrackId()),this._source.play()),Wn(this,nt.NEED_REPLACE_MIXING_TRACK,this).then(()=>{k.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{k.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[K5],Object.getOwnPropertyDescriptor(yr.prototype,"setVolume"),yr.prototype),an(yr.prototype,"setPlaybackDevice",[Y5,q5],Object.getOwnPropertyDescriptor(yr.prototype,"setPlaybackDevice"),yr.prototype),an(yr.prototype,"setEnabled",[X5,J5,$5],Object.getOwnPropertyDescriptor(yr.prototype,"setEnabled"),yr.prototype),an(yr.prototype,"setMuted",[Q5,Z5,e6],Object.getOwnPropertyDescriptor(yr.prototype,"setMuted"),yr.prototype),an(yr.prototype,"getStats",[t6],Object.getOwnPropertyDescriptor(yr.prototype,"getStats"),yr.prototype),an(yr.prototype,"setAudioFrameCallback",[n6],Object.getOwnPropertyDescriptor(yr.prototype,"setAudioFrameCallback"),yr.prototype),an(yr.prototype,"play",[r6,i6],Object.getOwnPropertyDescriptor(yr.prototype,"play"),yr.prototype),an(yr.prototype,"stop",[s6,a6],Object.getOwnPropertyDescriptor(yr.prototype,"stop"),yr.prototype),an(yr.prototype,"close",[o6],Object.getOwnPropertyDescriptor(yr.prototype,"close"),yr.prototype),an(yr.prototype,"pipe",[c6],Object.getOwnPropertyDescriptor(yr.prototype,"pipe"),yr.prototype),an(yr.prototype,"unpipe",[l6],Object.getOwnPropertyDescriptor(yr.prototype,"unpipe"),yr.prototype),yr),LT=(u6=gt({argsMap:(e,t)=>[e.getTrackId(),t]}),d6=Or(),h6=IE("MicrophoneAudioTrack","_enabledMutex"),p6=gt({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),f6=Or(),m6=gt({argsMap:e=>[e.getTrackId()]}),an(($u=class extends Nr{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,s){super(e,t.encoderConfig?Ob(t.encoderConfig):{},s,z("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),fe(this,"_config",void 0),fe(this,"_deviceName","default"),fe(this,"_constraints",void 0),fe(this,"_originalConstraints",void 0),fe(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(wE()||ek())&&Mn.bindInterruptDetectorTrack(this)}async setDevice(e){if(k.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{let t=await yo.getDeviceById(e),n={};n.audio=qn({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let s=null;try{s=await Eo(n,this.getTrackId())}catch(o){throw k.error("[".concat(this.getTrackId(),"] setDevice failed"),o.toString()),s=await Eo({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{let t=await yo.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}k.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return k.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),e),z("AUTO_RESET_AUDIO_ROUTE")&&(Es()||jc())){let d=navigator.audioSession;d&&(e||(d.type="playback"),d.type="auto")}if(!e){var s;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(s=this._source.clonedTrack)===null||s===void 0||s.stop(),n||(this._enabled=!1);try{await Wn(this,nt.NEED_DISABLE_TRACK,this)}catch(d){throw k.error("[".concat(this.getTrackId(),"] setEnabled false failed"),d.toString()),d}return}let o=qn({},this._constraints),u=yo.searchDeviceIdByName(this._deviceName);u&&!o.deviceId&&(o.deviceId=u);try{n||(this._enabled=!0);let d=await Eo({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!1),await Wn(this,nt.NEED_ENABLE_TRACK,this)}catch(d){throw n||(this._enabled=!1),k.error("[".concat(this.getTrackId(),"] setEnabled true failed"),d.toString()),d}k.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(wE()||ek())&&Mn.unbindInterruptDetectorTrack(this),Um.some(e=>(function(t){return"__className__"in t&&t.__className__==="MicrophoneAudioTrack"})(e))||Nk&&Nk()&&(tt.reportApiInvoke(null,{name:"BG_AUDIO_TAG_RESTART",options:{},tag:Fn.TRACER}).onSuccess(),k.debug("restart background audio tag success"))}onTrackEnded(){if((Es()||jc())&&this._enabled&&!this._isClosed&&Mn.duringInterruption){let e=async()=>{Mn.off(zi.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(k.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Mn.on(zi.IOS_INTERRUPTION_END,e)}else k.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(DE.TRACK_ENDED)}async renewMediaStreamTrack(e){let t=e||this._constraints,n=yo.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();let s=await Eo({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(go.REQUEST_UPDATE_CONSTRAINTS,async(t,n,s)=>{try{let o=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(o),n()}catch(o){s(o)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(go.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[u6,d6],Object.getOwnPropertyDescriptor($u.prototype,"setDevice"),$u.prototype),an($u.prototype,"setEnabled",[h6,p6,f6],Object.getOwnPropertyDescriptor($u.prototype,"setEnabled"),$u.prototype),an($u.prototype,"close",[m6],Object.getOwnPropertyDescriptor($u.prototype,"close"),$u.prototype),$u),dde=(g6=gt({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),_6=Or(),E6=gt({argsMap:e=>[e.getTrackId()]}),y6=Or(),v6=gt({argsMap:e=>[e.getTrackId()]}),S6=Or(),T6=gt({argsMap:e=>[e.getTrackId()]}),w6=Or(),C6=gt({argsMap:e=>[e.getTrackId()]}),R6=Or(),b6=gt({argsMap:e=>[e.getTrackId()]}),I6=gt({argsMap:e=>[e.getTrackId()]}),A6=Or(),an((rs=class extends Nr{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,s){super(t.createOutputTrack(),n,s),fe(this,"source",void 0),fe(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(mo.AUDIO_SOURCE_STATE_CHANGE,o=>{this.safeEmit(DE.SOURCE_STATE_CHANGE,o)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){Vn(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[g6,_6],Object.getOwnPropertyDescriptor(rs.prototype,"startProcessAudioBuffer"),rs.prototype),an(rs.prototype,"pauseProcessAudioBuffer",[E6,y6],Object.getOwnPropertyDescriptor(rs.prototype,"pauseProcessAudioBuffer"),rs.prototype),an(rs.prototype,"seekAudioBuffer",[v6,S6],Object.getOwnPropertyDescriptor(rs.prototype,"seekAudioBuffer"),rs.prototype),an(rs.prototype,"resumeProcessAudioBuffer",[T6,w6],Object.getOwnPropertyDescriptor(rs.prototype,"resumeProcessAudioBuffer"),rs.prototype),an(rs.prototype,"stopProcessAudioBuffer",[C6,R6],Object.getOwnPropertyDescriptor(rs.prototype,"stopProcessAudioBuffer"),rs.prototype),an(rs.prototype,"close",[b6],Object.getOwnPropertyDescriptor(rs.prototype,"close"),rs.prototype),an(rs.prototype,"setAudioBufferPlaybackSpeed",[I6,A6],Object.getOwnPropertyDescriptor(rs.prototype,"setAudioBufferPlaybackSpeed"),rs.prototype),rs);class oi extends Nr{get __className__(){return"MixingAudioTrack"}get isActive(){for(let t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){let t=ME().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,In(8,"track-mix-")),fe(this,"trackList",void 0),fe(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(k.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):k.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){k.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}_b(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){let t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(n=>{n instanceof oi?n.emit(Vm.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)}))}}class hde extends O5{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(mo.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),fe(this,"audioBuffer",void 0),fe(this,"sourceNode",void 0),fe(this,"startPlayTime",0),fe(this,"startPlayOffset",0),fe(this,"pausePlayTime",0),fe(this,"options",void 0),fe(this,"currentLoopCount",0),fe(this,"currentPlaybackSpeed",100),fe(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):k.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){let t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}let O6=new Map;function N6(e,t){if(e.length===0||t.length===0)return 1/0;let n=uk(e),s=uk(t);return Math.floor(s/n)}class Vk{get rendFrameRate(){let t=Math.max(1,N6(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:hs.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(k.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var n;t!==this._videoState&&(this._videoState=t,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(t){fe(this,"trackId",void 0),fe(this,"config",void 0),fe(this,"onFirstVideoFrameDecoded",void 0),fe(this,"onFirstVideoFrameRender",void 0),fe(this,"onVideoBufferReady",void 0),fe(this,"onVideoStateChanged",void 0),fe(this,"freezeTimeCounterList",[]),fe(this,"renderFreezeAccTime",0),fe(this,"renderFreezeAccTime2",0),fe(this,"isKeepLastFrame",!1),fe(this,"isDestroyed",!1),fe(this,"timeUpdatedCount",0),fe(this,"freezeTime",0),fe(this,"playbackTime",0),fe(this,"lastTimeUpdatedTime",0),fe(this,"autoplayFailed",!1),fe(this,"videoTrack",void 0),fe(this,"videoElement",void 0),fe(this,"cacheVideoElement",void 0),fe(this,"cancelRVFId",void 0),fe(this,"internal",!1),fe(this,"_render_interframe_delays",[]),fe(this,"_render_interframe_delays_sizes",[]),fe(this,"_videoState",Ju.VideoStateStopped),fe(this,"videoElementCheckInterval",void 0),fe(this,"videoElementFreezeTimeout",void 0),fe(this,"_videoElementStatus",hs.NONE),fe(this,"_isInPage",!0),fe(this,"isGettingVideoDimensions",!1),fe(this,"startGetVideoDimensions",()=>{let n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return k.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),fe(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Mn.curState==="running"&&(k.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(w4())),P4()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),fe(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":n.type==="play"&&k.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=hs.PLAYING;break;case"loadeddata":if(this.videoState=Ju.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=hs.CANPLAY;break;case"stalled":this.videoElementStatus=hs.STALLED;break;case"suspend":this.videoElementStatus=hs.SUSPEND;break;case"pause":this.videoElementStatus=hs.PAUSED,Es()||jc()||Pi()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(k.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=hs.WAITING;break;case"abort":this.videoElementStatus=hs.ABORT;break;case"ended":this.videoElementStatus=hs.ENDED;break;case"emptied":this.videoElementStatus=hs.EMPTIED;break;case"error":{let s=this.videoElement.error;s&&(this.videoElementStatus=hs.ERROR,k.error("[".concat(this.trackId,"] media error: ").concat(s.message," (").concat(s.code,")")));break}case"timeupdate":{let s=performance.now();if(this.timeUpdatedCount+=1,this.onVideoBufferReady&&this.timeUpdatedCount>z("BUFFER_READY_FRAMES")&&this.onVideoBufferReady(),this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=s);let o=s-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=s,Xa.lastVisibleTime<Xa.lastHiddenTime||u<Xa.lastHiddenTime||u<Xa.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(o>z("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=o),this.playbackTime+=o;this.playbackTime>=6e3;){this.playbackTime-=6e3;let d=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(d),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),fe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(k.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(w4())),P4()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),Mn.on(zi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Mn.on(zi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){let n=this.videoElement.play();n&&n.catch&&n.catch(o=>{t&&L5(t,"video",o.message,this.trackId),o.name==="NotAllowedError"?(k.warning("detected video element autoplay failed",o),this.autoplayFailed=!0,this.handleAutoPlayFailed()):k.warning("[".concat(this.trackId,"] play warning: "),o)});let s=pn();if((s.name==="Safari"&&Number(s.version)===15||wE())&&n&&n.then){let o=()=>{this.config.mirror&&!this.config.noStyle&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(o).catch(o)}}getCurrentFrame(){let t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;let n=t.getContext("2d");if(!n)return k.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);let s=n.getImageData(0,0,t.width,t.height);return t.remove(),s}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=document.createElement("canvas");s.width=this.videoElement.videoWidth,s.height=this.videoElement.videoHeight;let o=s.getContext("2d");return o?(o.drawImage(this.videoElement,0,0,s.width,s.height),new We((u,d)=>{s.toBlob(async f=>{if(s.remove(),f){let g=await z5(f);u({buffer:g,width:s.width,height:s.height})}else d(new _e(Y.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,n<0?.1:n>1?1:n)})):await Uk(t)}destroy(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.isDestroyed=!0,Mn.off(zi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Mn.off(zi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),t?this.videoElement.pause():this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Ju.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=hs.INIT,!this.videoElementCheckInterval&&(P6.forEach(u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=(function(u){return u!==document.body&&document.body.contains(u)})(this.videoElement)},1e3),z("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let u,d=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",d),this.videoElementFreezeTimeout=window.setTimeout(f,z("VIDEO_FREEZE_DURATION")))},f=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Ju.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Ju.VideoStateFrozen:document.addEventListener("visibilitychange",d))},g=(y,v)=>{if(this.videoElementStatus===hs.PLAYING){if(u){let A=v.presentationTime-u.presentationTime,F=v.presentedFrames-u.presentedFrames;this._render_interframe_delays_sizes.push(F),this._render_interframe_delays.push(A);let M=uk(this._render_interframe_delays_sizes),j=M-this._render_interframe_delays_sizes[0];if(M>30&&j>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===Ju.VideoStateStarting&&(this.videoState=Ju.VideoStateDecoding),this.videoState===Ju.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(f,z("VIDEO_FREEZE_DURATION"))),A<z("VIDEO_FREEZE_DURATION")&&this.videoState===Ju.VideoStateFrozen&&(this.videoState=Ju.VideoStateDecoding),A>z("VIDEO_FREEZE_DURATION")&&Xa.lastVisibleTime>=Xa.lastHiddenTime&&u.timestamp>Xa.lastVisibleTime&&u.timestamp>Xa.lastHiddenTime){let K=Math.min(66,N6(this._render_interframe_delays_sizes,this._render_interframe_delays)),q=Math.max(0,A-(F-1)*K);this.renderFreezeAccTime2+=q>K?q:0,this.renderFreezeAccTime+=A}}u=qn(qn({},v),{},{timestamp:y})}else this.isSkipCalcRenderFreezeTime()&&(u=qn(qn({},v),{},{timestamp:y}));var R,b;z("ENABLE_VIDEO_FRAME_CALLBACK")&&(this.cancelRVFId=(R=(b=this.videoElement).requestVideoFrameCallback)===null||R===void 0?void 0:R.call(b,g))};this.cancelRVFId=(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0?void 0:t.call(n,g)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),RT()&&!z("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");let s=pn();this.config.noStyle||(s.name==="Safari"&&Number(s.version)===15||wE()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover"),this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,$n()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,$n()&&this.videoElement.load());let o=this.videoElement.play();o!==void 0&&o.catch(u=>{k.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())})}resetVideoElement(){var t,n;P6.forEach(s=>{this.videoElement&&this.videoElement.removeEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.cancelRVFId&&this.videoElement&&((t=(n=this.videoElement).cancelVideoFrameCallback)===null||t===void 0||t.call(n,this.cancelRVFId),this.cancelRVFId=void 0),this.videoElementStatus=hs.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===hs.DESTROYED||this.internal}handleAutoPlayFailed(){let t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{k.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(s=>{k.error(s)}),this.autoplayFailed=!1,bT()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};bT()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),x5()}}let P6=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Db extends Vk{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),fe(this,"container",void 0),fe(this,"slot",void 0),this.slot=t.element,this.internal=n,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;let n=t.element;var s;!this.internal||this.slot?(n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()):(this.slot=n,n&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(s=this.slot)===null||s===void 0||s.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,s):await Uk(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",z("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var k6,D6,x6,L6,M6,U6,V6,F6,j6,B6,W6,G6,H6,z6,K6,Y6,q6,X6,J6,$6,Q6,Z6,eW,tW,nW,rW,iW,sW,Zt,aW,oW,cW,lW,uW,dW,hW,pW,vo;let jn=(k6=gt({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),D6=Or(),x6=gt({argsMap:e=>[e.getTrackId()]}),L6=IE("LocalVideoTrack","_enabledMutex"),M6=gt({argsMap:(e,t)=>[e.getTrackId(),t]}),U6=Or(),V6=IE("LocalVideoTrack","_enabledMutex"),F6=gt({argsMap:(e,t)=>[e.getTrackId(),t]}),j6=Or(),B6=gt({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),W6=Or(),G6=gt({argsMap:(e,t)=>[e.getTrackId(),t]}),H6=Or(),z6=Or(),K6=gt({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),Y6=Or(),q6=Or(),X6=Or(),J6=gt({argsMap:e=>[e.getTrackId()]}),$6=Or(),Q6=Or(),Z6=Or(),eW=Or(),tW=Or(),nW=gt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),rW=gt({argsMap:e=>[e.getTrackId()]}),iW=gt({argsMap:e=>[e.getTrackId()]}),sW=gt({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),Zt=class one extends LE{get videoHeight(){if(Pi()){let{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(Pi()){let{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==hs.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,s,o,u,d){if(super(t,u),fe(this,"trackMediaType",xE.VIDEO),fe(this,"_player",void 0),fe(this,"isUseScaleResolutionDownBy",!1),fe(this,"_videoVisibleTimer",null),fe(this,"_previousVideoVisibleStatus",void 0),fe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),fe(this,"_encoderConfig",void 0),fe(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),fe(this,"_optimizationMode",void 0),fe(this,"_saveEncodeBitrateRatio",1),fe(this,"_videoHeight",void 0),fe(this,"_videoWidth",void 0),fe(this,"_forceBitrateLimit",void 0),fe(this,"_enabled",!0),fe(this,"_processorDestination",void 0),fe(this,"_processorContext",void 0),Pi()){let{width:f,height:g}=t.getSettings();this._videoWidth=f,this._videoHeight=g}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=s,this._optimizationMode=o,this._hints=d||[],n&&this._hints.indexOf(bn.CUSTOM_TRACK)!==-1?this._encoderConfig=Qn(n):this._encoderConfig=n,this._hints.indexOf(bn.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if($1(_n.CHROME,115)&&mb().indexOf("Windows")!==-1){let f=(function(g,y){if("VideoFrame"in window&&"TransformStream"in window&&Qt().supportWebRTCInsertableStream){let v=new MediaStreamTrackProcessor(g),R=new MediaStreamTrackGenerator({kind:"video"}),b,A,F=Date.now(),M=()=>{j&&(clearInterval(j),j=void 0),b&&(b.close(),b=void 0),g.stop(),A=void 0,R.removeEventListener("ended",M)},j=window.setInterval(()=>{if(A&&b&&Date.now()-F>1e3)try{R.readyState==="live"?A.enqueue(b.clone()):M()}catch{M()}},1e3),K=new TransformStream({transform:(q,Q)=>{R.readyState==="live"?(A=Q,F=Date.now(),b===void 0?(b=q,Q.enqueue(q.clone())):(Q.enqueue(b),b=q)):q.close()}});return R.addEventListener("ended",M),v.readable.pipeThrough(K).pipeTo(R.writable),R}})(t);f&&(k.info("local screen video track begin to inject frame"),this._mediaStreamTrack=f)}n&&this._hints.indexOf(bn.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new U5(this.getTrackId(),"local"),this._processorDestination=new M5(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){let o=document.getElementById(t);o?t=o:(k.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}k.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));let s=qn(qn(qn({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(s):(t instanceof HTMLVideoElement?this._player=new Vk(s):this._player=new Db(s),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let o=this.getVideoElementVisibleStatus();this.safeEmit(DE.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},z("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,k.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await Wn(this,nt.NEED_DISABLE_TRACK,this)}catch(s){throw k.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}return n||(this._enabled=!1),void k.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Wn(this,nt.NEED_ENABLE_TRACK,this)}catch(s){throw k.error("[".concat(this.getTrackId(),"] setEnabled to true error"),s.toString()),s}k.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,k.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await Wn(this,nt.NEED_MUTE_TRACK,this):await Wn(this,nt.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),k.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await Wn(this,nt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(k)}}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new _e(Y.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=zc(t),z("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){let s=kb({encoderConfig:t});(Pi()||Es()||jc())&&(s.deviceId=void 0),k.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(s));try{await this._originMediaStreamTrack.applyConstraints(s),this.updateMediaStreamTrackResolution()}catch(o){let u=new _e(Y.UNEXPECTED_ERROR,o.toString());throw k.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=t,this._hints.indexOf(bn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Wn(this,nt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(k)}}getStats(){return _p(()=>{k.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),qa(this,nt.GET_STATS)||qn({},Ak)}async setBeautyEffect(t){k.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await Uk(t)}async findClosestProfile(){let{width:t,height:n,frameRate:s}=this.getMediaStreamTrackSettings(),{width:o,height:u,frameRate:d}=this._encoderConfig||{},f=bE(this._videoWidth||t||o||0),g=bE(this._videoHeight||n||u||0),y=(function(v,R,b){if(!Array.isArray(z("VIDEO_ENCODER_CONFIG_LIST"))||z("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;let A=Math.min(v,R);return!(A>=480)&&qn(qn({},z("VIDEO_ENCODER_CONFIG_LIST").find(F=>F.height>A)),{},{frameRate:b})})(f,g,bE(s||d||15));if(y)return k.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(f,"x").concat(g," => ").concat(JSON.stringify(y))),this.setEncoderConfiguration(y)}async setBitrateLimit(t){k.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void k.error(Y.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");let n=this._optimizationMode;try{this._optimizationMode=t,await Wn(this,nt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(s){throw this._optimizationMode=n,k.error("[".concat(this.getTrackId(),"] set optimization mode failed"),s.toString()),s}k.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return k.error(Y.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,k.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){j5(this._originMediaStreamTrack).then(t=>{let[n,s]=t;this._videoHeight=s,this._videoWidth=n}).catch(OT)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new _e(Y.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");k.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=zc(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(bn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Wn(this,nt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(k)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;let{width:t,height:n,frameRate:s}=this.getMediaStreamTrackSettings();if(!t||!n||!s)return;let{bitrateMax:o,bitrateMin:u}=this._encoderConfig;if(u==null||o==null){let{max:d,min:f}=(function(g,y,v,R,b){let A=z("BITRATE_ADAPTER_TYPE");if(A==="DEFAULT_BITRATE")return{min:R,max:b};if(b===void 0){let F=Math.floor(200*Math.pow(v/15,.6)*Math.pow(g*y/640/360,.75));b=A==="STANDARD_BITRATE"?4*F:2*F,R=R??F}else R=R??Math.floor(b/10);return{min:R,max:b}})(t,n,s,u,o);if(this._encoderConfig.bitrateMin=f,this._encoderConfig.bitrateMax=d,z("VIDEO_STANDARD_BITRATE_VERSION")&&u==null&&o==null){let[g,y]=(function(v,R,b){let A=4*Math.floor(2e5*Math.pow(b/15,.6)*Math.pow(v*R/230400,.75)),F=v*R,M=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),j=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]),K=za(M).call(M).next().value,q=1;if(M.has(F))K=M.get(F);else{var Q;let Qe=vm(Q=Array.from(M.entries())).call(Q,(Xt,Lt)=>{let[jt]=Xt,[En]=Lt;return jt-En}),at=Qe.find(Xt=>{let[Lt]=Xt;return Lt>F});if(at){let Xt=Qe.indexOf(at);if(Xt>0){let Lt=Qe[Xt-1],jt=(F-Lt[0])/(at[0]-Lt[0]);K=Lt[1]+jt*(at[1]-Lt[1])}else K=at[1]}else K=Qe[Qe.length-1][1]}if(j.has(F))q=j.get(F);else{var se;let Qe=vm(se=Array.from(j.entries())).call(se,(Xt,Lt)=>{let[jt]=Xt,[En]=Lt;return jt-En}),at=Qe.find(Xt=>{let[Lt]=Xt;return Lt>F});if(at){let Xt=Qe.indexOf(at);if(Xt>0){let Lt=Qe[Xt-1],jt=(F-Lt[0])/(at[0]-Lt[0]);q=Lt[1]+jt*(at[1]-Lt[1])}else q=at[1]}else q=Qe[Qe.length-1][1]}let oe=z("VIDEO_NEW_BITRATE_RATIO");oe&&oe>0&&(K=oe/100);let ne=Math.floor(A*K),de=Math.floor(65e4*Math.pow(v*R/230400,.5)*Math.pow(b/15,.69)),we=ne,Oe=z("VIDEO_STANDARD_BITRATE_VERSION");return Oe&&Oe>0&&(Oe===1?we=A:Oe===2?we=ne:Oe===3&&(we=de)),[Math.floor(we/1e3),q]})(t,n,s);this._encoderConfig.bitrateMax=g,this._encoderConfig.bitrateMin=f?Math.min(f,g):g,this._saveEncodeBitrateRatio=y,k.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(s,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else k.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(s,"] => [brMax: ").concat(d,", brMin: ").concat(f,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,n;let s=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),o={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:s?.parentElement},{element:u,slot:d}=o;if(this.isPlaying&&u instanceof HTMLVideoElement&&d instanceof HTMLElement){let f=F4.checkOneElementVisible(u),g=Object.assign({},f);if(g.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=g.visible;let y=tt.reportApiInvoke(null,{tag:Fn.TRACER,name:or.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});g.visible?y.onSuccess("Video is visible"):y.onSuccess("Invisible because of ".concat(g.reason))}return g}return}catch(s){throw new _e(Y.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new _e(Y.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;let t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],s=this._encoderConfig;t&&(s=qn(qn({},s),zc(t))),s=km(s);let o=In(8,"track-video-cloned-"),u=new one(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,s,km(this._scalabilityMode),this._optimizationMode,o,km(this._hints));return t&&s&&u.setEncoderConfiguration(s),k.debug("clone video track from ".concat(this.getTrackId()," to ").concat(o,", clone ").concat(n)),u}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new _e(Y.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new _e(Y.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(_p(()=>{tt.reportApiInvoke(null,{name:or.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Fn.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!z("ENABLE_VIDEO_SEI")||!z("ENABLE_ENCODED_TRANSFORM"))return void k.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new _e(Y.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();let n=this.getRTCRtpTransceiver();if(!n)return void k.warning("Video track is not published, SEI can not be send");let s=n.sender.getParameters();if(s.codecs.length===0)return;let o=s.codecs[0].mimeType.toLocaleLowerCase();o==="video/h264"||o==="video/h265"?this.safeEmit("sei-to-send",t):k.warning("SEI is not supported by ".concat(o))}bindProcessorDestinationEvents(){this.processorDestination.on(zs.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await Wn(this,nt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Wn(this,nt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(zs.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(go.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(go.REQUEST_CONSTRAINTS)}},an(Zt.prototype,"play",[k6,D6],Object.getOwnPropertyDescriptor(Zt.prototype,"play"),Zt.prototype),an(Zt.prototype,"stop",[x6],Object.getOwnPropertyDescriptor(Zt.prototype,"stop"),Zt.prototype),an(Zt.prototype,"setEnabled",[L6,M6,U6],Object.getOwnPropertyDescriptor(Zt.prototype,"setEnabled"),Zt.prototype),an(Zt.prototype,"setMuted",[V6,F6,j6],Object.getOwnPropertyDescriptor(Zt.prototype,"setMuted"),Zt.prototype),an(Zt.prototype,"setSaveEncodeBitrateRatio",[B6,W6],Object.getOwnPropertyDescriptor(Zt.prototype,"setSaveEncodeBitrateRatio"),Zt.prototype),an(Zt.prototype,"setEncoderConfiguration",[G6,H6],Object.getOwnPropertyDescriptor(Zt.prototype,"setEncoderConfiguration"),Zt.prototype),an(Zt.prototype,"getStats",[z6],Object.getOwnPropertyDescriptor(Zt.prototype,"getStats"),Zt.prototype),an(Zt.prototype,"setBeautyEffect",[K6,Y6],Object.getOwnPropertyDescriptor(Zt.prototype,"setBeautyEffect"),Zt.prototype),an(Zt.prototype,"getCurrentFrameData",[q6],Object.getOwnPropertyDescriptor(Zt.prototype,"getCurrentFrameData"),Zt.prototype),an(Zt.prototype,"getCurrentFrameImage",[X6],Object.getOwnPropertyDescriptor(Zt.prototype,"getCurrentFrameImage"),Zt.prototype),an(Zt.prototype,"findClosestProfile",[J6,$6],Object.getOwnPropertyDescriptor(Zt.prototype,"findClosestProfile"),Zt.prototype),an(Zt.prototype,"setBitrateLimit",[Q6],Object.getOwnPropertyDescriptor(Zt.prototype,"setBitrateLimit"),Zt.prototype),an(Zt.prototype,"setOptimizationMode",[Z6],Object.getOwnPropertyDescriptor(Zt.prototype,"setOptimizationMode"),Zt.prototype),an(Zt.prototype,"setScalabiltyMode",[eW],Object.getOwnPropertyDescriptor(Zt.prototype,"setScalabiltyMode"),Zt.prototype),an(Zt.prototype,"updateMediaStreamTrackResolution",[tW],Object.getOwnPropertyDescriptor(Zt.prototype,"updateMediaStreamTrackResolution"),Zt.prototype),an(Zt.prototype,"pipe",[nW],Object.getOwnPropertyDescriptor(Zt.prototype,"pipe"),Zt.prototype),an(Zt.prototype,"unpipe",[rW],Object.getOwnPropertyDescriptor(Zt.prototype,"unpipe"),Zt.prototype),an(Zt.prototype,"close",[iW],Object.getOwnPropertyDescriptor(Zt.prototype,"close"),Zt.prototype),an(Zt.prototype,"replaceTrack",[sW],Object.getOwnPropertyDescriptor(Zt.prototype,"replaceTrack"),Zt.prototype),Zt),xb=(aW=gt({argsMap:(e,t)=>[e.getTrackId(),t]}),oW=Or(),cW=IE("CameraVideoTrack","_enabledMutex"),lW=gt({argsMap:(e,t)=>[e.getTrackId(),t]}),uW=Or(),dW=gt({argsMap:(e,t)=>[e.getTrackId(),t]}),hW=Or(),pW=gt({argsMap:e=>[e.getTrackId()]}),vo=class cne extends jn{get __className__(){return"CameraVideoTrack"}constructor(t,n,s,o,u,d){super(t,zc(n.encoderConfig),o,u,d),fe(this,"_config",void 0),fe(this,"_originalConstraints",void 0),fe(this,"_constraints",void 0),fe(this,"_enabled",!0),fe(this,"_deviceName","default"),fe(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(wE()||ek())&&!(function(){let f=pn();if(f.os!==wi.IOS||!f.osVersion)return!1;let g=f.osVersion.split(".");return Number(g[0])===15&&Number(g[1])>=2})()&&k4()&&this._enabled&&!this._isClosed&&(k.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=s,this._constraints=s,this._deviceName=t.label,this._encoderConfig=zc(this._config.encoderConfig),Mn.on(zi.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Mn.on(zi.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(k.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{let n=await yo.getDeviceById(t),s={};s.video=qn({},this._constraints),s.video.deviceId={exact:t},s.video.facingMode=void 0,this._originMediaStreamTrack.stop();let o=null;try{o=await Eo(s,this.getTrackId())}catch(u){throw k.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),o=await Eo({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{let n=await yo.getDeviceById(t);this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}k.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){k.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));let n={video:qn(qn({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let s=null;try{s=await Eo(n,this.getTrackId())}catch(o){throw k.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),o.toString()),s=await Eo({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=qn({},n.video),k.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{let s=await Eo({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1)}await Wn(this,nt.NEED_ENABLE_TRACK,this)}catch(s){throw k.error("[".concat(this.getTrackId(),"] setEnabled true error"),s.toString()),s}this.updateMediaStreamTrackResolution(),k.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await Wn(this,nt.NEED_DISABLE_TRACK,this)}catch(s){throw k.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}k.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new _e(Y.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=zc(t),z("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);let s=Qn(this._config);s.encoderConfig=t;let o=kb(s);(Pi()||Es()||jc())&&(o.deviceId=void 0),k.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(u){let d=new _e(Y.UNEXPECTED_ERROR,u.toString());throw k.error("[".concat(this.getTrackId(),"] applyConstraints error"),d.toString()),d}this._config=s,this._constraints=o,this._originalConstraints=o,this._encoderConfig=t,this._hints.indexOf(bn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Wn(this,nt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw(k)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Es()||jc())&&this._enabled&&!this._isClosed&&Mn.duringInterruption){let t=async()=>{Mn.off(zi.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(k.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Mn.on(zi.IOS_INTERRUPTION_END,t)}else k.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(DE.TRACK_ENDED)}async renewMediaStreamTrack(t){let n=t||this._constraints,s=yo.searchDeviceIdByName(this._deviceName);if(s&&!n.deviceId&&(n.deviceId={exact:s}),this._enabled){let o=await Eo({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Mn.off(zi.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Mn.off(zi.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],s=this._encoderConfig;t&&(s=qn(qn({},s),zc(t))),s=km(s);let o=In(8,"track-cam-cloned-"),u=new cne(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,km(qn(qn({},this._config),{},{encoderConfig:s})),km(this._constraints),km(this._scalabilityMode),this._optimizationMode,o);return t&&s&&u.setEncoderConfiguration(s),k.debug("clone track from ".concat(this.getTrackId()," to ").concat(o,", clone ").concat(n)),u}bindProcessorContextEvents(){this.processorContext.on(go.REQUEST_UPDATE_CONSTRAINTS,async(t,n,s)=>{try{let o=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(o),n()}catch(o){s(o)}}),this.processorContext.on(go.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},an(vo.prototype,"setDevice",[aW,oW],Object.getOwnPropertyDescriptor(vo.prototype,"setDevice"),vo.prototype),an(vo.prototype,"setEnabled",[cW,lW,uW],Object.getOwnPropertyDescriptor(vo.prototype,"setEnabled"),vo.prototype),an(vo.prototype,"setEncoderConfiguration",[dW,hW],Object.getOwnPropertyDescriptor(vo.prototype,"setEncoderConfiguration"),vo.prototype),an(vo.prototype,"close",[pW],Object.getOwnPropertyDescriptor(vo.prototype,"close"),vo.prototype),vo);function fW(e){let t=In(8,"track-cus-"),n=tt.reportApiInvoke(null,{id:t,tag:Fn.TRACER,name:or.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),s=new Nr(e.mediaStreamTrack,e.encoderConfig?Ob(e.encoderConfig):{},t,!1);return k.info("create custom audio track success with config",e,"trackId",s.getTrackId()),n.onSuccess(s.getTrackId()),s}function Fk(e,t,n,s){n.optimizationMode&&(s&&s.width&&s.height?(n.encoderConfig=qn(qn({},s),{},{bitrateMin:s.bitrateMin,bitrateMax:s.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?k.debug("[".concat(e,"] set content hint to"),n.optimizationMode):k.debug("[".concat(e,"] set content hint failed")))):k.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var mW,gW,_W,EW,Qo,yW,vW,SW,TW,wW,CW,RW,is;class bW extends b5{getUserId(){return this._userId}constructor(t,n,s,o){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(o.clientId,"_").concat(In(5,""))),fe(this,"_userId",void 0),fe(this,"_uintId",void 0),fe(this,"_isDestroyed",!1),fe(this,"store",void 0),fe(this,"processor",void 0),fe(this,"processorContext",void 0),this._userId=n,this._uintId=s,this.store=o}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,k.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let VE=(mW=gt({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),gW=gt({argsMap:e=>[e.getTrackId()]}),_W=gt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),EW=gt({argsMap:e=>[e.getTrackId()]}),an((Qo=class extends bW{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==hs.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,s,o){super(e,t,n,s),fe(this,"_videoVisibleTimer",null),fe(this,"_previousVideoVisibleStatus",void 0),fe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),fe(this,"trackMediaType",xE.VIDEO),fe(this,"_videoWidth",void 0),fe(this,"_videoHeight",void 0),fe(this,"_player",void 0),fe(this,"_prePlayer",void 0),fe(this,"processorDestination",void 0),fe(this,"processorContext",void 0),this._prePlayer=o,this.updateMediaStreamTrackResolution(),this.processorContext=new U5(this.getTrackId(),"remote"),this.processorDestination=new M5(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return _p(()=>{k.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),qa(this,nt.GET_STATS)||qn({},C5)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit($o.PLAY_START),typeof e=="string"){let s=document.getElementById(e);s?e=s:(k.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}k.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));let n=qn(qn({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(n);else{let s=!1,o=!1;e instanceof HTMLVideoElement?(this._player=new Vk(n),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,o=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,s=this._player.videoState>0,this._player.updateConfig(n)):this._player=new Db(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit($o.FIRST_FRAME_DECODED),o&&this.safeEmit($o.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=u=>{this.safeEmit($o.VIDEO_STATE_CHANGED,u)},s&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let s=this.getVideoElementVisibleStatus();this.safeEmit($o.VIDEO_ELEMENT_VISIBLE_STATUS,s)}catch{}},z("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit($o.PLAY_END)}stop(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(e),this._player=void 0,k.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){j5(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(OT)}_updatePlayerSource(){k.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;let n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),s={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n?.parentElement},{element:o,slot:u}=s;if(this.isPlaying&&o instanceof HTMLVideoElement&&u instanceof HTMLElement){let d=F4.checkOneElementVisible(o),f=Object.assign({},d);if(f.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=f.visible;let g=tt.reportApiInvoke(null,{tag:Fn.TRACER,name:or.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});f.visible?g.onSuccess("Video is visible"):g.onSuccess("Invisible because of ".concat(f.reason))}return f}return}catch(n){throw new _e(Y.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new _e(Y.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(zs.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(zs.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Vm.SEI_RECEIVED,e)}}).prototype,"play",[mW],Object.getOwnPropertyDescriptor(Qo.prototype,"play"),Qo.prototype),an(Qo.prototype,"stop",[gW],Object.getOwnPropertyDescriptor(Qo.prototype,"stop"),Qo.prototype),an(Qo.prototype,"pipe",[_W],Object.getOwnPropertyDescriptor(Qo.prototype,"pipe"),Qo.prototype),an(Qo.prototype,"unpipe",[EW],Object.getOwnPropertyDescriptor(Qo.prototype,"unpipe"),Qo.prototype),Qo),FE=(yW=gt({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),vW=gt({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),SW=gt({argsMap:(e,t)=>[e.getTrackId(),t]}),TW=gt({argsMap:e=>[e.getTrackId()]}),wW=gt({argsMap:e=>[e.getTrackId()]}),CW=gt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),RW=gt({argsMap:e=>[e.getTrackId()]}),an((is=class extends bW{get isPlaying(){return this._useAudioElement?Ps.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,s){super(e,t,n,s),fe(this,"trackMediaType",xE.AUDIO),fe(this,"_source",void 0),fe(this,"_useAudioElement",!0),fe(this,"_volume",100),fe(this,"processorContext",void 0),fe(this,"processorDestination",void 0),fe(this,"_played",!1),fe(this,"_bypassWebAudio",!1),z("DISABLE_WEBAUDIO")?(this._source=new Mk,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new Dk(e,!0),z("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(mo.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit($o.FIRST_FRAME_DECODED)}),this.processorContext=new F5(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new V5(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(mo.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(mo.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(mo.ON_AUDIO_BUFFER),this._source.on(mo.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?Ps.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}setAmplifiedVolume(e){this._useAudioElement&&this._played&&(Ps.stop(this.getTrackId()),this._source.play()),this._useAudioElement=!1,e=Math.min(e,z("MAX_WEBAUDIO_VOLUME")),this._volume=e,this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!_5())throw new _e(Y.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ps.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getVolume(){return this._useAudioElement?Ps.getVolume(this.getTrackId()):this._source instanceof Dk?this._source.getAudioVolume():0}getStats(){return _p(()=>{k.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),qa(this,nt.GET_STATS)||qn({},w5)}play(){k.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(k.debug("[".concat(this.getTrackId(),"] use audio element to play")),Ps.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):(k.debug("[".concat(this.getTrackId(),"] use audio context to play")),this._source.play())}stop(){k.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Ps.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];k.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ps.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new _e(Y.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new _e(Y.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new _e(Y.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(zs.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(zs.ON_NODE,e=>{this._source.processedNode=e;let t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(zs.ON_TRACK),this.processorDestination.removeAllListeners(zs.ON_NODE)}}).prototype,"setVolume",[yW],Object.getOwnPropertyDescriptor(is.prototype,"setVolume"),is.prototype),an(is.prototype,"setAmplifiedVolume",[vW],Object.getOwnPropertyDescriptor(is.prototype,"setAmplifiedVolume"),is.prototype),an(is.prototype,"setPlaybackDevice",[SW],Object.getOwnPropertyDescriptor(is.prototype,"setPlaybackDevice"),is.prototype),an(is.prototype,"play",[TW],Object.getOwnPropertyDescriptor(is.prototype,"play"),is.prototype),an(is.prototype,"stop",[wW],Object.getOwnPropertyDescriptor(is.prototype,"stop"),is.prototype),an(is.prototype,"pipe",[CW],Object.getOwnPropertyDescriptor(is.prototype,"pipe"),is.prototype),an(is.prototype,"unpipe",[RW],Object.getOwnPropertyDescriptor(is.prototype,"unpipe"),is.prototype),is),Xa=new class extends dr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),fe(this,"_lastHiddenTime",0),fe(this,"_lastVisibleTime",0),fe(this,"needUploadStats",[]),fe(this,"isCollectingStats",!1),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),this.isCollectingStats&&this.needUploadStats.push(document.visibilityState==="visible"?1:0),k.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}startCollectStats(){this.isCollectingStats=!0,this.needUploadStats.push(this.visibility==="visible"?1:0)}stopCollectStats(){this.isCollectingStats=!1,this.needUploadStats.length=0}};class IW extends dr{constructor(t,n){super(),fe(this,"trackMediaType",xE.DATA),fe(this,"_version",1),fe(this,"_type",3),fe(this,"_config",void 0),fe(this,"_originDataChannel",void 0),fe(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),fe(this,"_dataStreamPacketHandler",{serialize:s=>s,deserialize:s=>s}),fe(this,"_datachannelEventMap",new Map),this._config=t,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return z("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new We((t,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();let s=setTimeout(()=>{var o;n(new _e(Y.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((o=this._originDataChannel)===null||o===void 0?void 0:o.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(s),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(s),new _e(Y.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new _e(Y.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){let t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[Nb.OPEN,Nb.CLOSE,Nb.ERROR].forEach(n=>{let s=()=>{this.emit(n)};this._datachannelEventMap.set(n,s),t.addEventListener(n,s)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[s,o]=n;t.removeEventListener(s,o)}),this._datachannelEventMap.clear()}}class pde extends IW{constructor(t){super(t),fe(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);let s=n.data.slice(0,this._dataStreamPacketHeader.byteLength),o=new DataView(s).getUint8(3);if(o!==this.id)return void(z("SHOW_DATASTREAM2_LOG")&&k.debug("invalid datachannel id: ".concat(o," !== ").concat(this.id)));let u=n.data.slice(this._dataStreamPacketHeader.byteLength);u=this._dataStreamPacketHandler.deserialize(u),this.emit(Nb.MESSAGE,u)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class fde extends IW{send(t){if(this._originDataChannel){let n=t;n=this._dataStreamPacketHandler.serialize(t);let s=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);s.set(new Uint8Array(this._dataStreamPacketHeader),0),s.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(s.buffer)}}}function Lb(){let e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcixuPVtdLHI9W107bGV0IGg9bnVsbDtlLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9dD0+e3QuZGF0YS5zZWkmJm4ucHVzaCh0LmRhdGEuc2VpKSx0LmRhdGEubWV0YWRhdGEmJnIucHVzaCh0LmRhdGEubWV0YWRhdGEpfSxzZWxmLnBvc3RNZXNzYWdlKCJzdGFydGVkIik7Y29uc3QgcD1lLnJlYWRhYmxlLmdldFJlYWRlcigpLFU9ZS53cml0YWJsZS5nZXRXcml0ZXIoKTsic2VpLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KG4udmFsdWUuZGF0YSkpLHI9YShuLnZhbHVlLHQpO2lmKHImJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtzZWk6cn0pLCFoKXtjb25zdCB0PW4udmFsdWUuZ2V0TWV0YWRhdGEoKXx8e307aD17dHlwZTpuLnZhbHVlLnR5cGUscnRwVGltZXN0YW1wOm4udmFsdWUudGltZXN0YW1wLHBheWxvYWRUeXBlOnQucGF5bG9hZFR5cGV8fDAsc3NyYzp0LnN5bmNocm9uaXphdGlvblNvdXJjZXx8MCxsZW5ndGg6bi52YWx1ZS5kYXRhLmJ5dGVMZW5ndGgsLi4uIm1pbWVUeXBlImluIHQ/e21pbWVUeXBlOnQubWltZVR5cGV9Ont9fSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7Zmlyc3RGcmFtZUluZm86aH0pfX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToic2VpLXR4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigoYT0+e2lmKCFhLmRvbmUpe2lmKGEudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KGEudmFsdWUuZGF0YSkpLGU9bi5zaGlmdCgpO2lmKGUpe2NvbnN0IG49byhhLnZhbHVlLmRhdGEsZSx0KTtuJiYoYS52YWx1ZS5kYXRhPW4pfX1VLndyaXRlKGEudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtwLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PW5ldyBEYXRhVmlldyhuLnZhbHVlLmRhdGEpLGE9dC5nZXRVaW50OCgwKTtsZXQgcjtpZigwIT0oMTI4JmEpJiY3MSE9PWEpe2NvbnN0IGU9ZnVuY3Rpb24odCl7aWYodC5ieXRlTGVuZ3RoPD0wKXJldHVybltdO2NvbnN0IGU9W107bGV0IG49MDtmb3IoO248dC5ieXRlTGVuZ3RoOyl7Y29uc3QgYT0oMTI4JnQuZ2V0VWludDgobikpPj43LHI9MTI3JnQuZ2V0VWludDgobik7aWYoIShhJiZuKzQ8PXQuYnl0ZUxlbmd0aCkpe24rKzticmVha317Y29uc3QgYT10LmdldFVpbnQzMihuLCExKSxvPSgxNjc3NjE5MiZhKT4+MTAsaT0xMDIzJmE7ZS5wdXNoKHtwdDpyLHRzX29mZnNldDpvLGxlbmd0aDppLGRhdGE6bmV3IFVpbnQ4QXJyYXl9KSxuKz00fX1sZXQgYT10LmJ5dGVMZW5ndGgtbjtmb3IoY29uc3QgciBvZiBlKXtpZihyLmxlbmd0aD5hKXJldHVybiBjb25zb2xlLndhcm4oIkJyb2tlbiByZWQgcGF5bG9hZCIpLFtdO3IubGVuZ3RoPjAmJihyLmRhdGE9bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sci5sZW5ndGgpLG4rPXIubGVuZ3RoLGEtPXIubGVuZ3RoKX1pZihhPjApe2NvbnN0IHI9e3B0OmUubGVuZ3RoPjA/ZVtlLmxlbmd0aC0xXS5wdDowLHRzX29mZnNldDowLGxlbmd0aDphLGRhdGE6bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sYSl9O2UucHVzaChyKX1yZXR1cm4gZX0odCk7aWYoZS5sZW5ndGg+MCl7Y29uc3QgdD1mdW5jdGlvbih0KXtsZXQgZT0wO2ZvcihsZXQgbj0wO248dC5sZW5ndGg7bisrKWUrPW48dC5sZW5ndGgtMT80OjEsZSs9dFtuXS5sZW5ndGg7Y29uc3Qgbj1uZXcgVWludDhBcnJheShlKTtsZXQgYT0wO2ZvcihsZXQgZT0wO2U8dC5sZW5ndGg7ZSsrKWlmKGU8dC5sZW5ndGgtMSl7Y29uc3Qgcj0oMjE0NzQ4MzY0OHwoMTI3JnRbZV0ucHQpPDwyNHwoMjYyMTQzJnRbZV0udHNfb2Zmc2V0KTw8MTB8MTAyMyZ0W2VdLmxlbmd0aCk+Pj4wO25bYSsrXT1yPj4yNCYyNTUsblthKytdPXI+PjE2JjI1NSxuW2ErK109cj4+OCYyNTUsblthKytdPTI1NSZyfWVsc2UgblthKytdPTEyNyZ0W2VdLnB0O2Zvcihjb25zdCBlIG9mIHQpbi5zZXQoZS5kYXRhLGEpLGErPWUubGVuZ3RoO3JldHVybiBufShlLm1hcCgodD0+e2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>xR.revokeObjectURL(e),0),new Worker(xR.createObjectURL(e))}let AW=71,jk=1,Bk=2,Wk=1,OW=2;var yp=(function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e})(yp||{});function Gk(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],n=e.getUint8(0);if(n!==AW)return;let s=e.getUint16(1),o=jk+Bk+s,u=new Uint8Array(e.byteLength-o);u.set(new Uint8Array(e.buffer,o,e.byteLength-o));let d={m:n,tlvLen:s,tlv:[],frame:u},f=jk+Bk;for(;f<o;){let g=e.getUint8(f),y=e.getUint16(f+Wk),v=Wk+OW;if(g===yp.AUDIO_LEVEL){let R=e.getUint8(f+v);for(let b=1;b<y;b++)R=R<<8|e.getUint8(f+v+b);d.tlv.push({tag:g,length:y,value:t?127^R>>1:127&R})}else if(g===yp.METADATA||g===yp.AUDIO_64_BIT_PTS){let R=new Uint8Array(y);for(let b=0;b<y;b++)R[b]=e.getUint8(f+v+b);d.tlv.push({tag:g,length:y,value:R})}f+=v+y}return d}let Mb=new Map,Ub=127,Bm=1e-10,Hk=139/13,Vb=new Map;function zk(e,t,n){let s="".concat(e,"-").concat(t,"-").concat(n),o=0;return Vb.has(s)?o=Vb.get(s):(o=Math.log((function(u,d){let f=u-d;d<f&&(d=f);let g=1;for(let y=u,v=1;y>d;y--,v++)g=g*y/v;return g})(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(n)+n*e,Vb.set(s,o)),o<Bm&&(o=Bm),o}function NW(e,t,n){let s=t.length,o=e.length/s,u=!1;for(let d=0,f=0;d<s;d++){let g=0;for(let y=f+o;f<y;f++)e[f]>n&&g++;t[d]!==g&&(t[d]=g,u=!0)}return u}window.cache=Vb;let mde=0;class PW{constructor(t){fe(this,"id",void 0),fe(this,"immediates",[]),fe(this,"lastNonSilence",-1),fe(this,"immediateSpeechActivityScore",Bm),fe(this,"lastLevelChangedTime",Date.now()),fe(this,"levels",[]),fe(this,"longs",[]),fe(this,"longSpeechActivityScore",Bm),fe(this,"mediums",[]),fe(this,"mediumSpeechActivityScore",Bm),fe(this,"minLevel",0),fe(this,"nextMinLevel",0),fe(this,"nextMinLevelWindowLength",0),fe(this,"energyScore",0),this.id=t||"".concat(mde++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){let t=this.immediates,n=this.levels,s=this.minLevel+Hk,o=!1;for(let u=0;u<t.length;++u){let d=n[u];d<s&&(d=0);let f=Math.floor(d/Hk);t[u]!==f&&(t[u]=f,o=!0)}return o}computeLongs(){return NW(this.mediums,this.longs,4)}computeMediums(){return NW(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=zk(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=zk(this.longs[0],10,47),this.longSpeechActivityScore>Bm&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=zk(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(Wf(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let s=t;return t<0&&(s=0),t>Ub&&(s=Ub),this.levels.unshift(s),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(s),s>=this.minLevel+Hk?s:s/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>Ub&&(n=Ub),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class gde{constructor(t){fe(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{let n=this.algorithm.runInDecisionMaker(this);n<=0?t=!0:setTimeout(this.execute.bind(this),n)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class Kk{constructor(t,n,s){fe(this,"isDominant",void 0),fe(this,"energyRanking",void 0),fe(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=n,this.energyScore=s}}class _de extends dr{constructor(t){super(),fe(this,"dominantId",null),fe(this,"lastDecisionTime",0),fe(this,"lastLevelChangedTime",0),fe(this,"lastLevelIdleTime",0),fe(this,"relativeSpeechActivities",[]),fe(this,"speakers",new Map),fe(this,"enableSilence",!1),fe(this,"timeoutToSilenceInterval",0),fe(this,"decisionMaker",null),fe(this,"loudest",[]),fe(this,"numLoudestToTrack",3),fe(this,"energyExpireTimeMs",250),fe(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,n!=null&&(this.energyExpireTimeMs=n),s!=null&&(this.energyAlphaPct=s),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(n=>n.id===t)}levelChanged(t,n){let s=Date.now(),o=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<s&&(this.lastLevelChangedTime=s,this.maybeStartDecisionMaker());let u=o.levelChanged(n,s);return this.updateLoudestList(o,u,s)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(t){t.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(t){let n=this.speakers.get(t);return n||(n=new PW(t),this.speakers.set(t,n),this.maybeStartDecisionMaker()),n}updateLoudestList(t,n,s){let o=t.id===this.dominantId;if(n<0){let g=0;for(;g<this.loudest.length&&this.loudest[g]!==t;)++g;return new Kk(o,g,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new Kk(o,0,t.energyScore);let u=s-this.energyExpireTimeMs,d=0;for(;d<this.loudest.length;){let g=this.loudest[d];if(g.getLastLevelChangedTime()<u&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(d,1);else if(g.id!==t.id)++d;else if(this.loudest.splice(d,1),this.loudest.length<this.numLoudestToTrack)break}let f=0;for(;f<this.loudest.length&&!(this.loudest[f].energyScore<t.energyScore);)++f;return f<this.numLoudestToTrack&&(this.loudest.splice(f,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new Kk(o,f,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new gde(this),this.decisionMaker.execute())}makeDecision(t){let n=null,s=null,o=this.speakers.size,u=null;if(o===0)u=null;else if(o===1){var d;let f=za(d=this.speakers).call(d).next().value;this.enableSilence&&f&&(u=f.id,f.evaluateSpeechActivityScores(t),t-f.lastNonSilence>this.timeoutToSilenceInterval&&(u=null))}else{let f=this.dominantId==null?null:this.speakers.get(this.dominantId);if(f==null){let v=this.speakers.entries().next();v.value&&(u=v.value[0],f=v.value[1])}else u=f.id;f?.evaluateSpeechActivityScores(t);let g=this.relativeSpeechActivities,y=2;for(let v of this.speakers.entries()){let[R,b]=v;if(b===f)continue;b.evaluateSpeechActivityScores(t);for(let j=0;j<g.length;++j){let K=f==null?Bm:f.getSpeechActivityScore(j);g[j]=Math.log(b.getSpeechActivityScore(j)/K)}let A=g[0],F=g[1],M=g[2];A>3&&F>2&&M>0&&F>y&&(y=F,u=R)}this.enableSilence&&f!=null&&u===f.id&&t-f.lastNonSilence>this.timeoutToSilenceInterval&&(u=null)}u==null&&!this.enableSilence||u===this.dominantId||(n=this.dominantId,this.dominantId=u,s=this.dominantId),s==null&&!this.enableSilence||s===n||this.emit("ActiveSpeakerChanged",s)}_runInDecisionMaker(){let t=Date.now(),n=300-(t-this.lastLevelIdleTime),s=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):s=n;let o=300-(t-this.lastDecisionTime);return o<=0&&(this.lastDecisionTime=t,this.makeDecision(t),o=300-(Date.now()-t)),o>0&&s>o&&(s=o),s}timeoutIdleLevels(t){let n=[];for(let o of za(s=this.speakers).call(s)){var s;let u=t-o.getLastLevelChangedTime();36e5<u&&(this.dominantId==null||o.id!==this.dominantId)?n.push(o.id):300<u&&o.levelTimedOut()}n.forEach(o=>this.speakers.delete(o))}}let jE=new Map,Wl=null,Fb=null,kW=3,Wm=[],Gl=new Map,jb=new Map;class Ede{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,n){fe(this,"id",void 0),fe(this,"track",void 0),fe(this,"score",0),fe(this,"active",!0),fe(this,"muted",!1),fe(this,"timer",0),fe(this,"actives",0),fe(this,"inactives",0),this.id=t,this.track=n,this.setActive(Gl.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){let t=this.active;this.active=this.activeRate>=.8;let{actives:n,inactives:s}=(function(){let o=[],u=[];return Array.from(za(Gl).call(Gl)).forEach(d=>{d.active?o.push(d):u.push(d)}),{actives:o,inactives:u}})();if(n.length>3){let o;n.forEach(u=>{(!o||o.score>u.score)&&(o=u)}),o&&o.setActive(!1)}if(n.length<3&&s.length>0){let o;s.forEach(u=>{(!o||o.score<u.score)&&u.id!==this.id&&(o=u)}),o&&t&&!this.active&&(o.samples>40&&o.activeRate-this.activeRate>.4?o.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){let t=(function(n){let s;return Array.from(za(Gl).call(Gl)).forEach(o=>{!o.active||o.id===n||o.samples<40||(!s||o.score<s.score)&&(s=o)}),s})(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){let t=(function(n){let s;return Array.from(za(Gl).call(Gl)).forEach(o=>{o.active||o.id===n||o.samples<40||(!s||o.score>s.score)&&(s=o)}),s})(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let Bb;function DW(e){let t=Gl.get(e);t&&(Gl.delete(e),t.clearTimer())}let Wb=new Map,yde=new Map,Yk="video/h264",qk="video/h265";function xW(e,t,n){let s=new Uint8Array(e,t,n),o=[],u=0;for(;o.length<n;)u+3<n&&s[u]===0&&s[u+1]===0&&s[u+2]===3&&(s[u+3]===0||s[u+3]===1||s[u+3]===2||s[u+3]===3)?(o.push(s[u],s[u+1],s[u+3]),u+=4):(o.push(s[u]),u++);return new Uint8Array(o)}function LW(e){let t=e.length,n=[],s=0;for(;s<t;)s+2<t&&e[s]===0&&e[s+1]===0&&(e[s+2]===0||e[s+2]===1||e[s+2]===2||e[s+2]===3)?(n.push(e[s],e[s+1],3,e[s+2]),s+=3):(n.push(e[s]),s++);return new Uint8Array(n)}function MW(e){if(e.length<5)return"";let t=-1;for(let o=0;o<e.length-3;o++){if(e[o]===0&&e[o+1]===0&&e[o+2]===1){t=o;break}if(o<e.length-4&&e[o]===0&&e[o+1]===0&&e[o+2]===0&&e[o+3]===1){t=o;break}}if(t===-1)return"";let n=t+(e[t+2]===0?4:3);if(n>=e.length)return"";let s=e[n];return 128&s?"":(s>>1&63)>=32||n+1<e.length&&!(248&e[n+1])?qk:(31&s)<=31?Yk:""}let Gb=new Map,MT=new Map;(function(){let e=pn();Ri.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Ri.getStreamFromExtension=e.name===_n.CHROME&&Number(e.version)>34,Ri.supportUnifiedPlan=(function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let t=new RTCPeerConnection,n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n})(),Ri.supportMinBitrate=e.name===_n.CHROME||e.name===_n.EDGE,Ri.supportSetRtpSenderParameters=(function(){let t=pn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!qu()||!(!Pi()&&!gb())||t.name===_n.FIREFOX&&Number(t.version)>=64)})(),e.name===_n.SAFARI&&(Number(e.version)>=14?Ri.supportDualStream=!0:Ri.supportDualStream=!1),Ri.webAudioMediaStreamDest=(function(){let t=pn();return!(t.name===_n.SAFARI&&Number(t.version)<12)})(),Ri.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Ri.supportWebGL=typeof WebGLRenderingContext<"u",Ri.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,qu()||(Ri.webAudioWithAEC=!0),Ri.supportShareAudio=(function(){let t=pn();return(t.os===wi.WIN_10||t.os===wi.WIN_81||t.os===wi.WIN_7||t.os===wi.LINUX||t.os===wi.MAC_OS||t.os===wi.CHROMIUM_OS)&&t.name===_n.CHROME&&Number(t.version)>=74})(),Ri.supportDataChannel=!!(jl(76)||Q1(68)||I4(14)),Ri.supportPCSetConfiguration=(function(){let t=window.RTCPeerConnection;return!$n()&&!!t&&t.prototype.setConfiguration instanceof Function})(),Ri.supportWebRTCEncodedTransform=jl(87)||C4()||Q1(117),Ri.supportWebRTCInsertableStream=(function(){let t=pn();return(t.name===_n.CHROME||t.name===_n.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window})(),Ri.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Ri.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,Ri.supportSuppressLocalAudioPlayback=v5(),Ri.supportRestrictOwnAudio=S5(),Eb(()=>{Ri.supportDualStreamEncoding=(function(){let t=pn();return!!z("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&z("CHROME_DUAL_STREAM_USE_ENCODING"))})(),k.debug("browser ua: ",navigator.userAgent),k.info("browser info: ",e),k.info("browser compatibility: ",Ri)})})();let vde=["CHINA","GLOBAL"],UW=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Gm=[],BE=[];function Hm(e,t){return!!t&&Gm.some(n=>n.uid===e&&n.channelName===t)}function Xk(){return BE.length>0}var Sde=H3.forEach,VW=Mf("forEach")?[].forEach:function(e){return Sde(this,e,arguments.length>1?arguments[1]:void 0)};Sn({target:"Array",proto:!0,forced:[].forEach!==VW},{forEach:VW});var Tde=Sa("Array","forEach"),wde=_l,Cde=Ur,Rde=N,bde=Tde,Jk=Array.prototype,Ide={DOMTokenList:!0,NodeList:!0},Ade=function(e){var t=e.forEach;return e===Jk||Rde(Jk,e)&&t===Jk.forEach||Cde(Ide,wde(e))?bde:t},Ode=l(Ade),Nde=Zi,FW=ra;Sn({target:"Object",stat:!0,forced:h(function(){FW(1)})},{keys:function(e){return FW(Nde(e))}});var Pde=l(fi.Object.keys),kde=l(Qr),Dde=l(Bf),xde=Sn,jW=El,Lde=es,Mde=Wr,BW=Dv,Ude=Cu,Vde=yi,Fde=AP,jde=Er,Bde=Bi,Wde=L3("slice"),Gde=jde("species"),$k=Array,Hde=Math.max;xde({target:"Array",proto:!0,forced:!Wde},{slice:function(e,t){var n,s,o,u=Vde(this),d=Ude(u),f=BW(e,d),g=BW(t===void 0?d:t,d);if(jW(u)&&(n=u.constructor,(Lde(n)&&(n===$k||jW(n.prototype))||Mde(n)&&(n=n[Gde])===null)&&(n=void 0),n===$k||n===void 0))return Bde(u,f,g);for(s=new(n===void 0?$k:n)(Hde(g-f,0)),o=0;f<g;f++,o++)f in u&&Fde(s,o,u[f]);return s.length=o,s}});var zde=Sa("Array","slice"),Kde=N,Yde=zde,Qk=Array.prototype,qde=function(e){var t=e.slice;return e===Qk||Kde(Qk,e)&&t===Qk.slice?Yde:t},Xde=l(qde);function ze(e,t,n,s,o){var u,d,f,g={};return Ode(u=Pde(s)).call(u,function(y){g[y]=s[y]}),g.enumerable=!!g.enumerable,g.configurable=!!g.configurable,("value"in g||g.initializer)&&(g.writable=!0),g=kde(d=Dde(f=Xde(n).call(n)).call(f)).call(d,function(y,v){return v(e,t,y)||y},g),o&&g.initializer!==void 0&&(g.value=g.initializer?g.initializer.call(o):void 0,g.initializer=void 0),g.initializer===void 0?(P3(e,t,g),null):g}let Hb=(function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e})({}),Zk=(function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e})({}),Zo=(function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e[e.REQ_DOWNGRADE_FALLBACK=27]="REQ_DOWNGRADE_FALLBACK",e})({}),Ks=(function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e})({}),pt=(function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.K_VOS_FALLBACK=30]="K_VOS_FALLBACK",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e})({}),nn=(function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e})({}),rt=(function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e.VOS_FALLBACK="vos_fallback",e.VOS_FALLBACK_PROMISE="vos_fallback_promise",e})({}),ct=(function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SET_DUAL_STREAM_MODE="set_dual_stream_mode",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.CONFIGURE="configure",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e})({}),zm=(function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e})({}),wt=(function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e.ENABLE_MULTI_STREAM="enable_multi_stream",e})({}),Ys=(function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e})({}),Ot=(function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e.ON_FALLBACK="websocket:on_fallback",e})({});function zb(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw k.error("Invalid Channel Name ".concat(e)),new he(Y.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Kb(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||M4(e,1,255)))throw new he(Y.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&k.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let th=(function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e})({}),Jde={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},eD={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function tD(e,t){Hi(e.url,"".concat(t,".url"),1,1e3,!1),wr(e.x)||Vn(e.x,"".concat(t,".x"),0,1e4),wr(e.y)||Vn(e.y,"".concat(t,".y"),0,1e4),wr(e.width)||Vn(e.width,"".concat(t,".width"),0,1e4),wr(e.height)||Vn(e.height,"".concat(t,".height"),0,1e4),wr(e.zOrder)||Vn(e.zOrder,"".concat(t,".zOrder"),0,255),wr(e.alpha)||Vn(e.alpha,"".concat(t,".alpha"),0,1,!1)}let $de={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},vp=(function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e})({}),nD=(function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e})({}),ci=(function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e})({});function WW(e){if(!e.channelName)throw new he(Y.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new he(Y.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Hi(e.token,"info.token",1,2047),Kb(e.uid),zb(e.channelName),!0}let ua=(function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e})({}),nh=(function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e})({}),Ia=(function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e})({}),WE=(function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e})({}),On=(function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e})({}),Vr=(function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e.VOS_FALLBACK="vos-fallback",e.VOS_FALLBACK_PROMISE="vos-fallback-promise",e.RESET_SIGNAL="reset-signal",e.DATACHANNEL_FAILBACK="datachannel-failback",e})({}),Yb=(function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e})({}),bi=(function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e})({}),yn=(function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e})({}),GW=[yn.AFRICA,yn.ASIA,yn.CHINA,yn.EUROPE,yn.GLOBAL,yn.INDIA,yn.JAPAN,yn.NORTH_AMERICA,yn.OCEANIA,yn.OVERSEA,yn.SOUTH_AMERICA],ps=(function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e})({}),qb={CHINA:{},ASIA:{CODE:ps.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:ps.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:ps.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:ps.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:ps.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:ps.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:ps.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:ps.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:ps.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:ps.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:ps.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:ps.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:ps.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};Ek&&(qb.CHINA={CODE:ps.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Hl=(function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e.UPDATE_REMOTE_VIDEO_STREAM_TYPE="update_remote_video_stream_type",e.FALLBACK_TO_HLS="fallback_to_hls",e.UPDATE_VOS_CONFIGURE="update_vos_configure",e})({});function HW(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class zW extends dr{constructor(t,n){super(),V(this,"onICEConnectionStateChange",void 0),V(this,"onConnectionStateChange",void 0),V(this,"onDTLSTransportStateChange",void 0),V(this,"onDTLSTransportError",void 0),V(this,"onICETransportStateChange",void 0),V(this,"onFirstAudioReceived",void 0),V(this,"onFirstVideoReceived",void 0),V(this,"onFirstAudioDecoded",void 0),V(this,"onFirstVideoDecoded",void 0),V(this,"onFirstVideoRender",void 0),V(this,"onFirstVideoBufferReady",void 0),V(this,"onFirstVideoDecodedTimeout",void 0),V(this,"onSelectedLocalCandidateChanged",void 0),V(this,"onSelectedRemoteCandidateChanged",void 0),V(this,"onICECandidateError",void 0),V(this,"getLocalVideoStats",void 0)}}class Xb extends zW{constructor(t,n){super(t,n),V(this,"establishPromise",void 0)}}let et=(function(e){return e.VIDEO="video",e.AUDIO="audio",e})({}),Di=(function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e})({}),rh=(function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e})({}),KW=["disconnected","failed"],De=(function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e})({}),Tn=(function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e})({}),dt=(function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e.FirstVideoPreRender="FirstVideoPreRender",e.FirstVideoBufferReady="FirstVideoBufferReady",e})({}),Kc=(function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e})({}),Yc=(function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e})({}),xi=(function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e})({}),Sp=(function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e})({}),li=(function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e})({}),Qu=(function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e})({}),ec=(function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e})({}),zl=(function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e})({}),GE=(function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e})({}),Fr=(function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e})({}),HE=(function(e){return e.ABORT="abort",e})({}),Tp=(function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e})({}),Qde=(function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e})({}),Zde={[Hb.ACCESS_POINT]:{[Ks.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Ks.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Ks.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Ks.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Ks.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Ks.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Ks.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Ks.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Ks.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Ks.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Ks.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Ks.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Ks.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Ks.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Ks.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Ks.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Ks.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Ks.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Hb.UNILBS]:{[Zo.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Zo.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Zo.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Zo.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Zo.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Zo.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Zo.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Zo.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Zo.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Zo.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Zo.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Zo.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1},[Zo.REQ_DOWNGRADE_FALLBACK]:{desc:"request downgrade fallback",retry:!1}},[Hb.STRING_UID_ALLOCATOR]:{[Zk.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Zk.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Zk.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function zE(e){let t=Zde[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};let n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===Hb.ACCESS_POINT){let s=e%1e4;if(s.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(s.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}let ehe={[pt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[pt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[pt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[pt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[pt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[pt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[pt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[pt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[pt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[pt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[pt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[pt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[pt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[pt.K_VOS_FALLBACK]:{desc:"K_VOS_FALLBACK",action:"tryNext"},[pt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[pt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[pt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[pt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[pt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[pt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[pt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[pt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[pt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[pt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[pt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[pt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[pt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[pt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[pt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[pt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[pt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[pt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[pt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[pt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[pt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[pt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[pt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[pt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[pt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[pt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[pt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[pt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[pt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[pt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[pt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[pt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[pt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[pt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[pt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[pt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[pt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[pt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[pt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[pt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[pt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[pt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[pt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[pt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[pt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[pt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[pt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[pt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[pt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[pt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[pt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Km(e){return ehe[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function YW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function rD(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?YW(Object(n),!0).forEach(function(s){V(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):YW(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function iD(e,t){if(typeof e=="string")return e;let{proxy:n,host:s,port:o}=e;if(t){let u=z("JOIN_GATEWAY_FALLBACK_PORT")||443;return u===443?"wss://".concat(s,"/ws/?p=").concat(Number(o)+150):"wss://".concat(s,":").concat(u,"/ws/?p=").concat(Number(o)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(s,"&p=").concat(o):"wss://".concat(s,":").concat(o)}let the=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,nhe=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,rhe=/wss:\/\/(.+):([0-9]+)\/?/,ihe=/wss:\/\/(.[^\/]+)\/?/,she=0;class ahe{constructor(t,n){V(this,"id",0),V(this,"store",void 0),V(this,"recordIndex",void 0),V(this,"websockets",[]),V(this,"try443PortDuration",2e3),V(this,"forceCloseWSDuration",5e3),V(this,"try443PortTimeout",null),V(this,"forceCloseTimeout",null),V(this,"isTry443PortFailed",!1),V(this,"isNormalPortFailed",!1),V(this,"useDoubleDomain",!1),V(this,"useProxy",!1),V(this,"startTime",Date.now()),this.id=++she,this.try443PortDuration=z("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;let n=Date.now()-this.startTime;for(var s=arguments.length,o=new Array(s),u=0;u<s;u++)o[u]=arguments[u];k.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...o)}createWebSocket(t,n,s){this.logger("createWebSocket:",t,{isTry443Port:n,hasTimeoutDetection:s});let o=z("GATEWAY_DOMAINS"),u=Date.now(),d=[],f=o.find(b=>{var A;return ke(A=t.host).call(A,b)});f||(this.useDoubleDomain=!1);let g=[];if(this.useDoubleDomain)o.forEach(b=>{g.push(iD(rD(rD({},t),{},{host:t.host.replace(f,b)}),n))});else{let b=rD({},t);if(n&&f){let A=o.find(F=>F!==f);A&&(b.host=b.host.replace(f,A))}g.push(iD(b,n))}try{g.forEach(b=>{let A=new WebSocket(b);A.binaryType="arraybuffer",d.push(A),this.logger("ws is connecting:",A.url)})}catch(b){if(this.logger("ws create failed"),d.forEach(A=>A.close()),d.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,n,s);if(!n&&Number(t.port)!==443)return this.createWebSocket(t,!0,s);throw new he(Y.WS_ERR,"init websocket failed! Error: ".concat(b.toString()))}let y=CT();this.store&&this.store.recordJoinChannelService({urls:d.map(b=>b.url),service:"gateway"},this.recordIndex),d.forEach(b=>{b.onopen=()=>{this.logger("onopen: ws ".concat(b.url," open cost ").concat(Date.now()-u,"ms")),this.websockets.forEach(A=>{A!==b&&(A.onopen=null,A.onclose=null,A.onmessage=null,A.close(),this.logger("close backup websocket: ".concat(A.url)))}),this.websockets.length=0,y.resolve(b)},b.onclose=A=>{this.logger("onclose: ws ".concat(b.url," closed cost ").concat(Date.now()-u,"ms state: ").concat(b.readyState));let F=d.every(M=>M.readyState===WebSocket.CLOSED||M.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(F)),F&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(A.reason)),y.reject({code:A.code,reason:Yb.A_ROUND_WS_FAILED})):!n&&F&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),R()),n?this.isTry443PortFailed=F:this.isNormalPortFailed=F},b.onmessage=A=>this.logger("".concat(b.url," onmessage: ").concat(A.data))}),this.websockets.push(...d);let v=()=>{this.websockets.forEach(b=>b.readyState!==WebSocket.OPEN&&b.close())},R=()=>{if(y.isResolved)return v();pn().os===wi.MAC_OS&&$n()&&v(),this.createWebSocket(t,!0,!0).then(b=>{y.resolve(b)}).catch(b=>{this.isNormalPortFailed&&y.reject(b),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",y.isResolved),this.forceCloseTimeout=null,v()},this.forceCloseWSDuration)};return s||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,v()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",y.isResolved),this.try443PortTimeout=null,R()},this.try443PortDuration)})(),y.promise}chooseBestWebsocket(t,n,s,o){return this.useDoubleDomain=!!n,typeof t=="string"&&(t=(function(u){let d,f,g;return[,d,f,g]=u.match(the)||[],d||([,f,g]=u.match(nhe)||[]),f&&g||([,f,g]=u.match(rhe)||[]),f&&g||([,f]=u.match(ihe)||[]),f||k.warning("un-destructible url: ",u),{proxy:d,host:f,port:g||"443"}})(t)),this.recordIndex=o,this.useProxy=!!t.proxy,s&&this.useProxy&&(k.warn("cannot use 443 only when use proxy"),s=!1),this.createWebSocket(t,!!s,!1).finally(()=>this.clearTimeout())}}function qW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}class XW extends dr{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;ke(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Ot.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Ot.CONNECTED):this._state==="closed"?this.emit(Ot.CLOSED):this._state==="failed"&&this.emit(Ot.FAILED))}resetReconnectCount(t){k.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2],o=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4&&arguments[4]!==void 0&&arguments[4],d=arguments.length>5?arguments[5]:void 0;super(),V(this,"_websocketUrl",null),V(this,"connectionID",0),V(this,"currentURLIndex",0),V(this,"urls",[]),V(this,"_reconnectMode","tryNext"),V(this,"reconnectReason",void 0),V(this,"_initMutex",void 0),V(this,"name",void 0),V(this,"_state","closed"),V(this,"reconnectInterrupter",void 0),V(this,"websocket",void 0),V(this,"retryConfig",void 0),V(this,"reconnectCount",0),V(this,"forceCloseTimeout",5e3),V(this,"onlineReconnectListener",void 0),V(this,"useCompress",void 0),V(this,"tryDoubleDomain",!1),V(this,"use443PortOnly",!1),V(this,"wsInflateLength",0),V(this,"wsDeflateLength",0),V(this,"closeEstablishingWs",()=>{}),V(this,"store",void 0),V(this,"joinGatewayRecordIndex",void 0),this.store=d,this.name=t,this.retryConfig=(function(R){for(var b=1;b<arguments.length;b++){var A=arguments[b]!=null?arguments[b]:{};b%2?qW(Object(A),!0).forEach(function(F){V(R,F,A[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(A)):qW(Object(A)).forEach(function(F){Object.defineProperty(R,F,Object.getOwnPropertyDescriptor(A,F))})}return R})({},n),this.useCompress=s,this.tryDoubleDomain=o,this.use443PortOnly=u,this._initMutex=new ki("websocket",d?d.clientId:void 0);let{timeout:f,timeoutFactor:g}=n,y=Math.max(300,Math.floor(3*f/5)),v=Math.max(1.2,Math.floor(8*g)/10);Gs.ONLINE&&(this.retryConfig.timeout=y,this.retryConfig.timeoutFactor=v),Cr.on(Nm.NETWORK_STATE_CHANGE,(R,b)=>{R!==b&&(this.resetReconnectCount("network state change: ".concat(b," -> ").concat(R)),R===Gs.ONLINE?(this.retryConfig.timeout=y,this.retryConfig.timeoutFactor=v):(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=g))})}getConnection(){return this.websocket||void 0}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,s=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=t,this.state="connecting";try{var o;let u=CT(),d=this.urls[this.currentURLIndex];(o=this.store)===null||o===void 0||o.beforeConnect(),(function(f){return!(Ib()||z("USE_NEW_TOKEN")||!z("ENABLE_PREALLOC_PC")&&(f==null||!f.autoSubscribe||z("FORCE_DISABLE_AUTO_SUB")))})(this.store)&&this.emit(li.PRE_CONNECT_PC),this.createWebSocketConnection(d).then(u.resolve).catch(u.reject),this.once(Ot.CLOSED,()=>{u.reject(new _e(Y.WS_DISCONNECT))}),this.once(Ot.CONNECTED,u.resolve),await u.promise}catch{}finally{s()}}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let s=this.websocket;n?setTimeout(()=>s.close(),500):s.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void k.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),k.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);let s=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),s&&s.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new _e(Y.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(s){throw new _e(Y.WS_ERR,"send websocket message error"+s.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){let t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var n;let s=CT();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;let o=v=>{var R;(R=this.store)===null||R===void 0||R.signalChannelOpen(),k.debug("[".concat(this.name,"] websocket opened:"),v),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),s.resolve()},u=async v=>{var R;if(k.debug("[".concat(this.name,"] websocket close ").concat((R=this.websocket)===null||R===void 0?void 0:R.url,", code: ").concat(v.code,", reason: ").concat(v.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)s.reject(new _e(Y.WS_DISCONNECT,"websocket close: ".concat(v.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=v.reason,this.state="reconnecting");let b=qa(this,Ot.WILL_RECONNECT,this.reconnectMode,v.reason)||this.reconnectMode,A=await this.reconnectWithAction(b);if(this.state==="closed")return void k.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!A)return s.reject(new _e(Y.WS_DISCONNECT,"websocket reconnect failed: ".concat(v.code))),this.close(!0);s.resolve()}},d=v=>{this.emit(Ot.ON_MESSAGE,v)},f=v=>{k.warn("[".concat(this.connectionID,"] ws open error ").concat(v))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),z("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=z("GATEWAY_WSS_ADDRESS")),k.debug("[".concat(this.name,"] start connect, url:"),t);let g=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var y;this._websocketUrl=iD(t);let v=await this.chooseBestWebsocketConnection(t);this.websocket=v,o&&o(this.websocket.url),this.websocket.onclose=u,this.websocket.onmessage=d,this.websocket.onerror=f,(y=this.store)===null||y===void 0||y.recordJoinChannelService({endTs:Date.now(),status:"success"},g),this.joinGatewayRecordIndex=g}catch(v){let R=this.state==="closed",b=v instanceof _e,A=b&&v.code===Y.WS_ABORT,F=b&&v.code===Y.WS_ERR,M=b?v.message:v&&(v.reason||v.toString());k.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(M)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:A?"aborted":"error",errors:[v]},g),R||F?(s.reject(R?new _e(Y.WS_DISCONNECT,"websocket is closed: ".concat(M)):new _e(Y.WS_ERR,"init websocket failed: ".concat(M))),F&&k.error("[".concat(this.name,"] init websocket failed: ").concat(M))):u&&u(v)}return s.promise}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;k.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Cr.isOnline||!Cr.onlineWaiter||(this.onlineReconnectListener=Cr.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let s=!0;if(this.reconnectInterrupter=()=>s=!1,n){let d=yb(this.reconnectCount,this.retryConfig);k.debug("[".concat(this.name,"] wait ").concat(d,"ms to reconnect websocket, mode: ").concat(t)),await We.race([Ci(d),this.onlineReconnectListener||new We(()=>{})])}if(this._state==="closed"||!s)return!1;this.reconnectCount+=1;let o=async(d,f)=>{this.emit(Ot.RECONNECT_CREATE_CONNECTION,f),await this.createWebSocketConnection(d)};try{if(t==="retry")await o(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);k.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await o(this.urls[this.currentURLIndex],t)}else t==="recover"&&(k.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await ei(this,Ot.REQUEST_NEW_URLS),this.currentURLIndex=0,await o(this.urls[this.currentURLIndex],t))}catch(d){var u;k.error("[".concat(this.name,"] reconnect failed ").concat(d&&d.toString()));let f=d==null||(u=d.data)===null||u===void 0?void 0:u.desc;if(Array.isArray(f)){if(ke(f).call(f,"dynamic key expired"))return this.emit(Ot.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1;if(ke(f).call(f,"request downgrade fallback"))return this.emit(Ot.ON_FALLBACK),!1}return this.reconnectWithAction(t,n)}return!0}}class sD extends XW{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){let s=CT(),o=(function(d,f){return new ahe(d,f)})(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{k.debug("[choose-best-ws] close establishing websockets"),o.closeAllWebsockets(),s.reject(new _e(Y.WS_ABORT,"choose best websocket aborted"))};let u=z("GATEWAY_DOMAINS");return k.debug("[choose-best-ws] currentDomain: ",t,", domains: ",u,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),o.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,n).then(s.resolve).catch(s.reject),s.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class UT extends XW{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){return new We((s,o)=>{let u=!1,d=[];this.closeEstablishingWs=()=>{k.debug("[choose-best-ws] close establishing websockets"),d.forEach(F=>{F.onclose=null,F.onopen=null,F.onmessage=null,F.close()}),o(new _e(Y.WS_ABORT,"choose best websocket aborted"))};let f=z("GATEWAY_DOMAINS"),g,y=t.indexOf("?h="),v=f.find(F=>y!==-1?ke(t).call(t,F,y):ke(t).call(t,F));k.debug("[choose-best-ws] currentDomain: ",v,", domains: ",f);let R=!this.tryDoubleDomain||!v;if(!R&&v){var b;let F=Date.now();try{f.forEach(M=>{let j=y===-1?t.replace(v,M):t.substr(0,y)+t.substr(y).replace(v,M),K=new WebSocket(j);K.binaryType="arraybuffer",d.push(K),k.debug("[choose-best-ws] ws is connecting:",K.url)})}catch{for(k.debug("[choose-best-ws] ws create failed, fallback to single url"),d.forEach(M=>M.close());d.length;)d.pop();R=!0}(b=this.store)===null||b===void 0||b.recordJoinChannelService({urls:d.map(M=>M.url),service:"gateway"},n),d.forEach(M=>{M.onopen=()=>{if(u)return;let j=Date.now()-F;k.debug("[choose-best-ws] ws open cost ".concat(j,"ms")),d.filter(K=>K!==M).forEach(K=>{k.debug("[choose-best-ws]close backup websocket: ".concat(K.url)),K.close()}),u=!0,s(M)},M.onclose=j=>{g=j,!u&&(d.find(K=>!(K.readyState===WebSocket.CLOSED||K.readyState===WebSocket.CLOSING))||(k.debug("[choose-best-ws] all websocket is closed"),u=!0,o(g)))},M.onmessage=j=>{k.debug("[choose-best-ws]".concat(M.url," onmessage: ").concat(j.data))}}),Ci(this.forceCloseTimeout).then(()=>{d.forEach(M=>{M.readyState!==WebSocket.OPEN&&M.close()})})}if(R){var A;let F;k.debug("[choose-best-ws] use single url: ",t),(A=this.store)===null||A===void 0||A.recordJoinChannelService({urls:[t],service:"gateway"},n);try{F=new WebSocket(t),d.push(F),F.binaryType="arraybuffer"}catch(M){let j=new _e(Y.WS_ERR,"init websocket failed! Error: ".concat(M.toString()));return k.error("[".concat(this.name,"]").concat(j)),void o(j)}F.onopen=()=>{s(F)},F.onclose=M=>{o(M)},F.onmessage=M=>{k.debug("[choose-best-ws]".concat(F.url," onmessage: ").concat(M.data))},Ci(this.forceCloseTimeout).then(()=>{F&&F.readyState!==WebSocket.OPEN&&F.close()})}}).then(s=>(this.closeEstablishingWs=void 0,s)).catch(s=>{throw this.closeEstablishingWs=void 0,s})}}class JW extends dr{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===nn.CONNECTED?this.emit(rt.WS_CONNECTED):t===nn.RECONNECTING?this.emit(rt.WS_RECONNECTING,this._websocketReconnectReason):t===nn.CLOSED&&this.emit(rt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),V(this,"__name__","AgoraRTCSignal"),V(this,"_disconnectedReason",void 0),V(this,"_websocketReconnectReason",void 0),V(this,"_connectionState",nn.CLOSED),V(this,"reconnectToken",void 0),V(this,"websocket",void 0),V(this,"openConnectionTime",void 0),V(this,"clientId",void 0),V(this,"lastMsgTime",Date.now()),V(this,"uploadCache",[]),V(this,"uploadCacheInterval",void 0),V(this,"rttRolling",new dk(5)),V(this,"pingpongTimer",void 0),V(this,"wsInflateDataTimer",void 0),V(this,"pingpongTimeoutCount",0),V(this,"ortc",void 0),V(this,"joinResponse",void 0),V(this,"multiIpOption",void 0),V(this,"initError",void 0),V(this,"spec",void 0),V(this,"store",void 0),V(this,"onWebsocketMessage",s=>{if(s.data instanceof ArrayBuffer)return void this.emit(rt.ON_BINARY_DATA,s.data);let o=JSON.parse(s.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){let u="res-@".concat(o._id);this.emit(u,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")){if(this.emit(o._type,o._message),o._type===wt.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===wt.ON_USER_BANNED)switch(o._message.error_code){case 14:this.close(tn.UID_BANNED);break;case 15:this.close(tn.IP_BANNED);break;case 16:this.close(tn.CHANNEL_BANNED)}if(o._type===wt.ON_USER_LICENSE_BANNED)switch(o._message.error_code){case pt.ERR_LICENSE_MISSING:this.close(tn.LICENSE_MISSING);break;case pt.ERR_LICENSE_EXPIRED:this.close(tn.LICENSE_EXPIRED);break;case pt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(tn.LICENSE_MINUTES_EXCEEDED);break;case pt.ERR_LICENSE_PERIOD_INVALID:this.close(tn.LICENSE_PERIOD_INVALID);break;case pt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(tn.LICENSE_MULTIPLE_SDK_SERVICE);break;case pt.ERR_LICENSE_ILLEGAL:this.close(tn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new sD("gateway-".concat(this.clientId),this.spec.retryConfig,!0,z("JOIN_GATEWAY_USE_DUAL_DOMAIN"),z("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===nn.CONNECTED&&this.reconnect("retry",ts.OFFLINE)})}async request(t,n,s,o){let u=In(6,""),d={_id:u,_type:t,_message:n},f=this.websocket.connectionID,g=()=>new We((F,M)=>{if(this.connectionState===nn.CONNECTED)return F();let j=()=>{this.off(rt.WS_CLOSED,K),F()},K=()=>{this.off(rt.WS_CONNECTED,j),M(new he(Y.WS_ABORT))};this.once(rt.WS_CONNECTED,j),this.once(rt.WS_CLOSED,K),t!==ct.PUBLISH&&t!==ct.PUBLISH_DATASTREAM&&t!==ct.SUBSCRIBE&&t!==ct.SUBSCRIBE_DATASTREAM&&t!==ct.UNSUBSCRIBE&&t!==ct.UNSUBSCRIBE_DATASTREAM&&t!==ct.UNPUBLISH&&t!==ct.UNPUBLISH_DATASTREAM&&t!==ct.CONTROL&&t!==ct.RESTART_ICE||this.once(rt.DISCONNECT_P2P,()=>{M(new he(Y.DISCONNECT_P2P))}),t!==ct.PUBLISH&&t!==ct.RESTART_ICE||this.once(rt.ABORT_P2P_EXECUTION,()=>{M(new he(Y.DISCONNECT_P2P))})});if(this.connectionState!==nn.CONNECTING&&this.connectionState!==nn.RECONNECTING||t===ct.JOIN||t===ct.REJOIN||await g(),this.websocket.sendMessage(d,!0),o)return;let y=new We((F,M)=>{let j=!1,K=(Q,se)=>{j=!0,F({isSuccess:Q==="success",message:se||{}}),this.off(rt.WS_CLOSED,q),this.off(rt.WS_RECONNECTING,q),this.emit(rt.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(u),K);let q=()=>{M(new he(Y.WS_ABORT,"type: ".concat(t))),this.off(rt.WS_CLOSED,q),this.off(rt.WS_RECONNECTING,q),this.off("res-@".concat(u),K)};this.once(rt.WS_CLOSED,q),this.once(rt.WS_RECONNECTING,q),Ci(z("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==f||j||(k.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(rt.REQUEST_TIMEOUT,t,n))})}),v=null;try{v=await y}catch(F){if(this.connectionState===nn.CLOSED||t===ct.LEAVE)throw new he(Y.WS_ABORT);return!this.spec.forceWaitGatewayResponse||s?F.throw():t===ct.JOIN||t===ct.REJOIN?null:(await g(),await this.request(t,n))}if(v.isSuccess)return v.message;let R=Number(v.message.error_code||v.message.code),b=Km(R),A=new he(Y.UNEXPECTED_RESPONSE,"".concat(b.desc,": ").concat(v.message.error_str),{code:R,data:v.message,desc:b.desc});return b.action==="success"?v.message:(k.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(R,", message: ").concat(b.desc,", action: ").concat(b.action)),R===pt.ERR_TOO_MANY_BROADCASTERS?((t===ct.JOIN||t===ct.REJOIN)&&(this.initError=A,this.close()),A.throw()):b.action==="failed"?A.throw():b.action==="quit"?(this.initError=A,this.close(),A.throw()):(R===pt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=v.message.option,k.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",ts.MULTI_IP)):this.reconnect(b.action,ts.SERVER_ERROR),t===ct.JOIN||t===ct.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new We(s=>{let o=u=>{(!n||n(u))&&(this.off(t,o),s(u))};this.on(t,o)})}uploadWRTCStats(t){if(!this.store.sessionId)return void k.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(zm.WRTC_STATS,n)}upload(t,n){let s={_type:t,_message:n};try{this.websocket.sendMessage(s)}catch{let o=z("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>o&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==nn.CONNECTED)return;let u=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(u._type,u._message)},z("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){let s={_type:t,_message:n};this.websocket.sendMessage(s)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new We((n,s)=>{this.once(rt.WS_CONNECTED,()=>n(this.joinResponse)),this.once(rt.WS_CLOSED,o=>s(this.initError||new he(Y.WS_ABORT,o))),this.connectionState=nn.CONNECTING,this.websocket.init(t).catch(s),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||tn.LEAVE,this.connectionState=nn.CLOSED,k.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(rt.ABORT_P2P_EXECUTION),this.store.signalConnected();let t=await ei(this,rt.REQUEST_JOIN_INFO);this.store.joinReq();let n=await this.request(ct.JOIN,t);if(this.ortc=t?.ortc,this.store.joinRep(),!n)return this.emit(rt.REPORT_JOIN_GATEWAY,Yb.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(rt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=nn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new he(Y.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let t=Pm(this,rt.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;let n=await this.request(ct.REJOIN,t);return!!n&&(this.connectionState=nn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(s=>{this.emit(wt.ON_USER_ONLINE,{uid:s.uid}),s.audio&&this.emit(wt.ON_ADD_AUDIO_STREAM,{uid:s.uid,uint_id:s.uint_id,audio:!0,ssrcId:s.audio_ssrc}),s.video&&this.emit(wt.ON_ADD_VIDEO_STREAM,{uid:s.uid,uint_id:s.uint_id,video:!0,ssrcId:s.video_ssrc}),s.audio_mute?this.emit(wt.MUTE_AUDIO,{uid:s.uid}):this.emit(wt.UNMUTE_AUDIO,{uid:s.uid}),s.video_mute?this.emit(wt.MUTE_VIDEO,{uid:s.uid}):this.emit(wt.UNMUTE_VIDEO,{uid:s.uid}),s.audio_enable_local?this.emit(wt.ENABLE_LOCAL_AUDIO,{uid:s.uid}):this.emit(wt.DISABLE_LOCAL_AUDIO,{uid:s.uid}),s.video_enable_local?this.emit(wt.ENABLE_LOCAL_VIDEO,{uid:s.uid}):this.emit(wt.DISABLE_LOCAL_VIDEO,{uid:s.uid}),s.audio||s.video||this.emit(wt.ON_REMOVE_STREAM,{uid:s.uid,uint_id:s.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){if(!this.ortc)return!1;let n={downgrade_codec:t,ortc:this.ortc};return!!await this.request(ct.DOWNGRADE_CODEC,n)}handleNotification(t){k.debug("[".concat(this.clientId,"] receive notification: "),t);let n=Km(t.code);if(t.code===28&&"detail"in t&&(k.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(rt.RECOVER_NOTIFICATION,t.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?t.code===pt.ERR_REPEAT_JOIN_CHANNEL&&z("IGNORE_UID_CHECK")?void this.close(tn.UID_CONFLICT):(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(tn.UID_BANNED),void this.close()):t.code===pt.K_VOS_FALLBACK&&"detail"in t?(k.info("[".concat(this.clientId,"] receive vos fallback notification: "),t.detail),t.detail==="FALLBACKCN"&&z("ENABLE_QUALITY_FALLBACK")?void ei(this,rt.VOS_FALLBACK_PROMISE,t.detail).then(()=>{this.reconnect("recover",n.desc)}).catch(s=>{k.debug("[".concat(this.clientId,"] cancel vos fallback cn, error: "),s)}):t.detail==="fallback_hls"&&z("ENABLE_FALLBACK_TO_HLS")?(this.emit(rt.VOS_FALLBACK,t.detail),void this.close(tn.FALLBACK_TO_HLS)):this.reconnect(n.action,n.desc)):void this.reconnect(n.action,ts.SERVER_ERROR);k.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=z("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(k.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>z("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ts.TIMEOUT):this.request(ct.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let s=Date.now()-n;this.rttRolling.add(s),z("REPORT_STATS")&&this.send(ct.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleWsInflateData(){let{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(zm.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Ot.RECONNECT_CREATE_CONNECTION,t=>{this.emit(rt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Ot.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ot.CLOSED,()=>{this.connectionState=nn.CLOSED}),this.websocket.on(Ot.FAILED,()=>{this._disconnectedReason=tn.NETWORK_ERROR,this.connectionState=nn.CLOSED}),this.websocket.on(Ot.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===nn.CONNECTED?this.connectionState=nn.RECONNECTING:this.connectionState=nn.CONNECTING}),this.websocket.on(Ot.WILL_RECONNECT,(t,n,s)=>{let o=Pm(this,rt.IS_P2P_DISCONNECTED),u=o||t!=="retry";o&&t==="retry"&&(k.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=Yb.P2P_DISCONNECTED),u&&(k.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(rt.REPORT_JOIN_GATEWAY,n||Yb.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(rt.DISCONNECT_P2P)),s(t)}),this.websocket.on(Ot.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{k.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",ts.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(rt.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof he){if(t.code===Y.UNEXPECTED_RESPONSE&&t.data.code===pt.ERR_NO_AUTHORIZED)return this.initError=new he(Y.TOKEN_EXPIRE,"dynamic key expired"),void this.close(tn.TOKEN_EXPIRE);k.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ts.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(Ot.REQUEST_NEW_URLS,(t,n)=>{ei(this,rt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(Ot.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(wt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(li.PRE_CONNECT_PC,()=>{this.emit(rt.PRE_CONNECT_PC)}),this.websocket.on(Ot.ON_FALLBACK,()=>{z("ENABLE_FALLBACK_TO_HLS")&&this.emit(rt.VOS_FALLBACK,"fallback_hls")})}}let ohe=(function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e})({}),Yr=(function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e})({});function $W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function Jb(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?$W(Object(n),!0).forEach(function(s){V(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$W(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}let aD=0;function qc(e){let t=z("TURN_DOMAINS");aD=(aD+1)%t.length;let n=t[aD]||"edge.agora.io";return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(n):(k.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function $b(e){try{let t=z("TURN_DOMAINS"),n=z("GATEWAY_DOMAINS").concat(t).find(s=>ke(e).call(e,s));return n?e.split(".".concat(n))[0].replace(/-/g,"."):e}catch{return k.debug("serverUrlToIp error, fallback to url",e),e}}function oD(e,t){e.addresses||(e.addresses=[]);let n=(function(f,g){if(z("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return f.map(R=>{let{ip:b,port:A}=R;return{address:"".concat(b,":").concat(A)}});let y=z("GATEWAY_DOMAINS"),v=y[1]&&ke(g).call(g,y[1])?1:0;return f.map(R=>{let{domain_prefix:b,port:A,ip:F}=R;if(b)return{address:"".concat(b,".").concat(y[v++%y.length],":").concat(A)};let M=/^[\.\:\d]+$/.test(F),j=M?"".concat(F.replace(/[^\d]/g,"-"),".").concat(y[v++%y.length],":").concat(A):"".concat(F,":").concat(A);return M||k.debug("Cannot recognized as ip address: ".concat(F,", use as host3")),{ip:F,port:A,address:j}})})(e.addresses,t),s=Array.isArray(e.detail)&&e.detail[18];if(s&&typeof s=="string"){let f=s.split(";");for(let g=0;g<f.length;g++){var o;let y=Bs(o=f[g]).call(o);n[g]&&y&&(n[g].ip6=y)}}let u=e.detail&&e.detail.candidate,d;if(u){let[f,g]=u.split(":");f&&g&&(d={port:Number(g),ip:f,address:"".concat(f,":").concat(g)})}return{gatewayAddrs:n,apGatewayAddress:d,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function da(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function QW(e){let t=e._encoderConfig;if(!t)return{};let n={resolution:t.width&&t.height?"".concat(da(t.width),"x").concat(da(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function Qb(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function VT(e,t){let n,s,o;switch(t){case Yr.CHOOSE_SERVER:s=4096,o="choose server";break;case Yr.CLOUD_PROXY:s=1048576,o="proxy";break;case Yr.CLOUD_PROXY_5:s=4194304,o="proxy5";break;case Yr.CLOUD_PROXY_FALLBACK:s=4194310,o="proxy fallback";break;default:throw new he(Y.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(u=>{u.buffer&&u.buffer.flag===s&&(n={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map(d=>Jb(Jb({},d),{},{ticket:u.buffer.cert})),server_ts:e.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:Jb(Jb({},u.buffer.detail),e.detail),flag:u.buffer.flag,opid:e.opid,cert:u.buffer.cert})}),!n)throw new he(Y.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(o," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function ZW(e,t){return await We.all(e.addresses.map(async n=>({address:qc(n.ip),tcpport:n.port,udpport:n.port,username:t&&z("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():ns.username,password:t&&z("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await ik(t.toString()):ns.password})))}function cD(e,t){let n=t.getMediaStreamTrack(!0).getSettings(),s=t.videoHeight||n.height,o=t.videoWidth||n.width;return s&&o?Math.max(Math.min(s,o)/Math.min(da(e.height),da(e.width)),1):(k.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function wp(e){let{candidateType:t,relayProtocol:n,type:s,address:o,port:u,protocol:d}=e,f={candidateType:t,relayProtocol:n,protocol:d};if(s!=="local-candidate"){let g=o.split(".");g.length>=4&&(g[1]="*",g[2]="*"),f.address=g.join("."),f.port=u}return f}function Zu(e){let t=e.split(":"),n=e.split(/[-.]/),s=ke(e).call(e,"-")?"-":".",o=e;return t.length>1?n.length>1?(n[1]="**",o=n[0]+s+"**:"+t[t.length-1]):o=t.length>2?t[0]+s+"**:"+t[t.length-1]:"**:"+t[t.length-1]:n.length>1&&(o=n[0]+s+"**"),o}function e8(e,t){return e.getTransceivers().find(n=>n.sender.track===t||n.receiver.track===t)}function FT(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:z("SVC_MODE");if(z("ENABLE_SVC"))return(function(t){return t in Tb})(e)?e:Tb.L1T3}let t8={[et.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[et.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function n8(e){e.send&&(KE(et.VIDEO,e.send.videoExtensions),KE(et.AUDIO,e.send.audioExtensions)),e.recv&&(KE(et.VIDEO,e.recv.videoExtensions),KE(et.AUDIO,e.recv.audioExtensions)),e.sendrecv&&(KE(et.VIDEO,e.sendrecv.videoExtensions),KE(et.AUDIO,e.sendrecv.audioExtensions))}function r8(e,t){e.send&&(Zb(et.VIDEO,e.send.videoExtensions,t.send.videoExtensions),Zb(et.AUDIO,e.send.audioExtensions,t.send.audioExtensions)),e.recv&&(Zb(et.VIDEO,e.recv.videoExtensions,t.recv.videoExtensions),Zb(et.AUDIO,e.recv.audioExtensions,t.recv.audioExtensions))}function Zb(e,t,n){t.forEach(s=>{var o;let u=t8[e].find(f=>{var g;let{key:y}=f;return ke(g=s.extensionName).call(g,y)});if(!u)return;let d=n.find(f=>{let{extensionName:g}=f;return ke(g).call(g,u.key)});d&&ke(o=d.extensionName).call(o,"gdpr_forbidden")&&(s.extensionName=d.extensionName)})}function KE(e,t){t.forEach(n=>{var s;let o=t8[e].find(u=>{var d;let{key:f}=u;return ke(d=n.extensionName).call(d,f)});ke(s=n.extensionName).call(s,"gdpr_forbidden")&&o&&(n.extensionName=o.extensionName)})}function i8(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||ke(e).call(e,"abs-send-time")}function eI(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||ke(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function s8(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function a8(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?s8(Object(n),!0).forEach(function(s){V(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s8(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function jT(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0,{filterRTX:o,filterVideoFec:u,filterAudioFec:d,filterAudioCodec:f,filterVideoCodec:g,unsupportedVideoUplinkCodec:y,unsupportedVideoDownlinkCodec:v}=t,{useXR:R}=n,b=[],A=[],F=[],M=[],j=!1,K=!1;if(Hs(e).mediaDescriptions.forEach(Q=>{s&&s!==Q.attributes.direction||(Q.media.mediaType!=="video"||j||(A=Q.attributes.payloads,M=Q.attributes.extmaps,j=!0),Q.media.mediaType!=="audio"||K||(b=Q.attributes.payloads,F=Q.attributes.extmaps,K=!0))}),!M||A.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!F||b.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(A.forEach(Q=>{var se;(se=Q.rtpMap)!==null&&se!==void 0&&se.clockRate&&(Q.rtpMap.clockRate=parseInt(Q.rtpMap.clockRate)),R&&Q.rtcpFeedbacks.push({type:"rrtr"})}),b.forEach(Q=>{var se;(se=Q.rtpMap)!==null&&se!==void 0&&se.clockRate&&(Q.rtpMap.clockRate=parseInt(Q.rtpMap.clockRate)),R&&Q.rtcpFeedbacks.push({type:"rrtr"})}),o&&(b=b.filter(Q=>{var se;return((se=Q.rtpMap)===null||se===void 0?void 0:se.encodingName.toLowerCase())!=="rtx"}),A=A.filter(Q=>{var se;return((se=Q.rtpMap)===null||se===void 0?void 0:se.encodingName.toLowerCase())!=="rtx"})),u){let Q=A.filter(ne=>{var de;return/(red)|(ulpfec)|(flexfec)/i.test(((de=ne.rtpMap)===null||de===void 0?void 0:de.encodingName)||"")}),se=Cp(Q,A).map(ne=>ne.payloadType),oe=[...Q.map(ne=>ne.payloadType),...se];A=A.filter(ne=>!ke(oe).call(oe,ne.payloadType))}if(d&&(b=b.filter(Q=>{var se;return!/(red)|(ulpfec)|(flexfec)/i.test(((se=Q.rtpMap)===null||se===void 0?void 0:se.encodingName)||"")})),f&&f?.length>0&&(b=b.filter(Q=>{var se;return ke(f).call(f,((se=Q.rtpMap)===null||se===void 0?void 0:se.encodingName.toLowerCase())||"")})),g&&g?.length>0){let Q=A.filter(se=>{var oe;return ke(g).call(g,((oe=se.rtpMap)===null||oe===void 0?void 0:oe.encodingName.toLowerCase())||"")});A=Q.concat(o?[]:Cp(Q,A))}let q=z("UNSUPPORTED_VIDEO_CODEC");if(q&&q.length>0){let Q=A.filter(ne=>ne.rtpMap&&ke(q).call(q,ne.rtpMap.encodingName.toLowerCase())),se=Cp(Q,A),oe=Q.concat(se).map(ne=>ne.payloadType);A=A.filter(ne=>!ke(oe).call(oe,ne.payloadType)),k.debug("unsupportedVideoCodec: ".concat(q,", toBeRemoved: ").concat(oe))}if(y&&y.length>0&&s==="sendonly"){let Q=A.filter(ne=>ne.rtpMap&&ke(y).call(y,ne.rtpMap.encodingName.toLowerCase())),se=Cp(Q,A),oe=Q.concat(se).map(ne=>ne.payloadType);A=A.filter(ne=>!ke(oe).call(oe,ne.payloadType)),k.debug("unsupportedVideoUplinkCodec: ".concat(y,", toBeRemoved: ").concat(oe))}if(v&&v.length>0&&s==="recvonly"){let Q=A.filter(ne=>ne.rtpMap&&ke(v).call(v,ne.rtpMap.encodingName.toLowerCase())),se=Cp(Q,A),oe=Q.concat(se).map(ne=>ne.payloadType);A=A.filter(ne=>!ke(oe).call(oe,ne.payloadType)),k.debug("unsupportedVideoDownlinkCodec: ".concat(v,", toBeRemoved: ").concat(oe))}return{audioCodecs:b,videoCodecs:A,audioExtensions:F,videoExtensions:M}}function ed(e){let t=Hs(e),n,s;for(let o of t.mediaDescriptions){if(!n){let u=o.attributes.iceUfrag,d=o.attributes.icePwd;if(!u||!d)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:u,icePwd:d}}if(!s){let u=o.attributes.fingerprints;u.length>0&&(s={fingerprints:u})}}if(!s&&t.attributes.fingerprints.length>0&&(s={fingerprints:t.attributes.fingerprints}),!s||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:s}}function lD(e,t){let n=[],s=e.attributes.ssrcGroups.filter(d=>d.semantic==="FID"),o=e.attributes.ssrcGroups.find(d=>d.semantic==="SIM"),u=e.attributes.ssrcs;if(o)o.ssrcIds.forEach(d=>{var f;let g=(f=s.find(y=>y.ssrcIds[0]===d))===null||f===void 0?void 0:f.ssrcIds[1];n.push({ssrcId:d,rtx:t?g:void 0})});else if(s.length>0){let d=s[0].ssrcIds[0],f=s[0].ssrcIds[1];n.push({ssrcId:d,rtx:t?f:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:u[0].ssrcId})}return n}function o8(e,t,n){let{cname:s}=e,o=[];t&&(o=c8(t)),o.length===0&&(o=e.iceParameters.candidates.map(v=>({foundation:v.foundation,componentId:"1",transport:v.protocol,priority:v.priority.toString(),connectionAddress:v.ip,port:v.port.toString(),type:v.type,extension:{}})),k.debug("Using candidates from gateway."));let u={fingerprints:e.dtlsParameters.fingerprints.map(v=>({hashFunction:v.algorithm,fingerprint:v.fingerprint}))},d={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd},f;switch(e.dtlsParameters.role){case"server":f="passive";break;case"client":f="active";break;case"auto":f="actpass"}let g=WT(e.rtpCapabilities),y=[];return Array.isArray(n)&&n.length>0&&n.forEach(v=>{y.push({kind:et.VIDEO,ssrcMsg:[{ssrcId:v.v,rtx:v.v_rtx}],mslabel:"".concat(v.v,"_").concat(v.a)},{kind:et.AUDIO,ssrcMsg:[{ssrcId:v.a}],mslabel:"".concat(v.v,"_").concat(v.a)})}),{dtlsParameters:u,iceParameters:d,candidates:o,rtpCapabilities:g,setup:f,cname:s,preSSRCs:y}}function c8(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],k.debug("Using remote candidate from AP ".concat(Zu(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),k.debug("Using IPV6 remote candidate from AP ".concat(Zu(e.ip6),":").concat(e.port)))),t}function BT(e,t,n){let s=[],o=[];return e.forEach(u=>{let{ssrcId:d,rtx:f}=u,g=In(8,"track-"),y={ssrcId:d,attributes:a8({label:g,mslabel:n=n||In(10,""),msid:"".concat(n," ").concat(g)},t&&{cname:t})};if(s.push(y),f!==void 0){let v={ssrcId:f,attributes:a8({label:g,mslabel:n,msid:"".concat(n," ").concat(g)},t&&{cname:t})};s.push(v),o.push({semantic:"FID",ssrcIds:[d,f]})}}),e.length>1&&o.push({semantic:"SIM",ssrcIds:e.map(u=>{let{ssrcId:d}=u;return d})}),{ssrcs:s,ssrcGroups:o}}function Ym(e,t){t instanceof Nr&&e.attributes.payloads.forEach(n=>{var s;let o=(s=n.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase();if(!o||["opus","pcmu","pcma","g722"].indexOf(o)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),o==="opus"&&typeof z("OPUS_PTIME")=="number"?n.fmtp.parameters.ptime=z("OPUS_PTIME"):n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";let u=t._encoderConfig;u&&(o!=="pcmu"&&o!=="pcma"&&o!=="g722"&&(u.bitrate&&!$n()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1")),t instanceof LT&&o==="opus"&&t._config.DTX&&(n.fmtp.parameters.usedtx="1"))})}function uD(e){let t=e.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function dD(e,t){var n;if(e.attributes.payloads.forEach(o=>{var u;((u=o.rtpMap)===null||u===void 0?void 0:u.encodingName.toLowerCase())==="h264"&&o.fmtp&&o.fmtp.parameters&&z("ENABLE_UP_SPS_PPS")&&(o.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),!(t instanceof jn&&t._encoderConfig&&t._hints.indexOf(bn.SCREEN_TRACK)===-1))return;let s=t._encoderConfig;Qt().supportMinBitrate&&s.bitrateMin&&e.attributes.payloads.forEach(o=>{var u,d;ke(u=["h264","h265","vp8","vp9","av1"]).call(u,((d=o.rtpMap)===null||d===void 0?void 0:d.encodingName.toLowerCase())||"")&&(o.fmtp||(o.fmtp={parameters:{}}),o.fmtp.parameters["x-google-min-bitrate"]="".concat(s.bitrateMin))}),Qt().supportMinBitrate&&!ke(n=t._hints).call(n,bn.LOW_STREAM)&&s.bitrateMax&&e.attributes.payloads.forEach(o=>{var u,d;ke(u=["h264","h265","vp8","vp9","av1"]).call(u,((d=o.rtpMap)===null||d===void 0?void 0:d.encodingName.toLowerCase())||"")&&(o.fmtp||(o.fmtp={parameters:{}}),o.fmtp.parameters["x-google-start-bitrate"]="".concat(z("X_GOOGLE_START_BITRATE")||Math.floor(s.bitrateMax)))})}function l8(e){if(e.media.mediaType!=="video")return;let t=pn();if(t.name!==_n.SAFARI&&t.os!==wi.IOS)return;let n=e.attributes.extmaps.findIndex(s=>/video-orientation/g.test(s.extensionName));n!==-1&&e.attributes.extmaps.splice(n,1)}function tI(e,t,n){if(!t)return;let s,o;if(e.media.mediaType==="video"?(s=n.videoExtensions,o=n.videoCodecs):(s=n.audioExtensions,o=n.audioCodecs),t.twcc===!0){let u=s.find(d=>eI(d.extensionName));if(u){let d=u.extensionName;e.attributes.extmaps.find(f=>eI(f.extensionName))||e.attributes.extmaps.push({entry:u.entry,extensionName:d}),(function(f,g){return g.filter(y=>!!f.find(v=>v.payloadType===y.payloadType&&!!v.rtcpFeedbacks.find(R=>R.type==="transport-cc")))})(o,e.attributes.payloads).forEach(f=>{f.rtcpFeedbacks.find(g=>g.type==="transport-cc")||f.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){let u=e.attributes.extmaps.findIndex(d=>eI(d.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(d=>{let f=d.rtcpFeedbacks.findIndex(g=>g.type==="transport-cc");f!==-1&&d.rtcpFeedbacks.splice(f,1)})}if(t.remb===!0){let u=s.find(d=>i8(d.extensionName));if(u){let d=u.extensionName;e.attributes.extmaps.find(f=>f.extensionName===d)||e.attributes.extmaps.push({entry:u.entry,extensionName:d}),(function(f,g){return g.filter(y=>!!f.find(v=>v.payloadType===y.payloadType&&!!v.rtcpFeedbacks.find(R=>R.type==="goog-remb")))})(o,e.attributes.payloads).forEach(f=>{f.rtcpFeedbacks.find(g=>g.type==="goog-remb")||f.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){let u=e.attributes.extmaps.findIndex(d=>i8(d.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(d=>{let f=d.rtcpFeedbacks.findIndex(g=>g.type==="goog-remb");f!==-1&&d.rtcpFeedbacks.splice(f,1)})}}function hD(e,t,n){if($n()||e.media.mediaType!=="video"||!(t instanceof jn)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!z("SIMULCAST")||n==="vp9"&&z("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;let s=n==="vp8"?2:t._scalabilityMode.numSpatialLayers,o=e.attributes.ssrcs[0],u=e.attributes.ssrcGroups.find(f=>f.semantic==="FID"&&f.ssrcIds[0]===o.ssrcId),d={semantic:"SIM",ssrcIds:[o.ssrcId]};for(let f=1;f<s;f++)e.attributes.ssrcs.push({ssrcId:o.ssrcId+f,attributes:Qn(o.attributes)}),d.ssrcIds.push(o.ssrcId+f),u&&(e.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+f,attributes:Qn(o.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[o.ssrcId+f,u.ssrcIds[1]+f]}));e.attributes.ssrcGroups.unshift(d)}async function u8(){try{let e=new RTCPeerConnection;e.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:Tb.L1T3}]});let t=await e.createOffer();if(!t.sdp)return void e.close();let n=Hs(t.sdp).mediaDescriptions[0];if(!n)return;let s=n.attributes.extmaps.find(o=>o.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return e.close(),s}catch{return}}async function pD(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});let s=(await n.createOffer()).sdp,{send:o,recv:u,sendrecv:d}=(function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0,v=jT(y,f,g,"sendonly"),R=jT(y,f,g,"recvonly"),b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},F={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Xc(v,R,"videoExtensions",b,A,F),Xc(v,R,"videoCodecs",b,A,F),Xc(v,R,"audioExtensions",b,A,F),Xc(v,R,"audioCodecs",b,A,F),z("RAISE_H264_BASELINE_PRIORITY")){let M=[],j=[];if(F.videoCodecs.forEach((K,q)=>{var Q;if(((Q=K.rtpMap)===null||Q===void 0?void 0:Q.encodingName.toLocaleLowerCase())==="h264"){var se,oe;let ne=F.videoCodecs[q+1],de=ne&&f8(K,ne),we=(se=K.fmtp)===null||se===void 0?void 0:se.parameters["profile-level-id"],Oe=(oe=K.fmtp)===null||oe===void 0?void 0:oe.parameters["packetization-mode"];!we||we!==z("FIRST_H264_PROFILE_LEVEL_ID")||z("FIRST_PACKETIZATION_MODE")&&Oe!==z("FIRST_PACKETIZATION_MODE")?de?j.push([K,ne]):j.push([K]):de?M.push([K,ne]):M.push([K])}}),M.length>0&&j.length>0){k.debug("raising H264 baseline profile priority"),F.videoCodecs.forEach((q,Q)=>{var se;if(((se=q.rtpMap)===null||se===void 0?void 0:se.encodingName.toLocaleLowerCase())==="h264"){let oe=f8(q,F.videoCodecs[Q+1]),ne=M.shift()||j.shift()||[];ne.length>0&&(oe?F.videoCodecs.splice(Q,2,...ne):F.videoCodecs.splice(Q,1,...ne))}});let K=A.videoCodecs.filter(q=>{var Q,se;return((Q=q.rtpMap)===null||Q===void 0?void 0:Q.encodingName.toLocaleLowerCase())==="h264"&&((se=q.fmtp)===null||se===void 0?void 0:se.parameters["profile-level-id"])!==z("FIRST_H264_PROFILE_LEVEL_ID")});if(K.length>0){let q=Cp(K,A.videoCodecs).map(se=>se.payloadType),Q=[...K.map(se=>se.payloadType),...q];A.videoCodecs=A.videoCodecs.filter(se=>!ke(Q).call(Q,se.payloadType))}z("FILTER_SEND_H264_BASELINE")&&(b.videoCodecs=b.videoCodecs.filter(q=>{var Q,se;return!(((Q=q.rtpMap)===null||Q===void 0?void 0:Q.encodingName.toLocaleLowerCase())==="h264"&&((se=q.fmtp)===null||se===void 0?void 0:se.parameters["profile-level-id"])!==z("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:b,recv:A,sendrecv:F}}return{send:b,recv:A,sendrecv:F}})(e,t,s);try{n.close()}catch{}return{send:o,recv:u,sendrecv:d}}function d8(){let e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=jT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Xc(e,t,"videoExtensions",n,s,o),Xc(e,t,"videoCodecs",n,s,o),Xc(e,t,"audioExtensions",n,s,o),Xc(e,t,"audioCodecs",n,s,o),z("RAISE_H264_BASELINE_PRIORITY")){let u=o.videoCodecs.findIndex(d=>d.rtpMap&&d.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&d.fmtp&&d.fmtp.parameters["profile-level-id"]==="42001f");if(u!==-1){let d=o.videoCodecs.findIndex(f=>f.rtpMap&&f.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(d<u){k.debug("raising H264 baseline profile priority");let f=o.videoCodecs[u];o.videoCodecs.splice(u,1),o.videoCodecs.splice(d,0,f)}d!==-1&&(s.videoCodecs=s.videoCodecs.filter(f=>!(f.rtpMap&&f.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&f.fmtp&&f.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:s,sendrecv:o}}function Xc(e,t,n,s,o,u){if(n==="videoExtensions"||n==="audioExtensions"){let d=[];return e[n].forEach(f=>{t[n].some((g,y)=>{if(f.entry===g.entry&&f.extensionName===g.extensionName)return d.push(y),!0})?u[n].push(f):s[n].push(f)}),void t[n].forEach((f,g)=>{d.indexOf(g)===-1&&o[n].push(f)})}if(n==="videoCodecs"||n==="audioCodecs"){let d=[];return e[n].forEach(f=>{t[n].some((g,y)=>{if(f.payloadType===g.payloadType&&JSON.stringify(f)===JSON.stringify(g))return d.push(y),!0})?u[n].push(f):s[n].push(f)}),void t[n].forEach((f,g)=>{d.indexOf(g)===-1&&o[n].push(f)})}}function WT(e){let{send:t,recv:n,sendrecv:s}=e;if(!s){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let o,u;return t?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...t.audioCodecs,...s.audioCodecs],o.videoCodecs=[...t.videoCodecs,...s.videoCodecs],o.audioExtensions=[...t.audioExtensions,...s.audioExtensions],o.videoExtensions=[...t.videoExtensions,...s.videoExtensions]):o=Qn(s),n?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...n.audioCodecs,...s.audioCodecs],u.videoCodecs=[...n.videoCodecs,...s.videoCodecs],u.audioExtensions=[...n.audioExtensions,...s.audioExtensions],u.videoExtensions=[...n.videoExtensions,...s.videoExtensions]):u=Qn(s),{send:o,recv:u}}function YE(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function GT(e,t,n,s){let o=[];if(e===et.VIDEO){if(z("H264_PROFILE_LEVEL_ID")&&s==="h264"&&(o=t.videoCodecs.filter(u=>{var d;return ke(d=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(d,s)&&u&&u.fmtp&&u.fmtp.parameters["profile-level-id"]===z("H264_PROFILE_LEVEL_ID")})),!Array.isArray(o)||o.length===0){let u=[],d=[],f=[],g=[];if(n.videoCodecs.forEach(y=>{let v=y.rtpMap&&y.rtpMap.encodingName.toLowerCase()||"";ke(v).call(v,s)?u.push(y):ke(v).call(v,"vp9")?d.push(y):ke(v).call(v,"vp8")?f.push(y):ke(v).call(v,"h264")&&g.push(y)}),u.length===0){let y="";d.length!==0?(u=d,y="vp9"):f.length!==0?(u=f,y="vp8"):g.length!==0&&(u=g,y="h264"),k.warning("codec ".concat(s," not included in rtpCapabilities, fallback to default payloads: ").concat(y))}u.length!==0&&(o=t.videoCodecs.filter(y=>u.some(v=>v.payloadType===y.payloadType)))}if(o.length===0&&(k.warning("codec ".concat(s," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),o=t.videoCodecs),z("USE_PUB_RTX")||z("USE_SUB_RTX")){let u=Cp(o,t.videoCodecs);o=[...o,...u]}}else{o=t.audioCodecs.filter(d=>{var f;return ke(f=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(f,s)});let u=t.audioCodecs.filter(d=>{var f;return ke(f=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(f,"red")});o.length===0&&(k.warning("codec ".concat(s," not included in rtpCapabilities, fallback to opus")),o=t.audioCodecs.filter(d=>{var f;return ke(f=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(f,"opus")})),z("ENABLE_AUDIO_RED")&&u.length!==0&&(o=[...u,...o])}return o}function Cp(e,t){let n=e.map(s=>s.payloadType.toString());return t.filter(s=>s.rtpMap&&s.rtpMap.encodingName==="rtx"&&s.fmtp&&s.fmtp.parameters.apt&&ke(n).call(n,s.fmtp&&s.fmtp.parameters.apt))}async function Aa(e,t,n){let s=t.toString(),o=h8(s,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:s});let u=await e.createAnswer();if(!u.sdp)throw new Error("cannot get answer sdp");let d=u.sdp;d=fD(d,n||{}),o?.(d||""),await e.setLocalDescription({type:"answer",sdp:d})}function fD(e,t,n){if(z("FORBID_MODIFY_LOCAL_OFFER_SDP"))return e;let s=Hs(e),{useXR:o}=t;return s.mediaDescriptions.forEach(u=>{var d;u.attributes.mid&&(Array.isArray(n)&&!ke(n).call(n,u.attributes.mid)||(u.media.mediaType==="audio"&&YE(u),u.media.mediaType==="video"&&(function(f){f.media.mediaType==="video"&&z("ENABLE_DOWN_SPS_PPS")&&f.attributes.payloads.filter(g=>{var y;return((y=g.rtpMap)===null||y===void 0?void 0:y.encodingName.toLowerCase())==="h264"}).forEach(g=>{g.fmtp||(g.fmtp={parameters:{}}),g.fmtp.parameters["sps-pps-idr-in-keyframe"]="1"})})(u),o&&ke(d=["audio","video"]).call(d,u.media.mediaType)&&u.attributes.payloads.forEach(f=>{f.rtcpFeedbacks.findIndex(g=>g.type==="rrtr")===-1&&f.rtcpFeedbacks.push({type:"rrtr"})})))}),eh(s)}function h8(e,t,n,s){if(z("SDP_LOGGING"))return k.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(s,`
`),e),t==="offer"?o=>{h8(o,"answer",n==="local"?"remote":"local",s)}:void 0}async function p8(e,t,n){try{var s;if(!Qt().supportSetRtpSenderParameters||!(function(g){return g==="vp9"||g==="av1"})(e)||!z("ENABLE_SVC"))return;let o={},u={},d=t.getParameters(),f=(s=d.encodings)===null||s===void 0?void 0:s[0];u.scalabilityMode=FT(n),f&&Object.assign(f,u),Object.assign(d,o),await t.setParameters(d),k.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(d.encodings)))}catch(o){k.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",o)}}function nI(e){let t=z("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(n=>ke(e).call(e,n))}function f8(e,t){try{var n;return((n=e.fmtp)===null||n===void 0?void 0:n.parameters.apt)===t.payloadType.toString()}catch{return!1}}function m8(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function Ja(e,t){return typeof z(e)===t?z(e):void 0}function che(){try{let e=z("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:(function(t){for(var n=1;n<arguments.length;n++){var s=arguments[n]!=null?arguments[n]:{};n%2?m8(Object(s),!0).forEach(function(o){V(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):m8(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t})({},e)}catch(e){return k.debug("handle gateway attributes failed: ",e),{}}}let g8={};function td(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&k.debug("install service ".concat(e.name)),g8[e.name]=e}function Kl(e){let t=g8[e];if(!t)throw new _e(Y.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function _8(e,t){return Kl("DataStream").create(e,t)}function rI(){return Kl("InterceptFrame").create()}function E8(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function Li(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?E8(Object(n),!0).forEach(function(s){V(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E8(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}let mD=new Map;class lhe extends dr{get state(){return this._state}set state(t){if(t===this._state)return;let n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(Vr.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(Vr.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){k.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){var s,o,u;super(),V(this,"store",void 0),V(this,"joinInfo",void 0),V(this,"key",void 0),V(this,"ntpOffset",0),V(this,"usingProxy",!1),V(this,"signal",void 0),V(this,"role",void 0),V(this,"isPreallocation",void 0),V(this,"isPreSub",void 0),V(this,"inChannelInfo",{joinAt:null,duration:0}),V(this,"spec",void 0),V(this,"_state","DISCONNECTED"),V(this,"_statsCollector",void 0),V(this,"_disconnectedReason",void 0),V(this,"isSignalRecover",!1),V(this,"hasChangeBGPAddress",!1),V(this,"trafficStatsInterval",void 0),V(this,"networkQualityInterval",void 0),V(this,"_joinGatewayStartTime",0),V(this,"_signalTimeout",!1),V(this,"_clientRoleOptions",void 0),V(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useP2P?(s={spec:Li(Li({},n),{},{retryConfig:n.websocketRetryConfig}),store:t},(o=(u=Kl("P2PChannel")).createSubmodule)===null||o===void 0?void 0:o.call(u,s)):this.store.useDcSignal?(function(d){return Kl("DataChannelSignal").create(d)})({spec:Li(Li({},n),{},{retryConfig:n.websocketRetryConfig}),store:t}):new JW(Li(Li({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}setUsingProxy(t){this.usingProxy=t}async join(t,n,s){if(this.store.useDcSignal){let v=!1;t.cloudProxyServer!=="disabled"?(k.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(t.cloudProxyServer,")")),v=!0):"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length>255||"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length<22?(k.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),v=!0):t.apResponse.addresses.some(R=>R.fingerprint)||z("FINGERPRINT")||(k.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),v=!0),v&&this.resetSignal()}this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);let o=Date.now(),u=mD.get(t.cname);if(u||(u=new Map,mD.set(t.cname,u)),this._isProactiveJoin=!0,u.has(t.uid)){let v=new he(Y.UID_CONFLICT);throw tt.joinGateway(t.sid,{lts:o,succ:!1,ec:v.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer||this.usingProxy,signalChannel:this.store.useDcSignal?"1":"0",preload:t.preload}),v}u.set(t.uid,!0),this.joinInfo=t,this.key=n;let d=0;this.joinGatewayStartTime=o;let f=t.proxyServer,g=this.store.useDcSignal?"datachannel":"websocket";try{k.debug("[".concat(this.store.clientId,"] use ").concat(g," join uid ").concat(d));let v=t.gatewayAddrs.map(b=>{let{address:A}=b,[F,M]=A.split(":"),j={host:F,port:M};return t.proxyServer&&(j.proxy=t.proxyServer),j}),R;R=this.store.useDcSignal?await this.signal.init(t.apResponse.addresses):await this.signal.init(v),d=R.uid,k.debug("[".concat(this.store.clientId,"] ").concat(g," join uid ").concat(d," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(v){var y;throw v.code===Y.INIT_DATACHANNEL_TIMEOUT&&this.signal.__name__==="AgoraRTCSignal"||tt.joinGateway(t.sid,{lts:o,succ:!1,ec:((y=v.data)===null||y===void 0?void 0:y.desc)||v.code,errorMsg:v.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!f||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:t.preload}),v&&v.code===Y.INIT_DATACHANNEL_TIMEOUT?(k.warning("[".concat(this.store.clientId,"] User join datachannel failed"),v.toString()),this.resetSignal(),v):(k.error("[".concat(this.store.clientId,"] User join failed"),v.toString()),u.delete(t.uid),this.signal.close(),v)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),k.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(v=>{k.warning("[".concat(this.store.clientId,"] get traffic stats error"),v.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Vr.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Vr.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Vr.NETWORK_QUALITY,{uplinkNetworkQuality:Qb(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:Qb(this._statsCollector.trafficStats.B_dnq)}):this.emit(Vr.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),d}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==tn.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==nn.CONNECTED||await(function(s,o){return o===1/0?s:We.race([s,Mue(o)])})(this.signal.request(ct.LEAVE,void 0,!0),3e3)}catch(s){k.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),s)}this.signal.close(n),n!==tn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let o={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:z("PUB_EXTEND"),twcc:!!z("PUBLISH_TWCC"),rtx:!!z("USE_PUB_RTX")};try{return(await this.signal.request(ct.PUBLISH,o,!0))._message}catch(u){if(s&&u.data&&u.data.code===pt.ERR_PUBLISH_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw u}}async publishDataChannel(t,n,s){var o;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let u={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(o=n.maxRetransmits)!==null&&o!==void 0?o:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(ct.PUBLISH_DATASTREAM,u,!0)}catch(d){if(s&&d.data&&d.data.code===pt.ERR_PUBLISH_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),d.toString()),await this.tryUnpubDataChannelBeforeRepub(t,n),this.publishDataChannel(t,n,!1);throw d}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(ct.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(s){k.warning("[".concat(this.store.clientId,"] unpublish warning: "),s)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await We.all(t.map(n=>this.signal.request(ct.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){k.warning("unpublish datachannels warning: ",n)}}async presubscribe(t,n,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));let o={stream_id:t,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!z("SUBSCRIBE_TWCC"),rtx:!!z("USE_SUB_RTX")||void 0,extend:z("SUB_EXTEND"),svc:Array.isArray(z("SVC"))&&z("SVC").length!==0?z("SVC"):void 0};try{return await this.signal.request(ct.PRE_SUBSCRIBE,o,!0)}catch(u){if(s&&u.data&&u.data.code===pt.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),u.toString()),this.presubscribe(t,n,!1);throw u}}async subscribe(t,n,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));let o={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!z("SUBSCRIBE_TWCC"),rtx:!!z("USE_SUB_RTX"),extend:z("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(z("SVC"))&&z("SVC").length!==0?z("SVC"):void 0};try{return(await this.signal.request(ct.SUBSCRIBE,o,!0))._message}catch(u){if(s&&u.data&&u.data.code===pt.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw u}}async subscribeDataChannel(t,n,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));let o={uid:t,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(ct.SUBSCRIBE_DATASTREAM,o,!0)}catch(u){if(s&&u.data&&u.data.code===pt.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),u.toString()),await this.tryUnsubDataChannelBeforeResub(t,n),await this.subscribeDataChannel(t,n,!1);throw u}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));let s={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!z("USE_SUB_RTX"),twcc:!!z("SUBSCRIBE_TWCC"),svc:Array.isArray(z("SVC"))&&z("SVC").length!==0?z("SVC"):void 0};try{return await this.signal.request(ct.SUBSCRIBE_STREAMS,s,!0)}catch(o){if(n&&o.data&&o.data.code===pt.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),o.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw o}}async setVideoProfile(t){let n=(function(s){if(!(s.bitrateMax&&s.bitrateMin&&s.frameRate&&s.height&&s.width))return;let o=s.frameRate,u=s.width,d=s.height,f=!0;return typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,o||(f=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(f=!1)),typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,o||(f=!1)),f?{stream_type:0,width:u,height:d,fps:o,start_bps:1e3*s.bitrateMax,min_bps:1e3*s.bitrateMin,target_bps:1e3*s.bitrateMax}:void 0})(t);if(n)return this.signal.request(ct.SET_VIDEO_PROFILE,n);k.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(ct.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(s){k.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),s)}}async unsubscribeDataChannel(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await We.all(t.map(s=>this.signal.request(ct.UNSUBSCRIBE_DATASTREAM,{stream_id:s,uid:n},!0)))}catch(s){k.warning("unsubscribeDataChannel warning: ",s)}}async massUnsubscribe(t){try{await this.signal.request(ct.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){k.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(t){let{iceParameters:n,dtlsParameters:s,rtpCapabilities:o}=t;return{gatewayEstablishParams:await this.signal.request(ct.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:s,rtpCapabilities:o}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(ct.GATEWAY_INFO)}async renewToken(t){await this.signal.request(ct.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,n){n&&(this._clientRoleOptions=Object.assign({},n)),z("CLIENT_ROLE_OPTIONS")&&(k.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(z("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},z("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),z("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},z("CLIENT_ROLE_OPTIONS")),k.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(z("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let s,o=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(s=this._clientRoleOptions.delay,o=1):o=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:o=0;let u=Object.assign({},n);delete u.delay,delete u.level,await this.signal.request(ct.SET_CLIENT_ROLE,Li(Li({role:t,level:o,delay:s},u),{},{client_ts:Date.now()})),this.role=t}async setDualStreamMode(t,n,s){await this.signal.request(ct.SET_DUAL_STREAM_MODE,{mode:t},s,n)}async setRemoteVideoStreamType(t,n){await this.signal.request(ct.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(ct.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(ct.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(ct.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(t){await this.signal.request(ct.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,n,s){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,n,s)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Li({},this.inChannelInfo)}async setConfigure(t){if(t&&Array.isArray(t)&&t.length!==0)return this.signal.request(ct.CONFIGURE,t)}async getGatewayVersion(){return(await this.signal.request(ct.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let t=mD.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0),this.usingProxy=!1}updateTurnConfigFromSignal(){if(!this.joinInfo)return;let t=(function(n){let s;return s=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),s?{username:ns.username,password:ns.password,turnServerURL:s[2],tcpport:parseInt(s[3])+30,udpport:parseInt(s[3])+30,forceturn:!1}:null})((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Li(Li({},ns),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;let t=await this.signal.request(ct.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(n=>{let s=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(o=>o.peer_uid===n.peer_uid);s&&s.B_st!==n.B_st&&Eb(()=>{this.emit(Vr.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var n,s,o,u;if(!this.joinInfo||!this.key)throw new he(Y.UNEXPECTED_ERROR,"can not generate join message, no join info");let d=Object.assign({},this.joinInfo.apResponse),f=z("REPORT_APP_SCENARIO");if(typeof f!="string")try{f=JSON.stringify(f)}catch{f=void 0}var g;f&&f.length>128&&(f=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Vr.UPDATE_GATEWAY_CONFIG),g=this.store.clientId,ke(BE).call(BE,g)||BE.push(g);let y=DT(this.store),v=!((n=this.isPreallocation)===null||n===void 0||!n.call(this)),R=E5(this.store),b=che(),A=jl(87)||C4()||Q1(117),F=((function(){let q=pn();if(q.name!==_n.SAFARI||!q.browserVersion)return!1;let Q=q.browserVersion.split(".");return Number(Q[0])>18||Number(Q[0])===18&&Number(Q[1])>=4})()||A4(18,4,!1))&&Z1(18,6,!0)&&this.spec.codec==="h264"&&z("ENABLE_ABSSENDTIME_AS_SENTTS"),M=!(((s=d.detail)===null||s===void 0?void 0:s[3])!=="CN"||!z("ENABLE_QUALITY_FALLBACK"))&&z("ENABLE_QUALITY_FALLBACK"),j=!!z("ENABLE_AP_MULTI_IP")&&((o=d.detail)===null||o===void 0?void 0:o[5])==="multi-ip",K=Li({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Xo,browser:navigator.userAgent,process_id:z("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:j||this.hasChangeBGPAddress,ap_response:d,extend:z("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:f,attributes:{userAttributes:Li(Li({enableEncodedTransform:(!!z("ENABLE_AUDIO_METADATA")||!!z("ENABLE_AUDIO_PTS"))&&A||!!z("ENABLE_AUDIO_TOPN")&&$1(_n.CHROME,87,116)||void 0,enableAudioMetadata:!!z("ENABLE_AUDIO_METADATA")&&A,enableAudioPts:!!z("ENABLE_AUDIO_PTS")&&A,topnSmoothLevel:z("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:z("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:z("TOPN_SWITCH_HOLD_MS"),topnAudioGain:z("TOPN_AUDIO_GAIN"),enableNetworkQualityProbe:this.store.networkQualityProbe,enablePublishedUserList:z("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:z("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Ja("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Ja("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Ja("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:z("USE_PUB_RTX")===!0||z("USE_SUB_RTX")===!0||void 0,disableFEC:z("DISABLE_FEC"),enableNTPReport:!!z("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:R,enableFulllinkAvSync:!!z("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Ja("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!z("FORCE_ENABLE_AUT_CC")||!Ib()&&(!!z("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!z("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Ja("USE_XR","boolean"),enableLossbasedBwe:Ja("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!z("FORCE_ENABLE_AUT_CC")||!Ib()&&(!!z("ENABLE_AUT_CC")||void 0),enableCCFallback:Ja("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:v,preSubNum:y?Ja("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Ja("PUBLISH_TWCC","boolean"),enableSubTWCC:Ja("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Ja("USE_PUB_RTX","boolean"),enableSubRTX:Ja("USE_SUB_RTX","boolean"),enableSubSVC:z("ENABLE_SVC")?z("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(z("SVC"))&&z("SVC").length!==0?z("SVC"):void 0,enableSvcExtended:z("ENABLE_SVC")&&Array.isArray(z("SVC_EXTENDED"))&&z("SVC_EXTENDED").length!==0?z("SVC_EXTENDED"):void 0,enableVosFallback:z("ENABLE_VOS_FALLBACK"),enableQualityFallback:M},b),{},{audioDuplicate:Ja("ENABLE_AUDIO_RED","boolean")?(u=Ja("AUDIO_DUPLICATE_NUM","number"))!==null&&u!==void 0?u:2:void 0,senttsUsesAbsSendTime:!!F||void 0,enableDualStreamFlag:Ja("ENABLE_DUAL_STREAM_FLAG","boolean")})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(K.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(K.aes_mode=this.joinInfo.aesmode,z("ENCRYPT_AES")?(K.aes_secret=this.joinInfo.aespassword,K.aes_encrypt=!0):K.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(K.aes_salt=this.joinInfo.aessalt)),d.addresses[this.signal.websocket.currentURLIndex]&&(K.ap_response.ticket=d.addresses[this.signal.websocket.currentURLIndex].ticket,delete d.addresses),this.joinInfo.defaultVideoStream!==void 0&&(K.default_video_stream=this.joinInfo.defaultVideoStream),K}getRejoinMessage(){if(!this.joinInfo)throw new he(Y.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(rt.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(rt.WS_RECONNECTING,t=>{this.joinInfo&&tt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||ts.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",tt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(rt.WS_CLOSED,t=>{let n;switch(t){case tn.LEAVE:n=ts.LEAVE;break;case tn.UID_BANNED:case tn.IP_BANNED:case tn.CHANNEL_BANNED:case tn.SERVER_ERROR:n=ts.SERVER_ERROR;break;case tn.FALLBACK:n=ts.FALLBACK;break;case tn.LICENSE_MISSING:case tn.LICENSE_EXPIRED:case tn.LICENSE_MINUTES_EXCEEDED:case tn.LICENSE_PERIOD_INVALID:case tn.LICENSE_MULTIPLE_SDK_SERVICE:case tn.LICENSE_ILLEGAL:case tn.TOKEN_EXPIRE:n=t;break;default:n=ts.NETWORK_ERROR}k.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+ts.NETWORK_ERROR)),this.joinInfo&&tt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===tn.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==tn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(rt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){let t=z("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(k.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(tt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){let t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void k.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));Ln("EVENT_REPORT_DOMAIN",t[1]),Ln("EVENT_REPORT_BACKUP_DOMAIN",t[1]),Ln("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(wt.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(rt.REQUEST_RECOVER,(t,n,s)=>{if(!this.joinInfo)return s(new he(Y.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,ei(this,Vr.REQUEST_NEW_GATEWAY_LIST).then(n).catch(s)}),this.signal.on(rt.REQUEST_JOIN_INFO,async(t,n,s)=>{var o,u,d;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));let f=Qn((o=this.joinInfo)===null||o===void 0?void 0:o.turnServer);if(z("NEW_TURN_MODE")&&f&&((u=this.joinInfo)===null||u===void 0?void 0:u.cloudProxyServer)==="disabled"){var g;let b=f.servers.map(M=>"turnServerURL"in M&&z("USE_TURN_IP")?Li(Li({},M),{},{turnServerURL:$b(M.turnServerURL)}):M),A=(g=f.serversFromGateway)===null||g===void 0?void 0:g.map(M=>z("USE_TURN_IP")?Li(Li({},M),{},{turnServerURL:$b(M.turnServerURL)}):M),F=this.signal.currentURLIndex;b.length>0&&(b=[b[F%b.length]],f.servers=b),Array.isArray(A)&&A.length>0&&(A=[A[0]],f.serversFromGateway=A),k.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(F))}let{iceParameters:y,dtlsParameters:v,rtpCapabilities:R}=await ei(this,Vr.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:f,cloudProxyServer:(d=this.joinInfo)===null||d===void 0?void 0:d.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:y,dtlsParameters:v,rtpCapabilities:R,version:"2"}}))}catch(b){n(b)}}),this.signal.on(rt.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(rt.REPORT_JOIN_GATEWAY,(t,n)=>{if(!this.joinInfo)return;let s,o="";var u;t instanceof he?(s=((u=t.data)===null||u===void 0?void 0:u.desc)||t.code,o=t.message):s=t,tt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:s,errorMsg:o,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload})}),this.signal.on(rt.IS_P2P_DISCONNECTED,t=>{t(Pm(this,Vr.IS_P2P_DISCONNECTED))}),this.signal.on(rt.DISCONNECT_P2P,()=>{this.emit(Vr.DISCONNECT_P2P)}),this.signal.on(rt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(rt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(rt.JOIN_RESPONSE,t=>{let n=this.getCurrentGatewayAddress();this.emit(Vr.JOIN_RESPONSE,t,n)}),this.signal.on(rt.PRE_CONNECT_PC,async(t,n)=>{if(this.joinInfo){var s,o;this.updateTurnConfigFromSignal();let d=this.getCurrentGatewayAddress(),f=Qn((s=this.joinInfo)===null||s===void 0?void 0:s.turnServer);if(z("NEW_TURN_MODE")&&f&&((o=this.joinInfo)===null||o===void 0?void 0:o.cloudProxyServer)==="disabled"){var u;let y=f.servers.map(b=>"turnServerURL"in b&&z("USE_TURN_IP")?Li(Li({},b),{},{turnServerURL:$b(b.turnServerURL)}):b),v=(u=f.serversFromGateway)===null||u===void 0?void 0:u.map(b=>z("USE_TURN_IP")?Li(Li({},b),{},{turnServerURL:$b(b.turnServerURL)}):b),R=this.signal.currentURLIndex;y.length>0&&(y=[y[R%y.length]],f.servers=y),Array.isArray(v)&&v.length>0&&(v=[v[0]],f.serversFromGateway=v),k.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(R,",in pre pc"))}let g=z("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(d&&g){let y=c8(d);ei(this,Vr.PRE_CONNECT_PC,{candidates:y,fingerprint:g,turnServer:f}).then(v=>{t?.(v)}).catch(n||(()=>{}))}}}),this.signal.on(rt.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof z("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(z("AP_REQUEST_DETAIL"),";").concat(t))}),this.signal.on(rt.VOS_FALLBACK,t=>{this.emit(Vr.VOS_FALLBACK,t)}),this.signal.on(rt.DATACHANNEL_FAILBACK,t=>{k.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(Vr.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(t,n){try{await this.signal.request(ct.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(s){throw k.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),s),s}}async tryUnsubDataChannelBeforeResub(t,n){try{await this.signal.request(ct.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(s){throw k.warning("unsubscribe datachannel warning",s),s}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(ct.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(s){throw k.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),s),s}}async tryUnpubDataChannelBeforeRepub(t,n){try{await this.signal.request(ct.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(s){throw k.warning("unpublish datastream warning: ",s),s}}async tryMassUnsubBeforeResub(t){let n={users:t.map(s=>({stream_id:s.stream_id,stream_type:s.stream_type}))};try{await this.signal.request(ct.UNSUBSCRIBE_STREAMS,n,!0)}catch(s){throw k.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),s),s}}async muteLocal(t,n){let s={action:t.find(o=>o.stream_type===On.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(ct.CONTROL,s,!0,!0)}catch(o){throw k.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),o),o}}async unmuteLocal(t,n){let s={action:t.find(o=>o.stream_type===On.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(ct.CONTROL,s,!0,!0)}catch(o){throw k.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),o),o}}async muteRemote(t,n){let s={action:t===et.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(ct.CONTROL,s,!0,!0)}catch(o){throw k.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),o),o}}async unmuteRemote(t,n){let s={action:t===et.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(ct.CONTROL,s,!0,!0)}catch(o){throw k.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),o),o}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){let n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(ct.RESTART_ICE,n,!0)}catch(s){throw k.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),s),s}}reconnect(t,n){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,n||ts.P2P_FAILED)}getCurrentGatewayAddress(){var t,n;if(!z("GATEWAY_WSS_ADDRESS"))return z("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(k.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(ct.SET_PARAMETER,{enablePublishAudioFilter:t})}downgradeCodec(t){this.signal.downgradeCodec(t)}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(tn.FALLBACK)),this.store.useDcSignal=!1,this.signal=new JW(Li(Li({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(Vr.RESET_SIGNAL)}}let iI=0,gD=0;function Yl(e,t,n,s){return new We((o,u)=>{t.timeout=t.timeout||z("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),iI+=Xu(t.data)):n&&(t.data.size?iI+=t.data.size:t.data instanceof FormData?iI+=q4(t.data):iI+=Xu(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,oa.request(t).then(d=>{typeof d.data=="string"?gD+=Xu(d.data):d.data instanceof ArrayBuffer||d.data instanceof Uint8Array?gD+=d.data.byteLength:gD+=Xu(JSON.stringify(d.data)),s&&o({data:d.data,headers:d.headers}),o(d.data)}).catch(d=>{oa.isCancel(d)?u(new he(Y.OPERATION_ABORTED,"cancel token canceled")):d.code==="ECONNABORTED"?u(new he(Y.NETWORK_TIMEOUT,d.message)):d.response?u(new he(Y.NETWORK_RESPONSE_ERROR,d.response.status)):u(new he(Y.NETWORK_ERROR,d.message))})})}(function(){var e;function t(Ce){var Ve=0;return function(){return Ve<Ce.length?{done:!1,value:Ce[Ve++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(Ce,Ve,Ze){return Ce==Array.prototype||Ce==Object.prototype||(Ce[Ve]=Ze.value),Ce},s,o=(function(Ce){Ce=[typeof globalThis=="object"&&globalThis,Ce,typeof window=="object"&&window,typeof self=="object"&&self,typeof c=="object"&&c];for(var Ve=0;Ve<Ce.length;++Ve){var Ze=Ce[Ve];if(Ze&&Ze.Math==Math)return Ze}throw Error("Cannot find global object")})(this);function u(Ce,Ve){if(Ve)e:{var Ze=o;Ce=Ce.split(".");for(var Ae=0;Ae<Ce.length-1;Ae++){var L=Ce[Ae];if(!(L in Ze))break e;Ze=Ze[L]}(Ve=Ve(Ae=Ze[Ce=Ce[Ce.length-1]]))!=Ae&&Ve!=null&&n(Ze,Ce,{configurable:!0,writable:!0,value:Ve})}}function d(Ce){return(Ce={next:Ce})[Symbol.iterator]=function(){return this},Ce}function f(Ce){var Ve=typeof Symbol<"u"&&Symbol.iterator&&Ce[Symbol.iterator];return Ve?Ve.call(Ce):{next:t(Ce)}}if(u("Symbol",function(Ce){function Ve(L,J){this.A=L,n(this,"description",{configurable:!0,writable:!0,value:J})}if(Ce)return Ce;Ve.prototype.toString=function(){return this.A};var Ze="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Ae=0;return function L(J){if(this instanceof L)throw new TypeError("Symbol is not a constructor");return new Ve(Ze+(J||"")+"_"+Ae++,J)}}),u("Symbol.iterator",function(Ce){if(Ce)return Ce;Ce=Symbol("Symbol.iterator");for(var Ve="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Ze=0;Ze<Ve.length;Ze++){var Ae=o[Ve[Ze]];typeof Ae=="function"&&typeof Ae.prototype[Ce]!="function"&&n(Ae.prototype,Ce,{configurable:!0,writable:!0,value:function(){return d(t(this))}})}return Ce}),typeof Object.setPrototypeOf=="function")s=Object.setPrototypeOf;else{var g;e:{var y={};try{y.__proto__={a:!0},g=y.a;break e}catch{}g=!1}s=g?function(Ce,Ve){if(Ce.__proto__=Ve,Ce.__proto__!==Ve)throw new TypeError(Ce+" is not extensible");return Ce}:null}var v=s;function R(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function b(Ce){if(Ce.m)throw new TypeError("Generator is already running");Ce.m=!0}function A(Ce,Ve){return Ce.h=3,{value:Ve}}function F(Ce){this.g=new R,this.G=Ce}function M(Ce,Ve,Ze,Ae){try{var L=Ve.call(Ce.g.j,Ze);if(!(L instanceof Object))throw new TypeError("Iterator result "+L+" is not an object");if(!L.done)return Ce.g.m=!1,L;var J=L.value}catch(ie){return Ce.g.j=null,Ce.g.s(ie),j(Ce)}return Ce.g.j=null,Ae.call(Ce.g,J),j(Ce)}function j(Ce){for(;Ce.g.h;)try{var Ve=Ce.G(Ce.g);if(Ve)return Ce.g.m=!1,{value:Ve.value,done:!1}}catch(Ze){Ce.g.v=void 0,Ce.g.s(Ze)}if(Ce.g.m=!1,Ce.g.l){if(Ve=Ce.g.l,Ce.g.l=null,Ve.F)throw Ve.D;return{value:Ve.return,done:!0}}return{value:void 0,done:!0}}function K(Ce){this.next=function(Ve){return Ce.o(Ve)},this.throw=function(Ve){return Ce.s(Ve)},this.return=function(Ve){return(function(Ze,Ae){b(Ze.g);var L=Ze.g.j;return L?M(Ze,"return"in L?L.return:function(J){return{value:J,done:!0}},Ae,Ze.g.return):(Ze.g.return(Ae),j(Ze))})(Ce,Ve)},this[Symbol.iterator]=function(){return this}}function q(Ce,Ve){return Ve=new K(new F(Ve)),v&&Ce.prototype&&v(Ve,Ce.prototype),Ve}if(R.prototype.o=function(Ce){this.v=Ce},R.prototype.s=function(Ce){this.l={D:Ce,F:!0},this.h=this.C||this.u},R.prototype.return=function(Ce){this.l={return:Ce},this.h=this.u},F.prototype.o=function(Ce){return b(this.g),this.g.j?M(this,this.g.j.next,Ce,this.g.o):(this.g.o(Ce),j(this))},F.prototype.s=function(Ce){return b(this.g),this.g.j?M(this,this.g.j.throw,Ce,this.g.o):(this.g.s(Ce),j(this))},u("Array.prototype.entries",function(Ce){return Ce||function(){return(function(Ve,Ze){Ve instanceof String&&(Ve+="");var Ae=0,L=!1,J={next:function(){if(!L&&Ae<Ve.length){var ie=Ae++;return{value:Ze(ie,Ve[ie]),done:!1}}return L=!0,{done:!0,value:void 0}}};return J[Symbol.iterator]=function(){return J},J})(this,function(Ve,Ze){return[Ve,Ze]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var Q=function(Ce,Ve){for(var Ze=0;Ze<Ce.length;Ze++)Ve(Ce[Ze])},se=function(Ce){return Ce.replace(/\r?\n|\r/g,`\r
`)},oe=function(Ce,Ve,Ze){return Ve instanceof Blob?(Ze=Ze!==void 0?Ze+"":typeof Ve.name=="string"?Ve.name:"blob",Ve.name===Ze&&Object.prototype.toString.call(Ve)!=="[object Blob]"||(Ve=new File([Ve],Ze)),[String(Ce),Ve]):[String(Ce),String(Ve)]},ne=function(Ce,Ve){if(Ce.length<Ve)throw new TypeError(Ve+" argument required, but only "+Ce.length+" present.")},de=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,we=de.FormData,Oe=de.XMLHttpRequest&&de.XMLHttpRequest.prototype.send,Qe=de.Request&&de.fetch,at=de.navigator&&de.navigator.sendBeacon,Xt=de.Element&&de.Element.prototype,Lt=de.Symbol&&Symbol.toStringTag;Lt&&(Blob.prototype[Lt]||(Blob.prototype[Lt]="Blob"),"File"in de&&!File.prototype[Lt]&&(File.prototype[Lt]="File"));try{new File([],"")}catch{de.File=function(Ce,Ve,Ze){return Ce=new Blob(Ce,Ze||{}),Object.defineProperties(Ce,{name:{value:Ve},lastModified:{value:+(Ze&&Ze.lastModified!==void 0?new Date(Ze.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Lt&&Object.defineProperty(Ce,Lt,{value:"File"}),Ce}}var jt=function(Ce){return Ce.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},En=function(Ce){this.i=[];var Ve=this;Ce&&Q(Ce.elements,function(Ze){if(Ze.name&&!Ze.disabled&&Ze.type!=="submit"&&Ze.type!=="button"&&!Ze.matches("form fieldset[disabled] *"))if(Ze.type==="file"){var Ae=Ze.files&&Ze.files.length?Ze.files:[new File([],"",{type:"application/octet-stream"})];Q(Ae,function(L){Ve.append(Ze.name,L)})}else Ze.type==="select-multiple"||Ze.type==="select-one"?Q(Ze.options,function(L){!L.disabled&&L.selected&&Ve.append(Ze.name,L.value)}):Ze.type==="checkbox"||Ze.type==="radio"?Ze.checked&&Ve.append(Ze.name,Ze.value):(Ae=Ze.type==="textarea"?se(Ze.value):Ze.value,Ve.append(Ze.name,Ae))})};if((e=En.prototype).append=function(Ce,Ve,Ze){ne(arguments,2),this.i.push(oe(Ce,Ve,Ze))},e.delete=function(Ce){ne(arguments,1);var Ve=[];Ce=String(Ce),Q(this.i,function(Ze){Ze[0]!==Ce&&Ve.push(Ze)}),this.i=Ve},e.entries=function Ce(){var Ve,Ze=this;return q(Ce,function(Ae){if(Ae.h==1&&(Ve=0),Ae.h!=3)return Ve<Ze.i.length?Ae=A(Ae,Ze.i[Ve]):(Ae.h=0,Ae=void 0),Ae;Ve++,Ae.h=2})},e.forEach=function(Ce,Ve){ne(arguments,1);for(var Ze=f(this),Ae=Ze.next();!Ae.done;Ae=Ze.next()){var L=f(Ae.value);Ae=L.next().value,L=L.next().value,Ce.call(Ve,L,Ae,this)}},e.get=function(Ce){ne(arguments,1);var Ve=this.i;Ce=String(Ce);for(var Ze=0;Ze<Ve.length;Ze++)if(Ve[Ze][0]===Ce)return Ve[Ze][1];return null},e.getAll=function(Ce){ne(arguments,1);var Ve=[];return Ce=String(Ce),Q(this.i,function(Ze){Ze[0]===Ce&&Ve.push(Ze[1])}),Ve},e.has=function(Ce){ne(arguments,1),Ce=String(Ce);for(var Ve=0;Ve<this.i.length;Ve++)if(this.i[Ve][0]===Ce)return!0;return!1},e.keys=function Ce(){var Ve,Ze,Ae,L,J=this;return q(Ce,function(ie){if(ie.h==1&&(Ve=f(J),Ze=Ve.next()),ie.h!=3)return Ze.done?void(ie.h=0):(Ae=Ze.value,L=f(Ae),A(ie,L.next().value));Ze=Ve.next(),ie.h=2})},e.set=function(Ce,Ve,Ze){ne(arguments,2),Ce=String(Ce);var Ae=[],L=oe(Ce,Ve,Ze),J=!0;Q(this.i,function(ie){ie[0]===Ce?J&&(J=!Ae.push(L)):Ae.push(ie)}),J&&Ae.push(L),this.i=Ae},e.values=function Ce(){var Ve,Ze,Ae,L,J=this;return q(Ce,function(ie){if(ie.h==1&&(Ve=f(J),Ze=Ve.next()),ie.h!=3)return Ze.done?void(ie.h=0):(Ae=Ze.value,(L=f(Ae)).next(),A(ie,L.next().value));Ze=Ve.next(),ie.h=2})},En.prototype._asNative=function(){for(var Ce=new we,Ve=f(this),Ze=Ve.next();!Ze.done;Ze=Ve.next()){var Ae=f(Ze.value);Ze=Ae.next().value,Ae=Ae.next().value,Ce.append(Ze,Ae)}return Ce},En.prototype._blob=function(){var Ce="----formdata-polyfill-"+Math.random(),Ve=[],Ze="--"+Ce+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Ae,L){return typeof Ae=="string"?Ve.push(Ze+jt(se(L))+`"\r
\r
`+se(Ae)+`\r
`):Ve.push(Ze+jt(se(L))+'"; filename="'+jt(Ae.name)+`"\r
Content-Type: `+(Ae.type||"application/octet-stream")+`\r
\r
`,Ae,`\r
`)}),Ve.push("--"+Ce+"--"),new Blob(Ve,{type:"multipart/form-data; boundary="+Ce})},En.prototype[Symbol.iterator]=function(){return this.entries()},En.prototype.toString=function(){return"[object FormData]"},Xt&&!Xt.matches&&(Xt.matches=Xt.matchesSelector||Xt.mozMatchesSelector||Xt.msMatchesSelector||Xt.oMatchesSelector||Xt.webkitMatchesSelector||function(Ce){for(var Ve=(Ce=(this.document||this.ownerDocument).querySelectorAll(Ce)).length;0<=--Ve&&Ce.item(Ve)!==this;);return-1<Ve}),Lt&&(En.prototype[Lt]="FormData"),Oe){var lr=de.XMLHttpRequest.prototype.setRequestHeader;de.XMLHttpRequest.prototype.setRequestHeader=function(Ce,Ve){lr.call(this,Ce,Ve),Ce.toLowerCase()==="content-type"&&(this.B=!0)},de.XMLHttpRequest.prototype.send=function(Ce){Ce instanceof En?(Ce=Ce._blob(),this.B||this.setRequestHeader("Content-Type",Ce.type),Oe.call(this,Ce)):Oe.call(this,Ce)}}Qe&&(de.fetch=function(Ce,Ve){return Ve&&Ve.body&&Ve.body instanceof En&&(Ve.body=Ve.body._blob()),Qe.call(this,Ce,Ve)}),at&&(de.navigator.sendBeacon=function(Ce,Ve){return Ve instanceof En&&(Ve=Ve._asNative()),at.call(this,Ce,Ve)}),de.FormData=En}})();let HT=()=>{let e=z("AREAS");return e.length===0&&e.push(yn.GLOBAL),ta(e).call(e,(t,n,s)=>{let o=y8(n);return o?s===0?o:"".concat(t,",").concat(o):t},"")},y8=e=>e===yn.OVERSEA?"".concat(ps.ASIA,",").concat(ps.EUROPE,",").concat(ps.AFRICA,",").concat(ps.NORTH_AMERICA,",").concat(ps.SOUTH_AMERICA,",").concat(ps.OCEANIA):ps[e],uhe=e=>{let t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(n=>{let s=qb[n],o=Object.keys(s);o&&o.map(u=>{u!=="CODE"&&(t[u]=t[u].concat(s[u]))})}),t},sI={GLOBAL:{ASIA:[yn.CHINA,yn.JAPAN,yn.INDIA,yn.KOREA,yn.HKMC],EUROPE:[],NORTH_AMERICA:[yn.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},aI=Object.keys(sI[yn.GLOBAL]),_D=[yn.CHINA,yn.NORTH_AMERICA,yn.EUROPE,yn.ASIA,yn.JAPAN,yn.INDIA,yn.OCEANIA,yn.SOUTH_AMERICA,yn.AFRICA,yn.KOREA,yn.HKMC,yn.US],dhe=function(e,t){let n=[];if(ke(e).call(e,yn.GLOBAL)){let u=[yn.GLOBAL,yn.OVERSEA],d=Object.keys(qb);if(t===yn.GLOBAL)throw new he(Y.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===yn.CHINA)n=[yn.OVERSEA];else if(o=t,ke(aI).call(aI,o)){let f=(s=t,sI[yn.GLOBAL][s]||[]),g=[...u,t,...f];n=d.filter(y=>!ke(g).call(g,y))}else if((function(f){let g=!1;return aI.forEach(y=>{var v;ke(v=sI[yn.GLOBAL][y]).call(v,f)&&(g=!0)}),g})(t)){let f=(function(y){let v;return aI.forEach(R=>{var b;ke(b=sI[yn.GLOBAL][R]).call(b,y)&&(v=R)}),v})(t),g=[...u,f,t];n=d.filter(y=>!ke(g).call(g,y))}else n=e;n=(function(f){let g=[];return _D.forEach(y=>{ke(f).call(f,y)&&g.push(y)}),g.concat(f.filter(y=>!ke(_D).call(_D,y)))})(n)}else n=e;var s,o;return n};function v8(e){var t,n;if(!e&&ke(t=z("AREAS")).call(t,yn.EXTENSIONS))return k.debug("update area from ap : reset"),void ED(vde,!0);if(!ke(n=z("AREAS")).call(n,yn.GLOBAL)||!e)return;let s=qb.EXTENSIONS;s&&(s={CODE:y8(yn.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},k.debug("update area from ap success: ".concat(e,",config is "),s),Ln("AREAS",[yn.EXTENSIONS],!0),Object.keys(s).map(o=>{o==="LOG_UPLOAD_SERVER"||o==="EVENT_REPORT_DOMAIN"||o==="EVENT_REPORT_BACKUP_DOMAIN"||o==="PROXY_SERVER_TYPE3"?Ln(o,s[o][0]):Ln(o,s[o])}))}function ED(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],n=tt.reportApiInvoke(null,{name:or.SET_AREA,options:e,tag:Fn.TRACER});try{let s=[];if(typeof e=="string"&&(s=[e]),Array.isArray(e)&&(e.forEach(u=>{if(!ke(GW).call(GW,u))throw new he(Y.INVALID_PARAMS,"invalid area code")}),s=e),Object.prototype.toString.call(e)==="[object Object]"){let{areaCode:u,excludedArea:d}=e;if(!u)throw new he(Y.INVALID_PARAMS,"area code is needed");let f=u;typeof u=="string"&&(f=[u]),s=d?dhe(f,d):f}if(!t){if(fo.AREAS){let u=new he(Y.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(u),void k.warning("setArea is prohibited because of config-distribute")}if(ke(s).call(s,yn.GLOBAL)&&z("AREAS")===yn.EXTENSIONS){let u=new he(Y.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(u),void k.warning("setArea is prohibited because of ap extensions")}}Ln("AREAS",s,t);let o=uhe(s);Object.keys(o).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?Ln(u,o[u][0]):Ln(u,o[u])}),k.debug("set area success:",s.join(","))}catch(s){throw n.onError(s),s}n.onSuccess()}function S8(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function nd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?S8(Object(n),!0).forEach(function(s){V(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S8(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}let yD=1;function hhe(e,t,n,s,o){yD+=1;let u={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:yD,requestId:yD,version:Xo,cname:n.cname},d={service_name:t,json_body:JSON.stringify(u)},f,g,y=e[0];return Bl(async()=>{f=Date.now();let v=await Yl(y,{data:d,cancelToken:s,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(g=Date.now()-f,v.code!==0){let A=new he(Y.UNEXPECTED_RESPONSE,"live streaming ap error, code"+v.code,{retry:!0,responseTime:g});throw k.error(A.toString()),A}let R=JSON.parse(v.json_body);if(R.code!==200){let A=new he(Y.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(R.code,", reason: ").concat(R.reason),{code:R.code,responseTime:g});throw k.error(A.toString()),A}if(!R.servers||R.servers.length===0){let A=new he(Y.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:R.code,responseTime:g});throw k.error(A.toString()),A}let b=(function(A,F){return{addressList:A.servers.map(M=>"wss://".concat(M.address.replace(/\./g,"-"),".").concat(z("WORKER_DOMAIN"),":").concat(M.wss,"?serviceName=").concat(encodeURIComponent(F))),workerToken:A.workerToken,vid:A.vid}})(R,t);return z("LIVE_STREAMING_ADDRESS")&&(b.addressList=z("LIVE_STREAMING_ADDRESS")instanceof Array?z("LIVE_STREAMING_ADDRESS"):[z("LIVE_STREAMING_ADDRESS")]),nd(nd({},b),{},{responseTime:g})},(v,R)=>(tt.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(v.addressList),firstSuccess:R===0,responseTime:g,serverIp:e[R%e.length]}),!1),(v,R)=>(tt.apworkerEvent(n.sid,{success:!1,sc:v.data&&v.data.code||200,serviceName:t,responseTime:g,serverIp:e[R%e.length]}),!!(v.code!==Y.OPERATION_ABORTED&&v.code!==Y.UNEXPECTED_RESPONSE||v.data&&v.data.retry)&&(y=e[(R+1)%e.length],!0)),o)}let vD=1;function T8(e,t,n,s){let{url:o,areaCode:u}=e,{clientId:d,sid:f}=t,g=Date.now(),y,v=t.role,[R,b]=TD(t,u,[Yr.CHOOSE_SERVER]),A=Cr.networkState;return Bl(async()=>{A&&Cr.networkState===Gs.OFFLINE&&Cr.onlineWaiter&&await We.race([Cr.onlineWaiter,Ci(s&&s.maxRetryTimeout||Kr.maxRetryTimeout)]),A=Cr.networkState;let{data:F,headers:M}=await Yl(o,{data:R,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);y=M.http3==="1"?1:-1,tt.reportResourceTiming(o,f),C8(F,o,t,g,[Yr.CHOOSE_SERVER],y);let j=VT(F,Yr.CHOOSE_SERVER);return SD(j),oD(j,o)},F=>(F&&tt.joinChooseServer(f,{role:v,lts:g,succ:!0,csAddr:o,opid:b,serverList:F.gatewayAddrs.map(M=>M.address),ec:null,cid:F.cid.toString(),uid:F.uid.toString(),csIp:F.csIp,unilbsServerIds:[Yr.CHOOSE_SERVER].toString(),isHttp3:y,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:F.res.detail&&F.res.detail[38],vid:F.vid}),!1),F=>F.code!==Y.OPERATION_ABORTED&&(F.code===Y.CAN_NOT_GET_GATEWAY_SERVER?F.data.retry:(tt.joinChooseServer(f,{role:v,lts:g,succ:!1,csAddr:o,serverList:null,opid:b,ec:F.code,csIp:F.data&&F.data.csIp,unilbsServerIds:[Yr.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:A}),isHttp3:y,corssRegionTagReq:t.apRequestDetail}),k.warning("[".concat(d||"sid-".concat(f.slice(0,6)),"] Choose server network error, retry"),F),!0)),s)}function w8(e,t,n,s){let o,{url:u,areaCode:d,serviceIds:f}=e,g=Date.now(),y=t.role,[v,R]=TD(t,d,f),b;return Bl(async()=>{b&&Cr.networkState===Gs.OFFLINE&&Cr.onlineWaiter&&await We.race([Cr.onlineWaiter,Ci(s&&s.maxRetryTimeout||Kr.maxRetryTimeout)]),b=Cr.networkState;let{data:A,headers:F}=await Yl(u,{data:v,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);o=F.http3==="1"?1:-1,tt.reportResourceTiming(u,t.sid),C8(A,u,t,g,f,o);let M=VT(A,Yr.CHOOSE_SERVER),j=VT(A,t.cloudProxyServer==="proxy5"?Yr.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Yr.CLOUD_PROXY:Yr.CLOUD_PROXY_FALLBACK),K=performance.getEntriesByName(u),q=K[K.length-1],Q;return q&&(Q={name:q.name,protocol:"nextHopProtocol"in q?q.nextHopProtocol:"",dnscost:"domainLookupEnd"in q&&"domainLookupStart"in q&&typeof q.domainLookupEnd=="number"&&typeof q.domainLookupStart=="number"?q.domainLookupEnd-q.domainLookupStart:-1,tcpTlsCost:"connectEnd"in q&&"connectStart"in q&&typeof q.connectEnd=="number"&&typeof q.connectStart=="number"?q.connectEnd-q.connectStart:-1,reqCost:"requestStart"in q&&typeof q.requestStart=="number"&&"responseEnd"in q&&typeof q.responseEnd=="number"?q.responseEnd-q.requestStart:-1,handleCost:"leave_ts"in A&&"enter_ts"in A&&typeof A.leave_ts=="number"&&typeof A.enter_ts=="number"?A.leave_ts-A.enter_ts:-1}),SD(M),{gatewayInfo:oD(M,u),proxyInfo:j,url:u,resourceTimingInfo:Q}},A=>{var F;return A.gatewayInfo&&tt.joinChooseServer(t.sid,{role:y,lts:g,succ:!0,csAddr:u,serverList:A.gatewayInfo.gatewayAddrs.map(M=>M.address),ec:null,opid:R,cid:A.gatewayInfo.cid.toString(),uid:A.gatewayInfo.uid.toString(),csIp:A.gatewayInfo.csIp,unilbsServerIds:f.toString(),isHttp3:o,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:A.gatewayInfo.res.detail&&A.gatewayInfo.res.detail[38],vid:(F=A.gatewayInfo)===null||F===void 0?void 0:F.vid,resourceTimingInfo:A.resourceTimingInfo?JSON.stringify(A.resourceTimingInfo):void 0}),A.proxyInfo&&tt.joinWebProxyAP(t.sid,{lts:g,sucess:1,apServerAddr:u,turnServerAddrList:A.proxyInfo.addresses.map(M=>M.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:f.toString()}),!1},A=>A.code!==Y.OPERATION_ABORTED&&(A.code===Y.CAN_NOT_GET_GATEWAY_SERVER?A.data.retry:(tt.joinWebProxyAP(t.sid,{lts:g,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:A.code,eventType:t.cloudProxyServer,unilbsServerIds:f.toString(),extend:JSON.stringify({networkState:b})}),k.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),A),!0)),s)}let C8=(e,t,n,s,o,u)=>{let{sid:d,clientId:f,cloudProxyServer:g}=n,y=[],v=R=>{R.flag===4096?tt.joinChooseServer(d,{role:n.role,lts:s,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:R.error.message,csIp:R.error.data&&R.error.data.csIp,unilbsServerIds:o.toString(),isHttp3:u,corssRegionTagReq:n.apRequestDetail}):R.flag!==1048576&&R.flag!==4194304&&R.flag!==4194310||tt.joinWebProxyAP(d,{lts:s,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:R.error.code,eventType:g,unilbsServerIds:o.toString()})};if(e.response_body.forEach(R=>{let b=R.buffer.code;if(R.uri===23&&b===0&&!R.buffer.edges_services)if(R.buffer.flag===4194310)k.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),R.buffer.edges_services=[];else{let A={error:new he(Y.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:z("NO_EDGES_RETRY"),csIp:e.detail[502]}),flag:R.buffer.flag};y.push(A),v(A)}if(b!==0){let A=zE(b),F={error:new he(Y.CAN_NOT_GET_GATEWAY_SERVER,A.desc,{desc:A.desc,retry:A.retry,csIp:e.detail[502]}),flag:R.buffer.flag};R.buffer.flag===4194310?k.warning(F.error.toString()):y.push(F),v(F)}}),y.length)throw k.warning("[".concat(f||"sid-".concat(d.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(y.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message,", retry: ").concat(R.error.data.retry)).join(" | "))),new he(Y.CAN_NOT_GET_GATEWAY_SERVER,y.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message)).join(" | "),{retry:!!y.find(R=>R.error.data.retry),csIp:e.detail[502],desc:[...new Set(y.map(R=>{var b;return R==null||(b=R.error)===null||b===void 0||(b=b.data)===null||b===void 0?void 0:b.desc}).filter(R=>!!R))]})},SD=e=>{var t,n,s,o;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new he(Y.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(z("AP_AREA")&&((s=e.detail)!==null&&s!==void 0&&s[23]&&typeof((o=e.detail)===null||o===void 0?void 0:o[23])=="string"?v8(e.detail[23].toLowerCase()):v8()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){let d=e.detail[19],f=d?.split(";");for(let g=0;g<f.length;g++){var u;let y=Bs(u=f[g]).call(u);e.addresses[g]&&f&&(e.addresses[g].fingerprint=y)}}if(z("GATEWAY_ADDRESS")&&z("GATEWAY_ADDRESS").length>0){k.debug("assign gateway address to",z("GATEWAY_ADDRESS"));let d=z("GATEWAY_ADDRESS").map(f=>{var g,y;let v=(g=(y=e.addresses.find(R=>R.ip===f.ip&&R.port===f.port))===null||y===void 0?void 0:y.fingerprint)!==null&&g!==void 0?g:"";return{ip:f.ip,port:f.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:f.fingerprint||v}});e.addresses=d}},phe=(e,t)=>{if(e.response_body&&e.response_body.length){let n=e.response_body[0];if(n.buffer.code!==0){let s=zE(n.buffer.code);throw new he(Y.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(s.desc),{retry:s.retry})}return n.buffer.ticket}throw k.debug("update ticket request received ap response without response body:",t),new he(Y.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},TD=(e,t,n)=>{let s=Math.floor(Math.random()*1e12),o=e.role==="host"?"1":e.role==="audience"?"2":void 0,u={appid:e.appId,client_ts:Date.now(),opid:s,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:nd(nd(nd({6:e.stringUid,11:t,12:z("USE_NEW_TOKEN")?"1":void 0},o?{17:o}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};u.request_bodies.forEach(f=>{e.multiIP&&e.multiIP.gateway_ip&&(f.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});let d=new FormData;return d.append("request",JSON.stringify(u)),[d,s]},fhe=(e,t)=>{let n=Math.floor(Math.random()*1e12),s={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(u=>({ip:u.ip,port:u.port}))}}]},o=new FormData;return o.append("request",JSON.stringify(s)),[o,n]},qE=0;function XE(e){return We.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}let zT=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:s,allFailedhandler:o,promisesCollector:u}=e,d=0,f=t,g,y=0,v=async()=>{let R=(()=>{let b=d*f,A=b+f;return n.slice(b,A).map(s)})();u&&u.push(...R);try{g=await XE(R)}catch(b){if(y+=f,d++,!(y>=n.length))return void await v();o(b)}R.forEach(b=>b.cancel())};return await v(),g},R8=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:s}=e,o=t.length,u=0,d=async()=>{let f=n(t.shift());try{return await f}catch(g){if(u++,u>=o||s!=null&&s(g))throw g;return d()}};return d()};async function mhe(){if(typeof VideoDecoder>"u")return!0;let e,t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],n=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],s=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],o=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],u=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],d=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new We((f,g)=>{let y;(async function(){e&&e.state!=="closed"||await(async function(){e=new VideoDecoder({output:R=>{R.close(),clearTimeout(y),f(!0)},error:R=>{clearTimeout(y),f(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})})();let v=[t,n,s,o,u,d];for(let R=0;R<v.length;R++){let b=new EncodedVideoChunk({type:R==0?"key":"delta",timestamp:33333*R,duration:33333,data:new Uint8Array(v[R])});try{await e.decode(b)}catch{return void f(!1)}}})(),y=setTimeout(()=>{f(!1)},5e3)})}async function oI(e,t,n,s){return{gatewayInfo:await(async function(o,u,d,f){let g=null,y=[],v=async()=>{let b=z("WEBCS_DOMAIN").slice(0,z("AJAX_REQUEST_CONCURRENT")).map(M=>({url:o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(M+"/api/v2/transpond/webrtc?v=2"):"https://".concat(M,"/api/v2/transpond/webrtc?v=2"),areaCode:HT()})),A=f.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:b.map(M=>M.url)}),F=await zT({fragementLength:z("FRAGEMENT_LENGTH"),referenceList:b,asyncMapHandler:M=>(k.debug("[".concat(o.clientId,"] Connect to choose_server:"),M.url),T8(M,o,u,d)),allFailedhandler:M=>{throw f.recordJoinChannelService({endTs:Date.now(),status:"error",errors:M},A),M[0]},promisesCollector:y});return f.recordJoinChannelService({endTs:Date.now(),status:"success"},A),F},R=async()=>{if(await Ci(1e3),g!==null)return g;let b=z("WEBCS_DOMAIN_BACKUP_LIST").map(M=>({url:o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(M+"/api/v2/transpond/webrtc?v=2"):"https://".concat(M,"/api/v2/transpond/webrtc?v=2"),areaCode:HT()})),A=f.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:b.map(M=>M.url)}),F=await zT({fragementLength:z("FRAGEMENT_LENGTH"),referenceList:b,asyncMapHandler:M=>(k.debug("[".concat(o.clientId,"] Connect to backup choose_server:"),M.url),T8(M,o,u,d)),allFailedhandler:M=>{throw f.recordJoinChannelService({endTs:Date.now(),status:"error",errors:M},A),M[0]},promisesCollector:y});return f.recordJoinChannelService({endTs:Date.now(),status:"success"},A),F};try{return g=await XE([v(),R()]),y.length&&y.forEach(b=>b.cancel&&typeof b.cancel=="function"&&b.cancel()),g}catch(b){throw b[0]}})(e,t,n,s)}}async function b8(e,t,n,s,o){let u=e.cloudProxyServer;if(u==="disabled"){if(e.useLocalAccessPoint)return await oI(e,t,n,o);if(z("JOIN_WITH_FALLBACK_MEDIA_PROXY")){let{gatewayInfo:b,proxyInfo:A}=await O8(e,t,n,o);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:b};let F=A.map(M=>({turnServerURL:M.address,tcpport:M.tcpport||ns.tcpport,udpport:M.udpport||ns.udpport,username:M.username||ns.username,password:M.password||ns.password,forceturn:!1,security:!0}));if(o.useP2P){var d;let M=(d=e.uid)!==null&&d!==void 0?d:b.uid,j="glb:".concat(M.toString()),K=await ik(j),q=A.map(Q=>({turnServerURL:Q.address,tcpport:Q.tcpport||ns.tcpport,udpport:Q.udpport||ns.udpport,username:j,password:K,forceturn:!1,security:!0}));F.push(...q)}return e.turnServer={mode:"manual",servers:F},{gatewayInfo:b}}return await oI(e,t,n,o)}let{proxyInfo:f,gatewayInfo:g}=await O8(e,t,n,o),y={gatewayInfo:g},v=f.map(b=>({turnServerURL:b.address,tcpport:u==="proxy3"?void 0:b.tcpport?b.tcpport:ns.tcpport,udpport:u==="proxy4"?void 0:b.udpport?b.udpport:ns.udpport,username:b.username||ns.username,password:b.password||ns.password,forceturn:u!=="proxy4",security:u==="proxy5"}));if(o.useP2P){var R;let b=(R=e.uid)!==null&&R!==void 0?R:g.uid,A="glb:".concat(b.toString()),F=await ik(A),M=f.map(j=>({turnServerURL:j.address,tcpport:u==="proxy3"?void 0:j.tcpport||ns.tcpport,udpport:u==="proxy4"?void 0:j.udpport||ns.udpport,username:A,password:F,forceturn:u!=="proxy4",security:u==="proxy5"}));v.push(...M)}return e.turnServer={mode:"manual",servers:v},k.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(u)),y}async function I8(e,t,n,s,o){let u=z("ACCOUNT_REGISTER").slice(0,z("AJAX_REQUEST_CONCURRENT")),d=[];d=t.proxyServer?u.map(g=>"https://".concat(t.proxyServer,"/ap/?url=").concat(g+"/api/v1")):u.map(g=>"https://".concat(g,"/api/v1"));let f=o?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:d});try{let g=await(async function(y,v,R,b,A){let F=Date.now(),M={sid:R.sid,opid:10,appid:R.appId,string_uid:v},j=y[0],K=await Bl(()=>Yl(j+"".concat(j.indexOf("?")===-1?"?":"&","action=stringuid"),{data:M,cancelToken:b,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(q,Q)=>{if(q.code===0){if(q.uid<=0||q.uid>=Math.pow(2,32))throw k.error("Invalid Uint Uid ".concat(v," => ").concat(q.uid),q),tt.reqUserAccount(M.sid,{lts:F,success:!1,serverAddr:j,stringUid:M.string_uid,uid:q.uid,errorCode:Y.INVALID_UINT_UID_FROM_STRING_UID,extend:M}),new he(Y.INVALID_UINT_UID_FROM_STRING_UID);return tt.reqUserAccount(M.sid,{lts:F,success:!0,serverAddr:j,stringUid:M.string_uid,uid:q.uid,errorCode:null,extend:M}),!1}let se=zE(q.code);return se.retry&&(j=y[(Q+1)%y.length]),tt.reqUserAccount(M.sid,{lts:F,success:!1,serverAddr:j,stringUid:M.string_uid,uid:q.uid,errorCode:se.desc,extend:M}),se.retry},(q,Q)=>q.code!==Y.OPERATION_ABORTED&&(tt.reqUserAccount(M.sid,{lts:F,success:!1,serverAddr:j,stringUid:M.string_uid,uid:null,errorCode:q.code,extend:M}),j=y[(Q+1)%y.length],!0),A);if(K.code!==0){let q=zE(K.code);throw new he(Y.UNEXPECTED_RESPONSE,q.desc)}return K})(d,e,t,n,s);return o?.recordJoinChannelService({status:"success",endTs:Date.now()},f),g.uid}catch(g){throw o?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[g]},f),g}}async function ghe(e,t,n){let s=z("ACCOUNT_REGISTER"),o=[];o=t.proxyServer?s.map(u=>"https://".concat(t.proxyServer,"/ap/?url=").concat(u+"/api/v1")):s.map(u=>"https://".concat(u,"/api/v1"));try{return await R8({referenceList:o,asyncMapHandler:u=>(async function(d,f,g,y){let v=Date.now(),R={sid:g.sid,opid:10,appid:g.appId,string_uid:f};try{let b=await Yl(d+"".concat(d.indexOf("?")===-1?"?":"&","action=stringuid"),{data:R,cancelToken:y,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(b.code!==0){let A=zE(b.code);throw new he(Y.UNEXPECTED_RESPONSE,"preload sua error:".concat(A.desc),A)}if(b.uid<=0||b.uid>=Math.pow(2,32))throw new he(Y.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:v,url:d,req:R,uid:b.uid,elapse:Date.now()-v}}catch(b){throw b}})(u,e,t,n),closeFn:u=>u.code===Y.OPERATION_ABORTED||u.code===Y.UNEXPECTED_RESPONSE&&!u.data.retry})}catch(u){throw u}}async function _he(e,t,n){let s=z("CDS_AP").slice(0,z("AJAX_REQUEST_CONCURRENT")).map(g=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(g+"/api/v1"):"https://".concat(g,"/api/v1?action=config")),o=s.map(g=>(function(y,v,R,b){let A=pn(),F={flag:64,cipher_method:0,features:nd(nd(nd(nd(nd({install_id:_k(),device:A.name,system:A.os,system_general:navigator.userAgent,vendor:v.appId,version:Xo,cname:v.cname,session_id:v.sid,proxyServer:v.proxyServer,sdk_type:ohe.WEB_RTC,browser_name:A.name,browser_version:A.version,user_agent:navigator.userAgent,channel_name:v.cname},v.stringUid&&{string_uid:v.stringUid}),v.uid&&{uid:v.uid+""}),A.os&&{os_name:A.os}),A.osVersion&&{os_version:A.osVersion}),{},{detail:""})};return Bl(()=>Yl(y,{data:F,timeout:1e3,cancelToken:R,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,M=>M.code!==Y.OPERATION_ABORTED,b)})(g,e,t,n)),u=null,d=null,f={};try{u=await XE(o)}catch(g){if(g.code===Y.OPERATION_ABORTED)throw g;d=g}if(o.forEach(g=>g.cancel()),tt.reportApiInvoke(e.sid,{name:or.REQUEST_CONFIG_DISTRIBUTE,options:{error:d,res:u}}).onSuccess(),u&&u.test_tags)try{f=(function(g){if(!g.test_tags)return{};let y=g.test_tags,v=Object.keys(y),R={};return v.forEach(b=>{var A;let F=Bs(A=b.slice(4)).call(A),M=JSON.parse(y[b]),j=M[1];R[F]={tag:M[0]||"",value:j}}),R})(u)}catch{}return f}async function A8(e,t){let n=z("WEBCS_DOMAIN").concat(z("WEBCS_DOMAIN_BACKUP_LIST")).map(s=>({url:"https://".concat(s,"/api/v2/transpond/webrtc?v=2"),areaCode:HT(),serviceIds:[Yr.CHOOSE_SERVER,Yr.CLOUD_PROXY_FALLBACK]}));try{return await R8({referenceList:n,asyncMapHandler:s=>(async function(o,u,d){let f,{url:g,areaCode:y,serviceIds:v}=o,R=Date.now(),[b,A]=TD(u,y,v),F=Cr.networkState;try{F&&Cr.networkState===Gs.OFFLINE&&Cr.onlineWaiter&&await We.race([Cr.onlineWaiter,Ci(Kr.maxRetryTimeout)]),F=Cr.networkState;let{data:M,headers:j}=await Yl(g,{data:b,cancelToken:d,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);f=j.http3==="1"?1:-1,(Q=>{let se=[];if(Q.response_body.forEach(oe=>{let ne=oe.buffer.code;if(oe.uri===23&&ne===0&&!oe.buffer.edges_services)if(oe.buffer.flag===4194310)oe.buffer.edges_services=[];else{let de={error:new he(Y.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:z("NO_EDGES_RETRY"),csIp:Q.detail[502]}),flag:oe.buffer.flag};se.push(de)}if(ne!==0){let de=zE(ne),we={error:new he(Y.CAN_NOT_GET_GATEWAY_SERVER,de.desc,{desc:de.desc,retry:de.retry,csIp:Q.detail[502]}),flag:oe.buffer.flag};oe.buffer.flag===4194310?k.warning(we.error.toString()):se.push(we)}}),se.length)throw new he(Y.CAN_NOT_GET_GATEWAY_SERVER,se.map(oe=>"flag: ".concat(oe.flag,", message: ").concat(oe.error.message)).join(" | "),{retry:!!se.find(oe=>oe.error.data.retry),csIp:Q.detail[502],desc:[...new Set(se.map(oe=>{var ne;return oe==null||(ne=oe.error)===null||ne===void 0||(ne=ne.data)===null||ne===void 0?void 0:ne.desc}).filter(oe=>!!oe))]})})(M);let K=VT(M,Yr.CHOOSE_SERVER),q=VT(M,Yr.CLOUD_PROXY_FALLBACK);return SD(K),{gatewayInfo:oD(K,g),proxyInfo:q,opid:A,requestTime:R,url:g,isHttp3:f,elapse:Date.now()-R}}catch(M){throw M}})(s,e,t),closeFn:s=>s.code===Y.OPERATION_ABORTED||s.code===Y.CAN_NOT_GET_GATEWAY_SERVER&&!s.data.retry})}catch(s){throw s}}async function O8(e,t,n,s){let o=z("PROXY_SERVER_TYPE3"),u=(A,F,M)=>{let j=M||o;return Array.isArray(j)&&(j=F%2==0&&o[1]||o[0]),"https://".concat(j,"/ap/?url=").concat(A)},d=null,f=[],g=async()=>{let A=z("WEBCS_DOMAIN").slice(0,z("AJAX_REQUEST_CONCURRENT")).map((j,K)=>{let q;return q=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(j,"/api/v2/transpond/webrtc?v=2"),K,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):u("".concat(j,"/api/v2/transpond/webrtc?v=2"),K),{url:q,areaCode:HT(),serviceIds:[Yr.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Yr.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Yr.CLOUD_PROXY:Yr.CLOUD_PROXY_FALLBACK]}}),F=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:A.map(j=>j.url)}),M=await zT({fragementLength:z("FRAGEMENT_LENGTH"),referenceList:A,asyncMapHandler:j=>(k.debug("[".concat(e.clientId,"] Connect to choose_server:"),j.url),w8(j,e,t,n)),allFailedhandler:j=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},F),j[0]},promisesCollector:f});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},F),M},y=async()=>{if(await Ci(1e3),d!==null)return d;let A=z("WEBCS_DOMAIN_BACKUP_LIST").map((j,K)=>{let q;return q=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(j,"/api/v2/transpond/webrtc?v=2"),K,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):u("".concat(j,"/api/v2/transpond/webrtc?v=2"),K),{url:q,areaCode:HT(),serviceIds:[Yr.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Yr.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Yr.CLOUD_PROXY:Yr.CLOUD_PROXY_FALLBACK]}}),F=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:A.map(j=>j.url)}),M=await zT({fragementLength:z("FRAGEMENT_LENGTH"),referenceList:A,asyncMapHandler:j=>(k.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),j.url),w8(j,e,t,n)),allFailedhandler:j=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},F),j[0]},promisesCollector:f});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},F),M},v,R,b;try{({gatewayInfo:v,proxyInfo:R,url:b}=await XE([g(),y()]))}catch(A){throw A[0]}if(f.length&&f.forEach(A=>A.cancel&&typeof A.cancel=="function"&&A.cancel()),!v||!R)throw new he(Y.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=b,e.cloudProxyServer!=="disabled"&&Array.isArray(o)&&b){let A=/^https?:\/\/(.+?)(\/.*)?$/.exec(b)[1];ke(o).call(o,A)&&(e.proxyServer=A,k.setProxyServer(A),tt.setProxyServer(A))}return d={gatewayInfo:v,proxyInfo:await ZW(R,v.uid)},d}async function Ehe(e,t,n){let s=z("UAP_AP").slice(0,z("AJAX_REQUEST_CONCURRENT")).map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")),o=s.map(u=>(function(d,f,g,y){let v={command:"convergeAllocateEdge",sid:f.sid,appId:f.appId,token:f.token,ts:Date.now(),version:Xo,cname:f.cname,uid:f.uid.toString(),requestId:vD,seq:vD};vD+=1;let R={service_name:"tele_channel",json_body:JSON.stringify(v)};return Bl(async()=>{let b=await Yl(d,{data:R,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(b.code!==0){let F=new he(Y.UNEXPECTED_RESPONSE,"cross channel ap error, code"+b.code,{retry:!0});throw k.error(F.toString()),F}let A=JSON.parse(b.json_body);if(A.code!==200){let F=new he(Y.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(A.code,", reason: ").concat(A.reason));throw k.error(F.toString()),F}if(!A.servers||A.servers.length===0){let F=new he(Y.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw k.error(F.toString()),F}return{vid:A.vid,workerToken:A.workerToken,addressList:(z("CHANNEL_MEDIA_RELAY_SERVERS")||A.servers).map(F=>"wss://".concat(F.address.replace(/\./g,"-"),".").concat(z("WORKER_DOMAIN"),":").concat(F.wss))}},void 0,b=>!!(b.code!==Y.OPERATION_ABORTED&&b.code!==Y.UNEXPECTED_RESPONSE||b.data&&b.data.retry),y)})(u,e,t,n));try{let u=await XE(o);return o.forEach(d=>d.cancel()),u}catch(u){throw u[0]}}async function yhe(e,t,n){let s=null,o=[],u=async d=>{let f=z(d?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(g=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(g+"/api/v2/transpond/webrtc?v=2"):"https://".concat(g,"/api/v2/transpond/webrtc?v=2"));return d&&(await Ci(1e3),s!==null)?s:await zT({fragementLength:z("FRAGEMENT_LENGTH"),referenceList:f,asyncMapHandler:g=>(k.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(d?"backup":""," choose_server:"),g),(function(y,v,R,b){let[A]=fhe(v,[Yr.CHOOSE_SERVER]),F=Cr.networkState;return Bl(async()=>{F&&Cr.networkState===Gs.OFFLINE&&Cr.onlineWaiter&&await We.race([Cr.onlineWaiter,Ci(b&&b.maxRetryTimeout||Kr.maxRetryTimeout)]),F=Cr.networkState;let M=await Yl(y,{data:A,cancelToken:R,headers:{"Content-Type":"multipart/form-data;"}},!0);return phe(M,y)},()=>!1,M=>M.code!==Y.OPERATION_ABORTED&&(M.code===Y.UPDATE_TICKET_FAILED?M.data.retry:(k.warning("[".concat(v.clientId,"] update ticket network error, retry"),M),!0)),b)})(g,e,t,n)),allFailedhandler:g=>{throw g[0]},promisesCollector:o})};try{return s=await XE([u(!1),u(!0)]),o.length&&o.forEach(d=>d.cancel&&typeof d.cancel=="function"&&d.cancel()),s}catch(d){throw d[0]}}function N8(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function wD(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?N8(Object(n),!0).forEach(function(s){V(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N8(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}class vhe extends dr{get isSuccess(){return!!this.configs}constructor(t,n){super(),V(this,"configs",void 0),V(this,"store",void 0),V(this,"joinInfo",void 0),V(this,"cancelToken",void 0),V(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),V(this,"interval",void 0),V(this,"mutex",void 0),V(this,"mutableParamsRead",!1),V(this,"configCache",{}),V(this,"limit_bitrate",void 0),this.mutex=new ki("config-distribute",t),this.store=n}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),z("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},z("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,tt.reportApiInvoke(null,{options:void 0,name:or.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Fn.TRACER}).onSuccess(JSON.stringify(fo))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void k.debug("[config-distribute] get config distribute interrupted have no joininfo");let t,n=await this.mutex.lock();try{t=await _he(this.joinInfo,this.cancelToken,this.retryConfig),k.debug("[config-distribute] get config distribute",JSON.stringify(t));let s=(function(o){var u;let d=vm(u=Object.keys(o).filter(y=>/^webrtc_ng_global_parameter/.test(y))).call(u);for(let y=0;y<d.length;y++)for(let v=d.length-1;v>y;v--){let R=d[v],b=o[R].value;if(typeof b.__priority=="number"){let A=b.__priority,F=d[v-1],M=o[F].value;if(typeof M.__priority=="number"){if(!(A>M.__priority))continue;{let j=R;d[v]=d[v-1],d[v-1]=j}}else{let j=R;d[v]=d[v-1],d[v-1]=j}}}let f=Date.now(),g={};return d.forEach(y=>{let v=o[y].value.__expires;v&&v<=f||(g[y]=o[y])}),g})(t);this.cacheGlobalParameterConfig(s),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=s}catch(s){let o=new he(Y.NETWORK_RESPONSE_ERROR,s);k.warning("[config-distribute] ".concat(o.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){HW(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(Hl.UPDATE_BITRATE_LIMIT,t):this.emit(Hl.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&wD({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{let n={},s=Object.keys(t),o=[];s.forEach(u=>{let d=t[u].value;n[u]=d;let f=d.__id;if(f&&this.configCache[u]&&this.configCache[u].__id===f)return;let g=d.__type,y=t[u].value,v=t[u].tag,R=0;g?g===l5.REALTIME&&(R=1):Object.keys(y).some(b=>Object.prototype.hasOwnProperty.call(Sk,b)||!Xk()&&Object.prototype.hasOwnProperty.call(Cb,b)?(R=1,!0):void 0),o.push({tag:v,isApplied:R,feature:u,params:JSON.stringify(d)})}),o.forEach(u=>{let{tag:d,feature:f,params:g,isApplied:y}=u;this.store.sessionId&&tt.abTest(this.store.sessionId,{intSucc:1,isApplied:y,tag:d,feature:f,params:g,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){k.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(t){let n=(function(o){let u={};return Object.keys(o).forEach(d=>{let f=o[d].value,g=f.__expires,y=f.__type;Object.keys(f).forEach(v=>{v==="__id"||v==="__type"||v==="__priority"||v==="__expires"||Object.prototype.hasOwnProperty.call(u,v)||(u[v]=wD(wD({value:f[v]},g&&{expires:g}),y&&{type:y}))})}),u})(t);try{var s;let o=(s=n.LIMIT_BITRATE)===null||s===void 0?void 0:s.value;delete n.LIMIT_BITRATE,o&&HW(o)&&this.handleBitrateLimit(o),this.limit_bitrate=o,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(t),(function(f){try{let g=Date.now();Object.keys(f).forEach(y=>{let{value:v,type:R,expires:b}=f[y];b&&b<=g||((R===l5.REALTIME||Object.prototype.hasOwnProperty.call(Sk,y))&&(fo[y]=v,An[y]=v,k.debug("Update realtime parameters from config distribute",y,v)),R||Xk()||!Object.prototype.hasOwnProperty.call(Cb,y)||(fo[y]=v,An[y]=v,k.debug("Update gateway parameters from config distribute",y,v)))})}catch(g){k.error("Error update config immediately: ".concat(f),g.message)}})(n);let u=JSON.stringify(n),d=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",d),k.debug("Caching global parameters ".concat(u))}catch(o){k.error("Error caching global parameters:",o.message)}}handleGlobalParameterConfig(t){try{let n=Date.now();Object.keys(t).forEach(s=>{switch(s){case"CLIENT_ROLE_OPTIONS":if(Object.prototype.hasOwnProperty.call(An,s)){let{value:u,expires:d}=t[s];if(d&&d<=n)return;lk(An[s],u)||(fo[s]=u,An[s]=u,this.emit(Hl.UPDATE_CLIENT_ROLE_OPTIONS,u),k.debug("Updating client role options: ".concat(JSON.stringify(u))))}break;case"REMOTE_VIDEO_STREAM_TYPE":if(Object.prototype.hasOwnProperty.call(An,s)){var o;let{value:u,expires:d}=t[s];if(d&&d<=n)return;typeof u=="number"&&ke(o=[0,1,4,5,6,7,8,9]).call(o,u)&&(fo[s]={value:u},An[s]=u,this.emit(Hl.UPDATE_REMOTE_VIDEO_STREAM_TYPE,u),k.debug("Updating client remote stream type: ".concat(JSON.stringify(u))))}break;case"ENABLE_FORCE_HLS":if(Object.prototype.hasOwnProperty.call(An,s)){let{value:u,expires:d}=t[s];if(d&&d<=n)return;lk(An[s],u)||(fo[s]=u,An[s]=u,this.emit(Hl.FALLBACK_TO_HLS,u),k.debug("Updating enable force hls: ".concat(JSON.stringify(u))))}break;case"VOS_CONFIGURE":if(Object.prototype.hasOwnProperty.call(An,s)){let{value:u,expires:d}=t[s];if(d&&d<=n)return;lk(An[s],u)||(fo[s]=u,An[s]=u,this.emit(Hl.UPDATE_VOS_CONFIGURE,u),k.debug("Updating vos configure: ".concat(JSON.stringify(u))))}}})}catch(n){k.error("Error handling global parameter config:",n.message)}}}class She extends dr{constructor(){super(...arguments),V(this,"resultStorage",new Map)}setLocalAudioStats(t,n,s){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(s,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(s,n))}setLocalVideoStats(t,n,s){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(s,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(s,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(s)),!n.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(s))}setRemoteAudioStats(t,n){let s=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",s,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){let s=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",s,this.checkVideoDecode(n))}record(t,n,s){if(z("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});let o=this.resultStorage.get(t);if(!o)return;o.result.push(s);let u=t==="VIDEO_ENCODE_FAILED"?z("ENCODE_EXCEPTION_TIMES"):5;if(o.result.length>=u){var d;let f=ke(d=o.result).call(d,!0);o.isPrevNormal&&!f&&this.emit("exception",CD[t],t,n),!o.isPrevNormal&&f&&this.emit("exception",CD[t]+2e3,t+"_RECOVER",n),o.isPrevNormal=f,o.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof oi&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let s=null;n._encoderConfig&&n._encoderConfig.frameRate&&(s=da(n._encoderConfig.frameRate));let o=t.captureFrameRate;return!s||!o||!(s>10&&o<5||s<10&&s>=5&&o<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var n;return!(!t.codecType||ke(n=z("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(n,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof oi&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}let CD={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},fs=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){let n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){let s=n[n.length-1];return Math.round(performance.now()-s.startTime)}return 0}measureFromPublishStart(e,t){let n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){let s=n[n.length-1];return Math.round(performance.now()-s.startTime)}return 0}};function P8(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function qm(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?P8(Object(n),!0).forEach(function(s){V(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P8(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}class KT{constructor(t){V(this,"store",void 0),V(this,"onStatsException",void 0),V(this,"onUploadPublishDuration",void 0),V(this,"onStatsChanged",void 0),V(this,"onVideoCodecChanged",void 0),V(this,"localStats",new Map),V(this,"remoteStats",new Map),V(this,"updateStatsInterval",void 0),V(this,"trafficStats",void 0),V(this,"trafficStatsPeerList",[]),V(this,"uplinkStats",void 0),V(this,"exceptionMonitor",void 0),V(this,"p2pChannel",void 0),V(this,"scalabilityMode",Tb.L1T1),V(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new She,this.exceptionMonitor.on("exception",(n,s,o)=>{this.onStatsException&&this.onStatsException(n,s,o)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(De.LocalAudioTrack)||qm({},Ik)}getLocalVideoTrackStats(){return this.localStats.get(De.LocalVideoTrack)||qm({},Ak)}getRemoteAudioTrackStats(t){let n=(u,d)=>{if(!this.trafficStats)return d;let f=this.trafficStats.peer_delay.find(g=>g.peer_uid===u);return f&&(d.publishDuration=f.B_ppad+(Date.now()-this.trafficStats.timestamp)),d},s={};if(t){var o;let u=(o=this.remoteStats.get(t))===null||o===void 0?void 0:o.audioStats;u&&(s[t]=n(t,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[d,{audioStats:f}]=u;f&&(s[d]=n(d,f))});return s}getRemoteNetworkQualityStats(t){let n={};if(t){var s;let o=(s=this.remoteStats.get(t))===null||s===void 0?void 0:s.networkStats;o&&(n[t]=o)}else Array.from(this.remoteStats.entries()).forEach(o=>{let[u,{networkStats:d}]=o;d&&(n[u]=d)});return n}getNetworkQuality(){let t=0,n=0;return this.trafficStats&&(t=Qb(this.trafficStats.B_unq),n=Qb(this.trafficStats.B_dnq)),{uplinkNetworkQuality:t,downlinkNetworkQuality:n}}getRemoteVideoTrackStats(t){let n=(u,d)=>{if(!this.trafficStats)return d;let f=this.trafficStats.peer_delay.find(g=>g.peer_uid===u);return f&&(d.publishDuration=f.B_ppvd+(Date.now()-this.trafficStats.timestamp)),d},s={};if(t){var o;let u=(o=this.remoteStats.get(t))===null||o===void 0?void 0:o.videoStats;u&&(s[t]=n(t,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[d,{videoStats:f}]=u;f&&(s[d]=n(d,f))});return s}getRTCStats(){let t=0,n=0,s=0,o=0,u=this.localStats.get(De.LocalAudioTrack);u&&(t+=u.sendBytes,n+=u.sendBitrate);let d=this.localStats.get(De.LocalVideoTrack);d&&(t+=d.sendBytes,n+=d.sendBitrate);let f=this.localStats.get(De.LocalVideoLowTrack);f&&(t+=f.sendBytes,n+=f.sendBitrate),this.remoteStats.forEach(y=>{let{audioStats:v,videoStats:R}=y;v&&(s+=v.receiveBytes,o+=v.receiveBitrate),R&&(s+=R.receiveBytes,o+=R.receiveBitrate)});let g=1;return this.trafficStats&&(g+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:g,SendBitrate:n,SendBytes:t,RecvBytes:s,RecvBitrate:o,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),t.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var s;let o=(s=this.p2pChannel)===null||s===void 0?void 0:s.getRemoteMedia(n.peer_uid),u=o!=null&&o.videoSSRC?fs.measureFromSubscribeStart(this.store.clientId,o.videoSSRC):0,d=o!=null&&o.audioSSRC?fs.measureFromSubscribeStart(this.store.clientId,o.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,u>d?u:d),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&k.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,s){if(!t)return!1;let o=!!s&&n.framesDecodeFreezeTime>s.framesDecodeFreezeTime,u=!s||n.framesDecodeCount>s.framesDecodeCount;return o||!u}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[s,o]=n;switch(s){case De.LocalVideoTrack:case De.LocalVideoLowTrack:{let f=o,g=qm({},Ak),y=t.getStats(),v=t.getLocalMedia(s);if(y){let R=y.videoSend.find(b=>b.ssrc===v?.ssrcs[0].ssrcId);if(R){let b=t.getLocalVideoSize(),A=t.getEncoderConfig(De.LocalVideoTrack);var u;(R.codec==="H264"||R.codec==="H265"||R.codec==="VP8"||R.codec==="VP9"||R.codec==="AV1X"||R.codec==="AV1")&&(g.codecType=R.codec,f?.codecType!==R.codec&&((u=this.onVideoCodecChanged)===null||u===void 0||u.call(this,R.codec.toLocaleLowerCase()))),g.sendBytes=R.bytes,g.sendBitrate=f?8*Math.max(0,g.sendBytes-f.sendBytes):0,R.inputFrame?(g.captureFrameRate=R.inputFrame.frameRate,g.captureResolutionHeight=R.inputFrame.height,g.captureResolutionWidth=R.inputFrame.width):b&&(g.captureResolutionWidth=b.width,g.captureResolutionHeight=b.height),R.sentFrame?(g.sendFrameRate=R.sentFrame.frameRate,g.sendResolutionHeight=R.sentFrame.height,g.sendResolutionWidth=R.sentFrame.width):b&&(g.sendResolutionWidth=b.width,g.sendResolutionHeight=b.height),R.avgEncodeMs&&(g.encodeDelay=R.avgEncodeMs),A&&A.bitrateMax?g.targetSendBitrate=1e3*A.bitrateMax:R.targetBitrate&&(g.targetSendBitrate=R.targetBitrate),g.sendPackets=R.packets,g.sendPacketsLost=R.packetsLost,g.sendJitterMs=R.jitterMs,g.sendRttMs=R.rttMs,g.totalDuration=f?f.totalDuration+1:1,g.totalFreezeTime=f?f.totalFreezeTime:0,this.isLocalVideoFreeze(R)&&(g.totalFreezeTime+=1),R.scalabilityMode&&this.scalabilityMode!==R.scalabilityMode&&(k.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(R.scalabilityMode)),this.scalabilityMode=R.scalabilityMode)}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var d;this.localStats.set(s,g),(f?.sendResolutionWidth!==g.sendResolutionWidth||f?.sendResolutionHeight!==g.sendResolutionHeight)&&((d=this.onStatsChanged)===null||d===void 0||d.call(this,"resolution",{width:g.sendResolutionWidth,height:g.sendResolutionHeight})),g&&v&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,v.track,g);break}case De.LocalAudioTrack:{let f=o,g=qm({},Ik),y=t.getStats(),v=t.getLocalMedia(s);if(y){let R=y.audioSend.find(b=>b.ssrc===v?.ssrcs[0].ssrcId);if(R){if(R.codec!=="opus"&&R.codec!=="aac"&&R.codec!=="PCMU"&&R.codec!=="PCMA"&&R.codec!=="G722"||(g.codecType=R.codec),R.inputLevel)g.sendVolumeLevel=Math.round(32767*R.inputLevel);else{let b=t.getLocalAudioVolume();b&&(g.sendVolumeLevel=Math.round(32767*b))}g.sendBytes=R.bytes,g.sendPackets=R.packets,g.sendPacketsLost=R.packetsLost,g.sendJitterMs=R.jitterMs,g.sendRttMs=R.rttMs,g.sendBitrate=f?8*Math.max(0,g.sendBytes-f.sendBytes):0}}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(De.LocalAudioTrack,g),g&&v&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,v.track,g);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{var s,o;let[u,{videoStats:d,audioStats:f,videoPcStats:g}]=n,y=f,v=d,R=g,b=qm({},w5),A=qm({},C5),F=qm({},ade),{audioTrack:M,videoTrack:j,audioSSRC:K,videoSSRC:q}=t.getRemoteMedia(u),Q;Q=this.store.useP2P?t.getStats(!0):t.getStats();let se=(s=Q)===null||s===void 0?void 0:s.audioRecv.find(we=>we.ssrc===K),oe=(o=Q)===null||o===void 0?void 0:o.videoRecv.find(we=>we.ssrc===q),ne=this.trafficStats&&this.trafficStats.peer_delay.find(we=>we.peer_uid===u);if(se&&(se.codec!=="opus"&&se.codec!=="aac"&&se.codec!=="PCMU"&&se.codec!=="PCMA"&&se.codec!=="G722"||(b.codecType=se.codec),se.outputLevel?b.receiveLevel=Math.round(32767*se.outputLevel):M&&(b.receiveLevel=Math.round(32767*M.getVolumeLevel())),b.receiveBytes=se.bytes,b.receivePackets=se.packets,b.receivePacketsLost=se.packetsLost,b.receivePacketsDiscarded=se.packetsDiscarded,b.packetLossRate=b.receivePacketsLost/(b.receivePackets+b.receivePacketsLost),b.receiveBitrate=y?8*Math.max(0,b.receiveBytes-y.receiveBytes):0,b.totalDuration=y?y.totalDuration+1:1,b.totalFreezeTime=y?y.totalFreezeTime:0,b.freezeRate=b.totalFreezeTime/b.totalDuration,b.receiveDelay=se.jitterBufferMs,b.totalDuration>10&&KT.isRemoteAudioFreeze(M)&&(b.totalFreezeTime+=1)),oe){var de;oe.codec!=="H264"&&oe.codec!=="H265"&&oe.codec!=="VP8"&&oe.codec!=="VP9"&&oe.codec!=="AV1X"&&oe.codec!=="AV1"||(A.codecType=oe.codec),A.receiveBytes=oe.bytes,A.receiveBitrate=v?8*Math.max(0,A.receiveBytes-v.receiveBytes):0,A.decodeFrameRate=oe.decodeFrameRate<0?0:oe.decodeFrameRate,A.renderFrameRate=oe.decodeFrameRate<0?0:oe.decodeFrameRate,oe.outputFrame&&(A.renderFrameRate=oe.outputFrame.frameRate),oe.receivedFrame?(A.receiveFrameRate=oe.receivedFrame.frameRate,A.receiveResolutionHeight=oe.receivedFrame.height,A.receiveResolutionWidth=oe.receivedFrame.width):j&&(A.receiveResolutionHeight=j._videoHeight||0,A.receiveResolutionWidth=j._videoWidth||0),oe.framesRateFirefox!==void 0&&(A.receiveFrameRate=Math.round(oe.framesRateFirefox)),A.receivePackets=oe.packets,A.receivePacketsLost=oe.packetsLost,A.packetLossRate=A.receivePacketsLost/(A.receivePackets+A.receivePacketsLost);let we=v?v.totalFreezeTime:0,Oe=v?v.totalDuration:0;A.totalDuration=v?v.totalDuration+1:1,A.totalFreezeTime=(de=oe.totalFreezesDuration)!==null&&de!==void 0?de:we||0,A.receiveDelay=oe.jitterBufferMs||0;let Qe=!!q&&t.getRemoteVideoIsReady(q);oe.totalFreezesDuration===void 0&&j&&Qe&&KT.isRemoteVideoFreeze(j,oe,R)&&(A.totalFreezeTime+=1),A.freezeRate=Math.max(0,Math.min((A.totalFreezeTime-we)/(A.totalDuration-Oe),1))}ne&&(b.end2EndDelay=ne.B_ad,A.end2EndDelay=ne.B_vd,b.transportDelay=ne.B_ed,A.transportDelay=ne.B_ed,b.currentPacketLossRate=ne.B_ealr4/100,A.currentPacketLossRate=ne.B_evlr4/100,F.uplinkNetworkQuality=ne.B_punq?ne.B_punq:0,F.downlinkNetworkQuality=ne.B_pdnq?ne.B_pdnq:0),this.remoteStats.set(u,{audioStats:b,videoStats:A,videoPcStats:oe,networkStats:F}),M&&this.exceptionMonitor.setRemoteAudioStats(M,b),j&&this.exceptionMonitor.setRemoteVideoStats(j,A)})}}class k8{constructor(){V(this,"destChannelMediaInfos",new Map),V(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){WW(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){WW(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){zb(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function D8(e){if(!(e instanceof k8))return new he(Y.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new he(Y.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new he(Y.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Rp{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,n){V(this,"uid",void 0),V(this,"_uintid",void 0),V(this,"_trust_in_room_",!0),V(this,"_trust_audio_enabled_state_",!0),V(this,"_trust_video_enabled_state_",!0),V(this,"_trust_audio_mute_state_",!0),V(this,"_trust_video_mute_state_",!0),V(this,"_audio_muted_",!1),V(this,"_video_muted_",!1),V(this,"_audio_enabled_",!0),V(this,"_video_enabled_",!0),V(this,"_audio_added_",!1),V(this,"_video_added_",!1),V(this,"_is_pre_created",!1),V(this,"_video_pre_subscribed",!1),V(this,"_audio_pre_subscribed",!1),V(this,"_trust_video_stream_added_state_",!0),V(this,"_trust_audio_stream_added_state_",!0),V(this,"_audioTrack",void 0),V(this,"_videoTrack",void 0),V(this,"_dataChannels",[]),V(this,"_audioSSRC",void 0),V(this,"_videoSSRC",void 0),V(this,"_audioOrtc",void 0),V(this,"_videoOrtc",void 0),V(this,"_cname",void 0),V(this,"_rtxSsrcId",void 0),V(this,"_videoMid",void 0),V(this,"_audioMid",void 0),this.uid=t,this._uintid=n}}function x8(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function RD(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?x8(Object(n),!0).forEach(function(s){V(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x8(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}let The=e=>`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1 2
a=msid-semantic: WMS
a=ice-lite`.concat(e?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:2
`),cI="9",bD=2e4,lI=4e4,L8=class{get localCapabilities(){return Qn(this._localCapabilities)}get rtpCapabilities(){return Qn(this._rtpCapabilities)}get candidates(){return Qn(this._candidates)}get iceParameters(){return Qn(this._iceParameters)}get dtlsParameters(){return Qn(this._dtlsParameters)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],n=arguments.length>2&&arguments[2]!==void 0&&arguments[2],s=arguments.length>3&&arguments[3]!==void 0&&arguments[3];V(this,"sessionDesc",void 0),V(this,"_localCapabilities",void 0),V(this,"_rtpCapabilities",void 0),V(this,"_candidates",void 0),V(this,"_originCandidates",void 0),V(this,"_iceParameters",void 0),V(this,"_isUseExtmapAllowMixed",void 0),V(this,"_isUseLocalCodecs",void 0),V(this,"_isUseDataChannel",void 0),V(this,"_dtlsParameters",void 0),V(this,"setup",void 0),V(this,"currentMidIndex",void 0),V(this,"cname",void 0),V(this,"useLocalCodecsMids",[]),V(this,"preloadSsrcs",[]),V(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=t,this._isUseLocalCodecs=n,this._isUseDataChannel=s,e=Qn(e);let{iceParameters:o,dtlsParameters:u,candidates:d,rtpCapabilities:f,setup:g,localCapabilities:y,cname:v}=e;this._rtpCapabilities=f,this._candidates=d,this._originCandidates=Qn(d),this._iceParameters=o,this._dtlsParameters=u,this._localCapabilities=y,this.setup=g,this.cname=v,[this.sessionDesc]=this.updateRemoteRTPCapabilities(f),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(e){return e.length===this.preloadSsrcs.length&&e.every(t=>{var n;return ke(n=this.preloadSsrcs).call(n,t)})}preloadRemoteMedia(e){let t=0,n=[],s=[];for(;e>0;){let o=[RD({ssrcId:lI+t},z("USE_SUB_RTX")?{rtx:lI+t+1}:{})],u="".concat(lI+t,"_").concat(bD+t),{ssrcs:d,ssrcGroups:f}=BT(o,this.cname,z("SYNC_GROUP")?u:void 0),g=this.preCreateOrRecycleSendMedia("video",d,f,void 0),y=[{ssrcId:bD+t}],v="".concat(lI+t,"_").concat(bD+t),{ssrcs:R,ssrcGroups:b}=BT(y,this.cname,z("SYNC_GROUP")?v:void 0),A=this.preCreateOrRecycleSendMedia("audio",R,b,void 0);e--,t+=2,n.push(g,A),s.push(d[0].ssrcId,R[0].ssrcId)}return this.useLocalCodecsMids.push(...n),this.preloadSsrcs=s,{mids:n,preSSRCs:s,isAvailable:!0}}preCreateOrRecycleSendMedia(e,t,n,s){let o=this.rtpCapabilities.send.videoCodecs,u=this._isUseLocalCodecs||o.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;k.debug("create or recycle send media without remote rtp capabilities, ssrcs ",t[0].ssrcId);let d=e===et.VIDEO?u.videoCodecs:u.audioCodecs,f=e===et.VIDEO?u.videoExtensions:u.audioExtensions;this.currentMidIndex+=1;let g="".concat(this.currentMidIndex),y={media:{mediaType:e,port:cI,protos:["UDP","TLS","RTP","SAVPF"],fmts:d.map(v=>v.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:f,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:d,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};return y=this.mungSendMediaDesc(y,s),this.sessionDesc.mediaDescriptions.push(y),this.updateBundleMids(),g}toString(){return eh(this.sessionDesc)}send(e,t,n,s){let{ssrcs:o,ssrcGroups:u}=BT(t,this.cname,z("SYNC_GROUP")?n:void 0),d=this.findPreloadMediaDesc(o);if(d){if($n()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,d.attributes.mid),s&&(s.twcc||s.remb)){let f=this.sessionDesc.mediaDescriptions.indexOf(d);return this.sessionDesc.mediaDescriptions[f]=this.mungSendMediaDesc(d,s),{mid:d.attributes.mid,needExchangeSDP:!0}}return{mid:d.attributes.mid,needExchangeSDP:!1}}{let f=this.findAvailableMediaIndex(e,o),g;return f===-1||f===1&&(Pi()||(function(){let y=pn();return!(y.name!==_n.CHROME||!y.osVersion)&&Number(y.version)<=90})()||jl(143)||gp(143)||z("RESERVE_MID_1_MLINE")||z("ENABLE_ENCODED_TRANSFORM")&&Qd())||f===0&&!(function(y){let v=pn();return!(v.name!==_n.FIREFOX||!v.osVersion)&&Number(v.version)===y})(138)&&z("USE_SUB_RTX")||N4()?(g=this.createOrRecycleSendMedia(e,o,u,"sendonly",s),this.updateBundleMids()):(g=Qn(this.sessionDesc.mediaDescriptions[f]),g.attributes.direction="sendonly",g.attributes.ssrcs=o,g.attributes.ssrcGroups=u,this.sessionDesc.mediaDescriptions[f]=this.mungSendMediaDesc(g,s)),$n()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,g.attributes.mid),{mid:g.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){let{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){let t=e.map(o=>{let{kind:u,ssrcMsg:d,mslabel:f}=o;return this.send(u,d,f)}),n=[],s=!1;return t.forEach(o=>{let{mid:u,needExchangeSDP:d}=o;d&&(s=!0),n.push(u)}),{mids:n,needExchangeSDP:s}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.mid==="0"||$n()||N4()?n.attributes.ssrcs=[]:(n.attributes.ssrcs=[],n.attributes.direction="inactive",n.media.port="0")}),this.updateBundleMids()}mute(e){let t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){let t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(n=>ke(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(n=>ke(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}receive(e,t,n,s){e.forEach((o,u)=>{this.createOrRecycleRecvMedia(o,[],"recvonly",t,n,s[u])}),this.updateBundleMids()}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e){let t=this.sessionDesc||Hs((n=this._isUseExtmapAllowMixed,this._isUseDataChannel?The(n):`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(n?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var n;this._rtpCapabilities=e;let s=!1,o=this.rtpCapabilities.send,u=this.localCapabilities.send,d=this.localCapabilities.recv,f=d.videoCodecs,g=d.audioCodecs,y=d.videoExtensions,v=d.audioExtensions;for(let F of t.mediaDescriptions){var R;if(F.attributes.direction!=="sendonly"||typeof F.attributes.mid!="string"||!ke(R=this.useLocalCodecsMids).call(R,F.attributes.mid)){if(s=!0,F.attributes.iceUfrag=this._iceParameters.iceUfrag,F.attributes.icePwd=this._iceParameters.icePwd,F.attributes.fingerprints=this._dtlsParameters.fingerprints,F.attributes.candidates=this._candidates,F.attributes.setup=this.setup,F.media.mediaType==="application"&&(F.attributes.sctpPort="5000"),F.media.mediaType==="video")if(this._isUseLocalCodecs&&F.attributes.direction==="sendonly"){var b;F.media.fmts=f.map(j=>j.payloadType.toString(10)),F.attributes.payloads=f,F.attributes.extmaps=y;let M=F.attributes.mid;typeof M!="string"||ke(b=this.useLocalCodecsMids).call(b,M)||this.useLocalCodecsMids.push(M)}else if(o.videoCodecs.length===0){let M=u.videoCodecs.filter(j=>{var K,q;return(K=j.rtpMap)===null||K===void 0?void 0:ke(q=K.encodingName.toLowerCase()).call(q,"vp8")});M.length===0&&M.push(u.videoCodecs[0]),F.media.fmts=M.map(j=>j.payloadType.toString(10)),F.attributes.payloads=M,F.attributes.extmaps=[]}else F.media.fmts=o.videoCodecs.map(M=>M.payloadType.toString(10)),F.attributes.payloads=o.videoCodecs,F.attributes.extmaps=o.videoExtensions;if(F.media.mediaType==="audio")if(this._isUseLocalCodecs&&F.attributes.direction==="sendonly"){var A;F.media.fmts=g.map(j=>j.payloadType.toString(10)),F.attributes.payloads=g,F.attributes.extmaps=v;let M=F.attributes.mid;typeof M!="string"||ke(A=this.useLocalCodecsMids).call(A,M)||this.useLocalCodecsMids.push(M)}else if(o.audioCodecs.length===0){let M=u.audioCodecs.filter(j=>{var K,q;return(K=j.rtpMap)===null||K===void 0?void 0:ke(q=K.encodingName.toLowerCase()).call(q,"opus")})||[u.audioCodecs[0]];F.media.fmts=M.map(j=>j.payloadType.toString(10)),F.attributes.payloads=M,F.attributes.extmaps=[]}else F.media.fmts=o.audioCodecs.map(M=>M.payloadType.toString(10)),F.attributes.payloads=o.audioCodecs,F.attributes.extmaps=o.audioExtensions,YE(F)}}return this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1,[this.sessionDesc,s]}updateCandidates(e){let t=this._originCandidates.filter(s=>s.transport==="udp"),n=[];if(t.forEach(s=>{n.push(RD(RD({},s),{},{foundation:"tcpcandidate",priority:Number(s.priority)-1+"",transport:"tcp",port:Number(s.port)+90+""}))}),t.length!==0){switch(e){case Di.TCP_RELAY:this._candidates=n;break;case Di.UDP_TCP_RELAY:case Di.RELAY:this._candidates=[...t,...n];break;default:this._candidates=t}for(let s of this.sessionDesc.mediaDescriptions)s.attributes.candidates=this.candidates}}restartICE(e){e=Qn(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){let t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex(n=>{let s=n.media.mediaType===e&&n.media.port!=="0"&&(n.attributes.direction==="sendonly"||n.attributes.direction==="sendrecv")&&n.attributes.ssrcs.length===0;if($n()){if(s){let o=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(o||n.attributes.mid!=="0"&&n.attributes.mid!=="1")||!(!o||o!==n.attributes.mid)}return!1}return s})}createOrRecycleDataChannel(){for(let n of this.sessionDesc.mediaDescriptions)if(n.media.mediaType==="application")return{mediaDesc:n,needExchangeSDP:!1};this.currentMidIndex+=1;let e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:cI,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,n,s,o,u){let d=e._mediaStreamTrack.kind,f=this.rtpCapabilities.recv,g=GT(d,f,this.localCapabilities.send,d===et.VIDEO?s:o),y=d===et.VIDEO?f.videoExtensions:f.audioExtensions;this.currentMidIndex+=1;let v="".concat(this.currentMidIndex),R={media:{mediaType:d,port:cI,protos:["UDP","TLS","RTP","SAVPF"],fmts:g.map(A=>A.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:g,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(v)}};R=this.mungRecvMediaDsec(R,e,u);let b=this.findFirstClosedMedia(d);if(b){let A=this.sessionDesc.mediaDescriptions.indexOf(b);this.sessionDesc.mediaDescriptions[A]=R}else this.sessionDesc.mediaDescriptions.push(R);return R}updateRemoteDtlsParameters(e){let t=new Set(this._dtlsParameters.fingerprints.map(o=>o.fingerprint)),n=new Set(e.map(o=>o.fingerprint)),s=!1;t.size!==n.size&&(s=!0);for(let o of t)n.has(o)||(s=!0);return s}updateRemoteCodec(e,t,n){let s=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(R=>R.rtpMap&&R.rtpMap.encodingName.toLowerCase()||"").filter(R=>{var b;return ke(b=Object.keys(Mm)).call(b,R)}))],o=new Set(t);if(s.every(R=>o.has(R)))return k.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;let u=this._rtpCapabilities.recv.videoCodecs.filter(R=>t.some(b=>{var A;return ke(A=R.rtpMap&&R.rtpMap.encodingName.toLowerCase()||"").call(A,b)}));if(u.length===0)return k.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(s," codecs: ").concat(t)),!1;let d=[...new Set(u.map(R=>R.rtpMap&&R.rtpMap.encodingName.toLowerCase()||""))],f;if(k.debug("updateRemoteCodec, from ".concat(s," to ").concat(d)),e.length===0)f=this.sessionDesc.mediaDescriptions.filter(R=>R.media.mediaType==="video"&&R.attributes.direction==="recvonly");else if(f=this.sessionDesc.mediaDescriptions.filter(R=>R.attributes.mid&&R.media.mediaType==="video"&&ke(e).call(e,R.attributes.mid)&&R.attributes.direction==="recvonly"),f.length!==e.length)return k.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(z("USE_PUB_RTX")||z("USE_SUB_RTX")){let R=Cp(u,this.rtpCapabilities.recv.videoCodecs);u.push(...R)}this._rtpCapabilities.recv.videoCodecs=u;let g=this.localCapabilities.send,y=this.rtpCapabilities.recv,v=GT(et.VIDEO,y,g,n);return f.forEach(R=>{let b=v.map(A=>A.payloadType.toString(10));k.debug("updateRemoteCodec mid: ".concat(R.attributes.mid,", from"),R.attributes.payloads,"to",v),R.attributes.payloads=v,R.media.fmts=b}),k.debug("updateRemoteCodec success, mids: ".concat(e,", codecs: ").concat(t,", remote recv: ").concat(this._rtpCapabilities.recv.videoCodecs.length,", remote send: ").concat(this._rtpCapabilities.send.videoCodecs.length)),!0}createOrRecycleSendMedia(e,t,n,s,o){let u=this.rtpCapabilities.send.videoCodecs,d=this._isUseLocalCodecs||u.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,f=e===et.VIDEO?d.videoCodecs:d.audioCodecs,g=e===et.VIDEO?d.videoExtensions:d.audioExtensions;this.currentMidIndex+=1;let y="".concat(this.currentMidIndex),v={media:{mediaType:e,port:cI,protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(y)}};v=this.mungSendMediaDesc(v,o);let R=this.findFirstClosedMedia(e);if(R){let b=this.sessionDesc.mediaDescriptions.indexOf(R);this.sessionDesc.mediaDescriptions[b]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}mungRecvMediaDsec(e,t,n){let s=Qn(e);return uD(s),Ym(s,t),dD(s,t),l8(s),tI(s,n,this.localCapabilities.send),s}mungSendMediaDesc(e,t){let n=Qn(e);return n.attributes&&n.attributes.payloads&&Array.isArray(n.attributes.payloads)&&n.attributes.payloads.length>0&&n.attributes.payloads.forEach(s=>{s.rtpMap&&s.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&z("ENABLE_DOWN_SPS_PPS")&&(s.fmtp&&s.fmtp.parameters||(s.fmtp={parameters:{}}),s.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),tI(n,t,this.localCapabilities.recv),YE(n),n}updateRecvMedia(e,t){let n=this.sessionDesc.mediaDescriptions.findIndex(s=>s.attributes.mid===e);if(n!==-1){let s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=s}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>$n()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}getSSRC(e){var t;return(t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e))===null||t===void 0?void 0:t.attributes.ssrcs}};function M8(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function ih(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?M8(Object(n),!0).forEach(function(s){V(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M8(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var JE=(function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e})(JE||{});let uI=new Map;function U8(e,t,n,s){let{scale:o}=e;if(o===0&&s===JE.UP||o>=t.length-1&&s===JE.DOWN)return e;let u=ih(ih({},e),{},{scale:s===JE.DOWN?++o:--o});switch(n){case"maintain-framerate":u=ih(ih({},u),t[o].motion);break;case"maintain-resolution":u=ih(ih({},u),t[o].detail);break;case"balanced":u=ih(ih({},u),t[o].balanced)}return u}function V8(e,t){if(t){let n={overUse:0,underUse:0,adaptationList:F8(t)};uI.set(e,n)}else uI.delete(e)}function F8(e){let t=ih({},e),{bitrateMax:n,frameRate:s,scaleResolutionDownBy:o,bitrateMin:u}=t,{MIN_FRAME_RATE:d,MAX_THRESHOLD_FRAMERATE:f,MAX_SCALE:g,BITRATE_MIN_THRESHOLD:y,BITRATE_MAX_THRESHOLD:v,BWE_SCALE_UP_THRESHOLD:R,BWE_SCALE_DOWN_THRESHOLD:b,PERF_SCALE_DOWN_THRESHOLD:A,PERF_SCALE_UP_THRESHOLD:F,BALANCE_BITRATE_FACTOR:M,BALANCE_FRAMERATE_FACTOR:j,BALANCE_RESOLUTION_FACTOR:K,MOTION_RESOLUTION_FACTOR:q,MOTION_BITRATE_FACTOR:Q,DETAIL_FRAMERATE_FACTOR:se,DETAIL_BITRATE_FACTOR:oe}=yk,ne=Math.min(t.frameRate,f),de=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(b,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(A,1)*ne),fps_up:s},balanced:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:n,bitrateMin:u},motion:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:n,bitrateMin:u},detail:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:n,bitrateMin:u}}];for(let we=1;we<=g;we++){let Oe={bwe_up:Math.round(Math.pow(R,we)*n),bwe_down:Math.round(Math.pow(b,we+1)*n),fps_up:Math.round(Math.pow(F,we)*ne),fps_down:Math.round(Math.pow(A,we+1)*ne)},Qe={scaleResolutionDownBy:o/Math.pow(K,we),frameRate:Math.max(Math.round(Math.pow(j,we)*s),d),bitrateMax:Math.max(Math.round(Math.pow(M,we)*n),v),bitrateMin:Math.max(Math.round(Math.pow(M,we)*u),y)},at={scaleResolutionDownBy:o/Math.pow(q,we),frameRate:s,bitrateMax:Math.max(Math.round(Math.pow(Q,we)*n),v),bitrateMin:Math.max(Math.round(Math.pow(Q,we)*u),y)},Xt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(se,we)*s),d),bitrateMax:Math.max(Math.round(Math.pow(oe,we)*n),v),bitrateMin:Math.max(Math.round(Math.pow(oe,we)*u),y)};de.push({scale:we,threshold:Oe,balanced:Qe,motion:at,detail:Xt})}return de}function whe(e,t,n,s,o,u){let d=uI.get(e)||{overUse:0,underUse:0,adaptationList:F8(o)},{adaptationList:f}=d;uI.set(e,d);let{OVERUSE_TIMES_THRESHOLD:g,UNDERUSE_TIMES_THRESHOLD:y}=yk,{scale:v}=s,R,b;return typeof t=="number"&&t>0&&(function(A,F,M,j){if(F>=M.length)return!1;let{threshold:{fps_down:K}}=M[F];return z("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&(K=M[0].threshold.fps_down),A<K})(t,v,f,u)&&(d.overUse++,b=AE.CPU,d.overUse>g)||typeof n=="number"&&n>0&&(function(A,F,M){if(F>=M.length)return!1;let{threshold:{bwe_down:j}}=M[F];return A<j})(n,v,f)&&(d.overUse++,b=AE.BANDWIDTH,d.overUse>g)?(d.overUse=0,d.underUse=0,R=U8(s,f,u,JE.DOWN),[R,b]):(typeof t=="number"&&t>0&&typeof n=="number"&&n>0&&(function(A,F,M,j){if(F===0)return;let{threshold:{fps_up:K}}=M[F];return z("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&(K=M[1].threshold.fps_up),A>K})(t,v,f,u)&&(function(A,F,M){if(F===0)return;let{threshold:{bwe_up:j}}=M[F];return A>j})(n,v,f)&&(d.underUse++,d.underUse>y&&(d.overUse=0,d.underUse=0,R=U8(s,f,u,JE.UP),R.scale===0&&(b=AE.NONE))),[R,b])}function j8(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function ID(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?j8(Object(n),!0).forEach(function(s){V(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j8(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function B8(e){var t;return!!z("ENABLE_AG_ADAPTATION")&&!!(e instanceof xb||ke(t=e._hints).call(t,bn.CUSTOM_TRACK))&&(!!z("FORCE_SUPPORT_AG_ADAPTATION")||!!(A4(14,0,!1)&&O4(17,4,!0)||I4(14)&&Z1(17,4,!0)))}let dI=new Map;function W8(e,t,n,s,o,u){if($E(e,n),o(t),s!=="balanced"&&s!=="maintain-framerate"&&s!=="maintain-resolution")return;let d=-1;V8(e,t);let f=window.setInterval(()=>{let y=dI.get(e);if(!z("ENABLE_AG_ADAPTATION")||!y)return $E(e,n),void o(t);let v=u();if(v.sendPackets>0&&v.OutgoingAvailableBandwidth>0){if(d===-1)return void(d=Date.now());if(Date.now()-d<1e3)return;let R=v.sendFrameRate,b=v.OutgoingAvailableBandwidth,[A,F]=whe(e,R,b,y.adaptationConfig,t,s);F&&(n.qualityLimitationReason=F),A&&y.adaptationConfig.scale!==A.scale&&(k.debug("[".concat(e,"] applyAdaptation: ").concat(n.qualityLimitationReason,`
           sendFps `).concat(R,", bwe ").concat(b,", switch from ").concat(y.adaptationConfig.scale," to ").concat(A.scale," ")),y.adaptationConfig=ID(ID({},y.adaptationConfig),A),o(A))}},z("CHECK_LOCAL_STATS_INTERVAL")),g=ID({},t);dI.set(e,{timer:f,adaptationConfig:g,originConfig:t,adaptationFunc:o}),k.debug("[".concat(e,"] start adaptation, originConfig: ").concat(JSON.stringify(t),", degradationPreference: ").concat(s))}function $E(e,t){let n=dI.get(e);if(n){let{timer:s}=n;window.clearTimeout(s),dI.delete(e)}t.qualityLimitationReason=AE.NONE,V8(e)}function Che(e,t){var n;let s;switch(t){case De.LocalAudioTrack:s=On.Audio;break;case De.LocalVideoTrack:s=ke(n=e._hints).call(n,bn.SCREEN_TRACK)?On.Screen:On.High;break;case De.LocalVideoLowTrack:s=On.Low}return s}function AD(e){let t=Qt();if(e.some(n=>n._bypassWebAudio))throw new _e(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new _e(Y.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function OD(e,t){AD(e);let n=new oi;return e.forEach(s=>n.addAudioTrack(s)),n}let Rhe=!Qt().supportUnifiedPlan||z("CHROME_FORCE_PLAN_B")&&qu();function YT(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.useDcSignal)return n={spec:t,store:e},Kl("DataChannelConnection").create(n);var n;return Rhe?(function(s){return Kl("PlanBConnection").create(s)})({spec:t,store:e}):new So(t,e)}function ND(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function PD(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(Om(e.turnServer.servers))return!1;if(z("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var cn;function G8(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function ql(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?G8(Object(n),!0).forEach(function(s){V(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G8(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}let So=(cn=class mg extends Xb{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return ke(n=Object.keys(Mm)).call(n,t)}))]}constructor(t,n){super(t,n),V(this,"id",In(5,"connection-")),V(this,"store",void 0),V(this,"peerConnection",void 0),V(this,"forceTurn",!1),V(this,"remoteSDP",void 0),V(this,"initialOffer",void 0),V(this,"transportEventReceiver",void 0),V(this,"statsFilter",void 0),V(this,"extension",{useXR:z("USE_XR")}),V(this,"localCapabilities",void 0),V(this,"remoteCodecs",void 0),V(this,"localCandidateCount",0),V(this,"allCandidatesReceived",!1),V(this,"isPreallocation",!1),V(this,"isPreRender",!1),V(this,"preMediaMap",new Map),V(this,"dataStreamChannelMap",new Map),V(this,"establishPromise",void 0),V(this,"recoveredDataChannelIds",[]),V(this,"currentDataChannelId",1),V(this,"supportAV1RtpSpec",!1),V(this,"mutex",void 0),V(this,"qualityLimitationReason",AE.NONE),V(this,"isFirstConnected",!1),this.store=n,this.forceTurn=PD(t),this.mutex=new ki("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(mg.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=wb(this.peerConnection,z("STATS_UPDATE_INTERVAL"),void 0,$n()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void k.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){let s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s);let u=this.remoteSDP.toString();o?.(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else k.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let s=ed(n.sdp),o=await pD({filterRTX:!z("USE_PUB_RTX")&&!z("USE_SUB_RTX"),filterVideoFec:z("FILTER_VIDEO_FEC"),filterAudioFec:z("FILTER_AUDIO_FEC"),filterVideoCodec:z("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:z("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:z("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=WT(o),this.initialOffer=n,z("ENABLE_SVC")&&this.store.codec=="av1"){let d=await u8();var t;d&&(this.supportAV1RtpSpec=!0,(t=o.send)===null||t===void 0||t.videoExtensions.push(d))}let u;return n.sdp&&nI(n.sdp)&&(u=Qn(o),n8(u)),ql(ql({},s),{},{rtpCapabilities:u||o,offerSDP:n.sdp})}catch(n){throw new _e(Y.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&nI(this.initialOffer.sdp)&&r8(t.rtpCapabilities,this.localCapabilities),this.remoteSDP=new L8(ql(ql({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!z("ENABLE_PRE_SUB_WITH_PRE_PC")||!z("PRE_USE_LOCAL_CODECS"))&&DT(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let n=this.remoteSDP.toString(),s=fD(this.initialOffer.sdp,this.extension),o=this.logSDPExchange(s||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),o?.(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n});let u=this.peerConnection.getTransceivers()[0];if(u!=null&&u.receiver&&this.tryBindTransportEvents(u.receiver),DT(this.store))if(t.preallocation&&z("ENABLE_PRE_SUB_WITH_PRE_PC")){let d=z("PRE_SUB_NUM"),{mids:f,preSSRCs:g}=this.remoteSDP.preloadRemoteMedia(d);await Aa(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(g)),this.presetMedia(f,g)}else{let{preSSRCs:d=[]}=t,f=d.map(y=>y.ssrcMsg[0].ssrcId);if(d.length===0)return;let{mids:g}=this.remoteSDP.batchSend(d.map(y=>Object.assign({},y)));await Aa(this.peerConnection,this.remoteSDP,this.extension),k.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(f)),this.presetMedia(g,f)}}catch(n){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}presetMedia(t,n){t.forEach((s,o)=>{this.peerConnection.getTransceivers().forEach(u=>{if(u.mid!=null&&s===u.mid&&u.receiver.track){let d=u.receiver.track,f;d.kind==="video"&&z("ENABLE_PRE_RENDER")&&(f=new Db({trackId:"track-".concat(d.kind,"-unknown-").concat(this.store.clientId,"_").concat(In(5,""))},!0),f.updateVideoTrack(d),f.onFirstVideoFrameRender=()=>{var g;let y=this.preMediaMap.get(n[o]);y&&(y.firstVideoRender=Date.now()),(g=this.onFirstVideoRender)===null||g===void 0||g.call(this,n[o])},f.onVideoBufferReady=()=>{var g;(g=this.onFirstVideoBufferReady)===null||g===void 0||g.call(this,n[o])},f.play(this.store.sessionId||void 0),this.isPreRender=!0),this.preMediaMap.set(n[o],{mid:s,track:d,player:f,transceiver:u})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let n=!1,{rtpCapabilities:s}=t;if([,n]=this.remoteSDP.updateRemoteRTPCapabilities(s),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){let d=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);n=n||d}let{preSSRCs:o=[]}=t,u=o.map(d=>d.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(u)){let d=[],f=[];if(Array.from(this.preMediaMap.entries()).every(g=>{let[y,{mid:v,player:R,track:b}]=g;return d.push(v),f.push(y),this.preMediaMap.delete(y),R&&R.destroy(),!0}),d.length>0&&(this.remoteSDP.stopSending(d),await Aa(this.peerConnection,this.remoteSDP,this.extension),k.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(f)),tt.reportApiInvoke(this.store.sessionId,{name:or.PRELOAD_MEDIA_FAILED,options:[o,f],tag:Fn.TRACER}).onSuccess()),o.length>0){let{mids:g}=this.remoteSDP.batchSend(o.map(y=>Object.assign({},y)));await Aa(this.peerConnection,this.remoteSDP,this.extension),k.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(u)),this.presetMedia(g,u)}}n?(await Aa(this.peerConnection,this.remoteSDP,this.extension),k.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):k.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(n){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(t,n,s){var o=this;return aa(function*(){let u=yield Ft(o.mutex.lock("From P2PConnection.send"));try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let d=[],f=FT();t.forEach(j=>{let K=o.peerConnection.addTransceiver(j._mediaStreamTrack,ql({direction:"sendonly"},j.trackMediaType==="video"&&o.supportAV1RtpSpec&&f?{sendEncodings:[{scalabilityMode:f}]}:{}));d.push(K),j._updateRtpTransceiver(K)}),$n()&&z("SIMULCAST")===!0&&(yield Ft(o.applySimulcastForFirefox(d,t)));let g=yield Ft(o.peerConnection.createOffer()),y=o.remoteSDP.predictReceivingMids(t.length),v=o.mungSendOfferSDP(g.sdp,t,y),R=Hs(v),b=y.map(j=>{let K=R.mediaDescriptions.find(q=>q.attributes.mid===j);if(!K)throw new Error("Cannot extract ssrc from mediaDescription.");return lD(K,z("USE_PUB_RTX"))}),A;try{A=yield b}catch(j){A=[],o.remoteSDP.receive(t,n,s,A);let K=o.remoteSDP.toString();throw yield Ft(o.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield Ft(o.peerConnection.setRemoteDescription({type:"answer",sdp:K})),yield Ft(o.stopSending(y,!0)),j}o.remoteSDP.receive(t,n,s,A);let F=o.remoteSDP.toString(),M=o.logSDPExchange(v,"offer","local","send");return yield Ft(o.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield Ft(o.applySimulcastEncodings(d,t)),yield Ft(o.applySendEncodings(d,t)),M?.(F),yield Ft(o.peerConnection.setRemoteDescription({type:"answer",sdp:F})),d.map((j,K)=>{let q=y[K];return{localSSRC:b[K],id:q,transceiver:j}})}catch(d){throw d instanceof _e?d:new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{u()}})()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let s=this.dataStreamChannelMap.get(t);if(s&&s.readyState==="open")k.debug("[P2PConnection] Channels are already available and can be reused directly.");else{let u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");s=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:z("DATASTREAM_MAX_RETRANSMITS")}),s.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,s)}n.forEach(u=>{u._updateOriginDataChannel(s)});let{needExchangeSDP:o}=this.remoteSDP.sendDataChannel();if(o){let u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});let d=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(d),k.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else k.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(s){throw s instanceof _e?s:new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(s.toString()))}}async stopDataChannels(t){try{let n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof _e?n:new _e(Y.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){let s=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let o=this.peerConnection.getTransceivers().filter(g=>t.indexOf(g.mid)!==-1);if(o.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");o.map(g=>{var y;$E(this.id+g.mid,this),g.direction="inactive",(y=g.stop)===null||y===void 0||y.call(g)});let u=await this.peerConnection.createOffer(),d=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(t);let f=this.remoteSDP.toString();d?.(f),await this.peerConnection.setRemoteDescription({type:"answer",sdp:f})}catch(o){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(o.toString()))}finally{s&&s()}}async receive(t,n,s,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:u,needExchangeSDP:d}=this.remoteSDP.send(t,n,s,o);d&&(await Aa(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));let f=this.peerConnection.getTransceivers().find(g=>g.mid===u);if(!f)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:f.receiver.track,id:u,transceiver:f}}catch(u){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let{mids:n,needExchangeSDP:s}=this.remoteSDP.batchSend(t);return s&&(await Aa(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(o=>{let u=this.peerConnection.getTransceivers().find(d=>d.mid===o);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:o,transceiver:u}})}catch(n){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(u=>{Array.from(this.preMediaMap.entries()).some(d=>{let[f,{mid:g,player:y}]=d;if(g===u)return this.preMediaMap.delete(f),y&&y.destroy(),!0})}),this.remoteSDP.stopSending(t);let n=this.remoteSDP.toString(),s=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});let o=await this.peerConnection.createAnswer();s?.(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);let n=this.remoteSDP.toString(),s=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});let o=await this.peerConnection.createAnswer();s?.(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);let n=this.remoteSDP.toString(),s=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});let o=await this.peerConnection.createAnswer();s?.(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(d=>{d.direction="inactive"});let s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.muteRemote(t);let u=this.remoteSDP.toString();o?.(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(n){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(d,f)=>{d.direction="sendonly"});let s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);let u=this.remoteSDP.toString();o?.(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(n){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return aa(function*(){let s=yield Ft(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");let o=Qt().supportPCSetConfiguration,u=z("FORCE_TURN_TCP")||n.forceTurn;if(t===Di.RELAY&&!o)return;if(o&&!u){let R=t===Di.RELAY?"relay":"all",b=n.peerConnection.getConfiguration();b.iceTransportPolicy!==R&&(k.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(b.iceTransportPolicy,"] to [").concat(R,"]")),b.iceTransportPolicy=R,n.peerConnection.setConfiguration(b))}n.remoteSDP.updateCandidates(t);let d=yield Ft(n.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let f=ed(d.sdp),{remoteIceParameters:g}=yield f.iceParameters;n.remoteSDP.restartICE(g);let y=n.remoteSDP.toString(),v=n.logSDPExchange(d.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield Ft(n.peerConnection.setLocalDescription(d)),v?.(y),yield Ft(n.peerConnection.setRemoteDescription({type:"answer",sdp:y}))}catch(o){k.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),o)}finally{s()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;let t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Di.TCP_RELAY),await Aa(this.peerConnection,this.remoteSDP,this.extension)}catch(n){k.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{$E(this.id+n.mid,this)}),this.preMediaMap.forEach(n=>{let{player:s}=n;s&&s.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return ql(ql({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let s=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(s.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);let u=this.remoteSDP.toString(),d=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),d?.(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new _e(Y.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(t,n){let s=this.peerConnection.getTransceivers().filter(o=>o.mid===t);s.length===1&&(this.isVP8Simulcast(n)?$n()||await this.applySimulcastEncodings(s,[n]):await this.applySendEncodings(s,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){let s=this.peerConnection.getTransceivers().find(o=>o.mid===n);s&&await s.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let n=t[0].transport.iceTransport,{local:s,remote:o}=n.getSelectedCandidatePair();return{local:ql(ql({},Gc),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port}),remote:ql(ql({},Gc),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;let s="code: ".concat(t.errorCode,", message: ").concat(t.errorText),o=t.port?"local: ".concat(t.port):"",u=Zu(t.url||"");k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(s,"), url: ").concat(u||"",", host_candidate:").concat(o)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,s)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},z("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let n={iceServers:[]},s=t.cloudProxyServer||"disabled";return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(Om(t.turnServer.servers)?n.iceServers=t.turnServer.servers:z("NEW_TURN_MODE")&&n.iceServers&&s==="disabled"?(z("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...mg.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...mg.newTurnServerConfigToIceServers(t.turnServer.servers)),z("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...mg.turnServerConfigToIceServers(t.turnServer.servers)),z("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...mg.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),z("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(n.iceTransportPolicy="relay")}))),z("ENABLE_ENCODED_TRANSFORM")&&Qt().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){let n=[];return t.forEach(s=>{s.security?s.tcpport&&n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(qc(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!z("FORCE_TURN_TCP")&&n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(t){let n=[];return t.forEach(s=>{let o=z("NEW_TURN_MODE");o===1?n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}):o===2?n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}):o===3?n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(qc(s.turnServerURL),":443?transport=tcp")}):o===4&&(n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}),n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}),n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(qc(s.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(t){let n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var o;n!=null&&n.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,n.state))},n.onerror=o=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in o?o.error:o)};let s=n.iceTransport;s&&(s.onstatechange=()=>{let o=n?.iceTransport.state;var u;o&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,o))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){let{local:o,remote:u}=s.getSelectedCandidatePair()||{};if(o&&u){let d=o.address+":"+o.port,f=u.address+":"+u.port;k.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Zu(d)),", remote ").concat(JSON.stringify(Zu(f))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var s,o;if(n||(n=this.peerConnection.getSenders().find(M=>M.track===t._mediaStreamTrack)),!n)return k.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return k.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Qt().supportSetRtpSenderParameters)return k.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let u={},d={};switch(t._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}let f=e8(this.peerConnection,t._mediaStreamTrack),g=G5(t);if(B8(t)&&f&&n&&g&&this.getLocalVideoStats&&ke(s=["vp8","vp9"]).call(s,this.store.codec)){var y;let M=u.degradationPreference||(ke(y=t._hints).call(y,bn.CUSTOM_TRACK)?z("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");W8(this.id+f.mid,g,this,M,j=>{n&&this.updateAdaptation(n,j)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var v;let{bitrateMax:M,frameRate:j,scaleResolutionDownBy:K}=t._encoderConfig;M&&(d.maxBitrate=1e3*M),(ke(v=t._hints).call(v,bn.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(j&&(d.maxFramerate=da(j)),K&&K>=1&&(d.scaleResolutionDownBy=K))}let{maxFramerate:R}=z("ENCODER_CONFIG_LIMIT");if(R&&typeof R=="number"&&(d.maxFramerate=d.maxFramerate?Math.min(d.maxFramerate,R):R),z("DSCP_TYPE")&&qu()){var b;let M=z("DSCP_TYPE");ke(b=["very-low","low","medium","high"]).call(b,M)&&(d.networkPriority=M)}let A=n.getParameters(),F=(o=A.encodings)===null||o===void 0?void 0:o[0];$n()&&!F&&(u.encodings=[d]),F&&Object.assign(F,d),Object.assign(A,u),k.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(A.encodings))),await n.setParameters(A),await p8(this.store.codec,n,z("SVC_MODE"))}async updateAdaptation(t,n){var s,o;if(!t)return k.debug("[updateAdaptation] no rtpSender found");if(!Qt().supportSetRtpSenderParameters)return k.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let u={},{bitrateMax:d,frameRate:f,scaleResolutionDownBy:g}=n;d&&(u.maxBitrate=1e3*d),f&&(u.maxFramerate=da(f)),g&&g>=1&&ke(s=["vp8","vp9"]).call(s,this.store.codec)&&(u.scaleResolutionDownBy=g);let y=t.getParameters(),v=(o=y.encodings)===null||o===void 0?void 0:o[0];v&&Object.assign(v,u),Object.assign(y,{});try{await t.setParameters(y),k.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(y.encodings)))}catch(R){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?k.debug("[updateAdaptation] peerConnection not connected}"):k.debug("[updateAdaptation] updateRtpSenderEncodings failed",R):k.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!Qt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let s=0;s<t.length;s++){let o=t[s],u=n[s];u instanceof jn&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,o.sender)}}catch{k.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,s){if(z("FORBID_MODIFY_LOCAL_OFFER_SDP"))return t;let o=Hs(t);return n.forEach((u,d)=>{let f=s[d],g=o.mediaDescriptions.find(y=>y.attributes.mid===f);g&&(Ym(g,u),hD(g,u,this.store.codec))}),eh(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,s)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,s)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let g=0;g<t.length;g++){var s,o,u,d,f;let y=t[g],v=n[g];if(v instanceof jn&&!ke(s=v._hints).call(s,bn.LOW_STREAM)&&(o=v._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((u=v._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(d=v._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((f=v._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1&&this.store.codec==="vp8"){let R={},b={high:1e3*(v._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:b.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:b.high}];let A=y.sender.getParameters();await y.sender.setParameters(Object.assign(A,R))}}}async applySimulcastEncodings(t,n){if(!$n()&&t.length===n.length)for(let s=0;s<t.length;s++){let o=n[s];if(o instanceof jn&&this.isVP8Simulcast(o)){let u=t[s],d={},f={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};d.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:f.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:f.medium,scaleResolutionDownBy:4}];let g=u.sender.getParameters();await u.sender.setParameters(Object.assign(g,d))}}}isVP8Simulcast(t){var n,s,o,u,d;return!!(t instanceof jn&&z("SIMULCAST")&&this.store.codec==="vp8"&&!ke(n=t._hints).call(n,bn.LOW_STREAM)&&(s=t._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((o=t._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(u=t._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((d=t._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1)}logSDPExchange(t,n,s,o){if(z("SDP_LOGGING"))return k.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(n," SDP during P2PConnection.").concat(o,`
`),t),n==="offer"?u=>{this.logSDPExchange(u,"answer",s==="local"?"remote":"local",o)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;let n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(t){if(Qt().supportPCSetConfiguration){let n=mg.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}t.isPreallocation&&(this.isPreallocation=!0)}},ze(cn.prototype,"updateRemoteRTPCapabilities",[ha],Object.getOwnPropertyDescriptor(cn.prototype,"updateRemoteRTPCapabilities"),cn.prototype),ze(cn.prototype,"connect",[ha],Object.getOwnPropertyDescriptor(cn.prototype,"connect"),cn.prototype),ze(cn.prototype,"updateRemoteConnect",[ha],Object.getOwnPropertyDescriptor(cn.prototype,"updateRemoteConnect"),cn.prototype),ze(cn.prototype,"createDataChannels",[ha],Object.getOwnPropertyDescriptor(cn.prototype,"createDataChannels"),cn.prototype),ze(cn.prototype,"receive",[ha],Object.getOwnPropertyDescriptor(cn.prototype,"receive"),cn.prototype),ze(cn.prototype,"batchReceive",[ha],Object.getOwnPropertyDescriptor(cn.prototype,"batchReceive"),cn.prototype),ze(cn.prototype,"stopReceiving",[ha],Object.getOwnPropertyDescriptor(cn.prototype,"stopReceiving"),cn.prototype),ze(cn.prototype,"muteRemote",[ha],Object.getOwnPropertyDescriptor(cn.prototype,"muteRemote"),cn.prototype),ze(cn.prototype,"unmuteRemote",[ha],Object.getOwnPropertyDescriptor(cn.prototype,"unmuteRemote"),cn.prototype),ze(cn.prototype,"muteLocal",[ha],Object.getOwnPropertyDescriptor(cn.prototype,"muteLocal"),cn.prototype),ze(cn.prototype,"unmuteLocal",[ha],Object.getOwnPropertyDescriptor(cn.prototype,"unmuteLocal"),cn.prototype),ze(cn.prototype,"close",[ha],Object.getOwnPropertyDescriptor(cn.prototype,"close"),cn.prototype),ze(cn.prototype,"updateEncoderConfig",[ha],Object.getOwnPropertyDescriptor(cn.prototype,"updateEncoderConfig"),cn.prototype),ze(cn.prototype,"updateSendParameters",[ha],Object.getOwnPropertyDescriptor(cn.prototype,"updateSendParameters"),cn.prototype),ze(cn.prototype,"replaceTrack",[ha],Object.getOwnPropertyDescriptor(cn.prototype,"replaceTrack"),cn.prototype),ze(cn.prototype,"updateAdaptation",[ha],Object.getOwnPropertyDescriptor(cn.prototype,"updateAdaptation"),cn.prototype),ze(cn.prototype,"getRemoteSSRC",[ha],Object.getOwnPropertyDescriptor(cn.prototype,"getRemoteSSRC"),cn.prototype),cn);function ha(e,t,n){let s=e[t];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){let o=this.mutex,u=await o.lock("From P2PConnection.".concat(t));try{for(var d=arguments.length,f=new Array(d),g=0;g<d;g++)f[g]=arguments[g];return await s.apply(this,f)}finally{u()}},n}function kD(e,t){let n=document.createElement("video"),s=document.createElement("canvas");n.setAttribute("style","display:none"),s.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),s.width=da(t.width),s.height=da(t.height);let o=da(t.framerate||15);document.body.append(n),document.body.append(s);let u=e._mediaStreamTrack;n.srcObject=new MediaStream([u]),n.play().catch(OT);let d=s.getContext("2d");if(!d)throw new he(Y.UNEXPECTED_ERROR,"can not get canvas context");let f=Qt(),g=s.captureStream(f.supportRequestFrame?0:o).getVideoTracks()[0];g.canvas||(g.canvas=s),s.startCapture=()=>{if(!n)return s.stopCapture&&s.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){let v=n.videoWidth,R=n.videoHeight/v,b=s.width*R;Math.abs(b-s.height)>=2&&(k.debug("adjust low stream resolution","".concat(s.width,"x").concat(s.height," -> ").concat(s.width,"x").concat(b)),s.height=b)}d.drawImage(n,0,0,s.width,s.height),g.requestFrame&&g.requestFrame(),u!==e._mediaStreamTrack&&(u=e._mediaStreamTrack,n.srcObject=new MediaStream([u]))},s.stopCapture=kk(()=>s.startCapture&&s.startCapture(),o);let y=g.stop;return g.stop=()=>{y.call(g),n&&(n.remove(),n.srcObject=null,n=null),s&&(s.width=0,s.remove(),s.stopCapture&&s.stopCapture(),s.startCapture=void 0,s.stopCapture=void 0,s=null),k.debug("clean low stream renderer")},g}var H8=(function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e})(H8||{}),Xl=(function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e})(Xl||{}),It=(function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e})(It||{}),Ii=(function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e[e.Audio_Recv_AV_Sync_TIME=2237]="Audio_Recv_AV_Sync_TIME",e})(Ii||{}),Ki=(function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e})(Ki||{}),QE=(function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e[e.PAGE_VISIBILITY=2233]="PAGE_VISIBILITY",e})(QE||{}),DD=(function(e){return e[e.Transport_Send_Bitrate=2234]="Transport_Send_Bitrate",e[e.Transport_Recv_Bitrate=2235]="Transport_Recv_Bitrate",e})(DD||{});let Xm=1e3,hI=6,qT=3,bhe=Math.max(hI,qT,60);function _t(e,t,n){n!=null&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function z8(e){let t={[Ki.CONN_TYPE]:0,[Ki.RTT]:e.rtt,[Ki.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{let n=e.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(t[Ki.CONN_TYPE]=1),n==="tcp"&&(t[Ki.CONN_TYPE]=3),n==="tls"&&(t[Ki.CONN_TYPE]=4);break}case"srflx":t[Ki.CONN_TYPE]=2;break;case"unknown":t[Ki.CONN_TYPE]=5;break;default:t[Ki.CONN_TYPE]=0}return t}function K8(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class Y8 extends dr{constructor(t){super(),V(this,"store",void 0),V(this,"uploadWRTCStatsTimer",void 0),V(this,"uploadOutboundDenoiserStatsTimer",void 0),V(this,"uploadExtStatsTimer",void 0),V(this,"uploadExtUsageStatsTimer",void 0),V(this,"uploadInboundExtStatsTimer",void 0),V(this,"requestStats",void 0),V(this,"requestTransportStats",void 0),V(this,"requestLocalMedia",void 0),V(this,"requestRemoteMedia",void 0),V(this,"requestAllTracks",void 0),V(this,"requestVideoIsReady",void 0),V(this,"requestUploadStats",void 0),V(this,"requestUpload",void 0),V(this,"uploadOutboundStarted",!1),V(this,"uploadInboundStarted",!1),V(this,"uploadTransportStarted",!1),V(this,"uploadBaseStatsStarted",!1),V(this,"uploadExtensionUsageStarted",!1),V(this,"lastRecvStats",void 0),V(this,"lastSendStats",void 0),V(this,"lastRefRecvStats",void 0),V(this,"lastRefSendStats",void 0),V(this,"lastNormalRecvStats",void 0),V(this,"lastNormalSendStats",void 0),V(this,"lastExtendStats",{}),V(this,"needUploadStats",{}),V(this,"needUploadRenderFreezeTime",!0),V(this,"lastUploadCompensateTime",-1),V(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;let n=t%qT==0,s=t%hI==0,o=t%60==0,u,d;if(this.uploadTransportStarted&&(u=this.requestStats(),this.store.useP2P&&(d=this.requestStats(!0))),!u&&this.uploadOutboundStarted&&(u=this.requestStats()),!d&&this.uploadInboundStarted&&(d=this.requestStats(!0)),u||d){var f;let g={};if(this.uploadTransportStarted&&u){let v=this.getTransportStats(u,n?this.lastRefSendStats:void 0,d,n);v&&(g.misc=[v])}if(this.uploadOutboundStarted&&u){let v=this.getOutboundStats(u,s?this.lastNormalSendStats:void 0,n?this.lastRefSendStats:void 0,this.lastSendStats,o);v&&(g.outbound=[v])}if(this.uploadInboundStarted&&d){this.uploadCompensateStats(t);let v=this.getInboundStats(d,s?this.lastNormalRecvStats:void 0,n?this.lastRefRecvStats:void 0,this.lastRecvStats);v&&(g.inbound=v)}let y=(f=this.requestTransportStats)===null||f===void 0?void 0:f.call(this).connectState;if(y&&(Array.isArray(g.misc)?g.misc[0]&&g.misc[0].addition&&(g.misc[0].addition[QE.RTC_PEER_CONNECTION_STATE]=gk[y]):g.misc=[{addition:{[QE.RTC_PEER_CONNECTION_STATE]:gk[y]}}]),Xa.needUploadStats.length>0||s){let v=Xa.needUploadStats.shift()||(Xa.visibility==="visible"?1:0);Array.isArray(g.misc)?g.misc[0]&&g.misc[0].addition&&(g.misc[0].addition[QE.PAGE_VISIBILITY]=v):g.misc=[{addition:{[QE.PAGE_VISIBILITY]:v}}]}this.needUploadStats.sendType&&(Array.isArray(g.outbound)&&g.outbound[0]&&g.outbound[0].high&&(g.outbound[0].high[H8.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(g)}this.lastRecvStats=d,this.lastSendStats=u,s&&(this.lastNormalRecvStats=d,this.lastNormalSendStats=u),n&&(this.lastRefRecvStats=d,this.lastRefSendStats=u)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0,Xa.startCollectStats();let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,s;let o=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(o&&((s=this.requestUploadStats)===null||s===void 0||s.call(this,{misc:[{addition:{[QE.RTC_PEER_CONNECTION_STATE]:gk[o.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===bhe+1&&(t=1)},Xm)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;let n=t%qT==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!n)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());let s=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=s,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;let o=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*o;let u=this.requestStats(!0);new Array(o).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;let d={};if(this.uploadInboundStarted&&u){let f=this.requestRemoteMedia()||[],g=[];f.forEach(y=>{let[v,R]=y,b={peer:v.uid};if(v._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(v._videoSSRC)&&R.has(et.VIDEO)&&v.videoTrack){let A=(function(F,M,j){if(!M.videoRecv.find(q=>q.ssrc===F))return;let K={};if(j&&j._player){let q=j._player,{renderFreezeAccTime2:Q,videoElementStatus:se}=q;if(Xa.visibility==="visible"&&se===hs.PLAYING&&Qt().supportRequestVideoFrameCallback){let oe=Math.min(6e3,Q);q.renderFreezeAccTime2=Math.max(0,Q-oe),_t(K,Xl.Video_Render_Freeze_Time_Render2,oe),z("USE_NEW_RENDER_FREEZE_TIME")&&_t(K,Xl.Video_Render_Freeze_Time_Render,oe)}}return K})(v._videoSSRC,u,v.videoTrack);A&&(b.video=A)}b.video&&g.push(b)}),g.length>0&&(d.inbound=g,this.requestUploadStats(d))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,n,s,o){if(!this.requestStats)return;if(!o)return t.rtt==null?void 0:{addition:{[Ki.RTT]:t.rtt,[Ki.CONN_TYPE]:void 0,[Ki.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};let u=z8(t);if(this.store.useP2P){if(s){let d=z8(s);u[Ki.CONN_TYPE]&&d[Ki.CONN_TYPE]&&(u[Ki.CONN_TYPE]+=d[Ki.CONN_TYPE]<<3)}u[Ki.CONN_TYPE]?u[Ki.CONN_TYPE]+=110:u[Ki.CONN_TYPE]=110}else{u[Ki.CONN_TYPE]?u[Ki.CONN_TYPE]+=100:u[Ki.CONN_TYPE]=100;let d=(function(f,g){return g?[Math.ceil(8*(f.transport.bytesSent-g.transport.bytesSent)/(f.timestamp-g.timestamp)),Math.ceil(8*(f.transport.bytesReceived-g.transport.bytesReceived)/(f.timestamp-g.timestamp))]:[0,0]})(t,n);u[DD.Transport_Send_Bitrate]=d[0],u[DD.Transport_Recv_Bitrate]=d[1]}return{addition:u}}getOutboundStats(t,n,s,o,u){if(!this.requestUploadStats||!this.requestLocalMedia)return;let d=this.requestLocalMedia();if(!d||d.length===0)return;let f,g,y;return d.forEach(v=>{let[R,{track:b,ssrcs:A}]=v;switch(R){case De.LocalVideoLowTrack:case De.LocalVideoTrack:if(R===De.LocalVideoTrack){var F;let M=(function(Q,se,oe,ne,de,we){let Oe=se.videoSend.find(Lt=>Lt.ssrc===Q);if(!Oe)return;let Qe={},{sentFrame:at,inputFrame:Xt}=Oe;if(ne&&(_t(Qe,Xl.Video_Send_Qp_Sum,Oe.qpSumPerFrame),Xt&&at)){let Lt=Xt.frameRate,jt=at.frameRate;Qe[Xl.Video_Send_Freeze]=(function(En,lr){let Ce=!0;return Ce=!(En<=5)&&(En<=10?lr<3:En<=20?lr<4:lr<5),Ce})(Lt,jt)?1:0}if(de){switch(at&&(_t(Qe,It.Video_Send_Height,at.height),_t(Qe,It.Video_Send_Width,at.width),_t(Qe,It.Video_Send_Frame_Rate,at.frameRate)),Qe[It.Video_Send_Disabled]=oe._originMediaStreamTrack&&!oe._originMediaStreamTrack.enabled||oe._mediaStreamTrack&&!oe._mediaStreamTrack.enabled?1:0,Oe.adaptionChangeReason){case"none":Qe[It.Video_Send_Adaptation]=0;break;case"cpu":Qe[It.Video_Send_Adaptation]=1;break;case"bandwidth":Qe[It.Video_Send_Adaptation]=2;break;case"other":Qe[It.Video_Send_Adaptation]=3}let Lt=0;Oe.adaptionChangeReason&&(Lt+=K8(Oe.adaptionChangeReason)),se.qualityLimitationReason&&(Lt+=K8(se.qualityLimitationReason)<<3),Qe[It.Video_Send_Adaptation]=Lt,Qe[It.Video_Send_Player_Status]=Ok[oe._player?oe._player.videoElementStatus:"uninit"],_t(Qe,It.Video_Send_Nacks,Oe.nacksCount),_t(Qe,It.Video_Send_Plis,Oe.plisCount),_t(Qe,It.Video_Send_Firs,Oe.firsCount),_t(Qe,It.Video_Send_Avg_Encode,Oe.avgEncodeMs),_t(Qe,It.Video_Send_Huge_Frame_Sent,Oe.hugeFramesSent),_t(Qe,It.Video_Send_Bytes_Retransmit,Oe.retransmittedBytesSent),_t(Qe,It.Video_Send_Packages_Retransmit,Oe.retransmittedPacketsSent),_t(Qe,It.Video_Send_Key_Frames_Encoded,Oe.keyFramesEncoded);let jt=de.videoSend.find(En=>En.ssrc===Q);if(jt){let En=Xm*qT;jt.timestamp&&Oe.timestamp&&(En=Oe.timestamp-jt.timestamp),jt.packets!=null&&Oe.packets!=null&&_t(Qe,It.Video_Send_Package_Rate,1e3*(Oe.packets-jt.packets)/En),Oe.packetsLost!=null&&jt.packetsLost!=null&&_t(Qe,It.Video_Send_Package_Lost,Oe.packetsLost-jt.packetsLost),jt.bytes!=null&&Oe.bytes!=null&&_t(Qe,It.Video_Send_Bitrate,8*(Oe.bytes-jt.bytes)/En)}}return Qe})(A[0].ssrcId,t,b,n,s),j=b.__className__==="CameraVideoTrack"?3:ke(F=b._hints).call(F,bn.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==j||u)&&(this.needUploadStats={sendType:j},this.lastExtendStats.sendType=j);let K=b&&(function(Q,se,oe,ne){let de=se.videoSend.find(Oe=>Oe.ssrc===Q);if(!de)return null;let we={};if(ne){let Oe=de.inputFrame,Qe=Oe&&Oe.height||oe.videoHeight||0,at=Oe&&Oe.width||oe.videoWidth||0,Xt=Oe&&Oe.frameRate||0;_t(we,It.Video_Capture_Height,Qe),_t(we,It.Video_Capture_Width,at),_t(we,It.Video_Capture_Frame_Rate,Xt)}return we})(A[0].ssrcId,t,b,!!s),q=(function(Q,se){let oe={};return se&&(_t(oe,It.Video_Send_Retransmit,Q.bitrate.retransmit),_t(oe,It.Video_Send_Target_Encoded,Q.bitrate.targetEncoded),_t(oe,It.Video_Send_Actual_Encoded,Q.bitrate.actualEncoded),_t(oe,It.Video_Send_Transmit,Q.bitrate.transmit),_t(oe,It.Video_Send_Bandwidth,Q.sendBandwidth)),oe})(t,!!s);g=Object.assign({},M,K,q)}else y=(function(M,j,K,q,Q){let se=j.videoSend.find(ne=>ne.ssrc===M);if(!se)return;let oe={};if(q){let ne=se.sentFrame;ne&&(_t(oe,It.Video_Send_Low_Height,ne.height),_t(oe,It.Video_Send_Low_Width,ne.width),_t(oe,It.Video_Send_Low_Frame_Rate,ne.frameRate));let de=q.videoSend.find(we=>we.ssrc===M);if(de){let we=Xm*hI;de.timestamp&&se.timestamp&&(we=se.timestamp-de.timestamp),de.packets!=null&&se.packets!=null&&_t(oe,It.Video_Send_Low_Package_Rate,1e3*(se.packets-de.packets)/we),se.packetsLost!=null&&de.packetsLost!=null&&_t(oe,It.Video_Send_Low_Package_Lost,se.packetsLost-de.packetsLost),de.bytes!=null&&se.bytes!=null&&_t(oe,It.Video_Send_Low_Bitrate,8*(se.bytes-de.bytes)/we)}}return oe})(A[0].ssrcId,t,0,s);break;case De.LocalAudioTrack:f=b&&(function(M,j,K,q,Q,se){let oe=j.audioSend.find(de=>de.ssrc===M);if(!oe)return;let ne={};if(Q){ne[It.Audio_Send_Disabled]=K._originMediaStreamTrack&&!K._originMediaStreamTrack.enabled||K._mediaStreamTrack&&!K._mediaStreamTrack.enabled?1:0;let de=100*K._source.getAccurateVolumeLevel(),we=oe.inputLevel;if(we!=null){let Qe=Math.ceil(50*Math.log10(100*we+1));_t(ne,It.Audio_Send_Level,Qe)}_t(ne,It.Audio_Capture_PCM_Level,de),_t(ne,It.Audio_Send_AEC_Return_Loss,oe.aecReturnLoss),_t(ne,It.Audio_Send_AEC_Return_Loss_Enhancement,oe.aecReturnLossEnhancement),_t(ne,It.Audio_Send_Bytes_Retransmit,oe.retransmittedBytesSent),_t(ne,It.Audio_Send_Packages_Retransmit,oe.retransmittedPacketsSent),ne[It.Audio_Send_Freeze]=0;let Oe=Q.audioSend.find(Qe=>Qe.ssrc===M);if(Oe){let Qe=Xm*hI;Oe.timestamp&&oe.timestamp&&(Qe=oe.timestamp-Oe.timestamp),Oe.bytes!=null&&oe.bytes!=null&&_t(ne,It.Audio_Send_Bitrate,8*(oe.bytes-Oe.bytes)/Qe),Oe.packets!=null&&oe.packets!=null&&_t(ne,It.Audio_Send_Package_Rate,1e3*(oe.packets-Oe.packets)/Qe)}}return ne})(A[0].ssrcId,t,b,0,s)}}),{high:g,low:y,audio:f}}getInboundStats(t,n,s,o){if(!this.requestRemoteMedia)return;let u=this.requestRemoteMedia()||[],d=[];return u.forEach(f=>{let[g,y]=f,v={peer:g.uid},R;if(y.has(et.VIDEO)&&g.videoTrack){let b=g._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(g._videoSSRC)||!1,A=g.videoTrack?(function(F,M,j,K,q,Q,se,oe){let ne=M.videoRecv.find(jt=>jt.ssrc===F);if(!ne)return;let de={},{receivedFrame:we,outputFrame:Oe,decodeFrameRate:Qe}=ne;_t(de,Ii.Video_Render_Frame_Rate_Decode,Qe),ne.framesRateFirefox&&_t(de,Ii.Video_Recv_Frame_Rate,ne.framesRateFirefox),we&&_t(de,Ii.Video_Recv_Frame_Rate,we.frameRate),_t(de,Ii.Video_Recv_Frame_Dropped,ne.framesDroppedCount),_t(de,Ii.Video_Recv_Bytes_Retransmit,ne.retransmittedBytesReceived),_t(de,Ii.Video_Recv_Packages_Retransmit,ne.retransmittedPacketsReceived),_t(de,Ii.Video_Recv_Packages_Discarded,ne.packetsDiscarded),_t(de,Ii.Video_Recv_Avg_Decode,ne.avgDecodeMs),_t(de,Ii.Video_Recv_Avg_Processing_Delay,ne.avgProcessingDelayMs),_t(de,Ii.Video_Recv_Avg_Assembly_Time,ne.avgFramesAssembledFromMultiplePacketsMs),_t(de,Ii.Video_Recv_Avg_Inter_Frame_Delay,ne.avgInterFrameDelayMs),_t(de,Ii.Video_Recv_Key_Frames_Decoded,ne.keyFramesDecoded);let at=oe&&oe.videoRecv.find(jt=>jt.ssrc===F);if(at){let jt=M.timestamp-oe.timestamp||Xm;ne.packetsLost!=null&&at.packetsLost!=null&&_t(de,Ii.Video_Recv_Package_Lost,ne.packetsLost-at.packetsLost),at.bytes!=null&&ne.bytes!=null&&_t(de,Ii.Video_Recv_Bitrate,8*(ne.bytes-at.bytes)/jt),at.packets!=null&&ne.packets!=null&&_t(de,Ii.Video_Recv_Package_Rate,1e3*(ne.packets-at.packets)/jt)}let Xt=Q&&Q.videoRecv.find(jt=>jt.ssrc===F);if(Xt&&(_t(de,Xl.Video_Recv_Qp_Sum,ne.qpSumPerFrame),de[Xl.Video_Recv_Freeze]=K&&KT.isRemoteVideoFreeze(j,ne,Xt)?1:0),se){var Lt;let jt=se.videoRecv.find(lr=>lr.ssrc===F);we?(_t(de,It.Video_Recv_Height,we.height),_t(de,It.Video_Recv_Width,we.width)):j&&(_t(de,It.Video_Recv_Height,j._videoHeight||0),_t(de,It.Video_Recv_Width,j._videoWidth||0)),Oe&&_t(de,It.Video_Recv_Frame_Rate_Output,Oe.frameRate);let En=(Lt=j._player)===null||Lt===void 0?void 0:Lt.rendFrameRate.toFixed(0);if(En&&_t(de,It.Video_Render_Frame_Rate_Render,+En),_t(de,It.Video_Recv_Jitter_Buffer,ne.jitterBufferMs),_t(de,It.Video_Recv_Current_Delay,ne.currentDelayMs),_t(de,It.Video_Recv_Firs,ne.firsCount),_t(de,It.Video_Recv_Nacks,ne.nacksCount),_t(de,It.Video_Recv_Plis,ne.plisCount),j){de[It.Video_Recv_Disabled]=j._originMediaStreamTrack.enabled&&j._mediaStreamTrack.enabled?0:1;let lr=j._player;if(lr){let{freezeTimeCounterList:Ce,renderFreezeAccTime:Ve,renderFreezeAccTime2:Ze,videoElementStatus:Ae}=lr;if(Ce&&Ce.length>0&&_t(de,Xl.Video_Render_Freeze_Time,Ce.splice(0,1)[0]),q&&Xa.visibility==="visible"&&Ae===hs.PLAYING&&Qt().supportRequestVideoFrameCallback){let L=Math.min(6e3,Ze);lr.renderFreezeAccTime2=Math.max(0,Ze-L),_t(de,Xl.Video_Render_Freeze_Time_Render2,L);let J=Math.min(6e3,Ve);lr.renderFreezeAccTime=Math.max(0,Ve-J),_t(de,Xl.Video_Render_Freeze_Time_Render,z("USE_NEW_RENDER_FREEZE_TIME")?L:J)}if(typeof ne.totalFreezesDuration=="number"){let L=jt&&jt.totalFreezesDuration?ne.totalFreezesDuration-jt.totalFreezesDuration:ne.totalFreezesDuration;_t(de,It.Video_Render_Freeze_Duration,1e3*L)}}}if(de[It.Video_Recv_Player_Status]=Ok[j._player?j._player.videoElementStatus:"uninit"],jt&&ne.totalInterFrameDelay!==void 0&&ne.totalSquaredInterFrameDelay!==void 0&&jt.totalInterFrameDelay!==void 0&&jt.totalSquaredInterFrameDelay!==void 0){let lr=ne.totalInterFrameDelay-jt.totalInterFrameDelay,Ce=ne.totalSquaredInterFrameDelay-jt.totalSquaredInterFrameDelay,Ve=ne.framesDecodeCount-jt.framesDecodeCount,Ze=lr/Ve*1e3,Ae=Math.round(1e3*Math.sqrt((Ce-Math.pow(lr,2)/Ve)/Ve));!isNaN(Ae)&&Ze+Ae>Math.max(3*Ze,Ze+150)&&(de[It.Video_Recv_I_Frame_Delay]=Ae)}}return de})(g._videoSSRC,t,g.videoTrack,b===!0,this.needUploadRenderFreezeTime,n,s,o):void 0;if(A&&(v.video=A),g.videoTrack){let F=t.videoRecv.find(M=>M.ssrc===g._videoSSRC);F&&F.estimatedPlayoutTimestamp&&(R=F.estimatedPlayoutTimestamp)}}if(y.has(et.AUDIO)&&g.audioTrack){let b=g.audioTrack?(function(A,F,M,j,K,q){let Q=F.audioRecv.find(de=>de.ssrc===A);if(!Q)return;let se={};_t(se,Ii.Audio_Recv_Jitter,Q.jitterMs),_t(se,Ii.Audio_Recv_Bytes_Retransmit,Q.retransmittedBytesReceived),_t(se,Ii.Audio_Recv_Packages_Retransmit,Q.retransmittedPacketsReceived),_t(se,Ii.Audio_Recv_Packages_Discarded,Q.packetsDiscarded),_t(se,Ii.Audio_Recv_Avg_Processing_Delay,Q.avgProcessingDelayMs);let oe=q&&q.audioRecv.find(de=>de.ssrc===A);if(oe){let de=Xm;Q.packets!=null&&oe.packets!=null&&_t(se,Ii.Audio_Recv_Package_Rate,1e3*(Q.packets-oe.packets)/de),Q.packetsLost!=null&&oe.packetsLost!=null&&_t(se,Ii.Audio_Recv_Package_Lost,Q.packetsLost-oe.packetsLost)}if(j){let{receivedFrames:de,droppedFrames:we}=Q;de!=null&&we!=null&&(se[Xl.Audio_Recv_Freeze]=(ne=de)===0||100*we/ne>20?1:0)}var ne;if(K){let de=100*M._source.getAccurateVolumeLevel(),we=Q.outputLevel;if(we!=null){let Qe=Math.ceil(50*Math.log10(100*we+1));_t(se,It.Audio_Render_Level,Qe)}_t(se,It.Audio_Recv_PCM_Level,de),M&&(se[It.Audio_Recv_Disabled]=M._originMediaStreamTrack.enabled&&M._mediaStreamTrack.enabled?0:1),_t(se,It.Audio_Recv_Jitter_Buffer,Q.jitterBufferMs),_t(se,It.Audio_Recv_Current_Delay,Q.jitterBufferMs),se[It.Audio_Recv_Player_Status]=Ok[Ps.getPlayerState(M.getTrackId())];let Oe=K.audioRecv.find(Qe=>Qe.ssrc===A);if(Oe){Oe.bytes!=null&&Q.bytes!=null&&_t(se,It.Audio_Recv_Bitrate,8*(Q.bytes-Oe.bytes)/(Xm*qT));let Qe=Q.concealedSamples-Oe.concealedSamples;Qe>0&&_t(se,It.Audio_Recv_Concealed_Samples,Qe);let at=Q.totalSamplesReceived-Oe.totalSamplesReceived;at>0&&_t(se,It.Audio_Recv_Total_Samples_Received,at);let Xt=Q.freezeSamples80-Oe.freezeSamples80;Xt>0&&_t(se,It.Audio_Render_Freeze_Samples_80ms,Xt);let Lt=Q.freezeSamples200-Oe.freezeSamples200;Lt>0&&_t(se,It.Audio_Render_Freeze_Samples_200ms,Lt);let jt=Q.freezeMs80-Oe.freezeMs80;_t(se,It.Audio_Render_Freeze_Time_80ms,jt<0?0:jt);let En=Q.freezeMs200-Oe.freezeMs200;_t(se,It.Audio_Render_Freeze_Time_200ms,En<0?0:En)}}return se})(g._audioSSRC,t,g.audioTrack,n,s,o):void 0;if(b&&(v.audio=b),g.audioTrack&&R){let A=t.audioRecv.find(F=>F.ssrc===g._audioSSRC);if(A&&A.estimatedPlayoutTimestamp){let F=A.estimatedPlayoutTimestamp-R;v.audio?v.audio[Ii.Audio_Recv_AV_Sync_TIME]=F:v.audio={[Ii.Audio_Recv_AV_Sync_TIME]:F}}}}(v.video||v.audio)&&d.push(v)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,d}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;let t=(this.requestAllTracks()||[]).find(n=>n instanceof LT);if(t&&t._external.getDenoiserStats){let n=t._external.getDenoiserStats();n&&this.requestUpload(zm.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[n,s]=t;s.has(et.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(o=>{this.requestUpload&&this.requestUpload(o.type,o.stats)}),s.has(et.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(o=>{this.requestUpload&&this.requestUpload(o.type,o.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);let t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{let n=Date.now(),s={connectionInterval:z("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n},o=[],u=this.requestAllTracks&&this.requestAllTracks()||[];for(let y of u)!y.muted&&y.enabled&&(o=o.concat(await y.getProcessorUsage()));let d=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(let[y,v]of d)v.has(et.VIDEO)&&y.videoTrack&&(o=o.concat(await y.videoTrack.getProcessorUsage())),v.has(et.AUDIO)&&y.audioTrack&&(o=o.concat(await y.audioTrack.getProcessorUsage()));if(o.length===0)return;s.details=(function(y,v){let R={};for(let{id:M,value:j,level:K,direction:q}of y){var b;let Q=(b=v.get(M))!==null&&b!==void 0?b:0,se=j===2?Q+z("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:Q;var A,F;v.set(M,se),R[M]?(j===2&&(R[M].value=j),K>R[M].level&&(R[M].level=K),q==="remote"&&(R[M].remoteUidCount+=1),R[M].totalTs=(A=v.get(M))!==null&&A!==void 0?A:0):R[M]={value:j,level:K,remoteUidCount:q==="local"?0:1,totalTs:(F=v.get(M))!==null&&F!==void 0?F:0}}return Object.keys(R).map(M=>{let{level:j,value:K,totalTs:q}=R[M];return{id:M,level:j,value:K,totalTs:q}})})(o,t);let f=Date.now(),g=f>n?f:n+1;this.requestUpload&&this.requestUpload(zm.EXTENSION_USAGE_STATS,{usageStats:s,sendTs:g})},z("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1,Xa.stopCollectStats()}}let Ihe=z("ICE_RESTART_INTERVAL"),pI=new Map,ZE=new Map,bp=[Di.UDP_TCP_RELAY,Di.TCP_RELAY,Di.RELAY],xD=z("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Qt().supportPCSetConfiguration;function q8(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],n=pI.get(e.id);n&&(window.clearTimeout(n),pI.delete(e.id));let s=ZE.get(e.id);t&&s&&s.index===bp.length-1&&(k.debug("[".concat(e.id,"] reset ICE restart policy")),ZE.delete(e.id))}function X8(e,t,n){if(pI.size===0&&ZE.size===0&&(Array.isArray(z("RESTART_SEQUENCE"))&&z("RESTART_SEQUENCE").length>0&&!(function(f,g){if(f.length!==g.length)return!1;for(let y=0;y<f.length;y+=1){let v=f[y];if(f.filter(R=>R===v).length!==g.filter(R=>R===v).length)return!1}return!0})(bp,z("RESTART_SEQUENCE"))&&(bp=z("RESTART_SEQUENCE").filter(f=>{var g;if(ke(g=Object.values(Di)).call(g,f))return!0}),k.debug("use reconnection policy from config distribution, queues: ".concat(bp.join(" => ")))),xD=z("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Qt().supportPCSetConfiguration),bp.length===0)return void n();let s,{index:o=0,type:u}=ZE.get(e.id)||{};if(xD&&u===Di.RELAY)return void n();let d=u&&o>=bp.length-1;if(xD)u=Di.RELAY;else{if(d)return void n();u?(o++,u=bp[o]):(u=bp[0],o=0)}k.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(u,", index: ").concat(o)),t(u),ZE.set(e.id,{index:o,type:u}),s=window.setTimeout(()=>X8(e,t,n),Ihe),pI.set(e.id,s)}var en;function J8(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function rd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?J8(Object(n),!0).forEach(function(s){V(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J8(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function $8(e){var t,n,s,o=2;for(typeof Symbol<"u"&&(n=ab,s=Symbol.iterator);o--;){if(n&&(t=e[n])!=null)return t.call(e);if(s&&(t=e[s])!=null)return new fI(t.call(e));n="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function fI(e){function t(n){if(Object(n)!==n)return We.reject(new TypeError(n+" is not an object."));var s=n.done;return We.resolve(n.value).then(function(o){return{value:o,done:s}})}return fI=function(n){this.s=n,this.n=n.next},fI.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var s=this.s.return;return s===void 0?We.resolve({value:n,done:!0}):t(s.apply(this.s,arguments))},throw:function(n){var s=this.s.return;return s===void 0?We.reject(n):t(s.apply(this.s,arguments))}},new fI(e)}let Jm=(en=class extends dr{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(dt.StateChange,t,this._state)}constructor(e,t){super(),V(this,"isPlanB",void 0),V(this,"store",void 0),V(this,"statsUploader",void 0),V(this,"connection",void 0),V(this,"localTrackMap",new Map),V(this,"remoteUserMap",new Map),V(this,"localDataChannels",[]),V(this,"remoteDataChannelMap",new Map),V(this,"pendingLocalTracks",[]),V(this,"pendingRemoteTracks",[]),V(this,"pendingLocalDataChannels",[]),V(this,"pendingRemoteDataChannels",[]),V(this,"statsCollector",void 0),V(this,"shouldForwardP2PCreation",void 0),V(this,"iceFailedCount",0),V(this,"dtlsFailedCount",0),V(this,"mutex",void 0),V(this,"_state",Tn.Disconnected),V(this,"_pcStatsUploadType",z("NEW_ICE_RESTART")?rh.FIRST_CONNECTION:rh.OLD_FIRST_CONNECTION),V(this,"_isStartRestartIce",!1),V(this,"_restartTimer",void 0),V(this,"_isTryConnecting",!1),V(this,"_iceError",null),V(this,"_forceTurn",!1),V(this,"_isWaitPcToRePub",!1),V(this,"handleMuteLocalTrack",async(n,s,o)=>{let u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Tn.Connected)return void o(new _e(Y.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));let d=this.filterTobeMutedTracks(n);if(d.length===0)return void s();let f=d.find(y=>y[0]==="videoLowTrack");if(f){let y=f[1];this.store.enableInstantMuteRestore?(y.track._originMediaStreamTrack.enabled=!1,k.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):y.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?k.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(d.map(y=>{let[,{id:v}]=y;return v}));let g=this.createMuteMessage(d);await Wn(this,dt.RequestMuteLocal,g),s()}catch(d){o(d)}finally{u()}}),V(this,"handleUnmuteLocalTrack",async(n,s,o)=>{let u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Tn.Connected)return void o(new _e(Y.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));let d=this.filterTobeUnmutedTracks(n);if(d.length===0)return void s();let f=d.find(y=>y[0]==="videoLowTrack");if(f){let y=f[1];if(this.store.enableInstantMuteRestore)y.track._originMediaStreamTrack.enabled=!0,k.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(y.track._originMediaStreamTrack.stop(),!z("DISABLE_DUAL_STREAM_USE_ENCODING")&&Qt().supportDualStreamEncoding){let v=n._mediaStreamTrack.clone();y.track._mediaStreamTrack=v,y.track._originMediaStreamTrack=v}else{let v=kD(n,Pm(this,dt.RequestLowStreamParameter));y.track._mediaStreamTrack=v,y.track._originMediaStreamTrack=v}await new We((v,R)=>{this.handleReplaceTrack(y.track,v,R,!0)})}}this.store.enableInstantMuteRestore?k.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(d.map(y=>{let[,{id:v}]=y;return v}));let g=this.createUnmuteMessage(d);await Wn(this,dt.RequestUnmuteLocal,g),s()}catch(d){o(d)}finally{u()}}),V(this,"handleUpdateVideoEncoder",async(n,s,o,u)=>{let d;u||(d=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{let g=this.localTrackMap.get(De.LocalVideoTrack);if(!this.connection||!g||g.track!==n||this.state!==Tn.Connected)return void s();let{id:y,track:v}=g;await this.connection.updateSendParameters(y,v),await this.connection.updateEncoderConfig(y,v),this.emit(dt.UpdateVideoEncoder,v),s()}catch(g){o(g)}finally{var f;(f=d)===null||f===void 0||f()}}),V(this,"handleUpdateVideoSendParameters",async(n,s,o)=>{let u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{let d=this.localTrackMap.get(De.LocalVideoTrack);if(!this.connection||!d||d.track!==n||this.state!==Tn.Connected)return void s();let{id:f,track:g}=d;await this.connection.updateSendParameters(f,g),s()}catch(d){o(d)}finally{u()}}),V(this,"handleReplaceMixingTrack",async(n,s,o,u)=>{if(!this.connection||this.state!==Tn.Connected)return void s();let d=OD([n]),f;k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(d.getTrackId(),"]")),typeof u=="boolean"&&u||(f=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,d),s()}catch(y){o(y)}finally{var g;(g=f)===null||g===void 0||g()}}),V(this,"handleReplaceTrack",async(n,s,o,u)=>{let d;k.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof u=="boolean"&&u||(d=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var f;let y=Array.from(this.localTrackMap.entries()).find(v=>{let[,{track:R}]=v;return n===R});if(!this.connection||!y||this.state!==Tn.Connected)return void s();if(await((f=this.connection)===null||f===void 0?void 0:f.replaceTrack(n,y[1].id)),this.isPlanB){let v=y[1];v.id=n._mediaStreamTrack.id,this.localTrackMap.set(y[0],v)}if(y[0]===De.LocalVideoTrack&&!z("DISABLE_DUAL_STREAM_USE_ENCODING")&&Qt().supportDualStreamEncoding){let v=this.localTrackMap.get(De.LocalVideoLowTrack);if(v){let R=n._mediaStreamTrack.clone();v.track._originMediaStreamTrack.stop(),v.track._mediaStreamTrack=R,v.track._originMediaStreamTrack=R,await new We((b,A)=>{this.handleReplaceTrack(v.track,b,A,!0)})}}s()}catch(y){o(y)}finally{var g;(g=d)===null||g===void 0||g()}}),V(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),V(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),V(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),V(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),V(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new Y8(this.store),this.bindStatsUploaderEvents(),this.mutex=new ki("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Qt().supportUnifiedPlan||z("CHROME_FORCE_PLAN_B")&&qu(),this.shouldForwardP2PCreation=z("FORWARD_P2P_CREATION")&&Qt().supportPCSetConfiguration&&x4(),this.shouldForwardP2PCreation&&(this.connection=YT(this.store),this.emit(dt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=Tn.New,this._forceTurn=PD(e),k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));let s=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||s||t)&&((s||t)&&this.connection&&(k.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=YT(this.store,e),this.emit(dt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new _e(Y.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=z("NEW_ICE_RESTART")?rh.FIRST_CONNECTION:rh.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new _e(Y.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(!this.isPreallocation()||this.state!==Tn.Connected){this.store.peerConnectionStart();let t=await this.connection.connect(e);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Tn.Connected,t}if(this.connection instanceof So&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),tt.reportApiInvoke(this.store.sessionId,{name:or.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:Fn.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(dt.RequestReconnect)});await this.connection.updateRemoteConnect(e)}updateRemoteRTPCapabilities(e){let t=Array.from(this.localTrackMap.entries()).filter(o=>{var u;let[d]=o;return ke(u=[De.LocalVideoLowTrack,De.LocalVideoTrack]).call(u,d)}),n=t.map(o=>{let[,{id:u}]=o;return u}),s=t.map(o=>{let[u]=o;return u});if(this.connection instanceof So||this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"){if(tt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(s),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!ke(e).call(e,this.store.codec)){let o=["vp9","vp8","h264"].find(u=>ke(e).call(e,u));o&&(this.store.codec=o,k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(o,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;return this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof So&&this.connection.peerConnectionState!=="closed"&&ke(e=[Tn.New,Tn.Connected]).call(e,this.state)?this.connection.establishPromise:void 0}async publishDataChannel(e){if(!this.connection||this.state!==Tn.Connected){if(this.state===Tn.Disconnected)throw new _e(Y.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(n=>{var s;ke(s=this.pendingLocalDataChannels).call(s,n)||this.pendingLocalDataChannels.push(n)}),[]}let t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(n=>{let s=Date.now();this.store.publish(n.id.toString(),"datachannel",s)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(n=>{this.localDataChannels.push(n);let s=Date.now();this.store.publish(n.id+"","datachannel",void 0,s)}),e.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(e,t,n){var s=this;return aa(function*(){let o=yield Ft(s.mutex.lock("From P2PChannel.publish"));try{var u;let d=s.connection&&ke(u=["disconnected","failed"]).call(u,s.connection.peerConnectionState);if(!s.connection||s.state!==Tn.Connected||d){if(s.state===Tn.Disconnected)throw new _e(Y.UNEXPECTED_ERROR,"PeerConnection already disconnected.");s.throwIfTrackTypeNotMatch(e);let g=e.filter(y=>s.pendingLocalTracks.indexOf(y)===-1);return s.pendingLocalTracks=s.pendingLocalTracks.concat(g),void(d&&(s._isWaitPcToRePub=!0))}s.store.pubId=s.store.pubId+1,fs.markPublishStart(s.store.clientId,s.store.pubId);let f=s.filterTobePublishedTracks(e,t,n);if(f.length===0)return void(yield Ft(s.tryToUnmuteAudio(e)));yield*TE($8(s.doPublish(s.connection,f)))}finally{o()}})()}doPublish(e,t){var n=this;return aa(function*(){t.forEach(b=>{let{track:A,type:F}=b,M=Date.now();n.store.publish(A.getTrackId(),F===De.LocalAudioTrack?"audio":"video",M)}),n.bindLocalTrackEvents(t);let s=t.map(b=>{let{track:A}=b;return A}),o=yield Ft(e.send(s,n.store.codec,n.store.audioCodec)),u=(yield Ft(o.next())).value,d=n.createGatewayPublishMessage(t,u),f;try{f=yield d}catch(b){throw o.throw(b),b?.code===Y.WS_ABORT&&t.forEach(A=>{let{track:F}=A;n.pendingLocalTracks.indexOf(F)===-1&&n.pendingLocalTracks.push(F)}),n.unbindLocalTrackEvents(t),b}let g=n.mapPubResToRemoteConfig(d,f,s),y=(yield Ft(o.next(g))).value;if(n.state===Tn.Disconnected)throw new _e(Y.UNEXPECTED_ERROR,"PeerConnection already disconnected.");z("ENABLE_VIDEO_SEI");let v=z("ENABLE_ENCODED_TRANSFORM"),R=z("ENABLE_AUDIO_METADATA");s.forEach(async b=>{let A=b.getRTCRtpTransceiver();if(!A||!v)return;let{interceptLocalVideoFrame:F,interceptLocalAudioFrame:M}=rI();b.trackMediaType===et.VIDEO?await F(A.sender,b):b.trackMediaType===et.AUDIO&&await M(A.sender,{metadata:R?()=>{let j=b.metadata.shift();return j&&j.value}:void 0})}),t.forEach(b=>{let{type:A}=b;n.statsCollector.addLocalStats(A)}),n.assignLocalTracks(t,y),n.statsUploader.startUploadOutboundStats(),t.forEach(b=>{let{track:A,type:F}=b,M=Date.now();n.store.publish(A.getTrackId(),F===De.LocalAudioTrack?"audio":"video",void 0,M)})})()}async updateVideoStreamParameter(e,t){let n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof jn))return k.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");let{track:s}=n,o=(function(u,d){let f={};return u.height&&u.width&&(f.scaleResolutionDownBy=cD(u,d)),f.maxFramerate=u.framerate?da(u.framerate):void 0,f.maxBitrate=u.bitrate?1e3*u.bitrate:void 0,f})(e,s);if(s._encoderConfig||(s._encoderConfig={}),t!==De.LocalVideoLowTrack||!z("DISABLE_DUAL_STREAM_USE_ENCODING")&&Qt().supportDualStreamEncoding)o.scaleResolutionDownBy!=null&&(s._encoderConfig.scaleResolutionDownBy=o.scaleResolutionDownBy);else{let u=s._originMediaStreamTrack;if(!u.canvas)return k.warn("[".concat(s.getTrackId(),"] no canvas on track"));(function(d,f){let g=d.canvas;f.width&&(g.width=da(f.width)),f.height&&(g.height=da(f.height)),f.framerate&&(g.stopCapture&&g.stopCapture(),g.stopCapture=kk(()=>{!g.startCapture&&g.stopCapture&&g.stopCapture(),g.startCapture&&g.startCapture()},da(f.framerate)))})(u,e)}o.maxBitrate!=null&&(s._encoderConfig.bitrateMax=o.maxBitrate/1e3),o.maxFramerate!=null&&(s._encoderConfig.frameRate&&typeof s._encoderConfig.frameRate=="object"?s._encoderConfig.frameRate.max=o.maxFramerate:s._encoderConfig.frameRate={max:o.maxFramerate}),k.debug("[".concat(s.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(s._encoderConfig))),await this.connection.updateRtpSenderEncodings(s)}publishLowStream(e){var t=this;return aa(function*(){if(!t.connection||t.state!==Tn.Connected)return;let n=yield Ft(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{let o=t.localTrackMap.get(De.LocalVideoTrack);if(!o)throw new _e(Y.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(De.LocalVideoLowTrack))throw new _e(Y.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));let u=[{track:t.getLowVideoTrack(o.track,e),type:De.LocalVideoLowTrack}];if(yield*TE($8(t.doPublish(t.connection,u))),o.track.muted||!o.track.enabled){var s;let d=(s=t.localTrackMap.get(De.LocalVideoLowTrack))===null||s===void 0?void 0:s.id;d!==void 0&&(yield Ft(t.connection.muteLocal([d])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(k.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ei(this,dt.RequestRePublish,this.pendingLocalTracks),this.emit(dt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(k.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await ei(this,dt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){let{user:n,kind:s}=this.pendingRemoteTracks[t];(s!==et.AUDIO||n._audio_added_&&n._audioSSRC)&&(s!==et.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await ei(this,dt.RequestReSubscribe,this.pendingRemoteTracks);else for(let{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===et.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:n}=t;this.emit(dt.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Tn.Connected)return void e.forEach(s=>{let o=this.pendingLocalTracks.indexOf(s);o!==-1&&this.pendingLocalTracks.splice(o,1)});let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let n=t.find(s=>s[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==Tn.Connected)return void e.forEach(n=>{let s=this.pendingLocalDataChannels.indexOf(n);s!==-1&&this.pendingLocalDataChannels.splice(s,1)});let t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(n=>{let s=this.localDataChannels.indexOf(n);s!==-1&&this.localDataChannels.splice(s,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Tn.Connected)return;let e=this.localTrackMap.get(De.LocalVideoLowTrack);if(!e)return;e.track.close();let t=[[De.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){let n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(s=>{let[,{id:o}]=s;return o})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(s=>{let[o,{track:u}]=s;return{type:o,track:u}})),t.forEach(s=>{let[o]=s;this.statsCollector.removeLocalStats(o)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==Tn.Connected)throw new _e(Y.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");let n=t.filter(s=>{var o;return!((o=this.remoteDataChannelMap.get(e))!==null&&o!==void 0&&o.get(s.id))});if(n.length!==0)return await this.connection.createDataChannels(e.uid,n),n.forEach(s=>{var o;this.remoteDataChannelMap.has(e)?(o=this.remoteDataChannelMap.get(e))===null||o===void 0||o.set(s.id,s):this.remoteDataChannelMap.set(e,new Map([[s.id,s]]));let u=this.pendingRemoteDataChannels.findIndex(d=>{let{user:f,id:g}=d;return f.uid===e.uid&&g===s.id});u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),n.map(s=>s.id)}async subscribe(e,t,n,s,o){var u;if(!this.connection||this.state!==Tn.Connected)throw new _e(Y.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(e))!==null&&u!==void 0&&u.has(t))return;let d,f,g,y,v=this.connection.getPreMedia(n);if(v)k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),g=v.transceiver,d=v.track,f=v.mid,y=v.player,v.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:v.firstVideoRender});else if(o){let A=o.find(M=>{let{stream_type:j}=M;return j===t});if(!A)throw new _e(Y.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));let F=await this.connection.receive(t,A.ssrcs,String(e._uintid),A.attributes);(this.connection instanceof So||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(g=F.transceiver),d=F.track,f=F.id}else{let A=await this.connection.receive(t,[{ssrcId:n,rtx:s}],String(e._uintid),void 0);(this.connection instanceof So||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(g=A.transceiver),d=A.track,f=A.id}if(t===et.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(d):(e._audioTrack=new FE(d,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),g&&e._audioTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(d):(e._videoTrack=new VE(d,e.uid,e._uintid,this.store,y),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once($o.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once($o.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),y?e._videoTrack.once($o.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once($o.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),g&&e._videoTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(e,e._videoTrack)),g&&z("ENABLE_ENCODED_TRANSFORM")){let{interceptRemoteVideoFrame:A,interceptRemoteAudioFrame:F}=rI();t==et.VIDEO?await A(g.receiver,{onSei:z("ENABLE_VIDEO_SEI")&&(M=>{var j;return(j=e._videoTrack)===null||j===void 0?void 0:j._onSei(M)}),onFirstFrame:M=>{var j;let K=Array.from(ys(j=this.remoteUserMap).call(j)).find(q=>q._videoSSRC===M.ssrc);K&&this.store.firstVideoFrameDecoded(K.uid,{firstReceivedEncodedFrame:Date.now(),frameType:M.type,rtpTimestamp:M.rtpTimestamp,framePayloadType:M.payloadType,frameDataLength:M.length,mimeType:M.mimeType})}}):t==et.AUDIO&&await F(g.receiver,{enableTopn:!!z("ENABLE_AUDIO_TOPN"),enableMetadata:!!z("ENABLE_AUDIO_METADATA"),enablePts:!!z("ENABLE_AUDIO_PTS"),onMetadata:M=>{this.safeEmit(dt.AudioMetadata,M)},onPts:M=>{this.safeEmit(dt.AudioPts,M)}})}let R=this.remoteUserMap.get(e);R?R.set(t,f):this.remoteUserMap.set(e,new Map([[t,f]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();let b=this.pendingRemoteTracks.findIndex(A=>{let{user:F,kind:M}=A;return F.uid===e.uid&&t===M});b!==-1&&(this.pendingRemoteTracks.splice(b,1),this.emit(dt.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Tn.Connected)throw new _e(Y.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(o=>{var u;let{user:d,mediaType:f}=o;return!((u=this.remoteUserMap.get(d))!==null&&u!==void 0&&u.has(f))});let t=[],n=new Map;e.forEach(o=>{if(!this.connection)return;let u=this.connection.getPreMedia(o.ssrcId);if(u){let{track:d,mid:f,transceiver:g,player:y}=u;n.set(o.ssrcId,{track:d,id:f,transceiver:g,player:y})}else t.push(o)});let s=await this.connection.batchReceive(t.map(o=>{let{user:u,mediaType:d,ssrcId:f,rtxSsrcId:g}=o;return{kind:d,ssrcMsg:[{ssrcId:f,rtx:g}],mslabel:String(u._uintid)}}));t.forEach((o,u)=>{n.set(o.ssrcId,s[u])});for(let{user:o,mediaType:u,ssrcId:d}of e){let f=n.get(d);if(!f)return void k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(o.uid," subscribe data,").concat(u,", ").concat(d));let{track:g,id:y,transceiver:v,player:R}=f;if(v&&z("ENABLE_ENCODED_TRANSFORM")){let{interceptRemoteVideoFrame:F,interceptRemoteAudioFrame:M}=rI();u==et.VIDEO?await F(v.receiver,{onSei:z("ENABLE_VIDEO_SEI")&&(j=>{var K;return(K=o._videoTrack)===null||K===void 0?void 0:K._onSei(j)}),onFirstFrame:j=>{var K;let q=Array.from(ys(K=this.remoteUserMap).call(K)).find(Q=>Q._videoSSRC===j.ssrc);q&&this.store.firstVideoFrameDecoded(q.uid,{firstReceivedEncodedFrame:Date.now(),frameType:j.type,rtpTimestamp:j.rtpTimestamp,framePayloadType:j.payloadType,frameDataLength:j.length,mimeType:j.mimeType})}}):u==et.AUDIO&&await M(v.receiver,{enableTopn:!!z("ENABLE_AUDIO_TOPN"),enableMetadata:!!z("ENABLE_AUDIO_METADATA"),enablePts:!!z("ENABLE_AUDIO_PTS"),onMetadata:j=>{this.safeEmit(dt.AudioMetadata,j)},onPts:j=>{this.safeEmit(dt.AudioPts,j)}})}if(u===et.AUDIO?(o._audioTrack?o._audioTrack._updateOriginMediaStreamTrack(g):(o._audioTrack=new FE(g,o.uid,o._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(o._audioTrack.getTrackId()))),v&&o._audioTrack._updateRtpTransceiver(v),this.bindRemoteTrackEvents(o,o._audioTrack)):(o._videoTrack?o._videoTrack._updateOriginMediaStreamTrack(g):(o._videoTrack=new VE(g,o.uid,o._uintid,this.store,R),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(o._videoTrack.getTrackId()))),v&&o._videoTrack._updateRtpTransceiver(v),this.bindRemoteTrackEvents(o,o._videoTrack)),z("ENABLE_VIDEO_SEI")&&v){let{interceptRemoteVideoFrame:F,interceptRemoteAudioFrame:M}=rI();u==et.VIDEO?await F(v.receiver,{onSei:j=>{var K;(K=o._videoTrack)===null||K===void 0||K._onSei(j)},onFirstFrame:j=>{var K;let q=Array.from(ys(K=this.remoteUserMap).call(K)).find(Q=>Q._videoSSRC===j.ssrc);q&&this.store.firstVideoFrameDecoded(q.uid,{firstReceivedEncodedFrame:Date.now(),frameType:j.type,rtpTimestamp:j.rtpTimestamp,framePayloadType:j.payloadType,frameDataLength:j.length,mimeType:j.mimeType})}}):u==et.AUDIO&&await M(v.receiver)}let b=this.remoteUserMap.get(o);b?b.set(u,y):this.remoteUserMap.set(o,new Map([[u,y]])),this.statsCollector.addRemoteStats(o.uid),this.statsUploader.startUploadInboundStats();let A=this.pendingRemoteTracks.findIndex(F=>{let{user:M,kind:j}=F;return M.uid===o.uid&&u===j});A!==-1&&(this.pendingRemoteTracks.splice(A,1),this.emit(dt.MediaReconnectEnd,o.uid))}}async unsubscribe(e,t,n){let s=this.pendingRemoteTracks.filter(d=>{let{user:f,kind:g}=d;return t!==void 0?f.uid===e.uid&&t===g:f.uid===e.uid});if(s.forEach(d=>{let f=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(f,1)}),this.connection&&this.state===Tn.Connected||n||s.forEach(d=>{let{kind:f}=d;var g;if(f===et.AUDIO)(g=e._audioTrack)===null||g===void 0||g._destroy(),e._audioTrack=void 0;else if(f===et.VIDEO){var y;(y=e._videoTrack)===null||y===void 0||y._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Tn.Connected)return;let o=this.filterTobeUnSubscribedTracks(e,t);if(o.length===0)return;await this.connection.stopReceiving(o.map(d=>{let[,{id:f}]=d;return f}));let u=this.createUnsubscribeMessage(o);return this.withdrawRemoteTracks(o),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),o.forEach(d=>{let[f,{kind:g}]=d;var y,v;if(g===et.VIDEO&&f._videoSSRC&&((y=this.connection)===null||y===void 0||y.setStatsRemoteVideoIsReady(f._videoSSRC,!1)),g===et.VIDEO)this.unbindRemoteTrackEvents(f._videoTrack),n||((v=f._videoTrack)===null||v===void 0||v._destroy(),f._videoTrack=void 0);else if(g===et.AUDIO){var R;this.unbindRemoteTrackEvents(f._audioTrack),!n&&((R=f._audioTrack)===null||R===void 0||R._destroy(),f._audioTrack=void 0)}}),u}async unsubscribeDataChannel(e,t){if(t.forEach(o=>{let u=this.pendingRemoteDataChannels.findIndex(d=>d.id===o.id);u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),!this.connection)return;let n=this.filterTobeUnSubscribedDataChannels(e,t);if(n.length===0)return;t.forEach(o=>{o._close()});let s=this.remoteDataChannelMap.get(e);return n.forEach(o=>{s&&s.delete(o.id)}),s&&s.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map(o=>o.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(let{user:o,mediaType:u}of e){let d=this.pendingRemoteTracks.filter(f=>{let{user:g,kind:y}=f;return u!==void 0?g.uid===o.uid&&u===y:g.uid===o.uid});d.forEach(f=>{let g=this.pendingRemoteTracks.indexOf(f);this.pendingRemoteTracks.splice(g,1)}),t=t.concat(d)}if(!this.connection||this.state!==Tn.Connected)return void t.forEach(o=>{let{user:u,kind:d}=o;var f;if(d===et.AUDIO)(f=u._audioTrack)===null||f===void 0||f._destroy(),u._audioTrack=void 0;else if(d===et.VIDEO){var g;(g=u._videoTrack)===null||g===void 0||g._destroy(),u._videoTrack=void 0}});let n=ta(e).call(e,(o,u)=>{let{user:d,mediaType:f}=u,g=this.filterTobeUnSubscribedTracks(d,f);return o.concat(g)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(o=>{let[,{id:u}]=o;return u}));let s=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(o=>{let[u,{kind:d}]=o;var f,g;if(d===et.VIDEO&&u._videoSSRC&&((f=this.connection)===null||f===void 0||f.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),d===et.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(g=u._videoTrack)===null||g===void 0||g._destroy(),u._videoTrack=void 0;else if(d===et.AUDIO){var y;this.unbindRemoteTrackEvents(u._audioTrack),(y=u._audioTrack)===null||y===void 0||y._destroy(),u._audioTrack=void 0}}),s}isPreSubScribe(e){return!this.connection||this.state!==Tn.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;let n=this.remoteUserMap.get(e);if(!n)return void k.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void k.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let s=t===et.VIDEO?e._videoSSRC:e._audioSSRC;s!==void 0&&this.connection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;let n=this.remoteUserMap.get(e);if(!n)return void k.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||k.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){let t=this.localTrackMap.get(De.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){let t=this.localTrackMap.get(De.LocalAudioTrack);if(t?.track instanceof oi){let n=t.track;return Array.from(this.localTrackMap.entries()).filter(s=>{let[o]=s;return o!==De.LocalAudioTrack}).filter(s=>{let[o]=s;return!(e&&o===De.LocalVideoLowTrack)}).map(s=>{let[,{track:o}]=s;return o}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[s]=n;return!(e&&s===De.LocalVideoLowTrack)}).map(n=>{let[,{track:s}]=n;return s})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,s,o){if(e){let d=this.localTrackMap.get(De.LocalAudioTrack),f=s?this.localTrackMap.get(De.LocalVideoLowTrack):this.localTrackMap.get(De.LocalVideoTrack);tt.publish(this.store.sessionId,{eventElapse:fs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d?.track.getTrackLabel(),videoName:f?.track.getTrackLabel(),screenshare:f?.track._hints.indexOf(bn.SCREEN_TRACK)!==-1,audio:!!d,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}else{var u;n||(n=[]);let d=n.find(g=>g instanceof Nr),f=s?(u=this.localTrackMap.get(De.LocalVideoTrack))===null||u===void 0?void 0:u.track:n.find(g=>g instanceof jn);tt.publish(this.store.sessionId,{eventElapse:fs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d?.getTrackLabel(),videoName:f?.getTrackLabel(),screenshare:f?._hints.indexOf(bn.SCREEN_TRACK)!==-1,audio:!!d,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}}reportSubscribeEvent(e,t,n,s){let o=s===et.VIDEO?n._videoSSRC:n._audioSSRC;o&&tt.subscribe(this.store.sessionId,{succ:e,ec:t,video:s===et.VIDEO,audio:s===et.AUDIO,peerid:n.uid,subscribeRequestid:o,p2pid:this.store.p2pId,eventElapse:fs.measureFromSubscribeStart(this.store.clientId,o),preSsrc:this.isPreSubScribe(o)})}reset(){k.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new ki("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=YT(this.store),this.emit(dt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(De.LocalAudioTrack);if(e?.track instanceof oi){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Tn.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(De.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(De.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof jn||t&&t.track instanceof Nr?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;let n=Array.from(ys(t=this.remoteUserMap).call(t)).find(s=>s.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[s]=n;return{uid:s.uid,level:s.audioTrack?100*s.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(De.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=vm(e).call(e,(n,s)=>n.level-s.level),e}async disconnectForReconnect(){this.connection&&(k.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Tn.Reconnecting,z("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=YT(this.store),this.emit(dt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:s}]=e;switch(n){case De.LocalVideoTrack:ke(t=s._hints).call(t,bn.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case De.LocalAudioTrack:s instanceof oi?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case De.LocalVideoLowTrack:}}),this.emit(dt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(ys(n).call(n)).forEach(s=>{this.setPendingRemoteMedia(t,s)}),this.emit(dt.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,n]=e;Array.from(ys(n).call(n)).forEach(s=>{this.setPendingRemoteDataChannel(t,s)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),k.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(let n of this.pendingRemoteDataChannels){let{user:s,id:o}=n;if((e instanceof Rp?e.uid:e)===s.uid&&o===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(let n of this.pendingRemoteTracks){let{user:s,kind:o}=n;if((e instanceof Rp?e.uid:e)===s.uid&&t===o)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return aa(function*(){if(!t.connection||t.state!==Tn.Connected)return;let n=yield Ft(t.mutex.lock("From P2PChannel.restartICE")),s;try{s=yield Ft(t.connection.restartICE(e));let u=yield Ft(s.next());if(u.done)return;let d=u.value,f=yield d;switch(ND(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case Di.UDP_TCP_RELAY:t._pcStatsUploadType=rh.UDP_TCP_RESTART;break;case Di.TCP_RELAY:t._pcStatsUploadType=rh.TCP_RESTART;break;case Di.RELAY:t._pcStatsUploadType=rh.RELAY_RESTART;break;default:t._pcStatsUploadType=rh.OLD_RESTART}t._isTryConnecting=!0,s.next(f)}catch(u){var o;(o=s)===null||o===void 0||o.throw(u)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=this.localTrackMap.get(De.LocalVideoTrack),n=this.localTrackMap.get(De.LocalAudioTrack),s=e.videoSend.find(A=>A.ssrc===t?.ssrcs[0].ssrcId),o=e.audioSend.find(A=>A.ssrc===n?.ssrcs[0].ssrcId);if(!s||!o)return 1;let u=qa(this,dt.NeedSignalRTT),d=s?s.rttMs:void 0,f=o?o.rttMs:void 0,g=d&&f?(d+f)/2:d||f,y=(g&&u?(g+u)/2:g||u)||0,v=100*e.sendPacketLossRate*.7/50+.3*y/1500,R=v<.17?1:v<.36?2:v<.59?3:v<.1?4:5,b=t?.track;if(b&&b._encoderConfig&&b._hints.indexOf(bn.SCREEN_TRACK)===-1){let A=b._encoderConfig.bitrateMax,F=e.bitrate.actualEncoded;if(A&&F){let M=(1e3*A-F)/(1e3*A);return UW[M<.15?0:M<.3?1:M<.45?2:M<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[s]=n,o=s._audioSSRC,u=s._videoSSRC,d=e.audioRecv.find(F=>F.ssrc===o),f=e.videoRecv.find(F=>F.ssrc===u);if(!d&&!f)return void(t+=1);let g=qa(this,dt.NeedSignalRTT),y=e.rtt,v=(y&&g?(y+g)/2:y||g)||0,R=d?d.jitterMs:void 0,b=e.recvPacketLossRate,A=.7*b*100/50+.3*v/1500;R&&(A=.6*b*100/50+.2*v/1500+.2*R/400),t+=A<.1?1:A<.17?2:A<.36?3:A<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new We((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}async replaceTrack(e,t){var n;if(k.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==Tn.Connected)return;let s=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:d}]=u;return e===d});if(!s)return;let o=s[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:o}]),this.bindLocalTrackEvents([{track:t,type:o}]),s[1].track=t),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(t,s[1].id)),this.isPlanB){let u=s[1];u.id=t._mediaStreamTrack.id,this.localTrackMap.set(o,u)}if(o===De.LocalVideoTrack&&!z("DISABLE_DUAL_STREAM_USE_ENCODING")&&Qt().supportDualStreamEncoding){let u=this.localTrackMap.get(De.LocalVideoLowTrack);if(u){let d=e._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=d,u.track._originMediaStreamTrack=d,await new We((f,g)=>{this.handleReplaceTrack(u.track,f,g,!0)})}}}filterTobePublishedTracks(e,t,n){let s=[],o=this.getAllTracks();e=RE(e=e.filter(g=>o.indexOf(g)===-1));let u,d=!1,f=this.localTrackMap.get(De.LocalAudioTrack);for(let g of e){if(g instanceof jn&&(this.localTrackMap.has(De.LocalVideoTrack)||d?new _e(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:g,type:De.LocalVideoTrack}),d=!0),t)){let y=this.getLowVideoTrack(g,n);s.push({track:y,type:De.LocalVideoLowTrack})}if(g instanceof Nr)if(f){let y=f.track;if(y instanceof oi)AD([g]),y.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0);else{let v=OD([y,g]);k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(v.getTrackId(),"]")),this.replaceTrack(y,v)}}else u instanceof oi?(AD([g]),u.addAudioTrack(g)):u||!g._useAudioElement&&Qt().webAudioMediaStreamDest&&!g._bypassWebAudio?u=OD(u?[g,u]:[g]):u=g}return u&&(k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(u.getTrackId(),"]")),s.push({track:u,type:De.LocalAudioTrack})),s}filterTobeUnpublishedTracks(e){let t=[],n=this.getAllTracks();e=RE(e=e.filter(s=>n.indexOf(s)!==-1));for(let s of e){if(s instanceof Nr){let o=this.localTrackMap.get(De.LocalAudioTrack);if(!o)continue;o.track instanceof oi?(o.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),o.track.trackList.length===0&&(t.push([De.LocalAudioTrack,o]),o.track.close())):t.push([De.LocalAudioTrack,o])}if(s instanceof jn){let o=this.localTrackMap.get(De.LocalVideoTrack);if(!o)continue;t.push([De.LocalVideoTrack,o]);let u=this.localTrackMap.get(De.LocalVideoLowTrack);u&&t.push([De.LocalVideoLowTrack,u])}}return t}filterTobePublishedDataChannels(e){return e=(e=RE(e)).filter(t=>this.localDataChannels.findIndex(n=>n.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=RE(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:s}=t;switch(s){case De.LocalVideoTrack:n.addListener(nt.GET_STATS,this.handleGetLocalVideoStats),n.addListener(nt.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(nt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(nt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case De.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case De.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof oi?e.trackList.forEach(n=>{n.addListener(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(nt.GET_STATS,this.handleGetLocalAudioStats),n.addListener(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(nt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(nt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:s}]=t;return{track:s,type:n}})),e.forEach(t=>{let{track:n,type:s}=t;switch(s){case De.LocalVideoTrack:n.off(nt.GET_STATS,this.handleGetLocalVideoStats),n.off(nt.GET_RTC_STATS,this.handleGetRTCStats),n.off(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(nt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(nt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case De.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case De.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof oi?e.trackList.forEach(t=>{t.off(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(nt.GET_STATS,this.handleGetLocalAudioStats),t.off(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(nt.GET_STATS,this.handleGetLocalAudioStats),e.off(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(nt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof VE&&t.addListener(nt.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof FE&&t.addListener(nt.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(nt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(et.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(et.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,s)=>{var o;let u,d,{track:f,type:g}=n;switch(g){case De.LocalAudioTrack:u=On.Audio,d={dtx:f instanceof LT&&f._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case De.LocalVideoTrack:u=ke(o=f._hints).call(o,bn.SCREEN_TRACK)?On.Screen:On.High,d=rd(rd({},QW(f)),{},{codec:this.store.codec,svc_mode:FT()});break;case De.LocalVideoLowTrack:u=On.Low,d=rd(rd({},QW(f)),{},{codec:this.store.codec,svc_mode:FT()})}return{stream_type:u,attributes:d,ssrcs:t[s]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let s,[o,{track:u,ssrcs:d,id:f}]=t;switch(o){case De.LocalVideoTrack:s=ke(n=u._hints).call(n,bn.SCREEN_TRACK)?On.Screen:On.High;break;case De.LocalAudioTrack:s=On.Audio;break;case De.LocalVideoLowTrack:s=On.Low}return{stream_type:s,ssrcs:d,mid:f}})}assignLocalTracks(e,t){e.forEach((n,s)=>{let{track:o,type:u}=n;this.localTrackMap.set(u,{track:o,id:t[s].id,ssrcs:t[s].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(dt.PeerConnectionStateChange,t),t==="connecting"&&e instanceof So&&!$n()&&z("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},z("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof So&&q8(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=rh.DISCONNECTED_OR_FAILED,qa(this,dt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){let n=this.pendingLocalTracks.map(o=>o.getTrackId()),s=this.pendingLocalDataChannels.map(o=>"dc_".concat(o.id));tt.reportApiInvoke(this.store.sessionId,{name:or.REPUB_AFTER_PC_CONNECTED,options:n.concat(s),tag:Fn.TRACER}).onSuccess(),this.republish()}if(z("NEW_ICE_RESTART")&&e instanceof So&&!$n()&&!this._forceTurn&&!this.store.useDcSignal){if(ke(KW).call(KW,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;let n=o=>{ND(e)&&(k.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(o)),qa(this,dt.QueryClientConnectionState)==="CONNECTED"&&this.emit(dt.RequestRestartICE,o))},s=()=>{ND(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),k.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(dt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{X8(e,n,s)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&z("ICE_RESTART")&&qa(this,dt.QueryClientConnectionState)==="CONNECTED"&&this.emit(dt.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(dt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(dt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),tt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Fn.TRACER}).onSuccess(),this.emit(dt.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;let s=Array.from(ys(n=this.remoteUserMap).call(n)).find(u=>u._audioSSRC===t);var o;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),(o=s.audioTrack)===null||o===void 0||o.emit($o.FIRST_FRAME_DECODED),tt.firstRemoteFrame(this.store.sessionId,ai.FIRST_AUDIO_DECODE,cr.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:fs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;let s=Array.from(ys(n=this.remoteUserMap).call(n)).find(o=>o._audioSSRC===t);s&&tt.firstRemoteFrame(this.store.sessionId,ai.FIRST_AUDIO_RECEIVED,cr.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:fs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,s)=>{var o;let u=Array.from(ys(o=this.remoteUserMap).call(o)).find(d=>d._videoSSRC===t);u&&this.store.firstVideoFrameDecoded(u.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,n,s)},e.onFirstVideoRender=t=>{var n;let s=Array.from(ys(n=this.remoteUserMap).call(n)).find(o=>o._videoSSRC===t);s&&(this.store.firstVideoFrameDecoded(s.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(s),this.emit(dt.FirstVideoPreRender,s.uid,t))},e.onFirstVideoReceived=t=>{var n;let s=Array.from(ys(n=this.remoteUserMap).call(n)).find(o=>o._videoSSRC===t);s&&(this.store.firstVideoFrameDecoded(s.uid,{firstReceived:Date.now()}),tt.firstRemoteFrame(this.store.sessionId,ai.FIRST_VIDEO_RECEIVED,cr.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:fs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstVideoBufferReady=t=>{var n;let s=Array.from(ys(n=this.remoteUserMap).call(n)).find(o=>o._videoSSRC===t);s&&this.emit(dt.FirstVideoBufferReady,s.uid,t)},e.onSelectedLocalCandidateChanged=(t,n)=>{let s=t.candidateType==="relay",o=n.candidateType==="relay";n.candidateType!=="unknown"&&s===o||this.emit(dt.ConnectionTypeChange,s),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(wp(n))," -> ").concat(JSON.stringify(wp(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(wp(n))," -> ").concat(JSON.stringify(wp(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{let t=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return rd(rd({},t),n)},e.onICECandidateError=t=>{this._iceError=t}}fallbackConnection(){k.debug("[".concat(this.store.clientId,"] [P2PChannel] try to fallback connection")),this.state===Tn.Connected?(k.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&this.resetConnection(this.connection),this.shouldForwardP2PCreation&&(this.connection=YT(this.store),this.emit(dt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)))}resetConnection(e){e instanceof So&&(function(t){ZE.delete(t.id),q8(t)})(e),e.close(),this.emit(dt.PeerConnectionStateChange,"closed"),(function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0})(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let n=this.localTrackMap.get(De.LocalAudioTrack);if(e instanceof Nr&&n?.track instanceof oi)return n.track.isActive||t.push([De.LocalAudioTrack,n]),t;let s=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:u}]=o;return e===u});if(s&&(t.push(s),s[0]===De.LocalVideoTrack)){let o=this.localTrackMap.get(De.LocalVideoLowTrack);o&&t.push([De.LocalVideoLowTrack,o])}return t}filterTobeUnmutedTracks(e){let t=[],n=this.localTrackMap.get(De.LocalAudioTrack);if(e instanceof Nr&&n?.track instanceof oi)return n.track.isActive&&t.push([De.LocalAudioTrack,n]),t;let s=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:u}]=o;return e===u});if(s)if(s[0]===De.LocalVideoTrack){t.push(s);let o=this.localTrackMap.get(De.LocalVideoLowTrack);o&&t.push([De.LocalVideoLowTrack,o])}else t.push(s);return t}createMuteMessage(e){return e.map(t=>{var n;let s,[o,{track:u,ssrcs:d,id:f}]=t;switch(o){case De.LocalAudioTrack:s=On.Audio;break;case De.LocalVideoTrack:s=ke(n=u._hints).call(n,bn.SCREEN_TRACK)?On.Screen:On.High;break;case De.LocalVideoLowTrack:s=On.Low}return{stream_type:s,ssrcs:d,mid:f}})}createUnmuteMessage(e){return e.map(t=>{var n;let s,[o,{track:u,ssrcs:d,id:f}]=t;switch(o){case De.LocalAudioTrack:s=On.Audio;break;case De.LocalVideoTrack:s=ke(n=u._hints).call(n,bn.SCREEN_TRACK)?On.Screen:On.High;break;case De.LocalVideoLowTrack:s=On.Low}return{stream_type:s,ssrcs:d,mid:f}})}filterTobeUnSubscribedTracks(e,t){let n=[],s=this.remoteUserMap.get(e);if(!s)return n;if(t){let o=s.get(t);if(!o)return n;n.push([e,{kind:t,id:o}])}else Array.from(s.entries()).forEach(o=>{let[u,d]=o;n.push([e,{kind:u,id:d}])});return n}filterTobeUnSubscribedDataChannels(e,t){let n=[];return t.forEach(s=>{var o;(o=this.remoteDataChannelMap.get(e))!==null&&o!==void 0&&o.has(s.id)&&n.push(s)}),n}createUnsubscribeMessage(e){let t=[];return e.forEach(n=>{let[s,{kind:o,id:u}]=n;switch(o){case et.VIDEO:return void(s._videoSSRC&&t.push({stream_type:et.VIDEO,ssrcId:s._videoSSRC}));case et.AUDIO:return void(s._audioSSRC&&t.push({stream_type:et.AUDIO,ssrcId:s._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){let t=new Map;return e.forEach(n=>{let[s,{kind:o}]=n;if(t.has(s)){let u=t.get(s);o===et.VIDEO?u|=bi.Video:u|=bi.Audio,t.set(s,u)}else o===et.VIDEO?t.set(s,bi.Video):t.set(s,bi.Audio)}),{users:Array.from(t.entries()).map(n=>{let[s,o]=n;return{stream_id:s.uid,stream_type:o}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:s}]=t,o=this.remoteUserMap.get(n);o&&(o.delete(s),Array.from(o.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(De.LocalVideoTrack),n=this.localTrackMap.get(De.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new We((s,o)=>{this.handleUpdateVideoEncoder(t.track,s,o,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new We((s,o)=>{this.handleUpdateVideoEncoder(n.track,s,o,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return!(!this.connection||!("name"in this.connection)||this.connection.name!=="DataChannelConnection"||this.connection.peerConnectionState==="closed")||this.connection instanceof So&&this.connection.isPreallocation}isPreSub(){return(this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof So)&&this.connection.isPreSub()}isPreRender(){return this.connection instanceof So&&this.connection.isPreRender}mapPubResToRemoteConfig(e,t,n){return e.map((s,o)=>{var u;let{stream_type:d}=s,f=(u=t.find(g=>{let{stream_type:y}=g;return d===y}))===null||u===void 0?void 0:u.attributes;if(f&&z("DISABLE_SCREEN_SHARE_REMB")){let g=n[o]._hints;(ke(g).call(g,bn.SCREEN_TRACK)||ke(g).call(g,bn.SCREEN_LOW_TRACK))&&(f.remb=!1,k.debug("disable remb for screen share, hints:",g))}return f})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof Nr){var t;let s=this.filterTobeUnmutedTracks(e[n]);if(s.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(s.map(u=>{let[,{id:d}]=u;return d})));let o=this.createUnmuteMessage(s);return void await Wn(this,dt.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(dt.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(dt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Ci(yb(this.dtlsFailedCount,Kr)),this.emit(dt.RequestReconnect)}async reconnectP2P(){let e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await ei(this,dt.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(dt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(De.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof jn)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof jn).length>1)throw new _e(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Nr).length>1&&(e.some(t=>t instanceof Nr&&t._bypassWebAudio)||!Qt().webAudioMediaStreamDest))throw new _e(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof jn&&this.pendingLocalTracks.some(n=>n instanceof jn))throw new _e(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Nr&&this.pendingLocalTracks.some(n=>n instanceof Nr)&&(!Qt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Nr&&n._bypassWebAudio)))throw new _e(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;let s=!z("DISABLE_DUAL_STREAM_USE_ENCODING")&&Qt().supportDualStreamEncoding,o=rd(rd({},{width:160,height:120,framerate:15,bitrate:50}),t),u;u=s?e._mediaStreamTrack.clone():kD(e,o);let d=In(8,"track-low-"),f=new jn(u,rd(rd({},s&&{scaleResolutionDownBy:cD(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,d);return f.on(Vm.TRANSCEIVER_UPDATED,g=>{e._updateRtpTransceiver(g,kE.LOW_STREAM)}),f._hints.push(bn.LOW_STREAM),ke(n=e._hints).call(n,bn.SCREEN_TRACK)&&f._hints.push(bn.SCREEN_LOW_TRACK),e.on("sei-to-send",g=>{f.emit("sei-to-send",g)}),e.addListener(nt.NEED_CLOSE,()=>{f.close()}),f}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof So){var o,u,d,f;let g=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:y,dtlsTransportState:v,peerConnectionState:R}=this.connection,{local:b,remote:A}=await this.connection.getSelectedCandidatePair();tt.pcStats(this.store.sessionId,{startTime:g,eventElapse:e-g||0,iceconnectionsate:y,dtlsstate:v,connectionstate:R,intSucc:t?1:2,error:this._iceError||s||"",selectedLocalCandidateProtocol:(o=b?.protocol)!==null&&o!==void 0?o:"",selectedLocalCandidateType:(u=b.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(b.address,":").concat(b.port),selectedRemoteCandidateProtocol:(d=A.protocol)!==null&&d!==void 0?d:"",selectedRemoteCandidateType:(f=A.candidateType)!==null&&f!==void 0?f:"",selectedRemoteCandidateAddress:"".concat(A.address,":").concat(A.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){let t=this.store.keyMetrics,n=t.firstVideoFrameDecoded.find(v=>v.userId===e.uid);if(!n)return;let{isInternalUpload:s,isExternalUpload:o}=n;if(s&&o)return;let{subscribeEnd:u,firstPreRender:d,peerPublishDuration:f,peerPubStatusMs:g}=n,{firstRender:y=0}=n;if(u&&(y||d)&&f&&g){n.isInternalUpload=!0;let{playEnd:v}=n;v&&(n.isExternalUpload=!0);let{firstPreRender:R=0}=n;y=R||y;let b=e.videoTrack,A={peer:e._uintid,width:b?._videoWidth||0,height:b?._videoHeight||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:f,peerPubStatusMs:g,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:n.userJoinNotify||0,videoAddNotify:n.videoAddNotify||0,subscribeStart:n.subscribeStart||0,subscribeEnd:n.subscribeEnd||0,firstReceived:n.firstReceived||0,firstDecoded:n.firstDecoded||0,firstPreRender:R||0,firstRender:v?Math.max(y,v):Math.max(y,u),playStart:n.playStart||0,playEnd:n.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:E5(this.store),firstReceivedEncodedFrame:n.firstReceivedEncodedFrame||0,frameType:n.frameType||"",rtpTimestamp:n.rtpTimestamp||0,framePayloadType:n.framePayloadType||0,frameDataLength:n.frameDataLength||0,mimeType:n.mimeType||""};tt.firstXLAPeerFirstVideoFrame(this.store.sessionId,A)}}reportVideoFirstFrameDecoded(e,t,n,s){var o;let u=Array.from(ys(o=this.remoteUserMap).call(o)).find(d=>d._videoSSRC===e);if(u){s||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());let d=this.store.keyMetrics,f=d.subscribe.find(g=>g.userId===u.uid&&g.type==="video");tt.firstRemoteVideoDecode(this.store.sessionId,ai.FIRST_VIDEO_DECODE,cr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:t,videoheight:n,subscribeElapse:fs.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:d.requestAPEnd||0,apStart:d.requestAPStart||0,joinGwEnd:d.joinGatewayEnd||0,joinGwStart:d.joinGatewayStart||0,pcEnd:d.peerConnectionEnd||0,pcStart:d.peerConnectionStart||0,subscriberEnd:f?.subscribeEnd||0,subscriberStart:f?.subscribeStart||0,videoAddNotify:f?.streamAdded||0,state:s?1:0,firstFrame:f?.firstFrame||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;let s=this.remoteUserMap.get(e);if(!s)return!1;let o=s.get(t);if(!o)return!1;let u=await this.connection.getRemoteSSRC(o);return u!==void 0&&u!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===De.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,kE.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},ze(en.prototype,"startP2PConnection",[ks],Object.getOwnPropertyDescriptor(en.prototype,"startP2PConnection"),en.prototype),ze(en.prototype,"connect",[ks],Object.getOwnPropertyDescriptor(en.prototype,"connect"),en.prototype),ze(en.prototype,"updateRemoteRTPCapabilities",[ks],Object.getOwnPropertyDescriptor(en.prototype,"updateRemoteRTPCapabilities"),en.prototype),ze(en.prototype,"publishDataChannel",[ks],Object.getOwnPropertyDescriptor(en.prototype,"publishDataChannel"),en.prototype),ze(en.prototype,"unpublish",[ks],Object.getOwnPropertyDescriptor(en.prototype,"unpublish"),en.prototype),ze(en.prototype,"unpublishDataChannel",[ks],Object.getOwnPropertyDescriptor(en.prototype,"unpublishDataChannel"),en.prototype),ze(en.prototype,"unpublishLowStream",[ks],Object.getOwnPropertyDescriptor(en.prototype,"unpublishLowStream"),en.prototype),ze(en.prototype,"subscribeDataChannel",[ks],Object.getOwnPropertyDescriptor(en.prototype,"subscribeDataChannel"),en.prototype),ze(en.prototype,"subscribe",[ks],Object.getOwnPropertyDescriptor(en.prototype,"subscribe"),en.prototype),ze(en.prototype,"massSubscribe",[ks],Object.getOwnPropertyDescriptor(en.prototype,"massSubscribe"),en.prototype),ze(en.prototype,"unsubscribe",[ks],Object.getOwnPropertyDescriptor(en.prototype,"unsubscribe"),en.prototype),ze(en.prototype,"unsubscribeDataChannel",[ks],Object.getOwnPropertyDescriptor(en.prototype,"unsubscribeDataChannel"),en.prototype),ze(en.prototype,"massUnsubscribe",[ks],Object.getOwnPropertyDescriptor(en.prototype,"massUnsubscribe"),en.prototype),ze(en.prototype,"muteRemote",[ks],Object.getOwnPropertyDescriptor(en.prototype,"muteRemote"),en.prototype),ze(en.prototype,"unmuteRemote",[ks],Object.getOwnPropertyDescriptor(en.prototype,"unmuteRemote"),en.prototype),ze(en.prototype,"hasRemoteMediaWithLock",[ks],Object.getOwnPropertyDescriptor(en.prototype,"hasRemoteMediaWithLock"),en.prototype),ze(en.prototype,"disconnectForReconnect",[ks],Object.getOwnPropertyDescriptor(en.prototype,"disconnectForReconnect"),en.prototype),ze(en.prototype,"updateBitrateLimit",[ks],Object.getOwnPropertyDescriptor(en.prototype,"updateBitrateLimit"),en.prototype),ze(en.prototype,"remoteMediaSsrcChanged",[ks],Object.getOwnPropertyDescriptor(en.prototype,"remoteMediaSsrcChanged"),en.prototype),en);function ks(e,t,n){let s=e[t];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){let o=this.mutex,u=await o.lock("From P2PChannel.".concat(t));try{for(var d=arguments.length,f=new Array(d),g=0;g<d;g++)f[g]=arguments[g];return await s.apply(this,f)}finally{u()}},n}function Q8(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function Z8(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Q8(Object(n),!0).forEach(function(s){V(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q8(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}let Ahe=Date.now(),Ohe=20,LD=new Map,mI=new Map;async function eG(e){let t=LD.get(e),n=Array.isArray(t)&&t[t.length-1],s=mI.get(e);if(!n)return void(s.isSyncing=!1);let o={uid:n.uid,payload:n.payload};s.firstRecvTs===0&&(s.firstRecvTs=n.recvTs,s.firstSendTs=n.sendTs);let u=n.sendTs-s.firstSendTs,d=u-(Date.now()-s.firstRecvTs);d>0&&(s.firstRecvTs=Date.now()-u);let f=n.mediaDelay+d;f<=0?(t.pop(),tG(n.context,o),f=0):f=Math.min(f,Ohe),setTimeout(()=>t.length&&eG(e),f)}function tG(e,t){e.safeEmit(Ht.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function Nhe(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return tG(n,{uid:e.uid,payload:e.payload});let s="".concat(n.id,"-").concat(e.uid),o=LD.get(s)||[],u=o.findIndex(y=>e.sendTs>=y.sendTs),d=Z8(Z8({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});u===-1?o.push(d):o.splice(u,0,d),LD.set(s,o);let f=!1;var g;mI.has(s)?f=!((g=mI.get(s))===null||g===void 0||!g.isSyncing):mI.set(s,{isSyncing:f,firstRecvTs:0,firstSendTs:0}),f||eG(s)}let Phe=pn().name;function nG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function rG(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?nG(Object(n),!0).forEach(function(s){V(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nG(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}let ey="websdk_ng_cache_parameter",khe=z("MAX_PRELOAD_ASYNC_LENGTH"),Dhe=1e4,$m=new Map,Qm=[],MD=null,UD=0,VD=0,gI=new Map,iG=new Uint8Array([241,141,127,212,103,139,200,225,251,157,127,139,143,2,22,163]),xhe=(function(e,t){let n=[],s=0,o=async()=>{let u=n.shift();u&&await u(),n.length>0&&s<t?o():s--};return async function(){for(var u=arguments.length,d=new Array(u),f=0;f<u;f++)d[f]=arguments[f];return new We(async(g,y)=>{n.push(async()=>{try{let v=await e(...d);g(v)}catch(v){y(v)}}),s<t&&(s++,o())})}})(jD,khe),FD=oa.CancelToken.source();class Lhe{constructor(){V(this,"_audioContext",null)}createMuteAudioTrack(){this._audioContext=new AudioContext;let t=this._audioContext.sampleRate,n=10*t,s=this._audioContext.createBuffer(2,n,t),o=this._audioContext.createBufferSource();o.buffer=s;let u=this._audioContext.createMediaStreamDestination();return o.connect(u),o.start(),u.stream.getAudioTracks()[0]}close(){this._audioContext&&(this._audioContext.close(),this._audioContext=null)}}async function jD(e,t,n,s,o,u,d){try{if(!z("ENABLE_PRELOAD"))return;if(!Qt().supportWebCrypto)return void _p(()=>{k.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new _e(Y.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Hi(n,"token",1,2047),Hi(e,"appid",1,2047),zb(t),s&&Kb(s);let f=xm();k.debug("preload channel ".concat(t,", uid is ").concat(s));let g={appId:e,cname:t,token:n||e,uid:typeof s!="string"?s:null,sid:f,proxyServer:o,role:d},y,v;typeof s=="string"?(g.stringUid=s,[v,y]=await We.all([ghe(s,{sid:f,appId:e},FD.token),A8(rG(rG({},g),{},{token:n||e,uid:0}),FD.token)]),g.uid=v.uid,y.gatewayInfo.uid=g.uid,y.gatewayInfo.res.uid=g.uid):(u&&(g.stringUid=u),y=await A8(g,FD.token));let R={sid:f,appId:e,cname:t,token:n||e,uid:g.stringUid||s,intUid:g.uid||y.gatewayInfo.uid,stringUid:g.stringUid,ts:Date.now(),sua:v,ap:y};await WD(R),UD++}catch(f){throw VD++,(function(g){MD||(MD=window.setTimeout(()=>{let v="";gI.forEach((R,b)=>{v+="".concat(b,": ").concat(R," ;")}),tt.reportApiInvoke(null,{name:or.PRELOAD,options:{success:UD,failed:VD,err:v}}).onError(g),UD=0,VD=0,gI.clear(),MD=null},Dhe));let y=gI.get(g.code)||0;gI.set(g.code,y+1)})(f),f}}async function BD(e){try{if(z("AP_REQUEST_DETAIL")||z("ENABLE_ROLE_SELECT_EDGE"))return;let t=sG(e);if(!t||e.cloudProxyServer!=="disabled")return;let n=await(async function(s,o){try{let u=await window.crypto.subtle.importKey("raw",K4(o),"AES-GCM",!1,["decrypt"]),d=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:iG},u,Dm(s));return JSON.parse(window.atob(Ep(new Uint8Array(d))))}catch{return}})(t,e.token||e.appId);if(!n||!(function(s,o){return s.cname===o.cname&&s.appId===o.appId&&s.token===o.token?o.stringUid?s.stringUid===o.stringUid:typeof o.uid=="number"?s.uid===o.uid:s.uid==o.uid:!1})(n,e))return;if(n&&Date.now()-n.ts<z("AP_CACHE_LIFETIME"))return n}catch(t){k.warn("Error get preloadInfo",t.message)}}function sG(e){let t;try{if(t=cG(ey),!t)return;let n=JSON.parse(t),s=lG(e),o=(function(d,f){for(let g=d.length-1;g>=0;g--)if(f(d[g]))return g;return-1})(n,d=>s in d);if(o===-1)return;let u=n.splice(o,1)[0];return _I(ey,JSON.stringify(n)),u[s]}catch(n){k.warn("Error delete preload info: ".concat(t),n.message),_I(ey,"")}}async function WD(e){let t;try{e.uid&&sG({appId:e.appId,cname:e.cname,token:e.token,uid:e.uid,stringUid:e.stringUid});let n=lG(e),s=await(async function(u,d){try{let f=await window.crypto.subtle.importKey("raw",K4(d),"AES-GCM",!1,["encrypt"]),g=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:iG},f,Dm(window.btoa(JSON.stringify(u))));return Ep(new Uint8Array(g))}catch{return}})(e,e.token||e.appId);if(!s)return;t=cG(ey);let o=t?JSON.parse(t):[];o.push({[n]:s}),o.length>z("AP_CACHE_NUM")&&o.shift(),_I(ey,JSON.stringify(o))}catch(n){k.warn("Error caching server parameters:",n.message),_I(ey,"")}}function GD(e){if(e){let t=$m.get(e);t&&(window.clearTimeout(t),t=null,$m.delete(e)),ke(Qm).call(Qm,e)||e.cloudProxyServer!=="disabled"||Qm.push(e)}if($m.size<z("AP_CACHE_NUM")&&Qm.length>0){let t=Qm.shift();$m.set(t,window.setTimeout(async()=>{let{appId:n,cname:s,token:o,stringUid:u,uid:d,proxyServer:f,role:g}=t;try{await xhe(n,s,o,d,f,u,g),$m.has(t)&&GD(t)}catch(y){k.warn("update preload failed",y.message),aG(t)}},z("AP_UPDATE_INTERVAL")))}}function aG(e){let t=Qm.indexOf(e);t!==-1&&Qm.splice(t,1);let n=$m.get(e);n&&(window.clearTimeout(n),n=null,$m.delete(e),GD())}function oG(e,t){let n=e.sua,s=e.ap;t&&n&&tt.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),tt.reportResourceTiming(e.ap.url,e.sid),tt.joinWebProxyAP(e.sid,{lts:s.requestTime,elapse:s.elapse,sucess:1,apServerAddr:s.url,turnServerAddrList:s.proxyInfo.addresses.map(o=>o.ip).join(","),eventType:"disabled",unilbsServerIds:[Yr.CHOOSE_SERVER,Yr.CLOUD_PROXY_FALLBACK].toString()}),tt.joinChooseServer(e.sid,{lts:s.requestTime,elapse:s.elapse,succ:!0,csAddr:s.url,opid:s.opid,serverList:s.gatewayInfo.gatewayAddrs.map(o=>o.address),ec:null,cid:s.gatewayInfo.cid.toString(),uid:s.gatewayInfo.uid.toString(),csIp:s.gatewayInfo.csIp,unilbsServerIds:[Yr.CHOOSE_SERVER].toString(),isHttp3:s.isHttp3})}function cG(e){return window.atob(window.localStorage.getItem(e)||"")}function _I(e,t){window.localStorage.setItem(e,window.btoa(t))}function lG(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),Z4(t)}function Mhe(e){let t=(function(){let n=Fhe.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}})();return(function(n,s){let o=n.appId;o!==void 0&&(qr(s,10),Ip(s,o));let u=n.cid;u!==void 0&&(qr(s,16),qr(s,u));let d=n.cname;d!==void 0&&(qr(s,26),Ip(s,d));let f=n.deviceId;f!==void 0&&(qr(s,34),Ip(s,f));let g=n.elapse;g!==void 0&&(qr(s,40),Ap(s,g));let y=n.fileSize;y!==void 0&&(qr(s,48),Ap(s,ty(y)));let v=n.height;v!==void 0&&(qr(s,56),Ap(s,ty(v)));let R=n.jpg;R!==void 0&&(qr(s,66),qr(s,R.length),dG(s,R));let b=n.networkType;b!==void 0&&(qr(s,72),Ap(s,ty(b)));let A=n.osType;A!==void 0&&(qr(s,80),Ap(s,ty(A)));let F=n.requestId;F!==void 0&&(qr(s,90),Ip(s,F));let M=n.sdkVersion;M!==void 0&&(qr(s,98),Ip(s,M));let j=n.sequence;j!==void 0&&(qr(s,104),Ap(s,ty(j)));let K=n.sid;K!==void 0&&(qr(s,114),Ip(s,K));let q=n.timestamp;q!==void 0&&(qr(s,120),Ap(s,q));let Q=n.uid;Q!==void 0&&(qr(s,128),qr(s,Q));let se=n.vid;se!==void 0&&(qr(s,136),qr(s,se));let oe=n.width;oe!==void 0&&(qr(s,144),Ap(s,ty(oe)));let ne=n.service;ne!==void 0&&(qr(s,152),qr(s,ne));let de=n.callbackData;de!==void 0&&(qr(s,162),qr(s,de.length),dG(s,de));let we=n.ticket;we!==void 0&&(qr(s,170),Ip(s,we));let Oe=n.vendorConfigs;Oe!==void 0&&(qr(s,178),Ip(s,Oe))})(e,t),(function(n){let s=n.bytes,o=n.limit;return s.length===o?s:s.subarray(0,o)})(t)}function Uhe(e){return(function(n){let s={};e:for(;!jhe(n);){let o=XT(n);switch(o>>>3){case 0:break e;case 1:s.code=XT(n);break;case 2:s.msg=hG(n,XT(n));break;case 3:s.requestId=hG(n,XT(n));break;case 4:s.timestamp=Bhe(n,!1);break;default:Vhe(n,7&o)}}return s})({bytes:t=e,offset:0,limit:t.length});var t}function Vhe(e,t){switch(t){case 0:for(;128&Jc(e););break;case 2:HD(e,XT(e));break;case 5:HD(e,4);break;case 1:HD(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function ty(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let Fhe=[];function HD(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function jhe(e){return e.offset>=e.limit}function EI(e,t){let n=e.bytes,s=e.offset,o=e.limit,u=s+t;if(u>n.length){let d=new Uint8Array(2*u);d.set(n),e.bytes=d}return e.offset=u,u>o&&(e.limit=u),s}function uG(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function dG(e,t){let n=EI(e,t.length);e.bytes.set(t,n)}function hG(e,t){let n=uG(e,t),s=String.fromCharCode,o=e.bytes,u="",d="";for(let f=0;f<t;f++){let g,y,v,R,b=o[f+n];128&b?(224&b)==192?f+1>=t?d+=u:(g=o[f+n+1],(192&g)!=128?d+=u:(R=(31&b)<<6|63&g,R<128?d+=u:(d+=s(R),f++))):(240&b)==224?f+2>=t?d+=u:(g=o[f+n+1],y=o[f+n+2],(49344&(g|y<<8))!=32896?d+=u:(R=(15&b)<<12|(63&g)<<6|63&y,R<2048||R>=55296&&R<=57343?d+=u:(d+=s(R),f+=2))):(248&b)==240?f+3>=t?d+=u:(g=o[f+n+1],y=o[f+n+2],v=o[f+n+3],(12632256&(g|y<<8|v<<16))!=8421504?d+=u:(R=(7&b)<<18|(63&g)<<12|(63&y)<<6|63&v,R<65536||R>1114111?d+=u:(R-=65536,d+=s(55296+(R>>10),56320+(1023&R)),f+=3))):d+=u:d+=s(b)}return d}function Ip(e,t){let n=t.length,s=0;for(let d=0;d<n;d++){let f=t.charCodeAt(d);f>=55296&&f<=56319&&d+1<n&&(f=(f<<10)+t.charCodeAt(++d)-56613888),s+=f<128?1:f<2048?2:f<65536?3:4}qr(e,s);let o=EI(e,s),u=e.bytes;for(let d=0;d<n;d++){let f=t.charCodeAt(d);f>=55296&&f<=56319&&d+1<n&&(f=(f<<10)+t.charCodeAt(++d)-56613888),f<128?u[o++]=f:(f<2048?u[o++]=f>>6&31|192:(f<65536?u[o++]=f>>12&15|224:(u[o++]=f>>18&7|240,u[o++]=f>>12&63|128),u[o++]=f>>6&63|128),u[o++]=63&f|128)}}function Jc(e){return e.bytes[uG(e,1)]}function pG(e,t){let n=EI(e,1);e.bytes[n]=t}function XT(e){let t,n=0,s=0;do t=Jc(e),n<32&&(s|=(127&t)<<n),n+=7;while(128&t);return s}function qr(e,t){for(t>>>=0;t>=128;)pG(e,127&t|128),t>>>=7;pG(e,t)}function Bhe(e,t){let n,s=0,o=0,u=0;return n=Jc(e),s=127&n,128&n&&(n=Jc(e),s|=(127&n)<<7,128&n&&(n=Jc(e),s|=(127&n)<<14,128&n&&(n=Jc(e),s|=(127&n)<<21,128&n&&(n=Jc(e),o=127&n,128&n&&(n=Jc(e),o|=(127&n)<<7,128&n&&(n=Jc(e),o|=(127&n)<<14,128&n&&(n=Jc(e),o|=(127&n)<<21,128&n&&(n=Jc(e),u=127&n,128&n&&(n=Jc(e),u|=(127&n)<<7))))))))),{low:s|o<<28,high:o>>>4|u<<24,unsigned:t}}function Ap(e,t){let n=t.low>>>0,s=(t.low>>>28|t.high<<4)>>>0,o=t.high>>>24,u=o===0?s===0?n<16384?n<128?1:2:n<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:o<128?9:10,d=EI(e,u),f=e.bytes;switch(u){case 10:f[d+9]=o>>>7&1;case 9:f[d+8]=u!==9?128|o:127&o;case 8:f[d+7]=u!==8?s>>>21|128:s>>>21&127;case 7:f[d+6]=u!==7?s>>>14|128:s>>>14&127;case 6:f[d+5]=u!==6?s>>>7|128:s>>>7&127;case 5:f[d+4]=u!==5?128|s:127&s;case 4:f[d+3]=u!==4?n>>>21|128:n>>>21&127;case 3:f[d+2]=u!==3?n>>>14|128:n>>>14&127;case 2:f[d+1]=u!==2?n>>>7|128:n>>>7&127;case 1:f[d]=u!==1?128|n:127&n}}let fG={},mG={},yI=4294967296,Whe=yI*yI,Ghe=Whe/2;_G(0,!0);let gG=_G(0),Hhe=JT(0,-2147483648,!1),zhe=JT(-1,2147483647,!1);function _G(e,t){let n,s,o;return t?(o=0<=(e>>>=0)&&e<256)&&(s=mG[e],s)?s:(n=JT(e,0,!0),o&&(mG[e]=n),n):(o=-128<=(e|=0)&&e<128)&&(s=fG[e],s)?s:(n=JT(e,e<0?-1:0,!1),o&&(fG[e]=n),n)}function JT(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function EG(e,t){if(isNaN(e))return gG;{if(e<=-9223372036854776e3)return Hhe;if(e+1>=Ghe)return zhe}return e<0?gG:JT(e%yI|0,e/yI|0,t)}function yG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}class zD extends dr{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let n=this._connectionState;this._connectionState=t,this.emit(zl.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var n;super(),V(this,"name","AgoraRTCImageModeration"),V(this,"_connectionState",ec.CONNECTING),V(this,"_sequence",0),V(this,"_moderationStartTime",void 0),V(this,"_workerConnection",void 0),V(this,"_workerMessageLengthLimit",void 0),V(this,"_qualityRatio",void 0),V(this,"_connectInfo",void 0),V(this,"_cancelTokenSource",oa.CancelToken.source()),V(this,"_retryConfig",void 0),V(this,"_moderationInterval",void 0),V(this,"_moderationTimer",null),V(this,"_moderationMode",1),V(this,"_quality",1),V(this,"_qualityTimer",null),V(this,"_ticket",void 0),V(this,"_moderationIntervalMinimum",void 0),V(this,"_uploadFailedNum",0),V(this,"_uploadNum",0),V(this,"_uploadTimer",null),V(this,"_extraInfo",void 0),V(this,"_vendor",""),V(this,"_encoder",new TextEncoder),V(this,"_moderationId",void 0),V(this,"inspectImage",()=>{if(this.connectionState!==ec.CONNECTED)throw new he(Y.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===ec.CONNECTED?this.requestToInspectImage():k.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=In(5,"image-moderation-"),this._workerMessageLengthLimit=z("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=z("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=z("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new UT("worker-"+this._moderationId,Kr),this.on(zl.STATE_CHANGE,(s,o)=>{k.debug("[".concat(this._moderationId,"] Moderation operation :").concat(GE[s]," ").concat(o||""))}),this.handleWorkerEvents()}async init(t,n){this.emit(zl.STATE_CHANGE,GE.CONNECT_AP),this._connectInfo=t;let s=this._cancelTokenSource.token;return this._retryConfig=n,new We((o,u)=>{this.on(zl.CONNECTION_STATE_CHANGE,(d,f)=>{d===ec.CONNECTED&&o()}),this.requestAP(t,s,n).then(d=>{this.connectWorker(d)}).catch(d=>{u(d)})})}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),k.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===ec.CONNECTED&&this.inspectImage()}async requestAP(t,n,s){let o=z("WEBCS_DOMAIN").map(g=>"https://".concat(g,"/api/v1")),u=await(function(g,y,v,R){let{appId:b,areaCode:A,cname:F,sid:M,token:j,uid:K}=y;qE++;let q="moderation_plugin",Q={service_name:q,json_body:JSON.stringify({appId:b,areaCode:A,cname:F,command:"allocateEdge",requestId:qE,seq:qE,sid:M,appToken:j,ts:Date.now(),uid:K+""})},se,oe,ne=g[0];return Bl(async()=>{se=Date.now();let de=await Yl(ne,{data:Q,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(oe=Date.now()-se,de.code!==0){let at=new he(Y.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+de.code,{retry:!0,responseTime:oe});throw k.error(at.toString()),at}let we=JSON.parse(de.json_body);if(we.code!==200){let at=new he(Y.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(we.code,", reason: ").concat(we.reason),{code:we.code,responseTime:oe});throw k.error(at.toString()),at}if(!we.servers||!Array.isArray(we.servers)||we.servers.length===0){let at=new he(Y.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:we.code,responseTime:oe});throw k.error(at.toString()),at}if(!we.servers.some(at=>!!at.wss)){let at=new he(Y.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:we.code,responseTime:oe});throw k.error(at.toString()),at}let Oe=z("IMAGE_MODERATION_WORKER_WSS");if(Oe)return{addressList:[Oe],workerToken:we.workerToken,vid:we.vid,responseTime:oe};let Qe=z("IMAGE_MODERATION_WORKER_HOST");return{addressList:we.servers.map(at=>{let{address:Xt,wss:Lt}=at;if(Xt&&Lt)return"wss://".concat(Xt.replace(/\./g,"-"),".").concat(Qe,":").concat(Lt,"/moderation")}).filter(at=>!!at),workerToken:we.workerToken,vid:we.vid,ticket:we.appTicket,responseTime:oe}},(de,we)=>(tt.apworkerEvent(M,{success:!0,sc:200,serviceName:q,responseDetail:JSON.stringify(de.addressList),firstSuccess:we===0,responseTime:oe,serverIp:g[we%g.length]}),!1),(de,we)=>(tt.apworkerEvent(M,{success:!1,sc:de.data&&de.data.code||200,serviceName:q,responseTime:oe,serverIp:g[we%g.length]}),!!(de.code!==Y.OPERATION_ABORTED&&de.code!==Y.UNEXPECTED_RESPONSE||de.data&&de.data.retry)&&(ne=g[(we+1)%g.length],!0)),R)})(o,t,n,s);this.emit(zl.STATE_CHANGE,GE.AP_CONNECTED);let{addressList:d,ticket:f}=u;return this._ticket=f,d}async connectWorker(t){this.emit(zl.STATE_CHANGE,GE.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(Ot.CONNECTED,async()=>{this.emit(zl.STATE_CHANGE,GE.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=ec.CONNECTED}),this._workerConnection.on(Ot.CLOSED,()=>{this.connectionState=ec.CLOSED}),this._workerConnection.on(Ot.FAILED,()=>{this.connectionState=ec.CLOSED}),this._workerConnection.on(Ot.RECONNECTING,()=>{this.connectionState=this.connectionState===ec.CONNECTED?ec.RECONNECTING:ec.CONNECTING}),this._workerConnection.on(Ot.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){let n=Uhe(new Uint8Array(t.data));z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&k.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,k.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{tt.reportApiInvoke(this._connectInfo.sid||null,{name:or.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:Fn.TRACER}).onError(new he(Y.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},z("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else k.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Ot.WILL_RECONNECT,(t,n,s)=>{t==="recover"&&s(t),s("tryNext")}),this._workerConnection.on(Ot.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){let t=qa(this,zl.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&k.debug("Only the track being played can be inspected"));this._sequence++;let s=await this.generateRequestData(t,n);this._workerConnection.sendMessage(s,!0,!0)}else z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&k.debug("Only the track being published can be inspected")}async generateRequestData(t,n){let{appId:s,cname:o,cid:u,vid:d,sid:f,uid:g}=n,y=Date.now(),v=await t.getCurrentFrameImage("image/jpeg",this.quality),R=await H5(v,s,o),b=this._sequence+"-"+u+"-"+g+"-"+y+"-"+In(12,""),A={appId:s,cid:u,cname:o,deviceId:"",elapse:zD.intToLong(Number(y-this._moderationStartTime)),fileSize:v.buffer.byteLength,height:v.height,width:v.width,jpg:R,networkType:6,osType:7,requestId:b,sdkVersion:"4.24.2",sequence:this._sequence,sid:f,timestamp:EG(y),uid:g,vid:d,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete A.callbackData;let F=Mhe(A);if(F.byteLength<this._workerMessageLengthLimit){if(z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){let M=(function(j){for(var K=1;K<arguments.length;K++){var q=arguments[K]!=null?arguments[K]:{};K%2?yG(Object(q),!0).forEach(function(Q){V(j,Q,q[Q])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(q)):yG(Object(q)).forEach(function(Q){Object.defineProperty(j,Q,Object.getOwnPropertyDescriptor(q,Q))})}return j})({},A);delete M.jpg,k.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(M))}return F}{let M=this.quality*this._qualityRatio;return this.quality=M,await this.generateRequestData(t,{appId:s,cname:o,cid:u,vid:d,sid:f,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=oa.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=ec.CLOSED,this.emit(zl.STATE_CHANGE,GE.CLOSED)}}function vG(e){if(Vn(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new he(Y.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new he(Y.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}let Khe={name:"ImageModeration",create:function(e){let{config:t}=e;return vG(t),new zD(t)}};var SG,TG,wG,CG,RG,bG,IG,AG,OG,NG,PG,kG,DG,xG,LG,MG,UG,VG,FG,jG,BG,WG,GG,HG,zG,KG,YG,qG,XG,JG,$G,QG,ZG,eH,tH,nH,rH,iH,sH,aH,oH,cH,Je;function lH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function $c(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?lH(Object(n),!0).forEach(function(s){V(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lH(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}ki.setLogger(k);let Yhe=(SG=gt(),TG=gt({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof LE))return[t];t=[t]}return t.map(n=>n?Object(n).toString():"null")}}),wG=gt({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==xE.DATA?(Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId())):[t.getChannelId()])}),CG=gt({argsMap:(e,t,n,s)=>[typeof t=="object"?t.uid:t,n,s]}),RG=gt({argsMap:(e,t,n)=>[t,n]}),bG=gt({argsMap:(e,t)=>t.map(n=>{let{user:s,mediaType:o}=n;return[s?.uid,o]})}),IG=gt({argsMap:(e,t,n,s)=>[typeof t=="object"?t.uid:t,n,s]}),AG=gt({argsMap:(e,t)=>t.map(n=>{let{user:s,mediaType:o}=n;return{uid:s?.uid,mediaType:o}})}),OG=gt(),NG=gt(),PG=gt(),kG=gt(),DG=gt(),xG=gt(),LG=gt(),MG=gt(),UG=gt(),VG=gt(),FG=gt(),jG=gt(),BG=gt(),WG=gt(),GG=gt(),HG=gt(),zG=gt({argsMap:(e,t)=>[t]}),KG=gt(),YG=gt(),qG=gt(),XG=gt(),JG=gt(),$G=gt(),QG=gt(),ZG=gt(),eH=gt({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),tH=gt(),nH=gt(),rH=gt(),iH=gt(),sH=gt(),aH=gt(),oH=gt({reportResult:!0}),cH=gt(),Je=class extends dr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),V(this,"store",void 0),V(this,"_uid",void 0),V(this,"_channelName",void 0),V(this,"_uintUid",void 0),V(this,"_users",[]),V(this,"_config",void 0),V(this,"_clientId",void 0),V(this,"_appId",void 0),V(this,"_sessionId",null),V(this,"_key",void 0),V(this,"_rtmConfig",{}),V(this,"_joinInfo",void 0),V(this,"_gateway",void 0),V(this,"_statsCollector",void 0),V(this,"_configDistribute",void 0),V(this,"_leaveMutex",void 0),V(this,"_publishMutex",void 0),V(this,"_renewTokenMutex",void 0),V(this,"_subscribeMutex",void 0),V(this,"_encryptionMode","none"),V(this,"_encryptionSecret",null),V(this,"_encryptionSalt",null),V(this,"_encryptDataStream",!1),V(this,"_encryptDataStreamKey",null),V(this,"_encryptDataStreamIv",null),V(this,"_proxyServer",void 0),V(this,"_turnServer",{servers:[],mode:"auto"}),V(this,"_cloudProxyServerMode","disabled"),V(this,"_isDualStreamEnabled",!1),V(this,"_defaultStreamFallbackType",void 0),V(this,"_lowStreamParameter",void 0),V(this,"_streamFallbackTypeCacheMap",new Map),V(this,"_remoteStreamTypeCacheMap",new Map),V(this,"_axiosCancelSource",oa.CancelToken.source()),V(this,"_audioVolumeIndicationInterval",void 0),V(this,"_networkQualityInterval",void 0),V(this,"_userOfflineTimeout",void 0),V(this,"_streamRemovedTimeout",void 0),V(this,"_rteDetailInterval",void 0),V(this,"_liveTranscodeStreamingClient",void 0),V(this,"_liveRawStreamingClient",void 0),V(this,"_channelMediaRelayClient",void 0),V(this,"_networkQualitySensitivity","normal"),V(this,"_p2pChannel",void 0),V(this,"_useLocalAccessPoint",!1),V(this,"_setLocalAPVersion",void 0),V(this,"_joinAndNotLeaveYet",!1),V(this,"_numberOfJoinCount",0),V(this,"_joinResponse",null),V(this,"_remoteDefaultVideoStreamType",void 0),V(this,"_inspect",void 0),V(this,"_moderation",void 0),V(this,"_license",void 0),V(this,"_pendingPublishedUsers",[]),V(this,"ntpAlignErrorCount",0),V(this,"remoteInboundOffset",0),V(this,"_peerConnectionState",void 0),V(this,"_pendingRtpCapabilityChange",void 0),V(this,"_fallbackServerInfo",void 0),V(this,"_dualStreamMode",void 0),V(this,"_handleLocalTrackEnable",(o,u,d)=>{this.publish(o,!1).then(u).catch(d)}),V(this,"_handleLocalTrackDisable",(o,u,d)=>{this.unpublish(o).then(u).catch(d)}),V(this,"_handleUserOnline",o=>{if(z("BLOCK_LOCAL_CLIENT")&&Hm(o.uid,this.channelName))return void k.debug("[".concat(o.uid,"] will be ignored in local"));this.isStringUID&&typeof o.uid!="string"&&k.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let u=this._users.find(d=>d.uid===o.uid);if(u)u._trust_in_room_=!0,u._is_pre_created&&(u._is_pre_created=!1,this.safeEmit(Ht.USER_JOINED,u));else{let d=new Rp(o.uid,o.uint_id||o.uid);this._users.push(d),k.debug("[".concat(this._clientId,"] user online"),o.uid),this.store.firstVideoFrameDecoded(d.uid,{userJoinNotify:Date.now()}),this.safeEmit(Ht.USER_JOINED,d)}}),V(this,"_handleUserOffline",o=>{if(z("BLOCK_LOCAL_CLIENT")&&Hm(o.uid,this.channelName))return;let u=this._users.find(d=>d.uid===o.uid);u&&(this._handleRemoveStream(o),this._handleRemoveDataChannels(o),u._audio_pre_subscribed||u._video_pre_subscribed?u._is_pre_created=!0:_b(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),k.debug("[".concat(this._clientId,"] user offline"),o.uid,"reason:",o.reason),this.safeEmit(Ht.USER_LEAVED,u,o.reason))}),V(this,"_handleAddAudioOrVideoStream",(o,u,d,f,g,y,v,R)=>{if(z("BLOCK_LOCAL_CLIENT")&&Hm(u,this.channelName))return;let b=this._users.find(M=>M.uid===u);if(!b)return void k.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));k.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(o)),this.store.subscribe(b.uid,o,void 0,void 0,void 0,Date.now()),o==="video"&&this.store.firstVideoFrameDecoded(b.uid,{videoAddNotify:Date.now()});let A=o==="audio"?b.hasAudio:b.hasVideo;b._uintid||(b._uintid=y||u),o==="audio"?b._trust_audio_stream_added_state_=!0:b._trust_video_stream_added_state_=!0,o==="audio"?(b._audio_added_=!0,d!==void 0&&(b._audioSSRC=d),f!==void 0&&(b._cname=f),v&&(b._audioOrtc=v)):(b._video_added_=!0,d!==void 0&&(b._videoSSRC=d),f!==void 0&&(b._cname=f),R!==void 0&&(b._rtxSsrcId=R),v&&(b._videoOrtc=v)),(o==="audio"?b.hasAudio:b.hasVideo)&&!A&&(k.info("[".concat(this._clientId,"] remote user ").concat(b.uid," published ").concat(o)),this.safeEmit(Ht.USER_PUBLISHED,b,o)),o==="video"?tt.onGatewayStream(this._sessionId,ai.ON_ADD_VIDEO_STREAM,cr.ON_ADD_VIDEO_STREAM,{peer:y||u,ssrc:b._videoSSRC}):tt.onGatewayStream(this._sessionId,ai.ON_ADD_AUDIO_STREAM,cr.ON_ADD_AUDIO_STREAM,{peer:y||u,ssrc:b._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(b,o,d).then(M=>{if(M&&(k.debug("[".concat(this._clientId,"] resubscribe ").concat(o," for user ").concat(b.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Jm))return this._p2pChannel.unsubscribe(b,o,!0).then(()=>this._subscribe(b,o,!0).catch(j=>{k.error("[".concat(this._clientId,"] resubscribe error"),j.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(b,o)&&(k.debug("[".concat(this._clientId,"] resubscribe ").concat(o," for user ").concat(b.uid," after reconnect.")),this._subscribe(b,o,!0).catch(M=>{k.error("[".concat(this._clientId,"] resubscribe error"),M.toString())}));let F=this._getEncodingName(g);o==="video"&&(F==="unknown"?this.safeEmit(Ht.AV1_DECODABLE_RESULT,!1):Pi()||Es()||F?.toLocaleLowerCase()!==Mm.av1||mhe().then(M=>{z("FLS_ENABLE_AV1_DECODE_DETECT")&&this.safeEmit(Ht.AV1_DECODABLE_RESULT,M),M||this._gateway.downgradeCodec(F)}))}),V(this,"_handleRemoveStream",o=>{if(z("BLOCK_LOCAL_CLIENT")&&Hm(o.uid,this.channelName))return;let u=this._users.find(f=>f.uid===o.uid);if(!u)return void k.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));k.debug("[".concat(this._clientId,"] stream removed with uid ").concat(o.uid));let d=()=>{};u.hasAudio&&u.hasVideo?d=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(Ht.USER_UNPUBLISHED,u,"audio"),k.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(Ht.USER_UNPUBLISHED,u,"video")}:u.hasVideo?d=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(Ht.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(d=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(Ht.USER_UNPUBLISHED,u,"audio")}),u._video_pre_subscribed||u._audio_pre_subscribed||(u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel instanceof Jm&&this._p2pChannel.unsubscribe(u).then(f=>{if(f)return this._gateway.unsubscribe(f,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),tt.onGatewayStream(this._sessionId,ai.ON_REMOVE_STREAM,cr.ON_REMOVE_STREAM,{peer:o.uint_id||o.uid}),d()}),V(this,"_handleSetStreamLocalEnable",(o,u,d)=>{if(z("BLOCK_LOCAL_CLIENT")&&Hm(u,this.channelName))return;let f=this._users.find(v=>v.uid===u);if(!f)return void k.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));k.debug("[".concat(this._clientId,"] local ").concat(o," ").concat(d?"enabled":"disabled"," with uid ").concat(u));let g=o==="audio"?f.hasAudio:f.hasVideo;if(o==="audio"){f._trust_audio_enabled_state_=!0;let v=f._audio_enabled_;if(f._audio_enabled_=d,f._audio_enabled_===v)return;{let R=f._audio_enabled_?"enable-local-audio":"disable-local-audio";k.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(Ht.USER_INFO_UPDATED,u,R)}}else{f._trust_video_enabled_state_=!0;let v=f._video_enabled_;if(f._video_enabled_=d,f._video_enabled_===v)return;{let R=f._video_enabled_?"enable-local-video":"disable-local-video";k.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(Ht.USER_INFO_UPDATED,u,R)}}let y=o==="audio"?f.hasAudio:f.hasVideo;return g!==y?!g&&y?(k.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(o)),void this.safeEmit(Ht.USER_PUBLISHED,f,o)):(o==="video"&&f._videoTrack&&f._videoTrack._destroy(),o==="audio"&&f._audioTrack,this._p2pChannel.muteRemote(f,o),k.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(o)),void this.safeEmit(Ht.USER_UNPUBLISHED,f,o)):void 0}),V(this,"_handleMuteStream",(o,u,d)=>{if(z("BLOCK_LOCAL_CLIENT")&&Hm(o,this.channelName))return;k.debug("[".concat(this._clientId,"] receive mute message"),o,u,d);let f=this._users.find(v=>v.uid===o);if(!f)return void k.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(o));let g=u==="audio"?f.hasAudio:f.hasVideo;if(u==="audio"){f._trust_audio_mute_state_=!0;let v=f._audio_muted_;if(f._audio_muted_=d,f._audio_muted_===v)return;{let R=f._audio_muted_?"mute-audio":"unmute-audio";k.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(o,", msg: ").concat(R)),this.safeEmit(Ht.USER_INFO_UPDATED,o,R)}}else{f._trust_video_mute_state_=!0;let v=f._video_muted_;if(f._video_muted_=d,f._video_muted_===v)return;{let R=f._video_muted_?"mute-video":"unmute-video";k.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(o,", msg: ").concat(R)),this.safeEmit(Ht.USER_INFO_UPDATED,o,R)}}let y=u==="audio"?f.hasAudio:f.hasVideo;if(g!==y){if(!g&&y)return(u==="audio"?f._audioSSRC:f._videoSSRC)?(k.info("[".concat(this._clientId,"] remote user ").concat(o," published ").concat(u)),void this.safeEmit(Ht.USER_PUBLISHED,f,u)):void k.warning("[".concat(this._clientId,"] remote user ").concat(o," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&f._videoTrack&&!f._video_pre_subscribed&&f._videoTrack._destroy(),u==="audio"&&f._audioTrack,this._p2pChannel.muteRemote(f,u),k.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished ").concat(u)),this.safeEmit(Ht.USER_UNPUBLISHED,f,u)}}),V(this,"_handleP2PLost",async o=>{k.debug("[".concat(this._clientId,"] receive p2p lost"),o),parseInt(o.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():k.warning("[".concat(this._clientId,"] P2PLost stream not found"),o)}),V(this,"_handleTokenWillExpire",()=>{k.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Ht.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),V(this,"_handleBeforeUnload",o=>{o.type==="beforeunload"&&o.returnValue!==void 0&&o.returnValue!==""||(this.leave(),k.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),V(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Ht.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});let o={downlinkNetworkQuality:0,uplinkNetworkQuality:0};o.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),o.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Ht.NETWORK_QUALITY,o)}),V(this,"_handleP2PAddAudioOrVideoStream",(o,u,d,f)=>{let g=this._users.find(v=>v.uid===u);if(!g)return void k.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));k.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(o)),this.store.subscribe(g.uid,o,void 0,void 0,void 0,Date.now());let y=o==="audio"?g.hasAudio:g.hasVideo;o==="audio"?g._trust_audio_stream_added_state_=!0:g._trust_video_stream_added_state_=!0,o==="audio"?(g._audio_added_=!0,d!==void 0&&(g._audioSSRC=d),f!==void 0&&(g._audioMid=f)):(g._video_added_=!0,d!==void 0&&(g._videoSSRC=d),f!==void 0&&(g._videoMid=f)),(o==="audio"?g.hasAudio:g.hasVideo)&&!y&&(k.info("[".concat(this._clientId,"] remote user ").concat(g.uid," published ").concat(o)),this.safeEmit(Ht.USER_PUBLISHED,g,o)),this._p2pChannel.hasPendingRemoteMedia(g,o)&&(k.debug("[".concat(this._clientId,"] resubscribe ").concat(o," for user ").concat(g.uid," after reconnect.")),this._subscribe(g,o,!0).catch(v=>{k.error("[".concat(this._clientId,"] resubscribe error"),v.toString())}))}),this._config=e,this._clientId=t||In(5,"client-"),this.store=new class{constructor(o,u,d,f,g){Ct(this,"state",void 0),this.state={codec:o,audioCodec:u,mode:d,clientId:f,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Lm.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,rteUrl:void 0,rteSid:void 0,autoSubscribe:!1,enableInstantMuteRestore:!1,networkQualityProbe:!1,useDcSignal:!!g}}dispatch(o){this.state=(function(u,d){switch(d.type){case Tt.SET_SESSION_ID:return Le(Le({},u),{},{sessionId:d.sessionId});case Tt.SET_P2P_ID:return Le(Le({},u),{},{p2pId:d.p2pId});case Tt.SET_UID:return Le(Le({},u),{},{uid:d.uid});case Tt.SET_INT_UID:return Le(Le({},u),{},{intUid:d.intUid});case Tt.SET_PUB_ID:return Le(Le({},u),{},{pubId:d.pubId});case Tt.KEY_METRIC_CLIENT_CREATED:return Le(Le({},u),{},{keyMetrics:Le(Le({},u.keyMetrics),{},{clientCreated:d.metric})});case Tt.KEY_METRIC_JOIN_START:return Le(Le({},u),{},{keyMetrics:Le(Le({},u.keyMetrics),{},{joinStart:d.metric})});case Tt.KEY_METRIC_PRELOAD_START:return Le(Le({},u),{},{keyMetrics:Le(Le({},u.keyMetrics),{},{preloadStart:d.metric})});case Tt.KEY_METRIC_PRELOAD_END:return Le(Le({},u),{},{keyMetrics:Le(Le({},u.keyMetrics),{},{preloadEnd:d.metric})});case Tt.KEY_METRIC_JOIN_END:return Le(Le({},u),{},{keyMetrics:Le(Le({},u.keyMetrics),{},{joinEnd:d.metric})});case Tt.KEY_METRIC_REQUEST_AP_START:return Le(Le({},u),{},{keyMetrics:Le(Le({},u.keyMetrics),{},{requestAPStart:d.metric})});case Tt.KEY_METRIC_REQUEST_AP_END:return Le(Le({},u),{},{keyMetrics:Le(Le({},u.keyMetrics),{},{requestAPEnd:d.metric})});case Tt.KEY_METRIC_REQUEST_SUA_END:return Le(Le({},u),{},{keyMetrics:Le(Le({},u.keyMetrics),{},{requestSUAEnd:d.metric})});case Tt.KEY_METRIC_BEFORE_CONNECT:return Le(Le({},u),{},{keyMetrics:Le(Le({},u.keyMetrics),{},{beforeConnect:d.metric})});case Tt.KEY_METRIC_PEER_RECEIVER:return Le(Le({},u),{},{keyMetrics:Le(Le({},u.keyMetrics),{},{peerReceiver:d.metric})});case Tt.KEY_METRIC_SIGNAL_CONNECTED:return Le(Le({},u),{},{keyMetrics:Le(Le({},u.keyMetrics),{},{signalConnected:d.metric})});case Tt.KEY_METRIC_JOIN_REQ:return Le(Le({},u),{},{keyMetrics:Le(Le({},u.keyMetrics),{},{joinReq:d.metric})});case Tt.KEY_METRIC_JOIN_REP:return Le(Le({},u),{},{keyMetrics:Le(Le({},u.keyMetrics),{},{joinRep:d.metric})});case Tt.KEY_METRIC_JOIN_GATEWAY_START:return Le(Le({},u),{},{keyMetrics:Le(Le({},u.keyMetrics),{},{joinGatewayStart:d.metric})});case Tt.KEY_METRIC_JOIN_GATEWAY_END:return Le(Le({},u),{},{keyMetrics:Le(Le({},u.keyMetrics),{},{joinGatewayEnd:d.metric})});case Tt.KEY_METRIC_PEER_CONNECTION_START:return Le(Le({},u),{},{keyMetrics:Le(Le({},u.keyMetrics),{},{peerConnectionStart:d.metric})});case Tt.KEY_METRIC_PEER_CONNECTION_END:return Le(Le({},u),{},{keyMetrics:Le(Le({},u.keyMetrics),{},{peerConnectionEnd:d.metric})});case Tt.KEY_METRIC_DESCRIPTION_START:return Le(Le({},u),{},{keyMetrics:Le(Le({},u.keyMetrics),{},{descriptionStart:d.metric})});case Tt.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Le(Le({},u),{},{keyMetrics:Le(Le({},u.keyMetrics),{},{signalChannelOpen:d.metric})});case Tt.KEY_METRIC_ICE_CONNECTION_END:return Le(Le({},u),{},{keyMetrics:Le(Le({},u.keyMetrics),{},{iceConnectionEnd:d.metric})});case Tt.KEY_METRIC_PUBLISH:{let f=u.keyMetrics.publish,g=f.findIndex(y=>y.trackId===d.metric.trackId);return g!==-1?(f[g]=Le(Le({},f[g]),d.metric),Le(Le({},u),{},{keyMetrics:Le(Le({},u.keyMetrics),{},{publish:[...f]})})):Le(Le({},u),{},{keyMetrics:Le(Le({},u.keyMetrics),{},{publish:[...u.keyMetrics.publish,d.metric]})})}case Tt.KEY_METRIC_SUBSCRIBE:{let f=u.keyMetrics.subscribe,g=f.findIndex(y=>y.userId===d.metric.userId&&y.type===d.metric.type);return g!==-1?(f[g]=Le(Le({},f[g]),d.metric),Le(Le({},u),{},{keyMetrics:Le(Le({},u.keyMetrics),{},{subscribe:[...f]})})):Le(Le({},u),{},{keyMetrics:Le(Le({},u.keyMetrics),{},{subscribe:[...u.keyMetrics.subscribe,d.metric]})})}case Tt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{let f=u.keyMetrics.firstVideoFrameDecoded,g=f.findIndex(y=>y.userId===d.metric.userId);return g!==-1?(f[g]=Le(Le({},f[g]),d.metric),Le(Le({},u),{},{keyMetrics:Le(Le({},u.keyMetrics),{},{firstVideoFrameDecoded:[...f]})})):Le(Le({},u),{},{keyMetrics:Le(Le({},u.keyMetrics),{},{firstVideoFrameDecoded:[...u.keyMetrics.firstVideoFrameDecoded,d.metric]})})}case Tt.RESET_FIRST_VIDEO_FRAME_DECODED:return u.keyMetrics.firstVideoFrameDecoded=[],u;case Tt.SET_CLOUD_PROXY_SERVER_MODE:return u.cloudProxyServerMode=d.mode,u;case Tt.RECORD_JOIN_CHANNEL_SERVICE:return typeof d.index!="number"?u.joinChannelServiceRecords=[...u.joinChannelServiceRecords,d.record]:(u.joinChannelServiceRecords[d.index]=Le(Le({},u.joinChannelServiceRecords[d.index]),d.record),u.joinChannelServiceRecords=[...u.joinChannelServiceRecords]),u;case Tt.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return u.joinChannelServiceRecords=[],u;case Tt.RESET_KEY_METRICS:return u.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},u;case Tt.SET_USE_P2P:return Le(Le({},u),{},{useP2P:d.val});case Tt.SET_TRANSPORT_TYPE:return Le(Le({},u),{},{p2pTransport:d.val});case Tt.SET_RTE_URL:return Le(Le({},u),{},{rteUrl:d.rteUrl});case Tt.SET_RTE_SID:return Le(Le({},u),{},{rteSid:d.rteSid});default:return u}})(this.state,o)}get useDcSignal(){return this.state.useDcSignal}set useDcSignal(o){this.state.useDcSignal=o}set autoSubscribe(o){this.state.autoSubscribe=o}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(o){this.state.enableInstantMuteRestore=o}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set networkQualityProbe(o){this.state.networkQualityProbe=o}get networkQualityProbe(){return this.state.networkQualityProbe}set sessionId(o){this.dispatch({type:Tt.SET_SESSION_ID,sessionId:o})}get sessionId(){return this.state.sessionId}set rteUrl(o){this.dispatch({type:Tt.SET_RTE_URL,rteUrl:o})}get rteUrl(){return this.state.rteUrl}set rteSid(o){this.dispatch({type:Tt.SET_RTE_SID,rteSid:o})}get rteSid(){return this.state.rteSid}set cid(o){this.state.cid=o}get cid(){return this.state.cid}set codec(o){this.state.codec=o}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(o){this.dispatch({type:Tt.SET_P2P_ID,p2pId:o})}get p2pId(){return this.state.p2pId}set dcId(o){this.dispatch({type:Tt.SET_DC_ID,dcId:o})}get dcId(){return this.state.dcId}set uid(o){this.dispatch({type:Tt.SET_UID,uid:o})}get uid(){return this.state.uid}set intUid(o){this.dispatch({type:Tt.SET_INT_UID,intUid:o})}get intUid(){return this.state.intUid}set pubId(o){this.dispatch({type:Tt.SET_PUB_ID,pubId:o})}get pubId(){return this.state.pubId}set cloudProxyServerMode(o){this.dispatch({type:Tt.SET_CLOUD_PROXY_SERVER_MODE,mode:o})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(o){this.dispatch({type:Tt.SET_USE_P2P,val:o})}get useP2P(){return this.state.useP2P}set p2pTransport(o){this.dispatch({type:Tt.SET_TRANSPORT_TYPE,val:o})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(o){this.state.hasStartJoinChannel=o}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(o){this.state.isABTestSuccess=o}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:Tt.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Tt.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:Tt.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:Tt.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:Tt.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Tt.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Tt.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:Tt.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:Tt.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:Tt.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:Tt.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:Tt.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:Tt.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Tt.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Tt.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Tt.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Tt.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(o,u){this.dispatch({type:Tt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:Le({userId:o},u)})}descriptionStart(){this.dispatch({type:Tt.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Tt.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Tt.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(o,u,d,f){this.dispatch({type:Tt.KEY_METRIC_PUBLISH,metric:Le(Le({trackId:o,type:u},d&&{publishStart:d}),f&&{publishEnd:f})})}subscribe(o,u,d,f,g,y,v){this.dispatch({type:Tt.KEY_METRIC_SUBSCRIBE,metric:Le(Le(Le(Le(Le({userId:o,type:u},d&&{subscribeStart:d}),f&&{subscribeEnd:f}),g&&{firstFrame:g}),y&&{streamAdded:y}),v&&{firstDecoded:v})})}massSubscribe(o,u,d,f){o.forEach(g=>{this.dispatch({type:Tt.KEY_METRIC_SUBSCRIBE,metric:Le(Le(Le({userId:g.userId,type:g.type},u&&{subscribeStart:u}),d&&{subscribeEnd:d}),f&&{firstFrame:f})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(o,u){o.service==="gateway"&&Array.isArray(o.urls)&&(o.urls=o.urls.map(d=>d.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof u!="number"?(this.dispatch({type:Tt.RECORD_JOIN_CHANNEL_SERVICE,record:Le(Le({},o),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(u<0||u>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Tt.RECORD_JOIN_CHANNEL_SERVICE,record:o,index:u}),u)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Tt.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Tt.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:Tt.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId,z("SIGNAL_CHANNEL")===1),this._leaveMutex=new ki("client-leave",this._clientId),this._publishMutex=new ki("client-publish",this._clientId),this._renewTokenMutex=new ki("client-renewtoken",this._clientId),this._subscribeMutex=new ki("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),k.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Xo," build: ").concat(vk,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{sk(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(o){k.warning("[".concat(this._clientId,"] ").concat(o.toString()))}var s;this._statsCollector=new KT(this.store),this._statsCollector.onStatsException=(o,u,d)=>{k.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(o,", msg: ").concat(u,", uid: ").concat(d)),o===CD.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(f=>{f instanceof xb&&z("ENABLE_ENCODE_EXCEPTION")&&f.findClosestProfile()}),this.safeEmit(Ht.EXCEPTION,{code:o,msg:u,uid:d})},this._statsCollector.onUploadPublishDuration=(o,u,d,f)=>{let g=this._users.find(y=>y.uid===o);g&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(g.uid,{peerPublishDuration:d,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(g)),tt.peerPublishStatus(this._sessionId,{subscribeElapse:f,audioPublishDuration:u,videoPublishDuration:d,peer:g._uintid}))},this._statsCollector.onVideoCodecChanged=o=>{if(z("VIDEO_STANDARD_BITRATE_VERSION")&&(o==="av1"||o==="h265"||o==="h264")){let u=this.localTracks.find(d=>d instanceof jn);u&&u._saveEncodeBitrateRatio!==1&&u.setSaveEncodeBitrateRatio(o==="h264"?z("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new lhe(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Kr,httpRetryConfig:e.httpRetryConfig||Kr,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new vhe(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(s={store:this.store,statsCollector:this._statsCollector},Kl("P2PChannel").create(s)),this._handleP2PEvents()):this._p2pChannel=new Jm(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,s,o){let u=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],d=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Ln("JOIN_GATEWAY_USE_443PORT_ONLY",u),Ln("JOIN_GATEWAY_USE_DUAL_DOMAIN",d);let f=this._gateway.signal.websocket;return f instanceof sD&&(f.use443PortOnly=u,f.tryDoubleDomain=d),(async function(g,y,v){pb.get(g)||pb.set(g,[]),fb.get(g)||fb.set(g,y),Yu.get(g)||Yu.set(g,0);let R=pb.get(g),b=fb.get(g);if(!R||!b)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Yu.get(g)===b){let K=CT();R.push(K),await K.promise}Yu.set(g,Yu.get(g)+1);for(var A=arguments.length,F=new Array(A>3?A-3:0),M=3;M<A;M++)F[M-3]=arguments[M];let j=await v(...F);return Yu.set(g,Yu.get(g)-1),Yu.get(g)===b-1&&R.length>0&&(R[0].resolve(),R.shift()),Yu.get(g)===0&&(pb.set(g,[]),fb.set(g,0),Yu.set(g,0)),j})("client.join",z("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,s,o)}async join(e,t,n,s,o){let u=++this._numberOfJoinCount;this.store.joinStart(),s&&(this.store.uid=s);let d=(vb||vb||(vb=(window.location.protocol.split(":")[0]||"").toUpperCase(),vb))==="HTTPS",f=t5()?window.isSecureContext:"Browser Not Support";(!t5()&&!d||!window.isSecureContext)&&k.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let g;tt.setAppId(e);try{if(!n&&n!==null)throw new he(Y.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));if(n&&Hi(n,"token",1,2047),Hi(e,"appid",1,2047),zb(t),s&&Kb(s),o)if(typeof o=="string")Hi(o,"optionalInfo",1,256),g=o;else{if(typeof o!="object")throw new he(Y.INVALID_PARAMS,"Invalid options: options is not a string or object");{let{autoSubscribe:j,enableInstantMuteRestore:K,networkQualityProbe:q}=o;j&&(Bc(j,"autoSubscribe"),k.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(j)),this.store.autoSubscribe=j),K&&(Bc(K,"enableInstantMuteRestore"),k.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(K)),this.store.enableInstantMuteRestore=K),q&&(Bc(q,"networkQualityProbe"),k.info("[".concat(this._clientId,"] join: networkQualityProbe: ").concat(q)),this.store.networkQualityProbe=q)}}}catch(j){throw tt.reportApiInvoke(xm(),{name:or.JOIN,options:[e,t,n,s],states:{isHttps:d,isSecureContext:f},tag:Fn.TRACER}).onError(j),j}if(this._leaveMutex.isLocked&&(k.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),k.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){let j=new he(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw tt.reportApiInvoke(xm(),{name:or.JOIN,options:[e,t,n,s],states:{isHttps:d,isSecureContext:f},tag:Fn.TRACER}).onError(j),j}this._gateway.state="CONNECTING",this.store.preloadStart();let y=await BD({appId:e,cname:t,uid:s,stringUid:typeof s=="string"?s:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new he(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));let v=y?.sid||xm();k.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(u)),this._sessionId||(this._sessionId=v,this.store.sessionId=this._sessionId);let R=tt.reportApiInvoke(this._sessionId,{id:this._clientId,name:or.JOIN,options:[e,t,n,s],states:{isHttps:d,isSecureContext:f},tag:Fn.TRACER}),b=$c($c($c({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof s!="string"?s:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:g,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!y},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:z("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(b.setLocalAPVersion=this._setLocalAPVersion),typeof s=="string"&&(b.stringUid=s,this._uintUid?(b.uid=this._uintUid,this._uintUid=void 0):b.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(b.aesmode=this._encryptionMode,b.aespassword=await(async j=>{let K=(function(oe){let ne=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),de=new Uint8Array(new ArrayBuffer(ne.length));for(let we=0;we<ne.length;we+=1)de[we]=ne.charCodeAt(we);return de})(),q=await window.crypto.subtle.importKey("spki",K,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),Q=rk(j),se=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},q,Q);return(function(oe){let ne="";for(let de=0;de<oe.length;de+=1)ne+=String.fromCharCode(oe[de]);return window.btoa(ne)})(new Uint8Array(se))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new he(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(b.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){let j=new TextEncoder,K=z("USE_PURE_ENCRYPTION_MASTER_KEY")?j.encode(b.appId+this._encryptionSecret+this._encryptionSecret):j.encode(b.appId+b.cname+this._encryptionSecret);this._encryptDataStreamIv=await(async function(q,Q,se){let oe=await window.crypto.subtle.importKey("raw",Q,"PBKDF2",!1,["deriveBits","deriveKey"]),ne=q==="aes-128-gcm2"?128:256,de=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:d5,hash:"SHA-256",salt:se},oe,ne+Bue);return new Uint8Array(de).subarray(ne/8)})(this._encryptionMode,K,Dm(this._encryptionSalt)),this._encryptDataStreamKey=await(async function(q,Q,se){let oe=await window.crypto.subtle.importKey("raw",Q,"PBKDF2",!1,["deriveBits","deriveKey"]),ne=q==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:d5,hash:"SHA-256",salt:se},oe,{name:"AES-GCM",length:ne},!0,["encrypt","decrypt"])})(this._encryptionMode,K,Dm(this._encryptionSalt))}else f?k.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):k.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,k.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:b.stringUid});let A=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&A===this._sessionId&&tt.joinChannelTimeout(this._sessionId,5)},5e3);try{var F;let j,K=b.cloudProxyServer;if(ke(F=["proxy3","proxy4","proxy5"]).call(F,K)){let ne=z("PROXY_SERVER_TYPE3");Array.isArray(ne)?b.proxyServer=ne[0]:b.proxyServer=ne}if(tt.setProxyServer(b.proxyServer),k.setProxyServer(b.proxyServer),this.store.requestAPStart(),y){if(k.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(b.stringUid?", ".concat(b.stringUid," => ").concat(y.intUid):""," ")),b.stringUid&&!b.uid&&(b.uid=y.intUid),j={gatewayInfo:y.ap.gatewayInfo},z("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&b.turnServer.mode==="auto")if(y.ap.proxyInfo.addresses.length===0)k.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{let ne=(await ZW(y.ap.proxyInfo,y.ap.gatewayInfo.uid)).map(de=>({turnServerURL:de.address,tcpport:de.tcpport||ns.tcpport,udpport:de.udpport||ns.udpport,username:de.username||ns.username,password:de.password||ns.password,forceturn:!1,security:!0}));b.turnServer={mode:"manual",servers:ne}}oG(y,b.stringUid)}else{if(b.stringUid&&!b.uid){let ne;[ne,j]=await We.all([I8(b.stringUid,b,this._axiosCancelSource.token,this._config.httpRetryConfig||Kr,this.store).finally(()=>{this.store.requestSUAEnd()}),b8(b,this._axiosCancelSource.token,this._config.httpRetryConfig||Kr,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),k.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(b.stringUid," => ").concat(ne)),b.uid=ne,j.gatewayInfo.uid=ne,j.gatewayInfo.res.uid=ne}else j=await b8(b,this._axiosCancelSource.token,this._config.httpRetryConfig||Kr,!0,this.store);if(!this._joinAndNotLeaveYet)throw new he(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(b,this._axiosCancelSource.token),this._configDistribute.on(Hl.UPDATE_BITRATE_LIMIT,ne=>{this._p2pChannel.updateBitrateLimit(ne)}),this._configDistribute.on(Hl.UPDATE_CLIENT_ROLE_OPTIONS,ne=>{this._setClientRoleOptions(ne)}),this._configDistribute.on(Hl.UPDATE_REMOTE_VIDEO_STREAM_TYPE,ne=>{var de;ke(de=[0,1,4,5,6,7,8,9]).call(de,ne)&&(this.remoteUsers.forEach(we=>{this._remoteStreamTypeCacheMap.get(we.uid)!==ne&&this.setRemoteVideoStreamType(we.uid,ne)}),this.setRemoteDefaultVideoStreamType(ne))}),this._configDistribute.on(Hl.FALLBACK_TO_HLS,ne=>{ne&&this.safeEmit(Ht.FALLBACK_TO_HLS,ak.CONFIG)}),this._configDistribute.on(Hl.UPDATE_VOS_CONFIGURE,ne=>{this._gateway.setConfigure(ne).catch(de=>{k.debug("[".concat(this._clientId,"] auto set vos config failed"),de)})})},0),this._key=n||e;let q=j.gatewayInfo,Q=b.uid?b.uid:q.uid;this._joinInfo=$c($c({},b),{},{cid:q.cid,uid:Q,vid:q.vid,apResponse:q.res,apGatewayAddress:q.apGatewayAddress,uni_lbs_ip:q.uni_lbs_ip,gatewayAddrs:q.gatewayAddrs}),this.store.intUid=Q,this.store.cid=q.cid;let se=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new he(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));R.onSuccess(se),this._appId=e,this._channelName=b.cname,this._uid=se,this.store.uid=se,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),!Pi()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(Pi()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);let oe=b.stringUid?"string uid: ".concat(b.stringUid,",uid: ").concat(b.uid):"uid: ".concat(this._uid);return k.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(oe)),setTimeout(()=>{k.startUpload()},5e3),this.store.joinEnd(),M=this,ke(Gm).call(Gm,M)||Gm.push(M),this._cloudProxyServerMode==="disabled"&&Qt().supportWebCrypto&&z("ENABLE_PRELOAD")&&GD(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0),this._sessionId&&tt.reportRteDetail(this._sessionId),this._rteDetailInterval=window.setInterval(()=>{this._sessionId&&tt.reportRteDetail(this._sessionId)},z("RTE_DETAIL_REPORT_INTERVAL")||6e4),se}catch(j){let K=Array.isArray(j)?j[0]:j;throw K&&K.code===Y.OPERATION_ABORTED?k.warning("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),K):k.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),K),K.code!==Y.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),R.onError(K),K}var M}async _joinGateway(){if(!this._joinInfo||!this._key)throw new he(Y.INVALID_OPERATION);try{return await this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!z("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}catch(e){if(e.code===Y.INIT_DATACHANNEL_TIMEOUT){if(this._gateway.leave(!0,tn.FALLBACK),k.debug("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new he(Y.INVALID_OPERATION);return tt.reportApiInvoke(this._sessionId,{name:or.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:Fn.TRACER}).onSuccess(),await this._joinGateway()}throw e}}async leave(){k.info("[".concat(this._clientId,"] Leaving channel"));let e=()=>{!Pi()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(Pi()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),(function(n){let s=Gm.indexOf(n);s!==-1&&Gm.splice(s,1)})(this),this._statsCollector.stopUpdateStats()};this.store.useDcSignal||e();let t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return k.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",tn.LEAVE),k.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t(),this.store.useDcSignal&&e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof LE))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new he(Y.INVALID_PARAMS,"param list is empty");let n=e;if(this._gateway.role==="audience")throw new he(Y.INVALID_OPERATION,"audience can not publish stream");for(let o of n){if(!(o instanceof LE))throw new he(Y.INVALID_PARAMS,"parameter is not local track");if(!o._enabled&&t)throw new he(Y.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(o.getTrackId()))}k.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(o=>"".concat(o.getTrackId()," "))));let s=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach(o=>{let u=this._configDistribute.getBitrateLimit();o instanceof jn&&u&&o.setBitrateLimit(u.uplink)});try{await this._publishHighStream(n),k.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(o=>"".concat(o.getTrackId()," "))))}catch(o){throw k.error("[".concat(this._clientId,"] publish error"),o.toString()),o}finally{s()}}async _publishDataChannel(e){if(e==null)throw new he(Y.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));Vn(e.id,"id",0,65535,!0),Bc(e.ordered,"ordered"),Hi(e.metadata,"metadata",0,512),k.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));let t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(o=>o.id===e.id)!==-1)throw new he(Y.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new he(Y.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&z("FORCE_TURN")&&!z("TURN_ENABLE_TCP")&&!z("TURN_ENABLE_UDP"))throw new he(Y.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");let n=(function(o){return _8(o,!1)})(e),s=await this._p2pChannel.publishDataChannel([n]);if(s.length>0){if(typeof n._originDataChannelId!="number")throw k.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new he(Y.CREATE_DATACHANNEL_ERROR);try{await We.all(s.map(o=>this._uid&&this._gateway.publishDataChannel(this._uid,o,!0))),await n._waitTillOpen()}catch(o){if(o.code!==Y.DISCONNECT_P2P)throw o}}return k.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw k.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new he(Y.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof LE))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);k.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(s=>"".concat(s.getTrackId()," "))," "));let n=await this._publishMutex.lock();try{if(this.store.useP2P){let s=await this._p2pChannel.unpublish(t);s&&await this._gateway.sendExtensionMessage(Fr.UNPUBLISH,{unpubMsg:s},!0)}else{let s=await this._p2pChannel.unpublish(t);s&&await this._gateway.unpublish(s,this._uid),k.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(o=>"".concat(o.getTrackId()))))}}catch(s){throw k.error("[".concat(this._clientId,"] unpublish error"),s.toString()),s}finally{n&&n()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),k.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(n=>"".concat(n.id," "))," "));let t=await this._publishMutex.lock();try{let n=await this._p2pChannel.unpublishDataChannel(e);n&&await this._gateway.unpublishDataChannel(n),k.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(s=>"".concat(s.id))))}catch(n){throw k.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof Rp)){let s=this.remoteUsers.find(o=>o.uid===e);if(!s)throw new he(Y.INVALID_REMOTE_USER,"user is not in the channel");e=s}return t==="datachannel"?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(zr(t,"mediaType",["audio","video"]),this.store.useP2P)throw new he(Y.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new he(Y.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));let n=t===et.AUDIO,s=t===et.VIDEO,o=await this._subscribeMutex.lock();try{let{ssrcId:u,ortc:d,rtxSsrcId:f,cname:g,uint_id:y}=await this._gateway.presubscribe(e,t,!0);if(u==null)throw new he(Y.UNEXPECTED_RESPONSE,"no ssrc id");let v=this._users.find(b=>b.uid===e);v||(v=new Rp(e,y||e),v._is_pre_created=!0,this._users.push(v)),g&&(v._cname=g),v._uintid||(v._uintid=y||e),n&&(v._audioSSRC=u,v._audio_pre_subscribed=!0,d&&(v._audioOrtc=d)),s&&(v._videoSSRC=u,v._video_pre_subscribed=!0,d&&(v._videoOrtc=d),f!=null&&(v._rtxSsrcId=f)),k.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(u)),await this._p2pChannel.subscribe(v,t,u,f,d);let R=n?v._audioTrack:v._videoTrack;if(!R)throw new he(Y.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(v._trust_audio_stream_added_state_=!0,v._audio_added_=!0),s&&(v._trust_video_stream_added_state_=!0,v._video_added_=!0),R}catch(u){throw k.error("[".concat(this._clientId,"] presub user ").concat(e," error"),u),u}finally{o()}}async _subscribeDataChannel(e,t){var n;if(Vn(t,"channelId",0,65535,!0),!this._joinInfo)throw new he(Y.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(d=>d===e))throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new he(Y.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new he(Y.INVALID_REMOTE_USER,"user is not published");let s=(n=e._dataChannels)===null||n===void 0?void 0:n.find(d=>d.id===t);if(!s)throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new he(Y.REMOTE_USER_IS_NOT_PUBLISHED);let o=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{let d=await this._p2pChannel.subscribeDataChannel(e,[s]);if(d&&ke(d).call(d,s.id))try{var u;if(typeof s._originDataChannelId!="number")throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new he(Y.CREATE_DATACHANNEL_ERROR);let f={id:s.id,datachannelId:s._originDataChannelId,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:(u=s.metadata)!==null&&u!==void 0?u:""};await this._gateway.subscribeDataChannel(e.uid,f,!0),await s._waitTillOpen()}catch(f){if(f?.code!==Y.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[s]),f;await this._p2pChannel.unsubscribeDataChannel(e,[s]),this._p2pChannel.setPendingRemoteDataChannel(e,s.id)}return k.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),s}finally{o()}}async _p2pSubscribe(e,t,n){if(zr(t,"mediaType",["audio","video"]),!this._joinInfo)throw new he(Y.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(o=>o===e)){let o=new he(Y.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),o}if(!e.hasAudio&&!e.hasVideo){let o=new he(Y.INVALID_REMOTE_USER,"user is not published");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),o}if(!n&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){let o=new he(Y.REMOTE_USER_IS_NOT_PUBLISHED);throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),o}let s=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let u=t==="audio"?e._audioSSRC:e._videoSSRC,d=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,u,d)}catch(u){throw u}k.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(u=>{k.warning("[".concat(this._clientId,"] auto set fallback failed"),u)});let o=t==="audio"?e._audioTrack:e._videoTrack;if(!o)throw new he(Y.UNEXPECTED_ERROR,"can not find remote track in user object");return o}catch(o){throw k.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),o),o}finally{s()}}async _subscribe(e,t,n){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(zr(t,"mediaType",["audio","video"]),!this._joinInfo)throw new he(Y.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(g=>g===e)){let g=new he(Y.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),g}if(!e.hasAudio&&!e.hasVideo){let g=new he(Y.INVALID_REMOTE_USER,"user is not published");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),g}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){let g=new he(Y.REMOTE_USER_IS_NOT_PUBLISHED);throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),g}let s=t==="audio"?e._audioSSRC:e._videoSSRC,o=t==="audio"?e._audioOrtc:e._videoOrtc,u=t==="video"?e._rtxSsrcId:void 0,d={stream_type:t==="audio"?et.AUDIO:et.VIDEO,ssrcId:s};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});let f=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let y=t==="audio"?e._audioSSRC:e._videoSSRC;y!==void 0&&y!==s&&(s=y,o=t==="audio"?e._audioOrtc:e._videoOrtc,u=t==="video"?e._rtxSsrcId:void 0,d={stream_type:t==="audio"?et.AUDIO:et.VIDEO,ssrcId:s}),fs.markSubscribeStart(this.store.clientId,s),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,s,u,o);try{this._p2pChannel.isPreSubScribe(s)||await this._gateway.subscribe(e.uid,d,!0)}catch(v){if(v?.code!==Y.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),v;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(y){throw this._p2pChannel.reportSubscribeEvent(!1,y?.code,e,t),y}k.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(y=>{k.warning("[".concat(this._clientId,"] auto set fallback failed"),y)});let g=t==="audio"?e._audioTrack:e._videoTrack;if(!g)throw new he(Y.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),g}catch(g){throw k.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),g),g}finally{f()}}async massSubscribe(e){if(Zd(e,"subscribeList"),!this._joinInfo)throw new he(Y.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));let t=Date.now(),n=new Map,s=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(f=>{let{user:g,mediaType:y}=f;return"user: ".concat(g?.uid,", mediaType: ").concat(y)}).join("; ")));let o=(e=[...e]).map(f=>{let{user:g,mediaType:y}=f;return{user:g,mediaType:y}}),u=await this._p2pChannel.globalLock();try{var d;for(let g=e.length-1;g>=0;g--){let y=e[g],{user:v,mediaType:R}=y;if(zr(R,"mediaType",["audio","video"]),!v){let F=new he(Y.INVALID_PARAMS,"user property does not exist in subscribeList item");throw k.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),F}if(!this._users.find(F=>F===v)){let F=new he(Y.INVALID_REMOTE_USER,"user is not in the channel");k.error("[".concat(this._clientId,"] can not massSubscribe ").concat(v.uid,", this user is not in the channel")),o[g].error=F,e.splice(g,1);continue}if(R==="audio"&&(!v.hasAudio||v._audioSSRC===void 0)||R==="video"&&(!v.hasVideo||v._videoSSRC===void 0)){let F=new he(Y.REMOTE_USER_IS_NOT_PUBLISHED);k.error("[".concat(this._clientId,"] can not subscribe ").concat(v.uid," with mediaType ").concat(R,", remote user is not published")),o[g].error=F,e.splice(g,1);continue}let b=bi.Video|bi.LwoVideo,A=n.get(v);if(A){if(R==="video"?A&b:A&bi.Audio){e.splice(g,1),k.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(v.uid,", mediaType:").concat(R," twice"));continue}n.set(v,A|(R==="video"?b:bi.Audio))}else n.set(v,R==="video"?b:bi.Audio)}for(let g=e.length-1;g>=0;g--){let y=e[g],{user:v,mediaType:R}=y,b=bi.Video|bi.LwoVideo;if(this._p2pChannel.hasRemoteMedia(v,R)){await this._p2pChannel.unmuteRemoteNoLock(v,R);let A=n.get(v);n.set(v,R==="video"?A^b:A^bi.Audio),e.splice(g,1)}}this.store.massSubscribe(e.map(g=>({userId:g.user.uid,type:g.mediaType})),t);let f=ta(d=Array.from(n.entries())).call(d,(g,y)=>{let[v,R]=y;if(R===0)return g;let b={stream_id:v.uid,stream_type:R};return R&bi.Audio&&(b.audio_ssrc=v._audioSSRC),R&bi.Video&&(b.video_ssrc=v._videoSSRC),g.push(b),g},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(y=>{let{user:v,mediaType:R}=y;return{user:v,mediaType:R,ssrcId:R===et.VIDEO?v._videoSSRC:v._audioSSRC,rtxSsrcId:R===et.VIDEO?v._rtxSsrcId:void 0}}));let g=new Map;if(f=f.filter(y=>y.video_ssrc&&!this._p2pChannel.isPreSubScribe(y.video_ssrc)||y.audio_ssrc&&!this._p2pChannel.isPreSubScribe(y.audio_ssrc)||!y.video_ssrc&&!y.audio_ssrc),f.length>0&&((await this._gateway.subscribeAll(f,!0))?.users||[]).forEach(v=>{let{stream_id:R,video_error_code:b,audio_error_code:A,error_code:F}=v;(b||A||F)&&g.set(R,{video_error_code:b,audio_error_code:A,error_code:F})}),Array.from(g.entries()).length>0){let y=[];Array.from(g.entries()).forEach(v=>{let[R,b]=v,A=this.remoteUsers.find(F=>F.uid===R);if(A){let F;b.error_code||b.video_error_code&&b.audio_error_code?F=void 0:b.video_error_code?F=et.VIDEO:b.audio_error_code&&(F=et.AUDIO),y.push({user:A,mediaType:F})}}),y.length>0&&await this._p2pChannel.massUnsubscribeNoLock(y)}for(let y of o){let v=g.get(y.user.uid);if(v){let R=v.error_code||y.mediaType==="audio"&&v.audio_error_code||y.mediaType==="video"&&v.video_error_code;if(R){let b=Km(R);k.error("user:".concat(y.user.uid," mediaType:").concat(y.mediaType," has massSubscribe error ").concat(b.desc)),y.error=new he(Y.SUBSCRIBE_FAILED,"code ".concat(R,": ").concat(b.desc))}}y.error||(y.mediaType==="video"?y.track=y.user.videoTrack:y.track=y.user.audioTrack)}return this.store.massSubscribe(o.filter(y=>!y.error).map(y=>({userId:y.user.uid,type:y.mediaType})),void 0,Date.now()),o.forEach(y=>{var v;tt.subscribe(this.store.sessionId,{succ:!!y.error,ec:((v=y.error)===null||v===void 0?void 0:v.code)||null,video:y.mediaType===et.VIDEO,audio:y.mediaType===et.AUDIO,peerid:y.user.uid,subscribeRequestid:y.mediaType===et.VIDEO?y.user._videoSSRC:y.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(y.user._videoSSRC)},!0)}),k.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(y=>{let{user:v,mediaType:R}=y;return"user: ".concat(v?.uid,", mediaType: ").concat(R)}).join("; "))),o}catch(g){throw await this._p2pChannel.massUnsubscribeNoLock(e),g}}finally{u(),s()}}async unsubscribe(e,t,n){if(!(e instanceof Rp)){let o=this.remoteUsers.find(u=>u.uid===e);if(!o)throw new he(Y.INVALID_REMOTE_USER,"user is not in the channel");e=o}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&zr(t,"mediaType",["audio","video"]),!this._joinInfo)throw new he(Y.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(o=>o===e)){let o=new he(Y.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),o}k.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));let s=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{let o=await this._p2pChannel.unsubscribe(e,t);o&&await this._gateway.unsubscribe(o,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&_b(this._users,e),k.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(o){if(o.code===Y.DISCONNECT_P2P)return void k.warning("disconnecting p2p, abort unsubscribe request.");throw k.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),o.toString()),o}finally{s()}}async _unsubscribeDataChannel(e,t){if(t&&Vn(t,"id",0,65535,!0),!this._joinInfo)throw new he(Y.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(s=>s===e)){let s=new he(Y.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),s}let n;if(typeof t=="number"){let s=e._dataChannels.find(o=>o.id===t);s&&(n=[s])}else n=e._dataChannels;if(n===void 0){let s=new he(Y.REMOTE_USER_IS_NOT_PUBLISHED);throw k.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),s}k.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(n.map(s=>s.id)));try{let s=await this._p2pChannel.unsubscribeDataChannel(e,n);s&&await this._gateway.unsubscribeDataChannel(s,e.uid),k.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(s))}catch(s){if(s.code===Y.DISCONNECT_P2P)return void k.warning("disconnecting p2p, abort unsubscribe request.");throw k.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),s.toString()),s}}async massUnsubscribe(e){if(Zd(e,"unsubscribeList"),!this._joinInfo)throw new he(Y.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");k.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(n=>{let{user:s,mediaType:o}=n;return"user: ".concat(s?.uid,", mediaType: ").concat(o,";")}).join())),e=[...e];let t=new Map;for(let n=e.length-1;n>=0;n--){let{user:s,mediaType:o}=e[n];if(!s){let d=new he(Y.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw k.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),d}if(zr(o,"mediaType",["video","audio",void 0]),!this._users.find(d=>d===s)){k.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(s.uid,", user is not in the channel")),e.splice(n,1);continue}let u=bi.Video|bi.LwoVideo;if(t.has(s)){let d=t.get(s),f;switch(o){case"video":f=d&u;break;case"audio":f=d&bi.Audio;break;default:f=d&(bi.Audio|u)}if(f){k.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(s.uid,",mediaType:").concat(o," twice.")),e.splice(n,1);continue}o?o==="audio"?t.set(s,d|bi.Audio):o==="video"&&t.set(s,d|u):t.set(s,d|bi.Audio|u)}else o?o==="audio"?t.set(s,bi.Audio):o==="video"&&t.set(s,u):t.set(s,bi.Audio|u)}try{let n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),k.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(s=>{let{user:o,mediaType:u}=s;return"user: ".concat(o?.uid,", mediaType: ").concat(u,";")}).join()))}catch(n){if(n.code===Y.DISCONNECT_P2P)return void k.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw k.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(e){(function(n){if(!n)throw new _e(Y.INVALID_PARAMS);wr(n.width)||tk(n.width,"streamParameter.width"),wr(n.height)||tk(n.height,"streamParameter.height"),wr(n.framerate)||tk(n.framerate,"streamParameter.framerate"),wr(n.bitrate)||Vn(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&k.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),k.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));let t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,De.LocalVideoLowTrack)}async setDualStreamMode(e,t){zr(e,"mode",[0,1,-1]);try{switch(t&&await this.setLowStreamParameter(t),this._dualStreamMode=e,this._joinInfo?this._gateway.setDualStreamMode(e).catch(n=>{k.warning("[".concat(this._clientId,"] set dual stream mode failed"),n.toString())}):k.debug("[".concat(this._clientId,"] haven't joined yet, cache dual stream mode ").concat(e)),e){case CE.AUTO_SIMULCAST_STREAM:k.info("[".concat(this._clientId,"] set dual stream mode to ").concat(e));break;case CE.DISABLE_SIMULCAST_STREM:return this.disableDualStream();case CE.ENABLE_SIMULCAST_STREAM:return this.enableDualStream()}}catch(n){throw k.error("[".concat(this._clientId,"] set dual stream mode error"),n.toString()),n}}async enableDualStream(){if(!Qt().supportDualStream)throw tt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new he(Y.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new he(Y.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw tt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,this._dualStreamMode=CE.ENABLE_SIMULCAST_STREAM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(e=>{k.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),e.toString())}),tt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),k.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)return this._isDualStreamEnabled=!1,void k.info("[".concat(this._clientId,"] disable dual stream before join"));if(this._p2pChannel.getLocalMedia(De.LocalVideoLowTrack))try{let e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw tt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,this._dualStreamMode=CE.DISABLE_SIMULCAST_STREM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(e=>{k.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),e.toString())}),tt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),k.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if((function(s){zr(s,"role",["audience","host"])})(e),t&&sk(t),this.mode==="rtc"||this.mode==="p2p")throw k.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new he(Y.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new he(Y.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new he(Y.INVALID_OPERATION,"can not set client role to audience when publishing stream");let n=this._config.role;if(this._joinInfo&&(this._joinInfo.role=e),e!==n&&z("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",ts.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),k.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level)),n==="audience"&&e!=="audience"&&this._pendingRtpCapabilityChange&&this._p2pChannel instanceof Jm){let{video_codec:s}=this._pendingRtpCapabilityChange;this._p2pChannel.updateRemoteRTPCapabilities(s.map(o=>o.toLowerCase()).filter(o=>{var u;return ke(u=Object.keys(Mm)).call(u,o)}))}}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&sk(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{k.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;let t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;let n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(Hi(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new he(Y.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new he(Y.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,tt.setProxyServer(this._proxyServer),k.setProxyServer(this._proxyServer),k.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new he(Y.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new he(Y.INVALID_OPERATION,"You have already set the proxy")}if(Om(e))return this._turnServer={servers:e,mode:"original-manual"},void k.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>G4(n)),this._turnServer={servers:e,mode:"manual"},k.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new he(Y.INVALID_OPERATION,"you should set license before join channel");if(Hi(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new he(Y.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,k.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new he(Y.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new he(Y.INVALID_OPERATION,"You have already set the proxy");let t=[3,4,5],n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new he(Y.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new he(Y.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,k.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new he(Y.INVALID_OPERATION,"Stop proxy server after leave channel");tt.setProxyServer(),k.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",k.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new he(Y.INVALID_PARAMS,"accessPoints is required.");Zd(e.accessPoints.serverList,"accessPoints.serverList"),Hi(e.accessPoints.domain,"accessPoints.domain");let t=(b,A)=>{Vn(b,A,0,65535,!0)},n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new he(Y.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");z("CLOSE_AFB_FOR_LOCAL_AP")&&(Ln("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Ln("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));let s=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,o=e.accessPoints.domain,u=e.accessPoints.serverList.map(b=>s.test(b)?"".concat(b.replace(/\./g,"-"),".").concat(o):b),d=u.map(b=>"".concat(b,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Ln("WEBCS_DOMAIN",d),Ln("WEBCS_DOMAIN_BACKUP_LIST",d),Ln("GATEWAY_DOMAINS",[o]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Zd(e.report.hostname,"report.hostname"),Ln("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Ln("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Ln("EVENT_REPORT_DOMAIN",u[0]),Ln("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let f=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),f=e.report.port),Ln("STATS_COLLECTOR_PORT",f),e.report?Ln("ENABLE_EVENT_REPORT",!0):Ln("ENABLE_EVENT_REPORT",!1);let g="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Zd(e.log.hostname,"log.hostname"),g=e.log.hostname[0]):g=u[0];let y=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),y=e.log.port),Ln("LOG_UPLOAD_SERVER","".concat(g,":").concat(y));let v=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Zd(e.cds.hostname,"cds.hostname"),v=e.cds.hostname):v=u;let R=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),R=e.cds.port),Ln("CDS_AP",v.map(b=>"".concat(b,":").concat(R))),e.cds?Ln("ENABLE_CONFIG_DISTRIBUTE",!0):Ln("ENABLE_CONFIG_DISTRIBUTE",!1),k.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(Zd(e,"serverList"),Hi(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new he(Y.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(s=>n.test(s)?"".concat(s.replace(/\./g,"-"),".").concat(t):s),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Ln("WEBCS_DOMAIN",e),Ln("WEBCS_DOMAIN_BACKUP_LIST",e),Ln("GATEWAY_DOMAINS",[t]),Ln("EVENT_REPORT_DOMAIN",e[0]),Ln("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Ln("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),k.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(zr(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw k.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else k.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){zr(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{let n=this._users.find(s=>s.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw k.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}k.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){zr(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw k.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}k.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,s){(function(u){zr(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Hi(t,"secret");let o=["aes-128-gcm2","aes-256-gcm2"];if(ke(o).call(o,e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new he(Y.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new he(Y.INVALID_PARAMS,"current encrypt mode does not need salt");if(s){if(Bc(s,"encryptDataStream"),!ke(o).call(o,e))throw new he(Y.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||k.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=Ep(n))}async renewToken(e){if(Hi(e,"token",1,2047),!this._key||!this._joinInfo)throw new he(Y.INVALID_OPERATION,"renewToken should not be called before user join");let t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);let n=await this._renewTokenMutex.lock();try{if(z("USE_NEW_TOKEN")){k.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));let s=await yhe(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Kr);k.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:s})}else k.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});k.debug("[".concat(this._clientId,"] renewToken success"))}catch(s){throw this._key=t,this._joinInfo.token=t,k.error("[".concat(this._clientId,"] renewToken failed"),s.toString()),s}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?k.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{let e=this._p2pChannel.getAudioLevels();this.safeEmit(Ht.VOLUME_INDICATOR,e)},z("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){let e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new he(Y.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new he(Y.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new he(Y.LIVE_STREAMING_TASK_CONFLICT);let n=t?th.TRANSCODE:th.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(th.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){let t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(e));if(!t.length)throw new he(Y.INVALID_PARAMS,"can not find live streaming url to stop");await We.all(t.map(n=>n&&n.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){D8(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){D8(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof Jm&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new he(Y.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){let o=new TextEncoder;e.payload=o.encode(e.payload)}let s=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ke(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(s=!0,e.payload=await(async function(o,u,d){var f;let g=ta(f=Array.from(d)).call(f,(M,j)=>M+j,0),y={serverTs:0,seq:Wue++,length:d.length,checkSum:g},v=new Uint8Array(Q4(g,2)),R=new ArrayBuffer(NE),b=new DataView(R);b.setUint32(0,y.serverTs),b.setUint16(4,y.seq),b.setUint16(6,y.length),b.setUint16(8,y.checkSum);let A=16-d.length%16;d=Y4(d,new Uint8Array(A));let F=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:o,tagLength:u5,additionalData:v},u,d);return Y4(new Uint8Array(R),new Uint8Array(F))})(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new he(Y.INVALID_PARAMS,s?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(ct.DATA_STREAM,{payload:Ep(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-Ahe},!n)}sendMetadata(e){if(!this._joinInfo)throw new he(Y.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new he(Y.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(ct.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Ep(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach($ue),!this._joinInfo)throw new he(Y.INVALID_OPERATION,"can not send custom report, not joined");await tt.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){let e=this._statsCollector.getRemoteNetworkQualityStats();if(z("DELETE_NEQ_AFTER_USER_LEAVE")){let t=this._users.map(n=>n.uid+"");Object.keys(e).forEach(n=>{ke(t).call(t,n)||delete e[n]})}return e}getNetworkQuality(){return this._statsCollector.getNetworkQuality()}async pickSVCLayer(e,t){zr(t.spatialLayer,"spatialLayer",[0,1,2,3]),zr(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw k.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(e){let{apRTM:t=!1,rtmFlag:n}=e;if(Bc(t,"apRTM"),Vn(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,k.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(k.debug("[".concat(this._clientId,"] reset client")),(function(e){let t=BE.indexOf(e);t!==-1&&BE.splice(t,1)})(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._pendingRtpCapabilityChange=void 0,this._axiosCancelSource.cancel(),this._axiosCancelSource=oa.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&aG(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0,this._sessionId&&tt.reportRteDetail(this._sessionId)),this._fallbackServerInfo=void 0,this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&tt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new ki("client-publish",this._clientId),this._subscribeMutex=new ki("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var n;let s=e||xm();e?k.debug("[".concat(this._clientId,"] new Session ").concat(s)):k.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(s));let o=e?"":this._sessionId||"";this._sessionId=s,this.store.sessionId=s,tt.addSid(s);let u={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:t?.stringUid||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:o,clientRole:this.role==="audience"?2:1,rteUrl:this.store.rteUrl,rteSid:this.store.rteSid};tt.sessionInit(this._sessionId,$c({cname:t.channel,appid:t.appId},u)),this._joinInfo&&(this._joinInfo.sid=s),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=s)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new he(Y.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&z("FORCE_TURN")&&!z("TURN_ENABLE_TCP")&&!z("TURN_ENABLE_UDP"))throw new he(Y.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");k.debug("[".concat(this._clientId,"] publish high stream"));try{let n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){let s=(await n.next()).value;if(s){try{await this._gateway.sendExtensionMessage(Fr.PUBLISH,s,!0)}catch(o){throw n.throw(o),o}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{let s=(await n.next()).value;if(s){var t;let o;try{o=await this._gateway.publish(this._uid,s,!0)}catch(u){if(u.code!==Y.DISCONNECT_P2P)throw n.throw(u),u}await n.next(((t=o)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(let o of e)o instanceof jn&&o._encoderConfig&&this._gateway.setVideoProfile(o._encoderConfig).catch(u=>{k.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!o.muted&&o.enabled||await this._p2pChannel.muteLocalTrack(o)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n?.code,e),n?.code===Y.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new he(Y.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));k.debug("[".concat(this._clientId,"] publish low stream"));let e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{let n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),s=(await n.next()).value;if(s){var t;let o;try{o=await this._gateway.publish(this._uid,s,!0)}catch(u){if(u.code!==Y.DISCONNECT_P2P)throw n.throw(u),u}n.next(((t=o)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n?.code,void 0,!0),n?.code===Y.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){let t=()=>{if(!this._joinInfo||!this._appId)return new he(Y.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let n=(s={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Kl("LiveStreaming").create(s));var s;return n.onLiveStreamError=(o,u)=>{tt.reportApiInvoke(this._sessionId,{name:or.ON_LIVE_STREAM_ERROR,options:[o,u],tag:Fn.TRACER}).onSuccess(),this.safeEmit(Ht.LIVE_STREAMING_ERROR,o,u)},n.onLiveStreamWarning=(o,u)=>{tt.reportApiInvoke(this._sessionId,{name:or.ON_LIVE_STREAM_WARNING,options:[o,u],tag:Fn.TRACER}).onSuccess(),this.safeEmit(Ht.LIVE_STREAMING_WARNING,o,u)},n.on(nD.REQUEST_WORKER_MANAGER_LIST,(o,u,d)=>{if(!this._joinInfo)return d(new he(Y.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(f,g,y,v){let R=z("UAP_AP").slice(0,z("AJAX_REQUEST_CONCURRENT")).map(b=>g.proxyServer?"https://".concat(g.proxyServer,"/ap/?url=").concat(b+"/api/v1?action=uap"):"https://".concat(b,"/api/v1?action=uap"));return await hhe(R,f,g,y,v)})(o,this._joinInfo,this._axiosCancelSource.token,Kr).then(u).catch(d)}),n};return e===th.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new he(Y.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){let{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),s=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},Kl("ChannelMediaRelay").create(e));s.on("state",o=>{o===Ia.RELAY_STATE_FAILURE&&s&&s.dispose(),this.safeEmit(Ht.CHANNEL_MEDIA_RELAY_STATE,o)}),s.on("event",o=>{this.safeEmit(Ht.CHANNEL_MEDIA_RELAY_EVENT,o)}),this._channelMediaRelayClient=s,this._statsCollector.onStatsChanged=(o,u)=>{var d;o==="resolution"&&((d=this._channelMediaRelayClient)===null||d===void 0||d.setVideoProfile(u))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){let{added:n,deleted:s}=e,o=[];if(t){let u=[];this._users.forEach(d=>{d._dataChannels.forEach(f=>{n.every(g=>g.uid!==d._uintid||g.stream_id!==f.id)&&u.push({uid:d._uintid,stream_id:f.id,ordered:f.ordered,max_retrans_times:f.maxRetransmits,metadata:f.metadata})})}),u.length>0&&this._handleUpdateDataChannel({added:[],deleted:u})}Array.isArray(n)&&n.length>0&&n.forEach(u=>{let{uid:d,stream_id:f,ordered:g,max_retrans_times:y,metadata:v}=u,R=this._users.find(b=>b._uintid===d);if(!R)return void k.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(k.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(d)),ke(o).call(o,R)||o.push(R),R._uintid||(R._uintid=d),R._dataChannels.findIndex(b=>b.id===u.stream_id)===-1){let b={id:f,ordered:!!g,maxRetransmits:y,metadata:v},A=(function(F){return _8(F,!0)})(b);R._dataChannels.push(A),k.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published datachannel")),t||this.safeEmit(Ht.USER_PUBLISHED,R,"datachannel",b)}this._p2pChannel.hasPendingRemoteDataChannel(R,u.stream_id)&&(k.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(R.uid," after reconnect.")),this._subscribeDataChannel(R,u.stream_id).catch(b=>{k.error("[".concat(this._clientId,"] resubscribe datachannel error"),b.toString())}))}),t&&(this.safeEmit(Ht.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(s)&&s.length>0&&s.forEach(u=>{let{uid:d,stream_id:f}=u,g=this._users.find(v=>v._uintid===d);if(!g)return void k.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));let y=g._dataChannels.find(v=>v.id===u.stream_id);y&&(k.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(d)),this._p2pChannel.unsubscribeDataChannel(g,[y]).then(v=>{if(g._dataChannels=g._dataChannels.filter(R=>R!==y),v)return this._gateway.unsubscribeDataChannel(v,g.uid)}),k.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished datachannel ,id:").concat(y.id)),this.safeEmit(Ht.USER_UNPUBLISHED,g,"datachannel",y._config))})}_getEncodingName(e){var t,n;if(!this._joinResponse)return;let s=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(!s)return;for(let f of s){var o;if(f.payloadType===e)return f==null||(o=f.rtpMap)===null||o===void 0?void 0:o.encodingName}let u=(n=this._joinResponse.ortc.rtpCapabilities.recv)===null||n===void 0?void 0:n.videoCodecs;if(u)for(let f of u){var d;if(f.payloadType===e)return f==null||(d=f.rtpMap)===null||d===void 0?void 0:d.encodingName}return e===0?"unknown":void 0}_handleRemoveDataChannels(e){let t=this._users.find(n=>n.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){k.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));let n=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(s=>{this.safeEmit(Ht.USER_UNPUBLISHED,t,"datachannel",s._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(s=>{if(s)return this._gateway.unsubscribeDataChannel(s,t.uid)}),n()}}else k.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Vr.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void k.error("Error loading sdk config",t.message)}if(e)try{let t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach(s=>{let{value:o,type:u,expires:d}=t[s];d&&d<=n||u||Xk()||!Object.prototype.hasOwnProperty.call(Cb,s)||(fo[s]=o,An[s]=o,k.debug("Update gateway parameters from config distribute",s,o))})}catch(t){k.error("Error update config from local cache",t.message)}})()}),this._gateway.on(Vr.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Vr.CONNECTION_STATE_CHANGE,(e,t,n)=>{var s;if(n===tn.FALLBACK)return;let o=()=>{this.safeEmit(Ht.CONNECTION_STATE_CHANGE,e,t,n)};if(tt.reportApiInvoke(this._sessionId||((s=this._gateway.joinInfo)===null||s===void 0?void 0:s.sid)||null,{name:or.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:Fn.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),k.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void o();if(e==="RECONNECTING")this._users.forEach(d=>{d._trust_in_room_=!1,d._trust_audio_enabled_state_=!1,d._trust_video_enabled_state_=!1,d._trust_audio_mute_state_=!1,d._trust_video_mute_state_=!1,d._trust_audio_stream_added_state_=!1,d._trust_video_stream_added_state_=!1,d._is_pre_created||(d._audio_pre_subscribed||(d._audioSSRC=void 0,d._audioOrtc=void 0),d._video_pre_subscribed||(d._videoSSRC=void 0,d._videoOrtc=void 0,d._rtxSsrcId=void 0),d._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach((d,f)=>{this._gateway.setStreamFallbackOption(f,d).catch(g=>{k.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),g)})}),this._remoteStreamTypeCacheMap.forEach((d,f)=>{this._gateway.setRemoteVideoStreamType(f,d).catch(g=>{k.warning("[".concat(this._clientId,"] auto set remote stream type failed"),g)})}),z("VOS_CONFIGURE")&&Array.isArray(z("VOS_CONFIGURE"))&&z("VOS_CONFIGURE").length>0&&(this._gateway.setConfigure(z("VOS_CONFIGURE")).catch(d=>{k.debug("[".concat(this._clientId,"] auto set vos config failed"),d)}),k.debug("[".concat(this._clientId,"] ws connected auto set vos config"))),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{k.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(d=>{k.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(d))}),this._dualStreamMode&&this._gateway.setDualStreamMode(this._dualStreamMode).catch(d=>{k.warning("[".concat(this._clientId,"] auto set dual stream mode failed"),d)}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(d=>!d._trust_in_room_).forEach(d=>{k.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(d.uid)),this._handleUserOffline({uid:d.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(d=>{d._trust_audio_mute_state_||(k.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(d.uid)),this._handleMuteStream(d.uid,et.AUDIO,!1)),d._trust_video_mute_state_||(k.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(d.uid)),this._handleMuteStream(d.uid,et.VIDEO,!1)),d._trust_audio_enabled_state_||(k.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(d.uid)),this._handleSetStreamLocalEnable("audio",d.uid,!0)),d._trust_video_enabled_state_||(k.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(d.uid)),this._handleSetStreamLocalEnable("video",d.uid,!0)),d._trust_video_stream_added_state_||(k.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(d.uid)),this._handleResetAddStream(d,"video")),d._trust_audio_stream_added_state_||(k.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(d.uid)),this._handleResetAddStream(d,"audio")),d._video_added_||d._audio_added_||(k.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(d.uid)),this._handleRemoveStream({uid:d.uid,uint_id:d._uintid}))}))},1e3))}o()}),this._gateway.on(Vr.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new he(Y.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;if(this._fallbackServerInfo)n=this._fallbackServerInfo,this._fallbackServerInfo=void 0,this._joinInfo.preload=!1,tt.reportApiInvoke(this._sessionId,{name:or.VOS_FALLBACK_CN,options:{cur:n.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!0},tag:Fn.TRACER}).onSuccess(),k.info("[".concat(this._clientId,"] use fallback cn server info"));else{let o=await BD($c($c({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));o?(n=o.ap,oG(o),this._joinInfo.preload=!0):(n=await oI(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Kr,this.store),this._joinInfo.preload=!1)}this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);let s=[];n.gatewayInfo.gatewayAddrs.forEach(o=>{let{address:u}=o,[d,f]=u.split(":");this._joinInfo&&this._joinInfo.proxyServer?s.push({proxy:this._joinInfo.proxyServer,host:d,port:f}):s.push({host:d,port:f})}),e(s)}catch(n){t(n)}}),this._gateway.on(Vr.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Ht.NETWORK_QUALITY,e)}),this._gateway.on(Vr.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(Ht.STREAM_TYPE_CHANGED,e,t),tt.reportApiInvoke(this._sessionId,{name:or.STREAM_TYPE_CHANGE,options:[e,t],tag:Fn.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(Vr.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(Vr.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{let s=await this._p2pChannel.getEstablishParams();s&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(s=await this._p2pChannel.startP2PConnection(e)),t(s)}catch(s){n(s)}}),this._gateway.on(Vr.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let n;this._joinResponse=e,e.attributes?n=e.attributes.userAttributes.preSubSsrcs:k.debug("no attributes in joinResponse");let s=o8(e.ortc,t,n);this._p2pChannel.connect(s)}),this._gateway.on(Vr.PRE_CONNECT_PC,async(e,t,n)=>{let{candidates:s,fingerprint:o,turnServer:u}=e;if(this._joinInfo&&s.length>0&&!this._p2pChannel.isPlanB){let{cert:f,cid:g}=this._joinInfo.apResponse,y="".concat(g,"_").concat(f);if(y.length<4||y.length>256)return void k.debug("[".concat(this._clientId,"] ufrag length is not valid, length: ").concat(y.length));await this._p2pChannel.startP2PConnection({turnServer:u,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var d;t(await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(g,"_").concat(f),icePwd:"".concat(g,"_").concat(f)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(d=z("FINGERPRINT"))!==null&&d!==void 0?d:o}]},candidates:s,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0}))}catch(v){v.code&&v.code===Y.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:u,cloudProxyServer:this._joinInfo.cloudProxyServer},!0),n(v)}}}),this._gateway.on(Vr.VOS_FALLBACK,e=>{e==="fallback_hls"&&this.safeEmit(Ht.FALLBACK_TO_HLS,ak.VOSERROR)}),this._gateway.on(Vr.RESET_SIGNAL,()=>{this._p2pChannel instanceof Jm&&this._p2pChannel.fallbackConnection(),this._handleGatewaySignalEvents()}),this._gateway.on(Vr.DATACHANNEL_FAILBACK,()=>{tt.reportApiInvoke(this._sessionId,{name:or.DATACHANNEL_FAILBACK,options:{},tag:Fn.TRACER}).onSuccess(),this._joinGateway()})}_handleGatewaySignalEvents(){this._gateway.signal.on(wt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(wt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(wt.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(wt.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(wt.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(wt.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(wt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(wt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(wt.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,et.AUDIO,!0)),this._gateway.signal.on(wt.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,et.AUDIO,!1)),this._gateway.signal.on(wt.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,et.VIDEO,!0)),this._gateway.signal.on(wt.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,et.VIDEO,!1)),this._gateway.signal.on(wt.RECEIVE_METADATA,e=>{let t=Dm(e.metadata);this.safeEmit(Ht.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(wt.ON_DATA_STREAM,async e=>{var t;if(!e)return;let n=Dm(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ke(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<NE)throw new he(Y.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(NE));n=await(async function(o,u,d){let f=d.subarray(0,NE),g=f.slice(8,NE),y=(g[0]<<8)+g[1],v=(f[6]<<8)+f[7],R=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:o,tagLength:u5,additionalData:new Uint8Array(Q4(y,2))},u,d.subarray(NE));return new Uint8Array(R).subarray(0,v)})(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let s=0;if(e.ordered||e.syncWithAudio){let o=this._p2pChannel.getStats(),u=this.remoteUsers.find(f=>f.uid===e.uid);s=o?.audioRecv.find(f=>f.ssrc===u?._audioSSRC)?.jitterBufferMs}(s==null||Number.isNaN(s))&&(s=0),Nhe($c($c({},e),{},{payload:n}),s,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(wt.ON_CRYPT_ERROR,()=>{_p(()=>{k.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Ht.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(wt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(wt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{k.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,tn.TOKEN_EXPIRE),this.safeEmit(Ht.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(wt.ON_STREAM_FALLBACK_UPDATE,e=>{k.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Ht.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(wt.ENABLE_MULTI_STREAM,e=>{this._dualStreamMode===CE.AUTO_SIMULCAST_STREAM&&this.enableDualStream().catch(t=>{k.debug("[".concat(this._clientId,"] set dual stream mode error"),t.toString())})}),this._gateway.signal.on(wt.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),k.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(wt.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(wt.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(rt.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case ct.PUBLISH:{if(!t)return;let o=t.ortc;if(o){var n,s;let u=o.some(g=>{let{stream_type:y}=g;return y===On.Audio}),d=o.some(g=>{let{stream_type:y}=g;return y!==On.Audio}),f=o.some(g=>{let{stream_type:y}=g;return y===On.Screen||y===On.ScreenLow});t.state==="offer"&&tt.publish(this._joinInfo.sid,{eventElapse:fs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:Y.TIMEOUT,audio:u,video:d,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:f,audioName:u?(n=o.find(g=>{let{stream_type:y}=g;return y===On.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:d?(s=o.find(g=>{let{stream_type:y}=g;return y!==On.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0})}break}case ct.SUBSCRIBE:t&&tt.subscribe(this._joinInfo.sid,{succ:!1,ec:Y.TIMEOUT,audio:t.stream_type===et.AUDIO,video:t.stream_type===et.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:fs.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(wt.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(wt.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;z("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(s=>!Hm(s.string_id||s.stream_id,this.channelName)));let t=[],n=[];for(let s of e.users){let o=this._users.find(v=>v._uintid===s.stream_id);o?o._trust_in_room_=!0:(o=new Rp(s.string_id||s.stream_id,s.stream_id),this._users.push(o),this.store.firstVideoFrameDecoded(o.uid,{userJoinNotify:Date.now()}),this.getListeners(Ht.PUBLISHED_USER_LIST).length===0&&(k.debug("[".concat(this._clientId,"] user online"),s.stream_id),this.safeEmit(Ht.USER_JOINED,o)));let u=bi.Audio&s.stream_type,d=(bi.Video|bi.LwoVideo)&s.stream_type,f=(65280&s.stream_type)!=0,g=u&&o.hasAudio,y=d&&o.hasVideo;d&&(o._trust_video_stream_added_state_=!0,o._video_added_=!0,o._videoSSRC=s.video_ssrc,o._rtxSsrcId=s.video_rtx),u&&(o._trust_audio_stream_added_state_=!0,o._audio_added_=!0,o._audioSSRC=s.audio_ssrc),u&&!g&&this.getListeners(Ht.PUBLISHED_USER_LIST).length===0&&(k.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published audio")),this.safeEmit(Ht.USER_PUBLISHED,o,"audio")),d&&!y&&this.getListeners(Ht.PUBLISHED_USER_LIST).length===0&&(k.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published video")),this.safeEmit(Ht.USER_PUBLISHED,o,"video")),(u&&!g||d&&!y||f)&&t.push(o),d&&this._p2pChannel.hasPendingRemoteMedia(o,"video")&&n.push({user:o,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(o,"audio")&&n.push({user:o,mediaType:"audio"})}n.length>0&&(k.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(s=>"user: ".concat(s.user.uid,", mediaType: ").concat(s.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(s=>{k.error("[".concat(this._clientId,"] mass resubscribe error"),s.toString())})),this.getListeners(Ht.PUBLISHED_USER_LIST).length>0?z("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(k.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(s=>s.uid).join(", "))),this.safeEmit(Ht.PUBLISHED_USER_LIST,t)):k.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(s=>s.uid).join(", ")))}),this._gateway.signal.on(wt.ON_RTP_CAPABILITY_CHANGE,e=>{let{video_codec:t}=e;if(this._p2pChannel instanceof Jm){if(this.role==="audience"&&z("UPDATE_RTP_CAP_IN_HOST"))return this._pendingRtpCapabilityChange=e,void k.debug("[".concat(this._clientId,"] no need to change rtp capability because of audience, params: ").concat(JSON.stringify(e)));this._p2pChannel.updateRemoteRTPCapabilities(t.map(n=>n.toLowerCase()).filter(n=>{var s;return ke(s=Object.keys(Mm)).call(s,n)}))}}),this._gateway.signal.on(rt.VOS_FALLBACK_PROMISE,async(e,t,n)=>{if(e==="FALLBACKCN"&&z("ENABLE_QUALITY_FALLBACK")){if(!this._joinInfo)return n(new he(Y.UNEXPECTED_ERROR,"can not recover, no join info"));k.info("[".concat(this._clientId,"] try fallback to cn, start request new server info"));let o=this._joinInfo.apRequestDetail;try{this._joinInfo.apRequestDetail=e;let u=await oI(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Kr,this.store);if(z("QUALITY_FALLBACK_REHEARSAL"))return tt.reportApiInvoke(this._sessionId,{name:or.VOS_FALLBACK_CN,options:{cur:u.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:Fn.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=o,void n();this._fallbackServerInfo=u,t()}catch(u){var s;let d=u==null||(s=u.data)===null||s===void 0?void 0:s.desc;z("QUALITY_FALLBACK_REHEARSAL")?(tt.reportApiInvoke(this._sessionId,{name:or.VOS_FALLBACK_CN,options:{cur:"failed, errorReason: "+d||"unknown",prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:Fn.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=o):Array.isArray(d)&&ke(d).call(d,"request downgrade fallback")&&this.safeEmit(Ht.FALLBACK_TO_HLS,ak.AP_ERROR),n(u)}}else n()})}_handleP2PEvents(){this._gateway.signal.on(wt.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Fr.PUBLISH,(e,t,n)=>{let{uid:s}=e;e.forEach(o=>{let{kind:u,ssrcs:d,mid:f,isMuted:g}=o;this._handleP2PAddAudioOrVideoStream(u,s,d[0].ssrcId,f);let y=this._users.find(v=>v.uid===s);return y&&this.store.useP2P?this._p2pChannel.mockSubscribe(y,u,d[0].ssrcId,f).then(()=>{t()}).catch(n):t(),this._handleMuteStream(s,u,!!g)})}),this._gateway.signal.on(Fr.CALL,async(e,t,n)=>{if(this.store.useP2P)try{var s;t(await this._p2pChannel.startP2P({turnServer:(s=this._joinInfo)===null||s===void 0?void 0:s.turnServer},e))}catch(o){n(o)}}),this._gateway.signal.on(rt.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(Fr.UNPUBLISH,async(e,t,n)=>{if(this.store.useP2P){let{unpubMsg:s,uid:o}=e,u=this._users.find(d=>d.uid===o);if(!u)return k.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(o)),void t();try{s.forEach(async d=>{let{stream_type:f}=d,g=f===On.Audio?et.AUDIO:et.VIDEO;await this._p2pChannel.unsubscribe(u,g),this._handleMuteStream(o,g,!0)}),t()}catch(d){n(d)}}}),this._gateway.signal.on(Fr.CONTROL,async(e,t)=>{let{action:n}=e;switch(n){case Tp.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,et.VIDEO,!0);break;case Tp.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,et.AUDIO,!0);break;case Tp.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,et.VIDEO,!1);break;case Tp.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,et.AUDIO,!1)}}),this._gateway.signal.on(Fr.RESTART_ICE,async(e,t,n)=>{if(this.store.useP2P)try{let{direction:s,iceParameter:o}=e;s!==Ys.SEND_ONLY||o?t(await this._p2pChannel.restartICE(s,o)):(this._p2pChannel.handleDisconnect(s),t())}catch(s){n(s)}}),this._gateway.signal.on(Fr.CANDIDATE,e=>{if(this.store.useP2P){let{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}}),this._p2pChannel.on(dt.RequestP2PRestartICE,async(e,t,n)=>{try{let{direction:s}=e;t(await this._gateway.sendExtensionMessage(Fr.RESTART_ICE,e,s===Ys.SEND_ONLY))}catch(s){n(s)}}),this._p2pChannel.on(dt.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Fr.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(dt.RequestP2PMuteLocal,async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(Fr.CONTROL,e,!0),t()}catch(s){n(s)}}),this._p2pChannel.on(dt.RequestP2PUnmuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(s){s.code===Y.DISCONNECT_P2P?t():n(s)}else t()}),this._p2pChannel.on(dt.RequestP2PMuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(s){s.code===Y.DISCONNECT_P2P?t():n(s)}else t()}),this._p2pChannel.on(dt.StateChange,(e,t)=>{t===Tn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(dt.PeerConnectionStateChange,e=>{let t=this._peerConnectionState;e!==t&&(this.safeEmit(Ht.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(dt.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(s){s.code===Y.DISCONNECT_P2P?t():n(s)}else t()}),this._p2pChannel.on(dt.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(s){s.code===Y.DISCONNECT_P2P?t():n(s)}else t()}),this._p2pChannel.on(dt.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(dt.RequestRePublishDataChannel,(e,t,n)=>{We.all(e.map(async s=>{let o=await this._p2pChannel.publishDataChannel([s]);try{o.forEach(u=>{this._uid&&this._gateway.publishDataChannel(this._uid,u,!0)})}catch(u){if(u.code!==Y.DISCONNECT_P2P)throw u}})).then(t).catch(n)}),this._p2pChannel.on(dt.RequestReSubscribe,async(e,t,n)=>{try{for(let{user:s,kind:o}of e)o===et.VIDEO?await this.subscribe(s,"video"):await this.subscribe(s,"audio");t()}catch(s){n(s)}}),this._p2pChannel.on(dt.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(dt.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(dt.MediaReconnectStart,e=>{this.safeEmit(Ht.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(dt.MediaReconnectEnd,e=>{this.safeEmit(Ht.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(dt.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(dt.RequestRestartICE,async e=>{if(this.store.useP2P)return;let t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;let s=n.value,o;try{o=await this._gateway.restartICE({iceParameters:s})}catch(d){return void t.throw(d)}let{iceParameters:u}=(function(d){let f=d.iceParameters;return{iceParameters:{iceUfrag:f.iceUfrag,icePwd:f.icePwd}}})(o);await t.next({remoteIceParameters:u})}),this._p2pChannel.on(dt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(dt.RequestReconnectPC,async()=>{var e;let{iceParameters:t,dtlsParameters:n,rtpCapabilities:s}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:o,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:s}),d=o8(o,u);await this._p2pChannel.connect(d),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(dt.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(dt.P2PLost,()=>{this.safeEmit(Ht.P2P_LOST,this.store.uid)}),this._p2pChannel.on(dt.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(dt.ConnectionTypeChange,e=>{this.safeEmit(Ht.IS_USING_CLOUD_PROXY,e),this._gateway.setUsingProxy(e)}),this._p2pChannel.on(dt.FirstVideoBufferReady,(e,t)=>{this.safeEmit(Ht.FIRST_VIDEO_BUFFER_READY,e,t)}),this._p2pChannel.on(dt.FirstVideoPreRender,(e,t)=>{this.safeEmit(Ht.FIRST_VIDEO_PRE_RENDER,e,t)}),this._p2pChannel.on(dt.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(dt.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(dt.AudioMetadata,e=>{this.safeEmit(Ht.AUDIO_METADATA,e)}),this._p2pChannel.on(dt.AudioPts,e=>{this.safeEmit(Ht.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new he(Y.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new he(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{let n=(t={config:e},Kl("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);let{appId:s,cname:o,sid:u,token:d,uid:f,cid:g,vid:y}=this._joinInfo;await n.init({appId:s,areaCode:"",cname:o,sid:u,token:d,uid:f,cid:g,vid:y?Number(y):0},Kr)}catch(n){throw Array.isArray(n)?n[0]:n}var t}handleVideoInspectEvents(e){e.on(xi.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(Ht.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===Kc.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Ht.CONTENT_INSPECT_ERROR,new he(Y.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(xi.INSPECT_RESULT,(t,n)=>{var s;if(n?.code===Y.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return k.debug("Stop inspect content because that has left channel"),this==null||(s=this._inspect)===null||s===void 0||s.close(),void(this._inspect=void 0);this.safeEmit(Ht.CONTENT_INSPECT_RESULT,t,n)}),e.on(xi.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new he(Y.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Bc(e,"enabled"),e){if(!t)throw new he(Y.INVALID_PARAMS,"config is required");if(vG(t),!this._joinInfo)throw new he(Y.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{let s=(n={config:t},Kl("ImageModeration").create(n));this._moderation=s,this.handleImageModerationEvents(s);let{appId:o,cname:u,sid:d,token:f,uid:g,cid:y,vid:v}=this._joinInfo;await s.init({appId:o,areaCode:"",cname:u,sid:d,token:f,uid:g,cid:y,vid:v?Number(v):0},Kr)}}catch(s){throw Array.isArray(s)?s[0]:s}}else{var n;if(!this._moderation)throw new he(Y.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(s){throw Array.isArray(s)?s[0]:s}}}handleImageModerationEvents(e){e.on(zl.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(Ht.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===ec.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new he(Y.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(zl.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(e){if((function(t){zr(t,"transport",["default","auto","relay","sd-rtn"])})(e),this.mode!=="p2p")throw new he(Y.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,k.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return k.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Bc(e,"enabled"),Ln("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_setRteInfo(e,t){this.store.rteUrl=e,this.store.rteSid=t}_isPreRender(){return"isPreRender"in this._p2pChannel&&this._p2pChannel.isPreRender()}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},ze(Je.prototype,"leave",[SG],Object.getOwnPropertyDescriptor(Je.prototype,"leave"),Je.prototype),ze(Je.prototype,"publish",[TG],Object.getOwnPropertyDescriptor(Je.prototype,"publish"),Je.prototype),ze(Je.prototype,"unpublish",[wG],Object.getOwnPropertyDescriptor(Je.prototype,"unpublish"),Je.prototype),ze(Je.prototype,"subscribe",[CG],Object.getOwnPropertyDescriptor(Je.prototype,"subscribe"),Je.prototype),ze(Je.prototype,"presubscribe",[RG],Object.getOwnPropertyDescriptor(Je.prototype,"presubscribe"),Je.prototype),ze(Je.prototype,"massSubscribe",[bG],Object.getOwnPropertyDescriptor(Je.prototype,"massSubscribe"),Je.prototype),ze(Je.prototype,"unsubscribe",[IG],Object.getOwnPropertyDescriptor(Je.prototype,"unsubscribe"),Je.prototype),ze(Je.prototype,"massUnsubscribe",[AG],Object.getOwnPropertyDescriptor(Je.prototype,"massUnsubscribe"),Je.prototype),ze(Je.prototype,"setLowStreamParameter",[OG],Object.getOwnPropertyDescriptor(Je.prototype,"setLowStreamParameter"),Je.prototype),ze(Je.prototype,"setDualStreamMode",[NG],Object.getOwnPropertyDescriptor(Je.prototype,"setDualStreamMode"),Je.prototype),ze(Je.prototype,"enableDualStream",[PG],Object.getOwnPropertyDescriptor(Je.prototype,"enableDualStream"),Je.prototype),ze(Je.prototype,"disableDualStream",[kG],Object.getOwnPropertyDescriptor(Je.prototype,"disableDualStream"),Je.prototype),ze(Je.prototype,"setClientRole",[DG],Object.getOwnPropertyDescriptor(Je.prototype,"setClientRole"),Je.prototype),ze(Je.prototype,"_setClientRoleOptions",[xG],Object.getOwnPropertyDescriptor(Je.prototype,"_setClientRoleOptions"),Je.prototype),ze(Je.prototype,"setProxyServer",[LG],Object.getOwnPropertyDescriptor(Je.prototype,"setProxyServer"),Je.prototype),ze(Je.prototype,"setTurnServer",[MG],Object.getOwnPropertyDescriptor(Je.prototype,"setTurnServer"),Je.prototype),ze(Je.prototype,"setLicense",[UG],Object.getOwnPropertyDescriptor(Je.prototype,"setLicense"),Je.prototype),ze(Je.prototype,"startProxyServer",[VG],Object.getOwnPropertyDescriptor(Je.prototype,"startProxyServer"),Je.prototype),ze(Je.prototype,"stopProxyServer",[FG],Object.getOwnPropertyDescriptor(Je.prototype,"stopProxyServer"),Je.prototype),ze(Je.prototype,"setLocalAccessPointsV2",[jG],Object.getOwnPropertyDescriptor(Je.prototype,"setLocalAccessPointsV2"),Je.prototype),ze(Je.prototype,"setLocalAccessPoints",[BG],Object.getOwnPropertyDescriptor(Je.prototype,"setLocalAccessPoints"),Je.prototype),ze(Je.prototype,"setRemoteDefaultVideoStreamType",[WG],Object.getOwnPropertyDescriptor(Je.prototype,"setRemoteDefaultVideoStreamType"),Je.prototype),ze(Je.prototype,"setRemoteVideoStreamType",[GG],Object.getOwnPropertyDescriptor(Je.prototype,"setRemoteVideoStreamType"),Je.prototype),ze(Je.prototype,"setStreamFallbackOption",[HG],Object.getOwnPropertyDescriptor(Je.prototype,"setStreamFallbackOption"),Je.prototype),ze(Je.prototype,"setEncryptionConfig",[zG],Object.getOwnPropertyDescriptor(Je.prototype,"setEncryptionConfig"),Je.prototype),ze(Je.prototype,"renewToken",[KG],Object.getOwnPropertyDescriptor(Je.prototype,"renewToken"),Je.prototype),ze(Je.prototype,"enableAudioVolumeIndicator",[YG],Object.getOwnPropertyDescriptor(Je.prototype,"enableAudioVolumeIndicator"),Je.prototype),ze(Je.prototype,"startLiveStreaming",[qG],Object.getOwnPropertyDescriptor(Je.prototype,"startLiveStreaming"),Je.prototype),ze(Je.prototype,"setLiveTranscoding",[XG],Object.getOwnPropertyDescriptor(Je.prototype,"setLiveTranscoding"),Je.prototype),ze(Je.prototype,"stopLiveStreaming",[JG],Object.getOwnPropertyDescriptor(Je.prototype,"stopLiveStreaming"),Je.prototype),ze(Je.prototype,"startChannelMediaRelay",[$G],Object.getOwnPropertyDescriptor(Je.prototype,"startChannelMediaRelay"),Je.prototype),ze(Je.prototype,"updateChannelMediaRelay",[QG],Object.getOwnPropertyDescriptor(Je.prototype,"updateChannelMediaRelay"),Je.prototype),ze(Je.prototype,"stopChannelMediaRelay",[ZG],Object.getOwnPropertyDescriptor(Je.prototype,"stopChannelMediaRelay"),Je.prototype),ze(Je.prototype,"sendCustomReportMessage",[eH],Object.getOwnPropertyDescriptor(Je.prototype,"sendCustomReportMessage"),Je.prototype),ze(Je.prototype,"pickSVCLayer",[tH],Object.getOwnPropertyDescriptor(Je.prototype,"pickSVCLayer"),Je.prototype),ze(Je.prototype,"setRTMConfig",[nH],Object.getOwnPropertyDescriptor(Je.prototype,"setRTMConfig"),Je.prototype),ze(Je.prototype,"enableContentInspect",[rH],Object.getOwnPropertyDescriptor(Je.prototype,"enableContentInspect"),Je.prototype),ze(Je.prototype,"disableContentInspect",[iH],Object.getOwnPropertyDescriptor(Je.prototype,"disableContentInspect"),Je.prototype),ze(Je.prototype,"setImageModeration",[sH],Object.getOwnPropertyDescriptor(Je.prototype,"setImageModeration"),Je.prototype),ze(Je.prototype,"setP2PTransport",[aH],Object.getOwnPropertyDescriptor(Je.prototype,"setP2PTransport"),Je.prototype),ze(Je.prototype,"getJoinChannelServiceRecords",[oH],Object.getOwnPropertyDescriptor(Je.prototype,"getJoinChannelServiceRecords"),Je.prototype),ze(Je.prototype,"setPublishAudioFilterEnabled",[cH],Object.getOwnPropertyDescriptor(Je.prototype,"setPublishAudioFilterEnabled"),Je.prototype),Je);function uH(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"},n=In(5,"client-"),s=tt.reportApiInvoke(null,{id:n,name:or.CREATE_CLIENT,options:[t],tag:Fn.TRACER});try{(function(o){zr(o.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),zr(o.mode,"config.mode",["rtc","live","p2p"]),o.audioCodec!==void 0&&zr(o.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),o.proxyServer!==void 0&&Hi(o.proxyServer,"config.proxyServer",1,1e4),o.turnServer!==void 0&&G4(o.turnServer),o.httpRetryConfig!==void 0&&W4(o.httpRetryConfig),o.websocketRetryConfig!==void 0&&W4(o.websocketRetryConfig)})(t)}catch(o){throw s.onError(o),o}return(O4(16,0,!0)||Z1(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",k.debug("browser not support vp9, force use vp8")),Ln("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),s.onSuccess(),new Yhe($c($c({forceWaitGatewayResponse:!0},t),{},{role:ke(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)}function qhe(){let e=!1,t=pn();return(t.name===_n.CHROME&&Number(t.version)>=58&&(Fl.engine.name!=="WebKit"||(function(){let n=pn();if(gb()){if(n.os===wi.MAC_OS)return!0;if(n.os===wi.IOS){let s=Fl.os.version&&Fl.os.version.split(".");if(s&&Number(s[0])===14&&s[1]&&Number(s[1])>=3||s&&Number(s[0])>14)return!0}}return!1})())||t.name===_n.FIREFOX&&Number(t.version)>=56||t.name===_n.OPERA&&Number(t.version)>=45||t.name===_n.SAFARI&&Number(t.version)>=11||t.name==="WebKit"&&(Es()||jc())&&t.osVersion&&Number(t.osVersion.split(".")[0])>=11||k4()||pn().name===_n.QQ)&&(e=!0),e}class $T{constructor(t,n){V(this,"id",0),V(this,"element",void 0),V(this,"peerPair",void 0),V(this,"context",void 0),V(this,"audioPlayerElement",void 0),V(this,"audioTrack",void 0),$T.count+=1,this.id=$T.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{let n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;let t=async(s,o)=>{let u=o==="offer"?await s.createOffer():await s.createAnswer();return await s.setLocalDescription(u),s.iceGatheringState==="complete"?s.localDescription:new We(d=>{s.onicegatheringstatechange=()=>{s.iceGatheringState==="complete"&&d(s.localDescription)}})},n=async(s,o)=>await s.setRemoteDescription(o);try{let s=await t(this.peerPair[0],"offer");await n(this.peerPair[1],s);let o=await t(this.peerPair[1],"answer");await n(this.peerPair[0],o)}catch(s){throw new he(Y.LOCAL_AEC_ERROR,s.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(o){throw new he(Y.LOCAL_AEC_ERROR,o.toString()).print()}if(!n)throw new he(Y.LOCAL_AEC_ERROR,"no dest node when local aec").print();let s=n.stream.getAudioTracks()[0];return this.audioTrack=s,s}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){k.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var dH,vI;V($T,"count",0);let Xhe=window.AudioContext||window.webkitAudioContext,Jhe=new(dH=gt({report:tt}),ze((vI=class{constructor(){V(this,"units",[]),V(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return k.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Xhe);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new $T(e,this.context),this.units.push(t)),t.startEchoCancellation(),k.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return pn().name!==_n.SAFARI}}).prototype,"processExternalMediaAEC",[dH],Object.getOwnPropertyDescriptor(vI.prototype,"processExternalMediaAEC"),vI.prototype),vI);function hH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function pH(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?hH(Object(n),!0).forEach(function(s){V(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hH(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}let KD=window||document;function fH(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!KD)return;let n=ti._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);let s=o=>{if(!(o&&o.blockedURI&&(ti.onSecurityPolicyViolation||ti.getListeners(Qu.SECURITY_POLICY_VIOLATION).length>0)))return;let u=o.blockedURI;z("CSP_DETECTED_HOSTNAME_LIST").some(d=>ke(u).call(u,d))&&(ti.onSecurityPolicyViolation&&typeof ti.onSecurityPolicyViolation=="function"&&ti.onSecurityPolicyViolation(o),ti.getListeners(Qu.SECURITY_POLICY_VIOLATION).length>0&&ti.safeEmit(Qu.SECURITY_POLICY_VIOLATION,o))};n&&KD.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||ti.getListeners(Qu.SECURITY_POLICY_VIOLATION).length>0)&&KD.addEventListener("securitypolicyviolation",s),ti._cspEventHandlerPointer=s}var $he=N,Qhe=s1,mH=RegExp.prototype,Zhe=function(e){return e===mH||$he(mH,e)?Qhe(e):e.flags},Ds=l(Zhe);function ny(e){let t=e.length;for(;--t>=0;)e[t]=0}let YD=256,gH=286,QT=30,ZT=15,qD=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),SI=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),epe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),_H=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),sh=new Array(576);ny(sh);let e0=new Array(60);ny(e0);let t0=new Array(512);ny(t0);let n0=new Array(256);ny(n0);let XD=new Array(29);ny(XD);let TI=new Array(QT);function JD(e,t,n,s,o){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=s,this.max_length=o,this.has_stree=e&&e.length}let EH,yH,vH;function $D(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}ny(TI);let SH=e=>e<256?t0[e]:t0[256+(e>>>7)],r0=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},To=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,r0(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},id=(e,t,n)=>{To(e,n[2*t],n[2*t+1])},TH=(e,t)=>{let n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1},wH=(e,t,n)=>{let s=new Array(16),o,u,d=0;for(o=1;o<=ZT;o++)d=d+n[o-1]<<1,s[o]=d;for(u=0;u<=t;u++){let f=e[2*u+1];f!==0&&(e[2*u]=TH(s[f]++,f))}},CH=e=>{let t;for(t=0;t<gH;t++)e.dyn_ltree[2*t]=0;for(t=0;t<QT;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},RH=e=>{e.bi_valid>8?r0(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},bH=(e,t,n,s)=>{let o=2*t,u=2*n;return e[o]<e[u]||e[o]===e[u]&&s[t]<=s[n]},QD=(e,t,n)=>{let s=e.heap[n],o=n<<1;for(;o<=e.heap_len&&(o<e.heap_len&&bH(t,e.heap[o+1],e.heap[o],e.depth)&&o++,!bH(t,s,e.heap[o],e.depth));)e.heap[n]=e.heap[o],n=o,o<<=1;e.heap[n]=s},IH=(e,t,n)=>{let s,o,u,d,f=0;if(e.sym_next!==0)do s=255&e.pending_buf[e.sym_buf+f++],s+=(255&e.pending_buf[e.sym_buf+f++])<<8,o=e.pending_buf[e.sym_buf+f++],s===0?id(e,o,t):(u=n0[o],id(e,u+YD+1,t),d=qD[u],d!==0&&(o-=XD[u],To(e,o,d)),s--,u=SH(s),id(e,u,n),d=SI[u],d!==0&&(s-=TI[u],To(e,s,d)));while(f<e.sym_next);id(e,256,t)},ZD=(e,t)=>{let n=t.dyn_tree,s=t.stat_desc.static_tree,o=t.stat_desc.has_stree,u=t.stat_desc.elems,d,f,g,y=-1;for(e.heap_len=0,e.heap_max=573,d=0;d<u;d++)n[2*d]!==0?(e.heap[++e.heap_len]=y=d,e.depth[d]=0):n[2*d+1]=0;for(;e.heap_len<2;)g=e.heap[++e.heap_len]=y<2?++y:0,n[2*g]=1,e.depth[g]=0,e.opt_len--,o&&(e.static_len-=s[2*g+1]);for(t.max_code=y,d=e.heap_len>>1;d>=1;d--)QD(e,n,d);g=u;do d=e.heap[1],e.heap[1]=e.heap[e.heap_len--],QD(e,n,1),f=e.heap[1],e.heap[--e.heap_max]=d,e.heap[--e.heap_max]=f,n[2*g]=n[2*d]+n[2*f],e.depth[g]=(e.depth[d]>=e.depth[f]?e.depth[d]:e.depth[f])+1,n[2*d+1]=n[2*f+1]=g,e.heap[1]=g++,QD(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((v,R)=>{let b=R.dyn_tree,A=R.max_code,F=R.stat_desc.static_tree,M=R.stat_desc.has_stree,j=R.stat_desc.extra_bits,K=R.stat_desc.extra_base,q=R.stat_desc.max_length,Q,se,oe,ne,de,we,Oe=0;for(ne=0;ne<=ZT;ne++)v.bl_count[ne]=0;for(b[2*v.heap[v.heap_max]+1]=0,Q=v.heap_max+1;Q<573;Q++)se=v.heap[Q],ne=b[2*b[2*se+1]+1]+1,ne>q&&(ne=q,Oe++),b[2*se+1]=ne,se>A||(v.bl_count[ne]++,de=0,se>=K&&(de=j[se-K]),we=b[2*se],v.opt_len+=we*(ne+de),M&&(v.static_len+=we*(F[2*se+1]+de)));if(Oe!==0){do{for(ne=q-1;v.bl_count[ne]===0;)ne--;v.bl_count[ne]--,v.bl_count[ne+1]+=2,v.bl_count[q]--,Oe-=2}while(Oe>0);for(ne=q;ne!==0;ne--)for(se=v.bl_count[ne];se!==0;)oe=v.heap[--Q],oe>A||(b[2*oe+1]!==ne&&(v.opt_len+=(ne-b[2*oe+1])*b[2*oe],b[2*oe+1]=ne),se--)}})(e,t),wH(n,y,e.bl_count)},AH=(e,t,n)=>{let s,o,u=-1,d=t[1],f=0,g=7,y=4;for(d===0&&(g=138,y=3),t[2*(n+1)+1]=65535,s=0;s<=n;s++)o=d,d=t[2*(s+1)+1],++f<g&&o===d||(f<y?e.bl_tree[2*o]+=f:o!==0?(o!==u&&e.bl_tree[2*o]++,e.bl_tree[32]++):f<=10?e.bl_tree[34]++:e.bl_tree[36]++,f=0,u=o,d===0?(g=138,y=3):o===d?(g=6,y=3):(g=7,y=4))},OH=(e,t,n)=>{let s,o,u=-1,d=t[1],f=0,g=7,y=4;for(d===0&&(g=138,y=3),s=0;s<=n;s++)if(o=d,d=t[2*(s+1)+1],!(++f<g&&o===d)){if(f<y)do id(e,o,e.bl_tree);while(--f!=0);else o!==0?(o!==u&&(id(e,o,e.bl_tree),f--),id(e,16,e.bl_tree),To(e,f-3,2)):f<=10?(id(e,17,e.bl_tree),To(e,f-3,3)):(id(e,18,e.bl_tree),To(e,f-11,7));f=0,u=o,d===0?(g=138,y=3):o===d?(g=6,y=3):(g=7,y=4)}},NH=!1,PH=(e,t,n,s)=>{To(e,0+(s?1:0),3),RH(e),r0(e,n),r0(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var tpe=e=>{NH||((()=>{let t,n,s,o,u,d=new Array(16);for(s=0,o=0;o<28;o++)for(XD[o]=s,t=0;t<1<<qD[o];t++)n0[s++]=o;for(n0[s-1]=o,u=0,o=0;o<16;o++)for(TI[o]=u,t=0;t<1<<SI[o];t++)t0[u++]=o;for(u>>=7;o<QT;o++)for(TI[o]=u<<7,t=0;t<1<<SI[o]-7;t++)t0[256+u++]=o;for(n=0;n<=ZT;n++)d[n]=0;for(t=0;t<=143;)sh[2*t+1]=8,t++,d[8]++;for(;t<=255;)sh[2*t+1]=9,t++,d[9]++;for(;t<=279;)sh[2*t+1]=7,t++,d[7]++;for(;t<=287;)sh[2*t+1]=8,t++,d[8]++;for(wH(sh,287,d),t=0;t<QT;t++)e0[2*t+1]=5,e0[2*t]=TH(t,5);EH=new JD(sh,qD,257,gH,ZT),yH=new JD(e0,SI,0,QT,ZT),vH=new JD(new Array(0),epe,0,19,7)})(),NH=!0),e.l_desc=new $D(e.dyn_ltree,EH),e.d_desc=new $D(e.dyn_dtree,yH),e.bl_desc=new $D(e.bl_tree,vH),e.bi_buf=0,e.bi_valid=0,CH(e)},npe=(e,t,n,s)=>{let o,u,d=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(f=>{let g,y=4093624447;for(g=0;g<=31;g++,y>>>=1)if(1&y&&f.dyn_ltree[2*g]!==0)return 0;if(f.dyn_ltree[18]!==0||f.dyn_ltree[20]!==0||f.dyn_ltree[26]!==0)return 1;for(g=32;g<YD;g++)if(f.dyn_ltree[2*g]!==0)return 1;return 0})(e)),ZD(e,e.l_desc),ZD(e,e.d_desc),d=(f=>{let g;for(AH(f,f.dyn_ltree,f.l_desc.max_code),AH(f,f.dyn_dtree,f.d_desc.max_code),ZD(f,f.bl_desc),g=18;g>=3&&f.bl_tree[2*_H[g]+1]===0;g--);return f.opt_len+=3*(g+1)+5+5+4,g})(e),o=e.opt_len+3+7>>>3,u=e.static_len+3+7>>>3,u<=o&&(o=u)):o=u=n+5,n+4<=o&&t!==-1?PH(e,t,n,s):e.strategy===4||u===o?(To(e,2+(s?1:0),3),IH(e,sh,e0)):(To(e,4+(s?1:0),3),((f,g,y,v)=>{let R;for(To(f,g-257,5),To(f,y-1,5),To(f,v-4,4),R=0;R<v;R++)To(f,f.bl_tree[2*_H[R]+1],3);OH(f,f.dyn_ltree,g-1),OH(f,f.dyn_dtree,y-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,d+1),IH(e,e.dyn_ltree,e.dyn_dtree)),CH(e),s&&RH(e)},rpe=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(n0[n]+YD+1)]++,e.dyn_dtree[2*SH(t)]++),e.sym_next===e.sym_end),ipe=e=>{To(e,2,3),id(e,256,sh),(t=>{t.bi_valid===16?(r0(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},spe={_tr_init:tpe,_tr_stored_block:PH,_tr_flush_block:npe,_tr_tally:rpe,_tr_align:ipe},i0=(e,t,n,s)=>{let o=65535&e|0,u=e>>>16&65535|0,d=0;for(;n!==0;){d=n>2e3?2e3:n,n-=d;do o=o+t[s++]|0,u=u+o|0;while(--d);o%=65521,u%=65521}return o|u<<16|0};let ape=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var s=0;s<8;s++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var qs=(e,t,n,s)=>{let o=ape,u=s+n;e^=-1;for(let d=s;d<u;d++)e=e>>>8^o[255&(e^t[d])];return-1^e},Zm={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},wI={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};let{_tr_init:ope,_tr_stored_block:ex,_tr_flush_block:cpe,_tr_tally:Op,_tr_align:lpe}=spe,{Z_NO_FLUSH:Np,Z_PARTIAL_FLUSH:upe,Z_FULL_FLUSH:dpe,Z_FINISH:Qc,Z_BLOCK:kH,Z_OK:pa,Z_STREAM_END:DH,Z_STREAM_ERROR:sd,Z_DATA_ERROR:hpe,Z_BUF_ERROR:tx,Z_DEFAULT_COMPRESSION:ppe,Z_FILTERED:fpe,Z_HUFFMAN_ONLY:CI,Z_RLE:mpe,Z_FIXED:gpe,Z_DEFAULT_STRATEGY:_pe,Z_UNKNOWN:Epe,Z_DEFLATED:RI}=wI,nx=286,ype=30,vpe=19,Spe=2*nx+1,Tpe=15,eg=258,ad=262,ry=42,tg=113,s0=666,ng=(e,t)=>(e.msg=Zm[t],t),xH=e=>2*e-(e>4?9:0),Pp=e=>{let t=e.length;for(;--t>=0;)e[t]=0},wpe=e=>{let t,n,s,o=e.w_size;t=e.hash_size,s=t;do n=e.head[--s],e.head[s]=n>=o?n-o:0;while(--t);t=o,s=t;do n=e.prev[--s],e.prev[s]=n>=o?n-o:0;while(--t)},kp=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask,tc=e=>{let t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},nc=(e,t)=>{cpe(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,tc(e.strm)},xr=(e,t)=>{e.pending_buf[e.pending++]=t},a0=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},rx=(e,t,n,s)=>{let o=e.avail_in;return o>s&&(o=s),o===0?0:(e.avail_in-=o,t.set(e.input.subarray(e.next_in,e.next_in+o),n),e.state.wrap===1?e.adler=i0(e.adler,t,o,n):e.state.wrap===2&&(e.adler=qs(e.adler,t,o,n)),e.next_in+=o,e.total_in+=o,o)},LH=(e,t)=>{let n,s,o=e.max_chain_length,u=e.strstart,d=e.prev_length,f=e.nice_match,g=e.strstart>e.w_size-ad?e.strstart-(e.w_size-ad):0,y=e.window,v=e.w_mask,R=e.prev,b=e.strstart+eg,A=y[u+d-1],F=y[u+d];e.prev_length>=e.good_match&&(o>>=2),f>e.lookahead&&(f=e.lookahead);do if(n=t,y[n+d]===F&&y[n+d-1]===A&&y[n]===y[u]&&y[++n]===y[u+1]){u+=2,n++;do;while(y[++u]===y[++n]&&y[++u]===y[++n]&&y[++u]===y[++n]&&y[++u]===y[++n]&&y[++u]===y[++n]&&y[++u]===y[++n]&&y[++u]===y[++n]&&y[++u]===y[++n]&&u<b);if(s=eg-(b-u),u=b-eg,s>d){if(e.match_start=t,d=s,s>=f)break;A=y[u+d-1],F=y[u+d]}}while((t=R[t&v])>g&&--o!=0);return d<=e.lookahead?d:e.lookahead},iy=e=>{let t=e.w_size,n,s,o;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-ad)&&(e.window.set(e.window.subarray(t,t+t-s),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),wpe(e),s+=t),e.strm.avail_in===0)break;if(n=rx(e.strm,e.window,e.strstart+e.lookahead,s),e.lookahead+=n,e.lookahead+e.insert>=3)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=kp(e,e.ins_h,e.window[o+1]);e.insert&&(e.ins_h=kp(e,e.ins_h,e.window[o+3-1]),e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<ad&&e.strm.avail_in!==0)},MH=(e,t)=>{let n,s,o,u=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,d=0,f=e.strm.avail_in;do{if(n=65535,o=e.bi_valid+42>>3,e.strm.avail_out<o||(o=e.strm.avail_out-o,s=e.strstart-e.block_start,n>s+e.strm.avail_in&&(n=s+e.strm.avail_in),n>o&&(n=o),n<u&&(n===0&&t!==Qc||t===Np||n!==s+e.strm.avail_in)))break;d=t===Qc&&n===s+e.strm.avail_in?1:0,ex(e,0,0,d),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,tc(e.strm),s&&(s>n&&(s=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+s),e.strm.next_out),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s,e.block_start+=s,n-=s),n&&(rx(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(d===0);return f-=e.strm.avail_in,f&&(f>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=f&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-f,e.strm.next_in),e.strstart),e.strstart+=f,e.insert+=f>e.w_size-e.insert?e.w_size-e.insert:f),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),d?4:t!==Np&&t!==Qc&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(o=e.window_size-e.strstart,e.strm.avail_in>o&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,o+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),o>e.strm.avail_in&&(o=e.strm.avail_in),o&&(rx(e.strm,e.window,e.strstart,o),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.high_water<e.strstart&&(e.high_water=e.strstart),o=e.bi_valid+42>>3,o=e.pending_buf_size-o>65535?65535:e.pending_buf_size-o,u=o>e.w_size?e.w_size:o,s=e.strstart-e.block_start,(s>=u||(s||t===Qc)&&t!==Np&&e.strm.avail_in===0&&s<=o)&&(n=s>o?o:s,d=t===Qc&&e.strm.avail_in===0&&n===s?1:0,ex(e,e.block_start,n,d),e.block_start+=n,tc(e.strm)),d?3:1)},ix=(e,t)=>{let n,s;for(;;){if(e.lookahead<ad){if(iy(e),e.lookahead<ad&&t===Np)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=kp(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-ad&&(e.match_length=LH(e,n)),e.match_length>=3)if(s=Op(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=kp(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=kp(e,e.ins_h,e.window[e.strstart+1]);else s=Op(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(s&&(nc(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Qc?(nc(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(nc(e,!1),e.strm.avail_out===0)?1:2},sy=(e,t)=>{let n,s,o;for(;;){if(e.lookahead<ad){if(iy(e),e.lookahead<ad&&t===Np)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=kp(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-ad&&(e.match_length=LH(e,n),e.match_length<=5&&(e.strategy===fpe||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){o=e.strstart+e.lookahead-3,s=Op(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=o&&(e.ins_h=kp(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,s&&(nc(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(s=Op(e,0,e.window[e.strstart-1]),s&&nc(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(s=Op(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Qc?(nc(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(nc(e,!1),e.strm.avail_out===0)?1:2};function od(e,t,n,s,o){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=s,this.func=o}let o0=[new od(0,0,0,0,MH),new od(4,4,8,4,ix),new od(4,5,16,8,ix),new od(4,6,32,32,ix),new od(4,4,16,16,sy),new od(8,16,32,32,sy),new od(8,16,128,128,sy),new od(8,32,128,256,sy),new od(32,128,258,1024,sy),new od(32,258,258,4096,sy)];function Cpe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=RI,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Spe),this.dyn_dtree=new Uint16Array(2*(2*ype+1)),this.bl_tree=new Uint16Array(2*(2*vpe+1)),Pp(this.dyn_ltree),Pp(this.dyn_dtree),Pp(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Tpe+1),this.heap=new Uint16Array(2*nx+1),Pp(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*nx+1),Pp(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}let c0=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.status!==ry&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==tg&&t.status!==s0?1:0},UH=e=>{if(c0(e))return ng(e,sd);e.total_in=e.total_out=0,e.data_type=Epe;let t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?ry:tg,e.adler=t.wrap===2?0:1,t.last_flush=-2,ope(t),pa},VH=e=>{let t=UH(e);return t===pa&&(n=>{n.window_size=2*n.w_size,Pp(n.head),n.max_lazy_match=o0[n.level].max_lazy,n.good_match=o0[n.level].good_length,n.nice_match=o0[n.level].nice_length,n.max_chain_length=o0[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(e.state),t},FH=(e,t,n,s,o,u)=>{if(!e)return sd;let d=1;if(t===ppe&&(t=6),s<0?(d=0,s=-s):s>15&&(d=2,s-=16),o<1||o>9||n!==RI||s<8||s>15||t<0||t>9||u<0||u>gpe||s===8&&d!==1)return ng(e,sd);s===8&&(s=9);let f=new Cpe;return e.state=f,f.strm=e,f.status=ry,f.wrap=d,f.gzhead=null,f.w_bits=s,f.w_size=1<<f.w_bits,f.w_mask=f.w_size-1,f.hash_bits=o+7,f.hash_size=1<<f.hash_bits,f.hash_mask=f.hash_size-1,f.hash_shift=~~((f.hash_bits+3-1)/3),f.window=new Uint8Array(2*f.w_size),f.head=new Uint16Array(f.hash_size),f.prev=new Uint16Array(f.w_size),f.lit_bufsize=1<<o+6,f.pending_buf_size=4*f.lit_bufsize,f.pending_buf=new Uint8Array(f.pending_buf_size),f.sym_buf=f.lit_bufsize,f.sym_end=3*(f.lit_bufsize-1),f.level=t,f.strategy=u,f.method=n,VH(e)};var Rpe=(e,t)=>{if(c0(e)||t>kH||t<0)return e?ng(e,sd):sd;let n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===s0&&t!==Qc)return ng(e,e.avail_out===0?tx:sd);let s=n.last_flush;if(n.last_flush=t,n.pending!==0){if(tc(e),e.avail_out===0)return n.last_flush=-1,pa}else if(e.avail_in===0&&xH(t)<=xH(s)&&t!==Qc)return ng(e,tx);if(n.status===s0&&e.avail_in!==0)return ng(e,tx);if(n.status===ry&&n.wrap===0&&(n.status=tg),n.status===ry){let o=RI+(n.w_bits-8<<4)<<8,u=-1;if(u=n.strategy>=CI||n.level<2?0:n.level<6?1:n.level===6?2:3,o|=u<<6,n.strstart!==0&&(o|=32),o+=31-o%31,a0(n,o),n.strstart!==0&&(a0(n,e.adler>>>16),a0(n,65535&e.adler)),e.adler=1,n.status=tg,tc(e),n.pending!==0)return n.last_flush=-1,pa}if(n.status===57){if(e.adler=0,xr(n,31),xr(n,139),xr(n,8),n.gzhead)xr(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),xr(n,255&n.gzhead.time),xr(n,n.gzhead.time>>8&255),xr(n,n.gzhead.time>>16&255),xr(n,n.gzhead.time>>24&255),xr(n,n.level===9?2:n.strategy>=CI||n.level<2?4:0),xr(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(xr(n,255&n.gzhead.extra.length),xr(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=qs(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(xr(n,0),xr(n,0),xr(n,0),xr(n,0),xr(n,0),xr(n,n.level===9?2:n.strategy>=CI||n.level<2?4:0),xr(n,3),n.status=tg,tc(e),n.pending!==0)return n.last_flush=-1,pa}if(n.status===69){if(n.gzhead.extra){let o=n.pending,u=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+u>n.pending_buf_size;){let f=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+f),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>o&&(e.adler=qs(e.adler,n.pending_buf,n.pending-o,o)),n.gzindex+=f,tc(e),n.pending!==0)return n.last_flush=-1,pa;o=0,u-=f}let d=new Uint8Array(n.gzhead.extra);n.pending_buf.set(d.subarray(n.gzindex,n.gzindex+u),n.pending),n.pending+=u,n.gzhead.hcrc&&n.pending>o&&(e.adler=qs(e.adler,n.pending_buf,n.pending-o,o)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let o,u=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>u&&(e.adler=qs(e.adler,n.pending_buf,n.pending-u,u)),tc(e),n.pending!==0)return n.last_flush=-1,pa;u=0}o=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,xr(n,o)}while(o!==0);n.gzhead.hcrc&&n.pending>u&&(e.adler=qs(e.adler,n.pending_buf,n.pending-u,u)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let o,u=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>u&&(e.adler=qs(e.adler,n.pending_buf,n.pending-u,u)),tc(e),n.pending!==0)return n.last_flush=-1,pa;u=0}o=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,xr(n,o)}while(o!==0);n.gzhead.hcrc&&n.pending>u&&(e.adler=qs(e.adler,n.pending_buf,n.pending-u,u))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(tc(e),n.pending!==0))return n.last_flush=-1,pa;xr(n,255&e.adler),xr(n,e.adler>>8&255),e.adler=0}if(n.status=tg,tc(e),n.pending!==0)return n.last_flush=-1,pa}if(e.avail_in!==0||n.lookahead!==0||t!==Np&&n.status!==s0){let o=n.level===0?MH(n,t):n.strategy===CI?((u,d)=>{let f;for(;;){if(u.lookahead===0&&(iy(u),u.lookahead===0)){if(d===Np)return 1;break}if(u.match_length=0,f=Op(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,f&&(nc(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,d===Qc?(nc(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(nc(u,!1),u.strm.avail_out===0)?1:2})(n,t):n.strategy===mpe?((u,d)=>{let f,g,y,v,R=u.window;for(;;){if(u.lookahead<=eg){if(iy(u),u.lookahead<=eg&&d===Np)return 1;if(u.lookahead===0)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(y=u.strstart-1,g=R[y],g===R[++y]&&g===R[++y]&&g===R[++y])){v=u.strstart+eg;do;while(g===R[++y]&&g===R[++y]&&g===R[++y]&&g===R[++y]&&g===R[++y]&&g===R[++y]&&g===R[++y]&&g===R[++y]&&y<v);u.match_length=eg-(v-y),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(f=Op(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(f=Op(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),f&&(nc(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,d===Qc?(nc(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(nc(u,!1),u.strm.avail_out===0)?1:2})(n,t):o0[n.level].func(n,t);if(o!==3&&o!==4||(n.status=s0),o===1||o===3)return e.avail_out===0&&(n.last_flush=-1),pa;if(o===2&&(t===upe?lpe(n):t!==kH&&(ex(n,0,0,!1),t===dpe&&(Pp(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),tc(e),e.avail_out===0))return n.last_flush=-1,pa}return t!==Qc?pa:n.wrap<=0?DH:(n.wrap===2?(xr(n,255&e.adler),xr(n,e.adler>>8&255),xr(n,e.adler>>16&255),xr(n,e.adler>>24&255),xr(n,255&e.total_in),xr(n,e.total_in>>8&255),xr(n,e.total_in>>16&255),xr(n,e.total_in>>24&255)):(a0(n,e.adler>>>16),a0(n,65535&e.adler)),tc(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?pa:DH)},bpe=(e,t)=>{let n=t.length;if(c0(e))return sd;let s=e.state,o=s.wrap;if(o===2||o===1&&s.status!==ry||s.lookahead)return sd;if(o===1&&(e.adler=i0(e.adler,t,n,0)),s.wrap=0,n>=s.w_size){o===0&&(Pp(s.head),s.strstart=0,s.block_start=0,s.insert=0);let g=new Uint8Array(s.w_size);g.set(t.subarray(n-s.w_size,n),0),t=g,n=s.w_size}let u=e.avail_in,d=e.next_in,f=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,iy(s);s.lookahead>=3;){let g=s.strstart,y=s.lookahead-2;do s.ins_h=kp(s,s.ins_h,s.window[g+3-1]),s.prev[g&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=g,g++;while(--y);s.strstart=g,s.lookahead=2,iy(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,e.next_in=d,e.input=f,e.avail_in=u,s.wrap=o,pa},l0={deflateInit:(e,t)=>FH(e,t,RI,15,8,_pe),deflateInit2:FH,deflateReset:VH,deflateResetKeep:UH,deflateSetHeader:(e,t)=>c0(e)||e.state.wrap!==2?sd:(e.state.gzhead=t,pa),deflate:Rpe,deflateEnd:e=>{if(c0(e))return sd;let t=e.state.status;return e.state=null,t===tg?ng(e,hpe):pa},deflateSetDictionary:bpe,deflateInfo:"pako deflate (from Nodeca project)"};let Ipe=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var bI={assign:function(e){let t=Array.prototype.slice.call(arguments,1);for(;t.length;){let n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(let s in n)Ipe(n,s)&&(e[s]=n[s])}}return e},flattenChunks:e=>{let t=0;for(let s=0,o=e.length;s<o;s++)t+=e[s].length;let n=new Uint8Array(t);for(let s=0,o=0,u=e.length;s<u;s++){let d=e[s];n.set(d,o),o+=d.length}return n}};let jH=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{jH=!1}let u0=new Uint8Array(256);for(let e=0;e<256;e++)u0[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;u0[254]=u0[254]=1;var d0={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,s,o,u,d=e.length,f=0;for(o=0;o<d;o++)n=e.charCodeAt(o),(64512&n)==55296&&o+1<d&&(s=e.charCodeAt(o+1),(64512&s)==56320&&(n=65536+(n-55296<<10)+(s-56320),o++)),f+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(f),u=0,o=0;u<f;o++)n=e.charCodeAt(o),(64512&n)==55296&&o+1<d&&(s=e.charCodeAt(o+1),(64512&s)==56320&&(n=65536+(n-55296<<10)+(s-56320),o++)),n<128?t[u++]=n:n<2048?(t[u++]=192|n>>>6,t[u++]=128|63&n):n<65536?(t[u++]=224|n>>>12,t[u++]=128|n>>>6&63,t[u++]=128|63&n):(t[u++]=240|n>>>18,t[u++]=128|n>>>12&63,t[u++]=128|n>>>6&63,t[u++]=128|63&n);return t},buf2string:(e,t)=>{let n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let s,o,u=new Array(2*n);for(o=0,s=0;s<n;){let d=e[s++];if(d<128){u[o++]=d;continue}let f=u0[d];if(f>4)u[o++]=65533,s+=f-1;else{for(d&=f===2?31:f===3?15:7;f>1&&s<n;)d=d<<6|63&e[s++],f--;f>1?u[o++]=65533:d<65536?u[o++]=d:(d-=65536,u[o++]=55296|d>>10&1023,u[o++]=56320|1023&d)}}return((d,f)=>{if(f<65534&&d.subarray&&jH)return String.fromCharCode.apply(null,d.length===f?d:d.subarray(0,f));let g="";for(let y=0;y<f;y++)g+=String.fromCharCode(d[y]);return g})(u,o)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(192&e[n])==128;)n--;return n<0||n===0?t:n+u0[e[n]]>t?n:t}},BH=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};let WH=Object.prototype.toString,{Z_NO_FLUSH:Ape,Z_SYNC_FLUSH:Ope,Z_FULL_FLUSH:Npe,Z_FINISH:Ppe,Z_OK:II,Z_STREAM_END:kpe,Z_DEFAULT_COMPRESSION:Dpe,Z_DEFAULT_STRATEGY:xpe,Z_DEFLATED:Lpe}=wI;function AI(e){this.options=bI.assign({level:Dpe,method:Lpe,chunkSize:16384,windowBits:15,memLevel:8,strategy:xpe},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new BH,this.strm.avail_out=0;let n=l0.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==II)throw new Error(Zm[n]);if(t.header&&l0.deflateSetHeader(this.strm,t.header),t.dictionary){let s;if(s=typeof t.dictionary=="string"?d0.string2buf(t.dictionary):WH.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,n=l0.deflateSetDictionary(this.strm,s),n!==II)throw new Error(Zm[n]);this._dict_set=!0}}function GH(e,t){let n=new AI(t);if(n.push(e,!0),n.err)throw n.msg||Zm[n.err];return n.result}AI.prototype.push=function(e,t){let n=this.strm,s=this.options.chunkSize,o,u;if(this.ended)return!1;for(u=t===~~t?t:t===!0?Ppe:Ape,typeof e=="string"?n.input=d0.string2buf(e):WH.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(s),n.next_out=0,n.avail_out=s),(u===Ope||u===Npe)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(o=l0.deflate(n,u),o===kpe)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),o=l0.deflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===II;if(n.avail_out!==0){if(u>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},AI.prototype.onData=function(e){this.chunks.push(e)},AI.prototype.onEnd=function(e){e===II&&(this.result=bI.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Mpe={deflate:GH,deflateRaw:function(e,t){return(t=t||{}).raw=!0,GH(e,t)}};let OI=16209;var Upe=function(e,t){let n,s,o,u,d,f,g,y,v,R,b,A,F,M,j,K,q,Q,se,oe,ne,de,we,Oe,Qe=e.state;n=e.next_in,we=e.input,s=n+(e.avail_in-5),o=e.next_out,Oe=e.output,u=o-(t-e.avail_out),d=o+(e.avail_out-257),f=Qe.dmax,g=Qe.wsize,y=Qe.whave,v=Qe.wnext,R=Qe.window,b=Qe.hold,A=Qe.bits,F=Qe.lencode,M=Qe.distcode,j=(1<<Qe.lenbits)-1,K=(1<<Qe.distbits)-1;e:do{A<15&&(b+=we[n++]<<A,A+=8,b+=we[n++]<<A,A+=8),q=F[b&j];t:for(;;){if(Q=q>>>24,b>>>=Q,A-=Q,Q=q>>>16&255,Q===0)Oe[o++]=65535&q;else{if(!(16&Q)){if(!(64&Q)){q=F[(65535&q)+(b&(1<<Q)-1)];continue t}if(32&Q){Qe.mode=16191;break e}e.msg="invalid literal/length code",Qe.mode=OI;break e}se=65535&q,Q&=15,Q&&(A<Q&&(b+=we[n++]<<A,A+=8),se+=b&(1<<Q)-1,b>>>=Q,A-=Q),A<15&&(b+=we[n++]<<A,A+=8,b+=we[n++]<<A,A+=8),q=M[b&K];n:for(;;){if(Q=q>>>24,b>>>=Q,A-=Q,Q=q>>>16&255,!(16&Q)){if(!(64&Q)){q=M[(65535&q)+(b&(1<<Q)-1)];continue n}e.msg="invalid distance code",Qe.mode=OI;break e}if(oe=65535&q,Q&=15,A<Q&&(b+=we[n++]<<A,A+=8,A<Q&&(b+=we[n++]<<A,A+=8)),oe+=b&(1<<Q)-1,oe>f){e.msg="invalid distance too far back",Qe.mode=OI;break e}if(b>>>=Q,A-=Q,Q=o-u,oe>Q){if(Q=oe-Q,Q>y&&Qe.sane){e.msg="invalid distance too far back",Qe.mode=OI;break e}if(ne=0,de=R,v===0){if(ne+=g-Q,Q<se){se-=Q;do Oe[o++]=R[ne++];while(--Q);ne=o-oe,de=Oe}}else if(v<Q){if(ne+=g+v-Q,Q-=v,Q<se){se-=Q;do Oe[o++]=R[ne++];while(--Q);if(ne=0,v<se){Q=v,se-=Q;do Oe[o++]=R[ne++];while(--Q);ne=o-oe,de=Oe}}}else if(ne+=v-Q,Q<se){se-=Q;do Oe[o++]=R[ne++];while(--Q);ne=o-oe,de=Oe}for(;se>2;)Oe[o++]=de[ne++],Oe[o++]=de[ne++],Oe[o++]=de[ne++],se-=3;se&&(Oe[o++]=de[ne++],se>1&&(Oe[o++]=de[ne++]))}else{ne=o-oe;do Oe[o++]=Oe[ne++],Oe[o++]=Oe[ne++],Oe[o++]=Oe[ne++],se-=3;while(se>2);se&&(Oe[o++]=Oe[ne++],se>1&&(Oe[o++]=Oe[ne++]))}break}}break}}while(n<s&&o<d);se=A>>3,n-=se,A-=se<<3,b&=(1<<A)-1,e.next_in=n,e.next_out=o,e.avail_in=n<s?s-n+5:5-(n-s),e.avail_out=o<d?d-o+257:257-(o-d),Qe.hold=b,Qe.bits=A};let NI=15,Vpe=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Fpe=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),jpe=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Bpe=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var h0=(e,t,n,s,o,u,d,f)=>{let g=f.bits,y,v,R,b,A,F,M=0,j=0,K=0,q=0,Q=0,se=0,oe=0,ne=0,de=0,we=0,Oe=null,Qe=new Uint16Array(16),at=new Uint16Array(16),Xt,Lt,jt,En=null;for(M=0;M<=NI;M++)Qe[M]=0;for(j=0;j<s;j++)Qe[t[n+j]]++;for(Q=g,q=NI;q>=1&&Qe[q]===0;q--);if(Q>q&&(Q=q),q===0)return o[u++]=20971520,o[u++]=20971520,f.bits=1,0;for(K=1;K<q&&Qe[K]===0;K++);for(Q<K&&(Q=K),ne=1,M=1;M<=NI;M++)if(ne<<=1,ne-=Qe[M],ne<0)return-1;if(ne>0&&(e===0||q!==1))return-1;for(at[1]=0,M=1;M<NI;M++)at[M+1]=at[M]+Qe[M];for(j=0;j<s;j++)t[n+j]!==0&&(d[at[t[n+j]]++]=j);if(e===0?(Oe=En=d,F=20):e===1?(Oe=Vpe,En=Fpe,F=257):(Oe=jpe,En=Bpe,F=0),we=0,j=0,M=K,A=u,se=Q,oe=0,R=-1,de=1<<Q,b=de-1,e===1&&de>852||e===2&&de>592)return 1;for(;;){Xt=M-oe,d[j]+1<F?(Lt=0,jt=d[j]):d[j]>=F?(Lt=En[d[j]-F],jt=Oe[d[j]-F]):(Lt=96,jt=0),y=1<<M-oe,v=1<<se,K=v;do v-=y,o[A+(we>>oe)+v]=Xt<<24|Lt<<16|jt|0;while(v!==0);for(y=1<<M-1;we&y;)y>>=1;if(y!==0?(we&=y-1,we+=y):we=0,j++,--Qe[M]==0){if(M===q)break;M=t[n+d[j]]}if(M>Q&&(we&b)!==R){for(oe===0&&(oe=Q),A+=K,se=M-oe,ne=1<<se;se+oe<q&&(ne-=Qe[se+oe],!(ne<=0));)se++,ne<<=1;if(de+=1<<se,e===1&&de>852||e===2&&de>592)return 1;R=we&b,o[R]=Q<<24|se<<16|A-u|0}}return we!==0&&(o[A+we]=M-oe<<24|64<<16|0),f.bits=Q,0};let{Z_FINISH:HH,Z_BLOCK:Wpe,Z_TREES:PI,Z_OK:rg,Z_STREAM_END:Gpe,Z_NEED_DICT:Hpe,Z_STREAM_ERROR:Zc,Z_DATA_ERROR:zH,Z_MEM_ERROR:KH,Z_BUF_ERROR:zpe,Z_DEFLATED:YH}=wI,kI=16180,DI=16190,ah=16191,sx=16192,ax=16194,xI=16199,LI=16200,ox=16206,Mi=16209,qH=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Kpe(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}let ig=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.mode<kI||t.mode>16211?1:0},XH=e=>{if(ig(e))return Zc;let t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=kI,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,rg},JH=e=>{if(ig(e))return Zc;let t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,XH(e)},$H=(e,t)=>{let n;if(ig(e))return Zc;let s=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Zc:(s.window!==null&&s.wbits!==t&&(s.window=null),s.wrap=n,s.wbits=t,JH(e))},QH=(e,t)=>{if(!e)return Zc;let n=new Kpe;e.state=n,n.strm=e,n.window=null,n.mode=kI;let s=$H(e,t);return s!==rg&&(e.state=null),s},cx,lx,ZH=!0,Ype=e=>{if(ZH){cx=new Int32Array(512),lx=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(h0(1,e.lens,0,288,cx,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;h0(2,e.lens,0,32,lx,0,e.work,{bits:5}),ZH=!1}e.lencode=cx,e.lenbits=9,e.distcode=lx,e.distbits=5},ez=(e,t,n,s)=>{let o,u=e.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),s>=u.wsize?(u.window.set(t.subarray(n-u.wsize,n),0),u.wnext=0,u.whave=u.wsize):(o=u.wsize-u.wnext,o>s&&(o=s),u.window.set(t.subarray(n-s,n-s+o),u.wnext),(s-=o)?(u.window.set(t.subarray(n-s,n),0),u.wnext=s,u.whave=u.wsize):(u.wnext+=o,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=o))),0};var qpe=(e,t)=>{let n,s,o,u,d,f,g,y,v,R,b,A,F,M,j,K,q,Q,se,oe,ne,de,we=0,Oe=new Uint8Array(4),Qe,at,Xt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(ig(e)||!e.output||!e.input&&e.avail_in!==0)return Zc;n=e.state,n.mode===ah&&(n.mode=sx),d=e.next_out,o=e.output,g=e.avail_out,u=e.next_in,s=e.input,f=e.avail_in,y=n.hold,v=n.bits,R=f,b=g,de=rg;e:for(;;)switch(n.mode){case kI:if(n.wrap===0){n.mode=sx;break}for(;v<16;){if(f===0)break e;f--,y+=s[u++]<<v,v+=8}if(2&n.wrap&&y===35615){n.wbits===0&&(n.wbits=15),n.check=0,Oe[0]=255&y,Oe[1]=y>>>8&255,n.check=qs(n.check,Oe,2,0),y=0,v=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&y)<<8)+(y>>8))%31){e.msg="incorrect header check",n.mode=Mi;break}if((15&y)!==YH){e.msg="unknown compression method",n.mode=Mi;break}if(y>>>=4,v-=4,ne=8+(15&y),n.wbits===0&&(n.wbits=ne),ne>15||ne>n.wbits){e.msg="invalid window size",n.mode=Mi;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&y?16189:ah,y=0,v=0;break;case 16181:for(;v<16;){if(f===0)break e;f--,y+=s[u++]<<v,v+=8}if(n.flags=y,(255&Ds(n))!==YH){e.msg="unknown compression method",n.mode=Mi;break}if(57344&Ds(n)){e.msg="unknown header flags set",n.mode=Mi;break}n.head&&(n.head.text=y>>8&1),512&Ds(n)&&4&n.wrap&&(Oe[0]=255&y,Oe[1]=y>>>8&255,n.check=qs(n.check,Oe,2,0)),y=0,v=0,n.mode=16182;case 16182:for(;v<32;){if(f===0)break e;f--,y+=s[u++]<<v,v+=8}n.head&&(n.head.time=y),512&Ds(n)&&4&n.wrap&&(Oe[0]=255&y,Oe[1]=y>>>8&255,Oe[2]=y>>>16&255,Oe[3]=y>>>24&255,n.check=qs(n.check,Oe,4,0)),y=0,v=0,n.mode=16183;case 16183:for(;v<16;){if(f===0)break e;f--,y+=s[u++]<<v,v+=8}n.head&&(n.head.xflags=255&y,n.head.os=y>>8),512&Ds(n)&&4&n.wrap&&(Oe[0]=255&y,Oe[1]=y>>>8&255,n.check=qs(n.check,Oe,2,0)),y=0,v=0,n.mode=16184;case 16184:if(1024&Ds(n)){for(;v<16;){if(f===0)break e;f--,y+=s[u++]<<v,v+=8}n.length=y,n.head&&(n.head.extra_len=y),512&Ds(n)&&4&n.wrap&&(Oe[0]=255&y,Oe[1]=y>>>8&255,n.check=qs(n.check,Oe,2,0)),y=0,v=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&Ds(n)&&(A=n.length,A>f&&(A=f),A&&(n.head&&(ne=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(s.subarray(u,u+A),ne)),512&Ds(n)&&4&n.wrap&&(n.check=qs(n.check,s,A,u)),f-=A,u+=A,n.length-=A),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&Ds(n)){if(f===0)break e;A=0;do ne=s[u+A++],n.head&&ne&&n.length<65536&&(n.head.name+=String.fromCharCode(ne));while(ne&&A<f);if(512&Ds(n)&&4&n.wrap&&(n.check=qs(n.check,s,A,u)),f-=A,u+=A,ne)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&Ds(n)){if(f===0)break e;A=0;do ne=s[u+A++],n.head&&ne&&n.length<65536&&(n.head.comment+=String.fromCharCode(ne));while(ne&&A<f);if(512&Ds(n)&&4&n.wrap&&(n.check=qs(n.check,s,A,u)),f-=A,u+=A,ne)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&Ds(n)){for(;v<16;){if(f===0)break e;f--,y+=s[u++]<<v,v+=8}if(4&n.wrap&&y!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Mi;break}y=0,v=0}n.head&&(n.head.hcrc=Ds(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=ah;break;case 16189:for(;v<32;){if(f===0)break e;f--,y+=s[u++]<<v,v+=8}e.adler=n.check=qH(y),y=0,v=0,n.mode=DI;case DI:if(n.havedict===0)return e.next_out=d,e.avail_out=g,e.next_in=u,e.avail_in=f,n.hold=y,n.bits=v,Hpe;e.adler=n.check=1,n.mode=ah;case ah:if(t===Wpe||t===PI)break e;case sx:if(n.last){y>>>=7&v,v-=7&v,n.mode=ox;break}for(;v<3;){if(f===0)break e;f--,y+=s[u++]<<v,v+=8}switch(n.last=1&y,y>>>=1,v-=1,3&y){case 0:n.mode=16193;break;case 1:if(Ype(n),n.mode=xI,t===PI){y>>>=2,v-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=Mi}y>>>=2,v-=2;break;case 16193:for(y>>>=7&v,v-=7&v;v<32;){if(f===0)break e;f--,y+=s[u++]<<v,v+=8}if((65535&y)!=(y>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Mi;break}if(n.length=65535&y,y=0,v=0,n.mode=ax,t===PI)break e;case ax:n.mode=16195;case 16195:if(A=n.length,A){if(A>f&&(A=f),A>g&&(A=g),A===0)break e;o.set(s.subarray(u,u+A),d),f-=A,u+=A,g-=A,d+=A,n.length-=A;break}n.mode=ah;break;case 16196:for(;v<14;){if(f===0)break e;f--,y+=s[u++]<<v,v+=8}if(n.nlen=257+(31&y),y>>>=5,v-=5,n.ndist=1+(31&y),y>>>=5,v-=5,n.ncode=4+(15&y),y>>>=4,v-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Mi;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;v<3;){if(f===0)break e;f--,y+=s[u++]<<v,v+=8}n.lens[Xt[n.have++]]=7&y,y>>>=3,v-=3}for(;n.have<19;)n.lens[Xt[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Qe={bits:n.lenbits},de=h0(0,n.lens,0,19,n.lencode,0,n.work,Qe),n.lenbits=Qe.bits,de){e.msg="invalid code lengths set",n.mode=Mi;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;we=n.lencode[y&(1<<n.lenbits)-1],j=we>>>24,K=we>>>16&255,q=65535&we,!(j<=v);){if(f===0)break e;f--,y+=s[u++]<<v,v+=8}if(q<16)y>>>=j,v-=j,n.lens[n.have++]=q;else{if(q===16){for(at=j+2;v<at;){if(f===0)break e;f--,y+=s[u++]<<v,v+=8}if(y>>>=j,v-=j,n.have===0){e.msg="invalid bit length repeat",n.mode=Mi;break}ne=n.lens[n.have-1],A=3+(3&y),y>>>=2,v-=2}else if(q===17){for(at=j+3;v<at;){if(f===0)break e;f--,y+=s[u++]<<v,v+=8}y>>>=j,v-=j,ne=0,A=3+(7&y),y>>>=3,v-=3}else{for(at=j+7;v<at;){if(f===0)break e;f--,y+=s[u++]<<v,v+=8}y>>>=j,v-=j,ne=0,A=11+(127&y),y>>>=7,v-=7}if(n.have+A>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Mi;break}for(;A--;)n.lens[n.have++]=ne}}if(n.mode===Mi)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=Mi;break}if(n.lenbits=9,Qe={bits:n.lenbits},de=h0(1,n.lens,0,n.nlen,n.lencode,0,n.work,Qe),n.lenbits=Qe.bits,de){e.msg="invalid literal/lengths set",n.mode=Mi;break}if(n.distbits=6,n.distcode=n.distdyn,Qe={bits:n.distbits},de=h0(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Qe),n.distbits=Qe.bits,de){e.msg="invalid distances set",n.mode=Mi;break}if(n.mode=xI,t===PI)break e;case xI:n.mode=LI;case LI:if(f>=6&&g>=258){e.next_out=d,e.avail_out=g,e.next_in=u,e.avail_in=f,n.hold=y,n.bits=v,Upe(e,b),d=e.next_out,o=e.output,g=e.avail_out,u=e.next_in,s=e.input,f=e.avail_in,y=n.hold,v=n.bits,n.mode===ah&&(n.back=-1);break}for(n.back=0;we=n.lencode[y&(1<<n.lenbits)-1],j=we>>>24,K=we>>>16&255,q=65535&we,!(j<=v);){if(f===0)break e;f--,y+=s[u++]<<v,v+=8}if(K&&!(240&K)){for(Q=j,se=K,oe=q;we=n.lencode[oe+((y&(1<<Q+se)-1)>>Q)],j=we>>>24,K=we>>>16&255,q=65535&we,!(Q+j<=v);){if(f===0)break e;f--,y+=s[u++]<<v,v+=8}y>>>=Q,v-=Q,n.back+=Q}if(y>>>=j,v-=j,n.back+=j,n.length=q,K===0){n.mode=16205;break}if(32&K){n.back=-1,n.mode=ah;break}if(64&K){e.msg="invalid literal/length code",n.mode=Mi;break}n.extra=15&K,n.mode=16201;case 16201:if(n.extra){for(at=n.extra;v<at;){if(f===0)break e;f--,y+=s[u++]<<v,v+=8}n.length+=y&(1<<n.extra)-1,y>>>=n.extra,v-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;we=n.distcode[y&(1<<n.distbits)-1],j=we>>>24,K=we>>>16&255,q=65535&we,!(j<=v);){if(f===0)break e;f--,y+=s[u++]<<v,v+=8}if(!(240&K)){for(Q=j,se=K,oe=q;we=n.distcode[oe+((y&(1<<Q+se)-1)>>Q)],j=we>>>24,K=we>>>16&255,q=65535&we,!(Q+j<=v);){if(f===0)break e;f--,y+=s[u++]<<v,v+=8}y>>>=Q,v-=Q,n.back+=Q}if(y>>>=j,v-=j,n.back+=j,64&K){e.msg="invalid distance code",n.mode=Mi;break}n.offset=q,n.extra=15&K,n.mode=16203;case 16203:if(n.extra){for(at=n.extra;v<at;){if(f===0)break e;f--,y+=s[u++]<<v,v+=8}n.offset+=y&(1<<n.extra)-1,y>>>=n.extra,v-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Mi;break}n.mode=16204;case 16204:if(g===0)break e;if(A=b-g,n.offset>A){if(A=n.offset-A,A>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Mi;break}A>n.wnext?(A-=n.wnext,F=n.wsize-A):F=n.wnext-A,A>n.length&&(A=n.length),M=n.window}else M=o,F=d-n.offset,A=n.length;A>g&&(A=g),g-=A,n.length-=A;do o[d++]=M[F++];while(--A);n.length===0&&(n.mode=LI);break;case 16205:if(g===0)break e;o[d++]=n.length,g--,n.mode=LI;break;case ox:if(n.wrap){for(;v<32;){if(f===0)break e;f--,y|=s[u++]<<v,v+=8}if(b-=g,e.total_out+=b,n.total+=b,4&n.wrap&&b&&(e.adler=n.check=Ds(n)?qs(n.check,o,b,d-b):i0(n.check,o,b,d-b)),b=g,4&n.wrap&&(Ds(n)?y:qH(y))!==n.check){e.msg="incorrect data check",n.mode=Mi;break}y=0,v=0}n.mode=16207;case 16207:if(n.wrap&&Ds(n)){for(;v<32;){if(f===0)break e;f--,y+=s[u++]<<v,v+=8}if(4&n.wrap&&y!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Mi;break}y=0,v=0}n.mode=16208;case 16208:de=Gpe;break e;case Mi:de=zH;break e;case 16210:return KH;default:return Zc}return e.next_out=d,e.avail_out=g,e.next_in=u,e.avail_in=f,n.hold=y,n.bits=v,(n.wsize||b!==e.avail_out&&n.mode<Mi&&(n.mode<ox||t!==HH))&&ez(e,e.output,e.next_out,b-e.avail_out),R-=e.avail_in,b-=e.avail_out,e.total_in+=R,e.total_out+=b,n.total+=b,4&n.wrap&&b&&(e.adler=n.check=Ds(n)?qs(n.check,o,b,e.next_out-b):i0(n.check,o,b,e.next_out-b)),e.data_type=n.bits+(n.last?64:0)+(n.mode===ah?128:0)+(n.mode===xI||n.mode===ax?256:0),(R===0&&b===0||t===HH)&&de===rg&&(de=zpe),de},oh={inflateReset:JH,inflateReset2:$H,inflateResetKeep:XH,inflateInit:e=>QH(e,15),inflateInit2:QH,inflate:qpe,inflateEnd:e=>{if(ig(e))return Zc;let t=e.state;return t.window&&(t.window=null),e.state=null,rg},inflateGetHeader:(e,t)=>{if(ig(e))return Zc;let n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,rg):Zc},inflateSetDictionary:(e,t)=>{let n=t.length,s,o,u;return ig(e)?Zc:(s=e.state,s.wrap!==0&&s.mode!==DI?Zc:s.mode===DI&&(o=1,o=i0(o,t,n,0),o!==s.check)?zH:(u=ez(e,t,n,n),u?(s.mode=16210,KH):(s.havedict=1,rg)))},inflateInfo:"pako inflate (from Nodeca project)"},Xpe=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};let tz=Object.prototype.toString,{Z_NO_FLUSH:Jpe,Z_FINISH:$pe,Z_OK:p0,Z_STREAM_END:ux,Z_NEED_DICT:dx,Z_STREAM_ERROR:Qpe,Z_DATA_ERROR:nz,Z_MEM_ERROR:Zpe}=wI;function MI(e){this.options=bI.assign({chunkSize:65536,windowBits:15,to:""},e||{});let t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new BH,this.strm.avail_out=0;let n=oh.inflateInit2(this.strm,t.windowBits);if(n!==p0)throw new Error(Zm[n]);if(this.header=new Xpe,oh.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=d0.string2buf(t.dictionary):tz.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=oh.inflateSetDictionary(this.strm,t.dictionary),n!==p0)))throw new Error(Zm[n])}function rz(e,t){let n=new MI(t);if(n.push(e),n.err)throw n.msg||Zm[n.err];return n.result}MI.prototype.push=function(e,t){let n=this.strm,s=this.options.chunkSize,o=this.options.dictionary,u,d,f;if(this.ended)return!1;for(d=t===~~t?t:t===!0?$pe:Jpe,tz.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(s),n.next_out=0,n.avail_out=s),u=oh.inflate(n,d),u===dx&&o&&(u=oh.inflateSetDictionary(n,o),u===p0?u=oh.inflate(n,d):u===nz&&(u=dx));n.avail_in>0&&u===ux&&n.state.wrap>0&&e[n.next_in]!==0;)oh.inflateReset(n),u=oh.inflate(n,d);switch(u){case Qpe:case nz:case dx:case Zpe:return this.onEnd(u),this.ended=!0,!1}if(f=n.avail_out,n.next_out&&(n.avail_out===0||u===ux))if(this.options.to==="string"){let g=d0.utf8border(n.output,n.next_out),y=n.next_out-g,v=d0.buf2string(n.output,g);n.next_out=y,n.avail_out=s-y,y&&n.output.set(n.output.subarray(g,g+y),0),this.onData(v)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(u!==p0||f!==0){if(u===ux)return u=oh.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},MI.prototype.onData=function(e){this.chunks.push(e)},MI.prototype.onEnd=function(e){e===p0&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=bI.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var efe={inflate:rz,inflateRaw:function(e,t){return(t=t||{}).raw=!0,rz(e,t)}};let{deflate:tfe,deflateRaw:nfe}=Mpe,{inflate:rfe,inflateRaw:ife}=efe;var sfe=tfe,afe=nfe,ofe=rfe,cfe=ife,iz=(function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e})(iz||{});class lfe{constructor(){V(this,"_sequence",0),V(this,"_startTime",Date.now()),V(this,"isUseOneByte",!0)}get startTime(){let t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){let n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){let f=new Uint8Array(4);f.set([1,0,0,0]);let g={id:0,length:4,data:f.buffer},y={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[g]};n.commonPacketHeader.extension=1,n.extension=y,n.payload=this.compress(t),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;z("SHOW_DATASTREAM2_LOG")&&k.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));let s=new ArrayBuffer(n.commonPacketHeader.length),o=new Uint8Array(s),u=new DataView(s),d=0;if(u.setUint16(d,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),d+=2,u.setUint32(d,n.commonPacketHeader.sequence,!0),d+=4,u.setUint16(d,n.commonStreamHeader,!0),d+=2,n.extension){let f=this.serializeExtension(n.extension);o.set(new Uint8Array(f),d),d+=f.byteLength}if(o.set(new Uint8Array(n.payload),d),d+=n.payload.byteLength,d!==n.commonPacketHeader.length)throw Error("serialize error!");return s}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);let n=new DataView(t),s=0,o=n.getUint16(s,!0);s+=2;let u={length:16383&o,reserved:(16384&o)>>14,extension:(32768&o)>>15,sequence:n.getUint16(s+2,!0)<<16|n.getUint16(s,!0)},d,f;if(s+=4,z("SHOW_DATASTREAM2_LOG")&&k.debug("receive data header: ".concat(JSON.stringify(u))),n.getUint16(s,!0),s+=2,u.extension){f=this.deserializeExtension(t.slice(s)),s+=2+f.length,d=t.slice(s);let g=!1;if(f.datas.length>0){let y=f.datas.find(v=>v.id===0);y&&(g=(1&new DataView(y.data).getUint32(0,!0))==1)}d=g?this.decompress(d):d}else d=t.slice(8);return d}serializeExtension(t){let{profile:n,length:s,datas:o}=t,u=new ArrayBuffer(s+2),d=new Uint8Array(u),f=new DataView(u),g=0;if(f.setUint8(g++,n),f.setUint8(g++,s),o.forEach(y=>{n?(f.setUint8(g++,y.id),f.setUint8(g++,y.length),d.set(new Uint8Array(y.data),g),g+=y.data.byteLength):(f.setUint8(g++,y.id|y.length<<4),d.set(new Uint8Array(y.data),g),g+=y.data.byteLength)}),g!==s+2)throw Error("serialize extension error, is ".concat(g,"!==").concat(s+2));return u}deserializeExtension(t){let n=new DataView(t),s=0,o=n.getUint8(s);s++;let u=n.getUint8(s);s++;let d=o===iz.TWO_BYTE,f=[],g=new DataView(t,2),y=0;for(;y<u;){let v=0,R=0,b=new ArrayBuffer(0);d?(v=g.getUint8(y),y++,R=g.getUint8(y),y++):(v=15&g.getUint8(y),R=g.getUint8(y)>>4,y++),R>0&&(b=g.buffer.slice(y+2,y+2+R),y+=b.byteLength),f.push({id:v,length:R,data:b})}if(y!==u)throw Error("parse error");return{profile:o,length:u,datas:f}}decompress(t){return ofe(new Uint8Array(t))}compress(t){return sfe(new Uint8Array(t))}}let ufe={name:"DataStream",create:(e,t)=>{let n=t?new pde(e):new fde(e);return n.useDataStream(new lfe),n}};class dfe extends dr{constructor(t,n,s){super(),V(this,"ws",void 0),V(this,"requestId",1),V(this,"heartBeatTimer",void 0),V(this,"joinInfo",void 0),V(this,"clientId",void 0),V(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),V(this,"onClose",o=>{this.emit("close"),this.dispose()}),V(this,"onMessage",o=>{let u=JSON.parse(o.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)}),this.joinInfo=t,this.clientId=n,this.ws=new UT("cross-channel-".concat(this.clientId),s),this.ws.on(Ot.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Ot.CONNECTED,this.onOpen),this.ws.on(Ot.ON_MESSAGE,this.onMessage),this.ws.on(Ot.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){let n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new We((n,s)=>{let o=window.setTimeout(()=>{s(new he(Y.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,u=>{window.clearTimeout(o),u.state&&u.state!==0?s(new he(Y.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(o),s(new he(Y.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new he(Y.WS_DISCONNECT);let n=()=>new We((d,f)=>{this.ws.once(Ot.CLOSED,()=>f(new he(Y.WS_ABORT))),this.ws.once(Ot.CONNECTED,d)});this.ws.state!=="connected"&&await n();let s=this.sendMessage(t),o=new We((d,f)=>{let g=()=>{f(new he(Y.WS_ABORT))};this.ws.once(Ot.RECONNECTING,g),this.ws.once(Ot.CLOSED,g),this.once("req_".concat(s),d),Ci(3e3).then(()=>{this.removeAllListeners("req_".concat(s)),this.ws.off(Ot.RECONNECTING,g),this.ws.off(Ot.CLOSED,g),f(new he(Y.TIMEOUT,"cross channel ws request timeout"))})}),u=await o;if(!u||u.code!==200)throw new he(Y.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(t){this.ws.removeAllListeners(Ot.REQUEST_NEW_URLS),this.ws.on(Ot.REQUEST_NEW_URLS,n=>{n(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){let n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class hfe extends dr{set state(t){t!==this._state&&(t!==Ia.RELAY_STATE_FAILURE&&(this.errorCode=WE.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,s,o,u){super(),V(this,"joinInfo",void 0),V(this,"sid",void 0),V(this,"clientId",void 0),V(this,"cancelToken",oa.CancelToken.source()),V(this,"workerToken",void 0),V(this,"requestId",0),V(this,"signal",void 0),V(this,"prevChannelMediaConfig",void 0),V(this,"httpRetryConfig",void 0),V(this,"_resolution",void 0),V(this,"_state",Ia.RELAY_STATE_IDLE),V(this,"errorCode",WE.RELAY_OK),V(this,"onStatus",d=>{k.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(d))),d&&d.command&&(d.command==="onAudioPacketReceived"&&this.emit("event",nh.PACKET_RECEIVED_AUDIO_FROM_SRC),d.command==="onVideoPacketReceived"&&this.emit("event",nh.PACKET_RECEIVED_VIDEO_FROM_SRC),d.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=WE.SRC_TOKEN_EXPIRED,this.state=Ia.RELAY_STATE_FAILURE),d.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=WE.DEST_TOKEN_EXPIRED,this.state=Ia.RELAY_STATE_FAILURE))}),V(this,"onReconnect",async()=>{k.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",nh.NETWORK_DISCONNECTED),this.state=Ia.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(d=>{this.state!==Ia.RELAY_STATE_IDLE&&(k.error("auto restart channel media relay failed",d.toString()),this.errorCode=WE.SERVER_CONNECTION_LOST,this.state=Ia.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=n,this.sid=xm(),this.signal=new dfe(this.joinInfo,this.clientId,s),this.httpRetryConfig=o,this._resolution=u}async startChannelMediaRelay(t){if(this.state!==Ia.RELAY_STATE_IDLE)throw new he(Y.INVALID_OPERATION);this.state=Ia.RELAY_STATE_CONNECTING,await this.connect(),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new he(Y.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new he(Y.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new he(Y.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==Ia.RELAY_STATE_RUNNING)throw new he(Y.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==Ia.RELAY_STATE_RUNNING)throw new he(Y.INVALID_OPERATION);let n=this.genMessage(ua.SetVideoProfile);await this.signal.request(n),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),k.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Ia.RELAY_STATE_IDLE,this.dispose()}dispose(){k.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=oa.CancelToken.source(),this.state=Ia.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){let t=await Ehe(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",nh.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){let n=this.genMessage(ua.SetSdkProfile,t);await this.signal.request(n),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));let s=this.genMessage(ua.SetSourceChannel,t);await this.signal.request(s),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",nh.PACKET_JOINED_SRC_CHANNEL),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));let o=this.genMessage(ua.SetSourceUserId,t);await this.signal.request(o),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));let u=this.genMessage(ua.SetDestChannel,t);await this.signal.request(u),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",nh.PACKET_JOINED_DEST_CHANNEL),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));let d=this.genMessage(ua.StartPacketTransfer,t);await this.signal.request(d),this.emit("event",nh.PACKET_SENT_TO_DEST_CHANNEL),this.state=Ia.RELAY_STATE_RUNNING,k.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){let n=this.genMessage(ua.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",nh.PACKET_UPDATE_DEST_CHANNEL),k.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){let t=this.genMessage(ua.StopPacketTransfer);await this.signal.request(t),k.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){let s=[],o=[],u=[];this.requestId+=1;let d={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Xo,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};d.sdkVersion==="4.24.2"&&(d.sdkVersion="0.0.1");let f=null,g=null;switch(t){case ua.SetSdkProfile:return d.clientRequest={command:"SetSdkProfile",type:"multi_channel"},d;case ua.SetSourceChannel:if(g=n&&n.getSrcChannelMediaInfo(),!g)throw new he(Y.UNEXPECTED_ERROR,"can not find source config");return d.clientRequest={command:"SetSourceChannel",uid:"0",channelName:g.channelName,token:g.token||this.joinInfo.appId},d;case ua.SetSourceUserId:if(g=n&&n.getSrcChannelMediaInfo(),!g)throw new he(Y.UNEXPECTED_ERROR,"can not find source config");return d.clientRequest={command:"SetSourceUserId",uid:g.uid+""},d;case ua.SetDestChannel:if(f=n&&n.getDestChannelMediaInfo(),!f)throw new he(Y.UNEXPECTED_ERROR,"can not find dest config");return f.forEach(y=>{s.push(y.channelName),o.push(y.uid+""),u.push(y.token||this.joinInfo.appId)}),d.clientRequest={command:"SetDestChannel",channelName:s,uid:o,token:u},d;case ua.StartPacketTransfer:return d.clientRequest={command:"StartPacketTransfer"},d;case ua.Reconnect:return d.clientRequest={command:"Reconnect"},d;case ua.StopPacketTransfer:return d.clientRequest={command:"StopPacketTransfer"},d;case ua.UpdateDestChannel:if(f=n&&n.getDestChannelMediaInfo(),!f)throw new he(Y.UNEXPECTED_ERROR,"can not find dest config");return f.forEach(y=>{s.push(y.channelName),o.push(y.uid+""),u.push(y.token||this.joinInfo.appId)}),d.clientRequest={command:"UpdateDestChannel",channelName:s,uid:o,token:u},d;case ua.SetVideoProfile:d.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return d}}let pfe={name:"ChannelMediaRelay",create:function(e){return new hfe(e.joinInfo,e.clientId,e.websocketRetryConfig||Kr,e.httpRetryConfig||Kr,e.resolution)}};function sz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function f0(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?sz(Object(n),!0).forEach(function(s){V(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sz(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}class ffe extends dr{constructor(t,n,s,o){super(),V(this,"spec",void 0),V(this,"token",void 0),V(this,"websocket",void 0),V(this,"pingpongTimer",void 0),V(this,"reconnectMode","retry"),V(this,"serviceMode",void 0),V(this,"reqId",0),V(this,"commandReqId",0),V(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),V(this,"handleWebSocketMessage",u=>{if(!u.data)return;let d=JSON.parse(u.data);d.requestId?this.emit("@".concat(d.requestId,"-").concat(d.sid),d):(tt.workerEvent(this.spec.sid,{actionType:"status",serverCode:d.code,workerType:this.serviceMode===th.TRANSCODE?1:2}),this.emit(vp.PUBLISH_STREAM_STATUS,d))}),this.spec=n,this.token=t,this.serviceMode=o,this.websocket=new UT("live-streaming",s),this.websocket.on(Ot.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Ot.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Ot.REQUEST_NEW_URLS,(u,d)=>{ei(this,vp.REQUEST_NEW_ADDRESS).then(u).catch(d)}),this.websocket.on(Ot.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,n,s,o){this.reqId+=1,t==="request"&&(this.commandReqId+=1);let u=this.commandReqId,d=this.reqId;if(!d||!this.websocket)throw new he(Y.UNEXPECTED_ERROR);let f=f0({command:t,sdkVersion:Xo==="4.24.2"?"0.0.1":Xo,seq:d,requestId:d,allocate:s,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new he(Y.WS_DISCONNECT);let g=()=>new We((b,A)=>{this.websocket.once(Ot.CLOSED,()=>A(new he(Y.WS_ABORT))),this.websocket.once(Ot.CONNECTED,b)});this.websocket.state!=="connected"&&await g(),f.clientRequest&&(f.clientRequest.workerToken=this.token);let y=new We((b,A)=>{let F=()=>{A(new he(Y.WS_ABORT))};this.websocket.once(Ot.RECONNECTING,F),this.websocket.once(Ot.CLOSED,F),this.once("@".concat(d,"-").concat(this.spec.sid),M=>{b(M)})});o&&tt.workerEvent(this.spec.sid,f0(f0({},o),{},{requestId:u,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));let v=Date.now();this.websocket.sendMessage(f);let R=null;try{R=await y}catch(b){if(this.websocket.state==="closed")throw b;return await g(),await this.request(t,n,s)}return o&&tt.workerEvent(this.spec.sid,f0(f0({},o),{},{requestId:u,actionType:"response",payload:JSON.stringify(R.serverResponse),serverCode:R.code,success:R.code===200,responseTime:Date.now()-v})),R.code!==200&&this.handleResponseError(R),R}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let t=Xo==="4.24.2"?"0.0.1":Xo;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case ci.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void k.warning("live stream response already exists stream");case ci.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case ci.LIVE_STREAM_RESPONSE_BAD_STREAM:case ci.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new he(Y.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case ci.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new he(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case ci.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new he(Y.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case ci.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let n=new he(Y.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(vp.WARNING,n,t.serverResponse.url)}case ci.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{let n=new he(Y.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(vp.WARNING,n,t.serverResponse.url)}case ci.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new he(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case ci.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new he(Y.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case ci.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{let n=new he(Y.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(vp.WARNING,n,t.serverResponse.url)}case ci.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new he(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case ci.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new he(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case ci.LIVE_STREAM_RESPONSE_WORKER_LOST:case ci.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new he(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case ci.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new he(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new he(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case ci.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case ci.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case ci.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case ci.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new he(Y.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(OT)},6e3)}}function az(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function Oa(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?az(Object(n),!0).forEach(function(s){V(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):az(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}class mfe extends dr{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Kr,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Kr;super(),V(this,"onLiveStreamWarning",void 0),V(this,"onLiveStreamError",void 0),V(this,"spec",void 0),V(this,"retryTimeout",1e4),V(this,"connection",void 0),V(this,"httpRetryConfig",void 0),V(this,"wsRetryConfig",void 0),V(this,"streamingTasks",new Map),V(this,"isStartingStreamingTask",!1),V(this,"taskMutex",new ki("live-streaming")),V(this,"cancelToken",oa.CancelToken.source()),V(this,"transcodingConfig",void 0),V(this,"uapResponse",void 0),V(this,"lastTaskId",1),V(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=s,this.wsRetryConfig=n}async setTranscodingConfig(t){let n=Oa(Oa({},$de),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(k.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(d=>Oa(Oa(Oa({},Jde),d),{},{zOrder:d.zOrder?d.zOrder+1:1}))),(function(d){wr(d.width)||Vn(d.width,"config.width",0,1e4),wr(d.height)||Vn(d.height,"config.height",0,1e4),wr(d.videoBitrate)||Vn(d.videoBitrate,"config.videoBitrate",1,1e6),wr(d.videoFrameRate)||Vn(d.videoFrameRate,"config.videoFrameRate"),wr(d.lowLatency)||Bc(d.lowLatency,"config.lowLatency"),wr(d.audioSampleRate)||zr(d.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),wr(d.audioBitrate)||Vn(d.audioBitrate,"config.audioBitrate",1,128),wr(d.audioChannels)||zr(d.audioChannels,"config.audioChannels",[1,2,3,4,5]),wr(d.videoGop)||Vn(d.videoGop,"config.videoGop"),wr(d.videoCodecProfile)||zr(d.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),wr(d.userCount)||Vn(d.userCount,"config.userCount",0,17),wr(d.backgroundColor)||Vn(d.backgroundColor,"config.backgroundColor",0,16777215),wr(d.userConfigExtraInfo)||Hi(d.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),d.transcodingUsers&&!wr(d.transcodingUsers)&&(Zd(d.transcodingUsers,"config.transcodingUsers"),d.transcodingUsers.forEach((f,g)=>{Kb(f.uid),wr(f.x)||Vn(f.x,"transcodingUser[".concat(g,"].x"),0,1e4),wr(f.y)||Vn(f.y,"transcodingUser[".concat(g,"].y"),0,1e4),wr(f.width)||Vn(f.width,"transcodingUser[".concat(g,"].width"),0,1e4),wr(f.height)||Vn(f.height,"transcodingUser[".concat(g,"].height"),0,1e4),wr(f.zOrder)||Vn(f.zOrder-1,"transcodingUser[".concat(g,"].zOrder"),0,100),wr(f.alpha)||Vn(f.alpha,"transcodingUser[".concat(g,"].alpha"),0,1,!1)})),wr(d.watermark)||tD(d.watermark,"watermark"),wr(d.backgroundImage)||tD(d.backgroundImage,"backgroundImage"),d.images&&!wr(d.images)&&(Zd(d.images,"config.images"),d.images.forEach((f,g)=>{tD(f,"images[".concat(g,"]"))}))})(n);let s=[];n.images&&s.push(...n.images.map(d=>Oa(Oa(Oa({},eD),d),{},{zOrder:255}))),n.backgroundImage&&(s.push(Oa(Oa(Oa({},eD),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(s.push(Oa(Oa(Oa({},eD),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=s,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(d=>Oa({},d)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);let o=(n.userConfigs||[]).map(d=>typeof d.uid=="number"?We.resolve(d.uid):I8(d.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await We.all(o)).forEach((d,f)=>{n.userConfigs&&n.userConfigs[f]&&(n.userConfigs[f].uid=d)}),this.transcodingConfig=n,this.connection)try{var u;let d=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(za(u=this.streamingTasks).call(u)).map(f=>f.taskId).join("#")});k.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(d.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(d){if(!d.data||!d.data.retry)throw d;d.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(f=>{k.warning("[".concat(this.spec.clientId,"] live streaming receive error"),d.toString(),"try to republish",f.url),this.startLiveStreamingTask(f.url,f.mode,d).then(()=>{k.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(f.url," success"))}).catch(g=>{k.error("[".concat(this.spec.clientId,"] live streaming republish failed"),f.url,g.toString()),this.onLiveStreamError&&this.onLiveStreamError(f.url,g)})})}}async startLiveStreamingTask(t,n,s){if(!this.transcodingConfig&&n===th.TRANSCODE)throw new he(Y.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let o={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};k.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));let u=await this.taskMutex.lock();if(!this.connection&&s)return void u();if(this.streamingTasks.get(t)&&!s)return u(),new he(Y.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(f){throw u(),f}n===th.TRANSCODE&&(o.transcodingConfig=Oa({},this.transcodingConfig)),this.uapResponse&&this.uapResponse.vid&&(o.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;let d=this.lastTaskId++;try{let f=new We((y,v)=>{Ci(this.retryTimeout).then(()=>{if(s)return v(s);let R=this.statusError.get(t);return R?(this.statusError.delete(t),v(R)):void 0})}),g=await We.race([this.connection.request("request",{clientRequest:o},!0,{url:t,command:"PublishStream",workerType:n===th.TRANSCODE?1:2,requestByUser:!s,tid:d.toString()}),f]);this.isStartingStreamingTask=!1,k.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(g.code)),this.streamingTasks.set(t,{clientRequest:o,mode:n,url:t,taskId:d}),u()}catch(f){if(u(),this.isStartingStreamingTask=!1,!f.data||!f.data.retry||s)throw f;return f.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,f)):await this.startLiveStreamingTask(t,n,f)}}stopLiveStreamingTask(t){return new We((n,s)=>{let o=this.streamingTasks.get(t);if(!o||!this.connection)return new he(Y.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let u=o.mode;o.abortTask=()=>{k.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:o.url}},!1,{url:t,command:"UnPublishStream",workerType:u===th.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(d=>{k.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(d.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(s)})}resetAllTask(){var t;let n=Array.from(za(t=this.streamingTasks).call(t));this.terminate();for(let s of n)this.startLiveStreamingTask(s.url,s.mode).catch(o=>{this.onLiveStreamError&&this.onLiveStreamError(s.url,o)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=oa.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new he(Y.UNEXPECTED_ERROR,"live streaming connection has already connected");let n=await ei(this,nD.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new ffe(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(vp.WARNING,(s,o)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(o,s)),this.connection.on(vp.PUBLISH_STREAM_STATUS,s=>this.handlePublishStreamServer(s)),this.connection.on(vp.REQUEST_NEW_ADDRESS,(s,o)=>{if(!this.connection)return o(new he(Y.UNEXPECTED_ERROR,"can not get new live streaming address list"));ei(this,nD.REQUEST_WORKER_MANAGER_LIST,t).then(u=>{this.uapResponse=u,s(u.addressList)}).catch(o)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){let n=t.serverStatus&&t.serverStatus.url||"empty_url",s=this.streamingTasks.get(n),o=t.reason;switch(t.code){case ci.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case ci.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case ci.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case ci.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{let d=new he(Y.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(s)return k.error(d.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,d);if(!this.isStartingStreamingTask)return;this.statusError.set(n,d)}case ci.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let d=new he(Y.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,o);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,d)}case ci.LIVE_STREAM_RESPONSE_WORKER_LOST:case ci.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();let d=Array.from(za(u=this.streamingTasks).call(u));for(let f of d)f.abortTask?f.abortTask():(k.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",f.url),this.startLiveStreamingTask(f.url,f.mode,new he(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{k.debug("[".concat(this.spec.clientId,"] republish live stream success"),f.url)}).catch(g=>{k.error(g.toString()),this.onLiveStreamError&&this.onLiveStreamError(f.url,g)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}let gfe={name:"LiveStreaming",create:function(e){return new mfe(e.joinInfo,e.websocketRetryConfig||Kr,e.httpRetryConfig||Kr)}};function _fe(e){let t=lz();return(function(n,s){let o=n.appId;o!==void 0&&(Pn(s,10),cd(s,o));let u=n.cid;u!==void 0&&(Pn(s,16),Pn(s,u));let d=n.cname;d!==void 0&&(Pn(s,26),cd(s,d));let f=n.deviceId;f!==void 0&&(Pn(s,34),cd(s,f));let g=n.elapse;g!==void 0&&(Pn(s,40),Dp(s,g));let y=n.fileSize;y!==void 0&&(Pn(s,48),Dp(s,ay(y)));let v=n.height;v!==void 0&&(Pn(s,56),Dp(s,ay(v)));let R=n.jpg;R!==void 0&&(Pn(s,66),Pn(s,R.length),(function(lr,Ce){let Ve=oy(lr,Ce.length);lr.bytes.set(Ce,Ve)})(s,R));let b=n.networkType;b!==void 0&&(Pn(s,72),Dp(s,ay(b)));let A=n.osType;A!==void 0&&(Pn(s,80),Dp(s,ay(A)));let F=n.requestId;F!==void 0&&(Pn(s,90),cd(s,F));let M=n.sdkVersion;M!==void 0&&(Pn(s,98),cd(s,M));let j=n.sequence;j!==void 0&&(Pn(s,104),Dp(s,ay(j)));let K=n.sid;K!==void 0&&(Pn(s,114),cd(s,K));let q=n.timestamp;q!==void 0&&(Pn(s,120),Dp(s,q));let Q=n.uid;Q!==void 0&&(Pn(s,128),Pn(s,Q));let se=n.vid;se!==void 0&&(Pn(s,136),Pn(s,se));let oe=n.width;oe!==void 0&&(Pn(s,144),Dp(s,ay(oe)));let ne=n.service;ne!==void 0&&(Pn(s,152),Pn(s,ne));let de=n.callbackData;de!==void 0&&(Pn(s,162),cd(s,de));let we=n.jpgEncryption;we!==void 0&&(Pn(s,168),Pn(s,we));let Oe=n.requestType;Oe!==void 0&&(Pn(s,176),Pn(s,Oe));let Qe=n.scorePorn;Qe!==void 0&&(Pn(s,185),gx(s,Qe));let at=n.scoreSexy;at!==void 0&&(Pn(s,193),gx(s,at));let Xt=n.scoreNeutral;Xt!==void 0&&(Pn(s,201),gx(s,Xt));let Lt=n.scene;Lt!==void 0&&(Pn(s,208),Pn(s,Lt));let jt=n.ossFilePrefix;jt!==void 0&&(Pn(s,218),cd(s,jt));let En=n.serviceVendor;if(En!==void 0)for(let lr of En){Pn(s,226);let Ce=lz();vfe(lr,Ce),Pn(s,Ce.limit),Cfe(s,Ce),wfe(Ce)}})(e,t),(function(n){let s=n.bytes,o=n.limit;return s.length===o?s:s.subarray(0,o)})(t)}function Efe(e){return(function(n){let s={};e:for(;!uz(n);){let o=ld(n);switch(o>>>3){case 0:break e;case 1:s.code=ld(n);break;case 2:s.msg=dz(n,ld(n));break;case 3:{let u=Sfe(n);s.data=yfe(n),n.limit=u;break}default:oz(n,7&o)}}return s})({bytes:t=e,offset:0,limit:t.length});var t}function yfe(e){let t={};e:for(;!uz(e);){let n=ld(e);switch(n>>>3){case 0:break e;case 1:t.requestId=dz(e,ld(e));break;case 2:t.requestType=ld(e)>>>0;break;case 3:t.scorePorn=mx(e);break;case 4:t.scoreSexy=mx(e);break;case 5:t.scoreNeutral=mx(e);break;case 6:t.requestScene=ld(e)>>>0;break;case 7:t.scene=ld(e)>>>0;break;default:oz(e,7&n)}}return t}function vfe(e,t){let n=e.service;n!==void 0&&(Pn(t,8),Pn(t,n));let s=e.vendor;s!==void 0&&(Pn(t,16),Pn(t,s));let o=e.token;o!==void 0&&(Pn(t,26),cd(t,o));let u=e.callbackUrl;u!==void 0&&(Pn(t,34),cd(t,u))}function Sfe(e){let t=ld(e),n=e.limit;return e.limit=e.offset+t,n}function oz(e,t){switch(t){case 0:for(;128&hz(e););break;case 2:px(e,ld(e));break;case 5:px(e,4);break;case 1:px(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let Tfe=new Float32Array(1);new Uint8Array(Tfe.buffer);let hx=new Float64Array(1),Na=new Uint8Array(hx.buffer);function ay(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let cz=[];function lz(){let e=cz.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function wfe(e){cz.push(e)}function px(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function uz(e){return e.offset>=e.limit}function oy(e,t){let n=e.bytes,s=e.offset,o=e.limit,u=s+t;if(u>n.length){let d=new Uint8Array(2*u);d.set(n),e.bytes=d}return e.offset=u,u>o&&(e.limit=u),s}function fx(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function dz(e,t){let n=fx(e,t),s=String.fromCharCode,o=e.bytes,u="",d="";for(let f=0;f<t;f++){let g,y,v,R,b=o[f+n];128&b?(224&b)==192?f+1>=t?d+=u:(g=o[f+n+1],(192&g)!=128?d+=u:(R=(31&b)<<6|63&g,R<128?d+=u:(d+=s(R),f++))):(240&b)==224?f+2>=t?d+=u:(g=o[f+n+1],y=o[f+n+2],(49344&(g|y<<8))!=32896?d+=u:(R=(15&b)<<12|(63&g)<<6|63&y,R<2048||R>=55296&&R<=57343?d+=u:(d+=s(R),f+=2))):(248&b)==240?f+3>=t?d+=u:(g=o[f+n+1],y=o[f+n+2],v=o[f+n+3],(12632256&(g|y<<8|v<<16))!=8421504?d+=u:(R=(7&b)<<18|(63&g)<<12|(63&y)<<6|63&v,R<65536||R>1114111?d+=u:(R-=65536,d+=s(55296+(R>>10),56320+(1023&R)),f+=3))):d+=u:d+=s(b)}return d}function cd(e,t){let n=t.length,s=0;for(let d=0;d<n;d++){let f=t.charCodeAt(d);f>=55296&&f<=56319&&d+1<n&&(f=(f<<10)+t.charCodeAt(++d)-56613888),s+=f<128?1:f<2048?2:f<65536?3:4}Pn(e,s);let o=oy(e,s),u=e.bytes;for(let d=0;d<n;d++){let f=t.charCodeAt(d);f>=55296&&f<=56319&&d+1<n&&(f=(f<<10)+t.charCodeAt(++d)-56613888),f<128?u[o++]=f:(f<2048?u[o++]=f>>6&31|192:(f<65536?u[o++]=f>>12&15|224:(u[o++]=f>>18&7|240,u[o++]=f>>12&63|128),u[o++]=f>>6&63|128),u[o++]=63&f|128)}}function Cfe(e,t){let n=oy(e,t.limit),s=e.bytes,o=t.bytes;for(let u=0,d=t.limit;u<d;u++)s[u+n]=o[u]}function hz(e){return e.bytes[fx(e,1)]}function pz(e,t){let n=oy(e,1);e.bytes[n]=t}function mx(e){let t=fx(e,8),n=e.bytes;return Na[0]=n[t++],Na[1]=n[t++],Na[2]=n[t++],Na[3]=n[t++],Na[4]=n[t++],Na[5]=n[t++],Na[6]=n[t++],Na[7]=n[t++],hx[0]}function gx(e,t){let n=oy(e,8),s=e.bytes;hx[0]=t,s[n++]=Na[0],s[n++]=Na[1],s[n++]=Na[2],s[n++]=Na[3],s[n++]=Na[4],s[n++]=Na[5],s[n++]=Na[6],s[n++]=Na[7]}function ld(e){let t,n=0,s=0;do t=hz(e),n<32&&(s|=(127&t)<<n),n+=7;while(128&t);return s}function Pn(e,t){for(t>>>=0;t>=128;)pz(e,127&t|128),t>>>=7;pz(e,t)}function Dp(e,t){let n=t.low>>>0,s=(t.low>>>28|t.high<<4)>>>0,o=t.high>>>24,u=o===0?s===0?n<16384?n<128?1:2:n<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:o<128?9:10,d=oy(e,u),f=e.bytes;switch(u){case 10:f[d+9]=o>>>7&1;case 9:f[d+8]=u!==9?128|o:127&o;case 8:f[d+7]=u!==8?s>>>21|128:s>>>21&127;case 7:f[d+6]=u!==7?s>>>14|128:s>>>14&127;case 6:f[d+5]=u!==6?s>>>7|128:s>>>7&127;case 5:f[d+4]=u!==5?128|s:127&s;case 4:f[d+3]=u!==4?n>>>21|128:n>>>21&127;case 3:f[d+2]=u!==3?n>>>14|128:n>>>14&127;case 2:f[d+1]=u!==2?n>>>7|128:n>>>7&127;case 1:f[d]=u!==1?128|n:127&n}}function fz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}let Rfe=new Map([["moderation",1],["supervise",2]]);class bfe extends dr{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let n=this._connectionState;this._connectionState=t,this.emit(xi.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=ta(n=t.map(s=>Rfe.get(s)||0)).call(n,(s,o)=>s+o),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),V(this,"name","AgoraRTCVideoContentInspect"),V(this,"_connectionState",Kc.CONNECTING),V(this,"_innerConnectionState",void 0),V(this,"sequence",0),V(this,"inspectStartTime",void 0),V(this,"workerManagerConnection",void 0),V(this,"workerConnection",void 0),V(this,"workerMessageLengthLimit",void 0),V(this,"inspectIntervalMinimum",void 0),V(this,"qualityRatio",void 0),V(this,"_connectInfo",void 0),V(this,"_cancelTokenSource",oa.CancelToken.source()),V(this,"_retryConfig",void 0),V(this,"wmSequence",0),V(this,"inspectInterval",void 0),V(this,"inspectTimer",null),V(this,"ossFilePrefix",void 0),V(this,"extraInfo",void 0),V(this,"_inspectType",void 0),V(this,"_inspectMode",void 0),V(this,"_quality",1),V(this,"qualityTimer",null),V(this,"_inspectId",void 0),V(this,"_needWorkUrlOnly",!1),V(this,"inspectImage",()=>{if(this.connectionState!==Kc.CONNECTED)throw new he(Y.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Kc.CONNECTED?this.requestToInspectImage():k.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=In(5,"inspect-"),this.workerMessageLengthLimit=z("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=z("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=z("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new UT("worker-manager-"+this._inspectId,Kr),this.on(xi.STATE_CHANGE,(n,s)=>{this._innerConnectionState=n,k.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Yc[n]," ").concat(s||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new UT("worker-"+this._inspectId,Kr),this.handleWorkerEvents()}async init(t,n){this.emit(xi.STATE_CHANGE,Yc.CONNECT_AP),this._connectInfo=t;let s=this._cancelTokenSource.token;return this._retryConfig=n,new We((o,u)=>{this.on(xi.CONNECTION_STATE_CHANGE,(d,f)=>{f===Kc.CONNECTED&&o()}),this.requestAP(t,s,n).then(d=>{this.connectWorkerManager(d)}).catch(d=>{u(d)})})}async requestAP(t,n,s){let o=z("WEBCS_DOMAIN").map(f=>"https://".concat(f,"/api/v1")),u=await(function(f,g,y,v){let{appId:R,areaCode:b,cname:A,sid:F,token:M,uid:j}=g;qE++;let K="image_moderation_api",q={service_name:K,json_body:JSON.stringify({appId:R,areaCode:b,cname:A,command:"allocateEdge",requestId:qE,seq:qE,sid:F,token:M,ts:Date.now(),uid:j+""})},Q,se,oe=f[0];return Bl(async()=>{Q=Date.now();let ne=await Yl(oe,{data:q,cancelToken:y,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(se=Date.now()-Q,ne.code!==0){let at=new he(Y.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ne.code,{retry:!0,responseTime:se});throw k.error(at.toString()),at}let de=JSON.parse(ne.json_body);if(de.code!==200){let at=new he(Y.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(de.code,", reason: ").concat(de.reason),{code:de.code,responseTime:se});throw k.error(at.toString()),at}if(!de.servers||!Array.isArray(de.servers)||de.servers.length===0){let at=new he(Y.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:de.code,responseTime:se});throw k.error(at.toString()),at}let we=z("VIDEO_INSPECT_WORKER_MANAGER_WSS");if(we)return{addressList:[we],workerToken:de.workerToken,vid:de.vid,responseTime:se};let Oe=z("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Qe=z("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:de.servers.map(at=>{let{address:Xt,wss:Lt}=at;if(Xt&&Lt)return"wss://".concat(Xt.replace(/\./g,"-"),".").concat(Oe,":").concat(Qe||Lt)}).filter(at=>!!at),workerToken:de.workerToken,vid:de.vid,responseTime:se}},(ne,de)=>(tt.apworkerEvent(F,{success:!0,sc:200,serviceName:K,responseDetail:JSON.stringify(ne.addressList),firstSuccess:de===0,responseTime:se,serverIp:f[de%f.length]}),!1),(ne,de)=>(tt.apworkerEvent(F,{success:!1,sc:ne.data&&ne.data.code||200,serviceName:K,responseTime:se,serverIp:f[de%f.length]}),!!(ne.code!==Y.OPERATION_ABORTED&&ne.code!==Y.UNEXPECTED_RESPONSE||ne.data&&ne.data.retry)&&(oe=f[(de+1)%f.length],!0)),v)})(o,t,n,s);this.emit(xi.STATE_CHANGE,Yc.AP_CONNECTED);let{addressList:d}=u;return this.wmSequence++,d}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(xi.STATE_CHANGE,Yc.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Ot.CONNECTED,async()=>{this.emit(xi.STATE_CHANGE,Yc.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Ot.CLOSED,()=>{this._innerConnectionState<Yc.GET_WORKER_MANAGER_RESPONSE&&k.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Ot.FAILED,()=>{this._innerConnectionState<Yc.GET_WORKER_MANAGER_RESPONSE&&k.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Ot.RECONNECTING,()=>{this._innerConnectionState<Yc.GET_WORKER_MANAGER_RESPONSE&&k.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Ot.ON_MESSAGE,async t=>{this.emit(xi.STATE_CHANGE,Yc.GET_WORKER_MANAGER_RESPONSE);let n=this.workerManagerConnection.url;this.workerManagerConnection.close();let s=JSON.parse(t.data);if(s.code!==200)throw k.error("[".concat(this._inspectId,"] Unexpected code ").concat(s.code," from worker manager")),new he(Y.UNEXPECTED_RESPONSE,"response code of worker is unexpected",s);if(!(s.serverResponse&&s.serverResponse.portWss&&n))throw k.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(s))),new he(Y.UNEXPECTED_RESPONSE,"response content of worker is unexpected",s);{let o=z("VIDEO_INSPECT_WORKER_PORT")||s.serverResponse.portWss,u=n.replace(/:\d+\/?$/,":".concat(o));this.emit(xi.STATE_CHANGE,Yc.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(xi.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}}),this.workerManagerConnection.on(Ot.WILL_RECONNECT,(t,n,s)=>{s(t)}),this.workerManagerConnection.on(Ot.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}handleWorkerEvents(){this.workerConnection.on(Ot.CONNECTED,async()=>{this.emit(xi.STATE_CHANGE,Yc.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Kc.CONNECTED}),this.workerConnection.on(Ot.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){let s=Efe(new Uint8Array(t.data));if(z("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&k.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(s)),s.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(xi.INSPECT_RESULT,void 0,void 0);if(s.data&&s.data.scorePorn&&s.data.scoreSexy&&s.data.scoreNeutral){var n;let o={porn:s.data.scorePorn,sexy:s.data.scoreSexy,neutral:s.data.scoreNeutral},u=ta(n=Object.keys(o)).call(n,(f,g)=>o[f]>o[g]?f:g,"porn"),d=Object.keys(o).find(f=>f===u);this.emit(xi.INSPECT_RESULT,d)}else this.emit(xi.INSPECT_RESULT,void 0,new he(Y.UNEXPECTED_RESPONSE,s.code+"","There is an unexpected data on message"))}else this.emit(xi.INSPECT_RESULT,void 0,new he(Y.UNEXPECTED_RESPONSE,s.code+"",s.msg))}else k.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(xi.INSPECT_RESULT,void 0,new he(Y.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Ot.CLOSED,()=>{this.connectionState=Kc.CLOSED}),this.workerConnection.on(Ot.FAILED,()=>{this.connectionState=Kc.CLOSED}),this.workerConnection.on(Ot.RECONNECTING,()=>{this.connectionState=this.connectionState===Kc.CONNECTED?Kc.RECONNECTING:Kc.CONNECTING}),this.workerConnection.on(Ot.WILL_RECONNECT,(t,n,s)=>{t==="recover"&&s(t),s("tryNext")}),this.workerConnection.on(Ot.REQUEST_NEW_URLS,(t,n)=>{this.workerManagerConnection.close(),this.once(xi.REQUEST_NEW_WORKER_URL,s=>{t([s])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(s=>{this.connectWorkerManager(s,!0)}).catch(s=>{n(s)})})}async requestToInspectImage(){this.sequence++;let t=qa(this,xi.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(xi.INSPECT_RESULT,void 0,new he(Y.INVALID_OPERATION,"Only the track being played can be inspected"));let s=await this.generateRequestData(t,n);this.workerConnection.sendMessage(s,!0,!0)}else this.emit(xi.INSPECT_RESULT,void 0,new he(Y.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:s,cname:o,cid:u,vid:d,sid:f,uid:g}=n,y=Date.now(),v=await t.getCurrentFrameImage("image/jpeg",this.quality),R=await H5(v,s,o),b=this.sequence+"-"+u+"-"+g+"-"+y+"-"+In(12,""),A={appId:s,cid:u,cname:o,deviceId:"",elapse:(F=Number(y-this.inspectStartTime),{low:F|=0,high:F>>31,unsigned:F>=0}),fileSize:R.byteLength,jpgEncryption:2,height:v.height,width:v.width,jpg:R,networkType:6,osType:7,requestId:b,sdkVersion:"4.24.2",sequence:this.sequence,sid:f,timestamp:EG(y),uid:g,vid:d,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var F;this.extraInfo===void 0&&delete A.callbackData,this.ossFilePrefix===void 0&&delete A.ossFilePrefix;let M=_fe(A);if(M.byteLength<this.workerMessageLengthLimit){if(z("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){let j=(function(K){for(var q=1;q<arguments.length;q++){var Q=arguments[q]!=null?arguments[q]:{};q%2?fz(Object(Q),!0).forEach(function(se){V(K,se,Q[se])}):Object.getOwnPropertyDescriptors?Object.defineProperties(K,Object.getOwnPropertyDescriptors(Q)):fz(Object(Q)).forEach(function(se){Object.defineProperty(K,se,Object.getOwnPropertyDescriptor(Q,se))})}return K})({},A);delete j.jpg,k.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(j))}return M}{let j=this.quality*this.qualityRatio;return this.quality=j,await this.generateRequestData(t,{appId:s,cname:o,cid:u,vid:d,sid:f,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=oa.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Kc.CLOSED,this.emit(xi.STATE_CHANGE,Yc.CLOSED)}}let Ife={name:"ContentInspect",create:function(e){let{config:t}=e;return(function(n){if(!n)throw new he(Y.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new he(Y.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{let s=[...new Set(n.inspectType)];s.forEach(o=>{var u;if(!ke(u=["supervise","moderation"]).call(u,o))throw new he(Y.INVALID_PARAMS,"".concat(o," is not a valid inspect type."))}),n.inspectType=s}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new he(Y.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")})(t),new bfe(t)}};var mz=l(fi.Object.getOwnPropertySymbols),Afe=Sn,Ofe=r_.indexOf,Nfe=Mf,_x=Ne([].indexOf),gz=!!_x&&1/_x([1],1,-0)<0;Afe({target:"Array",proto:!0,forced:gz||!Nfe("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return gz?_x(this,e,t)||0:Ofe(this,e,t)}});var Pfe=Sa("Array","indexOf"),kfe=N,Dfe=Pfe,Ex=Array.prototype,xfe=function(e){var t=e.indexOf;return e===Ex||kfe(Ex,e)&&t===Ex.indexOf?Dfe:t},_z=l(xfe);function Lfe(e,t){if(e==null)return{};var n,s,o=(function(d,f){if(d==null)return{};var g={};for(var y in d)if({}.hasOwnProperty.call(d,y)){if(_z(f).call(f,y)!==-1)continue;g[y]=d[y]}return g})(e,t);if(mz){var u=mz(e);for(s=0;s<u.length;s++)n=u[s],_z(t).call(t,n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}let Ez=class{get localCapabilities(){return Qn(this._localCapabilities)}get rtpCapabilities(){return Qn(this._rtpCapabilities)}get candidates(){return Qn(this._candidates)}get iceParameters(){return Qn(this._iceParameters)}get dtlsParameters(){return Qn(this._dtlsParameters)}constructor(e){V(this,"sessionDesc",void 0),V(this,"_localCapabilities",void 0),V(this,"_rtpCapabilities",void 0),V(this,"_candidates",void 0),V(this,"_iceParameters",void 0),V(this,"_dtlsParameters",void 0),V(this,"setup",void 0),V(this,"currentMidIndex",void 0),V(this,"cname","o/i14u9pJrxRKAsu"),V(this,"firefoxSsrcMidMap",new Map),e=Qn(e);let{remoteIceParameters:t,remoteDtlsParameters:n,candidates:s,remoteRTPCapabilities:o,localCapabilities:u,direction:d,setup:f,videoCodec:g,audioCodec:y}=e,v;this.setup=f,v=d===Ys.RECEIVE_ONLY?Hs(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Hs(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=o,this._candidates=s,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=u;let R=d===Ys.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,b=d===Ys.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,A=d===Ys.RECEIVE_ONLY?o.send.videoCodecs:GT(et.VIDEO,R,b,g),F=d===Ys.RECEIVE_ONLY?o.send.audioCodecs:GT(et.AUDIO,R,b,y);for(let M of v.mediaDescriptions)M.attributes.iceUfrag=t.iceUfrag,M.attributes.icePwd=t.icePwd,M.attributes.fingerprints=n.fingerprints,M.attributes.candidates=s,M.attributes.setup=this.setup,M.media.mediaType==="application"&&(M.attributes.sctpPort="5000"),M.media.mediaType==="video"&&(M.media.fmts=A.map(j=>j.payloadType.toString(10)),M.attributes.payloads=A,M.attributes.extmaps=R.videoExtensions),M.media.mediaType==="audio"&&(M.media.fmts=F.map(j=>j.payloadType.toString(10)),M.attributes.payloads=F,M.attributes.extmaps=R.audioExtensions,YE(M));this.sessionDesc=v,this.currentMidIndex=v.mediaDescriptions.length-1}toString(){return eh(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,n,s,o){n=n.replace(/ /g,"-");let{ssrcs:u,ssrcGroups:d}=BT(t,this.cname,z("SYNC_GROUP")?n:void 0),f=this.findPreloadMediaDesc(u);if(f){if($n()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,f.attributes.mid),o&&(o.twcc||o.remb)){let g=this.sessionDesc.mediaDescriptions.indexOf(f);return this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(f,o),{mid:f.attributes.mid,needExchangeSDP:!0}}return{mid:f.attributes.mid,needExchangeSDP:!1}}{let g=this.findAvailableMediaIndex(e,u,s),y;return g===-1?(y=this.createOrRecycleSendMedia(e,u,d,"sendonly",s,o),this.updateBundleMids()):(y=Qn(this.sessionDesc.mediaDescriptions[g]),y.attributes.direction="sendonly",y.attributes.ssrcs=u,y.attributes.ssrcGroups=d,this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(y,o)),$n()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,y.attributes.mid),{needExchangeSDP:!0,mid:y.attributes.mid}}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,n){let s=[];return e.forEach(o=>{let u=o._mediaStreamTrack.kind,d=this.findAvailableRecvMediaIndex(u),f,g=!1;d===-1?(g=!0,f=this.createOrRecycleRecvMedia(o,[],"recvonly",t,n),this.updateBundleMids()):(f=Qn(this.sessionDesc.mediaDescriptions[d]),f.attributes.direction="recvonly"),s.push({mid:f.attributes.mid,needCreateTransceiver:g})}),s}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){let{foundation:t,protocol:n,address:s,port:o,type:u,relatedAddress:d,relatedPort:f,priority:g}=new RTCIceCandidate(e),y={foundation:t??"",componentId:"1",transport:n??"",priority:g?g+"":"",connectionAddress:s??"",port:o?o+"":"",type:u?u+"":"",relAddr:d??"",relPort:f?f+"":"",extension:{}};this.candidates.some(v=>v.priority===y.priority&&v.connectionAddress===y.connectionAddress&&v.port===y.port)||(this._candidates.push(y),this.sessionDesc.mediaDescriptions.forEach(v=>{v.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,s,o){let u=e._mediaStreamTrack.kind,d=this.rtpCapabilities.recv,f=GT(u,d,this.localCapabilities.send,u===et.AUDIO?o:s),g=u===et.VIDEO?d.videoExtensions:d.audioExtensions,y="".concat(++this.currentMidIndex),v={media:{mediaType:u,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(y)}};v=this.mungRecvMediaDsec(v,e);let R=this.findFirstClosedMedia(u);if(R){let b=this.sessionDesc.mediaDescriptions.indexOf(R);this.sessionDesc.mediaDescriptions[b]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(n=>ke(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(n=>ke(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex(s=>{let o=s.media.mediaType===e&&s.media.port!=="0"&&(s.attributes.direction==="sendonly"||s.attributes.direction==="sendrecv")&&s.attributes.ssrcs.length===0;if($n()){if(o){let u=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(u||s.attributes.mid!=="0"&&s.attributes.mid!=="1")||!(!u||u!==s.attributes.mid)}return!1}return o&&s.attributes.mid===n})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{let n=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&n})}predictReceivingMids(e){let t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=Qn(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,n,s,o,u){let d=this.rtpCapabilities.send,f=e===et.VIDEO?d.videoCodecs:d.audioCodecs,g=e===et.VIDEO?d.videoExtensions:d.audioExtensions;$n()&&(o="".concat(++this.currentMidIndex));let y={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:o}};y=this.mungSendMediaDesc(y,u);let v=this.findFirstClosedMedia(e);if(v){let R=this.sessionDesc.mediaDescriptions.indexOf(v);this.sessionDesc.mediaDescriptions[R]=y}else this.sessionDesc.mediaDescriptions.push(y);return y}mungRecvMediaDsec(e,t,n){let s=Qn(e);return uD(s),Ym(s,t),dD(s,t),l8(s),tI(s,n,this.localCapabilities.send),s}mungSendMediaDesc(e,t){let n=Qn(e);return tI(n,t,this.localCapabilities.recv),YE(n),n}updateRecvMedia(e,t){let n=this.sessionDesc.mediaDescriptions.findIndex(s=>s.attributes.mid===e);if(n!==-1){let s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=s}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>$n()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}},Mfe=["sdp"];var Zn;function yz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function xp(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?yz(Object(n),!0).forEach(function(s){V(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yz(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}let vz=(Zn=class yy extends zW{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,s){super(t,n),V(this,"direction",void 0),V(this,"name",void 0),V(this,"store",void 0),V(this,"spec",void 0),V(this,"peerConnection",void 0),V(this,"initialOffer",void 0),V(this,"transport",void 0),V(this,"statsFilter",void 0),V(this,"localCandidateCount",0),V(this,"_isInRestartIce",!1),V(this,"mutex",void 0),V(this,"onLocalCandidate",void 0),V(this,"remoteSDP",void 0),V(this,"pendingCandidates",[]),V(this,"localCapabilities",void 0),V(this,"isReady",!1),V(this,"restartCnt",0),V(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new ki("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(yy.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=s??Ys.SEND_ONLY,this.name=this.direction===Ys.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=wb(this.peerConnection,z("STATS_UPDATE_INTERVAL"),void 0,$n()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{let n=await pD();if(this.localCapabilities=WT(n),t){let{sdp:s}=t,o=Lfe(t,Mfe),u=(function(){let v={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},R=jT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},F={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Xc(R,v,"videoExtensions",b,A,F),Xc(R,v,"videoCodecs",b,A,F),Xc(R,v,"audioExtensions",b,A,F),Xc(R,v,"audioCodecs",b,A,F),z("RAISE_H264_BASELINE_PRIORITY")){let M=F.videoCodecs.findIndex(j=>j.rtpMap&&j.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&j.fmtp&&j.fmtp.parameters["profile-level-id"]==="42001f");if(M!==-1){let j=F.videoCodecs.findIndex(K=>K.rtpMap&&K.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(j<M){k.debug("raising H264 baseline profile priority");let K=F.videoCodecs[M];F.videoCodecs.splice(M,1),F.videoCodecs.splice(j,0,K)}j!==-1&&z("FILTER_SEND_H264_BASELINE")&&(b.videoCodecs=b.videoCodecs.filter(K=>!(K.rtpMap&&K.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&K.fmtp&&K.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:b,recv:A,sendrecv:F}})({},{},s);this.remoteSDP=new Ez({remoteIceParameters:o.iceParameters,remoteDtlsParameters:o.dtlsParameters,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;let d=await this.peerConnection.createAnswer();if(!d.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");let f=ed(d.sdp);await this.peerConnection.setLocalDescription(d);let g=await d8({},{},d.sdp);this.localCapabilities=WT(g);let y=this.peerConnection.getTransceivers()[0];return y!=null&&y.receiver&&y.receiver.transport&&this.tryBindTransportEvents(y.receiver.transport),xp(xp({},f),{},{sdp:d.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});let s=await this.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let o=ed(s.sdp);return this.initialOffer=s,xp(xp({},o),{},{sdp:s.sdp})}}catch(n){throw new _e(Y.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);let{sdp:n,iceParameters:s,dtlsParameters:o}=t,u=await d8({},{},n);this.remoteSDP=new Ez({remoteIceParameters:s,remoteDtlsParameters:o,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});let d=this.peerConnection.getTransceivers()[0];d!=null&&d.sender&&d.sender.transport&&this.tryBindTransportEvents(d.sender.transport)}catch(n){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new _e(Y.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(t,n,s){var o=this;return aa(function*(){let u=yield Ft(o.mutex.lock("From P2PConnection.send"));try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let d=[],f=o.remoteSDP.receive(t,n,s);t.forEach((j,K)=>{if(f[K].needCreateTransceiver){let q=o.peerConnection.addTransceiver(j._mediaStreamTrack,{direction:"sendonly"});d.push(q),j._updateRtpTransceiver(q)}else{let q=o.peerConnection.getTransceivers().find(Q=>Q.mid===f[K].mid);if(!q)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(f[K].mid));d.push(q),j._updateRtpTransceiver(q)}}),$n()&&z("SIMULCAST")===!0&&(yield Ft(o.applySimulcastForFirefox(d,t)));let g=f.map(j=>j.mid),y=yield Ft(o.peerConnection.createOffer()),v=o.mungSendOfferSDP(y.sdp,t,g),R=Hs(v),b=g.map(j=>{let K=R.mediaDescriptions.find(q=>q.attributes.mid===j);if(!K)throw new Error("Cannot extract ssrc from mediaDescription.");return lD(K,z("USE_PUB_RTX"))}),A=d.map((j,K)=>{let q=g[K];return{localSSRC:b[K],id:q}});yield Ft(o.peerConnection.setLocalDescription({type:"offer",sdp:v}));try{yield A}catch(j){let K=o.remoteSDP.toString();throw yield Ft(o.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield Ft(o.peerConnection.setRemoteDescription({type:"answer",sdp:K})),yield Ft(o.stopSending(g,!0)),j}yield Ft(o.applySimulcastEncodings(d,t)),yield Ft(o.applySendEncodings(d,t));let F=o.remoteSDP.toString();return o.logSDPExchange(v,"offer","local","send")?.(F),yield Ft(o.setRemoteDescription({type:"answer",sdp:F})),d.map((j,K)=>{let q=g[K];return{localSSRC:b[K],id:q}})}catch(d){throw d instanceof _e?d:new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{u()}})()}async stopSending(t,n){let s=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let o=this.peerConnection.getTransceivers().filter(g=>t.indexOf(g.mid)!==-1);if(o.length!==t.length)throw new Error("Transceivers' length (".concat(o.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));o.map(g=>{var y;g.direction="inactive",(y=g.stop)===null||y===void 0||y.call(g)});let u=await this.peerConnection.createOffer(),d=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(t);let f=this.remoteSDP.toString();d?.(f),await this.setRemoteDescription({type:"answer",sdp:f})}catch(o){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(o.toString()))}finally{s&&s()}}async receive(t,n,s,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:u,needExchangeSDP:d}=this.remoteSDP.send(t,n,s,o);if(d){let g=this.remoteSDP.toString(),y=this.logSDPExchange(g,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:g});let v=await this.peerConnection.createAnswer(),R=this.mungReceiveAnswerSDP(v.sdp,u,t);y?.(R||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:R}),k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));let f=this.peerConnection.getTransceivers().find(g=>g.mid===u);if(!f||f.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:f.receiver.track,mid:f.mid,transceiver:f}}catch(u){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async mockReceive(t,n,s,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:u,needExchangeSDP:d}=this.remoteSDP.send(t,n,s,o);if(d){let f=this.remoteSDP.toString(),g=this.logSDPExchange(f,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:f});let y=await this.peerConnection.createAnswer(),v=this.mungReceiveAnswerSDP(y.sdp,u,t);g?.(v||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:v}),k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(u){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let n=this.remoteSDP.toString(),s=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});let o=await this.peerConnection.createAnswer();s?.(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===Lm.Auto&&(this.store.p2pTransport=Lm.SdRtn,Qt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(yy.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Qt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(yy.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;let n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let{iceParameters:s}=ed(n.sdp);return this.store.descriptionStart(),this.direction===Ys.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),s}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Ys.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});let n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");let{iceParameters:s}=ed(n.sdp);return await this.peerConnection.setLocalDescription(n),s}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let s=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(s.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);let u=this.remoteSDP.toString(),d=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),d?.(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new _e(Y.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(t,n){let s=this.peerConnection.getTransceivers().filter(o=>o.mid===t);s.length===1&&(this.isVP8Simulcast(n)?$n()||await this.applySimulcastEncodings(s,[n]):await this.applySendEncodings(s,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){let s=this.peerConnection.getTransceivers().find(o=>o.mid===n);s&&await s.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let n=t[0].transport.iceTransport,{local:s,remote:o}=n.getSelectedCandidatePair();return{local:xp(xp({},Gc),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port}),remote:xp(xp({},Gc),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,n;ke(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var n;t.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o={iceServers:[]};var u;return t.iceServers?o.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Om(t.turnServer.servers)?o.iceServers=t.turnServer.servers:(o.iceServers&&o.iceServers.push(...yy.turnServerConfigToIceServers(t.turnServer.servers,n,s)),z("USE_TURN_SERVER_OF_GATEWAY")&&o.iceServers&&t.turnServer.serversFromGateway&&o.iceServers.push(...yy.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,s)),ke(u=[Lm.Relay,Lm.SdRtn]).call(u,n)&&(o.iceTransportPolicy="relay"),z("FORCE_TURN_TCP")?o.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(d=>{d.forceturn&&(o.iceTransportPolicy="relay")}))),z("ENABLE_ENCODED_TRANSFORM")&&Qt().supportWebRTCEncodedTransform&&(o.encodedInsertableStreams=!0),k.debug("P2PConnection p2pTransport is ".concat(n)),o}static turnServerConfigToIceServers(t,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=[],u=t.filter(f=>f.tcpport);k.debug("P2PConnection turnServers is ".concat(u,", current index is ").concat(s));let d=u.length>s?u[s]:u[0];switch(n){case Lm.SdRtn:let f=t.filter(y=>{var v;return ke(v=y.username).call(v,"glb:")&&y.turnServerURL==y.turnServerURL}),g=f.length>s?f[s]:f[0];g&&(o.push({username:g.username,credential:g.password,credentialType:"password",urls:"turn:".concat(qc(g.turnServerURL),":").concat(g.tcpport,"?transport=udp")}),o.push({username:g.username,credential:g.password,credentialType:"password",urls:"turns:".concat(qc(g.turnServerURL),":").concat(g.tcpport,"?transport=tcp")}));break;case Lm.Relay:d&&(o.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(d.turnServerURL,":").concat(d.tcpport,"?transport=udp")}),o.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(qc(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}));break;default:d&&(o.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(d.turnServerURL,":").concat(d.tcpport,"?transport=udp")}),o.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(qc(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}),o.push({username:d.username,credential:d.password,credentialType:"password",urls:"stun:".concat(d.turnServerURL,":").concat(d.tcpport)}))}return o}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var s;t!=null&&t.state&&((s=this.onDTLSTransportStateChange)===null||s===void 0||s.call(this,t.state))},t.onerror=s=>{var o;(o=this.onDTLSTransportError)===null||o===void 0||o.call(this,"error"in s?s.error:s)};let n=t.iceTransport;n&&(n.onstatechange=()=>{let s=t?.iceTransport.state;var o;s&&((o=this.onICETransportStateChange)===null||o===void 0||o.call(this,s))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){let{local:s,remote:o}=n.getSelectedCandidatePair()||{};if(s&&o){let u=s.address+":"+s.port,d=o.address+":"+o.port;k.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Zu(u)),", remote ").concat(JSON.stringify(Zu(d))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var s;if(n||(n=this.peerConnection.getSenders().find(v=>v.track===t._mediaStreamTrack)),!n)return k.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return k.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Qt().supportSetRtpSenderParameters)return k.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let o={},u={};switch(t._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;default:o.degradationPreference="balanced"}if(t._encoderConfig){var d;let{bitrateMax:v,frameRate:R,scaleResolutionDownBy:b}=t._encoderConfig;v&&(u.maxBitrate=1e3*v),ke(d=t._hints).call(d,bn.LOW_STREAM)&&(R&&(u.maxFramerate=da(R)),b&&b>=1&&(u.scaleResolutionDownBy=b))}if(z("DSCP_TYPE")&&qu()){var f;let v=z("DSCP_TYPE");ke(f=["very-low","low","medium","high"]).call(f,v)&&(u.networkPriority=v)}let g=n.getParameters(),y=(s=g.encodings)===null||s===void 0?void 0:s[0];$n()&&!y&&(o.encodings=[u]),y&&Object.assign(y,u),Object.assign(g,o),k.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),await n.setParameters(g)}async applySendEncodings(t,n){try{if(!Qt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let s=0;s<t.length;s++){let o=t[s],u=n[s];u instanceof jn&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,o.sender)}}catch{k.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,s){let o=Hs(t);return n.forEach((u,d)=>{let f=s[d],g=o.mediaDescriptions.find(y=>y.attributes.mid===f);g&&(Ym(g,u),hD(g,u,this.store.codec))}),eh(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,s)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,s)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let g=0;g<t.length;g++){var s,o,u,d,f;let y=t[g],v=n[g];if(v instanceof jn&&!ke(s=v._hints).call(s,bn.LOW_STREAM)&&(o=v._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((u=v._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(d=v._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((f=v._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1&&this.store.codec==="vp8"){let R={},b={high:1e3*(v._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:b.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:b.high}];let A=y.sender.getParameters();await y.sender.setParameters(Object.assign(A,R))}}}async applySimulcastEncodings(t,n){if(!$n()&&t.length===n.length)for(let s=0;s<t.length;s++){let o=n[s];if(o instanceof jn&&this.isVP8Simulcast(o)){let u=t[s],d={},f={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};d.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:f.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:f.medium,scaleResolutionDownBy:4}];let g=u.sender.getParameters();await u.sender.setParameters(Object.assign(g,d))}}}isVP8Simulcast(t){var n,s,o,u,d;return!!(t instanceof jn&&z("SIMULCAST")&&this.store.codec==="vp8"&&!ke(n=t._hints).call(n,bn.LOW_STREAM)&&(s=t._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((o=t._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(u=t._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((d=t._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1)}logSDPExchange(t,n,s,o){if(z("SDP_LOGGING"))return k.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(n," SDP during P2PConnection.").concat(o,`
`),t),n==="offer"?u=>{this.logSDPExchange(u,"answer",s==="local"?"remote":"local",o)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(d=>{d.direction="inactive"});let s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.muteRemote(t);let u=this.remoteSDP.toString();o?.(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(n){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async d=>{d.direction="sendonly"});let s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.unmuteRemote(t);let u=this.remoteSDP.toString();o?.(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(n){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(t,n){var s;if(n=n??((s=this.currentRemoteDescription)===null||s===void 0?void 0:s.sdp)){var o;return((o=Hs(n).mediaDescriptions.find(d=>d.attributes.mid===t))===null||o===void 0?void 0:o.attributes.ssrcs)?.[0].ssrcId}}async setRemoteDescription(t){var n;await this.peerConnection.setRemoteDescription(t),ke(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,n,s){let o=Hs(t),u=o.mediaDescriptions.find(d=>d.attributes.mid===n);return u&&s===et.AUDIO&&u.media.mediaType==="audio"&&YE(u),eh(o)}},ze(Zn.prototype,"establish",[el],Object.getOwnPropertyDescriptor(Zn.prototype,"establish"),Zn.prototype),ze(Zn.prototype,"connect",[el],Object.getOwnPropertyDescriptor(Zn.prototype,"connect"),Zn.prototype),ze(Zn.prototype,"receive",[el],Object.getOwnPropertyDescriptor(Zn.prototype,"receive"),Zn.prototype),ze(Zn.prototype,"mockReceive",[el],Object.getOwnPropertyDescriptor(Zn.prototype,"mockReceive"),Zn.prototype),ze(Zn.prototype,"stopReceiving",[el],Object.getOwnPropertyDescriptor(Zn.prototype,"stopReceiving"),Zn.prototype),ze(Zn.prototype,"restartICE",[el],Object.getOwnPropertyDescriptor(Zn.prototype,"restartICE"),Zn.prototype),ze(Zn.prototype,"close",[el],Object.getOwnPropertyDescriptor(Zn.prototype,"close"),Zn.prototype),ze(Zn.prototype,"updateEncoderConfig",[el],Object.getOwnPropertyDescriptor(Zn.prototype,"updateEncoderConfig"),Zn.prototype),ze(Zn.prototype,"updateSendParameters",[el],Object.getOwnPropertyDescriptor(Zn.prototype,"updateSendParameters"),Zn.prototype),ze(Zn.prototype,"replaceTrack",[el],Object.getOwnPropertyDescriptor(Zn.prototype,"replaceTrack"),Zn.prototype),ze(Zn.prototype,"muteLocal",[el],Object.getOwnPropertyDescriptor(Zn.prototype,"muteLocal"),Zn.prototype),ze(Zn.prototype,"unmuteLocal",[el],Object.getOwnPropertyDescriptor(Zn.prototype,"unmuteLocal"),Zn.prototype),Zn);function el(e,t,n){let s=e[t];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){let o=this.mutex,u=await o.lock("From P2PConnection.".concat(t));try{for(var d=arguments.length,f=new Array(d),g=0;g<d;g++)f[g]=arguments[g];return await s.apply(this,f)}finally{u()}},n}let Jl=(function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e})({});var Sz,Tz,wz,Cz,Rz,bz,Iz,Az,Oz,Nz,Pz,hr;function kz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function UI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?kz(Object(n),!0).forEach(function(s){V(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kz(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}let Ufe=(Sz=$l(Jl.SEND_ONLY),Tz=$l(Jl.SEND_ONLY),wz=$l(),Cz=$l(Jl.RECEIVE_ONLY),Rz=$l(Jl.RECEIVE_ONLY),bz=$l(Jl.RECEIVE_ONLY),Iz=$l(Jl.RECEIVE_ONLY),Az=$l(Jl.RECEIVE_ONLY),Oz=$l(Jl.RECEIVE_ONLY),Nz=$l(),Pz=$l(Jl.RECEIVE_ONLY),hr=class extends dr{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(dt.StateChange,t,this._state)}constructor(e,t){super(),V(this,"isPlanB",!1),V(this,"store",void 0),V(this,"statsUploader",void 0),V(this,"sendConnection",void 0),V(this,"recvConnection",void 0),V(this,"localTrackMap",new Map),V(this,"remoteUserMap",new Map),V(this,"localDataChannels",[]),V(this,"pendingLocalTracks",[]),V(this,"pendingRemoteTracks",[]),V(this,"statsCollector",void 0),V(this,"dtlsFailedCount",0),V(this,"sendMutex",void 0),V(this,"recvMutex",void 0),V(this,"_state",Tn.Disconnected),V(this,"_restartStates",["disconnected","failed"]),V(this,"reconnectInterval",void 0),V(this,"uploadUnplinkStarted",!1),V(this,"uploadDownlinkStarted",!1),V(this,"uplinkStateUploadInterval",void 0),V(this,"downlinkStatsUploadInterval",void 0),V(this,"handleMuteLocalTrack",async(n,s,o)=>{let u=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Tn.Connected)return void o(new _e(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));let g=this.filterTobeMutedTracks(n);if(g.length===0)return void s();let y=g.find(A=>A[0]==="videoLowTrack");y&&y[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(g.map(A=>{let[,{id:F}]=A;return F}));let v=!1;var d,f;n.trackMediaType==="video"?v=!((d=this.localTrackMap.get(De.LocalAudioTrack))===null||d===void 0||!d.track._muted):v=((f=this.localTrackMap.get(De.LocalVideoTrack))===null||f===void 0?void 0:f.id)===void 0;let R=this.createMuteMessage(g);await Wn(this,dt.RequestMuteLocal,R);let b=n.trackMediaType==="video"?Tp.MUTE_LOCAL_VIDEO:Tp.MUTE_LOCAL_AUDIO;await Wn(this,dt.RequestP2PMuteLocal,{action:b,message:R,isMuteAll:v}),s()}catch(g){o(g)}finally{u()}}),V(this,"handleUnmuteLocalTrack",async(n,s,o)=>{let u=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Tn.Connected)return void o(new _e(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));let d=this.filterTobeUnmutedTracks(n);if(d.length===0)return void s();await this.sendConnection.unmuteLocal(d.map(y=>{let[,{id:v}]=y;return v}));let f=this.createUnmuteMessage(d),g=n.trackMediaType==="video"?Tp.UNMUTE_LOCAL_VIDEO:Tp.UNMUTE_LOCAL_AUDIO;await Wn(this,dt.RequestP2PMuteLocal,{action:g,message:f}),s()}catch(d){o(d)}finally{u()}}),V(this,"handleUpdateVideoEncoder",async(n,s,o,u)=>{let d;typeof u=="boolean"&&u||(d=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{let g=this.localTrackMap.get(De.LocalVideoTrack);if(!this.sendConnection||!g||g.track!==n||this.state!==Tn.Connected)return void s();let{id:y,track:v}=g;y&&(await this.sendConnection.updateSendParameters(y,v),await this.sendConnection.updateEncoderConfig(y,v),this.emit(dt.UpdateVideoEncoder,v)),s()}catch(g){o(g)}finally{var f;(f=d)===null||f===void 0||f()}}),V(this,"handleUpdateVideoSendParameters",async(n,s,o)=>{let u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{let d=this.localTrackMap.get(De.LocalVideoTrack);if(!this.sendConnection||!d||d.track!==n||this.state!==Tn.Connected)return void s();let{id:f,track:g}=d;f&&await this.sendConnection.updateSendParameters(f,g),s()}catch(d){o(d)}finally{u()}}),V(this,"handleReplaceTrack",async(n,s,o,u)=>{let d;k.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof u=="boolean"&&u||(d=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var f;let y=Array.from(this.localTrackMap.entries()).find(v=>{let[,{track:R}]=v;return n===R});if(!this.sendConnection||!y||y[1].id===void 0||this.state!==Tn.Connected)return void s();if(await((f=this.sendConnection)===null||f===void 0?void 0:f.replaceTrack(n,y[1].id)),y[0]===De.LocalVideoTrack&&Qt().supportDualStreamEncoding){let v=this.localTrackMap.get(De.LocalVideoLowTrack);if(v){let R=n._mediaStreamTrack.clone();v.track._originMediaStreamTrack.stop(),v.track._mediaStreamTrack=R,v.track._originMediaStreamTrack=R,await new We((b,A)=>{this.handleReplaceTrack(v.track,b,A,!0)})}}s()}catch(y){o(y)}finally{var g;(g=d)===null||g===void 0||g()}}),V(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),V(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),V(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),V(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new Y8(e),this.bindStatsUploaderEvents(),this.sendMutex=new ki("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new ki("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},z("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new _e(Y.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new _e(Y.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(k.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new vz(e,this.store,Ys.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);let s=await this.recvConnection.establish(t);return{iceParameters:s.iceParameters,dtlsParameters:s.dtlsParameters,sdp:s.sdp}}{this.state=Tn.New,this.sendConnection&&(k.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new vz(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);let s=await this.sendConnection.establish();return{iceParameters:s.iceParameters,dtlsParameters:s.dtlsParameters,sdp:s.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new _e(Y.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Tn.Connected}async addRemoteCandidate(e,t){if(t===Ys.RECEIVE_ONLY){if(!this.sendConnection)throw new _e(Y.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new _e(Y.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var s=this;return aa(function*(){let o=yield Ft(s.sendMutex.lock("From P2PChannel.publish"));try{if(!s.sendConnection||s.state!==Tn.Connected){s.throwIfTrackTypeNotMatch(e);let y=e.filter(v=>s.pendingLocalTracks.indexOf(v)===-1);return void(s.pendingLocalTracks=s.pendingLocalTracks.concat(y))}s.store.pubId=s.store.pubId+1,fs.markPublishStart(s.store.clientId,s.store.pubId);let u=s.filterTobePublishedTracks(e,t,n);if(u.length===0)return void(yield Ft(s.tryToUnmuteAudio(e)));u.forEach(y=>{let{track:v,type:R}=y,b=Date.now();s.store.publish(v.getTrackId(),R===De.LocalAudioTrack?"audio":"video",b)}),s.bindLocalTrackEvents(u);let d=yield Ft(s.sendConnection.send(u.map(y=>{let{track:v}=y;return v}),s.store.codec,s.store.audioCodec)),f=(yield Ft(d.next())).value,g=s.createGatewayPublishMessage(u,f);try{yield g}catch(y){throw d.throw(y),y?.code===Y.WS_ABORT&&u.forEach(v=>{let{track:R}=v;s.pendingLocalTracks.indexOf(R)===-1&&s.pendingLocalTracks.push(R)}),s.unbindLocalTrackEvents(u),y}yield Ft(d.next()),u.forEach(y=>{let{type:v}=y;s.statsCollector.addLocalStats(v)}),s.statsUploader.startUploadOutboundStats(),s.assignLocalTracks(u,f),u.forEach(y=>{let{track:v,type:R}=y,b=Date.now();s.store.publish(v.getTrackId(),R===De.LocalAudioTrack?"audio":"video",void 0,b)}),s.startUploadUplinkState()}finally{o()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Tn.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(o=>!ke(e).call(e,o)));let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let n=t.find(o=>o[0]==="videoLowTrack");n&&n[1].track.close();let s=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(o=>{let[,{id:u}]=o;return u})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(o=>{let[u,{track:d}]=o;return{type:u,track:d}})),t.forEach(o=>{let[u]=o;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Tn.Connected)return n&&n[1].track.close(),s;e.forEach(o=>{let u=this.pendingLocalTracks.indexOf(o);u!==-1&&this.pendingLocalTracks.splice(u,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);let e=()=>{let t=[],n=[];Array.from(this.localTrackMap.entries()).forEach(s=>{let[o,{track:u,ssrcs:d}]=s,f={stream_type:Che(u,o),ssrcs:d};u._muted||!u._enabled?t.push(f):n.push(f)}),t.length>0&&t.forEach(s=>{Wn(this,dt.RequestMuteLocal,[s])}),n.length>0&&n.forEach(s=>{Wn(this,dt.RequestUnmuteLocal,[s])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return aa(function*(){throw new _e(Y.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(k.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ei(this,dt.RequestRePublish,this.pendingLocalTracks),this.emit(dt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new _e(Y.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,s){var o;if(!this.recvConnection)throw new _e(Y.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((o=this.remoteUserMap.get(e))!==null&&o!==void 0&&o.has(t))return;let{track:u,mid:d,transceiver:f}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),s);t===et.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(u):(e._audioTrack=new FE(u,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),f&&e._audioTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(u):(e._videoTrack=new VE(u,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),f&&e._videoTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(e,e._videoTrack));let g=this.remoteUserMap.get(e);g?g.set(t,d):this.remoteUserMap.set(e,new Map([[t,d]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();let y=this.pendingRemoteTracks.findIndex(v=>{let{user:R,kind:b}=v;return R.uid===e.uid&&t===b});y!==-1&&(this.pendingRemoteTracks.splice(y,1),this.emit(dt.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,s){if(!this.recvConnection)throw new _e(Y.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),s)}async unsubscribe(e,t,n){let s=this.pendingRemoteTracks.filter(u=>{let{user:d,kind:f}=u;return t!==void 0?d.uid===e.uid&&t===f:d.uid===e.uid});if(s.forEach(u=>{let d=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(d,1)}),this.recvConnection||n||s.forEach(u=>{let{kind:d}=u;var f;if(d===et.AUDIO)(f=e._audioTrack)===null||f===void 0||f._destroy(),e._audioTrack=void 0;else if(d===et.VIDEO){var g;(g=e._videoTrack)===null||g===void 0||g._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;let o=this.filterTobeUnSubscribedTracks(e,t);o.length!==0&&(await this.recvConnection.stopReceiving(o.map(u=>{let[,{id:d}]=u;return d})),this.withdrawRemoteTracks(o),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),o.forEach(u=>{let[d,{kind:f}]=u;var g,y;if(f===et.VIDEO&&d._videoSSRC&&((g=this.recvConnection)===null||g===void 0||g.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),f===et.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),n||((y=d._videoTrack)===null||y===void 0||y._destroy(),d._videoTrack=void 0);else if(f===et.AUDIO){var v;this.unbindRemoteTrackEvents(d._audioTrack),!n&&((v=d._audioTrack)===null||v===void 0||v._destroy(),d._audioTrack=void 0)}}),o.forEach(u=>{let[,{kind:d}]=u;Wn(this,dt.RequestP2PMuteRemote,d)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,n]=t;[et.VIDEO,et.AUDIO].forEach(s=>{n.has(s)?Wn(this,dt.RequestP2PUnmuteRemote,s):Wn(this,dt.RequestP2PMuteRemote,s)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new _e(Y.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new _e(Y.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new _e(Y.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new _e(Y.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;let n=this.remoteUserMap.get(e);if(!n)return void k.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void k.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let s=t===et.VIDEO?e._videoSSRC:e._audioSSRC;s!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;let n=this.remoteUserMap.get(e);if(!n)return void k.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||k.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){let t=this.localTrackMap.get(De.LocalAudioTrack);if(t?.track instanceof oi){let n=t.track;return Array.from(this.localTrackMap.entries()).filter(s=>{let[o]=s;return o!==De.LocalAudioTrack}).filter(s=>{let[o]=s;return!(e&&o===De.LocalVideoLowTrack)}).map(s=>{let[,{track:o}]=s;return o}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[s]=n;return!(e&&s===De.LocalVideoLowTrack)}).map(n=>{let[,{track:s}]=n;return s})}reportPublishEvent(e,t,n,s,o){if(e){let d=this.localTrackMap.get(De.LocalAudioTrack),f=s?this.localTrackMap.get(De.LocalVideoLowTrack):this.localTrackMap.get(De.LocalVideoTrack);tt.publish(this.store.sessionId,{eventElapse:fs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d?.track.getTrackLabel(),videoName:f?.track.getTrackLabel(),screenshare:f?.track._hints.indexOf(bn.SCREEN_TRACK)!==-1,audio:!!d,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}else{var u;n||(n=[]);let d=n.find(g=>g instanceof Nr),f=s?(u=this.localTrackMap.get(De.LocalVideoTrack))===null||u===void 0?void 0:u.track:n.find(g=>g instanceof jn);tt.publish(this.store.sessionId,{eventElapse:fs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d?.getTrackLabel(),videoName:f?.getTrackLabel(),screenshare:f?._hints.indexOf(bn.SCREEN_TRACK)!==-1,audio:!!d,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}}reportSubscribeEvent(e,t,n,s){let o=s===et.VIDEO?n._videoSSRC:n._audioSSRC;o&&tt.subscribe(this.store.sessionId,{succ:e,ec:t,video:s===et.VIDEO,audio:s===et.AUDIO,peerid:n.uid,subscribeRequestid:s===et.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:fs.measureFromSubscribeStart(this.store.clientId,o)})}reset(){k.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new ki("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new ki("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(De.LocalAudioTrack);if(e?.track instanceof oi){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Tn.Disconnected}getStats(e){var t,n;return e?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(De.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(De.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof jn||t&&t.track instanceof Nr?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;let n=Array.from(ys(t=this.remoteUserMap).call(t)).find(s=>s.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[s]=n;return{uid:s.uid,level:s.audioTrack?100*s.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(De.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=vm(e).call(e,(n,s)=>n.level-s.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(k.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Tn.Reconnecting,z("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:s}]=e;switch(n){case De.LocalVideoTrack:ke(t=s._hints).call(t,bn.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case De.LocalAudioTrack:s instanceof oi?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case De.LocalVideoLowTrack:}}),this.emit(dt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(ys(n).call(n)).forEach(s=>{this.setPendingRemoteMedia(t,s)}),this.emit(dt.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),k.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(let n of this.pendingRemoteTracks){let{user:s,kind:o}=n;if((e instanceof Rp?e.uid:e)===s.uid&&t===o)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,s;if(e===Ys.SEND_ONLY){if(!this.sendConnection)throw new _e(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),s=this.sendConnection}else{if(!this.recvConnection)throw new _e(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),s=this.recvConnection}try{if(t){let o=await s.restartICE(t);return s.isInRestartIce=!1,o}{let o=await s.restartICE();if(o){let u=await ei(this,dt.RequestP2PRestartICE,{direction:Ys.RECEIVE_ONLY,iceParameter:o});await s.restartICE(u),s.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;let e=this.sendConnection.getStats(),t=this.localTrackMap.get(De.LocalVideoTrack),n=this.localTrackMap.get(De.LocalAudioTrack),s=e.videoSend.find(A=>{var F;return A.ssrc===(t==null||(F=t.ssrcs)===null||F===void 0?void 0:F[0].ssrcId)}),o=e.audioSend.find(A=>{var F;return A.ssrc===(n==null||(F=n.ssrcs)===null||F===void 0?void 0:F[0].ssrcId)});if(!s||!o)return 1;let u=qa(this,dt.NeedSignalRTT),d=s?s.rttMs:void 0,f=o?o.rttMs:void 0,g=d&&f?(d+f)/2:d||f,y=(g&&u?(g+u)/2:g||u)||0,v=100*e.sendPacketLossRate*.7/50+.3*y/1500,R=v<.17?1:v<.36?2:v<.59?3:v<.1?4:5,b=t?.track;if(b&&b._encoderConfig&&b._hints.indexOf(bn.SCREEN_TRACK)===-1){let A=b._encoderConfig.bitrateMax,F=e.bitrate.actualEncoded;if(A&&F){let M=(1e3*A-F)/(1e3*A);return UW[M<.15?0:M<.3?1:M<.45?2:M<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;let e=this.recvConnection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[s]=n,o=s._audioSSRC,u=s._videoSSRC,d=e.audioRecv.find(F=>F.ssrc===o),f=e.videoRecv.find(F=>F.ssrc===u);if(!d&&!f)return void(t+=1);let g=qa(this,dt.NeedSignalRTT),y=e.rtt,v=(y&&g?(y+g)/2:y||g)||0,R=d?d.jitterMs:void 0,b=e.recvPacketLossRate,A=.7*b*100/50+.3*v/1500;R&&(A=.6*b*100/50+.2*v/1500+.2*R/400),t+=A<.1?1:A<.17?2:A<.36?3:A<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new We((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){let s=[],o=Qt(),u=this.getAllTracks();e=RE(e=e.filter(g=>u.indexOf(g)===-1));let d=!1,f=!1;for(let g of e){if(g instanceof jn&&(this.localTrackMap.has(De.LocalVideoTrack)||d?new _e(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:g,type:De.LocalVideoTrack}),d=!0),t)){let y=this.getLowVideoTrack(g,n);s.push({track:y,type:De.LocalVideoLowTrack})}if(g instanceof Nr){let y=this.localTrackMap.get(De.LocalAudioTrack);if(y){if(!(y.track instanceof oi))throw new _e(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new _e(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");y.track.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0)}else if(f){let v=s.find(R=>{let{type:b}=R;return b===De.LocalAudioTrack});if(!(v.track instanceof oi))throw new _e(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new _e(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(g)}else{if(!o.webAudioMediaStreamDest||g instanceof oi||g._bypassWebAudio)s.push({track:g,type:De.LocalAudioTrack});else{let v=new oi;v.addAudioTrack(g),s.push({track:v,type:De.LocalAudioTrack})}f=!0}}}return s}filterTobeUnpublishedTracks(e){let t=[],n=this.getAllTracks();e=RE(e=e.filter(s=>n.indexOf(s)!==-1));for(let s of e){if(s instanceof Nr){let o=this.localTrackMap.get(De.LocalAudioTrack);if(!o)continue;o.track instanceof oi?(o.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),o.track.trackList.length===0&&(t.push([De.LocalAudioTrack,o]),o.track.close())):t.push([De.LocalAudioTrack,o])}if(s instanceof jn){let o=this.localTrackMap.get(De.LocalVideoTrack);if(!o)continue;t.push([De.LocalVideoTrack,o]);let u=this.localTrackMap.get(De.LocalVideoLowTrack);u&&t.push([De.LocalVideoLowTrack,u])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:s}=t;switch(s){case De.LocalVideoTrack:n.addListener(nt.GET_STATS,this.handleGetLocalVideoStats),n.addListener(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(nt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(nt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case De.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case De.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof oi?e.trackList.forEach(n=>{n.addListener(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(nt.GET_STATS,this.handleGetLocalAudioStats),n.addListener(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(nt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(nt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:s}]=t;return{track:s,type:n}})),e.forEach(t=>{let{track:n,type:s}=t;switch(s){case De.LocalVideoTrack:n.off(nt.GET_STATS,this.handleGetLocalVideoStats),n.off(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(nt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(nt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case De.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case De.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof oi?e.trackList.forEach(t=>{t.off(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(nt.GET_STATS,this.handleGetLocalAudioStats),t.off(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(nt.GET_STATS,this.handleGetLocalAudioStats),e.off(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof VE&&t.addListener(nt.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof FE&&t.addListener(nt.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(nt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(et.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(et.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,s)=>{var o;let u,{track:d,type:f}=n;switch(f){case De.LocalAudioTrack:u=On.Audio;break;case De.LocalVideoTrack:u=ke(o=d._hints).call(o,bn.SCREEN_TRACK)?On.Screen:On.High;break;case De.LocalVideoLowTrack:u=On.Low}return{kind:f===De.LocalAudioTrack?et.AUDIO:et.VIDEO,stream_type:u,mid:t[s].id,ssrcs:t[s].localSSRC,isMuted:d.muted||!d.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let s,[o,{track:u,ssrcs:d,id:f}]=t;switch(o){case De.LocalVideoTrack:s=ke(n=u._hints).call(n,bn.SCREEN_TRACK)?On.Screen:On.High;break;case De.LocalAudioTrack:s=On.Audio;break;case De.LocalVideoLowTrack:s=On.Low}return{stream_type:s,ssrcs:d,mid:f}})}assignLocalTracks(e,t){e.forEach((n,s)=>{let{track:o,type:u}=n;this.localTrackMap.set(u,{track:o,id:t[s].id,ssrcs:t[s].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(dt.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),ke(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&(t==="disconnected"&&await Ci(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),tt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Fn.TRACER}).onSuccess(),this.emit(dt.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;let s=Array.from(ys(n=this.remoteUserMap).call(n)).find(u=>u._audioSSRC===t);var o;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),(o=s.audioTrack)===null||o===void 0||o.emit($o.FIRST_FRAME_DECODED),tt.firstRemoteFrame(this.store.sessionId,ai.FIRST_AUDIO_DECODE,cr.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:fs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;let s=Array.from(ys(n=this.remoteUserMap).call(n)).find(o=>o._audioSSRC===t);s&&tt.firstRemoteFrame(this.store.sessionId,ai.FIRST_AUDIO_RECEIVED,cr.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:fs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,s)=>{this.reportVideoFirstFrameDecoded(t,n,s)},e.onFirstVideoReceived=t=>{var n;let s=Array.from(ys(n=this.remoteUserMap).call(n)).find(o=>o._videoSSRC===t);s&&tt.firstRemoteFrame(this.store.sessionId,ai.FIRST_VIDEO_RECEIVED,cr.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:fs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{let s=t.candidateType==="relay",o=n.candidateType==="relay";n.candidateType!=="unknown"&&s===o||this.emit(dt.ConnectionTypeChange,s),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(wp(n))," -> ").concat(JSON.stringify(wp(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(wp(n))," -> ").concat(JSON.stringify(wp(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(dt.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){let t=e===Ys.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,k.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Ys.SEND_ONLY?this.restartICE(e):ei(this,dt.RequestP2PRestartICE,{direction:Ys.SEND_ONLY}))}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let n=this.localTrackMap.get(De.LocalAudioTrack);if(e instanceof Nr&&n?.track instanceof oi)return n.track.isActive||t.push([De.LocalAudioTrack,n]),t;let s=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:u}]=o;return e===u});if(s&&(t.push(s),s[0]===De.LocalVideoTrack)){let o=this.localTrackMap.get(De.LocalVideoLowTrack);o&&t.push([De.LocalVideoLowTrack,o])}return t}filterTobeUnmutedTracks(e){let t=[],n=this.localTrackMap.get(De.LocalAudioTrack);if(e instanceof Nr&&n?.track instanceof oi)return n.track.isActive&&t.push([De.LocalAudioTrack,n]),t;let s=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:u}]=o;return e===u});if(s)if(s[0]===De.LocalVideoTrack){t.push(s);let o=this.localTrackMap.get(De.LocalVideoLowTrack);o&&t.push([De.LocalVideoLowTrack,o])}else t.push(s);return t}createMuteMessage(e){return e.map(t=>{var n;let s,[o,{track:u,ssrcs:d,id:f}]=t;switch(o){case De.LocalAudioTrack:s=On.Audio;break;case De.LocalVideoTrack:s=ke(n=u._hints).call(n,bn.SCREEN_TRACK)?On.Screen:On.High;break;case De.LocalVideoLowTrack:s=On.Low}return{stream_type:s,ssrcs:d,mid:f}})}createUnmuteMessage(e){return e.map(t=>{var n;let s,[o,{track:u,ssrcs:d,id:f}]=t;switch(o){case De.LocalAudioTrack:s=On.Audio;break;case De.LocalVideoTrack:s=ke(n=u._hints).call(n,bn.SCREEN_TRACK)?On.Screen:On.High;break;case De.LocalVideoLowTrack:s=On.Low}return{stream_type:s,ssrcs:d,mid:f}})}filterTobeUnSubscribedTracks(e,t){let n=[],s=this.remoteUserMap.get(e);if(!s)return n;if(t){let o=s.get(t);if(!o)return n;n.push([e,{kind:t,id:o}])}else Array.from(s.entries()).forEach(o=>{let[u,d]=o;n.push([e,{kind:u,id:d}])});return n}createUnsubscribeMessage(e){let t=[];return e.forEach(n=>{let[s,{kind:o,id:u}]=n;switch(o){case et.VIDEO:return void(s._videoSSRC&&t.push({stream_type:et.VIDEO,ssrcId:s._videoSSRC}));case et.AUDIO:return void(s._audioSSRC&&t.push({stream_type:et.AUDIO,ssrcId:s._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:s}]=t,o=this.remoteUserMap.get(n);o&&(o.delete(s),Array.from(o.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(De.LocalVideoTrack),n=this.localTrackMap.get(De.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new We((s,o)=>{this.handleUpdateVideoEncoder(t.track,s,o,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new We((s,o)=>{this.handleUpdateVideoEncoder(n.track,s,o,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){let e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Nr){let n=this.filterTobeUnmutedTracks(e[t]);if(n.length===0)continue;let s=this.createUnmuteMessage(n);return void await Wn(this,dt.RequestUnmuteLocal,s)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(dt.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(dt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Ci(yb(this.dtlsFailedCount,Kr)),this.emit(dt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(De.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof jn)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof jn).length>1)throw new _e(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Nr).length>1&&(e.some(t=>t instanceof Nr&&t._bypassWebAudio)||!Qt().webAudioMediaStreamDest))throw new _e(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof jn&&this.pendingLocalTracks.some(n=>n instanceof jn))throw new _e(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Nr&&this.pendingLocalTracks.some(n=>n instanceof Nr)&&(!Qt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Nr&&n._bypassWebAudio)))throw new _e(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let n=!z("DISABLE_DUAL_STREAM_USE_ENCODING")&&Qt().supportDualStreamEncoding,s=UI(UI({},{width:160,height:120,framerate:15,bitrate:50}),t),o;o=n?e._mediaStreamTrack.clone():kD(e,s);let u=In(8,"track-low-"),d=new jn(o,UI(UI({},n&&{scaleResolutionDownBy:cD(s,e)}),{},{frameRate:s.framerate,bitrateMax:s.bitrate,bitrateMin:s.bitrate}),void 0,void 0,u);return d.on(Vm.TRANSCEIVER_UPDATED,f=>{e._updateRtpTransceiver(f,kE.LOW_STREAM)}),d._hints.push(bn.LOW_STREAM),e.addListener(nt.NEED_CLOSE,()=>{d.close()}),d}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,s){var o;let u=Array.from(ys(o=this.remoteUserMap).call(o)).find(d=>d._videoSSRC===e);if(u){s||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());let d=this.store.keyMetrics,f=d.subscribe.find(g=>g.userId===u.uid&&g.type==="video");tt.firstRemoteVideoDecode(this.store.sessionId,ai.FIRST_VIDEO_DECODE,cr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:t,videoheight:n,subscribeElapse:fs.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:d.requestAPEnd||0,apStart:d.requestAPStart||0,joinGwEnd:d.joinGatewayEnd||0,joinGwStart:d.joinGatewayStart||0,pcEnd:d.peerConnectionEnd||0,pcStart:d.peerConnectionStart||0,subscriberEnd:f?.subscribeEnd||0,subscriberStart:f?.subscribeStart||0,videoAddNotify:f?.streamAdded||0,state:s?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;let s=this.remoteUserMap.get(e);if(!s)return!1;let o=s.get(t);if(!o)return!1;let u=await this.recvConnection.getRemoteSSRC(o);return u!==void 0&&u!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new _e(Y.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new _e(Y.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new _e(Y.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new _e(Y.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new _e(Y.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new _e(Y.NOT_SUPPORTED)}async preConnect(e){throw new _e(Y.NOT_SUPPORTED)}getEstablishParams(){throw new _e(Y.NOT_SUPPORTED)}async reSubscribe(e){throw new _e(Y.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new _e(Y.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===De.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,kE.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},ze(hr.prototype,"p2pConnect",[Sz],Object.getOwnPropertyDescriptor(hr.prototype,"p2pConnect"),hr.prototype),ze(hr.prototype,"unpublish",[Tz],Object.getOwnPropertyDescriptor(hr.prototype,"unpublish"),hr.prototype),ze(hr.prototype,"unpublishLowStream",[wz],Object.getOwnPropertyDescriptor(hr.prototype,"unpublishLowStream"),hr.prototype),ze(hr.prototype,"subscribe",[Cz],Object.getOwnPropertyDescriptor(hr.prototype,"subscribe"),hr.prototype),ze(hr.prototype,"mockSubscribe",[Rz],Object.getOwnPropertyDescriptor(hr.prototype,"mockSubscribe"),hr.prototype),ze(hr.prototype,"unsubscribe",[bz],Object.getOwnPropertyDescriptor(hr.prototype,"unsubscribe"),hr.prototype),ze(hr.prototype,"muteRemote",[Iz],Object.getOwnPropertyDescriptor(hr.prototype,"muteRemote"),hr.prototype),ze(hr.prototype,"unmuteRemote",[Az],Object.getOwnPropertyDescriptor(hr.prototype,"unmuteRemote"),hr.prototype),ze(hr.prototype,"hasRemoteMediaWithLock",[Oz],Object.getOwnPropertyDescriptor(hr.prototype,"hasRemoteMediaWithLock"),hr.prototype),ze(hr.prototype,"disconnectForReconnect",[Nz],Object.getOwnPropertyDescriptor(hr.prototype,"disconnectForReconnect"),hr.prototype),ze(hr.prototype,"remoteMediaSsrcChanged",[Pz],Object.getOwnPropertyDescriptor(hr.prototype,"remoteMediaSsrcChanged"),hr.prototype),hr);function $l(e){return function(t,n,s){let o=t[n];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){for(var u=arguments.length,d=new Array(u),f=0;f<u;f++)d[f]=arguments[f];switch(e){case Jl.SEND_ONLY:{let g=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await o.apply(this,d)}finally{g()}}case Jl.RECEIVE_ONLY:{let g=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await o.apply(this,d)}finally{g()}}default:{let g=await this.sendMutex.lock("From P2PChannel2.".concat(n)),y=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await o.apply(this,d)}finally{g(),y()}}}},s}}class sg extends dr{constructor(t,n){super(),V(this,"signal",void 0),V(this,"token",void 0),V(this,"tokenTimeout",void 0),V(this,"tokenInterval",void 0),V(this,"_sequence",0),V(this,"userMap",new Map),V(this,"encoder",new TextEncoder),this.signal=t,this.token=n;let s=()=>{this.signal.connectionState===nn.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(s,1e3):this.tokenInterval=window.setTimeout(s,3*z("P2P_TOKEN_INTERVAL"))};s()}async send(t,n,s,o,u){var d;if(this.userMap.size===0)return;let f=Array.from(za(d=this.userMap).call(d))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),o=o??In(6,""),u=u??this._sequence++;let g={_id:o,_type:t,_seq:u,_message:n,token:"".concat(this.token,"_").concat(f)};z("SHOW_P2P_LOG")&&k.debug("send message",g,"noNeedResponse : ".concat(s)),this.splitMessage(JSON.stringify(g)).forEach(v=>{this.signal.request(ct.DATA_STREAM,{payload:Ep(this.encoder.encode(v))})});let y=new We((v,R)=>{let b=window.setTimeout(()=>{this.off("res-@".concat(o,"_ack"),A),this.off("res-@".concat(o),M),this.off(HE.ABORT,F),k.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(o)),this.userMap.size===0?R(new _e(Y.INVALID_REMOTE_USER)):R(new _e(Y.TIMEOUT))},z("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),A=()=>{b&&window.clearTimeout(b),this.off(HE.ABORT,F),s&&v()},F=()=>{b&&window.clearTimeout(b),this.off("res-@".concat(o,"_ack"),A),this.off("res-@".concat(o),M),R(new _e(Y.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(o)))};this.once(HE.ABORT,F),this.once("res-@".concat(o,"_ack"),A);let M=(K,q)=>{j=!0,b&&window.clearTimeout(b),this.off("res-@".concat(o,"_ack"),A),this.off(HE.ABORT,F),K==="success"?v(q):R(new _e(Y.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(o)))},j=!1;s||(this.once("res-@".concat(o),M),Ci(z("SIGNAL_REQUEST_TIMEOUT")).then(()=>{j||k.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(o,", ").concat(g))}))});try{return await y}catch(v){if(v.code===Y.TIMEOUT)return await this.send(t,n,s,o,u);throw v}}onMessage(t){var n;let{_uid:s}=t,o,u=this.userMap.get(s);if(u)o=u.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Fr.CHECK)return;let{token:y}=t;o=new Map,u={uid:s,isStart:!0,token:y,splitMessageMap:o,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(s,u),this.signal.emit(wt.ON_USER_ONLINE,{uid:s}),this.handleUserOnline()}if("id"in t&&"total"in t){var d;let{id:y,total:v}=t,R=(d=o.get(y))!==null&&d!==void 0?d:[];if(R.push(t),o.has(y)||o.set(y,R),R.length!==v)return;{let b=vm(R).call(R,(A,F)=>A.index-F.index).map(A=>A.payload).join("");o.delete(y),(t=JSON.parse(b))._uid=s}}let{_type:f,token:g}=t;if(ke(n=[Fr.ACK,Fr.CHECK]).call(n,f))return f===Fr.CHECK&&this.handleCheckToken(u,g),void this.receiveMessage(t);g==="".concat(u.token,"_").concat(this.token)?this.handleReceivedMessage(t):k.debug('Receive unexpected message", '.concat(g,", cur_token: ").concat(u.token,"_").concat(this.token),t)}check(){let t={_id:In(6,""),token:this.token,_type:Fr.CHECK};z("SHOW_P2P_LOG")&&k.debug("send message",t),this.signal.request(ct.DATA_STREAM,{payload:Ep(this.encoder.encode(JSON.stringify(t)))})}ack(t){let n={_id:t,_type:Fr.ACK,token:this.token};z("SHOW_P2P_LOG")&&k.debug("send message",n),this.signal.request(ct.DATA_STREAM,{payload:Ep(this.encoder.encode(JSON.stringify(n)))})}response(t,n,s){this.send(Fr.RESPONSE,JSON.stringify({success:!s,message:n}),!0,t)}handleReceivedMessage(t){let n=()=>{this.userMap.forEach(y=>{let{receivedMessagesMap:v,nextExpectedSequenceNumber:R}=y;for(;v.has(R);){let b=v.get(R);v.delete(R),this.receiveMessage(b),y.nextExpectedSequenceNumber++}})};if(!t)return void n();let{_uid:s,_seq:o}=t,u=this.userMap.get(s),{receivedMessagesMap:d,isStart:f,nextExpectedSequenceNumber:g}=u;if(o<g)return this.ack(t._id),void k.debug("[external-signal] receive old message, seq: ".concat(o,", ").concat(t._message));d.set(o,t),f&&o===g&&(this.receiveMessage(t),d.delete(g),u.nextExpectedSequenceNumber++,n())}receiveMessage(t){let{_id:n,_type:s,_message:o,_uid:u}=t;if(z("SHOW_P2P_LOG")&&k.debug("receive message",t),n){let d;switch(t._type!==Fr.ACK&&(o&&(d=JSON.parse(o)),this.ack(t._id)),t._type){case Fr.CANDIDATE:case Fr.CONTROL:this.signal.emit(s,d,u);break;case Fr.PUBLISH:case Fr.UNPUBLISH:case Fr.RESTART_ICE:case Fr.CALL:d.uid=u,ei(this.signal,s,d).then(f=>{this.response(t._id,f)}).catch(()=>{this.response(t._id,void 0,!0)});break;case Fr.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case Fr.RESPONSE:{let{success:f,message:g}=d;this.emit("res-@".concat(n),f?"success":"failed",g);break}}}}splitMessage(t){if(t.length<sg.MAX_MESSAGE_SIZE)return[t];let n=[],{remoteToken:s}=JSON.parse(t),o=In(6,""),u=0,d=800,f=Math.ceil(t.length/d);for(;t.length>0;){u++;let g={id:o,index:u,total:f,payload:t.slice(0,d),token:"".concat(this.token,"_").concat(s)};JSON.stringify(g).length>sg.MAX_MESSAGE_SIZE?d-=50:(n.push(g),t=t.slice(d))}return n.map(g=>JSON.stringify(g))}handleCheckToken(t,n){return t.token!==n?(k.debug("token changed, from ".concat(t.token," to ").concat(n)),this.reset(t.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{k.debug("token timeout, ".concat(n)),this.reset(t.uid)},z("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){let t=await ei(this.signal,Fr.CALL,void 0),n=await this.send(Fr.CALL,t);this.signal.emit(rt.P2P_CONNECTION,n,!0)}async reset(t,n){let s=this.userMap.get(t);s&&(this.emit(HE.ABORT),this.signal.emit(wt.ON_USER_OFFLINE,{uid:s.uid,reason:Qde.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(k.debug("change local token from ".concat(n," to ").concat(n)),this.token=In(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(HE.ABORT)}}V(sg,"MAX_SIZE",1),V(sg,"MAX_MESSAGE_SIZE",1024);class Vfe extends dr{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===nn.CONNECTED?this.emit(rt.WS_CONNECTED):t===nn.RECONNECTING?this.emit(rt.WS_RECONNECTING,this._websocketReconnectReason):t===nn.CLOSED&&this.emit(rt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),V(this,"__name__","P2PSignal"),V(this,"_disconnectedReason",void 0),V(this,"_websocketReconnectReason",void 0),V(this,"_connectionState",nn.CLOSED),V(this,"reconnectToken",void 0),V(this,"p2pToken",void 0),V(this,"websocket",void 0),V(this,"openConnectionTime",void 0),V(this,"clientId",void 0),V(this,"lastMsgTime",Date.now()),V(this,"uploadCache",[]),V(this,"uploadCacheInterval",void 0),V(this,"rttRolling",new dk(5)),V(this,"pingpongTimer",void 0),V(this,"pingpongTimeoutCount",0),V(this,"joinResponse",void 0),V(this,"multiIpOption",void 0),V(this,"initError",void 0),V(this,"spec",void 0),V(this,"store",void 0),V(this,"_external_signal",void 0),V(this,"onWebsocketMessage",s=>{if(s.data instanceof ArrayBuffer)return void this.emit(rt.ON_BINARY_DATA,s.data);let o=JSON.parse(s.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){let u="res-@".concat(o._id);this.emit(u,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")){switch(o._type){case wt.ON_DATA_STREAM:return void this.handleDataStream(o._message);case wt.MUTE_AUDIO:case wt.MUTE_VIDEO:case wt.ON_P2P_LOST:case wt.ON_USER_ONLINE:return;case wt.ON_USER_OFFLINE:let{uid:u}=o._message;return k.debug("[".concat(this.clientId,"] user-offline uid: ").concat(u)),void this._external_signal.reset(u)}if(this.emit(o._type,o._message),o._type===wt.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===wt.ON_USER_BANNED)switch(o._message.error_code){case 14:this.close(tn.UID_BANNED);break;case 15:this.close(tn.IP_BANNED);break;case 16:this.close(tn.CHANNEL_BANNED)}if(o._type===wt.ON_USER_LICENSE_BANNED)switch(o._message.error_code){case pt.ERR_LICENSE_MISSING:this.close(tn.LICENSE_MISSING);break;case pt.ERR_LICENSE_EXPIRED:this.close(tn.LICENSE_EXPIRED);break;case pt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(tn.LICENSE_MINUTES_EXCEEDED);break;case pt.ERR_LICENSE_PERIOD_INVALID:this.close(tn.LICENSE_PERIOD_INVALID);break;case pt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(tn.LICENSE_MULTIPLE_SDK_SERVICE);break;case pt.ERR_LICENSE_ILLEGAL:this.close(tn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new sD("gateway-".concat(this.clientId),this.spec.retryConfig,!0,z("JOIN_GATEWAY_USE_DUAL_DOMAIN"),z("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===nn.CONNECTED&&this.reconnect("retry",ts.OFFLINE)}),this.p2pToken=In(6,""),this._external_signal=new sg(this,this.p2pToken)}async request(t,n,s,o){let u=In(6,""),d={_id:u,_type:t,_message:n},f=this.websocket.connectionID,g=()=>new We((F,M)=>{if(this.connectionState===nn.CONNECTED)return F();let j=()=>{this.off(rt.WS_CLOSED,K),F()},K=()=>{this.off(rt.WS_CONNECTED,j),M(new _e(Y.WS_ABORT))};this.once(rt.WS_CONNECTED,j),this.once(rt.WS_CLOSED,K)});if(this.connectionState!==nn.CONNECTING&&this.connectionState!==nn.RECONNECTING||t===ct.JOIN||t===ct.REJOIN||await g(),this.websocket.sendMessage(d,!0),o)return;let y=new We((F,M)=>{let j=!1,K=(Q,se)=>{j=!0,F({isSuccess:Q==="success",message:se||{}}),this.off(rt.WS_CLOSED,q),this.off(rt.WS_RECONNECTING,q),this.emit(rt.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(u),K);let q=()=>{M(new _e(Y.WS_ABORT,"type: ".concat(t))),this.off(rt.WS_CLOSED,q),this.off(rt.WS_RECONNECTING,q),this.off("res-@".concat(u),K)};this.once(rt.WS_CLOSED,q),this.once(rt.WS_RECONNECTING,q),Ci(z("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==f||j||(k.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(rt.REQUEST_TIMEOUT,t,n))})}),v=null;try{v=await y}catch(F){if(this.connectionState===nn.CLOSED||t===ct.LEAVE)throw new _e(Y.WS_ABORT);return!this.spec.forceWaitGatewayResponse||s?F.throw():t===ct.JOIN||t===ct.REJOIN?null:(await g(),await this.request(t,n))}if(v.isSuccess)return v.message;let R=Number(v.message.error_code||v.message.code),b=Km(R),A=new _e(Y.UNEXPECTED_RESPONSE,"".concat(b.desc,": ").concat(v.message.error_str),{code:R,data:v.message,desc:b.desc});return b.action==="success"?v.message:(k.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(R,", message: ").concat(b.desc,", action: ").concat(b.action)),R===pt.ERR_TOO_MANY_BROADCASTERS?((t===ct.JOIN||t===ct.REJOIN)&&(this.initError=A,this.close()),A.throw()):b.action==="failed"?A.throw():b.action==="quit"?(this.initError=A,this.close(),A.throw()):(R===pt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=v.message.option,k.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",ts.MULTI_IP)):this.reconnect(b.action,ts.SERVER_ERROR),t===ct.JOIN||t===ct.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new We(s=>{let o=u=>{(!n||n(u))&&(this.off(t,o),s(u))};this.on(t,o)})}uploadWRTCStats(t){if(!this.store.sessionId)return void k.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(zm.WRTC_STATS,n)}upload(t,n){let s={_type:t,_message:n};try{this.websocket.sendMessage(s)}catch{let o=z("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>o&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==nn.CONNECTED)return;let u=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(u._type,u._message)},z("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){let s={_type:t,_message:n};this.websocket.sendMessage(s)}async sendExtensionMessage(t,n,s){return await this._external_signal.send(t,n,s)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new We((n,s)=>{this.once(rt.WS_CONNECTED,()=>n(this.joinResponse)),this.once(rt.WS_CLOSED,()=>s(this.initError||new _e(Y.WS_ABORT))),this.connectionState=nn.CONNECTING,this.websocket.init(t).catch(s)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||tn.LEAVE,this.connectionState=nn.CLOSED,k.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=In(6,""),this._external_signal.clear(),this._external_signal=new sg(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(rt.ABORT_P2P_EXECUTION);let t=await ei(this,rt.REQUEST_JOIN_INFO),n=await this.request(ct.JOIN,t);if(!n)return this.emit(rt.REPORT_JOIN_GATEWAY,Y.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(rt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=nn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){return!1}handleDataStream(t){try{var n;let s=Dm(t.payload),o=new TextDecoder().decode(s),u=JSON.parse(o);"total"in u&&"id"in u||ke(n=Object.values(Fr)).call(n,u._type)?(u._uid=t.uid,this._external_signal.onMessage(u)):this.emit(wt.ON_DATA_STREAM,t)}catch{this.emit(wt.ON_DATA_STREAM,t)}}handleNotification(t){k.debug("[".concat(this.clientId,"] receive notification: "),t);let n=Km(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?t.code===pt.ERR_REPEAT_JOIN_CHANNEL&&z("IGNORE_UID_CHECK")?void this.close(tn.UID_CONFLICT):(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(tn.UID_BANNED),void this.close()):void this.reconnect(n.action,ts.SERVER_ERROR);k.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=z("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(k.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>z("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ts.TIMEOUT):this.request(ct.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let s=Date.now()-n;this.rttRolling.add(s),z("REPORT_STATS")&&this.send(ct.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleWebsocketEvents(){this.websocket.on(Ot.RECONNECT_CREATE_CONNECTION,t=>{this.emit(rt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Ot.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ot.CLOSED,()=>{this.connectionState=nn.CLOSED}),this.websocket.on(Ot.FAILED,()=>{this._disconnectedReason=tn.NETWORK_ERROR,this.connectionState=nn.CLOSED}),this.websocket.on(Ot.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===nn.CONNECTED?this.connectionState=nn.RECONNECTING:this.connectionState=nn.CONNECTING}),this.websocket.on(Ot.WILL_RECONNECT,(t,n,s)=>{t!=="retry"?(k.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):k.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),s(t)}),this.websocket.on(Ot.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(rt.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof _e&&t.code===Y.UNEXPECTED_RESPONSE&&t.data.code===pt.ERR_NO_AUTHORIZED)return k.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",ts.SERVER_ERROR);k.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ts.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Ot.REQUEST_NEW_URLS,(t,n)=>{ei(this,rt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(Ot.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(wt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}let Ffe={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new Ufe(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new Vfe(n,t)}};function Dz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function xz(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Dz(Object(n),!0).forEach(function(s){V(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Dz(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}class jfe{constructor(t){V(this,"sessionDesc",void 0),V(this,"localCapabilities",void 0),V(this,"rtpCapabilities",void 0),V(this,"candidates",void 0),V(this,"_originCandidates",void 0),V(this,"iceParameters",void 0),V(this,"dtlsParameters",void 0),V(this,"setup",void 0),V(this,"currentMidIndex",void 0),V(this,"cname",void 0),t=Qn(t);let{iceParameters:n,dtlsParameters:s,candidates:o,rtpCapabilities:u,setup:d,localCapabilities:f,sdkCodec:g,cname:y}=t,v=Hs(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=o,this._originCandidates=Qn(o),this.iceParameters=n,this.dtlsParameters=s,this.setup=d,this.localCapabilities=f,this.cname=y;for(let R=0;R<v.mediaDescriptions.length;R++){let b=v.mediaDescriptions[R];if(b.attributes.iceUfrag=n.iceUfrag,b.attributes.icePwd=n.icePwd,b.attributes.fingerprints=s.fingerprints,b.attributes.candidates=o,b.attributes.setup=d,b.media.mediaType==="video"){b.media.fmts=u.videoCodecs.map(M=>M.payloadType.toString(10));let A=u.videoCodecs.filter(M=>{var j,K;return(j=M.rtpMap)===null||j===void 0?void 0:ke(K=j.encodingName.toLowerCase()).call(K,g)}),F=u.videoCodecs.filter(M=>!ke(A).call(A,M));b.attributes.payloads=[...A,...F],b.attributes.extmaps=u.videoExtensions}b.media.mediaType==="audio"&&(b.media.fmts=u.audioCodecs.map(A=>A.payloadType.toString(10)),b.attributes.payloads=u.audioCodecs,b.attributes.extmaps=u.audioExtensions),v.mediaDescriptions[R]=this.mungMediaDesc(b)}this.sessionDesc=v,this.currentMidIndex=v.mediaDescriptions.length-1}toString(){return eh(this.sessionDesc)}send(t,n,s){let{ssrcs:o,ssrcGroups:u}=BT(n,this.cname),d=this.sessionDesc.mediaDescriptions.find(y=>t===et.VIDEO?y.media.mediaType==="video":y.media.mediaType==="audio"),f=o[0].attributes.label,g=o[0].attributes.mslabel;return d.attributes.ssrcs=d.attributes.ssrcs.concat(o),d.attributes.ssrcGroups=d.attributes.ssrcGroups.concat(u),{id:f,mslabel:g}}batchSend(t){return t.map(n=>{let{kind:s,ssrcMsg:o}=n;return this.send(s,o,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(n=>{let s=[],o=[],u=[];n.attributes.ssrcs.forEach(d=>{ke(t).call(t,d.attributes.label||"")?u.push(d):s.push(d)}),n.attributes.ssrcGroups.forEach(d=>{var f;ke(f=u.map(g=>g.ssrcId)).call(f,d.ssrcIds[0])||o.push(d)}),n.attributes.ssrcs=s,n.attributes.ssrcGroups=o})}mute(t){let n=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){let n=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(t,n,s){t.forEach((o,u)=>{let d=o._mediaStreamTrack,f=this.sessionDesc.mediaDescriptions.findIndex(y=>y.attributes.mid===d.kind),g=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[f],o);this.sessionDesc.mediaDescriptions[f]=g})}stopReceiving(t){}updateCandidates(t){let n=this._originCandidates.filter(o=>o.transport==="udp"),s=[];if(n.forEach(o=>{s.push(xz(xz({},o),{},{foundation:"tcpcandidate",priority:Number(o.priority)-1+"",transport:"tcp",port:Number(o.port)+90+""}))}),n.length!==0){switch(t){case Di.TCP_RELAY:this.candidates=s;break;case Di.UDP_TCP_RELAY:case Di.RELAY:this.candidates=[...n,...s];break;default:this.candidates=n}for(let o of this.sessionDesc.mediaDescriptions)o.attributes.candidates=this.candidates}}restartICE(t){t=Qn(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){let n=[];for(let s=0;s<t;s++)n.push((this.currentMidIndex+s+1).toString(10));return n}mungRecvMediaDsec(t,n){let s=Qn(t);return Ym(s,n),dD(s,n),s}updateRecvMedia(t,n){let s=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===t);if(s!==-1){let o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],n);this.sessionDesc.mediaDescriptions[s]=o}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,s){let o=this.sessionDesc.mediaDescriptions.find(d=>t===et.VIDEO?d.attributes.mid==="video":d.attributes.mid==="audio");if(o){let d=o.attributes.ssrcs.find(f=>f.attributes.label===n);var u;d&&(d.attributes.label=s,(u=d.attributes.msid)===null||u===void 0||u.replace(n,s))}}mungMediaDesc(t){let n=Qn(t);return uD(n),(function(s){let o=s.attributes.extmaps.find(u=>eI(u.extensionName));o&&s.attributes.extmaps.splice(s.attributes.extmaps.indexOf(o),1),s.attributes.payloads.forEach(u=>{let d=u.rtcpFeedbacks.findIndex(f=>f.type==="transport-cc");d!==-1&&u.rtcpFeedbacks.splice(d,1)})})(n),n}getSSRC(t){for(let n of this.sessionDesc.mediaDescriptions)for(let s of n.attributes.ssrcs)if(s.attributes.label===t)return[s]}}var Gn;function Lz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function VI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Lz(Object(n),!0).forEach(function(s){V(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Lz(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}let Bfe=(Gn=class U0 extends Xb{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return ke(n=Object.keys(Mm)).call(n,t)}))]}constructor(t,n){super(t,n),V(this,"store",void 0),V(this,"peerConnection",void 0),V(this,"remoteSDP",void 0),V(this,"initialOffer",void 0),V(this,"statsFilter",void 0),V(this,"useRTX",!1),V(this,"localCapabilities",void 0),V(this,"localCandidateCount",0),V(this,"allCandidatesReceived",!1),V(this,"establishPromise",void 0),V(this,"mutex",void 0),this.store=n,this.mutex=new ki("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(U0.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=wb(this.peerConnection,z("STATS_UPDATE_INTERVAL"),void 0,$n()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{let t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let n=ed(t.sdp),s=jT(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:z("FILTER_VIDEO_FEC"),filterAudioFec:z("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=s,this.initialOffer=t,VI(VI({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:s},offerSDP:t.sdp})}catch(t){throw new _e(Y.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new jfe(VI(VI({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));let n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(t,n){throw new _e(Y.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,n){var s=this;return aa(function*(){let o=yield Ft(s.mutex.lock());try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let u=t.map(b=>s.peerConnection.addTrack(b._mediaStreamTrack)),d=yield Ft(s.peerConnection.createOffer()),f=Hs(d.sdp),g=t.map(b=>{let A=b._mediaStreamTrack,F=f.mediaDescriptions.find(M=>M.attributes.mid===A.kind);if(!F)throw new Error("Cannot extract ssrc from mediaDescription.");return(function(M,j,K){let q=M.attributes.ssrcs.filter(se=>se.attributes.label===j),Q=M.attributes.ssrcGroups;if(q.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(Q&&q.length>1){let se=Q.find(oe=>oe.ssrcIds.indexOf(q[0].ssrcId)!==-1);return se?[{ssrcId:se.ssrcIds[0],rtx:K?se.ssrcIds[1]:void 0}]:[{ssrcId:q[0].ssrcId}]}return[{ssrcId:q[0].ssrcId}]})(F,A.id,s.useRTX)}),y;try{y=yield g}catch(b){throw u.forEach(A=>{Pi()&&A.replaceTrack(null),s.peerConnection.removeTrack(A)}),b}let v=s.mungSendOfferSDP(d.sdp,t);s.remoteSDP.receive(t,n,y);let R=s.remoteSDP.toString();return yield Ft(s.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield Ft(s.applySendEncodings(u,t)),yield Ft(s.peerConnection.setRemoteDescription({type:"answer",sdp:R})),t.map((b,A)=>{let F=b._mediaStreamTrack.id;return{localSSRC:g[A],id:F}})}catch(u){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{o()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let n=this.peerConnection.getSenders().filter(u=>{var d;return t.indexOf(((d=u.track)===null||d===void 0?void 0:d.id)||"")!==-1});if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(u=>{Pi()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)});let s=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);let o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,s,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{id:u,mslabel:d}=this.remoteSDP.send(t,n,o),f=new We((v,R)=>{let b=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(u)))},1e4),A=F=>{let M=pn();if((M.name==="Safari"&&Number(M.version)===11||Es())&&F.track.id!==u&&F.streams[0].id===d){var j;let K=F.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(t,u,F.track.id),this.peerConnection.removeEventListener("track",A),clearTimeout(b),void v(K)}if(F.track.id===u)return this.peerConnection.removeEventListener("track",A),clearTimeout(b),void v(F.track)};this.peerConnection.addEventListener("track",A)}),g=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:g});let y=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(y),{track:await f,id:u}}catch(u){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});let s=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(s)}catch(n){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let n=this.peerConnection.getSenders().filter(s=>{var o;return t.indexOf(((o=s.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map(s=>{if(Pi()&&s.track)s.track.enabled=!1;else{let o=s.getParameters();o.encodings.forEach(u=>u.active=!1),s.setParameters(o)}})}catch(n){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let n=this.peerConnection.getSenders().filter(u=>{var d;return t.indexOf(((d=u.track)===null||d===void 0?void 0:d.id)||"")!==-1});if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async u=>{if(Pi()&&u.track)u.track.enabled=!0;else{let d=u.getParameters();d.encodings.forEach(f=>f.active=!0),await u.setParameters(d)}});let s=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(s);let o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return aa(function*(){let s=yield Ft(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");let o=Qt().supportPCSetConfiguration;if(t===Di.RELAY&&!o)return;if(o){let y=n.peerConnection.getConfiguration(),v=t===Di.RELAY?"relay":"all";y.iceTransportPolicy!==v&&(k.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(y.iceTransportPolicy,"] to [").concat(v,"]")),y.iceTransportPolicy=v,n.peerConnection.setConfiguration(y))}t!==Di.RELAY&&n.remoteSDP.updateCandidates(t);let u=yield Ft(n.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let d=ed(u.sdp),{remoteIceParameters:f}=yield d.iceParameters;n.remoteSDP.restartICE(f);let g=n.remoteSDP.toString();yield Ft(n.peerConnection.setLocalDescription(u)),yield Ft(n.peerConnection.setRemoteDescription({type:"answer",sdp:g}))}catch(o){k.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),o)}finally{s()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let s=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(s.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);let u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new _e(Y.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(t,n){let s=this.peerConnection.getSenders().filter(o=>{var u;return((u=o.track)===null||u===void 0?void 0:u.id)===t});s.length===1&&await this.applySendEncodings(s,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){let s=this.peerConnection.getSenders().find(o=>{var u;return((u=o.track)===null||u===void 0?void 0:u.id)===n});s&&await s.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,n){throw new _e(Y.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new _e(Y.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},z("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Om(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...U0.turnServerConfigToIceServers(t.turnServer.servers)),z("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...U0.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){let n=[];return t.forEach(s=>{s.security?s.tcpport&&n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(t,n){var s;if(n||(n=this.peerConnection.getSenders().find(y=>{var v;return((v=y.track)===null||v===void 0?void 0:v.id)===t._mediaStreamTrack.id})),!n)return k.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Qt().supportSetRtpSenderParameters)return k.warn("Browser not support set rtp-sender parameters");let o={},u={};if(t instanceof jn)switch(t._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;default:o.degradationPreference="balanced"}if(z("DSCP_TYPE")&&qu()){var d;let y=z("DSCP_TYPE");ke(d=["very-low","low","medium","high"]).call(d,y)&&(u.networkPriority=y)}let f=n.getParameters(),g=(s=f.encodings)===null||s===void 0?void 0:s[0];g&&Object.assign(g,u),Object.assign(f,o),k.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(f.encodings))),await n.setParameters(f)}async applySendEncodings(t,n){try{if(!Qt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let s=0;s<t.length;s++){let o=t[s],u=n[s];o&&u&&await this.updateRtpSenderEncodings(u,o)}}catch{k.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n){let s=Hs(t);return n.forEach((o,u)=>{let d=o._mediaStreamTrack,f=s.mediaDescriptions.find(g=>g.attributes.mid===d.kind);f&&Ym(f,o)}),eh(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,s)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,s)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let n=this.remoteSDP.batchSend(t).map((u,d)=>{let{id:f,mslabel:g}=u,{kind:y}=t[d];return new We((v,R)=>{let b=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(f)))},1e4),A=F=>{let M=pn();if(M.name==="Safari"&&Number(M.version)===11&&F.track.id!==f&&F.streams[0].id===g){var j;let K=F.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(y,f,F.track.id),this.peerConnection.removeEventListener("track",A),clearTimeout(b),void v({track:K,id:f})}if(F.track.id===f)return this.peerConnection.removeEventListener("track",A),clearTimeout(b),void v({track:F.track,id:f})};this.peerConnection.addEventListener("track",A)})}),s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});let o=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(o),await We.all(n)}catch(n){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){return this.remoteSDP?this.remoteSDP.getSSRC(t)?.[0].ssrcId:void 0}setConfiguration(t){if(Qt().supportPCSetConfiguration){let n=U0.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},ze(Gn.prototype,"connect",[rc],Object.getOwnPropertyDescriptor(Gn.prototype,"connect"),Gn.prototype),ze(Gn.prototype,"stopSending",[rc],Object.getOwnPropertyDescriptor(Gn.prototype,"stopSending"),Gn.prototype),ze(Gn.prototype,"receive",[rc],Object.getOwnPropertyDescriptor(Gn.prototype,"receive"),Gn.prototype),ze(Gn.prototype,"stopReceiving",[rc],Object.getOwnPropertyDescriptor(Gn.prototype,"stopReceiving"),Gn.prototype),ze(Gn.prototype,"muteRemote",[rc],Object.getOwnPropertyDescriptor(Gn.prototype,"muteRemote"),Gn.prototype),ze(Gn.prototype,"unmuteRemote",[rc],Object.getOwnPropertyDescriptor(Gn.prototype,"unmuteRemote"),Gn.prototype),ze(Gn.prototype,"muteLocal",[rc],Object.getOwnPropertyDescriptor(Gn.prototype,"muteLocal"),Gn.prototype),ze(Gn.prototype,"unmuteLocal",[rc],Object.getOwnPropertyDescriptor(Gn.prototype,"unmuteLocal"),Gn.prototype),ze(Gn.prototype,"close",[rc],Object.getOwnPropertyDescriptor(Gn.prototype,"close"),Gn.prototype),ze(Gn.prototype,"updateEncoderConfig",[rc],Object.getOwnPropertyDescriptor(Gn.prototype,"updateEncoderConfig"),Gn.prototype),ze(Gn.prototype,"updateSendParameters",[rc],Object.getOwnPropertyDescriptor(Gn.prototype,"updateSendParameters"),Gn.prototype),ze(Gn.prototype,"replaceTrack",[rc],Object.getOwnPropertyDescriptor(Gn.prototype,"replaceTrack"),Gn.prototype),ze(Gn.prototype,"getRemoteSSRC",[rc],Object.getOwnPropertyDescriptor(Gn.prototype,"getRemoteSSRC"),Gn.prototype),Gn);function rc(e,t,n){let s=e[t];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){let o=this.mutex,u=await o.lock("Locking from P2PConnection.".concat(t));try{for(var d=arguments.length,f=new Array(d),g=0;g<d;g++)f[g]=arguments[g];return await s.apply(this,f)}finally{u()}},n}let Wfe={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new Bfe(n,t)}},Gfe={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Qt().supportWebRTCEncodedTransform)return void k.warning("browser not support audio encoded transform");if(Mb.has(e)||!e.track)return;let n={track:e.track};if(Qd()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");let o=null;try{o=e.createEncodedStreams()}catch(d){return void k.error("create audio-encoded-streams error",d&&d.message)}let u=new TransformStream({transform(d,f){n.controller||(n.controller=f),e.track&&e.track.id!==n.track.id&&(k.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",s),n.track=e.track,n.track.addEventListener("ended",s));let g=t.metadata&&t.metadata();g?(function(y,v){let{chunk:R,controller:b}=v,A=yp.METADATA;R.data=(function(F,M,j){let K=j.byteLength,q=K+Wk+OW,Q=jk+Bk+q,se=new ArrayBuffer(F.byteLength+Q),oe=new DataView(se);oe.setUint8(0,AW),oe.setUint16(1,q),oe.setUint8(3,M),oe.setUint16(4,K);for(let de=0;de<K;de++)oe.setUint8(6+de,j[de]);let ne=new Uint8Array(oe.buffer);return ne.set(new Uint8Array(F),Q),ne.buffer})(R.data,A,y),b.enqueue(R)})(g,{chunk:d,controller:f}):f.enqueue(d)}});o.readable.pipeThrough(u).pipeTo(o.writable)}else if(Pi()){if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");let o=Lb(),u=new MessageChannel;await new We(f=>o.onmessage=g=>{g.data==="registered"&&f(void 0)});let d=new RTCRtpScriptTransform(o,{name:"audio-metadata-tx",port:u.port2},[u.port2]);e.transform=d,await new We(f=>o.onmessage=g=>{g.data==="started"&&f(void 0)}),u.port1.onmessage=f=>{var g;if(f.data.transformed&&e.track&&((g=e.track)===null||g===void 0?void 0:g.id)!==n.track.id)k.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",s),n.track=e.track,n.track.addEventListener("ended",s);else if(f.data.getMetadata){let y=t.metadata&&t.metadata();y&&u.port1.postMessage({metadata:y})}},n.worker=o}function s(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",s)}let o=Mb.get(e);if(o){Mb.delete(e);try{var u,d;(u=o.controller)===null||u===void 0||u.terminate(),(d=o.worker)===null||d===void 0||d.terminate()}catch(f){k.warning(f&&f.message)}}}Mb.set(e,n),e.track.addEventListener("ended",s)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Qt().supportWebRTCEncodedTransform)return void k.warning("browser not support audio encoded transform");if(Wb.has(e))return;let n={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(Qd()&&!Es()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");$1(_n.CHROME,87,116)||(t.enableTopn=!1);let o=null;try{o=e.createEncodedStreams()}catch(d){return void k.error("create audio-encoded-streams error",d&&d.message)}let u=new TransformStream({transform(d,f){n.controller||(n.controller=f),e.track&&e.track.id!==n.track.id&&(k.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",s),n.track=e.track,n.track.addEventListener("ended",s)),t.enableTopn?(function(g,y,v){var R;let b=Gk(new DataView(y.data));if(!b)return v.enqueue(y);let A=g.track.id;yde.set(A,g.track);let F=(R=b.tlv.find(se=>se.tag===yp.AUDIO_LEVEL))===null||R===void 0?void 0:R.value,M=0;typeof F=="number"&&(M=127-F);let j=Math.round(Math.pow(10,M/60)-1),{selected:K,speaker:q}=(function(se,oe){let ne=jE.get(se);if(ne||(ne=(function(de){let we=new PW;return jE.set(de,we),Wl||(Wl=new _de(z("TOPN_SILENCE_THRESHOLD")||500),Wl.on("ActiveSpeakerChanged",Oe=>{Oe!=null&&(Fb=Oe)})),Wl.addSpeakers([we]),we})(se)),jE.size<=kW)return{selected:!0,speaker:ne};if(!Wl)throw new Error("no active speaker detector");return Wl.levelChanged(ne.id,oe),Wm=Wl.loudest.map(de=>de.id),Fb&&!ke(Wm).call(Wm,Fb)&&Wm.length>=kW&&Wm.pop(),{selected:ke(Wm).call(Wm,ne.id)||ne.id===Fb,speaker:ne}})(g,j),Q=(function(se,oe,ne){let de=Gl.get(se)||new Ede(se,oe);return de.score=ne,Gl.set(se,de),(function(we){if(jb.set(we,!0),!Bb)return void(Bb=Date.now());let Oe=Date.now();Oe-Bb>1e3&&(jb.get(we)?jb.set(we,!1):(DW(we),jb.delete(we)),Bb=Oe)})(se),de})(A,g.track,q.energyScore);Q.addSample(K),Q.active&&(y.data=b.frame.buffer,v.enqueue(y))})(e,d,f):t.enableMetadata||t.enablePts?(function(g,y,v,R){let b=new DataView(g.data),A=b.getUint8(0),F;if(128&A&&A!==71){let K=(function(q){if(q.byteLength<=0)return[];let Q=[],se=0;for(;se<q.byteLength;){let ne=(128&q.getUint8(se))>>7,de=127&q.getUint8(se);if(!(ne&&se+4<=q.byteLength)){se++;break}{let we=q.getUint32(se,!1),Oe=(16776192&we)>>10,Qe=1023&we;Q.push({pt:de,ts_offset:Oe,length:Qe,data:new Uint8Array}),se+=4}}let oe=q.byteLength-se;for(let ne of Q){if(ne.length>oe)return console.warn("Broken red payload"),[];ne.length>0&&(ne.data=new Uint8Array(q.buffer,q.byteOffset+se,ne.length),se+=ne.length,oe-=ne.length)}if(oe>0){let ne={pt:Q.length>0?Q[Q.length-1].pt:0,ts_offset:0,length:oe,data:new Uint8Array(q.buffer,q.byteOffset+se,oe)};Q.push(ne)}return Q})(b);if(K.length>0){let q=(function(Q){let se=0;for(let de=0;de<Q.length;de++)se+=de<Q.length-1?4:1,se+=Q[de].length;let oe=new Uint8Array(se),ne=0;for(let de=0;de<Q.length;de++)if(de<Q.length-1){let we=(2147483648|(127&Q[de].pt)<<24|(262143&Q[de].ts_offset)<<10|1023&Q[de].length)>>>0;oe[ne++]=we>>24&255,oe[ne++]=we>>16&255,oe[ne++]=we>>8&255,oe[ne++]=255&we}else oe[ne++]=127&Q[de].pt;for(let de of Q)oe.set(de.data,ne),ne+=de.length;return oe})(K.map(Q=>{let se=new Uint8Array(Q.length);se.set(Q.data);let oe=Gk(new DataView(se.buffer));return oe!=null&&oe.frame&&(Q.data=oe?.frame),F=oe,Q}));g.data=q.buffer}}else F=Gk(b),F&&(g.data=F.frame.buffer);if(y.enqueue(g),!F)return;let M=F.tlv.find(K=>K.tag===yp.METADATA);M&&v&&M.value instanceof Uint8Array&&v(M.value);let j=F.tlv.find(K=>K.tag===yp.AUDIO_64_BIT_PTS);j&&R&&j.value instanceof Uint8Array&&j.value.length==8&&R(new DataView(j.value.buffer).getBigUint64(0,!0))})(d,f,t.onMetadata,t.onPts):f.enqueue(d)}});o.readable.pipeThrough(u).pipeTo(o.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");let o=Lb(),u=new MessageChannel;await new We(f=>o.onmessage=g=>{g.data==="registered"&&f(void 0)});let d=new RTCRtpScriptTransform(o,{name:"audio-metadata-rx",port:u.port2},[u.port2]);e.transform=d,await new We(f=>o.onmessage=g=>{g.data==="started"&&f(void 0)}),u.port1.onmessage=f=>{var g;f.data.transformed&&e.track&&((g=e.track)===null||g===void 0?void 0:g.id)!==n.track.id?(k.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",s),n.track=e.track,n.track.addEventListener("ended",s)):f.data.metadata&&n.onMetadata?n.onMetadata(f.data.metadata):f.data.pts&&n.onPts&&n.onPts(f.data.pts)},n.worker=o}function s(){e.track.removeEventListener("ended",s),(function(o){let u=Wb.get(o);if(u){(function(g){let y=jE.get(g);y&&(jE.delete(g),Wl&&(Wl.removeSpeakers([y]),jE.size===0&&(Wl.destroy(),Wl=null)))})(o),DW(o.track.id),Wb.delete(o);try{var d,f;(d=u.controller)===null||d===void 0||d.terminate(),(f=u.worker)===null||f===void 0||f.terminate()}catch(g){k.warning(g&&g.message)}}})(e)}Wb.set(e,n),e.track.addEventListener("ended",s)},interceptLocalVideoFrame:async function(e,t){if(!Qt().supportWebRTCEncodedTransform)return void k.warning("browser not support video encoded transform");if(Gb.has(e)||!e.track)return;let n={track:e.track};if(Qd()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");let o=null;try{o=e.createEncodedStreams()}catch(f){return void k.error("create video-encoded-streams error",f&&f.message)}let u=[];t.on("sei-to-send",f=>{u.push(f)});let d=new TransformStream({transform(f,g){n.controller||(n.controller=g),e.track&&e.track.id!==n.track.id&&(k.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",s),n.track=e.track,n.track.addEventListener("ended",s));let y=MW(new Uint8Array(f.data)),v=u.shift();if(v){let R=(function(b,A,F){switch(F){case Yk:return(function(M,j){let K=LW(j),q=K.length,Q=Math.floor(q/255),se=q%255,oe=new Uint8Array(6+Q+1+q+M.byteLength);oe[0]=0,oe[1]=0,oe[2]=0,oe[3]=1,oe[4]=6,oe[5]=101;let ne=0;for(;ne<Q;)oe[6+ne]=255,ne++;return oe[6+ne]=se,ne++,oe.set(K,6+ne),oe.set(new Uint8Array(M),6+ne+q),oe.buffer})(b,A);case qk:return(function(M,j){let K=LW(j),q=K.length,Q=Math.floor(q/255),se=q%255,oe=new Uint8Array(7+Q+1+q+1+M.byteLength);oe[0]=0,oe[1]=0,oe[2]=0,oe[3]=1,oe[4]=78,oe[5]=1,oe[6]=101;let ne=0;for(;ne<Q;)oe[7+ne]=255,ne++;return oe[7+ne]=se,ne++,oe.set(K,7+ne),ne+=q,oe[7+ne]=128,ne++,oe.set(new Uint8Array(M),7+ne),oe.buffer})(b,A);default:return null}})(f.data,v,y);R&&(f.data=R)}g.enqueue(f)}});o.readable.pipeThrough(d).pipeTo(o.writable)}else{if(!Pi())return;{if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");let o=Lb(),u=new MessageChannel;await new We(f=>o.onmessage=g=>{g.data==="registered"&&f(void 0)});let d=new RTCRtpScriptTransform(o,{name:"sei-tx",port:u.port2},[u.port2]);e.transform=d,await new We(f=>o.onmessage=g=>{g.data==="started"&&f(void 0)}),t.on("sei-to-send",f=>{u.port1.postMessage({sei:f})}),u.port1.onmessage=f=>{var g;f.data.transformed&&e.track&&((g=e.track)===null||g===void 0?void 0:g.id)!==n.track.id&&(k.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",s),n.track=e.track,n.track.addEventListener("ended",s))},n.worker=o}}function s(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",s)}let o=Gb.get(e);if(o){Gb.delete(e);try{var u,d;(u=o.controller)===null||u===void 0||u.terminate(),(d=o.worker)===null||d===void 0||d.terminate()}catch(f){k.warning(f&&f.message)}}}Gb.set(e,n),e.track.addEventListener("ended",s)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Qt().supportWebRTCEncodedTransform)return void k.warning("browser not support video encoded transform");if(!e.track)return;if(MT.has(e)){let o=MT.get(e);return void(o&&(o.onSei=t.onSei))}let n={track:e.track,onSei:t.onSei};if(Qd()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");let o=null;try{o=e.createEncodedStreams()}catch(d){return void k.error("create video-encoded-streams error",d&&d.message)}let u=new TransformStream({transform(d,f){if(n.controller||(n.controller=f),!n.firstFrameInfo){var g;let v=d.getMetadata()||{};n.firstFrameInfo=qn({type:d.type,rtpTimestamp:d.timestamp,payloadType:v.payloadType||0,ssrc:v.synchronizationSource||0,length:d.data.byteLength},"mimeType"in v?{mimeType:v.mimeType}:{}),(g=t.onFirstFrame)===null||g===void 0||g.call(t,n.firstFrameInfo)}e.track&&e.track.id!==n.track.id&&(k.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",s),n.track=e.track,n.track.addEventListener("ended",s));let y=(function(v,R){switch(R){case Yk:return(function(b){let A=new DataView(b.data),F=0;for(;F+4<b.data.byteLength;){if(A.getUint8(F+0)===0&&A.getUint8(F+1)===0&&A.getUint8(F+2)===0&&A.getUint8(F+3)===1&&A.getUint8(F+4)===6){let M=F+6,j=0,K=0;for(;(K=A.getUint8(M++))===255;)j+=255;j+=K;let q=xW(b.data,M,j);return new Uint8Array(q)}F++}return null})(v);case qk:return(function(b){let A=new DataView(b.data),F=0;for(;F+5<b.data.byteLength;){if(A.getUint8(F+0)===0&&A.getUint8(F+1)===0&&A.getUint8(F+2)===0&&A.getUint8(F+3)===1&&A.getUint8(F+4)===78&&A.getUint8(F+5)===1&&A.getUint8(F+6)===101){let M=F+7,j=0,K=0;for(;(K=A.getUint8(M++))===255;)j+=255;j+=K;let q=xW(b.data,M,j);return new Uint8Array(q)}F++}return null})(v);default:return null}})(d,MW(new Uint8Array(d.data)));y&&n.onSei&&n.onSei(y),f.enqueue(d)}});o.readable.pipeThrough(u).pipeTo(o.writable)}else if(Pi()){if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");let o=Lb(),u=new MessageChannel;await new We(f=>o.onmessage=g=>{g.data==="registered"&&f(void 0)});let d=new RTCRtpScriptTransform(o,{name:"sei-rx",port:u.port2},[u.port2]);e.transform=d,await new We(f=>o.onmessage=g=>{g.data==="started"&&f(void 0)}),u.port1.onmessage=f=>{var g;if(f.data.transformed&&e.track&&((g=e.track)===null||g===void 0?void 0:g.id)!==n.track.id)k.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",s),n.track=e.track,n.track.addEventListener("ended",s);else if(f.data.sei&&n.onSei)n.onSei(f.data.sei);else if(f.data.firstFrameInfo&&t.onFirstFrame){var y;(y=t.onFirstFrame)===null||y===void 0||y.call(t,f.data.firstFrameInfo)}},n.worker=o}function s(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",s)}(function(o){let u=MT.get(o);if(u){MT.delete(o);try{var d,f;(d=u.controller)===null||d===void 0||d.terminate(),(f=u.worker)===null||f===void 0||f.terminate()}catch(g){k.warning(g&&g.message)}}})(e)}MT.set(e,n),e.track.addEventListener("ended",s)}},Hfe={name:"InterceptFrame",create:()=>Gfe};var ln;function Mz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function Ql(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Mz(Object(n),!0).forEach(function(s){V(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Mz(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}let zfe=(ln=class vy extends Xb{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return ke(n=Object.keys(Mm)).call(n,t)}))]}constructor(t,n,s){super(t,n),V(this,"id",In(5,"connection-")),V(this,"store",void 0),V(this,"peerConnection",void 0),V(this,"forceTurn",!1),V(this,"remoteSDP",void 0),V(this,"initialOffer",void 0),V(this,"transportEventReceiver",void 0),V(this,"statsFilter",void 0),V(this,"extension",{useXR:z("USE_XR")}),V(this,"localCapabilities",void 0),V(this,"remoteCodecs",void 0),V(this,"localCandidateCount",0),V(this,"allCandidatesReceived",!1),V(this,"isPreallocation",!1),V(this,"preMediaMap",new Map),V(this,"dataStreamChannelMap",new Map),V(this,"establishPromise",void 0),V(this,"recoveredDataChannelIds",[]),V(this,"currentDataChannelId",1),V(this,"supportAV1RtpSpec",!1),V(this,"mutex",void 0),V(this,"qualityLimitationReason",AE.NONE),V(this,"isFirstConnected",!1),this.store=n,this.forceTurn=PD(t),this.mutex=new ki("NVConnectionExtension-mutex",n.clientId),this.peerConnection=s,this.isFirstConnected=!1,this.statsFilter=wb(this.peerConnection,z("STATS_UPDATE_INTERVAL"),void 0,$n()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void k.debug("[NVConnectionExtension] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){let s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s);let u=this.remoteSDP.toString();o?.(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else k.debug("[NVConnectionExtension] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let s=ed(n.sdp),o=await pD({filterRTX:!z("USE_PUB_RTX")&&!z("USE_SUB_RTX"),filterVideoFec:z("FILTER_VIDEO_FEC"),filterAudioFec:z("FILTER_AUDIO_FEC"),filterVideoCodec:z("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:z("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:z("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=WT(o),this.initialOffer=n,z("ENABLE_SVC")&&this.store.codec=="av1"){let d=await u8();var t;d&&(this.supportAV1RtpSpec=!0,(t=o.send)===null||t===void 0||t.videoExtensions.push(d))}let u;return n.sdp&&nI(n.sdp)&&(u=Qn(o),n8(u)),Ql(Ql({},s),{},{rtpCapabilities:u||o,offerSDP:n.sdp})}catch(n){throw new _e(Y.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnectionExtension without initial offer.");this.initialOffer.sdp&&nI(this.initialOffer.sdp)&&r8(t.rtpCapabilities,this.localCapabilities),this.remoteSDP=new L8(Ql(Ql({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!z("ENABLE_PRE_SUB_WITH_PRE_PC")||!z("PRE_USE_LOCAL_CODECS"))&&DT(this.store),!0),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let n=this.remoteSDP.toString(),s=fD(this.initialOffer.sdp,this.extension),o=this.logSDPExchange(s||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),o?.(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n});let u=this.peerConnection.getTransceivers()[0];if(u!=null&&u.receiver&&this.tryBindTransportEvents(u.receiver),DT(this.store))if(t.preallocation&&z("ENABLE_PRE_SUB_WITH_PRE_PC")){let d=z("PRE_SUB_NUM"),{mids:f,preSSRCs:g}=this.remoteSDP.preloadRemoteMedia(d);await Aa(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] preload media, in pre pc,add preload ssrcs ").concat(g)),this.presetMedia(f,g)}else{let{preSSRCs:d=[]}=t,f=d.map(y=>y.ssrcMsg[0].ssrcId);if(d.length===0)return;let{mids:g}=this.remoteSDP.batchSend(d.map(y=>Object.assign({},y)));await Aa(this.peerConnection,this.remoteSDP,this.extension),k.debug("[NVConnectionExtension.connect] preload media, after join, add preload ssrcs ".concat(f)),this.presetMedia(g,f)}}catch(n){throw new _e(Y.EXCHANGE_SDP_FAILED,"NVConnectionExtension.connect failed; ".concat(n.toString()))}}presetMedia(t,n){t.forEach((s,o)=>{this.peerConnection.getTransceivers().forEach(u=>{if(u.mid!=null&&s===u.mid&&u.receiver.track){let d=u.receiver.track,f;d.kind==="video"&&z("ENABLE_PRE_RENDER")&&(f=new Db({trackId:"track-".concat(d.kind,"-unknown-").concat(this.store.clientId,"_").concat(In(5,""))},!0),f.updateVideoTrack(d),f.onFirstVideoFrameRender=()=>{var g;let y=this.preMediaMap.get(n[o]);y&&(y.firstVideoRender=Date.now()),(g=this.onFirstVideoRender)===null||g===void 0||g.call(this,n[o])},f.onVideoBufferReady=()=>{var g;(g=this.onFirstVideoBufferReady)===null||g===void 0||g.call(this,n[o])},f.play(this.store.sessionId||void 0)),this.preMediaMap.set(n[o],{mid:s,track:d,player:f,transceiver:u})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateRemoteConnect before remote SDP created");let n=!1,{rtpCapabilities:s}=t;if([,n]=this.remoteSDP.updateRemoteRTPCapabilities(s),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){let d=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);n=n||d}let{preSSRCs:o=[]}=t,u=o.map(d=>d.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(u)){let d=[],f=[];if(Array.from(this.preMediaMap.entries()).every(g=>{let[y,{mid:v,player:R,track:b}]=g;return d.push(v),f.push(y),this.preMediaMap.delete(y),R&&R.destroy(),!0}),d.length>0&&(this.remoteSDP.stopSending(d),await Aa(this.peerConnection,this.remoteSDP,this.extension),k.warn("[NVConnectionExtension.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(f)),tt.reportApiInvoke(this.store.sessionId,{name:or.PRELOAD_MEDIA_FAILED,options:[o,f],tag:Fn.TRACER}).onSuccess()),o.length>0){let{mids:g}=this.remoteSDP.batchSend(o.map(y=>Object.assign({},y)));await Aa(this.peerConnection,this.remoteSDP,this.extension),k.debug("[NVConnectionExtension.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(u)),this.presetMedia(g,u)}}n?(await Aa(this.peerConnection,this.remoteSDP,this.extension),k.debug("[NVConnectionExtension] updateRemoteConnect by exchanging SDP.")):k.debug("[NVConnectionExtension] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(n){throw new _e(Y.EXCHANGE_SDP_FAILED,"NVConnectionExtension.updateRemoteConnect failed; ".concat(n.toString()))}}send(t,n,s){var o=this;return aa(function*(){let u=yield Ft(o.mutex.lock("From NVConnectionExtension.send"));try{if(!o.remoteSDP)throw new Error("Cannot call NVConnectionExtension.send before remote SDP created");let d=[],f=FT();t.forEach(j=>{let K=o.peerConnection.addTransceiver(j._mediaStreamTrack,Ql({direction:"sendonly"},j.trackMediaType==="video"&&o.supportAV1RtpSpec&&f?{sendEncodings:[{scalabilityMode:f}]}:{}));d.push(K),j._updateRtpTransceiver(K)}),$n()&&z("SIMULCAST")===!0&&(yield Ft(o.applySimulcastForFirefox(d,t)));let g=yield Ft(o.peerConnection.createOffer()),y=o.remoteSDP.predictReceivingMids(t.length),v=o.mungSendOfferSDP(g.sdp,t,y),R=Hs(v),b=y.map(j=>{let K=R.mediaDescriptions.find(q=>q.attributes.mid===j);if(!K)throw new Error("Cannot extract ssrc from mediaDescription.");return lD(K,z("USE_PUB_RTX"))}),A;try{A=yield b}catch(j){A=[],o.remoteSDP.receive(t,n,s,A);let K=o.remoteSDP.toString();throw yield Ft(o.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield Ft(o.peerConnection.setRemoteDescription({type:"answer",sdp:K})),yield Ft(o.stopSending(y,!0)),j}o.remoteSDP.receive(t,n,s,A);let F=o.remoteSDP.toString(),M=o.logSDPExchange(v,"offer","local","send");return yield Ft(o.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield Ft(o.applySimulcastEncodings(d,t)),yield Ft(o.applySendEncodings(d,t)),M?.(F),yield Ft(o.peerConnection.setRemoteDescription({type:"answer",sdp:F})),d.map((j,K)=>{let q=y[K];return{localSSRC:b[K],id:q,transceiver:j}})}catch(d){throw d instanceof _e?d:new _e(Y.EXCHANGE_SDP_FAILED,"NVConnectionExtension.send failed; ".concat(d.toString()))}finally{u()}})()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.createDataChannels before remote SDP created");let s=this.dataStreamChannelMap.get(t);if(s&&s.readyState==="open")k.debug("[NVConnectionExtension] Channels are already available and can be reused directly.");else{let u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");s=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:z("DATASTREAM_MAX_RETRANSMITS")}),s.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,s)}n.forEach(u=>{u._updateOriginDataChannel(s)});let{needExchangeSDP:o}=this.remoteSDP.sendDataChannel();if(o){let u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});let d=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(d),k.debug("[NVConnectionExtension] createDataChannels by exchanging SDP.")}else k.debug("[NVConnectionExtension] createDataChannels no need to exchange SDP.");return}catch(s){throw s instanceof _e?s:new _e(Y.EXCHANGE_SDP_FAILED,"NVConnectionExtension.createDataChannels failed; ".concat(s.toString()))}}async stopDataChannels(t){try{let n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof _e?n:new _e(Y.DATACHANNEL_FAILED,"NVConnectionExtension.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){let s=n?void 0:await this.mutex.lock("From NVConnectionExtension.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopSending before remote SDP created");let o=this.peerConnection.getTransceivers().filter(g=>t.indexOf(g.mid)!==-1);if(o.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVConnectionExtension.stopSending.");o.map(g=>{var y;$E(this.id+g.mid,this),g.direction="inactive",(y=g.stop)===null||y===void 0||y.call(g)});let u=await this.peerConnection.createOffer(),d=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(t);let f=this.remoteSDP.toString();d?.(f),await this.peerConnection.setRemoteDescription({type:"answer",sdp:f})}catch(o){throw new _e(Y.EXCHANGE_SDP_FAILED,"NVConnectionExtension.stopSending failed; ".concat(o.toString()))}finally{s&&s()}}async receive(t,n,s,o){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.receive ".concat(t," before remoteSDP created."));let{mid:u,needExchangeSDP:d}=this.remoteSDP.send(t,n,s,o);d&&(await Aa(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] receive ").concat(t," by exchanging SDP.")));let f=this.peerConnection.getTransceivers().find(g=>g.mid===u);if(!f)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:f.receiver.track,id:u,transceiver:f}}catch(u){throw new _e(Y.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(u.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.batchReceive before remoteSDP created.");let{mids:n,needExchangeSDP:s}=this.remoteSDP.batchSend(t);return s&&(await Aa(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] batchReceive by exchanging SDP."))),n.map(o=>{let u=this.peerConnection.getTransceivers().find(d=>d.mid===o);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:o,transceiver:u}})}catch(n){throw new _e(Y.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopReceiving before remote SDP created.");t.forEach(u=>{Array.from(this.preMediaMap.entries()).some(d=>{let[f,{mid:g,player:y}]=d;if(g===u)return this.preMediaMap.delete(f),y&&y.destroy(),!0})}),this.remoteSDP.stopSending(t);let n=this.remoteSDP.toString(),s=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});let o=await this.peerConnection.createAnswer();s?.(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new _e(Y.EXCHANGE_SDP_FAILED,"NVConnectionExtension stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);let n=this.remoteSDP.toString(),s=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});let o=await this.peerConnection.createAnswer();s?.(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new _e(Y.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);let n=this.remoteSDP.toString(),s=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});let o=await this.peerConnection.createAnswer();s?.(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new _e(Y.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteLocal before remote SDP created.");let n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(d=>{d.direction="inactive"});let s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.muteRemote(t);let u=this.remoteSDP.toString();o?.(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(n){throw new _e(Y.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteLocal before remote SDP created.");let n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(d,f)=>{d.direction="sendonly"});let s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);let u=this.remoteSDP.toString();o?.(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(n){throw new _e(Y.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return aa(function*(){let s=yield Ft(n.mutex.lock("From NVConnectionExtension.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");let o=Qt().supportPCSetConfiguration,u=z("FORCE_TURN_TCP")||n.forceTurn;if(t===Di.RELAY&&!o)return;if(o&&!u){let R=t===Di.RELAY?"relay":"all",b=n.peerConnection.getConfiguration();b.iceTransportPolicy!==R&&(k.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(b.iceTransportPolicy,"] to [").concat(R,"]")),b.iceTransportPolicy=R,n.peerConnection.setConfiguration(b))}n.remoteSDP.updateCandidates(t);let d=yield Ft(n.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let f=ed(d.sdp),{remoteIceParameters:g}=yield f.iceParameters;n.remoteSDP.restartICE(g);let y=n.remoteSDP.toString(),v=n.logSDPExchange(d.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield Ft(n.peerConnection.setLocalDescription(d)),v?.(y),yield Ft(n.peerConnection.setRemoteDescription({type:"answer",sdp:y}))}catch(o){k.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),o)}finally{s()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;let t=await this.mutex.lock("From NVConnectionExtension.extendCandidate");try{this.remoteSDP.updateCandidates(Di.TCP_RELAY),await Aa(this.peerConnection,this.remoteSDP,this.extension)}catch(n){k.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{$E(this.id+n.mid,this)}),this.preMediaMap.forEach(n=>{let{player:s}=n;s&&s.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Ql(Ql({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateEncoderConfig before remote SDP created.");let s=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(s.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);let u=this.remoteSDP.toString(),d=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),d?.(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new _e(Y.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(t,n){let s=this.peerConnection.getTransceivers().filter(o=>o.mid===t);s.length===1&&(this.isVP8Simulcast(n)?$n()||await this.applySimulcastEncodings(s,[n]):await this.applySendEncodings(s,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){let s=this.peerConnection.getTransceivers().find(o=>o.mid===n);s&&await s.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let n=t[0].transport.iceTransport,{local:s,remote:o}=n.getSelectedCandidatePair();return{local:Ql(Ql({},Gc),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port}),remote:Ql(Ql({},Gc),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;let s="code: ".concat(t.errorCode,", message: ").concat(t.errorText),o=t.port?"local: ".concat(t.port):"",u=Zu(t.url||"");k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: NVConnectionExtension.onICECandidateError(").concat(s,"), url: ").concat(u||"",", host_candidate:").concat(o)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,s)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},z("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let n={iceServers:[]},s=t.cloudProxyServer||"disabled";return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(Om(t.turnServer.servers)?n.iceServers=t.turnServer.servers:z("NEW_TURN_MODE")&&n.iceServers&&s==="disabled"?(z("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...vy.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...vy.newTurnServerConfigToIceServers(t.turnServer.servers)),z("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...vy.turnServerConfigToIceServers(t.turnServer.servers)),z("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...vy.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),z("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(n.iceTransportPolicy="relay")}))),z("ENABLE_ENCODED_TRANSFORM")&&Qt().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){let n=[];return t.forEach(s=>{s.security?s.tcpport&&n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(qc(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!z("FORCE_TURN_TCP")&&n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(t){let n=[];return t.forEach(s=>{let o=z("NEW_TURN_MODE");o===1?n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}):o===2?n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}):o===3?n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(qc(s.turnServerURL),":443?transport=tcp")}):o===4&&(n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}),n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}),n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(qc(s.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(t){let n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var o;n!=null&&n.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,n.state))},n.onerror=o=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in o?o.error:o)};let s=n.iceTransport;s&&(s.onstatechange=()=>{let o=n?.iceTransport.state;var u;o&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,o))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){let{local:o,remote:u}=s.getSelectedCandidatePair()||{};if(o&&u){let d=o.address+":"+o.port,f=u.address+":"+u.port;k.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Zu(d)),", remote ").concat(JSON.stringify(Zu(f))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var s,o;if(n||(n=this.peerConnection.getSenders().find(M=>M.track===t._mediaStreamTrack)),!n)return k.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return k.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Qt().supportSetRtpSenderParameters)return k.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let u={},d={};switch(t._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}let f=e8(this.peerConnection,t._mediaStreamTrack),g=G5(t);if(B8(t)&&f&&n&&g&&this.getLocalVideoStats&&ke(s=["vp8","vp9"]).call(s,this.store.codec)){var y;let M=u.degradationPreference||(ke(y=t._hints).call(y,bn.CUSTOM_TRACK)?z("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");W8(this.id+f.mid,g,this,M,j=>{n&&this.updateAdaptation(n,j)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var v;let{bitrateMax:M,frameRate:j,scaleResolutionDownBy:K}=t._encoderConfig;M&&(d.maxBitrate=1e3*M),(ke(v=t._hints).call(v,bn.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(j&&(d.maxFramerate=da(j)),K&&K>=1&&(d.scaleResolutionDownBy=K))}let{maxFramerate:R}=z("ENCODER_CONFIG_LIMIT");if(R&&typeof R=="number"&&(d.maxFramerate=d.maxFramerate?Math.min(d.maxFramerate,R):R),z("DSCP_TYPE")&&qu()){var b;let M=z("DSCP_TYPE");ke(b=["very-low","low","medium","high"]).call(b,M)&&(d.networkPriority=M)}let A=n.getParameters(),F=(o=A.encodings)===null||o===void 0?void 0:o[0];$n()&&!F&&(u.encodings=[d]),F&&Object.assign(F,d),Object.assign(A,u),k.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(A.encodings))),await n.setParameters(A),await p8(this.store.codec,n,z("SVC_MODE"))}async updateAdaptation(t,n){var s,o;if(!t)return k.debug("[updateAdaptation] no rtpSender found");if(!Qt().supportSetRtpSenderParameters)return k.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let u={},{bitrateMax:d,frameRate:f,scaleResolutionDownBy:g}=n;d&&(u.maxBitrate=1e3*d),f&&(u.maxFramerate=da(f)),g&&g>=1&&ke(s=["vp8","vp9"]).call(s,this.store.codec)&&(u.scaleResolutionDownBy=g);let y=t.getParameters(),v=(o=y.encodings)===null||o===void 0?void 0:o[0];v&&Object.assign(v,u),Object.assign(y,{});try{await t.setParameters(y),k.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(y.encodings)))}catch(R){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?k.debug("[updateAdaptation] peerConnection not connected}"):k.debug("[updateAdaptation] updateRtpSenderEncodings failed",R):k.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!Qt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let s=0;s<t.length;s++){let o=t[s],u=n[s];u instanceof jn&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,o.sender)}}catch{k.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,s){let o=Hs(t);return n.forEach((u,d)=>{let f=s[d],g=o.mediaDescriptions.find(y=>y.attributes.mid===f);g&&(Ym(g,u),hD(g,u,this.store.codec))}),eh(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,s)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,s)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let g=0;g<t.length;g++){var s,o,u,d,f;let y=t[g],v=n[g];if(v instanceof jn&&!ke(s=v._hints).call(s,bn.LOW_STREAM)&&(o=v._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((u=v._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(d=v._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((f=v._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1&&this.store.codec==="vp8"){let R={},b={high:1e3*(v._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:b.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:b.high}];let A=y.sender.getParameters();await y.sender.setParameters(Object.assign(A,R))}}}async applySimulcastEncodings(t,n){if(!$n()&&t.length===n.length)for(let s=0;s<t.length;s++){let o=n[s];if(o instanceof jn&&this.isVP8Simulcast(o)){let u=t[s],d={},f={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};d.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:f.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:f.medium,scaleResolutionDownBy:4}];let g=u.sender.getParameters();await u.sender.setParameters(Object.assign(g,d))}}}isVP8Simulcast(t){var n,s,o,u,d;return!!(t instanceof jn&&z("SIMULCAST")&&this.store.codec==="vp8"&&!ke(n=t._hints).call(n,bn.LOW_STREAM)&&(s=t._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((o=t._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(u=t._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((d=t._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1)}logSDPExchange(t,n,s,o){if(z("SDP_LOGGING"))return k.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(n," SDP during NVConnectionExtension.").concat(o,`
`),t),n==="offer"?u=>{this.logSDPExchange(u,"answer",s==="local"?"remote":"local",o)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;let n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(t){if(Qt().supportPCSetConfiguration){let n=vy.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}t.isPreallocation&&(this.isPreallocation=!0)}},ze(ln.prototype,"updateRemoteRTPCapabilities",[fa],Object.getOwnPropertyDescriptor(ln.prototype,"updateRemoteRTPCapabilities"),ln.prototype),ze(ln.prototype,"connect",[fa],Object.getOwnPropertyDescriptor(ln.prototype,"connect"),ln.prototype),ze(ln.prototype,"updateRemoteConnect",[fa],Object.getOwnPropertyDescriptor(ln.prototype,"updateRemoteConnect"),ln.prototype),ze(ln.prototype,"createDataChannels",[fa],Object.getOwnPropertyDescriptor(ln.prototype,"createDataChannels"),ln.prototype),ze(ln.prototype,"receive",[fa],Object.getOwnPropertyDescriptor(ln.prototype,"receive"),ln.prototype),ze(ln.prototype,"batchReceive",[fa],Object.getOwnPropertyDescriptor(ln.prototype,"batchReceive"),ln.prototype),ze(ln.prototype,"stopReceiving",[fa],Object.getOwnPropertyDescriptor(ln.prototype,"stopReceiving"),ln.prototype),ze(ln.prototype,"muteRemote",[fa],Object.getOwnPropertyDescriptor(ln.prototype,"muteRemote"),ln.prototype),ze(ln.prototype,"unmuteRemote",[fa],Object.getOwnPropertyDescriptor(ln.prototype,"unmuteRemote"),ln.prototype),ze(ln.prototype,"muteLocal",[fa],Object.getOwnPropertyDescriptor(ln.prototype,"muteLocal"),ln.prototype),ze(ln.prototype,"unmuteLocal",[fa],Object.getOwnPropertyDescriptor(ln.prototype,"unmuteLocal"),ln.prototype),ze(ln.prototype,"close",[fa],Object.getOwnPropertyDescriptor(ln.prototype,"close"),ln.prototype),ze(ln.prototype,"updateEncoderConfig",[fa],Object.getOwnPropertyDescriptor(ln.prototype,"updateEncoderConfig"),ln.prototype),ze(ln.prototype,"updateSendParameters",[fa],Object.getOwnPropertyDescriptor(ln.prototype,"updateSendParameters"),ln.prototype),ze(ln.prototype,"replaceTrack",[fa],Object.getOwnPropertyDescriptor(ln.prototype,"replaceTrack"),ln.prototype),ze(ln.prototype,"updateAdaptation",[fa],Object.getOwnPropertyDescriptor(ln.prototype,"updateAdaptation"),ln.prototype),ze(ln.prototype,"getRemoteSSRC",[fa],Object.getOwnPropertyDescriptor(ln.prototype,"getRemoteSSRC"),ln.prototype),ln);function fa(e,t,n){let s=e[t];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){let o=this.mutex,u=await o.lock("From NVConnectionExtension.".concat(t));try{for(var d=arguments.length,f=new Array(d),g=0;g<d;g++)f[g]=arguments[g];return await s.apply(this,f)}finally{u()}},n}var kn;function Uz(e){var t,n,s,o=2;for(typeof Symbol<"u"&&(n=ab,s=Symbol.iterator);o--;){if(n&&(t=e[n])!=null)return t.call(e);if(s&&(t=e[s])!=null)return new FI(t.call(e));n="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function FI(e){function t(n){if(Object(n)!==n)return We.reject(new TypeError(n+" is not an object."));var s=n.done;return We.resolve(n.value).then(function(o){return{value:o,done:s}})}return FI=function(n){this.s=n,this.n=n.next},FI.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var s=this.s.return;return s===void 0?We.resolve({value:n,done:!0}):t(s.apply(this.s,arguments))},throw:function(n){var s=this.s.return;return s===void 0?We.reject(n):t(s.apply(this.s,arguments))}},new FI(e)}let Kfe=(kn=class AA extends Xb{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(t,n){super(t,n),V(this,"name","DataChannelConnection"),V(this,"store",void 0),V(this,"peerConnection",void 0),V(this,"cname",void 0),V(this,"mutex",new ki("DataChannelConnection-mutex")),V(this,"dataChannel",void 0),V(this,"_p2pConnection",void 0),V(this,"establishPromise",void 0),V(this,"_nvMedia",void 0),this.store=n,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(AA.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new zfe(t,n,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}getPreMedia(t){var n;return(n=this._p2pConnection)===null||n===void 0?void 0:n.getPreMedia(t)}isPreSub(){var t,n;return(t=(n=this._p2pConnection)===null||n===void 0?void 0:n.isPreSub())!==null&&t!==void 0&&t}async establish(){return await this._p2pConnection.establish()}getP2PConnectionParams(){return this._p2pConnection.establishPromise}updateRtpSenderEncodings(t){return this._p2pConnection.updateRtpSenderEncodings(t)}async connect(t){return this.cname=t.cname,await this._p2pConnection.connect(t),await new We((n,s)=>{let o=setTimeout(()=>{this.closeSignal(),s(new he(Y.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(t.candidates))))},z("DC_CONNECTION_TIMEOUT"));this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(o),void n()},this.dataChannel.onerror=u=>{this.closeSignal(),s(u)},this.dataChannel.addEventListener("close",()=>{s(new he(Y.DATACHANNEL_CONNECTION_TIMEOUT))})}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(t,n){return this._p2pConnection.updateRemoteRTPCapabilities(t,n)}send(t,n,s){var o=this;return aa(function*(){let u=yield Ft(o.mutex.lock("From DataChannelConnection.send"));try{return yield*TE(Uz(o._p2pConnection.send(t,n,s)))}finally{u()}})()}async stopSending(t,n){return this._p2pConnection.stopSending(t,n)}async createDataChannels(t,n){return this._p2pConnection.createDataChannels(t,n)}async stopDataChannels(t){return this._p2pConnection.stopDataChannels(t)}async receive(t,n,s,o){return this._nvMedia?(k.debug("[DataChannelConnection] receive ".concat(t," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(t,n,this.cname)):(k.debug("[DataChannelConnection] receive ".concat(t," by WebRTC.")),await this._p2pConnection.receive(t,n,s,o))}async batchReceive(t){return[...await this._p2pConnection.batchReceive(t)]}async stopReceiving(t){return await this._p2pConnection.stopReceiving(t)}async muteRemote(t){return await this._p2pConnection.muteRemote(t)}async unmuteRemote(t){return await this._p2pConnection.unmuteRemote(t)}async muteLocal(t){return await this._p2pConnection.muteLocal(t)}async unmuteLocal(t){return await this._p2pConnection.unmuteLocal(t)}restartICE(t){var n=this;return aa(function*(){return yield*TE(Uz(n._p2pConnection.restartICE(t)))})()}close(){var t;(t=this._nvMedia)===null||t===void 0||t.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(t){return this._p2pConnection.getRemoteVideoIsReady(t)}updateRemoteConnect(t){var n;return(n=this._nvMedia)===null||n===void 0||n.setRemoteRtpCapabilities(t),this._p2pConnection.updateRemoteConnect(t)}async updateEncoderConfig(t,n){return await this._p2pConnection.updateEncoderConfig(t,n)}async updateSendParameters(t,n){return await this._p2pConnection.updateSendParameters(t,n)}setStatsRemoteVideoIsReady(t,n){this._p2pConnection.setStatsRemoteVideoIsReady(t,n)}async replaceTrack(t,n){return await this._p2pConnection.replaceTrack(t,n)}async getRemoteSSRC(t){return this._p2pConnection.getRemoteSSRC(t)}logSDPExchange(t,n,s,o){if(z("SDP_LOGGING"))return k.upload("exchanging ".concat(s," ").concat(n," SDP during DataChannelConnection.").concat(o,`
`),t),n==="offer"?u=>{this.logSDPExchange(u,"answer",s==="local"?"remote":"local",o)}:void 0}static resolvePCConfiguration(t){let n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Om(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...AA.turnServerConfigToIceServers(t.turnServer.servers)),z("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...AA.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),z("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(n.iceTransportPolicy="relay")}))),z("ENABLE_ENCODED_TRANSFORM")&&Qt().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){let n=[];return t.forEach(s=>{s.security?s.tcpport&&n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(qc(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!z("FORCE_TURN_TCP")&&n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&n.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),n}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=t=>{var n;return(n=this.onICEConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onConnectionStateChange=t=>{var n;return(n=this.onConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportStateChange=t=>{var n;return(n=this.onDTLSTransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportError=t=>{var n;return(n=this.onDTLSTransportError)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onICETransportStateChange=t=>{var n;return(n=this.onICETransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioReceived=t=>{var n;return(n=this.onFirstAudioReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoReceived=t=>{var n;return(n=this.onFirstVideoReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioDecoded=t=>{var n;return(n=this.onFirstAudioDecoded)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoRender=t=>{var n;return(n=this.onFirstVideoRender)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoBufferReady=t=>{var n;return(n=this.onFirstVideoBufferReady)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoDecoded=(t,n,s)=>{var o;return(o=this.onFirstVideoDecoded)===null||o===void 0?void 0:o.call(this,t,n,s)},this._p2pConnection.onFirstVideoDecodedTimeout=t=>{var n;return(n=this.onFirstVideoDecodedTimeout)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onSelectedLocalCandidateChanged=(t,n)=>{var s;return(s=this.onSelectedLocalCandidateChanged)===null||s===void 0?void 0:s.call(this,t,n)},this._p2pConnection.onSelectedRemoteCandidateChanged=(t,n)=>{var s;return(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0?void 0:s.call(this,t,n)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}setConfiguration(t){this._p2pConnection.setConfiguration(t)}},ze(kn.prototype,"connect",[wo],Object.getOwnPropertyDescriptor(kn.prototype,"connect"),kn.prototype),ze(kn.prototype,"updateRemoteRTPCapabilities",[wo],Object.getOwnPropertyDescriptor(kn.prototype,"updateRemoteRTPCapabilities"),kn.prototype),ze(kn.prototype,"createDataChannels",[wo],Object.getOwnPropertyDescriptor(kn.prototype,"createDataChannels"),kn.prototype),ze(kn.prototype,"receive",[wo],Object.getOwnPropertyDescriptor(kn.prototype,"receive"),kn.prototype),ze(kn.prototype,"stopReceiving",[wo],Object.getOwnPropertyDescriptor(kn.prototype,"stopReceiving"),kn.prototype),ze(kn.prototype,"muteRemote",[wo],Object.getOwnPropertyDescriptor(kn.prototype,"muteRemote"),kn.prototype),ze(kn.prototype,"unmuteRemote",[wo],Object.getOwnPropertyDescriptor(kn.prototype,"unmuteRemote"),kn.prototype),ze(kn.prototype,"muteLocal",[wo],Object.getOwnPropertyDescriptor(kn.prototype,"muteLocal"),kn.prototype),ze(kn.prototype,"unmuteLocal",[wo],Object.getOwnPropertyDescriptor(kn.prototype,"unmuteLocal"),kn.prototype),ze(kn.prototype,"close",[wo],Object.getOwnPropertyDescriptor(kn.prototype,"close"),kn.prototype),ze(kn.prototype,"updateEncoderConfig",[wo],Object.getOwnPropertyDescriptor(kn.prototype,"updateEncoderConfig"),kn.prototype),ze(kn.prototype,"updateSendParameters",[wo],Object.getOwnPropertyDescriptor(kn.prototype,"updateSendParameters"),kn.prototype),ze(kn.prototype,"replaceTrack",[wo],Object.getOwnPropertyDescriptor(kn.prototype,"replaceTrack"),kn.prototype),ze(kn.prototype,"getRemoteSSRC",[wo],Object.getOwnPropertyDescriptor(kn.prototype,"getRemoteSSRC"),kn.prototype),kn);function wo(e,t,n){let s=e[t];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){let o=this.mutex,u=await o.lock("From DataChannelConnection.".concat(t));try{for(var d=arguments.length,f=new Array(d),g=0;g<d;g++)f[g]=arguments[g];return await s.apply(this,f)}finally{u()}},n}function Vz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}class Yfe extends dr{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;ke(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(li.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(li.CONNECTED):this._state==="closed"?this.emit(li.CLOSED):this._state==="failed"&&this.emit(li.FAILED))}constructor(t,n,s,o){super(),V(this,"connectionID",0),V(this,"currentURLIndex",0),V(this,"reconnectReason",void 0),V(this,"_reconnectMode","tryNext"),V(this,"_initMutex",void 0),V(this,"_name",void 0),V(this,"_state","closed"),V(this,"_reconnectInterrupter",void 0),V(this,"_url",void 0),V(this,"_retryConfig",void 0),V(this,"_reconnectCount",0),V(this,"_forceCloseTimeout",5e3),V(this,"_onlineReconnectListener",void 0),V(this,"_closeEstablishingTransmitter",()=>{}),V(this,"_store",void 0),V(this,"_joinChannelServiceRecordIndex",void 0),V(this,"_transmitter",void 0),V(this,"_useCompress",void 0),V(this,"_inflateLength",0),V(this,"_deflateLength",0),this._store=o,this._name=t,this._retryConfig=(function(u){for(var d=1;d<arguments.length;d++){var f=arguments[d]!=null?arguments[d]:{};d%2?Vz(Object(f),!0).forEach(function(g){V(u,g,f[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(f)):Vz(Object(f)).forEach(function(g){Object.defineProperty(u,g,Object.getOwnPropertyDescriptor(f,g))})}return u})({},n),this._useCompress=s}resetReconnectCount(t){k.debug("".concat(this._name," reset reconnect count, reason: ").concat(t)),this._reconnectCount=0}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;let s=this._transmitter;n?setTimeout(()=>s.close(),500):s.close(),this._transmitter=void 0}this.state=t?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(t,n){if(!this._transmitter)return void k.warning("[".concat(this._name,"] can not reconnect, no websocket"));var s;t!==void 0&&(this.reconnectMode=t),k.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((s=this._store)===null||s===void 0||s.recordJoinChannelService({status:"error",errors:[new Error(n)]},this._joinChannelServiceRecordIndex));let o=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),o&&o.bind(this._transmitter)({code:9999,reason:n})}getInflateData(){let t=this._inflateLength,n=this._deflateLength;return this.clearInflateData(),{inflateLength:t,deflateLength:n}}setInflateData(t){this._deflateLength=this._deflateLength+t.originLength,this._inflateLength=this._inflateLength+t.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}let Zl=(function(e){return e[e.Default=0]="Default",e[e.Ack=1]="Ack",e})({});class qfe{constructor(t,n,s){V(this,"version",1),V(this,"initialRTO",void 0),V(this,"maxBatchAckCount",void 0),V(this,"maxRTO",void 0),V(this,"initialRTT",void 0),V(this,"ID",void 0),V(this,"rtt",void 0),V(this,"packetNumber",1),V(this,"rtoRatioMap",new Map),V(this,"timeoutMap",new Map),V(this,"unorderedPacketQueue",[]),V(this,"batchAckPacketQueue",[]),V(this,"lastOrderedPacketNumber",0),V(this,"batchAckTimer",void 0),V(this,"sendImpl",void 0),V(this,"receiveImpl",void 0),this.sendImpl=t,this.receiveImpl=n,this.ID=In(7,"transmitter-"),this.initialRTO=s?.initialRTO!==void 0?s.initialRTO:z("TRANSMITTER_INITIAL_RTO"),this.initialRTT=s?.initialRTT!==void 0?s.initialRTT:z("TRANSMITTER_INITIAL_RTT"),this.rtt=s?.initialRTT!==void 0?s.initialRTT:z("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=s?.maxBatchAckCount!==void 0?s.maxBatchAckCount:z("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=s?.maxRTO!==void 0?s.maxRTO:z("TRANSMITTER_MAX_RTO")}packetize(t,n){return{type:Zl.Default,version:this.version,packetNumber:n,payload:t}}serialize(t){switch(t.type){case Zl.Default:{let n;typeof t.payload=="string"?n=new TextEncoder().encode(t.payload):n=t.payload;let s=new ArrayBuffer(n.length+15),o=new DataView(s);return o.setUint16(0,t.version),o.setUint8(2,t.type),o.setUint32(3,t.packetNumber),V4(o,7,BigInt(t.sendTs)),new Uint8Array(o.buffer).set(n,15),s}case Zl.Ack:{let n=new ArrayBuffer(16),s=new DataView(n);return s.setUint16(0,t.version),s.setUint8(2,t.type),s.setUint32(3,t.maxAckPacketNumber),s.setUint8(7,t.shift),V4(s,8,BigInt(t.ackSendTs)),n}}}deserialize(t){let n=new DataView(t),s=n.getUint16(0),o=n.getUint8(2);switch(o){case Zl.Default:{let u=n.getUint32(3),d=U4(n,7),f=t.slice(15),g=new Uint8Array(f);return{version:s,type:o,packetNumber:u,sendTs:Number(d),payload:g}}case Zl.Ack:{let u=n.getUint32(3),d=n.getUint8(7),f=U4(n,8);return{version:s,type:o,maxAckPacketNumber:u,shift:d,ackSendTs:Number(f)}}default:throw k.error("[".concat(this.ID,"] Unrecognized packet type ").concat(o)),new Error("Unrecognized packet type ".concat(o))}}sendMessage(t){z("DC_DEBUG_LOG")&&typeof t=="string"&&k.debug("[".concat(this.ID,"] sending message packet"),JSON.parse(t));let n=this.packetize(t,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;let s=this.calculateRTO(n),o=window.setTimeout(()=>{this.resendMessage(n)},s);this.timeoutMap.set(n.packetNumber,o),this.sendPacket(n)}onData(t){let n=this.deserialize(t);n.type===Zl.Default?this.ack(n):n.type===Zl.Ack&&(this.updateRTT(n,Math.round(performance.now())),this.clearRTO(n))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(t=>{let[n,s]=t;window.clearTimeout(s)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(t){let n=this.calculateRTO(t),s=window.setTimeout(()=>{z("DC_DEBUG_LOG")&&typeof t.payload=="string"&&k.debug("[".concat(this.ID,"] resending message packet"),JSON.parse(t.payload),"timeout: ".concat(n)),this.resendMessage(t)},n);this.timeoutMap.set(t.packetNumber,s),this.sendPacket(t)}calculateRTO(t){let n=this.rtoRatioMap.get(t.packetNumber);if(n===void 0)return this.rtoRatioMap.set(t.packetNumber,1),this.initialRTO;{let s=9*this.rtt/8*n;return this.rtoRatioMap.set(t.packetNumber,n+1),s>this.maxRTO?this.maxRTO:s}}updateRTT(t,n){let s=t.ackSendTs;this.rtt=this.rtt*(7/8)+(n-s-this.rtt)/8}ack(t){if(t.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(t):(this.batchAckPacketQueue.push(t),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(t.payload);;){let n=this.unorderedPacketQueue[0];if(!n){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(n.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(t.packetNumber<=this.lastOrderedPacketNumber){let n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Zl.Ack,version:this.version};z("DC_DEBUG_LOG")&&k.debug("[".concat(this.ID,"] sending ack packet"),n,"packetNumber: ".concat(t.packetNumber)),this.sendPacket(n)}else if(t.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[t.packetNumber-this.lastOrderedPacketNumber-2]=t;let n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Zl.Ack,version:this.version};z("DC_DEBUG_LOG")&&k.debug("[".concat(this.ID,"] sending ack packet"),n,"packetNumber: ".concat(t.packetNumber)),this.sendPacket(n)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;let t={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:Zl.Ack,version:this.version};z("DC_DEBUG_LOG")&&k.debug("[".concat(this.ID,"] sending batch ack packet"),t,"shift: ".concat(this.batchAckPacketQueue.length-1)),this.sendPacket(t),this.batchAckPacketQueue=[]}sendPacket(t){t.type===Zl.Default&&(t.sendTs=Math.round(performance.now()));let n=this.serialize(t);this.sendImpl(n)}clearRTO(t){for(let n=t.maxAckPacketNumber-t.shift;n<=t.maxAckPacketNumber;n++){let s=this.timeoutMap.get(n);s!==void 0&&window.clearTimeout(s),this.timeoutMap.delete(n),this.rtoRatioMap.delete(n)}}}class Fz extends Yfe{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),V(this,"_initMutex",void 0),V(this,"_reconnectInterrupter",void 0),V(this,"_url",void 0),V(this,"_transmitter",void 0),V(this,"_addresses",void 0),V(this,"_reliableTransmission",void 0),V(this,"_textEncoder",void 0),V(this,"_textDecoder",void 0),this._textEncoder=new TextEncoder,this._textDecoder=new TextDecoder,this._initMutex=new ki("datachannel");let{timeout:s,timeoutFactor:o}=n,u=Math.max(300,Math.floor(3*s/5)),d=Math.max(1.2,Math.floor(8*o)/10);Gs.ONLINE&&(this._retryConfig.timeout=u,this._retryConfig.timeoutFactor=d),Cr.on(Nm.NETWORK_STATE_CHANGE,(f,g)=>{f!==g&&(this.resetReconnectCount("network state change: ".concat(g," -> ").concat(f)),f===Gs.ONLINE?(this._retryConfig.timeout=u,this._retryConfig.timeoutFactor=d):(this._retryConfig.timeout=s,this._retryConfig.timeoutFactor=o))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=n;let s=(o,u)=>{this._addresses=t,this.currentURLIndex=this._addresses.findIndex(f=>f.fingerprint||z("FINGERPRINT"));let d=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(d).then(o).catch(u),this.once(li.CLOSED,()=>u(new he(Y.WS_DISCONNECT))),this.once(li.CONNECTED,()=>o())};return this._initMutex.lock().then(o=>new We((u,d)=>{s(u,d)}).then(()=>{o()}).catch(()=>{o()}))}async sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new he(Y.WS_ABORT,"datachannel is not ready");try{n||(t=JSON.stringify(t));let s=this._textEncoder.encode(t),o=afe(s,{raw:!0});this._reliableTransmission.sendMessage(o)}catch(s){throw new he(Y.WS_ERR,"send datachannel signal message error"+s.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(t){let n=JSON.stringify(t);return{compressed:n,compressedLength:n.length,origin:t}}sendMessageWithUint8Array(t){return{compressed:t,compressedLength:t.byteLength,origin:t}}createTransmitterConnection(t){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(t.ip,":").concat(t.port),new We((n,s)=>{var o;let u=()=>{k.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="recover",this.state="connected",this.resetReconnectCount("opened"),n()},d=async v=>{var R;if((R=this._closeEstablishingTransmitter)===null||R===void 0||R.call(this),k.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(v.code,", reason: ").concat(v.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=v.reason,this.state="reconnecting");let b=qa(this,li.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,A=await this.reconnectWithAction(b);if(this.state==="closed")return void k.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!A)return s(new he(Y.WS_DISCONNECT,"datachannel reconnect failed: ".concat(v.code))),void this.close(!0);n()}else s(new he(Y.WS_DISCONNECT,"datachannel close: ".concat(v.code))),this.close()},f=async v=>{try{var R;(R=this._reliableTransmission)===null||R===void 0||R.onData(v.data)}catch(b){console.log(b)}};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),k.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(t)));let g=(o=this._store)===null||o===void 0?void 0:o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),y=Date.now();ei(this,li.TO_CONNECT_DATACHANNEL).then(v=>{var R,b;if(!v)throw new Error("transmissonInfo not exist yet");let{transmitter:A,close:F}=v;this._transmitter=A,(R=this._store)===null||R===void 0||R.signalChannelOpen();let M=Date.now()-y;k.debug("[choose dc] dc open cost ".concat(M,"ms")),this._reliableTransmission=new qfe(j=>{var K;this._transmitter&&this._transmitter.readyState==="open"&&((K=this._transmitter)===null||K===void 0||K.send(j))},j=>{if(typeof j=="string")this.emit(li.ON_MESSAGE,j);else{let K=cfe(j,{raw:!0}).buffer,q=this._textDecoder.decode(K);this.emit(li.ON_MESSAGE,q)}}),this._closeEstablishingTransmitter=()=>{var j;(j=this._reliableTransmission)===null||j===void 0||j.close(),this._reliableTransmission=void 0,F()},u&&u(),A.onclose=d,A.onmessage=f,(b=this._store)===null||b===void 0||b.recordJoinChannelService({endTs:Date.now(),status:"success"},g),this._joinChannelServiceRecordIndex=g}).catch(v=>{var R;if((R=this._store)===null||R===void 0||R.recordJoinChannelService({endTs:Date.now(),status:v instanceof he&&v.code===Y.WS_ABORT?"aborted":"error",errors:[v]},g),this.state!=="closed"){if(v instanceof he&&v.code===Y.WS_ERR){let b=new he(Y.WS_ERR,"init datachannel failed! Error: ".concat(v.toString()));return k.error("[".concat(this._name,"]").concat(b)),void s(b)}d&&d(v)}else s(new he(Y.WS_DISCONNECT,"datachannel is closed: ".concat(v.toString())))})})}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||Cr.networkState!==Gs.OFFLINE||(this._onlineReconnectListener=Cr.onlineWaiter&&Cr.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let s=!0;if(this._reconnectInterrupter=()=>{s=!1},n){let f=yb(this._reconnectCount,this._retryConfig);k.debug("[".concat(this._name,"] wait ").concat(f,"ms to reconnect datachannel, mode: ").concat(t)),await We.race([Ci(f),this._onlineReconnectListener||new We(()=>{})])}if(this.state==="closed"||!s)return!1;this._reconnectCount+=1;let o=async(f,g)=>{this.emit(li.RECONNECT_CREATE_CONNECTION,g),await this.createTransmitterConnection(f)};try{if(t==="retry"){let f=this._addresses[this.currentURLIndex];await o(f,t)}else if(t==="tryNext"){this.currentURLIndex+=1;for(let g=this.currentURLIndex;g<this._addresses.length;g++){if(this._addresses[g].fingerprint||z("FINGERPRINT")){this.currentURLIndex=g;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return k.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);k.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));let f=this._addresses[this.currentURLIndex];await o(f,t)}else t==="recover"&&(k.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(li.FAILBACK));return!0}catch(f){var u,d;return k.error("[".concat(this._name,"] reconnect failed"),f.toString()),f!=null&&(u=f.data)!==null&&u!==void 0&&u.desc&&Array.isArray(f.data.desc)&&f.data.desc.length&&ke(d=f.data.desc).call(d,"dynamic key expired")?(this.emit(li.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,n)}}}class Xfe extends dr{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===nn.CONNECTED?this.emit(rt.WS_CONNECTED):t===nn.RECONNECTING?this.emit(rt.WS_RECONNECTING,this._websocketReconnectReason):t===nn.CLOSED&&this.emit(rt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}processPendingNotifications(){this.pendingNotifications.length!==0&&(k.debug("[".concat(this.clientId,"] processing ").concat(this.pendingNotifications.length," pending notifications")),this.pendingNotifications.forEach(t=>{let{type:n,message:s}=t;this.emit(n,s),n===wt.ON_NOTIFICATION&&this.handleNotification(s),n===wt.ON_USER_BANNED&&this.handleUserBanned(s)}),this.pendingNotifications=[])}handleUserBanned(t){switch(t.error_code){case 14:this.close(tn.UID_BANNED);break;case 15:this.close(tn.IP_BANNED);break;case 16:this.close(tn.CHANNEL_BANNED)}}constructor(t,n){super(),V(this,"__name__","DataChannelSignal"),V(this,"_disconnectedReason",void 0),V(this,"_websocketReconnectReason",void 0),V(this,"_connectionState",nn.CLOSED),V(this,"reconnectToken",void 0),V(this,"websocket",void 0),V(this,"openConnectionTime",void 0),V(this,"clientId",void 0),V(this,"lastMsgTime",Date.now()),V(this,"uploadCache",[]),V(this,"uploadCacheInterval",void 0),V(this,"rttRolling",new dk(5)),V(this,"pingpongTimer",void 0),V(this,"inflateDataTimer",void 0),V(this,"pingpongTimeoutCount",0),V(this,"ortc",void 0),V(this,"joinResponse",void 0),V(this,"multiIpOption",void 0),V(this,"initError",void 0),V(this,"spec",void 0),V(this,"store",void 0),V(this,"isJoining",!1),V(this,"pendingNotifications",[]),V(this,"onWebsocketMessage",s=>{if(s instanceof ArrayBuffer)return void this.emit(rt.ON_BINARY_DATA,s);let o=JSON.parse(s);if(z("DC_DEBUG_LOG")&&k.debug("[datachannel-signal] received packet",o),this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){let u="res-@".concat(o._id);this.emit(u,o._result,o._message)}else Object.prototype.hasOwnProperty.call(o,"_type")&&(this.isJoining?o._type===wt.ON_NOTIFICATION||o._type===wt.ON_USER_BANNED?(this.emit(o._type,o._message),o._type===wt.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===wt.ON_USER_BANNED&&this.handleUserBanned(o._message)):(this.pendingNotifications.push({type:o._type,message:o._message}),k.debug("[".concat(this.clientId,"] cached notification during join: ").concat(o._type))):(this.emit(o._type,o._message),o._type===wt.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===wt.ON_USER_BANNED&&this.handleUserBanned(o._message)))}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new Fz("gateway-".concat(this.clientId),this.spec.retryConfig,!0,n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===nn.CONNECTED&&this.reconnect("retry",Sp.OFFLINE)})}async request(t,n,s,o){let u=In(6,""),d={_id:u,_type:t,_message:n},f=this.websocket.connectionID,g=()=>new We((F,M)=>{if(this.connectionState===nn.CONNECTED)return F();let j=()=>{this.off(rt.WS_CLOSED,K),F()},K=()=>{this.off(rt.WS_CONNECTED,j),M(new he(Y.WS_ABORT))};this.once(rt.WS_CONNECTED,j),this.once(rt.WS_CLOSED,K),t!==ct.PUBLISH&&t!==ct.SUBSCRIBE&&t!==ct.UNSUBSCRIBE&&t!==ct.UNPUBLISH&&t!==ct.CONTROL&&t!==ct.RESTART_ICE||this.once(rt.DISCONNECT_P2P,()=>{M(new he(Y.DISCONNECT_P2P))}),t!==ct.PUBLISH&&t!==ct.RESTART_ICE||this.once(rt.ABORT_P2P_EXECUTION,()=>{M(new he(Y.DISCONNECT_P2P))})});if(this.connectionState!==nn.CONNECTING&&this.connectionState!==nn.RECONNECTING||t===ct.JOIN||t===ct.REJOIN||await g(),t===ct.LEAVE&&(this.websocket.unbindDcCloseEventListener(),o=!0),z("DC_DEBUG_LOG")&&k.debug("[datachannel-signal] sendMessage",d),await this.websocket.sendMessage(d,!0,!1),o)return;let y=new We((F,M)=>{let j=!1,K=(Q,se)=>{j=!0,F({isSuccess:Q==="success",message:se||{}}),this.off(rt.WS_CLOSED,q),this.off(rt.WS_RECONNECTING,q),this.emit(rt.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(u),K);let q=()=>{M(new he(Y.WS_ABORT,"type: ".concat(t))),this.off(rt.WS_CLOSED,q),this.off(rt.WS_RECONNECTING,q),this.off("res-@".concat(u),K)};this.once(rt.WS_CLOSED,q),this.once(rt.WS_RECONNECTING,q),Ci(z("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==f||j||(k.warning("dc request timeout, type: ".concat(t)),this.emit(rt.REQUEST_TIMEOUT,t,n))})}),v=null;try{v=await y}catch(F){if(this.connectionState===nn.CLOSED||t===ct.LEAVE)throw new he(Y.WS_ABORT);return!this.spec.forceWaitGatewayResponse||s?F.throw():t===ct.JOIN||t===ct.REJOIN?null:(await g(),await this.request(t,n))}if(v.isSuccess)return v.message;let R=Number(v.message.error_code||v.message.code),b=Km(R),A=new he(Y.UNEXPECTED_RESPONSE,"".concat(b.desc,": ").concat(v.message.error_str),{code:R,data:v.message});return b.action==="success"?v.message:(k.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(R,", message: ").concat(b.desc,", action: ").concat(b.action)),R===pt.ERR_TOO_MANY_BROADCASTERS?((t===ct.JOIN||t===ct.REJOIN)&&(this.initError=A,this.close()),A.throw()):b.action==="failed"?A.throw():b.action==="quit"?(this.initError=A,this.close(),A.throw()):(R===pt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=v.message.option,k.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Sp.MULTI_IP)):this.reconnect(b.action,Sp.SERVER_ERROR),t===ct.JOIN||t===ct.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new We(s=>{let o=u=>{(!n||n(u))&&(this.off(t,o),s(u))};this.on(t,o)})}uploadWRTCStats(t){if(!this.store.sessionId)return void k.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(zm.WRTC_STATS,n)}upload(t,n){let s={_type:t,_message:n};try{this.websocket.sendMessage(s)}catch{let o=z("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>o&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==nn.CONNECTED)return;let u=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(u._type,u._message)},z("UPLOAD_CACHE_INTERVAL")||2e3))}}async send(t,n){let s={_type:t,_message:n};await this.websocket.sendMessage(s)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new We((n,s)=>{this.once(rt.WS_CONNECTED,()=>n(this.joinResponse)),this.once(rt.WS_CLOSED,()=>s(this.initError||new he(Y.WS_ABORT))),this.connectionState=nn.CONNECTING,this.websocket.init(t).catch(s),this.websocket.once(li.FAILBACK,()=>{s(new he(Y.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{this.openConnectionTime===void 0&&(k.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),s(new he(Y.INIT_DATACHANNEL_TIMEOUT)))},z("DC_JOIN_WITH_FAILBACK"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this.isJoining=!1,this.pendingNotifications=[],this._disconnectedReason=t||tn.LEAVE,this.connectionState=nn.CLOSED,k.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),t===tn.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new Fz("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),z("DC_PINGPONG_INTERVAL")),!this.joinResponse){this.emit(rt.ABORT_P2P_EXECUTION),this.store.signalConnected();let t=await ei(this,rt.REQUEST_JOIN_INFO);this.store.joinReq(),this.isJoining=!0,this.pendingNotifications=[];let n=await this.request(ct.JOIN,t);if(this.store.joinRep(),this.ortc=t?.ortc,!n)return this.emit(rt.REPORT_JOIN_GATEWAY,Y.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(rt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=nn.CONNECTED,this.isJoining=!1,this.processPendingNotifications(),!0}async rejoin(){if(!this.reconnectToken)throw new he(Y.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let t=Pm(this,rt.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;let n=await this.request(ct.REJOIN,t);return!!n&&(this.connectionState=nn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),z("DC_PINGPONG_INTERVAL")),n.peers&&n.peers.forEach(s=>{this.emit(wt.ON_USER_ONLINE,{uid:s.uid}),s.audio&&this.emit(wt.ON_ADD_AUDIO_STREAM,{uid:s.uid,uint_id:s.uint_id,audio:!0,ssrcId:s.audio_ssrc}),s.video&&this.emit(wt.ON_ADD_VIDEO_STREAM,{uid:s.uid,uint_id:s.uint_id,video:!0,ssrcId:s.video_ssrc}),s.audio_mute?this.emit(wt.MUTE_AUDIO,{uid:s.uid}):this.emit(wt.UNMUTE_AUDIO,{uid:s.uid}),s.video_mute?this.emit(wt.MUTE_VIDEO,{uid:s.uid}):this.emit(wt.UNMUTE_VIDEO,{uid:s.uid}),s.audio_enable_local?this.emit(wt.ENABLE_LOCAL_AUDIO,{uid:s.uid}):this.emit(wt.DISABLE_LOCAL_AUDIO,{uid:s.uid}),s.video_enable_local?this.emit(wt.ENABLE_LOCAL_VIDEO,{uid:s.uid}):this.emit(wt.DISABLE_LOCAL_VIDEO,{uid:s.uid}),s.audio||s.video||this.emit(wt.ON_REMOVE_STREAM,{uid:s.uid,uint_id:s.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){if(!this.ortc)return!1;let n={downgrade_codec:t,ortc:this.ortc};return!!await this.request(ct.DOWNGRADE_CODEC,n)}handleNotification(t){k.debug("[".concat(this.clientId,"] receive notification: "),t);let n=Km(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(tn.UID_BANNED),void this.close()):void this.reconnect(n.action,Sp.SERVER_ERROR);k.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1,z("DC_DEBUG_LOG")&&console.debug("[datachannel-signal] pingpongTimeoutCount: ".concat(this.pingpongTimeoutCount));let t=z("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(k.warning("[datachannel-signal] PINGPONG Timeout. Last Socket Message: ".concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>z("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("recover",Sp.FALLBACK):this.request(ct.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let s=Date.now()-n;this.rttRolling.add(s),z("REPORT_STATS")&&this.send(ct.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleInflateData(){let{inflateLength:t,deflateLength:n}=this.websocket.getInflateData();t!==0&&n!==0&&this.upload(zm.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(li.RECONNECT_CREATE_CONNECTION,t=>{this.emit(rt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(li.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(li.CLOSED,()=>{this.connectionState=nn.CLOSED}),this.websocket.on(li.FAILED,()=>{this._disconnectedReason=tn.NETWORK_ERROR,this.connectionState=nn.CLOSED}),this.websocket.on(li.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===nn.CONNECTED?this.connectionState=nn.RECONNECTING:this.connectionState=nn.CONNECTING}),this.websocket.on(li.WILL_RECONNECT,(t,n)=>{if(Pm(this,rt.IS_P2P_DISCONNECTED)&&t==="retry")return k.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(rt.NEED_RENEW_SESSION),this.emit(rt.DISCONNECT_P2P),n("tryNext");t!=="retry"&&(k.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(rt.NEED_RENEW_SESSION),this.emit(rt.DISCONNECT_P2P)),n(t)}),this.websocket.on(li.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{k.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Sp.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(rt.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof he&&t.code===Y.UNEXPECTED_RESPONSE&&t.data.code===pt.ERR_NO_AUTHORIZED)return k.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Sp.SERVER_ERROR);k.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Sp.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(li.REQUEST_NEW_URLS,(t,n)=>{ei(this,rt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(li.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(wt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(li.TO_CONNECT_DATACHANNEL,(t,n)=>{ei(this,rt.PRE_CONNECT_PC).then(t).catch(n)}),this.websocket.on(li.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(rt.DATACHANNEL_FAILBACK)})}}let Jfe={name:"DataChannelConnection",create:function(e){let{store:t,spec:n}=e;return new Kfe(n,t)}},$fe={name:"DataChannelSignal",create:function(e){let{store:t,spec:n}=e;return new Xfe(n,t)}};_k(),Ln("PROCESS_ID","process-".concat(In(8,""),"-").concat(In(4,""),"-").concat(In(4,""),"-").concat(In(4,""),"-").concat(In(12,""))),(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void k.error("Error loading sdk config",t.message)}if(e)try{let t=JSON.parse(window.atob(e)),n=Date.now();k.debug("Loading global parameters from cache",t),Object.keys(t).forEach(s=>{if(Object.prototype.hasOwnProperty.call(An,s)){let{value:o,expires:u}=t[s];if(u&&u<=n)return;fo[s]=o,An[s]=o}})}catch(t){k.error("Error loading mutableParamsCache: ".concat(e),t.message)}})(),Array.isArray(fo.AREAS)&&fo.AREAS.length>0&&ED(fo.AREAS,!0);let jz=(e,t,n)=>{k.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),Ln(e,t,n)};td(pfe,!1),td(gfe,!1),td(Khe,!1),td(Ife,!1),td(ufe,!1),td(Ffe,!1),td(Wfe,!1),td(Hfe,!1),td(Jfe,!1),td($fe,!1);let ti=(function(e){let t=new dr,n=e,s={getListeners:t.getListeners.bind(t),on:(o,u)=>((function(d,f){d===Qu.SECURITY_POLICY_VIOLATION&&fH(f,!0)})(o,u),t.on.bind(t)(o,u)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return pH(pH({},n),s)})({__TRACK_LIST__:Um,VERSION:Xo,BUILD:vk,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:jz,getParameter:z,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection,n=await(async function(s){let o;return Qt().supportUnifiedPlan?(s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"}),o=(await s.createOffer()).sdp):o=(await s.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,o})(t);if(!n)return e;t.close(),t=null,e=(function(s){let o={video:[],audio:[]};return s.match(/ VP8/i)&&o.video.push("VP8"),s.match(/ VP9/i)&&o.video.push("VP9"),s.match(/ AV1/i)&&o.video.push("AV1"),s.match(/ H264/i)&&o.video.push("H264"),s.match(/ H265/i)&&o.video.push("H265"),s.match(/ opus/i)&&o.audio.push("OPUS"),s.match(/ PCMU/i)&&o.audio.push("PCMU"),s.match(/ PCMA/i)&&o.audio.push("PCMA"),s.match(/ G722/i)&&o.audio.push("G722"),o})(n)}catch(t){throw new he(Y.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],t=tt.reportApiInvoke(null,{name:or.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Fn.TRACER}),n=(function(){let u=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],d=!1;try{let f=window.RTCPeerConnection,g=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,y=window.WebSocket;d=!(!f||!y),u&&!g&&(d=!1),d&&RT()&&b4(75)&&new f().close()}catch(f){k.error("check system requirement failed: ",f),d=!1}return d})(e),s=qhe();k.debug("checkSystemRequirements, api:",n,"browser",s);let o=n&&s;return t.onSuccess(o),z("IGNORE_RTC_DEVICE_CHECK")?n:o},getDevices:function(e){return yo.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return yo.getRecordingDevices(e)},getCameras:function(e){return yo.getCamerasDevices(e)},getElectronScreenSources:P5,getPlaybackDevices:function(e){return yo.getSpeakers(e)},createClient:uH,createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=z("CAMERA_CAPTURE_CONFIG"),n=In(8,"track-cam-"),s=tt.reportApiInvoke(null,{id:n,tag:Fn.TRACER,name:or.CREATE_CAM_VIDEO_TRACK,options:[qn({},e),t]});t&&(e.encoderConfig=t);let o=kb(e),u=null;k.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{u=(await Eo({video:o},n)).getVideoTracks()[0]||null}catch(f){throw s.onError(f),f}if(!u){let f=new _e(Y.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(f),f.throw(k)}if(e.optimizationMode&&Fk(n,u,e,zc(e.encoderConfig)),z("USE_STANDARD_BITRATE_DEFAULT")){let f=zc(e.encoderConfig);e.encoderConfig=f,delete f.bitrateMax,delete f.bitrateMin}let d=new xb(u,e,o,e.scalabiltyMode?Ab(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return s.onSuccess(d.getTrackId()),k.info("create camera video success, trackId:",n),d},createCustomVideoTrack:function(e){let t=In(8,"track-cus-"),n=tt.reportApiInvoke(null,{id:t,tag:Fn.TRACER,name:or.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});z("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);let s=new jn(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?Ab(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[bn.CUSTOM_TRACK]);return n.onSuccess(s.getTrackId()),k.info("create custom video track success with config",e,"trackId",s.getTrackId()),s},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable",n=typeof t=="object"?(function(b){let A=B5(b);return v5()&&b.suppressLocalAudioPlayback&&(A.suppressLocalAudioPlayback=b.suppressLocalAudioPlayback),S5()&&b.restrictOwnAudio&&(A.restrictOwnAudio=!0),A})(t):void 0;n&&(t="auto");let s=In(8,"track-scr-v-"),o=tt.reportApiInvoke(null,{id:s,tag:Fn.TRACER,name:or.CREATE_SCREEN_VIDEO_TRACK,options:[qn({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";let u=(function(b){let A={};b.screenSourceType&&(A.mediaSource=b.screenSourceType),b.extensionId&&Qd()&&(A.extensionId=b.extensionId);let{displaySurface:F,selfBrowserSurface:M,surfaceSwitching:j,systemAudio:K,preferCurrentTab:q,windowAudio:Q,monitorTypeSurfaces:se}=b;(jl(107)||gp(107)||Am(93))&&(F&&(zr(F,"displaySurface",["browser","window","monitor"]),A.displaySurface=F),M?(zr(M,"selfBrowserSurface",["exclude","include"]),A.selfBrowserSurface=M):A.selfBrowserSurface="include",j&&(zr(j,"surfaceSwitching",["exclude","include"]),A.surfaceSwitching=j)),(jl(105)||gp(105)||Am(91))&&K&&(zr(K,"systemAudio",["exclude","include"]),A.systemAudio=K),(jl(94)||gp(94)||Am(80))&&q&&(A.preferCurrentTab=!0),(jl(141)||gp(141)||Am(125))&&Q&&(zr(Q,"windowAudio",["exclude","system"]),A.windowAudio=Q),(jl(119)||gp(119)||Am(105))&&se&&(zr(se,"monitorTypeSurfaces",["exclude","include"]),A.monitorTypeSurfaces=se),b.electronScreenSourceId&&(A.sourceId=b.electronScreenSourceId);let oe=b.encoderConfig?bk(b.encoderConfig):null;return A.mandatory={chromeMediaSource:"desktop",maxWidth:oe?oe.width:void 0,maxHeight:oe?oe.height:void 0},oe&&(oe.frameRate&&(typeof oe.frameRate=="number"?(A.mandatory.maxFrameRate=oe.frameRate,A.mandatory.minFrameRate=oe.frameRate):(A.mandatory.maxFrameRate=oe.frameRate.max||oe.frameRate.ideal||oe.frameRate.exact||void 0,A.mandatory.minFrameRate=oe.frameRate.min||oe.frameRate.ideal||oe.frameRate.exact||void 0),A.frameRate=oe.frameRate),oe.width&&(A.width=oe.width),oe.height&&(A.height=oe.height)),A})(e),d=null,f=null,g=Qt();if(!g.supportShareAudio&&t==="enable"){let b=new _e(Y.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return o.onError(b),b.throw(k)}k.info("start create screen video track with config",e,"withAudio",t,"trackId",s);let y=g.supportShareAudio&&t!=="disable";try{let b=await Eo({screen:u,screenAudio:y?n||!0:void 0},s);d=b.getVideoTracks()[0]||null,f=b.getAudioTracks()[0]||null}catch(b){throw o.onError(b),b}if(!d){let b=new _e(Y.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(b),b.throw(k)}if(!f&&t==="enable"){d&&d.stop();let b=new _e(Y.SHARE_AUDIO_NOT_ALLOWED);return o.onError(b),b.throw(k)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(Fk(s,d,e,e.encoderConfig&&bk(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));let v=new jn(d,e.encoderConfig?bk(e.encoderConfig):{},e.scalabiltyMode?Ab(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,s,[bn.SCREEN_TRACK]);if(!f)return o.onSuccess(v.getTrackId()),k.info("create screen video track success","video:",v.getTrackId()),v;let R=new Nr(f,void 0,In(8,"track-scr-a-"),!1);return o.onSuccess([v.getTrackId(),R.getTrackId()]),k.info("create screen video track success","video:",v.getTrackId(),"audio:",R.getTrackId()),[v,R]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=z("CAMERA_CAPTURE_CONFIG"),s=In(8,"track-mic-"),o=In(8,"track-cam-"),u=tt.reportApiInvoke(null,{id:"".concat(s,"-").concat(o),tag:Fn.TRACER,name:or.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);let d=kb(t),f=W5(e),g=null,y=null;k.info("start create camera video track(".concat(o,") and microphone audio track(").concat(s,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{let b=await Eo({audio:f,video:d},"".concat(s,"-").concat(o));g=b.getAudioTracks()[0],y=b.getVideoTracks()[0]}catch(b){throw u.onError(b),b}if(!g||!y){let b=new _e(Y.UNEXPECTED_ERROR,"can not find tracks in media stream");return u.onError(b),b.throw(k)}if(t.optimizationMode&&Fk(o,y,t,zc(t.encoderConfig)),z("USE_STANDARD_BITRATE_DEFAULT")){let b=zc(t.encoderConfig);t.encoderConfig=b,delete b.bitrateMax,delete b.bitrateMin}let v=new LT(g,e,f,s),R=new xb(y,t,d,t.scalabiltyMode?Ab(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,o);return u.onSuccess([v.getTrackId(),R.getTrackId()]),k.info("create camera video track(".concat(o,") and microphone audio track(").concat(s,") success")),[v,R]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=In(8,"track-mic-"),n=tt.reportApiInvoke(null,{id:t,tag:Fn.TRACER,name:or.CREATE_MIC_AUDIO_TRACK,options:[e]}),s=W5(e),o=null;k.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{o=(await Eo({audio:s},t)).getAudioTracks()[0]||null}catch(d){throw n.onError(d),d}if(!o){let d=new _e(Y.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(d),d.throw(k)}let u=new LT(o,e,s,t);return n.onSuccess(u.getTrackId()),k.info("create microphone audio track success, trackId:",t),u},createCustomAudioTrack:fW,createBufferSourceAudioTrack:async function(e){var t;let{cacheOnlineFile:n,encoderConfig:s}=e,{source:o}=e,u={source:o instanceof AudioBuffer?"AudioBuffer":o instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":o,cacheOnlineFile:n,encoderConfig:s},d=In(8,"track-buf-"),f=tt.reportApiInvoke(null,{id:d,tag:Fn.TRACER,name:or.CREATE_BUFFER_AUDIO_TRACK,options:[u]});if(z("DISABLE_WEBAUDIO"))throw new _e(Y.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");k.info("start create buffer source audio track with config",JSON.stringify(u),"trackId",d);let g=o;if(!(o instanceof AudioBuffer))try{o=await(async function(R,b){let A=null;if(typeof R=="string"){let M=O6.get(R);if(M)return k.debug("use cached audio resource: ",R),M;try{A=(await Bl(()=>oa.get(R,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(j){throw new _e(Y.FETCH_AUDIO_FILE_FAILED,j.toString())}}else A=await new We((M,j)=>{let K=new FileReader;K.onload=q=>{q.target?M(q.target.result):j(new _e(Y.READ_LOCAL_AUDIO_FILE_ERROR))},K.onerror=()=>{j(new _e(Y.READ_LOCAL_AUDIO_FILE_ERROR))},K.readAsArrayBuffer(R)});let F=await(function(M){let j=ME();return new We((K,q)=>{j.decodeAudioData(M,Q=>{K(Q)},Q=>{q(new _e(Y.DECODE_AUDIO_FILE_FAILED,Q.toString()))})})})(A);return typeof R=="string"&&b&&O6.set(R,F),F})(o,n)}catch(R){return f.onError(R),R.throw(k)}let y=new hde(o),v=new dde(g,y,s?Ob(s):{},d);return k.info("create buffer source audio track success, trackId:",d),f.onSuccess(v.getTrackId()),v},setAppType:function(e){if(k.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw k.debug("Invalid appType"),new he(Y.INVALID_PARAMS,"invalid app type",e);Ln("APP_TYPE",Math.floor(e))},setLogLevel:function(e){k.setLogLevel(e)},enableLogUpload:function(){z("USE_NEW_LOG")?Ln("UPLOAD_LOG",!0):k.enableLogUpload()},disableLogUpload:function(){z("USE_NEW_LOG")?Ln("UPLOAD_LOG",!1):k.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new k8},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,n=tt.reportApiInvoke(null,{tag:Fn.TRACER,name:or.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Nr||e instanceof FE)){let g=new he(Y.INVALID_TRACK,"the parameter is not a audio track");return n.onError(g),g.throw()}t&&t<1e3&&(t=1e3);let s=e instanceof Nr?e.getTrackLabel():"remote_track",o=e.getVolumeLevel(),u=o,d=o,f=Date.now();return new We(g=>{let y=setInterval(()=>{let v=e.getVolumeLevel();u=v>u?v:u,d=v<d?v:d;let R=u-d>1e-4,b=Date.now()-f;if(R||b>t){clearInterval(y);let A=R,F={duration:b,deviceLabel:s,maxVolumeLevel:u,result:A};k.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(F))),n.onSuccess(F),g(A)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,n=tt.reportApiInvoke(null,{tag:Fn.TRACER,name:or.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof jn||e instanceof VE)){let R=new he(Y.INVALID_TRACK,"the parameter is not a video track");return n.onError(R),R.throw()}t&&t<1e3&&(t=1e3);let s=e instanceof jn?e.getTrackLabel():"remote_track",o=e.getMediaStreamTrack(!0),u=document.createElement("video");u.style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(Pi()||gb())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([o]),u.play();let d=document.createElement("canvas");d.width=160,d.height=120;let f=0,g=0;try{let R=Date.now();f=await(function(b,A,F,M){let j,K=0,q=null;return new We((Q,se)=>{function oe(){K>M&&j&&(j(),Q(K));let ne=F.getContext("2d");if(!ne){let Oe=new he(Y.UNEXPECTED_ERROR,"can not get canvas 2d context.");return k.error(Oe.toString()),void se(Oe)}ne.drawImage(b,0,0,160,120);let de=ne.getImageData(0,0,F.width,F.height),we=Math.floor(de.data.length/3);if(q){for(let Oe=0;Oe<we;Oe+=3)if(de.data[Oe]!==q[Oe])return K+=1,void(q=de.data);q=de.data}else q=de.data}setTimeout(()=>{j&&(j(),Q(K))},A),j=kk(()=>{oe()},30)})})(u,t,d,4),g=Date.now()-R}catch(R){throw n.onError(R),R}Phe===_n.SAFARI&&(u.pause(),u.remove()),u.srcObject=null;let y=f>4,v={duration:g,changedPicNum:f,deviceLabel:s,result:y};return k.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(v))),n.onSuccess(v),y},setArea:ED,audioElementPlayCenter:Ps,resumeAudioContext:function(){return Ps.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){Jhe.processExternalMediaAEC(e)},registerExtensions:function(e){let t=z("PLUGIN_INFO")||[];e.forEach(n=>{"name"in n&&!ke(t).call(t,n.name)&&t.push(n.name);let s=n;s.__registered__=!0,s.logger.hookLog=k.extLog,s.reporter.hookApiInvoke=tt.extApiInvoke,s.parameters&&Object.keys(s.parameters).forEach(o=>{s.parameters[o]=z(o)})}),jz("PLUGIN_INFO",t)},ChannelMediaRelayError:WE,ChannelMediaRelayEvent:nh,ChannelMediaRelayState:Ia,RemoteStreamFallbackType:sde,RemoteStreamType:ide,ConnectionDisconnectedReason:tn,AudienceLatencyLevelType:Due,AREAS:yn,preload:async function(e,t,n,s){return jD(e,t,n,s)},startLastmileProbeTest:async function(e,t,n,s){let o={state:"unavailable"};await jD(e,t,n,s);let u=await BD({appId:e,cname:t,token:n||e,uid:s,cloudProxyServer:"disabled"});if(!u)return o;await WD(u);let d,f=uH({mode:"rtc",codec:"vp8"});try{d=await f.join(e,t,n,s,{networkQualityProbe:!0})}catch{return o}let g=new Lhe,y=g.createMuteAudioTrack(),v=await fW({mediaStreamTrack:y});await f.publish([v]);let[R,b,A]=await new We((Q,se)=>{let oe=setTimeout(()=>{clearTimeout(oe),Q([!0,null,"audio"])},5e3);f.on("user-published",async(ne,de)=>{ne.uid===d&&(clearTimeout(oe),Q([!1,ne,de]))})});if(R||!b)return await f.unpublish([v]),await f.leave(),v.close(),g.close(),o;await f.subscribe(b,A),await new We((Q,se)=>{let oe=setTimeout(()=>{clearTimeout(oe),Q(null)},5e3)});let F=f.getRTCStats(),M=f.getLocalAudioStats(),j=F.RTT,K=M.sendJitterMs,q=M.currentPacketLossRate;return o={state:"complete",rtt:j,packetLossRate:q,jitter:K,networkQuality:((Q,se,oe)=>{let ne=1;if(oe>0){let at=Math.log(100*oe)/Math.log(2)+1;at=Math.min(5,Math.max(0,at)),ne=1-at/5}let de=1;if(Q>0){let at=Math.log(Q/40)/Math.log(2)+1;at=Math.min(5,Math.max(0,at)),de=1-at/5}let we=1;if(se>0){let at=Math.log(se/10)/Math.log(2.5)+1;at=Math.min(5,Math.max(0,at)),we=1-at/5}let Oe=.5*ne+.3*de+.2*we,Qe=0;return Qe=Oe>=.8?1:Oe>=.6?2:Oe>=.4?3:Oe>=.2?4:5,Qe})(j,K,q)},await f.unsubscribe(b),await f.unpublish([v]),await f.leave(),v.close(),g.close(),await WD(u),o}});return Object.defineProperties(ti,{onAudioAutoplayFailed:{get:()=>la.onAudioAutoplayFailed,set:e=>{la.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>la.onAutoplayFailed,set:e=>{la.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>ti._onSecurityPolicyViolation,set(e){ti._onSecurityPolicyViolation=e,fH(e)}},__CLIENT_LIST__:{get:()=>z("SHOW_GLOBAL_CLIENT_LIST")?Gm:[]}}),yo.on(Fm.CAMERA_DEVICE_CHANGED,e=>{k.info("camera device changed",JSON.stringify(e)),ti.onCameraChanged&&ti.onCameraChanged(e),ti.safeEmit(Qu.CAMERA_CHANGED,e)}),yo.on(Fm.RECORDING_DEVICE_CHANGED,e=>{k.info("microphone device changed",JSON.stringify(e)),ti.onMicrophoneChanged&&ti.onMicrophoneChanged(e),ti.safeEmit(Qu.MICROPHONE_CHANGED,e)}),yo.on(Fm.PLAYOUT_DEVICE_CHANGED,e=>{k.debug("playout device changed",JSON.stringify(e)),ti.onPlaybackDeviceChanged&&ti.onPlaybackDeviceChanged(e),ti.safeEmit(Qu.PLAYBACK_DEVICE_CHANGED,e)}),Ps.onAutoplayFailed=()=>{k.info("detect audio element autoplay failed"),la.onAudioAutoplayFailed&&la.onAudioAutoplayFailed()},Mn.on("autoplay-failed",()=>{k.info("detect webaudio autoplay failed"),la.onAudioAutoplayFailed&&la.onAudioAutoplayFailed(),ti.safeEmit(Qu.AUTOPLAY_FAILED)}),Mn.on(zi.STATE_CHANGE,(e,t)=>{k.info("audio context state changed: ".concat(t," => ").concat(e)),ti.onAudioContextStateChanged&&ti.onAudioContextStateChanged(e,t),ti.safeEmit(Qu.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),Cr.on(Nm.NETWORK_STATE_CHANGE,(e,t)=>{k.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=ti),ti})}),lne={};V2e(lne,{AgoraRTCProvider:()=>hne,AgoraRTCReactError:()=>eo,AgoraRTCScreenShareProvider:()=>X2e,LocalAudioTrack:()=>Ene,LocalUser:()=>mO,LocalVideoTrack:()=>Sne,RemoteAudioTrack:()=>wne,RemoteUser:()=>Rne,RemoteVideoTrack:()=>Cne,TrackBoundary:()=>cUe,VERSION:()=>pUe,default:()=>bne,useAutoPlayAudioTrack:()=>wV,useAutoPlayVideoTrack:()=>TV,useClientEvent:()=>K2e,useConnectionState:()=>$2e,useCurrentUID:()=>Q2e,useIsConnected:()=>_v,useJoin:()=>fne,useLocalCameraTrack:()=>vV,useLocalMicrophoneTrack:()=>yV,useLocalScreenTrack:()=>_ne,useNetworkQuality:()=>Z2e,usePublish:()=>mne,useRTCClient:()=>hl,useRTCScreenShareClient:()=>J2e,useRemoteAudioTracks:()=>iUe,useRemoteUserTrack:()=>c2,useRemoteUsers:()=>gne,useRemoteVideoTracks:()=>sUe,useTrackEvent:()=>Y2e,useVolumeLevel:()=>tUe});var j2e=Gg(Hg());function xa(i,r,a){return i.on(r,a),()=>i.off(r,a)}function B2e(i){try{return i()}catch(r){console.error(r)}}function zg(i){return()=>i.forEach(B2e)}function W2e(i,r){let a=setInterval(i,r);return()=>clearInterval(a)}function tN(i,r){let a=setTimeout(i,r);return()=>clearTimeout(a)}function EV(){let i,r,a;function c(){if(r){let T=r;r=void 0,T()}}async function l(){if(a){let T=a;a=void 0;try{await T()}catch(C){console.error(C)}}}async function h(T){i=!0,await l();try{a=await T()}catch(C){console.error(C)}i=!1,c()}async function m(){i=!0,await l(),i=!1,c()}function E(T){i?r=()=>h(T):h(T)}function S(){i?r=m:m()}return{run:E,dispose:S}}var nN=typeof document<"u"?G.useLayoutEffect:G.useEffect;function G2e(i){return i!=null&&typeof i.then=="function"}function wf(){let i=G.useRef(!1);return G.useEffect(()=>(i.current=!1,()=>{i.current=!0}),[]),i}function H2e(){let i=wf();function r(a,c){return new Promise(async(l,h)=>{try{let m=await a;i.current||l(m)}catch(m){i.current?c&&c(m):h(m)}})}return G.useCallback(r,[i])}function une(i){let r=H2e(),[a,c]=G.useState();return nN(()=>{G2e(i)?r(i).then(c):c(i)},[i,r]),a}function Kg(i,r){let a=G.useRef();G.useEffect(()=>{let{run:c,dispose:l}=a.current||=EV();return c(i),l},r)}function z2e(i,r){let a=i.split("."),c=r.split("."),l=Math.max(a.length,c.length);for(let h=0;h<l;h++){let m=parseInt(a[h]||"0"),E=parseInt(c[h]||"0");if(m>E)return 1;if(m<E)return-1}return 0}function K2e(i,r,a){let c=G.useRef(a);nN(()=>{c.current=a},[a]),G.useEffect(()=>{if(i)return xa(i,r,(...l)=>{c.current&&c.current(...l)})},[r,i])}function Y2e(i,r,a){let c=G.useRef(a);nN(()=>{c.current=a},[a]),G.useEffect(()=>{if(i)return xa(i,r,(...l)=>{c.current&&c.current(...l)})},[r,i])}var dne=G.createContext(null);function hne({client:i,children:r}){return D.jsx(dne.Provider,{value:i,children:r})}function q2e(i){let r=G.useContext(dne);return i||r}function hl(i){let r=q2e(i);if(!r)throw new Error("Agora RTC client not found. Should be wrapped in <AgoraRTCProvider value={client} />");return r}var pne=G.createContext(null);function X2e({client:i,children:r}){return D.jsx(pne.Provider,{value:i,children:r})}function J2e(i){let r=G.useContext(pne);return i||r}function $2e(i){let r=hl(i),[a,c]=G.useState(r?r.connectionState:"DISCONNECTED");return G.useEffect(()=>{if(r){c(r.connectionState);let l;return zg([xa(r,"connection-state-change",h=>{l?.(),h==="CONNECTED"?l=tN(()=>c(h),0):c(h)}),()=>l?.()])}else c("DISCONNECTED")},[r]),a}function _v(i){let r=hl(i),[a,c]=G.useState(r?r.connectionState==="CONNECTED":!1);return G.useEffect(()=>{if(r){c(r.connectionState==="CONNECTED");let l;return zg([xa(r,"connection-state-change",h=>{l?.(),l=tN(()=>c(h==="CONNECTED"),0)}),()=>l?.()])}else c(!1)},[r]),a}function Q2e(i){let r=hl(i),[a,c]=G.useState(r?.uid);return G.useEffect(()=>{if(r)return xa(r,"connection-state-change",l=>{if(l==="CONNECTED")return tN(()=>c(r.uid),0);l==="DISCONNECTED"&&c(void 0)})},[r]),a}var eo=class extends Error{rtcMethod;rtcError;name="AgoraRTCReactException";constructor(i,r){typeof r=="string"?super(r):super(r.message),this.rtcMethod=i,this.rtcError=r}log(i){console[i](this)}};function fne(i,r=!0,a){let c=hl(a),l=_v(a),h=G.useRef(),[m,E]=G.useState(!1),[S,T]=G.useState(0),[C,I]=G.useState(null),N=wf();return Kg(async()=>{if(N.current||(I(null),T(0),E(!1)),r&&c){try{N.current||E(!0);let{appid:H,channel:x,token:B,uid:X}=typeof i=="function"?await i():i,Z=await c.join(H,x,B,X);N.current||T(Z)}catch(H){console.error(H),N.current||I(new eo("IAgoraRTCClient.join",H))}N.current||E(!1);let P=h.current||=EV();return zg([()=>{P.dispose()},()=>{P.run(()=>c.unpublish(c.localTracks))},()=>{for(let H of c.localTracks)H.isPlaying&&H.stop(),H.close();P.run(()=>c.leave())}])}},[r,a]),{data:S,isLoading:m,isConnected:l,error:C}}var Oq=()=>({uplinkNetworkQuality:0,downlinkNetworkQuality:0,delay:0});function Z2e(i){let r=hl(i),[a,c]=G.useState(Oq);return G.useEffect(()=>{if(r)return xa(r,"network-quality",l=>c({uplinkNetworkQuality:l.uplinkNetworkQuality,downlinkNetworkQuality:l.downlinkNetworkQuality,delay:r.getRTCStats().RTT??0}));c(Oq())},[r]),a}var eUe=Gg(Hg());function mne(i,r=!0,a){let c=hl(a),l=_v(a),h=G.useRef([]),[m,E]=G.useState(!1),[S,T]=G.useState(null),C=wf();return Kg(async()=>{if(C.current||(E(!1),T(null)),!c||!l||!r)return;let I=i.filter(Boolean),N=x=>{let B=z2e(eUe.default.VERSION,"4.18.2")>=0;return B||new eo("usePublish","please check your agora-rtc-sdk-ng version in package.json, it's recommend upgrade to >= 4.18.2").log("warn"),B?c.mode!=="live"||c.role!=="audience":!0},P=x=>h.current.some(B=>B&&B.getTrackId()===x.getTrackId()),H=x=>N()&&x.enabled&&r&&!P(x);for(let x=0;x<I.length;x++){let B=I[x];if(B&&H(B)){await c.unpublish(h.current.filter(X=>X?.trackMediaType===B.trackMediaType));try{C.current||E(!0),await c.publish(B)}catch(X){console.error(X),C.current||T(new eo("IAgoraRTCClient.publish",X))}C.current||E(!1)}}h.current=I},[l,r,c,i]),{isLoading:m,error:S}}function tUe(i){let[r,a]=G.useState(0);return G.useEffect(()=>{if(i)return W2e(()=>{a(i.getVolumeLevel())},1e3)},[i]),r}var nUe=Gg(Hg());function yV(i=!0,r={ANS:!0,AEC:!0}){let[a,c]=G.useState(null),[l,h]=G.useState(!1),[m,E]=G.useState(null),S=wf();return Kg(async()=>{if(S.current||(h(!1),E(null)),i&&!a){try{S.current||h(!0);let T=await nUe.default.createMicrophoneAudioTrack(r);S.current||c(T)}catch(T){console.error(T),S.current||E(new eo("IAgoraRTC.createMicrophoneAudioTrack",T))}S.current||h(!1)}},[i]),{localMicrophoneTrack:a,isLoading:l,error:m}}var rUe=Gg(Hg());function vV(i=!0,r){let[a,c]=G.useState(null),[l,h]=G.useState(!1),[m,E]=G.useState(null),S=wf();return Kg(async()=>{if(S.current||(h(!1),E(null)),i&&!a){try{S.current||h(!0);let T=await rUe.default.createCameraVideoTrack(r);S.current||c(T)}catch(T){console.error(T),S.current||E(new eo("IAgoraRTC.createCameraVideoTrack",T))}S.current||h(!1)}},[i]),{localCameraTrack:a,isLoading:l,error:m}}function iUe(i,r){let a=hl(r),[c,l]=G.useState([]),h=_v(),m=G.useRef([]),[E,S]=G.useState(!1),[T,C]=G.useState(null),I=wf();return Kg(async()=>{if(I.current||C(null),!Array.isArray(i)||!h)return;let N=async x=>{if(!x.audioTrack&&i.some(({uid:B})=>x.uid===B)){try{I.current||S(!0),await a.subscribe(x,"audio")}catch(B){console.error(B),I.current||C(new eo("IAgoraRTCClient.subscribe",B))}x.audioTrack&&!m.current.some(B=>B.getUserId()===x.uid)&&m.current.push(x.audioTrack),m.current=m.current.map(B=>x.audioTrack&&B.getUserId()===x.uid&&B.getTrackId()!==x.audioTrack.getTrackId()?x.audioTrack:B),I.current||(l([...m.current]),S(!1))}},P=async x=>{if(i.some(({uid:B})=>x.uid===B)){I.current||(m.current=m.current.filter(B=>B.getUserId()!==x.uid),l([...m.current]));try{I.current||S(!0),await a.unsubscribe(x,"audio")}catch(B){console.error(B),I.current||C(new eo("IAgoraRTCClient.unsubscribe",B))}I.current||S(!1)}};i.map(x=>{!x.audioTrack&&x.hasAudio&&N(x)});let H=[];for(let x=0;x<m.current.length;x++){let B=m.current[x];if(!i.some(X=>X.uid===B.getUserId())){let X=a.remoteUsers.find(Z=>Z.uid===B.getUserId());X&&H.push({user:X,mediaType:"audio"}),m.current.splice(x,1),x--}}if(H.length>0){try{I.current||S(!0),await a.massUnsubscribe(H)}catch(x){console.error(x),I.current||C(new eo("IAgoraRTCClient.massUnsubscribe",x))}I.current||(l(m.current.slice()),S(!1))}return zg([xa(a,"user-published",(x,B)=>{i.find(X=>X.uid===x.uid)&&B==="audio"&&N(x)}),xa(a,"user-unpublished",(x,B)=>{i.find(X=>X.uid===x.uid)&&B==="audio"&&P(x)})])},[h,a,i]),{audioTracks:c,isLoading:E,error:T}}function sUe(i,r){let a=hl(r),[c,l]=G.useState([]),h=_v(),m=G.useRef([]),[E,S]=G.useState(!1),[T,C]=G.useState(null),I=wf();return Kg(async()=>{if(I.current||C(null),!Array.isArray(i)||!h)return;let N=async x=>{if(!x.videoTrack&&i.some(({uid:B})=>x.uid===B)){try{I.current||S(!0),await a.subscribe(x,"video")}catch(B){console.error(B),I.current||C(new eo("IAgoraRTCClient.subscribe",B))}x.videoTrack&&!m.current.some(B=>B.getUserId()===x.uid)&&m.current.push(x.videoTrack),m.current=m.current.map(B=>x.videoTrack&&B.getUserId()===x.uid&&B.getTrackId()!==x.videoTrack.getTrackId()?x.videoTrack:B),I.current||(l([...m.current]),S(!1))}},P=async x=>{if(i.some(({uid:B})=>x.uid===B)){I.current||(m.current=m.current.filter(B=>B.getUserId()!==x.uid),l([...m.current]));try{I.current||S(!0),await a.unsubscribe(x,"video")}catch(B){console.error(B),I.current||C(new eo("IAgoraRTCClient.unsubscribe",B))}I.current||S(!1)}};i.map(x=>{!x.videoTrack&&x.hasVideo&&N(x)});let H=[];for(let x=0;x<m.current.length;x++){let B=m.current[x];if(!i.some(X=>X.uid===B.getUserId())){let X=a.remoteUsers.find(Z=>Z.uid===B.getUserId());X&&H.push({user:X,mediaType:"video"}),m.current.splice(x,1),x--}}if(H.length>0){try{I.current||S(!0),await a.massUnsubscribe(H)}catch(x){console.error(x),I.current||C(new eo("IAgoraRTCClient.massUnsubscribe",x))}I.current||(l(m.current.slice()),S(!1))}return zg([xa(a,"user-published",(x,B)=>{i.find(X=>X.uid===x.uid)&&B==="video"&&N(x)}),xa(a,"user-unpublished",(x,B)=>{i.find(X=>X.uid===x.uid)&&B==="video"&&P(x)})])},[h,a,i]),{videoTracks:c,isLoading:E,error:T}}function c2(i,r,a){let c=hl(a),l=r==="audio"?"audioTrack":"videoTrack",[h,m]=G.useState(i&&i[l]),E=_v(),S=G.useRef(),[T,C]=G.useState(!1),[I,N]=G.useState(null);return G.useEffect(()=>{if(!i||!E)return;let P=!1;P||N(null);let H=r==="audio"?"hasAudio":"hasVideo",x=i.uid,B=async($,le)=>{if($[l]&&c.remoteUsers.some(({uid:re})=>$.uid===re))try{P||C(!0),await c.unsubscribe($,le)}catch(re){P||N(new eo("IAgoraRTCClient.unsubscribe",re)),console.error(re)}P||(m(void 0),C(!1))},X=async($,le)=>{try{!$[l]&&c.remoteUsers.some(({uid:re})=>$.uid===re)&&(P||C(!0),await c.subscribe($,le)),P||m($[l])}catch(re){P||N(new eo("IAgoraRTCClient.subscribe",re)),console.error(re)}P||C(!1)},Z=S.current||=EV();return!i[l]&&i[H]?Z.run(()=>X(i,r)):m(i[l]),zg([()=>{P=!0,Z.dispose()},xa(c,"user-published",($,le)=>{$.uid===x&&le===r&&Z.run(()=>X($,r))}),xa(c,"user-unpublished",($,le)=>{$.uid===x&&le===r&&Z.run(()=>B($,r))})])},[E,c,i,r,l]),{track:h,isLoading:T,error:I}}function gne(i){let r=hl(i),[a,c]=G.useState(r?r.remoteUsers:[]);return G.useEffect(()=>{if(r){let l=()=>c(r.remoteUsers.slice());return zg([xa(r,"user-joined",l),xa(r,"user-left",l),xa(r,"user-published",l),xa(r,"user-unpublished",l)])}},[r]),a}var aUe=Gg(Hg());function _ne(i=!0,r,a){let[c,l]=G.useState(null),[h,m]=G.useState(!1),[E,S]=G.useState(null),T=wf();return Kg(async()=>{if(T.current||(m(!1),S(null)),i&&!c){try{T.current||m(!0);let C=await aUe.default.createScreenVideoTrack(r,a);T.current||l(C)}catch(C){console.error(C),T.current||S(new eo("IAgoraRTC.createScreenVideoTrack",C))}T.current||m(!1)}},[i]),{screenTrack:c,isLoading:h,error:E}}function oUe(){let i=new Map,r=1500;return{onMount:a=>{let c=i.get(a);c&&(c(),i.delete(a))},onUnmount:a=>{let c=i.get(a);c&&c(),i.set(a,tN(()=>{a.isPlaying&&a.stop(),i.delete(a)},r))},dispose:()=>{for(let[a,c]of i)a.isPlaying&&a.stop(),c&&c();i.clear()}}}var SV=G.createContext(void 0);function cUe({children:i}){let[r]=G.useState(oUe);return G.useEffect(()=>r.dispose,[r]),D.jsx(SV.Provider,{value:r,children:i})}function TV(i,r,a,c){let l=G.useContext(SV);G.useEffect(()=>{if(i)return c&&r?i.play(c,a||void 0):i.stop(),l?(l.onMount(i),()=>l.onUnmount(i)):()=>{i.isPlaying&&i.stop()}},[i,c,r,l,a])}function wV(i,r){let a=G.useContext(SV);nN(()=>{if(i)return r?i.play():i.stop(),a?(a.onMount(i),()=>a.onUnmount(i)):()=>{i.isPlaying&&i.stop()}},[i,r,a])}function Ene({track:i,play:r=!1,volume:a,disabled:c,muted:l,children:h}){let m=une(i);return wV(m,r),G.useEffect(()=>{m&&a!=null&&m.setVolume(a)},[m,a]),G.useEffect(()=>{m&&c!=null&&m.setEnabled(!c).catch(console.warn)},[c,m]),G.useEffect(()=>{m&&l!=null&&m.setMuted(l).catch(console.warn)},[l,m]),h?D.jsx(D.Fragment,{children:h}):null}var yne={position:"relative",width:"100%",height:"100%",overflow:"hidden",background:"#000"},vne={width:"100%",height:"100%"},CV={position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden",zIndex:2},rN=(i,r)=>G.useMemo(()=>({...i,...r}),[i,r]);function Sne({track:i,play:r,disabled:a,muted:c,style:l,videoPlayerConfig:h,...m}){let E=rN(vne,l),[S,T]=G.useState(null),C=une(i);return TV(C,r,h,S),G.useEffect(()=>{C&&a!=null&&C.setEnabled(!a).catch(console.warn)},[a,C]),G.useEffect(()=>{C&&c!=null&&C.setMuted(c).catch(console.warn)},[c,C]),D.jsx("div",{...m,ref:T,style:E})}var lUe={width:"100%",height:"100%",background:"#1a1e21 center/cover no-repeat",filter:"blur(16px) brightness(0.4)"},uUe={position:"absolute",top:"50%",left:"50%",maxWidth:"50%",maxHeight:"50%",aspectRatio:"1",transform:"translate(-50%, -50%)",borderRadius:"50%",overflow:"hidden",objectFit:"cover"};function Tne({cover:i}){return D.jsx("div",{style:CV,children:typeof i=="string"?D.jsxs(D.Fragment,{children:[D.jsx("div",{style:{...lUe,backgroundImage:`url(${i})`}}),D.jsx("img",{src:i,style:uUe})]}):i()})}function mO({micOn:i,cameraOn:r,audioTrack:a,videoTrack:c,playAudio:l,playVideo:h,volume:m,cover:E,children:S,style:T,...C}){let I=rN(yne,T);return h=h??!!r,l=l??!!i,D.jsxs("div",{...C,style:I,children:[D.jsx(Sne,{disabled:!r,play:h,track:c}),D.jsx(Ene,{disabled:!i,play:l,track:a,volume:m}),E&&!r&&D.jsx(Tne,{cover:E}),D.jsx("div",{style:CV,children:S})]})}function wne({track:i,play:r=!1,playbackDeviceId:a,volume:c,children:l}){return wV(i,r),G.useEffect(()=>{i&&a!=null&&i.setPlaybackDevice(a).catch(console.warn)},[i,a]),G.useEffect(()=>{i&&c!=null&&i.setVolume(c)},[i,c]),l?D.jsx(D.Fragment,{children:l}):null}function Cne({track:i,play:r,style:a,videoPlayerConfig:c,...l}){let h=rN(vne,a),[m,E]=G.useState(null);return TV(i,r,c,m),D.jsx("div",{...l,ref:E,style:h})}function Rne({user:i,playVideo:r,playAudio:a,playbackDeviceId:c,volume:l,cover:h,style:m,children:E,videoPlayerConfig:S,...T}){let C=rN(yne,m),{track:I}=c2(i,"video"),{track:N}=c2(i,"audio");return r=r??i?.hasVideo,a=a??i?.hasAudio,D.jsxs("div",{...T,style:C,children:[D.jsx(Cne,{play:r,track:I,videoPlayerConfig:S}),D.jsx(wne,{play:a,playbackDeviceId:c,track:N,volume:l}),h&&!r&&D.jsx(Tne,{cover:h}),D.jsx("div",{style:CV,children:E})]})}var dUe=Gg(Hg()),hUe=class{appType=1001;constructor(){dUe.default.setAppType(this.appType)}};new hUe;var pUe="2.5.1";F2e(lne,Gg(Hg()));var bne=j2e.default;const fUe="35f1e777bff540a9ad19c9b6fa3c2bc2",mUe=()=>{const[i,r]=G.useState("lobby"),[a,c]=G.useState(""),[l,h]=G.useState(!0),[m,E]=G.useState(!0),S=hl(bne.createClient({codec:"vp8",mode:"rtc"})),T=Ef();return G.useEffect(()=>{const I=new URLSearchParams(T.search).get("channel");I&&(c(I),r("prejoin"))},[T]),D.jsxs(hne,{client:S,children:[i==="lobby"&&D.jsx(gUe,{onJoin:C=>{c(C),r("prejoin")}}),i==="prejoin"&&D.jsx(_Ue,{roomCode:a,micOn:l,setMicOn:h,cameraOn:m,setCameraOn:E,onJoinNow:()=>r("meeting"),onBack:()=>r("lobby")}),i==="meeting"&&D.jsx(EUe,{roomCode:a,initialMic:l,initialCam:m,onLeave:()=>{r("lobby"),c("")}})]})},gUe=({onJoin:i})=>{const[r,a]=G.useState(""),[c,l]=G.useState(!1),[h,m]=G.useState(""),[E,S]=G.useState(""),[T,C]=G.useState([]);G.useEffect(()=>{const N=localStorage.getItem("custom-study-rooms");C(N?JSON.parse(N):[])},[]);const I=()=>{if(!h.trim())return;const N={id:crypto.randomUUID(),name:h,topic:E,participants:1},P=[N,...T];C(P),localStorage.setItem("custom-study-rooms",JSON.stringify(P)),l(!1),i(N.name)};return D.jsxs(Sc,{children:[D.jsx(hu,{icon:vO,title:"Study Rooms",subtitle:"Join live study sessions or create your own",gradient:"linear-gradient(135deg, hsl(330 80% 55% / 0.3), hsl(330 80% 55% / 0.1))"}),D.jsxs("div",{className:"max-w-6xl mx-auto mt-8 px-4",children:[D.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end md:items-center gap-4 mb-8",children:[D.jsxs("div",{children:[D.jsx("h2",{className:"text-2xl font-bold font-display",children:"Live Rooms"}),D.jsx("p",{className:"text-muted-foreground",children:"Happening now across campus"})]}),D.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[D.jsx("div",{className:"relative flex-1 md:w-64",children:D.jsx("input",{placeholder:"Enter room code...",className:"w-full h-10 px-3 rounded-lg bg-muted text-sm border border-transparent focus:border-primary outline-none",value:r,onChange:N=>a(N.target.value)})}),D.jsx(nr,{disabled:!r,onClick:()=>i(r),variant:"secondary",children:"Join"}),D.jsxs(nr,{onClick:()=>l(!0),className:"gap-2 bg-primary text-white",children:[D.jsx(PA,{className:"w-4 h-4"})," Create Room"]})]})]}),D.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[T.map(N=>D.jsxs("div",{className:"glass p-5 rounded-2xl border border-white/5 hover:border-primary/30 transition-all group relative overflow-hidden",children:[D.jsxs("div",{className:"absolute top-3 right-3 flex items-center gap-1.5 px-2 py-1 rounded-full bg-red-500/10 text-red-400 text-xs font-medium border border-red-500/20",children:[D.jsxs("span",{className:"relative flex h-2 w-2",children:[D.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),D.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-red-500"})]}),D.jsx("span",{children:"LIVE"})]}),D.jsxs("div",{className:"mb-4",children:[D.jsx("span",{className:"text-xs font-semibold tracking-wider text-muted-foreground uppercase",children:N.topic}),D.jsx("h3",{className:"text-xl font-bold mt-1 group-hover:text-primary transition-colors",children:N.name})]}),D.jsxs("div",{className:"flex items-center justify-between mt-6",children:[D.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[D.jsx(kw,{className:"w-4 h-4"}),D.jsxs("span",{children:[N.participants," studying"]})]}),D.jsx(nr,{size:"sm",onClick:()=>i(N.name),children:"Join Room"})]})]},N.id)),T.length===0&&D.jsxs("div",{className:"col-span-full py-12 text-center border-2 border-dashed border-border rounded-xl",children:[D.jsx("div",{className:"w-16 h-16 bg-muted/50 rounded-full flex items-center justify-center mx-auto mb-4",children:D.jsx(PA,{className:"w-8 h-8 text-muted-foreground"})}),D.jsx("h3",{className:"text-lg font-medium",children:"No live rooms right now"}),D.jsx("p",{className:"text-muted-foreground mb-4",children:"Be the first to start a study session!"}),D.jsx(nr,{onClick:()=>l(!0),variant:"outline",children:"Create a Room"})]})]}),c&&D.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:D.jsxs("div",{className:"bg-card w-full max-w-md p-6 rounded-2xl border border-white/10 shadow-2xl animate-in zoom-in-95 duration-200",children:[D.jsx("h3",{className:"text-xl font-bold mb-4",children:"Create New Room"}),D.jsxs("div",{className:"space-y-4",children:[D.jsxs("div",{className:"space-y-2",children:[D.jsx("label",{className:"text-sm font-medium",children:"Room Name"}),D.jsx("input",{autoFocus:!0,className:"w-full p-3 rounded-lg bg-muted border border-transparent focus:border-primary outline-none",placeholder:"e.g. Exam Prep Group",value:h,onChange:N=>m(N.target.value)})]}),D.jsxs("div",{className:"space-y-2",children:[D.jsx("label",{className:"text-sm font-medium",children:"Subject / Topic"}),D.jsx("input",{className:"w-full p-3 rounded-lg bg-muted border border-transparent focus:border-primary outline-none",placeholder:"e.g. Data Structures",value:E,onChange:N=>S(N.target.value)}),D.jsx("div",{className:"flex flex-wrap gap-2 pt-2",children:["Data Structures","VLSI Design","Thermodynamics","Machine Learning","Control Systems"].map(N=>D.jsx("button",{onClick:()=>{S(N),h||m(`${N} Study Group`)},className:"text-xs px-2 py-1 rounded-md bg-primary/10 text-primary hover:bg-primary/20 transition-colors",children:N},N))})]}),D.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[D.jsx(nr,{variant:"ghost",onClick:()=>l(!1),children:"Cancel"}),D.jsx(nr,{onClick:I,disabled:!h.trim()||!E.trim(),children:"Create & Join"})]})]})]})})]})]})},_Ue=i=>{const{localMicrophoneTrack:r}=yV(i.micOn),{localCameraTrack:a}=vV(i.cameraOn);return D.jsx("div",{className:"min-h-screen bg-[#202124] text-white flex flex-col items-center justify-center p-4",children:D.jsxs("div",{className:"w-full max-w-4xl flex flex-col md:flex-row gap-12 items-center",children:[D.jsx("div",{className:"flex-1 w-full max-w-xl",children:D.jsxs("div",{className:"relative aspect-video bg-[#3c4043] rounded-2xl overflow-hidden shadow-2xl border border-white/10 group",children:[D.jsx(mO,{audioTrack:r,cameraOn:i.cameraOn,micOn:i.micOn,videoTrack:a,cover:"https://www.agora.io/en/wp-content/uploads/2022/10/3d-spatial-audio-icon.svg",children:D.jsxs("div",{className:"absolute top-4 right-4 bg-black/50 px-3 py-1 rounded-full text-xs font-medium flex items-center gap-2",children:[D.jsx(oX,{className:"w-3 h-3 text-green-400"}),"Ready to join"]})}),D.jsxs("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 flex items-center gap-4 z-20",children:[D.jsx("button",{onClick:()=>i.setMicOn(!i.micOn),className:`p-4 rounded-full transition-all ${i.micOn?"bg-[#3c4043] hover:bg-[#4b4f52]/80 border border-white/10":"bg-red-600 hover:bg-red-700 shadow-lg"}`,children:i.micOn?D.jsx(pX,{className:"w-5 h-5"}):D.jsx(hX,{className:"w-5 h-5"})}),D.jsx("button",{onClick:()=>i.setCameraOn(!i.cameraOn),className:`p-4 rounded-full transition-all ${i.cameraOn?"bg-[#3c4043] hover:bg-[#4b4f52]/80 border border-white/10":"bg-red-600 hover:bg-red-700 shadow-lg"}`,children:i.cameraOn?D.jsx(PA,{className:"w-5 h-5"}):D.jsx(EX,{className:"w-5 h-5"})})]})]})}),D.jsxs("div",{className:"flex-1 space-y-6 text-center md:text-left",children:[D.jsx("h2",{className:"text-3xl font-display font-medium",children:"Ready to join?"}),D.jsxs("p",{className:"text-gray-400",children:["You are about to join room: ",D.jsx("span",{className:"text-white font-mono bg-white/10 px-2 py-1 rounded select-all",children:i.roomCode})]}),D.jsxs("div",{className:"flex flex-col gap-3 max-w-xs mx-auto md:mx-0",children:[D.jsx(nr,{size:"lg",className:"rounded-full bg-blue-600 hover:bg-blue-700 h-12 text-base font-medium shadow-blue-500/20 shadow-lg",onClick:i.onJoinNow,children:"Join Now"}),D.jsx(nr,{variant:"ghost",className:"rounded-full text-gray-400 hover:text-white hover:bg-white/10",onClick:i.onBack,children:"Back to Home"})]})]})]})})},EUe=i=>{const[r,a]=G.useState(i.initialMic),[c,l]=G.useState(i.initialCam),[h,m]=G.useState(!1),{toast:E}=d2(),[S,T]=G.useState(null),[C]=G.useState(()=>Math.floor(Math.random()*1e6)),{isConnected:I}=fne({appid:fUe,channel:i.roomCode,token:null,uid:C},!0),{localMicrophoneTrack:N}=yV(r),{localCameraTrack:P}=vV(c),{screenTrack:H}=_ne(h,{},"disable");G.useEffect(()=>{h&&H&&H.on("track-ended",()=>{m(!1)})},[h,H]);const x=[N,h?H:P].filter(Boolean);mne(x);const B=gne();return D.jsxs("div",{className:"h-screen w-full bg-[#202124] text-white flex flex-col overflow-hidden fixed top-0 left-0 z-50",children:[D.jsxs("div",{className:"h-16 flex items-center justify-between px-6 bg-black/40 backdrop-blur-md z-10 absolute top-0 w-full",children:[D.jsxs("div",{className:"flex items-center gap-3",children:[D.jsxs("span",{className:"text-lg font-medium tracking-wide font-mono",children:[i.roomCode.substring(0,8),"..."]}),I?D.jsxs("div",{className:"px-2 py-0.5 bg-green-500/20 text-green-400 text-xs rounded-md font-mono border border-green-500/20 flex items-center gap-1",children:[D.jsxs("span",{className:"relative flex h-2 w-2",children:[D.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),D.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-green-500"})]}),"LIVE"]}):D.jsxs("div",{className:"px-2 py-0.5 bg-yellow-500/20 text-yellow-400 text-xs rounded-md font-mono border border-yellow-500/20 flex items-center gap-1",children:[D.jsx(Oy,{className:"w-3 h-3 animate-spin"}),"CONNECTING"]})]}),D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx(kw,{className:"w-4 h-4 text-gray-400"}),D.jsx("span",{className:"text-sm text-gray-300",children:B.length+1})]})]}),D.jsxs("div",{className:"flex-1 p-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 overflow-y-auto bg-[#202124] pt-20 pb-24",children:[!h&&D.jsx("div",{className:"relative bg-[#3c4043] rounded-xl overflow-hidden border-2 border-blue-500/0 aspect-video group shadow-lg",children:D.jsx(mO,{audioTrack:N,cameraOn:c,micOn:r,videoTrack:P,cover:"https://www.agora.io/en/wp-content/uploads/2022/10/3d-spatial-audio-icon.svg",children:D.jsx("div",{className:"absolute bottom-3 left-3 bg-black/50 px-2 py-1 rounded text-sm font-medium z-10",children:"You"})})}),h&&H&&D.jsx("div",{className:"relative bg-[#3c4043] rounded-xl overflow-hidden border-2 border-blue-500 aspect-video group shadow-lg col-span-2 row-span-2",children:D.jsx(mO,{audioTrack:N,cameraOn:!1,micOn:r,videoTrack:H,cover:"https://www.agora.io/en/wp-content/uploads/2022/10/3d-spatial-audio-icon.svg",children:D.jsxs("div",{className:"absolute bottom-3 left-3 bg-blue-600 px-2 py-1 rounded text-sm font-medium z-10 flex items-center gap-2",children:[D.jsx(lK,{className:"w-3 h-3"})," You are presenting"]})})}),B.map(X=>D.jsx("div",{className:`relative bg-[#3c4043] rounded-xl overflow-hidden aspect-video shadow-lg ${X.hasVideo?"":"flex items-center justify-center"}`,children:D.jsx(Rne,{cover:"https://www.agora.io/en/wp-content/uploads/2022/10/3d-spatial-audio-icon.svg",user:X,children:D.jsxs("div",{className:"absolute bottom-3 left-3 bg-black/50 px-2 py-1 rounded text-sm font-medium z-10",children:["Student ",X.uid]})})},X.uid)),B.length===0&&I&&D.jsx("div",{className:"col-span-1 md:col-span-2 lg:col-span-3 flex items-center justify-center p-8 text-center text-gray-500 h-64 border-2 border-dashed border-gray-700 rounded-xl",children:D.jsxs("div",{className:"max-w-sm",children:[D.jsx(Oy,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-blue-400"}),D.jsx("p",{className:"text-lg font-medium text-gray-300",children:"Waiting for friends..."}),D.jsx("p",{className:"text-sm mt-2",children:"Share the link to invite them to this room."}),D.jsx("p",{className:"font-mono text-xs mt-4 bg-black/20 p-2 rounded select-all",children:i.roomCode})]})}),B.length===0&&!I&&D.jsx("div",{className:"col-span-1 md:col-span-2 lg:col-span-3 flex items-center justify-center p-8 text-center text-gray-500 h-64",children:D.jsx("p",{children:"Connecting to server..."})})]}),D.jsxs("div",{className:"h-20 bg-[#202124] flex items-center justify-center gap-4 px-4 z-20 absolute bottom-0 w-full shadow-2xl border-t border-white/5",children:[D.jsx("button",{onClick:()=>a(!r),className:`h-12 w-12 rounded-full flex items-center justify-center transition-all ${r?"bg-[#3c4043] hover:bg-[#4b4f52]":"bg-red-600 hover:bg-red-700"}`,title:"Toggle Microphone",children:r?D.jsx(pX,{className:"w-5 h-5"}):D.jsx(hX,{className:"w-5 h-5"})}),D.jsx("button",{onClick:()=>l(!c),className:`h-12 w-12 rounded-full flex items-center justify-center transition-all ${c?"bg-[#3c4043] hover:bg-[#4b4f52]":"bg-red-600 hover:bg-red-700"}`,title:"Toggle Camera",children:c?D.jsx(PA,{className:"w-5 h-5"}):D.jsx(EX,{className:"w-5 h-5"})}),D.jsx("button",{onClick:()=>m(!h),className:`h-12 w-12 rounded-full flex items-center justify-center transition-all ${h?"bg-blue-600 hover:bg-blue-700 text-white":"bg-[#3c4043] hover:bg-[#4b4f52] text-gray-200"}`,title:"Share Screen",children:D.jsx(lK,{className:"w-5 h-5"})}),D.jsx("div",{className:"w-px h-8 bg-gray-600 mx-2"}),D.jsx("button",{onClick:()=>{const X=`${window.location.origin}${window.location.pathname}#/study-rooms?channel=${i.roomCode}`;navigator.clipboard.writeText(X),E({title:"Copied joining info",description:"Meeting link copied to clipboard"})},className:"h-12 w-12 rounded-full bg-[#3c4043] hover:bg-[#4b4f52] flex items-center justify-center text-blue-400 transition-colors",title:"Copy Link",children:D.jsx(mge,{className:"w-5 h-5"})}),D.jsxs("button",{onClick:i.onLeave,className:"h-12 px-8 rounded-full bg-red-600 hover:bg-red-700 flex items-center font-medium gap-2 transition-colors ml-4",children:[D.jsx(Oge,{className:"w-5 h-5"}),D.jsx("span",{className:"hidden sm:inline",children:"Leave call"})]})]})]})},yUe=()=>{const[i,r]=G.useState("map"),a=[{name:"Main Library",type:"Library",floor:"Ground Floor",color:"hsl(199 89% 48%)"},{name:"Computer Lab A",type:"Lab",floor:"Main Block",color:"hsl(142 76% 36%)"},{name:"Auditorium",type:"Venue",floor:"Mechanical Block",color:"hsl(263 70% 58%)"},{name:"Cafeteria",type:"Food",floor:"Near Garden",color:"hsl(45 93% 47%)"},{name:"Sports Complex",type:"Sports",floor:"Outdoor",color:"hsl(330 80% 55%)"},{name:"Admin Block",type:"Office",floor:"Main Entrance",color:"hsl(15 90% 55%)"}];return D.jsxs(Sc,{children:[D.jsx(hu,{icon:WL,title:"Campus Map",subtitle:"Locate your way around KLE Tech, Belagavi",gradient:"linear-gradient(135deg, hsl(15 90% 55% / 0.3), hsl(15 90% 55% / 0.1))"}),D.jsxs(Xn.div,{layout:!0,className:"glass rounded-2xl p-2 mb-6 relative overflow-hidden h-[500px] flex items-center justify-center border border-white/10 shadow-2xl group",children:[D.jsx(UQ,{mode:"wait",children:i==="map"?D.jsx(Xn.iframe,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},src:"https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3838.328374828131!2d74.48425267592984!3d15.83935278480749!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3bbf668f6eb689e1%3A0xe74e7604a56c459e!2sKLE%20Dr.%20M.%20S.%20Sheshgiri%20College%20of%20Engineering%20and%20Technology!5e0!3m2!1sen!2sin!4v1703672000000!5m2!1sen!2sin",width:"100%",height:"100%",style:{border:0,borderRadius:"12px"},allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",className:"w-full h-full grayscale-[0.3] hover:grayscale-0 transition-all duration-500"},"map"):D.jsx(Xn.iframe,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},src:"https://www.google.com/maps/embed?pb=!4v1766862401947!6m8!1m7!1sCAoSFkNJSE0wb2dLRUlDQWdJRDRpLXktWEE.!2m2!1d15.82035380132274!2d74.4985191981654!3f40!4f0!5f0.7820865974627469",width:"100%",height:"100%",style:{border:0,borderRadius:"12px"},allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",className:"w-full h-full"},"street")}),D.jsx("div",{className:"absolute bottom-4 right-4 z-10",children:D.jsx(Xn.button,{onClick:()=>r(c=>c==="map"?"street":"map"),whileHover:{scale:1.05},whileTap:{scale:.95},className:`flex items-center gap-3 px-5 py-3 rounded-xl font-bold shadow-xl transition-all border ${i==="map"?"bg-yellow-400 text-black border-yellow-500 hover:bg-yellow-300":"bg-white text-black border-white hover:bg-gray-100"}`,children:i==="map"?D.jsxs(D.Fragment,{children:[D.jsx("div",{className:"bg-black/10 p-1.5 rounded-full",children:D.jsx(Ige,{className:"w-5 h-5 fill-current"})}),D.jsx("span",{className:"font-display text-sm tracking-wide",children:"Enter Street View"})]}):D.jsxs(D.Fragment,{children:[D.jsx("div",{className:"bg-black/10 p-1.5 rounded-full",children:D.jsx(WL,{className:"w-5 h-5"})}),D.jsx("span",{className:"font-display text-sm tracking-wide",children:"Return to Map"})]})})})]}),D.jsx("h2",{className:"text-xl font-semibold text-foreground mb-4 font-display",children:"Quick Locations"}),D.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:a.map((c,l)=>D.jsxs(Xn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:l*.05},className:"glass rounded-xl p-4 cursor-pointer hover:scale-105 transition-transform",children:[D.jsx("div",{className:"w-10 h-10 rounded-lg mb-3 flex items-center justify-center",style:{background:`${c.color}33`},children:D.jsx(hge,{className:"w-5 h-5",style:{color:c.color}})}),D.jsx("h3",{className:"text-sm font-medium text-foreground mb-1",children:c.name}),D.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[D.jsx(BL,{className:"w-3 h-3"}),D.jsx("span",{children:c.floor})]})]},c.name))})]})},vUe=()=>{const i=[{title:"Tech Fest 2024",date:"Dec 28, 2024",time:"9:00 AM",venue:"Main Auditorium",attendees:350,type:"Technical",color:"hsl(199 89% 48%)"},{title:"Hackathon: Code Sprint",date:"Jan 5, 2025",time:"10:00 AM",venue:"Computer Lab A",attendees:120,type:"Competition",color:"hsl(263 70% 58%)"},{title:"Industry Expert Talk",date:"Jan 10, 2025",time:"2:00 PM",venue:"Seminar Hall",attendees:80,type:"Seminar",color:"hsl(142 76% 36%)"}];return D.jsxs(Sc,{children:[D.jsx(hu,{icon:uA,title:"Events",subtitle:"Stay updated with campus happenings",gradient:"linear-gradient(135deg, hsl(280 70% 50% / 0.3), hsl(280 70% 50% / 0.1))"}),D.jsxs(Xn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"glass rounded-2xl p-6 mb-6 relative overflow-hidden",children:[D.jsx("div",{className:"absolute inset-0 opacity-20",style:{background:"linear-gradient(135deg, hsl(199 89% 48%), hsl(263 70% 58%))"}}),D.jsxs("div",{className:"relative z-10",children:[D.jsx("span",{className:"inline-block px-3 py-1 text-xs font-medium bg-primary/20 text-primary rounded-full mb-4",children:"Featured Event"}),D.jsx("h2",{className:"text-2xl font-bold text-foreground mb-2 font-display",children:"Tech Fest 2024"}),D.jsx("p",{className:"text-muted-foreground mb-4 max-w-xl",children:"The biggest technical festival of KLE featuring workshops, competitions, and networking opportunities."}),D.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[D.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[D.jsx(uA,{className:"w-4 h-4"}),D.jsx("span",{children:"Dec 28, 2024"})]}),D.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[D.jsx(rw,{className:"w-4 h-4"}),D.jsx("span",{children:"9:00 AM - 6:00 PM"})]}),D.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[D.jsx(BL,{className:"w-4 h-4"}),D.jsx("span",{children:"Main Auditorium"})]})]}),D.jsx(nr,{className:"bg-primary hover:bg-primary/90",children:"Register Now"})]})]}),D.jsx("h2",{className:"text-xl font-semibold text-foreground mb-4 font-display",children:"Upcoming Events"}),D.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:i.map((r,a)=>D.jsxs(Xn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.2+a*.1},className:"glass rounded-2xl p-5",children:[D.jsx("span",{className:"inline-block px-2 py-1 text-xs font-medium rounded-full mb-3",style:{background:`${r.color}33`,color:r.color},children:r.type}),D.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:r.title}),D.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground mb-4",children:[D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx(uA,{className:"w-4 h-4"}),D.jsx("span",{children:r.date})]}),D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx(rw,{className:"w-4 h-4"}),D.jsx("span",{children:r.time})]}),D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx(BL,{className:"w-4 h-4"}),D.jsx("span",{children:r.venue})]}),D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx(kw,{className:"w-4 h-4"}),D.jsxs("span",{children:[r.attendees," attending"]})]})]}),D.jsx(nr,{variant:"outline",size:"sm",className:"w-full",children:"Interested"})]},r.title))})]})},SUe=()=>{const[i,r]=G.useState(""),a=[{id:1,question:"How do I implement a min-heap from scratch in Python?",author:"Rahul M.",subject:"Data Structures",answers:5,votes:12,time:"2 hours ago"},{id:2,question:"Can someone explain the difference between mutex and semaphore?",author:"Priya S.",subject:"Operating Systems",answers:8,votes:24,time:"5 hours ago"},{id:3,question:"Best approach for normalizing a database with complex relationships?",author:"Arun K.",subject:"Database Systems",answers:3,votes:8,time:"Yesterday"}],c=["Data Structures","Algorithms","OS","DBMS","Networks","ML"];return D.jsxs(Sc,{children:[D.jsx(hu,{icon:uX,title:"Doubts",subtitle:"Ask questions and help your peers",gradient:"linear-gradient(135deg, hsl(180 70% 45% / 0.3), hsl(180 70% 45% / 0.1))"}),D.jsxs(Xn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"glass rounded-2xl p-6 mb-6",children:[D.jsx("h3",{className:"text-lg font-semibold text-foreground mb-3",children:"Ask a Question"}),D.jsx(ZU,{value:i,onChange:l=>r(l.target.value),placeholder:"What's your doubt? Be specific for better answers...",className:"bg-muted border-border mb-3",rows:3}),D.jsxs("div",{className:"flex items-center justify-between",children:[D.jsx("div",{className:"flex flex-wrap gap-2",children:c.slice(0,4).map(l=>D.jsx("button",{className:"px-3 py-1 text-xs rounded-full bg-muted text-muted-foreground hover:bg-primary/20 hover:text-primary transition-colors",children:l},l))}),D.jsxs(nr,{className:"gap-2 bg-primary hover:bg-primary/90",children:[D.jsx(mX,{className:"w-4 h-4"}),"Post Question"]})]})]}),D.jsx("h2",{className:"text-xl font-semibold text-foreground mb-4 font-display",children:"Recent Questions"}),D.jsx("div",{className:"space-y-4",children:a.map((l,h)=>D.jsx(Xn.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.2+h*.1},className:"glass rounded-xl p-5 cursor-pointer hover:scale-[1.01] transition-transform",children:D.jsxs("div",{className:"flex gap-4",children:[D.jsxs("div",{className:"flex flex-col items-center gap-1",children:[D.jsx("button",{className:"p-2 rounded-lg hover:bg-primary/10 transition-colors",children:D.jsx(xge,{className:"w-5 h-5 text-muted-foreground hover:text-primary"})}),D.jsx("span",{className:"text-sm font-medium text-foreground",children:l.votes})]}),D.jsxs("div",{className:"flex-1",children:[D.jsx("h3",{className:"text-foreground font-medium mb-2 hover:text-primary transition-colors",children:l.question}),D.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[D.jsxs("span",{className:"flex items-center gap-1",children:[D.jsx(Dge,{className:"w-3 h-3"}),l.subject]}),D.jsx("span",{children:""}),D.jsxs("span",{children:[l.answers," answers"]}),D.jsx("span",{children:""}),D.jsx("span",{children:l.time})]}),D.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Asked by ",l.author]})]})]})},l.id))})]})},TUe=()=>{const i=[{name:"Aditya Sharma",year:"4th Year",branch:"Computer Science",company:"Google",skills:["DSA","System Design","CP"],rating:4.9,sessions:45},{name:"Neha Patel",year:"4th Year",branch:"Information Science",company:"Microsoft",skills:["ML","Python","Research"],rating:4.8,sessions:32},{name:"Rohan Kumar",year:"Alumni",branch:"Computer Science",company:"Amazon",skills:["Backend","AWS","Interviews"],rating:5,sessions:78}];return D.jsxs(Sc,{children:[D.jsx(hu,{icon:kw,title:"Senior Connect",subtitle:"Get guidance from experienced seniors and alumni",gradient:"linear-gradient(135deg, hsl(220 70% 55% / 0.3), hsl(220 70% 55% / 0.1))"}),D.jsx(Xn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"grid grid-cols-3 gap-4 mb-8",children:[{label:"Active Mentors",value:"50+"},{label:"Sessions Completed",value:"500+"},{label:"Students Helped",value:"1000+"}].map((r,a)=>D.jsxs("div",{className:"glass rounded-xl p-4 text-center",children:[D.jsx("p",{className:"text-2xl font-bold text-primary font-display",children:r.value}),D.jsx("p",{className:"text-sm text-muted-foreground",children:r.label})]},r.label))}),D.jsx("h2",{className:"text-xl font-semibold text-foreground mb-4 font-display",children:"Top Mentors"}),D.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:i.map((r,a)=>D.jsxs(Xn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.2+a*.1},className:"glass rounded-2xl p-5",children:[D.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[D.jsx("div",{className:"w-14 h-14 rounded-full bg-gradient-to-br from-primary to-accent flex items-center justify-center text-xl font-bold text-foreground",children:r.name.charAt(0)}),D.jsxs("div",{children:[D.jsx("h3",{className:"font-semibold text-foreground",children:r.name}),D.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.year,"  ",r.branch]})]})]}),D.jsxs("div",{className:"flex items-center gap-2 mb-3 text-sm",children:[D.jsx(dge,{className:"w-4 h-4 text-muted-foreground"}),D.jsx("span",{className:"text-foreground",children:r.company})]}),D.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:r.skills.map(c=>D.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-muted text-muted-foreground",children:c},c))}),D.jsxs("div",{className:"flex items-center justify-between mb-4 text-sm",children:[D.jsxs("div",{className:"flex items-center gap-1",children:[D.jsx(_X,{className:"w-4 h-4 text-yellow-500 fill-yellow-500"}),D.jsx("span",{className:"text-foreground",children:r.rating})]}),D.jsxs("span",{className:"text-muted-foreground",children:[r.sessions," sessions"]})]}),D.jsxs(nr,{variant:"outline",className:"w-full gap-2",children:[D.jsx(dX,{className:"w-4 h-4"}),"Connect"]})]},r.name))})]})},wUe=()=>{const i=[{icon:uge,title:"Book Exchange",description:"Donate or borrow textbooks and study materials",items:45,color:"hsl(199 89% 48%)"},{icon:oK,title:"Essentials Drive",description:"Access stationary, clothing, and daily essentials",items:120,color:"hsl(142 76% 36%)"},{icon:yge,title:"Financial Aid",description:"Scholarships and emergency fund information",items:15,color:"hsl(263 70% 58%)"}],r=[{item:"Engineering Mathematics Textbook",donor:"Anonymous",time:"2 hours ago"},{item:"Scientific Calculator",donor:"Priya S.",time:"5 hours ago"},{item:"Laptop Bag",donor:"Alumni Association",time:"Yesterday"}];return D.jsxs(Sc,{children:[D.jsx(hu,{icon:jL,title:"Student Help",subtitle:"Supporting each other through college life",gradient:"linear-gradient(135deg, hsl(350 80% 50% / 0.3), hsl(350 80% 50% / 0.1))"}),D.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:i.map((a,c)=>D.jsxs(Xn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:c*.1},className:"glass rounded-2xl p-6 hover:scale-[1.02] transition-transform cursor-pointer",children:[D.jsx("div",{className:"w-14 h-14 rounded-xl mb-4 flex items-center justify-center",style:{background:`${a.color}33`},children:D.jsx(a.icon,{className:"w-7 h-7",style:{color:a.color}})}),D.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:a.title}),D.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:a.description}),D.jsxs("p",{className:"text-sm text-primary font-medium",children:[a.items," items available"]})]},a.title))}),D.jsxs(Xn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},className:"glass rounded-2xl p-6 mb-6 text-center relative overflow-hidden",children:[D.jsx("div",{className:"absolute inset-0 opacity-10",style:{background:"linear-gradient(135deg, hsl(350 80% 50%), hsl(263 70% 58%))"}}),D.jsxs("div",{className:"relative z-10",children:[D.jsx(jL,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),D.jsx("h3",{className:"text-xl font-semibold text-foreground mb-2 font-display",children:"Make a Difference"}),D.jsx("p",{className:"text-muted-foreground mb-4 max-w-md mx-auto",children:"Your donation can help a fellow student succeed. Every contribution matters."}),D.jsx(nr,{className:"bg-destructive hover:bg-destructive/90 text-destructive-foreground",children:"Donate Now"})]})]}),D.jsx("h2",{className:"text-xl font-semibold text-foreground mb-4 font-display",children:"Recent Donations"}),D.jsx("div",{className:"space-y-3",children:r.map((a,c)=>D.jsxs(Xn.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.4+c*.1},className:"glass rounded-xl p-4 flex items-center justify-between",children:[D.jsxs("div",{className:"flex items-center gap-4",children:[D.jsx("div",{className:"w-10 h-10 rounded-lg bg-destructive/10 flex items-center justify-center",children:D.jsx(oK,{className:"w-5 h-5 text-destructive"})}),D.jsxs("div",{children:[D.jsx("h3",{className:"text-foreground font-medium",children:a.item}),D.jsxs("p",{className:"text-sm text-muted-foreground",children:["By ",a.donor]})]})]}),D.jsx("span",{className:"text-xs text-muted-foreground",children:a.time})]},a.item))})]})};function CUe(i){const r=G.useRef({value:i,previous:i});return G.useMemo(()=>(r.current.value!==i&&(r.current.previous=r.current.value,r.current.value=i),r.current.previous),[i])}var iN="Switch",[RUe]=mf(iN),[bUe,IUe]=RUe(iN),Ine=G.forwardRef((i,r)=>{const{__scopeSwitch:a,name:c,checked:l,defaultChecked:h,required:m,disabled:E,value:S="on",onCheckedChange:T,form:C,...I}=i,[N,P]=G.useState(null),H=Xs(r,$=>P($)),x=G.useRef(!1),B=N?C||!!N.closest("form"):!0,[X,Z]=Nw({prop:l,defaultProp:h??!1,onChange:T,caller:iN});return D.jsxs(bUe,{scope:a,checked:X,disabled:E,children:[D.jsx(ri.button,{type:"button",role:"switch","aria-checked":X,"aria-required":m,"data-state":Pne(X),"data-disabled":E?"":void 0,disabled:E,value:S,...I,ref:H,onClick:vr(i.onClick,$=>{Z(le=>!le),B&&(x.current=$.isPropagationStopped(),x.current||$.stopPropagation())})}),B&&D.jsx(Nne,{control:N,bubbles:!x.current,name:c,value:S,checked:X,required:m,disabled:E,form:C,style:{transform:"translateX(-100%)"}})]})});Ine.displayName=iN;var Ane="SwitchThumb",One=G.forwardRef((i,r)=>{const{__scopeSwitch:a,...c}=i,l=IUe(Ane,a);return D.jsx(ri.span,{"data-state":Pne(l.checked),"data-disabled":l.disabled?"":void 0,...c,ref:r})});One.displayName=Ane;var AUe="SwitchBubbleInput",Nne=G.forwardRef(({__scopeSwitch:i,control:r,checked:a,bubbles:c=!0,...l},h)=>{const m=G.useRef(null),E=Xs(m,h),S=CUe(a),T=BX(r);return G.useEffect(()=>{const C=m.current;if(!C)return;const I=window.HTMLInputElement.prototype,P=Object.getOwnPropertyDescriptor(I,"checked").set;if(S!==a&&P){const H=new Event("click",{bubbles:c});P.call(C,a),C.dispatchEvent(H)}},[S,a,c]),D.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:a,...l,tabIndex:-1,ref:E,style:{...l.style,...T,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Nne.displayName=AUe;function Pne(i){return i?"checked":"unchecked"}var kne=Ine,OUe=One;const Dne=G.forwardRef(({className:i,...r},a)=>D.jsx(kne,{className:Br("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",i),...r,ref:a,children:D.jsx(OUe,{className:Br("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Dne.displayName=kne.displayName;const NUe={pushNotifications:!0,emailNotifications:!1,studyReminders:!0,darkMode:!0,compactMode:!1},PUe=()=>{const{signOut:i}=UO(),[r,a]=G.useState(()=>{const E=localStorage.getItem("app-settings");return E?JSON.parse(E):NUe});G.useEffect(()=>{localStorage.setItem("app-settings",JSON.stringify(r)),r.darkMode?document.documentElement.classList.remove("light-mode"):document.documentElement.classList.add("light-mode"),r.compactMode?document.documentElement.classList.add("compact-mode"):document.documentElement.classList.remove("compact-mode")},[r]);const c=E=>{a(S=>({...S,[E]:!S[E]})),gK.success("Settings updated")},l=E=>{gK.info(`${E} coming soon!`,{description:"This feature is currently under development."})},h=[{title:"Account",icon:SO,settings:[{label:"Edit Profile",description:"Update your personal information",type:"link"},{label:"Change Password",description:"Update your account password",type:"link"}]},{title:"Notifications",icon:lge,settings:[{label:"Push Notifications",description:"Receive push notifications",type:"toggle",key:"pushNotifications"},{label:"Email Notifications",description:"Get updates via email",type:"toggle",key:"emailNotifications"},{label:"Study Reminders",description:"Daily study session reminders",type:"toggle",key:"studyReminders"}]},{title:"Privacy",icon:dK,settings:[{label:"Profile Visibility",description:"Control who can see your profile",type:"link"},{label:"Data & Privacy",description:"Manage your data preferences",type:"link"}]},{title:"Appearance",icon:Age,settings:[{label:"Dark Mode",description:"Enable dark theme",type:"toggle",key:"darkMode"},{label:"Compact Mode",description:"Reduce spacing and padding",type:"toggle",key:"compactMode"}]}],m=async()=>{await i(),window.location.href="/#/auth"};return D.jsxs(Sc,{children:[D.jsx(hu,{icon:gX,title:"Settings",subtitle:"Customize your KLE CONNECT experience",gradient:"linear-gradient(135deg, hsl(217 20% 50% / 0.3), hsl(217 20% 50% / 0.1))"}),D.jsxs("div",{className:"space-y-6",children:[D.jsxs(Xn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"glass rounded-2xl p-6 border border-primary/20 bg-primary/5 mb-6",children:[D.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[D.jsx(dK,{className:"w-5 h-5 text-primary"}),D.jsx("h2",{className:"text-lg font-semibold text-foreground font-display",children:"System Security"})]}),D.jsxs("div",{className:"space-y-2",children:[D.jsx("p",{className:"text-sm font-medium text-foreground",children:"AI Token Proxy Active"}),D.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"All AI requests are now securely proxied through a backend server. Your API keys are never exposed in the browser or via Git history."})]})]}),h.map((E,S)=>D.jsxs(Xn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:S*.1},className:"glass rounded-2xl p-6",children:[D.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[D.jsx(E.icon,{className:"w-5 h-5 text-primary"}),D.jsx("h2",{className:"text-lg font-semibold text-foreground font-display",children:E.title})]}),D.jsx("div",{className:"space-y-4",children:E.settings.map(T=>D.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-border last:border-0",children:[D.jsxs("div",{children:[D.jsx("p",{className:"text-foreground font-medium",children:T.label}),D.jsx("p",{className:"text-sm text-muted-foreground",children:T.description})]}),T.type==="toggle"&&T.key&&D.jsx(Dne,{checked:r[T.key],onCheckedChange:()=>c(T.key)}),T.type==="link"&&D.jsx("span",{className:"text-sm text-primary cursor-pointer hover:underline",onClick:()=>l(T.label),children:"Edit "})]},T.label))})]},E.title)),D.jsx(Xn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.4},className:"glass rounded-2xl p-6 hover:bg-red-500/10 transition-colors cursor-pointer group",onClick:m,children:D.jsxs("button",{className:"flex items-center gap-3 text-destructive group-hover:text-red-500 transition-colors w-full",children:[D.jsx(Cge,{className:"w-5 h-5"}),D.jsx("span",{className:"font-medium",children:"Log Out"})]})})]})]})},kUe=tne,DUe=nne,xne=G.forwardRef(({className:i,...r},a)=>D.jsx($O,{ref:a,className:Br("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",i),...r}));xne.displayName=$O.displayName;const Lne=G.forwardRef(({className:i,children:r,...a},c)=>D.jsxs(DUe,{children:[D.jsx(xne,{}),D.jsxs(QO,{ref:c,className:Br("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",i),...a,children:[r,D.jsxs(rne,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[D.jsx(TO,{className:"h-4 w-4"}),D.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Lne.displayName=QO.displayName;const Mne=({className:i,...r})=>D.jsx("div",{className:Br("flex flex-col space-y-1.5 text-center sm:text-left",i),...r});Mne.displayName="DialogHeader";const Une=G.forwardRef(({className:i,...r},a)=>D.jsx(ZO,{ref:a,className:Br("text-lg font-semibold leading-none tracking-tight",i),...r}));Une.displayName=ZO.displayName;const xUe=G.forwardRef(({className:i,...r},a)=>D.jsx(eN,{ref:a,className:Br("text-sm text-muted-foreground",i),...r}));xUe.displayName=eN.displayName;const OA=i=>`/KLE_CONNECT/${i}`,LUe=[{label:"Buy Me a Coffee",note:"Scan and pay any amount you are comfortable with.",imageHint:OA("paytm-om-ganesh.png")}],MUe="upi://pay?pa=omganeshmatiwade007@pingpay&pn=elitehacker&tn=Support%20the%20Creator",UUe=[{name:"Omganesh Matiwade",role:"Full Stack Developer",image:OA("om-ganesh.jpg"),github:"https://github.com/Omganesh014",linkedin:"https://www.linkedin.com/in/omganesh-r-matiwade-08a694330?utm_source=share_via&utm_content=profile&utm_medium=member_android",instagram:"https://www.instagram.com/omganesh_014?igsh=MTRkbjE0MHpycno4aQ==",accent:"hsl(199 89% 48%)"},{name:"Vaibhav Chavanpatil",role:"Backend Developer",image:OA("vaibhav-chavanpatil.jpg"),github:"https://github.com/VAIBHAV7848",linkedin:"https://www.linkedin.com/in/vaibhav-chavanpatil-a047b035a?utm_source=share_via&utm_content=profile&utm_medium=member_android",instagram:"https://www.instagram.com/v_chavanpatil?igsh=NzJiNXlyYXF3N3d5",accent:"hsl(263 70% 58%)"},{name:"Darshan Kittur",role:"UI/UX Designer",image:OA("darshan-kittur.jpg"),github:"https://github.com/darshankittur",linkedin:"https://www.linkedin.com/in/darshan-kittur-65532a326?utm_source=share_via&utm_content=profile&utm_medium=member_android",instagram:"https://www.instagram.com/darshankittur_79?igsh=Z2JxZGtueWFvZnN3",accent:"hsl(35 90% 55%)"}],VUe=i=>i.split(" ").map(r=>r[0]||"").join("").slice(0,2).toUpperCase(),FUe=({name:i,src:r,accent:a})=>{const[c,l]=G.useState(!1),h=VUe(i);return!r||c?D.jsxs("div",{className:"w-24 h-24 rounded-full border-2 flex items-center justify-center text-xl font-bold text-white shadow-lg relative overflow-hidden",style:{background:`linear-gradient(135deg, ${a}, ${a}dd)`,borderColor:a},"aria-label":i,children:[D.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 to-transparent"}),D.jsx("span",{className:"relative z-10",children:h})]}):D.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden border-2 shadow-lg bg-muted",style:{borderColor:a},children:D.jsx("img",{src:r,alt:i,className:"w-full h-full object-cover",onError:()=>l(!0),loading:"lazy"})})},jUe=({src:i,alt:r})=>{const[a,c]=G.useState(!1);return a?D.jsxs("div",{className:"rounded-xl border border-dashed border-border/60 bg-muted/40 flex items-center justify-center w-64 h-64 px-4 text-center text-xs text-muted-foreground",children:["Could not load ",i,". Place your QR file at that exact path inside /public."]}):D.jsx("div",{className:"rounded-xl border border-border/60 bg-muted/20 flex items-center justify-center w-64 h-64 overflow-hidden p-2",children:D.jsx("img",{src:i,alt:r,className:"w-full h-full object-contain",loading:"lazy",onError:()=>c(!0)})})},BUe=()=>{const[i,r]=G.useState(!1);return D.jsxs(Sc,{children:[D.jsx(hu,{icon:cX,title:"Meet the Developers",subtitle:"Built with passion. Supported by the community.",gradient:"linear-gradient(135deg, hsl(199 89% 48% / 0.25), hsl(45 93% 47% / 0.15))"}),D.jsxs("div",{className:"space-y-8",children:[D.jsxs(Xn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.35},className:"glass rounded-2xl p-6 flex flex-col gap-3",children:[D.jsx("p",{className:"text-sm text-muted-foreground",children:"Meet the developers behind the project and support the work if you found it useful."}),D.jsxs("div",{className:"grid gap-3 md:grid-cols-3 text-sm text-muted-foreground",children:[D.jsxs("div",{className:"flex items-start gap-2",children:[D.jsx(Ege,{className:"w-4 h-4 text-primary mt-0.5"}),D.jsx("span",{children:"Direct, optional support - no feature gating or subscriptions."})]}),D.jsxs("div",{className:"flex items-start gap-2",children:[D.jsx(sK,{className:"w-4 h-4 text-primary mt-0.5"}),D.jsx("span",{children:"Micro-payments add up over time and keep the project healthy."})]}),D.jsxs("div",{className:"flex items-start gap-2",children:[D.jsx(cge,{className:"w-4 h-4 text-primary mt-0.5"}),D.jsx("span",{children:"Messages often include appreciation, bug reports, and feature ideas."})]})]})]}),D.jsx("section",{className:"grid gap-4 md:grid-cols-3",children:UUe.map((a,c)=>D.jsx(Xn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.35,delay:c*.05},className:"glass rounded-2xl p-5 border border-border/50",children:D.jsxs("div",{className:"flex flex-col items-center text-center gap-3",children:[D.jsx(FUe,{name:a.name,src:a.image,accent:a.accent}),D.jsxs("div",{children:[D.jsx("h3",{className:"text-lg font-semibold text-foreground",children:a.name}),D.jsx("p",{className:"text-sm text-muted-foreground",children:a.role})]}),D.jsxs("div",{className:"flex flex-wrap justify-center gap-2 w-full",children:[D.jsx(nr,{asChild:!0,size:"sm",variant:"outline",children:D.jsxs("a",{href:a.github,target:"_blank",rel:"noreferrer",className:"flex items-center gap-1",children:[D.jsx(_ge,{className:"w-4 h-4"})," GitHub"]})}),D.jsx(nr,{asChild:!0,size:"sm",variant:"outline",children:D.jsxs("a",{href:a.linkedin,target:"_blank",rel:"noreferrer",className:"flex items-center gap-1",children:[D.jsx(Tge,{className:"w-4 h-4"})," LinkedIn"]})}),D.jsx(nr,{asChild:!0,size:"sm",variant:"outline",children:D.jsxs("a",{href:a.instagram,target:"_blank",rel:"noreferrer",className:"flex items-center gap-1",children:[D.jsx(Sge,{className:"w-4 h-4"})," Instagram"]})})]})]})},a.name))}),D.jsxs(Xn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},className:"glass rounded-2xl p-6 border border-border/50",children:[D.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[D.jsxs("div",{className:"space-y-1",children:[D.jsx("h3",{className:"text-xl font-semibold text-foreground",children:"Support Our Work"}),D.jsx("p",{className:"text-sm text-muted-foreground max-w-2xl",children:"If this project helped you, consider supporting us. Your contribution helps us maintain, improve, and scale."})]}),D.jsxs("div",{className:"flex flex-wrap gap-3",children:[D.jsxs(nr,{onClick:()=>r(!0),children:[D.jsx(sK,{className:"w-4 h-4"})," Support via Buy Me a Coffee"]}),D.jsxs(nr,{variant:"outline",onClick:()=>window.location.assign(MUe),children:[D.jsx(uK,{className:"w-4 h-4"})," Pay via UPI"]})]})]}),D.jsx("p",{className:"text-xs text-muted-foreground mt-3",children:"Every contribution means a lot."})]}),D.jsxs(Xn.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},transition:{duration:.35},className:"glass rounded-2xl p-6 grid gap-4 md:grid-cols-3 border border-border/40",children:[D.jsxs("div",{className:"space-y-2",children:[D.jsx("h4",{className:"text-sm font-semibold text-foreground",children:"Support flow"}),D.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"1) Open the Buy Me a Coffee link  2) Choose an amount  3) Pay (card / UPI / PayPal)  4) Optionally leave a message  5) Money goes directly to you."})]}),D.jsxs("div",{className:"space-y-2",children:[D.jsx("h4",{className:"text-sm font-semibold text-foreground",children:"Why it helps"}),D.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"Direct income without ads or contracts. Great for open-source, free tools, tutorials, and hackathon projects."})]}),D.jsxs("div",{className:"space-y-2",children:[D.jsx("h4",{className:"text-sm font-semibold text-foreground",children:"Best practices"}),D.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"Keep it optional and respectful. Mention where funds go. Add this link to your footer, README, and portfolio."})]})]})]}),D.jsx(kUe,{open:i,onOpenChange:r,children:D.jsxs(Lne,{className:"max-w-md",children:[D.jsx(Mne,{children:D.jsx(Une,{className:"text-2xl text-center",children:"Support via QR Code"})}),D.jsx("div",{className:"flex flex-col items-center text-center gap-4 py-4",children:LUe.map(a=>D.jsxs("div",{className:"flex flex-col items-center gap-3 w-full",children:[D.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary/15 flex items-center justify-center",children:D.jsx(uK,{className:"w-5 h-5 text-primary"})}),D.jsxs("div",{children:[D.jsx("h4",{className:"text-base font-semibold text-foreground",children:a.label}),D.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.note})]}),D.jsx(jUe,{src:a.imageHint,alt:`${a.label} QR`}),D.jsxs("p",{className:"text-[11px] text-muted-foreground",children:["Place your QR file at ",a.imageHint," inside /public."]})]},a.label))})]})})]})},WUe=()=>{const i=Ef();return G.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",i.pathname)},[i.pathname]),D.jsx(Sc,{children:D.jsx("div",{className:"min-h-[60vh] flex items-center justify-center",children:D.jsxs(Xn.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5},className:"text-center",children:[D.jsx("div",{className:"text-8xl font-bold font-display mb-4 text-gradient",children:"404"}),D.jsx("h1",{className:"text-2xl font-semibold text-foreground mb-2",children:"Page Not Found"}),D.jsx("p",{className:"text-muted-foreground mb-6",children:"The page you're looking for doesn't exist or has been moved."}),D.jsx(lw,{to:"/",children:D.jsxs(nr,{className:"gap-2 bg-primary hover:bg-primary/90",children:[D.jsx(vge,{className:"w-4 h-4"}),"Go Home"]})})]})})})};class GUe extends G.Component{state={hasError:!1,error:null};static getDerivedStateFromError(r){return{hasError:!0,error:r}}componentDidCatch(r,a){console.error("Uncaught error:",r,a)}handleReset=()=>{this.setState({hasError:!1,error:null}),window.location.href="/"};render(){return this.state.hasError?D.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-6 text-center",children:D.jsxs("div",{className:"glass max-w-md w-full p-8 rounded-2xl animate-in fade-in zoom-in duration-300",children:[D.jsx("div",{className:"w-16 h-16 bg-destructive/20 rounded-2xl flex items-center justify-center mx-auto mb-6",children:D.jsx(Mge,{className:"w-8 h-8 text-destructive"})}),D.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Something went wrong"}),D.jsx("p",{className:"text-muted-foreground mb-8 text-sm",children:"We encountered an unexpected error. Don't worry, your data is safe."}),D.jsxs(nr,{onClick:this.handleReset,className:"w-full gap-2",children:[D.jsx(Pge,{className:"w-4 h-4"}),"Reload Application"]}),!1]})}):this.props.children}}const sc=({children:i})=>{const{user:r,loading:a}=UO();return a?D.jsx("div",{className:"h-screen w-full flex items-center justify-center bg-background",children:D.jsx(Oy,{className:"w-8 h-8 animate-spin text-primary"})}):r?D.jsx(D.Fragment,{children:i}):D.jsx(Xve,{to:"/auth",replace:!0})},HUe=rSe([{path:"/auth",element:D.jsx(Q1e,{})},{path:"/",element:D.jsx(sc,{children:D.jsx(a1e,{})})},{path:"/ai-tutor",element:D.jsx(sc,{children:D.jsx(Aq,{})})},{path:"/ai_tutor",element:D.jsx(sc,{children:D.jsx(Aq,{})})},{path:"/notes",element:D.jsx(sc,{children:D.jsx(N2e,{})})},{path:"/planner",element:D.jsx(sc,{children:D.jsx(P2e,{})})},{path:"/study-rooms",element:D.jsx(sc,{children:D.jsx(mUe,{})})},{path:"/campus-map",element:D.jsx(sc,{children:D.jsx(yUe,{})})},{path:"/events",element:D.jsx(sc,{children:D.jsx(vUe,{})})},{path:"/doubts",element:D.jsx(sc,{children:D.jsx(SUe,{})})},{path:"/senior-connect",element:D.jsx(sc,{children:D.jsx(TUe,{})})},{path:"/student-help",element:D.jsx(sc,{children:D.jsx(wUe,{})})},{path:"/support",element:D.jsx(sc,{children:D.jsx(BUe,{})})},{path:"/settings",element:D.jsx(sc,{children:D.jsx(PUe,{})})},{path:"*",element:D.jsx(WUe,{})}],{future:{v7_relativeSplatPath:!0,v7_fetcherPersist:!0,v7_normalizeFormMethod:!0,v7_partialHydration:!0,v7_skipActionErrorRevalidation:!0}}),zUe=()=>D.jsx(GUe,{children:D.jsx(ibe,{children:D.jsxs(Mye,{children:[D.jsx(E_e,{}),D.jsx(J_e,{}),D.jsx(hSe,{router:HUe,future:{v7_startTransition:!0}})]})})});sme.createRoot(document.getElementById("root")).render(D.jsx(zUe,{}));
