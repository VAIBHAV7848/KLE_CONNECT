function aX(i,n){for(var s=0;s<n.length;s++){const a=n[s];if(typeof a!="string"&&!Array.isArray(a)){for(const l in a)if(l!=="default"&&!(l in i)){const d=Object.getOwnPropertyDescriptor(a,l);d&&Object.defineProperty(i,l,d.get?d:{enumerable:!0,get:()=>a[l]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))a(l);new MutationObserver(l=>{for(const d of l)if(d.type==="childList")for(const f of d.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&a(f)}).observe(document,{childList:!0,subtree:!0});function s(l){const d={};return l.integrity&&(d.integrity=l.integrity),l.referrerPolicy&&(d.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?d.credentials="include":l.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function a(l){if(l.ep)return;l.ep=!0;const d=s(l);fetch(l.href,d)}})();function IO(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Nx={exports:{}},S0={},Px={exports:{}},nr={};var nK;function Dme(){if(nK)return nr;nK=1;var i=Symbol.for("react.element"),n=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),f=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),S=Symbol.for("react.suspense"),T=Symbol.for("react.memo"),C=Symbol.for("react.lazy"),I=Symbol.iterator;function N(ge){return ge===null||typeof ge!="object"?null:(ge=I&&ge[I]||ge["@@iterator"],typeof ge=="function"?ge:null)}var P={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},W=Object.assign,x={};function B(ge,Oe,ue){this.props=ge,this.context=Oe,this.refs=x,this.updater=ue||P}B.prototype.isReactComponent={},B.prototype.setState=function(ge,Oe){if(typeof ge!="object"&&typeof ge!="function"&&ge!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ge,Oe,"setState")},B.prototype.forceUpdate=function(ge){this.updater.enqueueForceUpdate(this,ge,"forceUpdate")};function X(){}X.prototype=B.prototype;function Z(ge,Oe,ue){this.props=ge,this.context=Oe,this.refs=x,this.updater=ue||P}var $=Z.prototype=new X;$.constructor=Z,W($,B.prototype),$.isPureReactComponent=!0;var ae=Array.isArray,ce=Object.prototype.hasOwnProperty,le={current:null},ne={key:!0,ref:!0,__self:!0,__source:!0};function fe(ge,Oe,ue){var it,yt={},Dt=null,At=null;if(Oe!=null)for(it in Oe.ref!==void 0&&(At=Oe.ref),Oe.key!==void 0&&(Dt=""+Oe.key),Oe)ce.call(Oe,it)&&!ne.hasOwnProperty(it)&&(yt[it]=Oe[it]);var dn=arguments.length-2;if(dn===1)yt.children=ue;else if(1<dn){for(var Cn=Array(dn),fr=0;fr<dn;fr++)Cn[fr]=arguments[fr+2];yt.children=Cn}if(ge&&ge.defaultProps)for(it in dn=ge.defaultProps,dn)yt[it]===void 0&&(yt[it]=dn[it]);return{$$typeof:i,type:ge,key:Dt,ref:At,props:yt,_owner:le.current}}function Se(ge,Oe){return{$$typeof:i,type:ge.type,key:Oe,ref:ge.ref,props:ge.props,_owner:ge._owner}}function De(ge){return typeof ge=="object"&&ge!==null&&ge.$$typeof===i}function be(ge){var Oe={"=":"=0",":":"=2"};return"$"+ge.replace(/[=:]/g,function(ue){return Oe[ue]})}var ye=/\/+/g;function Ge(ge,Oe){return typeof ge=="object"&&ge!==null&&ge.key!=null?be(""+ge.key):Oe.toString(36)}function Te(ge,Oe,ue,it,yt){var Dt=typeof ge;(Dt==="undefined"||Dt==="boolean")&&(ge=null);var At=!1;if(ge===null)At=!0;else switch(Dt){case"string":case"number":At=!0;break;case"object":switch(ge.$$typeof){case i:case n:At=!0}}if(At)return At=ge,yt=yt(At),ge=it===""?"."+Ge(At,0):it,ae(yt)?(ue="",ge!=null&&(ue=ge.replace(ye,"$&/")+"/"),Te(yt,Oe,ue,"",function(fr){return fr})):yt!=null&&(De(yt)&&(yt=Se(yt,ue+(!yt.key||At&&At.key===yt.key?"":(""+yt.key).replace(ye,"$&/")+"/")+ge)),Oe.push(yt)),1;if(At=0,it=it===""?".":it+":",ae(ge))for(var dn=0;dn<ge.length;dn++){Dt=ge[dn];var Cn=it+Ge(Dt,dn);At+=Te(Dt,Oe,ue,Cn,yt)}else if(Cn=N(ge),typeof Cn=="function")for(ge=Cn.call(ge),dn=0;!(Dt=ge.next()).done;)Dt=Dt.value,Cn=it+Ge(Dt,dn++),At+=Te(Dt,Oe,ue,Cn,yt);else if(Dt==="object")throw Oe=String(ge),Error("Objects are not valid as a React child (found: "+(Oe==="[object Object]"?"object with keys {"+Object.keys(ge).join(", ")+"}":Oe)+"). If you meant to render a collection of children, use an array instead.");return At}function Fe(ge,Oe,ue){if(ge==null)return ge;var it=[],yt=0;return Te(ge,it,"","",function(Dt){return Oe.call(ue,Dt,yt++)}),it}function Je(ge){if(ge._status===-1){var Oe=ge._result;Oe=Oe(),Oe.then(function(ue){(ge._status===0||ge._status===-1)&&(ge._status=1,ge._result=ue)},function(ue){(ge._status===0||ge._status===-1)&&(ge._status=2,ge._result=ue)}),ge._status===-1&&(ge._status=0,ge._result=Oe)}if(ge._status===1)return ge._result.default;throw ge._result}var je={current:null},Ie={transition:null},He={ReactCurrentDispatcher:je,ReactCurrentBatchConfig:Ie,ReactCurrentOwner:le};function re(){throw Error("act(...) is not supported in production builds of React.")}return nr.Children={map:Fe,forEach:function(ge,Oe,ue){Fe(ge,function(){Oe.apply(this,arguments)},ue)},count:function(ge){var Oe=0;return Fe(ge,function(){Oe++}),Oe},toArray:function(ge){return Fe(ge,function(Oe){return Oe})||[]},only:function(ge){if(!De(ge))throw Error("React.Children.only expected to receive a single React element child.");return ge}},nr.Component=B,nr.Fragment=s,nr.Profiler=l,nr.PureComponent=Z,nr.StrictMode=a,nr.Suspense=S,nr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=He,nr.act=re,nr.cloneElement=function(ge,Oe,ue){if(ge==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+ge+".");var it=W({},ge.props),yt=ge.key,Dt=ge.ref,At=ge._owner;if(Oe!=null){if(Oe.ref!==void 0&&(Dt=Oe.ref,At=le.current),Oe.key!==void 0&&(yt=""+Oe.key),ge.type&&ge.type.defaultProps)var dn=ge.type.defaultProps;for(Cn in Oe)ce.call(Oe,Cn)&&!ne.hasOwnProperty(Cn)&&(it[Cn]=Oe[Cn]===void 0&&dn!==void 0?dn[Cn]:Oe[Cn])}var Cn=arguments.length-2;if(Cn===1)it.children=ue;else if(1<Cn){dn=Array(Cn);for(var fr=0;fr<Cn;fr++)dn[fr]=arguments[fr+2];it.children=dn}return{$$typeof:i,type:ge.type,key:yt,ref:Dt,props:it,_owner:At}},nr.createContext=function(ge){return ge={$$typeof:f,_currentValue:ge,_currentValue2:ge,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},ge.Provider={$$typeof:d,_context:ge},ge.Consumer=ge},nr.createElement=fe,nr.createFactory=function(ge){var Oe=fe.bind(null,ge);return Oe.type=ge,Oe},nr.createRef=function(){return{current:null}},nr.forwardRef=function(ge){return{$$typeof:E,render:ge}},nr.isValidElement=De,nr.lazy=function(ge){return{$$typeof:C,_payload:{_status:-1,_result:ge},_init:Je}},nr.memo=function(ge,Oe){return{$$typeof:T,type:ge,compare:Oe===void 0?null:Oe}},nr.startTransition=function(ge){var Oe=Ie.transition;Ie.transition={};try{ge()}finally{Ie.transition=Oe}},nr.unstable_act=re,nr.useCallback=function(ge,Oe){return je.current.useCallback(ge,Oe)},nr.useContext=function(ge){return je.current.useContext(ge)},nr.useDebugValue=function(){},nr.useDeferredValue=function(ge){return je.current.useDeferredValue(ge)},nr.useEffect=function(ge,Oe){return je.current.useEffect(ge,Oe)},nr.useId=function(){return je.current.useId()},nr.useImperativeHandle=function(ge,Oe,ue){return je.current.useImperativeHandle(ge,Oe,ue)},nr.useInsertionEffect=function(ge,Oe){return je.current.useInsertionEffect(ge,Oe)},nr.useLayoutEffect=function(ge,Oe){return je.current.useLayoutEffect(ge,Oe)},nr.useMemo=function(ge,Oe){return je.current.useMemo(ge,Oe)},nr.useReducer=function(ge,Oe,ue){return je.current.useReducer(ge,Oe,ue)},nr.useRef=function(ge){return je.current.useRef(ge)},nr.useState=function(ge){return je.current.useState(ge)},nr.useSyncExternalStore=function(ge,Oe,ue){return je.current.useSyncExternalStore(ge,Oe,ue)},nr.useTransition=function(){return je.current.useTransition()},nr.version="18.3.1",nr}var rK;function v2(){return rK||(rK=1,Px.exports=Dme()),Px.exports}var iK;function xme(){if(iK)return S0;iK=1;var i=v2(),n=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,l=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function f(E,S,T){var C,I={},N=null,P=null;T!==void 0&&(N=""+T),S.key!==void 0&&(N=""+S.key),S.ref!==void 0&&(P=S.ref);for(C in S)a.call(S,C)&&!d.hasOwnProperty(C)&&(I[C]=S[C]);if(E&&E.defaultProps)for(C in S=E.defaultProps,S)I[C]===void 0&&(I[C]=S[C]);return{$$typeof:n,type:E,key:N,ref:P,props:I,_owner:l.current}}return S0.Fragment=s,S0.jsx=f,S0.jsxs=f,S0}var sK;function Lme(){return sK||(sK=1,Nx.exports=xme()),Nx.exports}var D=Lme(),QI={},kx={exports:{}},Ra={},Dx={exports:{}},xx={};var oK;function Mme(){return oK||(oK=1,(function(i){function n(Ie,He){var re=Ie.length;Ie.push(He);e:for(;0<re;){var ge=re-1>>>1,Oe=Ie[ge];if(0<l(Oe,He))Ie[ge]=He,Ie[re]=Oe,re=ge;else break e}}function s(Ie){return Ie.length===0?null:Ie[0]}function a(Ie){if(Ie.length===0)return null;var He=Ie[0],re=Ie.pop();if(re!==He){Ie[0]=re;e:for(var ge=0,Oe=Ie.length,ue=Oe>>>1;ge<ue;){var it=2*(ge+1)-1,yt=Ie[it],Dt=it+1,At=Ie[Dt];if(0>l(yt,re))Dt<Oe&&0>l(At,yt)?(Ie[ge]=At,Ie[Dt]=re,ge=Dt):(Ie[ge]=yt,Ie[it]=re,ge=it);else if(Dt<Oe&&0>l(At,re))Ie[ge]=At,Ie[Dt]=re,ge=Dt;else break e}}return He}function l(Ie,He){var re=Ie.sortIndex-He.sortIndex;return re!==0?re:Ie.id-He.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;i.unstable_now=function(){return d.now()}}else{var f=Date,E=f.now();i.unstable_now=function(){return f.now()-E}}var S=[],T=[],C=1,I=null,N=3,P=!1,W=!1,x=!1,B=typeof setTimeout=="function"?setTimeout:null,X=typeof clearTimeout=="function"?clearTimeout:null,Z=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function $(Ie){for(var He=s(T);He!==null;){if(He.callback===null)a(T);else if(He.startTime<=Ie)a(T),He.sortIndex=He.expirationTime,n(S,He);else break;He=s(T)}}function ae(Ie){if(x=!1,$(Ie),!W)if(s(S)!==null)W=!0,Je(ce);else{var He=s(T);He!==null&&je(ae,He.startTime-Ie)}}function ce(Ie,He){W=!1,x&&(x=!1,X(fe),fe=-1),P=!0;var re=N;try{for($(He),I=s(S);I!==null&&(!(I.expirationTime>He)||Ie&&!be());){var ge=I.callback;if(typeof ge=="function"){I.callback=null,N=I.priorityLevel;var Oe=ge(I.expirationTime<=He);He=i.unstable_now(),typeof Oe=="function"?I.callback=Oe:I===s(S)&&a(S),$(He)}else a(S);I=s(S)}if(I!==null)var ue=!0;else{var it=s(T);it!==null&&je(ae,it.startTime-He),ue=!1}return ue}finally{I=null,N=re,P=!1}}var le=!1,ne=null,fe=-1,Se=5,De=-1;function be(){return!(i.unstable_now()-De<Se)}function ye(){if(ne!==null){var Ie=i.unstable_now();De=Ie;var He=!0;try{He=ne(!0,Ie)}finally{He?Ge():(le=!1,ne=null)}}else le=!1}var Ge;if(typeof Z=="function")Ge=function(){Z(ye)};else if(typeof MessageChannel<"u"){var Te=new MessageChannel,Fe=Te.port2;Te.port1.onmessage=ye,Ge=function(){Fe.postMessage(null)}}else Ge=function(){B(ye,0)};function Je(Ie){ne=Ie,le||(le=!0,Ge())}function je(Ie,He){fe=B(function(){Ie(i.unstable_now())},He)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(Ie){Ie.callback=null},i.unstable_continueExecution=function(){W||P||(W=!0,Je(ce))},i.unstable_forceFrameRate=function(Ie){0>Ie||125<Ie?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Se=0<Ie?Math.floor(1e3/Ie):5},i.unstable_getCurrentPriorityLevel=function(){return N},i.unstable_getFirstCallbackNode=function(){return s(S)},i.unstable_next=function(Ie){switch(N){case 1:case 2:case 3:var He=3;break;default:He=N}var re=N;N=He;try{return Ie()}finally{N=re}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(Ie,He){switch(Ie){case 1:case 2:case 3:case 4:case 5:break;default:Ie=3}var re=N;N=Ie;try{return He()}finally{N=re}},i.unstable_scheduleCallback=function(Ie,He,re){var ge=i.unstable_now();switch(typeof re=="object"&&re!==null?(re=re.delay,re=typeof re=="number"&&0<re?ge+re:ge):re=ge,Ie){case 1:var Oe=-1;break;case 2:Oe=250;break;case 5:Oe=1073741823;break;case 4:Oe=1e4;break;default:Oe=5e3}return Oe=re+Oe,Ie={id:C++,callback:He,priorityLevel:Ie,startTime:re,expirationTime:Oe,sortIndex:-1},re>ge?(Ie.sortIndex=re,n(T,Ie),s(S)===null&&Ie===s(T)&&(x?(X(fe),fe=-1):x=!0,je(ae,re-ge))):(Ie.sortIndex=Oe,n(S,Ie),W||P||(W=!0,Je(ce))),Ie},i.unstable_shouldYield=be,i.unstable_wrapCallback=function(Ie){var He=N;return function(){var re=N;N=He;try{return Ie.apply(this,arguments)}finally{N=re}}}})(xx)),xx}var aK;function Ume(){return aK||(aK=1,Dx.exports=Mme()),Dx.exports}var cK;function Vme(){if(cK)return Ra;cK=1;var i=v2(),n=Ume();function s(p){for(var _="https://reactjs.org/docs/error-decoder.html?invariant="+p,w=1;w<arguments.length;w++)_+="&args[]="+encodeURIComponent(arguments[w]);return"Minified React error #"+p+"; visit "+_+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,l={};function d(p,_){f(p,_),f(p+"Capture",_)}function f(p,_){for(l[p]=_,p=0;p<_.length;p++)a.add(_[p])}var E=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),S=Object.prototype.hasOwnProperty,T=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,C={},I={};function N(p){return S.call(I,p)?!0:S.call(C,p)?!1:T.test(p)?I[p]=!0:(C[p]=!0,!1)}function P(p,_,w,O){if(w!==null&&w.type===0)return!1;switch(typeof _){case"function":case"symbol":return!0;case"boolean":return O?!1:w!==null?!w.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function W(p,_,w,O){if(_===null||typeof _>"u"||P(p,_,w,O))return!0;if(O)return!1;if(w!==null)switch(w.type){case 3:return!_;case 4:return _===!1;case 5:return isNaN(_);case 6:return isNaN(_)||1>_}return!1}function x(p,_,w,O,U,G,ee){this.acceptsBooleans=_===2||_===3||_===4,this.attributeName=O,this.attributeNamespace=U,this.mustUseProperty=w,this.propertyName=p,this.type=_,this.sanitizeURL=G,this.removeEmptyString=ee}var B={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){B[p]=new x(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var _=p[0];B[_]=new x(_,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){B[p]=new x(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){B[p]=new x(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){B[p]=new x(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){B[p]=new x(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){B[p]=new x(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){B[p]=new x(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){B[p]=new x(p,5,!1,p.toLowerCase(),null,!1,!1)});var X=/[\-:]([a-z])/g;function Z(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var _=p.replace(X,Z);B[_]=new x(_,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var _=p.replace(X,Z);B[_]=new x(_,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var _=p.replace(X,Z);B[_]=new x(_,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){B[p]=new x(p,1,!1,p.toLowerCase(),null,!1,!1)}),B.xlinkHref=new x("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){B[p]=new x(p,1,!1,p.toLowerCase(),null,!0,!0)});function $(p,_,w,O){var U=B.hasOwnProperty(_)?B[_]:null;(U!==null?U.type!==0:O||!(2<_.length)||_[0]!=="o"&&_[0]!=="O"||_[1]!=="n"&&_[1]!=="N")&&(W(_,w,U,O)&&(w=null),O||U===null?N(_)&&(w===null?p.removeAttribute(_):p.setAttribute(_,""+w)):U.mustUseProperty?p[U.propertyName]=w===null?U.type===3?!1:"":w:(_=U.attributeName,O=U.attributeNamespace,w===null?p.removeAttribute(_):(U=U.type,w=U===3||U===4&&w===!0?"":""+w,O?p.setAttributeNS(O,_,w):p.setAttribute(_,w))))}var ae=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ce=Symbol.for("react.element"),le=Symbol.for("react.portal"),ne=Symbol.for("react.fragment"),fe=Symbol.for("react.strict_mode"),Se=Symbol.for("react.profiler"),De=Symbol.for("react.provider"),be=Symbol.for("react.context"),ye=Symbol.for("react.forward_ref"),Ge=Symbol.for("react.suspense"),Te=Symbol.for("react.suspense_list"),Fe=Symbol.for("react.memo"),Je=Symbol.for("react.lazy"),je=Symbol.for("react.offscreen"),Ie=Symbol.iterator;function He(p){return p===null||typeof p!="object"?null:(p=Ie&&p[Ie]||p["@@iterator"],typeof p=="function"?p:null)}var re=Object.assign,ge;function Oe(p){if(ge===void 0)try{throw Error()}catch(w){var _=w.stack.trim().match(/\n( *(at )?)/);ge=_&&_[1]||""}return`
`+ge+p}var ue=!1;function it(p,_){if(!p||ue)return"";ue=!0;var w=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(_)if(_=function(){throw Error()},Object.defineProperty(_.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(_,[])}catch(Ke){var O=Ke}Reflect.construct(p,[],_)}else{try{_.call()}catch(Ke){O=Ke}p.call(_.prototype)}else{try{throw Error()}catch(Ke){O=Ke}p()}}catch(Ke){if(Ke&&O&&typeof Ke.stack=="string"){for(var U=Ke.stack.split(`
`),G=O.stack.split(`
`),ee=U.length-1,me=G.length-1;1<=ee&&0<=me&&U[ee]!==G[me];)me--;for(;1<=ee&&0<=me;ee--,me--)if(U[ee]!==G[me]){if(ee!==1||me!==1)do if(ee--,me--,0>me||U[ee]!==G[me]){var ve=`
`+U[ee].replace(" at new "," at ");return p.displayName&&ve.includes("<anonymous>")&&(ve=ve.replace("<anonymous>",p.displayName)),ve}while(1<=ee&&0<=me);break}}}finally{ue=!1,Error.prepareStackTrace=w}return(p=p?p.displayName||p.name:"")?Oe(p):""}function yt(p){switch(p.tag){case 5:return Oe(p.type);case 16:return Oe("Lazy");case 13:return Oe("Suspense");case 19:return Oe("SuspenseList");case 0:case 2:case 15:return p=it(p.type,!1),p;case 11:return p=it(p.type.render,!1),p;case 1:return p=it(p.type,!0),p;default:return""}}function Dt(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case ne:return"Fragment";case le:return"Portal";case Se:return"Profiler";case fe:return"StrictMode";case Ge:return"Suspense";case Te:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case be:return(p.displayName||"Context")+".Consumer";case De:return(p._context.displayName||"Context")+".Provider";case ye:var _=p.render;return p=p.displayName,p||(p=_.displayName||_.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case Fe:return _=p.displayName||null,_!==null?_:Dt(p.type)||"Memo";case Je:_=p._payload,p=p._init;try{return Dt(p(_))}catch{}}return null}function At(p){var _=p.type;switch(p.tag){case 24:return"Cache";case 9:return(_.displayName||"Context")+".Consumer";case 10:return(_._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=_.render,p=p.displayName||p.name||"",_.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return _;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Dt(_);case 8:return _===fe?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof _=="function")return _.displayName||_.name||null;if(typeof _=="string")return _}return null}function dn(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function Cn(p){var _=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(_==="checkbox"||_==="radio")}function fr(p){var _=Cn(p)?"checked":"value",w=Object.getOwnPropertyDescriptor(p.constructor.prototype,_),O=""+p[_];if(!p.hasOwnProperty(_)&&typeof w<"u"&&typeof w.get=="function"&&typeof w.set=="function"){var U=w.get,G=w.set;return Object.defineProperty(p,_,{configurable:!0,get:function(){return U.call(this)},set:function(ee){O=""+ee,G.call(this,ee)}}),Object.defineProperty(p,_,{enumerable:w.enumerable}),{getValue:function(){return O},setValue:function(ee){O=""+ee},stopTracking:function(){p._valueTracker=null,delete p[_]}}}}function as(p){p._valueTracker||(p._valueTracker=fr(p))}function Jr(p){if(!p)return!1;var _=p._valueTracker;if(!_)return!0;var w=_.getValue(),O="";return p&&(O=Cn(p)?p.checked?"true":"false":p.value),p=O,p!==w?(_.setValue(p),!0):!1}function Mr(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function wc(p,_){var w=_.checked;return re({},_,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:w??p._wrapperState.initialChecked})}function fl(p,_){var w=_.defaultValue==null?"":_.defaultValue,O=_.checked!=null?_.checked:_.defaultChecked;w=dn(_.value!=null?_.value:w),p._wrapperState={initialChecked:O,initialValue:w,controlled:_.type==="checkbox"||_.type==="radio"?_.checked!=null:_.value!=null}}function yi(p,_){_=_.checked,_!=null&&$(p,"checked",_,!1)}function Cc(p,_){yi(p,_);var w=dn(_.value),O=_.type;if(w!=null)O==="number"?(w===0&&p.value===""||p.value!=w)&&(p.value=""+w):p.value!==""+w&&(p.value=""+w);else if(O==="submit"||O==="reset"){p.removeAttribute("value");return}_.hasOwnProperty("value")?fi(p,_.type,w):_.hasOwnProperty("defaultValue")&&fi(p,_.type,dn(_.defaultValue)),_.checked==null&&_.defaultChecked!=null&&(p.defaultChecked=!!_.defaultChecked)}function Wr(p,_,w){if(_.hasOwnProperty("value")||_.hasOwnProperty("defaultValue")){var O=_.type;if(!(O!=="submit"&&O!=="reset"||_.value!==void 0&&_.value!==null))return;_=""+p._wrapperState.initialValue,w||_===p.value||(p.value=_),p.defaultValue=_}w=p.name,w!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,w!==""&&(p.name=w)}function fi(p,_,w){(_!=="number"||Mr(p.ownerDocument)!==p)&&(w==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+w&&(p.defaultValue=""+w))}var $s=Array.isArray;function gs(p,_,w,O){if(p=p.options,_){_={};for(var U=0;U<w.length;U++)_["$"+w[U]]=!0;for(w=0;w<p.length;w++)U=_.hasOwnProperty("$"+p[w].value),p[w].selected!==U&&(p[w].selected=U),U&&O&&(p[w].defaultSelected=!0)}else{for(w=""+dn(w),_=null,U=0;U<p.length;U++){if(p[U].value===w){p[U].selected=!0,O&&(p[U].defaultSelected=!0);return}_!==null||p[U].disabled||(_=p[U])}_!==null&&(_.selected=!0)}}function Rc(p,_){if(_.dangerouslySetInnerHTML!=null)throw Error(s(91));return re({},_,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function Qs(p,_){var w=_.value;if(w==null){if(w=_.children,_=_.defaultValue,w!=null){if(_!=null)throw Error(s(92));if($s(w)){if(1<w.length)throw Error(s(93));w=w[0]}_=w}_==null&&(_=""),w=_}p._wrapperState={initialValue:dn(w)}}function Ir(p,_){var w=dn(_.value),O=dn(_.defaultValue);w!=null&&(w=""+w,w!==p.value&&(p.value=w),_.defaultValue==null&&p.defaultValue!==w&&(p.defaultValue=w)),O!=null&&(p.defaultValue=""+O)}function Fo(p){var _=p.textContent;_===p._wrapperState.initialValue&&_!==""&&_!==null&&(p.value=_)}function Xe(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lt(p,_){return p==null||p==="http://www.w3.org/1999/xhtml"?Xe(_):p==="http://www.w3.org/2000/svg"&&_==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var Kt,an=(function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(_,w,O,U){MSApp.execUnsafeLocalFunction(function(){return p(_,w,O,U)})}:p})(function(p,_){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=_;else{for(Kt=Kt||document.createElement("div"),Kt.innerHTML="<svg>"+_.valueOf().toString()+"</svg>",_=Kt.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;_.firstChild;)p.appendChild(_.firstChild)}});function Nn(p,_){if(_){var w=p.firstChild;if(w&&w===p.lastChild&&w.nodeType===3){w.nodeValue=_;return}}p.textContent=_}var ii={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Zs=["Webkit","ms","Moz","O"];Object.keys(ii).forEach(function(p){Zs.forEach(function(_){_=_+p.charAt(0).toUpperCase()+p.substring(1),ii[_]=ii[p]})});function $r(p,_,w){return _==null||typeof _=="boolean"||_===""?"":w||typeof _!="number"||_===0||ii.hasOwnProperty(p)&&ii[p]?(""+_).trim():_+"px"}function mi(p,_){p=p.style;for(var w in _)if(_.hasOwnProperty(w)){var O=w.indexOf("--")===0,U=$r(w,_[w],O);w==="float"&&(w="cssFloat"),O?p.setProperty(w,U):p[w]=U}}var Eo=re({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Gr(p,_){if(_){if(Eo[p]&&(_.children!=null||_.dangerouslySetInnerHTML!=null))throw Error(s(137,p));if(_.dangerouslySetInnerHTML!=null){if(_.children!=null)throw Error(s(60));if(typeof _.dangerouslySetInnerHTML!="object"||!("__html"in _.dangerouslySetInnerHTML))throw Error(s(61))}if(_.style!=null&&typeof _.style!="object")throw Error(s(62))}}function yo(p,_){if(p.indexOf("-")===-1)return typeof _.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var vi=null;function ia(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var ml=null,sa=null,vo=null;function jo(p){if(p=Yf(p)){if(typeof ml!="function")throw Error(s(280));var _=p.stateNode;_&&(_=__(_),ml(p.stateNode,p.type,_))}}function ja(p){sa?vo?vo.push(p):vo=[p]:sa=p}function mn(){if(sa){var p=sa,_=vo;if(vo=sa=null,jo(p),_)for(p=0;p<_.length;p++)jo(_[p])}}function Wn(p,_){return p(_)}function mr(){}var $i=!1;function Ls(p,_,w){if($i)return p(_,w);$i=!0;try{return Wn(p,_,w)}finally{$i=!1,(sa!==null||vo!==null)&&(mr(),mn())}}function kr(p,_){var w=p.stateNode;if(w===null)return null;var O=__(w);if(O===null)return null;w=O[_];e:switch(_){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(O=!O.disabled)||(p=p.type,O=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!O;break e;default:p=!1}if(p)return null;if(w&&typeof w!="function")throw Error(s(231,_,typeof w));return w}var Ee=!1;if(E)try{var Ae={};Object.defineProperty(Ae,"passive",{get:function(){Ee=!0}}),window.addEventListener("test",Ae,Ae),window.removeEventListener("test",Ae,Ae)}catch{Ee=!1}function We(p,_,w,O,U,G,ee,me,ve){var Ke=Array.prototype.slice.call(arguments,3);try{_.apply(w,Ke)}catch(ut){this.onError(ut)}}var st=!1,St=null,Yt=!1,hn=null,Ut={onError:function(p){st=!0,St=p}};function Gt(p,_,w,O,U,G,ee,me,ve){st=!1,St=null,We.apply(Ut,arguments)}function xt(p,_,w,O,U,G,ee,me,ve){if(Gt.apply(this,arguments),st){if(st){var Ke=St;st=!1,St=null}else throw Error(s(198));Yt||(Yt=!0,hn=Ke)}}function Vt(p){var _=p,w=p;if(p.alternate)for(;_.return;)_=_.return;else{p=_;do _=p,(_.flags&4098)!==0&&(w=_.return),p=_.return;while(p)}return _.tag===3?w:null}function Rn(p){if(p.tag===13){var _=p.memoizedState;if(_===null&&(p=p.alternate,p!==null&&(_=p.memoizedState)),_!==null)return _.dehydrated}return null}function Yn(p){if(Vt(p)!==p)throw Error(s(188))}function Qi(p){var _=p.alternate;if(!_){if(_=Vt(p),_===null)throw Error(s(188));return _!==p?null:p}for(var w=p,O=_;;){var U=w.return;if(U===null)break;var G=U.alternate;if(G===null){if(O=U.return,O!==null){w=O;continue}break}if(U.child===G.child){for(G=U.child;G;){if(G===w)return Yn(U),p;if(G===O)return Yn(U),_;G=G.sibling}throw Error(s(188))}if(w.return!==O.return)w=U,O=G;else{for(var ee=!1,me=U.child;me;){if(me===w){ee=!0,w=U,O=G;break}if(me===O){ee=!0,O=U,w=G;break}me=me.sibling}if(!ee){for(me=G.child;me;){if(me===w){ee=!0,w=G,O=U;break}if(me===O){ee=!0,O=G,w=U;break}me=me.sibling}if(!ee)throw Error(s(189))}}if(w.alternate!==O)throw Error(s(190))}if(w.tag!==3)throw Error(s(188));return w.stateNode.current===w?p:_}function Sr(p){return p=Qi(p),p!==null?ir(p):null}function ir(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var _=ir(p);if(_!==null)return _;p=p.sibling}return null}var Ar=n.unstable_scheduleCallback,gl=n.unstable_cancelCallback,Pd=n.unstable_shouldYield,Zi=n.unstable_requestPaint,gr=n.unstable_now,If=n.unstable_getCurrentPriorityLevel,Ur=n.unstable_ImmediatePriority,bc=n.unstable_UserBlockingPriority,_l=n.unstable_NormalPriority,Oh=n.unstable_LowPriority,sr=n.unstable_IdlePriority,Dr=null,bs=null;function mu(p){if(bs&&typeof bs.onCommitFiberRoot=="function")try{bs.onCommitFiberRoot(Dr,p,void 0,(p.current.flags&128)===128)}catch{}}var _r=Math.clz32?Math.clz32:_u,gu=Math.log,$g=Math.LN2;function _u(p){return p>>>=0,p===0?32:31-(gu(p)/$g|0)|0}var Nh=64,Qg=4194304;function Er(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function Zg(p,_){var w=p.pendingLanes;if(w===0)return 0;var O=0,U=p.suspendedLanes,G=p.pingedLanes,ee=w&268435455;if(ee!==0){var me=ee&~U;me!==0?O=Er(me):(G&=ee,G!==0&&(O=Er(G)))}else ee=w&~U,ee!==0?O=Er(ee):G!==0&&(O=Er(G));if(O===0)return 0;if(_!==0&&_!==O&&(_&U)===0&&(U=O&-O,G=_&-_,U>=G||U===16&&(G&4194240)!==0))return _;if((O&4)!==0&&(O|=w&16),_=p.entangledLanes,_!==0)for(p=p.entanglements,_&=O;0<_;)w=31-_r(_),U=1<<w,O|=p[w],_&=~U;return O}function nC(p,_){switch(p){case 1:case 2:case 4:return _+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function rC(p,_){for(var w=p.suspendedLanes,O=p.pingedLanes,U=p.expirationTimes,G=p.pendingLanes;0<G;){var ee=31-_r(G),me=1<<ee,ve=U[ee];ve===-1?((me&w)===0||(me&O)!==0)&&(U[ee]=nC(me,_)):ve<=_&&(p.expiredLanes|=me),G&=~me}}function wv(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function iC(){var p=Nh;return Nh<<=1,(Nh&4194240)===0&&(Nh=64),p}function Cv(p){for(var _=[],w=0;31>w;w++)_.push(p);return _}function Af(p,_,w){p.pendingLanes|=_,_!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,_=31-_r(_),p[_]=w}function gN(p,_){var w=p.pendingLanes&~_;p.pendingLanes=_,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=_,p.mutableReadLanes&=_,p.entangledLanes&=_,_=p.entanglements;var O=p.eventTimes;for(p=p.expirationTimes;0<w;){var U=31-_r(w),G=1<<U;_[U]=0,O[U]=-1,p[U]=-1,w&=~G}}function Rv(p,_){var w=p.entangledLanes|=_;for(p=p.entanglements;w;){var O=31-_r(w),U=1<<O;U&_|p[O]&_&&(p[O]|=_),w&=~U}}var Tr=0;function bv(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var e_,Iv,t_,sC,Av,Ov=!1,n_=[],Eu=null,yu=null,vu=null,Of=new Map,Nf=new Map,Su=[],oC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function aC(p,_){switch(p){case"focusin":case"focusout":Eu=null;break;case"dragenter":case"dragleave":yu=null;break;case"mouseover":case"mouseout":vu=null;break;case"pointerover":case"pointerout":Of.delete(_.pointerId);break;case"gotpointercapture":case"lostpointercapture":Nf.delete(_.pointerId)}}function Pf(p,_,w,O,U,G){return p===null||p.nativeEvent!==G?(p={blockedOn:_,domEventName:w,eventSystemFlags:O,nativeEvent:G,targetContainers:[U]},_!==null&&(_=Yf(_),_!==null&&Iv(_)),p):(p.eventSystemFlags|=O,_=p.targetContainers,U!==null&&_.indexOf(U)===-1&&_.push(U),p)}function _N(p,_,w,O,U){switch(_){case"focusin":return Eu=Pf(Eu,p,_,w,O,U),!0;case"dragenter":return yu=Pf(yu,p,_,w,O,U),!0;case"mouseover":return vu=Pf(vu,p,_,w,O,U),!0;case"pointerover":var G=U.pointerId;return Of.set(G,Pf(Of.get(G)||null,p,_,w,O,U)),!0;case"gotpointercapture":return G=U.pointerId,Nf.set(G,Pf(Nf.get(G)||null,p,_,w,O,U)),!0}return!1}function Ph(p){var _=xd(p.target);if(_!==null){var w=Vt(_);if(w!==null){if(_=w.tag,_===13){if(_=Rn(w),_!==null){p.blockedOn=_,Av(p.priority,function(){t_(w)});return}}else if(_===3&&w.stateNode.current.memoizedState.isDehydrated){p.blockedOn=w.tag===3?w.stateNode.containerInfo:null;return}}}p.blockedOn=null}function r_(p){if(p.blockedOn!==null)return!1;for(var _=p.targetContainers;0<_.length;){var w=Nv(p.domEventName,p.eventSystemFlags,_[0],p.nativeEvent);if(w===null){w=p.nativeEvent;var O=new w.constructor(w.type,w);vi=O,w.target.dispatchEvent(O),vi=null}else return _=Yf(w),_!==null&&Iv(_),p.blockedOn=w,!1;_.shift()}return!0}function cC(p,_,w){r_(p)&&w.delete(_)}function EN(){Ov=!1,Eu!==null&&r_(Eu)&&(Eu=null),yu!==null&&r_(yu)&&(yu=null),vu!==null&&r_(vu)&&(vu=null),Of.forEach(cC),Nf.forEach(cC)}function kf(p,_){p.blockedOn===_&&(p.blockedOn=null,Ov||(Ov=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,EN)))}function kh(p){function _(U){return kf(U,p)}if(0<n_.length){kf(n_[0],p);for(var w=1;w<n_.length;w++){var O=n_[w];O.blockedOn===p&&(O.blockedOn=null)}}for(Eu!==null&&kf(Eu,p),yu!==null&&kf(yu,p),vu!==null&&kf(vu,p),Of.forEach(_),Nf.forEach(_),w=0;w<Su.length;w++)O=Su[w],O.blockedOn===p&&(O.blockedOn=null);for(;0<Su.length&&(w=Su[0],w.blockedOn===null);)Ph(w),w.blockedOn===null&&Su.shift()}var Dh=ae.ReactCurrentBatchConfig,i_=!0;function yN(p,_,w,O){var U=Tr,G=Dh.transition;Dh.transition=null;try{Tr=1,So(p,_,w,O)}finally{Tr=U,Dh.transition=G}}function Tu(p,_,w,O){var U=Tr,G=Dh.transition;Dh.transition=null;try{Tr=4,So(p,_,w,O)}finally{Tr=U,Dh.transition=G}}function So(p,_,w,O){if(i_){var U=Nv(p,_,w,O);if(U===null)Xv(p,_,O,Df,w),aC(p,O);else if(_N(U,p,_,w,O))O.stopPropagation();else if(aC(p,O),_&4&&-1<oC.indexOf(p)){for(;U!==null;){var G=Yf(U);if(G!==null&&e_(G),G=Nv(p,_,w,O),G===null&&Xv(p,_,O,Df,w),G===U)break;U=G}U!==null&&O.stopPropagation()}else Xv(p,_,O,null,w)}}var Df=null;function Nv(p,_,w,O){if(Df=null,p=ia(O),p=xd(p),p!==null)if(_=Vt(p),_===null)p=null;else if(w=_.tag,w===13){if(p=Rn(_),p!==null)return p;p=null}else if(w===3){if(_.stateNode.current.memoizedState.isDehydrated)return _.tag===3?_.stateNode.containerInfo:null;p=null}else _!==p&&(p=null);return Df=p,null}function lC(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(If()){case Ur:return 1;case bc:return 4;case _l:case Oh:return 16;case sr:return 536870912;default:return 16}default:return 16}}var wu=null,Is=null,s_=null;function uC(){if(s_)return s_;var p,_=Is,w=_.length,O,U="value"in wu?wu.value:wu.textContent,G=U.length;for(p=0;p<w&&_[p]===U[p];p++);var ee=w-p;for(O=1;O<=ee&&_[w-O]===U[G-O];O++);return s_=U.slice(p,1<O?1-O:void 0)}function o_(p){var _=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&_===13&&(p=13)):p=_,p===10&&(p=13),32<=p||p===13?p:0}function kd(){return!0}function Pv(){return!1}function Bo(p){function _(w,O,U,G,ee){this._reactName=w,this._targetInst=U,this.type=O,this.nativeEvent=G,this.target=ee,this.currentTarget=null;for(var me in p)p.hasOwnProperty(me)&&(w=p[me],this[me]=w?w(G):G[me]);return this.isDefaultPrevented=(G.defaultPrevented!=null?G.defaultPrevented:G.returnValue===!1)?kd:Pv,this.isPropagationStopped=Pv,this}return re(_.prototype,{preventDefault:function(){this.defaultPrevented=!0;var w=this.nativeEvent;w&&(w.preventDefault?w.preventDefault():typeof w.returnValue!="unknown"&&(w.returnValue=!1),this.isDefaultPrevented=kd)},stopPropagation:function(){var w=this.nativeEvent;w&&(w.stopPropagation?w.stopPropagation():typeof w.cancelBubble!="unknown"&&(w.cancelBubble=!0),this.isPropagationStopped=kd)},persist:function(){},isPersistent:kd}),_}var Cu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},kv=Bo(Cu),Dd=re({},Cu,{view:0,detail:0}),Dv=Bo(Dd),xf,xv,Lf,Ic=re({},Dd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Mv,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==Lf&&(Lf&&p.type==="mousemove"?(xf=p.screenX-Lf.screenX,xv=p.screenY-Lf.screenY):xv=xf=0,Lf=p),xf)},movementY:function(p){return"movementY"in p?p.movementY:xv}}),xh=Bo(Ic),vN=re({},Ic,{dataTransfer:0}),SN=Bo(vN),TN=re({},Dd,{relatedTarget:0}),Lv=Bo(TN),wN=re({},Cu,{animationName:0,elapsedTime:0,pseudoElement:0}),Lh=Bo(wN),CN=re({},Cu,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),Mh=Bo(CN),dC=re({},Cu,{data:0}),hC=Bo(dC),Sn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},RN={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},bN={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function IN(p){var _=this.nativeEvent;return _.getModifierState?_.getModifierState(p):(p=bN[p])?!!_[p]:!1}function Mv(){return IN}var Uv=re({},Dd,{key:function(p){if(p.key){var _=Sn[p.key]||p.key;if(_!=="Unidentified")return _}return p.type==="keypress"?(p=o_(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?RN[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Mv,charCode:function(p){return p.type==="keypress"?o_(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?o_(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),AN=Bo(Uv),ON=re({},Ic,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),pC=Bo(ON),Vv=re({},Dd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Mv}),NN=Bo(Vv),PN=re({},Cu,{propertyName:0,elapsedTime:0,pseudoElement:0}),fC=Bo(PN),kN=re({},Ic,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),Ru=Bo(kN),DN=[9,13,27,32],Fv=E&&"CompositionEvent"in window,Mf=null;E&&"documentMode"in document&&(Mf=document.documentMode);var mC=E&&"TextEvent"in window&&!Mf,a_=E&&(!Fv||Mf&&8<Mf&&11>=Mf),gC=" ",_C=!1;function EC(p,_){switch(p){case"keyup":return DN.indexOf(_.keyCode)!==-1;case"keydown":return _.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function To(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var Uh=!1;function xN(p,_){switch(p){case"compositionend":return To(_);case"keypress":return _.which!==32?null:(_C=!0,gC);case"textInput":return p=_.data,p===gC&&_C?null:p;default:return null}}function LN(p,_){if(Uh)return p==="compositionend"||!Fv&&EC(p,_)?(p=uC(),s_=Is=wu=null,Uh=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(_.ctrlKey||_.altKey||_.metaKey)||_.ctrlKey&&_.altKey){if(_.char&&1<_.char.length)return _.char;if(_.which)return String.fromCharCode(_.which)}return null;case"compositionend":return a_&&_.locale!=="ko"?null:_.data;default:return null}}var MN={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function c_(p){var _=p&&p.nodeName&&p.nodeName.toLowerCase();return _==="input"?!!MN[p.type]:_==="textarea"}function yC(p,_,w,O){ja(O),_=Gf(_,"onChange"),0<_.length&&(w=new kv("onChange","change",null,w,O),p.push({event:w,listeners:_}))}var Uf=null,Vh=null;function jv(p){NC(p,0)}function l_(p){var _=zh(p);if(Jr(_))return p}function UN(p,_){if(p==="change")return _}var Vf=!1;if(E){var Bv;if(E){var Wv="oninput"in document;if(!Wv){var vC=document.createElement("div");vC.setAttribute("oninput","return;"),Wv=typeof vC.oninput=="function"}Bv=Wv}else Bv=!1;Vf=Bv&&(!document.documentMode||9<document.documentMode)}function El(){Uf&&(Uf.detachEvent("onpropertychange",SC),Vh=Uf=null)}function SC(p){if(p.propertyName==="value"&&l_(Vh)){var _=[];yC(_,Vh,p,ia(p)),Ls(jv,_)}}function VN(p,_,w){p==="focusin"?(El(),Uf=_,Vh=w,Uf.attachEvent("onpropertychange",SC)):p==="focusout"&&El()}function eo(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return l_(Vh)}function FN(p,_){if(p==="click")return l_(_)}function jN(p,_){if(p==="input"||p==="change")return l_(_)}function BN(p,_){return p===_&&(p!==0||1/p===1/_)||p!==p&&_!==_}var Ba=typeof Object.is=="function"?Object.is:BN;function Fh(p,_){if(Ba(p,_))return!0;if(typeof p!="object"||p===null||typeof _!="object"||_===null)return!1;var w=Object.keys(p),O=Object.keys(_);if(w.length!==O.length)return!1;for(O=0;O<w.length;O++){var U=w[O];if(!S.call(_,U)||!Ba(p[U],_[U]))return!1}return!0}function TC(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function wC(p,_){var w=TC(p);p=0;for(var O;w;){if(w.nodeType===3){if(O=p+w.textContent.length,p<=_&&O>=_)return{node:w,offset:_-p};p=O}e:{for(;w;){if(w.nextSibling){w=w.nextSibling;break e}w=w.parentNode}w=void 0}w=TC(w)}}function CC(p,_){return p&&_?p===_?!0:p&&p.nodeType===3?!1:_&&_.nodeType===3?CC(p,_.parentNode):"contains"in p?p.contains(_):p.compareDocumentPosition?!!(p.compareDocumentPosition(_)&16):!1:!1}function Gv(){for(var p=window,_=Mr();_ instanceof p.HTMLIFrameElement;){try{var w=typeof _.contentWindow.location.href=="string"}catch{w=!1}if(w)p=_.contentWindow;else break;_=Mr(p.document)}return _}function Hv(p){var _=p&&p.nodeName&&p.nodeName.toLowerCase();return _&&(_==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||_==="textarea"||p.contentEditable==="true")}function WN(p){var _=Gv(),w=p.focusedElem,O=p.selectionRange;if(_!==w&&w&&w.ownerDocument&&CC(w.ownerDocument.documentElement,w)){if(O!==null&&Hv(w)){if(_=O.start,p=O.end,p===void 0&&(p=_),"selectionStart"in w)w.selectionStart=_,w.selectionEnd=Math.min(p,w.value.length);else if(p=(_=w.ownerDocument||document)&&_.defaultView||window,p.getSelection){p=p.getSelection();var U=w.textContent.length,G=Math.min(O.start,U);O=O.end===void 0?G:Math.min(O.end,U),!p.extend&&G>O&&(U=O,O=G,G=U),U=wC(w,G);var ee=wC(w,O);U&&ee&&(p.rangeCount!==1||p.anchorNode!==U.node||p.anchorOffset!==U.offset||p.focusNode!==ee.node||p.focusOffset!==ee.offset)&&(_=_.createRange(),_.setStart(U.node,U.offset),p.removeAllRanges(),G>O?(p.addRange(_),p.extend(ee.node,ee.offset)):(_.setEnd(ee.node,ee.offset),p.addRange(_)))}}for(_=[],p=w;p=p.parentNode;)p.nodeType===1&&_.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof w.focus=="function"&&w.focus(),w=0;w<_.length;w++)p=_[w],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var zv=E&&"documentMode"in document&&11>=document.documentMode,bu=null,Kv=null,ke=null,Yv=!1;function RC(p,_,w){var O=w.window===w?w.document:w.nodeType===9?w:w.ownerDocument;Yv||bu==null||bu!==Mr(O)||(O=bu,"selectionStart"in O&&Hv(O)?O={start:O.selectionStart,end:O.selectionEnd}:(O=(O.ownerDocument&&O.ownerDocument.defaultView||window).getSelection(),O={anchorNode:O.anchorNode,anchorOffset:O.anchorOffset,focusNode:O.focusNode,focusOffset:O.focusOffset}),ke&&Fh(ke,O)||(ke=O,O=Gf(Kv,"onSelect"),0<O.length&&(_=new kv("onSelect","select",null,_,w),p.push({event:_,listeners:O}),_.target=bu)))}function u_(p,_){var w={};return w[p.toLowerCase()]=_.toLowerCase(),w["Webkit"+p]="webkit"+_,w["Moz"+p]="moz"+_,w}var jh={animationend:u_("Animation","AnimationEnd"),animationiteration:u_("Animation","AnimationIteration"),animationstart:u_("Animation","AnimationStart"),transitionend:u_("Transition","TransitionEnd")},d_={},qv={};E&&(qv=document.createElement("div").style,"AnimationEvent"in window||(delete jh.animationend.animation,delete jh.animationiteration.animation,delete jh.animationstart.animation),"TransitionEvent"in window||delete jh.transitionend.transition);function h_(p){if(d_[p])return d_[p];if(!jh[p])return p;var _=jh[p],w;for(w in _)if(_.hasOwnProperty(w)&&w in qv)return d_[p]=_[w];return p}var bC=h_("animationend"),IC=h_("animationiteration"),Ff=h_("animationstart"),Bh=h_("transitionend"),AC=new Map,OC="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Wa(p,_){AC.set(p,_),d(_,[p])}for(var jf=0;jf<OC.length;jf++){var Wh=OC[jf],GN=Wh.toLowerCase(),HN=Wh[0].toUpperCase()+Wh.slice(1);Wa(GN,"on"+HN)}Wa(bC,"onAnimationEnd"),Wa(IC,"onAnimationIteration"),Wa(Ff,"onAnimationStart"),Wa("dblclick","onDoubleClick"),Wa("focusin","onFocus"),Wa("focusout","onBlur"),Wa(Bh,"onTransitionEnd"),f("onMouseEnter",["mouseout","mouseover"]),f("onMouseLeave",["mouseout","mouseover"]),f("onPointerEnter",["pointerout","pointerover"]),f("onPointerLeave",["pointerout","pointerover"]),d("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),d("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),d("onBeforeInput",["compositionend","keypress","textInput","paste"]),d("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Bf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),zN=new Set("cancel close invalid load scroll toggle".split(" ").concat(Bf));function p_(p,_,w){var O=p.type||"unknown-event";p.currentTarget=w,xt(O,_,void 0,p),p.currentTarget=null}function NC(p,_){_=(_&4)!==0;for(var w=0;w<p.length;w++){var O=p[w],U=O.event;O=O.listeners;e:{var G=void 0;if(_)for(var ee=O.length-1;0<=ee;ee--){var me=O[ee],ve=me.instance,Ke=me.currentTarget;if(me=me.listener,ve!==G&&U.isPropagationStopped())break e;p_(U,me,Ke),G=ve}else for(ee=0;ee<O.length;ee++){if(me=O[ee],ve=me.instance,Ke=me.currentTarget,me=me.listener,ve!==G&&U.isPropagationStopped())break e;p_(U,me,Ke),G=ve}}}if(Yt)throw p=hn,Yt=!1,hn=null,p}function Qr(p,_){var w=_[Zv];w===void 0&&(w=_[Zv]=new Set);var O=p+"__bubble";w.has(O)||(PC(_,p,2,!1),w.add(O))}function to(p,_,w){var O=0;_&&(O|=4),PC(w,p,O,_)}var f_="_reactListening"+Math.random().toString(36).slice(2);function yl(p){if(!p[f_]){p[f_]=!0,a.forEach(function(w){w!=="selectionchange"&&(zN.has(w)||to(w,!1,p),to(w,!0,p))});var _=p.nodeType===9?p:p.ownerDocument;_===null||_[f_]||(_[f_]=!0,to("selectionchange",!1,_))}}function PC(p,_,w,O){switch(lC(_)){case 1:var U=yN;break;case 4:U=Tu;break;default:U=So}w=U.bind(null,_,w,p),U=void 0,!Ee||_!=="touchstart"&&_!=="touchmove"&&_!=="wheel"||(U=!0),O?U!==void 0?p.addEventListener(_,w,{capture:!0,passive:U}):p.addEventListener(_,w,!0):U!==void 0?p.addEventListener(_,w,{passive:U}):p.addEventListener(_,w,!1)}function Xv(p,_,w,O,U){var G=O;if((_&1)===0&&(_&2)===0&&O!==null)e:for(;;){if(O===null)return;var ee=O.tag;if(ee===3||ee===4){var me=O.stateNode.containerInfo;if(me===U||me.nodeType===8&&me.parentNode===U)break;if(ee===4)for(ee=O.return;ee!==null;){var ve=ee.tag;if((ve===3||ve===4)&&(ve=ee.stateNode.containerInfo,ve===U||ve.nodeType===8&&ve.parentNode===U))return;ee=ee.return}for(;me!==null;){if(ee=xd(me),ee===null)return;if(ve=ee.tag,ve===5||ve===6){O=G=ee;continue e}me=me.parentNode}}O=O.return}Ls(function(){var Ke=G,ut=ia(w),ht=[];e:{var at=AC.get(p);if(at!==void 0){var bt=kv,Bt=p;switch(p){case"keypress":if(o_(w)===0)break e;case"keydown":case"keyup":bt=AN;break;case"focusin":Bt="focus",bt=Lv;break;case"focusout":Bt="blur",bt=Lv;break;case"beforeblur":case"afterblur":bt=Lv;break;case"click":if(w.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":bt=xh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":bt=SN;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":bt=NN;break;case bC:case IC:case Ff:bt=Lh;break;case Bh:bt=fC;break;case"scroll":bt=Dv;break;case"wheel":bt=Ru;break;case"copy":case"cut":case"paste":bt=Mh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":bt=pC}var Ht=(_&4)!==0,Wi=!Ht&&p==="scroll",Le=Ht?at!==null?at+"Capture":null:at;Ht=[];for(var we=Ke,Be;we!==null;){Be=we;var ft=Be.stateNode;if(Be.tag===5&&ft!==null&&(Be=ft,Le!==null&&(ft=kr(we,Le),ft!=null&&Ht.push(Wf(we,ft,Be)))),Wi)break;we=we.return}0<Ht.length&&(at=new bt(at,Bt,null,w,ut),ht.push({event:at,listeners:Ht}))}}if((_&7)===0){e:{if(at=p==="mouseover"||p==="pointerover",bt=p==="mouseout"||p==="pointerout",at&&w!==vi&&(Bt=w.relatedTarget||w.fromElement)&&(xd(Bt)||Bt[vl]))break e;if((bt||at)&&(at=ut.window===ut?ut:(at=ut.ownerDocument)?at.defaultView||at.parentWindow:window,bt?(Bt=w.relatedTarget||w.toElement,bt=Ke,Bt=Bt?xd(Bt):null,Bt!==null&&(Wi=Vt(Bt),Bt!==Wi||Bt.tag!==5&&Bt.tag!==6)&&(Bt=null)):(bt=null,Bt=Ke),bt!==Bt)){if(Ht=xh,ft="onMouseLeave",Le="onMouseEnter",we="mouse",(p==="pointerout"||p==="pointerover")&&(Ht=pC,ft="onPointerLeave",Le="onPointerEnter",we="pointer"),Wi=bt==null?at:zh(bt),Be=Bt==null?at:zh(Bt),at=new Ht(ft,we+"leave",bt,w,ut),at.target=Wi,at.relatedTarget=Be,ft=null,xd(ut)===Ke&&(Ht=new Ht(Le,we+"enter",Bt,w,ut),Ht.target=Be,Ht.relatedTarget=Wi,ft=Ht),Wi=ft,bt&&Bt)t:{for(Ht=bt,Le=Bt,we=0,Be=Ht;Be;Be=Gh(Be))we++;for(Be=0,ft=Le;ft;ft=Gh(ft))Be++;for(;0<we-Be;)Ht=Gh(Ht),we--;for(;0<Be-we;)Le=Gh(Le),Be--;for(;we--;){if(Ht===Le||Le!==null&&Ht===Le.alternate)break t;Ht=Gh(Ht),Le=Gh(Le)}Ht=null}else Ht=null;bt!==null&&kC(ht,at,bt,Ht,!1),Bt!==null&&Wi!==null&&kC(ht,Wi,Bt,Ht,!0)}}e:{if(at=Ke?zh(Ke):window,bt=at.nodeName&&at.nodeName.toLowerCase(),bt==="select"||bt==="input"&&at.type==="file")var qt=UN;else if(c_(at))if(Vf)qt=jN;else{qt=eo;var sn=VN}else(bt=at.nodeName)&&bt.toLowerCase()==="input"&&(at.type==="checkbox"||at.type==="radio")&&(qt=FN);if(qt&&(qt=qt(p,Ke))){yC(ht,qt,w,ut);break e}sn&&sn(p,at,Ke),p==="focusout"&&(sn=at._wrapperState)&&sn.controlled&&at.type==="number"&&fi(at,"number",at.value)}switch(sn=Ke?zh(Ke):window,p){case"focusin":(c_(sn)||sn.contentEditable==="true")&&(bu=sn,Kv=Ke,ke=null);break;case"focusout":ke=Kv=bu=null;break;case"mousedown":Yv=!0;break;case"contextmenu":case"mouseup":case"dragend":Yv=!1,RC(ht,w,ut);break;case"selectionchange":if(zv)break;case"keydown":case"keyup":RC(ht,w,ut)}var rn;if(Fv)e:{switch(p){case"compositionstart":var gn="onCompositionStart";break e;case"compositionend":gn="onCompositionEnd";break e;case"compositionupdate":gn="onCompositionUpdate";break e}gn=void 0}else Uh?EC(p,w)&&(gn="onCompositionEnd"):p==="keydown"&&w.keyCode===229&&(gn="onCompositionStart");gn&&(a_&&w.locale!=="ko"&&(Uh||gn!=="onCompositionStart"?gn==="onCompositionEnd"&&Uh&&(rn=uC()):(wu=ut,Is="value"in wu?wu.value:wu.textContent,Uh=!0)),sn=Gf(Ke,gn),0<sn.length&&(gn=new hC(gn,p,null,w,ut),ht.push({event:gn,listeners:sn}),rn?gn.data=rn:(rn=To(w),rn!==null&&(gn.data=rn)))),(rn=mC?xN(p,w):LN(p,w))&&(Ke=Gf(Ke,"onBeforeInput"),0<Ke.length&&(ut=new hC("onBeforeInput","beforeinput",null,w,ut),ht.push({event:ut,listeners:Ke}),ut.data=rn))}NC(ht,_)})}function Wf(p,_,w){return{instance:p,listener:_,currentTarget:w}}function Gf(p,_){for(var w=_+"Capture",O=[];p!==null;){var U=p,G=U.stateNode;U.tag===5&&G!==null&&(U=G,G=kr(p,w),G!=null&&O.unshift(Wf(p,G,U)),G=kr(p,_),G!=null&&O.push(Wf(p,G,U))),p=p.return}return O}function Gh(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function kC(p,_,w,O,U){for(var G=_._reactName,ee=[];w!==null&&w!==O;){var me=w,ve=me.alternate,Ke=me.stateNode;if(ve!==null&&ve===O)break;me.tag===5&&Ke!==null&&(me=Ke,U?(ve=kr(w,G),ve!=null&&ee.unshift(Wf(w,ve,me))):U||(ve=kr(w,G),ve!=null&&ee.push(Wf(w,ve,me)))),w=w.return}ee.length!==0&&p.push({event:_,listeners:ee})}var KN=/\r\n?/g,Jv=/\u0000|\uFFFD/g;function DC(p){return(typeof p=="string"?p:""+p).replace(KN,`
`).replace(Jv,"")}function Hf(p,_,w){if(_=DC(_),DC(p)!==_&&w)throw Error(s(425))}function zf(){}var $v=null,m_=null;function Hh(p,_){return p==="textarea"||p==="noscript"||typeof _.children=="string"||typeof _.children=="number"||typeof _.dangerouslySetInnerHTML=="object"&&_.dangerouslySetInnerHTML!==null&&_.dangerouslySetInnerHTML.__html!=null}var Qv=typeof setTimeout=="function"?setTimeout:void 0,YN=typeof clearTimeout=="function"?clearTimeout:void 0,xC=typeof Promise=="function"?Promise:void 0,qN=typeof queueMicrotask=="function"?queueMicrotask:typeof xC<"u"?function(p){return xC.resolve(null).then(p).catch(XN)}:Qv;function XN(p){setTimeout(function(){throw p})}function g_(p,_){var w=_,O=0;do{var U=w.nextSibling;if(p.removeChild(w),U&&U.nodeType===8)if(w=U.data,w==="/$"){if(O===0){p.removeChild(U),kh(_);return}O--}else w!=="$"&&w!=="$?"&&w!=="$!"||O++;w=U}while(w);kh(_)}function Ac(p){for(;p!=null;p=p.nextSibling){var _=p.nodeType;if(_===1||_===3)break;if(_===8){if(_=p.data,_==="$"||_==="$!"||_==="$?")break;if(_==="/$")return null}}return p}function LC(p){p=p.previousSibling;for(var _=0;p;){if(p.nodeType===8){var w=p.data;if(w==="$"||w==="$!"||w==="$?"){if(_===0)return p;_--}else w==="/$"&&_++}p=p.previousSibling}return null}var Iu=Math.random().toString(36).slice(2),Oc="__reactFiber$"+Iu,Kf="__reactProps$"+Iu,vl="__reactContainer$"+Iu,Zv="__reactEvents$"+Iu,JN="__reactListeners$"+Iu,$N="__reactHandles$"+Iu;function xd(p){var _=p[Oc];if(_)return _;for(var w=p.parentNode;w;){if(_=w[vl]||w[Oc]){if(w=_.alternate,_.child!==null||w!==null&&w.child!==null)for(p=LC(p);p!==null;){if(w=p[Oc])return w;p=LC(p)}return _}p=w,w=p.parentNode}return null}function Yf(p){return p=p[Oc]||p[vl],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function zh(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(s(33))}function __(p){return p[Kf]||null}var eS=[],Sl=-1;function Ga(p){return{current:p}}function Hr(p){0>Sl||(p.current=eS[Sl],eS[Sl]=null,Sl--)}function Zr(p,_){Sl++,eS[Sl]=p.current,p.current=_}var Au={},Ms=Ga(Au),no=Ga(!1),Ou=Au;function Nu(p,_){var w=p.type.contextTypes;if(!w)return Au;var O=p.stateNode;if(O&&O.__reactInternalMemoizedUnmaskedChildContext===_)return O.__reactInternalMemoizedMaskedChildContext;var U={},G;for(G in w)U[G]=_[G];return O&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=_,p.__reactInternalMemoizedMaskedChildContext=U),U}function wo(p){return p=p.childContextTypes,p!=null}function E_(){Hr(no),Hr(Ms)}function Kh(p,_,w){if(Ms.current!==Au)throw Error(s(168));Zr(Ms,_),Zr(no,w)}function MC(p,_,w){var O=p.stateNode;if(_=_.childContextTypes,typeof O.getChildContext!="function")return w;O=O.getChildContext();for(var U in O)if(!(U in _))throw Error(s(108,At(p)||"Unknown",U));return re({},w,O)}function y_(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||Au,Ou=Ms.current,Zr(Ms,p),Zr(no,no.current),!0}function UC(p,_,w){var O=p.stateNode;if(!O)throw Error(s(169));w?(p=MC(p,_,Ou),O.__reactInternalMemoizedMergedChildContext=p,Hr(no),Hr(Ms),Zr(Ms,p)):Hr(no),Zr(no,w)}var Tl=null,v_=!1,tS=!1;function nS(p){Tl===null?Tl=[p]:Tl.push(p)}function QN(p){v_=!0,nS(p)}function Pu(){if(!tS&&Tl!==null){tS=!0;var p=0,_=Tr;try{var w=Tl;for(Tr=1;p<w.length;p++){var O=w[p];do O=O(!0);while(O!==null)}Tl=null,v_=!1}catch(U){throw Tl!==null&&(Tl=Tl.slice(p+1)),Ar(Ur,Pu),U}finally{Tr=_,tS=!1}}return null}var Yh=[],ku=0,S_=null,T_=0,ro=[],oa=0,Ld=null,wl=1,Cl="";function Md(p,_){Yh[ku++]=T_,Yh[ku++]=S_,S_=p,T_=_}function VC(p,_,w){ro[oa++]=wl,ro[oa++]=Cl,ro[oa++]=Ld,Ld=p;var O=wl;p=Cl;var U=32-_r(O)-1;O&=~(1<<U),w+=1;var G=32-_r(_)+U;if(30<G){var ee=U-U%5;G=(O&(1<<ee)-1).toString(32),O>>=ee,U-=ee,wl=1<<32-_r(_)+U|w<<U|O,Cl=G+p}else wl=1<<G|w<<U|O,Cl=p}function qh(p){p.return!==null&&(Md(p,1),VC(p,1,0))}function w_(p){for(;p===S_;)S_=Yh[--ku],Yh[ku]=null,T_=Yh[--ku],Yh[ku]=null;for(;p===Ld;)Ld=ro[--oa],ro[oa]=null,Cl=ro[--oa],ro[oa]=null,wl=ro[--oa],ro[oa]=null}var Wo=null,Go=null,si=!1,Ha=null;function FC(p,_){var w=da(5,null,null,0);w.elementType="DELETED",w.stateNode=_,w.return=p,_=p.deletions,_===null?(p.deletions=[w],p.flags|=16):_.push(w)}function jC(p,_){switch(p.tag){case 5:var w=p.type;return _=_.nodeType!==1||w.toLowerCase()!==_.nodeName.toLowerCase()?null:_,_!==null?(p.stateNode=_,Wo=p,Go=Ac(_.firstChild),!0):!1;case 6:return _=p.pendingProps===""||_.nodeType!==3?null:_,_!==null?(p.stateNode=_,Wo=p,Go=null,!0):!1;case 13:return _=_.nodeType!==8?null:_,_!==null?(w=Ld!==null?{id:wl,overflow:Cl}:null,p.memoizedState={dehydrated:_,treeContext:w,retryLane:1073741824},w=da(18,null,null,0),w.stateNode=_,w.return=p,p.child=w,Wo=p,Go=null,!0):!1;default:return!1}}function qf(p){return(p.mode&1)!==0&&(p.flags&128)===0}function Xf(p){if(si){var _=Go;if(_){var w=_;if(!jC(p,_)){if(qf(p))throw Error(s(418));_=Ac(w.nextSibling);var O=Wo;_&&jC(p,_)?FC(O,w):(p.flags=p.flags&-4097|2,si=!1,Wo=p)}}else{if(qf(p))throw Error(s(418));p.flags=p.flags&-4097|2,si=!1,Wo=p}}}function rS(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;Wo=p}function Xh(p){if(p!==Wo)return!1;if(!si)return rS(p),si=!0,!1;var _;if((_=p.tag!==3)&&!(_=p.tag!==5)&&(_=p.type,_=_!=="head"&&_!=="body"&&!Hh(p.type,p.memoizedProps)),_&&(_=Go)){if(qf(p))throw iS(),Error(s(418));for(;_;)FC(p,_),_=Ac(_.nextSibling)}if(rS(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(s(317));e:{for(p=p.nextSibling,_=0;p;){if(p.nodeType===8){var w=p.data;if(w==="/$"){if(_===0){Go=Ac(p.nextSibling);break e}_--}else w!=="$"&&w!=="$!"&&w!=="$?"||_++}p=p.nextSibling}Go=null}}else Go=Wo?Ac(p.stateNode.nextSibling):null;return!0}function iS(){for(var p=Go;p;)p=Ac(p.nextSibling)}function Ud(){Go=Wo=null,si=!1}function Jh(p){Ha===null?Ha=[p]:Ha.push(p)}var Jf=ae.ReactCurrentBatchConfig;function $f(p,_,w){if(p=w.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(w._owner){if(w=w._owner,w){if(w.tag!==1)throw Error(s(309));var O=w.stateNode}if(!O)throw Error(s(147,p));var U=O,G=""+p;return _!==null&&_.ref!==null&&typeof _.ref=="function"&&_.ref._stringRef===G?_.ref:(_=function(ee){var me=U.refs;ee===null?delete me[G]:me[G]=ee},_._stringRef=G,_)}if(typeof p!="string")throw Error(s(284));if(!w._owner)throw Error(s(290,p))}return p}function C_(p,_){throw p=Object.prototype.toString.call(_),Error(s(31,p==="[object Object]"?"object with keys {"+Object.keys(_).join(", ")+"}":p))}function sS(p){var _=p._init;return _(p._payload)}function BC(p){function _(Le,we){if(p){var Be=Le.deletions;Be===null?(Le.deletions=[we],Le.flags|=16):Be.push(we)}}function w(Le,we){if(!p)return null;for(;we!==null;)_(Le,we),we=we.sibling;return null}function O(Le,we){for(Le=new Map;we!==null;)we.key!==null?Le.set(we.key,we):Le.set(we.index,we),we=we.sibling;return Le}function U(Le,we){return Le=Hu(Le,we),Le.index=0,Le.sibling=null,Le}function G(Le,we,Be){return Le.index=Be,p?(Be=Le.alternate,Be!==null?(Be=Be.index,Be<we?(Le.flags|=2,we):Be):(Le.flags|=2,we)):(Le.flags|=1048576,we)}function ee(Le){return p&&Le.alternate===null&&(Le.flags|=2),Le}function me(Le,we,Be,ft){return we===null||we.tag!==6?(we=eE(Be,Le.mode,ft),we.return=Le,we):(we=U(we,Be),we.return=Le,we)}function ve(Le,we,Be,ft){var qt=Be.type;return qt===ne?ut(Le,we,Be.props.children,ft,Be.key):we!==null&&(we.elementType===qt||typeof qt=="object"&&qt!==null&&qt.$$typeof===Je&&sS(qt)===we.type)?(ft=U(we,Be.props),ft.ref=$f(Le,we,Be),ft.return=Le,ft):(ft=cp(Be.type,Be.key,Be.props,null,Le.mode,ft),ft.ref=$f(Le,we,Be),ft.return=Le,ft)}function Ke(Le,we,Be,ft){return we===null||we.tag!==4||we.stateNode.containerInfo!==Be.containerInfo||we.stateNode.implementation!==Be.implementation?(we=lp(Be,Le.mode,ft),we.return=Le,we):(we=U(we,Be.children||[]),we.return=Le,we)}function ut(Le,we,Be,ft,qt){return we===null||we.tag!==7?(we=zu(Be,Le.mode,ft,qt),we.return=Le,we):(we=U(we,Be),we.return=Le,we)}function ht(Le,we,Be){if(typeof we=="string"&&we!==""||typeof we=="number")return we=eE(""+we,Le.mode,Be),we.return=Le,we;if(typeof we=="object"&&we!==null){switch(we.$$typeof){case ce:return Be=cp(we.type,we.key,we.props,null,Le.mode,Be),Be.ref=$f(Le,null,we),Be.return=Le,Be;case le:return we=lp(we,Le.mode,Be),we.return=Le,we;case Je:var ft=we._init;return ht(Le,ft(we._payload),Be)}if($s(we)||He(we))return we=zu(we,Le.mode,Be,null),we.return=Le,we;C_(Le,we)}return null}function at(Le,we,Be,ft){var qt=we!==null?we.key:null;if(typeof Be=="string"&&Be!==""||typeof Be=="number")return qt!==null?null:me(Le,we,""+Be,ft);if(typeof Be=="object"&&Be!==null){switch(Be.$$typeof){case ce:return Be.key===qt?ve(Le,we,Be,ft):null;case le:return Be.key===qt?Ke(Le,we,Be,ft):null;case Je:return qt=Be._init,at(Le,we,qt(Be._payload),ft)}if($s(Be)||He(Be))return qt!==null?null:ut(Le,we,Be,ft,null);C_(Le,Be)}return null}function bt(Le,we,Be,ft,qt){if(typeof ft=="string"&&ft!==""||typeof ft=="number")return Le=Le.get(Be)||null,me(we,Le,""+ft,qt);if(typeof ft=="object"&&ft!==null){switch(ft.$$typeof){case ce:return Le=Le.get(ft.key===null?Be:ft.key)||null,ve(we,Le,ft,qt);case le:return Le=Le.get(ft.key===null?Be:ft.key)||null,Ke(we,Le,ft,qt);case Je:var sn=ft._init;return bt(Le,we,Be,sn(ft._payload),qt)}if($s(ft)||He(ft))return Le=Le.get(Be)||null,ut(we,Le,ft,qt,null);C_(we,ft)}return null}function Bt(Le,we,Be,ft){for(var qt=null,sn=null,rn=we,gn=we=0,ds=null;rn!==null&&gn<Be.length;gn++){rn.index>gn?(ds=rn,rn=null):ds=rn.sibling;var or=at(Le,rn,Be[gn],ft);if(or===null){rn===null&&(rn=ds);break}p&&rn&&or.alternate===null&&_(Le,rn),we=G(or,we,gn),sn===null?qt=or:sn.sibling=or,sn=or,rn=ds}if(gn===Be.length)return w(Le,rn),si&&Md(Le,gn),qt;if(rn===null){for(;gn<Be.length;gn++)rn=ht(Le,Be[gn],ft),rn!==null&&(we=G(rn,we,gn),sn===null?qt=rn:sn.sibling=rn,sn=rn);return si&&Md(Le,gn),qt}for(rn=O(Le,rn);gn<Be.length;gn++)ds=bt(rn,Le,gn,Be[gn],ft),ds!==null&&(p&&ds.alternate!==null&&rn.delete(ds.key===null?gn:ds.key),we=G(ds,we,gn),sn===null?qt=ds:sn.sibling=ds,sn=ds);return p&&rn.forEach(function(Dl){return _(Le,Dl)}),si&&Md(Le,gn),qt}function Ht(Le,we,Be,ft){var qt=He(Be);if(typeof qt!="function")throw Error(s(150));if(Be=qt.call(Be),Be==null)throw Error(s(151));for(var sn=qt=null,rn=we,gn=we=0,ds=null,or=Be.next();rn!==null&&!or.done;gn++,or=Be.next()){rn.index>gn?(ds=rn,rn=null):ds=rn.sibling;var Dl=at(Le,rn,or.value,ft);if(Dl===null){rn===null&&(rn=ds);break}p&&rn&&Dl.alternate===null&&_(Le,rn),we=G(Dl,we,gn),sn===null?qt=Dl:sn.sibling=Dl,sn=Dl,rn=ds}if(or.done)return w(Le,rn),si&&Md(Le,gn),qt;if(rn===null){for(;!or.done;gn++,or=Be.next())or=ht(Le,or.value,ft),or!==null&&(we=G(or,we,gn),sn===null?qt=or:sn.sibling=or,sn=or);return si&&Md(Le,gn),qt}for(rn=O(Le,rn);!or.done;gn++,or=Be.next())or=bt(rn,Le,gn,or.value,ft),or!==null&&(p&&or.alternate!==null&&rn.delete(or.key===null?gn:or.key),we=G(or,we,gn),sn===null?qt=or:sn.sibling=or,sn=or);return p&&rn.forEach(function(mP){return _(Le,mP)}),si&&Md(Le,gn),qt}function Wi(Le,we,Be,ft){if(typeof Be=="object"&&Be!==null&&Be.type===ne&&Be.key===null&&(Be=Be.props.children),typeof Be=="object"&&Be!==null){switch(Be.$$typeof){case ce:e:{for(var qt=Be.key,sn=we;sn!==null;){if(sn.key===qt){if(qt=Be.type,qt===ne){if(sn.tag===7){w(Le,sn.sibling),we=U(sn,Be.props.children),we.return=Le,Le=we;break e}}else if(sn.elementType===qt||typeof qt=="object"&&qt!==null&&qt.$$typeof===Je&&sS(qt)===sn.type){w(Le,sn.sibling),we=U(sn,Be.props),we.ref=$f(Le,sn,Be),we.return=Le,Le=we;break e}w(Le,sn);break}else _(Le,sn);sn=sn.sibling}Be.type===ne?(we=zu(Be.props.children,Le.mode,ft,Be.key),we.return=Le,Le=we):(ft=cp(Be.type,Be.key,Be.props,null,Le.mode,ft),ft.ref=$f(Le,we,Be),ft.return=Le,Le=ft)}return ee(Le);case le:e:{for(sn=Be.key;we!==null;){if(we.key===sn)if(we.tag===4&&we.stateNode.containerInfo===Be.containerInfo&&we.stateNode.implementation===Be.implementation){w(Le,we.sibling),we=U(we,Be.children||[]),we.return=Le,Le=we;break e}else{w(Le,we);break}else _(Le,we);we=we.sibling}we=lp(Be,Le.mode,ft),we.return=Le,Le=we}return ee(Le);case Je:return sn=Be._init,Wi(Le,we,sn(Be._payload),ft)}if($s(Be))return Bt(Le,we,Be,ft);if(He(Be))return Ht(Le,we,Be,ft);C_(Le,Be)}return typeof Be=="string"&&Be!==""||typeof Be=="number"?(Be=""+Be,we!==null&&we.tag===6?(w(Le,we.sibling),we=U(we,Be),we.return=Le,Le=we):(w(Le,we),we=eE(Be,Le.mode,ft),we.return=Le,Le=we),ee(Le)):w(Le,we)}return Wi}var $h=BC(!0),oS=BC(!1),R_=Ga(null),b_=null,Qh=null,aS=null;function cS(){aS=Qh=b_=null}function lS(p){var _=R_.current;Hr(R_),p._currentValue=_}function I_(p,_,w){for(;p!==null;){var O=p.alternate;if((p.childLanes&_)!==_?(p.childLanes|=_,O!==null&&(O.childLanes|=_)):O!==null&&(O.childLanes&_)!==_&&(O.childLanes|=_),p===w)break;p=p.return}}function za(p,_){b_=p,aS=Qh=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&_)!==0&&(Ro=!0),p.firstContext=null)}function aa(p){var _=p._currentValue;if(aS!==p)if(p={context:p,memoizedValue:_,next:null},Qh===null){if(b_===null)throw Error(s(308));Qh=p,b_.dependencies={lanes:0,firstContext:p}}else Qh=Qh.next=p;return _}var Vd=null;function uS(p){Vd===null?Vd=[p]:Vd.push(p)}function dS(p,_,w,O){var U=_.interleaved;return U===null?(w.next=w,uS(_)):(w.next=U.next,U.next=w),_.interleaved=w,Rl(p,O)}function Rl(p,_){p.lanes|=_;var w=p.alternate;for(w!==null&&(w.lanes|=_),w=p,p=p.return;p!==null;)p.childLanes|=_,w=p.alternate,w!==null&&(w.childLanes|=_),w=p,p=p.return;return w.tag===3?w.stateNode:null}var bl=!1;function hS(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function WC(p,_){p=p.updateQueue,_.updateQueue===p&&(_.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function Il(p,_){return{eventTime:p,lane:_,tag:0,payload:null,callback:null,next:null}}function Ka(p,_,w){var O=p.updateQueue;if(O===null)return null;if(O=O.shared,(qn&2)!==0){var U=O.pending;return U===null?_.next=_:(_.next=U.next,U.next=_),O.pending=_,Rl(p,w)}return U=O.interleaved,U===null?(_.next=_,uS(O)):(_.next=U.next,U.next=_),O.interleaved=_,Rl(p,w)}function A_(p,_,w){if(_=_.updateQueue,_!==null&&(_=_.shared,(w&4194240)!==0)){var O=_.lanes;O&=p.pendingLanes,w|=O,_.lanes=w,Rv(p,w)}}function GC(p,_){var w=p.updateQueue,O=p.alternate;if(O!==null&&(O=O.updateQueue,w===O)){var U=null,G=null;if(w=w.firstBaseUpdate,w!==null){do{var ee={eventTime:w.eventTime,lane:w.lane,tag:w.tag,payload:w.payload,callback:w.callback,next:null};G===null?U=G=ee:G=G.next=ee,w=w.next}while(w!==null);G===null?U=G=_:G=G.next=_}else U=G=_;w={baseState:O.baseState,firstBaseUpdate:U,lastBaseUpdate:G,shared:O.shared,effects:O.effects},p.updateQueue=w;return}p=w.lastBaseUpdate,p===null?w.firstBaseUpdate=_:p.next=_,w.lastBaseUpdate=_}function O_(p,_,w,O){var U=p.updateQueue;bl=!1;var G=U.firstBaseUpdate,ee=U.lastBaseUpdate,me=U.shared.pending;if(me!==null){U.shared.pending=null;var ve=me,Ke=ve.next;ve.next=null,ee===null?G=Ke:ee.next=Ke,ee=ve;var ut=p.alternate;ut!==null&&(ut=ut.updateQueue,me=ut.lastBaseUpdate,me!==ee&&(me===null?ut.firstBaseUpdate=Ke:me.next=Ke,ut.lastBaseUpdate=ve))}if(G!==null){var ht=U.baseState;ee=0,ut=Ke=ve=null,me=G;do{var at=me.lane,bt=me.eventTime;if((O&at)===at){ut!==null&&(ut=ut.next={eventTime:bt,lane:0,tag:me.tag,payload:me.payload,callback:me.callback,next:null});e:{var Bt=p,Ht=me;switch(at=_,bt=w,Ht.tag){case 1:if(Bt=Ht.payload,typeof Bt=="function"){ht=Bt.call(bt,ht,at);break e}ht=Bt;break e;case 3:Bt.flags=Bt.flags&-65537|128;case 0:if(Bt=Ht.payload,at=typeof Bt=="function"?Bt.call(bt,ht,at):Bt,at==null)break e;ht=re({},ht,at);break e;case 2:bl=!0}}me.callback!==null&&me.lane!==0&&(p.flags|=64,at=U.effects,at===null?U.effects=[me]:at.push(me))}else bt={eventTime:bt,lane:at,tag:me.tag,payload:me.payload,callback:me.callback,next:null},ut===null?(Ke=ut=bt,ve=ht):ut=ut.next=bt,ee|=at;if(me=me.next,me===null){if(me=U.shared.pending,me===null)break;at=me,me=at.next,at.next=null,U.lastBaseUpdate=at,U.shared.pending=null}}while(!0);if(ut===null&&(ve=ht),U.baseState=ve,U.firstBaseUpdate=Ke,U.lastBaseUpdate=ut,_=U.shared.interleaved,_!==null){U=_;do ee|=U.lane,U=U.next;while(U!==_)}else G===null&&(U.shared.lanes=0);Kd|=ee,p.lanes=ee,p.memoizedState=ht}}function HC(p,_,w){if(p=_.effects,_.effects=null,p!==null)for(_=0;_<p.length;_++){var O=p[_],U=O.callback;if(U!==null){if(O.callback=null,O=w,typeof U!="function")throw Error(s(191,U));U.call(O)}}}var Qf={},Nc=Ga(Qf),Fd=Ga(Qf),Zf=Ga(Qf);function Du(p){if(p===Qf)throw Error(s(174));return p}function pS(p,_){switch(Zr(Zf,_),Zr(Fd,p),Zr(Nc,Qf),p=_.nodeType,p){case 9:case 11:_=(_=_.documentElement)?_.namespaceURI:lt(null,"");break;default:p=p===8?_.parentNode:_,_=p.namespaceURI||null,p=p.tagName,_=lt(_,p)}Hr(Nc),Zr(Nc,_)}function jd(){Hr(Nc),Hr(Fd),Hr(Zf)}function zC(p){Du(Zf.current);var _=Du(Nc.current),w=lt(_,p.type);_!==w&&(Zr(Fd,p),Zr(Nc,w))}function fS(p){Fd.current===p&&(Hr(Nc),Hr(Fd))}var Si=Ga(0);function N_(p){for(var _=p;_!==null;){if(_.tag===13){var w=_.memoizedState;if(w!==null&&(w=w.dehydrated,w===null||w.data==="$?"||w.data==="$!"))return _}else if(_.tag===19&&_.memoizedProps.revealOrder!==void 0){if((_.flags&128)!==0)return _}else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===p)break;for(;_.sibling===null;){if(_.return===null||_.return===p)return null;_=_.return}_.sibling.return=_.return,_=_.sibling}return null}var mS=[];function gS(){for(var p=0;p<mS.length;p++)mS[p]._workInProgressVersionPrimary=null;mS.length=0}var em=ae.ReactCurrentDispatcher,_S=ae.ReactCurrentBatchConfig,Bd=0,gi=null,cs=null,ji=null,tm=!1,Al=!1,nm=0,ZN=0;function Us(){throw Error(s(321))}function ES(p,_){if(_===null)return!1;for(var w=0;w<_.length&&w<p.length;w++)if(!Ba(p[w],_[w]))return!1;return!0}function Zh(p,_,w,O,U,G){if(Bd=G,gi=_,_.memoizedState=null,_.updateQueue=null,_.lanes=0,em.current=p===null||p.memoizedState===null?tP:eR,p=w(O,U),Al){G=0;do{if(Al=!1,nm=0,25<=G)throw Error(s(301));G+=1,ji=cs=null,_.updateQueue=null,em.current=nP,p=w(O,U)}while(Al)}if(em.current=tp,_=cs!==null&&cs.next!==null,Bd=0,ji=cs=gi=null,tm=!1,_)throw Error(s(300));return p}function yS(){var p=nm!==0;return nm=0,p}function Ya(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ji===null?gi.memoizedState=ji=p:ji=ji.next=p,ji}function Co(){if(cs===null){var p=gi.alternate;p=p!==null?p.memoizedState:null}else p=cs.next;var _=ji===null?gi.memoizedState:ji.next;if(_!==null)ji=_,cs=p;else{if(p===null)throw Error(s(310));cs=p,p={memoizedState:cs.memoizedState,baseState:cs.baseState,baseQueue:cs.baseQueue,queue:cs.queue,next:null},ji===null?gi.memoizedState=ji=p:ji=ji.next=p}return ji}function Wd(p,_){return typeof _=="function"?_(p):_}function vS(p){var _=Co(),w=_.queue;if(w===null)throw Error(s(311));w.lastRenderedReducer=p;var O=cs,U=O.baseQueue,G=w.pending;if(G!==null){if(U!==null){var ee=U.next;U.next=G.next,G.next=ee}O.baseQueue=U=G,w.pending=null}if(U!==null){G=U.next,O=O.baseState;var me=ee=null,ve=null,Ke=G;do{var ut=Ke.lane;if((Bd&ut)===ut)ve!==null&&(ve=ve.next={lane:0,action:Ke.action,hasEagerState:Ke.hasEagerState,eagerState:Ke.eagerState,next:null}),O=Ke.hasEagerState?Ke.eagerState:p(O,Ke.action);else{var ht={lane:ut,action:Ke.action,hasEagerState:Ke.hasEagerState,eagerState:Ke.eagerState,next:null};ve===null?(me=ve=ht,ee=O):ve=ve.next=ht,gi.lanes|=ut,Kd|=ut}Ke=Ke.next}while(Ke!==null&&Ke!==G);ve===null?ee=O:ve.next=me,Ba(O,_.memoizedState)||(Ro=!0),_.memoizedState=O,_.baseState=ee,_.baseQueue=ve,w.lastRenderedState=O}if(p=w.interleaved,p!==null){U=p;do G=U.lane,gi.lanes|=G,Kd|=G,U=U.next;while(U!==p)}else U===null&&(w.lanes=0);return[_.memoizedState,w.dispatch]}function SS(p){var _=Co(),w=_.queue;if(w===null)throw Error(s(311));w.lastRenderedReducer=p;var O=w.dispatch,U=w.pending,G=_.memoizedState;if(U!==null){w.pending=null;var ee=U=U.next;do G=p(G,ee.action),ee=ee.next;while(ee!==U);Ba(G,_.memoizedState)||(Ro=!0),_.memoizedState=G,_.baseQueue===null&&(_.baseState=G),w.lastRenderedState=G}return[G,O]}function KC(){}function YC(p,_){var w=gi,O=Co(),U=_(),G=!Ba(O.memoizedState,U);if(G&&(O.memoizedState=U,Ro=!0),O=O.queue,D_(XC.bind(null,w,O,p),[p]),O.getSnapshot!==_||G||ji!==null&&ji.memoizedState.tag&1){if(w.flags|=2048,Ol(9,rm.bind(null,w,O,U,_),void 0,null),ls===null)throw Error(s(349));(Bd&30)!==0||qC(w,_,U)}return U}function qC(p,_,w){p.flags|=16384,p={getSnapshot:_,value:w},_=gi.updateQueue,_===null?(_={lastEffect:null,stores:null},gi.updateQueue=_,_.stores=[p]):(w=_.stores,w===null?_.stores=[p]:w.push(p))}function rm(p,_,w,O){_.value=w,_.getSnapshot=O,Gd(_)&&P_(p)}function XC(p,_,w){return w(function(){Gd(_)&&P_(p)})}function Gd(p){var _=p.getSnapshot;p=p.value;try{var w=_();return!Ba(p,w)}catch{return!0}}function P_(p){var _=Rl(p,1);_!==null&&Ko(_,p,1,-1)}function im(p){var _=Ya();return typeof p=="function"&&(p=p()),_.memoizedState=_.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Wd,lastRenderedState:p},_.queue=p,p=p.dispatch=Hd.bind(null,gi,p),[_.memoizedState,p]}function Ol(p,_,w,O){return p={tag:p,create:_,destroy:w,deps:O,next:null},_=gi.updateQueue,_===null?(_={lastEffect:null,stores:null},gi.updateQueue=_,_.lastEffect=p.next=p):(w=_.lastEffect,w===null?_.lastEffect=p.next=p:(O=w.next,w.next=p,p.next=O,_.lastEffect=p)),p}function sm(){return Co().memoizedState}function k_(p,_,w,O){var U=Ya();gi.flags|=p,U.memoizedState=Ol(1|_,w,void 0,O===void 0?null:O)}function om(p,_,w,O){var U=Co();O=O===void 0?null:O;var G=void 0;if(cs!==null){var ee=cs.memoizedState;if(G=ee.destroy,O!==null&&ES(O,ee.deps)){U.memoizedState=Ol(_,w,G,O);return}}gi.flags|=p,U.memoizedState=Ol(1|_,w,G,O)}function JC(p,_){return k_(8390656,8,p,_)}function D_(p,_){return om(2048,8,p,_)}function $C(p,_){return om(4,2,p,_)}function QC(p,_){return om(4,4,p,_)}function x_(p,_){if(typeof _=="function")return p=p(),_(p),function(){_(null)};if(_!=null)return p=p(),_.current=p,function(){_.current=null}}function L_(p,_,w){return w=w!=null?w.concat([p]):null,om(4,4,x_.bind(null,_,p),w)}function TS(){}function ZC(p,_){var w=Co();_=_===void 0?null:_;var O=w.memoizedState;return O!==null&&_!==null&&ES(_,O[1])?O[0]:(w.memoizedState=[p,_],p)}function wS(p,_){var w=Co();_=_===void 0?null:_;var O=w.memoizedState;return O!==null&&_!==null&&ES(_,O[1])?O[0]:(p=p(),w.memoizedState=[p,_],p)}function M_(p,_,w){return(Bd&21)===0?(p.baseState&&(p.baseState=!1,Ro=!0),p.memoizedState=w):(Ba(w,_)||(w=iC(),gi.lanes|=w,Kd|=w,p.baseState=!0),_)}function eP(p,_){var w=Tr;Tr=w!==0&&4>w?w:4,p(!0);var O=_S.transition;_S.transition={};try{p(!1),_()}finally{Tr=w,_S.transition=O}}function qa(){return Co().memoizedState}function ep(p,_,w){var O=ju(p);if(w={lane:O,action:w,hasEagerState:!1,eagerState:null,next:null},CS(p))RS(_,w);else if(w=dS(p,_,w,O),w!==null){var U=so();Ko(w,p,O,U),xu(w,_,O)}}function Hd(p,_,w){var O=ju(p),U={lane:O,action:w,hasEagerState:!1,eagerState:null,next:null};if(CS(p))RS(_,U);else{var G=p.alternate;if(p.lanes===0&&(G===null||G.lanes===0)&&(G=_.lastRenderedReducer,G!==null))try{var ee=_.lastRenderedState,me=G(ee,w);if(U.hasEagerState=!0,U.eagerState=me,Ba(me,ee)){var ve=_.interleaved;ve===null?(U.next=U,uS(_)):(U.next=ve.next,ve.next=U),_.interleaved=U;return}}catch{}w=dS(p,_,U,O),w!==null&&(U=so(),Ko(w,p,O,U),xu(w,_,O))}}function CS(p){var _=p.alternate;return p===gi||_!==null&&_===gi}function RS(p,_){Al=tm=!0;var w=p.pending;w===null?_.next=_:(_.next=w.next,w.next=_),p.pending=_}function xu(p,_,w){if((w&4194240)!==0){var O=_.lanes;O&=p.pendingLanes,w|=O,_.lanes=w,Rv(p,w)}}var tp={readContext:aa,useCallback:Us,useContext:Us,useEffect:Us,useImperativeHandle:Us,useInsertionEffect:Us,useLayoutEffect:Us,useMemo:Us,useReducer:Us,useRef:Us,useState:Us,useDebugValue:Us,useDeferredValue:Us,useTransition:Us,useMutableSource:Us,useSyncExternalStore:Us,useId:Us,unstable_isNewReconciler:!1},tP={readContext:aa,useCallback:function(p,_){return Ya().memoizedState=[p,_===void 0?null:_],p},useContext:aa,useEffect:JC,useImperativeHandle:function(p,_,w){return w=w!=null?w.concat([p]):null,k_(4194308,4,x_.bind(null,_,p),w)},useLayoutEffect:function(p,_){return k_(4194308,4,p,_)},useInsertionEffect:function(p,_){return k_(4,2,p,_)},useMemo:function(p,_){var w=Ya();return _=_===void 0?null:_,p=p(),w.memoizedState=[p,_],p},useReducer:function(p,_,w){var O=Ya();return _=w!==void 0?w(_):_,O.memoizedState=O.baseState=_,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:_},O.queue=p,p=p.dispatch=ep.bind(null,gi,p),[O.memoizedState,p]},useRef:function(p){var _=Ya();return p={current:p},_.memoizedState=p},useState:im,useDebugValue:TS,useDeferredValue:function(p){return Ya().memoizedState=p},useTransition:function(){var p=im(!1),_=p[0];return p=eP.bind(null,p[1]),Ya().memoizedState=p,[_,p]},useMutableSource:function(){},useSyncExternalStore:function(p,_,w){var O=gi,U=Ya();if(si){if(w===void 0)throw Error(s(407));w=w()}else{if(w=_(),ls===null)throw Error(s(349));(Bd&30)!==0||qC(O,_,w)}U.memoizedState=w;var G={value:w,getSnapshot:_};return U.queue=G,JC(XC.bind(null,O,G,p),[p]),O.flags|=2048,Ol(9,rm.bind(null,O,G,w,_),void 0,null),w},useId:function(){var p=Ya(),_=ls.identifierPrefix;if(si){var w=Cl,O=wl;w=(O&~(1<<32-_r(O)-1)).toString(32)+w,_=":"+_+"R"+w,w=nm++,0<w&&(_+="H"+w.toString(32)),_+=":"}else w=ZN++,_=":"+_+"r"+w.toString(32)+":";return p.memoizedState=_},unstable_isNewReconciler:!1},eR={readContext:aa,useCallback:ZC,useContext:aa,useEffect:D_,useImperativeHandle:L_,useInsertionEffect:$C,useLayoutEffect:QC,useMemo:wS,useReducer:vS,useRef:sm,useState:function(){return vS(Wd)},useDebugValue:TS,useDeferredValue:function(p){var _=Co();return M_(_,cs.memoizedState,p)},useTransition:function(){var p=vS(Wd)[0],_=Co().memoizedState;return[p,_]},useMutableSource:KC,useSyncExternalStore:YC,useId:qa,unstable_isNewReconciler:!1},nP={readContext:aa,useCallback:ZC,useContext:aa,useEffect:D_,useImperativeHandle:L_,useInsertionEffect:$C,useLayoutEffect:QC,useMemo:wS,useReducer:SS,useRef:sm,useState:function(){return SS(Wd)},useDebugValue:TS,useDeferredValue:function(p){var _=Co();return cs===null?_.memoizedState=p:M_(_,cs.memoizedState,p)},useTransition:function(){var p=SS(Wd)[0],_=Co().memoizedState;return[p,_]},useMutableSource:KC,useSyncExternalStore:YC,useId:qa,unstable_isNewReconciler:!1};function ca(p,_){if(p&&p.defaultProps){_=re({},_),p=p.defaultProps;for(var w in p)_[w]===void 0&&(_[w]=p[w]);return _}return _}function U_(p,_,w,O){_=p.memoizedState,w=w(O,_),w=w==null?_:re({},_,w),p.memoizedState=w,p.lanes===0&&(p.updateQueue.baseState=w)}var V_={isMounted:function(p){return(p=p._reactInternals)?Vt(p)===p:!1},enqueueSetState:function(p,_,w){p=p._reactInternals;var O=so(),U=ju(p),G=Il(O,U);G.payload=_,w!=null&&(G.callback=w),_=Ka(p,G,U),_!==null&&(Ko(_,p,U,O),A_(_,p,U))},enqueueReplaceState:function(p,_,w){p=p._reactInternals;var O=so(),U=ju(p),G=Il(O,U);G.tag=1,G.payload=_,w!=null&&(G.callback=w),_=Ka(p,G,U),_!==null&&(Ko(_,p,U,O),A_(_,p,U))},enqueueForceUpdate:function(p,_){p=p._reactInternals;var w=so(),O=ju(p),U=Il(w,O);U.tag=2,_!=null&&(U.callback=_),_=Ka(p,U,O),_!==null&&(Ko(_,p,O,w),A_(_,p,O))}};function Nl(p,_,w,O,U,G,ee){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(O,G,ee):_.prototype&&_.prototype.isPureReactComponent?!Fh(w,O)||!Fh(U,G):!0}function tR(p,_,w){var O=!1,U=Au,G=_.contextType;return typeof G=="object"&&G!==null?G=aa(G):(U=wo(_)?Ou:Ms.current,O=_.contextTypes,G=(O=O!=null)?Nu(p,U):Au),_=new _(w,G),p.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,_.updater=V_,p.stateNode=_,_._reactInternals=p,O&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=U,p.__reactInternalMemoizedMaskedChildContext=G),_}function nR(p,_,w,O){p=_.state,typeof _.componentWillReceiveProps=="function"&&_.componentWillReceiveProps(w,O),typeof _.UNSAFE_componentWillReceiveProps=="function"&&_.UNSAFE_componentWillReceiveProps(w,O),_.state!==p&&V_.enqueueReplaceState(_,_.state,null)}function bS(p,_,w,O){var U=p.stateNode;U.props=w,U.state=p.memoizedState,U.refs={},hS(p);var G=_.contextType;typeof G=="object"&&G!==null?U.context=aa(G):(G=wo(_)?Ou:Ms.current,U.context=Nu(p,G)),U.state=p.memoizedState,G=_.getDerivedStateFromProps,typeof G=="function"&&(U_(p,_,G,w),U.state=p.memoizedState),typeof _.getDerivedStateFromProps=="function"||typeof U.getSnapshotBeforeUpdate=="function"||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(_=U.state,typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount(),_!==U.state&&V_.enqueueReplaceState(U,U.state,null),O_(p,w,U,O),U.state=p.memoizedState),typeof U.componentDidMount=="function"&&(p.flags|=4194308)}function np(p,_){try{var w="",O=_;do w+=yt(O),O=O.return;while(O);var U=w}catch(G){U=`
Error generating stack: `+G.message+`
`+G.stack}return{value:p,source:_,stack:U,digest:null}}function F_(p,_,w){return{value:p,source:null,stack:w??null,digest:_??null}}function IS(p,_){try{console.error(_.value)}catch(w){setTimeout(function(){throw w})}}var AS=typeof WeakMap=="function"?WeakMap:Map;function OS(p,_,w){w=Il(-1,w),w.tag=3,w.payload={element:null};var O=_.value;return w.callback=function(){Fs||(Fs=!0,qS=O),IS(p,_)},w}function rR(p,_,w){w=Il(-1,w),w.tag=3;var O=p.type.getDerivedStateFromError;if(typeof O=="function"){var U=_.value;w.payload=function(){return O(U)},w.callback=function(){IS(p,_)}}var G=p.stateNode;return G!==null&&typeof G.componentDidCatch=="function"&&(w.callback=function(){IS(p,_),typeof O!="function"&&(Vu===null?Vu=new Set([this]):Vu.add(this));var ee=_.stack;this.componentDidCatch(_.value,{componentStack:ee!==null?ee:""})}),w}function NS(p,_,w){var O=p.pingCache;if(O===null){O=p.pingCache=new AS;var U=new Set;O.set(_,U)}else U=O.get(_),U===void 0&&(U=new Set,O.set(_,U));U.has(w)||(U.add(w),p=SR.bind(null,p,_,w),_.then(p,p))}function iR(p){do{var _;if((_=p.tag===13)&&(_=p.memoizedState,_=_!==null?_.dehydrated!==null:!0),_)return p;p=p.return}while(p!==null);return null}function sR(p,_,w,O,U){return(p.mode&1)===0?(p===_?p.flags|=65536:(p.flags|=128,w.flags|=131072,w.flags&=-52805,w.tag===1&&(w.alternate===null?w.tag=17:(_=Il(-1,1),_.tag=2,Ka(w,_,1))),w.lanes|=1),p):(p.flags|=65536,p.lanes=U,p)}var rP=ae.ReactCurrentOwner,Ro=!1;function io(p,_,w,O){_.child=p===null?oS(_,null,w,O):$h(_,p.child,w,O)}function oR(p,_,w,O,U){w=w.render;var G=_.ref;return za(_,U),O=Zh(p,_,w,O,G,U),w=yS(),p!==null&&!Ro?(_.updateQueue=p.updateQueue,_.flags&=-2053,p.lanes&=~U,Pl(p,_,U)):(si&&w&&qh(_),_.flags|=1,io(p,_,O,U),_.child)}function aR(p,_,w,O,U){if(p===null){var G=w.type;return typeof G=="function"&&!iT(G)&&G.defaultProps===void 0&&w.compare===null&&w.defaultProps===void 0?(_.tag=15,_.type=G,PS(p,_,G,O,U)):(p=cp(w.type,null,O,_,_.mode,U),p.ref=_.ref,p.return=_,_.child=p)}if(G=p.child,(p.lanes&U)===0){var ee=G.memoizedProps;if(w=w.compare,w=w!==null?w:Fh,w(ee,O)&&p.ref===_.ref)return Pl(p,_,U)}return _.flags|=1,p=Hu(G,O),p.ref=_.ref,p.return=_,_.child=p}function PS(p,_,w,O,U){if(p!==null){var G=p.memoizedProps;if(Fh(G,O)&&p.ref===_.ref)if(Ro=!1,_.pendingProps=O=G,(p.lanes&U)!==0)(p.flags&131072)!==0&&(Ro=!0);else return _.lanes=p.lanes,Pl(p,_,U)}return kS(p,_,w,O,U)}function Pc(p,_,w){var O=_.pendingProps,U=O.children,G=p!==null?p.memoizedState:null;if(O.mode==="hidden")if((_.mode&1)===0)_.memoizedState={baseLanes:0,cachePool:null,transitions:null},Zr(rp,zo),zo|=w;else{if((w&1073741824)===0)return p=G!==null?G.baseLanes|w:w,_.lanes=_.childLanes=1073741824,_.memoizedState={baseLanes:p,cachePool:null,transitions:null},_.updateQueue=null,Zr(rp,zo),zo|=p,null;_.memoizedState={baseLanes:0,cachePool:null,transitions:null},O=G!==null?G.baseLanes:w,Zr(rp,zo),zo|=O}else G!==null?(O=G.baseLanes|w,_.memoizedState=null):O=w,Zr(rp,zo),zo|=O;return io(p,_,U,w),_.child}function cR(p,_){var w=_.ref;(p===null&&w!==null||p!==null&&p.ref!==w)&&(_.flags|=512,_.flags|=2097152)}function kS(p,_,w,O,U){var G=wo(w)?Ou:Ms.current;return G=Nu(_,G),za(_,U),w=Zh(p,_,w,O,G,U),O=yS(),p!==null&&!Ro?(_.updateQueue=p.updateQueue,_.flags&=-2053,p.lanes&=~U,Pl(p,_,U)):(si&&O&&qh(_),_.flags|=1,io(p,_,w,U),_.child)}function lR(p,_,w,O,U){if(wo(w)){var G=!0;y_(_)}else G=!1;if(za(_,U),_.stateNode===null)W_(p,_),tR(_,w,O),bS(_,w,O,U),O=!0;else if(p===null){var ee=_.stateNode,me=_.memoizedProps;ee.props=me;var ve=ee.context,Ke=w.contextType;typeof Ke=="object"&&Ke!==null?Ke=aa(Ke):(Ke=wo(w)?Ou:Ms.current,Ke=Nu(_,Ke));var ut=w.getDerivedStateFromProps,ht=typeof ut=="function"||typeof ee.getSnapshotBeforeUpdate=="function";ht||typeof ee.UNSAFE_componentWillReceiveProps!="function"&&typeof ee.componentWillReceiveProps!="function"||(me!==O||ve!==Ke)&&nR(_,ee,O,Ke),bl=!1;var at=_.memoizedState;ee.state=at,O_(_,O,ee,U),ve=_.memoizedState,me!==O||at!==ve||no.current||bl?(typeof ut=="function"&&(U_(_,w,ut,O),ve=_.memoizedState),(me=bl||Nl(_,w,me,O,at,ve,Ke))?(ht||typeof ee.UNSAFE_componentWillMount!="function"&&typeof ee.componentWillMount!="function"||(typeof ee.componentWillMount=="function"&&ee.componentWillMount(),typeof ee.UNSAFE_componentWillMount=="function"&&ee.UNSAFE_componentWillMount()),typeof ee.componentDidMount=="function"&&(_.flags|=4194308)):(typeof ee.componentDidMount=="function"&&(_.flags|=4194308),_.memoizedProps=O,_.memoizedState=ve),ee.props=O,ee.state=ve,ee.context=Ke,O=me):(typeof ee.componentDidMount=="function"&&(_.flags|=4194308),O=!1)}else{ee=_.stateNode,WC(p,_),me=_.memoizedProps,Ke=_.type===_.elementType?me:ca(_.type,me),ee.props=Ke,ht=_.pendingProps,at=ee.context,ve=w.contextType,typeof ve=="object"&&ve!==null?ve=aa(ve):(ve=wo(w)?Ou:Ms.current,ve=Nu(_,ve));var bt=w.getDerivedStateFromProps;(ut=typeof bt=="function"||typeof ee.getSnapshotBeforeUpdate=="function")||typeof ee.UNSAFE_componentWillReceiveProps!="function"&&typeof ee.componentWillReceiveProps!="function"||(me!==ht||at!==ve)&&nR(_,ee,O,ve),bl=!1,at=_.memoizedState,ee.state=at,O_(_,O,ee,U);var Bt=_.memoizedState;me!==ht||at!==Bt||no.current||bl?(typeof bt=="function"&&(U_(_,w,bt,O),Bt=_.memoizedState),(Ke=bl||Nl(_,w,Ke,O,at,Bt,ve)||!1)?(ut||typeof ee.UNSAFE_componentWillUpdate!="function"&&typeof ee.componentWillUpdate!="function"||(typeof ee.componentWillUpdate=="function"&&ee.componentWillUpdate(O,Bt,ve),typeof ee.UNSAFE_componentWillUpdate=="function"&&ee.UNSAFE_componentWillUpdate(O,Bt,ve)),typeof ee.componentDidUpdate=="function"&&(_.flags|=4),typeof ee.getSnapshotBeforeUpdate=="function"&&(_.flags|=1024)):(typeof ee.componentDidUpdate!="function"||me===p.memoizedProps&&at===p.memoizedState||(_.flags|=4),typeof ee.getSnapshotBeforeUpdate!="function"||me===p.memoizedProps&&at===p.memoizedState||(_.flags|=1024),_.memoizedProps=O,_.memoizedState=Bt),ee.props=O,ee.state=Bt,ee.context=ve,O=Ke):(typeof ee.componentDidUpdate!="function"||me===p.memoizedProps&&at===p.memoizedState||(_.flags|=4),typeof ee.getSnapshotBeforeUpdate!="function"||me===p.memoizedProps&&at===p.memoizedState||(_.flags|=1024),O=!1)}return DS(p,_,w,O,G,U)}function DS(p,_,w,O,U,G){cR(p,_);var ee=(_.flags&128)!==0;if(!O&&!ee)return U&&UC(_,w,!1),Pl(p,_,G);O=_.stateNode,rP.current=_;var me=ee&&typeof w.getDerivedStateFromError!="function"?null:O.render();return _.flags|=1,p!==null&&ee?(_.child=$h(_,p.child,null,G),_.child=$h(_,null,me,G)):io(p,_,me,G),_.memoizedState=O.state,U&&UC(_,w,!0),_.child}function uR(p){var _=p.stateNode;_.pendingContext?Kh(p,_.pendingContext,_.pendingContext!==_.context):_.context&&Kh(p,_.context,!1),pS(p,_.containerInfo)}function dR(p,_,w,O,U){return Ud(),Jh(U),_.flags|=256,io(p,_,w,O),_.child}var am={dehydrated:null,treeContext:null,retryLane:0};function xS(p){return{baseLanes:p,cachePool:null,transitions:null}}function hR(p,_,w){var O=_.pendingProps,U=Si.current,G=!1,ee=(_.flags&128)!==0,me;if((me=ee)||(me=p!==null&&p.memoizedState===null?!1:(U&2)!==0),me?(G=!0,_.flags&=-129):(p===null||p.memoizedState!==null)&&(U|=1),Zr(Si,U&1),p===null)return Xf(_),p=_.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((_.mode&1)===0?_.lanes=1:p.data==="$!"?_.lanes=8:_.lanes=1073741824,null):(ee=O.children,p=O.fallback,G?(O=_.mode,G=_.child,ee={mode:"hidden",children:ee},(O&1)===0&&G!==null?(G.childLanes=0,G.pendingProps=ee):G=Em(ee,O,0,null),p=zu(p,O,w,null),G.return=_,p.return=_,G.sibling=p,_.child=G,_.child.memoizedState=xS(w),_.memoizedState=am,p):LS(_,ee));if(U=p.memoizedState,U!==null&&(me=U.dehydrated,me!==null))return iP(p,_,ee,O,me,U,w);if(G){G=O.fallback,ee=_.mode,U=p.child,me=U.sibling;var ve={mode:"hidden",children:O.children};return(ee&1)===0&&_.child!==U?(O=_.child,O.childLanes=0,O.pendingProps=ve,_.deletions=null):(O=Hu(U,ve),O.subtreeFlags=U.subtreeFlags&14680064),me!==null?G=Hu(me,G):(G=zu(G,ee,w,null),G.flags|=2),G.return=_,O.return=_,O.sibling=G,_.child=O,O=G,G=_.child,ee=p.child.memoizedState,ee=ee===null?xS(w):{baseLanes:ee.baseLanes|w,cachePool:null,transitions:ee.transitions},G.memoizedState=ee,G.childLanes=p.childLanes&~w,_.memoizedState=am,O}return G=p.child,p=G.sibling,O=Hu(G,{mode:"visible",children:O.children}),(_.mode&1)===0&&(O.lanes=w),O.return=_,O.sibling=null,p!==null&&(w=_.deletions,w===null?(_.deletions=[p],_.flags|=16):w.push(p)),_.child=O,_.memoizedState=null,O}function LS(p,_){return _=Em({mode:"visible",children:_},p.mode,0,null),_.return=p,p.child=_}function j_(p,_,w,O){return O!==null&&Jh(O),$h(_,p.child,null,w),p=LS(_,_.pendingProps.children),p.flags|=2,_.memoizedState=null,p}function iP(p,_,w,O,U,G,ee){if(w)return _.flags&256?(_.flags&=-257,O=F_(Error(s(422))),j_(p,_,ee,O)):_.memoizedState!==null?(_.child=p.child,_.flags|=128,null):(G=O.fallback,U=_.mode,O=Em({mode:"visible",children:O.children},U,0,null),G=zu(G,U,ee,null),G.flags|=2,O.return=_,G.return=_,O.sibling=G,_.child=O,(_.mode&1)!==0&&$h(_,p.child,null,ee),_.child.memoizedState=xS(ee),_.memoizedState=am,G);if((_.mode&1)===0)return j_(p,_,ee,null);if(U.data==="$!"){if(O=U.nextSibling&&U.nextSibling.dataset,O)var me=O.dgst;return O=me,G=Error(s(419)),O=F_(G,O,void 0),j_(p,_,ee,O)}if(me=(ee&p.childLanes)!==0,Ro||me){if(O=ls,O!==null){switch(ee&-ee){case 4:U=2;break;case 16:U=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:U=32;break;case 536870912:U=268435456;break;default:U=0}U=(U&(O.suspendedLanes|ee))!==0?0:U,U!==0&&U!==G.retryLane&&(G.retryLane=U,Rl(p,U),Ko(O,p,U,-1))}return op(),O=F_(Error(s(421))),j_(p,_,ee,O)}return U.data==="$?"?(_.flags|=128,_.child=p.child,_=hP.bind(null,p),U._reactRetry=_,null):(p=G.treeContext,Go=Ac(U.nextSibling),Wo=_,si=!0,Ha=null,p!==null&&(ro[oa++]=wl,ro[oa++]=Cl,ro[oa++]=Ld,wl=p.id,Cl=p.overflow,Ld=_),_=LS(_,O.children),_.flags|=4096,_)}function pR(p,_,w){p.lanes|=_;var O=p.alternate;O!==null&&(O.lanes|=_),I_(p.return,_,w)}function B_(p,_,w,O,U){var G=p.memoizedState;G===null?p.memoizedState={isBackwards:_,rendering:null,renderingStartTime:0,last:O,tail:w,tailMode:U}:(G.isBackwards=_,G.rendering=null,G.renderingStartTime=0,G.last=O,G.tail=w,G.tailMode=U)}function MS(p,_,w){var O=_.pendingProps,U=O.revealOrder,G=O.tail;if(io(p,_,O.children,w),O=Si.current,(O&2)!==0)O=O&1|2,_.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=_.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&pR(p,w,_);else if(p.tag===19)pR(p,w,_);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===_)break e;for(;p.sibling===null;){if(p.return===null||p.return===_)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}O&=1}if(Zr(Si,O),(_.mode&1)===0)_.memoizedState=null;else switch(U){case"forwards":for(w=_.child,U=null;w!==null;)p=w.alternate,p!==null&&N_(p)===null&&(U=w),w=w.sibling;w=U,w===null?(U=_.child,_.child=null):(U=w.sibling,w.sibling=null),B_(_,!1,U,w,G);break;case"backwards":for(w=null,U=_.child,_.child=null;U!==null;){if(p=U.alternate,p!==null&&N_(p)===null){_.child=U;break}p=U.sibling,U.sibling=w,w=U,U=p}B_(_,!0,w,null,G);break;case"together":B_(_,!1,null,null,void 0);break;default:_.memoizedState=null}return _.child}function W_(p,_){(_.mode&1)===0&&p!==null&&(p.alternate=null,_.alternate=null,_.flags|=2)}function Pl(p,_,w){if(p!==null&&(_.dependencies=p.dependencies),Kd|=_.lanes,(w&_.childLanes)===0)return null;if(p!==null&&_.child!==p.child)throw Error(s(153));if(_.child!==null){for(p=_.child,w=Hu(p,p.pendingProps),_.child=w,w.return=_;p.sibling!==null;)p=p.sibling,w=w.sibling=Hu(p,p.pendingProps),w.return=_;w.sibling=null}return _.child}function G_(p,_,w){switch(_.tag){case 3:uR(_),Ud();break;case 5:zC(_);break;case 1:wo(_.type)&&y_(_);break;case 4:pS(_,_.stateNode.containerInfo);break;case 10:var O=_.type._context,U=_.memoizedProps.value;Zr(R_,O._currentValue),O._currentValue=U;break;case 13:if(O=_.memoizedState,O!==null)return O.dehydrated!==null?(Zr(Si,Si.current&1),_.flags|=128,null):(w&_.child.childLanes)!==0?hR(p,_,w):(Zr(Si,Si.current&1),p=Pl(p,_,w),p!==null?p.sibling:null);Zr(Si,Si.current&1);break;case 19:if(O=(w&_.childLanes)!==0,(p.flags&128)!==0){if(O)return MS(p,_,w);_.flags|=128}if(U=_.memoizedState,U!==null&&(U.rendering=null,U.tail=null,U.lastEffect=null),Zr(Si,Si.current),O)break;return null;case 22:case 23:return _.lanes=0,Pc(p,_,w)}return Pl(p,_,w)}var H_,z_,cm,US;H_=function(p,_){for(var w=_.child;w!==null;){if(w.tag===5||w.tag===6)p.appendChild(w.stateNode);else if(w.tag!==4&&w.child!==null){w.child.return=w,w=w.child;continue}if(w===_)break;for(;w.sibling===null;){if(w.return===null||w.return===_)return;w=w.return}w.sibling.return=w.return,w=w.sibling}},z_=function(){},cm=function(p,_,w,O){var U=p.memoizedProps;if(U!==O){p=_.stateNode,Du(Nc.current);var G=null;switch(w){case"input":U=wc(p,U),O=wc(p,O),G=[];break;case"select":U=re({},U,{value:void 0}),O=re({},O,{value:void 0}),G=[];break;case"textarea":U=Rc(p,U),O=Rc(p,O),G=[];break;default:typeof U.onClick!="function"&&typeof O.onClick=="function"&&(p.onclick=zf)}Gr(w,O);var ee;w=null;for(Ke in U)if(!O.hasOwnProperty(Ke)&&U.hasOwnProperty(Ke)&&U[Ke]!=null)if(Ke==="style"){var me=U[Ke];for(ee in me)me.hasOwnProperty(ee)&&(w||(w={}),w[ee]="")}else Ke!=="dangerouslySetInnerHTML"&&Ke!=="children"&&Ke!=="suppressContentEditableWarning"&&Ke!=="suppressHydrationWarning"&&Ke!=="autoFocus"&&(l.hasOwnProperty(Ke)?G||(G=[]):(G=G||[]).push(Ke,null));for(Ke in O){var ve=O[Ke];if(me=U?.[Ke],O.hasOwnProperty(Ke)&&ve!==me&&(ve!=null||me!=null))if(Ke==="style")if(me){for(ee in me)!me.hasOwnProperty(ee)||ve&&ve.hasOwnProperty(ee)||(w||(w={}),w[ee]="");for(ee in ve)ve.hasOwnProperty(ee)&&me[ee]!==ve[ee]&&(w||(w={}),w[ee]=ve[ee])}else w||(G||(G=[]),G.push(Ke,w)),w=ve;else Ke==="dangerouslySetInnerHTML"?(ve=ve?ve.__html:void 0,me=me?me.__html:void 0,ve!=null&&me!==ve&&(G=G||[]).push(Ke,ve)):Ke==="children"?typeof ve!="string"&&typeof ve!="number"||(G=G||[]).push(Ke,""+ve):Ke!=="suppressContentEditableWarning"&&Ke!=="suppressHydrationWarning"&&(l.hasOwnProperty(Ke)?(ve!=null&&Ke==="onScroll"&&Qr("scroll",p),G||me===ve||(G=[])):(G=G||[]).push(Ke,ve))}w&&(G=G||[]).push("style",w);var Ke=G;(_.updateQueue=Ke)&&(_.flags|=4)}},US=function(p,_,w,O){w!==O&&(_.flags|=4)};function lm(p,_){if(!si)switch(p.tailMode){case"hidden":_=p.tail;for(var w=null;_!==null;)_.alternate!==null&&(w=_),_=_.sibling;w===null?p.tail=null:w.sibling=null;break;case"collapsed":w=p.tail;for(var O=null;w!==null;)w.alternate!==null&&(O=w),w=w.sibling;O===null?_||p.tail===null?p.tail=null:p.tail.sibling=null:O.sibling=null}}function As(p){var _=p.alternate!==null&&p.alternate.child===p.child,w=0,O=0;if(_)for(var U=p.child;U!==null;)w|=U.lanes|U.childLanes,O|=U.subtreeFlags&14680064,O|=U.flags&14680064,U.return=p,U=U.sibling;else for(U=p.child;U!==null;)w|=U.lanes|U.childLanes,O|=U.subtreeFlags,O|=U.flags,U.return=p,U=U.sibling;return p.subtreeFlags|=O,p.childLanes=w,_}function K_(p,_,w){var O=_.pendingProps;switch(w_(_),_.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return As(_),null;case 1:return wo(_.type)&&E_(),As(_),null;case 3:return O=_.stateNode,jd(),Hr(no),Hr(Ms),gS(),O.pendingContext&&(O.context=O.pendingContext,O.pendingContext=null),(p===null||p.child===null)&&(Xh(_)?_.flags|=4:p===null||p.memoizedState.isDehydrated&&(_.flags&256)===0||(_.flags|=1024,Ha!==null&&(JS(Ha),Ha=null))),z_(p,_),As(_),null;case 5:fS(_);var U=Du(Zf.current);if(w=_.type,p!==null&&_.stateNode!=null)cm(p,_,w,O,U),p.ref!==_.ref&&(_.flags|=512,_.flags|=2097152);else{if(!O){if(_.stateNode===null)throw Error(s(166));return As(_),null}if(p=Du(Nc.current),Xh(_)){O=_.stateNode,w=_.type;var G=_.memoizedProps;switch(O[Oc]=_,O[Kf]=G,p=(_.mode&1)!==0,w){case"dialog":Qr("cancel",O),Qr("close",O);break;case"iframe":case"object":case"embed":Qr("load",O);break;case"video":case"audio":for(U=0;U<Bf.length;U++)Qr(Bf[U],O);break;case"source":Qr("error",O);break;case"img":case"image":case"link":Qr("error",O),Qr("load",O);break;case"details":Qr("toggle",O);break;case"input":fl(O,G),Qr("invalid",O);break;case"select":O._wrapperState={wasMultiple:!!G.multiple},Qr("invalid",O);break;case"textarea":Qs(O,G),Qr("invalid",O)}Gr(w,G),U=null;for(var ee in G)if(G.hasOwnProperty(ee)){var me=G[ee];ee==="children"?typeof me=="string"?O.textContent!==me&&(G.suppressHydrationWarning!==!0&&Hf(O.textContent,me,p),U=["children",me]):typeof me=="number"&&O.textContent!==""+me&&(G.suppressHydrationWarning!==!0&&Hf(O.textContent,me,p),U=["children",""+me]):l.hasOwnProperty(ee)&&me!=null&&ee==="onScroll"&&Qr("scroll",O)}switch(w){case"input":as(O),Wr(O,G,!0);break;case"textarea":as(O),Fo(O);break;case"select":case"option":break;default:typeof G.onClick=="function"&&(O.onclick=zf)}O=U,_.updateQueue=O,O!==null&&(_.flags|=4)}else{ee=U.nodeType===9?U:U.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=Xe(w)),p==="http://www.w3.org/1999/xhtml"?w==="script"?(p=ee.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof O.is=="string"?p=ee.createElement(w,{is:O.is}):(p=ee.createElement(w),w==="select"&&(ee=p,O.multiple?ee.multiple=!0:O.size&&(ee.size=O.size))):p=ee.createElementNS(p,w),p[Oc]=_,p[Kf]=O,H_(p,_,!1,!1),_.stateNode=p;e:{switch(ee=yo(w,O),w){case"dialog":Qr("cancel",p),Qr("close",p),U=O;break;case"iframe":case"object":case"embed":Qr("load",p),U=O;break;case"video":case"audio":for(U=0;U<Bf.length;U++)Qr(Bf[U],p);U=O;break;case"source":Qr("error",p),U=O;break;case"img":case"image":case"link":Qr("error",p),Qr("load",p),U=O;break;case"details":Qr("toggle",p),U=O;break;case"input":fl(p,O),U=wc(p,O),Qr("invalid",p);break;case"option":U=O;break;case"select":p._wrapperState={wasMultiple:!!O.multiple},U=re({},O,{value:void 0}),Qr("invalid",p);break;case"textarea":Qs(p,O),U=Rc(p,O),Qr("invalid",p);break;default:U=O}Gr(w,U),me=U;for(G in me)if(me.hasOwnProperty(G)){var ve=me[G];G==="style"?mi(p,ve):G==="dangerouslySetInnerHTML"?(ve=ve?ve.__html:void 0,ve!=null&&an(p,ve)):G==="children"?typeof ve=="string"?(w!=="textarea"||ve!=="")&&Nn(p,ve):typeof ve=="number"&&Nn(p,""+ve):G!=="suppressContentEditableWarning"&&G!=="suppressHydrationWarning"&&G!=="autoFocus"&&(l.hasOwnProperty(G)?ve!=null&&G==="onScroll"&&Qr("scroll",p):ve!=null&&$(p,G,ve,ee))}switch(w){case"input":as(p),Wr(p,O,!1);break;case"textarea":as(p),Fo(p);break;case"option":O.value!=null&&p.setAttribute("value",""+dn(O.value));break;case"select":p.multiple=!!O.multiple,G=O.value,G!=null?gs(p,!!O.multiple,G,!1):O.defaultValue!=null&&gs(p,!!O.multiple,O.defaultValue,!0);break;default:typeof U.onClick=="function"&&(p.onclick=zf)}switch(w){case"button":case"input":case"select":case"textarea":O=!!O.autoFocus;break e;case"img":O=!0;break e;default:O=!1}}O&&(_.flags|=4)}_.ref!==null&&(_.flags|=512,_.flags|=2097152)}return As(_),null;case 6:if(p&&_.stateNode!=null)US(p,_,p.memoizedProps,O);else{if(typeof O!="string"&&_.stateNode===null)throw Error(s(166));if(w=Du(Zf.current),Du(Nc.current),Xh(_)){if(O=_.stateNode,w=_.memoizedProps,O[Oc]=_,(G=O.nodeValue!==w)&&(p=Wo,p!==null))switch(p.tag){case 3:Hf(O.nodeValue,w,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&Hf(O.nodeValue,w,(p.mode&1)!==0)}G&&(_.flags|=4)}else O=(w.nodeType===9?w:w.ownerDocument).createTextNode(O),O[Oc]=_,_.stateNode=O}return As(_),null;case 13:if(Hr(Si),O=_.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(si&&Go!==null&&(_.mode&1)!==0&&(_.flags&128)===0)iS(),Ud(),_.flags|=98560,G=!1;else if(G=Xh(_),O!==null&&O.dehydrated!==null){if(p===null){if(!G)throw Error(s(318));if(G=_.memoizedState,G=G!==null?G.dehydrated:null,!G)throw Error(s(317));G[Oc]=_}else Ud(),(_.flags&128)===0&&(_.memoizedState=null),_.flags|=4;As(_),G=!1}else Ha!==null&&(JS(Ha),Ha=null),G=!0;if(!G)return _.flags&65536?_:null}return(_.flags&128)!==0?(_.lanes=w,_):(O=O!==null,O!==(p!==null&&p.memoizedState!==null)&&O&&(_.child.flags|=8192,(_.mode&1)!==0&&(p===null||(Si.current&1)!==0?us===0&&(us=3):op())),_.updateQueue!==null&&(_.flags|=4),As(_),null);case 4:return jd(),z_(p,_),p===null&&yl(_.stateNode.containerInfo),As(_),null;case 10:return lS(_.type._context),As(_),null;case 17:return wo(_.type)&&E_(),As(_),null;case 19:if(Hr(Si),G=_.memoizedState,G===null)return As(_),null;if(O=(_.flags&128)!==0,ee=G.rendering,ee===null)if(O)lm(G,!1);else{if(us!==0||p!==null&&(p.flags&128)!==0)for(p=_.child;p!==null;){if(ee=N_(p),ee!==null){for(_.flags|=128,lm(G,!1),O=ee.updateQueue,O!==null&&(_.updateQueue=O,_.flags|=4),_.subtreeFlags=0,O=w,w=_.child;w!==null;)G=w,p=O,G.flags&=14680066,ee=G.alternate,ee===null?(G.childLanes=0,G.lanes=p,G.child=null,G.subtreeFlags=0,G.memoizedProps=null,G.memoizedState=null,G.updateQueue=null,G.dependencies=null,G.stateNode=null):(G.childLanes=ee.childLanes,G.lanes=ee.lanes,G.child=ee.child,G.subtreeFlags=0,G.deletions=null,G.memoizedProps=ee.memoizedProps,G.memoizedState=ee.memoizedState,G.updateQueue=ee.updateQueue,G.type=ee.type,p=ee.dependencies,G.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),w=w.sibling;return Zr(Si,Si.current&1|2),_.child}p=p.sibling}G.tail!==null&&gr()>la&&(_.flags|=128,O=!0,lm(G,!1),_.lanes=4194304)}else{if(!O)if(p=N_(ee),p!==null){if(_.flags|=128,O=!0,w=p.updateQueue,w!==null&&(_.updateQueue=w,_.flags|=4),lm(G,!0),G.tail===null&&G.tailMode==="hidden"&&!ee.alternate&&!si)return As(_),null}else 2*gr()-G.renderingStartTime>la&&w!==1073741824&&(_.flags|=128,O=!0,lm(G,!1),_.lanes=4194304);G.isBackwards?(ee.sibling=_.child,_.child=ee):(w=G.last,w!==null?w.sibling=ee:_.child=ee,G.last=ee)}return G.tail!==null?(_=G.tail,G.rendering=_,G.tail=_.sibling,G.renderingStartTime=gr(),_.sibling=null,w=Si.current,Zr(Si,O?w&1|2:w&1),_):(As(_),null);case 22:case 23:return gm(),O=_.memoizedState!==null,p!==null&&p.memoizedState!==null!==O&&(_.flags|=8192),O&&(_.mode&1)!==0?(zo&1073741824)!==0&&(As(_),_.subtreeFlags&6&&(_.flags|=8192)):As(_),null;case 24:return null;case 25:return null}throw Error(s(156,_.tag))}function sP(p,_){switch(w_(_),_.tag){case 1:return wo(_.type)&&E_(),p=_.flags,p&65536?(_.flags=p&-65537|128,_):null;case 3:return jd(),Hr(no),Hr(Ms),gS(),p=_.flags,(p&65536)!==0&&(p&128)===0?(_.flags=p&-65537|128,_):null;case 5:return fS(_),null;case 13:if(Hr(Si),p=_.memoizedState,p!==null&&p.dehydrated!==null){if(_.alternate===null)throw Error(s(340));Ud()}return p=_.flags,p&65536?(_.flags=p&-65537|128,_):null;case 19:return Hr(Si),null;case 4:return jd(),null;case 10:return lS(_.type._context),null;case 22:case 23:return gm(),null;case 24:return null;default:return null}}var um=!1,Os=!1,oP=typeof WeakSet=="function"?WeakSet:Set,Nt=null;function zd(p,_){var w=p.ref;if(w!==null)if(typeof w=="function")try{w(null)}catch(O){Ti(p,_,O)}else w.current=null}function VS(p,_,w){try{w()}catch(O){Ti(p,_,O)}}var fR=!1;function aP(p,_){if($v=i_,p=Gv(),Hv(p)){if("selectionStart"in p)var w={start:p.selectionStart,end:p.selectionEnd};else e:{w=(w=p.ownerDocument)&&w.defaultView||window;var O=w.getSelection&&w.getSelection();if(O&&O.rangeCount!==0){w=O.anchorNode;var U=O.anchorOffset,G=O.focusNode;O=O.focusOffset;try{w.nodeType,G.nodeType}catch{w=null;break e}var ee=0,me=-1,ve=-1,Ke=0,ut=0,ht=p,at=null;t:for(;;){for(var bt;ht!==w||U!==0&&ht.nodeType!==3||(me=ee+U),ht!==G||O!==0&&ht.nodeType!==3||(ve=ee+O),ht.nodeType===3&&(ee+=ht.nodeValue.length),(bt=ht.firstChild)!==null;)at=ht,ht=bt;for(;;){if(ht===p)break t;if(at===w&&++Ke===U&&(me=ee),at===G&&++ut===O&&(ve=ee),(bt=ht.nextSibling)!==null)break;ht=at,at=ht.parentNode}ht=bt}w=me===-1||ve===-1?null:{start:me,end:ve}}else w=null}w=w||{start:0,end:0}}else w=null;for(m_={focusedElem:p,selectionRange:w},i_=!1,Nt=_;Nt!==null;)if(_=Nt,p=_.child,(_.subtreeFlags&1028)!==0&&p!==null)p.return=_,Nt=p;else for(;Nt!==null;){_=Nt;try{var Bt=_.alternate;if((_.flags&1024)!==0)switch(_.tag){case 0:case 11:case 15:break;case 1:if(Bt!==null){var Ht=Bt.memoizedProps,Wi=Bt.memoizedState,Le=_.stateNode,we=Le.getSnapshotBeforeUpdate(_.elementType===_.type?Ht:ca(_.type,Ht),Wi);Le.__reactInternalSnapshotBeforeUpdate=we}break;case 3:var Be=_.stateNode.containerInfo;Be.nodeType===1?Be.textContent="":Be.nodeType===9&&Be.documentElement&&Be.removeChild(Be.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(s(163))}}catch(ft){Ti(_,_.return,ft)}if(p=_.sibling,p!==null){p.return=_.return,Nt=p;break}Nt=_.return}return Bt=fR,fR=!1,Bt}function Lu(p,_,w){var O=_.updateQueue;if(O=O!==null?O.lastEffect:null,O!==null){var U=O=O.next;do{if((U.tag&p)===p){var G=U.destroy;U.destroy=void 0,G!==void 0&&VS(_,w,G)}U=U.next}while(U!==O)}}function Y_(p,_){if(_=_.updateQueue,_=_!==null?_.lastEffect:null,_!==null){var w=_=_.next;do{if((w.tag&p)===p){var O=w.create;w.destroy=O()}w=w.next}while(w!==_)}}function FS(p){var _=p.ref;if(_!==null){var w=p.stateNode;p.tag,p=w,typeof _=="function"?_(p):_.current=p}}function mR(p){var _=p.alternate;_!==null&&(p.alternate=null,mR(_)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(_=p.stateNode,_!==null&&(delete _[Oc],delete _[Kf],delete _[Zv],delete _[JN],delete _[$N])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function jS(p){return p.tag===5||p.tag===3||p.tag===4}function gR(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||jS(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function BS(p,_,w){var O=p.tag;if(O===5||O===6)p=p.stateNode,_?w.nodeType===8?w.parentNode.insertBefore(p,_):w.insertBefore(p,_):(w.nodeType===8?(_=w.parentNode,_.insertBefore(p,w)):(_=w,_.appendChild(p)),w=w._reactRootContainer,w!=null||_.onclick!==null||(_.onclick=zf));else if(O!==4&&(p=p.child,p!==null))for(BS(p,_,w),p=p.sibling;p!==null;)BS(p,_,w),p=p.sibling}function dm(p,_,w){var O=p.tag;if(O===5||O===6)p=p.stateNode,_?w.insertBefore(p,_):w.appendChild(p);else if(O!==4&&(p=p.child,p!==null))for(dm(p,_,w),p=p.sibling;p!==null;)dm(p,_,w),p=p.sibling}var Ns=null,Ho=!1;function Mu(p,_,w){for(w=w.child;w!==null;)WS(p,_,w),w=w.sibling}function WS(p,_,w){if(bs&&typeof bs.onCommitFiberUnmount=="function")try{bs.onCommitFiberUnmount(Dr,w)}catch{}switch(w.tag){case 5:Os||zd(w,_);case 6:var O=Ns,U=Ho;Ns=null,Mu(p,_,w),Ns=O,Ho=U,Ns!==null&&(Ho?(p=Ns,w=w.stateNode,p.nodeType===8?p.parentNode.removeChild(w):p.removeChild(w)):Ns.removeChild(w.stateNode));break;case 18:Ns!==null&&(Ho?(p=Ns,w=w.stateNode,p.nodeType===8?g_(p.parentNode,w):p.nodeType===1&&g_(p,w),kh(p)):g_(Ns,w.stateNode));break;case 4:O=Ns,U=Ho,Ns=w.stateNode.containerInfo,Ho=!0,Mu(p,_,w),Ns=O,Ho=U;break;case 0:case 11:case 14:case 15:if(!Os&&(O=w.updateQueue,O!==null&&(O=O.lastEffect,O!==null))){U=O=O.next;do{var G=U,ee=G.destroy;G=G.tag,ee!==void 0&&((G&2)!==0||(G&4)!==0)&&VS(w,_,ee),U=U.next}while(U!==O)}Mu(p,_,w);break;case 1:if(!Os&&(zd(w,_),O=w.stateNode,typeof O.componentWillUnmount=="function"))try{O.props=w.memoizedProps,O.state=w.memoizedState,O.componentWillUnmount()}catch(me){Ti(w,_,me)}Mu(p,_,w);break;case 21:Mu(p,_,w);break;case 22:w.mode&1?(Os=(O=Os)||w.memoizedState!==null,Mu(p,_,w),Os=O):Mu(p,_,w);break;default:Mu(p,_,w)}}function _R(p){var _=p.updateQueue;if(_!==null){p.updateQueue=null;var w=p.stateNode;w===null&&(w=p.stateNode=new oP),_.forEach(function(O){var U=ap.bind(null,p,O);w.has(O)||(w.add(O),O.then(U,U))})}}function Xa(p,_){var w=_.deletions;if(w!==null)for(var O=0;O<w.length;O++){var U=w[O];try{var G=p,ee=_,me=ee;e:for(;me!==null;){switch(me.tag){case 5:Ns=me.stateNode,Ho=!1;break e;case 3:Ns=me.stateNode.containerInfo,Ho=!0;break e;case 4:Ns=me.stateNode.containerInfo,Ho=!0;break e}me=me.return}if(Ns===null)throw Error(s(160));WS(G,ee,U),Ns=null,Ho=!1;var ve=U.alternate;ve!==null&&(ve.return=null),U.return=null}catch(Ke){Ti(U,_,Ke)}}if(_.subtreeFlags&12854)for(_=_.child;_!==null;)GS(_,p),_=_.sibling}function GS(p,_){var w=p.alternate,O=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(Xa(_,p),kc(p),O&4){try{Lu(3,p,p.return),Y_(3,p)}catch(Ht){Ti(p,p.return,Ht)}try{Lu(5,p,p.return)}catch(Ht){Ti(p,p.return,Ht)}}break;case 1:Xa(_,p),kc(p),O&512&&w!==null&&zd(w,w.return);break;case 5:if(Xa(_,p),kc(p),O&512&&w!==null&&zd(w,w.return),p.flags&32){var U=p.stateNode;try{Nn(U,"")}catch(Ht){Ti(p,p.return,Ht)}}if(O&4&&(U=p.stateNode,U!=null)){var G=p.memoizedProps,ee=w!==null?w.memoizedProps:G,me=p.type,ve=p.updateQueue;if(p.updateQueue=null,ve!==null)try{me==="input"&&G.type==="radio"&&G.name!=null&&yi(U,G),yo(me,ee);var Ke=yo(me,G);for(ee=0;ee<ve.length;ee+=2){var ut=ve[ee],ht=ve[ee+1];ut==="style"?mi(U,ht):ut==="dangerouslySetInnerHTML"?an(U,ht):ut==="children"?Nn(U,ht):$(U,ut,ht,Ke)}switch(me){case"input":Cc(U,G);break;case"textarea":Ir(U,G);break;case"select":var at=U._wrapperState.wasMultiple;U._wrapperState.wasMultiple=!!G.multiple;var bt=G.value;bt!=null?gs(U,!!G.multiple,bt,!1):at!==!!G.multiple&&(G.defaultValue!=null?gs(U,!!G.multiple,G.defaultValue,!0):gs(U,!!G.multiple,G.multiple?[]:"",!1))}U[Kf]=G}catch(Ht){Ti(p,p.return,Ht)}}break;case 6:if(Xa(_,p),kc(p),O&4){if(p.stateNode===null)throw Error(s(162));U=p.stateNode,G=p.memoizedProps;try{U.nodeValue=G}catch(Ht){Ti(p,p.return,Ht)}}break;case 3:if(Xa(_,p),kc(p),O&4&&w!==null&&w.memoizedState.isDehydrated)try{kh(_.containerInfo)}catch(Ht){Ti(p,p.return,Ht)}break;case 4:Xa(_,p),kc(p);break;case 13:Xa(_,p),kc(p),U=p.child,U.flags&8192&&(G=U.memoizedState!==null,U.stateNode.isHidden=G,!G||U.alternate!==null&&U.alternate.memoizedState!==null||(YS=gr())),O&4&&_R(p);break;case 22:if(ut=w!==null&&w.memoizedState!==null,p.mode&1?(Os=(Ke=Os)||ut,Xa(_,p),Os=Ke):Xa(_,p),kc(p),O&8192){if(Ke=p.memoizedState!==null,(p.stateNode.isHidden=Ke)&&!ut&&(p.mode&1)!==0)for(Nt=p,ut=p.child;ut!==null;){for(ht=Nt=ut;Nt!==null;){switch(at=Nt,bt=at.child,at.tag){case 0:case 11:case 14:case 15:Lu(4,at,at.return);break;case 1:zd(at,at.return);var Bt=at.stateNode;if(typeof Bt.componentWillUnmount=="function"){O=at,w=at.return;try{_=O,Bt.props=_.memoizedProps,Bt.state=_.memoizedState,Bt.componentWillUnmount()}catch(Ht){Ti(O,w,Ht)}}break;case 5:zd(at,at.return);break;case 22:if(at.memoizedState!==null){q_(ht);continue}}bt!==null?(bt.return=at,Nt=bt):q_(ht)}ut=ut.sibling}e:for(ut=null,ht=p;;){if(ht.tag===5){if(ut===null){ut=ht;try{U=ht.stateNode,Ke?(G=U.style,typeof G.setProperty=="function"?G.setProperty("display","none","important"):G.display="none"):(me=ht.stateNode,ve=ht.memoizedProps.style,ee=ve!=null&&ve.hasOwnProperty("display")?ve.display:null,me.style.display=$r("display",ee))}catch(Ht){Ti(p,p.return,Ht)}}}else if(ht.tag===6){if(ut===null)try{ht.stateNode.nodeValue=Ke?"":ht.memoizedProps}catch(Ht){Ti(p,p.return,Ht)}}else if((ht.tag!==22&&ht.tag!==23||ht.memoizedState===null||ht===p)&&ht.child!==null){ht.child.return=ht,ht=ht.child;continue}if(ht===p)break e;for(;ht.sibling===null;){if(ht.return===null||ht.return===p)break e;ut===ht&&(ut=null),ht=ht.return}ut===ht&&(ut=null),ht.sibling.return=ht.return,ht=ht.sibling}}break;case 19:Xa(_,p),kc(p),O&4&&_R(p);break;case 21:break;default:Xa(_,p),kc(p)}}function kc(p){var _=p.flags;if(_&2){try{e:{for(var w=p.return;w!==null;){if(jS(w)){var O=w;break e}w=w.return}throw Error(s(160))}switch(O.tag){case 5:var U=O.stateNode;O.flags&32&&(Nn(U,""),O.flags&=-33);var G=gR(p);dm(p,G,U);break;case 3:case 4:var ee=O.stateNode.containerInfo,me=gR(p);BS(p,me,ee);break;default:throw Error(s(161))}}catch(ve){Ti(p,p.return,ve)}p.flags&=-3}_&4096&&(p.flags&=-4097)}function cP(p,_,w){Nt=p,HS(p)}function HS(p,_,w){for(var O=(p.mode&1)!==0;Nt!==null;){var U=Nt,G=U.child;if(U.tag===22&&O){var ee=U.memoizedState!==null||um;if(!ee){var me=U.alternate,ve=me!==null&&me.memoizedState!==null||Os;me=um;var Ke=Os;if(um=ee,(Os=ve)&&!Ke)for(Nt=U;Nt!==null;)ee=Nt,ve=ee.child,ee.tag===22&&ee.memoizedState!==null?ER(U):ve!==null?(ve.return=ee,Nt=ve):ER(U);for(;G!==null;)Nt=G,HS(G),G=G.sibling;Nt=U,um=me,Os=Ke}zS(p)}else(U.subtreeFlags&8772)!==0&&G!==null?(G.return=U,Nt=G):zS(p)}}function zS(p){for(;Nt!==null;){var _=Nt;if((_.flags&8772)!==0){var w=_.alternate;try{if((_.flags&8772)!==0)switch(_.tag){case 0:case 11:case 15:Os||Y_(5,_);break;case 1:var O=_.stateNode;if(_.flags&4&&!Os)if(w===null)O.componentDidMount();else{var U=_.elementType===_.type?w.memoizedProps:ca(_.type,w.memoizedProps);O.componentDidUpdate(U,w.memoizedState,O.__reactInternalSnapshotBeforeUpdate)}var G=_.updateQueue;G!==null&&HC(_,G,O);break;case 3:var ee=_.updateQueue;if(ee!==null){if(w=null,_.child!==null)switch(_.child.tag){case 5:w=_.child.stateNode;break;case 1:w=_.child.stateNode}HC(_,ee,w)}break;case 5:var me=_.stateNode;if(w===null&&_.flags&4){w=me;var ve=_.memoizedProps;switch(_.type){case"button":case"input":case"select":case"textarea":ve.autoFocus&&w.focus();break;case"img":ve.src&&(w.src=ve.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(_.memoizedState===null){var Ke=_.alternate;if(Ke!==null){var ut=Ke.memoizedState;if(ut!==null){var ht=ut.dehydrated;ht!==null&&kh(ht)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(s(163))}Os||_.flags&512&&FS(_)}catch(at){Ti(_,_.return,at)}}if(_===p){Nt=null;break}if(w=_.sibling,w!==null){w.return=_.return,Nt=w;break}Nt=_.return}}function q_(p){for(;Nt!==null;){var _=Nt;if(_===p){Nt=null;break}var w=_.sibling;if(w!==null){w.return=_.return,Nt=w;break}Nt=_.return}}function ER(p){for(;Nt!==null;){var _=Nt;try{switch(_.tag){case 0:case 11:case 15:var w=_.return;try{Y_(4,_)}catch(ve){Ti(_,w,ve)}break;case 1:var O=_.stateNode;if(typeof O.componentDidMount=="function"){var U=_.return;try{O.componentDidMount()}catch(ve){Ti(_,U,ve)}}var G=_.return;try{FS(_)}catch(ve){Ti(_,G,ve)}break;case 5:var ee=_.return;try{FS(_)}catch(ve){Ti(_,ee,ve)}}}catch(ve){Ti(_,_.return,ve)}if(_===p){Nt=null;break}var me=_.sibling;if(me!==null){me.return=_.return,Nt=me;break}Nt=_.return}}var lP=Math.ceil,Uu=ae.ReactCurrentDispatcher,X_=ae.ReactCurrentOwner,Vs=ae.ReactCurrentBatchConfig,qn=0,ls=null,Ni=null,es=0,zo=0,rp=Ga(0),us=0,ip=null,Kd=0,J_=0,KS=0,Yd=null,Bi=null,YS=0,la=1/0,Dc=null,Fs=!1,qS=null,Vu=null,hm=!1,Fu=null,pm=0,sp=0,XS=null,fm=-1,$_=0;function so(){return(qn&6)!==0?gr():fm!==-1?fm:fm=gr()}function ju(p){return(p.mode&1)===0?1:(qn&2)!==0&&es!==0?es&-es:Jf.transition!==null?($_===0&&($_=iC()),$_):(p=Tr,p!==0||(p=window.event,p=p===void 0?16:lC(p.type)),p)}function Ko(p,_,w,O){if(50<sp)throw sp=0,XS=null,Error(s(185));Af(p,w,O),((qn&2)===0||p!==ls)&&(p===ls&&((qn&2)===0&&(J_|=w),us===4&&Bu(p,es)),js(p,O),w===1&&qn===0&&(_.mode&1)===0&&(la=gr()+500,v_&&Pu()))}function js(p,_){var w=p.callbackNode;rC(p,_);var O=Zg(p,p===ls?es:0);if(O===0)w!==null&&gl(w),p.callbackNode=null,p.callbackPriority=0;else if(_=O&-O,p.callbackPriority!==_){if(w!=null&&gl(w),_===1)p.tag===0?QN(Q_.bind(null,p)):nS(Q_.bind(null,p)),qN(function(){(qn&6)===0&&Pu()}),w=null;else{switch(bv(O)){case 1:w=Ur;break;case 4:w=bc;break;case 16:w=_l;break;case 536870912:w=sr;break;default:w=_l}w=nT(w,yR.bind(null,p))}p.callbackPriority=_,p.callbackNode=w}}function yR(p,_){if(fm=-1,$_=0,(qn&6)!==0)throw Error(s(327));var w=p.callbackNode;if(Gu()&&p.callbackNode!==w)return null;var O=Zg(p,p===ls?es:0);if(O===0)return null;if((O&30)!==0||(O&p.expiredLanes)!==0||_)_=_m(p,O);else{_=O;var U=qn;qn|=2;var G=QS();(ls!==p||es!==_)&&(Dc=null,la=gr()+500,kl(p,_));do try{dP();break}catch(me){$S(p,me)}while(!0);cS(),Uu.current=G,qn=U,Ni!==null?_=0:(ls=null,es=0,_=us)}if(_!==0){if(_===2&&(U=wv(p),U!==0&&(O=U,_=mm(p,U))),_===1)throw w=ip,kl(p,0),Bu(p,O),js(p,gr()),w;if(_===6)Bu(p,O);else{if(U=p.current.alternate,(O&30)===0&&!vR(U)&&(_=_m(p,O),_===2&&(G=wv(p),G!==0&&(O=G,_=mm(p,G))),_===1))throw w=ip,kl(p,0),Bu(p,O),js(p,gr()),w;switch(p.finishedWork=U,p.finishedLanes=O,_){case 0:case 1:throw Error(s(345));case 2:ua(p,Bi,Dc);break;case 3:if(Bu(p,O),(O&130023424)===O&&(_=YS+500-gr(),10<_)){if(Zg(p,0)!==0)break;if(U=p.suspendedLanes,(U&O)!==O){so(),p.pingedLanes|=p.suspendedLanes&U;break}p.timeoutHandle=Qv(ua.bind(null,p,Bi,Dc),_);break}ua(p,Bi,Dc);break;case 4:if(Bu(p,O),(O&4194240)===O)break;for(_=p.eventTimes,U=-1;0<O;){var ee=31-_r(O);G=1<<ee,ee=_[ee],ee>U&&(U=ee),O&=~G}if(O=U,O=gr()-O,O=(120>O?120:480>O?480:1080>O?1080:1920>O?1920:3e3>O?3e3:4320>O?4320:1960*lP(O/1960))-O,10<O){p.timeoutHandle=Qv(ua.bind(null,p,Bi,Dc),O);break}ua(p,Bi,Dc);break;case 5:ua(p,Bi,Dc);break;default:throw Error(s(329))}}}return js(p,gr()),p.callbackNode===w?yR.bind(null,p):null}function mm(p,_){var w=Yd;return p.current.memoizedState.isDehydrated&&(kl(p,_).flags|=256),p=_m(p,_),p!==2&&(_=Bi,Bi=w,_!==null&&JS(_)),p}function JS(p){Bi===null?Bi=p:Bi.push.apply(Bi,p)}function vR(p){for(var _=p;;){if(_.flags&16384){var w=_.updateQueue;if(w!==null&&(w=w.stores,w!==null))for(var O=0;O<w.length;O++){var U=w[O],G=U.getSnapshot;U=U.value;try{if(!Ba(G(),U))return!1}catch{return!1}}}if(w=_.child,_.subtreeFlags&16384&&w!==null)w.return=_,_=w;else{if(_===p)break;for(;_.sibling===null;){if(_.return===null||_.return===p)return!0;_=_.return}_.sibling.return=_.return,_=_.sibling}}return!0}function Bu(p,_){for(_&=~KS,_&=~J_,p.suspendedLanes|=_,p.pingedLanes&=~_,p=p.expirationTimes;0<_;){var w=31-_r(_),O=1<<w;p[w]=-1,_&=~O}}function Q_(p){if((qn&6)!==0)throw Error(s(327));Gu();var _=Zg(p,0);if((_&1)===0)return js(p,gr()),null;var w=_m(p,_);if(p.tag!==0&&w===2){var O=wv(p);O!==0&&(_=O,w=mm(p,O))}if(w===1)throw w=ip,kl(p,0),Bu(p,_),js(p,gr()),w;if(w===6)throw Error(s(345));return p.finishedWork=p.current.alternate,p.finishedLanes=_,ua(p,Bi,Dc),js(p,gr()),null}function qd(p,_){var w=qn;qn|=1;try{return p(_)}finally{qn=w,qn===0&&(la=gr()+500,v_&&Pu())}}function Wu(p){Fu!==null&&Fu.tag===0&&(qn&6)===0&&Gu();var _=qn;qn|=1;var w=Vs.transition,O=Tr;try{if(Vs.transition=null,Tr=1,p)return p()}finally{Tr=O,Vs.transition=w,qn=_,(qn&6)===0&&Pu()}}function gm(){zo=rp.current,Hr(rp)}function kl(p,_){p.finishedWork=null,p.finishedLanes=0;var w=p.timeoutHandle;if(w!==-1&&(p.timeoutHandle=-1,YN(w)),Ni!==null)for(w=Ni.return;w!==null;){var O=w;switch(w_(O),O.tag){case 1:O=O.type.childContextTypes,O!=null&&E_();break;case 3:jd(),Hr(no),Hr(Ms),gS();break;case 5:fS(O);break;case 4:jd();break;case 13:Hr(Si);break;case 19:Hr(Si);break;case 10:lS(O.type._context);break;case 22:case 23:gm()}w=w.return}if(ls=p,Ni=p=Hu(p.current,null),es=zo=_,us=0,ip=null,KS=J_=Kd=0,Bi=Yd=null,Vd!==null){for(_=0;_<Vd.length;_++)if(w=Vd[_],O=w.interleaved,O!==null){w.interleaved=null;var U=O.next,G=w.pending;if(G!==null){var ee=G.next;G.next=U,O.next=ee}w.pending=O}Vd=null}return p}function $S(p,_){do{var w=Ni;try{if(cS(),em.current=tp,tm){for(var O=gi.memoizedState;O!==null;){var U=O.queue;U!==null&&(U.pending=null),O=O.next}tm=!1}if(Bd=0,ji=cs=gi=null,Al=!1,nm=0,X_.current=null,w===null||w.return===null){us=1,ip=_,Ni=null;break}e:{var G=p,ee=w.return,me=w,ve=_;if(_=es,me.flags|=32768,ve!==null&&typeof ve=="object"&&typeof ve.then=="function"){var Ke=ve,ut=me,ht=ut.tag;if((ut.mode&1)===0&&(ht===0||ht===11||ht===15)){var at=ut.alternate;at?(ut.updateQueue=at.updateQueue,ut.memoizedState=at.memoizedState,ut.lanes=at.lanes):(ut.updateQueue=null,ut.memoizedState=null)}var bt=iR(ee);if(bt!==null){bt.flags&=-257,sR(bt,ee,me,G,_),bt.mode&1&&NS(G,Ke,_),_=bt,ve=Ke;var Bt=_.updateQueue;if(Bt===null){var Ht=new Set;Ht.add(ve),_.updateQueue=Ht}else Bt.add(ve);break e}else{if((_&1)===0){NS(G,Ke,_),op();break e}ve=Error(s(426))}}else if(si&&me.mode&1){var Wi=iR(ee);if(Wi!==null){(Wi.flags&65536)===0&&(Wi.flags|=256),sR(Wi,ee,me,G,_),Jh(np(ve,me));break e}}G=ve=np(ve,me),us!==4&&(us=2),Yd===null?Yd=[G]:Yd.push(G),G=ee;do{switch(G.tag){case 3:G.flags|=65536,_&=-_,G.lanes|=_;var Le=OS(G,ve,_);GC(G,Le);break e;case 1:me=ve;var we=G.type,Be=G.stateNode;if((G.flags&128)===0&&(typeof we.getDerivedStateFromError=="function"||Be!==null&&typeof Be.componentDidCatch=="function"&&(Vu===null||!Vu.has(Be)))){G.flags|=65536,_&=-_,G.lanes|=_;var ft=rR(G,me,_);GC(G,ft);break e}}G=G.return}while(G!==null)}eT(w)}catch(qt){_=qt,Ni===w&&w!==null&&(Ni=w=w.return);continue}break}while(!0)}function QS(){var p=Uu.current;return Uu.current=tp,p===null?tp:p}function op(){(us===0||us===3||us===2)&&(us=4),ls===null||(Kd&268435455)===0&&(J_&268435455)===0||Bu(ls,es)}function _m(p,_){var w=qn;qn|=2;var O=QS();(ls!==p||es!==_)&&(Dc=null,kl(p,_));do try{uP();break}catch(U){$S(p,U)}while(!0);if(cS(),qn=w,Uu.current=O,Ni!==null)throw Error(s(261));return ls=null,es=0,us}function uP(){for(;Ni!==null;)ZS(Ni)}function dP(){for(;Ni!==null&&!Pd();)ZS(Ni)}function ZS(p){var _=wR(p.alternate,p,zo);p.memoizedProps=p.pendingProps,_===null?eT(p):Ni=_,X_.current=null}function eT(p){var _=p;do{var w=_.alternate;if(p=_.return,(_.flags&32768)===0){if(w=K_(w,_,zo),w!==null){Ni=w;return}}else{if(w=sP(w,_),w!==null){w.flags&=32767,Ni=w;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{us=6,Ni=null;return}}if(_=_.sibling,_!==null){Ni=_;return}Ni=_=p}while(_!==null);us===0&&(us=5)}function ua(p,_,w){var O=Tr,U=Vs.transition;try{Vs.transition=null,Tr=1,tT(p,_,w,O)}finally{Vs.transition=U,Tr=O}return null}function tT(p,_,w,O){do Gu();while(Fu!==null);if((qn&6)!==0)throw Error(s(327));w=p.finishedWork;var U=p.finishedLanes;if(w===null)return null;if(p.finishedWork=null,p.finishedLanes=0,w===p.current)throw Error(s(177));p.callbackNode=null,p.callbackPriority=0;var G=w.lanes|w.childLanes;if(gN(p,G),p===ls&&(Ni=ls=null,es=0),(w.subtreeFlags&2064)===0&&(w.flags&2064)===0||hm||(hm=!0,nT(_l,function(){return Gu(),null})),G=(w.flags&15990)!==0,(w.subtreeFlags&15990)!==0||G){G=Vs.transition,Vs.transition=null;var ee=Tr;Tr=1;var me=qn;qn|=4,X_.current=null,aP(p,w),GS(w,p),WN(m_),i_=!!$v,m_=$v=null,p.current=w,cP(w),Zi(),qn=me,Tr=ee,Vs.transition=G}else p.current=w;if(hm&&(hm=!1,Fu=p,pm=U),G=p.pendingLanes,G===0&&(Vu=null),mu(w.stateNode),js(p,gr()),_!==null)for(O=p.onRecoverableError,w=0;w<_.length;w++)U=_[w],O(U.value,{componentStack:U.stack,digest:U.digest});if(Fs)throw Fs=!1,p=qS,qS=null,p;return(pm&1)!==0&&p.tag!==0&&Gu(),G=p.pendingLanes,(G&1)!==0?p===XS?sp++:(sp=0,XS=p):sp=0,Pu(),null}function Gu(){if(Fu!==null){var p=bv(pm),_=Vs.transition,w=Tr;try{if(Vs.transition=null,Tr=16>p?16:p,Fu===null)var O=!1;else{if(p=Fu,Fu=null,pm=0,(qn&6)!==0)throw Error(s(331));var U=qn;for(qn|=4,Nt=p.current;Nt!==null;){var G=Nt,ee=G.child;if((Nt.flags&16)!==0){var me=G.deletions;if(me!==null){for(var ve=0;ve<me.length;ve++){var Ke=me[ve];for(Nt=Ke;Nt!==null;){var ut=Nt;switch(ut.tag){case 0:case 11:case 15:Lu(8,ut,G)}var ht=ut.child;if(ht!==null)ht.return=ut,Nt=ht;else for(;Nt!==null;){ut=Nt;var at=ut.sibling,bt=ut.return;if(mR(ut),ut===Ke){Nt=null;break}if(at!==null){at.return=bt,Nt=at;break}Nt=bt}}}var Bt=G.alternate;if(Bt!==null){var Ht=Bt.child;if(Ht!==null){Bt.child=null;do{var Wi=Ht.sibling;Ht.sibling=null,Ht=Wi}while(Ht!==null)}}Nt=G}}if((G.subtreeFlags&2064)!==0&&ee!==null)ee.return=G,Nt=ee;else e:for(;Nt!==null;){if(G=Nt,(G.flags&2048)!==0)switch(G.tag){case 0:case 11:case 15:Lu(9,G,G.return)}var Le=G.sibling;if(Le!==null){Le.return=G.return,Nt=Le;break e}Nt=G.return}}var we=p.current;for(Nt=we;Nt!==null;){ee=Nt;var Be=ee.child;if((ee.subtreeFlags&2064)!==0&&Be!==null)Be.return=ee,Nt=Be;else e:for(ee=we;Nt!==null;){if(me=Nt,(me.flags&2048)!==0)try{switch(me.tag){case 0:case 11:case 15:Y_(9,me)}}catch(qt){Ti(me,me.return,qt)}if(me===ee){Nt=null;break e}var ft=me.sibling;if(ft!==null){ft.return=me.return,Nt=ft;break e}Nt=me.return}}if(qn=U,Pu(),bs&&typeof bs.onPostCommitFiberRoot=="function")try{bs.onPostCommitFiberRoot(Dr,p)}catch{}O=!0}return O}finally{Tr=w,Vs.transition=_}}return!1}function Z_(p,_,w){_=np(w,_),_=OS(p,_,1),p=Ka(p,_,1),_=so(),p!==null&&(Af(p,1,_),js(p,_))}function Ti(p,_,w){if(p.tag===3)Z_(p,p,w);else for(;_!==null;){if(_.tag===3){Z_(_,p,w);break}else if(_.tag===1){var O=_.stateNode;if(typeof _.type.getDerivedStateFromError=="function"||typeof O.componentDidCatch=="function"&&(Vu===null||!Vu.has(O))){p=np(w,p),p=rR(_,p,1),_=Ka(_,p,1),p=so(),_!==null&&(Af(_,1,p),js(_,p));break}}_=_.return}}function SR(p,_,w){var O=p.pingCache;O!==null&&O.delete(_),_=so(),p.pingedLanes|=p.suspendedLanes&w,ls===p&&(es&w)===w&&(us===4||us===3&&(es&130023424)===es&&500>gr()-YS?kl(p,0):KS|=w),js(p,_)}function TR(p,_){_===0&&((p.mode&1)===0?_=1:(_=Qg,Qg<<=1,(Qg&130023424)===0&&(Qg=4194304)));var w=so();p=Rl(p,_),p!==null&&(Af(p,_,w),js(p,w))}function hP(p){var _=p.memoizedState,w=0;_!==null&&(w=_.retryLane),TR(p,w)}function ap(p,_){var w=0;switch(p.tag){case 13:var O=p.stateNode,U=p.memoizedState;U!==null&&(w=U.retryLane);break;case 19:O=p.stateNode;break;default:throw Error(s(314))}O!==null&&O.delete(_),TR(p,w)}var wR;wR=function(p,_,w){if(p!==null)if(p.memoizedProps!==_.pendingProps||no.current)Ro=!0;else{if((p.lanes&w)===0&&(_.flags&128)===0)return Ro=!1,G_(p,_,w);Ro=(p.flags&131072)!==0}else Ro=!1,si&&(_.flags&1048576)!==0&&VC(_,T_,_.index);switch(_.lanes=0,_.tag){case 2:var O=_.type;W_(p,_),p=_.pendingProps;var U=Nu(_,Ms.current);za(_,w),U=Zh(null,_,O,p,U,w);var G=yS();return _.flags|=1,typeof U=="object"&&U!==null&&typeof U.render=="function"&&U.$$typeof===void 0?(_.tag=1,_.memoizedState=null,_.updateQueue=null,wo(O)?(G=!0,y_(_)):G=!1,_.memoizedState=U.state!==null&&U.state!==void 0?U.state:null,hS(_),U.updater=V_,_.stateNode=U,U._reactInternals=_,bS(_,O,p,w),_=DS(null,_,O,!0,G,w)):(_.tag=0,si&&G&&qh(_),io(null,_,U,w),_=_.child),_;case 16:O=_.elementType;e:{switch(W_(p,_),p=_.pendingProps,U=O._init,O=U(O._payload),_.type=O,U=_.tag=pP(O),p=ca(O,p),U){case 0:_=kS(null,_,O,p,w);break e;case 1:_=lR(null,_,O,p,w);break e;case 11:_=oR(null,_,O,p,w);break e;case 14:_=aR(null,_,O,ca(O.type,p),w);break e}throw Error(s(306,O,""))}return _;case 0:return O=_.type,U=_.pendingProps,U=_.elementType===O?U:ca(O,U),kS(p,_,O,U,w);case 1:return O=_.type,U=_.pendingProps,U=_.elementType===O?U:ca(O,U),lR(p,_,O,U,w);case 3:e:{if(uR(_),p===null)throw Error(s(387));O=_.pendingProps,G=_.memoizedState,U=G.element,WC(p,_),O_(_,O,null,w);var ee=_.memoizedState;if(O=ee.element,G.isDehydrated)if(G={element:O,isDehydrated:!1,cache:ee.cache,pendingSuspenseBoundaries:ee.pendingSuspenseBoundaries,transitions:ee.transitions},_.updateQueue.baseState=G,_.memoizedState=G,_.flags&256){U=np(Error(s(423)),_),_=dR(p,_,O,w,U);break e}else if(O!==U){U=np(Error(s(424)),_),_=dR(p,_,O,w,U);break e}else for(Go=Ac(_.stateNode.containerInfo.firstChild),Wo=_,si=!0,Ha=null,w=oS(_,null,O,w),_.child=w;w;)w.flags=w.flags&-3|4096,w=w.sibling;else{if(Ud(),O===U){_=Pl(p,_,w);break e}io(p,_,O,w)}_=_.child}return _;case 5:return zC(_),p===null&&Xf(_),O=_.type,U=_.pendingProps,G=p!==null?p.memoizedProps:null,ee=U.children,Hh(O,U)?ee=null:G!==null&&Hh(O,G)&&(_.flags|=32),cR(p,_),io(p,_,ee,w),_.child;case 6:return p===null&&Xf(_),null;case 13:return hR(p,_,w);case 4:return pS(_,_.stateNode.containerInfo),O=_.pendingProps,p===null?_.child=$h(_,null,O,w):io(p,_,O,w),_.child;case 11:return O=_.type,U=_.pendingProps,U=_.elementType===O?U:ca(O,U),oR(p,_,O,U,w);case 7:return io(p,_,_.pendingProps,w),_.child;case 8:return io(p,_,_.pendingProps.children,w),_.child;case 12:return io(p,_,_.pendingProps.children,w),_.child;case 10:e:{if(O=_.type._context,U=_.pendingProps,G=_.memoizedProps,ee=U.value,Zr(R_,O._currentValue),O._currentValue=ee,G!==null)if(Ba(G.value,ee)){if(G.children===U.children&&!no.current){_=Pl(p,_,w);break e}}else for(G=_.child,G!==null&&(G.return=_);G!==null;){var me=G.dependencies;if(me!==null){ee=G.child;for(var ve=me.firstContext;ve!==null;){if(ve.context===O){if(G.tag===1){ve=Il(-1,w&-w),ve.tag=2;var Ke=G.updateQueue;if(Ke!==null){Ke=Ke.shared;var ut=Ke.pending;ut===null?ve.next=ve:(ve.next=ut.next,ut.next=ve),Ke.pending=ve}}G.lanes|=w,ve=G.alternate,ve!==null&&(ve.lanes|=w),I_(G.return,w,_),me.lanes|=w;break}ve=ve.next}}else if(G.tag===10)ee=G.type===_.type?null:G.child;else if(G.tag===18){if(ee=G.return,ee===null)throw Error(s(341));ee.lanes|=w,me=ee.alternate,me!==null&&(me.lanes|=w),I_(ee,w,_),ee=G.sibling}else ee=G.child;if(ee!==null)ee.return=G;else for(ee=G;ee!==null;){if(ee===_){ee=null;break}if(G=ee.sibling,G!==null){G.return=ee.return,ee=G;break}ee=ee.return}G=ee}io(p,_,U.children,w),_=_.child}return _;case 9:return U=_.type,O=_.pendingProps.children,za(_,w),U=aa(U),O=O(U),_.flags|=1,io(p,_,O,w),_.child;case 14:return O=_.type,U=ca(O,_.pendingProps),U=ca(O.type,U),aR(p,_,O,U,w);case 15:return PS(p,_,_.type,_.pendingProps,w);case 17:return O=_.type,U=_.pendingProps,U=_.elementType===O?U:ca(O,U),W_(p,_),_.tag=1,wo(O)?(p=!0,y_(_)):p=!1,za(_,w),tR(_,O,U),bS(_,O,U,w),DS(null,_,O,!0,p,w);case 19:return MS(p,_,w);case 22:return Pc(p,_,w)}throw Error(s(156,_.tag))};function nT(p,_){return Ar(p,_)}function rT(p,_,w,O){this.tag=p,this.key=w,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=_,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=O,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function da(p,_,w,O){return new rT(p,_,w,O)}function iT(p){return p=p.prototype,!(!p||!p.isReactComponent)}function pP(p){if(typeof p=="function")return iT(p)?1:0;if(p!=null){if(p=p.$$typeof,p===ye)return 11;if(p===Fe)return 14}return 2}function Hu(p,_){var w=p.alternate;return w===null?(w=da(p.tag,_,p.key,p.mode),w.elementType=p.elementType,w.type=p.type,w.stateNode=p.stateNode,w.alternate=p,p.alternate=w):(w.pendingProps=_,w.type=p.type,w.flags=0,w.subtreeFlags=0,w.deletions=null),w.flags=p.flags&14680064,w.childLanes=p.childLanes,w.lanes=p.lanes,w.child=p.child,w.memoizedProps=p.memoizedProps,w.memoizedState=p.memoizedState,w.updateQueue=p.updateQueue,_=p.dependencies,w.dependencies=_===null?null:{lanes:_.lanes,firstContext:_.firstContext},w.sibling=p.sibling,w.index=p.index,w.ref=p.ref,w}function cp(p,_,w,O,U,G){var ee=2;if(O=p,typeof p=="function")iT(p)&&(ee=1);else if(typeof p=="string")ee=5;else e:switch(p){case ne:return zu(w.children,U,G,_);case fe:ee=8,U|=8;break;case Se:return p=da(12,w,_,U|2),p.elementType=Se,p.lanes=G,p;case Ge:return p=da(13,w,_,U),p.elementType=Ge,p.lanes=G,p;case Te:return p=da(19,w,_,U),p.elementType=Te,p.lanes=G,p;case je:return Em(w,U,G,_);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case De:ee=10;break e;case be:ee=9;break e;case ye:ee=11;break e;case Fe:ee=14;break e;case Je:ee=16,O=null;break e}throw Error(s(130,p==null?p:typeof p,""))}return _=da(ee,w,_,U),_.elementType=p,_.type=O,_.lanes=G,_}function zu(p,_,w,O){return p=da(7,p,O,_),p.lanes=w,p}function Em(p,_,w,O){return p=da(22,p,O,_),p.elementType=je,p.lanes=w,p.stateNode={isHidden:!1},p}function eE(p,_,w){return p=da(6,p,null,_),p.lanes=w,p}function lp(p,_,w){return _=da(4,p.children!==null?p.children:[],p.key,_),_.lanes=w,_.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},_}function sT(p,_,w,O,U){this.tag=_,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Cv(0),this.expirationTimes=Cv(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Cv(0),this.identifierPrefix=O,this.onRecoverableError=U,this.mutableSourceEagerHydrationData=null}function up(p,_,w,O,U,G,ee,me,ve){return p=new sT(p,_,w,me,ve),_===1?(_=1,G===!0&&(_|=8)):_=0,G=da(3,null,null,_),p.current=G,G.stateNode=p,G.memoizedState={element:O,isDehydrated:w,cache:null,transitions:null,pendingSuspenseBoundaries:null},hS(G),p}function tE(p,_,w){var O=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:le,key:O==null?null:""+O,children:p,containerInfo:_,implementation:w}}function oT(p){if(!p)return Au;p=p._reactInternals;e:{if(Vt(p)!==p||p.tag!==1)throw Error(s(170));var _=p;do{switch(_.tag){case 3:_=_.stateNode.context;break e;case 1:if(wo(_.type)){_=_.stateNode.__reactInternalMemoizedMergedChildContext;break e}}_=_.return}while(_!==null);throw Error(s(171))}if(p.tag===1){var w=p.type;if(wo(w))return MC(p,w,_)}return _}function Xd(p,_,w,O,U,G,ee,me,ve){return p=up(w,O,!0,p,U,G,ee,me,ve),p.context=oT(null),w=p.current,O=so(),U=ju(w),G=Il(O,U),G.callback=_??null,Ka(w,G,U),p.current.lanes=U,Af(p,U,O),js(p,O),p}function xc(p,_,w,O){var U=_.current,G=so(),ee=ju(U);return w=oT(w),_.context===null?_.context=w:_.pendingContext=w,_=Il(G,ee),_.payload={element:p},O=O===void 0?null:O,O!==null&&(_.callback=O),p=Ka(U,_,ee),p!==null&&(Ko(p,U,ee,G),A_(p,U,ee)),ee}function nE(p){return p=p.current,p.child?(p.child.tag===5,p.child.stateNode):null}function dp(p,_){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var w=p.retryLane;p.retryLane=w!==0&&w<_?w:_}}function aT(p,_){dp(p,_),(p=p.alternate)&&dp(p,_)}function fP(){return null}var CR=typeof reportError=="function"?reportError:function(p){console.error(p)};function cT(p){this._internalRoot=p}ym.prototype.render=cT.prototype.render=function(p){var _=this._internalRoot;if(_===null)throw Error(s(409));xc(p,_,null,null)},ym.prototype.unmount=cT.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var _=p.containerInfo;Wu(function(){xc(null,p,null,null)}),_[vl]=null}};function ym(p){this._internalRoot=p}ym.prototype.unstable_scheduleHydration=function(p){if(p){var _=sC();p={blockedOn:null,target:p,priority:_};for(var w=0;w<Su.length&&_!==0&&_<Su[w].priority;w++);Su.splice(w,0,p),w===0&&Ph(p)}};function vm(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function Sm(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function RR(){}function bR(p,_,w,O,U){if(U){if(typeof O=="function"){var G=O;O=function(){var Ke=nE(ee);G.call(Ke)}}var ee=Xd(_,O,p,0,null,!1,!1,"",RR);return p._reactRootContainer=ee,p[vl]=ee.current,yl(p.nodeType===8?p.parentNode:p),Wu(),ee}for(;U=p.lastChild;)p.removeChild(U);if(typeof O=="function"){var me=O;O=function(){var Ke=nE(ve);me.call(Ke)}}var ve=up(p,0,!1,null,null,!1,!1,"",RR);return p._reactRootContainer=ve,p[vl]=ve.current,yl(p.nodeType===8?p.parentNode:p),Wu(function(){xc(_,ve,w,O)}),ve}function rE(p,_,w,O,U){var G=w._reactRootContainer;if(G){var ee=G;if(typeof U=="function"){var me=U;U=function(){var ve=nE(ee);me.call(ve)}}xc(_,ee,p,U)}else ee=bR(w,_,p,U,O);return nE(ee)}e_=function(p){switch(p.tag){case 3:var _=p.stateNode;if(_.current.memoizedState.isDehydrated){var w=Er(_.pendingLanes);w!==0&&(Rv(_,w|1),js(_,gr()),(qn&6)===0&&(la=gr()+500,Pu()))}break;case 13:Wu(function(){var O=Rl(p,1);if(O!==null){var U=so();Ko(O,p,1,U)}}),aT(p,1)}},Iv=function(p){if(p.tag===13){var _=Rl(p,134217728);if(_!==null){var w=so();Ko(_,p,134217728,w)}aT(p,134217728)}},t_=function(p){if(p.tag===13){var _=ju(p),w=Rl(p,_);if(w!==null){var O=so();Ko(w,p,_,O)}aT(p,_)}},sC=function(){return Tr},Av=function(p,_){var w=Tr;try{return Tr=p,_()}finally{Tr=w}},ml=function(p,_,w){switch(_){case"input":if(Cc(p,w),_=w.name,w.type==="radio"&&_!=null){for(w=p;w.parentNode;)w=w.parentNode;for(w=w.querySelectorAll("input[name="+JSON.stringify(""+_)+'][type="radio"]'),_=0;_<w.length;_++){var O=w[_];if(O!==p&&O.form===p.form){var U=__(O);if(!U)throw Error(s(90));Jr(O),Cc(O,U)}}}break;case"textarea":Ir(p,w);break;case"select":_=w.value,_!=null&&gs(p,!!w.multiple,_,!1)}},Wn=qd,mr=Wu;var Tm={usingClientEntryPoint:!1,Events:[Yf,zh,__,ja,mn,qd]},bo={findFiberByHostInstance:xd,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},IR={bundleType:bo.bundleType,version:bo.version,rendererPackageName:bo.rendererPackageName,rendererConfig:bo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ae.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=Sr(p),p===null?null:p.stateNode},findFiberByHostInstance:bo.findFiberByHostInstance||fP,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var iE=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!iE.isDisabled&&iE.supportsFiber)try{Dr=iE.inject(IR),bs=iE}catch{}}return Ra.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Tm,Ra.createPortal=function(p,_){var w=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!vm(_))throw Error(s(200));return tE(p,_,null,w)},Ra.createRoot=function(p,_){if(!vm(p))throw Error(s(299));var w=!1,O="",U=CR;return _!=null&&(_.unstable_strictMode===!0&&(w=!0),_.identifierPrefix!==void 0&&(O=_.identifierPrefix),_.onRecoverableError!==void 0&&(U=_.onRecoverableError)),_=up(p,1,!1,null,null,w,!1,O,U),p[vl]=_.current,yl(p.nodeType===8?p.parentNode:p),new cT(_)},Ra.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var _=p._reactInternals;if(_===void 0)throw typeof p.render=="function"?Error(s(188)):(p=Object.keys(p).join(","),Error(s(268,p)));return p=Sr(_),p=p===null?null:p.stateNode,p},Ra.flushSync=function(p){return Wu(p)},Ra.hydrate=function(p,_,w){if(!Sm(_))throw Error(s(200));return rE(null,p,_,!0,w)},Ra.hydrateRoot=function(p,_,w){if(!vm(p))throw Error(s(405));var O=w!=null&&w.hydratedSources||null,U=!1,G="",ee=CR;if(w!=null&&(w.unstable_strictMode===!0&&(U=!0),w.identifierPrefix!==void 0&&(G=w.identifierPrefix),w.onRecoverableError!==void 0&&(ee=w.onRecoverableError)),_=Xd(_,null,p,1,w??null,U,!1,G,ee),p[vl]=_.current,yl(p),O)for(p=0;p<O.length;p++)w=O[p],U=w._getVersion,U=U(w._source),_.mutableSourceEagerHydrationData==null?_.mutableSourceEagerHydrationData=[w,U]:_.mutableSourceEagerHydrationData.push(w,U);return new ym(_)},Ra.render=function(p,_,w){if(!Sm(_))throw Error(s(200));return rE(null,p,_,!1,w)},Ra.unmountComponentAtNode=function(p){if(!Sm(p))throw Error(s(40));return p._reactRootContainer?(Wu(function(){rE(null,null,p,!1,function(){p._reactRootContainer=null,p[vl]=null})}),!0):!1},Ra.unstable_batchedUpdates=qd,Ra.unstable_renderSubtreeIntoContainer=function(p,_,w,O){if(!Sm(w))throw Error(s(200));if(p==null||p._reactInternals===void 0)throw Error(s(38));return rE(p,_,w,!1,O)},Ra.version="18.3.1-next-f1338f8080-20240426",Ra}var lK;function cX(){if(lK)return kx.exports;lK=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(n){console.error(n)}}return i(),kx.exports=Vme(),kx.exports}var uK;function Fme(){if(uK)return QI;uK=1;var i=cX();return QI.createRoot=i.createRoot,QI.hydrateRoot=i.hydrateRoot,QI}var jme=Fme(),H=v2();const vt=IO(H),S2=aX({__proto__:null,default:vt},[H]),Bme=1,Wme=1e6;let Lx=0;function Gme(){return Lx=(Lx+1)%Number.MAX_SAFE_INTEGER,Lx.toString()}const Mx=new Map,dK=i=>{if(Mx.has(i))return;const n=setTimeout(()=>{Mx.delete(i),G0({type:"REMOVE_TOAST",toastId:i})},Wme);Mx.set(i,n)},Hme=(i,n)=>{switch(n.type){case"ADD_TOAST":return{...i,toasts:[n.toast,...i.toasts].slice(0,Bme)};case"UPDATE_TOAST":return{...i,toasts:i.toasts.map(s=>s.id===n.toast.id?{...s,...n.toast}:s)};case"DISMISS_TOAST":{const{toastId:s}=n;return s?dK(s):i.toasts.forEach(a=>{dK(a.id)}),{...i,toasts:i.toasts.map(a=>a.id===s||s===void 0?{...a,open:!1}:a)}}case"REMOVE_TOAST":return n.toastId===void 0?{...i,toasts:[]}:{...i,toasts:i.toasts.filter(s=>s.id!==n.toastId)}}},_A=[];let EA={toasts:[]};function G0(i){EA=Hme(EA,i),_A.forEach(n=>{n(EA)})}function zme({...i}){const n=Gme(),s=l=>G0({type:"UPDATE_TOAST",toast:{...l,id:n}}),a=()=>G0({type:"DISMISS_TOAST",toastId:n});return G0({type:"ADD_TOAST",toast:{...i,id:n,open:!0,onOpenChange:l=>{l||a()}}}),{id:n,dismiss:a,update:s}}function T2(){const[i,n]=H.useState(EA);return H.useEffect(()=>(_A.push(n),()=>{const s=_A.indexOf(n);s>-1&&_A.splice(s,1)}),[i]),{...i,toast:zme,dismiss:s=>G0({type:"DISMISS_TOAST",toastId:s})}}var Uw=cX();const w2=IO(Uw),Kme=aX({__proto__:null,default:w2},[Uw]);function vr(i,n,{checkForDefaultPrevented:s=!0}={}){return function(l){if(i?.(l),s===!1||!l.defaultPrevented)return n?.(l)}}function hK(i,n){if(typeof i=="function")return i(n);i!=null&&(i.current=n)}function lX(...i){return n=>{let s=!1;const a=i.map(l=>{const d=hK(l,n);return!s&&typeof d=="function"&&(s=!0),d});if(s)return()=>{for(let l=0;l<a.length;l++){const d=a[l];typeof d=="function"?d():hK(i[l],null)}}}}function Xs(...i){return H.useCallback(lX(...i),i)}function Yme(i,n){const s=H.createContext(n),a=d=>{const{children:f,...E}=d,S=H.useMemo(()=>E,Object.values(E));return D.jsx(s.Provider,{value:S,children:f})};a.displayName=i+"Provider";function l(d){const f=H.useContext(s);if(f)return f;if(n!==void 0)return n;throw new Error(`\`${d}\` must be used within \`${i}\``)}return[a,l]}function Ef(i,n=[]){let s=[];function a(d,f){const E=H.createContext(f),S=s.length;s=[...s,f];const T=I=>{const{scope:N,children:P,...W}=I,x=N?.[i]?.[S]||E,B=H.useMemo(()=>W,Object.values(W));return D.jsx(x.Provider,{value:B,children:P})};T.displayName=d+"Provider";function C(I,N){const P=N?.[i]?.[S]||E,W=H.useContext(P);if(W)return W;if(f!==void 0)return f;throw new Error(`\`${I}\` must be used within \`${d}\``)}return[T,C]}const l=()=>{const d=s.map(f=>H.createContext(f));return function(E){const S=E?.[i]||d;return H.useMemo(()=>({[`__scope${i}`]:{...E,[i]:S}}),[E,S])}};return l.scopeName=i,[a,qme(l,...n)]}function qme(...i){const n=i[0];if(i.length===1)return n;const s=()=>{const a=i.map(l=>({useScope:l(),scopeName:l.scopeName}));return function(d){const f=a.reduce((E,{useScope:S,scopeName:T})=>{const I=S(d)[`__scope${T}`];return{...E,...I}},{});return H.useMemo(()=>({[`__scope${n.scopeName}`]:f}),[f])}};return s.scopeName=n.scopeName,s}function cw(i){const n=Jme(i),s=H.forwardRef((a,l)=>{const{children:d,...f}=a,E=H.Children.toArray(d),S=E.find(Qme);if(S){const T=S.props.children,C=E.map(I=>I===S?H.Children.count(T)>1?H.Children.only(null):H.isValidElement(T)?T.props.children:null:I);return D.jsx(n,{...f,ref:l,children:H.isValidElement(T)?H.cloneElement(T,void 0,C):null})}return D.jsx(n,{...f,ref:l,children:d})});return s.displayName=`${i}.Slot`,s}var Xme=cw("Slot");function Jme(i){const n=H.forwardRef((s,a)=>{const{children:l,...d}=s;if(H.isValidElement(l)){const f=ege(l),E=Zme(d,l.props);return l.type!==H.Fragment&&(E.ref=a?lX(a,f):f),H.cloneElement(l,E)}return H.Children.count(l)>1?H.Children.only(null):null});return n.displayName=`${i}.SlotClone`,n}var uX=Symbol("radix.slottable");function $me(i){const n=({children:s})=>D.jsx(D.Fragment,{children:s});return n.displayName=`${i}.Slottable`,n.__radixId=uX,n}function Qme(i){return H.isValidElement(i)&&typeof i.type=="function"&&"__radixId"in i.type&&i.type.__radixId===uX}function Zme(i,n){const s={...n};for(const a in n){const l=i[a],d=n[a];/^on[A-Z]/.test(a)?l&&d?s[a]=(...E)=>{const S=d(...E);return l(...E),S}:l&&(s[a]=l):a==="style"?s[a]={...l,...d}:a==="className"&&(s[a]=[l,d].filter(Boolean).join(" "))}return{...i,...s}}function ege(i){let n=Object.getOwnPropertyDescriptor(i.props,"ref")?.get,s=n&&"isReactWarning"in n&&n.isReactWarning;return s?i.ref:(n=Object.getOwnPropertyDescriptor(i,"ref")?.get,s=n&&"isReactWarning"in n&&n.isReactWarning,s?i.props.ref:i.props.ref||i.ref)}function dX(i){const n=i+"CollectionProvider",[s,a]=Ef(n),[l,d]=s(n,{collectionRef:{current:null},itemMap:new Map}),f=x=>{const{scope:B,children:X}=x,Z=vt.useRef(null),$=vt.useRef(new Map).current;return D.jsx(l,{scope:B,itemMap:$,collectionRef:Z,children:X})};f.displayName=n;const E=i+"CollectionSlot",S=cw(E),T=vt.forwardRef((x,B)=>{const{scope:X,children:Z}=x,$=d(E,X),ae=Xs(B,$.collectionRef);return D.jsx(S,{ref:ae,children:Z})});T.displayName=E;const C=i+"CollectionItemSlot",I="data-radix-collection-item",N=cw(C),P=vt.forwardRef((x,B)=>{const{scope:X,children:Z,...$}=x,ae=vt.useRef(null),ce=Xs(B,ae),le=d(C,X);return vt.useEffect(()=>(le.itemMap.set(ae,{ref:ae,...$}),()=>{le.itemMap.delete(ae)})),D.jsx(N,{[I]:"",ref:ce,children:Z})});P.displayName=C;function W(x){const B=d(i+"CollectionConsumer",x);return vt.useCallback(()=>{const Z=B.collectionRef.current;if(!Z)return[];const $=Array.from(Z.querySelectorAll(`[${I}]`));return Array.from(B.itemMap.values()).sort((le,ne)=>$.indexOf(le.ref.current)-$.indexOf(ne.ref.current))},[B.collectionRef,B.itemMap])}return[{Provider:f,Slot:T,ItemSlot:P},W,a]}var tge=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],ri=tge.reduce((i,n)=>{const s=cw(`Primitive.${n}`),a=H.forwardRef((l,d)=>{const{asChild:f,...E}=l,S=f?s:n;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),D.jsx(S,{...E,ref:d})});return a.displayName=`Primitive.${n}`,{...i,[n]:a}},{});function hX(i,n){i&&Uw.flushSync(()=>i.dispatchEvent(n))}function uu(i){const n=H.useRef(i);return H.useEffect(()=>{n.current=i}),H.useMemo(()=>(...s)=>n.current?.(...s),[])}function nge(i,n=globalThis?.document){const s=uu(i);H.useEffect(()=>{const a=l=>{l.key==="Escape"&&s(l)};return n.addEventListener("keydown",a,{capture:!0}),()=>n.removeEventListener("keydown",a,{capture:!0})},[s,n])}var rge="DismissableLayer",YL="dismissableLayer.update",ige="dismissableLayer.pointerDownOutside",sge="dismissableLayer.focusOutside",pK,pX=H.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),AO=H.forwardRef((i,n)=>{const{disableOutsidePointerEvents:s=!1,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:d,onInteractOutside:f,onDismiss:E,...S}=i,T=H.useContext(pX),[C,I]=H.useState(null),N=C?.ownerDocument??globalThis?.document,[,P]=H.useState({}),W=Xs(n,ne=>I(ne)),x=Array.from(T.layers),[B]=[...T.layersWithOutsidePointerEventsDisabled].slice(-1),X=x.indexOf(B),Z=C?x.indexOf(C):-1,$=T.layersWithOutsidePointerEventsDisabled.size>0,ae=Z>=X,ce=age(ne=>{const fe=ne.target,Se=[...T.branches].some(De=>De.contains(fe));!ae||Se||(l?.(ne),f?.(ne),ne.defaultPrevented||E?.())},N),le=cge(ne=>{const fe=ne.target;[...T.branches].some(De=>De.contains(fe))||(d?.(ne),f?.(ne),ne.defaultPrevented||E?.())},N);return nge(ne=>{Z===T.layers.size-1&&(a?.(ne),!ne.defaultPrevented&&E&&(ne.preventDefault(),E()))},N),H.useEffect(()=>{if(C)return s&&(T.layersWithOutsidePointerEventsDisabled.size===0&&(pK=N.body.style.pointerEvents,N.body.style.pointerEvents="none"),T.layersWithOutsidePointerEventsDisabled.add(C)),T.layers.add(C),fK(),()=>{s&&T.layersWithOutsidePointerEventsDisabled.size===1&&(N.body.style.pointerEvents=pK)}},[C,N,s,T]),H.useEffect(()=>()=>{C&&(T.layers.delete(C),T.layersWithOutsidePointerEventsDisabled.delete(C),fK())},[C,T]),H.useEffect(()=>{const ne=()=>P({});return document.addEventListener(YL,ne),()=>document.removeEventListener(YL,ne)},[]),D.jsx(ri.div,{...S,ref:W,style:{pointerEvents:$?ae?"auto":"none":void 0,...i.style},onFocusCapture:vr(i.onFocusCapture,le.onFocusCapture),onBlurCapture:vr(i.onBlurCapture,le.onBlurCapture),onPointerDownCapture:vr(i.onPointerDownCapture,ce.onPointerDownCapture)})});AO.displayName=rge;var oge="DismissableLayerBranch",fX=H.forwardRef((i,n)=>{const s=H.useContext(pX),a=H.useRef(null),l=Xs(n,a);return H.useEffect(()=>{const d=a.current;if(d)return s.branches.add(d),()=>{s.branches.delete(d)}},[s.branches]),D.jsx(ri.div,{...i,ref:l})});fX.displayName=oge;function age(i,n=globalThis?.document){const s=uu(i),a=H.useRef(!1),l=H.useRef(()=>{});return H.useEffect(()=>{const d=E=>{if(E.target&&!a.current){let S=function(){mX(ige,s,T,{discrete:!0})};const T={originalEvent:E};E.pointerType==="touch"?(n.removeEventListener("click",l.current),l.current=S,n.addEventListener("click",l.current,{once:!0})):S()}else n.removeEventListener("click",l.current);a.current=!1},f=window.setTimeout(()=>{n.addEventListener("pointerdown",d)},0);return()=>{window.clearTimeout(f),n.removeEventListener("pointerdown",d),n.removeEventListener("click",l.current)}},[n,s]),{onPointerDownCapture:()=>a.current=!0}}function cge(i,n=globalThis?.document){const s=uu(i),a=H.useRef(!1);return H.useEffect(()=>{const l=d=>{d.target&&!a.current&&mX(sge,s,{originalEvent:d},{discrete:!1})};return n.addEventListener("focusin",l),()=>n.removeEventListener("focusin",l)},[n,s]),{onFocusCapture:()=>a.current=!0,onBlurCapture:()=>a.current=!1}}function fK(){const i=new CustomEvent(YL);document.dispatchEvent(i)}function mX(i,n,s,{discrete:a}){const l=s.originalEvent.target,d=new CustomEvent(i,{bubbles:!1,cancelable:!0,detail:s});n&&l.addEventListener(i,n,{once:!0}),a?hX(l,d):l.dispatchEvent(d)}var lge=AO,uge=fX,_h=globalThis?.document?H.useLayoutEffect:()=>{},dge="Portal",C2=H.forwardRef((i,n)=>{const{container:s,...a}=i,[l,d]=H.useState(!1);_h(()=>d(!0),[]);const f=s||l&&globalThis?.document?.body;return f?w2.createPortal(D.jsx(ri.div,{...a,ref:n}),f):null});C2.displayName=dge;function hge(i,n){return H.useReducer((s,a)=>n[s][a]??s,i)}var Gg=i=>{const{present:n,children:s}=i,a=pge(n),l=typeof s=="function"?s({present:a.isPresent}):H.Children.only(s),d=Xs(a.ref,fge(l));return typeof s=="function"||a.isPresent?H.cloneElement(l,{ref:d}):null};Gg.displayName="Presence";function pge(i){const[n,s]=H.useState(),a=H.useRef(null),l=H.useRef(i),d=H.useRef("none"),f=i?"mounted":"unmounted",[E,S]=hge(f,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return H.useEffect(()=>{const T=ZI(a.current);d.current=E==="mounted"?T:"none"},[E]),_h(()=>{const T=a.current,C=l.current;if(C!==i){const N=d.current,P=ZI(T);i?S("MOUNT"):P==="none"||T?.display==="none"?S("UNMOUNT"):S(C&&N!==P?"ANIMATION_OUT":"UNMOUNT"),l.current=i}},[i,S]),_h(()=>{if(n){let T;const C=n.ownerDocument.defaultView??window,I=P=>{const x=ZI(a.current).includes(P.animationName);if(P.target===n&&x&&(S("ANIMATION_END"),!l.current)){const B=n.style.animationFillMode;n.style.animationFillMode="forwards",T=C.setTimeout(()=>{n.style.animationFillMode==="forwards"&&(n.style.animationFillMode=B)})}},N=P=>{P.target===n&&(d.current=ZI(a.current))};return n.addEventListener("animationstart",N),n.addEventListener("animationcancel",I),n.addEventListener("animationend",I),()=>{C.clearTimeout(T),n.removeEventListener("animationstart",N),n.removeEventListener("animationcancel",I),n.removeEventListener("animationend",I)}}else S("ANIMATION_END")},[n,S]),{isPresent:["mounted","unmountSuspended"].includes(E),ref:H.useCallback(T=>{a.current=T?getComputedStyle(T):null,s(T)},[])}}function ZI(i){return i?.animationName||"none"}function fge(i){let n=Object.getOwnPropertyDescriptor(i.props,"ref")?.get,s=n&&"isReactWarning"in n&&n.isReactWarning;return s?i.ref:(n=Object.getOwnPropertyDescriptor(i,"ref")?.get,s=n&&"isReactWarning"in n&&n.isReactWarning,s?i.props.ref:i.props.ref||i.ref)}var mge=S2[" useInsertionEffect ".trim().toString()]||_h;function Vw({prop:i,defaultProp:n,onChange:s=()=>{},caller:a}){const[l,d,f]=gge({defaultProp:n,onChange:s}),E=i!==void 0,S=E?i:l;{const C=H.useRef(i!==void 0);H.useEffect(()=>{const I=C.current;I!==E&&console.warn(`${a} is changing from ${I?"controlled":"uncontrolled"} to ${E?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),C.current=E},[E,a])}const T=H.useCallback(C=>{if(E){const I=_ge(C)?C(i):C;I!==i&&f.current?.(I)}else d(C)},[E,i,d,f]);return[S,T]}function gge({defaultProp:i,onChange:n}){const[s,a]=H.useState(i),l=H.useRef(s),d=H.useRef(n);return mge(()=>{d.current=n},[n]),H.useEffect(()=>{l.current!==s&&(d.current?.(s),l.current=s)},[s,l]),[s,a,d]}function _ge(i){return typeof i=="function"}var Ege=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),yge="VisuallyHidden",OO=H.forwardRef((i,n)=>D.jsx(ri.span,{...i,ref:n,style:{...Ege,...i.style}}));OO.displayName=yge;var vge=OO,R2="ToastProvider",[b2,Sge,Tge]=dX("Toast"),[gX]=Ef("Toast",[Tge]),[wge,NO]=gX(R2),_X=i=>{const{__scopeToast:n,label:s="Notification",duration:a=5e3,swipeDirection:l="right",swipeThreshold:d=50,children:f}=i,[E,S]=H.useState(null),[T,C]=H.useState(0),I=H.useRef(!1),N=H.useRef(!1);return s.trim()||console.error(`Invalid prop \`label\` supplied to \`${R2}\`. Expected non-empty \`string\`.`),D.jsx(b2.Provider,{scope:n,children:D.jsx(wge,{scope:n,label:s,duration:a,swipeDirection:l,swipeThreshold:d,toastCount:T,viewport:E,onViewportChange:S,onToastAdd:H.useCallback(()=>C(P=>P+1),[]),onToastRemove:H.useCallback(()=>C(P=>P-1),[]),isFocusedToastEscapeKeyDownRef:I,isClosePausedRef:N,children:f})})};_X.displayName=R2;var EX="ToastViewport",Cge=["F8"],qL="toast.viewportPause",XL="toast.viewportResume",yX=H.forwardRef((i,n)=>{const{__scopeToast:s,hotkey:a=Cge,label:l="Notifications ({hotkey})",...d}=i,f=NO(EX,s),E=Sge(s),S=H.useRef(null),T=H.useRef(null),C=H.useRef(null),I=H.useRef(null),N=Xs(n,I,f.onViewportChange),P=a.join("+").replace(/Key/g,"").replace(/Digit/g,""),W=f.toastCount>0;H.useEffect(()=>{const B=X=>{a.length!==0&&a.every($=>X[$]||X.code===$)&&I.current?.focus()};return document.addEventListener("keydown",B),()=>document.removeEventListener("keydown",B)},[a]),H.useEffect(()=>{const B=S.current,X=I.current;if(W&&B&&X){const Z=()=>{if(!f.isClosePausedRef.current){const le=new CustomEvent(qL);X.dispatchEvent(le),f.isClosePausedRef.current=!0}},$=()=>{if(f.isClosePausedRef.current){const le=new CustomEvent(XL);X.dispatchEvent(le),f.isClosePausedRef.current=!1}},ae=le=>{!B.contains(le.relatedTarget)&&$()},ce=()=>{B.contains(document.activeElement)||$()};return B.addEventListener("focusin",Z),B.addEventListener("focusout",ae),B.addEventListener("pointermove",Z),B.addEventListener("pointerleave",ce),window.addEventListener("blur",Z),window.addEventListener("focus",$),()=>{B.removeEventListener("focusin",Z),B.removeEventListener("focusout",ae),B.removeEventListener("pointermove",Z),B.removeEventListener("pointerleave",ce),window.removeEventListener("blur",Z),window.removeEventListener("focus",$)}}},[W,f.isClosePausedRef]);const x=H.useCallback(({tabbingDirection:B})=>{const Z=E().map($=>{const ae=$.ref.current,ce=[ae,...Uge(ae)];return B==="forwards"?ce:ce.reverse()});return(B==="forwards"?Z.reverse():Z).flat()},[E]);return H.useEffect(()=>{const B=I.current;if(B){const X=Z=>{const $=Z.altKey||Z.ctrlKey||Z.metaKey;if(Z.key==="Tab"&&!$){const ce=document.activeElement,le=Z.shiftKey;if(Z.target===B&&le){T.current?.focus();return}const Se=x({tabbingDirection:le?"backwards":"forwards"}),De=Se.findIndex(be=>be===ce);Ux(Se.slice(De+1))?Z.preventDefault():le?T.current?.focus():C.current?.focus()}};return B.addEventListener("keydown",X),()=>B.removeEventListener("keydown",X)}},[E,x]),D.jsxs(uge,{ref:S,role:"region","aria-label":l.replace("{hotkey}",P),tabIndex:-1,style:{pointerEvents:W?void 0:"none"},children:[W&&D.jsx(JL,{ref:T,onFocusFromOutsideViewport:()=>{const B=x({tabbingDirection:"forwards"});Ux(B)}}),D.jsx(b2.Slot,{scope:s,children:D.jsx(ri.ol,{tabIndex:-1,...d,ref:N})}),W&&D.jsx(JL,{ref:C,onFocusFromOutsideViewport:()=>{const B=x({tabbingDirection:"backwards"});Ux(B)}})]})});yX.displayName=EX;var vX="ToastFocusProxy",JL=H.forwardRef((i,n)=>{const{__scopeToast:s,onFocusFromOutsideViewport:a,...l}=i,d=NO(vX,s);return D.jsx(OO,{"aria-hidden":!0,tabIndex:0,...l,ref:n,style:{position:"fixed"},onFocus:f=>{const E=f.relatedTarget;!d.viewport?.contains(E)&&a()}})});JL.displayName=vX;var Fw="Toast",Rge="toast.swipeStart",bge="toast.swipeMove",Ige="toast.swipeCancel",Age="toast.swipeEnd",SX=H.forwardRef((i,n)=>{const{forceMount:s,open:a,defaultOpen:l,onOpenChange:d,...f}=i,[E,S]=Vw({prop:a,defaultProp:l??!0,onChange:d,caller:Fw});return D.jsx(Gg,{present:s||E,children:D.jsx(Pge,{open:E,...f,ref:n,onClose:()=>S(!1),onPause:uu(i.onPause),onResume:uu(i.onResume),onSwipeStart:vr(i.onSwipeStart,T=>{T.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:vr(i.onSwipeMove,T=>{const{x:C,y:I}=T.detail.delta;T.currentTarget.setAttribute("data-swipe","move"),T.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${C}px`),T.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${I}px`)}),onSwipeCancel:vr(i.onSwipeCancel,T=>{T.currentTarget.setAttribute("data-swipe","cancel"),T.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),T.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),T.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),T.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:vr(i.onSwipeEnd,T=>{const{x:C,y:I}=T.detail.delta;T.currentTarget.setAttribute("data-swipe","end"),T.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),T.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),T.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${C}px`),T.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${I}px`),S(!1)})})})});SX.displayName=Fw;var[Oge,Nge]=gX(Fw,{onClose(){}}),Pge=H.forwardRef((i,n)=>{const{__scopeToast:s,type:a="foreground",duration:l,open:d,onClose:f,onEscapeKeyDown:E,onPause:S,onResume:T,onSwipeStart:C,onSwipeMove:I,onSwipeCancel:N,onSwipeEnd:P,...W}=i,x=NO(Fw,s),[B,X]=H.useState(null),Z=Xs(n,Te=>X(Te)),$=H.useRef(null),ae=H.useRef(null),ce=l||x.duration,le=H.useRef(0),ne=H.useRef(ce),fe=H.useRef(0),{onToastAdd:Se,onToastRemove:De}=x,be=uu(()=>{B?.contains(document.activeElement)&&x.viewport?.focus(),f()}),ye=H.useCallback(Te=>{!Te||Te===1/0||(window.clearTimeout(fe.current),le.current=new Date().getTime(),fe.current=window.setTimeout(be,Te))},[be]);H.useEffect(()=>{const Te=x.viewport;if(Te){const Fe=()=>{ye(ne.current),T?.()},Je=()=>{const je=new Date().getTime()-le.current;ne.current=ne.current-je,window.clearTimeout(fe.current),S?.()};return Te.addEventListener(qL,Je),Te.addEventListener(XL,Fe),()=>{Te.removeEventListener(qL,Je),Te.removeEventListener(XL,Fe)}}},[x.viewport,ce,S,T,ye]),H.useEffect(()=>{d&&!x.isClosePausedRef.current&&ye(ce)},[d,ce,x.isClosePausedRef,ye]),H.useEffect(()=>(Se(),()=>De()),[Se,De]);const Ge=H.useMemo(()=>B?AX(B):null,[B]);return x.viewport?D.jsxs(D.Fragment,{children:[Ge&&D.jsx(kge,{__scopeToast:s,role:"status","aria-live":a==="foreground"?"assertive":"polite","aria-atomic":!0,children:Ge}),D.jsx(Oge,{scope:s,onClose:be,children:Uw.createPortal(D.jsx(b2.ItemSlot,{scope:s,children:D.jsx(lge,{asChild:!0,onEscapeKeyDown:vr(E,()=>{x.isFocusedToastEscapeKeyDownRef.current||be(),x.isFocusedToastEscapeKeyDownRef.current=!1}),children:D.jsx(ri.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":d?"open":"closed","data-swipe-direction":x.swipeDirection,...W,ref:Z,style:{userSelect:"none",touchAction:"none",...i.style},onKeyDown:vr(i.onKeyDown,Te=>{Te.key==="Escape"&&(E?.(Te.nativeEvent),Te.nativeEvent.defaultPrevented||(x.isFocusedToastEscapeKeyDownRef.current=!0,be()))}),onPointerDown:vr(i.onPointerDown,Te=>{Te.button===0&&($.current={x:Te.clientX,y:Te.clientY})}),onPointerMove:vr(i.onPointerMove,Te=>{if(!$.current)return;const Fe=Te.clientX-$.current.x,Je=Te.clientY-$.current.y,je=!!ae.current,Ie=["left","right"].includes(x.swipeDirection),He=["left","up"].includes(x.swipeDirection)?Math.min:Math.max,re=Ie?He(0,Fe):0,ge=Ie?0:He(0,Je),Oe=Te.pointerType==="touch"?10:2,ue={x:re,y:ge},it={originalEvent:Te,delta:ue};je?(ae.current=ue,eA(bge,I,it,{discrete:!1})):mK(ue,x.swipeDirection,Oe)?(ae.current=ue,eA(Rge,C,it,{discrete:!1}),Te.target.setPointerCapture(Te.pointerId)):(Math.abs(Fe)>Oe||Math.abs(Je)>Oe)&&($.current=null)}),onPointerUp:vr(i.onPointerUp,Te=>{const Fe=ae.current,Je=Te.target;if(Je.hasPointerCapture(Te.pointerId)&&Je.releasePointerCapture(Te.pointerId),ae.current=null,$.current=null,Fe){const je=Te.currentTarget,Ie={originalEvent:Te,delta:Fe};mK(Fe,x.swipeDirection,x.swipeThreshold)?eA(Age,P,Ie,{discrete:!0}):eA(Ige,N,Ie,{discrete:!0}),je.addEventListener("click",He=>He.preventDefault(),{once:!0})}})})})}),x.viewport)})]}):null}),kge=i=>{const{__scopeToast:n,children:s,...a}=i,l=NO(Fw,n),[d,f]=H.useState(!1),[E,S]=H.useState(!1);return Lge(()=>f(!0)),H.useEffect(()=>{const T=window.setTimeout(()=>S(!0),1e3);return()=>window.clearTimeout(T)},[]),E?null:D.jsx(C2,{asChild:!0,children:D.jsx(OO,{...a,children:d&&D.jsxs(D.Fragment,{children:[l.label," ",s]})})})},Dge="ToastTitle",TX=H.forwardRef((i,n)=>{const{__scopeToast:s,...a}=i;return D.jsx(ri.div,{...a,ref:n})});TX.displayName=Dge;var xge="ToastDescription",wX=H.forwardRef((i,n)=>{const{__scopeToast:s,...a}=i;return D.jsx(ri.div,{...a,ref:n})});wX.displayName=xge;var CX="ToastAction",RX=H.forwardRef((i,n)=>{const{altText:s,...a}=i;return s.trim()?D.jsx(IX,{altText:s,asChild:!0,children:D.jsx(I2,{...a,ref:n})}):(console.error(`Invalid prop \`altText\` supplied to \`${CX}\`. Expected non-empty \`string\`.`),null)});RX.displayName=CX;var bX="ToastClose",I2=H.forwardRef((i,n)=>{const{__scopeToast:s,...a}=i,l=Nge(bX,s);return D.jsx(IX,{asChild:!0,children:D.jsx(ri.button,{type:"button",...a,ref:n,onClick:vr(i.onClick,l.onClose)})})});I2.displayName=bX;var IX=H.forwardRef((i,n)=>{const{__scopeToast:s,altText:a,...l}=i;return D.jsx(ri.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":a||void 0,...l,ref:n})});function AX(i){const n=[];return Array.from(i.childNodes).forEach(a=>{if(a.nodeType===a.TEXT_NODE&&a.textContent&&n.push(a.textContent),Mge(a)){const l=a.ariaHidden||a.hidden||a.style.display==="none",d=a.dataset.radixToastAnnounceExclude==="";if(!l)if(d){const f=a.dataset.radixToastAnnounceAlt;f&&n.push(f)}else n.push(...AX(a))}}),n}function eA(i,n,s,{discrete:a}){const l=s.originalEvent.currentTarget,d=new CustomEvent(i,{bubbles:!0,cancelable:!0,detail:s});n&&l.addEventListener(i,n,{once:!0}),a?hX(l,d):l.dispatchEvent(d)}var mK=(i,n,s=0)=>{const a=Math.abs(i.x),l=Math.abs(i.y),d=a>l;return n==="left"||n==="right"?d&&a>s:!d&&l>s};function Lge(i=()=>{}){const n=uu(i);_h(()=>{let s=0,a=0;return s=window.requestAnimationFrame(()=>a=window.requestAnimationFrame(n)),()=>{window.cancelAnimationFrame(s),window.cancelAnimationFrame(a)}},[n])}function Mge(i){return i.nodeType===i.ELEMENT_NODE}function Uge(i){const n=[],s=document.createTreeWalker(i,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>{const l=a.tagName==="INPUT"&&a.type==="hidden";return a.disabled||a.hidden||l?NodeFilter.FILTER_SKIP:a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;s.nextNode();)n.push(s.currentNode);return n}function Ux(i){const n=document.activeElement;return i.some(s=>s===n?!0:(s.focus(),document.activeElement!==n))}var Vge=_X,OX=yX,NX=SX,PX=TX,kX=wX,DX=RX,xX=I2;function LX(i){var n,s,a="";if(typeof i=="string"||typeof i=="number")a+=i;else if(typeof i=="object")if(Array.isArray(i)){var l=i.length;for(n=0;n<l;n++)i[n]&&(s=LX(i[n]))&&(a&&(a+=" "),a+=s)}else for(s in i)i[s]&&(a&&(a+=" "),a+=s);return a}function MX(){for(var i,n,s=0,a="",l=arguments.length;s<l;s++)(i=arguments[s])&&(n=LX(i))&&(a&&(a+=" "),a+=n);return a}const gK=i=>typeof i=="boolean"?`${i}`:i===0?"0":i,_K=MX,A2=(i,n)=>s=>{var a;if(n?.variants==null)return _K(i,s?.class,s?.className);const{variants:l,defaultVariants:d}=n,f=Object.keys(l).map(T=>{const C=s?.[T],I=d?.[T];if(C===null)return null;const N=gK(C)||gK(I);return l[T][N]}),E=s&&Object.entries(s).reduce((T,C)=>{let[I,N]=C;return N===void 0||(T[I]=N),T},{}),S=n==null||(a=n.compoundVariants)===null||a===void 0?void 0:a.reduce((T,C)=>{let{class:I,className:N,...P}=C;return Object.entries(P).every(W=>{let[x,B]=W;return Array.isArray(B)?B.includes({...d,...E}[x]):{...d,...E}[x]===B})?[...T,I,N]:T},[]);return _K(i,f,S,s?.class,s?.className)};const Fge=i=>i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),UX=(...i)=>i.filter((n,s,a)=>!!n&&n.trim()!==""&&a.indexOf(n)===s).join(" ").trim();var jge={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Bge=H.forwardRef(({color:i="currentColor",size:n=24,strokeWidth:s=2,absoluteStrokeWidth:a,className:l="",children:d,iconNode:f,...E},S)=>H.createElement("svg",{ref:S,...jge,width:n,height:n,stroke:i,strokeWidth:a?Number(s)*24/Number(n):s,className:UX("lucide",l),...E},[...f.map(([T,C])=>H.createElement(T,C)),...Array.isArray(d)?d:[d]]));const Wt=(i,n)=>{const s=H.forwardRef(({className:a,...l},d)=>H.createElement(Bge,{ref:d,iconNode:n,className:UX(`lucide-${Fge(i)}`,a),...l}));return s.displayName=`${i}`,s};const Wge=Wt("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const Gge=Wt("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);const Hge=Wt("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);const zge=Wt("BookHeart",[["path",{d:"M16 8.2A2.22 2.22 0 0 0 13.8 6c-.8 0-1.4.3-1.8.9-.4-.6-1-.9-1.8-.9A2.22 2.22 0 0 0 8 8.2c0 .6.3 1.2.7 1.6A226.652 226.652 0 0 0 12 13a404 404 0 0 0 3.3-3.1 2.413 2.413 0 0 0 .7-1.7",key:"1t75a8"}],["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]);const jA=Wt("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);const Dy=Wt("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);const O2=Wt("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]);const Kge=Wt("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);const Yge=Wt("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);const yA=Wt("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);const VX=Wt("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const qge=Wt("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]);const Xge=Wt("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);const lw=Wt("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);const EK=Wt("Coffee",[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]]);const Jge=Wt("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);const yK=Wt("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);const $ge=Wt("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);const Qge=Wt("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const vK=Wt("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);const Zge=Wt("Github",[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]]);const PO=Wt("GraduationCap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]);const e_e=Wt("HandCoins",[["path",{d:"M11 15h2a2 2 0 1 0 0-4h-3c-.6 0-1.1.2-1.4.6L3 17",key:"geh8rc"}],["path",{d:"m7 21 1.6-1.4c.3-.4.8-.6 1.4-.6h4c1.1 0 2.1-.4 2.8-1.2l4.6-4.4a2 2 0 0 0-2.75-2.91l-4.2 3.9",key:"1fto5m"}],["path",{d:"m2 16 6 6",key:"1pfhp9"}],["circle",{cx:"16",cy:"9",r:"2.9",key:"1n0dlu"}],["circle",{cx:"6",cy:"5",r:"3",key:"151irh"}]]);const t_e=Wt("HandHeart",[["path",{d:"M11 14h2a2 2 0 1 0 0-4h-3c-.6 0-1.1.2-1.4.6L3 16",key:"1ifwr1"}],["path",{d:"m7 20 1.6-1.4c.3-.4.8-.6 1.4-.6h4c1.1 0 2.1-.4 2.8-1.2l4.6-4.4a2 2 0 0 0-2.75-2.91l-4.2 3.9",key:"17abbs"}],["path",{d:"m2 15 6 6",key:"10dquu"}],["path",{d:"M19.5 8.5c.7-.7 1.5-1.6 1.5-2.7A2.73 2.73 0 0 0 16 4a2.78 2.78 0 0 0-5 1.8c0 1.2.8 2 1.5 2.8L16 12Z",key:"1h3036"}]]);const FX=Wt("HeartHandshake",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}],["path",{d:"M12 5 9.04 7.96a2.17 2.17 0 0 0 0 3.08c.82.82 2.13.85 3 .07l2.07-1.9a2.82 2.82 0 0 1 3.79 0l2.96 2.66",key:"4oyue0"}],["path",{d:"m18 15-2-2",key:"60u0ii"}],["path",{d:"m15 18-2-2",key:"6p76be"}]]);const $L=Wt("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);const n_e=Wt("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);const r_e=Wt("Instagram",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]]);const SK=Wt("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);const jX=Wt("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);const i_e=Wt("Linkedin",[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]]);const xy=Wt("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);const TK=Wt("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);const s_e=Wt("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);const o_e=Wt("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);const a_e=Wt("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);const QL=Wt("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);const ZL=Wt("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);const c_e=Wt("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);const BX=Wt("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);const WX=Wt("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);const GX=Wt("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);const HX=Wt("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);const wK=Wt("MonitorUp",[["path",{d:"m9 10 3-3 3 3",key:"11gsxs"}],["path",{d:"M12 13V7",key:"h0r20n"}],["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["path",{d:"M12 17v4",key:"1riwvh"}],["path",{d:"M8 21h8",key:"1ev6f3"}]]);const l_e=Wt("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);const u_e=Wt("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);const d_e=Wt("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]);const h_e=Wt("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);const zX=Wt("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);const CK=Wt("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);const p_e=Wt("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);const KX=Wt("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);const YX=Wt("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const RK=Wt("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);const f_e=Wt("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);const qX=Wt("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);const m_e=Wt("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);const bK=Wt("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);const g_e=Wt("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]);const __e=Wt("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);const E_e=Wt("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);const kO=Wt("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);const jw=Wt("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);const XX=Wt("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);const BA=Wt("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);const DO=Wt("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),N2="-",y_e=i=>{const n=S_e(i),{conflictingClassGroups:s,conflictingClassGroupModifiers:a}=i;return{getClassGroupId:f=>{const E=f.split(N2);return E[0]===""&&E.length!==1&&E.shift(),JX(E,n)||v_e(f)},getConflictingClassGroupIds:(f,E)=>{const S=s[f]||[];return E&&a[f]?[...S,...a[f]]:S}}},JX=(i,n)=>{if(i.length===0)return n.classGroupId;const s=i[0],a=n.nextPart.get(s),l=a?JX(i.slice(1),a):void 0;if(l)return l;if(n.validators.length===0)return;const d=i.join(N2);return n.validators.find(({validator:f})=>f(d))?.classGroupId},IK=/^\[(.+)\]$/,v_e=i=>{if(IK.test(i)){const n=IK.exec(i)[1],s=n?.substring(0,n.indexOf(":"));if(s)return"arbitrary.."+s}},S_e=i=>{const{theme:n,prefix:s}=i,a={nextPart:new Map,validators:[]};return w_e(Object.entries(i.classGroups),s).forEach(([d,f])=>{eM(f,a,d,n)}),a},eM=(i,n,s,a)=>{i.forEach(l=>{if(typeof l=="string"){const d=l===""?n:AK(n,l);d.classGroupId=s;return}if(typeof l=="function"){if(T_e(l)){eM(l(a),n,s,a);return}n.validators.push({validator:l,classGroupId:s});return}Object.entries(l).forEach(([d,f])=>{eM(f,AK(n,d),s,a)})})},AK=(i,n)=>{let s=i;return n.split(N2).forEach(a=>{s.nextPart.has(a)||s.nextPart.set(a,{nextPart:new Map,validators:[]}),s=s.nextPart.get(a)}),s},T_e=i=>i.isThemeGetter,w_e=(i,n)=>n?i.map(([s,a])=>{const l=a.map(d=>typeof d=="string"?n+d:typeof d=="object"?Object.fromEntries(Object.entries(d).map(([f,E])=>[n+f,E])):d);return[s,l]}):i,C_e=i=>{if(i<1)return{get:()=>{},set:()=>{}};let n=0,s=new Map,a=new Map;const l=(d,f)=>{s.set(d,f),n++,n>i&&(n=0,a=s,s=new Map)};return{get(d){let f=s.get(d);if(f!==void 0)return f;if((f=a.get(d))!==void 0)return l(d,f),f},set(d,f){s.has(d)?s.set(d,f):l(d,f)}}},$X="!",R_e=i=>{const{separator:n,experimentalParseClassName:s}=i,a=n.length===1,l=n[0],d=n.length,f=E=>{const S=[];let T=0,C=0,I;for(let B=0;B<E.length;B++){let X=E[B];if(T===0){if(X===l&&(a||E.slice(B,B+d)===n)){S.push(E.slice(C,B)),C=B+d;continue}if(X==="/"){I=B;continue}}X==="["?T++:X==="]"&&T--}const N=S.length===0?E:E.substring(C),P=N.startsWith($X),W=P?N.substring(1):N,x=I&&I>C?I-C:void 0;return{modifiers:S,hasImportantModifier:P,baseClassName:W,maybePostfixModifierPosition:x}};return s?E=>s({className:E,parseClassName:f}):f},b_e=i=>{if(i.length<=1)return i;const n=[];let s=[];return i.forEach(a=>{a[0]==="["?(n.push(...s.sort(),a),s=[]):s.push(a)}),n.push(...s.sort()),n},I_e=i=>({cache:C_e(i.cacheSize),parseClassName:R_e(i),...y_e(i)}),A_e=/\s+/,O_e=(i,n)=>{const{parseClassName:s,getClassGroupId:a,getConflictingClassGroupIds:l}=n,d=[],f=i.trim().split(A_e);let E="";for(let S=f.length-1;S>=0;S-=1){const T=f[S],{modifiers:C,hasImportantModifier:I,baseClassName:N,maybePostfixModifierPosition:P}=s(T);let W=!!P,x=a(W?N.substring(0,P):N);if(!x){if(!W){E=T+(E.length>0?" "+E:E);continue}if(x=a(N),!x){E=T+(E.length>0?" "+E:E);continue}W=!1}const B=b_e(C).join(":"),X=I?B+$X:B,Z=X+x;if(d.includes(Z))continue;d.push(Z);const $=l(x,W);for(let ae=0;ae<$.length;++ae){const ce=$[ae];d.push(X+ce)}E=T+(E.length>0?" "+E:E)}return E};function N_e(){let i=0,n,s,a="";for(;i<arguments.length;)(n=arguments[i++])&&(s=QX(n))&&(a&&(a+=" "),a+=s);return a}const QX=i=>{if(typeof i=="string")return i;let n,s="";for(let a=0;a<i.length;a++)i[a]&&(n=QX(i[a]))&&(s&&(s+=" "),s+=n);return s};function P_e(i,...n){let s,a,l,d=f;function f(S){const T=n.reduce((C,I)=>I(C),i());return s=I_e(T),a=s.cache.get,l=s.cache.set,d=E,E(S)}function E(S){const T=a(S);if(T)return T;const C=O_e(S,s);return l(S,C),C}return function(){return d(N_e.apply(null,arguments))}}const Oi=i=>{const n=s=>s[i]||[];return n.isThemeGetter=!0,n},ZX=/^\[(?:([a-z-]+):)?(.+)\]$/i,k_e=/^\d+\/\d+$/,D_e=new Set(["px","full","screen"]),x_e=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,L_e=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,M_e=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,U_e=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,V_e=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,uh=i=>Ly(i)||D_e.has(i)||k_e.test(i),Vp=i=>lv(i,"length",K_e),Ly=i=>!!i&&!Number.isNaN(Number(i)),Vx=i=>lv(i,"number",Ly),T0=i=>!!i&&Number.isInteger(Number(i)),F_e=i=>i.endsWith("%")&&Ly(i.slice(0,-1)),zn=i=>ZX.test(i),Fp=i=>x_e.test(i),j_e=new Set(["length","size","percentage"]),B_e=i=>lv(i,j_e,eJ),W_e=i=>lv(i,"position",eJ),G_e=new Set(["image","url"]),H_e=i=>lv(i,G_e,q_e),z_e=i=>lv(i,"",Y_e),w0=()=>!0,lv=(i,n,s)=>{const a=ZX.exec(i);return a?a[1]?typeof n=="string"?a[1]===n:n.has(a[1]):s(a[2]):!1},K_e=i=>L_e.test(i)&&!M_e.test(i),eJ=()=>!1,Y_e=i=>U_e.test(i),q_e=i=>V_e.test(i),X_e=()=>{const i=Oi("colors"),n=Oi("spacing"),s=Oi("blur"),a=Oi("brightness"),l=Oi("borderColor"),d=Oi("borderRadius"),f=Oi("borderSpacing"),E=Oi("borderWidth"),S=Oi("contrast"),T=Oi("grayscale"),C=Oi("hueRotate"),I=Oi("invert"),N=Oi("gap"),P=Oi("gradientColorStops"),W=Oi("gradientColorStopPositions"),x=Oi("inset"),B=Oi("margin"),X=Oi("opacity"),Z=Oi("padding"),$=Oi("saturate"),ae=Oi("scale"),ce=Oi("sepia"),le=Oi("skew"),ne=Oi("space"),fe=Oi("translate"),Se=()=>["auto","contain","none"],De=()=>["auto","hidden","clip","visible","scroll"],be=()=>["auto",zn,n],ye=()=>[zn,n],Ge=()=>["",uh,Vp],Te=()=>["auto",Ly,zn],Fe=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Je=()=>["solid","dashed","dotted","double","none"],je=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Ie=()=>["start","end","center","between","around","evenly","stretch"],He=()=>["","0",zn],re=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ge=()=>[Ly,zn];return{cacheSize:500,separator:":",theme:{colors:[w0],spacing:[uh,Vp],blur:["none","",Fp,zn],brightness:ge(),borderColor:[i],borderRadius:["none","","full",Fp,zn],borderSpacing:ye(),borderWidth:Ge(),contrast:ge(),grayscale:He(),hueRotate:ge(),invert:He(),gap:ye(),gradientColorStops:[i],gradientColorStopPositions:[F_e,Vp],inset:be(),margin:be(),opacity:ge(),padding:ye(),saturate:ge(),scale:ge(),sepia:He(),skew:ge(),space:ye(),translate:ye()},classGroups:{aspect:[{aspect:["auto","square","video",zn]}],container:["container"],columns:[{columns:[Fp]}],"break-after":[{"break-after":re()}],"break-before":[{"break-before":re()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Fe(),zn]}],overflow:[{overflow:De()}],"overflow-x":[{"overflow-x":De()}],"overflow-y":[{"overflow-y":De()}],overscroll:[{overscroll:Se()}],"overscroll-x":[{"overscroll-x":Se()}],"overscroll-y":[{"overscroll-y":Se()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[x]}],"inset-x":[{"inset-x":[x]}],"inset-y":[{"inset-y":[x]}],start:[{start:[x]}],end:[{end:[x]}],top:[{top:[x]}],right:[{right:[x]}],bottom:[{bottom:[x]}],left:[{left:[x]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",T0,zn]}],basis:[{basis:be()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",zn]}],grow:[{grow:He()}],shrink:[{shrink:He()}],order:[{order:["first","last","none",T0,zn]}],"grid-cols":[{"grid-cols":[w0]}],"col-start-end":[{col:["auto",{span:["full",T0,zn]},zn]}],"col-start":[{"col-start":Te()}],"col-end":[{"col-end":Te()}],"grid-rows":[{"grid-rows":[w0]}],"row-start-end":[{row:["auto",{span:[T0,zn]},zn]}],"row-start":[{"row-start":Te()}],"row-end":[{"row-end":Te()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",zn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",zn]}],gap:[{gap:[N]}],"gap-x":[{"gap-x":[N]}],"gap-y":[{"gap-y":[N]}],"justify-content":[{justify:["normal",...Ie()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Ie(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Ie(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[Z]}],px:[{px:[Z]}],py:[{py:[Z]}],ps:[{ps:[Z]}],pe:[{pe:[Z]}],pt:[{pt:[Z]}],pr:[{pr:[Z]}],pb:[{pb:[Z]}],pl:[{pl:[Z]}],m:[{m:[B]}],mx:[{mx:[B]}],my:[{my:[B]}],ms:[{ms:[B]}],me:[{me:[B]}],mt:[{mt:[B]}],mr:[{mr:[B]}],mb:[{mb:[B]}],ml:[{ml:[B]}],"space-x":[{"space-x":[ne]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[ne]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",zn,n]}],"min-w":[{"min-w":[zn,n,"min","max","fit"]}],"max-w":[{"max-w":[zn,n,"none","full","min","max","fit","prose",{screen:[Fp]},Fp]}],h:[{h:[zn,n,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[zn,n,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[zn,n,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[zn,n,"auto","min","max","fit"]}],"font-size":[{text:["base",Fp,Vp]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Vx]}],"font-family":[{font:[w0]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",zn]}],"line-clamp":[{"line-clamp":["none",Ly,Vx]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",uh,zn]}],"list-image":[{"list-image":["none",zn]}],"list-style-type":[{list:["none","disc","decimal",zn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[i]}],"placeholder-opacity":[{"placeholder-opacity":[X]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[i]}],"text-opacity":[{"text-opacity":[X]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Je(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",uh,Vp]}],"underline-offset":[{"underline-offset":["auto",uh,zn]}],"text-decoration-color":[{decoration:[i]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:ye()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",zn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",zn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[X]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Fe(),W_e]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",B_e]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},H_e]}],"bg-color":[{bg:[i]}],"gradient-from-pos":[{from:[W]}],"gradient-via-pos":[{via:[W]}],"gradient-to-pos":[{to:[W]}],"gradient-from":[{from:[P]}],"gradient-via":[{via:[P]}],"gradient-to":[{to:[P]}],rounded:[{rounded:[d]}],"rounded-s":[{"rounded-s":[d]}],"rounded-e":[{"rounded-e":[d]}],"rounded-t":[{"rounded-t":[d]}],"rounded-r":[{"rounded-r":[d]}],"rounded-b":[{"rounded-b":[d]}],"rounded-l":[{"rounded-l":[d]}],"rounded-ss":[{"rounded-ss":[d]}],"rounded-se":[{"rounded-se":[d]}],"rounded-ee":[{"rounded-ee":[d]}],"rounded-es":[{"rounded-es":[d]}],"rounded-tl":[{"rounded-tl":[d]}],"rounded-tr":[{"rounded-tr":[d]}],"rounded-br":[{"rounded-br":[d]}],"rounded-bl":[{"rounded-bl":[d]}],"border-w":[{border:[E]}],"border-w-x":[{"border-x":[E]}],"border-w-y":[{"border-y":[E]}],"border-w-s":[{"border-s":[E]}],"border-w-e":[{"border-e":[E]}],"border-w-t":[{"border-t":[E]}],"border-w-r":[{"border-r":[E]}],"border-w-b":[{"border-b":[E]}],"border-w-l":[{"border-l":[E]}],"border-opacity":[{"border-opacity":[X]}],"border-style":[{border:[...Je(),"hidden"]}],"divide-x":[{"divide-x":[E]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[E]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[X]}],"divide-style":[{divide:Je()}],"border-color":[{border:[l]}],"border-color-x":[{"border-x":[l]}],"border-color-y":[{"border-y":[l]}],"border-color-s":[{"border-s":[l]}],"border-color-e":[{"border-e":[l]}],"border-color-t":[{"border-t":[l]}],"border-color-r":[{"border-r":[l]}],"border-color-b":[{"border-b":[l]}],"border-color-l":[{"border-l":[l]}],"divide-color":[{divide:[l]}],"outline-style":[{outline:["",...Je()]}],"outline-offset":[{"outline-offset":[uh,zn]}],"outline-w":[{outline:[uh,Vp]}],"outline-color":[{outline:[i]}],"ring-w":[{ring:Ge()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[i]}],"ring-opacity":[{"ring-opacity":[X]}],"ring-offset-w":[{"ring-offset":[uh,Vp]}],"ring-offset-color":[{"ring-offset":[i]}],shadow:[{shadow:["","inner","none",Fp,z_e]}],"shadow-color":[{shadow:[w0]}],opacity:[{opacity:[X]}],"mix-blend":[{"mix-blend":[...je(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":je()}],filter:[{filter:["","none"]}],blur:[{blur:[s]}],brightness:[{brightness:[a]}],contrast:[{contrast:[S]}],"drop-shadow":[{"drop-shadow":["","none",Fp,zn]}],grayscale:[{grayscale:[T]}],"hue-rotate":[{"hue-rotate":[C]}],invert:[{invert:[I]}],saturate:[{saturate:[$]}],sepia:[{sepia:[ce]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[s]}],"backdrop-brightness":[{"backdrop-brightness":[a]}],"backdrop-contrast":[{"backdrop-contrast":[S]}],"backdrop-grayscale":[{"backdrop-grayscale":[T]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[C]}],"backdrop-invert":[{"backdrop-invert":[I]}],"backdrop-opacity":[{"backdrop-opacity":[X]}],"backdrop-saturate":[{"backdrop-saturate":[$]}],"backdrop-sepia":[{"backdrop-sepia":[ce]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[f]}],"border-spacing-x":[{"border-spacing-x":[f]}],"border-spacing-y":[{"border-spacing-y":[f]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",zn]}],duration:[{duration:ge()}],ease:[{ease:["linear","in","out","in-out",zn]}],delay:[{delay:ge()}],animate:[{animate:["none","spin","ping","pulse","bounce",zn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[ae]}],"scale-x":[{"scale-x":[ae]}],"scale-y":[{"scale-y":[ae]}],rotate:[{rotate:[T0,zn]}],"translate-x":[{"translate-x":[fe]}],"translate-y":[{"translate-y":[fe]}],"skew-x":[{"skew-x":[le]}],"skew-y":[{"skew-y":[le]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",zn]}],accent:[{accent:["auto",i]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",zn]}],"caret-color":[{caret:[i]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":ye()}],"scroll-mx":[{"scroll-mx":ye()}],"scroll-my":[{"scroll-my":ye()}],"scroll-ms":[{"scroll-ms":ye()}],"scroll-me":[{"scroll-me":ye()}],"scroll-mt":[{"scroll-mt":ye()}],"scroll-mr":[{"scroll-mr":ye()}],"scroll-mb":[{"scroll-mb":ye()}],"scroll-ml":[{"scroll-ml":ye()}],"scroll-p":[{"scroll-p":ye()}],"scroll-px":[{"scroll-px":ye()}],"scroll-py":[{"scroll-py":ye()}],"scroll-ps":[{"scroll-ps":ye()}],"scroll-pe":[{"scroll-pe":ye()}],"scroll-pt":[{"scroll-pt":ye()}],"scroll-pr":[{"scroll-pr":ye()}],"scroll-pb":[{"scroll-pb":ye()}],"scroll-pl":[{"scroll-pl":ye()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",zn]}],fill:[{fill:[i,"none"]}],"stroke-w":[{stroke:[uh,Vp,Vx]}],stroke:[{stroke:[i,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},J_e=P_e(X_e);function Br(...i){return J_e(MX(i))}const $_e=Vge,tJ=H.forwardRef(({className:i,...n},s)=>D.jsx(OX,{ref:s,className:Br("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",i),...n}));tJ.displayName=OX.displayName;const Q_e=A2("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),nJ=H.forwardRef(({className:i,variant:n,...s},a)=>D.jsx(NX,{ref:a,className:Br(Q_e({variant:n}),i),...s}));nJ.displayName=NX.displayName;const Z_e=H.forwardRef(({className:i,...n},s)=>D.jsx(DX,{ref:s,className:Br("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",i),...n}));Z_e.displayName=DX.displayName;const rJ=H.forwardRef(({className:i,...n},s)=>D.jsx(xX,{ref:s,className:Br("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",i),"toast-close":"",...n,children:D.jsx(DO,{className:"h-4 w-4"})}));rJ.displayName=xX.displayName;const iJ=H.forwardRef(({className:i,...n},s)=>D.jsx(PX,{ref:s,className:Br("text-sm font-semibold",i),...n}));iJ.displayName=PX.displayName;const sJ=H.forwardRef(({className:i,...n},s)=>D.jsx(kX,{ref:s,className:Br("text-sm opacity-90",i),...n}));sJ.displayName=kX.displayName;function eEe(){const{toasts:i}=T2();return D.jsxs($_e,{children:[i.map(function({id:n,title:s,description:a,action:l,...d}){return D.jsxs(nJ,{...d,children:[D.jsxs("div",{className:"grid gap-1",children:[s&&D.jsx(iJ,{children:s}),a&&D.jsx(sJ,{children:a})]}),l,D.jsx(rJ,{})]},n)}),D.jsx(tJ,{})]})}var OK=["light","dark"],tEe="(prefers-color-scheme: dark)",nEe=H.createContext(void 0),rEe={setTheme:i=>{},themes:[]},iEe=()=>{var i;return(i=H.useContext(nEe))!=null?i:rEe};H.memo(({forcedTheme:i,storageKey:n,attribute:s,enableSystem:a,enableColorScheme:l,defaultTheme:d,value:f,attrs:E,nonce:S})=>{let T=d==="system",C=s==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${E.map(W=>`'${W}'`).join(",")})`};`:`var d=document.documentElement,n='${s}',s='setAttribute';`,I=l?OK.includes(d)&&d?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${d}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",N=(W,x=!1,B=!0)=>{let X=f?f[W]:W,Z=x?W+"|| ''":`'${X}'`,$="";return l&&B&&!x&&OK.includes(W)&&($+=`d.style.colorScheme = '${W}';`),s==="class"?x||X?$+=`c.add(${Z})`:$+="null":X&&($+=`d[s](n,${Z})`),$},P=i?`!function(){${C}${N(i)}}()`:a?`!function(){try{${C}var e=localStorage.getItem('${n}');if('system'===e||(!e&&${T})){var t='${tEe}',m=window.matchMedia(t);if(m.media!==t||m.matches){${N("dark")}}else{${N("light")}}}else if(e){${f?`var x=${JSON.stringify(f)};`:""}${N(f?"x[e]":"e",!0)}}${T?"":"else{"+N(d,!1,!1)+"}"}${I}}catch(e){}}()`:`!function(){try{${C}var e=localStorage.getItem('${n}');if(e){${f?`var x=${JSON.stringify(f)};`:""}${N(f?"x[e]":"e",!0)}}else{${N(d,!1,!1)};}${I}}catch(t){}}();`;return H.createElement("script",{nonce:S,dangerouslySetInnerHTML:{__html:P}})});var sEe=i=>{switch(i){case"success":return cEe;case"info":return uEe;case"warning":return lEe;case"error":return dEe;default:return null}},oEe=Array(12).fill(0),aEe=({visible:i,className:n})=>vt.createElement("div",{className:["sonner-loading-wrapper",n].filter(Boolean).join(" "),"data-visible":i},vt.createElement("div",{className:"sonner-spinner"},oEe.map((s,a)=>vt.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${a}`})))),cEe=vt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},vt.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),lEe=vt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},vt.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),uEe=vt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},vt.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),dEe=vt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},vt.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),hEe=vt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},vt.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),vt.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),pEe=()=>{let[i,n]=vt.useState(document.hidden);return vt.useEffect(()=>{let s=()=>{n(document.hidden)};return document.addEventListener("visibilitychange",s),()=>window.removeEventListener("visibilitychange",s)},[]),i},tM=1,fEe=class{constructor(){this.subscribe=i=>(this.subscribers.push(i),()=>{let n=this.subscribers.indexOf(i);this.subscribers.splice(n,1)}),this.publish=i=>{this.subscribers.forEach(n=>n(i))},this.addToast=i=>{this.publish(i),this.toasts=[...this.toasts,i]},this.create=i=>{var n;let{message:s,...a}=i,l=typeof i?.id=="number"||((n=i.id)==null?void 0:n.length)>0?i.id:tM++,d=this.toasts.find(E=>E.id===l),f=i.dismissible===void 0?!0:i.dismissible;return this.dismissedToasts.has(l)&&this.dismissedToasts.delete(l),d?this.toasts=this.toasts.map(E=>E.id===l?(this.publish({...E,...i,id:l,title:s}),{...E,...i,id:l,dismissible:f,title:s}):E):this.addToast({title:s,...a,dismissible:f,id:l}),l},this.dismiss=i=>(this.dismissedToasts.add(i),i||this.toasts.forEach(n=>{this.subscribers.forEach(s=>s({id:n.id,dismiss:!0}))}),this.subscribers.forEach(n=>n({id:i,dismiss:!0})),i),this.message=(i,n)=>this.create({...n,message:i}),this.error=(i,n)=>this.create({...n,message:i,type:"error"}),this.success=(i,n)=>this.create({...n,type:"success",message:i}),this.info=(i,n)=>this.create({...n,type:"info",message:i}),this.warning=(i,n)=>this.create({...n,type:"warning",message:i}),this.loading=(i,n)=>this.create({...n,type:"loading",message:i}),this.promise=(i,n)=>{if(!n)return;let s;n.loading!==void 0&&(s=this.create({...n,promise:i,type:"loading",message:n.loading,description:typeof n.description!="function"?n.description:void 0}));let a=i instanceof Promise?i:i(),l=s!==void 0,d,f=a.then(async S=>{if(d=["resolve",S],vt.isValidElement(S))l=!1,this.create({id:s,type:"default",message:S});else if(gEe(S)&&!S.ok){l=!1;let T=typeof n.error=="function"?await n.error(`HTTP error! status: ${S.status}`):n.error,C=typeof n.description=="function"?await n.description(`HTTP error! status: ${S.status}`):n.description;this.create({id:s,type:"error",message:T,description:C})}else if(n.success!==void 0){l=!1;let T=typeof n.success=="function"?await n.success(S):n.success,C=typeof n.description=="function"?await n.description(S):n.description;this.create({id:s,type:"success",message:T,description:C})}}).catch(async S=>{if(d=["reject",S],n.error!==void 0){l=!1;let T=typeof n.error=="function"?await n.error(S):n.error,C=typeof n.description=="function"?await n.description(S):n.description;this.create({id:s,type:"error",message:T,description:C})}}).finally(()=>{var S;l&&(this.dismiss(s),s=void 0),(S=n.finally)==null||S.call(n)}),E=()=>new Promise((S,T)=>f.then(()=>d[0]==="reject"?T(d[1]):S(d[1])).catch(T));return typeof s!="string"&&typeof s!="number"?{unwrap:E}:Object.assign(s,{unwrap:E})},this.custom=(i,n)=>{let s=n?.id||tM++;return this.create({jsx:i(s),id:s,...n}),s},this.getActiveToasts=()=>this.toasts.filter(i=>!this.dismissedToasts.has(i.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},Aa=new fEe,mEe=(i,n)=>{let s=n?.id||tM++;return Aa.addToast({title:i,...n,id:s}),s},gEe=i=>i&&typeof i=="object"&&"ok"in i&&typeof i.ok=="boolean"&&"status"in i&&typeof i.status=="number",_Ee=mEe,EEe=()=>Aa.toasts,yEe=()=>Aa.getActiveToasts(),WA=Object.assign(_Ee,{success:Aa.success,info:Aa.info,warning:Aa.warning,error:Aa.error,custom:Aa.custom,message:Aa.message,promise:Aa.promise,dismiss:Aa.dismiss,loading:Aa.loading},{getHistory:EEe,getToasts:yEe});function vEe(i,{insertAt:n}={}){if(typeof document>"u")return;let s=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",n==="top"&&s.firstChild?s.insertBefore(a,s.firstChild):s.appendChild(a),a.styleSheet?a.styleSheet.cssText=i:a.appendChild(document.createTextNode(i))}vEe(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function tA(i){return i.label!==void 0}var SEe=3,TEe="32px",wEe="16px",NK=4e3,CEe=356,REe=14,bEe=20,IEe=200;function iu(...i){return i.filter(Boolean).join(" ")}function AEe(i){let[n,s]=i.split("-"),a=[];return n&&a.push(n),s&&a.push(s),a}var OEe=i=>{var n,s,a,l,d,f,E,S,T,C,I;let{invert:N,toast:P,unstyled:W,interacting:x,setHeights:B,visibleToasts:X,heights:Z,index:$,toasts:ae,expanded:ce,removeToast:le,defaultRichColors:ne,closeButton:fe,style:Se,cancelButtonStyle:De,actionButtonStyle:be,className:ye="",descriptionClassName:Ge="",duration:Te,position:Fe,gap:Je,loadingIcon:je,expandByDefault:Ie,classNames:He,icons:re,closeButtonAriaLabel:ge="Close toast",pauseWhenPageIsHidden:Oe}=i,[ue,it]=vt.useState(null),[yt,Dt]=vt.useState(null),[At,dn]=vt.useState(!1),[Cn,fr]=vt.useState(!1),[as,Jr]=vt.useState(!1),[Mr,wc]=vt.useState(!1),[fl,yi]=vt.useState(!1),[Cc,Wr]=vt.useState(0),[fi,$s]=vt.useState(0),gs=vt.useRef(P.duration||Te||NK),Rc=vt.useRef(null),Qs=vt.useRef(null),Ir=$===0,Fo=$+1<=X,Xe=P.type,lt=P.dismissible!==!1,Kt=P.className||"",an=P.descriptionClassName||"",Nn=vt.useMemo(()=>Z.findIndex(mn=>mn.toastId===P.id)||0,[Z,P.id]),ii=vt.useMemo(()=>{var mn;return(mn=P.closeButton)!=null?mn:fe},[P.closeButton,fe]),Zs=vt.useMemo(()=>P.duration||Te||NK,[P.duration,Te]),$r=vt.useRef(0),mi=vt.useRef(0),Eo=vt.useRef(0),Gr=vt.useRef(null),[yo,vi]=Fe.split("-"),ia=vt.useMemo(()=>Z.reduce((mn,Wn,mr)=>mr>=Nn?mn:mn+Wn.height,0),[Z,Nn]),ml=pEe(),sa=P.invert||N,vo=Xe==="loading";mi.current=vt.useMemo(()=>Nn*Je+ia,[Nn,ia]),vt.useEffect(()=>{gs.current=Zs},[Zs]),vt.useEffect(()=>{dn(!0)},[]),vt.useEffect(()=>{let mn=Qs.current;if(mn){let Wn=mn.getBoundingClientRect().height;return $s(Wn),B(mr=>[{toastId:P.id,height:Wn,position:P.position},...mr]),()=>B(mr=>mr.filter($i=>$i.toastId!==P.id))}},[B,P.id]),vt.useLayoutEffect(()=>{if(!At)return;let mn=Qs.current,Wn=mn.style.height;mn.style.height="auto";let mr=mn.getBoundingClientRect().height;mn.style.height=Wn,$s(mr),B($i=>$i.find(Ls=>Ls.toastId===P.id)?$i.map(Ls=>Ls.toastId===P.id?{...Ls,height:mr}:Ls):[{toastId:P.id,height:mr,position:P.position},...$i])},[At,P.title,P.description,B,P.id]);let jo=vt.useCallback(()=>{fr(!0),Wr(mi.current),B(mn=>mn.filter(Wn=>Wn.toastId!==P.id)),setTimeout(()=>{le(P)},IEe)},[P,le,B,mi]);vt.useEffect(()=>{if(P.promise&&Xe==="loading"||P.duration===1/0||P.type==="loading")return;let mn;return ce||x||Oe&&ml?(()=>{if(Eo.current<$r.current){let Wn=new Date().getTime()-$r.current;gs.current=gs.current-Wn}Eo.current=new Date().getTime()})():gs.current!==1/0&&($r.current=new Date().getTime(),mn=setTimeout(()=>{var Wn;(Wn=P.onAutoClose)==null||Wn.call(P,P),jo()},gs.current)),()=>clearTimeout(mn)},[ce,x,P,Xe,Oe,ml,jo]),vt.useEffect(()=>{P.delete&&jo()},[jo,P.delete]);function ja(){var mn,Wn,mr;return re!=null&&re.loading?vt.createElement("div",{className:iu(He?.loader,(mn=P?.classNames)==null?void 0:mn.loader,"sonner-loader"),"data-visible":Xe==="loading"},re.loading):je?vt.createElement("div",{className:iu(He?.loader,(Wn=P?.classNames)==null?void 0:Wn.loader,"sonner-loader"),"data-visible":Xe==="loading"},je):vt.createElement(aEe,{className:iu(He?.loader,(mr=P?.classNames)==null?void 0:mr.loader),visible:Xe==="loading"})}return vt.createElement("li",{tabIndex:0,ref:Qs,className:iu(ye,Kt,He?.toast,(n=P?.classNames)==null?void 0:n.toast,He?.default,He?.[Xe],(s=P?.classNames)==null?void 0:s[Xe]),"data-sonner-toast":"","data-rich-colors":(a=P.richColors)!=null?a:ne,"data-styled":!(P.jsx||P.unstyled||W),"data-mounted":At,"data-promise":!!P.promise,"data-swiped":fl,"data-removed":Cn,"data-visible":Fo,"data-y-position":yo,"data-x-position":vi,"data-index":$,"data-front":Ir,"data-swiping":as,"data-dismissible":lt,"data-type":Xe,"data-invert":sa,"data-swipe-out":Mr,"data-swipe-direction":yt,"data-expanded":!!(ce||Ie&&At),style:{"--index":$,"--toasts-before":$,"--z-index":ae.length-$,"--offset":`${Cn?Cc:mi.current}px`,"--initial-height":Ie?"auto":`${fi}px`,...Se,...P.style},onDragEnd:()=>{Jr(!1),it(null),Gr.current=null},onPointerDown:mn=>{vo||!lt||(Rc.current=new Date,Wr(mi.current),mn.target.setPointerCapture(mn.pointerId),mn.target.tagName!=="BUTTON"&&(Jr(!0),Gr.current={x:mn.clientX,y:mn.clientY}))},onPointerUp:()=>{var mn,Wn,mr,$i;if(Mr||!lt)return;Gr.current=null;let Ls=Number(((mn=Qs.current)==null?void 0:mn.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),kr=Number(((Wn=Qs.current)==null?void 0:Wn.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),Ee=new Date().getTime()-((mr=Rc.current)==null?void 0:mr.getTime()),Ae=ue==="x"?Ls:kr,We=Math.abs(Ae)/Ee;if(Math.abs(Ae)>=bEe||We>.11){Wr(mi.current),($i=P.onDismiss)==null||$i.call(P,P),Dt(ue==="x"?Ls>0?"right":"left":kr>0?"down":"up"),jo(),wc(!0),yi(!1);return}Jr(!1),it(null)},onPointerMove:mn=>{var Wn,mr,$i,Ls;if(!Gr.current||!lt||((Wn=window.getSelection())==null?void 0:Wn.toString().length)>0)return;let kr=mn.clientY-Gr.current.y,Ee=mn.clientX-Gr.current.x,Ae=(mr=i.swipeDirections)!=null?mr:AEe(Fe);!ue&&(Math.abs(Ee)>1||Math.abs(kr)>1)&&it(Math.abs(Ee)>Math.abs(kr)?"x":"y");let We={x:0,y:0};ue==="y"?(Ae.includes("top")||Ae.includes("bottom"))&&(Ae.includes("top")&&kr<0||Ae.includes("bottom")&&kr>0)&&(We.y=kr):ue==="x"&&(Ae.includes("left")||Ae.includes("right"))&&(Ae.includes("left")&&Ee<0||Ae.includes("right")&&Ee>0)&&(We.x=Ee),(Math.abs(We.x)>0||Math.abs(We.y)>0)&&yi(!0),($i=Qs.current)==null||$i.style.setProperty("--swipe-amount-x",`${We.x}px`),(Ls=Qs.current)==null||Ls.style.setProperty("--swipe-amount-y",`${We.y}px`)}},ii&&!P.jsx?vt.createElement("button",{"aria-label":ge,"data-disabled":vo,"data-close-button":!0,onClick:vo||!lt?()=>{}:()=>{var mn;jo(),(mn=P.onDismiss)==null||mn.call(P,P)},className:iu(He?.closeButton,(l=P?.classNames)==null?void 0:l.closeButton)},(d=re?.close)!=null?d:hEe):null,P.jsx||H.isValidElement(P.title)?P.jsx?P.jsx:typeof P.title=="function"?P.title():P.title:vt.createElement(vt.Fragment,null,Xe||P.icon||P.promise?vt.createElement("div",{"data-icon":"",className:iu(He?.icon,(f=P?.classNames)==null?void 0:f.icon)},P.promise||P.type==="loading"&&!P.icon?P.icon||ja():null,P.type!=="loading"?P.icon||re?.[Xe]||sEe(Xe):null):null,vt.createElement("div",{"data-content":"",className:iu(He?.content,(E=P?.classNames)==null?void 0:E.content)},vt.createElement("div",{"data-title":"",className:iu(He?.title,(S=P?.classNames)==null?void 0:S.title)},typeof P.title=="function"?P.title():P.title),P.description?vt.createElement("div",{"data-description":"",className:iu(Ge,an,He?.description,(T=P?.classNames)==null?void 0:T.description)},typeof P.description=="function"?P.description():P.description):null),H.isValidElement(P.cancel)?P.cancel:P.cancel&&tA(P.cancel)?vt.createElement("button",{"data-button":!0,"data-cancel":!0,style:P.cancelButtonStyle||De,onClick:mn=>{var Wn,mr;tA(P.cancel)&&lt&&((mr=(Wn=P.cancel).onClick)==null||mr.call(Wn,mn),jo())},className:iu(He?.cancelButton,(C=P?.classNames)==null?void 0:C.cancelButton)},P.cancel.label):null,H.isValidElement(P.action)?P.action:P.action&&tA(P.action)?vt.createElement("button",{"data-button":!0,"data-action":!0,style:P.actionButtonStyle||be,onClick:mn=>{var Wn,mr;tA(P.action)&&((mr=(Wn=P.action).onClick)==null||mr.call(Wn,mn),!mn.defaultPrevented&&jo())},className:iu(He?.actionButton,(I=P?.classNames)==null?void 0:I.actionButton)},P.action.label):null))};function PK(){if(typeof window>"u"||typeof document>"u")return"ltr";let i=document.documentElement.getAttribute("dir");return i==="auto"||!i?window.getComputedStyle(document.documentElement).direction:i}function NEe(i,n){let s={};return[i,n].forEach((a,l)=>{let d=l===1,f=d?"--mobile-offset":"--offset",E=d?wEe:TEe;function S(T){["top","right","bottom","left"].forEach(C=>{s[`${f}-${C}`]=typeof T=="number"?`${T}px`:T})}typeof a=="number"||typeof a=="string"?S(a):typeof a=="object"?["top","right","bottom","left"].forEach(T=>{a[T]===void 0?s[`${f}-${T}`]=E:s[`${f}-${T}`]=typeof a[T]=="number"?`${a[T]}px`:a[T]}):S(E)}),s}var PEe=H.forwardRef(function(i,n){let{invert:s,position:a="bottom-right",hotkey:l=["altKey","KeyT"],expand:d,closeButton:f,className:E,offset:S,mobileOffset:T,theme:C="light",richColors:I,duration:N,style:P,visibleToasts:W=SEe,toastOptions:x,dir:B=PK(),gap:X=REe,loadingIcon:Z,icons:$,containerAriaLabel:ae="Notifications",pauseWhenPageIsHidden:ce}=i,[le,ne]=vt.useState([]),fe=vt.useMemo(()=>Array.from(new Set([a].concat(le.filter(Oe=>Oe.position).map(Oe=>Oe.position)))),[le,a]),[Se,De]=vt.useState([]),[be,ye]=vt.useState(!1),[Ge,Te]=vt.useState(!1),[Fe,Je]=vt.useState(C!=="system"?C:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),je=vt.useRef(null),Ie=l.join("+").replace(/Key/g,"").replace(/Digit/g,""),He=vt.useRef(null),re=vt.useRef(!1),ge=vt.useCallback(Oe=>{ne(ue=>{var it;return(it=ue.find(yt=>yt.id===Oe.id))!=null&&it.delete||Aa.dismiss(Oe.id),ue.filter(({id:yt})=>yt!==Oe.id)})},[]);return vt.useEffect(()=>Aa.subscribe(Oe=>{if(Oe.dismiss){ne(ue=>ue.map(it=>it.id===Oe.id?{...it,delete:!0}:it));return}setTimeout(()=>{w2.flushSync(()=>{ne(ue=>{let it=ue.findIndex(yt=>yt.id===Oe.id);return it!==-1?[...ue.slice(0,it),{...ue[it],...Oe},...ue.slice(it+1)]:[Oe,...ue]})})})}),[]),vt.useEffect(()=>{if(C!=="system"){Je(C);return}if(C==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?Je("dark"):Je("light")),typeof window>"u")return;let Oe=window.matchMedia("(prefers-color-scheme: dark)");try{Oe.addEventListener("change",({matches:ue})=>{Je(ue?"dark":"light")})}catch{Oe.addListener(({matches:it})=>{try{Je(it?"dark":"light")}catch(yt){console.error(yt)}})}},[C]),vt.useEffect(()=>{le.length<=1&&ye(!1)},[le]),vt.useEffect(()=>{let Oe=ue=>{var it,yt;l.every(Dt=>ue[Dt]||ue.code===Dt)&&(ye(!0),(it=je.current)==null||it.focus()),ue.code==="Escape"&&(document.activeElement===je.current||(yt=je.current)!=null&&yt.contains(document.activeElement))&&ye(!1)};return document.addEventListener("keydown",Oe),()=>document.removeEventListener("keydown",Oe)},[l]),vt.useEffect(()=>{if(je.current)return()=>{He.current&&(He.current.focus({preventScroll:!0}),He.current=null,re.current=!1)}},[je.current]),vt.createElement("section",{ref:n,"aria-label":`${ae} ${Ie}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},fe.map((Oe,ue)=>{var it;let[yt,Dt]=Oe.split("-");return le.length?vt.createElement("ol",{key:Oe,dir:B==="auto"?PK():B,tabIndex:-1,ref:je,className:E,"data-sonner-toaster":!0,"data-theme":Fe,"data-y-position":yt,"data-lifted":be&&le.length>1&&!d,"data-x-position":Dt,style:{"--front-toast-height":`${((it=Se[0])==null?void 0:it.height)||0}px`,"--width":`${CEe}px`,"--gap":`${X}px`,...P,...NEe(S,T)},onBlur:At=>{re.current&&!At.currentTarget.contains(At.relatedTarget)&&(re.current=!1,He.current&&(He.current.focus({preventScroll:!0}),He.current=null))},onFocus:At=>{At.target instanceof HTMLElement&&At.target.dataset.dismissible==="false"||re.current||(re.current=!0,He.current=At.relatedTarget)},onMouseEnter:()=>ye(!0),onMouseMove:()=>ye(!0),onMouseLeave:()=>{Ge||ye(!1)},onDragEnd:()=>ye(!1),onPointerDown:At=>{At.target instanceof HTMLElement&&At.target.dataset.dismissible==="false"||Te(!0)},onPointerUp:()=>Te(!1)},le.filter(At=>!At.position&&ue===0||At.position===Oe).map((At,dn)=>{var Cn,fr;return vt.createElement(OEe,{key:At.id,icons:$,index:dn,toast:At,defaultRichColors:I,duration:(Cn=x?.duration)!=null?Cn:N,className:x?.className,descriptionClassName:x?.descriptionClassName,invert:s,visibleToasts:W,closeButton:(fr=x?.closeButton)!=null?fr:f,interacting:Ge,position:Oe,style:x?.style,unstyled:x?.unstyled,classNames:x?.classNames,cancelButtonStyle:x?.cancelButtonStyle,actionButtonStyle:x?.actionButtonStyle,removeToast:ge,toasts:le.filter(as=>as.position==At.position),heights:Se.filter(as=>as.position==At.position),setHeights:De,expandByDefault:d,gap:X,loadingIcon:Z,expanded:be,pauseWhenPageIsHidden:ce,swipeDirections:i.swipeDirections})})):null}))});const kEe=({...i})=>{const{theme:n="system"}=iEe();return D.jsx(PEe,{theme:n,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...i})};var DEe=S2[" useId ".trim().toString()]||(()=>{}),xEe=0;function H0(i){const[n,s]=H.useState(DEe());return _h(()=>{s(a=>a??String(xEe++))},[i]),n?`radix-${n}`:""}const LEe=["top","right","bottom","left"],lf=Math.min,uc=Math.max,GA=Math.round,nA=Math.floor,yd=i=>({x:i,y:i}),MEe={left:"right",right:"left",bottom:"top",top:"bottom"},UEe={start:"end",end:"start"};function nM(i,n,s){return uc(i,lf(n,s))}function Eh(i,n){return typeof i=="function"?i(n):i}function yh(i){return i.split("-")[0]}function uv(i){return i.split("-")[1]}function P2(i){return i==="x"?"y":"x"}function k2(i){return i==="y"?"height":"width"}const VEe=new Set(["top","bottom"]);function _d(i){return VEe.has(yh(i))?"y":"x"}function D2(i){return P2(_d(i))}function FEe(i,n,s){s===void 0&&(s=!1);const a=uv(i),l=D2(i),d=k2(l);let f=l==="x"?a===(s?"end":"start")?"right":"left":a==="start"?"bottom":"top";return n.reference[d]>n.floating[d]&&(f=HA(f)),[f,HA(f)]}function jEe(i){const n=HA(i);return[rM(i),n,rM(n)]}function rM(i){return i.replace(/start|end/g,n=>UEe[n])}const kK=["left","right"],DK=["right","left"],BEe=["top","bottom"],WEe=["bottom","top"];function GEe(i,n,s){switch(i){case"top":case"bottom":return s?n?DK:kK:n?kK:DK;case"left":case"right":return n?BEe:WEe;default:return[]}}function HEe(i,n,s,a){const l=uv(i);let d=GEe(yh(i),s==="start",a);return l&&(d=d.map(f=>f+"-"+l),n&&(d=d.concat(d.map(rM)))),d}function HA(i){return i.replace(/left|right|bottom|top/g,n=>MEe[n])}function zEe(i){return{top:0,right:0,bottom:0,left:0,...i}}function oJ(i){return typeof i!="number"?zEe(i):{top:i,right:i,bottom:i,left:i}}function zA(i){const{x:n,y:s,width:a,height:l}=i;return{width:a,height:l,top:s,left:n,right:n+a,bottom:s+l,x:n,y:s}}function xK(i,n,s){let{reference:a,floating:l}=i;const d=_d(n),f=D2(n),E=k2(f),S=yh(n),T=d==="y",C=a.x+a.width/2-l.width/2,I=a.y+a.height/2-l.height/2,N=a[E]/2-l[E]/2;let P;switch(S){case"top":P={x:C,y:a.y-l.height};break;case"bottom":P={x:C,y:a.y+a.height};break;case"right":P={x:a.x+a.width,y:I};break;case"left":P={x:a.x-l.width,y:I};break;default:P={x:a.x,y:a.y}}switch(uv(n)){case"start":P[f]-=N*(s&&T?-1:1);break;case"end":P[f]+=N*(s&&T?-1:1);break}return P}const KEe=async(i,n,s)=>{const{placement:a="bottom",strategy:l="absolute",middleware:d=[],platform:f}=s,E=d.filter(Boolean),S=await(f.isRTL==null?void 0:f.isRTL(n));let T=await f.getElementRects({reference:i,floating:n,strategy:l}),{x:C,y:I}=xK(T,a,S),N=a,P={},W=0;for(let x=0;x<E.length;x++){const{name:B,fn:X}=E[x],{x:Z,y:$,data:ae,reset:ce}=await X({x:C,y:I,initialPlacement:a,placement:N,strategy:l,middlewareData:P,rects:T,platform:f,elements:{reference:i,floating:n}});C=Z??C,I=$??I,P={...P,[B]:{...P[B],...ae}},ce&&W<=50&&(W++,typeof ce=="object"&&(ce.placement&&(N=ce.placement),ce.rects&&(T=ce.rects===!0?await f.getElementRects({reference:i,floating:n,strategy:l}):ce.rects),{x:C,y:I}=xK(T,N,S)),x=-1)}return{x:C,y:I,placement:N,strategy:l,middlewareData:P}};async function uw(i,n){var s;n===void 0&&(n={});const{x:a,y:l,platform:d,rects:f,elements:E,strategy:S}=i,{boundary:T="clippingAncestors",rootBoundary:C="viewport",elementContext:I="floating",altBoundary:N=!1,padding:P=0}=Eh(n,i),W=oJ(P),B=E[N?I==="floating"?"reference":"floating":I],X=zA(await d.getClippingRect({element:(s=await(d.isElement==null?void 0:d.isElement(B)))==null||s?B:B.contextElement||await(d.getDocumentElement==null?void 0:d.getDocumentElement(E.floating)),boundary:T,rootBoundary:C,strategy:S})),Z=I==="floating"?{x:a,y:l,width:f.floating.width,height:f.floating.height}:f.reference,$=await(d.getOffsetParent==null?void 0:d.getOffsetParent(E.floating)),ae=await(d.isElement==null?void 0:d.isElement($))?await(d.getScale==null?void 0:d.getScale($))||{x:1,y:1}:{x:1,y:1},ce=zA(d.convertOffsetParentRelativeRectToViewportRelativeRect?await d.convertOffsetParentRelativeRectToViewportRelativeRect({elements:E,rect:Z,offsetParent:$,strategy:S}):Z);return{top:(X.top-ce.top+W.top)/ae.y,bottom:(ce.bottom-X.bottom+W.bottom)/ae.y,left:(X.left-ce.left+W.left)/ae.x,right:(ce.right-X.right+W.right)/ae.x}}const YEe=i=>({name:"arrow",options:i,async fn(n){const{x:s,y:a,placement:l,rects:d,platform:f,elements:E,middlewareData:S}=n,{element:T,padding:C=0}=Eh(i,n)||{};if(T==null)return{};const I=oJ(C),N={x:s,y:a},P=D2(l),W=k2(P),x=await f.getDimensions(T),B=P==="y",X=B?"top":"left",Z=B?"bottom":"right",$=B?"clientHeight":"clientWidth",ae=d.reference[W]+d.reference[P]-N[P]-d.floating[W],ce=N[P]-d.reference[P],le=await(f.getOffsetParent==null?void 0:f.getOffsetParent(T));let ne=le?le[$]:0;(!ne||!await(f.isElement==null?void 0:f.isElement(le)))&&(ne=E.floating[$]||d.floating[W]);const fe=ae/2-ce/2,Se=ne/2-x[W]/2-1,De=lf(I[X],Se),be=lf(I[Z],Se),ye=De,Ge=ne-x[W]-be,Te=ne/2-x[W]/2+fe,Fe=nM(ye,Te,Ge),Je=!S.arrow&&uv(l)!=null&&Te!==Fe&&d.reference[W]/2-(Te<ye?De:be)-x[W]/2<0,je=Je?Te<ye?Te-ye:Te-Ge:0;return{[P]:N[P]+je,data:{[P]:Fe,centerOffset:Te-Fe-je,...Je&&{alignmentOffset:je}},reset:Je}}}),qEe=function(i){return i===void 0&&(i={}),{name:"flip",options:i,async fn(n){var s,a;const{placement:l,middlewareData:d,rects:f,initialPlacement:E,platform:S,elements:T}=n,{mainAxis:C=!0,crossAxis:I=!0,fallbackPlacements:N,fallbackStrategy:P="bestFit",fallbackAxisSideDirection:W="none",flipAlignment:x=!0,...B}=Eh(i,n);if((s=d.arrow)!=null&&s.alignmentOffset)return{};const X=yh(l),Z=_d(E),$=yh(E)===E,ae=await(S.isRTL==null?void 0:S.isRTL(T.floating)),ce=N||($||!x?[HA(E)]:jEe(E)),le=W!=="none";!N&&le&&ce.push(...HEe(E,x,W,ae));const ne=[E,...ce],fe=await uw(n,B),Se=[];let De=((a=d.flip)==null?void 0:a.overflows)||[];if(C&&Se.push(fe[X]),I){const Te=FEe(l,f,ae);Se.push(fe[Te[0]],fe[Te[1]])}if(De=[...De,{placement:l,overflows:Se}],!Se.every(Te=>Te<=0)){var be,ye;const Te=(((be=d.flip)==null?void 0:be.index)||0)+1,Fe=ne[Te];if(Fe&&(!(I==="alignment"?Z!==_d(Fe):!1)||De.every(Ie=>Ie.overflows[0]>0&&_d(Ie.placement)===Z)))return{data:{index:Te,overflows:De},reset:{placement:Fe}};let Je=(ye=De.filter(je=>je.overflows[0]<=0).sort((je,Ie)=>je.overflows[1]-Ie.overflows[1])[0])==null?void 0:ye.placement;if(!Je)switch(P){case"bestFit":{var Ge;const je=(Ge=De.filter(Ie=>{if(le){const He=_d(Ie.placement);return He===Z||He==="y"}return!0}).map(Ie=>[Ie.placement,Ie.overflows.filter(He=>He>0).reduce((He,re)=>He+re,0)]).sort((Ie,He)=>Ie[1]-He[1])[0])==null?void 0:Ge[0];je&&(Je=je);break}case"initialPlacement":Je=E;break}if(l!==Je)return{reset:{placement:Je}}}return{}}}};function LK(i,n){return{top:i.top-n.height,right:i.right-n.width,bottom:i.bottom-n.height,left:i.left-n.width}}function MK(i){return LEe.some(n=>i[n]>=0)}const XEe=function(i){return i===void 0&&(i={}),{name:"hide",options:i,async fn(n){const{rects:s}=n,{strategy:a="referenceHidden",...l}=Eh(i,n);switch(a){case"referenceHidden":{const d=await uw(n,{...l,elementContext:"reference"}),f=LK(d,s.reference);return{data:{referenceHiddenOffsets:f,referenceHidden:MK(f)}}}case"escaped":{const d=await uw(n,{...l,altBoundary:!0}),f=LK(d,s.floating);return{data:{escapedOffsets:f,escaped:MK(f)}}}default:return{}}}}},aJ=new Set(["left","top"]);async function JEe(i,n){const{placement:s,platform:a,elements:l}=i,d=await(a.isRTL==null?void 0:a.isRTL(l.floating)),f=yh(s),E=uv(s),S=_d(s)==="y",T=aJ.has(f)?-1:1,C=d&&S?-1:1,I=Eh(n,i);let{mainAxis:N,crossAxis:P,alignmentAxis:W}=typeof I=="number"?{mainAxis:I,crossAxis:0,alignmentAxis:null}:{mainAxis:I.mainAxis||0,crossAxis:I.crossAxis||0,alignmentAxis:I.alignmentAxis};return E&&typeof W=="number"&&(P=E==="end"?W*-1:W),S?{x:P*C,y:N*T}:{x:N*T,y:P*C}}const $Ee=function(i){return i===void 0&&(i=0),{name:"offset",options:i,async fn(n){var s,a;const{x:l,y:d,placement:f,middlewareData:E}=n,S=await JEe(n,i);return f===((s=E.offset)==null?void 0:s.placement)&&(a=E.arrow)!=null&&a.alignmentOffset?{}:{x:l+S.x,y:d+S.y,data:{...S,placement:f}}}}},QEe=function(i){return i===void 0&&(i={}),{name:"shift",options:i,async fn(n){const{x:s,y:a,placement:l}=n,{mainAxis:d=!0,crossAxis:f=!1,limiter:E={fn:B=>{let{x:X,y:Z}=B;return{x:X,y:Z}}},...S}=Eh(i,n),T={x:s,y:a},C=await uw(n,S),I=_d(yh(l)),N=P2(I);let P=T[N],W=T[I];if(d){const B=N==="y"?"top":"left",X=N==="y"?"bottom":"right",Z=P+C[B],$=P-C[X];P=nM(Z,P,$)}if(f){const B=I==="y"?"top":"left",X=I==="y"?"bottom":"right",Z=W+C[B],$=W-C[X];W=nM(Z,W,$)}const x=E.fn({...n,[N]:P,[I]:W});return{...x,data:{x:x.x-s,y:x.y-a,enabled:{[N]:d,[I]:f}}}}}},ZEe=function(i){return i===void 0&&(i={}),{options:i,fn(n){const{x:s,y:a,placement:l,rects:d,middlewareData:f}=n,{offset:E=0,mainAxis:S=!0,crossAxis:T=!0}=Eh(i,n),C={x:s,y:a},I=_d(l),N=P2(I);let P=C[N],W=C[I];const x=Eh(E,n),B=typeof x=="number"?{mainAxis:x,crossAxis:0}:{mainAxis:0,crossAxis:0,...x};if(S){const $=N==="y"?"height":"width",ae=d.reference[N]-d.floating[$]+B.mainAxis,ce=d.reference[N]+d.reference[$]-B.mainAxis;P<ae?P=ae:P>ce&&(P=ce)}if(T){var X,Z;const $=N==="y"?"width":"height",ae=aJ.has(yh(l)),ce=d.reference[I]-d.floating[$]+(ae&&((X=f.offset)==null?void 0:X[I])||0)+(ae?0:B.crossAxis),le=d.reference[I]+d.reference[$]+(ae?0:((Z=f.offset)==null?void 0:Z[I])||0)-(ae?B.crossAxis:0);W<ce?W=ce:W>le&&(W=le)}return{[N]:P,[I]:W}}}},eye=function(i){return i===void 0&&(i={}),{name:"size",options:i,async fn(n){var s,a;const{placement:l,rects:d,platform:f,elements:E}=n,{apply:S=()=>{},...T}=Eh(i,n),C=await uw(n,T),I=yh(l),N=uv(l),P=_d(l)==="y",{width:W,height:x}=d.floating;let B,X;I==="top"||I==="bottom"?(B=I,X=N===(await(f.isRTL==null?void 0:f.isRTL(E.floating))?"start":"end")?"left":"right"):(X=I,B=N==="end"?"top":"bottom");const Z=x-C.top-C.bottom,$=W-C.left-C.right,ae=lf(x-C[B],Z),ce=lf(W-C[X],$),le=!n.middlewareData.shift;let ne=ae,fe=ce;if((s=n.middlewareData.shift)!=null&&s.enabled.x&&(fe=$),(a=n.middlewareData.shift)!=null&&a.enabled.y&&(ne=Z),le&&!N){const De=uc(C.left,0),be=uc(C.right,0),ye=uc(C.top,0),Ge=uc(C.bottom,0);P?fe=W-2*(De!==0||be!==0?De+be:uc(C.left,C.right)):ne=x-2*(ye!==0||Ge!==0?ye+Ge:uc(C.top,C.bottom))}await S({...n,availableWidth:fe,availableHeight:ne});const Se=await f.getDimensions(E.floating);return W!==Se.width||x!==Se.height?{reset:{rects:!0}}:{}}}};function xO(){return typeof window<"u"}function dv(i){return cJ(i)?(i.nodeName||"").toLowerCase():"#document"}function mc(i){var n;return(i==null||(n=i.ownerDocument)==null?void 0:n.defaultView)||window}function Od(i){var n;return(n=(cJ(i)?i.ownerDocument:i.document)||window.document)==null?void 0:n.documentElement}function cJ(i){return xO()?i instanceof Node||i instanceof mc(i).Node:!1}function du(i){return xO()?i instanceof Element||i instanceof mc(i).Element:!1}function Cd(i){return xO()?i instanceof HTMLElement||i instanceof mc(i).HTMLElement:!1}function UK(i){return!xO()||typeof ShadowRoot>"u"?!1:i instanceof ShadowRoot||i instanceof mc(i).ShadowRoot}const tye=new Set(["inline","contents"]);function Bw(i){const{overflow:n,overflowX:s,overflowY:a,display:l}=hu(i);return/auto|scroll|overlay|hidden|clip/.test(n+a+s)&&!tye.has(l)}const nye=new Set(["table","td","th"]);function rye(i){return nye.has(dv(i))}const iye=[":popover-open",":modal"];function LO(i){return iye.some(n=>{try{return i.matches(n)}catch{return!1}})}const sye=["transform","translate","scale","rotate","perspective"],oye=["transform","translate","scale","rotate","perspective","filter"],aye=["paint","layout","strict","content"];function x2(i){const n=L2(),s=du(i)?hu(i):i;return sye.some(a=>s[a]?s[a]!=="none":!1)||(s.containerType?s.containerType!=="normal":!1)||!n&&(s.backdropFilter?s.backdropFilter!=="none":!1)||!n&&(s.filter?s.filter!=="none":!1)||oye.some(a=>(s.willChange||"").includes(a))||aye.some(a=>(s.contain||"").includes(a))}function cye(i){let n=uf(i);for(;Cd(n)&&!Xy(n);){if(x2(n))return n;if(LO(n))return null;n=uf(n)}return null}function L2(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const lye=new Set(["html","body","#document"]);function Xy(i){return lye.has(dv(i))}function hu(i){return mc(i).getComputedStyle(i)}function MO(i){return du(i)?{scrollLeft:i.scrollLeft,scrollTop:i.scrollTop}:{scrollLeft:i.scrollX,scrollTop:i.scrollY}}function uf(i){if(dv(i)==="html")return i;const n=i.assignedSlot||i.parentNode||UK(i)&&i.host||Od(i);return UK(n)?n.host:n}function lJ(i){const n=uf(i);return Xy(n)?i.ownerDocument?i.ownerDocument.body:i.body:Cd(n)&&Bw(n)?n:lJ(n)}function dw(i,n,s){var a;n===void 0&&(n=[]),s===void 0&&(s=!0);const l=lJ(i),d=l===((a=i.ownerDocument)==null?void 0:a.body),f=mc(l);if(d){const E=iM(f);return n.concat(f,f.visualViewport||[],Bw(l)?l:[],E&&s?dw(E):[])}return n.concat(l,dw(l,[],s))}function iM(i){return i.parent&&Object.getPrototypeOf(i.parent)?i.frameElement:null}function uJ(i){const n=hu(i);let s=parseFloat(n.width)||0,a=parseFloat(n.height)||0;const l=Cd(i),d=l?i.offsetWidth:s,f=l?i.offsetHeight:a,E=GA(s)!==d||GA(a)!==f;return E&&(s=d,a=f),{width:s,height:a,$:E}}function M2(i){return du(i)?i:i.contextElement}function My(i){const n=M2(i);if(!Cd(n))return yd(1);const s=n.getBoundingClientRect(),{width:a,height:l,$:d}=uJ(n);let f=(d?GA(s.width):s.width)/a,E=(d?GA(s.height):s.height)/l;return(!f||!Number.isFinite(f))&&(f=1),(!E||!Number.isFinite(E))&&(E=1),{x:f,y:E}}const uye=yd(0);function dJ(i){const n=mc(i);return!L2()||!n.visualViewport?uye:{x:n.visualViewport.offsetLeft,y:n.visualViewport.offsetTop}}function dye(i,n,s){return n===void 0&&(n=!1),!s||n&&s!==mc(i)?!1:n}function Dg(i,n,s,a){n===void 0&&(n=!1),s===void 0&&(s=!1);const l=i.getBoundingClientRect(),d=M2(i);let f=yd(1);n&&(a?du(a)&&(f=My(a)):f=My(i));const E=dye(d,s,a)?dJ(d):yd(0);let S=(l.left+E.x)/f.x,T=(l.top+E.y)/f.y,C=l.width/f.x,I=l.height/f.y;if(d){const N=mc(d),P=a&&du(a)?mc(a):a;let W=N,x=iM(W);for(;x&&a&&P!==W;){const B=My(x),X=x.getBoundingClientRect(),Z=hu(x),$=X.left+(x.clientLeft+parseFloat(Z.paddingLeft))*B.x,ae=X.top+(x.clientTop+parseFloat(Z.paddingTop))*B.y;S*=B.x,T*=B.y,C*=B.x,I*=B.y,S+=$,T+=ae,W=mc(x),x=iM(W)}}return zA({width:C,height:I,x:S,y:T})}function U2(i,n){const s=MO(i).scrollLeft;return n?n.left+s:Dg(Od(i)).left+s}function hJ(i,n,s){s===void 0&&(s=!1);const a=i.getBoundingClientRect(),l=a.left+n.scrollLeft-(s?0:U2(i,a)),d=a.top+n.scrollTop;return{x:l,y:d}}function hye(i){let{elements:n,rect:s,offsetParent:a,strategy:l}=i;const d=l==="fixed",f=Od(a),E=n?LO(n.floating):!1;if(a===f||E&&d)return s;let S={scrollLeft:0,scrollTop:0},T=yd(1);const C=yd(0),I=Cd(a);if((I||!I&&!d)&&((dv(a)!=="body"||Bw(f))&&(S=MO(a)),Cd(a))){const P=Dg(a);T=My(a),C.x=P.x+a.clientLeft,C.y=P.y+a.clientTop}const N=f&&!I&&!d?hJ(f,S,!0):yd(0);return{width:s.width*T.x,height:s.height*T.y,x:s.x*T.x-S.scrollLeft*T.x+C.x+N.x,y:s.y*T.y-S.scrollTop*T.y+C.y+N.y}}function pye(i){return Array.from(i.getClientRects())}function fye(i){const n=Od(i),s=MO(i),a=i.ownerDocument.body,l=uc(n.scrollWidth,n.clientWidth,a.scrollWidth,a.clientWidth),d=uc(n.scrollHeight,n.clientHeight,a.scrollHeight,a.clientHeight);let f=-s.scrollLeft+U2(i);const E=-s.scrollTop;return hu(a).direction==="rtl"&&(f+=uc(n.clientWidth,a.clientWidth)-l),{width:l,height:d,x:f,y:E}}function mye(i,n){const s=mc(i),a=Od(i),l=s.visualViewport;let d=a.clientWidth,f=a.clientHeight,E=0,S=0;if(l){d=l.width,f=l.height;const T=L2();(!T||T&&n==="fixed")&&(E=l.offsetLeft,S=l.offsetTop)}return{width:d,height:f,x:E,y:S}}const gye=new Set(["absolute","fixed"]);function _ye(i,n){const s=Dg(i,!0,n==="fixed"),a=s.top+i.clientTop,l=s.left+i.clientLeft,d=Cd(i)?My(i):yd(1),f=i.clientWidth*d.x,E=i.clientHeight*d.y,S=l*d.x,T=a*d.y;return{width:f,height:E,x:S,y:T}}function VK(i,n,s){let a;if(n==="viewport")a=mye(i,s);else if(n==="document")a=fye(Od(i));else if(du(n))a=_ye(n,s);else{const l=dJ(i);a={x:n.x-l.x,y:n.y-l.y,width:n.width,height:n.height}}return zA(a)}function pJ(i,n){const s=uf(i);return s===n||!du(s)||Xy(s)?!1:hu(s).position==="fixed"||pJ(s,n)}function Eye(i,n){const s=n.get(i);if(s)return s;let a=dw(i,[],!1).filter(E=>du(E)&&dv(E)!=="body"),l=null;const d=hu(i).position==="fixed";let f=d?uf(i):i;for(;du(f)&&!Xy(f);){const E=hu(f),S=x2(f);!S&&E.position==="fixed"&&(l=null),(d?!S&&!l:!S&&E.position==="static"&&!!l&&gye.has(l.position)||Bw(f)&&!S&&pJ(i,f))?a=a.filter(C=>C!==f):l=E,f=uf(f)}return n.set(i,a),a}function yye(i){let{element:n,boundary:s,rootBoundary:a,strategy:l}=i;const f=[...s==="clippingAncestors"?LO(n)?[]:Eye(n,this._c):[].concat(s),a],E=f[0],S=f.reduce((T,C)=>{const I=VK(n,C,l);return T.top=uc(I.top,T.top),T.right=lf(I.right,T.right),T.bottom=lf(I.bottom,T.bottom),T.left=uc(I.left,T.left),T},VK(n,E,l));return{width:S.right-S.left,height:S.bottom-S.top,x:S.left,y:S.top}}function vye(i){const{width:n,height:s}=uJ(i);return{width:n,height:s}}function Sye(i,n,s){const a=Cd(n),l=Od(n),d=s==="fixed",f=Dg(i,!0,d,n);let E={scrollLeft:0,scrollTop:0};const S=yd(0);function T(){S.x=U2(l)}if(a||!a&&!d)if((dv(n)!=="body"||Bw(l))&&(E=MO(n)),a){const P=Dg(n,!0,d,n);S.x=P.x+n.clientLeft,S.y=P.y+n.clientTop}else l&&T();d&&!a&&l&&T();const C=l&&!a&&!d?hJ(l,E):yd(0),I=f.left+E.scrollLeft-S.x-C.x,N=f.top+E.scrollTop-S.y-C.y;return{x:I,y:N,width:f.width,height:f.height}}function Fx(i){return hu(i).position==="static"}function FK(i,n){if(!Cd(i)||hu(i).position==="fixed")return null;if(n)return n(i);let s=i.offsetParent;return Od(i)===s&&(s=s.ownerDocument.body),s}function fJ(i,n){const s=mc(i);if(LO(i))return s;if(!Cd(i)){let l=uf(i);for(;l&&!Xy(l);){if(du(l)&&!Fx(l))return l;l=uf(l)}return s}let a=FK(i,n);for(;a&&rye(a)&&Fx(a);)a=FK(a,n);return a&&Xy(a)&&Fx(a)&&!x2(a)?s:a||cye(i)||s}const Tye=async function(i){const n=this.getOffsetParent||fJ,s=this.getDimensions,a=await s(i.floating);return{reference:Sye(i.reference,await n(i.floating),i.strategy),floating:{x:0,y:0,width:a.width,height:a.height}}};function wye(i){return hu(i).direction==="rtl"}const Cye={convertOffsetParentRelativeRectToViewportRelativeRect:hye,getDocumentElement:Od,getClippingRect:yye,getOffsetParent:fJ,getElementRects:Tye,getClientRects:pye,getDimensions:vye,getScale:My,isElement:du,isRTL:wye};function mJ(i,n){return i.x===n.x&&i.y===n.y&&i.width===n.width&&i.height===n.height}function Rye(i,n){let s=null,a;const l=Od(i);function d(){var E;clearTimeout(a),(E=s)==null||E.disconnect(),s=null}function f(E,S){E===void 0&&(E=!1),S===void 0&&(S=1),d();const T=i.getBoundingClientRect(),{left:C,top:I,width:N,height:P}=T;if(E||n(),!N||!P)return;const W=nA(I),x=nA(l.clientWidth-(C+N)),B=nA(l.clientHeight-(I+P)),X=nA(C),$={rootMargin:-W+"px "+-x+"px "+-B+"px "+-X+"px",threshold:uc(0,lf(1,S))||1};let ae=!0;function ce(le){const ne=le[0].intersectionRatio;if(ne!==S){if(!ae)return f();ne?f(!1,ne):a=setTimeout(()=>{f(!1,1e-7)},1e3)}ne===1&&!mJ(T,i.getBoundingClientRect())&&f(),ae=!1}try{s=new IntersectionObserver(ce,{...$,root:l.ownerDocument})}catch{s=new IntersectionObserver(ce,$)}s.observe(i)}return f(!0),d}function bye(i,n,s,a){a===void 0&&(a={});const{ancestorScroll:l=!0,ancestorResize:d=!0,elementResize:f=typeof ResizeObserver=="function",layoutShift:E=typeof IntersectionObserver=="function",animationFrame:S=!1}=a,T=M2(i),C=l||d?[...T?dw(T):[],...dw(n)]:[];C.forEach(X=>{l&&X.addEventListener("scroll",s,{passive:!0}),d&&X.addEventListener("resize",s)});const I=T&&E?Rye(T,s):null;let N=-1,P=null;f&&(P=new ResizeObserver(X=>{let[Z]=X;Z&&Z.target===T&&P&&(P.unobserve(n),cancelAnimationFrame(N),N=requestAnimationFrame(()=>{var $;($=P)==null||$.observe(n)})),s()}),T&&!S&&P.observe(T),P.observe(n));let W,x=S?Dg(i):null;S&&B();function B(){const X=Dg(i);x&&!mJ(x,X)&&s(),x=X,W=requestAnimationFrame(B)}return s(),()=>{var X;C.forEach(Z=>{l&&Z.removeEventListener("scroll",s),d&&Z.removeEventListener("resize",s)}),I?.(),(X=P)==null||X.disconnect(),P=null,S&&cancelAnimationFrame(W)}}const Iye=$Ee,Aye=QEe,Oye=qEe,Nye=eye,Pye=XEe,jK=YEe,kye=ZEe,Dye=(i,n,s)=>{const a=new Map,l={platform:Cye,...s},d={...l.platform,_c:a};return KEe(i,n,{...l,platform:d})};var xye=typeof document<"u",Lye=function(){},vA=xye?H.useLayoutEffect:Lye;function KA(i,n){if(i===n)return!0;if(typeof i!=typeof n)return!1;if(typeof i=="function"&&i.toString()===n.toString())return!0;let s,a,l;if(i&&n&&typeof i=="object"){if(Array.isArray(i)){if(s=i.length,s!==n.length)return!1;for(a=s;a--!==0;)if(!KA(i[a],n[a]))return!1;return!0}if(l=Object.keys(i),s=l.length,s!==Object.keys(n).length)return!1;for(a=s;a--!==0;)if(!{}.hasOwnProperty.call(n,l[a]))return!1;for(a=s;a--!==0;){const d=l[a];if(!(d==="_owner"&&i.$$typeof)&&!KA(i[d],n[d]))return!1}return!0}return i!==i&&n!==n}function gJ(i){return typeof window>"u"?1:(i.ownerDocument.defaultView||window).devicePixelRatio||1}function BK(i,n){const s=gJ(i);return Math.round(n*s)/s}function jx(i){const n=H.useRef(i);return vA(()=>{n.current=i}),n}function Mye(i){i===void 0&&(i={});const{placement:n="bottom",strategy:s="absolute",middleware:a=[],platform:l,elements:{reference:d,floating:f}={},transform:E=!0,whileElementsMounted:S,open:T}=i,[C,I]=H.useState({x:0,y:0,strategy:s,placement:n,middlewareData:{},isPositioned:!1}),[N,P]=H.useState(a);KA(N,a)||P(a);const[W,x]=H.useState(null),[B,X]=H.useState(null),Z=H.useCallback(Ie=>{Ie!==le.current&&(le.current=Ie,x(Ie))},[]),$=H.useCallback(Ie=>{Ie!==ne.current&&(ne.current=Ie,X(Ie))},[]),ae=d||W,ce=f||B,le=H.useRef(null),ne=H.useRef(null),fe=H.useRef(C),Se=S!=null,De=jx(S),be=jx(l),ye=jx(T),Ge=H.useCallback(()=>{if(!le.current||!ne.current)return;const Ie={placement:n,strategy:s,middleware:N};be.current&&(Ie.platform=be.current),Dye(le.current,ne.current,Ie).then(He=>{const re={...He,isPositioned:ye.current!==!1};Te.current&&!KA(fe.current,re)&&(fe.current=re,Uw.flushSync(()=>{I(re)}))})},[N,n,s,be,ye]);vA(()=>{T===!1&&fe.current.isPositioned&&(fe.current.isPositioned=!1,I(Ie=>({...Ie,isPositioned:!1})))},[T]);const Te=H.useRef(!1);vA(()=>(Te.current=!0,()=>{Te.current=!1}),[]),vA(()=>{if(ae&&(le.current=ae),ce&&(ne.current=ce),ae&&ce){if(De.current)return De.current(ae,ce,Ge);Ge()}},[ae,ce,Ge,De,Se]);const Fe=H.useMemo(()=>({reference:le,floating:ne,setReference:Z,setFloating:$}),[Z,$]),Je=H.useMemo(()=>({reference:ae,floating:ce}),[ae,ce]),je=H.useMemo(()=>{const Ie={position:s,left:0,top:0};if(!Je.floating)return Ie;const He=BK(Je.floating,C.x),re=BK(Je.floating,C.y);return E?{...Ie,transform:"translate("+He+"px, "+re+"px)",...gJ(Je.floating)>=1.5&&{willChange:"transform"}}:{position:s,left:He,top:re}},[s,E,Je.floating,C.x,C.y]);return H.useMemo(()=>({...C,update:Ge,refs:Fe,elements:Je,floatingStyles:je}),[C,Ge,Fe,Je,je])}const Uye=i=>{function n(s){return{}.hasOwnProperty.call(s,"current")}return{name:"arrow",options:i,fn(s){const{element:a,padding:l}=typeof i=="function"?i(s):i;return a&&n(a)?a.current!=null?jK({element:a.current,padding:l}).fn(s):{}:a?jK({element:a,padding:l}).fn(s):{}}}},Vye=(i,n)=>({...Iye(i),options:[i,n]}),Fye=(i,n)=>({...Aye(i),options:[i,n]}),jye=(i,n)=>({...kye(i),options:[i,n]}),Bye=(i,n)=>({...Oye(i),options:[i,n]}),Wye=(i,n)=>({...Nye(i),options:[i,n]}),Gye=(i,n)=>({...Pye(i),options:[i,n]}),Hye=(i,n)=>({...Uye(i),options:[i,n]});var zye="Arrow",_J=H.forwardRef((i,n)=>{const{children:s,width:a=10,height:l=5,...d}=i;return D.jsx(ri.svg,{...d,ref:n,width:a,height:l,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:i.asChild?s:D.jsx("polygon",{points:"0,0 30,0 15,10"})})});_J.displayName=zye;var Kye=_J;function EJ(i){const[n,s]=H.useState(void 0);return _h(()=>{if(i){s({width:i.offsetWidth,height:i.offsetHeight});const a=new ResizeObserver(l=>{if(!Array.isArray(l)||!l.length)return;const d=l[0];let f,E;if("borderBoxSize"in d){const S=d.borderBoxSize,T=Array.isArray(S)?S[0]:S;f=T.inlineSize,E=T.blockSize}else f=i.offsetWidth,E=i.offsetHeight;s({width:f,height:E})});return a.observe(i,{box:"border-box"}),()=>a.unobserve(i)}else s(void 0)},[i]),n}var yJ="Popper",[vJ,SJ]=Ef(yJ),[iFe,TJ]=vJ(yJ),wJ="PopperAnchor",CJ=H.forwardRef((i,n)=>{const{__scopePopper:s,virtualRef:a,...l}=i,d=TJ(wJ,s),f=H.useRef(null),E=Xs(n,f);return H.useEffect(()=>{d.onAnchorChange(a?.current||f.current)}),a?null:D.jsx(ri.div,{...l,ref:E})});CJ.displayName=wJ;var V2="PopperContent",[Yye,qye]=vJ(V2),RJ=H.forwardRef((i,n)=>{const{__scopePopper:s,side:a="bottom",sideOffset:l=0,align:d="center",alignOffset:f=0,arrowPadding:E=0,avoidCollisions:S=!0,collisionBoundary:T=[],collisionPadding:C=0,sticky:I="partial",hideWhenDetached:N=!1,updatePositionStrategy:P="optimized",onPlaced:W,...x}=i,B=TJ(V2,s),[X,Z]=H.useState(null),$=Xs(n,At=>Z(At)),[ae,ce]=H.useState(null),le=EJ(ae),ne=le?.width??0,fe=le?.height??0,Se=a+(d!=="center"?"-"+d:""),De=typeof C=="number"?C:{top:0,right:0,bottom:0,left:0,...C},be=Array.isArray(T)?T:[T],ye=be.length>0,Ge={padding:De,boundary:be.filter(Jye),altBoundary:ye},{refs:Te,floatingStyles:Fe,placement:Je,isPositioned:je,middlewareData:Ie}=Mye({strategy:"fixed",placement:Se,whileElementsMounted:(...At)=>bye(...At,{animationFrame:P==="always"}),elements:{reference:B.anchor},middleware:[Vye({mainAxis:l+fe,alignmentAxis:f}),S&&Fye({mainAxis:!0,crossAxis:!1,limiter:I==="partial"?jye():void 0,...Ge}),S&&Bye({...Ge}),Wye({...Ge,apply:({elements:At,rects:dn,availableWidth:Cn,availableHeight:fr})=>{const{width:as,height:Jr}=dn.reference,Mr=At.floating.style;Mr.setProperty("--radix-popper-available-width",`${Cn}px`),Mr.setProperty("--radix-popper-available-height",`${fr}px`),Mr.setProperty("--radix-popper-anchor-width",`${as}px`),Mr.setProperty("--radix-popper-anchor-height",`${Jr}px`)}}),ae&&Hye({element:ae,padding:E}),$ye({arrowWidth:ne,arrowHeight:fe}),N&&Gye({strategy:"referenceHidden",...Ge})]}),[He,re]=AJ(Je),ge=uu(W);_h(()=>{je&&ge?.()},[je,ge]);const Oe=Ie.arrow?.x,ue=Ie.arrow?.y,it=Ie.arrow?.centerOffset!==0,[yt,Dt]=H.useState();return _h(()=>{X&&Dt(window.getComputedStyle(X).zIndex)},[X]),D.jsx("div",{ref:Te.setFloating,"data-radix-popper-content-wrapper":"",style:{...Fe,transform:je?Fe.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:yt,"--radix-popper-transform-origin":[Ie.transformOrigin?.x,Ie.transformOrigin?.y].join(" "),...Ie.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:i.dir,children:D.jsx(Yye,{scope:s,placedSide:He,onArrowChange:ce,arrowX:Oe,arrowY:ue,shouldHideArrow:it,children:D.jsx(ri.div,{"data-side":He,"data-align":re,...x,ref:$,style:{...x.style,animation:je?void 0:"none"}})})})});RJ.displayName=V2;var bJ="PopperArrow",Xye={top:"bottom",right:"left",bottom:"top",left:"right"},IJ=H.forwardRef(function(n,s){const{__scopePopper:a,...l}=n,d=qye(bJ,a),f=Xye[d.placedSide];return D.jsx("span",{ref:d.onArrowChange,style:{position:"absolute",left:d.arrowX,top:d.arrowY,[f]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[d.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[d.placedSide],visibility:d.shouldHideArrow?"hidden":void 0},children:D.jsx(Kye,{...l,ref:s,style:{...l.style,display:"block"}})})});IJ.displayName=bJ;function Jye(i){return i!==null}var $ye=i=>({name:"transformOrigin",options:i,fn(n){const{placement:s,rects:a,middlewareData:l}=n,f=l.arrow?.centerOffset!==0,E=f?0:i.arrowWidth,S=f?0:i.arrowHeight,[T,C]=AJ(s),I={start:"0%",center:"50%",end:"100%"}[C],N=(l.arrow?.x??0)+E/2,P=(l.arrow?.y??0)+S/2;let W="",x="";return T==="bottom"?(W=f?I:`${N}px`,x=`${-S}px`):T==="top"?(W=f?I:`${N}px`,x=`${a.floating.height+S}px`):T==="right"?(W=`${-S}px`,x=f?I:`${P}px`):T==="left"&&(W=`${a.floating.width+S}px`,x=f?I:`${P}px`),{data:{x:W,y:x}}}});function AJ(i){const[n,s="center"]=i.split("-");return[n,s]}var Qye=CJ,Zye=RJ,eve=IJ,[UO]=Ef("Tooltip",[SJ]),F2=SJ(),OJ="TooltipProvider",tve=700,WK="tooltip.open",[nve,NJ]=UO(OJ),PJ=i=>{const{__scopeTooltip:n,delayDuration:s=tve,skipDelayDuration:a=300,disableHoverableContent:l=!1,children:d}=i,f=H.useRef(!0),E=H.useRef(!1),S=H.useRef(0);return H.useEffect(()=>{const T=S.current;return()=>window.clearTimeout(T)},[]),D.jsx(nve,{scope:n,isOpenDelayedRef:f,delayDuration:s,onOpen:H.useCallback(()=>{window.clearTimeout(S.current),f.current=!1},[]),onClose:H.useCallback(()=>{window.clearTimeout(S.current),S.current=window.setTimeout(()=>f.current=!0,a)},[a]),isPointerInTransitRef:E,onPointerInTransitChange:H.useCallback(T=>{E.current=T},[]),disableHoverableContent:l,children:d})};PJ.displayName=OJ;var kJ="Tooltip",[sFe,VO]=UO(kJ),sM="TooltipTrigger",rve=H.forwardRef((i,n)=>{const{__scopeTooltip:s,...a}=i,l=VO(sM,s),d=NJ(sM,s),f=F2(s),E=H.useRef(null),S=Xs(n,E,l.onTriggerChange),T=H.useRef(!1),C=H.useRef(!1),I=H.useCallback(()=>T.current=!1,[]);return H.useEffect(()=>()=>document.removeEventListener("pointerup",I),[I]),D.jsx(Qye,{asChild:!0,...f,children:D.jsx(ri.button,{"aria-describedby":l.open?l.contentId:void 0,"data-state":l.stateAttribute,...a,ref:S,onPointerMove:vr(i.onPointerMove,N=>{N.pointerType!=="touch"&&!C.current&&!d.isPointerInTransitRef.current&&(l.onTriggerEnter(),C.current=!0)}),onPointerLeave:vr(i.onPointerLeave,()=>{l.onTriggerLeave(),C.current=!1}),onPointerDown:vr(i.onPointerDown,()=>{l.open&&l.onClose(),T.current=!0,document.addEventListener("pointerup",I,{once:!0})}),onFocus:vr(i.onFocus,()=>{T.current||l.onOpen()}),onBlur:vr(i.onBlur,l.onClose),onClick:vr(i.onClick,l.onClose)})})});rve.displayName=sM;var ive="TooltipPortal",[oFe,sve]=UO(ive,{forceMount:void 0}),Jy="TooltipContent",DJ=H.forwardRef((i,n)=>{const s=sve(Jy,i.__scopeTooltip),{forceMount:a=s.forceMount,side:l="top",...d}=i,f=VO(Jy,i.__scopeTooltip);return D.jsx(Gg,{present:a||f.open,children:f.disableHoverableContent?D.jsx(xJ,{side:l,...d,ref:n}):D.jsx(ove,{side:l,...d,ref:n})})}),ove=H.forwardRef((i,n)=>{const s=VO(Jy,i.__scopeTooltip),a=NJ(Jy,i.__scopeTooltip),l=H.useRef(null),d=Xs(n,l),[f,E]=H.useState(null),{trigger:S,onClose:T}=s,C=l.current,{onPointerInTransitChange:I}=a,N=H.useCallback(()=>{E(null),I(!1)},[I]),P=H.useCallback((W,x)=>{const B=W.currentTarget,X={x:W.clientX,y:W.clientY},Z=dve(X,B.getBoundingClientRect()),$=hve(X,Z),ae=pve(x.getBoundingClientRect()),ce=mve([...$,...ae]);E(ce),I(!0)},[I]);return H.useEffect(()=>()=>N(),[N]),H.useEffect(()=>{if(S&&C){const W=B=>P(B,C),x=B=>P(B,S);return S.addEventListener("pointerleave",W),C.addEventListener("pointerleave",x),()=>{S.removeEventListener("pointerleave",W),C.removeEventListener("pointerleave",x)}}},[S,C,P,N]),H.useEffect(()=>{if(f){const W=x=>{const B=x.target,X={x:x.clientX,y:x.clientY},Z=S?.contains(B)||C?.contains(B),$=!fve(X,f);Z?N():$&&(N(),T())};return document.addEventListener("pointermove",W),()=>document.removeEventListener("pointermove",W)}},[S,C,f,T,N]),D.jsx(xJ,{...i,ref:d})}),[ave,cve]=UO(kJ,{isInside:!1}),lve=$me("TooltipContent"),xJ=H.forwardRef((i,n)=>{const{__scopeTooltip:s,children:a,"aria-label":l,onEscapeKeyDown:d,onPointerDownOutside:f,...E}=i,S=VO(Jy,s),T=F2(s),{onClose:C}=S;return H.useEffect(()=>(document.addEventListener(WK,C),()=>document.removeEventListener(WK,C)),[C]),H.useEffect(()=>{if(S.trigger){const I=N=>{N.target?.contains(S.trigger)&&C()};return window.addEventListener("scroll",I,{capture:!0}),()=>window.removeEventListener("scroll",I,{capture:!0})}},[S.trigger,C]),D.jsx(AO,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:d,onPointerDownOutside:f,onFocusOutside:I=>I.preventDefault(),onDismiss:C,children:D.jsxs(Zye,{"data-state":S.stateAttribute,...T,...E,ref:n,style:{...E.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[D.jsx(lve,{children:a}),D.jsx(ave,{scope:s,isInside:!0,children:D.jsx(vge,{id:S.contentId,role:"tooltip",children:l||a})})]})})});DJ.displayName=Jy;var LJ="TooltipArrow",uve=H.forwardRef((i,n)=>{const{__scopeTooltip:s,...a}=i,l=F2(s);return cve(LJ,s).isInside?null:D.jsx(eve,{...l,...a,ref:n})});uve.displayName=LJ;function dve(i,n){const s=Math.abs(n.top-i.y),a=Math.abs(n.bottom-i.y),l=Math.abs(n.right-i.x),d=Math.abs(n.left-i.x);switch(Math.min(s,a,l,d)){case d:return"left";case l:return"right";case s:return"top";case a:return"bottom";default:throw new Error("unreachable")}}function hve(i,n,s=5){const a=[];switch(n){case"top":a.push({x:i.x-s,y:i.y+s},{x:i.x+s,y:i.y+s});break;case"bottom":a.push({x:i.x-s,y:i.y-s},{x:i.x+s,y:i.y-s});break;case"left":a.push({x:i.x+s,y:i.y-s},{x:i.x+s,y:i.y+s});break;case"right":a.push({x:i.x-s,y:i.y-s},{x:i.x-s,y:i.y+s});break}return a}function pve(i){const{top:n,right:s,bottom:a,left:l}=i;return[{x:l,y:n},{x:s,y:n},{x:s,y:a},{x:l,y:a}]}function fve(i,n){const{x:s,y:a}=i;let l=!1;for(let d=0,f=n.length-1;d<n.length;f=d++){const E=n[d],S=n[f],T=E.x,C=E.y,I=S.x,N=S.y;C>a!=N>a&&s<(I-T)*(a-C)/(N-C)+T&&(l=!l)}return l}function mve(i){const n=i.slice();return n.sort((s,a)=>s.x<a.x?-1:s.x>a.x?1:s.y<a.y?-1:s.y>a.y?1:0),gve(n)}function gve(i){if(i.length<=1)return i.slice();const n=[];for(let a=0;a<i.length;a++){const l=i[a];for(;n.length>=2;){const d=n[n.length-1],f=n[n.length-2];if((d.x-f.x)*(l.y-f.y)>=(d.y-f.y)*(l.x-f.x))n.pop();else break}n.push(l)}n.pop();const s=[];for(let a=i.length-1;a>=0;a--){const l=i[a];for(;s.length>=2;){const d=s[s.length-1],f=s[s.length-2];if((d.x-f.x)*(l.y-f.y)>=(d.y-f.y)*(l.x-f.x))s.pop();else break}s.push(l)}return s.pop(),n.length===1&&s.length===1&&n[0].x===s[0].x&&n[0].y===s[0].y?n:n.concat(s)}var _ve=PJ,MJ=DJ;const Eve=_ve,yve=H.forwardRef(({className:i,sideOffset:n=4,...s},a)=>D.jsx(MJ,{ref:a,sideOffset:n,className:Br("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",i),...s}));yve.displayName=MJ.displayName;function Ui(){return Ui=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var s=arguments[n];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(i[a]=s[a])}return i},Ui.apply(this,arguments)}var Ss;(function(i){i.Pop="POP",i.Push="PUSH",i.Replace="REPLACE"})(Ss||(Ss={}));const GK="popstate";function vve(i){i===void 0&&(i={});function n(l,d){let{pathname:f="/",search:E="",hash:S=""}=Ah(l.location.hash.substr(1));return!f.startsWith("/")&&!f.startsWith(".")&&(f="/"+f),hw("",{pathname:f,search:E,hash:S},d.state&&d.state.usr||null,d.state&&d.state.key||"default")}function s(l,d){let f=l.document.querySelector("base"),E="";if(f&&f.getAttribute("href")){let S=l.location.href,T=S.indexOf("#");E=T===-1?S:S.slice(0,T)}return E+"#"+(typeof d=="string"?d:Lg(d))}function a(l,d){xg(l.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(d)+")")}return Tve(n,s,a,i)}function ur(i,n){if(i===!1||i===null||typeof i>"u")throw new Error(n)}function xg(i,n){if(!i){typeof console<"u"&&console.warn(n);try{throw new Error(n)}catch{}}}function Sve(){return Math.random().toString(36).substr(2,8)}function HK(i,n){return{usr:i.state,key:i.key,idx:n}}function hw(i,n,s,a){return s===void 0&&(s=null),Ui({pathname:typeof i=="string"?i:i.pathname,search:"",hash:""},typeof n=="string"?Ah(n):n,{state:s,key:n&&n.key||a||Sve()})}function Lg(i){let{pathname:n="/",search:s="",hash:a=""}=i;return s&&s!=="?"&&(n+=s.charAt(0)==="?"?s:"?"+s),a&&a!=="#"&&(n+=a.charAt(0)==="#"?a:"#"+a),n}function Ah(i){let n={};if(i){let s=i.indexOf("#");s>=0&&(n.hash=i.substr(s),i=i.substr(0,s));let a=i.indexOf("?");a>=0&&(n.search=i.substr(a),i=i.substr(0,a)),i&&(n.pathname=i)}return n}function Tve(i,n,s,a){a===void 0&&(a={});let{window:l=document.defaultView,v5Compat:d=!1}=a,f=l.history,E=Ss.Pop,S=null,T=C();T==null&&(T=0,f.replaceState(Ui({},f.state,{idx:T}),""));function C(){return(f.state||{idx:null}).idx}function I(){E=Ss.Pop;let B=C(),X=B==null?null:B-T;T=B,S&&S({action:E,location:x.location,delta:X})}function N(B,X){E=Ss.Push;let Z=hw(x.location,B,X);s&&s(Z,B),T=C()+1;let $=HK(Z,T),ae=x.createHref(Z);try{f.pushState($,"",ae)}catch(ce){if(ce instanceof DOMException&&ce.name==="DataCloneError")throw ce;l.location.assign(ae)}d&&S&&S({action:E,location:x.location,delta:1})}function P(B,X){E=Ss.Replace;let Z=hw(x.location,B,X);s&&s(Z,B),T=C();let $=HK(Z,T),ae=x.createHref(Z);f.replaceState($,"",ae),d&&S&&S({action:E,location:x.location,delta:0})}function W(B){let X=l.location.origin!=="null"?l.location.origin:l.location.href,Z=typeof B=="string"?B:Lg(B);return Z=Z.replace(/ $/,"%20"),ur(X,"No window.location.(origin|href) available to create URL for href: "+Z),new URL(Z,X)}let x={get action(){return E},get location(){return i(l,f)},listen(B){if(S)throw new Error("A history only accepts one active listener");return l.addEventListener(GK,I),S=B,()=>{l.removeEventListener(GK,I),S=null}},createHref(B){return n(l,B)},createURL:W,encodeLocation(B){let X=W(B);return{pathname:X.pathname,search:X.search,hash:X.hash}},push:N,replace:P,go(B){return f.go(B)}};return x}var Xr;(function(i){i.data="data",i.deferred="deferred",i.redirect="redirect",i.error="error"})(Xr||(Xr={}));const wve=new Set(["lazy","caseSensitive","path","id","index","children"]);function Cve(i){return i.index===!0}function YA(i,n,s,a){return s===void 0&&(s=[]),a===void 0&&(a={}),i.map((l,d)=>{let f=[...s,String(d)],E=typeof l.id=="string"?l.id:f.join("-");if(ur(l.index!==!0||!l.children,"Cannot specify children on an index route"),ur(!a[E],'Found a route id collision on id "'+E+`".  Route id's must be globally unique within Data Router usages`),Cve(l)){let S=Ui({},l,n(l),{id:E});return a[E]=S,S}else{let S=Ui({},l,n(l),{id:E,children:void 0});return a[E]=S,l.children&&(S.children=YA(l.children,n,f,a)),S}})}function yg(i,n,s){return s===void 0&&(s="/"),SA(i,n,s,!1)}function SA(i,n,s,a){let l=typeof n=="string"?Ah(n):n,d=hv(l.pathname||"/",s);if(d==null)return null;let f=UJ(i);bve(f);let E=null;for(let S=0;E==null&&S<f.length;++S){let T=Uve(d);E=Lve(f[S],T,a)}return E}function Rve(i,n){let{route:s,pathname:a,params:l}=i;return{id:s.id,pathname:a,params:l,data:n[s.id],handle:s.handle}}function UJ(i,n,s,a){n===void 0&&(n=[]),s===void 0&&(s=[]),a===void 0&&(a="");let l=(d,f,E)=>{let S={relativePath:E===void 0?d.path||"":E,caseSensitive:d.caseSensitive===!0,childrenIndex:f,route:d};S.relativePath.startsWith("/")&&(ur(S.relativePath.startsWith(a),'Absolute route path "'+S.relativePath+'" nested under path '+('"'+a+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),S.relativePath=S.relativePath.slice(a.length));let T=gh([a,S.relativePath]),C=s.concat(S);d.children&&d.children.length>0&&(ur(d.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+T+'".')),UJ(d.children,n,C,T)),!(d.path==null&&!d.index)&&n.push({path:T,score:Dve(T,d.index),routesMeta:C})};return i.forEach((d,f)=>{var E;if(d.path===""||!((E=d.path)!=null&&E.includes("?")))l(d,f);else for(let S of VJ(d.path))l(d,f,S)}),n}function VJ(i){let n=i.split("/");if(n.length===0)return[];let[s,...a]=n,l=s.endsWith("?"),d=s.replace(/\?$/,"");if(a.length===0)return l?[d,""]:[d];let f=VJ(a.join("/")),E=[];return E.push(...f.map(S=>S===""?d:[d,S].join("/"))),l&&E.push(...f),E.map(S=>i.startsWith("/")&&S===""?"/":S)}function bve(i){i.sort((n,s)=>n.score!==s.score?s.score-n.score:xve(n.routesMeta.map(a=>a.childrenIndex),s.routesMeta.map(a=>a.childrenIndex)))}const Ive=/^:[\w-]+$/,Ave=3,Ove=2,Nve=1,Pve=10,kve=-2,zK=i=>i==="*";function Dve(i,n){let s=i.split("/"),a=s.length;return s.some(zK)&&(a+=kve),n&&(a+=Ove),s.filter(l=>!zK(l)).reduce((l,d)=>l+(Ive.test(d)?Ave:d===""?Nve:Pve),a)}function xve(i,n){return i.length===n.length&&i.slice(0,-1).every((a,l)=>a===n[l])?i[i.length-1]-n[n.length-1]:0}function Lve(i,n,s){s===void 0&&(s=!1);let{routesMeta:a}=i,l={},d="/",f=[];for(let E=0;E<a.length;++E){let S=a[E],T=E===a.length-1,C=d==="/"?n:n.slice(d.length)||"/",I=KK({path:S.relativePath,caseSensitive:S.caseSensitive,end:T},C),N=S.route;if(!I&&T&&s&&!a[a.length-1].route.index&&(I=KK({path:S.relativePath,caseSensitive:S.caseSensitive,end:!1},C)),!I)return null;Object.assign(l,I.params),f.push({params:l,pathname:gh([d,I.pathname]),pathnameBase:jve(gh([d,I.pathnameBase])),route:N}),I.pathnameBase!=="/"&&(d=gh([d,I.pathnameBase]))}return f}function KK(i,n){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[s,a]=Mve(i.path,i.caseSensitive,i.end),l=n.match(s);if(!l)return null;let d=l[0],f=d.replace(/(.)\/+$/,"$1"),E=l.slice(1);return{params:a.reduce((T,C,I)=>{let{paramName:N,isOptional:P}=C;if(N==="*"){let x=E[I]||"";f=d.slice(0,d.length-x.length).replace(/(.)\/+$/,"$1")}const W=E[I];return P&&!W?T[N]=void 0:T[N]=(W||"").replace(/%2F/g,"/"),T},{}),pathname:d,pathnameBase:f,pattern:i}}function Mve(i,n,s){n===void 0&&(n=!1),s===void 0&&(s=!0),xg(i==="*"||!i.endsWith("*")||i.endsWith("/*"),'Route path "'+i+'" will be treated as if it were '+('"'+i.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+i.replace(/\*$/,"/*")+'".'));let a=[],l="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(f,E,S)=>(a.push({paramName:E,isOptional:S!=null}),S?"/?([^\\/]+)?":"/([^\\/]+)"));return i.endsWith("*")?(a.push({paramName:"*"}),l+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?l+="\\/*$":i!==""&&i!=="/"&&(l+="(?:(?=\\/|$))"),[new RegExp(l,n?void 0:"i"),a]}function Uve(i){try{return i.split("/").map(n=>decodeURIComponent(n).replace(/\//g,"%2F")).join("/")}catch(n){return xg(!1,'The URL path "'+i+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+n+").")),i}}function hv(i,n){if(n==="/")return i;if(!i.toLowerCase().startsWith(n.toLowerCase()))return null;let s=n.endsWith("/")?n.length-1:n.length,a=i.charAt(s);return a&&a!=="/"?null:i.slice(s)||"/"}function Vve(i,n){n===void 0&&(n="/");let{pathname:s,search:a="",hash:l=""}=typeof i=="string"?Ah(i):i;return{pathname:s?s.startsWith("/")?s:Fve(s,n):n,search:Bve(a),hash:Wve(l)}}function Fve(i,n){let s=n.replace(/\/+$/,"").split("/");return i.split("/").forEach(l=>{l===".."?s.length>1&&s.pop():l!=="."&&s.push(l)}),s.length>1?s.join("/"):"/"}function Bx(i,n,s,a){return"Cannot include a '"+i+"' character in a manually specified "+("`to."+n+"` field ["+JSON.stringify(a)+"].  Please separate it out to the ")+("`to."+s+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function FJ(i){return i.filter((n,s)=>s===0||n.route.path&&n.route.path.length>0)}function FO(i,n){let s=FJ(i);return n?s.map((a,l)=>l===s.length-1?a.pathname:a.pathnameBase):s.map(a=>a.pathnameBase)}function jO(i,n,s,a){a===void 0&&(a=!1);let l;typeof i=="string"?l=Ah(i):(l=Ui({},i),ur(!l.pathname||!l.pathname.includes("?"),Bx("?","pathname","search",l)),ur(!l.pathname||!l.pathname.includes("#"),Bx("#","pathname","hash",l)),ur(!l.search||!l.search.includes("#"),Bx("#","search","hash",l)));let d=i===""||l.pathname==="",f=d?"/":l.pathname,E;if(f==null)E=s;else{let I=n.length-1;if(!a&&f.startsWith("..")){let N=f.split("/");for(;N[0]==="..";)N.shift(),I-=1;l.pathname=N.join("/")}E=I>=0?n[I]:"/"}let S=Vve(l,E),T=f&&f!=="/"&&f.endsWith("/"),C=(d||f===".")&&s.endsWith("/");return!S.pathname.endsWith("/")&&(T||C)&&(S.pathname+="/"),S}const gh=i=>i.join("/").replace(/\/\/+/g,"/"),jve=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),Bve=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,Wve=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i;class qA{constructor(n,s,a,l){l===void 0&&(l=!1),this.status=n,this.statusText=s||"",this.internal=l,a instanceof Error?(this.data=a.toString(),this.error=a):this.data=a}}function pw(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}const jJ=["post","put","patch","delete"],Gve=new Set(jJ),Hve=["get",...jJ],zve=new Set(Hve),Kve=new Set([301,302,303,307,308]),Yve=new Set([307,308]),Wx={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},qve={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},C0={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},j2=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Xve=i=>({hasErrorBoundary:!!i.hasErrorBoundary}),BJ="remix-router-transitions";function Jve(i){const n=i.window?i.window:typeof window<"u"?window:void 0,s=typeof n<"u"&&typeof n.document<"u"&&typeof n.document.createElement<"u",a=!s;ur(i.routes.length>0,"You must provide a non-empty routes array to createRouter");let l;if(i.mapRouteProperties)l=i.mapRouteProperties;else if(i.detectErrorBoundary){let Ee=i.detectErrorBoundary;l=Ae=>({hasErrorBoundary:Ee(Ae)})}else l=Xve;let d={},f=YA(i.routes,l,void 0,d),E,S=i.basename||"/",T=i.dataStrategy||eSe,C=i.patchRoutesOnNavigation,I=Ui({v7_fetcherPersist:!1,v7_normalizeFormMethod:!1,v7_partialHydration:!1,v7_prependBasename:!1,v7_relativeSplatPath:!1,v7_skipActionErrorRevalidation:!1},i.future),N=null,P=new Set,W=null,x=null,B=null,X=i.hydrationData!=null,Z=yg(f,i.history.location,S),$=!1,ae=null;if(Z==null&&!C){let Ee=Ia(404,{pathname:i.history.location.pathname}),{matches:Ae,route:We}=r9(f);Z=Ae,ae={[We.id]:Ee}}Z&&!i.hydrationData&&mr(Z,f,i.history.location.pathname).active&&(Z=null);let ce;if(Z)if(Z.some(Ee=>Ee.route.lazy))ce=!1;else if(!Z.some(Ee=>Ee.route.loader))ce=!0;else if(I.v7_partialHydration){let Ee=i.hydrationData?i.hydrationData.loaderData:null,Ae=i.hydrationData?i.hydrationData.errors:null;if(Ae){let We=Z.findIndex(st=>Ae[st.route.id]!==void 0);ce=Z.slice(0,We+1).every(st=>!aM(st.route,Ee,Ae))}else ce=Z.every(We=>!aM(We.route,Ee,Ae))}else ce=i.hydrationData!=null;else if(ce=!1,Z=[],I.v7_partialHydration){let Ee=mr(null,f,i.history.location.pathname);Ee.active&&Ee.matches&&($=!0,Z=Ee.matches)}let le,ne={historyAction:i.history.action,location:i.history.location,matches:Z,initialized:ce,navigation:Wx,restoreScrollPosition:i.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:i.hydrationData&&i.hydrationData.loaderData||{},actionData:i.hydrationData&&i.hydrationData.actionData||null,errors:i.hydrationData&&i.hydrationData.errors||ae,fetchers:new Map,blockers:new Map},fe=Ss.Pop,Se=!1,De,be=!1,ye=new Map,Ge=null,Te=!1,Fe=!1,Je=[],je=new Set,Ie=new Map,He=0,re=-1,ge=new Map,Oe=new Set,ue=new Map,it=new Map,yt=new Set,Dt=new Map,At=new Map,dn;function Cn(){if(N=i.history.listen(Ee=>{let{action:Ae,location:We,delta:st}=Ee;if(dn){dn(),dn=void 0;return}xg(At.size===0||st!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let St=ml({currentLocation:ne.location,nextLocation:We,historyAction:Ae});if(St&&st!=null){let Yt=new Promise(hn=>{dn=hn});i.history.go(st*-1),ia(St,{state:"blocked",location:We,proceed(){ia(St,{state:"proceeding",proceed:void 0,reset:void 0,location:We}),Yt.then(()=>i.history.go(st))},reset(){let hn=new Map(ne.blockers);hn.set(St,C0),Jr({blockers:hn})}});return}return yi(Ae,We)}),s){fSe(n,ye);let Ee=()=>mSe(n,ye);n.addEventListener("pagehide",Ee),Ge=()=>n.removeEventListener("pagehide",Ee)}return ne.initialized||yi(Ss.Pop,ne.location,{initialHydration:!0}),le}function fr(){N&&N(),Ge&&Ge(),P.clear(),De&&De.abort(),ne.fetchers.forEach((Ee,Ae)=>ii(Ae)),ne.blockers.forEach((Ee,Ae)=>vi(Ae))}function as(Ee){return P.add(Ee),()=>P.delete(Ee)}function Jr(Ee,Ae){Ae===void 0&&(Ae={}),ne=Ui({},ne,Ee);let We=[],st=[];I.v7_fetcherPersist&&ne.fetchers.forEach((St,Yt)=>{St.state==="idle"&&(yt.has(Yt)?st.push(Yt):We.push(Yt))}),yt.forEach(St=>{!ne.fetchers.has(St)&&!Ie.has(St)&&st.push(St)}),[...P].forEach(St=>St(ne,{deletedFetchers:st,viewTransitionOpts:Ae.viewTransitionOpts,flushSync:Ae.flushSync===!0})),I.v7_fetcherPersist?(We.forEach(St=>ne.fetchers.delete(St)),st.forEach(St=>ii(St))):st.forEach(St=>yt.delete(St))}function Mr(Ee,Ae,We){var st,St;let{flushSync:Yt}=We===void 0?{}:We,hn=ne.actionData!=null&&ne.navigation.formMethod!=null&&au(ne.navigation.formMethod)&&ne.navigation.state==="loading"&&((st=Ee.state)==null?void 0:st._isRedirect)!==!0,Ut;Ae.actionData?Object.keys(Ae.actionData).length>0?Ut=Ae.actionData:Ut=null:hn?Ut=ne.actionData:Ut=null;let Gt=Ae.loaderData?t9(ne.loaderData,Ae.loaderData,Ae.matches||[],Ae.errors):ne.loaderData,xt=ne.blockers;xt.size>0&&(xt=new Map(xt),xt.forEach((Yn,Qi)=>xt.set(Qi,C0)));let Vt=Se===!0||ne.navigation.formMethod!=null&&au(ne.navigation.formMethod)&&((St=Ee.state)==null?void 0:St._isRedirect)!==!0;E&&(f=E,E=void 0),Te||fe===Ss.Pop||(fe===Ss.Push?i.history.push(Ee,Ee.state):fe===Ss.Replace&&i.history.replace(Ee,Ee.state));let Rn;if(fe===Ss.Pop){let Yn=ye.get(ne.location.pathname);Yn&&Yn.has(Ee.pathname)?Rn={currentLocation:ne.location,nextLocation:Ee}:ye.has(Ee.pathname)&&(Rn={currentLocation:Ee,nextLocation:ne.location})}else if(be){let Yn=ye.get(ne.location.pathname);Yn?Yn.add(Ee.pathname):(Yn=new Set([Ee.pathname]),ye.set(ne.location.pathname,Yn)),Rn={currentLocation:ne.location,nextLocation:Ee}}Jr(Ui({},Ae,{actionData:Ut,loaderData:Gt,historyAction:fe,location:Ee,initialized:!0,navigation:Wx,revalidation:"idle",restoreScrollPosition:Wn(Ee,Ae.matches||ne.matches),preventScrollReset:Vt,blockers:xt}),{viewTransitionOpts:Rn,flushSync:Yt===!0}),fe=Ss.Pop,Se=!1,be=!1,Te=!1,Fe=!1,Je=[]}async function wc(Ee,Ae){if(typeof Ee=="number"){i.history.go(Ee);return}let We=oM(ne.location,ne.matches,S,I.v7_prependBasename,Ee,I.v7_relativeSplatPath,Ae?.fromRouteId,Ae?.relative),{path:st,submission:St,error:Yt}=YK(I.v7_normalizeFormMethod,!1,We,Ae),hn=ne.location,Ut=hw(ne.location,st,Ae&&Ae.state);Ut=Ui({},Ut,i.history.encodeLocation(Ut));let Gt=Ae&&Ae.replace!=null?Ae.replace:void 0,xt=Ss.Push;Gt===!0?xt=Ss.Replace:Gt===!1||St!=null&&au(St.formMethod)&&St.formAction===ne.location.pathname+ne.location.search&&(xt=Ss.Replace);let Vt=Ae&&"preventScrollReset"in Ae?Ae.preventScrollReset===!0:void 0,Rn=(Ae&&Ae.flushSync)===!0,Yn=ml({currentLocation:hn,nextLocation:Ut,historyAction:xt});if(Yn){ia(Yn,{state:"blocked",location:Ut,proceed(){ia(Yn,{state:"proceeding",proceed:void 0,reset:void 0,location:Ut}),wc(Ee,Ae)},reset(){let Qi=new Map(ne.blockers);Qi.set(Yn,C0),Jr({blockers:Qi})}});return}return await yi(xt,Ut,{submission:St,pendingError:Yt,preventScrollReset:Vt,replace:Ae&&Ae.replace,enableViewTransition:Ae&&Ae.viewTransition,flushSync:Rn})}function fl(){if(lt(),Jr({revalidation:"loading"}),ne.navigation.state!=="submitting"){if(ne.navigation.state==="idle"){yi(ne.historyAction,ne.location,{startUninterruptedRevalidation:!0});return}yi(fe||ne.historyAction,ne.navigation.location,{overrideNavigation:ne.navigation,enableViewTransition:be===!0})}}async function yi(Ee,Ae,We){De&&De.abort(),De=null,fe=Ee,Te=(We&&We.startUninterruptedRevalidation)===!0,mn(ne.location,ne.matches),Se=(We&&We.preventScrollReset)===!0,be=(We&&We.enableViewTransition)===!0;let st=E||f,St=We&&We.overrideNavigation,Yt=We!=null&&We.initialHydration&&ne.matches&&ne.matches.length>0&&!$?ne.matches:yg(st,Ae,S),hn=(We&&We.flushSync)===!0;if(Yt&&ne.initialized&&!Fe&&oSe(ne.location,Ae)&&!(We&&We.submission&&au(We.submission.formMethod))){Mr(Ae,{matches:Yt},{flushSync:hn});return}let Ut=mr(Yt,st,Ae.pathname);if(Ut.active&&Ut.matches&&(Yt=Ut.matches),!Yt){let{error:Sr,notFoundMatches:ir,route:Ar}=sa(Ae.pathname);Mr(Ae,{matches:ir,loaderData:{},errors:{[Ar.id]:Sr}},{flushSync:hn});return}De=new AbortController;let Gt=fy(i.history,Ae,De.signal,We&&We.submission),xt;if(We&&We.pendingError)xt=[vg(Yt).route.id,{type:Xr.error,error:We.pendingError}];else if(We&&We.submission&&au(We.submission.formMethod)){let Sr=await Cc(Gt,Ae,We.submission,Yt,Ut.active,{replace:We.replace,flushSync:hn});if(Sr.shortCircuited)return;if(Sr.pendingActionResult){let[ir,Ar]=Sr.pendingActionResult;if(cc(Ar)&&pw(Ar.error)&&Ar.error.status===404){De=null,Mr(Ae,{matches:Sr.matches,loaderData:{},errors:{[ir]:Ar.error}});return}}Yt=Sr.matches||Yt,xt=Sr.pendingActionResult,St=Gx(Ae,We.submission),hn=!1,Ut.active=!1,Gt=fy(i.history,Gt.url,Gt.signal)}let{shortCircuited:Vt,matches:Rn,loaderData:Yn,errors:Qi}=await Wr(Gt,Ae,Yt,Ut.active,St,We&&We.submission,We&&We.fetcherSubmission,We&&We.replace,We&&We.initialHydration===!0,hn,xt);Vt||(De=null,Mr(Ae,Ui({matches:Rn||Yt},n9(xt),{loaderData:Yn,errors:Qi})))}async function Cc(Ee,Ae,We,st,St,Yt){Yt===void 0&&(Yt={}),lt();let hn=hSe(Ae,We);if(Jr({navigation:hn},{flushSync:Yt.flushSync===!0}),St){let xt=await $i(st,Ae.pathname,Ee.signal);if(xt.type==="aborted")return{shortCircuited:!0};if(xt.type==="error"){let Vt=vg(xt.partialMatches).route.id;return{matches:xt.partialMatches,pendingActionResult:[Vt,{type:Xr.error,error:xt.error}]}}else if(xt.matches)st=xt.matches;else{let{notFoundMatches:Vt,error:Rn,route:Yn}=sa(Ae.pathname);return{matches:Vt,pendingActionResult:[Yn.id,{type:Xr.error,error:Rn}]}}}let Ut,Gt=x0(st,Ae);if(!Gt.route.action&&!Gt.route.lazy)Ut={type:Xr.error,error:Ia(405,{method:Ee.method,pathname:Ae.pathname,routeId:Gt.route.id})};else if(Ut=(await Fo("action",ne,Ee,[Gt],st,null))[Gt.route.id],Ee.signal.aborted)return{shortCircuited:!0};if(Sg(Ut)){let xt;return Yt&&Yt.replace!=null?xt=Yt.replace:xt=QK(Ut.response.headers.get("Location"),new URL(Ee.url),S)===ne.location.pathname+ne.location.search,await Ir(Ee,Ut,!0,{submission:We,replace:xt}),{shortCircuited:!0}}if($p(Ut))throw Ia(400,{type:"defer-action"});if(cc(Ut)){let xt=vg(st,Gt.route.id);return(Yt&&Yt.replace)!==!0&&(fe=Ss.Push),{matches:st,pendingActionResult:[xt.route.id,Ut]}}return{matches:st,pendingActionResult:[Gt.route.id,Ut]}}async function Wr(Ee,Ae,We,st,St,Yt,hn,Ut,Gt,xt,Vt){let Rn=St||Gx(Ae,Yt),Yn=Yt||hn||s9(Rn),Qi=!Te&&(!I.v7_partialHydration||!Gt);if(st){if(Qi){let Dr=fi(Vt);Jr(Ui({navigation:Rn},Dr!==void 0?{actionData:Dr}:{}),{flushSync:xt})}let sr=await $i(We,Ae.pathname,Ee.signal);if(sr.type==="aborted")return{shortCircuited:!0};if(sr.type==="error"){let Dr=vg(sr.partialMatches).route.id;return{matches:sr.partialMatches,loaderData:{},errors:{[Dr]:sr.error}}}else if(sr.matches)We=sr.matches;else{let{error:Dr,notFoundMatches:bs,route:mu}=sa(Ae.pathname);return{matches:bs,loaderData:{},errors:{[mu.id]:Dr}}}}let Sr=E||f,[ir,Ar]=XK(i.history,ne,We,Yn,Ae,I.v7_partialHydration&&Gt===!0,I.v7_skipActionErrorRevalidation,Fe,Je,je,yt,ue,Oe,Sr,S,Vt);if(vo(sr=>!(We&&We.some(Dr=>Dr.route.id===sr))||ir&&ir.some(Dr=>Dr.route.id===sr)),re=++He,ir.length===0&&Ar.length===0){let sr=Eo();return Mr(Ae,Ui({matches:We,loaderData:{},errors:Vt&&cc(Vt[1])?{[Vt[0]]:Vt[1].error}:null},n9(Vt),sr?{fetchers:new Map(ne.fetchers)}:{}),{flushSync:xt}),{shortCircuited:!0}}if(Qi){let sr={};if(!st){sr.navigation=Rn;let Dr=fi(Vt);Dr!==void 0&&(sr.actionData=Dr)}Ar.length>0&&(sr.fetchers=$s(Ar)),Jr(sr,{flushSync:xt})}Ar.forEach(sr=>{$r(sr.key),sr.controller&&Ie.set(sr.key,sr.controller)});let gl=()=>Ar.forEach(sr=>$r(sr.key));De&&De.signal.addEventListener("abort",gl);let{loaderResults:Pd,fetcherResults:Zi}=await Xe(ne,We,ir,Ar,Ee);if(Ee.signal.aborted)return{shortCircuited:!0};De&&De.signal.removeEventListener("abort",gl),Ar.forEach(sr=>Ie.delete(sr.key));let gr=rA(Pd);if(gr)return await Ir(Ee,gr.result,!0,{replace:Ut}),{shortCircuited:!0};if(gr=rA(Zi),gr)return Oe.add(gr.key),await Ir(Ee,gr.result,!0,{replace:Ut}),{shortCircuited:!0};let{loaderData:If,errors:Ur}=e9(ne,We,Pd,Vt,Ar,Zi,Dt);Dt.forEach((sr,Dr)=>{sr.subscribe(bs=>{(bs||sr.done)&&Dt.delete(Dr)})}),I.v7_partialHydration&&Gt&&ne.errors&&(Ur=Ui({},ne.errors,Ur));let bc=Eo(),_l=Gr(re),Oh=bc||_l||Ar.length>0;return Ui({matches:We,loaderData:If,errors:Ur},Oh?{fetchers:new Map(ne.fetchers)}:{})}function fi(Ee){if(Ee&&!cc(Ee[1]))return{[Ee[0]]:Ee[1].data};if(ne.actionData)return Object.keys(ne.actionData).length===0?null:ne.actionData}function $s(Ee){return Ee.forEach(Ae=>{let We=ne.fetchers.get(Ae.key),st=R0(void 0,We?We.data:void 0);ne.fetchers.set(Ae.key,st)}),new Map(ne.fetchers)}function gs(Ee,Ae,We,st){if(a)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");$r(Ee);let St=(st&&st.flushSync)===!0,Yt=E||f,hn=oM(ne.location,ne.matches,S,I.v7_prependBasename,We,I.v7_relativeSplatPath,Ae,st?.relative),Ut=yg(Yt,hn,S),Gt=mr(Ut,Yt,hn);if(Gt.active&&Gt.matches&&(Ut=Gt.matches),!Ut){an(Ee,Ae,Ia(404,{pathname:hn}),{flushSync:St});return}let{path:xt,submission:Vt,error:Rn}=YK(I.v7_normalizeFormMethod,!0,hn,st);if(Rn){an(Ee,Ae,Rn,{flushSync:St});return}let Yn=x0(Ut,xt),Qi=(st&&st.preventScrollReset)===!0;if(Vt&&au(Vt.formMethod)){Rc(Ee,Ae,xt,Yn,Ut,Gt.active,St,Qi,Vt);return}ue.set(Ee,{routeId:Ae,path:xt}),Qs(Ee,Ae,xt,Yn,Ut,Gt.active,St,Qi,Vt)}async function Rc(Ee,Ae,We,st,St,Yt,hn,Ut,Gt){lt(),ue.delete(Ee);function xt(_r){if(!_r.route.action&&!_r.route.lazy){let gu=Ia(405,{method:Gt.formMethod,pathname:We,routeId:Ae});return an(Ee,Ae,gu,{flushSync:hn}),!0}return!1}if(!Yt&&xt(st))return;let Vt=ne.fetchers.get(Ee);Kt(Ee,pSe(Gt,Vt),{flushSync:hn});let Rn=new AbortController,Yn=fy(i.history,We,Rn.signal,Gt);if(Yt){let _r=await $i(St,new URL(Yn.url).pathname,Yn.signal,Ee);if(_r.type==="aborted")return;if(_r.type==="error"){an(Ee,Ae,_r.error,{flushSync:hn});return}else if(_r.matches){if(St=_r.matches,st=x0(St,We),xt(st))return}else{an(Ee,Ae,Ia(404,{pathname:We}),{flushSync:hn});return}}Ie.set(Ee,Rn);let Qi=He,ir=(await Fo("action",ne,Yn,[st],St,Ee))[st.route.id];if(Yn.signal.aborted){Ie.get(Ee)===Rn&&Ie.delete(Ee);return}if(I.v7_fetcherPersist&&yt.has(Ee)){if(Sg(ir)||cc(ir)){Kt(Ee,Gp(void 0));return}}else{if(Sg(ir))if(Ie.delete(Ee),re>Qi){Kt(Ee,Gp(void 0));return}else return Oe.add(Ee),Kt(Ee,R0(Gt)),Ir(Yn,ir,!1,{fetcherSubmission:Gt,preventScrollReset:Ut});if(cc(ir)){an(Ee,Ae,ir.error);return}}if($p(ir))throw Ia(400,{type:"defer-action"});let Ar=ne.navigation.location||ne.location,gl=fy(i.history,Ar,Rn.signal),Pd=E||f,Zi=ne.navigation.state!=="idle"?yg(Pd,ne.navigation.location,S):ne.matches;ur(Zi,"Didn't find any matches after fetcher action");let gr=++He;ge.set(Ee,gr);let If=R0(Gt,ir.data);ne.fetchers.set(Ee,If);let[Ur,bc]=XK(i.history,ne,Zi,Gt,Ar,!1,I.v7_skipActionErrorRevalidation,Fe,Je,je,yt,ue,Oe,Pd,S,[st.route.id,ir]);bc.filter(_r=>_r.key!==Ee).forEach(_r=>{let gu=_r.key,$g=ne.fetchers.get(gu),_u=R0(void 0,$g?$g.data:void 0);ne.fetchers.set(gu,_u),$r(gu),_r.controller&&Ie.set(gu,_r.controller)}),Jr({fetchers:new Map(ne.fetchers)});let _l=()=>bc.forEach(_r=>$r(_r.key));Rn.signal.addEventListener("abort",_l);let{loaderResults:Oh,fetcherResults:sr}=await Xe(ne,Zi,Ur,bc,gl);if(Rn.signal.aborted)return;Rn.signal.removeEventListener("abort",_l),ge.delete(Ee),Ie.delete(Ee),bc.forEach(_r=>Ie.delete(_r.key));let Dr=rA(Oh);if(Dr)return Ir(gl,Dr.result,!1,{preventScrollReset:Ut});if(Dr=rA(sr),Dr)return Oe.add(Dr.key),Ir(gl,Dr.result,!1,{preventScrollReset:Ut});let{loaderData:bs,errors:mu}=e9(ne,Zi,Oh,void 0,bc,sr,Dt);if(ne.fetchers.has(Ee)){let _r=Gp(ir.data);ne.fetchers.set(Ee,_r)}Gr(gr),ne.navigation.state==="loading"&&gr>re?(ur(fe,"Expected pending action"),De&&De.abort(),Mr(ne.navigation.location,{matches:Zi,loaderData:bs,errors:mu,fetchers:new Map(ne.fetchers)})):(Jr({errors:mu,loaderData:t9(ne.loaderData,bs,Zi,mu),fetchers:new Map(ne.fetchers)}),Fe=!1)}async function Qs(Ee,Ae,We,st,St,Yt,hn,Ut,Gt){let xt=ne.fetchers.get(Ee);Kt(Ee,R0(Gt,xt?xt.data:void 0),{flushSync:hn});let Vt=new AbortController,Rn=fy(i.history,We,Vt.signal);if(Yt){let ir=await $i(St,new URL(Rn.url).pathname,Rn.signal,Ee);if(ir.type==="aborted")return;if(ir.type==="error"){an(Ee,Ae,ir.error,{flushSync:hn});return}else if(ir.matches)St=ir.matches,st=x0(St,We);else{an(Ee,Ae,Ia(404,{pathname:We}),{flushSync:hn});return}}Ie.set(Ee,Vt);let Yn=He,Sr=(await Fo("loader",ne,Rn,[st],St,Ee))[st.route.id];if($p(Sr)&&(Sr=await B2(Sr,Rn.signal,!0)||Sr),Ie.get(Ee)===Vt&&Ie.delete(Ee),!Rn.signal.aborted){if(yt.has(Ee)){Kt(Ee,Gp(void 0));return}if(Sg(Sr))if(re>Yn){Kt(Ee,Gp(void 0));return}else{Oe.add(Ee),await Ir(Rn,Sr,!1,{preventScrollReset:Ut});return}if(cc(Sr)){an(Ee,Ae,Sr.error);return}ur(!$p(Sr),"Unhandled fetcher deferred data"),Kt(Ee,Gp(Sr.data))}}async function Ir(Ee,Ae,We,st){let{submission:St,fetcherSubmission:Yt,preventScrollReset:hn,replace:Ut}=st===void 0?{}:st;Ae.response.headers.has("X-Remix-Revalidate")&&(Fe=!0);let Gt=Ae.response.headers.get("Location");ur(Gt,"Expected a Location header on the redirect Response"),Gt=QK(Gt,new URL(Ee.url),S);let xt=hw(ne.location,Gt,{_isRedirect:!0});if(s){let ir=!1;if(Ae.response.headers.has("X-Remix-Reload-Document"))ir=!0;else if(j2.test(Gt)){const Ar=i.history.createURL(Gt);ir=Ar.origin!==n.location.origin||hv(Ar.pathname,S)==null}if(ir){Ut?n.location.replace(Gt):n.location.assign(Gt);return}}De=null;let Vt=Ut===!0||Ae.response.headers.has("X-Remix-Replace")?Ss.Replace:Ss.Push,{formMethod:Rn,formAction:Yn,formEncType:Qi}=ne.navigation;!St&&!Yt&&Rn&&Yn&&Qi&&(St=s9(ne.navigation));let Sr=St||Yt;if(Yve.has(Ae.response.status)&&Sr&&au(Sr.formMethod))await yi(Vt,xt,{submission:Ui({},Sr,{formAction:Gt}),preventScrollReset:hn||Se,enableViewTransition:We?be:void 0});else{let ir=Gx(xt,St);await yi(Vt,xt,{overrideNavigation:ir,fetcherSubmission:Yt,preventScrollReset:hn||Se,enableViewTransition:We?be:void 0})}}async function Fo(Ee,Ae,We,st,St,Yt){let hn,Ut={};try{hn=await tSe(T,Ee,Ae,We,st,St,Yt,d,l)}catch(Gt){return st.forEach(xt=>{Ut[xt.route.id]={type:Xr.error,error:Gt}}),Ut}for(let[Gt,xt]of Object.entries(hn))if(aSe(xt)){let Vt=xt.result;Ut[Gt]={type:Xr.redirect,response:iSe(Vt,We,Gt,St,S,I.v7_relativeSplatPath)}}else Ut[Gt]=await rSe(xt);return Ut}async function Xe(Ee,Ae,We,st,St){let Yt=Ee.matches,hn=Fo("loader",Ee,St,We,Ae,null),Ut=Promise.all(st.map(async Vt=>{if(Vt.matches&&Vt.match&&Vt.controller){let Yn=(await Fo("loader",Ee,fy(i.history,Vt.path,Vt.controller.signal),[Vt.match],Vt.matches,Vt.key))[Vt.match.route.id];return{[Vt.key]:Yn}}else return Promise.resolve({[Vt.key]:{type:Xr.error,error:Ia(404,{pathname:Vt.path})}})})),Gt=await hn,xt=(await Ut).reduce((Vt,Rn)=>Object.assign(Vt,Rn),{});return await Promise.all([uSe(Ae,Gt,St.signal,Yt,Ee.loaderData),dSe(Ae,xt,st)]),{loaderResults:Gt,fetcherResults:xt}}function lt(){Fe=!0,Je.push(...vo()),ue.forEach((Ee,Ae)=>{Ie.has(Ae)&&je.add(Ae),$r(Ae)})}function Kt(Ee,Ae,We){We===void 0&&(We={}),ne.fetchers.set(Ee,Ae),Jr({fetchers:new Map(ne.fetchers)},{flushSync:(We&&We.flushSync)===!0})}function an(Ee,Ae,We,st){st===void 0&&(st={});let St=vg(ne.matches,Ae);ii(Ee),Jr({errors:{[St.route.id]:We},fetchers:new Map(ne.fetchers)},{flushSync:(st&&st.flushSync)===!0})}function Nn(Ee){return it.set(Ee,(it.get(Ee)||0)+1),yt.has(Ee)&&yt.delete(Ee),ne.fetchers.get(Ee)||qve}function ii(Ee){let Ae=ne.fetchers.get(Ee);Ie.has(Ee)&&!(Ae&&Ae.state==="loading"&&ge.has(Ee))&&$r(Ee),ue.delete(Ee),ge.delete(Ee),Oe.delete(Ee),I.v7_fetcherPersist&&yt.delete(Ee),je.delete(Ee),ne.fetchers.delete(Ee)}function Zs(Ee){let Ae=(it.get(Ee)||0)-1;Ae<=0?(it.delete(Ee),yt.add(Ee),I.v7_fetcherPersist||ii(Ee)):it.set(Ee,Ae),Jr({fetchers:new Map(ne.fetchers)})}function $r(Ee){let Ae=Ie.get(Ee);Ae&&(Ae.abort(),Ie.delete(Ee))}function mi(Ee){for(let Ae of Ee){let We=Nn(Ae),st=Gp(We.data);ne.fetchers.set(Ae,st)}}function Eo(){let Ee=[],Ae=!1;for(let We of Oe){let st=ne.fetchers.get(We);ur(st,"Expected fetcher: "+We),st.state==="loading"&&(Oe.delete(We),Ee.push(We),Ae=!0)}return mi(Ee),Ae}function Gr(Ee){let Ae=[];for(let[We,st]of ge)if(st<Ee){let St=ne.fetchers.get(We);ur(St,"Expected fetcher: "+We),St.state==="loading"&&($r(We),ge.delete(We),Ae.push(We))}return mi(Ae),Ae.length>0}function yo(Ee,Ae){let We=ne.blockers.get(Ee)||C0;return At.get(Ee)!==Ae&&At.set(Ee,Ae),We}function vi(Ee){ne.blockers.delete(Ee),At.delete(Ee)}function ia(Ee,Ae){let We=ne.blockers.get(Ee)||C0;ur(We.state==="unblocked"&&Ae.state==="blocked"||We.state==="blocked"&&Ae.state==="blocked"||We.state==="blocked"&&Ae.state==="proceeding"||We.state==="blocked"&&Ae.state==="unblocked"||We.state==="proceeding"&&Ae.state==="unblocked","Invalid blocker state transition: "+We.state+" -> "+Ae.state);let st=new Map(ne.blockers);st.set(Ee,Ae),Jr({blockers:st})}function ml(Ee){let{currentLocation:Ae,nextLocation:We,historyAction:st}=Ee;if(At.size===0)return;At.size>1&&xg(!1,"A router only supports one blocker at a time");let St=Array.from(At.entries()),[Yt,hn]=St[St.length-1],Ut=ne.blockers.get(Yt);if(!(Ut&&Ut.state==="proceeding")&&hn({currentLocation:Ae,nextLocation:We,historyAction:st}))return Yt}function sa(Ee){let Ae=Ia(404,{pathname:Ee}),We=E||f,{matches:st,route:St}=r9(We);return vo(),{notFoundMatches:st,route:St,error:Ae}}function vo(Ee){let Ae=[];return Dt.forEach((We,st)=>{(!Ee||Ee(st))&&(We.cancel(),Ae.push(st),Dt.delete(st))}),Ae}function jo(Ee,Ae,We){if(W=Ee,B=Ae,x=We||null,!X&&ne.navigation===Wx){X=!0;let st=Wn(ne.location,ne.matches);st!=null&&Jr({restoreScrollPosition:st})}return()=>{W=null,B=null,x=null}}function ja(Ee,Ae){return x&&x(Ee,Ae.map(st=>Rve(st,ne.loaderData)))||Ee.key}function mn(Ee,Ae){if(W&&B){let We=ja(Ee,Ae);W[We]=B()}}function Wn(Ee,Ae){if(W){let We=ja(Ee,Ae),st=W[We];if(typeof st=="number")return st}return null}function mr(Ee,Ae,We){if(C)if(Ee){if(Object.keys(Ee[0].params).length>0)return{active:!0,matches:SA(Ae,We,S,!0)}}else return{active:!0,matches:SA(Ae,We,S,!0)||[]};return{active:!1,matches:null}}async function $i(Ee,Ae,We,st){if(!C)return{type:"success",matches:Ee};let St=Ee;for(;;){let Yt=E==null,hn=E||f,Ut=d;try{await C({signal:We,path:Ae,matches:St,fetcherKey:st,patch:(Vt,Rn)=>{We.aborted||$K(Vt,Rn,hn,Ut,l)}})}catch(Vt){return{type:"error",error:Vt,partialMatches:St}}finally{Yt&&!We.aborted&&(f=[...f])}if(We.aborted)return{type:"aborted"};let Gt=yg(hn,Ae,S);if(Gt)return{type:"success",matches:Gt};let xt=SA(hn,Ae,S,!0);if(!xt||St.length===xt.length&&St.every((Vt,Rn)=>Vt.route.id===xt[Rn].route.id))return{type:"success",matches:null};St=xt}}function Ls(Ee){d={},E=YA(Ee,l,void 0,d)}function kr(Ee,Ae){let We=E==null;$K(Ee,Ae,E||f,d,l),We&&(f=[...f],Jr({}))}return le={get basename(){return S},get future(){return I},get state(){return ne},get routes(){return f},get window(){return n},initialize:Cn,subscribe:as,enableScrollRestoration:jo,navigate:wc,fetch:gs,revalidate:fl,createHref:Ee=>i.history.createHref(Ee),encodeLocation:Ee=>i.history.encodeLocation(Ee),getFetcher:Nn,deleteFetcher:Zs,dispose:fr,getBlocker:yo,deleteBlocker:vi,patchRoutes:kr,_internalFetchControllers:Ie,_internalActiveDeferreds:Dt,_internalSetRoutes:Ls},le}function $ve(i){return i!=null&&("formData"in i&&i.formData!=null||"body"in i&&i.body!==void 0)}function oM(i,n,s,a,l,d,f,E){let S,T;if(f){S=[];for(let I of n)if(S.push(I),I.route.id===f){T=I;break}}else S=n,T=n[n.length-1];let C=jO(l||".",FO(S,d),hv(i.pathname,s)||i.pathname,E==="path");if(l==null&&(C.search=i.search,C.hash=i.hash),(l==null||l===""||l===".")&&T){let I=W2(C.search);if(T.route.index&&!I)C.search=C.search?C.search.replace(/^\?/,"?index&"):"?index";else if(!T.route.index&&I){let N=new URLSearchParams(C.search),P=N.getAll("index");N.delete("index"),P.filter(x=>x).forEach(x=>N.append("index",x));let W=N.toString();C.search=W?"?"+W:""}}return a&&s!=="/"&&(C.pathname=C.pathname==="/"?s:gh([s,C.pathname])),Lg(C)}function YK(i,n,s,a){if(!a||!$ve(a))return{path:s};if(a.formMethod&&!lSe(a.formMethod))return{path:s,error:Ia(405,{method:a.formMethod})};let l=()=>({path:s,error:Ia(400,{type:"invalid-body"})}),d=a.formMethod||"get",f=i?d.toUpperCase():d.toLowerCase(),E=HJ(s);if(a.body!==void 0){if(a.formEncType==="text/plain"){if(!au(f))return l();let N=typeof a.body=="string"?a.body:a.body instanceof FormData||a.body instanceof URLSearchParams?Array.from(a.body.entries()).reduce((P,W)=>{let[x,B]=W;return""+P+x+"="+B+`
`},""):String(a.body);return{path:s,submission:{formMethod:f,formAction:E,formEncType:a.formEncType,formData:void 0,json:void 0,text:N}}}else if(a.formEncType==="application/json"){if(!au(f))return l();try{let N=typeof a.body=="string"?JSON.parse(a.body):a.body;return{path:s,submission:{formMethod:f,formAction:E,formEncType:a.formEncType,formData:void 0,json:N,text:void 0}}}catch{return l()}}}ur(typeof FormData=="function","FormData is not available in this environment");let S,T;if(a.formData)S=cM(a.formData),T=a.formData;else if(a.body instanceof FormData)S=cM(a.body),T=a.body;else if(a.body instanceof URLSearchParams)S=a.body,T=ZK(S);else if(a.body==null)S=new URLSearchParams,T=new FormData;else try{S=new URLSearchParams(a.body),T=ZK(S)}catch{return l()}let C={formMethod:f,formAction:E,formEncType:a&&a.formEncType||"application/x-www-form-urlencoded",formData:T,json:void 0,text:void 0};if(au(C.formMethod))return{path:s,submission:C};let I=Ah(s);return n&&I.search&&W2(I.search)&&S.append("index",""),I.search="?"+S,{path:Lg(I),submission:C}}function qK(i,n,s){s===void 0&&(s=!1);let a=i.findIndex(l=>l.route.id===n);return a>=0?i.slice(0,s?a+1:a):i}function XK(i,n,s,a,l,d,f,E,S,T,C,I,N,P,W,x){let B=x?cc(x[1])?x[1].error:x[1].data:void 0,X=i.createURL(n.location),Z=i.createURL(l),$=s;d&&n.errors?$=qK(s,Object.keys(n.errors)[0],!0):x&&cc(x[1])&&($=qK(s,x[0]));let ae=x?x[1].statusCode:void 0,ce=f&&ae&&ae>=400,le=$.filter((fe,Se)=>{let{route:De}=fe;if(De.lazy)return!0;if(De.loader==null)return!1;if(d)return aM(De,n.loaderData,n.errors);if(Qve(n.loaderData,n.matches[Se],fe)||S.some(Ge=>Ge===fe.route.id))return!0;let be=n.matches[Se],ye=fe;return JK(fe,Ui({currentUrl:X,currentParams:be.params,nextUrl:Z,nextParams:ye.params},a,{actionResult:B,actionStatus:ae,defaultShouldRevalidate:ce?!1:E||X.pathname+X.search===Z.pathname+Z.search||X.search!==Z.search||WJ(be,ye)}))}),ne=[];return I.forEach((fe,Se)=>{if(d||!s.some(Te=>Te.route.id===fe.routeId)||C.has(Se))return;let De=yg(P,fe.path,W);if(!De){ne.push({key:Se,routeId:fe.routeId,path:fe.path,matches:null,match:null,controller:null});return}let be=n.fetchers.get(Se),ye=x0(De,fe.path),Ge=!1;N.has(Se)?Ge=!1:T.has(Se)?(T.delete(Se),Ge=!0):be&&be.state!=="idle"&&be.data===void 0?Ge=E:Ge=JK(ye,Ui({currentUrl:X,currentParams:n.matches[n.matches.length-1].params,nextUrl:Z,nextParams:s[s.length-1].params},a,{actionResult:B,actionStatus:ae,defaultShouldRevalidate:ce?!1:E})),Ge&&ne.push({key:Se,routeId:fe.routeId,path:fe.path,matches:De,match:ye,controller:new AbortController})}),[le,ne]}function aM(i,n,s){if(i.lazy)return!0;if(!i.loader)return!1;let a=n!=null&&n[i.id]!==void 0,l=s!=null&&s[i.id]!==void 0;return!a&&l?!1:typeof i.loader=="function"&&i.loader.hydrate===!0?!0:!a&&!l}function Qve(i,n,s){let a=!n||s.route.id!==n.route.id,l=i[s.route.id]===void 0;return a||l}function WJ(i,n){let s=i.route.path;return i.pathname!==n.pathname||s!=null&&s.endsWith("*")&&i.params["*"]!==n.params["*"]}function JK(i,n){if(i.route.shouldRevalidate){let s=i.route.shouldRevalidate(n);if(typeof s=="boolean")return s}return n.defaultShouldRevalidate}function $K(i,n,s,a,l){var d;let f;if(i){let T=a[i];ur(T,"No route found to patch children into: routeId = "+i),T.children||(T.children=[]),f=T.children}else f=s;let E=n.filter(T=>!f.some(C=>GJ(T,C))),S=YA(E,l,[i||"_","patch",String(((d=f)==null?void 0:d.length)||"0")],a);f.push(...S)}function GJ(i,n){return"id"in i&&"id"in n&&i.id===n.id?!0:i.index===n.index&&i.path===n.path&&i.caseSensitive===n.caseSensitive?(!i.children||i.children.length===0)&&(!n.children||n.children.length===0)?!0:i.children.every((s,a)=>{var l;return(l=n.children)==null?void 0:l.some(d=>GJ(s,d))}):!1}async function Zve(i,n,s){if(!i.lazy)return;let a=await i.lazy();if(!i.lazy)return;let l=s[i.id];ur(l,"No route found in manifest");let d={};for(let f in a){let S=l[f]!==void 0&&f!=="hasErrorBoundary";xg(!S,'Route "'+l.id+'" has a static property "'+f+'" defined but its lazy function is also returning a value for this property. '+('The lazy route property "'+f+'" will be ignored.')),!S&&!wve.has(f)&&(d[f]=a[f])}Object.assign(l,d),Object.assign(l,Ui({},n(l),{lazy:void 0}))}async function eSe(i){let{matches:n}=i,s=n.filter(l=>l.shouldLoad);return(await Promise.all(s.map(l=>l.resolve()))).reduce((l,d,f)=>Object.assign(l,{[s[f].route.id]:d}),{})}async function tSe(i,n,s,a,l,d,f,E,S,T){let C=d.map(P=>P.route.lazy?Zve(P.route,S,E):void 0),I=d.map((P,W)=>{let x=C[W],B=l.some(Z=>Z.route.id===P.route.id);return Ui({},P,{shouldLoad:B,resolve:async Z=>(Z&&a.method==="GET"&&(P.route.lazy||P.route.loader)&&(B=!0),B?nSe(n,a,P,x,Z,T):Promise.resolve({type:Xr.data,result:void 0}))})}),N=await i({matches:I,request:a,params:d[0].params,fetcherKey:f,context:T});try{await Promise.all(C)}catch{}return N}async function nSe(i,n,s,a,l,d){let f,E,S=T=>{let C,I=new Promise((W,x)=>C=x);E=()=>C(),n.signal.addEventListener("abort",E);let N=W=>typeof T!="function"?Promise.reject(new Error("You cannot call the handler for a route which defines a boolean "+('"'+i+'" [routeId: '+s.route.id+"]"))):T({request:n,params:s.params,context:d},...W!==void 0?[W]:[]),P=(async()=>{try{return{type:"data",result:await(l?l(x=>N(x)):N())}}catch(W){return{type:"error",result:W}}})();return Promise.race([P,I])};try{let T=s.route[i];if(a)if(T){let C,[I]=await Promise.all([S(T).catch(N=>{C=N}),a]);if(C!==void 0)throw C;f=I}else if(await a,T=s.route[i],T)f=await S(T);else if(i==="action"){let C=new URL(n.url),I=C.pathname+C.search;throw Ia(405,{method:n.method,pathname:I,routeId:s.route.id})}else return{type:Xr.data,result:void 0};else if(T)f=await S(T);else{let C=new URL(n.url),I=C.pathname+C.search;throw Ia(404,{pathname:I})}ur(f.result!==void 0,"You defined "+(i==="action"?"an action":"a loader")+" for route "+('"'+s.route.id+"\" but didn't return anything from your `"+i+"` ")+"function. Please return a value or `null`.")}catch(T){return{type:Xr.error,result:T}}finally{E&&n.signal.removeEventListener("abort",E)}return f}async function rSe(i){let{result:n,type:s}=i;if(zJ(n)){let I;try{let N=n.headers.get("Content-Type");N&&/\bapplication\/json\b/.test(N)?n.body==null?I=null:I=await n.json():I=await n.text()}catch(N){return{type:Xr.error,error:N}}return s===Xr.error?{type:Xr.error,error:new qA(n.status,n.statusText,I),statusCode:n.status,headers:n.headers}:{type:Xr.data,data:I,statusCode:n.status,headers:n.headers}}if(s===Xr.error){if(i9(n)){var a,l;if(n.data instanceof Error){var d,f;return{type:Xr.error,error:n.data,statusCode:(d=n.init)==null?void 0:d.status,headers:(f=n.init)!=null&&f.headers?new Headers(n.init.headers):void 0}}return{type:Xr.error,error:new qA(((a=n.init)==null?void 0:a.status)||500,void 0,n.data),statusCode:pw(n)?n.status:void 0,headers:(l=n.init)!=null&&l.headers?new Headers(n.init.headers):void 0}}return{type:Xr.error,error:n,statusCode:pw(n)?n.status:void 0}}if(cSe(n)){var E,S;return{type:Xr.deferred,deferredData:n,statusCode:(E=n.init)==null?void 0:E.status,headers:((S=n.init)==null?void 0:S.headers)&&new Headers(n.init.headers)}}if(i9(n)){var T,C;return{type:Xr.data,data:n.data,statusCode:(T=n.init)==null?void 0:T.status,headers:(C=n.init)!=null&&C.headers?new Headers(n.init.headers):void 0}}return{type:Xr.data,data:n}}function iSe(i,n,s,a,l,d){let f=i.headers.get("Location");if(ur(f,"Redirects returned/thrown from loaders/actions must have a Location header"),!j2.test(f)){let E=a.slice(0,a.findIndex(S=>S.route.id===s)+1);f=oM(new URL(n.url),E,l,!0,f,d),i.headers.set("Location",f)}return i}function QK(i,n,s){if(j2.test(i)){let a=i,l=a.startsWith("//")?new URL(n.protocol+a):new URL(a),d=hv(l.pathname,s)!=null;if(l.origin===n.origin&&d)return l.pathname+l.search+l.hash}return i}function fy(i,n,s,a){let l=i.createURL(HJ(n)).toString(),d={signal:s};if(a&&au(a.formMethod)){let{formMethod:f,formEncType:E}=a;d.method=f.toUpperCase(),E==="application/json"?(d.headers=new Headers({"Content-Type":E}),d.body=JSON.stringify(a.json)):E==="text/plain"?d.body=a.text:E==="application/x-www-form-urlencoded"&&a.formData?d.body=cM(a.formData):d.body=a.formData}return new Request(l,d)}function cM(i){let n=new URLSearchParams;for(let[s,a]of i.entries())n.append(s,typeof a=="string"?a:a.name);return n}function ZK(i){let n=new FormData;for(let[s,a]of i.entries())n.append(s,a);return n}function sSe(i,n,s,a,l){let d={},f=null,E,S=!1,T={},C=s&&cc(s[1])?s[1].error:void 0;return i.forEach(I=>{if(!(I.route.id in n))return;let N=I.route.id,P=n[N];if(ur(!Sg(P),"Cannot handle redirect results in processLoaderData"),cc(P)){let W=P.error;C!==void 0&&(W=C,C=void 0),f=f||{};{let x=vg(i,N);f[x.route.id]==null&&(f[x.route.id]=W)}d[N]=void 0,S||(S=!0,E=pw(P.error)?P.error.status:500),P.headers&&(T[N]=P.headers)}else $p(P)?(a.set(N,P.deferredData),d[N]=P.deferredData.data,P.statusCode!=null&&P.statusCode!==200&&!S&&(E=P.statusCode),P.headers&&(T[N]=P.headers)):(d[N]=P.data,P.statusCode&&P.statusCode!==200&&!S&&(E=P.statusCode),P.headers&&(T[N]=P.headers))}),C!==void 0&&s&&(f={[s[0]]:C},d[s[0]]=void 0),{loaderData:d,errors:f,statusCode:E||200,loaderHeaders:T}}function e9(i,n,s,a,l,d,f){let{loaderData:E,errors:S}=sSe(n,s,a,f);return l.forEach(T=>{let{key:C,match:I,controller:N}=T,P=d[C];if(ur(P,"Did not find corresponding fetcher result"),!(N&&N.signal.aborted))if(cc(P)){let W=vg(i.matches,I?.route.id);S&&S[W.route.id]||(S=Ui({},S,{[W.route.id]:P.error})),i.fetchers.delete(C)}else if(Sg(P))ur(!1,"Unhandled fetcher revalidation redirect");else if($p(P))ur(!1,"Unhandled fetcher deferred data");else{let W=Gp(P.data);i.fetchers.set(C,W)}}),{loaderData:E,errors:S}}function t9(i,n,s,a){let l=Ui({},n);for(let d of s){let f=d.route.id;if(n.hasOwnProperty(f)?n[f]!==void 0&&(l[f]=n[f]):i[f]!==void 0&&d.route.loader&&(l[f]=i[f]),a&&a.hasOwnProperty(f))break}return l}function n9(i){return i?cc(i[1])?{actionData:{}}:{actionData:{[i[0]]:i[1].data}}:{}}function vg(i,n){return(n?i.slice(0,i.findIndex(a=>a.route.id===n)+1):[...i]).reverse().find(a=>a.route.hasErrorBoundary===!0)||i[0]}function r9(i){let n=i.length===1?i[0]:i.find(s=>s.index||!s.path||s.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:n}],route:n}}function Ia(i,n){let{pathname:s,routeId:a,method:l,type:d,message:f}=n===void 0?{}:n,E="Unknown Server Error",S="Unknown @remix-run/router error";return i===400?(E="Bad Request",l&&s&&a?S="You made a "+l+' request to "'+s+'" but '+('did not provide a `loader` for route "'+a+'", ')+"so there is no way to handle the request.":d==="defer-action"?S="defer() is not supported in actions":d==="invalid-body"&&(S="Unable to encode submission body")):i===403?(E="Forbidden",S='Route "'+a+'" does not match URL "'+s+'"'):i===404?(E="Not Found",S='No route matches URL "'+s+'"'):i===405&&(E="Method Not Allowed",l&&s&&a?S="You made a "+l.toUpperCase()+' request to "'+s+'" but '+('did not provide an `action` for route "'+a+'", ')+"so there is no way to handle the request.":l&&(S='Invalid request method "'+l.toUpperCase()+'"')),new qA(i||500,E,new Error(S),!0)}function rA(i){let n=Object.entries(i);for(let s=n.length-1;s>=0;s--){let[a,l]=n[s];if(Sg(l))return{key:a,result:l}}}function HJ(i){let n=typeof i=="string"?Ah(i):i;return Lg(Ui({},n,{hash:""}))}function oSe(i,n){return i.pathname!==n.pathname||i.search!==n.search?!1:i.hash===""?n.hash!=="":i.hash===n.hash?!0:n.hash!==""}function aSe(i){return zJ(i.result)&&Kve.has(i.result.status)}function $p(i){return i.type===Xr.deferred}function cc(i){return i.type===Xr.error}function Sg(i){return(i&&i.type)===Xr.redirect}function i9(i){return typeof i=="object"&&i!=null&&"type"in i&&"data"in i&&"init"in i&&i.type==="DataWithResponseInit"}function cSe(i){let n=i;return n&&typeof n=="object"&&typeof n.data=="object"&&typeof n.subscribe=="function"&&typeof n.cancel=="function"&&typeof n.resolveData=="function"}function zJ(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.headers=="object"&&typeof i.body<"u"}function lSe(i){return zve.has(i.toLowerCase())}function au(i){return Gve.has(i.toLowerCase())}async function uSe(i,n,s,a,l){let d=Object.entries(n);for(let f=0;f<d.length;f++){let[E,S]=d[f],T=i.find(N=>N?.route.id===E);if(!T)continue;let C=a.find(N=>N.route.id===T.route.id),I=C!=null&&!WJ(C,T)&&(l&&l[T.route.id])!==void 0;$p(S)&&I&&await B2(S,s,!1).then(N=>{N&&(n[E]=N)})}}async function dSe(i,n,s){for(let a=0;a<s.length;a++){let{key:l,routeId:d,controller:f}=s[a],E=n[l];i.find(T=>T?.route.id===d)&&$p(E)&&(ur(f,"Expected an AbortController for revalidating fetcher deferred result"),await B2(E,f.signal,!0).then(T=>{T&&(n[l]=T)}))}}async function B2(i,n,s){if(s===void 0&&(s=!1),!await i.deferredData.resolveData(n)){if(s)try{return{type:Xr.data,data:i.deferredData.unwrappedData}}catch(l){return{type:Xr.error,error:l}}return{type:Xr.data,data:i.deferredData.data}}}function W2(i){return new URLSearchParams(i).getAll("index").some(n=>n==="")}function x0(i,n){let s=typeof n=="string"?Ah(n).search:n.search;if(i[i.length-1].route.index&&W2(s||""))return i[i.length-1];let a=FJ(i);return a[a.length-1]}function s9(i){let{formMethod:n,formAction:s,formEncType:a,text:l,formData:d,json:f}=i;if(!(!n||!s||!a)){if(l!=null)return{formMethod:n,formAction:s,formEncType:a,formData:void 0,json:void 0,text:l};if(d!=null)return{formMethod:n,formAction:s,formEncType:a,formData:d,json:void 0,text:void 0};if(f!==void 0)return{formMethod:n,formAction:s,formEncType:a,formData:void 0,json:f,text:void 0}}}function Gx(i,n){return n?{state:"loading",location:i,formMethod:n.formMethod,formAction:n.formAction,formEncType:n.formEncType,formData:n.formData,json:n.json,text:n.text}:{state:"loading",location:i,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function hSe(i,n){return{state:"submitting",location:i,formMethod:n.formMethod,formAction:n.formAction,formEncType:n.formEncType,formData:n.formData,json:n.json,text:n.text}}function R0(i,n){return i?{state:"loading",formMethod:i.formMethod,formAction:i.formAction,formEncType:i.formEncType,formData:i.formData,json:i.json,text:i.text,data:n}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:n}}function pSe(i,n){return{state:"submitting",formMethod:i.formMethod,formAction:i.formAction,formEncType:i.formEncType,formData:i.formData,json:i.json,text:i.text,data:n?n.data:void 0}}function Gp(i){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:i}}function fSe(i,n){try{let s=i.sessionStorage.getItem(BJ);if(s){let a=JSON.parse(s);for(let[l,d]of Object.entries(a||{}))d&&Array.isArray(d)&&n.set(l,new Set(d||[]))}}catch{}}function mSe(i,n){if(n.size>0){let s={};for(let[a,l]of n)s[a]=[...l];try{i.sessionStorage.setItem(BJ,JSON.stringify(s))}catch(a){xg(!1,"Failed to save applied view transitions in sessionStorage ("+a+").")}}}function XA(){return XA=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var s=arguments[n];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(i[a]=s[a])}return i},XA.apply(this,arguments)}const BO=H.createContext(null),KJ=H.createContext(null),yf=H.createContext(null),G2=H.createContext(null),vf=H.createContext({outlet:null,matches:[],isDataRoute:!1}),YJ=H.createContext(null);function gSe(i,n){let{relative:s}=n===void 0?{}:n;pv()||ur(!1);let{basename:a,navigator:l}=H.useContext(yf),{hash:d,pathname:f,search:E}=XJ(i,{relative:s}),S=f;return a!=="/"&&(S=f==="/"?a:gh([a,f])),l.createHref({pathname:S,search:E,hash:d})}function pv(){return H.useContext(G2)!=null}function Sf(){return pv()||ur(!1),H.useContext(G2).location}function qJ(i){H.useContext(yf).static||H.useLayoutEffect(i)}function H2(){let{isDataRoute:i}=H.useContext(vf);return i?ASe():_Se()}function _Se(){pv()||ur(!1);let i=H.useContext(BO),{basename:n,future:s,navigator:a}=H.useContext(yf),{matches:l}=H.useContext(vf),{pathname:d}=Sf(),f=JSON.stringify(FO(l,s.v7_relativeSplatPath)),E=H.useRef(!1);return qJ(()=>{E.current=!0}),H.useCallback(function(T,C){if(C===void 0&&(C={}),!E.current)return;if(typeof T=="number"){a.go(T);return}let I=jO(T,JSON.parse(f),d,C.relative==="path");i==null&&n!=="/"&&(I.pathname=I.pathname==="/"?n:gh([n,I.pathname])),(C.replace?a.replace:a.push)(I,C.state,C)},[n,a,f,d,i])}function XJ(i,n){let{relative:s}=n===void 0?{}:n,{future:a}=H.useContext(yf),{matches:l}=H.useContext(vf),{pathname:d}=Sf(),f=JSON.stringify(FO(l,a.v7_relativeSplatPath));return H.useMemo(()=>jO(i,JSON.parse(f),d,s==="path"),[i,f,d,s])}function ESe(i,n,s,a){pv()||ur(!1);let{navigator:l}=H.useContext(yf),{matches:d}=H.useContext(vf),f=d[d.length-1],E=f?f.params:{};f&&f.pathname;let S=f?f.pathnameBase:"/";f&&f.route;let T=Sf(),C;C=T;let I=C.pathname||"/",N=I;if(S!=="/"){let x=S.replace(/^\//,"").split("/");N="/"+I.replace(/^\//,"").split("/").slice(x.length).join("/")}let P=yg(i,{pathname:N});return wSe(P&&P.map(x=>Object.assign({},x,{params:Object.assign({},E,x.params),pathname:gh([S,l.encodeLocation?l.encodeLocation(x.pathname).pathname:x.pathname]),pathnameBase:x.pathnameBase==="/"?S:gh([S,l.encodeLocation?l.encodeLocation(x.pathnameBase).pathname:x.pathnameBase])})),d,s,a)}function ySe(){let i=ISe(),n=pw(i)?i.status+" "+i.statusText:i instanceof Error?i.message:JSON.stringify(i),s=i instanceof Error?i.stack:null,l={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return H.createElement(H.Fragment,null,H.createElement("h2",null,"Unexpected Application Error!"),H.createElement("h3",{style:{fontStyle:"italic"}},n),s?H.createElement("pre",{style:l},s):null,null)}const vSe=H.createElement(ySe,null);class SSe extends H.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,s){return s.location!==n.location||s.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:s.error,location:s.location,revalidation:n.revalidation||s.revalidation}}componentDidCatch(n,s){console.error("React Router caught the following error during render",n,s)}render(){return this.state.error!==void 0?H.createElement(vf.Provider,{value:this.props.routeContext},H.createElement(YJ.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function TSe(i){let{routeContext:n,match:s,children:a}=i,l=H.useContext(BO);return l&&l.static&&l.staticContext&&(s.route.errorElement||s.route.ErrorBoundary)&&(l.staticContext._deepestRenderedBoundaryId=s.route.id),H.createElement(vf.Provider,{value:n},a)}function wSe(i,n,s,a){var l;if(n===void 0&&(n=[]),s===void 0&&(s=null),a===void 0&&(a=null),i==null){var d;if(!s)return null;if(s.errors)i=s.matches;else if((d=a)!=null&&d.v7_partialHydration&&n.length===0&&!s.initialized&&s.matches.length>0)i=s.matches;else return null}let f=i,E=(l=s)==null?void 0:l.errors;if(E!=null){let C=f.findIndex(I=>I.route.id&&E?.[I.route.id]!==void 0);C>=0||ur(!1),f=f.slice(0,Math.min(f.length,C+1))}let S=!1,T=-1;if(s&&a&&a.v7_partialHydration)for(let C=0;C<f.length;C++){let I=f[C];if((I.route.HydrateFallback||I.route.hydrateFallbackElement)&&(T=C),I.route.id){let{loaderData:N,errors:P}=s,W=I.route.loader&&N[I.route.id]===void 0&&(!P||P[I.route.id]===void 0);if(I.route.lazy||W){S=!0,T>=0?f=f.slice(0,T+1):f=[f[0]];break}}}return f.reduceRight((C,I,N)=>{let P,W=!1,x=null,B=null;s&&(P=E&&I.route.id?E[I.route.id]:void 0,x=I.route.errorElement||vSe,S&&(T<0&&N===0?(OSe("route-fallback"),W=!0,B=null):T===N&&(W=!0,B=I.route.hydrateFallbackElement||null)));let X=n.concat(f.slice(0,N+1)),Z=()=>{let $;return P?$=x:W?$=B:I.route.Component?$=H.createElement(I.route.Component,null):I.route.element?$=I.route.element:$=C,H.createElement(TSe,{match:I,routeContext:{outlet:C,matches:X,isDataRoute:s!=null},children:$})};return s&&(I.route.ErrorBoundary||I.route.errorElement||N===0)?H.createElement(SSe,{location:s.location,revalidation:s.revalidation,component:x,error:P,children:Z(),routeContext:{outlet:null,matches:X,isDataRoute:!0}}):Z()},null)}var JJ=(function(i){return i.UseBlocker="useBlocker",i.UseRevalidator="useRevalidator",i.UseNavigateStable="useNavigate",i})(JJ||{}),$J=(function(i){return i.UseBlocker="useBlocker",i.UseLoaderData="useLoaderData",i.UseActionData="useActionData",i.UseRouteError="useRouteError",i.UseNavigation="useNavigation",i.UseRouteLoaderData="useRouteLoaderData",i.UseMatches="useMatches",i.UseRevalidator="useRevalidator",i.UseNavigateStable="useNavigate",i.UseRouteId="useRouteId",i})($J||{});function CSe(i){let n=H.useContext(BO);return n||ur(!1),n}function RSe(i){let n=H.useContext(KJ);return n||ur(!1),n}function bSe(i){let n=H.useContext(vf);return n||ur(!1),n}function QJ(i){let n=bSe(),s=n.matches[n.matches.length-1];return s.route.id||ur(!1),s.route.id}function ISe(){var i;let n=H.useContext(YJ),s=RSe(),a=QJ();return n!==void 0?n:(i=s.errors)==null?void 0:i[a]}function ASe(){let{router:i}=CSe(JJ.UseNavigateStable),n=QJ($J.UseNavigateStable),s=H.useRef(!1);return qJ(()=>{s.current=!0}),H.useCallback(function(l,d){d===void 0&&(d={}),s.current&&(typeof l=="number"?i.navigate(l):i.navigate(l,XA({fromRouteId:n},d)))},[i,n])}const o9={};function OSe(i,n,s){o9[i]||(o9[i]=!0)}function NSe(i,n){i?.v7_startTransition,i?.v7_relativeSplatPath===void 0&&(!n||n.v7_relativeSplatPath),n&&(n.v7_fetcherPersist,n.v7_normalizeFormMethod,n.v7_partialHydration,n.v7_skipActionErrorRevalidation)}function PSe(i){let{to:n,replace:s,state:a,relative:l}=i;pv()||ur(!1);let{future:d,static:f}=H.useContext(yf),{matches:E}=H.useContext(vf),{pathname:S}=Sf(),T=H2(),C=jO(n,FO(E,d.v7_relativeSplatPath),S,l==="path"),I=JSON.stringify(C);return H.useEffect(()=>T(JSON.parse(I),{replace:s,state:a,relative:l}),[T,I,l,s,a]),null}function kSe(i){let{basename:n="/",children:s=null,location:a,navigationType:l=Ss.Pop,navigator:d,static:f=!1,future:E}=i;pv()&&ur(!1);let S=n.replace(/^\/*/,"/"),T=H.useMemo(()=>({basename:S,navigator:d,static:f,future:XA({v7_relativeSplatPath:!1},E)}),[S,E,d,f]);typeof a=="string"&&(a=Ah(a));let{pathname:C="/",search:I="",hash:N="",state:P=null,key:W="default"}=a,x=H.useMemo(()=>{let B=hv(C,S);return B==null?null:{location:{pathname:B,search:I,hash:N,state:P,key:W},navigationType:l}},[S,C,I,N,P,W,l]);return x==null?null:H.createElement(yf.Provider,{value:T},H.createElement(G2.Provider,{children:s,value:x}))}new Promise(()=>{});function DSe(i){let n={hasErrorBoundary:i.ErrorBoundary!=null||i.errorElement!=null};return i.Component&&Object.assign(n,{element:H.createElement(i.Component),Component:void 0}),i.HydrateFallback&&Object.assign(n,{hydrateFallbackElement:H.createElement(i.HydrateFallback),HydrateFallback:void 0}),i.ErrorBoundary&&Object.assign(n,{errorElement:H.createElement(i.ErrorBoundary),ErrorBoundary:void 0}),n}function fw(){return fw=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var s=arguments[n];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(i[a]=s[a])}return i},fw.apply(this,arguments)}function xSe(i,n){if(i==null)return{};var s={},a=Object.keys(i),l,d;for(d=0;d<a.length;d++)l=a[d],!(n.indexOf(l)>=0)&&(s[l]=i[l]);return s}function LSe(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function MSe(i,n){return i.button===0&&(!n||n==="_self")&&!LSe(i)}const USe=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],VSe="6";try{window.__reactRouterVersion=VSe}catch{}function FSe(i,n){return Jve({basename:n?.basename,future:fw({},n?.future,{v7_prependBasename:!0}),history:vve({window:n?.window}),hydrationData:n?.hydrationData||jSe(),routes:i,mapRouteProperties:DSe,dataStrategy:n?.dataStrategy,patchRoutesOnNavigation:n?.patchRoutesOnNavigation,window:n?.window}).initialize()}function jSe(){var i;let n=(i=window)==null?void 0:i.__staticRouterHydrationData;return n&&n.errors&&(n=fw({},n,{errors:BSe(n.errors)})),n}function BSe(i){if(!i)return null;let n=Object.entries(i),s={};for(let[a,l]of n)if(l&&l.__type==="RouteErrorResponse")s[a]=new qA(l.status,l.statusText,l.data,l.internal===!0);else if(l&&l.__type==="Error"){if(l.__subType){let d=window[l.__subType];if(typeof d=="function")try{let f=new d(l.message);f.stack="",s[a]=f}catch{}}if(s[a]==null){let d=new Error(l.message);d.stack="",s[a]=d}}else s[a]=l;return s}const WSe=H.createContext({isTransitioning:!1}),GSe=H.createContext(new Map),HSe="startTransition",a9=S2[HSe],zSe="flushSync",c9=Kme[zSe];function KSe(i){a9?a9(i):i()}function b0(i){c9?c9(i):i()}let YSe=class{constructor(){this.status="pending",this.promise=new Promise((n,s)=>{this.resolve=a=>{this.status==="pending"&&(this.status="resolved",n(a))},this.reject=a=>{this.status==="pending"&&(this.status="rejected",s(a))}})}};function qSe(i){let{fallbackElement:n,router:s,future:a}=i,[l,d]=H.useState(s.state),[f,E]=H.useState(),[S,T]=H.useState({isTransitioning:!1}),[C,I]=H.useState(),[N,P]=H.useState(),[W,x]=H.useState(),B=H.useRef(new Map),{v7_startTransition:X}=a||{},Z=H.useCallback(fe=>{X?KSe(fe):fe()},[X]),$=H.useCallback((fe,Se)=>{let{deletedFetchers:De,flushSync:be,viewTransitionOpts:ye}=Se;fe.fetchers.forEach((Te,Fe)=>{Te.data!==void 0&&B.current.set(Fe,Te.data)}),De.forEach(Te=>B.current.delete(Te));let Ge=s.window==null||s.window.document==null||typeof s.window.document.startViewTransition!="function";if(!ye||Ge){be?b0(()=>d(fe)):Z(()=>d(fe));return}if(be){b0(()=>{N&&(C&&C.resolve(),N.skipTransition()),T({isTransitioning:!0,flushSync:!0,currentLocation:ye.currentLocation,nextLocation:ye.nextLocation})});let Te=s.window.document.startViewTransition(()=>{b0(()=>d(fe))});Te.finished.finally(()=>{b0(()=>{I(void 0),P(void 0),E(void 0),T({isTransitioning:!1})})}),b0(()=>P(Te));return}N?(C&&C.resolve(),N.skipTransition(),x({state:fe,currentLocation:ye.currentLocation,nextLocation:ye.nextLocation})):(E(fe),T({isTransitioning:!0,flushSync:!1,currentLocation:ye.currentLocation,nextLocation:ye.nextLocation}))},[s.window,N,C,B,Z]);H.useLayoutEffect(()=>s.subscribe($),[s,$]),H.useEffect(()=>{S.isTransitioning&&!S.flushSync&&I(new YSe)},[S]),H.useEffect(()=>{if(C&&f&&s.window){let fe=f,Se=C.promise,De=s.window.document.startViewTransition(async()=>{Z(()=>d(fe)),await Se});De.finished.finally(()=>{I(void 0),P(void 0),E(void 0),T({isTransitioning:!1})}),P(De)}},[Z,f,C,s.window]),H.useEffect(()=>{C&&f&&l.location.key===f.location.key&&C.resolve()},[C,N,l.location,f]),H.useEffect(()=>{!S.isTransitioning&&W&&(E(W.state),T({isTransitioning:!0,flushSync:!1,currentLocation:W.currentLocation,nextLocation:W.nextLocation}),x(void 0))},[S.isTransitioning,W]),H.useEffect(()=>{},[]);let ae=H.useMemo(()=>({createHref:s.createHref,encodeLocation:s.encodeLocation,go:fe=>s.navigate(fe),push:(fe,Se,De)=>s.navigate(fe,{state:Se,preventScrollReset:De?.preventScrollReset}),replace:(fe,Se,De)=>s.navigate(fe,{replace:!0,state:Se,preventScrollReset:De?.preventScrollReset})}),[s]),ce=s.basename||"/",le=H.useMemo(()=>({router:s,navigator:ae,static:!1,basename:ce}),[s,ae,ce]),ne=H.useMemo(()=>({v7_relativeSplatPath:s.future.v7_relativeSplatPath}),[s.future.v7_relativeSplatPath]);return H.useEffect(()=>NSe(a,s.future),[a,s.future]),H.createElement(H.Fragment,null,H.createElement(BO.Provider,{value:le},H.createElement(KJ.Provider,{value:l},H.createElement(GSe.Provider,{value:B.current},H.createElement(WSe.Provider,{value:S},H.createElement(kSe,{basename:ce,location:l.location,navigationType:l.historyAction,navigator:ae,future:ne},l.initialized||s.future.v7_partialHydration?H.createElement(XSe,{routes:s.routes,future:s.future,state:l}):n))))),null)}const XSe=H.memo(JSe);function JSe(i){let{routes:n,future:s,state:a}=i;return ESe(n,void 0,a,s)}const $Se=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",QSe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,mw=H.forwardRef(function(n,s){let{onClick:a,relative:l,reloadDocument:d,replace:f,state:E,target:S,to:T,preventScrollReset:C,viewTransition:I}=n,N=xSe(n,USe),{basename:P}=H.useContext(yf),W,x=!1;if(typeof T=="string"&&QSe.test(T)&&(W=T,$Se))try{let $=new URL(window.location.href),ae=T.startsWith("//")?new URL($.protocol+T):new URL(T),ce=hv(ae.pathname,P);ae.origin===$.origin&&ce!=null?T=ce+ae.search+ae.hash:x=!0}catch{}let B=gSe(T,{relative:l}),X=ZSe(T,{replace:f,state:E,target:S,preventScrollReset:C,relative:l,viewTransition:I});function Z($){a&&a($),$.defaultPrevented||X($)}return H.createElement("a",fw({},N,{href:W||B,onClick:x||d?a:Z,ref:s,target:S}))});var l9;(function(i){i.UseScrollRestoration="useScrollRestoration",i.UseSubmit="useSubmit",i.UseSubmitFetcher="useSubmitFetcher",i.UseFetcher="useFetcher",i.useViewTransitionState="useViewTransitionState"})(l9||(l9={}));var u9;(function(i){i.UseFetcher="useFetcher",i.UseFetchers="useFetchers",i.UseScrollRestoration="useScrollRestoration"})(u9||(u9={}));function ZSe(i,n){let{target:s,replace:a,state:l,preventScrollReset:d,relative:f,viewTransition:E}=n===void 0?{}:n,S=H2(),T=Sf(),C=XJ(i,{relative:f});return H.useCallback(I=>{if(MSe(I,s)){I.preventDefault();let N=a!==void 0?a:Lg(T)===Lg(C);S(i,{replace:N,state:l,preventScrollReset:d,relative:f,viewTransition:E})}},[T,S,C,a,l,s,i,d,f,E])}const eTe=()=>{};var d9={};const ZJ=function(i){const n=[];let s=0;for(let a=0;a<i.length;a++){let l=i.charCodeAt(a);l<128?n[s++]=l:l<2048?(n[s++]=l>>6|192,n[s++]=l&63|128):(l&64512)===55296&&a+1<i.length&&(i.charCodeAt(a+1)&64512)===56320?(l=65536+((l&1023)<<10)+(i.charCodeAt(++a)&1023),n[s++]=l>>18|240,n[s++]=l>>12&63|128,n[s++]=l>>6&63|128,n[s++]=l&63|128):(n[s++]=l>>12|224,n[s++]=l>>6&63|128,n[s++]=l&63|128)}return n},tTe=function(i){const n=[];let s=0,a=0;for(;s<i.length;){const l=i[s++];if(l<128)n[a++]=String.fromCharCode(l);else if(l>191&&l<224){const d=i[s++];n[a++]=String.fromCharCode((l&31)<<6|d&63)}else if(l>239&&l<365){const d=i[s++],f=i[s++],E=i[s++],S=((l&7)<<18|(d&63)<<12|(f&63)<<6|E&63)-65536;n[a++]=String.fromCharCode(55296+(S>>10)),n[a++]=String.fromCharCode(56320+(S&1023))}else{const d=i[s++],f=i[s++];n[a++]=String.fromCharCode((l&15)<<12|(d&63)<<6|f&63)}}return n.join("")},e$={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(i,n){if(!Array.isArray(i))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=n?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let l=0;l<i.length;l+=3){const d=i[l],f=l+1<i.length,E=f?i[l+1]:0,S=l+2<i.length,T=S?i[l+2]:0,C=d>>2,I=(d&3)<<4|E>>4;let N=(E&15)<<2|T>>6,P=T&63;S||(P=64,f||(N=64)),a.push(s[C],s[I],s[N],s[P])}return a.join("")},encodeString(i,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(i):this.encodeByteArray(ZJ(i),n)},decodeString(i,n){return this.HAS_NATIVE_SUPPORT&&!n?atob(i):tTe(this.decodeStringToByteArray(i,n))},decodeStringToByteArray(i,n){this.init_();const s=n?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let l=0;l<i.length;){const d=s[i.charAt(l++)],E=l<i.length?s[i.charAt(l)]:0;++l;const T=l<i.length?s[i.charAt(l)]:64;++l;const I=l<i.length?s[i.charAt(l)]:64;if(++l,d==null||E==null||T==null||I==null)throw new nTe;const N=d<<2|E>>4;if(a.push(N),T!==64){const P=E<<4&240|T>>2;if(a.push(P),I!==64){const W=T<<6&192|I;a.push(W)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let i=0;i<this.ENCODED_VALS.length;i++)this.byteToCharMap_[i]=this.ENCODED_VALS.charAt(i),this.charToByteMap_[this.byteToCharMap_[i]]=i,this.byteToCharMapWebSafe_[i]=this.ENCODED_VALS_WEBSAFE.charAt(i),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]]=i,i>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)]=i,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)]=i)}}};class nTe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const rTe=function(i){const n=ZJ(i);return e$.encodeByteArray(n,!0)},t$=function(i){return rTe(i).replace(/\./g,"")},n$=function(i){try{return e$.decodeString(i,!0)}catch(n){console.error("base64Decode failed: ",n)}return null};function iTe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const sTe=()=>iTe().__FIREBASE_DEFAULTS__,oTe=()=>{if(typeof process>"u"||typeof d9>"u")return;const i=d9.__FIREBASE_DEFAULTS__;if(i)return JSON.parse(i)},aTe=()=>{if(typeof document>"u")return;let i;try{i=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const n=i&&n$(i[1]);return n&&JSON.parse(n)},z2=()=>{try{return eTe()||sTe()||oTe()||aTe()}catch(i){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${i}`);return}},cTe=i=>z2()?.emulatorHosts?.[i],r$=()=>z2()?.config,i$=i=>z2()?.[`_${i}`];class lTe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((n,s)=>{this.resolve=n,this.reject=s})}wrapCallback(n){return(s,a)=>{s?this.reject(s):this.resolve(a),typeof n=="function"&&(this.promise.catch(()=>{}),n.length===1?n(s):n(s,a))}}}function WO(i){try{return(i.startsWith("http://")||i.startsWith("https://")?new URL(i).hostname:i).endsWith(".cloudworkstations.dev")}catch{return!1}}async function uTe(i){return(await fetch(i,{credentials:"include"})).ok}const z0={};function dTe(){const i={prod:[],emulator:[]};for(const n of Object.keys(z0))z0[n]?i.emulator.push(n):i.prod.push(n);return i}function hTe(i){let n=document.getElementById(i),s=!1;return n||(n=document.createElement("div"),n.setAttribute("id",i),s=!0),{created:s,element:n}}let h9=!1;function pTe(i,n){if(typeof window>"u"||typeof document>"u"||!WO(window.location.host)||z0[i]===n||z0[i]||h9)return;z0[i]=n;function s(N){return`__firebase__banner__${N}`}const a="__firebase__banner",d=dTe().prod.length>0;function f(){const N=document.getElementById(a);N&&N.remove()}function E(N){N.style.display="flex",N.style.background="#7faaf0",N.style.position="fixed",N.style.bottom="5px",N.style.left="5px",N.style.padding=".5em",N.style.borderRadius="5px",N.style.alignItems="center"}function S(N,P){N.setAttribute("width","24"),N.setAttribute("id",P),N.setAttribute("height","24"),N.setAttribute("viewBox","0 0 24 24"),N.setAttribute("fill","none"),N.style.marginLeft="-6px"}function T(){const N=document.createElement("span");return N.style.cursor="pointer",N.style.marginLeft="16px",N.style.fontSize="24px",N.innerHTML=" &times;",N.onclick=()=>{h9=!0,f()},N}function C(N,P){N.setAttribute("id",P),N.innerText="Learn more",N.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",N.setAttribute("target","__blank"),N.style.paddingLeft="5px",N.style.textDecoration="underline"}function I(){const N=hTe(a),P=s("text"),W=document.getElementById(P)||document.createElement("span"),x=s("learnmore"),B=document.getElementById(x)||document.createElement("a"),X=s("preprendIcon"),Z=document.getElementById(X)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(N.created){const $=N.element;E($),C(B,x);const ae=T();S(Z,X),$.append(Z,W,B,ae),document.body.appendChild($)}d?(W.innerText="Preview backend disconnected.",Z.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(Z.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,W.innerText="Preview backend running in this workspace."),W.setAttribute("id",P)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",I):I()}function ra(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function fTe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ra())}function mTe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function s$(){const i=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof i=="object"&&i.id!==void 0}function gTe(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function _Te(){const i=ra();return i.indexOf("MSIE ")>=0||i.indexOf("Trident/")>=0}function o$(){try{return typeof indexedDB=="object"}catch{return!1}}function a$(){return new Promise((i,n)=>{try{let s=!0;const a="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(a);l.onsuccess=()=>{l.result.close(),s||self.indexedDB.deleteDatabase(a),i(!0)},l.onupgradeneeded=()=>{s=!1},l.onerror=()=>{n(l.error?.message||"")}}catch(s){n(s)}})}function ETe(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}const yTe="FirebaseError";class Nd extends Error{constructor(n,s,a){super(s),this.code=n,this.customData=a,this.name=yTe,Object.setPrototypeOf(this,Nd.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Hg.prototype.create)}}class Hg{constructor(n,s,a){this.service=n,this.serviceName=s,this.errors=a}create(n,...s){const a=s[0]||{},l=`${this.service}/${n}`,d=this.errors[n],f=d?vTe(d,a):"Error",E=`${this.serviceName}: ${f} (${l}).`;return new Nd(l,E,a)}}function vTe(i,n){return i.replace(STe,(s,a)=>{const l=n[a];return l!=null?String(l):`<${a}?>`})}const STe=/\{\$([^}]+)}/g;function TTe(i){for(const n in i)if(Object.prototype.hasOwnProperty.call(i,n))return!1;return!0}function Mg(i,n){if(i===n)return!0;const s=Object.keys(i),a=Object.keys(n);for(const l of s){if(!a.includes(l))return!1;const d=i[l],f=n[l];if(p9(d)&&p9(f)){if(!Mg(d,f))return!1}else if(d!==f)return!1}for(const l of a)if(!s.includes(l))return!1;return!0}function p9(i){return i!==null&&typeof i=="object"}function fv(i){const n=[];for(const[s,a]of Object.entries(i))Array.isArray(a)?a.forEach(l=>{n.push(encodeURIComponent(s)+"="+encodeURIComponent(l))}):n.push(encodeURIComponent(s)+"="+encodeURIComponent(a));return n.length?"&"+n.join("&"):""}function L0(i){const n={};return i.replace(/^\?/,"").split("&").forEach(a=>{if(a){const[l,d]=a.split("=");n[decodeURIComponent(l)]=decodeURIComponent(d)}}),n}function M0(i){const n=i.indexOf("?");if(!n)return"";const s=i.indexOf("#",n);return i.substring(n,s>0?s:void 0)}function wTe(i,n){const s=new CTe(i,n);return s.subscribe.bind(s)}class CTe{constructor(n,s){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=s,this.task.then(()=>{n(this)}).catch(a=>{this.error(a)})}next(n){this.forEachObserver(s=>{s.next(n)})}error(n){this.forEachObserver(s=>{s.error(n)}),this.close(n)}complete(){this.forEachObserver(n=>{n.complete()}),this.close()}subscribe(n,s,a){let l;if(n===void 0&&s===void 0&&a===void 0)throw new Error("Missing Observer.");RTe(n,["next","error","complete"])?l=n:l={next:n,error:s,complete:a},l.next===void 0&&(l.next=Hx),l.error===void 0&&(l.error=Hx),l.complete===void 0&&(l.complete=Hx);const d=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),d}unsubscribeOne(n){this.observers===void 0||this.observers[n]===void 0||(delete this.observers[n],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(n){if(!this.finalized)for(let s=0;s<this.observers.length;s++)this.sendOne(s,n)}sendOne(n,s){this.task.then(()=>{if(this.observers!==void 0&&this.observers[n]!==void 0)try{s(this.observers[n])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(n){this.finalized||(this.finalized=!0,n!==void 0&&(this.finalError=n),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function RTe(i,n){if(typeof i!="object"||i===null)return!1;for(const s of n)if(s in i&&typeof i[s]=="function")return!0;return!1}function Hx(){}const bTe=1e3,ITe=2,ATe=14400*1e3,OTe=.5;function f9(i,n=bTe,s=ITe){const a=n*Math.pow(s,i),l=Math.round(OTe*a*(Math.random()-.5)*2);return Math.min(ATe,a+l)}function Sc(i){return i&&i._delegate?i._delegate:i}class Rd{constructor(n,s,a){this.name=n,this.instanceFactory=s,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(n){return this.instantiationMode=n,this}setMultipleInstances(n){return this.multipleInstances=n,this}setServiceProps(n){return this.serviceProps=n,this}setInstanceCreatedCallback(n){return this.onInstanceCreated=n,this}}const mg="[DEFAULT]";class NTe{constructor(n,s){this.name=n,this.container=s,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(n){const s=this.normalizeInstanceIdentifier(n);if(!this.instancesDeferred.has(s)){const a=new lTe;if(this.instancesDeferred.set(s,a),this.isInitialized(s)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:s});l&&a.resolve(l)}catch{}}return this.instancesDeferred.get(s).promise}getImmediate(n){const s=this.normalizeInstanceIdentifier(n?.identifier),a=n?.optional??!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(l){if(a)return null;throw l}else{if(a)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(n){if(n.name!==this.name)throw Error(`Mismatching Component ${n.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=n,!!this.shouldAutoInitialize()){if(kTe(n))try{this.getOrInitializeService({instanceIdentifier:mg})}catch{}for(const[s,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(s);try{const d=this.getOrInitializeService({instanceIdentifier:l});a.resolve(d)}catch{}}}}clearInstance(n=mg){this.instancesDeferred.delete(n),this.instancesOptions.delete(n),this.instances.delete(n)}async delete(){const n=Array.from(this.instances.values());await Promise.all([...n.filter(s=>"INTERNAL"in s).map(s=>s.INTERNAL.delete()),...n.filter(s=>"_delete"in s).map(s=>s._delete())])}isComponentSet(){return this.component!=null}isInitialized(n=mg){return this.instances.has(n)}getOptions(n=mg){return this.instancesOptions.get(n)||{}}initialize(n={}){const{options:s={}}=n,a=this.normalizeInstanceIdentifier(n.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:a,options:s});for(const[d,f]of this.instancesDeferred.entries()){const E=this.normalizeInstanceIdentifier(d);a===E&&f.resolve(l)}return l}onInit(n,s){const a=this.normalizeInstanceIdentifier(s),l=this.onInitCallbacks.get(a)??new Set;l.add(n),this.onInitCallbacks.set(a,l);const d=this.instances.get(a);return d&&n(d,a),()=>{l.delete(n)}}invokeOnInitCallbacks(n,s){const a=this.onInitCallbacks.get(s);if(a)for(const l of a)try{l(n,s)}catch{}}getOrInitializeService({instanceIdentifier:n,options:s={}}){let a=this.instances.get(n);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:PTe(n),options:s}),this.instances.set(n,a),this.instancesOptions.set(n,s),this.invokeOnInitCallbacks(a,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,a)}catch{}return a||null}normalizeInstanceIdentifier(n=mg){return this.component?this.component.multipleInstances?n:mg:n}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function PTe(i){return i===mg?void 0:i}function kTe(i){return i.instantiationMode==="EAGER"}class DTe{constructor(n){this.name=n,this.providers=new Map}addComponent(n){const s=this.getProvider(n.name);if(s.isComponentSet())throw new Error(`Component ${n.name} has already been registered with ${this.name}`);s.setComponent(n)}addOrOverwriteComponent(n){this.getProvider(n.name).isComponentSet()&&this.providers.delete(n.name),this.addComponent(n)}getProvider(n){if(this.providers.has(n))return this.providers.get(n);const s=new NTe(n,this);return this.providers.set(n,s),s}getProviders(){return Array.from(this.providers.values())}}var hi;(function(i){i[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT"})(hi||(hi={}));const xTe={debug:hi.DEBUG,verbose:hi.VERBOSE,info:hi.INFO,warn:hi.WARN,error:hi.ERROR,silent:hi.SILENT},LTe=hi.INFO,MTe={[hi.DEBUG]:"log",[hi.VERBOSE]:"log",[hi.INFO]:"info",[hi.WARN]:"warn",[hi.ERROR]:"error"},UTe=(i,n,...s)=>{if(n<i.logLevel)return;const a=new Date().toISOString(),l=MTe[n];if(l)console[l](`[${a}]  ${i.name}:`,...s);else throw new Error(`Attempted to log a message with an invalid logType (value: ${n})`)};class K2{constructor(n){this.name=n,this._logLevel=LTe,this._logHandler=UTe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(n){if(!(n in hi))throw new TypeError(`Invalid value "${n}" assigned to \`logLevel\``);this._logLevel=n}setLogLevel(n){this._logLevel=typeof n=="string"?xTe[n]:n}get logHandler(){return this._logHandler}set logHandler(n){if(typeof n!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=n}get userLogHandler(){return this._userLogHandler}set userLogHandler(n){this._userLogHandler=n}debug(...n){this._userLogHandler&&this._userLogHandler(this,hi.DEBUG,...n),this._logHandler(this,hi.DEBUG,...n)}log(...n){this._userLogHandler&&this._userLogHandler(this,hi.VERBOSE,...n),this._logHandler(this,hi.VERBOSE,...n)}info(...n){this._userLogHandler&&this._userLogHandler(this,hi.INFO,...n),this._logHandler(this,hi.INFO,...n)}warn(...n){this._userLogHandler&&this._userLogHandler(this,hi.WARN,...n),this._logHandler(this,hi.WARN,...n)}error(...n){this._userLogHandler&&this._userLogHandler(this,hi.ERROR,...n),this._logHandler(this,hi.ERROR,...n)}}const VTe=(i,n)=>n.some(s=>i instanceof s);let m9,g9;function FTe(){return m9||(m9=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function jTe(){return g9||(g9=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const c$=new WeakMap,lM=new WeakMap,l$=new WeakMap,zx=new WeakMap,Y2=new WeakMap;function BTe(i){const n=new Promise((s,a)=>{const l=()=>{i.removeEventListener("success",d),i.removeEventListener("error",f)},d=()=>{s(nf(i.result)),l()},f=()=>{a(i.error),l()};i.addEventListener("success",d),i.addEventListener("error",f)});return n.then(s=>{s instanceof IDBCursor&&c$.set(s,i)}).catch(()=>{}),Y2.set(n,i),n}function WTe(i){if(lM.has(i))return;const n=new Promise((s,a)=>{const l=()=>{i.removeEventListener("complete",d),i.removeEventListener("error",f),i.removeEventListener("abort",f)},d=()=>{s(),l()},f=()=>{a(i.error||new DOMException("AbortError","AbortError")),l()};i.addEventListener("complete",d),i.addEventListener("error",f),i.addEventListener("abort",f)});lM.set(i,n)}let uM={get(i,n,s){if(i instanceof IDBTransaction){if(n==="done")return lM.get(i);if(n==="objectStoreNames")return i.objectStoreNames||l$.get(i);if(n==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return nf(i[n])},set(i,n,s){return i[n]=s,!0},has(i,n){return i instanceof IDBTransaction&&(n==="done"||n==="store")?!0:n in i}};function GTe(i){uM=i(uM)}function HTe(i){return i===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(n,...s){const a=i.call(Kx(this),n,...s);return l$.set(a,n.sort?n.sort():[n]),nf(a)}:jTe().includes(i)?function(...n){return i.apply(Kx(this),n),nf(c$.get(this))}:function(...n){return nf(i.apply(Kx(this),n))}}function zTe(i){return typeof i=="function"?HTe(i):(i instanceof IDBTransaction&&WTe(i),VTe(i,FTe())?new Proxy(i,uM):i)}function nf(i){if(i instanceof IDBRequest)return BTe(i);if(zx.has(i))return zx.get(i);const n=zTe(i);return n!==i&&(zx.set(i,n),Y2.set(n,i)),n}const Kx=i=>Y2.get(i);function u$(i,n,{blocked:s,upgrade:a,blocking:l,terminated:d}={}){const f=indexedDB.open(i,n),E=nf(f);return a&&f.addEventListener("upgradeneeded",S=>{a(nf(f.result),S.oldVersion,S.newVersion,nf(f.transaction),S)}),s&&f.addEventListener("blocked",S=>s(S.oldVersion,S.newVersion,S)),E.then(S=>{d&&S.addEventListener("close",()=>d()),l&&S.addEventListener("versionchange",T=>l(T.oldVersion,T.newVersion,T))}).catch(()=>{}),E}const KTe=["get","getKey","getAll","getAllKeys","count"],YTe=["put","add","delete","clear"],Yx=new Map;function _9(i,n){if(!(i instanceof IDBDatabase&&!(n in i)&&typeof n=="string"))return;if(Yx.get(n))return Yx.get(n);const s=n.replace(/FromIndex$/,""),a=n!==s,l=YTe.includes(s);if(!(s in(a?IDBIndex:IDBObjectStore).prototype)||!(l||KTe.includes(s)))return;const d=async function(f,...E){const S=this.transaction(f,l?"readwrite":"readonly");let T=S.store;return a&&(T=T.index(E.shift())),(await Promise.all([T[s](...E),l&&S.done]))[0]};return Yx.set(n,d),d}GTe(i=>({...i,get:(n,s,a)=>_9(n,s)||i.get(n,s,a),has:(n,s)=>!!_9(n,s)||i.has(n,s)}));class qTe{constructor(n){this.container=n}getPlatformInfoString(){return this.container.getProviders().map(s=>{if(XTe(s)){const a=s.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(s=>s).join(" ")}}function XTe(i){return i.getComponent()?.type==="VERSION"}const dM="@firebase/app",E9="0.14.6";const vh=new K2("@firebase/app"),JTe="@firebase/app-compat",$Te="@firebase/analytics-compat",QTe="@firebase/analytics",ZTe="@firebase/app-check-compat",e0e="@firebase/app-check",t0e="@firebase/auth",n0e="@firebase/auth-compat",r0e="@firebase/database",i0e="@firebase/data-connect",s0e="@firebase/database-compat",o0e="@firebase/functions",a0e="@firebase/functions-compat",c0e="@firebase/installations",l0e="@firebase/installations-compat",u0e="@firebase/messaging",d0e="@firebase/messaging-compat",h0e="@firebase/performance",p0e="@firebase/performance-compat",f0e="@firebase/remote-config",m0e="@firebase/remote-config-compat",g0e="@firebase/storage",_0e="@firebase/storage-compat",E0e="@firebase/firestore",y0e="@firebase/ai",v0e="@firebase/firestore-compat",S0e="firebase",T0e="12.6.0";const hM="[DEFAULT]",w0e={[dM]:"fire-core",[JTe]:"fire-core-compat",[QTe]:"fire-analytics",[$Te]:"fire-analytics-compat",[e0e]:"fire-app-check",[ZTe]:"fire-app-check-compat",[t0e]:"fire-auth",[n0e]:"fire-auth-compat",[r0e]:"fire-rtdb",[i0e]:"fire-data-connect",[s0e]:"fire-rtdb-compat",[o0e]:"fire-fn",[a0e]:"fire-fn-compat",[c0e]:"fire-iid",[l0e]:"fire-iid-compat",[u0e]:"fire-fcm",[d0e]:"fire-fcm-compat",[h0e]:"fire-perf",[p0e]:"fire-perf-compat",[f0e]:"fire-rc",[m0e]:"fire-rc-compat",[g0e]:"fire-gcs",[_0e]:"fire-gcs-compat",[E0e]:"fire-fst",[v0e]:"fire-fst-compat",[y0e]:"fire-vertex","fire-js":"fire-js",[S0e]:"fire-js-all"};const JA=new Map,C0e=new Map,pM=new Map;function y9(i,n){try{i.container.addComponent(n)}catch(s){vh.debug(`Component ${n.name} failed to register with FirebaseApp ${i.name}`,s)}}function Sh(i){const n=i.name;if(pM.has(n))return vh.debug(`There were multiple attempts to register component ${n}.`),!1;pM.set(n,i);for(const s of JA.values())y9(s,i);for(const s of C0e.values())y9(s,i);return!0}function mv(i,n){const s=i.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),i.container.getProvider(n)}function Oa(i){return i==null?!1:i.settings!==void 0}const R0e={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},rf=new Hg("app","Firebase",R0e);class b0e{constructor(n,s,a){this._isDeleted=!1,this._options={...n},this._config={...s},this._name=s.name,this._automaticDataCollectionEnabled=s.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new Rd("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(n){this.checkDestroyed(),this._automaticDataCollectionEnabled=n}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(n){this._isDeleted=n}checkDestroyed(){if(this.isDeleted)throw rf.create("app-deleted",{appName:this._name})}}const Ww=T0e;function d$(i,n={}){let s=i;typeof n!="object"&&(n={name:n});const a={name:hM,automaticDataCollectionEnabled:!0,...n},l=a.name;if(typeof l!="string"||!l)throw rf.create("bad-app-name",{appName:String(l)});if(s||(s=r$()),!s)throw rf.create("no-options");const d=JA.get(l);if(d){if(Mg(s,d.options)&&Mg(a,d.config))return d;throw rf.create("duplicate-app",{appName:l})}const f=new DTe(l);for(const S of pM.values())f.addComponent(S);const E=new b0e(s,a,f);return JA.set(l,E),E}function h$(i=hM){const n=JA.get(i);if(!n&&i===hM&&r$())return d$();if(!n)throw rf.create("no-app",{appName:i});return n}function vd(i,n,s){let a=w0e[i]??i;s&&(a+=`-${s}`);const l=a.match(/\s|\//),d=n.match(/\s|\//);if(l||d){const f=[`Unable to register library "${a}" with version "${n}":`];l&&f.push(`library name "${a}" contains illegal characters (whitespace or "/")`),l&&d&&f.push("and"),d&&f.push(`version name "${n}" contains illegal characters (whitespace or "/")`),vh.warn(f.join(" "));return}Sh(new Rd(`${a}-version`,()=>({library:a,version:n}),"VERSION"))}const I0e="firebase-heartbeat-database",A0e=1,gw="firebase-heartbeat-store";let qx=null;function p$(){return qx||(qx=u$(I0e,A0e,{upgrade:(i,n)=>{switch(n){case 0:try{i.createObjectStore(gw)}catch(s){console.warn(s)}}}}).catch(i=>{throw rf.create("idb-open",{originalErrorMessage:i.message})})),qx}async function O0e(i){try{const s=(await p$()).transaction(gw),a=await s.objectStore(gw).get(f$(i));return await s.done,a}catch(n){if(n instanceof Nd)vh.warn(n.message);else{const s=rf.create("idb-get",{originalErrorMessage:n?.message});vh.warn(s.message)}}}async function v9(i,n){try{const a=(await p$()).transaction(gw,"readwrite");await a.objectStore(gw).put(n,f$(i)),await a.done}catch(s){if(s instanceof Nd)vh.warn(s.message);else{const a=rf.create("idb-set",{originalErrorMessage:s?.message});vh.warn(a.message)}}}function f$(i){return`${i.name}!${i.options.appId}`}const N0e=1024,P0e=30;class k0e{constructor(n){this.container=n,this._heartbeatsCache=null;const s=this.container.getProvider("app").getImmediate();this._storage=new x0e(s),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),a=S9();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===a||this._heartbeatsCache.heartbeats.some(l=>l.date===a))return;if(this._heartbeatsCache.heartbeats.push({date:a,agent:s}),this._heartbeatsCache.heartbeats.length>P0e){const l=L0e(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(l,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){vh.warn(n)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=S9(),{heartbeatsToSend:s,unsentEntries:a}=D0e(this._heartbeatsCache.heartbeats),l=t$(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=n,a.length>0?(this._heartbeatsCache.heartbeats=a,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),l}catch(n){return vh.warn(n),""}}}function S9(){return new Date().toISOString().substring(0,10)}function D0e(i,n=N0e){const s=[];let a=i.slice();for(const l of i){const d=s.find(f=>f.agent===l.agent);if(d){if(d.dates.push(l.date),T9(s)>n){d.dates.pop();break}}else if(s.push({agent:l.agent,dates:[l.date]}),T9(s)>n){s.pop();break}a=a.slice(1)}return{heartbeatsToSend:s,unsentEntries:a}}class x0e{constructor(n){this.app=n,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return o$()?a$().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const s=await O0e(this.app);return s?.heartbeats?s:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(n){if(await this._canUseIndexedDBPromise){const a=await this.read();return v9(this.app,{lastSentHeartbeatDate:n.lastSentHeartbeatDate??a.lastSentHeartbeatDate,heartbeats:n.heartbeats})}else return}async add(n){if(await this._canUseIndexedDBPromise){const a=await this.read();return v9(this.app,{lastSentHeartbeatDate:n.lastSentHeartbeatDate??a.lastSentHeartbeatDate,heartbeats:[...a.heartbeats,...n.heartbeats]})}else return}}function T9(i){return t$(JSON.stringify({version:2,heartbeats:i})).length}function L0e(i){if(i.length===0)return-1;let n=0,s=i[0].date;for(let a=1;a<i.length;a++)i[a].date<s&&(s=i[a].date,n=a);return n}function M0e(i){Sh(new Rd("platform-logger",n=>new qTe(n),"PRIVATE")),Sh(new Rd("heartbeat",n=>new k0e(n),"PRIVATE")),vd(dM,E9,i),vd(dM,E9,"esm2020"),vd("fire-js","")}M0e("");function m$(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const U0e=m$,g$=new Hg("auth","Firebase",m$());const $A=new K2("@firebase/auth");function V0e(i,...n){$A.logLevel<=hi.WARN&&$A.warn(`Auth (${Ww}): ${i}`,...n)}function TA(i,...n){$A.logLevel<=hi.ERROR&&$A.error(`Auth (${Ww}): ${i}`,...n)}function ll(i,...n){throw X2(i,...n)}function Pa(i,...n){return X2(i,...n)}function q2(i,n,s){const a={...U0e(),[n]:s};return new Hg("auth","Firebase",a).create(n,{appName:i.name})}function lu(i){return q2(i,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function F0e(i,n,s){const a=s;if(!(n instanceof a))throw a.name!==n.constructor.name&&ll(i,"argument-error"),q2(i,"argument-error",`Type of ${n.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function X2(i,...n){if(typeof i!="string"){const s=n[0],a=[...n.slice(1)];return a[0]&&(a[0].appName=i.name),i._errorFactory.create(s,...a)}return g$.create(i,...n)}function Mt(i,n,...s){if(!i)throw X2(n,...s)}function fh(i){const n="INTERNAL ASSERTION FAILED: "+i;throw TA(n),new Error(n)}function Th(i,n){i||fh(n)}function fM(){return typeof self<"u"&&self.location?.href||""}function _$(){return w9()==="http:"||w9()==="https:"}function w9(){return typeof self<"u"&&self.location?.protocol||null}function j0e(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(_$()||s$()||"connection"in navigator)?navigator.onLine:!0}function B0e(){if(typeof navigator>"u")return null;const i=navigator;return i.languages&&i.languages[0]||i.language||null}class Gw{constructor(n,s){this.shortDelay=n,this.longDelay=s,Th(s>n,"Short delay should be less than long delay!"),this.isMobile=fTe()||gTe()}get(){return j0e()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function J2(i,n){Th(i.emulator,"Emulator should always be set here");const{url:s}=i.emulator;return n?`${s}${n.startsWith("/")?n.slice(1):n}`:s}class E${static initialize(n,s,a){this.fetchImpl=n,s&&(this.headersImpl=s),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;fh("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;fh("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;fh("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const W0e={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const G0e=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],H0e=new Gw(3e4,6e4);function Va(i,n){return i.tenantId&&!n.tenantId?{...n,tenantId:i.tenantId}:n}async function ul(i,n,s,a,l={}){return y$(i,l,async()=>{let d={},f={};a&&(n==="GET"?f=a:d={body:JSON.stringify(a)});const E=fv({key:i.config.apiKey,...f}).slice(1),S=await i._getAdditionalHeaders();S["Content-Type"]="application/json",i.languageCode&&(S["X-Firebase-Locale"]=i.languageCode);const T={method:n,headers:S,...d};return mTe()||(T.referrerPolicy="no-referrer"),i.emulatorConfig&&WO(i.emulatorConfig.host)&&(T.credentials="include"),E$.fetch()(await v$(i,i.config.apiHost,s,E),T)})}async function y$(i,n,s){i._canInitEmulator=!1;const a={...W0e,...n};try{const l=new K0e(i),d=await Promise.race([s(),l.promise]);l.clearNetworkTimeout();const f=await d.json();if("needConfirmation"in f)throw U0(i,"account-exists-with-different-credential",f);if(d.ok&&!("errorMessage"in f))return f;{const E=d.ok?f.errorMessage:f.error.message,[S,T]=E.split(" : ");if(S==="FEDERATED_USER_ID_ALREADY_LINKED")throw U0(i,"credential-already-in-use",f);if(S==="EMAIL_EXISTS")throw U0(i,"email-already-in-use",f);if(S==="USER_DISABLED")throw U0(i,"user-disabled",f);const C=a[S]||S.toLowerCase().replace(/[_\s]+/g,"-");if(T)throw q2(i,C,T);ll(i,C)}}catch(l){if(l instanceof Nd)throw l;ll(i,"network-request-failed",{message:String(l)})}}async function Tf(i,n,s,a,l={}){const d=await ul(i,n,s,a,l);return"mfaPendingCredential"in d&&ll(i,"multi-factor-auth-required",{_serverResponse:d}),d}async function v$(i,n,s,a){const l=`${n}${s}?${a}`,d=i,f=d.config.emulator?J2(i.config,l):`${i.config.apiScheme}://${l}`;return G0e.includes(s)&&(await d._persistenceManagerAvailable,d._getPersistenceType()==="COOKIE")?d._getPersistence()._getFinalTarget(f).toString():f}function z0e(i){switch(i){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class K0e{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(n){this.auth=n,this.timer=null,this.promise=new Promise((s,a)=>{this.timer=setTimeout(()=>a(Pa(this.auth,"network-request-failed")),H0e.get())})}}function U0(i,n,s){const a={appName:i.name};s.email&&(a.email=s.email),s.phoneNumber&&(a.phoneNumber=s.phoneNumber);const l=Pa(i,n,a);return l.customData._tokenResponse=s,l}function C9(i){return i!==void 0&&i.getResponse!==void 0}function R9(i){return i!==void 0&&i.enterprise!==void 0}class S${constructor(n){if(this.siteKey="",this.recaptchaEnforcementState=[],n.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=n.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=n.recaptchaEnforcementState}getProviderEnforcementState(n){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const s of this.recaptchaEnforcementState)if(s.provider&&s.provider===n)return z0e(s.enforcementState);return null}isProviderEnabled(n){return this.getProviderEnforcementState(n)==="ENFORCE"||this.getProviderEnforcementState(n)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Y0e(i){return(await ul(i,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function T$(i,n){return ul(i,"GET","/v2/recaptchaConfig",Va(i,n))}async function q0e(i,n){return ul(i,"POST","/v1/accounts:delete",n)}async function QA(i,n){return ul(i,"POST","/v1/accounts:lookup",n)}function K0(i){if(i)try{const n=new Date(Number(i));if(!isNaN(n.getTime()))return n.toUTCString()}catch{}}async function X0e(i,n=!1){const s=Sc(i),a=await s.getIdToken(n),l=$2(a);Mt(l&&l.exp&&l.auth_time&&l.iat,s.auth,"internal-error");const d=typeof l.firebase=="object"?l.firebase:void 0,f=d?.sign_in_provider;return{claims:l,token:a,authTime:K0(Xx(l.auth_time)),issuedAtTime:K0(Xx(l.iat)),expirationTime:K0(Xx(l.exp)),signInProvider:f||null,signInSecondFactor:d?.sign_in_second_factor||null}}function Xx(i){return Number(i)*1e3}function $2(i){const[n,s,a]=i.split(".");if(n===void 0||s===void 0||a===void 0)return TA("JWT malformed, contained fewer than 3 sections"),null;try{const l=n$(s);return l?JSON.parse(l):(TA("Failed to decode base64 JWT payload"),null)}catch(l){return TA("Caught error parsing JWT payload as JSON",l?.toString()),null}}function b9(i){const n=$2(i);return Mt(n,"internal-error"),Mt(typeof n.exp<"u","internal-error"),Mt(typeof n.iat<"u","internal-error"),Number(n.exp)-Number(n.iat)}async function _w(i,n,s=!1){if(s)return n;try{return await n}catch(a){throw a instanceof Nd&&J0e(a)&&i.auth.currentUser===i&&await i.auth.signOut(),a}}function J0e({code:i}){return i==="auth/user-disabled"||i==="auth/user-token-expired"}class $0e{constructor(n){this.user=n,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(n){if(n){const s=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),s}else{this.errorBackoff=3e4;const a=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,a)}}schedule(n=!1){if(!this.isRunning)return;const s=this.getInterval(n);this.timerId=setTimeout(async()=>{await this.iteration()},s)}async iteration(){try{await this.user.getIdToken(!0)}catch(n){n?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class mM{constructor(n,s){this.createdAt=n,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=K0(this.lastLoginAt),this.creationTime=K0(this.createdAt)}_copy(n){this.createdAt=n.createdAt,this.lastLoginAt=n.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ZA(i){const n=i.auth,s=await i.getIdToken(),a=await _w(i,QA(n,{idToken:s}));Mt(a?.users.length,n,"internal-error");const l=a.users[0];i._notifyReloadListener(l);const d=l.providerUserInfo?.length?w$(l.providerUserInfo):[],f=Z0e(i.providerData,d),E=i.isAnonymous,S=!(i.email&&l.passwordHash)&&!f?.length,T=E?S:!1,C={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:f,metadata:new mM(l.createdAt,l.lastLoginAt),isAnonymous:T};Object.assign(i,C)}async function Q0e(i){const n=Sc(i);await ZA(n),await n.auth._persistUserIfCurrent(n),n.auth._notifyListenersIfCurrent(n)}function Z0e(i,n){return[...i.filter(a=>!n.some(l=>l.providerId===a.providerId)),...n]}function w$(i){return i.map(({providerId:n,...s})=>({providerId:n,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}))}async function ewe(i,n){const s=await y$(i,{},async()=>{const a=fv({grant_type:"refresh_token",refresh_token:n}).slice(1),{tokenApiHost:l,apiKey:d}=i.config,f=await v$(i,l,"/v1/token",`key=${d}`),E=await i._getAdditionalHeaders();E["Content-Type"]="application/x-www-form-urlencoded";const S={method:"POST",headers:E,body:a};return i.emulatorConfig&&WO(i.emulatorConfig.host)&&(S.credentials="include"),E$.fetch()(f,S)});return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}}async function twe(i,n){return ul(i,"POST","/v2/accounts:revokeToken",Va(i,n))}class Uy{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(n){Mt(n.idToken,"internal-error"),Mt(typeof n.idToken<"u","internal-error"),Mt(typeof n.refreshToken<"u","internal-error");const s="expiresIn"in n&&typeof n.expiresIn<"u"?Number(n.expiresIn):b9(n.idToken);this.updateTokensAndExpiration(n.idToken,n.refreshToken,s)}updateFromIdToken(n){Mt(n.length!==0,"internal-error");const s=b9(n);this.updateTokensAndExpiration(n,null,s)}async getToken(n,s=!1){return!s&&this.accessToken&&!this.isExpired?this.accessToken:(Mt(this.refreshToken,n,"user-token-expired"),this.refreshToken?(await this.refresh(n,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(n,s){const{accessToken:a,refreshToken:l,expiresIn:d}=await ewe(n,s);this.updateTokensAndExpiration(a,l,Number(d))}updateTokensAndExpiration(n,s,a){this.refreshToken=s||null,this.accessToken=n||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(n,s){const{refreshToken:a,accessToken:l,expirationTime:d}=s,f=new Uy;return a&&(Mt(typeof a=="string","internal-error",{appName:n}),f.refreshToken=a),l&&(Mt(typeof l=="string","internal-error",{appName:n}),f.accessToken=l),d&&(Mt(typeof d=="number","internal-error",{appName:n}),f.expirationTime=d),f}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(n){this.accessToken=n.accessToken,this.refreshToken=n.refreshToken,this.expirationTime=n.expirationTime}_clone(){return Object.assign(new Uy,this.toJSON())}_performRefresh(){return fh("not implemented")}}function jp(i,n){Mt(typeof i=="string"||typeof i>"u","internal-error",{appName:n})}class cu{constructor({uid:n,auth:s,stsTokenManager:a,...l}){this.providerId="firebase",this.proactiveRefresh=new $0e(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=s,this.stsTokenManager=a,this.accessToken=a.accessToken,this.displayName=l.displayName||null,this.email=l.email||null,this.emailVerified=l.emailVerified||!1,this.phoneNumber=l.phoneNumber||null,this.photoURL=l.photoURL||null,this.isAnonymous=l.isAnonymous||!1,this.tenantId=l.tenantId||null,this.providerData=l.providerData?[...l.providerData]:[],this.metadata=new mM(l.createdAt||void 0,l.lastLoginAt||void 0)}async getIdToken(n){const s=await _w(this,this.stsTokenManager.getToken(this.auth,n));return Mt(s,this.auth,"internal-error"),this.accessToken!==s&&(this.accessToken=s,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),s}getIdTokenResult(n){return X0e(this,n)}reload(){return Q0e(this)}_assign(n){this!==n&&(Mt(this.uid===n.uid,this.auth,"internal-error"),this.displayName=n.displayName,this.photoURL=n.photoURL,this.email=n.email,this.emailVerified=n.emailVerified,this.phoneNumber=n.phoneNumber,this.isAnonymous=n.isAnonymous,this.tenantId=n.tenantId,this.providerData=n.providerData.map(s=>({...s})),this.metadata._copy(n.metadata),this.stsTokenManager._assign(n.stsTokenManager))}_clone(n){const s=new cu({...this,auth:n,stsTokenManager:this.stsTokenManager._clone()});return s.metadata._copy(this.metadata),s}_onReload(n){Mt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=n,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(n){this.reloadListener?this.reloadListener(n):this.reloadUserInfo=n}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(n,s=!1){let a=!1;n.idToken&&n.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(n),a=!0),s&&await ZA(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Oa(this.auth.app))return Promise.reject(lu(this.auth));const n=await this.getIdToken();return await _w(this,q0e(this.auth,{idToken:n})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(n=>({...n})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(n,s){const a=s.displayName??void 0,l=s.email??void 0,d=s.phoneNumber??void 0,f=s.photoURL??void 0,E=s.tenantId??void 0,S=s._redirectEventId??void 0,T=s.createdAt??void 0,C=s.lastLoginAt??void 0,{uid:I,emailVerified:N,isAnonymous:P,providerData:W,stsTokenManager:x}=s;Mt(I&&x,n,"internal-error");const B=Uy.fromJSON(this.name,x);Mt(typeof I=="string",n,"internal-error"),jp(a,n.name),jp(l,n.name),Mt(typeof N=="boolean",n,"internal-error"),Mt(typeof P=="boolean",n,"internal-error"),jp(d,n.name),jp(f,n.name),jp(E,n.name),jp(S,n.name),jp(T,n.name),jp(C,n.name);const X=new cu({uid:I,auth:n,email:l,emailVerified:N,displayName:a,isAnonymous:P,photoURL:f,phoneNumber:d,tenantId:E,stsTokenManager:B,createdAt:T,lastLoginAt:C});return W&&Array.isArray(W)&&(X.providerData=W.map(Z=>({...Z}))),S&&(X._redirectEventId=S),X}static async _fromIdTokenResponse(n,s,a=!1){const l=new Uy;l.updateFromServerResponse(s);const d=new cu({uid:s.localId,auth:n,stsTokenManager:l,isAnonymous:a});return await ZA(d),d}static async _fromGetAccountInfoResponse(n,s,a){const l=s.users[0];Mt(l.localId!==void 0,"internal-error");const d=l.providerUserInfo!==void 0?w$(l.providerUserInfo):[],f=!(l.email&&l.passwordHash)&&!d?.length,E=new Uy;E.updateFromIdToken(a);const S=new cu({uid:l.localId,auth:n,stsTokenManager:E,isAnonymous:f}),T={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:d,metadata:new mM(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!d?.length};return Object.assign(S,T),S}}const I9=new Map;function mh(i){Th(i instanceof Function,"Expected a class definition");let n=I9.get(i);return n?(Th(n instanceof i,"Instance stored in cache mismatched with class"),n):(n=new i,I9.set(i,n),n)}class C${constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(n,s){this.storage[n]=s}async _get(n){const s=this.storage[n];return s===void 0?null:s}async _remove(n){delete this.storage[n]}_addListener(n,s){}_removeListener(n,s){}}C$.type="NONE";const A9=C$;function wA(i,n,s){return`firebase:${i}:${n}:${s}`}class Vy{constructor(n,s,a){this.persistence=n,this.auth=s,this.userKey=a;const{config:l,name:d}=this.auth;this.fullUserKey=wA(this.userKey,l.apiKey,d),this.fullPersistenceKey=wA("persistence",l.apiKey,d),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(n){return this.persistence._set(this.fullUserKey,n.toJSON())}async getCurrentUser(){const n=await this.persistence._get(this.fullUserKey);if(!n)return null;if(typeof n=="string"){const s=await QA(this.auth,{idToken:n}).catch(()=>{});return s?cu._fromGetAccountInfoResponse(this.auth,s,n):null}return cu._fromJSON(this.auth,n)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(n){if(this.persistence===n)return;const s=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=n,s)return this.setCurrentUser(s)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(n,s,a="authUser"){if(!s.length)return new Vy(mh(A9),n,a);const l=(await Promise.all(s.map(async T=>{if(await T._isAvailable())return T}))).filter(T=>T);let d=l[0]||mh(A9);const f=wA(a,n.config.apiKey,n.name);let E=null;for(const T of s)try{const C=await T._get(f);if(C){let I;if(typeof C=="string"){const N=await QA(n,{idToken:C}).catch(()=>{});if(!N)break;I=await cu._fromGetAccountInfoResponse(n,N,C)}else I=cu._fromJSON(n,C);T!==d&&(E=I),d=T;break}}catch{}const S=l.filter(T=>T._shouldAllowMigration);return!d._shouldAllowMigration||!S.length?new Vy(d,n,a):(d=S[0],E&&await d._set(f,E.toJSON()),await Promise.all(s.map(async T=>{if(T!==d)try{await T._remove(f)}catch{}})),new Vy(d,n,a))}}function O9(i){const n=i.toLowerCase();if(n.includes("opera/")||n.includes("opr/")||n.includes("opios/"))return"Opera";if(A$(n))return"IEMobile";if(n.includes("msie")||n.includes("trident/"))return"IE";if(n.includes("edge/"))return"Edge";if(R$(n))return"Firefox";if(n.includes("silk/"))return"Silk";if(N$(n))return"Blackberry";if(P$(n))return"Webos";if(b$(n))return"Safari";if((n.includes("chrome/")||I$(n))&&!n.includes("edge/"))return"Chrome";if(O$(n))return"Android";{const s=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=i.match(s);if(a?.length===2)return a[1]}return"Other"}function R$(i=ra()){return/firefox\//i.test(i)}function b$(i=ra()){const n=i.toLowerCase();return n.includes("safari/")&&!n.includes("chrome/")&&!n.includes("crios/")&&!n.includes("android")}function I$(i=ra()){return/crios\//i.test(i)}function A$(i=ra()){return/iemobile/i.test(i)}function O$(i=ra()){return/android/i.test(i)}function N$(i=ra()){return/blackberry/i.test(i)}function P$(i=ra()){return/webos/i.test(i)}function Q2(i=ra()){return/iphone|ipad|ipod/i.test(i)||/macintosh/i.test(i)&&/mobile/i.test(i)}function nwe(i=ra()){return Q2(i)&&!!window.navigator?.standalone}function rwe(){return _Te()&&document.documentMode===10}function k$(i=ra()){return Q2(i)||O$(i)||P$(i)||N$(i)||/windows phone/i.test(i)||A$(i)}function D$(i,n=[]){let s;switch(i){case"Browser":s=O9(ra());break;case"Worker":s=`${O9(ra())}-${i}`;break;default:s=i}const a=n.length?n.join(","):"FirebaseCore-web";return`${s}/JsCore/${Ww}/${a}`}class iwe{constructor(n){this.auth=n,this.queue=[]}pushCallback(n,s){const a=d=>new Promise((f,E)=>{try{const S=n(d);f(S)}catch(S){E(S)}});a.onAbort=s,this.queue.push(a);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(n){if(this.auth.currentUser===n)return;const s=[];try{for(const a of this.queue)await a(n),a.onAbort&&s.push(a.onAbort)}catch(a){s.reverse();for(const l of s)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a?.message})}}}async function swe(i,n={}){return ul(i,"GET","/v2/passwordPolicy",Va(i,n))}const owe=6;class awe{constructor(n){const s=n.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=s.minPasswordLength??owe,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),s.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),s.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),s.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),s.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=n.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=n.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=n.forceUpgradeOnSignin??!1,this.schemaVersion=n.schemaVersion}validatePassword(n){const s={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(n,s),this.validatePasswordCharacterOptions(n,s),s.isValid&&(s.isValid=s.meetsMinPasswordLength??!0),s.isValid&&(s.isValid=s.meetsMaxPasswordLength??!0),s.isValid&&(s.isValid=s.containsLowercaseLetter??!0),s.isValid&&(s.isValid=s.containsUppercaseLetter??!0),s.isValid&&(s.isValid=s.containsNumericCharacter??!0),s.isValid&&(s.isValid=s.containsNonAlphanumericCharacter??!0),s}validatePasswordLengthOptions(n,s){const a=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;a&&(s.meetsMinPasswordLength=n.length>=a),l&&(s.meetsMaxPasswordLength=n.length<=l)}validatePasswordCharacterOptions(n,s){this.updatePasswordCharacterOptionsStatuses(s,!1,!1,!1,!1);let a;for(let l=0;l<n.length;l++)a=n.charAt(l),this.updatePasswordCharacterOptionsStatuses(s,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(n,s,a,l,d){this.customStrengthOptions.containsLowercaseLetter&&(n.containsLowercaseLetter||(n.containsLowercaseLetter=s)),this.customStrengthOptions.containsUppercaseLetter&&(n.containsUppercaseLetter||(n.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(n.containsNumericCharacter||(n.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(n.containsNonAlphanumericCharacter||(n.containsNonAlphanumericCharacter=d))}}class cwe{constructor(n,s,a,l){this.app=n,this.heartbeatServiceProvider=s,this.appCheckServiceProvider=a,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new N9(this),this.idTokenSubscription=new N9(this),this.beforeStateQueue=new iwe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=g$,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=n.name,this.clientVersion=l.sdkClientVersion,this._persistenceManagerAvailable=new Promise(d=>this._resolvePersistenceManagerAvailable=d)}_initializeWithPersistence(n,s){return s&&(this._popupRedirectResolver=mh(s)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Vy.create(this,n),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(s),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const n=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!n)){if(this.currentUser&&n&&this.currentUser.uid===n.uid){this._currentUser._assign(n),await this.currentUser.getIdToken();return}await this._updateCurrentUser(n,!0)}}async initializeCurrentUserFromIdToken(n){try{const s=await QA(this,{idToken:n}),a=await cu._fromGetAccountInfoResponse(this,s,n);await this.directlySetCurrentUser(a)}catch(s){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",s),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(n){if(Oa(this.app)){const d=this.app.settings.authIdToken;return d?new Promise(f=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(d).then(f,f))}):this.directlySetCurrentUser(null)}const s=await this.assertedPersistence.getCurrentUser();let a=s,l=!1;if(n&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const d=this.redirectUser?._redirectEventId,f=a?._redirectEventId,E=await this.tryRedirectSignIn(n);(!d||d===f)&&E?.user&&(a=E.user,l=!0)}if(!a)return this.directlySetCurrentUser(null);if(!a._redirectEventId){if(l)try{await this.beforeStateQueue.runMiddleware(a)}catch(d){a=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(d))}return a?this.reloadAndSetCurrentUserOrClear(a):this.directlySetCurrentUser(null)}return Mt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===a._redirectEventId?this.directlySetCurrentUser(a):this.reloadAndSetCurrentUserOrClear(a)}async tryRedirectSignIn(n){let s=null;try{s=await this._popupRedirectResolver._completeRedirectFn(this,n,!0)}catch{await this._setRedirectUser(null)}return s}async reloadAndSetCurrentUserOrClear(n){try{await ZA(n)}catch(s){if(s?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(n)}useDeviceLanguage(){this.languageCode=B0e()}async _delete(){this._deleted=!0}async updateCurrentUser(n){if(Oa(this.app))return Promise.reject(lu(this));const s=n?Sc(n):null;return s&&Mt(s.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(s&&s._clone(this))}async _updateCurrentUser(n,s=!1){if(!this._deleted)return n&&Mt(this.tenantId===n.tenantId,this,"tenant-id-mismatch"),s||await this.beforeStateQueue.runMiddleware(n),this.queue(async()=>{await this.directlySetCurrentUser(n),this.notifyAuthListeners()})}async signOut(){return Oa(this.app)?Promise.reject(lu(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(n){return Oa(this.app)?Promise.reject(lu(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(mh(n))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(n){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const s=this._getPasswordPolicyInternal();return s.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):s.validatePassword(n)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const n=await swe(this),s=new awe(n);this.tenantId===null?this._projectPasswordPolicy=s:this._tenantPasswordPolicies[this.tenantId]=s}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(n){this._errorFactory=new Hg("auth","Firebase",n())}onAuthStateChanged(n,s,a){return this.registerStateListener(this.authStateSubscription,n,s,a)}beforeAuthStateChanged(n,s){return this.beforeStateQueue.pushCallback(n,s)}onIdTokenChanged(n,s,a){return this.registerStateListener(this.idTokenSubscription,n,s,a)}authStateReady(){return new Promise((n,s)=>{if(this.currentUser)n();else{const a=this.onAuthStateChanged(()=>{a(),n()},s)}})}async revokeAccessToken(n){if(this.currentUser){const s=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:n,idToken:s};this.tenantId!=null&&(a.tenantId=this.tenantId),await twe(this,a)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(n,s){const a=await this.getOrInitRedirectPersistenceManager(s);return n===null?a.removeCurrentUser():a.setCurrentUser(n)}async getOrInitRedirectPersistenceManager(n){if(!this.redirectPersistenceManager){const s=n&&mh(n)||this._popupRedirectResolver;Mt(s,this,"argument-error"),this.redirectPersistenceManager=await Vy.create(this,[mh(s._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(n){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===n?this._currentUser:this.redirectUser?._redirectEventId===n?this.redirectUser:null}async _persistUserIfCurrent(n){if(n===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(n))}_notifyListenersIfCurrent(n){n===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=this.currentUser?.uid??null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(n,s,a,l){if(this._deleted)return()=>{};const d=typeof s=="function"?s:s.next.bind(s);let f=!1;const E=this._isInitialized?Promise.resolve():this._initializationPromise;if(Mt(E,this,"internal-error"),E.then(()=>{f||d(this.currentUser)}),typeof s=="function"){const S=n.addObserver(s,a,l);return()=>{f=!0,S()}}else{const S=n.addObserver(s);return()=>{f=!0,S()}}}async directlySetCurrentUser(n){this.currentUser&&this.currentUser!==n&&this._currentUser._stopProactiveRefresh(),n&&this.isProactiveRefreshEnabled&&n._startProactiveRefresh(),this.currentUser=n,n?await this.assertedPersistence.setCurrentUser(n):await this.assertedPersistence.removeCurrentUser()}queue(n){return this.operations=this.operations.then(n,n),this.operations}get assertedPersistence(){return Mt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(n){!n||this.frameworks.includes(n)||(this.frameworks.push(n),this.frameworks.sort(),this.clientVersion=D$(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const s=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();s&&(n["X-Firebase-Client"]=s);const a=await this._getAppCheckToken();return a&&(n["X-Firebase-AppCheck"]=a),n}async _getAppCheckToken(){if(Oa(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const n=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return n?.error&&V0e(`Error while retrieving App Check token: ${n.error}`),n?.token}}function dl(i){return Sc(i)}class N9{constructor(n){this.auth=n,this.observer=null,this.addObserver=wTe(s=>this.observer=s)}get next(){return Mt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Hw={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function lwe(i){Hw=i}function Z2(i){return Hw.loadJS(i)}function uwe(){return Hw.recaptchaV2Script}function dwe(){return Hw.recaptchaEnterpriseScript}function hwe(){return Hw.gapiScript}function x$(i){return`__${i}${Math.floor(Math.random()*1e6)}`}const pwe=500,fwe=6e4,iA=1e12;class mwe{constructor(n){this.auth=n,this.counter=iA,this._widgets=new Map}render(n,s){const a=this.counter;return this._widgets.set(a,new Ewe(n,this.auth.name,s||{})),this.counter++,a}reset(n){const s=n||iA;this._widgets.get(s)?.delete(),this._widgets.delete(s)}getResponse(n){const s=n||iA;return this._widgets.get(s)?.getResponse()||""}async execute(n){const s=n||iA;return this._widgets.get(s)?.execute(),""}}class gwe{constructor(){this.enterprise=new _we}ready(n){n()}execute(n,s){return Promise.resolve("token")}render(n,s){return""}}class _we{ready(n){n()}execute(n,s){return Promise.resolve("token")}render(n,s){return""}}class Ewe{constructor(n,s,a){this.params=a,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const l=typeof n=="string"?document.getElementById(n):n;Mt(l,"argument-error",{appName:s}),this.container=l,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=ywe(50);const{callback:n,"expired-callback":s}=this.params;if(n)try{n(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,s)try{s()}catch{}this.isVisible&&this.execute()},fwe)},pwe))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function ywe(i){const n=[],s="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let a=0;a<i;a++)n.push(s.charAt(Math.floor(Math.random()*s.length)));return n.join("")}const vwe="recaptcha-enterprise",Y0="NO_RECAPTCHA";class L${constructor(n){this.type=vwe,this.auth=dl(n)}async verify(n="verify",s=!1){async function a(d){if(!s){if(d.tenantId==null&&d._agentRecaptchaConfig!=null)return d._agentRecaptchaConfig.siteKey;if(d.tenantId!=null&&d._tenantRecaptchaConfigs[d.tenantId]!==void 0)return d._tenantRecaptchaConfigs[d.tenantId].siteKey}return new Promise(async(f,E)=>{T$(d,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(S=>{if(S.recaptchaKey===void 0)E(new Error("recaptcha Enterprise site key undefined"));else{const T=new S$(S);return d.tenantId==null?d._agentRecaptchaConfig=T:d._tenantRecaptchaConfigs[d.tenantId]=T,f(T.siteKey)}}).catch(S=>{E(S)})})}function l(d,f,E){const S=window.grecaptcha;R9(S)?S.enterprise.ready(()=>{S.enterprise.execute(d,{action:n}).then(T=>{f(T)}).catch(()=>{f(Y0)})}):E(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new gwe().execute("siteKey",{action:"verify"}):new Promise((d,f)=>{a(this.auth).then(E=>{if(!s&&R9(window.grecaptcha))l(E,d,f);else{if(typeof window>"u"){f(new Error("RecaptchaVerifier is only supported in browser"));return}let S=dwe();S.length!==0&&(S+=E),Z2(S).then(()=>{l(E,d,f)}).catch(T=>{f(T)})}}).catch(E=>{f(E)})})}}async function I0(i,n,s,a=!1,l=!1){const d=new L$(i);let f;if(l)f=Y0;else try{f=await d.verify(s)}catch{f=await d.verify(s,!0)}const E={...n};if(s==="mfaSmsEnrollment"||s==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in E){const S=E.phoneEnrollmentInfo.phoneNumber,T=E.phoneEnrollmentInfo.recaptchaToken;Object.assign(E,{phoneEnrollmentInfo:{phoneNumber:S,recaptchaToken:T,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in E){const S=E.phoneSignInInfo.recaptchaToken;Object.assign(E,{phoneSignInInfo:{recaptchaToken:S,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return E}return a?Object.assign(E,{captchaResp:f}):Object.assign(E,{captchaResponse:f}),Object.assign(E,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(E,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),E}async function Fy(i,n,s,a,l){if(l==="EMAIL_PASSWORD_PROVIDER")if(i._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const d=await I0(i,n,s,s==="getOobCode");return a(i,d)}else return a(i,n).catch(async d=>{if(d.code==="auth/missing-recaptcha-token"){console.log(`${s} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const f=await I0(i,n,s,s==="getOobCode");return a(i,f)}else return Promise.reject(d)});else if(l==="PHONE_PROVIDER")if(i._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){const d=await I0(i,n,s);return a(i,d).catch(async f=>{if(i._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&(f.code==="auth/missing-recaptcha-token"||f.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${s} flow.`);const E=await I0(i,n,s,!1,!0);return a(i,E)}return Promise.reject(f)})}else{const d=await I0(i,n,s,!1,!0);return a(i,d)}else return Promise.reject(l+" provider is not supported.")}async function Swe(i){const n=dl(i),s=await T$(n,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),a=new S$(s);n.tenantId==null?n._agentRecaptchaConfig=a:n._tenantRecaptchaConfigs[n.tenantId]=a,a.isAnyProviderEnabled()&&new L$(n).verify()}function Twe(i,n){const s=mv(i,"auth");if(s.isInitialized()){const l=s.getImmediate(),d=s.getOptions();if(Mg(d,n??{}))return l;ll(l,"already-initialized")}return s.initialize({options:n})}function wwe(i,n){const s=n?.persistence||[],a=(Array.isArray(s)?s:[s]).map(mh);n?.errorMap&&i._updateErrorMap(n.errorMap),i._initializeWithPersistence(a,n?.popupRedirectResolver)}function Cwe(i,n,s){const a=dl(i);Mt(/^https?:\/\//.test(n),a,"invalid-emulator-scheme");const l=!1,d=M$(n),{host:f,port:E}=Rwe(n),S=E===null?"":`:${E}`,T={url:`${d}//${f}${S}/`},C=Object.freeze({host:f,port:E,protocol:d.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!a._canInitEmulator){Mt(a.config.emulator&&a.emulatorConfig,a,"emulator-config-failed"),Mt(Mg(T,a.config.emulator)&&Mg(C,a.emulatorConfig),a,"emulator-config-failed");return}a.config.emulator=T,a.emulatorConfig=C,a.settings.appVerificationDisabledForTesting=!0,WO(f)?(uTe(`${d}//${f}${S}`),pTe("Auth",!0)):bwe()}function M$(i){const n=i.indexOf(":");return n<0?"":i.substr(0,n+1)}function Rwe(i){const n=M$(i),s=/(\/\/)?([^?#/]+)/.exec(i.substr(n.length));if(!s)return{host:"",port:null};const a=s[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(a);if(l){const d=l[1];return{host:d,port:P9(a.substr(d.length+1))}}else{const[d,f]=a.split(":");return{host:d,port:P9(f)}}}function P9(i){if(!i)return null;const n=Number(i);return isNaN(n)?null:n}function bwe(){function i(){const n=document.createElement("p"),s=n.style;n.innerText="Running in emulator mode. Do not use with production credentials.",s.position="fixed",s.width="100%",s.backgroundColor="#ffffff",s.border=".1em solid #000000",s.color="#b50000",s.bottom="0px",s.left="0px",s.margin="0px",s.zIndex="10000",s.textAlign="center",n.classList.add("firebase-emulator-warning"),document.body.appendChild(n)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",i):i())}class GO{constructor(n,s){this.providerId=n,this.signInMethod=s}toJSON(){return fh("not implemented")}_getIdTokenResponse(n){return fh("not implemented")}_linkToIdToken(n,s){return fh("not implemented")}_getReauthenticationResolver(n){return fh("not implemented")}}async function Iwe(i,n){return ul(i,"POST","/v1/accounts:signUp",n)}async function Awe(i,n){return Tf(i,"POST","/v1/accounts:signInWithPassword",Va(i,n))}async function Owe(i,n){return Tf(i,"POST","/v1/accounts:signInWithEmailLink",Va(i,n))}async function Nwe(i,n){return Tf(i,"POST","/v1/accounts:signInWithEmailLink",Va(i,n))}class Ew extends GO{constructor(n,s,a,l=null){super("password",a),this._email=n,this._password=s,this._tenantId=l}static _fromEmailAndPassword(n,s){return new Ew(n,s,"password")}static _fromEmailAndCode(n,s,a=null){return new Ew(n,s,"emailLink",a)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(n){const s=typeof n=="string"?JSON.parse(n):n;if(s?.email&&s?.password){if(s.signInMethod==="password")return this._fromEmailAndPassword(s.email,s.password);if(s.signInMethod==="emailLink")return this._fromEmailAndCode(s.email,s.password,s.tenantId)}return null}async _getIdTokenResponse(n){switch(this.signInMethod){case"password":const s={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Fy(n,s,"signInWithPassword",Awe,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return Owe(n,{email:this._email,oobCode:this._password});default:ll(n,"internal-error")}}async _linkToIdToken(n,s){switch(this.signInMethod){case"password":const a={idToken:s,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Fy(n,a,"signUpPassword",Iwe,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return Nwe(n,{idToken:s,email:this._email,oobCode:this._password});default:ll(n,"internal-error")}}_getReauthenticationResolver(n){return this._getIdTokenResponse(n)}}async function jy(i,n){return Tf(i,"POST","/v1/accounts:signInWithIdp",Va(i,n))}const Pwe="http://localhost";class Ug extends GO{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(n){const s=new Ug(n.providerId,n.signInMethod);return n.idToken||n.accessToken?(n.idToken&&(s.idToken=n.idToken),n.accessToken&&(s.accessToken=n.accessToken),n.nonce&&!n.pendingToken&&(s.nonce=n.nonce),n.pendingToken&&(s.pendingToken=n.pendingToken)):n.oauthToken&&n.oauthTokenSecret?(s.accessToken=n.oauthToken,s.secret=n.oauthTokenSecret):ll("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(n){const s=typeof n=="string"?JSON.parse(n):n,{providerId:a,signInMethod:l,...d}=s;if(!a||!l)return null;const f=new Ug(a,l);return f.idToken=d.idToken||void 0,f.accessToken=d.accessToken||void 0,f.secret=d.secret,f.nonce=d.nonce,f.pendingToken=d.pendingToken||null,f}_getIdTokenResponse(n){const s=this.buildRequest();return jy(n,s)}_linkToIdToken(n,s){const a=this.buildRequest();return a.idToken=s,jy(n,a)}_getReauthenticationResolver(n){const s=this.buildRequest();return s.autoCreate=!1,jy(n,s)}buildRequest(){const n={requestUri:Pwe,returnSecureToken:!0};if(this.pendingToken)n.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),n.postBody=fv(s)}return n}}async function k9(i,n){return ul(i,"POST","/v1/accounts:sendVerificationCode",Va(i,n))}async function kwe(i,n){return Tf(i,"POST","/v1/accounts:signInWithPhoneNumber",Va(i,n))}async function Dwe(i,n){const s=await Tf(i,"POST","/v1/accounts:signInWithPhoneNumber",Va(i,n));if(s.temporaryProof)throw U0(i,"account-exists-with-different-credential",s);return s}const xwe={USER_NOT_FOUND:"user-not-found"};async function Lwe(i,n){const s={...n,operation:"REAUTH"};return Tf(i,"POST","/v1/accounts:signInWithPhoneNumber",Va(i,s),xwe)}class q0 extends GO{constructor(n){super("phone","phone"),this.params=n}static _fromVerification(n,s){return new q0({verificationId:n,verificationCode:s})}static _fromTokenResponse(n,s){return new q0({phoneNumber:n,temporaryProof:s})}_getIdTokenResponse(n){return kwe(n,this._makeVerificationRequest())}_linkToIdToken(n,s){return Dwe(n,{idToken:s,...this._makeVerificationRequest()})}_getReauthenticationResolver(n){return Lwe(n,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:n,phoneNumber:s,verificationId:a,verificationCode:l}=this.params;return n&&s?{temporaryProof:n,phoneNumber:s}:{sessionInfo:a,code:l}}toJSON(){const n={providerId:this.providerId};return this.params.phoneNumber&&(n.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(n.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(n.verificationCode=this.params.verificationCode),this.params.verificationId&&(n.verificationId=this.params.verificationId),n}static fromJSON(n){typeof n=="string"&&(n=JSON.parse(n));const{verificationId:s,verificationCode:a,phoneNumber:l,temporaryProof:d}=n;return!a&&!s&&!l&&!d?null:new q0({verificationId:s,verificationCode:a,phoneNumber:l,temporaryProof:d})}}function Mwe(i){switch(i){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Uwe(i){const n=L0(M0(i)).link,s=n?L0(M0(n)).deep_link_id:null,a=L0(M0(i)).deep_link_id;return(a?L0(M0(a)).link:null)||a||s||n||i}class eU{constructor(n){const s=L0(M0(n)),a=s.apiKey??null,l=s.oobCode??null,d=Mwe(s.mode??null);Mt(a&&l&&d,"argument-error"),this.apiKey=a,this.operation=d,this.code=l,this.continueUrl=s.continueUrl??null,this.languageCode=s.lang??null,this.tenantId=s.tenantId??null}static parseLink(n){const s=Uwe(n);try{return new eU(s)}catch{return null}}}class gv{constructor(){this.providerId=gv.PROVIDER_ID}static credential(n,s){return Ew._fromEmailAndPassword(n,s)}static credentialWithLink(n,s){const a=eU.parseLink(s);return Mt(a,"argument-error"),Ew._fromEmailAndCode(n,a.code,a.tenantId)}}gv.PROVIDER_ID="password";gv.EMAIL_PASSWORD_SIGN_IN_METHOD="password";gv.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class tU{constructor(n){this.providerId=n,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(n){this.defaultLanguageCode=n}setCustomParameters(n){return this.customParameters=n,this}getCustomParameters(){return this.customParameters}}class zw extends tU{constructor(){super(...arguments),this.scopes=[]}addScope(n){return this.scopes.includes(n)||this.scopes.push(n),this}getScopes(){return[...this.scopes]}}class qp extends zw{constructor(){super("facebook.com")}static credential(n){return Ug._fromParams({providerId:qp.PROVIDER_ID,signInMethod:qp.FACEBOOK_SIGN_IN_METHOD,accessToken:n})}static credentialFromResult(n){return qp.credentialFromTaggedObject(n)}static credentialFromError(n){return qp.credentialFromTaggedObject(n.customData||{})}static credentialFromTaggedObject({_tokenResponse:n}){if(!n||!("oauthAccessToken"in n)||!n.oauthAccessToken)return null;try{return qp.credential(n.oauthAccessToken)}catch{return null}}}qp.FACEBOOK_SIGN_IN_METHOD="facebook.com";qp.PROVIDER_ID="facebook.com";class ph extends zw{constructor(){super("google.com"),this.addScope("profile")}static credential(n,s){return Ug._fromParams({providerId:ph.PROVIDER_ID,signInMethod:ph.GOOGLE_SIGN_IN_METHOD,idToken:n,accessToken:s})}static credentialFromResult(n){return ph.credentialFromTaggedObject(n)}static credentialFromError(n){return ph.credentialFromTaggedObject(n.customData||{})}static credentialFromTaggedObject({_tokenResponse:n}){if(!n)return null;const{oauthIdToken:s,oauthAccessToken:a}=n;if(!s&&!a)return null;try{return ph.credential(s,a)}catch{return null}}}ph.GOOGLE_SIGN_IN_METHOD="google.com";ph.PROVIDER_ID="google.com";class Xp extends zw{constructor(){super("github.com")}static credential(n){return Ug._fromParams({providerId:Xp.PROVIDER_ID,signInMethod:Xp.GITHUB_SIGN_IN_METHOD,accessToken:n})}static credentialFromResult(n){return Xp.credentialFromTaggedObject(n)}static credentialFromError(n){return Xp.credentialFromTaggedObject(n.customData||{})}static credentialFromTaggedObject({_tokenResponse:n}){if(!n||!("oauthAccessToken"in n)||!n.oauthAccessToken)return null;try{return Xp.credential(n.oauthAccessToken)}catch{return null}}}Xp.GITHUB_SIGN_IN_METHOD="github.com";Xp.PROVIDER_ID="github.com";class Jp extends zw{constructor(){super("twitter.com")}static credential(n,s){return Ug._fromParams({providerId:Jp.PROVIDER_ID,signInMethod:Jp.TWITTER_SIGN_IN_METHOD,oauthToken:n,oauthTokenSecret:s})}static credentialFromResult(n){return Jp.credentialFromTaggedObject(n)}static credentialFromError(n){return Jp.credentialFromTaggedObject(n.customData||{})}static credentialFromTaggedObject({_tokenResponse:n}){if(!n)return null;const{oauthAccessToken:s,oauthTokenSecret:a}=n;if(!s||!a)return null;try{return Jp.credential(s,a)}catch{return null}}}Jp.TWITTER_SIGN_IN_METHOD="twitter.com";Jp.PROVIDER_ID="twitter.com";async function U$(i,n){return Tf(i,"POST","/v1/accounts:signUp",Va(i,n))}class wh{constructor(n){this.user=n.user,this.providerId=n.providerId,this._tokenResponse=n._tokenResponse,this.operationType=n.operationType}static async _fromIdTokenResponse(n,s,a,l=!1){const d=await cu._fromIdTokenResponse(n,a,l),f=D9(a);return new wh({user:d,providerId:f,_tokenResponse:a,operationType:s})}static async _forOperation(n,s,a){await n._updateTokensIfNecessary(a,!0);const l=D9(a);return new wh({user:n,providerId:l,_tokenResponse:a,operationType:s})}}function D9(i){return i.providerId?i.providerId:"phoneNumber"in i?"phone":null}async function Vwe(i){if(Oa(i.app))return Promise.reject(lu(i));const n=dl(i);if(await n._initializationPromise,n.currentUser?.isAnonymous)return new wh({user:n.currentUser,providerId:null,operationType:"signIn"});const s=await U$(n,{returnSecureToken:!0}),a=await wh._fromIdTokenResponse(n,"signIn",s,!0);return await n._updateCurrentUser(a.user),a}class eO extends Nd{constructor(n,s,a,l){super(s.code,s.message),this.operationType=a,this.user=l,Object.setPrototypeOf(this,eO.prototype),this.customData={appName:n.name,tenantId:n.tenantId??void 0,_serverResponse:s.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(n,s,a,l){return new eO(n,s,a,l)}}function V$(i,n,s,a){return(n==="reauthenticate"?s._getReauthenticationResolver(i):s._getIdTokenResponse(i)).catch(d=>{throw d.code==="auth/multi-factor-auth-required"?eO._fromErrorAndOperation(i,d,n,a):d})}async function Fwe(i,n,s=!1){const a=await _w(i,n._linkToIdToken(i.auth,await i.getIdToken()),s);return wh._forOperation(i,"link",a)}async function jwe(i,n,s=!1){const{auth:a}=i;if(Oa(a.app))return Promise.reject(lu(a));const l="reauthenticate";try{const d=await _w(i,V$(a,l,n,i),s);Mt(d.idToken,a,"internal-error");const f=$2(d.idToken);Mt(f,a,"internal-error");const{sub:E}=f;return Mt(i.uid===E,a,"user-mismatch"),wh._forOperation(i,l,d)}catch(d){throw d?.code==="auth/user-not-found"&&ll(a,"user-mismatch"),d}}async function F$(i,n,s=!1){if(Oa(i.app))return Promise.reject(lu(i));const a="signIn",l=await V$(i,a,n),d=await wh._fromIdTokenResponse(i,a,l);return s||await i._updateCurrentUser(d.user),d}async function j$(i,n){return F$(dl(i),n)}async function B$(i){const n=dl(i);n._getPasswordPolicyInternal()&&await n._updatePasswordPolicy()}async function Bwe(i,n,s){if(Oa(i.app))return Promise.reject(lu(i));const a=dl(i),f=await Fy(a,{returnSecureToken:!0,email:n,password:s,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",U$,"EMAIL_PASSWORD_PROVIDER").catch(S=>{throw S.code==="auth/password-does-not-meet-requirements"&&B$(i),S}),E=await wh._fromIdTokenResponse(a,"signIn",f);return await a._updateCurrentUser(E.user),E}function Wwe(i,n,s){return Oa(i.app)?Promise.reject(lu(i)):j$(Sc(i),gv.credential(n,s)).catch(async a=>{throw a.code==="auth/password-does-not-meet-requirements"&&B$(i),a})}function Gwe(i,n,s,a){return Sc(i).onIdTokenChanged(n,s,a)}function Hwe(i,n,s){return Sc(i).beforeAuthStateChanged(n,s)}function zwe(i,n,s,a){return Sc(i).onAuthStateChanged(n,s,a)}function Kwe(i){return Sc(i).signOut()}function x9(i,n){return ul(i,"POST","/v2/accounts/mfaEnrollment:start",Va(i,n))}const tO="__sak";class W${constructor(n,s){this.storageRetriever=n,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(tO,"1"),this.storage.removeItem(tO),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(n,s){return this.storage.setItem(n,JSON.stringify(s)),Promise.resolve()}_get(n){const s=this.storage.getItem(n);return Promise.resolve(s?JSON.parse(s):null)}_remove(n){return this.storage.removeItem(n),Promise.resolve()}get storage(){return this.storageRetriever()}}const Ywe=1e3,qwe=10;class G$ extends W${constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(n,s)=>this.onStorageEvent(n,s),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=k$(),this._shouldAllowMigration=!0}forAllChangedKeys(n){for(const s of Object.keys(this.listeners)){const a=this.storage.getItem(s),l=this.localCache[s];a!==l&&n(s,l,a)}}onStorageEvent(n,s=!1){if(!n.key){this.forAllChangedKeys((f,E,S)=>{this.notifyListeners(f,S)});return}const a=n.key;s?this.detachListener():this.stopPolling();const l=()=>{const f=this.storage.getItem(a);!s&&this.localCache[a]===f||this.notifyListeners(a,f)},d=this.storage.getItem(a);rwe()&&d!==n.newValue&&n.newValue!==n.oldValue?setTimeout(l,qwe):l()}notifyListeners(n,s){this.localCache[n]=s;const a=this.listeners[n];if(a)for(const l of Array.from(a))l(s&&JSON.parse(s))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((n,s,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:n,oldValue:s,newValue:a}),!0)})},Ywe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(n,s){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[n]||(this.listeners[n]=new Set,this.localCache[n]=this.storage.getItem(n)),this.listeners[n].add(s)}_removeListener(n,s){this.listeners[n]&&(this.listeners[n].delete(s),this.listeners[n].size===0&&delete this.listeners[n]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(n,s){await super._set(n,s),this.localCache[n]=JSON.stringify(s)}async _get(n){const s=await super._get(n);return this.localCache[n]=JSON.stringify(s),s}async _remove(n){await super._remove(n),delete this.localCache[n]}}G$.type="LOCAL";const Xwe=G$;class H$ extends W${constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(n,s){}_removeListener(n,s){}}H$.type="SESSION";const z$=H$;function Jwe(i){return Promise.all(i.map(async n=>{try{return{fulfilled:!0,value:await n}}catch(s){return{fulfilled:!1,reason:s}}}))}class HO{constructor(n){this.eventTarget=n,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(n){const s=this.receivers.find(l=>l.isListeningto(n));if(s)return s;const a=new HO(n);return this.receivers.push(a),a}isListeningto(n){return this.eventTarget===n}async handleEvent(n){const s=n,{eventId:a,eventType:l,data:d}=s.data,f=this.handlersMap[l];if(!f?.size)return;s.ports[0].postMessage({status:"ack",eventId:a,eventType:l});const E=Array.from(f).map(async T=>T(s.origin,d)),S=await Jwe(E);s.ports[0].postMessage({status:"done",eventId:a,eventType:l,response:S})}_subscribe(n,s){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[n]||(this.handlersMap[n]=new Set),this.handlersMap[n].add(s)}_unsubscribe(n,s){this.handlersMap[n]&&s&&this.handlersMap[n].delete(s),(!s||this.handlersMap[n].size===0)&&delete this.handlersMap[n],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}HO.receivers=[];function nU(i="",n=10){let s="";for(let a=0;a<n;a++)s+=Math.floor(Math.random()*10);return i+s}class $we{constructor(n){this.target=n,this.handlers=new Set}removeMessageHandler(n){n.messageChannel&&(n.messageChannel.port1.removeEventListener("message",n.onMessage),n.messageChannel.port1.close()),this.handlers.delete(n)}async _send(n,s,a=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let d,f;return new Promise((E,S)=>{const T=nU("",20);l.port1.start();const C=setTimeout(()=>{S(new Error("unsupported_event"))},a);f={messageChannel:l,onMessage(I){const N=I;if(N.data.eventId===T)switch(N.data.status){case"ack":clearTimeout(C),d=setTimeout(()=>{S(new Error("timeout"))},3e3);break;case"done":clearTimeout(d),E(N.data.response);break;default:clearTimeout(C),clearTimeout(d),S(new Error("invalid_response"));break}}},this.handlers.add(f),l.port1.addEventListener("message",f.onMessage),this.target.postMessage({eventType:n,eventId:T,data:s},[l.port2])}).finally(()=>{f&&this.removeMessageHandler(f)})}}function Cs(){return window}function Qwe(i){Cs().location.href=i}function rU(){return typeof Cs().WorkerGlobalScope<"u"&&typeof Cs().importScripts=="function"}async function Zwe(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function eCe(){return navigator?.serviceWorker?.controller||null}function tCe(){return rU()?self:null}const K$="firebaseLocalStorageDb",nCe=1,nO="firebaseLocalStorage",Y$="fbase_key";class Kw{constructor(n){this.request=n}toPromise(){return new Promise((n,s)=>{this.request.addEventListener("success",()=>{n(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function zO(i,n){return i.transaction([nO],n?"readwrite":"readonly").objectStore(nO)}function rCe(){const i=indexedDB.deleteDatabase(K$);return new Kw(i).toPromise()}function gM(){const i=indexedDB.open(K$,nCe);return new Promise((n,s)=>{i.addEventListener("error",()=>{s(i.error)}),i.addEventListener("upgradeneeded",()=>{const a=i.result;try{a.createObjectStore(nO,{keyPath:Y$})}catch(l){s(l)}}),i.addEventListener("success",async()=>{const a=i.result;a.objectStoreNames.contains(nO)?n(a):(a.close(),await rCe(),n(await gM()))})})}async function L9(i,n,s){const a=zO(i,!0).put({[Y$]:n,value:s});return new Kw(a).toPromise()}async function iCe(i,n){const s=zO(i,!1).get(n),a=await new Kw(s).toPromise();return a===void 0?null:a.value}function M9(i,n){const s=zO(i,!0).delete(n);return new Kw(s).toPromise()}const sCe=800,oCe=3;class q${constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await gM(),this.db)}async _withRetries(n){let s=0;for(;;)try{const a=await this._openDb();return await n(a)}catch(a){if(s++>oCe)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return rU()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=HO._getInstance(tCe()),this.receiver._subscribe("keyChanged",async(n,s)=>({keyProcessed:(await this._poll()).includes(s.key)})),this.receiver._subscribe("ping",async(n,s)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await Zwe(),!this.activeServiceWorker)return;this.sender=new $we(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&n[0]?.fulfilled&&n[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(n){if(!(!this.sender||!this.activeServiceWorker||eCe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:n},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const n=await gM();return await L9(n,tO,"1"),await M9(n,tO),!0}catch{}return!1}async _withPendingWrite(n){this.pendingWrites++;try{await n()}finally{this.pendingWrites--}}async _set(n,s){return this._withPendingWrite(async()=>(await this._withRetries(a=>L9(a,n,s)),this.localCache[n]=s,this.notifyServiceWorker(n)))}async _get(n){const s=await this._withRetries(a=>iCe(a,n));return this.localCache[n]=s,s}async _remove(n){return this._withPendingWrite(async()=>(await this._withRetries(s=>M9(s,n)),delete this.localCache[n],this.notifyServiceWorker(n)))}async _poll(){const n=await this._withRetries(l=>{const d=zO(l,!1).getAll();return new Kw(d).toPromise()});if(!n)return[];if(this.pendingWrites!==0)return[];const s=[],a=new Set;if(n.length!==0)for(const{fbase_key:l,value:d}of n)a.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(d)&&(this.notifyListeners(l,d),s.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!a.has(l)&&(this.notifyListeners(l,null),s.push(l));return s}notifyListeners(n,s){this.localCache[n]=s;const a=this.listeners[n];if(a)for(const l of Array.from(a))l(s)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),sCe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(n,s){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[n]||(this.listeners[n]=new Set,this._get(n)),this.listeners[n].add(s)}_removeListener(n,s){this.listeners[n]&&(this.listeners[n].delete(s),this.listeners[n].size===0&&delete this.listeners[n]),Object.keys(this.listeners).length===0&&this.stopPolling()}}q$.type="LOCAL";const aCe=q$;function U9(i,n){return ul(i,"POST","/v2/accounts/mfaSignIn:start",Va(i,n))}const Jx=x$("rcb"),cCe=new Gw(3e4,6e4);class lCe{constructor(){this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!Cs().grecaptcha?.render}load(n,s=""){return Mt(uCe(s),n,"argument-error"),this.shouldResolveImmediately(s)&&C9(Cs().grecaptcha)?Promise.resolve(Cs().grecaptcha):new Promise((a,l)=>{const d=Cs().setTimeout(()=>{l(Pa(n,"network-request-failed"))},cCe.get());Cs()[Jx]=()=>{Cs().clearTimeout(d),delete Cs()[Jx];const E=Cs().grecaptcha;if(!E||!C9(E)){l(Pa(n,"internal-error"));return}const S=E.render;E.render=(T,C)=>{const I=S(T,C);return this.counter++,I},this.hostLanguage=s,a(E)};const f=`${uwe()}?${fv({onload:Jx,render:"explicit",hl:s})}`;Z2(f).catch(()=>{clearTimeout(d),l(Pa(n,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(n){return!!Cs().grecaptcha?.render&&(n===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function uCe(i){return i.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(i)}class dCe{async load(n){return new mwe(n)}clearedOneInstance(){}}const X0="recaptcha",hCe={theme:"light",type:"image"};class pCe{constructor(n,s,a={...hCe}){this.parameters=a,this.type=X0,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=dl(n),this.isInvisible=this.parameters.size==="invisible",Mt(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const l=typeof s=="string"?document.getElementById(s):s;Mt(l,this.auth,"argument-error"),this.container=l,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new dCe:new lCe,this.validateStartingState()}async verify(){this.assertNotDestroyed();const n=await this.render(),s=this.getAssertedRecaptcha(),a=s.getResponse(n);return a||new Promise(l=>{const d=f=>{f&&(this.tokenChangeListeners.delete(d),l(f))};this.tokenChangeListeners.add(d),this.isInvisible&&s.execute(n)})}render(){try{this.assertNotDestroyed()}catch(n){return Promise.reject(n)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(n=>{throw this.renderPromise=null,n}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(n=>{this.container.removeChild(n)})}validateStartingState(){Mt(!this.parameters.sitekey,this.auth,"argument-error"),Mt(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),Mt(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(n){return s=>{if(this.tokenChangeListeners.forEach(a=>a(s)),typeof n=="function")n(s);else if(typeof n=="string"){const a=Cs()[n];typeof a=="function"&&a(s)}}}assertNotDestroyed(){Mt(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let n=this.container;if(!this.isInvisible){const s=document.createElement("div");n.appendChild(s),n=s}this.widgetId=this.getAssertedRecaptcha().render(n,this.parameters)}return this.widgetId}async init(){Mt(_$()&&!rU(),this.auth,"internal-error"),await fCe(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const n=await Y0e(this.auth);Mt(n,this.auth,"internal-error"),this.parameters.sitekey=n}getAssertedRecaptcha(){return Mt(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function fCe(){let i=null;return new Promise(n=>{if(document.readyState==="complete"){n();return}i=()=>n(),window.addEventListener("load",i)}).catch(n=>{throw i&&window.removeEventListener("load",i),n})}class mCe{constructor(n,s){this.verificationId=n,this.onConfirmation=s}confirm(n){const s=q0._fromVerification(this.verificationId,n);return this.onConfirmation(s)}}async function gCe(i,n,s){if(Oa(i.app))return Promise.reject(lu(i));const a=dl(i),l=await _Ce(a,n,Sc(s));return new mCe(l,d=>j$(a,d))}async function _Ce(i,n,s){if(!i._getRecaptchaConfig())try{await Swe(i)}catch{console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let a;if(typeof n=="string"?a={phoneNumber:n}:a=n,"session"in a){const l=a.session;if("phoneNumber"in a){Mt(l.type==="enroll",i,"internal-error");const d={idToken:l.credential,phoneEnrollmentInfo:{phoneNumber:a.phoneNumber,clientType:"CLIENT_TYPE_WEB"}};return(await Fy(i,d,"mfaSmsEnrollment",async(T,C)=>{if(C.phoneEnrollmentInfo.captchaResponse===Y0){Mt(s?.type===X0,T,"argument-error");const I=await $x(T,C,s);return x9(T,I)}return x9(T,C)},"PHONE_PROVIDER").catch(T=>Promise.reject(T))).phoneSessionInfo.sessionInfo}else{Mt(l.type==="signin",i,"internal-error");const d=a.multiFactorHint?.uid||a.multiFactorUid;Mt(d,i,"missing-multi-factor-info");const f={mfaPendingCredential:l.credential,mfaEnrollmentId:d,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}};return(await Fy(i,f,"mfaSmsSignIn",async(C,I)=>{if(I.phoneSignInInfo.captchaResponse===Y0){Mt(s?.type===X0,C,"argument-error");const N=await $x(C,I,s);return U9(C,N)}return U9(C,I)},"PHONE_PROVIDER").catch(C=>Promise.reject(C))).phoneResponseInfo.sessionInfo}}else{const l={phoneNumber:a.phoneNumber,clientType:"CLIENT_TYPE_WEB"};return(await Fy(i,l,"sendVerificationCode",async(S,T)=>{if(T.captchaResponse===Y0){Mt(s?.type===X0,S,"argument-error");const C=await $x(S,T,s);return k9(S,C)}return k9(S,T)},"PHONE_PROVIDER").catch(S=>Promise.reject(S))).sessionInfo}}finally{s?._reset()}}async function $x(i,n,s){Mt(s.type===X0,i,"argument-error");const a=await s.verify();Mt(typeof a=="string",i,"argument-error");const l={...n};if("phoneEnrollmentInfo"in l){const d=l.phoneEnrollmentInfo.phoneNumber,f=l.phoneEnrollmentInfo.captchaResponse,E=l.phoneEnrollmentInfo.clientType,S=l.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:d,recaptchaToken:a,captchaResponse:f,clientType:E,recaptchaVersion:S}}),l}else if("phoneSignInInfo"in l){const d=l.phoneSignInInfo.captchaResponse,f=l.phoneSignInInfo.clientType,E=l.phoneSignInInfo.recaptchaVersion;return Object.assign(l,{phoneSignInInfo:{recaptchaToken:a,captchaResponse:d,clientType:f,recaptchaVersion:E}}),l}else return Object.assign(l,{recaptchaToken:a}),l}function X$(i,n){return n?mh(n):(Mt(i._popupRedirectResolver,i,"argument-error"),i._popupRedirectResolver)}class iU extends GO{constructor(n){super("custom","custom"),this.params=n}_getIdTokenResponse(n){return jy(n,this._buildIdpRequest())}_linkToIdToken(n,s){return jy(n,this._buildIdpRequest(s))}_getReauthenticationResolver(n){return jy(n,this._buildIdpRequest())}_buildIdpRequest(n){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return n&&(s.idToken=n),s}}function ECe(i){return F$(i.auth,new iU(i),i.bypassAuthState)}function yCe(i){const{auth:n,user:s}=i;return Mt(s,n,"internal-error"),jwe(s,new iU(i),i.bypassAuthState)}async function vCe(i){const{auth:n,user:s}=i;return Mt(s,n,"internal-error"),Fwe(s,new iU(i),i.bypassAuthState)}class J${constructor(n,s,a,l,d=!1){this.auth=n,this.resolver=a,this.user=l,this.bypassAuthState=d,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){return new Promise(async(n,s)=>{this.pendingPromise={resolve:n,reject:s};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(n){const{urlResponse:s,sessionId:a,postBody:l,tenantId:d,error:f,type:E}=n;if(f){this.reject(f);return}const S={auth:this.auth,requestUri:s,sessionId:a,tenantId:d||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(E)(S))}catch(T){this.reject(T)}}onError(n){this.reject(n)}getIdpTask(n){switch(n){case"signInViaPopup":case"signInViaRedirect":return ECe;case"linkViaPopup":case"linkViaRedirect":return vCe;case"reauthViaPopup":case"reauthViaRedirect":return yCe;default:ll(this.auth,"internal-error")}}resolve(n){Th(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(n),this.unregisterAndCleanUp()}reject(n){Th(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(n),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const SCe=new Gw(2e3,1e4);async function TCe(i,n,s){if(Oa(i.app))return Promise.reject(Pa(i,"operation-not-supported-in-this-environment"));const a=dl(i);F0e(i,n,tU);const l=X$(a,s);return new Tg(a,"signInViaPopup",n,l).executeNotNull()}class Tg extends J${constructor(n,s,a,l,d){super(n,s,l,d),this.provider=a,this.authWindow=null,this.pollId=null,Tg.currentPopupAction&&Tg.currentPopupAction.cancel(),Tg.currentPopupAction=this}async executeNotNull(){const n=await this.execute();return Mt(n,this.auth,"internal-error"),n}async onExecution(){Th(this.filter.length===1,"Popup operations only handle one event");const n=nU();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],n),this.authWindow.associatedEvent=n,this.resolver._originValidation(this.auth).catch(s=>{this.reject(s)}),this.resolver._isIframeWebStorageSupported(this.auth,s=>{s||this.reject(Pa(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Pa(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Tg.currentPopupAction=null}pollUserCancellation(){const n=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Pa(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(n,SCe.get())};n()}}Tg.currentPopupAction=null;const wCe="pendingRedirect",CA=new Map;class CCe extends J${constructor(n,s,a=!1){super(n,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,a),this.eventId=null}async execute(){let n=CA.get(this.auth._key());if(!n){try{const a=await RCe(this.resolver,this.auth)?await super.execute():null;n=()=>Promise.resolve(a)}catch(s){n=()=>Promise.reject(s)}CA.set(this.auth._key(),n)}return this.bypassAuthState||CA.set(this.auth._key(),()=>Promise.resolve(null)),n()}async onAuthEvent(n){if(n.type==="signInViaRedirect")return super.onAuthEvent(n);if(n.type==="unknown"){this.resolve(null);return}if(n.eventId){const s=await this.auth._redirectUserForId(n.eventId);if(s)return this.user=s,super.onAuthEvent(n);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function RCe(i,n){const s=ACe(n),a=ICe(i);if(!await a._isAvailable())return!1;const l=await a._get(s)==="true";return await a._remove(s),l}function bCe(i,n){CA.set(i._key(),n)}function ICe(i){return mh(i._redirectPersistence)}function ACe(i){return wA(wCe,i.config.apiKey,i.name)}async function OCe(i,n,s=!1){if(Oa(i.app))return Promise.reject(lu(i));const a=dl(i),l=X$(a,n),f=await new CCe(a,l,s).execute();return f&&!s&&(delete f.user._redirectEventId,await a._persistUserIfCurrent(f.user),await a._setRedirectUser(null,n)),f}const NCe=600*1e3;class PCe{constructor(n){this.auth=n,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(n){this.consumers.add(n),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,n)&&(this.sendToConsumer(this.queuedRedirectEvent,n),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(n){this.consumers.delete(n)}onEvent(n){if(this.hasEventBeenHandled(n))return!1;let s=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(n,a)&&(s=!0,this.sendToConsumer(n,a),this.saveEventToCache(n))}),this.hasHandledPotentialRedirect||!kCe(n)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=n,s=!0)),s}sendToConsumer(n,s){if(n.error&&!$$(n)){const a=n.error.code?.split("auth/")[1]||"internal-error";s.onError(Pa(this.auth,a))}else s.onAuthEvent(n)}isEventForConsumer(n,s){const a=s.eventId===null||!!n.eventId&&n.eventId===s.eventId;return s.filter.includes(n.type)&&a}hasEventBeenHandled(n){return Date.now()-this.lastProcessedEventTime>=NCe&&this.cachedEventUids.clear(),this.cachedEventUids.has(V9(n))}saveEventToCache(n){this.cachedEventUids.add(V9(n)),this.lastProcessedEventTime=Date.now()}}function V9(i){return[i.type,i.eventId,i.sessionId,i.tenantId].filter(n=>n).join("-")}function $$({type:i,error:n}){return i==="unknown"&&n?.code==="auth/no-auth-event"}function kCe(i){switch(i.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return $$(i);default:return!1}}async function DCe(i,n={}){return ul(i,"GET","/v1/projects",n)}const xCe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,LCe=/^https?/;async function MCe(i){if(i.config.emulator)return;const{authorizedDomains:n}=await DCe(i);for(const s of n)try{if(UCe(s))return}catch{}ll(i,"unauthorized-domain")}function UCe(i){const n=fM(),{protocol:s,hostname:a}=new URL(n);if(i.startsWith("chrome-extension://")){const f=new URL(i);return f.hostname===""&&a===""?s==="chrome-extension:"&&i.replace("chrome-extension://","")===n.replace("chrome-extension://",""):s==="chrome-extension:"&&f.hostname===a}if(!LCe.test(s))return!1;if(xCe.test(i))return a===i;const l=i.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(a)}const VCe=new Gw(3e4,6e4);function F9(){const i=Cs().___jsl;if(i?.H){for(const n of Object.keys(i.H))if(i.H[n].r=i.H[n].r||[],i.H[n].L=i.H[n].L||[],i.H[n].r=[...i.H[n].L],i.CP)for(let s=0;s<i.CP.length;s++)i.CP[s]=null}}function FCe(i){return new Promise((n,s)=>{function a(){F9(),gapi.load("gapi.iframes",{callback:()=>{n(gapi.iframes.getContext())},ontimeout:()=>{F9(),s(Pa(i,"network-request-failed"))},timeout:VCe.get()})}if(Cs().gapi?.iframes?.Iframe)n(gapi.iframes.getContext());else if(Cs().gapi?.load)a();else{const l=x$("iframefcb");return Cs()[l]=()=>{gapi.load?a():s(Pa(i,"network-request-failed"))},Z2(`${hwe()}?onload=${l}`).catch(d=>s(d))}}).catch(n=>{throw RA=null,n})}let RA=null;function jCe(i){return RA=RA||FCe(i),RA}const BCe=new Gw(5e3,15e3),WCe="__/auth/iframe",GCe="emulator/auth/iframe",HCe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},zCe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function KCe(i){const n=i.config;Mt(n.authDomain,i,"auth-domain-config-required");const s=n.emulator?J2(n,GCe):`https://${i.config.authDomain}/${WCe}`,a={apiKey:n.apiKey,appName:i.name,v:Ww},l=zCe.get(i.config.apiHost);l&&(a.eid=l);const d=i._getFrameworks();return d.length&&(a.fw=d.join(",")),`${s}?${fv(a).slice(1)}`}async function YCe(i){const n=await jCe(i),s=Cs().gapi;return Mt(s,i,"internal-error"),n.open({where:document.body,url:KCe(i),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:HCe,dontclear:!0},a=>new Promise(async(l,d)=>{await a.restyle({setHideOnLeave:!1});const f=Pa(i,"network-request-failed"),E=Cs().setTimeout(()=>{d(f)},BCe.get());function S(){Cs().clearTimeout(E),l(a)}a.ping(S).then(S,()=>{d(f)})}))}const qCe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},XCe=500,JCe=600,$Ce="_blank",QCe="http://localhost";class j9{constructor(n){this.window=n,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function ZCe(i,n,s,a=XCe,l=JCe){const d=Math.max((window.screen.availHeight-l)/2,0).toString(),f=Math.max((window.screen.availWidth-a)/2,0).toString();let E="";const S={...qCe,width:a.toString(),height:l.toString(),top:d,left:f},T=ra().toLowerCase();s&&(E=I$(T)?$Ce:s),R$(T)&&(n=n||QCe,S.scrollbars="yes");const C=Object.entries(S).reduce((N,[P,W])=>`${N}${P}=${W},`,"");if(nwe(T)&&E!=="_self")return eRe(n||"",E),new j9(null);const I=window.open(n||"",E,C);Mt(I,i,"popup-blocked");try{I.focus()}catch{}return new j9(I)}function eRe(i,n){const s=document.createElement("a");s.href=i,s.target=n;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(a)}const tRe="__/auth/handler",nRe="emulator/auth/handler",rRe=encodeURIComponent("fac");async function B9(i,n,s,a,l,d){Mt(i.config.authDomain,i,"auth-domain-config-required"),Mt(i.config.apiKey,i,"invalid-api-key");const f={apiKey:i.config.apiKey,appName:i.name,authType:s,redirectUrl:a,v:Ww,eventId:l};if(n instanceof tU){n.setDefaultLanguage(i.languageCode),f.providerId=n.providerId||"",TTe(n.getCustomParameters())||(f.customParameters=JSON.stringify(n.getCustomParameters()));for(const[C,I]of Object.entries({}))f[C]=I}if(n instanceof zw){const C=n.getScopes().filter(I=>I!=="");C.length>0&&(f.scopes=C.join(","))}i.tenantId&&(f.tid=i.tenantId);const E=f;for(const C of Object.keys(E))E[C]===void 0&&delete E[C];const S=await i._getAppCheckToken(),T=S?`#${rRe}=${encodeURIComponent(S)}`:"";return`${iRe(i)}?${fv(E).slice(1)}${T}`}function iRe({config:i}){return i.emulator?J2(i,nRe):`https://${i.authDomain}/${tRe}`}const Qx="webStorageSupport";class sRe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=z$,this._completeRedirectFn=OCe,this._overrideRedirectResult=bCe}async _openPopup(n,s,a,l){Th(this.eventManagers[n._key()]?.manager,"_initialize() not called before _openPopup()");const d=await B9(n,s,a,fM(),l);return ZCe(n,d,nU())}async _openRedirect(n,s,a,l){await this._originValidation(n);const d=await B9(n,s,a,fM(),l);return Qwe(d),new Promise(()=>{})}_initialize(n){const s=n._key();if(this.eventManagers[s]){const{manager:l,promise:d}=this.eventManagers[s];return l?Promise.resolve(l):(Th(d,"If manager is not set, promise should be"),d)}const a=this.initAndGetManager(n);return this.eventManagers[s]={promise:a},a.catch(()=>{delete this.eventManagers[s]}),a}async initAndGetManager(n){const s=await YCe(n),a=new PCe(n);return s.register("authEvent",l=>(Mt(l?.authEvent,n,"invalid-auth-event"),{status:a.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[n._key()]={manager:a},this.iframes[n._key()]=s,a}_isIframeWebStorageSupported(n,s){this.iframes[n._key()].send(Qx,{type:Qx},l=>{const d=l?.[0]?.[Qx];d!==void 0&&s(!!d),ll(n,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(n){const s=n._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=MCe(n)),this.originValidationPromises[s]}get _shouldInitProactively(){return k$()||b$()||Q2()}}const oRe=sRe;var W9="@firebase/auth",G9="1.12.0";class aRe{constructor(n){this.auth=n,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(n){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(n)}:null}addAuthTokenListener(n){if(this.assertAuthConfigured(),this.internalListeners.has(n))return;const s=this.auth.onIdTokenChanged(a=>{n(a?.stsTokenManager.accessToken||null)});this.internalListeners.set(n,s),this.updateProactiveRefresh()}removeAuthTokenListener(n){this.assertAuthConfigured();const s=this.internalListeners.get(n);s&&(this.internalListeners.delete(n),s(),this.updateProactiveRefresh())}assertAuthConfigured(){Mt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function cRe(i){switch(i){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function lRe(i){Sh(new Rd("auth",(n,{options:s})=>{const a=n.getProvider("app").getImmediate(),l=n.getProvider("heartbeat"),d=n.getProvider("app-check-internal"),{apiKey:f,authDomain:E}=a.options;Mt(f&&!f.includes(":"),"invalid-api-key",{appName:a.name});const S={apiKey:f,authDomain:E,clientPlatform:i,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:D$(i)},T=new cwe(a,l,d,S);return wwe(T,s),T},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,s,a)=>{n.getProvider("auth-internal").initialize()})),Sh(new Rd("auth-internal",n=>{const s=dl(n.getProvider("auth").getImmediate());return(a=>new aRe(a))(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),vd(W9,G9,cRe(i)),vd(W9,G9,"esm2020")}const uRe=300,dRe=i$("authIdTokenMaxAge")||uRe;let H9=null;const hRe=i=>async n=>{const s=n&&await n.getIdTokenResult(),a=s&&(new Date().getTime()-Date.parse(s.issuedAtTime))/1e3;if(a&&a>dRe)return;const l=s?.token;H9!==l&&(H9=l,await fetch(i,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function pRe(i=h$()){const n=mv(i,"auth");if(n.isInitialized())return n.getImmediate();const s=Twe(i,{popupRedirectResolver:oRe,persistence:[aCe,Xwe,z$]}),a=i$("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const d=new URL(a,location.origin);if(location.origin===d.origin){const f=hRe(d.toString());Hwe(s,f,()=>f(s.currentUser)),Gwe(s,E=>f(E))}}const l=cTe("auth");return l&&Cwe(s,`http://${l}`),s}function fRe(){return document.getElementsByTagName("head")?.[0]??document}lwe({loadJS(i){return new Promise((n,s)=>{const a=document.createElement("script");a.setAttribute("src",i),a.onload=n,a.onerror=l=>{const d=Pa("internal-error");d.customData=l,s(d)},a.type="text/javascript",a.charset="UTF-8",fRe().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});lRe("Browser");var mRe="firebase",gRe="12.7.0";vd(mRe,gRe,"app");const Q$="@firebase/installations",sU="0.6.19";const Z$=1e4,eQ=`w:${sU}`,tQ="FIS_v2",_Re="https://firebaseinstallations.googleapis.com/v1",ERe=3600*1e3,yRe="installations",vRe="Installations";const SRe={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Vg=new Hg(yRe,vRe,SRe);function nQ(i){return i instanceof Nd&&i.code.includes("request-failed")}function rQ({projectId:i}){return`${_Re}/projects/${i}/installations`}function iQ(i){return{token:i.token,requestStatus:2,expiresIn:wRe(i.expiresIn),creationTime:Date.now()}}async function sQ(i,n){const a=(await n.json()).error;return Vg.create("request-failed",{requestName:i,serverCode:a.code,serverMessage:a.message,serverStatus:a.status})}function oQ({apiKey:i}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":i})}function TRe(i,{refreshToken:n}){const s=oQ(i);return s.append("Authorization",CRe(n)),s}async function aQ(i){const n=await i();return n.status>=500&&n.status<600?i():n}function wRe(i){return Number(i.replace("s","000"))}function CRe(i){return`${tQ} ${i}`}async function RRe({appConfig:i,heartbeatServiceProvider:n},{fid:s}){const a=rQ(i),l=oQ(i),d=n.getImmediate({optional:!0});if(d){const T=await d.getHeartbeatsHeader();T&&l.append("x-firebase-client",T)}const f={fid:s,authVersion:tQ,appId:i.appId,sdkVersion:eQ},E={method:"POST",headers:l,body:JSON.stringify(f)},S=await aQ(()=>fetch(a,E));if(S.ok){const T=await S.json();return{fid:T.fid||s,registrationStatus:2,refreshToken:T.refreshToken,authToken:iQ(T.authToken)}}else throw await sQ("Create Installation",S)}function cQ(i){return new Promise(n=>{setTimeout(n,i)})}function bRe(i){return btoa(String.fromCharCode(...i)).replace(/\+/g,"-").replace(/\//g,"_")}const IRe=/^[cdef][\w-]{21}$/,_M="";function ARe(){try{const i=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(i),i[0]=112+i[0]%16;const s=ORe(i);return IRe.test(s)?s:_M}catch{return _M}}function ORe(i){return bRe(i).substr(0,22)}function KO(i){return`${i.appName}!${i.appId}`}const lQ=new Map;function uQ(i,n){const s=KO(i);dQ(s,n),NRe(s,n)}function dQ(i,n){const s=lQ.get(i);if(s)for(const a of s)a(n)}function NRe(i,n){const s=PRe();s&&s.postMessage({key:i,fid:n}),kRe()}let wg=null;function PRe(){return!wg&&"BroadcastChannel"in self&&(wg=new BroadcastChannel("[Firebase] FID Change"),wg.onmessage=i=>{dQ(i.data.key,i.data.fid)}),wg}function kRe(){lQ.size===0&&wg&&(wg.close(),wg=null)}const DRe="firebase-installations-database",xRe=1,Fg="firebase-installations-store";let Zx=null;function oU(){return Zx||(Zx=u$(DRe,xRe,{upgrade:(i,n)=>{n===0&&i.createObjectStore(Fg)}})),Zx}async function rO(i,n){const s=KO(i),l=(await oU()).transaction(Fg,"readwrite"),d=l.objectStore(Fg),f=await d.get(s);return await d.put(n,s),await l.done,(!f||f.fid!==n.fid)&&uQ(i,n.fid),n}async function hQ(i){const n=KO(i),a=(await oU()).transaction(Fg,"readwrite");await a.objectStore(Fg).delete(n),await a.done}async function YO(i,n){const s=KO(i),l=(await oU()).transaction(Fg,"readwrite"),d=l.objectStore(Fg),f=await d.get(s),E=n(f);return E===void 0?await d.delete(s):await d.put(E,s),await l.done,E&&(!f||f.fid!==E.fid)&&uQ(i,E.fid),E}async function aU(i){let n;const s=await YO(i.appConfig,a=>{const l=LRe(a),d=MRe(i,l);return n=d.registrationPromise,d.installationEntry});return s.fid===_M?{installationEntry:await n}:{installationEntry:s,registrationPromise:n}}function LRe(i){const n=i||{fid:ARe(),registrationStatus:0};return pQ(n)}function MRe(i,n){if(n.registrationStatus===0){if(!navigator.onLine){const l=Promise.reject(Vg.create("app-offline"));return{installationEntry:n,registrationPromise:l}}const s={fid:n.fid,registrationStatus:1,registrationTime:Date.now()},a=URe(i,s);return{installationEntry:s,registrationPromise:a}}else return n.registrationStatus===1?{installationEntry:n,registrationPromise:VRe(i)}:{installationEntry:n}}async function URe(i,n){try{const s=await RRe(i,n);return rO(i.appConfig,s)}catch(s){throw nQ(s)&&s.customData.serverCode===409?await hQ(i.appConfig):await rO(i.appConfig,{fid:n.fid,registrationStatus:0}),s}}async function VRe(i){let n=await z9(i.appConfig);for(;n.registrationStatus===1;)await cQ(100),n=await z9(i.appConfig);if(n.registrationStatus===0){const{installationEntry:s,registrationPromise:a}=await aU(i);return a||s}return n}function z9(i){return YO(i,n=>{if(!n)throw Vg.create("installation-not-found");return pQ(n)})}function pQ(i){return FRe(i)?{fid:i.fid,registrationStatus:0}:i}function FRe(i){return i.registrationStatus===1&&i.registrationTime+Z$<Date.now()}async function jRe({appConfig:i,heartbeatServiceProvider:n},s){const a=BRe(i,s),l=TRe(i,s),d=n.getImmediate({optional:!0});if(d){const T=await d.getHeartbeatsHeader();T&&l.append("x-firebase-client",T)}const f={installation:{sdkVersion:eQ,appId:i.appId}},E={method:"POST",headers:l,body:JSON.stringify(f)},S=await aQ(()=>fetch(a,E));if(S.ok){const T=await S.json();return iQ(T)}else throw await sQ("Generate Auth Token",S)}function BRe(i,{fid:n}){return`${rQ(i)}/${n}/authTokens:generate`}async function cU(i,n=!1){let s;const a=await YO(i.appConfig,d=>{if(!fQ(d))throw Vg.create("not-registered");const f=d.authToken;if(!n&&HRe(f))return d;if(f.requestStatus===1)return s=WRe(i,n),d;{if(!navigator.onLine)throw Vg.create("app-offline");const E=KRe(d);return s=GRe(i,E),E}});return s?await s:a.authToken}async function WRe(i,n){let s=await K9(i.appConfig);for(;s.authToken.requestStatus===1;)await cQ(100),s=await K9(i.appConfig);const a=s.authToken;return a.requestStatus===0?cU(i,n):a}function K9(i){return YO(i,n=>{if(!fQ(n))throw Vg.create("not-registered");const s=n.authToken;return YRe(s)?{...n,authToken:{requestStatus:0}}:n})}async function GRe(i,n){try{const s=await jRe(i,n),a={...n,authToken:s};return await rO(i.appConfig,a),s}catch(s){if(nQ(s)&&(s.customData.serverCode===401||s.customData.serverCode===404))await hQ(i.appConfig);else{const a={...n,authToken:{requestStatus:0}};await rO(i.appConfig,a)}throw s}}function fQ(i){return i!==void 0&&i.registrationStatus===2}function HRe(i){return i.requestStatus===2&&!zRe(i)}function zRe(i){const n=Date.now();return n<i.creationTime||i.creationTime+i.expiresIn<n+ERe}function KRe(i){const n={requestStatus:1,requestTime:Date.now()};return{...i,authToken:n}}function YRe(i){return i.requestStatus===1&&i.requestTime+Z$<Date.now()}async function qRe(i){const n=i,{installationEntry:s,registrationPromise:a}=await aU(n);return a?a.catch(console.error):cU(n).catch(console.error),s.fid}async function XRe(i,n=!1){const s=i;return await JRe(s),(await cU(s,n)).token}async function JRe(i){const{registrationPromise:n}=await aU(i);n&&await n}function $Re(i){if(!i||!i.options)throw eL("App Configuration");if(!i.name)throw eL("App Name");const n=["projectId","apiKey","appId"];for(const s of n)if(!i.options[s])throw eL(s);return{appName:i.name,projectId:i.options.projectId,apiKey:i.options.apiKey,appId:i.options.appId}}function eL(i){return Vg.create("missing-app-config-values",{valueName:i})}const mQ="installations",QRe="installations-internal",ZRe=i=>{const n=i.getProvider("app").getImmediate(),s=$Re(n),a=mv(n,"heartbeat");return{app:n,appConfig:s,heartbeatServiceProvider:a,_delete:()=>Promise.resolve()}},ebe=i=>{const n=i.getProvider("app").getImmediate(),s=mv(n,mQ).getImmediate();return{getId:()=>qRe(s),getToken:l=>XRe(s,l)}};function tbe(){Sh(new Rd(mQ,ZRe,"PUBLIC")),Sh(new Rd(QRe,ebe,"PRIVATE"))}tbe();vd(Q$,sU);vd(Q$,sU,"esm2020");const iO="analytics",nbe="firebase_id",rbe="origin",ibe=60*1e3,sbe="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",lU="https://www.googletagmanager.com/gtag/js";const ta=new K2("@firebase/analytics");const obe={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},gc=new Hg("analytics","Analytics",obe);function abe(i){if(!i.startsWith(lU)){const n=gc.create("invalid-gtag-resource",{gtagURL:i});return ta.warn(n.message),""}return i}function gQ(i){return Promise.all(i.map(n=>n.catch(s=>s)))}function cbe(i,n){let s;return window.trustedTypes&&(s=window.trustedTypes.createPolicy(i,n)),s}function lbe(i,n){const s=cbe("firebase-js-sdk-policy",{createScriptURL:abe}),a=document.createElement("script"),l=`${lU}?l=${i}&id=${n}`;a.src=s?s?.createScriptURL(l):l,a.async=!0,document.head.appendChild(a)}function ube(i){let n=[];return Array.isArray(window[i])?n=window[i]:window[i]=n,n}async function dbe(i,n,s,a,l,d){const f=a[l];try{if(f)await n[f];else{const S=(await gQ(s)).find(T=>T.measurementId===l);S&&await n[S.appId]}}catch(E){ta.error(E)}i("config",l,d)}async function hbe(i,n,s,a,l){try{let d=[];if(l&&l.send_to){let f=l.send_to;Array.isArray(f)||(f=[f]);const E=await gQ(s);for(const S of f){const T=E.find(I=>I.measurementId===S),C=T&&n[T.appId];if(C)d.push(C);else{d=[];break}}}d.length===0&&(d=Object.values(n)),await Promise.all(d),i("event",a,l||{})}catch(d){ta.error(d)}}function pbe(i,n,s,a){async function l(d,...f){try{if(d==="event"){const[E,S]=f;await hbe(i,n,s,E,S)}else if(d==="config"){const[E,S]=f;await dbe(i,n,s,a,E,S)}else if(d==="consent"){const[E,S]=f;i("consent",E,S)}else if(d==="get"){const[E,S,T]=f;i("get",E,S,T)}else if(d==="set"){const[E]=f;i("set",E)}else i(d,...f)}catch(E){ta.error(E)}}return l}function fbe(i,n,s,a,l){let d=function(...f){window[a].push(arguments)};return window[l]&&typeof window[l]=="function"&&(d=window[l]),window[l]=pbe(d,i,n,s),{gtagCore:d,wrappedGtag:window[l]}}function mbe(i){const n=window.document.getElementsByTagName("script");for(const s of Object.values(n))if(s.src&&s.src.includes(lU)&&s.src.includes(i))return s;return null}const gbe=30,_be=1e3;class Ebe{constructor(n={},s=_be){this.throttleMetadata=n,this.intervalMillis=s}getThrottleMetadata(n){return this.throttleMetadata[n]}setThrottleMetadata(n,s){this.throttleMetadata[n]=s}deleteThrottleMetadata(n){delete this.throttleMetadata[n]}}const _Q=new Ebe;function ybe(i){return new Headers({Accept:"application/json","x-goog-api-key":i})}async function vbe(i){const{appId:n,apiKey:s}=i,a={method:"GET",headers:ybe(s)},l=sbe.replace("{app-id}",n),d=await fetch(l,a);if(d.status!==200&&d.status!==304){let f="";try{const E=await d.json();E.error?.message&&(f=E.error.message)}catch{}throw gc.create("config-fetch-failed",{httpStatus:d.status,responseMessage:f})}return d.json()}async function Sbe(i,n=_Q,s){const{appId:a,apiKey:l,measurementId:d}=i.options;if(!a)throw gc.create("no-app-id");if(!l){if(d)return{measurementId:d,appId:a};throw gc.create("no-api-key")}const f=n.getThrottleMetadata(a)||{backoffCount:0,throttleEndTimeMillis:Date.now()},E=new Cbe;return setTimeout(async()=>{E.abort()},ibe),EQ({appId:a,apiKey:l,measurementId:d},f,E,n)}async function EQ(i,{throttleEndTimeMillis:n,backoffCount:s},a,l=_Q){const{appId:d,measurementId:f}=i;try{await Tbe(a,n)}catch(E){if(f)return ta.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${f} provided in the "measurementId" field in the local Firebase config. [${E?.message}]`),{appId:d,measurementId:f};throw E}try{const E=await vbe(i);return l.deleteThrottleMetadata(d),E}catch(E){const S=E;if(!wbe(S)){if(l.deleteThrottleMetadata(d),f)return ta.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${f} provided in the "measurementId" field in the local Firebase config. [${S?.message}]`),{appId:d,measurementId:f};throw E}const T=Number(S?.customData?.httpStatus)===503?f9(s,l.intervalMillis,gbe):f9(s,l.intervalMillis),C={throttleEndTimeMillis:Date.now()+T,backoffCount:s+1};return l.setThrottleMetadata(d,C),ta.debug(`Calling attemptFetch again in ${T} millis`),EQ(i,C,a,l)}}function Tbe(i,n){return new Promise((s,a)=>{const l=Math.max(n-Date.now(),0),d=setTimeout(s,l);i.addEventListener(()=>{clearTimeout(d),a(gc.create("fetch-throttle",{throttleEndTimeMillis:n}))})})}function wbe(i){if(!(i instanceof Nd)||!i.customData)return!1;const n=Number(i.customData.httpStatus);return n===429||n===500||n===503||n===504}class Cbe{constructor(){this.listeners=[]}addEventListener(n){this.listeners.push(n)}abort(){this.listeners.forEach(n=>n())}}async function Rbe(i,n,s,a,l){if(l&&l.global){i("event",s,a);return}else{const d=await n,f={...a,send_to:d};i("event",s,f)}}async function bbe(i,n,s,a){if(a&&a.global){const l={};for(const d of Object.keys(s))l[`user_properties.${d}`]=s[d];return i("set",l),Promise.resolve()}else{const l=await n;i("config",l,{update:!0,user_properties:s})}}async function Ibe(){if(o$())try{await a$()}catch(i){return ta.warn(gc.create("indexeddb-unavailable",{errorInfo:i?.toString()}).message),!1}else return ta.warn(gc.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function Abe(i,n,s,a,l,d,f){const E=Sbe(i);E.then(N=>{s[N.measurementId]=N.appId,i.options.measurementId&&N.measurementId!==i.options.measurementId&&ta.warn(`The measurement ID in the local Firebase config (${i.options.measurementId}) does not match the measurement ID fetched from the server (${N.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(N=>ta.error(N)),n.push(E);const S=Ibe().then(N=>{if(N)return a.getId()}),[T,C]=await Promise.all([E,S]);mbe(d)||lbe(d,T.measurementId),l("js",new Date);const I=f?.config??{};return I[rbe]="firebase",I.update=!0,C!=null&&(I[nbe]=C),l("config",T.measurementId,I),T.measurementId}class Obe{constructor(n){this.app=n}_delete(){return delete By[this.app.options.appId],Promise.resolve()}}let By={},Y9=[];const q9={};let tL="dataLayer",Nbe="gtag",X9,uU,J9=!1;function Pbe(){const i=[];if(s$()&&i.push("This is a browser extension environment."),ETe()||i.push("Cookies are not available."),i.length>0){const n=i.map((a,l)=>`(${l+1}) ${a}`).join(" "),s=gc.create("invalid-analytics-context",{errorInfo:n});ta.warn(s.message)}}function kbe(i,n,s){Pbe();const a=i.options.appId;if(!a)throw gc.create("no-app-id");if(!i.options.apiKey)if(i.options.measurementId)ta.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${i.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw gc.create("no-api-key");if(By[a]!=null)throw gc.create("already-exists",{id:a});if(!J9){ube(tL);const{wrappedGtag:d,gtagCore:f}=fbe(By,Y9,q9,tL,Nbe);uU=d,X9=f,J9=!0}return By[a]=Abe(i,Y9,q9,n,X9,tL,s),new Obe(i)}function Dbe(i=h$()){i=Sc(i);const n=mv(i,iO);return n.isInitialized()?n.getImmediate():xbe(i)}function xbe(i,n={}){const s=mv(i,iO);if(s.isInitialized()){const l=s.getImmediate();if(Mg(n,s.getOptions()))return l;throw gc.create("already-initialized")}return s.initialize({options:n})}function Lbe(i,n,s){i=Sc(i),bbe(uU,By[i.app.options.appId],n,s).catch(a=>ta.error(a))}function Mbe(i,n,s,a){i=Sc(i),Rbe(uU,By[i.app.options.appId],n,s,a).catch(l=>ta.error(l))}const $9="@firebase/analytics",Q9="0.10.19";function Ube(){Sh(new Rd(iO,(n,{options:s})=>{const a=n.getProvider("app").getImmediate(),l=n.getProvider("installations-internal").getImmediate();return kbe(a,l,s)},"PUBLIC")),Sh(new Rd("analytics-internal",i,"PRIVATE")),vd($9,Q9),vd($9,Q9,"esm2020");function i(n){try{const s=n.getProvider(iO).getImmediate();return{logEvent:(a,l,d)=>Mbe(s,a,l,d),setUserProperties:(a,l)=>Lbe(s,a,l)}}catch(s){throw gc.create("interop-component-reg-failed",{reason:s})}}}Ube();const Vbe={apiKey:"AIzaSyAMMzRab6OCXICjmAlnN-maJXRGEEgWdaE",authDomain:"kle-connect.firebaseapp.com",projectId:"kle-connect",storageBucket:"kle-connect.firebasestorage.app",messagingSenderId:"939070940474",appId:"1:939070940474:web:5a0b7a45c7fe345fbddc03",measurementId:"G-9T43NDMQVS"},yQ=d$(Vbe),Bp=pRe(yQ),Fbe=new ph;Dbe(yQ);const vQ=H.createContext(void 0),qO=()=>{const i=H.useContext(vQ);if(!i)throw new Error("useAuth must be used within an AuthProvider");return i},jbe=({children:i})=>{const[n,s]=H.useState(null),[a,l]=H.useState(!0);H.useEffect(()=>{const N=zwe(Bp,P=>{s(P),l(!1)});return()=>N()},[]);const d=async(N,P,W)=>{try{return await Bwe(Bp,N,P),{error:null}}catch(x){return{error:x}}},f=async(N,P)=>{try{return await Wwe(Bp,N,P),{error:null}}catch(W){return{error:W}}},E=async()=>{try{return await TCe(Bp,Fbe),{error:null}}catch(N){return{error:N}}},S=async()=>{try{return await Vwe(Bp),{error:null}}catch(N){return{error:N}}},T=N=>new pCe(Bp,N,{size:"invisible",callback:()=>{}}),C=async(N,P)=>{try{return{confirmationResult:await gCe(Bp,N,P),error:null}}catch(W){return{confirmationResult:null,error:W}}},I=async()=>{await Kwe(Bp)};return D.jsx(vQ.Provider,{value:{user:n,loading:a,signUp:d,signIn:f,signInWithGoogle:E,signInAnonymously:S,setUpRecaptcha:T,signInWithPhone:C,signOut:I},children:i})},dU=H.createContext({});function hU(i){const n=H.useRef(null);return n.current===null&&(n.current=i()),n.current}const pU=typeof window<"u",SQ=pU?H.useLayoutEffect:H.useEffect,XO=H.createContext(null);function fU(i,n){i.indexOf(n)===-1&&i.push(n)}function mU(i,n){const s=i.indexOf(n);s>-1&&i.splice(s,1)}const Ch=(i,n,s)=>s>n?n:s<i?i:s;let gU=()=>{};const Rh={},TQ=i=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(i);function wQ(i){return typeof i=="object"&&i!==null}const CQ=i=>/^0[^.\s]+$/u.test(i);function _U(i){let n;return()=>(n===void 0&&(n=i()),n)}const cl=i=>i,Bbe=(i,n)=>s=>n(i(s)),Yw=(...i)=>i.reduce(Bbe),yw=(i,n,s)=>{const a=n-i;return a===0?1:(s-i)/a};class EU{constructor(){this.subscriptions=[]}add(n){return fU(this.subscriptions,n),()=>mU(this.subscriptions,n)}notify(n,s,a){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](n,s,a);else for(let d=0;d<l;d++){const f=this.subscriptions[d];f&&f(n,s,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Sd=i=>i*1e3,sl=i=>i/1e3;function RQ(i,n){return n?i*(1e3/n):0}const bQ=(i,n,s)=>(((1-3*s+3*n)*i+(3*s-6*n))*i+3*n)*i,Wbe=1e-7,Gbe=12;function Hbe(i,n,s,a,l){let d,f,E=0;do f=n+(s-n)/2,d=bQ(f,a,l)-i,d>0?s=f:n=f;while(Math.abs(d)>Wbe&&++E<Gbe);return f}function qw(i,n,s,a){if(i===n&&s===a)return cl;const l=d=>Hbe(d,0,1,i,s);return d=>d===0||d===1?d:bQ(l(d),n,a)}const IQ=i=>n=>n<=.5?i(2*n)/2:(2-i(2*(1-n)))/2,AQ=i=>n=>1-i(1-n),OQ=qw(.33,1.53,.69,.99),yU=AQ(OQ),NQ=IQ(yU),PQ=i=>(i*=2)<1?.5*yU(i):.5*(2-Math.pow(2,-10*(i-1))),vU=i=>1-Math.sin(Math.acos(i)),kQ=AQ(vU),DQ=IQ(vU),zbe=qw(.42,0,1,1),Kbe=qw(0,0,.58,1),xQ=qw(.42,0,.58,1),Ybe=i=>Array.isArray(i)&&typeof i[0]!="number",LQ=i=>Array.isArray(i)&&typeof i[0]=="number",qbe={linear:cl,easeIn:zbe,easeInOut:xQ,easeOut:Kbe,circIn:vU,circInOut:DQ,circOut:kQ,backIn:yU,backInOut:NQ,backOut:OQ,anticipate:PQ},Xbe=i=>typeof i=="string",Z9=i=>{if(LQ(i)){gU(i.length===4);const[n,s,a,l]=i;return qw(n,s,a,l)}else if(Xbe(i))return qbe[i];return i},sA=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function Jbe(i,n){let s=new Set,a=new Set,l=!1,d=!1;const f=new WeakSet;let E={delta:0,timestamp:0,isProcessing:!1};function S(C){f.has(C)&&(T.schedule(C),i()),C(E)}const T={schedule:(C,I=!1,N=!1)=>{const W=N&&l?s:a;return I&&f.add(C),W.has(C)||W.add(C),C},cancel:C=>{a.delete(C),f.delete(C)},process:C=>{if(E=C,l){d=!0;return}l=!0,[s,a]=[a,s],s.forEach(S),s.clear(),l=!1,d&&(d=!1,T.process(C))}};return T}const $be=40;function MQ(i,n){let s=!1,a=!0;const l={delta:0,timestamp:0,isProcessing:!1},d=()=>s=!0,f=sA.reduce(($,ae)=>($[ae]=Jbe(d),$),{}),{setup:E,read:S,resolveKeyframes:T,preUpdate:C,update:I,preRender:N,render:P,postRender:W}=f,x=()=>{const $=Rh.useManualTiming?l.timestamp:performance.now();s=!1,Rh.useManualTiming||(l.delta=a?1e3/60:Math.max(Math.min($-l.timestamp,$be),1)),l.timestamp=$,l.isProcessing=!0,E.process(l),S.process(l),T.process(l),C.process(l),I.process(l),N.process(l),P.process(l),W.process(l),l.isProcessing=!1,s&&n&&(a=!1,i(x))},B=()=>{s=!0,a=!0,l.isProcessing||i(x)};return{schedule:sA.reduce(($,ae)=>{const ce=f[ae];return $[ae]=(le,ne=!1,fe=!1)=>(s||B(),ce.schedule(le,ne,fe)),$},{}),cancel:$=>{for(let ae=0;ae<sA.length;ae++)f[sA[ae]].cancel($)},state:l,steps:f}}const{schedule:Fi,cancel:df,state:go,steps:nL}=MQ(typeof requestAnimationFrame<"u"?requestAnimationFrame:cl,!0);let bA;function Qbe(){bA=void 0}const Na={now:()=>(bA===void 0&&Na.set(go.isProcessing||Rh.useManualTiming?go.timestamp:performance.now()),bA),set:i=>{bA=i,queueMicrotask(Qbe)}},UQ=i=>n=>typeof n=="string"&&n.startsWith(i),VQ=UQ("--"),Zbe=UQ("var(--"),SU=i=>Zbe(i)?eIe.test(i.split("/*")[0].trim()):!1,eIe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,_v={test:i=>typeof i=="number",parse:parseFloat,transform:i=>i},vw={..._v,transform:i=>Ch(0,1,i)},oA={..._v,default:1},J0=i=>Math.round(i*1e5)/1e5,TU=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function tIe(i){return i==null}const nIe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,wU=(i,n)=>s=>!!(typeof s=="string"&&nIe.test(s)&&s.startsWith(i)||n&&!tIe(s)&&Object.prototype.hasOwnProperty.call(s,n)),FQ=(i,n,s)=>a=>{if(typeof a!="string")return a;const[l,d,f,E]=a.match(TU);return{[i]:parseFloat(l),[n]:parseFloat(d),[s]:parseFloat(f),alpha:E!==void 0?parseFloat(E):1}},rIe=i=>Ch(0,255,i),rL={..._v,transform:i=>Math.round(rIe(i))},Cg={test:wU("rgb","red"),parse:FQ("red","green","blue"),transform:({red:i,green:n,blue:s,alpha:a=1})=>"rgba("+rL.transform(i)+", "+rL.transform(n)+", "+rL.transform(s)+", "+J0(vw.transform(a))+")"};function iIe(i){let n="",s="",a="",l="";return i.length>5?(n=i.substring(1,3),s=i.substring(3,5),a=i.substring(5,7),l=i.substring(7,9)):(n=i.substring(1,2),s=i.substring(2,3),a=i.substring(3,4),l=i.substring(4,5),n+=n,s+=s,a+=a,l+=l),{red:parseInt(n,16),green:parseInt(s,16),blue:parseInt(a,16),alpha:l?parseInt(l,16)/255:1}}const EM={test:wU("#"),parse:iIe,transform:Cg.transform},Xw=i=>({test:n=>typeof n=="string"&&n.endsWith(i)&&n.split(" ").length===1,parse:parseFloat,transform:n=>`${n}${i}`}),Hp=Xw("deg"),Td=Xw("%"),vn=Xw("px"),sIe=Xw("vh"),oIe=Xw("vw"),e7={...Td,parse:i=>Td.parse(i)/100,transform:i=>Td.transform(i*100)},by={test:wU("hsl","hue"),parse:FQ("hue","saturation","lightness"),transform:({hue:i,saturation:n,lightness:s,alpha:a=1})=>"hsla("+Math.round(i)+", "+Td.transform(J0(n))+", "+Td.transform(J0(s))+", "+J0(vw.transform(a))+")"},Ts={test:i=>Cg.test(i)||EM.test(i)||by.test(i),parse:i=>Cg.test(i)?Cg.parse(i):by.test(i)?by.parse(i):EM.parse(i),transform:i=>typeof i=="string"?i:i.hasOwnProperty("red")?Cg.transform(i):by.transform(i),getAnimatableNone:i=>{const n=Ts.parse(i);return n.alpha=0,Ts.transform(n)}},aIe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function cIe(i){return isNaN(i)&&typeof i=="string"&&(i.match(TU)?.length||0)+(i.match(aIe)?.length||0)>0}const jQ="number",BQ="color",lIe="var",uIe="var(",t7="${}",dIe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Sw(i){const n=i.toString(),s=[],a={color:[],number:[],var:[]},l=[];let d=0;const E=n.replace(dIe,S=>(Ts.test(S)?(a.color.push(d),l.push(BQ),s.push(Ts.parse(S))):S.startsWith(uIe)?(a.var.push(d),l.push(lIe),s.push(S)):(a.number.push(d),l.push(jQ),s.push(parseFloat(S))),++d,t7)).split(t7);return{values:s,split:E,indexes:a,types:l}}function WQ(i){return Sw(i).values}function GQ(i){const{split:n,types:s}=Sw(i),a=n.length;return l=>{let d="";for(let f=0;f<a;f++)if(d+=n[f],l[f]!==void 0){const E=s[f];E===jQ?d+=J0(l[f]):E===BQ?d+=Ts.transform(l[f]):d+=l[f]}return d}}const hIe=i=>typeof i=="number"?0:Ts.test(i)?Ts.getAnimatableNone(i):i;function pIe(i){const n=WQ(i);return GQ(i)(n.map(hIe))}const hf={test:cIe,parse:WQ,createTransformer:GQ,getAnimatableNone:pIe};function iL(i,n,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?i+(n-i)*6*s:s<1/2?n:s<2/3?i+(n-i)*(2/3-s)*6:i}function fIe({hue:i,saturation:n,lightness:s,alpha:a}){i/=360,n/=100,s/=100;let l=0,d=0,f=0;if(!n)l=d=f=s;else{const E=s<.5?s*(1+n):s+n-s*n,S=2*s-E;l=iL(S,E,i+1/3),d=iL(S,E,i),f=iL(S,E,i-1/3)}return{red:Math.round(l*255),green:Math.round(d*255),blue:Math.round(f*255),alpha:a}}function sO(i,n){return s=>s>0?n:i}const Xi=(i,n,s)=>i+(n-i)*s,sL=(i,n,s)=>{const a=i*i,l=s*(n*n-a)+a;return l<0?0:Math.sqrt(l)},mIe=[EM,Cg,by],gIe=i=>mIe.find(n=>n.test(i));function n7(i){const n=gIe(i);if(!n)return!1;let s=n.parse(i);return n===by&&(s=fIe(s)),s}const r7=(i,n)=>{const s=n7(i),a=n7(n);if(!s||!a)return sO(i,n);const l={...s};return d=>(l.red=sL(s.red,a.red,d),l.green=sL(s.green,a.green,d),l.blue=sL(s.blue,a.blue,d),l.alpha=Xi(s.alpha,a.alpha,d),Cg.transform(l))},yM=new Set(["none","hidden"]);function _Ie(i,n){return yM.has(i)?s=>s<=0?i:n:s=>s>=1?n:i}function EIe(i,n){return s=>Xi(i,n,s)}function CU(i){return typeof i=="number"?EIe:typeof i=="string"?SU(i)?sO:Ts.test(i)?r7:SIe:Array.isArray(i)?HQ:typeof i=="object"?Ts.test(i)?r7:yIe:sO}function HQ(i,n){const s=[...i],a=s.length,l=i.map((d,f)=>CU(d)(d,n[f]));return d=>{for(let f=0;f<a;f++)s[f]=l[f](d);return s}}function yIe(i,n){const s={...i,...n},a={};for(const l in s)i[l]!==void 0&&n[l]!==void 0&&(a[l]=CU(i[l])(i[l],n[l]));return l=>{for(const d in a)s[d]=a[d](l);return s}}function vIe(i,n){const s=[],a={color:0,var:0,number:0};for(let l=0;l<n.values.length;l++){const d=n.types[l],f=i.indexes[d][a[d]],E=i.values[f]??0;s[l]=E,a[d]++}return s}const SIe=(i,n)=>{const s=hf.createTransformer(n),a=Sw(i),l=Sw(n);return a.indexes.var.length===l.indexes.var.length&&a.indexes.color.length===l.indexes.color.length&&a.indexes.number.length>=l.indexes.number.length?yM.has(i)&&!l.values.length||yM.has(n)&&!a.values.length?_Ie(i,n):Yw(HQ(vIe(a,l),l.values),s):sO(i,n)};function zQ(i,n,s){return typeof i=="number"&&typeof n=="number"&&typeof s=="number"?Xi(i,n,s):CU(i)(i,n)}const TIe=i=>{const n=({timestamp:s})=>i(s);return{start:(s=!0)=>Fi.update(n,s),stop:()=>df(n),now:()=>go.isProcessing?go.timestamp:Na.now()}},KQ=(i,n,s=10)=>{let a="";const l=Math.max(Math.round(n/s),2);for(let d=0;d<l;d++)a+=Math.round(i(d/(l-1))*1e4)/1e4+", ";return`linear(${a.substring(0,a.length-2)})`},oO=2e4;function RU(i){let n=0;const s=50;let a=i.next(n);for(;!a.done&&n<oO;)n+=s,a=i.next(n);return n>=oO?1/0:n}function wIe(i,n=100,s){const a=s({...i,keyframes:[0,n]}),l=Math.min(RU(a),oO);return{type:"keyframes",ease:d=>a.next(l*d).value/n,duration:sl(l)}}const CIe=5;function YQ(i,n,s){const a=Math.max(n-CIe,0);return RQ(s-i(a),n-a)}const ss={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},oL=.001;function RIe({duration:i=ss.duration,bounce:n=ss.bounce,velocity:s=ss.velocity,mass:a=ss.mass}){let l,d,f=1-n;f=Ch(ss.minDamping,ss.maxDamping,f),i=Ch(ss.minDuration,ss.maxDuration,sl(i)),f<1?(l=T=>{const C=T*f,I=C*i,N=C-s,P=vM(T,f),W=Math.exp(-I);return oL-N/P*W},d=T=>{const I=T*f*i,N=I*s+s,P=Math.pow(f,2)*Math.pow(T,2)*i,W=Math.exp(-I),x=vM(Math.pow(T,2),f);return(-l(T)+oL>0?-1:1)*((N-P)*W)/x}):(l=T=>{const C=Math.exp(-T*i),I=(T-s)*i+1;return-oL+C*I},d=T=>{const C=Math.exp(-T*i),I=(s-T)*(i*i);return C*I});const E=5/i,S=IIe(l,d,E);if(i=Sd(i),isNaN(S))return{stiffness:ss.stiffness,damping:ss.damping,duration:i};{const T=Math.pow(S,2)*a;return{stiffness:T,damping:f*2*Math.sqrt(a*T),duration:i}}}const bIe=12;function IIe(i,n,s){let a=s;for(let l=1;l<bIe;l++)a=a-i(a)/n(a);return a}function vM(i,n){return i*Math.sqrt(1-n*n)}const AIe=["duration","bounce"],OIe=["stiffness","damping","mass"];function i7(i,n){return n.some(s=>i[s]!==void 0)}function NIe(i){let n={velocity:ss.velocity,stiffness:ss.stiffness,damping:ss.damping,mass:ss.mass,isResolvedFromDuration:!1,...i};if(!i7(i,OIe)&&i7(i,AIe))if(i.visualDuration){const s=i.visualDuration,a=2*Math.PI/(s*1.2),l=a*a,d=2*Ch(.05,1,1-(i.bounce||0))*Math.sqrt(l);n={...n,mass:ss.mass,stiffness:l,damping:d}}else{const s=RIe(i);n={...n,...s,mass:ss.mass},n.isResolvedFromDuration=!0}return n}function aO(i=ss.visualDuration,n=ss.bounce){const s=typeof i!="object"?{visualDuration:i,keyframes:[0,1],bounce:n}:i;let{restSpeed:a,restDelta:l}=s;const d=s.keyframes[0],f=s.keyframes[s.keyframes.length-1],E={done:!1,value:d},{stiffness:S,damping:T,mass:C,duration:I,velocity:N,isResolvedFromDuration:P}=NIe({...s,velocity:-sl(s.velocity||0)}),W=N||0,x=T/(2*Math.sqrt(S*C)),B=f-d,X=sl(Math.sqrt(S/C)),Z=Math.abs(B)<5;a||(a=Z?ss.restSpeed.granular:ss.restSpeed.default),l||(l=Z?ss.restDelta.granular:ss.restDelta.default);let $;if(x<1){const ce=vM(X,x);$=le=>{const ne=Math.exp(-x*X*le);return f-ne*((W+x*X*B)/ce*Math.sin(ce*le)+B*Math.cos(ce*le))}}else if(x===1)$=ce=>f-Math.exp(-X*ce)*(B+(W+X*B)*ce);else{const ce=X*Math.sqrt(x*x-1);$=le=>{const ne=Math.exp(-x*X*le),fe=Math.min(ce*le,300);return f-ne*((W+x*X*B)*Math.sinh(fe)+ce*B*Math.cosh(fe))/ce}}const ae={calculatedDuration:P&&I||null,next:ce=>{const le=$(ce);if(P)E.done=ce>=I;else{let ne=ce===0?W:0;x<1&&(ne=ce===0?Sd(W):YQ($,ce,le));const fe=Math.abs(ne)<=a,Se=Math.abs(f-le)<=l;E.done=fe&&Se}return E.value=E.done?f:le,E},toString:()=>{const ce=Math.min(RU(ae),oO),le=KQ(ne=>ae.next(ce*ne).value,ce,30);return ce+"ms "+le},toTransition:()=>{}};return ae}aO.applyToOptions=i=>{const n=wIe(i,100,aO);return i.ease=n.ease,i.duration=Sd(n.duration),i.type="keyframes",i};function SM({keyframes:i,velocity:n=0,power:s=.8,timeConstant:a=325,bounceDamping:l=10,bounceStiffness:d=500,modifyTarget:f,min:E,max:S,restDelta:T=.5,restSpeed:C}){const I=i[0],N={done:!1,value:I},P=fe=>E!==void 0&&fe<E||S!==void 0&&fe>S,W=fe=>E===void 0?S:S===void 0||Math.abs(E-fe)<Math.abs(S-fe)?E:S;let x=s*n;const B=I+x,X=f===void 0?B:f(B);X!==B&&(x=X-I);const Z=fe=>-x*Math.exp(-fe/a),$=fe=>X+Z(fe),ae=fe=>{const Se=Z(fe),De=$(fe);N.done=Math.abs(Se)<=T,N.value=N.done?X:De};let ce,le;const ne=fe=>{P(N.value)&&(ce=fe,le=aO({keyframes:[N.value,W(N.value)],velocity:YQ($,fe,N.value),damping:l,stiffness:d,restDelta:T,restSpeed:C}))};return ne(0),{calculatedDuration:null,next:fe=>{let Se=!1;return!le&&ce===void 0&&(Se=!0,ae(fe),ne(fe)),ce!==void 0&&fe>=ce?le.next(fe-ce):(!Se&&ae(fe),N)}}}function PIe(i,n,s){const a=[],l=s||Rh.mix||zQ,d=i.length-1;for(let f=0;f<d;f++){let E=l(i[f],i[f+1]);if(n){const S=Array.isArray(n)?n[f]||cl:n;E=Yw(S,E)}a.push(E)}return a}function kIe(i,n,{clamp:s=!0,ease:a,mixer:l}={}){const d=i.length;if(gU(d===n.length),d===1)return()=>n[0];if(d===2&&n[0]===n[1])return()=>n[1];const f=i[0]===i[1];i[0]>i[d-1]&&(i=[...i].reverse(),n=[...n].reverse());const E=PIe(n,a,l),S=E.length,T=C=>{if(f&&C<i[0])return n[0];let I=0;if(S>1)for(;I<i.length-2&&!(C<i[I+1]);I++);const N=yw(i[I],i[I+1],C);return E[I](N)};return s?C=>T(Ch(i[0],i[d-1],C)):T}function DIe(i,n){const s=i[i.length-1];for(let a=1;a<=n;a++){const l=yw(0,n,a);i.push(Xi(s,1,l))}}function xIe(i){const n=[0];return DIe(n,i.length-1),n}function LIe(i,n){return i.map(s=>s*n)}function MIe(i,n){return i.map(()=>n||xQ).splice(0,i.length-1)}function $0({duration:i=300,keyframes:n,times:s,ease:a="easeInOut"}){const l=Ybe(a)?a.map(Z9):Z9(a),d={done:!1,value:n[0]},f=LIe(s&&s.length===n.length?s:xIe(n),i),E=kIe(f,n,{ease:Array.isArray(l)?l:MIe(n,l)});return{calculatedDuration:i,next:S=>(d.value=E(S),d.done=S>=i,d)}}const UIe=i=>i!==null;function bU(i,{repeat:n,repeatType:s="loop"},a,l=1){const d=i.filter(UIe),E=l<0||n&&s!=="loop"&&n%2===1?0:d.length-1;return!E||a===void 0?d[E]:a}const VIe={decay:SM,inertia:SM,tween:$0,keyframes:$0,spring:aO};function qQ(i){typeof i.type=="string"&&(i.type=VIe[i.type])}class IU{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(n=>{this.resolve=n})}notifyFinished(){this.resolve()}then(n,s){return this.finished.then(n,s)}}const FIe=i=>i/100;class AU extends IU{constructor(n){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:s}=this.options;s&&s.updatedAt!==Na.now()&&this.tick(Na.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=n,this.initAnimation(),this.play(),n.autoplay===!1&&this.pause()}initAnimation(){const{options:n}=this;qQ(n);const{type:s=$0,repeat:a=0,repeatDelay:l=0,repeatType:d,velocity:f=0}=n;let{keyframes:E}=n;const S=s||$0;S!==$0&&typeof E[0]!="number"&&(this.mixKeyframes=Yw(FIe,zQ(E[0],E[1])),E=[0,100]);const T=S({...n,keyframes:E});d==="mirror"&&(this.mirroredGenerator=S({...n,keyframes:[...E].reverse(),velocity:-f})),T.calculatedDuration===null&&(T.calculatedDuration=RU(T));const{calculatedDuration:C}=T;this.calculatedDuration=C,this.resolvedDuration=C+l,this.totalDuration=this.resolvedDuration*(a+1)-l,this.generator=T}updateTime(n){const s=Math.round(n-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=s}tick(n,s=!1){const{generator:a,totalDuration:l,mixKeyframes:d,mirroredGenerator:f,resolvedDuration:E,calculatedDuration:S}=this;if(this.startTime===null)return a.next(0);const{delay:T=0,keyframes:C,repeat:I,repeatType:N,repeatDelay:P,type:W,onUpdate:x,finalKeyframe:B}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,n):this.speed<0&&(this.startTime=Math.min(n-l/this.speed,this.startTime)),s?this.currentTime=n:this.updateTime(n);const X=this.currentTime-T*(this.playbackSpeed>=0?1:-1),Z=this.playbackSpeed>=0?X<0:X>l;this.currentTime=Math.max(X,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=l);let $=this.currentTime,ae=a;if(I){const fe=Math.min(this.currentTime,l)/E;let Se=Math.floor(fe),De=fe%1;!De&&fe>=1&&(De=1),De===1&&Se--,Se=Math.min(Se,I+1),Se%2&&(N==="reverse"?(De=1-De,P&&(De-=P/E)):N==="mirror"&&(ae=f)),$=Ch(0,1,De)*E}const ce=Z?{done:!1,value:C[0]}:ae.next($);d&&(ce.value=d(ce.value));let{done:le}=ce;!Z&&S!==null&&(le=this.playbackSpeed>=0?this.currentTime>=l:this.currentTime<=0);const ne=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&le);return ne&&W!==SM&&(ce.value=bU(C,this.options,B,this.speed)),x&&x(ce.value),ne&&this.finish(),ce}then(n,s){return this.finished.then(n,s)}get duration(){return sl(this.calculatedDuration)}get iterationDuration(){const{delay:n=0}=this.options||{};return this.duration+sl(n)}get time(){return sl(this.currentTime)}set time(n){n=Sd(n),this.currentTime=n,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=n:this.driver&&(this.startTime=this.driver.now()-n/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(n){this.updateTime(Na.now());const s=this.playbackSpeed!==n;this.playbackSpeed=n,s&&(this.time=sl(this.currentTime))}play(){if(this.isStopped)return;const{driver:n=TIe,startTime:s}=this.options;this.driver||(this.driver=n(l=>this.tick(l))),this.options.onPlay?.();const a=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=a):this.holdTime!==null?this.startTime=a-this.holdTime:this.startTime||(this.startTime=s??a),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Na.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(n){return this.startTime=0,this.tick(n,!0)}attachTimeline(n){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),n.observe(this)}}function jIe(i){for(let n=1;n<i.length;n++)i[n]??(i[n]=i[n-1])}const Rg=i=>i*180/Math.PI,TM=i=>{const n=Rg(Math.atan2(i[1],i[0]));return wM(n)},BIe={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:i=>(Math.abs(i[0])+Math.abs(i[3]))/2,rotate:TM,rotateZ:TM,skewX:i=>Rg(Math.atan(i[1])),skewY:i=>Rg(Math.atan(i[2])),skew:i=>(Math.abs(i[1])+Math.abs(i[2]))/2},wM=i=>(i=i%360,i<0&&(i+=360),i),s7=TM,o7=i=>Math.sqrt(i[0]*i[0]+i[1]*i[1]),a7=i=>Math.sqrt(i[4]*i[4]+i[5]*i[5]),WIe={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:o7,scaleY:a7,scale:i=>(o7(i)+a7(i))/2,rotateX:i=>wM(Rg(Math.atan2(i[6],i[5]))),rotateY:i=>wM(Rg(Math.atan2(-i[2],i[0]))),rotateZ:s7,rotate:s7,skewX:i=>Rg(Math.atan(i[4])),skewY:i=>Rg(Math.atan(i[1])),skew:i=>(Math.abs(i[1])+Math.abs(i[4]))/2};function CM(i){return i.includes("scale")?1:0}function RM(i,n){if(!i||i==="none")return CM(n);const s=i.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let a,l;if(s)a=WIe,l=s;else{const E=i.match(/^matrix\(([-\d.e\s,]+)\)$/u);a=BIe,l=E}if(!l)return CM(n);const d=a[n],f=l[1].split(",").map(HIe);return typeof d=="function"?d(f):f[d]}const GIe=(i,n)=>{const{transform:s="none"}=getComputedStyle(i);return RM(s,n)};function HIe(i){return parseFloat(i.trim())}const Ev=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],yv=new Set(Ev),c7=i=>i===_v||i===vn,zIe=new Set(["x","y","z"]),KIe=Ev.filter(i=>!zIe.has(i));function YIe(i){const n=[];return KIe.forEach(s=>{const a=i.getValue(s);a!==void 0&&(n.push([s,a.get()]),a.set(s.startsWith("scale")?1:0))}),n}const Ig={width:({x:i},{paddingLeft:n="0",paddingRight:s="0"})=>i.max-i.min-parseFloat(n)-parseFloat(s),height:({y:i},{paddingTop:n="0",paddingBottom:s="0"})=>i.max-i.min-parseFloat(n)-parseFloat(s),top:(i,{top:n})=>parseFloat(n),left:(i,{left:n})=>parseFloat(n),bottom:({y:i},{top:n})=>parseFloat(n)+(i.max-i.min),right:({x:i},{left:n})=>parseFloat(n)+(i.max-i.min),x:(i,{transform:n})=>RM(n,"x"),y:(i,{transform:n})=>RM(n,"y")};Ig.translateX=Ig.x;Ig.translateY=Ig.y;const Ag=new Set;let bM=!1,IM=!1,AM=!1;function XQ(){if(IM){const i=Array.from(Ag).filter(a=>a.needsMeasurement),n=new Set(i.map(a=>a.element)),s=new Map;n.forEach(a=>{const l=YIe(a);l.length&&(s.set(a,l),a.render())}),i.forEach(a=>a.measureInitialState()),n.forEach(a=>{a.render();const l=s.get(a);l&&l.forEach(([d,f])=>{a.getValue(d)?.set(f)})}),i.forEach(a=>a.measureEndState()),i.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}IM=!1,bM=!1,Ag.forEach(i=>i.complete(AM)),Ag.clear()}function JQ(){Ag.forEach(i=>{i.readKeyframes(),i.needsMeasurement&&(IM=!0)})}function qIe(){AM=!0,JQ(),XQ(),AM=!1}class OU{constructor(n,s,a,l,d,f=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...n],this.onComplete=s,this.name=a,this.motionValue=l,this.element=d,this.isAsync=f}scheduleResolve(){this.state="scheduled",this.isAsync?(Ag.add(this),bM||(bM=!0,Fi.read(JQ),Fi.resolveKeyframes(XQ))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:n,name:s,element:a,motionValue:l}=this;if(n[0]===null){const d=l?.get(),f=n[n.length-1];if(d!==void 0)n[0]=d;else if(a&&s){const E=a.readValue(s,f);E!=null&&(n[0]=E)}n[0]===void 0&&(n[0]=f),l&&d===void 0&&l.set(n[0])}jIe(n)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(n=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,n),Ag.delete(this)}cancel(){this.state==="scheduled"&&(Ag.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const XIe=i=>i.startsWith("--");function JIe(i,n,s){XIe(n)?i.style.setProperty(n,s):i.style[n]=s}const $Ie=_U(()=>window.ScrollTimeline!==void 0),QIe={};function ZIe(i,n){const s=_U(i);return()=>QIe[n]??s()}const $Q=ZIe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),V0=([i,n,s,a])=>`cubic-bezier(${i}, ${n}, ${s}, ${a})`,l7={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:V0([0,.65,.55,1]),circOut:V0([.55,0,1,.45]),backIn:V0([.31,.01,.66,-.59]),backOut:V0([.33,1.53,.69,.99])};function QQ(i,n){if(i)return typeof i=="function"?$Q()?KQ(i,n):"ease-out":LQ(i)?V0(i):Array.isArray(i)?i.map(s=>QQ(s,n)||l7.easeOut):l7[i]}function eAe(i,n,s,{delay:a=0,duration:l=300,repeat:d=0,repeatType:f="loop",ease:E="easeOut",times:S}={},T=void 0){const C={[n]:s};S&&(C.offset=S);const I=QQ(E,l);Array.isArray(I)&&(C.easing=I);const N={delay:a,duration:l,easing:Array.isArray(I)?"linear":I,fill:"both",iterations:d+1,direction:f==="reverse"?"alternate":"normal"};return T&&(N.pseudoElement=T),i.animate(C,N)}function ZQ(i){return typeof i=="function"&&"applyToOptions"in i}function tAe({type:i,...n}){return ZQ(i)&&$Q()?i.applyToOptions(n):(n.duration??(n.duration=300),n.ease??(n.ease="easeOut"),n)}class nAe extends IU{constructor(n){if(super(),this.finishedTime=null,this.isStopped=!1,!n)return;const{element:s,name:a,keyframes:l,pseudoElement:d,allowFlatten:f=!1,finalKeyframe:E,onComplete:S}=n;this.isPseudoElement=!!d,this.allowFlatten=f,this.options=n,gU(typeof n.type!="string");const T=tAe(n);this.animation=eAe(s,a,l,T,d),T.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!d){const C=bU(l,this.options,E,this.speed);this.updateMotionValue?this.updateMotionValue(C):JIe(s,a,C),this.animation.cancel()}S?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:n}=this;n==="idle"||n==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const n=this.animation.effect?.getComputedTiming?.().duration||0;return sl(Number(n))}get iterationDuration(){const{delay:n=0}=this.options||{};return this.duration+sl(n)}get time(){return sl(Number(this.animation.currentTime)||0)}set time(n){this.finishedTime=null,this.animation.currentTime=Sd(n)}get speed(){return this.animation.playbackRate}set speed(n){n<0&&(this.finishedTime=null),this.animation.playbackRate=n}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(n){this.animation.startTime=n}attachTimeline({timeline:n,observe:s}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,n&&$Ie()?(this.animation.timeline=n,cl):s(this)}}const eZ={anticipate:PQ,backInOut:NQ,circInOut:DQ};function rAe(i){return i in eZ}function iAe(i){typeof i.ease=="string"&&rAe(i.ease)&&(i.ease=eZ[i.ease])}const u7=10;class sAe extends nAe{constructor(n){iAe(n),qQ(n),super(n),n.startTime&&(this.startTime=n.startTime),this.options=n}updateMotionValue(n){const{motionValue:s,onUpdate:a,onComplete:l,element:d,...f}=this.options;if(!s)return;if(n!==void 0){s.set(n);return}const E=new AU({...f,autoplay:!1}),S=Sd(this.finishedTime??this.time);s.setWithVelocity(E.sample(S-u7).value,E.sample(S).value,u7),E.stop()}}const d7=(i,n)=>n==="zIndex"?!1:!!(typeof i=="number"||Array.isArray(i)||typeof i=="string"&&(hf.test(i)||i==="0")&&!i.startsWith("url("));function oAe(i){const n=i[0];if(i.length===1)return!0;for(let s=0;s<i.length;s++)if(i[s]!==n)return!0}function aAe(i,n,s,a){const l=i[0];if(l===null)return!1;if(n==="display"||n==="visibility")return!0;const d=i[i.length-1],f=d7(l,n),E=d7(d,n);return!f||!E?!1:oAe(i)||(s==="spring"||ZQ(s))&&a}function OM(i){i.duration=0,i.type="keyframes"}const cAe=new Set(["opacity","clipPath","filter","transform"]),lAe=_U(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function uAe(i){const{motionValue:n,name:s,repeatDelay:a,repeatType:l,damping:d,type:f}=i;if(!(n?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:S,transformTemplate:T}=n.owner.getProps();return lAe()&&s&&cAe.has(s)&&(s!=="transform"||!T)&&!S&&!a&&l!=="mirror"&&d!==0&&f!=="inertia"}const dAe=40;class hAe extends IU{constructor({autoplay:n=!0,delay:s=0,type:a="keyframes",repeat:l=0,repeatDelay:d=0,repeatType:f="loop",keyframes:E,name:S,motionValue:T,element:C,...I}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Na.now();const N={autoplay:n,delay:s,type:a,repeat:l,repeatDelay:d,repeatType:f,name:S,motionValue:T,element:C,...I},P=C?.KeyframeResolver||OU;this.keyframeResolver=new P(E,(W,x,B)=>this.onKeyframesResolved(W,x,N,!B),S,T,C),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(n,s,a,l){this.keyframeResolver=void 0;const{name:d,type:f,velocity:E,delay:S,isHandoff:T,onUpdate:C}=a;this.resolvedAt=Na.now(),aAe(n,d,f,E)||((Rh.instantAnimations||!S)&&C?.(bU(n,a,s)),n[0]=n[n.length-1],OM(a),a.repeat=0);const N={startTime:l?this.resolvedAt?this.resolvedAt-this.createdAt>dAe?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:s,...a,keyframes:n},P=!T&&uAe(N)?new sAe({...N,element:N.motionValue.owner.current}):new AU(N);P.finished.then(()=>this.notifyFinished()).catch(cl),this.pendingTimeline&&(this.stopTimeline=P.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=P}get finished(){return this._animation?this.animation.finished:this._finished}then(n,s){return this.finished.finally(n).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),qIe()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(n){this.animation.time=n}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(n){this.animation.speed=n}get startTime(){return this.animation.startTime}attachTimeline(n){return this._animation?this.stopTimeline=this.animation.attachTimeline(n):this.pendingTimeline=n,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const pAe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function fAe(i){const n=pAe.exec(i);if(!n)return[,];const[,s,a,l]=n;return[`--${s??a}`,l]}function tZ(i,n,s=1){const[a,l]=fAe(i);if(!a)return;const d=window.getComputedStyle(n).getPropertyValue(a);if(d){const f=d.trim();return TQ(f)?parseFloat(f):f}return SU(l)?tZ(l,n,s+1):l}function NU(i,n){return i?.[n]??i?.default??i}const nZ=new Set(["width","height","top","left","right","bottom",...Ev]),mAe={test:i=>i==="auto",parse:i=>i},rZ=i=>n=>n.test(i),iZ=[_v,vn,Td,Hp,oIe,sIe,mAe],h7=i=>iZ.find(rZ(i));function gAe(i){return typeof i=="number"?i===0:i!==null?i==="none"||i==="0"||CQ(i):!0}const _Ae=new Set(["brightness","contrast","saturate","opacity"]);function EAe(i){const[n,s]=i.slice(0,-1).split("(");if(n==="drop-shadow")return i;const[a]=s.match(TU)||[];if(!a)return i;const l=s.replace(a,"");let d=_Ae.has(n)?1:0;return a!==s&&(d*=100),n+"("+d+l+")"}const yAe=/\b([a-z-]*)\(.*?\)/gu,NM={...hf,getAnimatableNone:i=>{const n=i.match(yAe);return n?n.map(EAe).join(" "):i}},p7={..._v,transform:Math.round},vAe={rotate:Hp,rotateX:Hp,rotateY:Hp,rotateZ:Hp,scale:oA,scaleX:oA,scaleY:oA,scaleZ:oA,skew:Hp,skewX:Hp,skewY:Hp,distance:vn,translateX:vn,translateY:vn,translateZ:vn,x:vn,y:vn,z:vn,perspective:vn,transformPerspective:vn,opacity:vw,originX:e7,originY:e7,originZ:vn},PU={borderWidth:vn,borderTopWidth:vn,borderRightWidth:vn,borderBottomWidth:vn,borderLeftWidth:vn,borderRadius:vn,radius:vn,borderTopLeftRadius:vn,borderTopRightRadius:vn,borderBottomRightRadius:vn,borderBottomLeftRadius:vn,width:vn,maxWidth:vn,height:vn,maxHeight:vn,top:vn,right:vn,bottom:vn,left:vn,padding:vn,paddingTop:vn,paddingRight:vn,paddingBottom:vn,paddingLeft:vn,margin:vn,marginTop:vn,marginRight:vn,marginBottom:vn,marginLeft:vn,backgroundPositionX:vn,backgroundPositionY:vn,...vAe,zIndex:p7,fillOpacity:vw,strokeOpacity:vw,numOctaves:p7},SAe={...PU,color:Ts,backgroundColor:Ts,outlineColor:Ts,fill:Ts,stroke:Ts,borderColor:Ts,borderTopColor:Ts,borderRightColor:Ts,borderBottomColor:Ts,borderLeftColor:Ts,filter:NM,WebkitFilter:NM},sZ=i=>SAe[i];function oZ(i,n){let s=sZ(i);return s!==NM&&(s=hf),s.getAnimatableNone?s.getAnimatableNone(n):void 0}const TAe=new Set(["auto","none","0"]);function wAe(i,n,s){let a=0,l;for(;a<i.length&&!l;){const d=i[a];typeof d=="string"&&!TAe.has(d)&&Sw(d).values.length&&(l=i[a]),a++}if(l&&s)for(const d of n)i[d]=oZ(s,l)}class CAe extends OU{constructor(n,s,a,l,d){super(n,s,a,l,d,!0)}readKeyframes(){const{unresolvedKeyframes:n,element:s,name:a}=this;if(!s||!s.current)return;super.readKeyframes();for(let S=0;S<n.length;S++){let T=n[S];if(typeof T=="string"&&(T=T.trim(),SU(T))){const C=tZ(T,s.current);C!==void 0&&(n[S]=C),S===n.length-1&&(this.finalKeyframe=T)}}if(this.resolveNoneKeyframes(),!nZ.has(a)||n.length!==2)return;const[l,d]=n,f=h7(l),E=h7(d);if(f!==E)if(c7(f)&&c7(E))for(let S=0;S<n.length;S++){const T=n[S];typeof T=="string"&&(n[S]=parseFloat(T))}else Ig[a]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:n,name:s}=this,a=[];for(let l=0;l<n.length;l++)(n[l]===null||gAe(n[l]))&&a.push(l);a.length&&wAe(n,a,s)}measureInitialState(){const{element:n,unresolvedKeyframes:s,name:a}=this;if(!n||!n.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Ig[a](n.measureViewportBox(),window.getComputedStyle(n.current)),s[0]=this.measuredOrigin;const l=s[s.length-1];l!==void 0&&n.getValue(a,l).jump(l,!1)}measureEndState(){const{element:n,name:s,unresolvedKeyframes:a}=this;if(!n||!n.current)return;const l=n.getValue(s);l&&l.jump(this.measuredOrigin,!1);const d=a.length-1,f=a[d];a[d]=Ig[s](n.measureViewportBox(),window.getComputedStyle(n.current)),f!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=f),this.removedTransforms?.length&&this.removedTransforms.forEach(([E,S])=>{n.getValue(E).set(S)}),this.resolveNoneKeyframes()}}function RAe(i,n,s){if(i instanceof EventTarget)return[i];if(typeof i=="string"){let a=document;const l=s?.[i]??a.querySelectorAll(i);return l?Array.from(l):[]}return Array.from(i)}const aZ=(i,n)=>n&&typeof i=="number"?n.transform(i):i;function cZ(i){return wQ(i)&&"offsetHeight"in i}const f7=30,bAe=i=>!isNaN(parseFloat(i));class IAe{constructor(n,s={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=a=>{const l=Na.now();if(this.updatedAt!==l&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const d of this.dependents)d.dirty()},this.hasAnimated=!1,this.setCurrent(n),this.owner=s.owner}setCurrent(n){this.current=n,this.updatedAt=Na.now(),this.canTrackVelocity===null&&n!==void 0&&(this.canTrackVelocity=bAe(this.current))}setPrevFrameValue(n=this.current){this.prevFrameValue=n,this.prevUpdatedAt=this.updatedAt}onChange(n){return this.on("change",n)}on(n,s){this.events[n]||(this.events[n]=new EU);const a=this.events[n].add(s);return n==="change"?()=>{a(),Fi.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const n in this.events)this.events[n].clear()}attach(n,s){this.passiveEffect=n,this.stopPassiveEffect=s}set(n){this.passiveEffect?this.passiveEffect(n,this.updateAndNotify):this.updateAndNotify(n)}setWithVelocity(n,s,a){this.set(s),this.prev=void 0,this.prevFrameValue=n,this.prevUpdatedAt=this.updatedAt-a}jump(n,s=!0){this.updateAndNotify(n),this.prev=n,this.prevUpdatedAt=this.prevFrameValue=void 0,s&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(n){this.dependents||(this.dependents=new Set),this.dependents.add(n)}removeDependent(n){this.dependents&&this.dependents.delete(n)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const n=Na.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||n-this.updatedAt>f7)return 0;const s=Math.min(this.updatedAt-this.prevUpdatedAt,f7);return RQ(parseFloat(this.current)-parseFloat(this.prevFrameValue),s)}start(n){return this.stop(),new Promise(s=>{this.hasAnimated=!0,this.animation=n(s),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function $y(i,n){return new IAe(i,n)}const{schedule:kU}=MQ(queueMicrotask,!1),ou={x:!1,y:!1};function lZ(){return ou.x||ou.y}function AAe(i){return i==="x"||i==="y"?ou[i]?null:(ou[i]=!0,()=>{ou[i]=!1}):ou.x||ou.y?null:(ou.x=ou.y=!0,()=>{ou.x=ou.y=!1})}function uZ(i,n){const s=RAe(i),a=new AbortController,l={passive:!0,...n,signal:a.signal};return[s,l,()=>a.abort()]}function m7(i){return!(i.pointerType==="touch"||lZ())}function OAe(i,n,s={}){const[a,l,d]=uZ(i,s),f=E=>{if(!m7(E))return;const{target:S}=E,T=n(S,E);if(typeof T!="function"||!S)return;const C=I=>{m7(I)&&(T(I),S.removeEventListener("pointerleave",C))};S.addEventListener("pointerleave",C,l)};return a.forEach(E=>{E.addEventListener("pointerenter",f,l)}),d}const dZ=(i,n)=>n?i===n?!0:dZ(i,n.parentElement):!1,DU=i=>i.pointerType==="mouse"?typeof i.button!="number"||i.button<=0:i.isPrimary!==!1,NAe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function PAe(i){return NAe.has(i.tagName)||i.tabIndex!==-1}const IA=new WeakSet;function g7(i){return n=>{n.key==="Enter"&&i(n)}}function aL(i,n){i.dispatchEvent(new PointerEvent("pointer"+n,{isPrimary:!0,bubbles:!0}))}const kAe=(i,n)=>{const s=i.currentTarget;if(!s)return;const a=g7(()=>{if(IA.has(s))return;aL(s,"down");const l=g7(()=>{aL(s,"up")}),d=()=>aL(s,"cancel");s.addEventListener("keyup",l,n),s.addEventListener("blur",d,n)});s.addEventListener("keydown",a,n),s.addEventListener("blur",()=>s.removeEventListener("keydown",a),n)};function _7(i){return DU(i)&&!lZ()}function DAe(i,n,s={}){const[a,l,d]=uZ(i,s),f=E=>{const S=E.currentTarget;if(!_7(E))return;IA.add(S);const T=n(S,E),C=(P,W)=>{window.removeEventListener("pointerup",I),window.removeEventListener("pointercancel",N),IA.has(S)&&IA.delete(S),_7(P)&&typeof T=="function"&&T(P,{success:W})},I=P=>{C(P,S===window||S===document||s.useGlobalTarget||dZ(S,P.target))},N=P=>{C(P,!1)};window.addEventListener("pointerup",I,l),window.addEventListener("pointercancel",N,l)};return a.forEach(E=>{(s.useGlobalTarget?window:E).addEventListener("pointerdown",f,l),cZ(E)&&(E.addEventListener("focus",T=>kAe(T,l)),!PAe(E)&&!E.hasAttribute("tabindex")&&(E.tabIndex=0))}),d}function hZ(i){return wQ(i)&&"ownerSVGElement"in i}function xAe(i){return hZ(i)&&i.tagName==="svg"}const Lo=i=>!!(i&&i.getVelocity),LAe=[...iZ,Ts,hf],MAe=i=>LAe.find(rZ(i)),xU=H.createContext({transformPagePoint:i=>i,isStatic:!1,reducedMotion:"never"});function E7(i,n){if(typeof i=="function")return i(n);i!=null&&(i.current=n)}function UAe(...i){return n=>{let s=!1;const a=i.map(l=>{const d=E7(l,n);return!s&&typeof d=="function"&&(s=!0),d});if(s)return()=>{for(let l=0;l<a.length;l++){const d=a[l];typeof d=="function"?d():E7(i[l],null)}}}}function VAe(...i){return H.useCallback(UAe(...i),i)}class FAe extends H.Component{getSnapshotBeforeUpdate(n){const s=this.props.childRef.current;if(s&&n.isPresent&&!this.props.isPresent){const a=s.offsetParent,l=cZ(a)&&a.offsetWidth||0,d=this.props.sizeRef.current;d.height=s.offsetHeight||0,d.width=s.offsetWidth||0,d.top=s.offsetTop,d.left=s.offsetLeft,d.right=l-d.width-d.left}return null}componentDidUpdate(){}render(){return this.props.children}}function jAe({children:i,isPresent:n,anchorX:s,root:a}){const l=H.useId(),d=H.useRef(null),f=H.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:E}=H.useContext(xU),S=VAe(d,i?.ref);return H.useInsertionEffect(()=>{const{width:T,height:C,top:I,left:N,right:P}=f.current;if(n||!d.current||!T||!C)return;const W=s==="left"?`left: ${N}`:`right: ${P}`;d.current.dataset.motionPopId=l;const x=document.createElement("style");E&&(x.nonce=E);const B=a??document.head;return B.appendChild(x),x.sheet&&x.sheet.insertRule(`
          [data-motion-pop-id="${l}"] {
            position: absolute !important;
            width: ${T}px !important;
            height: ${C}px !important;
            ${W}px !important;
            top: ${I}px !important;
          }
        `),()=>{B.contains(x)&&B.removeChild(x)}},[n]),D.jsx(FAe,{isPresent:n,childRef:d,sizeRef:f,children:H.cloneElement(i,{ref:S})})}const BAe=({children:i,initial:n,isPresent:s,onExitComplete:a,custom:l,presenceAffectsLayout:d,mode:f,anchorX:E,root:S})=>{const T=hU(WAe),C=H.useId();let I=!0,N=H.useMemo(()=>(I=!1,{id:C,initial:n,isPresent:s,custom:l,onExitComplete:P=>{T.set(P,!0);for(const W of T.values())if(!W)return;a&&a()},register:P=>(T.set(P,!1),()=>T.delete(P))}),[s,T,a]);return d&&I&&(N={...N}),H.useMemo(()=>{T.forEach((P,W)=>T.set(W,!1))},[s]),H.useEffect(()=>{!s&&!T.size&&a&&a()},[s]),f==="popLayout"&&(i=D.jsx(jAe,{isPresent:s,anchorX:E,root:S,children:i})),D.jsx(XO.Provider,{value:N,children:i})};function WAe(){return new Map}function pZ(i=!0){const n=H.useContext(XO);if(n===null)return[!0,null];const{isPresent:s,onExitComplete:a,register:l}=n,d=H.useId();H.useEffect(()=>{if(i)return l(d)},[i]);const f=H.useCallback(()=>i&&a&&a(d),[d,a,i]);return!s&&a?[!1,f]:[!0]}const aA=i=>i.key||"";function y7(i){const n=[];return H.Children.forEach(i,s=>{H.isValidElement(s)&&n.push(s)}),n}const LU=({children:i,custom:n,initial:s=!0,onExitComplete:a,presenceAffectsLayout:l=!0,mode:d="sync",propagate:f=!1,anchorX:E="left",root:S})=>{const[T,C]=pZ(f),I=H.useMemo(()=>y7(i),[i]),N=f&&!T?[]:I.map(aA),P=H.useRef(!0),W=H.useRef(I),x=hU(()=>new Map),[B,X]=H.useState(I),[Z,$]=H.useState(I);SQ(()=>{P.current=!1,W.current=I;for(let le=0;le<Z.length;le++){const ne=aA(Z[le]);N.includes(ne)?x.delete(ne):x.get(ne)!==!0&&x.set(ne,!1)}},[Z,N.length,N.join("-")]);const ae=[];if(I!==B){let le=[...I];for(let ne=0;ne<Z.length;ne++){const fe=Z[ne],Se=aA(fe);N.includes(Se)||(le.splice(ne,0,fe),ae.push(fe))}return d==="wait"&&ae.length&&(le=ae),$(y7(le)),X(I),null}const{forceRender:ce}=H.useContext(dU);return D.jsx(D.Fragment,{children:Z.map(le=>{const ne=aA(le),fe=f&&!T?!1:I===Z||N.includes(ne),Se=()=>{if(x.has(ne))x.set(ne,!0);else return;let De=!0;x.forEach(be=>{be||(De=!1)}),De&&(ce?.(),$(W.current),f&&C?.(),a&&a())};return D.jsx(BAe,{isPresent:fe,initial:!P.current||s?void 0:!1,custom:n,presenceAffectsLayout:l,mode:d,root:S,onExitComplete:fe?void 0:Se,anchorX:E,children:le},ne)})})},fZ=H.createContext({strict:!1}),v7={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Qy={};for(const i in v7)Qy[i]={isEnabled:n=>v7[i].some(s=>!!n[s])};function GAe(i){for(const n in i)Qy[n]={...Qy[n],...i[n]}}const HAe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function cO(i){return i.startsWith("while")||i.startsWith("drag")&&i!=="draggable"||i.startsWith("layout")||i.startsWith("onTap")||i.startsWith("onPan")||i.startsWith("onLayout")||HAe.has(i)}let mZ=i=>!cO(i);function zAe(i){typeof i=="function"&&(mZ=n=>n.startsWith("on")?!cO(n):i(n))}try{zAe(require("@emotion/is-prop-valid").default)}catch{}function KAe(i,n,s){const a={};for(const l in i)l==="values"&&typeof i.values=="object"||(mZ(l)||s===!0&&cO(l)||!n&&!cO(l)||i.draggable&&l.startsWith("onDrag"))&&(a[l]=i[l]);return a}const JO=H.createContext({});function $O(i){return i!==null&&typeof i=="object"&&typeof i.start=="function"}function Tw(i){return typeof i=="string"||Array.isArray(i)}const MU=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],UU=["initial",...MU];function QO(i){return $O(i.animate)||UU.some(n=>Tw(i[n]))}function gZ(i){return!!(QO(i)||i.variants)}function YAe(i,n){if(QO(i)){const{initial:s,animate:a}=i;return{initial:s===!1||Tw(s)?s:void 0,animate:Tw(a)?a:void 0}}return i.inherit!==!1?n:{}}function qAe(i){const{initial:n,animate:s}=YAe(i,H.useContext(JO));return H.useMemo(()=>({initial:n,animate:s}),[S7(n),S7(s)])}function S7(i){return Array.isArray(i)?i.join(" "):i}function T7(i,n){return n.max===n.min?0:i/(n.max-n.min)*100}const A0={correct:(i,n)=>{if(!n.target)return i;if(typeof i=="string")if(vn.test(i))i=parseFloat(i);else return i;const s=T7(i,n.target.x),a=T7(i,n.target.y);return`${s}% ${a}%`}},XAe={correct:(i,{treeScale:n,projectionDelta:s})=>{const a=i,l=hf.parse(i);if(l.length>5)return a;const d=hf.createTransformer(i),f=typeof l[0]!="number"?1:0,E=s.x.scale*n.x,S=s.y.scale*n.y;l[0+f]/=E,l[1+f]/=S;const T=Xi(E,S,.5);return typeof l[2+f]=="number"&&(l[2+f]/=T),typeof l[3+f]=="number"&&(l[3+f]/=T),d(l)}},PM={borderRadius:{...A0,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:A0,borderTopRightRadius:A0,borderBottomLeftRadius:A0,borderBottomRightRadius:A0,boxShadow:XAe};function _Z(i,{layout:n,layoutId:s}){return yv.has(i)||i.startsWith("origin")||(n||s!==void 0)&&(!!PM[i]||i==="opacity")}const JAe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},$Ae=Ev.length;function QAe(i,n,s){let a="",l=!0;for(let d=0;d<$Ae;d++){const f=Ev[d],E=i[f];if(E===void 0)continue;let S=!0;if(typeof E=="number"?S=E===(f.startsWith("scale")?1:0):S=parseFloat(E)===0,!S||s){const T=aZ(E,PU[f]);if(!S){l=!1;const C=JAe[f]||f;a+=`${C}(${T}) `}s&&(n[f]=T)}}return a=a.trim(),s?a=s(n,l?"":a):l&&(a="none"),a}function VU(i,n,s){const{style:a,vars:l,transformOrigin:d}=i;let f=!1,E=!1;for(const S in n){const T=n[S];if(yv.has(S)){f=!0;continue}else if(VQ(S)){l[S]=T;continue}else{const C=aZ(T,PU[S]);S.startsWith("origin")?(E=!0,d[S]=C):a[S]=C}}if(n.transform||(f||s?a.transform=QAe(n,i.transform,s):a.transform&&(a.transform="none")),E){const{originX:S="50%",originY:T="50%",originZ:C=0}=d;a.transformOrigin=`${S} ${T} ${C}`}}const FU=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function EZ(i,n,s){for(const a in n)!Lo(n[a])&&!_Z(a,s)&&(i[a]=n[a])}function ZAe({transformTemplate:i},n){return H.useMemo(()=>{const s=FU();return VU(s,n,i),Object.assign({},s.vars,s.style)},[n])}function eOe(i,n){const s=i.style||{},a={};return EZ(a,s,i),Object.assign(a,ZAe(i,n)),a}function tOe(i,n){const s={},a=eOe(i,n);return i.drag&&i.dragListener!==!1&&(s.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=i.drag===!0?"none":`pan-${i.drag==="x"?"y":"x"}`),i.tabIndex===void 0&&(i.onTap||i.onTapStart||i.whileTap)&&(s.tabIndex=0),s.style=a,s}const nOe={offset:"stroke-dashoffset",array:"stroke-dasharray"},rOe={offset:"strokeDashoffset",array:"strokeDasharray"};function iOe(i,n,s=1,a=0,l=!0){i.pathLength=1;const d=l?nOe:rOe;i[d.offset]=vn.transform(-a);const f=vn.transform(n),E=vn.transform(s);i[d.array]=`${f} ${E}`}function yZ(i,{attrX:n,attrY:s,attrScale:a,pathLength:l,pathSpacing:d=1,pathOffset:f=0,...E},S,T,C){if(VU(i,E,T),S){i.style.viewBox&&(i.attrs.viewBox=i.style.viewBox);return}i.attrs=i.style,i.style={};const{attrs:I,style:N}=i;I.transform&&(N.transform=I.transform,delete I.transform),(N.transform||I.transformOrigin)&&(N.transformOrigin=I.transformOrigin??"50% 50%",delete I.transformOrigin),N.transform&&(N.transformBox=C?.transformBox??"fill-box",delete I.transformBox),n!==void 0&&(I.x=n),s!==void 0&&(I.y=s),a!==void 0&&(I.scale=a),l!==void 0&&iOe(I,l,d,f,!1)}const vZ=()=>({...FU(),attrs:{}}),SZ=i=>typeof i=="string"&&i.toLowerCase()==="svg";function sOe(i,n,s,a){const l=H.useMemo(()=>{const d=vZ();return yZ(d,n,SZ(a),i.transformTemplate,i.style),{...d.attrs,style:{...d.style}}},[n]);if(i.style){const d={};EZ(d,i.style,i),l.style={...d,...l.style}}return l}const oOe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function jU(i){return typeof i!="string"||i.includes("-")?!1:!!(oOe.indexOf(i)>-1||/[A-Z]/u.test(i))}function aOe(i,n,s,{latestValues:a},l,d=!1){const E=(jU(i)?sOe:tOe)(n,a,l,i),S=KAe(n,typeof i=="string",d),T=i!==H.Fragment?{...S,...E,ref:s}:{},{children:C}=n,I=H.useMemo(()=>Lo(C)?C.get():C,[C]);return H.createElement(i,{...T,children:I})}function w7(i){const n=[{},{}];return i?.values.forEach((s,a)=>{n[0][a]=s.get(),n[1][a]=s.getVelocity()}),n}function BU(i,n,s,a){if(typeof n=="function"){const[l,d]=w7(a);n=n(s!==void 0?s:i.custom,l,d)}if(typeof n=="string"&&(n=i.variants&&i.variants[n]),typeof n=="function"){const[l,d]=w7(a);n=n(s!==void 0?s:i.custom,l,d)}return n}function AA(i){return Lo(i)?i.get():i}function cOe({scrapeMotionValuesFromProps:i,createRenderState:n},s,a,l){return{latestValues:lOe(s,a,l,i),renderState:n()}}function lOe(i,n,s,a){const l={},d=a(i,{});for(const N in d)l[N]=AA(d[N]);let{initial:f,animate:E}=i;const S=QO(i),T=gZ(i);n&&T&&!S&&i.inherit!==!1&&(f===void 0&&(f=n.initial),E===void 0&&(E=n.animate));let C=s?s.initial===!1:!1;C=C||f===!1;const I=C?E:f;if(I&&typeof I!="boolean"&&!$O(I)){const N=Array.isArray(I)?I:[I];for(let P=0;P<N.length;P++){const W=BU(i,N[P]);if(W){const{transitionEnd:x,transition:B,...X}=W;for(const Z in X){let $=X[Z];if(Array.isArray($)){const ae=C?$.length-1:0;$=$[ae]}$!==null&&(l[Z]=$)}for(const Z in x)l[Z]=x[Z]}}}return l}const TZ=i=>(n,s)=>{const a=H.useContext(JO),l=H.useContext(XO),d=()=>cOe(i,n,a,l);return s?d():hU(d)};function WU(i,n,s){const{style:a}=i,l={};for(const d in a)(Lo(a[d])||n.style&&Lo(n.style[d])||_Z(d,i)||s?.getValue(d)?.liveStyle!==void 0)&&(l[d]=a[d]);return l}const uOe=TZ({scrapeMotionValuesFromProps:WU,createRenderState:FU});function wZ(i,n,s){const a=WU(i,n,s);for(const l in i)if(Lo(i[l])||Lo(n[l])){const d=Ev.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;a[d]=i[l]}return a}const dOe=TZ({scrapeMotionValuesFromProps:wZ,createRenderState:vZ}),hOe=Symbol.for("motionComponentSymbol");function Iy(i){return i&&typeof i=="object"&&Object.prototype.hasOwnProperty.call(i,"current")}function pOe(i,n,s){return H.useCallback(a=>{a&&i.onMount&&i.onMount(a),n&&(a?n.mount(a):n.unmount()),s&&(typeof s=="function"?s(a):Iy(s)&&(s.current=a))},[n])}const GU=i=>i.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),fOe="framerAppearId",CZ="data-"+GU(fOe),RZ=H.createContext({});function mOe(i,n,s,a,l){const{visualElement:d}=H.useContext(JO),f=H.useContext(fZ),E=H.useContext(XO),S=H.useContext(xU).reducedMotion,T=H.useRef(null);a=a||f.renderer,!T.current&&a&&(T.current=a(i,{visualState:n,parent:d,props:s,presenceContext:E,blockInitialAnimation:E?E.initial===!1:!1,reducedMotionConfig:S}));const C=T.current,I=H.useContext(RZ);C&&!C.projection&&l&&(C.type==="html"||C.type==="svg")&&gOe(T.current,s,l,I);const N=H.useRef(!1);H.useInsertionEffect(()=>{C&&N.current&&C.update(s,E)});const P=s[CZ],W=H.useRef(!!P&&!window.MotionHandoffIsComplete?.(P)&&window.MotionHasOptimisedAnimation?.(P));return SQ(()=>{C&&(N.current=!0,window.MotionIsMounted=!0,C.updateFeatures(),C.scheduleRenderMicrotask(),W.current&&C.animationState&&C.animationState.animateChanges())}),H.useEffect(()=>{C&&(!W.current&&C.animationState&&C.animationState.animateChanges(),W.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(P)}),W.current=!1),C.enteringChildren=void 0)}),C}function gOe(i,n,s,a){const{layoutId:l,layout:d,drag:f,dragConstraints:E,layoutScroll:S,layoutRoot:T,layoutCrossfade:C}=n;i.projection=new s(i.latestValues,n["data-framer-portal-id"]?void 0:bZ(i.parent)),i.projection.setOptions({layoutId:l,layout:d,alwaysMeasureLayout:!!f||E&&Iy(E),visualElement:i,animationType:typeof d=="string"?d:"both",initialPromotionConfig:a,crossfade:C,layoutScroll:S,layoutRoot:T})}function bZ(i){if(i)return i.options.allowProjection!==!1?i.projection:bZ(i.parent)}function cL(i,{forwardMotionProps:n=!1}={},s,a){s&&GAe(s);const l=jU(i)?dOe:uOe;function d(E,S){let T;const C={...H.useContext(xU),...E,layoutId:_Oe(E)},{isStatic:I}=C,N=qAe(E),P=l(E,I);if(!I&&pU){EOe();const W=yOe(C);T=W.MeasureLayout,N.visualElement=mOe(i,P,C,a,W.ProjectionNode)}return D.jsxs(JO.Provider,{value:N,children:[T&&N.visualElement?D.jsx(T,{visualElement:N.visualElement,...C}):null,aOe(i,E,pOe(P,N.visualElement,S),P,I,n)]})}d.displayName=`motion.${typeof i=="string"?i:`create(${i.displayName??i.name??""})`}`;const f=H.forwardRef(d);return f[hOe]=i,f}function _Oe({layoutId:i}){const n=H.useContext(dU).id;return n&&i!==void 0?n+"-"+i:i}function EOe(i,n){H.useContext(fZ).strict}function yOe(i){const{drag:n,layout:s}=Qy;if(!n&&!s)return{};const a={...n,...s};return{MeasureLayout:n?.isEnabled(i)||s?.isEnabled(i)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}function vOe(i,n){if(typeof Proxy>"u")return cL;const s=new Map,a=(d,f)=>cL(d,f,i,n),l=(d,f)=>a(d,f);return new Proxy(l,{get:(d,f)=>f==="create"?a:(s.has(f)||s.set(f,cL(f,void 0,i,n)),s.get(f))})}function IZ({top:i,left:n,right:s,bottom:a}){return{x:{min:n,max:s},y:{min:i,max:a}}}function SOe({x:i,y:n}){return{top:n.min,right:i.max,bottom:n.max,left:i.min}}function TOe(i,n){if(!n)return i;const s=n({x:i.left,y:i.top}),a=n({x:i.right,y:i.bottom});return{top:s.y,left:s.x,bottom:a.y,right:a.x}}function lL(i){return i===void 0||i===1}function kM({scale:i,scaleX:n,scaleY:s}){return!lL(i)||!lL(n)||!lL(s)}function gg(i){return kM(i)||AZ(i)||i.z||i.rotate||i.rotateX||i.rotateY||i.skewX||i.skewY}function AZ(i){return C7(i.x)||C7(i.y)}function C7(i){return i&&i!=="0%"}function lO(i,n,s){const a=i-s,l=n*a;return s+l}function R7(i,n,s,a,l){return l!==void 0&&(i=lO(i,l,a)),lO(i,s,a)+n}function DM(i,n=0,s=1,a,l){i.min=R7(i.min,n,s,a,l),i.max=R7(i.max,n,s,a,l)}function OZ(i,{x:n,y:s}){DM(i.x,n.translate,n.scale,n.originPoint),DM(i.y,s.translate,s.scale,s.originPoint)}const b7=.999999999999,I7=1.0000000000001;function wOe(i,n,s,a=!1){const l=s.length;if(!l)return;n.x=n.y=1;let d,f;for(let E=0;E<l;E++){d=s[E],f=d.projectionDelta;const{visualElement:S}=d.options;S&&S.props.style&&S.props.style.display==="contents"||(a&&d.options.layoutScroll&&d.scroll&&d!==d.root&&Oy(i,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),f&&(n.x*=f.x.scale,n.y*=f.y.scale,OZ(i,f)),a&&gg(d.latestValues)&&Oy(i,d.latestValues))}n.x<I7&&n.x>b7&&(n.x=1),n.y<I7&&n.y>b7&&(n.y=1)}function Ay(i,n){i.min=i.min+n,i.max=i.max+n}function A7(i,n,s,a,l=.5){const d=Xi(i.min,i.max,l);DM(i,n,s,d,a)}function Oy(i,n){A7(i.x,n.x,n.scaleX,n.scale,n.originX),A7(i.y,n.y,n.scaleY,n.scale,n.originY)}function NZ(i,n){return IZ(TOe(i.getBoundingClientRect(),n))}function COe(i,n,s){const a=NZ(i,s),{scroll:l}=n;return l&&(Ay(a.x,l.offset.x),Ay(a.y,l.offset.y)),a}const O7=()=>({translate:0,scale:1,origin:0,originPoint:0}),Ny=()=>({x:O7(),y:O7()}),N7=()=>({min:0,max:0}),xs=()=>({x:N7(),y:N7()}),xM={current:null},PZ={current:!1};function ROe(){if(PZ.current=!0,!!pU)if(window.matchMedia){const i=window.matchMedia("(prefers-reduced-motion)"),n=()=>xM.current=i.matches;i.addEventListener("change",n),n()}else xM.current=!1}const bOe=new WeakMap;function IOe(i,n,s){for(const a in n){const l=n[a],d=s[a];if(Lo(l))i.addValue(a,l);else if(Lo(d))i.addValue(a,$y(l,{owner:i}));else if(d!==l)if(i.hasValue(a)){const f=i.getValue(a);f.liveStyle===!0?f.jump(l):f.hasAnimated||f.set(l)}else{const f=i.getStaticValue(a);i.addValue(a,$y(f!==void 0?f:l,{owner:i}))}}for(const a in s)n[a]===void 0&&i.removeValue(a);return n}const P7=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class AOe{scrapeMotionValuesFromProps(n,s,a){return{}}constructor({parent:n,props:s,presenceContext:a,reducedMotionConfig:l,blockInitialAnimation:d,visualState:f},E={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=OU,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const N=Na.now();this.renderScheduledAt<N&&(this.renderScheduledAt=N,Fi.render(this.render,!1,!0))};const{latestValues:S,renderState:T}=f;this.latestValues=S,this.baseTarget={...S},this.initialValues=s.initial?{...S}:{},this.renderState=T,this.parent=n,this.props=s,this.presenceContext=a,this.depth=n?n.depth+1:0,this.reducedMotionConfig=l,this.options=E,this.blockInitialAnimation=!!d,this.isControllingVariants=QO(s),this.isVariantNode=gZ(s),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(n&&n.current);const{willChange:C,...I}=this.scrapeMotionValuesFromProps(s,{},this);for(const N in I){const P=I[N];S[N]!==void 0&&Lo(P)&&P.set(S[N])}}mount(n){this.current=n,bOe.set(n,this),this.projection&&!this.projection.instance&&this.projection.mount(n),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((s,a)=>this.bindToMotionValue(a,s)),PZ.current||ROe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:xM.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),df(this.notifyUpdate),df(this.render),this.valueSubscriptions.forEach(n=>n()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const n in this.events)this.events[n].clear();for(const n in this.features){const s=this.features[n];s&&(s.unmount(),s.isMounted=!1)}this.current=null}addChild(n){this.children.add(n),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(n)}removeChild(n){this.children.delete(n),this.enteringChildren&&this.enteringChildren.delete(n)}bindToMotionValue(n,s){this.valueSubscriptions.has(n)&&this.valueSubscriptions.get(n)();const a=yv.has(n);a&&this.onBindTransform&&this.onBindTransform();const l=s.on("change",f=>{this.latestValues[n]=f,this.props.onUpdate&&Fi.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let d;window.MotionCheckAppearSync&&(d=window.MotionCheckAppearSync(this,n,s)),this.valueSubscriptions.set(n,()=>{l(),d&&d(),s.owner&&s.stop()})}sortNodePosition(n){return!this.current||!this.sortInstanceNodePosition||this.type!==n.type?0:this.sortInstanceNodePosition(this.current,n.current)}updateFeatures(){let n="animation";for(n in Qy){const s=Qy[n];if(!s)continue;const{isEnabled:a,Feature:l}=s;if(!this.features[n]&&l&&a(this.props)&&(this.features[n]=new l(this)),this.features[n]){const d=this.features[n];d.isMounted?d.update():(d.mount(),d.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):xs()}getStaticValue(n){return this.latestValues[n]}setStaticValue(n,s){this.latestValues[n]=s}update(n,s){(n.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=n,this.prevPresenceContext=this.presenceContext,this.presenceContext=s;for(let a=0;a<P7.length;a++){const l=P7[a];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const d="on"+l,f=n[d];f&&(this.propEventSubscriptions[l]=this.on(l,f))}this.prevMotionValues=IOe(this,this.scrapeMotionValuesFromProps(n,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(n){return this.props.variants?this.props.variants[n]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(n){const s=this.getClosestVariantNode();if(s)return s.variantChildren&&s.variantChildren.add(n),()=>s.variantChildren.delete(n)}addValue(n,s){const a=this.values.get(n);s!==a&&(a&&this.removeValue(n),this.bindToMotionValue(n,s),this.values.set(n,s),this.latestValues[n]=s.get())}removeValue(n){this.values.delete(n);const s=this.valueSubscriptions.get(n);s&&(s(),this.valueSubscriptions.delete(n)),delete this.latestValues[n],this.removeValueFromRenderState(n,this.renderState)}hasValue(n){return this.values.has(n)}getValue(n,s){if(this.props.values&&this.props.values[n])return this.props.values[n];let a=this.values.get(n);return a===void 0&&s!==void 0&&(a=$y(s===null?void 0:s,{owner:this}),this.addValue(n,a)),a}readValue(n,s){let a=this.latestValues[n]!==void 0||!this.current?this.latestValues[n]:this.getBaseTargetFromProps(this.props,n)??this.readValueFromInstance(this.current,n,this.options);return a!=null&&(typeof a=="string"&&(TQ(a)||CQ(a))?a=parseFloat(a):!MAe(a)&&hf.test(s)&&(a=oZ(n,s)),this.setBaseTarget(n,Lo(a)?a.get():a)),Lo(a)?a.get():a}setBaseTarget(n,s){this.baseTarget[n]=s}getBaseTarget(n){const{initial:s}=this.props;let a;if(typeof s=="string"||typeof s=="object"){const d=BU(this.props,s,this.presenceContext?.custom);d&&(a=d[n])}if(s&&a!==void 0)return a;const l=this.getBaseTargetFromProps(this.props,n);return l!==void 0&&!Lo(l)?l:this.initialValues[n]!==void 0&&a===void 0?void 0:this.baseTarget[n]}on(n,s){return this.events[n]||(this.events[n]=new EU),this.events[n].add(s)}notify(n,...s){this.events[n]&&this.events[n].notify(...s)}scheduleRenderMicrotask(){kU.render(this.render)}}class kZ extends AOe{constructor(){super(...arguments),this.KeyframeResolver=CAe}sortInstanceNodePosition(n,s){return n.compareDocumentPosition(s)&2?1:-1}getBaseTargetFromProps(n,s){return n.style?n.style[s]:void 0}removeValueFromRenderState(n,{vars:s,style:a}){delete s[n],delete a[n]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:n}=this.props;Lo(n)&&(this.childSubscription=n.on("change",s=>{this.current&&(this.current.textContent=`${s}`)}))}}function DZ(i,{style:n,vars:s},a,l){const d=i.style;let f;for(f in n)d[f]=n[f];l?.applyProjectionStyles(d,a);for(f in s)d.setProperty(f,s[f])}function OOe(i){return window.getComputedStyle(i)}class NOe extends kZ{constructor(){super(...arguments),this.type="html",this.renderInstance=DZ}readValueFromInstance(n,s){if(yv.has(s))return this.projection?.isProjecting?CM(s):GIe(n,s);{const a=OOe(n),l=(VQ(s)?a.getPropertyValue(s):a[s])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(n,{transformPagePoint:s}){return NZ(n,s)}build(n,s,a){VU(n,s,a.transformTemplate)}scrapeMotionValuesFromProps(n,s,a){return WU(n,s,a)}}const xZ=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function POe(i,n,s,a){DZ(i,n,void 0,a);for(const l in n.attrs)i.setAttribute(xZ.has(l)?l:GU(l),n.attrs[l])}class kOe extends kZ{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=xs}getBaseTargetFromProps(n,s){return n[s]}readValueFromInstance(n,s){if(yv.has(s)){const a=sZ(s);return a&&a.default||0}return s=xZ.has(s)?s:GU(s),n.getAttribute(s)}scrapeMotionValuesFromProps(n,s,a){return wZ(n,s,a)}build(n,s,a){yZ(n,s,this.isSVGTag,a.transformTemplate,a.style)}renderInstance(n,s,a,l){POe(n,s,a,l)}mount(n){this.isSVGTag=SZ(n.tagName),super.mount(n)}}const DOe=(i,n)=>jU(i)?new kOe(n):new NOe(n,{allowProjection:i!==H.Fragment});function Wy(i,n,s){const a=i.getProps();return BU(a,n,s!==void 0?s:a.custom,i)}const LM=i=>Array.isArray(i);function xOe(i,n,s){i.hasValue(n)?i.getValue(n).set(s):i.addValue(n,$y(s))}function LOe(i){return LM(i)?i[i.length-1]||0:i}function MOe(i,n){const s=Wy(i,n);let{transitionEnd:a={},transition:l={},...d}=s||{};d={...d,...a};for(const f in d){const E=LOe(d[f]);xOe(i,f,E)}}function UOe(i){return!!(Lo(i)&&i.add)}function MM(i,n){const s=i.getValue("willChange");if(UOe(s))return s.add(n);if(!s&&Rh.WillChange){const a=new Rh.WillChange("auto");i.addValue("willChange",a),a.add(n)}}function LZ(i){return i.props[CZ]}const VOe=i=>i!==null;function FOe(i,{repeat:n,repeatType:s="loop"},a){const l=i.filter(VOe),d=n&&s!=="loop"&&n%2===1?0:l.length-1;return l[d]}const jOe={type:"spring",stiffness:500,damping:25,restSpeed:10},BOe=i=>({type:"spring",stiffness:550,damping:i===0?2*Math.sqrt(550):30,restSpeed:10}),WOe={type:"keyframes",duration:.8},GOe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},HOe=(i,{keyframes:n})=>n.length>2?WOe:yv.has(i)?i.startsWith("scale")?BOe(n[1]):jOe:GOe;function zOe({when:i,delay:n,delayChildren:s,staggerChildren:a,staggerDirection:l,repeat:d,repeatType:f,repeatDelay:E,from:S,elapsed:T,...C}){return!!Object.keys(C).length}const HU=(i,n,s,a={},l,d)=>f=>{const E=NU(a,i)||{},S=E.delay||a.delay||0;let{elapsed:T=0}=a;T=T-Sd(S);const C={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:n.getVelocity(),...E,delay:-T,onUpdate:N=>{n.set(N),E.onUpdate&&E.onUpdate(N)},onComplete:()=>{f(),E.onComplete&&E.onComplete()},name:i,motionValue:n,element:d?void 0:l};zOe(E)||Object.assign(C,HOe(i,C)),C.duration&&(C.duration=Sd(C.duration)),C.repeatDelay&&(C.repeatDelay=Sd(C.repeatDelay)),C.from!==void 0&&(C.keyframes[0]=C.from);let I=!1;if((C.type===!1||C.duration===0&&!C.repeatDelay)&&(OM(C),C.delay===0&&(I=!0)),(Rh.instantAnimations||Rh.skipAnimations)&&(I=!0,OM(C),C.delay=0),C.allowFlatten=!E.type&&!E.ease,I&&!d&&n.get()!==void 0){const N=FOe(C.keyframes,E);if(N!==void 0){Fi.update(()=>{C.onUpdate(N),C.onComplete()});return}}return E.isSync?new AU(C):new hAe(C)};function KOe({protectedKeys:i,needsAnimating:n},s){const a=i.hasOwnProperty(s)&&n[s]!==!0;return n[s]=!1,a}function MZ(i,n,{delay:s=0,transitionOverride:a,type:l}={}){let{transition:d=i.getDefaultTransition(),transitionEnd:f,...E}=n;a&&(d=a);const S=[],T=l&&i.animationState&&i.animationState.getState()[l];for(const C in E){const I=i.getValue(C,i.latestValues[C]??null),N=E[C];if(N===void 0||T&&KOe(T,C))continue;const P={delay:s,...NU(d||{},C)},W=I.get();if(W!==void 0&&!I.isAnimating&&!Array.isArray(N)&&N===W&&!P.velocity)continue;let x=!1;if(window.MotionHandoffAnimation){const X=LZ(i);if(X){const Z=window.MotionHandoffAnimation(X,C,Fi);Z!==null&&(P.startTime=Z,x=!0)}}MM(i,C),I.start(HU(C,I,N,i.shouldReduceMotion&&nZ.has(C)?{type:!1}:P,i,x));const B=I.animation;B&&S.push(B)}return f&&Promise.all(S).then(()=>{Fi.update(()=>{f&&MOe(i,f)})}),S}function UZ(i,n,s,a=0,l=1){const d=Array.from(i).sort((T,C)=>T.sortNodePosition(C)).indexOf(n),f=i.size,E=(f-1)*a;return typeof s=="function"?s(d,f):l===1?d*a:E-d*a}function UM(i,n,s={}){const a=Wy(i,n,s.type==="exit"?i.presenceContext?.custom:void 0);let{transition:l=i.getDefaultTransition()||{}}=a||{};s.transitionOverride&&(l=s.transitionOverride);const d=a?()=>Promise.all(MZ(i,a,s)):()=>Promise.resolve(),f=i.variantChildren&&i.variantChildren.size?(S=0)=>{const{delayChildren:T=0,staggerChildren:C,staggerDirection:I}=l;return YOe(i,n,S,T,C,I,s)}:()=>Promise.resolve(),{when:E}=l;if(E){const[S,T]=E==="beforeChildren"?[d,f]:[f,d];return S().then(()=>T())}else return Promise.all([d(),f(s.delay)])}function YOe(i,n,s=0,a=0,l=0,d=1,f){const E=[];for(const S of i.variantChildren)S.notify("AnimationStart",n),E.push(UM(S,n,{...f,delay:s+(typeof a=="function"?0:a)+UZ(i.variantChildren,S,a,l,d)}).then(()=>S.notify("AnimationComplete",n)));return Promise.all(E)}function qOe(i,n,s={}){i.notify("AnimationStart",n);let a;if(Array.isArray(n)){const l=n.map(d=>UM(i,d,s));a=Promise.all(l)}else if(typeof n=="string")a=UM(i,n,s);else{const l=typeof n=="function"?Wy(i,n,s.custom):n;a=Promise.all(MZ(i,l,s))}return a.then(()=>{i.notify("AnimationComplete",n)})}function VZ(i,n){if(!Array.isArray(n))return!1;const s=n.length;if(s!==i.length)return!1;for(let a=0;a<s;a++)if(n[a]!==i[a])return!1;return!0}const XOe=UU.length;function FZ(i){if(!i)return;if(!i.isControllingVariants){const s=i.parent?FZ(i.parent)||{}:{};return i.props.initial!==void 0&&(s.initial=i.props.initial),s}const n={};for(let s=0;s<XOe;s++){const a=UU[s],l=i.props[a];(Tw(l)||l===!1)&&(n[a]=l)}return n}const JOe=[...MU].reverse(),$Oe=MU.length;function QOe(i){return n=>Promise.all(n.map(({animation:s,options:a})=>qOe(i,s,a)))}function ZOe(i){let n=QOe(i),s=k7(),a=!0;const l=S=>(T,C)=>{const I=Wy(i,C,S==="exit"?i.presenceContext?.custom:void 0);if(I){const{transition:N,transitionEnd:P,...W}=I;T={...T,...W,...P}}return T};function d(S){n=S(i)}function f(S){const{props:T}=i,C=FZ(i.parent)||{},I=[],N=new Set;let P={},W=1/0;for(let B=0;B<$Oe;B++){const X=JOe[B],Z=s[X],$=T[X]!==void 0?T[X]:C[X],ae=Tw($),ce=X===S?Z.isActive:null;ce===!1&&(W=B);let le=$===C[X]&&$!==T[X]&&ae;if(le&&a&&i.manuallyAnimateOnMount&&(le=!1),Z.protectedKeys={...P},!Z.isActive&&ce===null||!$&&!Z.prevProp||$O($)||typeof $=="boolean")continue;const ne=eNe(Z.prevProp,$);let fe=ne||X===S&&Z.isActive&&!le&&ae||B>W&&ae,Se=!1;const De=Array.isArray($)?$:[$];let be=De.reduce(l(X),{});ce===!1&&(be={});const{prevResolvedValues:ye={}}=Z,Ge={...ye,...be},Te=je=>{fe=!0,N.has(je)&&(Se=!0,N.delete(je)),Z.needsAnimating[je]=!0;const Ie=i.getValue(je);Ie&&(Ie.liveStyle=!1)};for(const je in Ge){const Ie=be[je],He=ye[je];if(P.hasOwnProperty(je))continue;let re=!1;LM(Ie)&&LM(He)?re=!VZ(Ie,He):re=Ie!==He,re?Ie!=null?Te(je):N.add(je):Ie!==void 0&&N.has(je)?Te(je):Z.protectedKeys[je]=!0}Z.prevProp=$,Z.prevResolvedValues=be,Z.isActive&&(P={...P,...be}),a&&i.blockInitialAnimation&&(fe=!1);const Fe=le&&ne;fe&&(!Fe||Se)&&I.push(...De.map(je=>{const Ie={type:X};if(typeof je=="string"&&a&&!Fe&&i.manuallyAnimateOnMount&&i.parent){const{parent:He}=i,re=Wy(He,je);if(He.enteringChildren&&re){const{delayChildren:ge}=re.transition||{};Ie.delay=UZ(He.enteringChildren,i,ge)}}return{animation:je,options:Ie}}))}if(N.size){const B={};if(typeof T.initial!="boolean"){const X=Wy(i,Array.isArray(T.initial)?T.initial[0]:T.initial);X&&X.transition&&(B.transition=X.transition)}N.forEach(X=>{const Z=i.getBaseTarget(X),$=i.getValue(X);$&&($.liveStyle=!0),B[X]=Z??null}),I.push({animation:B})}let x=!!I.length;return a&&(T.initial===!1||T.initial===T.animate)&&!i.manuallyAnimateOnMount&&(x=!1),a=!1,x?n(I):Promise.resolve()}function E(S,T){if(s[S].isActive===T)return Promise.resolve();i.variantChildren?.forEach(I=>I.animationState?.setActive(S,T)),s[S].isActive=T;const C=f(S);for(const I in s)s[I].protectedKeys={};return C}return{animateChanges:f,setActive:E,setAnimateFunction:d,getState:()=>s,reset:()=>{s=k7()}}}function eNe(i,n){return typeof n=="string"?n!==i:Array.isArray(n)?!VZ(n,i):!1}function hg(i=!1){return{isActive:i,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function k7(){return{animate:hg(!0),whileInView:hg(),whileHover:hg(),whileTap:hg(),whileDrag:hg(),whileFocus:hg(),exit:hg()}}class wf{constructor(n){this.isMounted=!1,this.node=n}update(){}}class tNe extends wf{constructor(n){super(n),n.animationState||(n.animationState=ZOe(n))}updateAnimationControlsSubscription(){const{animate:n}=this.node.getProps();$O(n)&&(this.unmountControls=n.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:n}=this.node.getProps(),{animate:s}=this.node.prevProps||{};n!==s&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let nNe=0;class rNe extends wf{constructor(){super(...arguments),this.id=nNe++}update(){if(!this.node.presenceContext)return;const{isPresent:n,onExitComplete:s}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||n===a)return;const l=this.node.animationState.setActive("exit",!n);s&&!n&&l.then(()=>{s(this.id)})}mount(){const{register:n,onExitComplete:s}=this.node.presenceContext||{};s&&s(this.id),n&&(this.unmount=n(this.id))}unmount(){}}const iNe={animation:{Feature:tNe},exit:{Feature:rNe}};function ww(i,n,s,a={passive:!0}){return i.addEventListener(n,s,a),()=>i.removeEventListener(n,s)}function Jw(i){return{point:{x:i.pageX,y:i.pageY}}}const sNe=i=>n=>DU(n)&&i(n,Jw(n));function Q0(i,n,s,a){return ww(i,n,sNe(s),a)}const jZ=1e-4,oNe=1-jZ,aNe=1+jZ,BZ=.01,cNe=0-BZ,lNe=0+BZ;function ea(i){return i.max-i.min}function uNe(i,n,s){return Math.abs(i-n)<=s}function D7(i,n,s,a=.5){i.origin=a,i.originPoint=Xi(n.min,n.max,i.origin),i.scale=ea(s)/ea(n),i.translate=Xi(s.min,s.max,i.origin)-i.originPoint,(i.scale>=oNe&&i.scale<=aNe||isNaN(i.scale))&&(i.scale=1),(i.translate>=cNe&&i.translate<=lNe||isNaN(i.translate))&&(i.translate=0)}function Z0(i,n,s,a){D7(i.x,n.x,s.x,a?a.originX:void 0),D7(i.y,n.y,s.y,a?a.originY:void 0)}function x7(i,n,s){i.min=s.min+n.min,i.max=i.min+ea(n)}function dNe(i,n,s){x7(i.x,n.x,s.x),x7(i.y,n.y,s.y)}function L7(i,n,s){i.min=n.min-s.min,i.max=i.min+ea(n)}function uO(i,n,s){L7(i.x,n.x,s.x),L7(i.y,n.y,s.y)}function nl(i){return[i("x"),i("y")]}const WZ=({current:i})=>i?i.ownerDocument.defaultView:null,M7=(i,n)=>Math.abs(i-n);function hNe(i,n){const s=M7(i.x,n.x),a=M7(i.y,n.y);return Math.sqrt(s**2+a**2)}class GZ{constructor(n,s,{transformPagePoint:a,contextWindow:l=window,dragSnapToOrigin:d=!1,distanceThreshold:f=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const N=dL(this.lastMoveEventInfo,this.history),P=this.startEvent!==null,W=hNe(N.offset,{x:0,y:0})>=this.distanceThreshold;if(!P&&!W)return;const{point:x}=N,{timestamp:B}=go;this.history.push({...x,timestamp:B});const{onStart:X,onMove:Z}=this.handlers;P||(X&&X(this.lastMoveEvent,N),this.startEvent=this.lastMoveEvent),Z&&Z(this.lastMoveEvent,N)},this.handlePointerMove=(N,P)=>{this.lastMoveEvent=N,this.lastMoveEventInfo=uL(P,this.transformPagePoint),Fi.update(this.updatePoint,!0)},this.handlePointerUp=(N,P)=>{this.end();const{onEnd:W,onSessionEnd:x,resumeAnimation:B}=this.handlers;if(this.dragSnapToOrigin&&B&&B(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const X=dL(N.type==="pointercancel"?this.lastMoveEventInfo:uL(P,this.transformPagePoint),this.history);this.startEvent&&W&&W(N,X),x&&x(N,X)},!DU(n))return;this.dragSnapToOrigin=d,this.handlers=s,this.transformPagePoint=a,this.distanceThreshold=f,this.contextWindow=l||window;const E=Jw(n),S=uL(E,this.transformPagePoint),{point:T}=S,{timestamp:C}=go;this.history=[{...T,timestamp:C}];const{onSessionStart:I}=s;I&&I(n,dL(S,this.history)),this.removeListeners=Yw(Q0(this.contextWindow,"pointermove",this.handlePointerMove),Q0(this.contextWindow,"pointerup",this.handlePointerUp),Q0(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(n){this.handlers=n}end(){this.removeListeners&&this.removeListeners(),df(this.updatePoint)}}function uL(i,n){return n?{point:n(i.point)}:i}function U7(i,n){return{x:i.x-n.x,y:i.y-n.y}}function dL({point:i},n){return{point:i,delta:U7(i,HZ(n)),offset:U7(i,pNe(n)),velocity:fNe(n,.1)}}function pNe(i){return i[0]}function HZ(i){return i[i.length-1]}function fNe(i,n){if(i.length<2)return{x:0,y:0};let s=i.length-1,a=null;const l=HZ(i);for(;s>=0&&(a=i[s],!(l.timestamp-a.timestamp>Sd(n)));)s--;if(!a)return{x:0,y:0};const d=sl(l.timestamp-a.timestamp);if(d===0)return{x:0,y:0};const f={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}function mNe(i,{min:n,max:s},a){return n!==void 0&&i<n?i=a?Xi(n,i,a.min):Math.max(i,n):s!==void 0&&i>s&&(i=a?Xi(s,i,a.max):Math.min(i,s)),i}function V7(i,n,s){return{min:n!==void 0?i.min+n:void 0,max:s!==void 0?i.max+s-(i.max-i.min):void 0}}function gNe(i,{top:n,left:s,bottom:a,right:l}){return{x:V7(i.x,s,l),y:V7(i.y,n,a)}}function F7(i,n){let s=n.min-i.min,a=n.max-i.max;return n.max-n.min<i.max-i.min&&([s,a]=[a,s]),{min:s,max:a}}function _Ne(i,n){return{x:F7(i.x,n.x),y:F7(i.y,n.y)}}function ENe(i,n){let s=.5;const a=ea(i),l=ea(n);return l>a?s=yw(n.min,n.max-a,i.min):a>l&&(s=yw(i.min,i.max-l,n.min)),Ch(0,1,s)}function yNe(i,n){const s={};return n.min!==void 0&&(s.min=n.min-i.min),n.max!==void 0&&(s.max=n.max-i.min),s}const VM=.35;function vNe(i=VM){return i===!1?i=0:i===!0&&(i=VM),{x:j7(i,"left","right"),y:j7(i,"top","bottom")}}function j7(i,n,s){return{min:B7(i,n),max:B7(i,s)}}function B7(i,n){return typeof i=="number"?i:i[n]||0}const SNe=new WeakMap;class TNe{constructor(n){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=xs(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=n}start(n,{snapToCursor:s=!1,distanceThreshold:a}={}){const{presenceContext:l}=this.visualElement;if(l&&l.isPresent===!1)return;const d=I=>{const{dragSnapToOrigin:N}=this.getProps();N?this.pauseAnimation():this.stopAnimation(),s&&this.snapToCursor(Jw(I).point)},f=(I,N)=>{const{drag:P,dragPropagation:W,onDragStart:x}=this.getProps();if(P&&!W&&(this.openDragLock&&this.openDragLock(),this.openDragLock=AAe(P),!this.openDragLock))return;this.latestPointerEvent=I,this.latestPanInfo=N,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),nl(X=>{let Z=this.getAxisMotionValue(X).get()||0;if(Td.test(Z)){const{projection:$}=this.visualElement;if($&&$.layout){const ae=$.layout.layoutBox[X];ae&&(Z=ea(ae)*(parseFloat(Z)/100))}}this.originPoint[X]=Z}),x&&Fi.postRender(()=>x(I,N)),MM(this.visualElement,"transform");const{animationState:B}=this.visualElement;B&&B.setActive("whileDrag",!0)},E=(I,N)=>{this.latestPointerEvent=I,this.latestPanInfo=N;const{dragPropagation:P,dragDirectionLock:W,onDirectionLock:x,onDrag:B}=this.getProps();if(!P&&!this.openDragLock)return;const{offset:X}=N;if(W&&this.currentDirection===null){this.currentDirection=wNe(X),this.currentDirection!==null&&x&&x(this.currentDirection);return}this.updateAxis("x",N.point,X),this.updateAxis("y",N.point,X),this.visualElement.render(),B&&B(I,N)},S=(I,N)=>{this.latestPointerEvent=I,this.latestPanInfo=N,this.stop(I,N),this.latestPointerEvent=null,this.latestPanInfo=null},T=()=>nl(I=>this.getAnimationState(I)==="paused"&&this.getAxisMotionValue(I).animation?.play()),{dragSnapToOrigin:C}=this.getProps();this.panSession=new GZ(n,{onSessionStart:d,onStart:f,onMove:E,onSessionEnd:S,resumeAnimation:T},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:C,distanceThreshold:a,contextWindow:WZ(this.visualElement)})}stop(n,s){const a=n||this.latestPointerEvent,l=s||this.latestPanInfo,d=this.isDragging;if(this.cancel(),!d||!l||!a)return;const{velocity:f}=l;this.startAnimation(f);const{onDragEnd:E}=this.getProps();E&&Fi.postRender(()=>E(a,l))}cancel(){this.isDragging=!1;const{projection:n,animationState:s}=this.visualElement;n&&(n.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),s&&s.setActive("whileDrag",!1)}updateAxis(n,s,a){const{drag:l}=this.getProps();if(!a||!cA(n,l,this.currentDirection))return;const d=this.getAxisMotionValue(n);let f=this.originPoint[n]+a[n];this.constraints&&this.constraints[n]&&(f=mNe(f,this.constraints[n],this.elastic[n])),d.set(f)}resolveConstraints(){const{dragConstraints:n,dragElastic:s}=this.getProps(),a=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,l=this.constraints;n&&Iy(n)?this.constraints||(this.constraints=this.resolveRefConstraints()):n&&a?this.constraints=gNe(a.layoutBox,n):this.constraints=!1,this.elastic=vNe(s),l!==this.constraints&&a&&this.constraints&&!this.hasMutatedConstraints&&nl(d=>{this.constraints!==!1&&this.getAxisMotionValue(d)&&(this.constraints[d]=yNe(a.layoutBox[d],this.constraints[d]))})}resolveRefConstraints(){const{dragConstraints:n,onMeasureDragConstraints:s}=this.getProps();if(!n||!Iy(n))return!1;const a=n.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const d=COe(a,l.root,this.visualElement.getTransformPagePoint());let f=_Ne(l.layout.layoutBox,d);if(s){const E=s(SOe(f));this.hasMutatedConstraints=!!E,E&&(f=IZ(E))}return f}startAnimation(n){const{drag:s,dragMomentum:a,dragElastic:l,dragTransition:d,dragSnapToOrigin:f,onDragTransitionEnd:E}=this.getProps(),S=this.constraints||{},T=nl(C=>{if(!cA(C,s,this.currentDirection))return;let I=S&&S[C]||{};f&&(I={min:0,max:0});const N=l?200:1e6,P=l?40:1e7,W={type:"inertia",velocity:a?n[C]:0,bounceStiffness:N,bounceDamping:P,timeConstant:750,restDelta:1,restSpeed:10,...d,...I};return this.startAxisValueAnimation(C,W)});return Promise.all(T).then(E)}startAxisValueAnimation(n,s){const a=this.getAxisMotionValue(n);return MM(this.visualElement,n),a.start(HU(n,a,0,s,this.visualElement,!1))}stopAnimation(){nl(n=>this.getAxisMotionValue(n).stop())}pauseAnimation(){nl(n=>this.getAxisMotionValue(n).animation?.pause())}getAnimationState(n){return this.getAxisMotionValue(n).animation?.state}getAxisMotionValue(n){const s=`_drag${n.toUpperCase()}`,a=this.visualElement.getProps(),l=a[s];return l||this.visualElement.getValue(n,(a.initial?a.initial[n]:void 0)||0)}snapToCursor(n){nl(s=>{const{drag:a}=this.getProps();if(!cA(s,a,this.currentDirection))return;const{projection:l}=this.visualElement,d=this.getAxisMotionValue(s);if(l&&l.layout){const{min:f,max:E}=l.layout.layoutBox[s];d.set(n[s]-Xi(f,E,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:n,dragConstraints:s}=this.getProps(),{projection:a}=this.visualElement;if(!Iy(s)||!a||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};nl(f=>{const E=this.getAxisMotionValue(f);if(E&&this.constraints!==!1){const S=E.get();l[f]=ENe({min:S,max:S},this.constraints[f])}});const{transformTemplate:d}=this.visualElement.getProps();this.visualElement.current.style.transform=d?d({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),nl(f=>{if(!cA(f,n,null))return;const E=this.getAxisMotionValue(f),{min:S,max:T}=this.constraints[f];E.set(Xi(S,T,l[f]))})}addListeners(){if(!this.visualElement.current)return;SNe.set(this.visualElement,this);const n=this.visualElement.current,s=Q0(n,"pointerdown",S=>{const{drag:T,dragListener:C=!0}=this.getProps();T&&C&&this.start(S)}),a=()=>{const{dragConstraints:S}=this.getProps();Iy(S)&&S.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,d=l.addEventListener("measure",a);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),Fi.read(a);const f=ww(window,"resize",()=>this.scalePositionWithinConstraints()),E=l.addEventListener("didUpdate",(({delta:S,hasLayoutChanged:T})=>{this.isDragging&&T&&(nl(C=>{const I=this.getAxisMotionValue(C);I&&(this.originPoint[C]+=S[C].translate,I.set(I.get()+S[C].translate))}),this.visualElement.render())}));return()=>{f(),s(),d(),E&&E()}}getProps(){const n=this.visualElement.getProps(),{drag:s=!1,dragDirectionLock:a=!1,dragPropagation:l=!1,dragConstraints:d=!1,dragElastic:f=VM,dragMomentum:E=!0}=n;return{...n,drag:s,dragDirectionLock:a,dragPropagation:l,dragConstraints:d,dragElastic:f,dragMomentum:E}}}function cA(i,n,s){return(n===!0||n===i)&&(s===null||s===i)}function wNe(i,n=10){let s=null;return Math.abs(i.y)>n?s="y":Math.abs(i.x)>n&&(s="x"),s}class CNe extends wf{constructor(n){super(n),this.removeGroupControls=cl,this.removeListeners=cl,this.controls=new TNe(n)}mount(){const{dragControls:n}=this.node.getProps();n&&(this.removeGroupControls=n.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||cl}unmount(){this.removeGroupControls(),this.removeListeners()}}const W7=i=>(n,s)=>{i&&Fi.postRender(()=>i(n,s))};class RNe extends wf{constructor(){super(...arguments),this.removePointerDownListener=cl}onPointerDown(n){this.session=new GZ(n,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:WZ(this.node)})}createPanHandlers(){const{onPanSessionStart:n,onPanStart:s,onPan:a,onPanEnd:l}=this.node.getProps();return{onSessionStart:W7(n),onStart:W7(s),onMove:a,onEnd:(d,f)=>{delete this.session,l&&Fi.postRender(()=>l(d,f))}}}mount(){this.removePointerDownListener=Q0(this.node.current,"pointerdown",n=>this.onPointerDown(n))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const OA={hasAnimatedSinceResize:!0,hasEverUpdated:!1};let hL=!1;class bNe extends H.Component{componentDidMount(){const{visualElement:n,layoutGroup:s,switchLayoutGroup:a,layoutId:l}=this.props,{projection:d}=n;d&&(s.group&&s.group.add(d),a&&a.register&&l&&a.register(d),hL&&d.root.didUpdate(),d.addEventListener("animationComplete",()=>{this.safeToRemove()}),d.setOptions({...d.options,onExitComplete:()=>this.safeToRemove()})),OA.hasEverUpdated=!0}getSnapshotBeforeUpdate(n){const{layoutDependency:s,visualElement:a,drag:l,isPresent:d}=this.props,{projection:f}=a;return f&&(f.isPresent=d,hL=!0,l||n.layoutDependency!==s||s===void 0||n.isPresent!==d?f.willUpdate():this.safeToRemove(),n.isPresent!==d&&(d?f.promote():f.relegate()||Fi.postRender(()=>{const E=f.getStack();(!E||!E.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:n}=this.props.visualElement;n&&(n.root.didUpdate(),kU.postRender(()=>{!n.currentAnimation&&n.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:n,layoutGroup:s,switchLayoutGroup:a}=this.props,{projection:l}=n;hL=!0,l&&(l.scheduleCheckAfterUnmount(),s&&s.group&&s.group.remove(l),a&&a.deregister&&a.deregister(l))}safeToRemove(){const{safeToRemove:n}=this.props;n&&n()}render(){return null}}function zZ(i){const[n,s]=pZ(),a=H.useContext(dU);return D.jsx(bNe,{...i,layoutGroup:a,switchLayoutGroup:H.useContext(RZ),isPresent:n,safeToRemove:s})}function INe(i,n,s){const a=Lo(i)?i:$y(i);return a.start(HU("",a,n,s)),a.animation}const ANe=(i,n)=>i.depth-n.depth;class ONe{constructor(){this.children=[],this.isDirty=!1}add(n){fU(this.children,n),this.isDirty=!0}remove(n){mU(this.children,n),this.isDirty=!0}forEach(n){this.isDirty&&this.children.sort(ANe),this.isDirty=!1,this.children.forEach(n)}}function NNe(i,n){const s=Na.now(),a=({timestamp:l})=>{const d=l-s;d>=n&&(df(a),i(d-n))};return Fi.setup(a,!0),()=>df(a)}const KZ=["TopLeft","TopRight","BottomLeft","BottomRight"],PNe=KZ.length,G7=i=>typeof i=="string"?parseFloat(i):i,H7=i=>typeof i=="number"||vn.test(i);function kNe(i,n,s,a,l,d){l?(i.opacity=Xi(0,s.opacity??1,DNe(a)),i.opacityExit=Xi(n.opacity??1,0,xNe(a))):d&&(i.opacity=Xi(n.opacity??1,s.opacity??1,a));for(let f=0;f<PNe;f++){const E=`border${KZ[f]}Radius`;let S=z7(n,E),T=z7(s,E);if(S===void 0&&T===void 0)continue;S||(S=0),T||(T=0),S===0||T===0||H7(S)===H7(T)?(i[E]=Math.max(Xi(G7(S),G7(T),a),0),(Td.test(T)||Td.test(S))&&(i[E]+="%")):i[E]=T}(n.rotate||s.rotate)&&(i.rotate=Xi(n.rotate||0,s.rotate||0,a))}function z7(i,n){return i[n]!==void 0?i[n]:i.borderRadius}const DNe=YZ(0,.5,kQ),xNe=YZ(.5,.95,cl);function YZ(i,n,s){return a=>a<i?0:a>n?1:s(yw(i,n,a))}function K7(i,n){i.min=n.min,i.max=n.max}function su(i,n){K7(i.x,n.x),K7(i.y,n.y)}function Y7(i,n){i.translate=n.translate,i.scale=n.scale,i.originPoint=n.originPoint,i.origin=n.origin}function q7(i,n,s,a,l){return i-=n,i=lO(i,1/s,a),l!==void 0&&(i=lO(i,1/l,a)),i}function LNe(i,n=0,s=1,a=.5,l,d=i,f=i){if(Td.test(n)&&(n=parseFloat(n),n=Xi(f.min,f.max,n/100)-f.min),typeof n!="number")return;let E=Xi(d.min,d.max,a);i===d&&(E-=n),i.min=q7(i.min,n,s,E,l),i.max=q7(i.max,n,s,E,l)}function X7(i,n,[s,a,l],d,f){LNe(i,n[s],n[a],n[l],n.scale,d,f)}const MNe=["x","scaleX","originX"],UNe=["y","scaleY","originY"];function J7(i,n,s,a){X7(i.x,n,MNe,s?s.x:void 0,a?a.x:void 0),X7(i.y,n,UNe,s?s.y:void 0,a?a.y:void 0)}function $7(i){return i.translate===0&&i.scale===1}function qZ(i){return $7(i.x)&&$7(i.y)}function Q7(i,n){return i.min===n.min&&i.max===n.max}function VNe(i,n){return Q7(i.x,n.x)&&Q7(i.y,n.y)}function Z7(i,n){return Math.round(i.min)===Math.round(n.min)&&Math.round(i.max)===Math.round(n.max)}function XZ(i,n){return Z7(i.x,n.x)&&Z7(i.y,n.y)}function eY(i){return ea(i.x)/ea(i.y)}function tY(i,n){return i.translate===n.translate&&i.scale===n.scale&&i.originPoint===n.originPoint}class FNe{constructor(){this.members=[]}add(n){fU(this.members,n),n.scheduleRender()}remove(n){if(mU(this.members,n),n===this.prevLead&&(this.prevLead=void 0),n===this.lead){const s=this.members[this.members.length-1];s&&this.promote(s)}}relegate(n){const s=this.members.findIndex(l=>n===l);if(s===0)return!1;let a;for(let l=s;l>=0;l--){const d=this.members[l];if(d.isPresent!==!1){a=d;break}}return a?(this.promote(a),!0):!1}promote(n,s){const a=this.lead;if(n!==a&&(this.prevLead=a,this.lead=n,n.show(),a)){a.instance&&a.scheduleRender(),n.scheduleRender(),n.resumeFrom=a,s&&(n.resumeFrom.preserveOpacity=!0),a.snapshot&&(n.snapshot=a.snapshot,n.snapshot.latestValues=a.animationValues||a.latestValues),n.root&&n.root.isUpdating&&(n.isLayoutDirty=!0);const{crossfade:l}=n.options;l===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(n=>{const{options:s,resumingFrom:a}=n;s.onExitComplete&&s.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(n=>{n.instance&&n.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function jNe(i,n,s){let a="";const l=i.x.translate/n.x,d=i.y.translate/n.y,f=s?.z||0;if((l||d||f)&&(a=`translate3d(${l}px, ${d}px, ${f}px) `),(n.x!==1||n.y!==1)&&(a+=`scale(${1/n.x}, ${1/n.y}) `),s){const{transformPerspective:T,rotate:C,rotateX:I,rotateY:N,skewX:P,skewY:W}=s;T&&(a=`perspective(${T}px) ${a}`),C&&(a+=`rotate(${C}deg) `),I&&(a+=`rotateX(${I}deg) `),N&&(a+=`rotateY(${N}deg) `),P&&(a+=`skewX(${P}deg) `),W&&(a+=`skewY(${W}deg) `)}const E=i.x.scale*n.x,S=i.y.scale*n.y;return(E!==1||S!==1)&&(a+=`scale(${E}, ${S})`),a||"none"}const pL=["","X","Y","Z"],BNe=1e3;let WNe=0;function fL(i,n,s,a){const{latestValues:l}=n;l[i]&&(s[i]=l[i],n.setStaticValue(i,0),a&&(a[i]=0))}function JZ(i){if(i.hasCheckedOptimisedAppear=!0,i.root===i)return;const{visualElement:n}=i.options;if(!n)return;const s=LZ(n);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:l,layoutId:d}=i.options;window.MotionCancelOptimisedAnimation(s,"transform",Fi,!(l||d))}const{parent:a}=i;a&&!a.hasCheckedOptimisedAppear&&JZ(a)}function $Z({attachResizeListener:i,defaultParent:n,measureScroll:s,checkIsScrollRoot:a,resetTransform:l}){return class{constructor(f={},E=n?.()){this.id=WNe++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(zNe),this.nodes.forEach(XNe),this.nodes.forEach(JNe),this.nodes.forEach(KNe)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=f,this.root=E?E.root||E:this,this.path=E?[...E.path,E]:[],this.parent=E,this.depth=E?E.depth+1:0;for(let S=0;S<this.path.length;S++)this.path[S].shouldResetTransform=!0;this.root===this&&(this.nodes=new ONe)}addEventListener(f,E){return this.eventHandlers.has(f)||this.eventHandlers.set(f,new EU),this.eventHandlers.get(f).add(E)}notifyListeners(f,...E){const S=this.eventHandlers.get(f);S&&S.notify(...E)}hasListeners(f){return this.eventHandlers.has(f)}mount(f){if(this.instance)return;this.isSVG=hZ(f)&&!xAe(f),this.instance=f;const{layoutId:E,layout:S,visualElement:T}=this.options;if(T&&!T.current&&T.mount(f),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(S||E)&&(this.isLayoutDirty=!0),i){let C,I=0;const N=()=>this.root.updateBlockedByResize=!1;Fi.read(()=>{I=window.innerWidth}),i(f,()=>{const P=window.innerWidth;P!==I&&(I=P,this.root.updateBlockedByResize=!0,C&&C(),C=NNe(N,250),OA.hasAnimatedSinceResize&&(OA.hasAnimatedSinceResize=!1,this.nodes.forEach(iY)))})}E&&this.root.registerSharedNode(E,this),this.options.animate!==!1&&T&&(E||S)&&this.addEventListener("didUpdate",({delta:C,hasLayoutChanged:I,hasRelativeLayoutChanged:N,layout:P})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const W=this.options.transition||T.getDefaultTransition()||tPe,{onLayoutAnimationStart:x,onLayoutAnimationComplete:B}=T.getProps(),X=!this.targetLayout||!XZ(this.targetLayout,P),Z=!I&&N;if(this.options.layoutRoot||this.resumeFrom||Z||I&&(X||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const $={...NU(W,"layout"),onPlay:x,onComplete:B};(T.shouldReduceMotion||this.options.layoutRoot)&&($.delay=0,$.type=!1),this.startAnimation($),this.setAnimationOrigin(C,Z)}else I||iY(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=P})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const f=this.getStack();f&&f.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),df(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach($Ne),this.animationId++)}getTransformTemplate(){const{visualElement:f}=this.options;return f&&f.getProps().transformTemplate}willUpdate(f=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&JZ(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let C=0;C<this.path.length;C++){const I=this.path[C];I.shouldResetTransform=!0,I.updateScroll("snapshot"),I.options.layoutRoot&&I.willUpdate(!1)}const{layoutId:E,layout:S}=this.options;if(E===void 0&&!S)return;const T=this.getTransformTemplate();this.prevTransformTemplateValue=T?T(this.latestValues,""):void 0,this.updateSnapshot(),f&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(nY);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(rY);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(qNe),this.nodes.forEach(GNe),this.nodes.forEach(HNe)):this.nodes.forEach(rY),this.clearAllSnapshots();const E=Na.now();go.delta=Ch(0,1e3/60,E-go.timestamp),go.timestamp=E,go.isProcessing=!0,nL.update.process(go),nL.preRender.process(go),nL.render.process(go),go.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,kU.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(YNe),this.sharedNodes.forEach(QNe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Fi.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Fi.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!ea(this.snapshot.measuredBox.x)&&!ea(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let S=0;S<this.path.length;S++)this.path[S].updateScroll();const f=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=xs(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:E}=this.options;E&&E.notify("LayoutMeasure",this.layout.layoutBox,f?f.layoutBox:void 0)}updateScroll(f="measure"){let E=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===f&&(E=!1),E&&this.instance){const S=a(this.instance);this.scroll={animationId:this.root.animationId,phase:f,isRoot:S,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:S}}}resetTransform(){if(!l)return;const f=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,E=this.projectionDelta&&!qZ(this.projectionDelta),S=this.getTransformTemplate(),T=S?S(this.latestValues,""):void 0,C=T!==this.prevTransformTemplateValue;f&&this.instance&&(E||gg(this.latestValues)||C)&&(l(this.instance,T),this.shouldResetTransform=!1,this.scheduleRender())}measure(f=!0){const E=this.measurePageBox();let S=this.removeElementScroll(E);return f&&(S=this.removeTransform(S)),nPe(S),{animationId:this.root.animationId,measuredBox:E,layoutBox:S,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:f}=this.options;if(!f)return xs();const E=f.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(rPe))){const{scroll:T}=this.root;T&&(Ay(E.x,T.offset.x),Ay(E.y,T.offset.y))}return E}removeElementScroll(f){const E=xs();if(su(E,f),this.scroll?.wasRoot)return E;for(let S=0;S<this.path.length;S++){const T=this.path[S],{scroll:C,options:I}=T;T!==this.root&&C&&I.layoutScroll&&(C.wasRoot&&su(E,f),Ay(E.x,C.offset.x),Ay(E.y,C.offset.y))}return E}applyTransform(f,E=!1){const S=xs();su(S,f);for(let T=0;T<this.path.length;T++){const C=this.path[T];!E&&C.options.layoutScroll&&C.scroll&&C!==C.root&&Oy(S,{x:-C.scroll.offset.x,y:-C.scroll.offset.y}),gg(C.latestValues)&&Oy(S,C.latestValues)}return gg(this.latestValues)&&Oy(S,this.latestValues),S}removeTransform(f){const E=xs();su(E,f);for(let S=0;S<this.path.length;S++){const T=this.path[S];if(!T.instance||!gg(T.latestValues))continue;kM(T.latestValues)&&T.updateSnapshot();const C=xs(),I=T.measurePageBox();su(C,I),J7(E,T.latestValues,T.snapshot?T.snapshot.layoutBox:void 0,C)}return gg(this.latestValues)&&J7(E,this.latestValues),E}setTargetDelta(f){this.targetDelta=f,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(f){this.options={...this.options,...f,crossfade:f.crossfade!==void 0?f.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==go.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(f=!1){const E=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=E.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=E.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=E.isSharedProjectionDirty);const S=!!this.resumingFrom||this!==E;if(!(f||S&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:C,layoutId:I}=this.options;if(!this.layout||!(C||I))return;this.resolvedRelativeTargetAt=go.timestamp;const N=this.getClosestProjectingParent();N&&this.linkedParentVersion!==N.layoutVersion&&!N.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(N&&N.layout?this.createRelativeTarget(N,this.layout.layoutBox,N.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=xs(),this.targetWithTransforms=xs()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),dNe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):su(this.target,this.layout.layoutBox),OZ(this.target,this.targetDelta)):su(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,N&&!!N.resumingFrom==!!this.resumingFrom&&!N.options.layoutScroll&&N.target&&this.animationProgress!==1?this.createRelativeTarget(N,this.target,N.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||kM(this.parent.latestValues)||AZ(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(f,E,S){this.relativeParent=f,this.linkedParentVersion=f.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=xs(),this.relativeTargetOrigin=xs(),uO(this.relativeTargetOrigin,E,S),su(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){const f=this.getLead(),E=!!this.resumingFrom||this!==f;let S=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(S=!1),E&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(S=!1),this.resolvedRelativeTargetAt===go.timestamp&&(S=!1),S)return;const{layout:T,layoutId:C}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(T||C))return;su(this.layoutCorrected,this.layout.layoutBox);const I=this.treeScale.x,N=this.treeScale.y;wOe(this.layoutCorrected,this.treeScale,this.path,E),f.layout&&!f.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(f.target=f.layout.layoutBox,f.targetWithTransforms=xs());const{target:P}=f;if(!P){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(Y7(this.prevProjectionDelta.x,this.projectionDelta.x),Y7(this.prevProjectionDelta.y,this.projectionDelta.y)),Z0(this.projectionDelta,this.layoutCorrected,P,this.latestValues),(this.treeScale.x!==I||this.treeScale.y!==N||!tY(this.projectionDelta.x,this.prevProjectionDelta.x)||!tY(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",P))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(f=!0){if(this.options.visualElement?.scheduleRender(),f){const E=this.getStack();E&&E.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Ny(),this.projectionDelta=Ny(),this.projectionDeltaWithTransform=Ny()}setAnimationOrigin(f,E=!1){const S=this.snapshot,T=S?S.latestValues:{},C={...this.latestValues},I=Ny();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!E;const N=xs(),P=S?S.source:void 0,W=this.layout?this.layout.source:void 0,x=P!==W,B=this.getStack(),X=!B||B.members.length<=1,Z=!!(x&&!X&&this.options.crossfade===!0&&!this.path.some(ePe));this.animationProgress=0;let $;this.mixTargetDelta=ae=>{const ce=ae/1e3;sY(I.x,f.x,ce),sY(I.y,f.y,ce),this.setTargetDelta(I),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(uO(N,this.layout.layoutBox,this.relativeParent.layout.layoutBox),ZNe(this.relativeTarget,this.relativeTargetOrigin,N,ce),$&&VNe(this.relativeTarget,$)&&(this.isProjectionDirty=!1),$||($=xs()),su($,this.relativeTarget)),x&&(this.animationValues=C,kNe(C,T,this.latestValues,ce,Z,X)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=ce},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(f){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(df(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Fi.update(()=>{OA.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=$y(0)),this.currentAnimation=INe(this.motionValue,[0,1e3],{...f,velocity:0,isSync:!0,onUpdate:E=>{this.mixTargetDelta(E),f.onUpdate&&f.onUpdate(E)},onStop:()=>{},onComplete:()=>{f.onComplete&&f.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const f=this.getStack();f&&f.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(BNe),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const f=this.getLead();let{targetWithTransforms:E,target:S,layout:T,latestValues:C}=f;if(!(!E||!S||!T)){if(this!==f&&this.layout&&T&&QZ(this.options.animationType,this.layout.layoutBox,T.layoutBox)){S=this.target||xs();const I=ea(this.layout.layoutBox.x);S.x.min=f.target.x.min,S.x.max=S.x.min+I;const N=ea(this.layout.layoutBox.y);S.y.min=f.target.y.min,S.y.max=S.y.min+N}su(E,S),Oy(E,C),Z0(this.projectionDeltaWithTransform,this.layoutCorrected,E,C)}}registerSharedNode(f,E){this.sharedNodes.has(f)||this.sharedNodes.set(f,new FNe),this.sharedNodes.get(f).add(E);const T=E.options.initialPromotionConfig;E.promote({transition:T?T.transition:void 0,preserveFollowOpacity:T&&T.shouldPreserveFollowOpacity?T.shouldPreserveFollowOpacity(E):void 0})}isLead(){const f=this.getStack();return f?f.lead===this:!0}getLead(){const{layoutId:f}=this.options;return f?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:f}=this.options;return f?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:f}=this.options;if(f)return this.root.sharedNodes.get(f)}promote({needsReset:f,transition:E,preserveFollowOpacity:S}={}){const T=this.getStack();T&&T.promote(this,S),f&&(this.projectionDelta=void 0,this.needsReset=!0),E&&this.setOptions({transition:E})}relegate(){const f=this.getStack();return f?f.relegate(this):!1}resetSkewAndRotation(){const{visualElement:f}=this.options;if(!f)return;let E=!1;const{latestValues:S}=f;if((S.z||S.rotate||S.rotateX||S.rotateY||S.rotateZ||S.skewX||S.skewY)&&(E=!0),!E)return;const T={};S.z&&fL("z",f,T,this.animationValues);for(let C=0;C<pL.length;C++)fL(`rotate${pL[C]}`,f,T,this.animationValues),fL(`skew${pL[C]}`,f,T,this.animationValues);f.render();for(const C in T)f.setStaticValue(C,T[C]),this.animationValues&&(this.animationValues[C]=T[C]);f.scheduleRender()}applyProjectionStyles(f,E){if(!this.instance||this.isSVG)return;if(!this.isVisible){f.visibility="hidden";return}const S=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,f.visibility="",f.opacity="",f.pointerEvents=AA(E?.pointerEvents)||"",f.transform=S?S(this.latestValues,""):"none";return}const T=this.getLead();if(!this.projectionDelta||!this.layout||!T.target){this.options.layoutId&&(f.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,f.pointerEvents=AA(E?.pointerEvents)||""),this.hasProjected&&!gg(this.latestValues)&&(f.transform=S?S({},""):"none",this.hasProjected=!1);return}f.visibility="";const C=T.animationValues||T.latestValues;this.applyTransformsToTarget();let I=jNe(this.projectionDeltaWithTransform,this.treeScale,C);S&&(I=S(C,I)),f.transform=I;const{x:N,y:P}=this.projectionDelta;f.transformOrigin=`${N.origin*100}% ${P.origin*100}% 0`,T.animationValues?f.opacity=T===this?C.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:C.opacityExit:f.opacity=T===this?C.opacity!==void 0?C.opacity:"":C.opacityExit!==void 0?C.opacityExit:0;for(const W in PM){if(C[W]===void 0)continue;const{correct:x,applyTo:B,isCSSVariable:X}=PM[W],Z=I==="none"?C[W]:x(C[W],T);if(B){const $=B.length;for(let ae=0;ae<$;ae++)f[B[ae]]=Z}else X?this.options.visualElement.renderState.vars[W]=Z:f[W]=Z}this.options.layoutId&&(f.pointerEvents=T===this?AA(E?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(f=>f.currentAnimation?.stop()),this.root.nodes.forEach(nY),this.root.sharedNodes.clear()}}}function GNe(i){i.updateLayout()}function HNe(i){const n=i.resumeFrom?.snapshot||i.snapshot;if(i.isLead()&&i.layout&&n&&i.hasListeners("didUpdate")){const{layoutBox:s,measuredBox:a}=i.layout,{animationType:l}=i.options,d=n.source!==i.layout.source;l==="size"?nl(C=>{const I=d?n.measuredBox[C]:n.layoutBox[C],N=ea(I);I.min=s[C].min,I.max=I.min+N}):QZ(l,n.layoutBox,s)&&nl(C=>{const I=d?n.measuredBox[C]:n.layoutBox[C],N=ea(s[C]);I.max=I.min+N,i.relativeTarget&&!i.currentAnimation&&(i.isProjectionDirty=!0,i.relativeTarget[C].max=i.relativeTarget[C].min+N)});const f=Ny();Z0(f,s,n.layoutBox);const E=Ny();d?Z0(E,i.applyTransform(a,!0),n.measuredBox):Z0(E,s,n.layoutBox);const S=!qZ(f);let T=!1;if(!i.resumeFrom){const C=i.getClosestProjectingParent();if(C&&!C.resumeFrom){const{snapshot:I,layout:N}=C;if(I&&N){const P=xs();uO(P,n.layoutBox,I.layoutBox);const W=xs();uO(W,s,N.layoutBox),XZ(P,W)||(T=!0),C.options.layoutRoot&&(i.relativeTarget=W,i.relativeTargetOrigin=P,i.relativeParent=C)}}}i.notifyListeners("didUpdate",{layout:s,snapshot:n,delta:E,layoutDelta:f,hasLayoutChanged:S,hasRelativeLayoutChanged:T})}else if(i.isLead()){const{onExitComplete:s}=i.options;s&&s()}i.options.transition=void 0}function zNe(i){i.parent&&(i.isProjecting()||(i.isProjectionDirty=i.parent.isProjectionDirty),i.isSharedProjectionDirty||(i.isSharedProjectionDirty=!!(i.isProjectionDirty||i.parent.isProjectionDirty||i.parent.isSharedProjectionDirty)),i.isTransformDirty||(i.isTransformDirty=i.parent.isTransformDirty))}function KNe(i){i.isProjectionDirty=i.isSharedProjectionDirty=i.isTransformDirty=!1}function YNe(i){i.clearSnapshot()}function nY(i){i.clearMeasurements()}function rY(i){i.isLayoutDirty=!1}function qNe(i){const{visualElement:n}=i.options;n&&n.getProps().onBeforeLayoutMeasure&&n.notify("BeforeLayoutMeasure"),i.resetTransform()}function iY(i){i.finishAnimation(),i.targetDelta=i.relativeTarget=i.target=void 0,i.isProjectionDirty=!0}function XNe(i){i.resolveTargetDelta()}function JNe(i){i.calcProjection()}function $Ne(i){i.resetSkewAndRotation()}function QNe(i){i.removeLeadSnapshot()}function sY(i,n,s){i.translate=Xi(n.translate,0,s),i.scale=Xi(n.scale,1,s),i.origin=n.origin,i.originPoint=n.originPoint}function oY(i,n,s,a){i.min=Xi(n.min,s.min,a),i.max=Xi(n.max,s.max,a)}function ZNe(i,n,s,a){oY(i.x,n.x,s.x,a),oY(i.y,n.y,s.y,a)}function ePe(i){return i.animationValues&&i.animationValues.opacityExit!==void 0}const tPe={duration:.45,ease:[.4,0,.1,1]},aY=i=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(i),cY=aY("applewebkit/")&&!aY("chrome/")?Math.round:cl;function lY(i){i.min=cY(i.min),i.max=cY(i.max)}function nPe(i){lY(i.x),lY(i.y)}function QZ(i,n,s){return i==="position"||i==="preserve-aspect"&&!uNe(eY(n),eY(s),.2)}function rPe(i){return i!==i.root&&i.scroll?.wasRoot}const iPe=$Z({attachResizeListener:(i,n)=>ww(i,"resize",n),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),mL={current:void 0},ZZ=$Z({measureScroll:i=>({x:i.scrollLeft,y:i.scrollTop}),defaultParent:()=>{if(!mL.current){const i=new iPe({});i.mount(window),i.setOptions({layoutScroll:!0}),mL.current=i}return mL.current},resetTransform:(i,n)=>{i.style.transform=n!==void 0?n:"none"},checkIsScrollRoot:i=>window.getComputedStyle(i).position==="fixed"}),sPe={pan:{Feature:RNe},drag:{Feature:CNe,ProjectionNode:ZZ,MeasureLayout:zZ}};function uY(i,n,s){const{props:a}=i;i.animationState&&a.whileHover&&i.animationState.setActive("whileHover",s==="Start");const l="onHover"+s,d=a[l];d&&Fi.postRender(()=>d(n,Jw(n)))}class oPe extends wf{mount(){const{current:n}=this.node;n&&(this.unmount=OAe(n,(s,a)=>(uY(this.node,a,"Start"),l=>uY(this.node,l,"End"))))}unmount(){}}class aPe extends wf{constructor(){super(...arguments),this.isActive=!1}onFocus(){let n=!1;try{n=this.node.current.matches(":focus-visible")}catch{n=!0}!n||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Yw(ww(this.node.current,"focus",()=>this.onFocus()),ww(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function dY(i,n,s){const{props:a}=i;if(i.current instanceof HTMLButtonElement&&i.current.disabled)return;i.animationState&&a.whileTap&&i.animationState.setActive("whileTap",s==="Start");const l="onTap"+(s==="End"?"":s),d=a[l];d&&Fi.postRender(()=>d(n,Jw(n)))}class cPe extends wf{mount(){const{current:n}=this.node;n&&(this.unmount=DAe(n,(s,a)=>(dY(this.node,a,"Start"),(l,{success:d})=>dY(this.node,l,d?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const FM=new WeakMap,gL=new WeakMap,lPe=i=>{const n=FM.get(i.target);n&&n(i)},uPe=i=>{i.forEach(lPe)};function dPe({root:i,...n}){const s=i||document;gL.has(s)||gL.set(s,{});const a=gL.get(s),l=JSON.stringify(n);return a[l]||(a[l]=new IntersectionObserver(uPe,{root:i,...n})),a[l]}function hPe(i,n,s){const a=dPe(n);return FM.set(i,s),a.observe(i),()=>{FM.delete(i),a.unobserve(i)}}const pPe={some:0,all:1};class fPe extends wf{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:n={}}=this.node.getProps(),{root:s,margin:a,amount:l="some",once:d}=n,f={root:s?s.current:void 0,rootMargin:a,threshold:typeof l=="number"?l:pPe[l]},E=S=>{const{isIntersecting:T}=S;if(this.isInView===T||(this.isInView=T,d&&!T&&this.hasEnteredView))return;T&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",T);const{onViewportEnter:C,onViewportLeave:I}=this.node.getProps(),N=T?C:I;N&&N(S)};return hPe(this.node.current,f,E)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:n,prevProps:s}=this.node;["amount","margin","root"].some(mPe(n,s))&&this.startObserver()}unmount(){}}function mPe({viewport:i={}},{viewport:n={}}={}){return s=>i[s]!==n[s]}const gPe={inView:{Feature:fPe},tap:{Feature:cPe},focus:{Feature:aPe},hover:{Feature:oPe}},_Pe={layout:{ProjectionNode:ZZ,MeasureLayout:zZ}},EPe={...iNe,...gPe,...sPe,..._Pe},Bn=vOe(EPe,DOe);function dh(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function eee(i,n){i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.__proto__=n}var _c={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Zy={duration:.5,overwrite:!1,delay:0},zU,_o,Vi,ol=1e8,pi=1/ol,jM=Math.PI*2,yPe=jM/4,vPe=0,tee=Math.sqrt,SPe=Math.cos,TPe=Math.sin,Js=function(n){return typeof n=="string"},os=function(n){return typeof n=="function"},bh=function(n){return typeof n=="number"},KU=function(n){return typeof n>"u"},bd=function(n){return typeof n=="object"},ka=function(n){return n!==!1},YU=function(){return typeof window<"u"},lA=function(n){return os(n)||Js(n)},nee=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},Uo=Array.isArray,wPe=/random\([^)]+\)/g,CPe=/,\s*/g,hY=/(?:-?\.?\d|\.)+/gi,ree=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Py=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,_L=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,iee=/[+-]=-?[.\d]+/,RPe=/[^,'"\[\]\s]+/gi,bPe=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,qi,pd,BM,qU,Ec={},dO={},see,oee=function(n){return(dO=ev(n,Ec))&&Ua},XU=function(n,s){return console.warn("Invalid property",n,"set to",s,"Missing plugin? gsap.registerPlugin()")},Cw=function(n,s){return!s&&console.warn(n)},aee=function(n,s){return n&&(Ec[n]=s)&&dO&&(dO[n]=s)||Ec},Rw=function(){return 0},IPe={suppressEvents:!0,isStart:!0,kill:!1},NA={suppressEvents:!0,kill:!1},APe={suppressEvents:!0},JU={},sf=[],WM={},cee,lc={},EL={},pY=30,PA=[],$U="",QU=function(n){var s=n[0],a,l;if(bd(s)||os(s)||(n=[n]),!(a=(s._gsap||{}).harness)){for(l=PA.length;l--&&!PA[l].targetTest(s););a=PA[l]}for(l=n.length;l--;)n[l]&&(n[l]._gsap||(n[l]._gsap=new kee(n[l],a)))||n.splice(l,1);return n},Og=function(n){return n._gsap||QU(al(n))[0]._gsap},lee=function(n,s,a){return(a=n[s])&&os(a)?n[s]():KU(a)&&n.getAttribute&&n.getAttribute(s)||a},Da=function(n,s){return(n=n.split(",")).forEach(s)||n},ms=function(n){return Math.round(n*1e5)/1e5||0},Yi=function(n){return Math.round(n*1e7)/1e7||0},Gy=function(n,s){var a=s.charAt(0),l=parseFloat(s.substr(2));return n=parseFloat(n),a==="+"?n+l:a==="-"?n-l:a==="*"?n*l:n/l},OPe=function(n,s){for(var a=s.length,l=0;n.indexOf(s[l])<0&&++l<a;);return l<a},hO=function(){var n=sf.length,s=sf.slice(0),a,l;for(WM={},sf.length=0,a=0;a<n;a++)l=s[a],l&&l._lazy&&(l.render(l._lazy[0],l._lazy[1],!0)._lazy=0)},ZU=function(n){return!!(n._initted||n._startAt||n.add)},uee=function(n,s,a,l){sf.length&&!_o&&hO(),n.render(s,a,!!(_o&&s<0&&ZU(n))),sf.length&&!_o&&hO()},dee=function(n){var s=parseFloat(n);return(s||s===0)&&(n+"").match(RPe).length<2?s:Js(n)?n.trim():n},hee=function(n){return n},yc=function(n,s){for(var a in s)a in n||(n[a]=s[a]);return n},NPe=function(n){return function(s,a){for(var l in a)l in s||l==="duration"&&n||l==="ease"||(s[l]=a[l])}},ev=function(n,s){for(var a in s)n[a]=s[a];return n},fY=function i(n,s){for(var a in s)a!=="__proto__"&&a!=="constructor"&&a!=="prototype"&&(n[a]=bd(s[a])?i(n[a]||(n[a]={}),s[a]):s[a]);return n},pO=function(n,s){var a={},l;for(l in n)l in s||(a[l]=n[l]);return a},ew=function(n){var s=n.parent||qi,a=n.keyframes?NPe(Uo(n.keyframes)):yc;if(ka(n.inherit))for(;s;)a(n,s.vars.defaults),s=s.parent||s._dp;return n},PPe=function(n,s){for(var a=n.length,l=a===s.length;l&&a--&&n[a]===s[a];);return a<0},pee=function(n,s,a,l,d){var f=n[l],E;if(d)for(E=s[d];f&&f[d]>E;)f=f._prev;return f?(s._next=f._next,f._next=s):(s._next=n[a],n[a]=s),s._next?s._next._prev=s:n[l]=s,s._prev=f,s.parent=s._dp=n,s},ZO=function(n,s,a,l){a===void 0&&(a="_first"),l===void 0&&(l="_last");var d=s._prev,f=s._next;d?d._next=f:n[a]===s&&(n[a]=f),f?f._prev=d:n[l]===s&&(n[l]=d),s._next=s._prev=s.parent=null},pf=function(n,s){n.parent&&(!s||n.parent.autoRemoveChildren)&&n.parent.remove&&n.parent.remove(n),n._act=0},Ng=function(n,s){if(n&&(!s||s._end>n._dur||s._start<0))for(var a=n;a;)a._dirty=1,a=a.parent;return n},kPe=function(n){for(var s=n.parent;s&&s.parent;)s._dirty=1,s.totalDuration(),s=s.parent;return n},GM=function(n,s,a,l){return n._startAt&&(_o?n._startAt.revert(NA):n.vars.immediateRender&&!n.vars.autoRevert||n._startAt.render(s,!0,l))},DPe=function i(n){return!n||n._ts&&i(n.parent)},mY=function(n){return n._repeat?tv(n._tTime,n=n.duration()+n._rDelay)*n:0},tv=function(n,s){var a=Math.floor(n=Yi(n/s));return n&&a===n?a-1:a},fO=function(n,s){return(n-s._start)*s._ts+(s._ts>=0?0:s._dirty?s.totalDuration():s._tDur)},eN=function(n){return n._end=Yi(n._start+(n._tDur/Math.abs(n._ts||n._rts||pi)||0))},tN=function(n,s){var a=n._dp;return a&&a.smoothChildTiming&&n._ts&&(n._start=Yi(a._time-(n._ts>0?s/n._ts:((n._dirty?n.totalDuration():n._tDur)-s)/-n._ts)),eN(n),a._dirty||Ng(a,n)),n},fee=function(n,s){var a;if((s._time||!s._dur&&s._initted||s._start<n._time&&(s._dur||!s.add))&&(a=fO(n.rawTime(),s),(!s._dur||$w(0,s.totalDuration(),a)-s._tTime>pi)&&s.render(a,!0)),Ng(n,s)._dp&&n._initted&&n._time>=n._dur&&n._ts){if(n._dur<n.duration())for(a=n;a._dp;)a.rawTime()>=0&&a.totalTime(a._tTime),a=a._dp;n._zTime=-pi}},fd=function(n,s,a,l){return s.parent&&pf(s),s._start=Yi((bh(a)?a:a||n!==qi?rl(n,a,s):n._time)+s._delay),s._end=Yi(s._start+(s.totalDuration()/Math.abs(s.timeScale())||0)),pee(n,s,"_first","_last",n._sort?"_start":0),HM(s)||(n._recent=s),l||fee(n,s),n._ts<0&&tN(n,n._tTime),n},mee=function(n,s){return(Ec.ScrollTrigger||XU("scrollTrigger",s))&&Ec.ScrollTrigger.create(s,n)},gee=function(n,s,a,l,d){if(tV(n,s,d),!n._initted)return 1;if(!a&&n._pt&&!_o&&(n._dur&&n.vars.lazy!==!1||!n._dur&&n.vars.lazy)&&cee!==dc.frame)return sf.push(n),n._lazy=[d,l],1},xPe=function i(n){var s=n.parent;return s&&s._ts&&s._initted&&!s._lock&&(s.rawTime()<0||i(s))},HM=function(n){var s=n.data;return s==="isFromStart"||s==="isStart"},LPe=function(n,s,a,l){var d=n.ratio,f=s<0||!s&&(!n._start&&xPe(n)&&!(!n._initted&&HM(n))||(n._ts<0||n._dp._ts<0)&&!HM(n))?0:1,E=n._rDelay,S=0,T,C,I;if(E&&n._repeat&&(S=$w(0,n._tDur,s),C=tv(S,E),n._yoyo&&C&1&&(f=1-f),C!==tv(n._tTime,E)&&(d=1-f,n.vars.repeatRefresh&&n._initted&&n.invalidate())),f!==d||_o||l||n._zTime===pi||!s&&n._zTime){if(!n._initted&&gee(n,s,l,a,S))return;for(I=n._zTime,n._zTime=s||(a?pi:0),a||(a=s&&!I),n.ratio=f,n._from&&(f=1-f),n._time=0,n._tTime=S,T=n._pt;T;)T.r(f,T.d),T=T._next;s<0&&GM(n,s,a,!0),n._onUpdate&&!a&&hc(n,"onUpdate"),S&&n._repeat&&!a&&n.parent&&hc(n,"onRepeat"),(s>=n._tDur||s<0)&&n.ratio===f&&(f&&pf(n,1),!a&&!_o&&(hc(n,f?"onComplete":"onReverseComplete",!0),n._prom&&n._prom()))}else n._zTime||(n._zTime=s)},MPe=function(n,s,a){var l;if(a>s)for(l=n._first;l&&l._start<=a;){if(l.data==="isPause"&&l._start>s)return l;l=l._next}else for(l=n._last;l&&l._start>=a;){if(l.data==="isPause"&&l._start<s)return l;l=l._prev}},nv=function(n,s,a,l){var d=n._repeat,f=Yi(s)||0,E=n._tTime/n._tDur;return E&&!l&&(n._time*=f/n._dur),n._dur=f,n._tDur=d?d<0?1e10:Yi(f*(d+1)+n._rDelay*d):f,E>0&&!l&&tN(n,n._tTime=n._tDur*E),n.parent&&eN(n),a||Ng(n.parent,n),n},gY=function(n){return n instanceof Zo?Ng(n):nv(n,n._dur)},UPe={_start:0,endTime:Rw,totalDuration:Rw},rl=function i(n,s,a){var l=n.labels,d=n._recent||UPe,f=n.duration()>=ol?d.endTime(!1):n._dur,E,S,T;return Js(s)&&(isNaN(s)||s in l)?(S=s.charAt(0),T=s.substr(-1)==="%",E=s.indexOf("="),S==="<"||S===">"?(E>=0&&(s=s.replace(/=/,"")),(S==="<"?d._start:d.endTime(d._repeat>=0))+(parseFloat(s.substr(1))||0)*(T?(E<0?d:a).totalDuration()/100:1)):E<0?(s in l||(l[s]=f),l[s]):(S=parseFloat(s.charAt(E-1)+s.substr(E+1)),T&&a&&(S=S/100*(Uo(a)?a[0]:a).totalDuration()),E>1?i(n,s.substr(0,E-1),a)+S:f+S)):s==null?f:+s},tw=function(n,s,a){var l=bh(s[1]),d=(l?2:1)+(n<2?0:1),f=s[d],E,S;if(l&&(f.duration=s[1]),f.parent=a,n){for(E=f,S=a;S&&!("immediateRender"in E);)E=S.vars.defaults||{},S=ka(S.vars.inherit)&&S.parent;f.immediateRender=ka(E.immediateRender),n<2?f.runBackwards=1:f.startAt=s[d-1]}return new Rs(s[0],f,s[d+1])},Cf=function(n,s){return n||n===0?s(n):s},$w=function(n,s,a){return a<n?n:a>s?s:a},Do=function(n,s){return!Js(n)||!(s=bPe.exec(n))?"":s[1]},VPe=function(n,s,a){return Cf(a,function(l){return $w(n,s,l)})},zM=[].slice,_ee=function(n,s){return n&&bd(n)&&"length"in n&&(!s&&!n.length||n.length-1 in n&&bd(n[0]))&&!n.nodeType&&n!==pd},FPe=function(n,s,a){return a===void 0&&(a=[]),n.forEach(function(l){var d;return Js(l)&&!s||_ee(l,1)?(d=a).push.apply(d,al(l)):a.push(l)})||a},al=function(n,s,a){return Vi&&!s&&Vi.selector?Vi.selector(n):Js(n)&&!a&&(BM||!rv())?zM.call((s||qU).querySelectorAll(n),0):Uo(n)?FPe(n,a):_ee(n)?zM.call(n,0):n?[n]:[]},KM=function(n){return n=al(n)[0]||Cw("Invalid scope")||{},function(s){var a=n.current||n.nativeElement||n;return al(s,a.querySelectorAll?a:a===n?Cw("Invalid scope")||qU.createElement("div"):n)}},Eee=function(n){return n.sort(function(){return .5-Math.random()})},yee=function(n){if(os(n))return n;var s=bd(n)?n:{each:n},a=Pg(s.ease),l=s.from||0,d=parseFloat(s.base)||0,f={},E=l>0&&l<1,S=isNaN(l)||E,T=s.axis,C=l,I=l;return Js(l)?C=I={center:.5,edges:.5,end:1}[l]||0:!E&&S&&(C=l[0],I=l[1]),function(N,P,W){var x=(W||s).length,B=f[x],X,Z,$,ae,ce,le,ne,fe,Se;if(!B){if(Se=s.grid==="auto"?0:(s.grid||[1,ol])[1],!Se){for(ne=-ol;ne<(ne=W[Se++].getBoundingClientRect().left)&&Se<x;);Se<x&&Se--}for(B=f[x]=[],X=S?Math.min(Se,x)*C-.5:l%Se,Z=Se===ol?0:S?x*I/Se-.5:l/Se|0,ne=0,fe=ol,le=0;le<x;le++)$=le%Se-X,ae=Z-(le/Se|0),B[le]=ce=T?Math.abs(T==="y"?ae:$):tee($*$+ae*ae),ce>ne&&(ne=ce),ce<fe&&(fe=ce);l==="random"&&Eee(B),B.max=ne-fe,B.min=fe,B.v=x=(parseFloat(s.amount)||parseFloat(s.each)*(Se>x?x-1:T?T==="y"?x/Se:Se:Math.max(Se,x/Se))||0)*(l==="edges"?-1:1),B.b=x<0?d-x:d,B.u=Do(s.amount||s.each)||0,a=a&&x<0?Oee(a):a}return x=(B[N]-B.min)/B.max||0,Yi(B.b+(a?a(x):x)*B.v)+B.u}},YM=function(n){var s=Math.pow(10,((n+"").split(".")[1]||"").length);return function(a){var l=Yi(Math.round(parseFloat(a)/n)*n*s);return(l-l%1)/s+(bh(a)?0:Do(a))}},vee=function(n,s){var a=Uo(n),l,d;return!a&&bd(n)&&(l=a=n.radius||ol,n.values?(n=al(n.values),(d=!bh(n[0]))&&(l*=l)):n=YM(n.increment)),Cf(s,a?os(n)?function(f){return d=n(f),Math.abs(d-f)<=l?d:f}:function(f){for(var E=parseFloat(d?f.x:f),S=parseFloat(d?f.y:0),T=ol,C=0,I=n.length,N,P;I--;)d?(N=n[I].x-E,P=n[I].y-S,N=N*N+P*P):N=Math.abs(n[I]-E),N<T&&(T=N,C=I);return C=!l||T<=l?n[C]:f,d||C===f||bh(f)?C:C+Do(f)}:YM(n))},See=function(n,s,a,l){return Cf(Uo(n)?!s:a===!0?!!(a=0):!l,function(){return Uo(n)?n[~~(Math.random()*n.length)]:(a=a||1e-5)&&(l=a<1?Math.pow(10,(a+"").length-2):1)&&Math.floor(Math.round((n-a/2+Math.random()*(s-n+a*.99))/a)*a*l)/l})},jPe=function(){for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return function(l){return s.reduce(function(d,f){return f(d)},l)}},BPe=function(n,s){return function(a){return n(parseFloat(a))+(s||Do(a))}},WPe=function(n,s,a){return wee(n,s,0,1,a)},Tee=function(n,s,a){return Cf(a,function(l){return n[~~s(l)]})},GPe=function i(n,s,a){var l=s-n;return Uo(n)?Tee(n,i(0,n.length),s):Cf(a,function(d){return(l+(d-n)%l)%l+n})},HPe=function i(n,s,a){var l=s-n,d=l*2;return Uo(n)?Tee(n,i(0,n.length-1),s):Cf(a,function(f){return f=(d+(f-n)%d)%d||0,n+(f>l?d-f:f)})},bw=function(n){return n.replace(wPe,function(s){var a=s.indexOf("[")+1,l=s.substring(a||7,a?s.indexOf("]"):s.length-1).split(CPe);return See(a?l:+l[0],a?0:+l[1],+l[2]||1e-5)})},wee=function(n,s,a,l,d){var f=s-n,E=l-a;return Cf(d,function(S){return a+((S-n)/f*E||0)})},zPe=function i(n,s,a,l){var d=isNaN(n+s)?0:function(P){return(1-P)*n+P*s};if(!d){var f=Js(n),E={},S,T,C,I,N;if(a===!0&&(l=1)&&(a=null),f)n={p:n},s={p:s};else if(Uo(n)&&!Uo(s)){for(C=[],I=n.length,N=I-2,T=1;T<I;T++)C.push(i(n[T-1],n[T]));I--,d=function(W){W*=I;var x=Math.min(N,~~W);return C[x](W-x)},a=s}else l||(n=ev(Uo(n)?[]:{},n));if(!C){for(S in s)eV.call(E,n,S,"get",s[S]);d=function(W){return iV(W,E)||(f?n.p:n)}}}return Cf(a,d)},_Y=function(n,s,a){var l=n.labels,d=ol,f,E,S;for(f in l)E=l[f]-s,E<0==!!a&&E&&d>(E=Math.abs(E))&&(S=f,d=E);return S},hc=function(n,s,a){var l=n.vars,d=l[s],f=Vi,E=n._ctx,S,T,C;if(d)return S=l[s+"Params"],T=l.callbackScope||n,a&&sf.length&&hO(),E&&(Vi=E),C=S?d.apply(T,S):d.call(T),Vi=f,C},F0=function(n){return pf(n),n.scrollTrigger&&n.scrollTrigger.kill(!!_o),n.progress()<1&&hc(n,"onInterrupt"),n},ky,Cee=[],Ree=function(n){if(n)if(n=!n.name&&n.default||n,YU()||n.headless){var s=n.name,a=os(n),l=s&&!a&&n.init?function(){this._props=[]}:n,d={init:Rw,render:iV,add:eV,kill:a1e,modifier:o1e,rawVars:0},f={targetTest:0,get:0,getSetter:rV,aliases:{},register:0};if(rv(),n!==l){if(lc[s])return;yc(l,yc(pO(n,d),f)),ev(l.prototype,ev(d,pO(n,f))),lc[l.prop=s]=l,n.targetTest&&(PA.push(l),JU[s]=1),s=(s==="css"?"CSS":s.charAt(0).toUpperCase()+s.substr(1))+"Plugin"}aee(s,l),n.register&&n.register(Ua,l,xa)}else Cee.push(n)},di=255,j0={aqua:[0,di,di],lime:[0,di,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,di],navy:[0,0,128],white:[di,di,di],olive:[128,128,0],yellow:[di,di,0],orange:[di,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[di,0,0],pink:[di,192,203],cyan:[0,di,di],transparent:[di,di,di,0]},yL=function(n,s,a){return n+=n<0?1:n>1?-1:0,(n*6<1?s+(a-s)*n*6:n<.5?a:n*3<2?s+(a-s)*(2/3-n)*6:s)*di+.5|0},bee=function(n,s,a){var l=n?bh(n)?[n>>16,n>>8&di,n&di]:0:j0.black,d,f,E,S,T,C,I,N,P,W;if(!l){if(n.substr(-1)===","&&(n=n.substr(0,n.length-1)),j0[n])l=j0[n];else if(n.charAt(0)==="#"){if(n.length<6&&(d=n.charAt(1),f=n.charAt(2),E=n.charAt(3),n="#"+d+d+f+f+E+E+(n.length===5?n.charAt(4)+n.charAt(4):"")),n.length===9)return l=parseInt(n.substr(1,6),16),[l>>16,l>>8&di,l&di,parseInt(n.substr(7),16)/255];n=parseInt(n.substr(1),16),l=[n>>16,n>>8&di,n&di]}else if(n.substr(0,3)==="hsl"){if(l=W=n.match(hY),!s)S=+l[0]%360/360,T=+l[1]/100,C=+l[2]/100,f=C<=.5?C*(T+1):C+T-C*T,d=C*2-f,l.length>3&&(l[3]*=1),l[0]=yL(S+1/3,d,f),l[1]=yL(S,d,f),l[2]=yL(S-1/3,d,f);else if(~n.indexOf("="))return l=n.match(ree),a&&l.length<4&&(l[3]=1),l}else l=n.match(hY)||j0.transparent;l=l.map(Number)}return s&&!W&&(d=l[0]/di,f=l[1]/di,E=l[2]/di,I=Math.max(d,f,E),N=Math.min(d,f,E),C=(I+N)/2,I===N?S=T=0:(P=I-N,T=C>.5?P/(2-I-N):P/(I+N),S=I===d?(f-E)/P+(f<E?6:0):I===f?(E-d)/P+2:(d-f)/P+4,S*=60),l[0]=~~(S+.5),l[1]=~~(T*100+.5),l[2]=~~(C*100+.5)),a&&l.length<4&&(l[3]=1),l},Iee=function(n){var s=[],a=[],l=-1;return n.split(of).forEach(function(d){var f=d.match(Py)||[];s.push.apply(s,f),a.push(l+=f.length+1)}),s.c=a,s},EY=function(n,s,a){var l="",d=(n+l).match(of),f=s?"hsla(":"rgba(",E=0,S,T,C,I;if(!d)return n;if(d=d.map(function(N){return(N=bee(N,s,1))&&f+(s?N[0]+","+N[1]+"%,"+N[2]+"%,"+N[3]:N.join(","))+")"}),a&&(C=Iee(n),S=a.c,S.join(l)!==C.c.join(l)))for(T=n.replace(of,"1").split(Py),I=T.length-1;E<I;E++)l+=T[E]+(~S.indexOf(E)?d.shift()||f+"0,0,0,0)":(C.length?C:d.length?d:a).shift());if(!T)for(T=n.split(of),I=T.length-1;E<I;E++)l+=T[E]+d[E];return l+T[I]},of=(function(){var i="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",n;for(n in j0)i+="|"+n+"\\b";return new RegExp(i+")","gi")})(),KPe=/hsl[a]?\(/,Aee=function(n){var s=n.join(" "),a;if(of.lastIndex=0,of.test(s))return a=KPe.test(s),n[1]=EY(n[1],a),n[0]=EY(n[0],a,Iee(n[1])),!0},Iw,dc=(function(){var i=Date.now,n=500,s=33,a=i(),l=a,d=1e3/240,f=d,E=[],S,T,C,I,N,P,W=function x(B){var X=i()-l,Z=B===!0,$,ae,ce,le;if((X>n||X<0)&&(a+=X-s),l+=X,ce=l-a,$=ce-f,($>0||Z)&&(le=++I.frame,N=ce-I.time*1e3,I.time=ce=ce/1e3,f+=$+($>=d?4:d-$),ae=1),Z||(S=T(x)),ae)for(P=0;P<E.length;P++)E[P](ce,N,le,B)};return I={time:0,frame:0,tick:function(){W(!0)},deltaRatio:function(B){return N/(1e3/(B||60))},wake:function(){see&&(!BM&&YU()&&(pd=BM=window,qU=pd.document||{},Ec.gsap=Ua,(pd.gsapVersions||(pd.gsapVersions=[])).push(Ua.version),oee(dO||pd.GreenSockGlobals||!pd.gsap&&pd||{}),Cee.forEach(Ree)),C=typeof requestAnimationFrame<"u"&&requestAnimationFrame,S&&I.sleep(),T=C||function(B){return setTimeout(B,f-I.time*1e3+1|0)},Iw=1,W(2))},sleep:function(){(C?cancelAnimationFrame:clearTimeout)(S),Iw=0,T=Rw},lagSmoothing:function(B,X){n=B||1/0,s=Math.min(X||33,n)},fps:function(B){d=1e3/(B||240),f=I.time*1e3+d},add:function(B,X,Z){var $=X?function(ae,ce,le,ne){B(ae,ce,le,ne),I.remove($)}:B;return I.remove(B),E[Z?"unshift":"push"]($),rv(),$},remove:function(B,X){~(X=E.indexOf(B))&&E.splice(X,1)&&P>=X&&P--},_listeners:E},I})(),rv=function(){return!Iw&&dc.wake()},pr={},YPe=/^[\d.\-M][\d.\-,\s]/,qPe=/["']/g,XPe=function(n){for(var s={},a=n.substr(1,n.length-3).split(":"),l=a[0],d=1,f=a.length,E,S,T;d<f;d++)S=a[d],E=d!==f-1?S.lastIndexOf(","):S.length,T=S.substr(0,E),s[l]=isNaN(T)?T.replace(qPe,"").trim():+T,l=S.substr(E+1).trim();return s},JPe=function(n){var s=n.indexOf("(")+1,a=n.indexOf(")"),l=n.indexOf("(",s);return n.substring(s,~l&&l<a?n.indexOf(")",a+1):a)},$Pe=function(n){var s=(n+"").split("("),a=pr[s[0]];return a&&s.length>1&&a.config?a.config.apply(null,~n.indexOf("{")?[XPe(s[1])]:JPe(n).split(",").map(dee)):pr._CE&&YPe.test(n)?pr._CE("",n):a},Oee=function(n){return function(s){return 1-n(1-s)}},Nee=function i(n,s){for(var a=n._first,l;a;)a instanceof Zo?i(a,s):a.vars.yoyoEase&&(!a._yoyo||!a._repeat)&&a._yoyo!==s&&(a.timeline?i(a.timeline,s):(l=a._ease,a._ease=a._yEase,a._yEase=l,a._yoyo=s)),a=a._next},Pg=function(n,s){return n&&(os(n)?n:pr[n]||$Pe(n))||s},zg=function(n,s,a,l){a===void 0&&(a=function(S){return 1-s(1-S)}),l===void 0&&(l=function(S){return S<.5?s(S*2)/2:1-s((1-S)*2)/2});var d={easeIn:s,easeOut:a,easeInOut:l},f;return Da(n,function(E){pr[E]=Ec[E]=d,pr[f=E.toLowerCase()]=a;for(var S in d)pr[f+(S==="easeIn"?".in":S==="easeOut"?".out":".inOut")]=pr[E+"."+S]=d[S]}),d},Pee=function(n){return function(s){return s<.5?(1-n(1-s*2))/2:.5+n((s-.5)*2)/2}},vL=function i(n,s,a){var l=s>=1?s:1,d=(a||(n?.3:.45))/(s<1?s:1),f=d/jM*(Math.asin(1/l)||0),E=function(C){return C===1?1:l*Math.pow(2,-10*C)*TPe((C-f)*d)+1},S=n==="out"?E:n==="in"?function(T){return 1-E(1-T)}:Pee(E);return d=jM/d,S.config=function(T,C){return i(n,T,C)},S},SL=function i(n,s){s===void 0&&(s=1.70158);var a=function(f){return f?--f*f*((s+1)*f+s)+1:0},l=n==="out"?a:n==="in"?function(d){return 1-a(1-d)}:Pee(a);return l.config=function(d){return i(n,d)},l};Da("Linear,Quad,Cubic,Quart,Quint,Strong",function(i,n){var s=n<5?n+1:n;zg(i+",Power"+(s-1),n?function(a){return Math.pow(a,s)}:function(a){return a},function(a){return 1-Math.pow(1-a,s)},function(a){return a<.5?Math.pow(a*2,s)/2:1-Math.pow((1-a)*2,s)/2})});pr.Linear.easeNone=pr.none=pr.Linear.easeIn;zg("Elastic",vL("in"),vL("out"),vL());(function(i,n){var s=1/n,a=2*s,l=2.5*s,d=function(E){return E<s?i*E*E:E<a?i*Math.pow(E-1.5/n,2)+.75:E<l?i*(E-=2.25/n)*E+.9375:i*Math.pow(E-2.625/n,2)+.984375};zg("Bounce",function(f){return 1-d(1-f)},d)})(7.5625,2.75);zg("Expo",function(i){return Math.pow(2,10*(i-1))*i+i*i*i*i*i*i*(1-i)});zg("Circ",function(i){return-(tee(1-i*i)-1)});zg("Sine",function(i){return i===1?1:-SPe(i*yPe)+1});zg("Back",SL("in"),SL("out"),SL());pr.SteppedEase=pr.steps=Ec.SteppedEase={config:function(n,s){n===void 0&&(n=1);var a=1/n,l=n+(s?0:1),d=s?1:0,f=1-pi;return function(E){return((l*$w(0,f,E)|0)+d)*a}}};Zy.ease=pr["quad.out"];Da("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(i){return $U+=i+","+i+"Params,"});var kee=function(n,s){this.id=vPe++,n._gsap=this,this.target=n,this.harness=s,this.get=s?s.get:lee,this.set=s?s.getSetter:rV},Aw=(function(){function i(s){this.vars=s,this._delay=+s.delay||0,(this._repeat=s.repeat===1/0?-2:s.repeat||0)&&(this._rDelay=s.repeatDelay||0,this._yoyo=!!s.yoyo||!!s.yoyoEase),this._ts=1,nv(this,+s.duration,1,1),this.data=s.data,Vi&&(this._ctx=Vi,Vi.data.push(this)),Iw||dc.wake()}var n=i.prototype;return n.delay=function(a){return a||a===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+a-this._delay),this._delay=a,this):this._delay},n.duration=function(a){return arguments.length?this.totalDuration(this._repeat>0?a+(a+this._rDelay)*this._repeat:a):this.totalDuration()&&this._dur},n.totalDuration=function(a){return arguments.length?(this._dirty=0,nv(this,this._repeat<0?a:(a-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},n.totalTime=function(a,l){if(rv(),!arguments.length)return this._tTime;var d=this._dp;if(d&&d.smoothChildTiming&&this._ts){for(tN(this,a),!d._dp||d.parent||fee(d,this);d&&d.parent;)d.parent._time!==d._start+(d._ts>=0?d._tTime/d._ts:(d.totalDuration()-d._tTime)/-d._ts)&&d.totalTime(d._tTime,!0),d=d.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&a<this._tDur||this._ts<0&&a>0||!this._tDur&&!a)&&fd(this._dp,this,this._start-this._delay)}return(this._tTime!==a||!this._dur&&!l||this._initted&&Math.abs(this._zTime)===pi||!this._initted&&this._dur&&a||!a&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=a),uee(this,a,l)),this},n.time=function(a,l){return arguments.length?this.totalTime(Math.min(this.totalDuration(),a+mY(this))%(this._dur+this._rDelay)||(a?this._dur:0),l):this._time},n.totalProgress=function(a,l){return arguments.length?this.totalTime(this.totalDuration()*a,l):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},n.progress=function(a,l){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-a:a)+mY(this),l):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},n.iteration=function(a,l){var d=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(a-1)*d,l):this._repeat?tv(this._tTime,d)+1:1},n.timeScale=function(a,l){if(!arguments.length)return this._rts===-pi?0:this._rts;if(this._rts===a)return this;var d=this.parent&&this._ts?fO(this.parent._time,this):this._tTime;return this._rts=+a||0,this._ts=this._ps||a===-pi?0:this._rts,this.totalTime($w(-Math.abs(this._delay),this.totalDuration(),d),l!==!1),eN(this),kPe(this)},n.paused=function(a){return arguments.length?(this._ps!==a&&(this._ps=a,a?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(rv(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==pi&&(this._tTime-=pi)))),this):this._ps},n.startTime=function(a){if(arguments.length){this._start=Yi(a);var l=this.parent||this._dp;return l&&(l._sort||!this.parent)&&fd(l,this,this._start-this._delay),this}return this._start},n.endTime=function(a){return this._start+(ka(a)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},n.rawTime=function(a){var l=this.parent||this._dp;return l?a&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?fO(l.rawTime(a),this):this._tTime:this._tTime},n.revert=function(a){a===void 0&&(a=APe);var l=_o;return _o=a,ZU(this)&&(this.timeline&&this.timeline.revert(a),this.totalTime(-.01,a.suppressEvents)),this.data!=="nested"&&a.kill!==!1&&this.kill(),_o=l,this},n.globalTime=function(a){for(var l=this,d=arguments.length?a:l.rawTime();l;)d=l._start+d/(Math.abs(l._ts)||1),l=l._dp;return!this.parent&&this._sat?this._sat.globalTime(a):d},n.repeat=function(a){return arguments.length?(this._repeat=a===1/0?-2:a,gY(this)):this._repeat===-2?1/0:this._repeat},n.repeatDelay=function(a){if(arguments.length){var l=this._time;return this._rDelay=a,gY(this),l?this.time(l):this}return this._rDelay},n.yoyo=function(a){return arguments.length?(this._yoyo=a,this):this._yoyo},n.seek=function(a,l){return this.totalTime(rl(this,a),ka(l))},n.restart=function(a,l){return this.play().totalTime(a?-this._delay:0,ka(l)),this._dur||(this._zTime=-pi),this},n.play=function(a,l){return a!=null&&this.seek(a,l),this.reversed(!1).paused(!1)},n.reverse=function(a,l){return a!=null&&this.seek(a||this.totalDuration(),l),this.reversed(!0).paused(!1)},n.pause=function(a,l){return a!=null&&this.seek(a,l),this.paused(!0)},n.resume=function(){return this.paused(!1)},n.reversed=function(a){return arguments.length?(!!a!==this.reversed()&&this.timeScale(-this._rts||(a?-pi:0)),this):this._rts<0},n.invalidate=function(){return this._initted=this._act=0,this._zTime=-pi,this},n.isActive=function(){var a=this.parent||this._dp,l=this._start,d;return!!(!a||this._ts&&this._initted&&a.isActive()&&(d=a.rawTime(!0))>=l&&d<this.endTime(!0)-pi)},n.eventCallback=function(a,l,d){var f=this.vars;return arguments.length>1?(l?(f[a]=l,d&&(f[a+"Params"]=d),a==="onUpdate"&&(this._onUpdate=l)):delete f[a],this):f[a]},n.then=function(a){var l=this,d=l._prom;return new Promise(function(f){var E=os(a)?a:hee,S=function(){var C=l.then;l.then=null,d&&d(),os(E)&&(E=E(l))&&(E.then||E===l)&&(l.then=C),f(E),l.then=C};l._initted&&l.totalProgress()===1&&l._ts>=0||!l._tTime&&l._ts<0?S():l._prom=S})},n.kill=function(){F0(this)},i})();yc(Aw.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-pi,_prom:0,_ps:!1,_rts:1});var Zo=(function(i){eee(n,i);function n(a,l){var d;return a===void 0&&(a={}),d=i.call(this,a)||this,d.labels={},d.smoothChildTiming=!!a.smoothChildTiming,d.autoRemoveChildren=!!a.autoRemoveChildren,d._sort=ka(a.sortChildren),qi&&fd(a.parent||qi,dh(d),l),a.reversed&&d.reverse(),a.paused&&d.paused(!0),a.scrollTrigger&&mee(dh(d),a.scrollTrigger),d}var s=n.prototype;return s.to=function(l,d,f){return tw(0,arguments,this),this},s.from=function(l,d,f){return tw(1,arguments,this),this},s.fromTo=function(l,d,f,E){return tw(2,arguments,this),this},s.set=function(l,d,f){return d.duration=0,d.parent=this,ew(d).repeatDelay||(d.repeat=0),d.immediateRender=!!d.immediateRender,new Rs(l,d,rl(this,f),1),this},s.call=function(l,d,f){return fd(this,Rs.delayedCall(0,l,d),f)},s.staggerTo=function(l,d,f,E,S,T,C){return f.duration=d,f.stagger=f.stagger||E,f.onComplete=T,f.onCompleteParams=C,f.parent=this,new Rs(l,f,rl(this,S)),this},s.staggerFrom=function(l,d,f,E,S,T,C){return f.runBackwards=1,ew(f).immediateRender=ka(f.immediateRender),this.staggerTo(l,d,f,E,S,T,C)},s.staggerFromTo=function(l,d,f,E,S,T,C,I){return E.startAt=f,ew(E).immediateRender=ka(E.immediateRender),this.staggerTo(l,d,E,S,T,C,I)},s.render=function(l,d,f){var E=this._time,S=this._dirty?this.totalDuration():this._tDur,T=this._dur,C=l<=0?0:Yi(l),I=this._zTime<0!=l<0&&(this._initted||!T),N,P,W,x,B,X,Z,$,ae,ce,le,ne;if(this!==qi&&C>S&&l>=0&&(C=S),C!==this._tTime||f||I){if(E!==this._time&&T&&(C+=this._time-E,l+=this._time-E),N=C,ae=this._start,$=this._ts,X=!$,I&&(T||(E=this._zTime),(l||!d)&&(this._zTime=l)),this._repeat){if(le=this._yoyo,B=T+this._rDelay,this._repeat<-1&&l<0)return this.totalTime(B*100+l,d,f);if(N=Yi(C%B),C===S?(x=this._repeat,N=T):(ce=Yi(C/B),x=~~ce,x&&x===ce&&(N=T,x--),N>T&&(N=T)),ce=tv(this._tTime,B),!E&&this._tTime&&ce!==x&&this._tTime-ce*B-this._dur<=0&&(ce=x),le&&x&1&&(N=T-N,ne=1),x!==ce&&!this._lock){var fe=le&&ce&1,Se=fe===(le&&x&1);if(x<ce&&(fe=!fe),E=fe?0:C%T?T:C,this._lock=1,this.render(E||(ne?0:Yi(x*B)),d,!T)._lock=0,this._tTime=C,!d&&this.parent&&hc(this,"onRepeat"),this.vars.repeatRefresh&&!ne&&(this.invalidate()._lock=1,ce=x),E&&E!==this._time||X!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(T=this._dur,S=this._tDur,Se&&(this._lock=2,E=fe?T:-1e-4,this.render(E,!0),this.vars.repeatRefresh&&!ne&&this.invalidate()),this._lock=0,!this._ts&&!X)return this;Nee(this,ne)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(Z=MPe(this,Yi(E),Yi(N)),Z&&(C-=N-(N=Z._start))),this._tTime=C,this._time=N,this._act=!$,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=l,E=0),!E&&C&&T&&!d&&!ce&&(hc(this,"onStart"),this._tTime!==C))return this;if(N>=E&&l>=0)for(P=this._first;P;){if(W=P._next,(P._act||N>=P._start)&&P._ts&&Z!==P){if(P.parent!==this)return this.render(l,d,f);if(P.render(P._ts>0?(N-P._start)*P._ts:(P._dirty?P.totalDuration():P._tDur)+(N-P._start)*P._ts,d,f),N!==this._time||!this._ts&&!X){Z=0,W&&(C+=this._zTime=-pi);break}}P=W}else{P=this._last;for(var De=l<0?l:N;P;){if(W=P._prev,(P._act||De<=P._end)&&P._ts&&Z!==P){if(P.parent!==this)return this.render(l,d,f);if(P.render(P._ts>0?(De-P._start)*P._ts:(P._dirty?P.totalDuration():P._tDur)+(De-P._start)*P._ts,d,f||_o&&ZU(P)),N!==this._time||!this._ts&&!X){Z=0,W&&(C+=this._zTime=De?-pi:pi);break}}P=W}}if(Z&&!d&&(this.pause(),Z.render(N>=E?0:-pi)._zTime=N>=E?1:-1,this._ts))return this._start=ae,eN(this),this.render(l,d,f);this._onUpdate&&!d&&hc(this,"onUpdate",!0),(C===S&&this._tTime>=this.totalDuration()||!C&&E)&&(ae===this._start||Math.abs($)!==Math.abs(this._ts))&&(this._lock||((l||!T)&&(C===S&&this._ts>0||!C&&this._ts<0)&&pf(this,1),!d&&!(l<0&&!E)&&(C||E||!S)&&(hc(this,C===S&&l>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(C<S&&this.timeScale()>0)&&this._prom())))}return this},s.add=function(l,d){var f=this;if(bh(d)||(d=rl(this,d,l)),!(l instanceof Aw)){if(Uo(l))return l.forEach(function(E){return f.add(E,d)}),this;if(Js(l))return this.addLabel(l,d);if(os(l))l=Rs.delayedCall(0,l);else return this}return this!==l?fd(this,l,d):this},s.getChildren=function(l,d,f,E){l===void 0&&(l=!0),d===void 0&&(d=!0),f===void 0&&(f=!0),E===void 0&&(E=-ol);for(var S=[],T=this._first;T;)T._start>=E&&(T instanceof Rs?d&&S.push(T):(f&&S.push(T),l&&S.push.apply(S,T.getChildren(!0,d,f)))),T=T._next;return S},s.getById=function(l){for(var d=this.getChildren(1,1,1),f=d.length;f--;)if(d[f].vars.id===l)return d[f]},s.remove=function(l){return Js(l)?this.removeLabel(l):os(l)?this.killTweensOf(l):(l.parent===this&&ZO(this,l),l===this._recent&&(this._recent=this._last),Ng(this))},s.totalTime=function(l,d){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Yi(dc.time-(this._ts>0?l/this._ts:(this.totalDuration()-l)/-this._ts))),i.prototype.totalTime.call(this,l,d),this._forcing=0,this):this._tTime},s.addLabel=function(l,d){return this.labels[l]=rl(this,d),this},s.removeLabel=function(l){return delete this.labels[l],this},s.addPause=function(l,d,f){var E=Rs.delayedCall(0,d||Rw,f);return E.data="isPause",this._hasPause=1,fd(this,E,rl(this,l))},s.removePause=function(l){var d=this._first;for(l=rl(this,l);d;)d._start===l&&d.data==="isPause"&&pf(d),d=d._next},s.killTweensOf=function(l,d,f){for(var E=this.getTweensOf(l,f),S=E.length;S--;)Qp!==E[S]&&E[S].kill(l,d);return this},s.getTweensOf=function(l,d){for(var f=[],E=al(l),S=this._first,T=bh(d),C;S;)S instanceof Rs?OPe(S._targets,E)&&(T?(!Qp||S._initted&&S._ts)&&S.globalTime(0)<=d&&S.globalTime(S.totalDuration())>d:!d||S.isActive())&&f.push(S):(C=S.getTweensOf(E,d)).length&&f.push.apply(f,C),S=S._next;return f},s.tweenTo=function(l,d){d=d||{};var f=this,E=rl(f,l),S=d,T=S.startAt,C=S.onStart,I=S.onStartParams,N=S.immediateRender,P,W=Rs.to(f,yc({ease:d.ease||"none",lazy:!1,immediateRender:!1,time:E,overwrite:"auto",duration:d.duration||Math.abs((E-(T&&"time"in T?T.time:f._time))/f.timeScale())||pi,onStart:function(){if(f.pause(),!P){var B=d.duration||Math.abs((E-(T&&"time"in T?T.time:f._time))/f.timeScale());W._dur!==B&&nv(W,B,0,1).render(W._time,!0,!0),P=1}C&&C.apply(W,I||[])}},d));return N?W.render(0):W},s.tweenFromTo=function(l,d,f){return this.tweenTo(d,yc({startAt:{time:rl(this,l)}},f))},s.recent=function(){return this._recent},s.nextLabel=function(l){return l===void 0&&(l=this._time),_Y(this,rl(this,l))},s.previousLabel=function(l){return l===void 0&&(l=this._time),_Y(this,rl(this,l),1)},s.currentLabel=function(l){return arguments.length?this.seek(l,!0):this.previousLabel(this._time+pi)},s.shiftChildren=function(l,d,f){f===void 0&&(f=0);var E=this._first,S=this.labels,T;for(l=Yi(l);E;)E._start>=f&&(E._start+=l,E._end+=l),E=E._next;if(d)for(T in S)S[T]>=f&&(S[T]+=l);return Ng(this)},s.invalidate=function(l){var d=this._first;for(this._lock=0;d;)d.invalidate(l),d=d._next;return i.prototype.invalidate.call(this,l)},s.clear=function(l){l===void 0&&(l=!0);for(var d=this._first,f;d;)f=d._next,this.remove(d),d=f;return this._dp&&(this._time=this._tTime=this._pTime=0),l&&(this.labels={}),Ng(this)},s.totalDuration=function(l){var d=0,f=this,E=f._last,S=ol,T,C,I;if(arguments.length)return f.timeScale((f._repeat<0?f.duration():f.totalDuration())/(f.reversed()?-l:l));if(f._dirty){for(I=f.parent;E;)T=E._prev,E._dirty&&E.totalDuration(),C=E._start,C>S&&f._sort&&E._ts&&!f._lock?(f._lock=1,fd(f,E,C-E._delay,1)._lock=0):S=C,C<0&&E._ts&&(d-=C,(!I&&!f._dp||I&&I.smoothChildTiming)&&(f._start+=Yi(C/f._ts),f._time-=C,f._tTime-=C),f.shiftChildren(-C,!1,-1/0),S=0),E._end>d&&E._ts&&(d=E._end),E=T;nv(f,f===qi&&f._time>d?f._time:d,1,1),f._dirty=0}return f._tDur},n.updateRoot=function(l){if(qi._ts&&(uee(qi,fO(l,qi)),cee=dc.frame),dc.frame>=pY){pY+=_c.autoSleep||120;var d=qi._first;if((!d||!d._ts)&&_c.autoSleep&&dc._listeners.length<2){for(;d&&!d._ts;)d=d._next;d||dc.sleep()}}},n})(Aw);yc(Zo.prototype,{_lock:0,_hasPause:0,_forcing:0});var QPe=function(n,s,a,l,d,f,E){var S=new xa(this._pt,n,s,0,1,Vee,null,d),T=0,C=0,I,N,P,W,x,B,X,Z;for(S.b=a,S.e=l,a+="",l+="",(X=~l.indexOf("random("))&&(l=bw(l)),f&&(Z=[a,l],f(Z,n,s),a=Z[0],l=Z[1]),N=a.match(_L)||[];I=_L.exec(l);)W=I[0],x=l.substring(T,I.index),P?P=(P+1)%5:x.substr(-5)==="rgba("&&(P=1),W!==N[C++]&&(B=parseFloat(N[C-1])||0,S._pt={_next:S._pt,p:x||C===1?x:",",s:B,c:W.charAt(1)==="="?Gy(B,W)-B:parseFloat(W)-B,m:P&&P<4?Math.round:0},T=_L.lastIndex);return S.c=T<l.length?l.substring(T,l.length):"",S.fp=E,(iee.test(l)||X)&&(S.e=0),this._pt=S,S},eV=function(n,s,a,l,d,f,E,S,T,C){os(l)&&(l=l(d||0,n,f));var I=n[s],N=a!=="get"?a:os(I)?T?n[s.indexOf("set")||!os(n["get"+s.substr(3)])?s:"get"+s.substr(3)](T):n[s]():I,P=os(I)?T?r1e:Mee:nV,W;if(Js(l)&&(~l.indexOf("random(")&&(l=bw(l)),l.charAt(1)==="="&&(W=Gy(N,l)+(Do(N)||0),(W||W===0)&&(l=W))),!C||N!==l||qM)return!isNaN(N*l)&&l!==""?(W=new xa(this._pt,n,s,+N||0,l-(N||0),typeof I=="boolean"?s1e:Uee,0,P),T&&(W.fp=T),E&&W.modifier(E,this,n),this._pt=W):(!I&&!(s in n)&&XU(s,l),QPe.call(this,n,s,N,l,P,S||_c.stringFilter,T))},ZPe=function(n,s,a,l,d){if(os(n)&&(n=nw(n,d,s,a,l)),!bd(n)||n.style&&n.nodeType||Uo(n)||nee(n))return Js(n)?nw(n,d,s,a,l):n;var f={},E;for(E in n)f[E]=nw(n[E],d,s,a,l);return f},Dee=function(n,s,a,l,d,f){var E,S,T,C;if(lc[n]&&(E=new lc[n]).init(d,E.rawVars?s[n]:ZPe(s[n],l,d,f,a),a,l,f)!==!1&&(a._pt=S=new xa(a._pt,d,n,0,1,E.render,E,0,E.priority),a!==ky))for(T=a._ptLookup[a._targets.indexOf(d)],C=E._props.length;C--;)T[E._props[C]]=S;return E},Qp,qM,tV=function i(n,s,a){var l=n.vars,d=l.ease,f=l.startAt,E=l.immediateRender,S=l.lazy,T=l.onUpdate,C=l.runBackwards,I=l.yoyoEase,N=l.keyframes,P=l.autoRevert,W=n._dur,x=n._startAt,B=n._targets,X=n.parent,Z=X&&X.data==="nested"?X.vars.targets:B,$=n._overwrite==="auto"&&!zU,ae=n.timeline,ce,le,ne,fe,Se,De,be,ye,Ge,Te,Fe,Je,je;if(ae&&(!N||!d)&&(d="none"),n._ease=Pg(d,Zy.ease),n._yEase=I?Oee(Pg(I===!0?d:I,Zy.ease)):0,I&&n._yoyo&&!n._repeat&&(I=n._yEase,n._yEase=n._ease,n._ease=I),n._from=!ae&&!!l.runBackwards,!ae||N&&!l.stagger){if(ye=B[0]?Og(B[0]).harness:0,Je=ye&&l[ye.prop],ce=pO(l,JU),x&&(x._zTime<0&&x.progress(1),s<0&&C&&E&&!P?x.render(-1,!0):x.revert(C&&W?NA:IPe),x._lazy=0),f){if(pf(n._startAt=Rs.set(B,yc({data:"isStart",overwrite:!1,parent:X,immediateRender:!0,lazy:!x&&ka(S),startAt:null,delay:0,onUpdate:T&&function(){return hc(n,"onUpdate")},stagger:0},f))),n._startAt._dp=0,n._startAt._sat=n,s<0&&(_o||!E&&!P)&&n._startAt.revert(NA),E&&W&&s<=0&&a<=0){s&&(n._zTime=s);return}}else if(C&&W&&!x){if(s&&(E=!1),ne=yc({overwrite:!1,data:"isFromStart",lazy:E&&!x&&ka(S),immediateRender:E,stagger:0,parent:X},ce),Je&&(ne[ye.prop]=Je),pf(n._startAt=Rs.set(B,ne)),n._startAt._dp=0,n._startAt._sat=n,s<0&&(_o?n._startAt.revert(NA):n._startAt.render(-1,!0)),n._zTime=s,!E)i(n._startAt,pi,pi);else if(!s)return}for(n._pt=n._ptCache=0,S=W&&ka(S)||S&&!W,le=0;le<B.length;le++){if(Se=B[le],be=Se._gsap||QU(B)[le]._gsap,n._ptLookup[le]=Te={},WM[be.id]&&sf.length&&hO(),Fe=Z===B?le:Z.indexOf(Se),ye&&(Ge=new ye).init(Se,Je||ce,n,Fe,Z)!==!1&&(n._pt=fe=new xa(n._pt,Se,Ge.name,0,1,Ge.render,Ge,0,Ge.priority),Ge._props.forEach(function(Ie){Te[Ie]=fe}),Ge.priority&&(De=1)),!ye||Je)for(ne in ce)lc[ne]&&(Ge=Dee(ne,ce,n,Fe,Se,Z))?Ge.priority&&(De=1):Te[ne]=fe=eV.call(n,Se,ne,"get",ce[ne],Fe,Z,0,l.stringFilter);n._op&&n._op[le]&&n.kill(Se,n._op[le]),$&&n._pt&&(Qp=n,qi.killTweensOf(Se,Te,n.globalTime(s)),je=!n.parent,Qp=0),n._pt&&S&&(WM[be.id]=1)}De&&Fee(n),n._onInit&&n._onInit(n)}n._onUpdate=T,n._initted=(!n._op||n._pt)&&!je,N&&s<=0&&ae.render(ol,!0,!0)},e1e=function(n,s,a,l,d,f,E,S){var T=(n._pt&&n._ptCache||(n._ptCache={}))[s],C,I,N,P;if(!T)for(T=n._ptCache[s]=[],N=n._ptLookup,P=n._targets.length;P--;){if(C=N[P][s],C&&C.d&&C.d._pt)for(C=C.d._pt;C&&C.p!==s&&C.fp!==s;)C=C._next;if(!C)return qM=1,n.vars[s]="+=0",tV(n,E),qM=0,S?Cw(s+" not eligible for reset"):1;T.push(C)}for(P=T.length;P--;)I=T[P],C=I._pt||I,C.s=(l||l===0)&&!d?l:C.s+(l||0)+f*C.c,C.c=a-C.s,I.e&&(I.e=ms(a)+Do(I.e)),I.b&&(I.b=C.s+Do(I.b))},t1e=function(n,s){var a=n[0]?Og(n[0]).harness:0,l=a&&a.aliases,d,f,E,S;if(!l)return s;d=ev({},s);for(f in l)if(f in d)for(S=l[f].split(","),E=S.length;E--;)d[S[E]]=d[f];return d},n1e=function(n,s,a,l){var d=s.ease||l||"power1.inOut",f,E;if(Uo(s))E=a[n]||(a[n]=[]),s.forEach(function(S,T){return E.push({t:T/(s.length-1)*100,v:S,e:d})});else for(f in s)E=a[f]||(a[f]=[]),f==="ease"||E.push({t:parseFloat(n),v:s[f],e:d})},nw=function(n,s,a,l,d){return os(n)?n.call(s,a,l,d):Js(n)&&~n.indexOf("random(")?bw(n):n},xee=$U+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",Lee={};Da(xee+",id,stagger,delay,duration,paused,scrollTrigger",function(i){return Lee[i]=1});var Rs=(function(i){eee(n,i);function n(a,l,d,f){var E;typeof l=="number"&&(d.duration=l,l=d,d=null),E=i.call(this,f?l:ew(l))||this;var S=E.vars,T=S.duration,C=S.delay,I=S.immediateRender,N=S.stagger,P=S.overwrite,W=S.keyframes,x=S.defaults,B=S.scrollTrigger,X=S.yoyoEase,Z=l.parent||qi,$=(Uo(a)||nee(a)?bh(a[0]):"length"in l)?[a]:al(a),ae,ce,le,ne,fe,Se,De,be;if(E._targets=$.length?QU($):Cw("GSAP target "+a+" not found. https://gsap.com",!_c.nullTargetWarn)||[],E._ptLookup=[],E._overwrite=P,W||N||lA(T)||lA(C)){if(l=E.vars,ae=E.timeline=new Zo({data:"nested",defaults:x||{},targets:Z&&Z.data==="nested"?Z.vars.targets:$}),ae.kill(),ae.parent=ae._dp=dh(E),ae._start=0,N||lA(T)||lA(C)){if(ne=$.length,De=N&&yee(N),bd(N))for(fe in N)~xee.indexOf(fe)&&(be||(be={}),be[fe]=N[fe]);for(ce=0;ce<ne;ce++)le=pO(l,Lee),le.stagger=0,X&&(le.yoyoEase=X),be&&ev(le,be),Se=$[ce],le.duration=+nw(T,dh(E),ce,Se,$),le.delay=(+nw(C,dh(E),ce,Se,$)||0)-E._delay,!N&&ne===1&&le.delay&&(E._delay=C=le.delay,E._start+=C,le.delay=0),ae.to(Se,le,De?De(ce,Se,$):0),ae._ease=pr.none;ae.duration()?T=C=0:E.timeline=0}else if(W){ew(yc(ae.vars.defaults,{ease:"none"})),ae._ease=Pg(W.ease||l.ease||"none");var ye=0,Ge,Te,Fe;if(Uo(W))W.forEach(function(Je){return ae.to($,Je,">")}),ae.duration();else{le={};for(fe in W)fe==="ease"||fe==="easeEach"||n1e(fe,W[fe],le,W.easeEach);for(fe in le)for(Ge=le[fe].sort(function(Je,je){return Je.t-je.t}),ye=0,ce=0;ce<Ge.length;ce++)Te=Ge[ce],Fe={ease:Te.e,duration:(Te.t-(ce?Ge[ce-1].t:0))/100*T},Fe[fe]=Te.v,ae.to($,Fe,ye),ye+=Fe.duration;ae.duration()<T&&ae.to({},{duration:T-ae.duration()})}}T||E.duration(T=ae.duration())}else E.timeline=0;return P===!0&&!zU&&(Qp=dh(E),qi.killTweensOf($),Qp=0),fd(Z,dh(E),d),l.reversed&&E.reverse(),l.paused&&E.paused(!0),(I||!T&&!W&&E._start===Yi(Z._time)&&ka(I)&&DPe(dh(E))&&Z.data!=="nested")&&(E._tTime=-pi,E.render(Math.max(0,-C)||0)),B&&mee(dh(E),B),E}var s=n.prototype;return s.render=function(l,d,f){var E=this._time,S=this._tDur,T=this._dur,C=l<0,I=l>S-pi&&!C?S:l<pi?0:l,N,P,W,x,B,X,Z,$,ae;if(!T)LPe(this,l,d,f);else if(I!==this._tTime||!l||f||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==C||this._lazy){if(N=I,$=this.timeline,this._repeat){if(x=T+this._rDelay,this._repeat<-1&&C)return this.totalTime(x*100+l,d,f);if(N=Yi(I%x),I===S?(W=this._repeat,N=T):(B=Yi(I/x),W=~~B,W&&W===B?(N=T,W--):N>T&&(N=T)),X=this._yoyo&&W&1,X&&(ae=this._yEase,N=T-N),B=tv(this._tTime,x),N===E&&!f&&this._initted&&W===B)return this._tTime=I,this;W!==B&&($&&this._yEase&&Nee($,X),this.vars.repeatRefresh&&!X&&!this._lock&&N!==x&&this._initted&&(this._lock=f=1,this.render(Yi(x*W),!0).invalidate()._lock=0))}if(!this._initted){if(gee(this,C?l:N,f,d,I))return this._tTime=0,this;if(E!==this._time&&!(f&&this.vars.repeatRefresh&&W!==B))return this;if(T!==this._dur)return this.render(l,d,f)}if(this._tTime=I,this._time=N,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=Z=(ae||this._ease)(N/T),this._from&&(this.ratio=Z=1-Z),!E&&I&&!d&&!B&&(hc(this,"onStart"),this._tTime!==I))return this;for(P=this._pt;P;)P.r(Z,P.d),P=P._next;$&&$.render(l<0?l:$._dur*$._ease(N/this._dur),d,f)||this._startAt&&(this._zTime=l),this._onUpdate&&!d&&(C&&GM(this,l,d,f),hc(this,"onUpdate")),this._repeat&&W!==B&&this.vars.onRepeat&&!d&&this.parent&&hc(this,"onRepeat"),(I===this._tDur||!I)&&this._tTime===I&&(C&&!this._onUpdate&&GM(this,l,!0,!0),(l||!T)&&(I===this._tDur&&this._ts>0||!I&&this._ts<0)&&pf(this,1),!d&&!(C&&!E)&&(I||E||X)&&(hc(this,I===S?"onComplete":"onReverseComplete",!0),this._prom&&!(I<S&&this.timeScale()>0)&&this._prom()))}return this},s.targets=function(){return this._targets},s.invalidate=function(l){return(!l||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(l),i.prototype.invalidate.call(this,l)},s.resetTo=function(l,d,f,E,S){Iw||dc.wake(),this._ts||this.play();var T=Math.min(this._dur,(this._dp._time-this._start)*this._ts),C;return this._initted||tV(this,T),C=this._ease(T/this._dur),e1e(this,l,d,f,E,C,T,S)?this.resetTo(l,d,f,E,1):(tN(this,0),this.parent||pee(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},s.kill=function(l,d){if(d===void 0&&(d="all"),!l&&(!d||d==="all"))return this._lazy=this._pt=0,this.parent?F0(this):this.scrollTrigger&&this.scrollTrigger.kill(!!_o),this;if(this.timeline){var f=this.timeline.totalDuration();return this.timeline.killTweensOf(l,d,Qp&&Qp.vars.overwrite!==!0)._first||F0(this),this.parent&&f!==this.timeline.totalDuration()&&nv(this,this._dur*this.timeline._tDur/f,0,1),this}var E=this._targets,S=l?al(l):E,T=this._ptLookup,C=this._pt,I,N,P,W,x,B,X;if((!d||d==="all")&&PPe(E,S))return d==="all"&&(this._pt=0),F0(this);for(I=this._op=this._op||[],d!=="all"&&(Js(d)&&(x={},Da(d,function(Z){return x[Z]=1}),d=x),d=t1e(E,d)),X=E.length;X--;)if(~S.indexOf(E[X])){N=T[X],d==="all"?(I[X]=d,W=N,P={}):(P=I[X]=I[X]||{},W=d);for(x in W)B=N&&N[x],B&&((!("kill"in B.d)||B.d.kill(x)===!0)&&ZO(this,B,"_pt"),delete N[x]),P!=="all"&&(P[x]=1)}return this._initted&&!this._pt&&C&&F0(this),this},n.to=function(l,d){return new n(l,d,arguments[2])},n.from=function(l,d){return tw(1,arguments)},n.delayedCall=function(l,d,f,E){return new n(d,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:l,onComplete:d,onReverseComplete:d,onCompleteParams:f,onReverseCompleteParams:f,callbackScope:E})},n.fromTo=function(l,d,f){return tw(2,arguments)},n.set=function(l,d){return d.duration=0,d.repeatDelay||(d.repeat=0),new n(l,d)},n.killTweensOf=function(l,d,f){return qi.killTweensOf(l,d,f)},n})(Aw);yc(Rs.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});Da("staggerTo,staggerFrom,staggerFromTo",function(i){Rs[i]=function(){var n=new Zo,s=zM.call(arguments,0);return s.splice(i==="staggerFromTo"?5:4,0,0),n[i].apply(n,s)}});var nV=function(n,s,a){return n[s]=a},Mee=function(n,s,a){return n[s](a)},r1e=function(n,s,a,l){return n[s](l.fp,a)},i1e=function(n,s,a){return n.setAttribute(s,a)},rV=function(n,s){return os(n[s])?Mee:KU(n[s])&&n.setAttribute?i1e:nV},Uee=function(n,s){return s.set(s.t,s.p,Math.round((s.s+s.c*n)*1e6)/1e6,s)},s1e=function(n,s){return s.set(s.t,s.p,!!(s.s+s.c*n),s)},Vee=function(n,s){var a=s._pt,l="";if(!n&&s.b)l=s.b;else if(n===1&&s.e)l=s.e;else{for(;a;)l=a.p+(a.m?a.m(a.s+a.c*n):Math.round((a.s+a.c*n)*1e4)/1e4)+l,a=a._next;l+=s.c}s.set(s.t,s.p,l,s)},iV=function(n,s){for(var a=s._pt;a;)a.r(n,a.d),a=a._next},o1e=function(n,s,a,l){for(var d=this._pt,f;d;)f=d._next,d.p===l&&d.modifier(n,s,a),d=f},a1e=function(n){for(var s=this._pt,a,l;s;)l=s._next,s.p===n&&!s.op||s.op===n?ZO(this,s,"_pt"):s.dep||(a=1),s=l;return!a},c1e=function(n,s,a,l){l.mSet(n,s,l.m.call(l.tween,a,l.mt),l)},Fee=function(n){for(var s=n._pt,a,l,d,f;s;){for(a=s._next,l=d;l&&l.pr>s.pr;)l=l._next;(s._prev=l?l._prev:f)?s._prev._next=s:d=s,(s._next=l)?l._prev=s:f=s,s=a}n._pt=d},xa=(function(){function i(s,a,l,d,f,E,S,T,C){this.t=a,this.s=d,this.c=f,this.p=l,this.r=E||Uee,this.d=S||this,this.set=T||nV,this.pr=C||0,this._next=s,s&&(s._prev=this)}var n=i.prototype;return n.modifier=function(a,l,d){this.mSet=this.mSet||this.set,this.set=c1e,this.m=a,this.mt=d,this.tween=l},i})();Da($U+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(i){return JU[i]=1});Ec.TweenMax=Ec.TweenLite=Rs;Ec.TimelineLite=Ec.TimelineMax=Zo;qi=new Zo({sortChildren:!1,defaults:Zy,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});_c.stringFilter=Aee;var kg=[],kA={},l1e=[],yY=0,u1e=0,TL=function(n){return(kA[n]||l1e).map(function(s){return s()})},XM=function(){var n=Date.now(),s=[];n-yY>2&&(TL("matchMediaInit"),kg.forEach(function(a){var l=a.queries,d=a.conditions,f,E,S,T;for(E in l)f=pd.matchMedia(l[E]).matches,f&&(S=1),f!==d[E]&&(d[E]=f,T=1);T&&(a.revert(),S&&s.push(a))}),TL("matchMediaRevert"),s.forEach(function(a){return a.onMatch(a,function(l){return a.add(null,l)})}),yY=n,TL("matchMedia"))},jee=(function(){function i(s,a){this.selector=a&&KM(a),this.data=[],this._r=[],this.isReverted=!1,this.id=u1e++,s&&this.add(s)}var n=i.prototype;return n.add=function(a,l,d){os(a)&&(d=l,l=a,a=os);var f=this,E=function(){var T=Vi,C=f.selector,I;return T&&T!==f&&T.data.push(f),d&&(f.selector=KM(d)),Vi=f,I=l.apply(f,arguments),os(I)&&f._r.push(I),Vi=T,f.selector=C,f.isReverted=!1,I};return f.last=E,a===os?E(f,function(S){return f.add(null,S)}):a?f[a]=E:E},n.ignore=function(a){var l=Vi;Vi=null,a(this),Vi=l},n.getTweens=function(){var a=[];return this.data.forEach(function(l){return l instanceof i?a.push.apply(a,l.getTweens()):l instanceof Rs&&!(l.parent&&l.parent.data==="nested")&&a.push(l)}),a},n.clear=function(){this._r.length=this.data.length=0},n.kill=function(a,l){var d=this;if(a?(function(){for(var E=d.getTweens(),S=d.data.length,T;S--;)T=d.data[S],T.data==="isFlip"&&(T.revert(),T.getChildren(!0,!0,!1).forEach(function(C){return E.splice(E.indexOf(C),1)}));for(E.map(function(C){return{g:C._dur||C._delay||C._sat&&!C._sat.vars.immediateRender?C.globalTime(0):-1/0,t:C}}).sort(function(C,I){return I.g-C.g||-1/0}).forEach(function(C){return C.t.revert(a)}),S=d.data.length;S--;)T=d.data[S],T instanceof Zo?T.data!=="nested"&&(T.scrollTrigger&&T.scrollTrigger.revert(),T.kill()):!(T instanceof Rs)&&T.revert&&T.revert(a);d._r.forEach(function(C){return C(a,d)}),d.isReverted=!0})():this.data.forEach(function(E){return E.kill&&E.kill()}),this.clear(),l)for(var f=kg.length;f--;)kg[f].id===this.id&&kg.splice(f,1)},n.revert=function(a){this.kill(a||{})},i})(),d1e=(function(){function i(s){this.contexts=[],this.scope=s,Vi&&Vi.data.push(this)}var n=i.prototype;return n.add=function(a,l,d){bd(a)||(a={matches:a});var f=new jee(0,d||this.scope),E=f.conditions={},S,T,C;Vi&&!f.selector&&(f.selector=Vi.selector),this.contexts.push(f),l=f.add("onMatch",l),f.queries=a;for(T in a)T==="all"?C=1:(S=pd.matchMedia(a[T]),S&&(kg.indexOf(f)<0&&kg.push(f),(E[T]=S.matches)&&(C=1),S.addListener?S.addListener(XM):S.addEventListener("change",XM)));return C&&l(f,function(I){return f.add(null,I)}),this},n.revert=function(a){this.kill(a||{})},n.kill=function(a){this.contexts.forEach(function(l){return l.kill(a,!0)})},i})(),mO={registerPlugin:function(){for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];s.forEach(function(l){return Ree(l)})},timeline:function(n){return new Zo(n)},getTweensOf:function(n,s){return qi.getTweensOf(n,s)},getProperty:function(n,s,a,l){Js(n)&&(n=al(n)[0]);var d=Og(n||{}).get,f=a?hee:dee;return a==="native"&&(a=""),n&&(s?f((lc[s]&&lc[s].get||d)(n,s,a,l)):function(E,S,T){return f((lc[E]&&lc[E].get||d)(n,E,S,T))})},quickSetter:function(n,s,a){if(n=al(n),n.length>1){var l=n.map(function(C){return Ua.quickSetter(C,s,a)}),d=l.length;return function(C){for(var I=d;I--;)l[I](C)}}n=n[0]||{};var f=lc[s],E=Og(n),S=E.harness&&(E.harness.aliases||{})[s]||s,T=f?function(C){var I=new f;ky._pt=0,I.init(n,a?C+a:C,ky,0,[n]),I.render(1,I),ky._pt&&iV(1,ky)}:E.set(n,S);return f?T:function(C){return T(n,S,a?C+a:C,E,1)}},quickTo:function(n,s,a){var l,d=Ua.to(n,yc((l={},l[s]="+=0.1",l.paused=!0,l.stagger=0,l),a||{})),f=function(S,T,C){return d.resetTo(s,S,T,C)};return f.tween=d,f},isTweening:function(n){return qi.getTweensOf(n,!0).length>0},defaults:function(n){return n&&n.ease&&(n.ease=Pg(n.ease,Zy.ease)),fY(Zy,n||{})},config:function(n){return fY(_c,n||{})},registerEffect:function(n){var s=n.name,a=n.effect,l=n.plugins,d=n.defaults,f=n.extendTimeline;(l||"").split(",").forEach(function(E){return E&&!lc[E]&&!Ec[E]&&Cw(s+" effect requires "+E+" plugin.")}),EL[s]=function(E,S,T){return a(al(E),yc(S||{},d),T)},f&&(Zo.prototype[s]=function(E,S,T){return this.add(EL[s](E,bd(S)?S:(T=S)&&{},this),T)})},registerEase:function(n,s){pr[n]=Pg(s)},parseEase:function(n,s){return arguments.length?Pg(n,s):pr},getById:function(n){return qi.getById(n)},exportRoot:function(n,s){n===void 0&&(n={});var a=new Zo(n),l,d;for(a.smoothChildTiming=ka(n.smoothChildTiming),qi.remove(a),a._dp=0,a._time=a._tTime=qi._time,l=qi._first;l;)d=l._next,(s||!(!l._dur&&l instanceof Rs&&l.vars.onComplete===l._targets[0]))&&fd(a,l,l._start-l._delay),l=d;return fd(qi,a,0),a},context:function(n,s){return n?new jee(n,s):Vi},matchMedia:function(n){return new d1e(n)},matchMediaRefresh:function(){return kg.forEach(function(n){var s=n.conditions,a,l;for(l in s)s[l]&&(s[l]=!1,a=1);a&&n.revert()})||XM()},addEventListener:function(n,s){var a=kA[n]||(kA[n]=[]);~a.indexOf(s)||a.push(s)},removeEventListener:function(n,s){var a=kA[n],l=a&&a.indexOf(s);l>=0&&a.splice(l,1)},utils:{wrap:GPe,wrapYoyo:HPe,distribute:yee,random:See,snap:vee,normalize:WPe,getUnit:Do,clamp:VPe,splitColor:bee,toArray:al,selector:KM,mapRange:wee,pipe:jPe,unitize:BPe,interpolate:zPe,shuffle:Eee},install:oee,effects:EL,ticker:dc,updateRoot:Zo.updateRoot,plugins:lc,globalTimeline:qi,core:{PropTween:xa,globals:aee,Tween:Rs,Timeline:Zo,Animation:Aw,getCache:Og,_removeLinkedListItem:ZO,reverting:function(){return _o},context:function(n){return n&&Vi&&(Vi.data.push(n),n._ctx=Vi),Vi},suppressOverwrites:function(n){return zU=n}}};Da("to,from,fromTo,delayedCall,set,killTweensOf",function(i){return mO[i]=Rs[i]});dc.add(Zo.updateRoot);ky=mO.to({},{duration:0});var h1e=function(n,s){for(var a=n._pt;a&&a.p!==s&&a.op!==s&&a.fp!==s;)a=a._next;return a},p1e=function(n,s){var a=n._targets,l,d,f;for(l in s)for(d=a.length;d--;)f=n._ptLookup[d][l],f&&(f=f.d)&&(f._pt&&(f=h1e(f,l)),f&&f.modifier&&f.modifier(s[l],n,a[d],l))},wL=function(n,s){return{name:n,headless:1,rawVars:1,init:function(l,d,f){f._onInit=function(E){var S,T;if(Js(d)&&(S={},Da(d,function(C){return S[C]=1}),d=S),s){S={};for(T in d)S[T]=s(d[T]);d=S}p1e(E,d)}}}},Ua=mO.registerPlugin({name:"attr",init:function(n,s,a,l,d){var f,E,S;this.tween=a;for(f in s)S=n.getAttribute(f)||"",E=this.add(n,"setAttribute",(S||0)+"",s[f],l,d,0,0,f),E.op=f,E.b=S,this._props.push(f)},render:function(n,s){for(var a=s._pt;a;)_o?a.set(a.t,a.p,a.b,a):a.r(n,a.d),a=a._next}},{name:"endArray",headless:1,init:function(n,s){for(var a=s.length;a--;)this.add(n,a,n[a]||0,s[a],0,0,0,0,0,1)}},wL("roundProps",YM),wL("modifiers"),wL("snap",vee))||mO;Rs.version=Zo.version=Ua.version="3.14.2";see=1;YU()&&rv();pr.Power0;pr.Power1;pr.Power2;pr.Power3;pr.Power4;pr.Linear;pr.Quad;pr.Cubic;pr.Quart;pr.Quint;pr.Strong;pr.Elastic;pr.Back;pr.SteppedEase;pr.Bounce;pr.Sine;pr.Expo;pr.Circ;var vY,Zp,Hy,sV,bg,SY,oV,f1e=function(){return typeof window<"u"},Ih={},_g=180/Math.PI,zy=Math.PI/180,my=Math.atan2,TY=1e8,aV=/([A-Z])/g,m1e=/(left|right|width|margin|padding|x)/i,g1e=/[\s,\(]\S/,Ed={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},JM=function(n,s){return s.set(s.t,s.p,Math.round((s.s+s.c*n)*1e4)/1e4+s.u,s)},_1e=function(n,s){return s.set(s.t,s.p,n===1?s.e:Math.round((s.s+s.c*n)*1e4)/1e4+s.u,s)},E1e=function(n,s){return s.set(s.t,s.p,n?Math.round((s.s+s.c*n)*1e4)/1e4+s.u:s.b,s)},y1e=function(n,s){return s.set(s.t,s.p,n===1?s.e:n?Math.round((s.s+s.c*n)*1e4)/1e4+s.u:s.b,s)},v1e=function(n,s){var a=s.s+s.c*n;s.set(s.t,s.p,~~(a+(a<0?-.5:.5))+s.u,s)},Bee=function(n,s){return s.set(s.t,s.p,n?s.e:s.b,s)},Wee=function(n,s){return s.set(s.t,s.p,n!==1?s.b:s.e,s)},S1e=function(n,s,a){return n.style[s]=a},T1e=function(n,s,a){return n.style.setProperty(s,a)},w1e=function(n,s,a){return n._gsap[s]=a},C1e=function(n,s,a){return n._gsap.scaleX=n._gsap.scaleY=a},R1e=function(n,s,a,l,d){var f=n._gsap;f.scaleX=f.scaleY=a,f.renderTransform(d,f)},b1e=function(n,s,a,l,d){var f=n._gsap;f[s]=a,f.renderTransform(d,f)},Ji="transform",La=Ji+"Origin",I1e=function i(n,s){var a=this,l=this.target,d=l.style,f=l._gsap;if(n in Ih&&d){if(this.tfm=this.tfm||{},n!=="transform")n=Ed[n]||n,~n.indexOf(",")?n.split(",").forEach(function(E){return a.tfm[E]=hh(l,E)}):this.tfm[n]=f.x?f[n]:hh(l,n),n===La&&(this.tfm.zOrigin=f.zOrigin);else return Ed.transform.split(",").forEach(function(E){return i.call(a,E,s)});if(this.props.indexOf(Ji)>=0)return;f.svg&&(this.svgo=l.getAttribute("data-svg-origin"),this.props.push(La,s,"")),n=Ji}(d||s)&&this.props.push(n,s,d[n])},Gee=function(n){n.translate&&(n.removeProperty("translate"),n.removeProperty("scale"),n.removeProperty("rotate"))},A1e=function(){var n=this.props,s=this.target,a=s.style,l=s._gsap,d,f;for(d=0;d<n.length;d+=3)n[d+1]?n[d+1]===2?s[n[d]](n[d+2]):s[n[d]]=n[d+2]:n[d+2]?a[n[d]]=n[d+2]:a.removeProperty(n[d].substr(0,2)==="--"?n[d]:n[d].replace(aV,"-$1").toLowerCase());if(this.tfm){for(f in this.tfm)l[f]=this.tfm[f];l.svg&&(l.renderTransform(),s.setAttribute("data-svg-origin",this.svgo||"")),d=oV(),(!d||!d.isStart)&&!a[Ji]&&(Gee(a),l.zOrigin&&a[La]&&(a[La]+=" "+l.zOrigin+"px",l.zOrigin=0,l.renderTransform()),l.uncache=1)}},Hee=function(n,s){var a={target:n,props:[],revert:A1e,save:I1e};return n._gsap||Ua.core.getCache(n),s&&n.style&&n.nodeType&&s.split(",").forEach(function(l){return a.save(l)}),a},zee,$M=function(n,s){var a=Zp.createElementNS?Zp.createElementNS((s||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),n):Zp.createElement(n);return a&&a.style?a:Zp.createElement(n)},pc=function i(n,s,a){var l=getComputedStyle(n);return l[s]||l.getPropertyValue(s.replace(aV,"-$1").toLowerCase())||l.getPropertyValue(s)||!a&&i(n,iv(s)||s,1)||""},wY="O,Moz,ms,Ms,Webkit".split(","),iv=function(n,s,a){var l=s||bg,d=l.style,f=5;if(n in d&&!a)return n;for(n=n.charAt(0).toUpperCase()+n.substr(1);f--&&!(wY[f]+n in d););return f<0?null:(f===3?"ms":f>=0?wY[f]:"")+n},QM=function(){f1e()&&window.document&&(vY=window,Zp=vY.document,Hy=Zp.documentElement,bg=$M("div")||{style:{}},$M("div"),Ji=iv(Ji),La=Ji+"Origin",bg.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",zee=!!iv("perspective"),oV=Ua.core.reverting,sV=1)},CY=function(n){var s=n.ownerSVGElement,a=$M("svg",s&&s.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),l=n.cloneNode(!0),d;l.style.display="block",a.appendChild(l),Hy.appendChild(a);try{d=l.getBBox()}catch{}return a.removeChild(l),Hy.removeChild(a),d},RY=function(n,s){for(var a=s.length;a--;)if(n.hasAttribute(s[a]))return n.getAttribute(s[a])},Kee=function(n){var s,a;try{s=n.getBBox()}catch{s=CY(n),a=1}return s&&(s.width||s.height)||a||(s=CY(n)),s&&!s.width&&!s.x&&!s.y?{x:+RY(n,["x","cx","x1"])||0,y:+RY(n,["y","cy","y1"])||0,width:0,height:0}:s},Yee=function(n){return!!(n.getCTM&&(!n.parentNode||n.ownerSVGElement)&&Kee(n))},ff=function(n,s){if(s){var a=n.style,l;s in Ih&&s!==La&&(s=Ji),a.removeProperty?(l=s.substr(0,2),(l==="ms"||s.substr(0,6)==="webkit")&&(s="-"+s),a.removeProperty(l==="--"?s:s.replace(aV,"-$1").toLowerCase())):a.removeAttribute(s)}},ef=function(n,s,a,l,d,f){var E=new xa(n._pt,s,a,0,1,f?Wee:Bee);return n._pt=E,E.b=l,E.e=d,n._props.push(a),E},bY={deg:1,rad:1,turn:1},O1e={grid:1,flex:1},mf=function i(n,s,a,l){var d=parseFloat(a)||0,f=(a+"").trim().substr((d+"").length)||"px",E=bg.style,S=m1e.test(s),T=n.tagName.toLowerCase()==="svg",C=(T?"client":"offset")+(S?"Width":"Height"),I=100,N=l==="px",P=l==="%",W,x,B,X;if(l===f||!d||bY[l]||bY[f])return d;if(f!=="px"&&!N&&(d=i(n,s,a,"px")),X=n.getCTM&&Yee(n),(P||f==="%")&&(Ih[s]||~s.indexOf("adius")))return W=X?n.getBBox()[S?"width":"height"]:n[C],ms(P?d/W*I:d/100*W);if(E[S?"width":"height"]=I+(N?f:l),x=l!=="rem"&&~s.indexOf("adius")||l==="em"&&n.appendChild&&!T?n:n.parentNode,X&&(x=(n.ownerSVGElement||{}).parentNode),(!x||x===Zp||!x.appendChild)&&(x=Zp.body),B=x._gsap,B&&P&&B.width&&S&&B.time===dc.time&&!B.uncache)return ms(d/B.width*I);if(P&&(s==="height"||s==="width")){var Z=n.style[s];n.style[s]=I+l,W=n[C],Z?n.style[s]=Z:ff(n,s)}else(P||f==="%")&&!O1e[pc(x,"display")]&&(E.position=pc(n,"position")),x===n&&(E.position="static"),x.appendChild(bg),W=bg[C],x.removeChild(bg),E.position="absolute";return S&&P&&(B=Og(x),B.time=dc.time,B.width=x[C]),ms(N?W*d/I:W&&d?I/W*d:0)},hh=function(n,s,a,l){var d;return sV||QM(),s in Ed&&s!=="transform"&&(s=Ed[s],~s.indexOf(",")&&(s=s.split(",")[0])),Ih[s]&&s!=="transform"?(d=Nw(n,l),d=s!=="transformOrigin"?d[s]:d.svg?d.origin:_O(pc(n,La))+" "+d.zOrigin+"px"):(d=n.style[s],(!d||d==="auto"||l||~(d+"").indexOf("calc("))&&(d=gO[s]&&gO[s](n,s,a)||pc(n,s)||lee(n,s)||(s==="opacity"?1:0))),a&&!~(d+"").trim().indexOf(" ")?mf(n,s,d,a)+a:d},N1e=function(n,s,a,l){if(!a||a==="none"){var d=iv(s,n,1),f=d&&pc(n,d,1);f&&f!==a?(s=d,a=f):s==="borderColor"&&(a=pc(n,"borderTopColor"))}var E=new xa(this._pt,n.style,s,0,1,Vee),S=0,T=0,C,I,N,P,W,x,B,X,Z,$,ae,ce;if(E.b=a,E.e=l,a+="",l+="",l.substring(0,6)==="var(--"&&(l=pc(n,l.substring(4,l.indexOf(")")))),l==="auto"&&(x=n.style[s],n.style[s]=l,l=pc(n,s)||l,x?n.style[s]=x:ff(n,s)),C=[a,l],Aee(C),a=C[0],l=C[1],N=a.match(Py)||[],ce=l.match(Py)||[],ce.length){for(;I=Py.exec(l);)B=I[0],Z=l.substring(S,I.index),W?W=(W+1)%5:(Z.substr(-5)==="rgba("||Z.substr(-5)==="hsla(")&&(W=1),B!==(x=N[T++]||"")&&(P=parseFloat(x)||0,ae=x.substr((P+"").length),B.charAt(1)==="="&&(B=Gy(P,B)+ae),X=parseFloat(B),$=B.substr((X+"").length),S=Py.lastIndex-$.length,$||($=$||_c.units[s]||ae,S===l.length&&(l+=$,E.e+=$)),ae!==$&&(P=mf(n,s,x,$)||0),E._pt={_next:E._pt,p:Z||T===1?Z:",",s:P,c:X-P,m:W&&W<4||s==="zIndex"?Math.round:0});E.c=S<l.length?l.substring(S,l.length):""}else E.r=s==="display"&&l==="none"?Wee:Bee;return iee.test(l)&&(E.e=0),this._pt=E,E},IY={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},P1e=function(n){var s=n.split(" "),a=s[0],l=s[1]||"50%";return(a==="top"||a==="bottom"||l==="left"||l==="right")&&(n=a,a=l,l=n),s[0]=IY[a]||a,s[1]=IY[l]||l,s.join(" ")},k1e=function(n,s){if(s.tween&&s.tween._time===s.tween._dur){var a=s.t,l=a.style,d=s.u,f=a._gsap,E,S,T;if(d==="all"||d===!0)l.cssText="",S=1;else for(d=d.split(","),T=d.length;--T>-1;)E=d[T],Ih[E]&&(S=1,E=E==="transformOrigin"?La:Ji),ff(a,E);S&&(ff(a,Ji),f&&(f.svg&&a.removeAttribute("transform"),l.scale=l.rotate=l.translate="none",Nw(a,1),f.uncache=1,Gee(l)))}},gO={clearProps:function(n,s,a,l,d){if(d.data!=="isFromStart"){var f=n._pt=new xa(n._pt,s,a,0,0,k1e);return f.u=l,f.pr=-10,f.tween=d,n._props.push(a),1}}},Ow=[1,0,0,1,0,0],qee={},Xee=function(n){return n==="matrix(1, 0, 0, 1, 0, 0)"||n==="none"||!n},AY=function(n){var s=pc(n,Ji);return Xee(s)?Ow:s.substr(7).match(ree).map(ms)},cV=function(n,s){var a=n._gsap||Og(n),l=n.style,d=AY(n),f,E,S,T;return a.svg&&n.getAttribute("transform")?(S=n.transform.baseVal.consolidate().matrix,d=[S.a,S.b,S.c,S.d,S.e,S.f],d.join(",")==="1,0,0,1,0,0"?Ow:d):(d===Ow&&!n.offsetParent&&n!==Hy&&!a.svg&&(S=l.display,l.display="block",f=n.parentNode,(!f||!n.offsetParent&&!n.getBoundingClientRect().width)&&(T=1,E=n.nextElementSibling,Hy.appendChild(n)),d=AY(n),S?l.display=S:ff(n,"display"),T&&(E?f.insertBefore(n,E):f?f.appendChild(n):Hy.removeChild(n))),s&&d.length>6?[d[0],d[1],d[4],d[5],d[12],d[13]]:d)},ZM=function(n,s,a,l,d,f){var E=n._gsap,S=d||cV(n,!0),T=E.xOrigin||0,C=E.yOrigin||0,I=E.xOffset||0,N=E.yOffset||0,P=S[0],W=S[1],x=S[2],B=S[3],X=S[4],Z=S[5],$=s.split(" "),ae=parseFloat($[0])||0,ce=parseFloat($[1])||0,le,ne,fe,Se;a?S!==Ow&&(ne=P*B-W*x)&&(fe=ae*(B/ne)+ce*(-x/ne)+(x*Z-B*X)/ne,Se=ae*(-W/ne)+ce*(P/ne)-(P*Z-W*X)/ne,ae=fe,ce=Se):(le=Kee(n),ae=le.x+(~$[0].indexOf("%")?ae/100*le.width:ae),ce=le.y+(~($[1]||$[0]).indexOf("%")?ce/100*le.height:ce)),l||l!==!1&&E.smooth?(X=ae-T,Z=ce-C,E.xOffset=I+(X*P+Z*x)-X,E.yOffset=N+(X*W+Z*B)-Z):E.xOffset=E.yOffset=0,E.xOrigin=ae,E.yOrigin=ce,E.smooth=!!l,E.origin=s,E.originIsAbsolute=!!a,n.style[La]="0px 0px",f&&(ef(f,E,"xOrigin",T,ae),ef(f,E,"yOrigin",C,ce),ef(f,E,"xOffset",I,E.xOffset),ef(f,E,"yOffset",N,E.yOffset)),n.setAttribute("data-svg-origin",ae+" "+ce)},Nw=function(n,s){var a=n._gsap||new kee(n);if("x"in a&&!s&&!a.uncache)return a;var l=n.style,d=a.scaleX<0,f="px",E="deg",S=getComputedStyle(n),T=pc(n,La)||"0",C,I,N,P,W,x,B,X,Z,$,ae,ce,le,ne,fe,Se,De,be,ye,Ge,Te,Fe,Je,je,Ie,He,re,ge,Oe,ue,it,yt;return C=I=N=x=B=X=Z=$=ae=0,P=W=1,a.svg=!!(n.getCTM&&Yee(n)),S.translate&&((S.translate!=="none"||S.scale!=="none"||S.rotate!=="none")&&(l[Ji]=(S.translate!=="none"?"translate3d("+(S.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(S.rotate!=="none"?"rotate("+S.rotate+") ":"")+(S.scale!=="none"?"scale("+S.scale.split(" ").join(",")+") ":"")+(S[Ji]!=="none"?S[Ji]:"")),l.scale=l.rotate=l.translate="none"),ne=cV(n,a.svg),a.svg&&(a.uncache?(Ie=n.getBBox(),T=a.xOrigin-Ie.x+"px "+(a.yOrigin-Ie.y)+"px",je=""):je=!s&&n.getAttribute("data-svg-origin"),ZM(n,je||T,!!je||a.originIsAbsolute,a.smooth!==!1,ne)),ce=a.xOrigin||0,le=a.yOrigin||0,ne!==Ow&&(be=ne[0],ye=ne[1],Ge=ne[2],Te=ne[3],C=Fe=ne[4],I=Je=ne[5],ne.length===6?(P=Math.sqrt(be*be+ye*ye),W=Math.sqrt(Te*Te+Ge*Ge),x=be||ye?my(ye,be)*_g:0,Z=Ge||Te?my(Ge,Te)*_g+x:0,Z&&(W*=Math.abs(Math.cos(Z*zy))),a.svg&&(C-=ce-(ce*be+le*Ge),I-=le-(ce*ye+le*Te))):(yt=ne[6],ue=ne[7],re=ne[8],ge=ne[9],Oe=ne[10],it=ne[11],C=ne[12],I=ne[13],N=ne[14],fe=my(yt,Oe),B=fe*_g,fe&&(Se=Math.cos(-fe),De=Math.sin(-fe),je=Fe*Se+re*De,Ie=Je*Se+ge*De,He=yt*Se+Oe*De,re=Fe*-De+re*Se,ge=Je*-De+ge*Se,Oe=yt*-De+Oe*Se,it=ue*-De+it*Se,Fe=je,Je=Ie,yt=He),fe=my(-Ge,Oe),X=fe*_g,fe&&(Se=Math.cos(-fe),De=Math.sin(-fe),je=be*Se-re*De,Ie=ye*Se-ge*De,He=Ge*Se-Oe*De,it=Te*De+it*Se,be=je,ye=Ie,Ge=He),fe=my(ye,be),x=fe*_g,fe&&(Se=Math.cos(fe),De=Math.sin(fe),je=be*Se+ye*De,Ie=Fe*Se+Je*De,ye=ye*Se-be*De,Je=Je*Se-Fe*De,be=je,Fe=Ie),B&&Math.abs(B)+Math.abs(x)>359.9&&(B=x=0,X=180-X),P=ms(Math.sqrt(be*be+ye*ye+Ge*Ge)),W=ms(Math.sqrt(Je*Je+yt*yt)),fe=my(Fe,Je),Z=Math.abs(fe)>2e-4?fe*_g:0,ae=it?1/(it<0?-it:it):0),a.svg&&(je=n.getAttribute("transform"),a.forceCSS=n.setAttribute("transform","")||!Xee(pc(n,Ji)),je&&n.setAttribute("transform",je))),Math.abs(Z)>90&&Math.abs(Z)<270&&(d?(P*=-1,Z+=x<=0?180:-180,x+=x<=0?180:-180):(W*=-1,Z+=Z<=0?180:-180)),s=s||a.uncache,a.x=C-((a.xPercent=C&&(!s&&a.xPercent||(Math.round(n.offsetWidth/2)===Math.round(-C)?-50:0)))?n.offsetWidth*a.xPercent/100:0)+f,a.y=I-((a.yPercent=I&&(!s&&a.yPercent||(Math.round(n.offsetHeight/2)===Math.round(-I)?-50:0)))?n.offsetHeight*a.yPercent/100:0)+f,a.z=N+f,a.scaleX=ms(P),a.scaleY=ms(W),a.rotation=ms(x)+E,a.rotationX=ms(B)+E,a.rotationY=ms(X)+E,a.skewX=Z+E,a.skewY=$+E,a.transformPerspective=ae+f,(a.zOrigin=parseFloat(T.split(" ")[2])||!s&&a.zOrigin||0)&&(l[La]=_O(T)),a.xOffset=a.yOffset=0,a.force3D=_c.force3D,a.renderTransform=a.svg?x1e:zee?Jee:D1e,a.uncache=0,a},_O=function(n){return(n=n.split(" "))[0]+" "+n[1]},CL=function(n,s,a){var l=Do(s);return ms(parseFloat(s)+parseFloat(mf(n,"x",a+"px",l)))+l},D1e=function(n,s){s.z="0px",s.rotationY=s.rotationX="0deg",s.force3D=0,Jee(n,s)},pg="0deg",O0="0px",fg=") ",Jee=function(n,s){var a=s||this,l=a.xPercent,d=a.yPercent,f=a.x,E=a.y,S=a.z,T=a.rotation,C=a.rotationY,I=a.rotationX,N=a.skewX,P=a.skewY,W=a.scaleX,x=a.scaleY,B=a.transformPerspective,X=a.force3D,Z=a.target,$=a.zOrigin,ae="",ce=X==="auto"&&n&&n!==1||X===!0;if($&&(I!==pg||C!==pg)){var le=parseFloat(C)*zy,ne=Math.sin(le),fe=Math.cos(le),Se;le=parseFloat(I)*zy,Se=Math.cos(le),f=CL(Z,f,ne*Se*-$),E=CL(Z,E,-Math.sin(le)*-$),S=CL(Z,S,fe*Se*-$+$)}B!==O0&&(ae+="perspective("+B+fg),(l||d)&&(ae+="translate("+l+"%, "+d+"%) "),(ce||f!==O0||E!==O0||S!==O0)&&(ae+=S!==O0||ce?"translate3d("+f+", "+E+", "+S+") ":"translate("+f+", "+E+fg),T!==pg&&(ae+="rotate("+T+fg),C!==pg&&(ae+="rotateY("+C+fg),I!==pg&&(ae+="rotateX("+I+fg),(N!==pg||P!==pg)&&(ae+="skew("+N+", "+P+fg),(W!==1||x!==1)&&(ae+="scale("+W+", "+x+fg),Z.style[Ji]=ae||"translate(0, 0)"},x1e=function(n,s){var a=s||this,l=a.xPercent,d=a.yPercent,f=a.x,E=a.y,S=a.rotation,T=a.skewX,C=a.skewY,I=a.scaleX,N=a.scaleY,P=a.target,W=a.xOrigin,x=a.yOrigin,B=a.xOffset,X=a.yOffset,Z=a.forceCSS,$=parseFloat(f),ae=parseFloat(E),ce,le,ne,fe,Se;S=parseFloat(S),T=parseFloat(T),C=parseFloat(C),C&&(C=parseFloat(C),T+=C,S+=C),S||T?(S*=zy,T*=zy,ce=Math.cos(S)*I,le=Math.sin(S)*I,ne=Math.sin(S-T)*-N,fe=Math.cos(S-T)*N,T&&(C*=zy,Se=Math.tan(T-C),Se=Math.sqrt(1+Se*Se),ne*=Se,fe*=Se,C&&(Se=Math.tan(C),Se=Math.sqrt(1+Se*Se),ce*=Se,le*=Se)),ce=ms(ce),le=ms(le),ne=ms(ne),fe=ms(fe)):(ce=I,fe=N,le=ne=0),($&&!~(f+"").indexOf("px")||ae&&!~(E+"").indexOf("px"))&&($=mf(P,"x",f,"px"),ae=mf(P,"y",E,"px")),(W||x||B||X)&&($=ms($+W-(W*ce+x*ne)+B),ae=ms(ae+x-(W*le+x*fe)+X)),(l||d)&&(Se=P.getBBox(),$=ms($+l/100*Se.width),ae=ms(ae+d/100*Se.height)),Se="matrix("+ce+","+le+","+ne+","+fe+","+$+","+ae+")",P.setAttribute("transform",Se),Z&&(P.style[Ji]=Se)},L1e=function(n,s,a,l,d){var f=360,E=Js(d),S=parseFloat(d)*(E&&~d.indexOf("rad")?_g:1),T=S-l,C=l+T+"deg",I,N;return E&&(I=d.split("_")[1],I==="short"&&(T%=f,T!==T%(f/2)&&(T+=T<0?f:-f)),I==="cw"&&T<0?T=(T+f*TY)%f-~~(T/f)*f:I==="ccw"&&T>0&&(T=(T-f*TY)%f-~~(T/f)*f)),n._pt=N=new xa(n._pt,s,a,l,T,_1e),N.e=C,N.u="deg",n._props.push(a),N},OY=function(n,s){for(var a in s)n[a]=s[a];return n},M1e=function(n,s,a){var l=OY({},a._gsap),d="perspective,force3D,transformOrigin,svgOrigin",f=a.style,E,S,T,C,I,N,P,W;l.svg?(T=a.getAttribute("transform"),a.setAttribute("transform",""),f[Ji]=s,E=Nw(a,1),ff(a,Ji),a.setAttribute("transform",T)):(T=getComputedStyle(a)[Ji],f[Ji]=s,E=Nw(a,1),f[Ji]=T);for(S in Ih)T=l[S],C=E[S],T!==C&&d.indexOf(S)<0&&(P=Do(T),W=Do(C),I=P!==W?mf(a,S,T,W):parseFloat(T),N=parseFloat(C),n._pt=new xa(n._pt,E,S,I,N-I,JM),n._pt.u=W||0,n._props.push(S));OY(E,l)};Da("padding,margin,Width,Radius",function(i,n){var s="Top",a="Right",l="Bottom",d="Left",f=(n<3?[s,a,l,d]:[s+d,s+a,l+a,l+d]).map(function(E){return n<2?i+E:"border"+E+i});gO[n>1?"border"+i:i]=function(E,S,T,C,I){var N,P;if(arguments.length<4)return N=f.map(function(W){return hh(E,W,T)}),P=N.join(" "),P.split(N[0]).length===5?N[0]:P;N=(C+"").split(" "),P={},f.forEach(function(W,x){return P[W]=N[x]=N[x]||N[(x-1)/2|0]}),E.init(S,P,I)}});var $ee={name:"css",register:QM,targetTest:function(n){return n.style&&n.nodeType},init:function(n,s,a,l,d){var f=this._props,E=n.style,S=a.vars.startAt,T,C,I,N,P,W,x,B,X,Z,$,ae,ce,le,ne,fe,Se;sV||QM(),this.styles=this.styles||Hee(n),fe=this.styles.props,this.tween=a;for(x in s)if(x!=="autoRound"&&(C=s[x],!(lc[x]&&Dee(x,s,a,l,n,d)))){if(P=typeof C,W=gO[x],P==="function"&&(C=C.call(a,l,n,d),P=typeof C),P==="string"&&~C.indexOf("random(")&&(C=bw(C)),W)W(this,n,x,C,a)&&(ne=1);else if(x.substr(0,2)==="--")T=(getComputedStyle(n).getPropertyValue(x)+"").trim(),C+="",of.lastIndex=0,of.test(T)||(B=Do(T),X=Do(C),X?B!==X&&(T=mf(n,x,T,X)+X):B&&(C+=B)),this.add(E,"setProperty",T,C,l,d,0,0,x),f.push(x),fe.push(x,0,E[x]);else if(P!=="undefined"){if(S&&x in S?(T=typeof S[x]=="function"?S[x].call(a,l,n,d):S[x],Js(T)&&~T.indexOf("random(")&&(T=bw(T)),Do(T+"")||T==="auto"||(T+=_c.units[x]||Do(hh(n,x))||""),(T+"").charAt(1)==="="&&(T=hh(n,x))):T=hh(n,x),N=parseFloat(T),Z=P==="string"&&C.charAt(1)==="="&&C.substr(0,2),Z&&(C=C.substr(2)),I=parseFloat(C),x in Ed&&(x==="autoAlpha"&&(N===1&&hh(n,"visibility")==="hidden"&&I&&(N=0),fe.push("visibility",0,E.visibility),ef(this,E,"visibility",N?"inherit":"hidden",I?"inherit":"hidden",!I)),x!=="scale"&&x!=="transform"&&(x=Ed[x],~x.indexOf(",")&&(x=x.split(",")[0]))),$=x in Ih,$){if(this.styles.save(x),Se=C,P==="string"&&C.substring(0,6)==="var(--"){if(C=pc(n,C.substring(4,C.indexOf(")"))),C.substring(0,5)==="calc("){var De=n.style.perspective;n.style.perspective=C,C=pc(n,"perspective"),De?n.style.perspective=De:ff(n,"perspective")}I=parseFloat(C)}if(ae||(ce=n._gsap,ce.renderTransform&&!s.parseTransform||Nw(n,s.parseTransform),le=s.smoothOrigin!==!1&&ce.smooth,ae=this._pt=new xa(this._pt,E,Ji,0,1,ce.renderTransform,ce,0,-1),ae.dep=1),x==="scale")this._pt=new xa(this._pt,ce,"scaleY",ce.scaleY,(Z?Gy(ce.scaleY,Z+I):I)-ce.scaleY||0,JM),this._pt.u=0,f.push("scaleY",x),x+="X";else if(x==="transformOrigin"){fe.push(La,0,E[La]),C=P1e(C),ce.svg?ZM(n,C,0,le,0,this):(X=parseFloat(C.split(" ")[2])||0,X!==ce.zOrigin&&ef(this,ce,"zOrigin",ce.zOrigin,X),ef(this,E,x,_O(T),_O(C)));continue}else if(x==="svgOrigin"){ZM(n,C,1,le,0,this);continue}else if(x in qee){L1e(this,ce,x,N,Z?Gy(N,Z+C):C);continue}else if(x==="smoothOrigin"){ef(this,ce,"smooth",ce.smooth,C);continue}else if(x==="force3D"){ce[x]=C;continue}else if(x==="transform"){M1e(this,C,n);continue}}else x in E||(x=iv(x)||x);if($||(I||I===0)&&(N||N===0)&&!g1e.test(C)&&x in E)B=(T+"").substr((N+"").length),I||(I=0),X=Do(C)||(x in _c.units?_c.units[x]:B),B!==X&&(N=mf(n,x,T,X)),this._pt=new xa(this._pt,$?ce:E,x,N,(Z?Gy(N,Z+I):I)-N,!$&&(X==="px"||x==="zIndex")&&s.autoRound!==!1?v1e:JM),this._pt.u=X||0,$&&Se!==C?(this._pt.b=T,this._pt.e=Se,this._pt.r=y1e):B!==X&&X!=="%"&&(this._pt.b=T,this._pt.r=E1e);else if(x in E)N1e.call(this,n,x,T,Z?Z+C:C);else if(x in n)this.add(n,x,T||n[x],Z?Z+C:C,l,d);else if(x!=="parseTransform"){XU(x,C);continue}$||(x in E?fe.push(x,0,E[x]):typeof n[x]=="function"?fe.push(x,2,n[x]()):fe.push(x,1,T||n[x])),f.push(x)}}ne&&Fee(this)},render:function(n,s){if(s.tween._time||!oV())for(var a=s._pt;a;)a.r(n,a.d),a=a._next;else s.styles.revert()},get:hh,aliases:Ed,getSetter:function(n,s,a){var l=Ed[s];return l&&l.indexOf(",")<0&&(s=l),s in Ih&&s!==La&&(n._gsap.x||hh(n,"x"))?a&&SY===a?s==="scale"?C1e:w1e:(SY=a||{})&&(s==="scale"?R1e:b1e):n.style&&!KU(n.style[s])?S1e:~s.indexOf("-")?T1e:rV(n,s)},core:{_removeProperty:ff,_getMatrix:cV}};Ua.utils.checkPrefix=iv;Ua.core.getStyleSaver=Hee;(function(i,n,s,a){var l=Da(i+","+n+","+s,function(d){Ih[d]=1});Da(n,function(d){_c.units[d]="deg",qee[d]=1}),Ed[l[13]]=i+","+n,Da(a,function(d){var f=d.split(":");Ed[f[1]]=l[f[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");Da("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(i){_c.units[i]="px"});Ua.registerPlugin($ee);var DA=Ua.registerPlugin($ee)||Ua;DA.core.Tween;const U1e=(i,n={baseSize:48,maxScale:1.5,maxDistance:120})=>{const s=H.useRef(null),a=H.useRef(new Map),l=H.useCallback((S,T)=>{T?a.current.set(S,T):a.current.delete(S)},[]),d=H.useCallback(S=>{const{maxScale:T,maxDistance:C}=n;if(S>=C)return 1;const I=S/C,N=Math.cos(I*Math.PI/2),P=1+(T-1)*N;return Math.max(1,Math.min(T,P))},[n]),f=H.useCallback(S=>{const T=s.current;if(!T)return;const C=T.getBoundingClientRect(),I=S.clientX,N=S.clientY,P=window.innerHeight-N,W=C.height+50;if(P>W+n.maxDistance){a.current.forEach(x=>{DA.to(x,{scale:1,y:0,duration:.4,ease:"power3.out"})});return}a.current.forEach((x,B)=>{const X=x.getBoundingClientRect(),Z=X.left+X.width/2,$=Math.abs(I-Z),ae=d($),ce=n.baseSize,le=-((ae-1)*ce*.5);DA.to(x,{scale:ae,y:le,duration:.2,ease:"power2.out",overwrite:"auto"})})},[d,n]),E=H.useCallback(()=>{a.current.forEach((S,T)=>{DA.to(S,{scale:1,y:0,duration:.5,ease:"elastic.out(1, 0.4)",delay:T*.015})})},[]);return H.useEffect(()=>{const S=s.current;if(S)return S.addEventListener("mousemove",f),S.addEventListener("mouseleave",E),()=>{S.removeEventListener("mousemove",f),S.removeEventListener("mouseleave",E)}},[f,E]),{dockRef:s,setItemRef:l}},V1e=({icon:i,label:n,to:s,gradient:a,onSetRef:l})=>{const[d,f]=H.useState(!1),S=Sf().pathname===s,T=H.useCallback(C=>{l(C)},[l]);return D.jsxs("div",{ref:T,className:"dock-item relative origin-bottom",onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),style:{willChange:"transform"},children:[D.jsx(LU,{children:d&&D.jsx(Bn.div,{initial:{opacity:0,y:8,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:4,scale:.95},transition:{duration:.12,ease:"easeOut"},className:"absolute -top-10 left-1/2 -translate-x-1/2 z-50 pointer-events-none",children:D.jsx("div",{className:"glass px-3 py-1.5 rounded-lg whitespace-nowrap shadow-lg",children:D.jsx("span",{className:"text-xs font-medium text-foreground",children:n})})})}),D.jsxs(mw,{to:s,className:`
          relative flex items-center justify-center w-12 h-12 rounded-xl
          transition-colors duration-200 group
          ${S?"active":""}
        `,"aria-label":n,children:[D.jsx("div",{className:`
            absolute inset-0 rounded-xl opacity-0 transition-opacity duration-300
            ${S?"opacity-100":"group-hover:opacity-70"}
          `,style:{background:a||"linear-gradient(135deg, hsl(199 89% 48% / 0.25), hsl(263 70% 58% / 0.25))"}}),D.jsx(i,{className:`
            w-6 h-6 relative z-10 transition-colors duration-200
            ${S?"text-primary":"text-muted-foreground group-hover:text-foreground"}
          `}),S&&D.jsx(Bn.div,{layoutId:"activeIndicator",className:"absolute -bottom-1.5 w-1 h-1 rounded-full bg-primary",transition:{type:"spring",stiffness:500,damping:30}})]})]})},NY=[{icon:jX,label:"Dashboard",to:"/",gradient:"linear-gradient(135deg, hsl(199 89% 48% / 0.3), hsl(199 89% 48% / 0.1))"},{icon:Dy,label:"AI Tutor",to:"/ai-tutor",gradient:"linear-gradient(135deg, hsl(263 70% 58% / 0.3), hsl(263 70% 58% / 0.1))"},{icon:jA,label:"Notes & PYQs",to:"/notes",gradient:"linear-gradient(135deg, hsl(142 76% 36% / 0.3), hsl(142 76% 36% / 0.1))"},{icon:O2,label:"Study Planner",to:"/planner",gradient:"linear-gradient(135deg, hsl(45 93% 47% / 0.3), hsl(45 93% 47% / 0.1))"},{icon:PO,label:"Study Rooms",to:"/study-rooms",gradient:"linear-gradient(135deg, hsl(330 80% 55% / 0.3), hsl(330 80% 55% / 0.1))"},{icon:ZL,label:"Campus Map",to:"/campus-map",gradient:"linear-gradient(135deg, hsl(15 90% 55% / 0.3), hsl(15 90% 55% / 0.1))"},{icon:yA,label:"Events",to:"/events",gradient:"linear-gradient(135deg, hsl(280 70% 50% / 0.3), hsl(280 70% 50% / 0.1))"},{icon:BX,label:"Doubts",to:"/doubts",gradient:"linear-gradient(135deg, hsl(180 70% 45% / 0.3), hsl(180 70% 45% / 0.1))"},{icon:jw,label:"Senior Connect",to:"/senior-connect",gradient:"linear-gradient(135deg, hsl(220 70% 55% / 0.3), hsl(220 70% 55% / 0.1))"},{icon:$L,label:"Student Help",to:"/student-help",gradient:"linear-gradient(135deg, hsl(350 80% 50% / 0.3), hsl(350 80% 50% / 0.1))"},{icon:FX,label:"Support",to:"/support",gradient:"linear-gradient(135deg, hsl(35 90% 55% / 0.3), hsl(35 90% 55% / 0.1))"},{icon:YX,label:"Settings",to:"/settings",gradient:"linear-gradient(135deg, hsl(217 20% 50% / 0.3), hsl(217 20% 50% / 0.1))"}],F1e=()=>{const{dockRef:i,setItemRef:n}=U1e(NY.length,{baseSize:48,maxScale:1.6,maxDistance:100}),s=H.useCallback(a=>l=>n(a,l),[n]);return D.jsxs("div",{className:"fixed bottom-4 left-1/2 -translate-x-1/2 z-50",children:[D.jsx("div",{ref:i,className:"glass-dock rounded-2xl px-3 py-2.5 flex items-end gap-1",children:NY.map((a,l)=>D.jsx(V1e,{icon:a.icon,label:a.label,to:a.to,gradient:a.gradient,onSetRef:s(l)},a.to))}),D.jsx("div",{className:"absolute -bottom-4 left-1/2 -translate-x-1/2 w-3/4 h-8 opacity-20 blur-xl pointer-events-none",style:{background:"linear-gradient(to bottom, hsl(199 89% 48% / 0.3), transparent)"}})]})},Tc=({children:i})=>D.jsxs("div",{className:"min-h-screen bg-background relative overflow-hidden",children:[D.jsxs("div",{className:"fixed inset-0 pointer-events-none overflow-hidden",children:[D.jsx("div",{className:"absolute -top-1/2 -left-1/2 w-full h-full opacity-30",style:{background:"radial-gradient(circle, hsl(199 89% 48% / 0.15) 0%, transparent 50%)"}}),D.jsx("div",{className:"absolute -bottom-1/2 -right-1/2 w-full h-full opacity-20",style:{background:"radial-gradient(circle, hsl(263 70% 58% / 0.15) 0%, transparent 50%)"}})]}),D.jsx(Bn.main,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3,ease:"easeOut"},className:"page-container relative z-10",children:i}),D.jsx(F1e,{})]}),j1e=({icon:i,title:n,description:s,gradient:a,delay:l=0,children:d})=>D.jsxs(Bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:l,ease:"easeOut"},className:"module-card group",children:[D.jsx("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center mb-4 transition-transform duration-300 group-hover:scale-110",style:{background:a},children:D.jsx(i,{className:"w-7 h-7 text-foreground"})}),D.jsx("h3",{className:"text-xl font-semibold text-foreground mb-2 font-display",children:n}),D.jsx("p",{className:"text-muted-foreground text-sm leading-relaxed mb-4",children:s}),d]}),B1e=A2("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Jn=H.forwardRef(({className:i,variant:n,size:s,asChild:a=!1,...l},d)=>{const f=a?Xme:"button";return D.jsx(f,{className:Br(B1e({variant:n,size:s,className:i})),ref:d,...l})});Jn.displayName="Button";const W1e=()=>{const{user:i,loading:n,signOut:s}=qO(),[a,l]=H.useState([{label:"AI Chats",value:"0",icon:Dy,change:"Start Now"},{label:"Study Hours",value:"0",icon:lw,change:"Track"},{label:"Tasks",value:"0",icon:bK,change:"Plan"}]);H.useEffect(()=>{const f=localStorage.getItem("aitutor-conversations"),E=f?JSON.parse(f).length:0;l([{label:"AI Sessions",value:E.toString(),icon:Dy,change:E>0?"Active":"Start now"},{label:"Study Hours",value:"12.5",icon:lw,change:"+2.5h"},{label:"Pending Tasks",value:"3",icon:bK,change:"-1"}])},[]);const d=[{icon:Dy,title:"AI Tutor",description:"Get instant help with your assignments and concepts",gradient:"linear-gradient(135deg, hsl(263 70% 58% / 0.3), hsl(263 70% 58% / 0.1))",path:"/ai-tutor"},{icon:jA,title:"Notes & PYQs",description:"Access curated study materials and past papers",gradient:"linear-gradient(135deg, hsl(142 76% 36% / 0.3), hsl(142 76% 36% / 0.1))",path:"/notes"},{icon:O2,title:"Study Planner",description:"Plan your study sessions and track progress",gradient:"linear-gradient(135deg, hsl(45 93% 47% / 0.3), hsl(45 93% 47% / 0.1))",path:"/planner"},{icon:PO,title:"Study Rooms",description:"Join virtual study sessions with classmates",gradient:"linear-gradient(135deg, hsl(330 80% 55% / 0.3), hsl(330 80% 55% / 0.1))",path:"/study-rooms"}];return D.jsxs(Tc,{children:[D.jsx(Bn.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"mb-8",children:D.jsxs("div",{className:"flex items-center justify-between mb-4",children:[D.jsxs("div",{className:"flex items-center gap-4",children:[D.jsx("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center",style:{background:"linear-gradient(135deg, hsl(199 89% 48% / 0.3), hsl(263 70% 58% / 0.3))"},children:D.jsx(jX,{className:"w-7 h-7 text-primary"})}),D.jsxs("div",{children:[D.jsxs("h1",{className:"text-4xl font-bold font-display",children:[D.jsx("span",{className:"text-gradient",children:"KLE"}),D.jsx("span",{className:"text-foreground",children:" CONNECT"})]}),D.jsx("p",{className:"text-muted-foreground",children:i?`Welcome back, ${i.user_metadata?.full_name||i.email}!`:"Your college companion, powered by AI"})]})]}),D.jsx("div",{className:"flex items-center gap-3",children:n?D.jsx(Jn,{variant:"ghost",disabled:!0,size:"sm",children:"Loading..."}):i?D.jsxs("div",{className:"flex items-center gap-3",children:[D.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[D.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center",children:D.jsx(kO,{className:"w-4 h-4 text-primary"})}),D.jsx("span",{className:"text-muted-foreground hidden md:inline",children:i.displayName||i.email||"Student"})]}),D.jsx(Jn,{variant:"outline",size:"sm",onClick:async()=>{await s(),window.location.href="/#/auth"},children:"Sign Out"})]}):D.jsx(mw,{to:"/auth",children:D.jsxs(Jn,{className:"gap-2 bg-primary hover:bg-primary/90",children:[D.jsx(s_e,{className:"w-4 h-4"}),"Sign In"]})})})]})}),D.jsx(Bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:a.map((f,E)=>D.jsxs("div",{className:"glass rounded-2xl p-5 flex items-center gap-4 hover:bg-white/5 transition-colors",children:[D.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center",style:{background:"linear-gradient(135deg, hsl(199 89% 48% / 0.2), hsl(199 89% 48% / 0.05))"},children:D.jsx(f.icon,{className:"w-6 h-6 text-primary"})}),D.jsxs("div",{children:[D.jsx("p",{className:"text-2xl font-bold text-foreground font-display",children:f.value}),D.jsx("p",{className:"text-sm text-muted-foreground",children:f.label})]}),D.jsx("span",{className:"ml-auto text-xs text-primary font-medium px-2 py-1 rounded-full bg-primary/10",children:f.change})]},f.label))}),D.jsx(Bn.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.2},className:"mb-4",children:D.jsx("h2",{className:"text-xl font-semibold text-foreground mb-4 font-display",children:"Quick Actions"})}),D.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:d.map((f,E)=>D.jsx(mw,{to:f.path,children:D.jsx(j1e,{icon:f.icon,title:f.title,description:f.description,gradient:f.gradient,delay:.3+E*.1})},f.title))}),D.jsxs(Bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.6},className:"mt-8",children:[D.jsx("h2",{className:"text-xl font-semibold text-foreground mb-4 font-display",children:"Recent Activity"}),D.jsx("div",{className:"glass rounded-2xl p-6",children:D.jsx("div",{className:"space-y-4",children:[{action:"Completed",item:"Data Structures Quiz",time:"2 hours ago"},{action:"Joined",item:"Study Room: Algorithm Design",time:"5 hours ago"},{action:"Downloaded",item:"Operating Systems Notes",time:"Yesterday"}].map((f,E)=>D.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-border last:border-0",children:[D.jsxs("div",{children:[D.jsx("span",{className:"text-primary text-sm font-medium",children:f.action}),D.jsx("span",{className:"text-foreground text-sm ml-2",children:f.item})]}),D.jsx("span",{className:"text-muted-foreground text-xs",children:f.time})]},E))})})]})]})},Ty=H.forwardRef(({className:i,type:n,...s},a)=>D.jsx("input",{type:n,className:Br("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",i),ref:a,...s}));Ty.displayName="Input";var G1e=H.createContext(void 0);function Qee(i){const n=H.useContext(G1e);return i||n||"ltr"}var RL="rovingFocusGroup.onEntryFocus",H1e={bubbles:!1,cancelable:!0},Qw="RovingFocusGroup",[e2,Zee,z1e]=dX(Qw),[K1e,ete]=Ef(Qw,[z1e]),[Y1e,q1e]=K1e(Qw),tte=H.forwardRef((i,n)=>D.jsx(e2.Provider,{scope:i.__scopeRovingFocusGroup,children:D.jsx(e2.Slot,{scope:i.__scopeRovingFocusGroup,children:D.jsx(X1e,{...i,ref:n})})}));tte.displayName=Qw;var X1e=H.forwardRef((i,n)=>{const{__scopeRovingFocusGroup:s,orientation:a,loop:l=!1,dir:d,currentTabStopId:f,defaultCurrentTabStopId:E,onCurrentTabStopIdChange:S,onEntryFocus:T,preventScrollOnEntryFocus:C=!1,...I}=i,N=H.useRef(null),P=Xs(n,N),W=Qee(d),[x,B]=Vw({prop:f,defaultProp:E??null,onChange:S,caller:Qw}),[X,Z]=H.useState(!1),$=uu(T),ae=Zee(s),ce=H.useRef(!1),[le,ne]=H.useState(0);return H.useEffect(()=>{const fe=N.current;if(fe)return fe.addEventListener(RL,$),()=>fe.removeEventListener(RL,$)},[$]),D.jsx(Y1e,{scope:s,orientation:a,dir:W,loop:l,currentTabStopId:x,onItemFocus:H.useCallback(fe=>B(fe),[B]),onItemShiftTab:H.useCallback(()=>Z(!0),[]),onFocusableItemAdd:H.useCallback(()=>ne(fe=>fe+1),[]),onFocusableItemRemove:H.useCallback(()=>ne(fe=>fe-1),[]),children:D.jsx(ri.div,{tabIndex:X||le===0?-1:0,"data-orientation":a,...I,ref:P,style:{outline:"none",...i.style},onMouseDown:vr(i.onMouseDown,()=>{ce.current=!0}),onFocus:vr(i.onFocus,fe=>{const Se=!ce.current;if(fe.target===fe.currentTarget&&Se&&!X){const De=new CustomEvent(RL,H1e);if(fe.currentTarget.dispatchEvent(De),!De.defaultPrevented){const be=ae().filter(Je=>Je.focusable),ye=be.find(Je=>Je.active),Ge=be.find(Je=>Je.id===x),Fe=[ye,Ge,...be].filter(Boolean).map(Je=>Je.ref.current);ite(Fe,C)}}ce.current=!1}),onBlur:vr(i.onBlur,()=>Z(!1))})})}),nte="RovingFocusGroupItem",rte=H.forwardRef((i,n)=>{const{__scopeRovingFocusGroup:s,focusable:a=!0,active:l=!1,tabStopId:d,children:f,...E}=i,S=H0(),T=d||S,C=q1e(nte,s),I=C.currentTabStopId===T,N=Zee(s),{onFocusableItemAdd:P,onFocusableItemRemove:W,currentTabStopId:x}=C;return H.useEffect(()=>{if(a)return P(),()=>W()},[a,P,W]),D.jsx(e2.ItemSlot,{scope:s,id:T,focusable:a,active:l,children:D.jsx(ri.span,{tabIndex:I?0:-1,"data-orientation":C.orientation,...E,ref:n,onMouseDown:vr(i.onMouseDown,B=>{a?C.onItemFocus(T):B.preventDefault()}),onFocus:vr(i.onFocus,()=>C.onItemFocus(T)),onKeyDown:vr(i.onKeyDown,B=>{if(B.key==="Tab"&&B.shiftKey){C.onItemShiftTab();return}if(B.target!==B.currentTarget)return;const X=Q1e(B,C.orientation,C.dir);if(X!==void 0){if(B.metaKey||B.ctrlKey||B.altKey||B.shiftKey)return;B.preventDefault();let $=N().filter(ae=>ae.focusable).map(ae=>ae.ref.current);if(X==="last")$.reverse();else if(X==="prev"||X==="next"){X==="prev"&&$.reverse();const ae=$.indexOf(B.currentTarget);$=C.loop?Z1e($,ae+1):$.slice(ae+1)}setTimeout(()=>ite($))}}),children:typeof f=="function"?f({isCurrentTabStop:I,hasTabStop:x!=null}):f})})});rte.displayName=nte;var J1e={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function $1e(i,n){return n!=="rtl"?i:i==="ArrowLeft"?"ArrowRight":i==="ArrowRight"?"ArrowLeft":i}function Q1e(i,n,s){const a=$1e(i.key,s);if(!(n==="vertical"&&["ArrowLeft","ArrowRight"].includes(a))&&!(n==="horizontal"&&["ArrowUp","ArrowDown"].includes(a)))return J1e[a]}function ite(i,n=!1){const s=document.activeElement;for(const a of i)if(a===s||(a.focus({preventScroll:n}),document.activeElement!==s))return}function Z1e(i,n){return i.map((s,a)=>i[(n+a)%i.length])}var eke=tte,tke=rte,nN="Tabs",[nke]=Ef(nN,[ete]),ste=ete(),[rke,lV]=nke(nN),ote=H.forwardRef((i,n)=>{const{__scopeTabs:s,value:a,onValueChange:l,defaultValue:d,orientation:f="horizontal",dir:E,activationMode:S="automatic",...T}=i,C=Qee(E),[I,N]=Vw({prop:a,onChange:l,defaultProp:d??"",caller:nN});return D.jsx(rke,{scope:s,baseId:H0(),value:I,onValueChange:N,orientation:f,dir:C,activationMode:S,children:D.jsx(ri.div,{dir:C,"data-orientation":f,...T,ref:n})})});ote.displayName=nN;var ate="TabsList",cte=H.forwardRef((i,n)=>{const{__scopeTabs:s,loop:a=!0,...l}=i,d=lV(ate,s),f=ste(s);return D.jsx(eke,{asChild:!0,...f,orientation:d.orientation,dir:d.dir,loop:a,children:D.jsx(ri.div,{role:"tablist","aria-orientation":d.orientation,...l,ref:n})})});cte.displayName=ate;var lte="TabsTrigger",ute=H.forwardRef((i,n)=>{const{__scopeTabs:s,value:a,disabled:l=!1,...d}=i,f=lV(lte,s),E=ste(s),S=pte(f.baseId,a),T=fte(f.baseId,a),C=a===f.value;return D.jsx(tke,{asChild:!0,...E,focusable:!l,active:C,children:D.jsx(ri.button,{type:"button",role:"tab","aria-selected":C,"aria-controls":T,"data-state":C?"active":"inactive","data-disabled":l?"":void 0,disabled:l,id:S,...d,ref:n,onMouseDown:vr(i.onMouseDown,I=>{!l&&I.button===0&&I.ctrlKey===!1?f.onValueChange(a):I.preventDefault()}),onKeyDown:vr(i.onKeyDown,I=>{[" ","Enter"].includes(I.key)&&f.onValueChange(a)}),onFocus:vr(i.onFocus,()=>{const I=f.activationMode!=="manual";!C&&!l&&I&&f.onValueChange(a)})})})});ute.displayName=lte;var dte="TabsContent",hte=H.forwardRef((i,n)=>{const{__scopeTabs:s,value:a,forceMount:l,children:d,...f}=i,E=lV(dte,s),S=pte(E.baseId,a),T=fte(E.baseId,a),C=a===E.value,I=H.useRef(C);return H.useEffect(()=>{const N=requestAnimationFrame(()=>I.current=!1);return()=>cancelAnimationFrame(N)},[]),D.jsx(Gg,{present:l||C,children:({present:N})=>D.jsx(ri.div,{"data-state":C?"active":"inactive","data-orientation":E.orientation,role:"tabpanel","aria-labelledby":S,hidden:!N,id:T,tabIndex:0,...f,ref:n,style:{...i.style,animationDuration:I.current?"0s":void 0},children:N&&d})})});hte.displayName=dte;function pte(i,n){return`${i}-trigger-${n}`}function fte(i,n){return`${i}-content-${n}`}var ike=ote,mte=cte,gte=ute,_te=hte;const ske=ike,Ete=H.forwardRef(({className:i,...n},s)=>D.jsx(mte,{ref:s,className:Br("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",i),...n}));Ete.displayName=mte.displayName;const t2=H.forwardRef(({className:i,...n},s)=>D.jsx(gte,{ref:s,className:Br("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",i),...n}));t2.displayName=gte.displayName;const n2=H.forwardRef(({className:i,...n},s)=>D.jsx(_te,{ref:s,className:Br("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",i),...n}));n2.displayName=_te.displayName;var Pr;(function(i){i.assertEqual=l=>{};function n(l){}i.assertIs=n;function s(l){throw new Error}i.assertNever=s,i.arrayToEnum=l=>{const d={};for(const f of l)d[f]=f;return d},i.getValidEnumValues=l=>{const d=i.objectKeys(l).filter(E=>typeof l[l[E]]!="number"),f={};for(const E of d)f[E]=l[E];return i.objectValues(f)},i.objectValues=l=>i.objectKeys(l).map(function(d){return l[d]}),i.objectKeys=typeof Object.keys=="function"?l=>Object.keys(l):l=>{const d=[];for(const f in l)Object.prototype.hasOwnProperty.call(l,f)&&d.push(f);return d},i.find=(l,d)=>{for(const f of l)if(d(f))return f},i.isInteger=typeof Number.isInteger=="function"?l=>Number.isInteger(l):l=>typeof l=="number"&&Number.isFinite(l)&&Math.floor(l)===l;function a(l,d=" | "){return l.map(f=>typeof f=="string"?`'${f}'`:f).join(d)}i.joinValues=a,i.jsonStringifyReplacer=(l,d)=>typeof d=="bigint"?d.toString():d})(Pr||(Pr={}));var PY;(function(i){i.mergeShapes=(n,s)=>({...n,...s})})(PY||(PY={}));const Jt=Pr.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Kp=i=>{switch(typeof i){case"undefined":return Jt.undefined;case"string":return Jt.string;case"number":return Number.isNaN(i)?Jt.nan:Jt.number;case"boolean":return Jt.boolean;case"function":return Jt.function;case"bigint":return Jt.bigint;case"symbol":return Jt.symbol;case"object":return Array.isArray(i)?Jt.array:i===null?Jt.null:i.then&&typeof i.then=="function"&&i.catch&&typeof i.catch=="function"?Jt.promise:typeof Map<"u"&&i instanceof Map?Jt.map:typeof Set<"u"&&i instanceof Set?Jt.set:typeof Date<"u"&&i instanceof Date?Jt.date:Jt.object;default:return Jt.unknown}},Et=Pr.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Id extends Error{get errors(){return this.issues}constructor(n){super(),this.issues=[],this.addIssue=a=>{this.issues=[...this.issues,a]},this.addIssues=(a=[])=>{this.issues=[...this.issues,...a]};const s=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,s):this.__proto__=s,this.name="ZodError",this.issues=n}format(n){const s=n||function(d){return d.message},a={_errors:[]},l=d=>{for(const f of d.issues)if(f.code==="invalid_union")f.unionErrors.map(l);else if(f.code==="invalid_return_type")l(f.returnTypeError);else if(f.code==="invalid_arguments")l(f.argumentsError);else if(f.path.length===0)a._errors.push(s(f));else{let E=a,S=0;for(;S<f.path.length;){const T=f.path[S];S===f.path.length-1?(E[T]=E[T]||{_errors:[]},E[T]._errors.push(s(f))):E[T]=E[T]||{_errors:[]},E=E[T],S++}}};return l(this),a}static assert(n){if(!(n instanceof Id))throw new Error(`Not a ZodError: ${n}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Pr.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(n=s=>s.message){const s={},a=[];for(const l of this.issues)if(l.path.length>0){const d=l.path[0];s[d]=s[d]||[],s[d].push(n(l))}else a.push(n(l));return{formErrors:a,fieldErrors:s}}get formErrors(){return this.flatten()}}Id.create=i=>new Id(i);const r2=(i,n)=>{let s;switch(i.code){case Et.invalid_type:i.received===Jt.undefined?s="Required":s=`Expected ${i.expected}, received ${i.received}`;break;case Et.invalid_literal:s=`Invalid literal value, expected ${JSON.stringify(i.expected,Pr.jsonStringifyReplacer)}`;break;case Et.unrecognized_keys:s=`Unrecognized key(s) in object: ${Pr.joinValues(i.keys,", ")}`;break;case Et.invalid_union:s="Invalid input";break;case Et.invalid_union_discriminator:s=`Invalid discriminator value. Expected ${Pr.joinValues(i.options)}`;break;case Et.invalid_enum_value:s=`Invalid enum value. Expected ${Pr.joinValues(i.options)}, received '${i.received}'`;break;case Et.invalid_arguments:s="Invalid function arguments";break;case Et.invalid_return_type:s="Invalid function return type";break;case Et.invalid_date:s="Invalid date";break;case Et.invalid_string:typeof i.validation=="object"?"includes"in i.validation?(s=`Invalid input: must include "${i.validation.includes}"`,typeof i.validation.position=="number"&&(s=`${s} at one or more positions greater than or equal to ${i.validation.position}`)):"startsWith"in i.validation?s=`Invalid input: must start with "${i.validation.startsWith}"`:"endsWith"in i.validation?s=`Invalid input: must end with "${i.validation.endsWith}"`:Pr.assertNever(i.validation):i.validation!=="regex"?s=`Invalid ${i.validation}`:s="Invalid";break;case Et.too_small:i.type==="array"?s=`Array must contain ${i.exact?"exactly":i.inclusive?"at least":"more than"} ${i.minimum} element(s)`:i.type==="string"?s=`String must contain ${i.exact?"exactly":i.inclusive?"at least":"over"} ${i.minimum} character(s)`:i.type==="number"?s=`Number must be ${i.exact?"exactly equal to ":i.inclusive?"greater than or equal to ":"greater than "}${i.minimum}`:i.type==="bigint"?s=`Number must be ${i.exact?"exactly equal to ":i.inclusive?"greater than or equal to ":"greater than "}${i.minimum}`:i.type==="date"?s=`Date must be ${i.exact?"exactly equal to ":i.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(i.minimum))}`:s="Invalid input";break;case Et.too_big:i.type==="array"?s=`Array must contain ${i.exact?"exactly":i.inclusive?"at most":"less than"} ${i.maximum} element(s)`:i.type==="string"?s=`String must contain ${i.exact?"exactly":i.inclusive?"at most":"under"} ${i.maximum} character(s)`:i.type==="number"?s=`Number must be ${i.exact?"exactly":i.inclusive?"less than or equal to":"less than"} ${i.maximum}`:i.type==="bigint"?s=`BigInt must be ${i.exact?"exactly":i.inclusive?"less than or equal to":"less than"} ${i.maximum}`:i.type==="date"?s=`Date must be ${i.exact?"exactly":i.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(i.maximum))}`:s="Invalid input";break;case Et.custom:s="Invalid input";break;case Et.invalid_intersection_types:s="Intersection results could not be merged";break;case Et.not_multiple_of:s=`Number must be a multiple of ${i.multipleOf}`;break;case Et.not_finite:s="Number must be finite";break;default:s=n.defaultError,Pr.assertNever(i)}return{message:s}};let oke=r2;function ake(){return oke}const cke=i=>{const{data:n,path:s,errorMaps:a,issueData:l}=i,d=[...s,...l.path||[]],f={...l,path:d};if(l.message!==void 0)return{...l,path:d,message:l.message};let E="";const S=a.filter(T=>!!T).slice().reverse();for(const T of S)E=T(f,{data:n,defaultError:E}).message;return{...l,path:d,message:E}};function kt(i,n){const s=ake(),a=cke({issueData:n,data:i.data,path:i.path,errorMaps:[i.common.contextualErrorMap,i.schemaErrorMap,s,s===r2?void 0:r2].filter(l=>!!l)});i.common.issues.push(a)}class vc{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(n,s){const a=[];for(const l of s){if(l.status==="aborted")return Dn;l.status==="dirty"&&n.dirty(),a.push(l.value)}return{status:n.value,value:a}}static async mergeObjectAsync(n,s){const a=[];for(const l of s){const d=await l.key,f=await l.value;a.push({key:d,value:f})}return vc.mergeObjectSync(n,a)}static mergeObjectSync(n,s){const a={};for(const l of s){const{key:d,value:f}=l;if(d.status==="aborted"||f.status==="aborted")return Dn;d.status==="dirty"&&n.dirty(),f.status==="dirty"&&n.dirty(),d.value!=="__proto__"&&(typeof f.value<"u"||l.alwaysSet)&&(a[d.value]=f.value)}return{status:n.value,value:a}}}const Dn=Object.freeze({status:"aborted"}),B0=i=>({status:"dirty",value:i}),hl=i=>({status:"valid",value:i}),kY=i=>i.status==="aborted",DY=i=>i.status==="dirty",sv=i=>i.status==="valid",EO=i=>typeof Promise<"u"&&i instanceof Promise;var $t;(function(i){i.errToObj=n=>typeof n=="string"?{message:n}:n||{},i.toString=n=>typeof n=="string"?n:n?.message})($t||($t={}));class gf{constructor(n,s,a,l){this._cachedPath=[],this.parent=n,this.data=s,this._path=a,this._key=l}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const xY=(i,n)=>{if(sv(n))return{success:!0,data:n.value};if(!i.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const s=new Id(i.common.issues);return this._error=s,this._error}}};function rr(i){if(!i)return{};const{errorMap:n,invalid_type_error:s,required_error:a,description:l}=i;if(n&&(s||a))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return n?{errorMap:n,description:l}:{errorMap:(f,E)=>{const{message:S}=i;return f.code==="invalid_enum_value"?{message:S??E.defaultError}:typeof E.data>"u"?{message:S??a??E.defaultError}:f.code!=="invalid_type"?{message:E.defaultError}:{message:S??s??E.defaultError}},description:l}}class br{get description(){return this._def.description}_getType(n){return Kp(n.data)}_getOrReturnCtx(n,s){return s||{common:n.parent.common,data:n.data,parsedType:Kp(n.data),schemaErrorMap:this._def.errorMap,path:n.path,parent:n.parent}}_processInputParams(n){return{status:new vc,ctx:{common:n.parent.common,data:n.data,parsedType:Kp(n.data),schemaErrorMap:this._def.errorMap,path:n.path,parent:n.parent}}}_parseSync(n){const s=this._parse(n);if(EO(s))throw new Error("Synchronous parse encountered promise.");return s}_parseAsync(n){const s=this._parse(n);return Promise.resolve(s)}parse(n,s){const a=this.safeParse(n,s);if(a.success)return a.data;throw a.error}safeParse(n,s){const a={common:{issues:[],async:s?.async??!1,contextualErrorMap:s?.errorMap},path:s?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:n,parsedType:Kp(n)},l=this._parseSync({data:n,path:a.path,parent:a});return xY(a,l)}"~validate"(n){const s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:n,parsedType:Kp(n)};if(!this["~standard"].async)try{const a=this._parseSync({data:n,path:[],parent:s});return sv(a)?{value:a.value}:{issues:s.common.issues}}catch(a){a?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:n,path:[],parent:s}).then(a=>sv(a)?{value:a.value}:{issues:s.common.issues})}async parseAsync(n,s){const a=await this.safeParseAsync(n,s);if(a.success)return a.data;throw a.error}async safeParseAsync(n,s){const a={common:{issues:[],contextualErrorMap:s?.errorMap,async:!0},path:s?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:n,parsedType:Kp(n)},l=this._parse({data:n,path:a.path,parent:a}),d=await(EO(l)?l:Promise.resolve(l));return xY(a,d)}refine(n,s){const a=l=>typeof s=="string"||typeof s>"u"?{message:s}:typeof s=="function"?s(l):s;return this._refinement((l,d)=>{const f=n(l),E=()=>d.addIssue({code:Et.custom,...a(l)});return typeof Promise<"u"&&f instanceof Promise?f.then(S=>S?!0:(E(),!1)):f?!0:(E(),!1)})}refinement(n,s){return this._refinement((a,l)=>n(a)?!0:(l.addIssue(typeof s=="function"?s(a,l):s),!1))}_refinement(n){return new av({schema:this,typeName:xn.ZodEffects,effect:{type:"refinement",refinement:n}})}superRefine(n){return this._refinement(n)}constructor(n){this.spa=this.safeParseAsync,this._def=n,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:s=>this["~validate"](s)}}optional(){return af.create(this,this._def)}nullable(){return cv.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return wd.create(this)}promise(){return TO.create(this,this._def)}or(n){return vO.create([this,n],this._def)}and(n){return SO.create(this,n,this._def)}transform(n){return new av({...rr(this._def),schema:this,typeName:xn.ZodEffects,effect:{type:"transform",transform:n}})}default(n){const s=typeof n=="function"?n:()=>n;return new s2({...rr(this._def),innerType:this,defaultValue:s,typeName:xn.ZodDefault})}brand(){return new Pke({typeName:xn.ZodBranded,type:this,...rr(this._def)})}catch(n){const s=typeof n=="function"?n:()=>n;return new o2({...rr(this._def),innerType:this,catchValue:s,typeName:xn.ZodCatch})}describe(n){const s=this.constructor;return new s({...this._def,description:n})}pipe(n){return uV.create(this,n)}readonly(){return a2.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const lke=/^c[^\s-]{8,}$/i,uke=/^[0-9a-z]+$/,dke=/^[0-9A-HJKMNP-TV-Z]{26}$/i,hke=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,pke=/^[a-z0-9_-]{21}$/i,fke=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,mke=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,gke=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,_ke="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let bL;const Eke=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,yke=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,vke=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Ske=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Tke=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,wke=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,yte="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Cke=new RegExp(`^${yte}$`);function vte(i){let n="[0-5]\\d";i.precision?n=`${n}\\.\\d{${i.precision}}`:i.precision==null&&(n=`${n}(\\.\\d+)?`);const s=i.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${n})${s}`}function Rke(i){return new RegExp(`^${vte(i)}$`)}function bke(i){let n=`${yte}T${vte(i)}`;const s=[];return s.push(i.local?"Z?":"Z"),i.offset&&s.push("([+-]\\d{2}:?\\d{2})"),n=`${n}(${s.join("|")})`,new RegExp(`^${n}$`)}function Ike(i,n){return!!((n==="v4"||!n)&&Eke.test(i)||(n==="v6"||!n)&&vke.test(i))}function Ake(i,n){if(!fke.test(i))return!1;try{const[s]=i.split(".");if(!s)return!1;const a=s.replace(/-/g,"+").replace(/_/g,"/").padEnd(s.length+(4-s.length%4)%4,"="),l=JSON.parse(atob(a));return!(typeof l!="object"||l===null||"typ"in l&&l?.typ!=="JWT"||!l.alg||n&&l.alg!==n)}catch{return!1}}function Oke(i,n){return!!((n==="v4"||!n)&&yke.test(i)||(n==="v6"||!n)&&Ske.test(i))}class tf extends br{_parse(n){if(this._def.coerce&&(n.data=String(n.data)),this._getType(n)!==Jt.string){const d=this._getOrReturnCtx(n);return kt(d,{code:Et.invalid_type,expected:Jt.string,received:d.parsedType}),Dn}const a=new vc;let l;for(const d of this._def.checks)if(d.kind==="min")n.data.length<d.value&&(l=this._getOrReturnCtx(n,l),kt(l,{code:Et.too_small,minimum:d.value,type:"string",inclusive:!0,exact:!1,message:d.message}),a.dirty());else if(d.kind==="max")n.data.length>d.value&&(l=this._getOrReturnCtx(n,l),kt(l,{code:Et.too_big,maximum:d.value,type:"string",inclusive:!0,exact:!1,message:d.message}),a.dirty());else if(d.kind==="length"){const f=n.data.length>d.value,E=n.data.length<d.value;(f||E)&&(l=this._getOrReturnCtx(n,l),f?kt(l,{code:Et.too_big,maximum:d.value,type:"string",inclusive:!0,exact:!0,message:d.message}):E&&kt(l,{code:Et.too_small,minimum:d.value,type:"string",inclusive:!0,exact:!0,message:d.message}),a.dirty())}else if(d.kind==="email")gke.test(n.data)||(l=this._getOrReturnCtx(n,l),kt(l,{validation:"email",code:Et.invalid_string,message:d.message}),a.dirty());else if(d.kind==="emoji")bL||(bL=new RegExp(_ke,"u")),bL.test(n.data)||(l=this._getOrReturnCtx(n,l),kt(l,{validation:"emoji",code:Et.invalid_string,message:d.message}),a.dirty());else if(d.kind==="uuid")hke.test(n.data)||(l=this._getOrReturnCtx(n,l),kt(l,{validation:"uuid",code:Et.invalid_string,message:d.message}),a.dirty());else if(d.kind==="nanoid")pke.test(n.data)||(l=this._getOrReturnCtx(n,l),kt(l,{validation:"nanoid",code:Et.invalid_string,message:d.message}),a.dirty());else if(d.kind==="cuid")lke.test(n.data)||(l=this._getOrReturnCtx(n,l),kt(l,{validation:"cuid",code:Et.invalid_string,message:d.message}),a.dirty());else if(d.kind==="cuid2")uke.test(n.data)||(l=this._getOrReturnCtx(n,l),kt(l,{validation:"cuid2",code:Et.invalid_string,message:d.message}),a.dirty());else if(d.kind==="ulid")dke.test(n.data)||(l=this._getOrReturnCtx(n,l),kt(l,{validation:"ulid",code:Et.invalid_string,message:d.message}),a.dirty());else if(d.kind==="url")try{new URL(n.data)}catch{l=this._getOrReturnCtx(n,l),kt(l,{validation:"url",code:Et.invalid_string,message:d.message}),a.dirty()}else d.kind==="regex"?(d.regex.lastIndex=0,d.regex.test(n.data)||(l=this._getOrReturnCtx(n,l),kt(l,{validation:"regex",code:Et.invalid_string,message:d.message}),a.dirty())):d.kind==="trim"?n.data=n.data.trim():d.kind==="includes"?n.data.includes(d.value,d.position)||(l=this._getOrReturnCtx(n,l),kt(l,{code:Et.invalid_string,validation:{includes:d.value,position:d.position},message:d.message}),a.dirty()):d.kind==="toLowerCase"?n.data=n.data.toLowerCase():d.kind==="toUpperCase"?n.data=n.data.toUpperCase():d.kind==="startsWith"?n.data.startsWith(d.value)||(l=this._getOrReturnCtx(n,l),kt(l,{code:Et.invalid_string,validation:{startsWith:d.value},message:d.message}),a.dirty()):d.kind==="endsWith"?n.data.endsWith(d.value)||(l=this._getOrReturnCtx(n,l),kt(l,{code:Et.invalid_string,validation:{endsWith:d.value},message:d.message}),a.dirty()):d.kind==="datetime"?bke(d).test(n.data)||(l=this._getOrReturnCtx(n,l),kt(l,{code:Et.invalid_string,validation:"datetime",message:d.message}),a.dirty()):d.kind==="date"?Cke.test(n.data)||(l=this._getOrReturnCtx(n,l),kt(l,{code:Et.invalid_string,validation:"date",message:d.message}),a.dirty()):d.kind==="time"?Rke(d).test(n.data)||(l=this._getOrReturnCtx(n,l),kt(l,{code:Et.invalid_string,validation:"time",message:d.message}),a.dirty()):d.kind==="duration"?mke.test(n.data)||(l=this._getOrReturnCtx(n,l),kt(l,{validation:"duration",code:Et.invalid_string,message:d.message}),a.dirty()):d.kind==="ip"?Ike(n.data,d.version)||(l=this._getOrReturnCtx(n,l),kt(l,{validation:"ip",code:Et.invalid_string,message:d.message}),a.dirty()):d.kind==="jwt"?Ake(n.data,d.alg)||(l=this._getOrReturnCtx(n,l),kt(l,{validation:"jwt",code:Et.invalid_string,message:d.message}),a.dirty()):d.kind==="cidr"?Oke(n.data,d.version)||(l=this._getOrReturnCtx(n,l),kt(l,{validation:"cidr",code:Et.invalid_string,message:d.message}),a.dirty()):d.kind==="base64"?Tke.test(n.data)||(l=this._getOrReturnCtx(n,l),kt(l,{validation:"base64",code:Et.invalid_string,message:d.message}),a.dirty()):d.kind==="base64url"?wke.test(n.data)||(l=this._getOrReturnCtx(n,l),kt(l,{validation:"base64url",code:Et.invalid_string,message:d.message}),a.dirty()):Pr.assertNever(d);return{status:a.value,value:n.data}}_regex(n,s,a){return this.refinement(l=>n.test(l),{validation:s,code:Et.invalid_string,...$t.errToObj(a)})}_addCheck(n){return new tf({...this._def,checks:[...this._def.checks,n]})}email(n){return this._addCheck({kind:"email",...$t.errToObj(n)})}url(n){return this._addCheck({kind:"url",...$t.errToObj(n)})}emoji(n){return this._addCheck({kind:"emoji",...$t.errToObj(n)})}uuid(n){return this._addCheck({kind:"uuid",...$t.errToObj(n)})}nanoid(n){return this._addCheck({kind:"nanoid",...$t.errToObj(n)})}cuid(n){return this._addCheck({kind:"cuid",...$t.errToObj(n)})}cuid2(n){return this._addCheck({kind:"cuid2",...$t.errToObj(n)})}ulid(n){return this._addCheck({kind:"ulid",...$t.errToObj(n)})}base64(n){return this._addCheck({kind:"base64",...$t.errToObj(n)})}base64url(n){return this._addCheck({kind:"base64url",...$t.errToObj(n)})}jwt(n){return this._addCheck({kind:"jwt",...$t.errToObj(n)})}ip(n){return this._addCheck({kind:"ip",...$t.errToObj(n)})}cidr(n){return this._addCheck({kind:"cidr",...$t.errToObj(n)})}datetime(n){return typeof n=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:n}):this._addCheck({kind:"datetime",precision:typeof n?.precision>"u"?null:n?.precision,offset:n?.offset??!1,local:n?.local??!1,...$t.errToObj(n?.message)})}date(n){return this._addCheck({kind:"date",message:n})}time(n){return typeof n=="string"?this._addCheck({kind:"time",precision:null,message:n}):this._addCheck({kind:"time",precision:typeof n?.precision>"u"?null:n?.precision,...$t.errToObj(n?.message)})}duration(n){return this._addCheck({kind:"duration",...$t.errToObj(n)})}regex(n,s){return this._addCheck({kind:"regex",regex:n,...$t.errToObj(s)})}includes(n,s){return this._addCheck({kind:"includes",value:n,position:s?.position,...$t.errToObj(s?.message)})}startsWith(n,s){return this._addCheck({kind:"startsWith",value:n,...$t.errToObj(s)})}endsWith(n,s){return this._addCheck({kind:"endsWith",value:n,...$t.errToObj(s)})}min(n,s){return this._addCheck({kind:"min",value:n,...$t.errToObj(s)})}max(n,s){return this._addCheck({kind:"max",value:n,...$t.errToObj(s)})}length(n,s){return this._addCheck({kind:"length",value:n,...$t.errToObj(s)})}nonempty(n){return this.min(1,$t.errToObj(n))}trim(){return new tf({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new tf({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new tf({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(n=>n.kind==="datetime")}get isDate(){return!!this._def.checks.find(n=>n.kind==="date")}get isTime(){return!!this._def.checks.find(n=>n.kind==="time")}get isDuration(){return!!this._def.checks.find(n=>n.kind==="duration")}get isEmail(){return!!this._def.checks.find(n=>n.kind==="email")}get isURL(){return!!this._def.checks.find(n=>n.kind==="url")}get isEmoji(){return!!this._def.checks.find(n=>n.kind==="emoji")}get isUUID(){return!!this._def.checks.find(n=>n.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(n=>n.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(n=>n.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(n=>n.kind==="cuid2")}get isULID(){return!!this._def.checks.find(n=>n.kind==="ulid")}get isIP(){return!!this._def.checks.find(n=>n.kind==="ip")}get isCIDR(){return!!this._def.checks.find(n=>n.kind==="cidr")}get isBase64(){return!!this._def.checks.find(n=>n.kind==="base64")}get isBase64url(){return!!this._def.checks.find(n=>n.kind==="base64url")}get minLength(){let n=null;for(const s of this._def.checks)s.kind==="min"&&(n===null||s.value>n)&&(n=s.value);return n}get maxLength(){let n=null;for(const s of this._def.checks)s.kind==="max"&&(n===null||s.value<n)&&(n=s.value);return n}}tf.create=i=>new tf({checks:[],typeName:xn.ZodString,coerce:i?.coerce??!1,...rr(i)});function Nke(i,n){const s=(i.toString().split(".")[1]||"").length,a=(n.toString().split(".")[1]||"").length,l=s>a?s:a,d=Number.parseInt(i.toFixed(l).replace(".","")),f=Number.parseInt(n.toFixed(l).replace(".",""));return d%f/10**l}class Pw extends br{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(n){if(this._def.coerce&&(n.data=Number(n.data)),this._getType(n)!==Jt.number){const d=this._getOrReturnCtx(n);return kt(d,{code:Et.invalid_type,expected:Jt.number,received:d.parsedType}),Dn}let a;const l=new vc;for(const d of this._def.checks)d.kind==="int"?Pr.isInteger(n.data)||(a=this._getOrReturnCtx(n,a),kt(a,{code:Et.invalid_type,expected:"integer",received:"float",message:d.message}),l.dirty()):d.kind==="min"?(d.inclusive?n.data<d.value:n.data<=d.value)&&(a=this._getOrReturnCtx(n,a),kt(a,{code:Et.too_small,minimum:d.value,type:"number",inclusive:d.inclusive,exact:!1,message:d.message}),l.dirty()):d.kind==="max"?(d.inclusive?n.data>d.value:n.data>=d.value)&&(a=this._getOrReturnCtx(n,a),kt(a,{code:Et.too_big,maximum:d.value,type:"number",inclusive:d.inclusive,exact:!1,message:d.message}),l.dirty()):d.kind==="multipleOf"?Nke(n.data,d.value)!==0&&(a=this._getOrReturnCtx(n,a),kt(a,{code:Et.not_multiple_of,multipleOf:d.value,message:d.message}),l.dirty()):d.kind==="finite"?Number.isFinite(n.data)||(a=this._getOrReturnCtx(n,a),kt(a,{code:Et.not_finite,message:d.message}),l.dirty()):Pr.assertNever(d);return{status:l.value,value:n.data}}gte(n,s){return this.setLimit("min",n,!0,$t.toString(s))}gt(n,s){return this.setLimit("min",n,!1,$t.toString(s))}lte(n,s){return this.setLimit("max",n,!0,$t.toString(s))}lt(n,s){return this.setLimit("max",n,!1,$t.toString(s))}setLimit(n,s,a,l){return new Pw({...this._def,checks:[...this._def.checks,{kind:n,value:s,inclusive:a,message:$t.toString(l)}]})}_addCheck(n){return new Pw({...this._def,checks:[...this._def.checks,n]})}int(n){return this._addCheck({kind:"int",message:$t.toString(n)})}positive(n){return this._addCheck({kind:"min",value:0,inclusive:!1,message:$t.toString(n)})}negative(n){return this._addCheck({kind:"max",value:0,inclusive:!1,message:$t.toString(n)})}nonpositive(n){return this._addCheck({kind:"max",value:0,inclusive:!0,message:$t.toString(n)})}nonnegative(n){return this._addCheck({kind:"min",value:0,inclusive:!0,message:$t.toString(n)})}multipleOf(n,s){return this._addCheck({kind:"multipleOf",value:n,message:$t.toString(s)})}finite(n){return this._addCheck({kind:"finite",message:$t.toString(n)})}safe(n){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:$t.toString(n)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:$t.toString(n)})}get minValue(){let n=null;for(const s of this._def.checks)s.kind==="min"&&(n===null||s.value>n)&&(n=s.value);return n}get maxValue(){let n=null;for(const s of this._def.checks)s.kind==="max"&&(n===null||s.value<n)&&(n=s.value);return n}get isInt(){return!!this._def.checks.find(n=>n.kind==="int"||n.kind==="multipleOf"&&Pr.isInteger(n.value))}get isFinite(){let n=null,s=null;for(const a of this._def.checks){if(a.kind==="finite"||a.kind==="int"||a.kind==="multipleOf")return!0;a.kind==="min"?(s===null||a.value>s)&&(s=a.value):a.kind==="max"&&(n===null||a.value<n)&&(n=a.value)}return Number.isFinite(s)&&Number.isFinite(n)}}Pw.create=i=>new Pw({checks:[],typeName:xn.ZodNumber,coerce:i?.coerce||!1,...rr(i)});class kw extends br{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(n){if(this._def.coerce)try{n.data=BigInt(n.data)}catch{return this._getInvalidInput(n)}if(this._getType(n)!==Jt.bigint)return this._getInvalidInput(n);let a;const l=new vc;for(const d of this._def.checks)d.kind==="min"?(d.inclusive?n.data<d.value:n.data<=d.value)&&(a=this._getOrReturnCtx(n,a),kt(a,{code:Et.too_small,type:"bigint",minimum:d.value,inclusive:d.inclusive,message:d.message}),l.dirty()):d.kind==="max"?(d.inclusive?n.data>d.value:n.data>=d.value)&&(a=this._getOrReturnCtx(n,a),kt(a,{code:Et.too_big,type:"bigint",maximum:d.value,inclusive:d.inclusive,message:d.message}),l.dirty()):d.kind==="multipleOf"?n.data%d.value!==BigInt(0)&&(a=this._getOrReturnCtx(n,a),kt(a,{code:Et.not_multiple_of,multipleOf:d.value,message:d.message}),l.dirty()):Pr.assertNever(d);return{status:l.value,value:n.data}}_getInvalidInput(n){const s=this._getOrReturnCtx(n);return kt(s,{code:Et.invalid_type,expected:Jt.bigint,received:s.parsedType}),Dn}gte(n,s){return this.setLimit("min",n,!0,$t.toString(s))}gt(n,s){return this.setLimit("min",n,!1,$t.toString(s))}lte(n,s){return this.setLimit("max",n,!0,$t.toString(s))}lt(n,s){return this.setLimit("max",n,!1,$t.toString(s))}setLimit(n,s,a,l){return new kw({...this._def,checks:[...this._def.checks,{kind:n,value:s,inclusive:a,message:$t.toString(l)}]})}_addCheck(n){return new kw({...this._def,checks:[...this._def.checks,n]})}positive(n){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:$t.toString(n)})}negative(n){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:$t.toString(n)})}nonpositive(n){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:$t.toString(n)})}nonnegative(n){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:$t.toString(n)})}multipleOf(n,s){return this._addCheck({kind:"multipleOf",value:n,message:$t.toString(s)})}get minValue(){let n=null;for(const s of this._def.checks)s.kind==="min"&&(n===null||s.value>n)&&(n=s.value);return n}get maxValue(){let n=null;for(const s of this._def.checks)s.kind==="max"&&(n===null||s.value<n)&&(n=s.value);return n}}kw.create=i=>new kw({checks:[],typeName:xn.ZodBigInt,coerce:i?.coerce??!1,...rr(i)});class LY extends br{_parse(n){if(this._def.coerce&&(n.data=!!n.data),this._getType(n)!==Jt.boolean){const a=this._getOrReturnCtx(n);return kt(a,{code:Et.invalid_type,expected:Jt.boolean,received:a.parsedType}),Dn}return hl(n.data)}}LY.create=i=>new LY({typeName:xn.ZodBoolean,coerce:i?.coerce||!1,...rr(i)});class yO extends br{_parse(n){if(this._def.coerce&&(n.data=new Date(n.data)),this._getType(n)!==Jt.date){const d=this._getOrReturnCtx(n);return kt(d,{code:Et.invalid_type,expected:Jt.date,received:d.parsedType}),Dn}if(Number.isNaN(n.data.getTime())){const d=this._getOrReturnCtx(n);return kt(d,{code:Et.invalid_date}),Dn}const a=new vc;let l;for(const d of this._def.checks)d.kind==="min"?n.data.getTime()<d.value&&(l=this._getOrReturnCtx(n,l),kt(l,{code:Et.too_small,message:d.message,inclusive:!0,exact:!1,minimum:d.value,type:"date"}),a.dirty()):d.kind==="max"?n.data.getTime()>d.value&&(l=this._getOrReturnCtx(n,l),kt(l,{code:Et.too_big,message:d.message,inclusive:!0,exact:!1,maximum:d.value,type:"date"}),a.dirty()):Pr.assertNever(d);return{status:a.value,value:new Date(n.data.getTime())}}_addCheck(n){return new yO({...this._def,checks:[...this._def.checks,n]})}min(n,s){return this._addCheck({kind:"min",value:n.getTime(),message:$t.toString(s)})}max(n,s){return this._addCheck({kind:"max",value:n.getTime(),message:$t.toString(s)})}get minDate(){let n=null;for(const s of this._def.checks)s.kind==="min"&&(n===null||s.value>n)&&(n=s.value);return n!=null?new Date(n):null}get maxDate(){let n=null;for(const s of this._def.checks)s.kind==="max"&&(n===null||s.value<n)&&(n=s.value);return n!=null?new Date(n):null}}yO.create=i=>new yO({checks:[],coerce:i?.coerce||!1,typeName:xn.ZodDate,...rr(i)});class MY extends br{_parse(n){if(this._getType(n)!==Jt.symbol){const a=this._getOrReturnCtx(n);return kt(a,{code:Et.invalid_type,expected:Jt.symbol,received:a.parsedType}),Dn}return hl(n.data)}}MY.create=i=>new MY({typeName:xn.ZodSymbol,...rr(i)});class UY extends br{_parse(n){if(this._getType(n)!==Jt.undefined){const a=this._getOrReturnCtx(n);return kt(a,{code:Et.invalid_type,expected:Jt.undefined,received:a.parsedType}),Dn}return hl(n.data)}}UY.create=i=>new UY({typeName:xn.ZodUndefined,...rr(i)});class VY extends br{_parse(n){if(this._getType(n)!==Jt.null){const a=this._getOrReturnCtx(n);return kt(a,{code:Et.invalid_type,expected:Jt.null,received:a.parsedType}),Dn}return hl(n.data)}}VY.create=i=>new VY({typeName:xn.ZodNull,...rr(i)});class FY extends br{constructor(){super(...arguments),this._any=!0}_parse(n){return hl(n.data)}}FY.create=i=>new FY({typeName:xn.ZodAny,...rr(i)});class jY extends br{constructor(){super(...arguments),this._unknown=!0}_parse(n){return hl(n.data)}}jY.create=i=>new jY({typeName:xn.ZodUnknown,...rr(i)});class _f extends br{_parse(n){const s=this._getOrReturnCtx(n);return kt(s,{code:Et.invalid_type,expected:Jt.never,received:s.parsedType}),Dn}}_f.create=i=>new _f({typeName:xn.ZodNever,...rr(i)});class BY extends br{_parse(n){if(this._getType(n)!==Jt.undefined){const a=this._getOrReturnCtx(n);return kt(a,{code:Et.invalid_type,expected:Jt.void,received:a.parsedType}),Dn}return hl(n.data)}}BY.create=i=>new BY({typeName:xn.ZodVoid,...rr(i)});class wd extends br{_parse(n){const{ctx:s,status:a}=this._processInputParams(n),l=this._def;if(s.parsedType!==Jt.array)return kt(s,{code:Et.invalid_type,expected:Jt.array,received:s.parsedType}),Dn;if(l.exactLength!==null){const f=s.data.length>l.exactLength.value,E=s.data.length<l.exactLength.value;(f||E)&&(kt(s,{code:f?Et.too_big:Et.too_small,minimum:E?l.exactLength.value:void 0,maximum:f?l.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:l.exactLength.message}),a.dirty())}if(l.minLength!==null&&s.data.length<l.minLength.value&&(kt(s,{code:Et.too_small,minimum:l.minLength.value,type:"array",inclusive:!0,exact:!1,message:l.minLength.message}),a.dirty()),l.maxLength!==null&&s.data.length>l.maxLength.value&&(kt(s,{code:Et.too_big,maximum:l.maxLength.value,type:"array",inclusive:!0,exact:!1,message:l.maxLength.message}),a.dirty()),s.common.async)return Promise.all([...s.data].map((f,E)=>l.type._parseAsync(new gf(s,f,s.path,E)))).then(f=>vc.mergeArray(a,f));const d=[...s.data].map((f,E)=>l.type._parseSync(new gf(s,f,s.path,E)));return vc.mergeArray(a,d)}get element(){return this._def.type}min(n,s){return new wd({...this._def,minLength:{value:n,message:$t.toString(s)}})}max(n,s){return new wd({...this._def,maxLength:{value:n,message:$t.toString(s)}})}length(n,s){return new wd({...this._def,exactLength:{value:n,message:$t.toString(s)}})}nonempty(n){return this.min(1,n)}}wd.create=(i,n)=>new wd({type:i,minLength:null,maxLength:null,exactLength:null,typeName:xn.ZodArray,...rr(n)});function wy(i){if(i instanceof ws){const n={};for(const s in i.shape){const a=i.shape[s];n[s]=af.create(wy(a))}return new ws({...i._def,shape:()=>n})}else return i instanceof wd?new wd({...i._def,type:wy(i.element)}):i instanceof af?af.create(wy(i.unwrap())):i instanceof cv?cv.create(wy(i.unwrap())):i instanceof jg?jg.create(i.items.map(n=>wy(n))):i}class ws extends br{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const n=this._def.shape(),s=Pr.objectKeys(n);return this._cached={shape:n,keys:s},this._cached}_parse(n){if(this._getType(n)!==Jt.object){const T=this._getOrReturnCtx(n);return kt(T,{code:Et.invalid_type,expected:Jt.object,received:T.parsedType}),Dn}const{status:a,ctx:l}=this._processInputParams(n),{shape:d,keys:f}=this._getCached(),E=[];if(!(this._def.catchall instanceof _f&&this._def.unknownKeys==="strip"))for(const T in l.data)f.includes(T)||E.push(T);const S=[];for(const T of f){const C=d[T],I=l.data[T];S.push({key:{status:"valid",value:T},value:C._parse(new gf(l,I,l.path,T)),alwaysSet:T in l.data})}if(this._def.catchall instanceof _f){const T=this._def.unknownKeys;if(T==="passthrough")for(const C of E)S.push({key:{status:"valid",value:C},value:{status:"valid",value:l.data[C]}});else if(T==="strict")E.length>0&&(kt(l,{code:Et.unrecognized_keys,keys:E}),a.dirty());else if(T!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const T=this._def.catchall;for(const C of E){const I=l.data[C];S.push({key:{status:"valid",value:C},value:T._parse(new gf(l,I,l.path,C)),alwaysSet:C in l.data})}}return l.common.async?Promise.resolve().then(async()=>{const T=[];for(const C of S){const I=await C.key,N=await C.value;T.push({key:I,value:N,alwaysSet:C.alwaysSet})}return T}).then(T=>vc.mergeObjectSync(a,T)):vc.mergeObjectSync(a,S)}get shape(){return this._def.shape()}strict(n){return $t.errToObj,new ws({...this._def,unknownKeys:"strict",...n!==void 0?{errorMap:(s,a)=>{const l=this._def.errorMap?.(s,a).message??a.defaultError;return s.code==="unrecognized_keys"?{message:$t.errToObj(n).message??l}:{message:l}}}:{}})}strip(){return new ws({...this._def,unknownKeys:"strip"})}passthrough(){return new ws({...this._def,unknownKeys:"passthrough"})}extend(n){return new ws({...this._def,shape:()=>({...this._def.shape(),...n})})}merge(n){return new ws({unknownKeys:n._def.unknownKeys,catchall:n._def.catchall,shape:()=>({...this._def.shape(),...n._def.shape()}),typeName:xn.ZodObject})}setKey(n,s){return this.augment({[n]:s})}catchall(n){return new ws({...this._def,catchall:n})}pick(n){const s={};for(const a of Pr.objectKeys(n))n[a]&&this.shape[a]&&(s[a]=this.shape[a]);return new ws({...this._def,shape:()=>s})}omit(n){const s={};for(const a of Pr.objectKeys(this.shape))n[a]||(s[a]=this.shape[a]);return new ws({...this._def,shape:()=>s})}deepPartial(){return wy(this)}partial(n){const s={};for(const a of Pr.objectKeys(this.shape)){const l=this.shape[a];n&&!n[a]?s[a]=l:s[a]=l.optional()}return new ws({...this._def,shape:()=>s})}required(n){const s={};for(const a of Pr.objectKeys(this.shape))if(n&&!n[a])s[a]=this.shape[a];else{let d=this.shape[a];for(;d instanceof af;)d=d._def.innerType;s[a]=d}return new ws({...this._def,shape:()=>s})}keyof(){return Ste(Pr.objectKeys(this.shape))}}ws.create=(i,n)=>new ws({shape:()=>i,unknownKeys:"strip",catchall:_f.create(),typeName:xn.ZodObject,...rr(n)});ws.strictCreate=(i,n)=>new ws({shape:()=>i,unknownKeys:"strict",catchall:_f.create(),typeName:xn.ZodObject,...rr(n)});ws.lazycreate=(i,n)=>new ws({shape:i,unknownKeys:"strip",catchall:_f.create(),typeName:xn.ZodObject,...rr(n)});class vO extends br{_parse(n){const{ctx:s}=this._processInputParams(n),a=this._def.options;function l(d){for(const E of d)if(E.result.status==="valid")return E.result;for(const E of d)if(E.result.status==="dirty")return s.common.issues.push(...E.ctx.common.issues),E.result;const f=d.map(E=>new Id(E.ctx.common.issues));return kt(s,{code:Et.invalid_union,unionErrors:f}),Dn}if(s.common.async)return Promise.all(a.map(async d=>{const f={...s,common:{...s.common,issues:[]},parent:null};return{result:await d._parseAsync({data:s.data,path:s.path,parent:f}),ctx:f}})).then(l);{let d;const f=[];for(const S of a){const T={...s,common:{...s.common,issues:[]},parent:null},C=S._parseSync({data:s.data,path:s.path,parent:T});if(C.status==="valid")return C;C.status==="dirty"&&!d&&(d={result:C,ctx:T}),T.common.issues.length&&f.push(T.common.issues)}if(d)return s.common.issues.push(...d.ctx.common.issues),d.result;const E=f.map(S=>new Id(S));return kt(s,{code:Et.invalid_union,unionErrors:E}),Dn}}get options(){return this._def.options}}vO.create=(i,n)=>new vO({options:i,typeName:xn.ZodUnion,...rr(n)});function i2(i,n){const s=Kp(i),a=Kp(n);if(i===n)return{valid:!0,data:i};if(s===Jt.object&&a===Jt.object){const l=Pr.objectKeys(n),d=Pr.objectKeys(i).filter(E=>l.indexOf(E)!==-1),f={...i,...n};for(const E of d){const S=i2(i[E],n[E]);if(!S.valid)return{valid:!1};f[E]=S.data}return{valid:!0,data:f}}else if(s===Jt.array&&a===Jt.array){if(i.length!==n.length)return{valid:!1};const l=[];for(let d=0;d<i.length;d++){const f=i[d],E=n[d],S=i2(f,E);if(!S.valid)return{valid:!1};l.push(S.data)}return{valid:!0,data:l}}else return s===Jt.date&&a===Jt.date&&+i==+n?{valid:!0,data:i}:{valid:!1}}class SO extends br{_parse(n){const{status:s,ctx:a}=this._processInputParams(n),l=(d,f)=>{if(kY(d)||kY(f))return Dn;const E=i2(d.value,f.value);return E.valid?((DY(d)||DY(f))&&s.dirty(),{status:s.value,value:E.data}):(kt(a,{code:Et.invalid_intersection_types}),Dn)};return a.common.async?Promise.all([this._def.left._parseAsync({data:a.data,path:a.path,parent:a}),this._def.right._parseAsync({data:a.data,path:a.path,parent:a})]).then(([d,f])=>l(d,f)):l(this._def.left._parseSync({data:a.data,path:a.path,parent:a}),this._def.right._parseSync({data:a.data,path:a.path,parent:a}))}}SO.create=(i,n,s)=>new SO({left:i,right:n,typeName:xn.ZodIntersection,...rr(s)});class jg extends br{_parse(n){const{status:s,ctx:a}=this._processInputParams(n);if(a.parsedType!==Jt.array)return kt(a,{code:Et.invalid_type,expected:Jt.array,received:a.parsedType}),Dn;if(a.data.length<this._def.items.length)return kt(a,{code:Et.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Dn;!this._def.rest&&a.data.length>this._def.items.length&&(kt(a,{code:Et.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),s.dirty());const d=[...a.data].map((f,E)=>{const S=this._def.items[E]||this._def.rest;return S?S._parse(new gf(a,f,a.path,E)):null}).filter(f=>!!f);return a.common.async?Promise.all(d).then(f=>vc.mergeArray(s,f)):vc.mergeArray(s,d)}get items(){return this._def.items}rest(n){return new jg({...this._def,rest:n})}}jg.create=(i,n)=>{if(!Array.isArray(i))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new jg({items:i,typeName:xn.ZodTuple,rest:null,...rr(n)})};class WY extends br{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(n){const{status:s,ctx:a}=this._processInputParams(n);if(a.parsedType!==Jt.map)return kt(a,{code:Et.invalid_type,expected:Jt.map,received:a.parsedType}),Dn;const l=this._def.keyType,d=this._def.valueType,f=[...a.data.entries()].map(([E,S],T)=>({key:l._parse(new gf(a,E,a.path,[T,"key"])),value:d._parse(new gf(a,S,a.path,[T,"value"]))}));if(a.common.async){const E=new Map;return Promise.resolve().then(async()=>{for(const S of f){const T=await S.key,C=await S.value;if(T.status==="aborted"||C.status==="aborted")return Dn;(T.status==="dirty"||C.status==="dirty")&&s.dirty(),E.set(T.value,C.value)}return{status:s.value,value:E}})}else{const E=new Map;for(const S of f){const T=S.key,C=S.value;if(T.status==="aborted"||C.status==="aborted")return Dn;(T.status==="dirty"||C.status==="dirty")&&s.dirty(),E.set(T.value,C.value)}return{status:s.value,value:E}}}}WY.create=(i,n,s)=>new WY({valueType:n,keyType:i,typeName:xn.ZodMap,...rr(s)});class Dw extends br{_parse(n){const{status:s,ctx:a}=this._processInputParams(n);if(a.parsedType!==Jt.set)return kt(a,{code:Et.invalid_type,expected:Jt.set,received:a.parsedType}),Dn;const l=this._def;l.minSize!==null&&a.data.size<l.minSize.value&&(kt(a,{code:Et.too_small,minimum:l.minSize.value,type:"set",inclusive:!0,exact:!1,message:l.minSize.message}),s.dirty()),l.maxSize!==null&&a.data.size>l.maxSize.value&&(kt(a,{code:Et.too_big,maximum:l.maxSize.value,type:"set",inclusive:!0,exact:!1,message:l.maxSize.message}),s.dirty());const d=this._def.valueType;function f(S){const T=new Set;for(const C of S){if(C.status==="aborted")return Dn;C.status==="dirty"&&s.dirty(),T.add(C.value)}return{status:s.value,value:T}}const E=[...a.data.values()].map((S,T)=>d._parse(new gf(a,S,a.path,T)));return a.common.async?Promise.all(E).then(S=>f(S)):f(E)}min(n,s){return new Dw({...this._def,minSize:{value:n,message:$t.toString(s)}})}max(n,s){return new Dw({...this._def,maxSize:{value:n,message:$t.toString(s)}})}size(n,s){return this.min(n,s).max(n,s)}nonempty(n){return this.min(1,n)}}Dw.create=(i,n)=>new Dw({valueType:i,minSize:null,maxSize:null,typeName:xn.ZodSet,...rr(n)});class GY extends br{get schema(){return this._def.getter()}_parse(n){const{ctx:s}=this._processInputParams(n);return this._def.getter()._parse({data:s.data,path:s.path,parent:s})}}GY.create=(i,n)=>new GY({getter:i,typeName:xn.ZodLazy,...rr(n)});class HY extends br{_parse(n){if(n.data!==this._def.value){const s=this._getOrReturnCtx(n);return kt(s,{received:s.data,code:Et.invalid_literal,expected:this._def.value}),Dn}return{status:"valid",value:n.data}}get value(){return this._def.value}}HY.create=(i,n)=>new HY({value:i,typeName:xn.ZodLiteral,...rr(n)});function Ste(i,n){return new ov({values:i,typeName:xn.ZodEnum,...rr(n)})}class ov extends br{_parse(n){if(typeof n.data!="string"){const s=this._getOrReturnCtx(n),a=this._def.values;return kt(s,{expected:Pr.joinValues(a),received:s.parsedType,code:Et.invalid_type}),Dn}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(n.data)){const s=this._getOrReturnCtx(n),a=this._def.values;return kt(s,{received:s.data,code:Et.invalid_enum_value,options:a}),Dn}return hl(n.data)}get options(){return this._def.values}get enum(){const n={};for(const s of this._def.values)n[s]=s;return n}get Values(){const n={};for(const s of this._def.values)n[s]=s;return n}get Enum(){const n={};for(const s of this._def.values)n[s]=s;return n}extract(n,s=this._def){return ov.create(n,{...this._def,...s})}exclude(n,s=this._def){return ov.create(this.options.filter(a=>!n.includes(a)),{...this._def,...s})}}ov.create=Ste;class zY extends br{_parse(n){const s=Pr.getValidEnumValues(this._def.values),a=this._getOrReturnCtx(n);if(a.parsedType!==Jt.string&&a.parsedType!==Jt.number){const l=Pr.objectValues(s);return kt(a,{expected:Pr.joinValues(l),received:a.parsedType,code:Et.invalid_type}),Dn}if(this._cache||(this._cache=new Set(Pr.getValidEnumValues(this._def.values))),!this._cache.has(n.data)){const l=Pr.objectValues(s);return kt(a,{received:a.data,code:Et.invalid_enum_value,options:l}),Dn}return hl(n.data)}get enum(){return this._def.values}}zY.create=(i,n)=>new zY({values:i,typeName:xn.ZodNativeEnum,...rr(n)});class TO extends br{unwrap(){return this._def.type}_parse(n){const{ctx:s}=this._processInputParams(n);if(s.parsedType!==Jt.promise&&s.common.async===!1)return kt(s,{code:Et.invalid_type,expected:Jt.promise,received:s.parsedType}),Dn;const a=s.parsedType===Jt.promise?s.data:Promise.resolve(s.data);return hl(a.then(l=>this._def.type.parseAsync(l,{path:s.path,errorMap:s.common.contextualErrorMap})))}}TO.create=(i,n)=>new TO({type:i,typeName:xn.ZodPromise,...rr(n)});class av extends br{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===xn.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(n){const{status:s,ctx:a}=this._processInputParams(n),l=this._def.effect||null,d={addIssue:f=>{kt(a,f),f.fatal?s.abort():s.dirty()},get path(){return a.path}};if(d.addIssue=d.addIssue.bind(d),l.type==="preprocess"){const f=l.transform(a.data,d);if(a.common.async)return Promise.resolve(f).then(async E=>{if(s.value==="aborted")return Dn;const S=await this._def.schema._parseAsync({data:E,path:a.path,parent:a});return S.status==="aborted"?Dn:S.status==="dirty"||s.value==="dirty"?B0(S.value):S});{if(s.value==="aborted")return Dn;const E=this._def.schema._parseSync({data:f,path:a.path,parent:a});return E.status==="aborted"?Dn:E.status==="dirty"||s.value==="dirty"?B0(E.value):E}}if(l.type==="refinement"){const f=E=>{const S=l.refinement(E,d);if(a.common.async)return Promise.resolve(S);if(S instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return E};if(a.common.async===!1){const E=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});return E.status==="aborted"?Dn:(E.status==="dirty"&&s.dirty(),f(E.value),{status:s.value,value:E.value})}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(E=>E.status==="aborted"?Dn:(E.status==="dirty"&&s.dirty(),f(E.value).then(()=>({status:s.value,value:E.value}))))}if(l.type==="transform")if(a.common.async===!1){const f=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});if(!sv(f))return Dn;const E=l.transform(f.value,d);if(E instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:s.value,value:E}}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(f=>sv(f)?Promise.resolve(l.transform(f.value,d)).then(E=>({status:s.value,value:E})):Dn);Pr.assertNever(l)}}av.create=(i,n,s)=>new av({schema:i,typeName:xn.ZodEffects,effect:n,...rr(s)});av.createWithPreprocess=(i,n,s)=>new av({schema:n,effect:{type:"preprocess",transform:i},typeName:xn.ZodEffects,...rr(s)});class af extends br{_parse(n){return this._getType(n)===Jt.undefined?hl(void 0):this._def.innerType._parse(n)}unwrap(){return this._def.innerType}}af.create=(i,n)=>new af({innerType:i,typeName:xn.ZodOptional,...rr(n)});class cv extends br{_parse(n){return this._getType(n)===Jt.null?hl(null):this._def.innerType._parse(n)}unwrap(){return this._def.innerType}}cv.create=(i,n)=>new cv({innerType:i,typeName:xn.ZodNullable,...rr(n)});class s2 extends br{_parse(n){const{ctx:s}=this._processInputParams(n);let a=s.data;return s.parsedType===Jt.undefined&&(a=this._def.defaultValue()),this._def.innerType._parse({data:a,path:s.path,parent:s})}removeDefault(){return this._def.innerType}}s2.create=(i,n)=>new s2({innerType:i,typeName:xn.ZodDefault,defaultValue:typeof n.default=="function"?n.default:()=>n.default,...rr(n)});class o2 extends br{_parse(n){const{ctx:s}=this._processInputParams(n),a={...s,common:{...s.common,issues:[]}},l=this._def.innerType._parse({data:a.data,path:a.path,parent:{...a}});return EO(l)?l.then(d=>({status:"valid",value:d.status==="valid"?d.value:this._def.catchValue({get error(){return new Id(a.common.issues)},input:a.data})})):{status:"valid",value:l.status==="valid"?l.value:this._def.catchValue({get error(){return new Id(a.common.issues)},input:a.data})}}removeCatch(){return this._def.innerType}}o2.create=(i,n)=>new o2({innerType:i,typeName:xn.ZodCatch,catchValue:typeof n.catch=="function"?n.catch:()=>n.catch,...rr(n)});class KY extends br{_parse(n){if(this._getType(n)!==Jt.nan){const a=this._getOrReturnCtx(n);return kt(a,{code:Et.invalid_type,expected:Jt.nan,received:a.parsedType}),Dn}return{status:"valid",value:n.data}}}KY.create=i=>new KY({typeName:xn.ZodNaN,...rr(i)});class Pke extends br{_parse(n){const{ctx:s}=this._processInputParams(n),a=s.data;return this._def.type._parse({data:a,path:s.path,parent:s})}unwrap(){return this._def.type}}class uV extends br{_parse(n){const{status:s,ctx:a}=this._processInputParams(n);if(a.common.async)return(async()=>{const d=await this._def.in._parseAsync({data:a.data,path:a.path,parent:a});return d.status==="aborted"?Dn:d.status==="dirty"?(s.dirty(),B0(d.value)):this._def.out._parseAsync({data:d.value,path:a.path,parent:a})})();{const l=this._def.in._parseSync({data:a.data,path:a.path,parent:a});return l.status==="aborted"?Dn:l.status==="dirty"?(s.dirty(),{status:"dirty",value:l.value}):this._def.out._parseSync({data:l.value,path:a.path,parent:a})}}static create(n,s){return new uV({in:n,out:s,typeName:xn.ZodPipeline})}}class a2 extends br{_parse(n){const s=this._def.innerType._parse(n),a=l=>(sv(l)&&(l.value=Object.freeze(l.value)),l);return EO(s)?s.then(l=>a(l)):a(s)}unwrap(){return this._def.innerType}}a2.create=(i,n)=>new a2({innerType:i,typeName:xn.ZodReadonly,...rr(n)});var xn;(function(i){i.ZodString="ZodString",i.ZodNumber="ZodNumber",i.ZodNaN="ZodNaN",i.ZodBigInt="ZodBigInt",i.ZodBoolean="ZodBoolean",i.ZodDate="ZodDate",i.ZodSymbol="ZodSymbol",i.ZodUndefined="ZodUndefined",i.ZodNull="ZodNull",i.ZodAny="ZodAny",i.ZodUnknown="ZodUnknown",i.ZodNever="ZodNever",i.ZodVoid="ZodVoid",i.ZodArray="ZodArray",i.ZodObject="ZodObject",i.ZodUnion="ZodUnion",i.ZodDiscriminatedUnion="ZodDiscriminatedUnion",i.ZodIntersection="ZodIntersection",i.ZodTuple="ZodTuple",i.ZodRecord="ZodRecord",i.ZodMap="ZodMap",i.ZodSet="ZodSet",i.ZodFunction="ZodFunction",i.ZodLazy="ZodLazy",i.ZodLiteral="ZodLiteral",i.ZodEnum="ZodEnum",i.ZodEffects="ZodEffects",i.ZodNativeEnum="ZodNativeEnum",i.ZodOptional="ZodOptional",i.ZodNullable="ZodNullable",i.ZodDefault="ZodDefault",i.ZodCatch="ZodCatch",i.ZodPromise="ZodPromise",i.ZodBranded="ZodBranded",i.ZodPipeline="ZodPipeline",i.ZodReadonly="ZodReadonly"})(xn||(xn={}));const rw=tf.create;_f.create;wd.create;const Tte=ws.create;vO.create;SO.create;jg.create;ov.create;TO.create;af.create;cv.create;const kke=Tte({fullName:rw().min(2,"Name must be at least 2 characters").max(100),email:rw().email("Invalid email address"),password:rw().min(6,"Password must be at least 6 characters")}),Dke=Tte({email:rw().email("Invalid email address"),password:rw().min(1,"Password is required")}),xke=()=>{const[i,n]=H.useState(!1),[s,a]=H.useState(""),[l,d]=H.useState(""),[f,E]=H.useState(""),[S,T]=H.useState(""),[C,I]=H.useState(""),[N,P]=H.useState(null),[W,x]=H.useState(!1),B=H.useRef(null),[X,Z]=H.useState(!1),[$,ae]=H.useState({}),{signUp:ce,signIn:le,signInWithGoogle:ne,signInAnonymously:fe,setUpRecaptcha:Se,signInWithPhone:De,user:be,loading:ye}=qO(),{toast:Ge}=T2(),Te=H2();H.useEffect(()=>{be&&!ye&&Te("/")},[be,ye,Te]);const Fe=()=>{try{return i?kke.parse({fullName:f,email:s,password:l}):Dke.parse({email:s,password:l}),ae({}),!0}catch(re){if(re instanceof Id){const ge={};re.errors.forEach(Oe=>{Oe.path[0]&&(ge[Oe.path[0]]=Oe.message)}),ae(ge)}return!1}},Je=async re=>{if(re.preventDefault(),!!Fe()){Z(!0);try{if(i){const{error:ge}=await ce(s,l,f);ge?ge.message.includes("already registered")?Ge({title:"Account exists",description:"This email is already registered. Try signing in instead.",variant:"destructive"}):Ge({title:"Sign up failed",description:ge.message,variant:"destructive"}):(Ge({title:"Welcome to KLE CONNECT!",description:"Your account has been created successfully."}),Te("/"))}else{const{error:ge}=await le(s,l);ge?Ge({title:"Sign in failed",description:"Invalid email or password. Please try again.",variant:"destructive"}):(Ge({title:"Welcome back!",description:"You have signed in successfully."}),Te("/"))}}finally{Z(!1)}}},je=async re=>{if(re.preventDefault(),!S){ae({phoneNumber:"Phone number is required"});return}let ge=S.trim();if(ge.startsWith("+")||(ge.length===10?ge=`+91${ge}`:ge=`+91${ge}`),!/^\+[1-9]\d{1,14}$/.test(ge)){ae({phoneNumber:"Invalid phone number format. Use E.164 format (e.g., +919876543210)"});return}Z(!0),ae({});try{if(!B.current)if(document.getElementById("recaptcha-container"))B.current=Se("recaptcha-container");else throw new Error("Recaptcha container not found");const{confirmationResult:ue,error:it}=await De(ge,B.current);if(it){console.error("OTP Send Error:",it),B.current&&(B.current.clear(),B.current=null);let yt=it.message;it.message.includes("auth/invalid-phone-number")?yt="Invalid phone number format. We added +91 automatically, but it still failed. Please check the number.":it.message.includes("reCAPTCHA")&&(yt="Verification failed. Please try again."),Ge({title:"Failed to send OTP",description:yt,variant:"destructive"})}else P(ue),Ge({title:"OTP Sent",description:`We've sent a code to ${ge}`})}catch(ue){console.error("Catch Error:",ue),B.current&&(B.current.clear(),B.current=null),Ge({title:"Error",description:ue.message,variant:"destructive"})}finally{Z(!1)}},Ie=async re=>{if(re.preventDefault(),!(!C||!N)){Z(!0);try{await N.confirm(C),Ge({title:"Success",description:"Phone number verified successfully!"}),Te("/")}catch{Ge({title:"Verification Failed",description:"Invalid OTP. Please try again.",variant:"destructive"})}finally{Z(!1)}}},He=async()=>{Z(!0);const{error:re}=await fe();Z(!1),re?Ge({title:"Guest Login Failed",description:re.message,variant:"destructive"}):(Ge({title:"Welcome Guest!",description:"You are now logged in anonymously."}),Te("/"))};return D.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center p-4 relative overflow-hidden",children:[D.jsx("div",{className:"fixed inset-0 pointer-events-none overflow-hidden"}),D.jsx("div",{id:"recaptcha-container"}),D.jsxs(mw,{to:"/",className:"absolute top-6 left-6 flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors",children:[D.jsx(Wge,{className:"w-4 h-4"}),D.jsx("span",{className:"text-sm",children:"Back to home"})]}),D.jsx(Bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"w-full max-w-md",children:D.jsxs("div",{className:"glass rounded-2xl p-8",children:[D.jsxs("div",{className:"text-center mb-6",children:[D.jsx("div",{className:"flex justify-center mb-4",children:D.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center",style:{background:"linear-gradient(135deg, hsl(199 89% 48% / 0.3), hsl(263 70% 58% / 0.3))"},children:D.jsx(PO,{className:"w-8 h-8 text-primary"})})}),D.jsxs("h1",{className:"text-2xl font-bold font-display",children:[D.jsx("span",{className:"text-gradient",children:"KLE"}),D.jsx("span",{className:"text-foreground",children:" CONNECT"})]}),D.jsx("p",{className:"text-muted-foreground text-sm mt-2",children:"Welcome to the student portal"})]}),D.jsxs(ske,{defaultValue:"email",className:"w-full",children:[D.jsxs(Ete,{className:"grid w-full grid-cols-2 mb-6",children:[D.jsx(t2,{value:"email",children:"Email"}),D.jsx(t2,{value:"phone",children:"Phone"})]}),D.jsx(n2,{value:"email",children:D.jsxs("form",{onSubmit:Je,className:"space-y-4",children:[i&&D.jsxs("div",{children:[D.jsxs("div",{className:"relative",children:[D.jsx(kO,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),D.jsx(Ty,{type:"text",placeholder:"Full Name",value:f,onChange:re=>E(re.target.value),className:"pl-10 bg-muted border-border"})]}),$.fullName&&D.jsx("p",{className:"text-destructive text-xs mt-1",children:$.fullName})]}),D.jsxs("div",{children:[D.jsxs("div",{className:"relative",children:[D.jsx(a_e,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),D.jsx(Ty,{type:"email",placeholder:"Email",value:s,onChange:re=>a(re.target.value),className:"pl-10 bg-muted border-border"})]}),$.email&&D.jsx("p",{className:"text-destructive text-xs mt-1",children:$.email})]}),D.jsxs("div",{children:[D.jsxs("div",{className:"relative",children:[D.jsx(TK,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),D.jsx(Ty,{type:"password",placeholder:"Password",value:l,onChange:re=>d(re.target.value),className:"pl-10 bg-muted border-border"})]}),$.password&&D.jsx("p",{className:"text-destructive text-xs mt-1",children:$.password})]}),D.jsx(Jn,{type:"submit",className:"w-full bg-primary hover:bg-primary/90",disabled:X,children:X?D.jsxs(D.Fragment,{children:[D.jsx(xy,{className:"w-4 h-4 mr-2 animate-spin"}),i?"Creating account...":"Signing in..."]}):i?"Create Account":"Sign In"}),D.jsx("div",{className:"text-center mt-2",children:D.jsx("button",{type:"button",onClick:()=>{n(!i),ae({})},className:"text-xs text-muted-foreground hover:text-primary transition-colors",children:i?"Already have an account? Sign in":"Don't have an account? Sign up"})})]})}),D.jsx(n2,{value:"phone",children:N?D.jsxs("form",{onSubmit:Ie,className:"space-y-4",children:[D.jsx("div",{children:D.jsxs("div",{className:"relative",children:[D.jsx(TK,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),D.jsx(Ty,{type:"text",placeholder:"Enter 6-digit OTP",value:C,onChange:re=>I(re.target.value),className:"pl-10 bg-muted border-border"})]})}),D.jsx(Jn,{type:"submit",className:"w-full bg-primary hover:bg-primary/90",disabled:X,children:X?D.jsx(xy,{className:"w-4 h-4 animate-spin"}):"Verify OTP"}),D.jsx("button",{type:"button",onClick:()=>P(null),className:"w-full text-xs text-muted-foreground hover:text-primary mt-2",children:"Change phone number"})]}):D.jsxs("form",{onSubmit:je,className:"space-y-4",children:[D.jsxs("div",{children:[D.jsxs("div",{className:"relative",children:[D.jsx(h_e,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),D.jsx(Ty,{type:"tel",placeholder:"+1 234 567 8900",value:S,onChange:re=>T(re.target.value),className:"pl-10 bg-muted border-border"})]}),D.jsx("p",{className:"text-xs text-muted-foreground mt-1 ml-1",children:"Include country code (e.g. +91 for India)"}),$.phoneNumber&&D.jsx("p",{className:"text-destructive text-xs mt-1",children:$.phoneNumber})]}),D.jsx(Jn,{type:"submit",className:"w-full bg-primary hover:bg-primary/90",disabled:X,children:X?D.jsx(xy,{className:"w-4 h-4 animate-spin"}):"Send OTP"})]})})]}),D.jsx("div",{className:"relative my-6",children:D.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:D.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with"})})}),D.jsxs("div",{className:"space-y-2",children:[D.jsxs(Jn,{type:"button",variant:"outline",className:"w-full",disabled:X,onClick:async()=>{Z(!0);const{error:re}=await ne();Z(!1),re?Ge({title:"Google Sign In failed",description:re.message,variant:"destructive"}):(Ge({title:"Welcome!",description:"Successfully signed in with Google."}),Te("/"))},children:[D.jsx("svg",{className:"mr-2 h-4 w-4","aria-hidden":"true",focusable:"false","data-prefix":"fab","data-icon":"google",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 488 512",children:D.jsx("path",{fill:"currentColor",d:"M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2 0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"})}),"Google"]}),D.jsxs(Jn,{type:"button",variant:"outline",className:"w-full",disabled:X,onClick:He,children:[D.jsx(qge,{className:"mr-2 h-4 w-4"}),"Continue as Guest"]})]})]})})]})},pu=({icon:i,title:n,subtitle:s,gradient:a})=>D.jsx(Bn.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},className:"mb-8",children:D.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[D.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center",style:{background:a},children:D.jsx(i,{className:"w-6 h-6 text-foreground"})}),D.jsxs("div",{children:[D.jsx("h1",{className:"text-3xl font-bold font-display text-foreground",children:n}),D.jsx("p",{className:"text-muted-foreground text-sm",children:s})]})]})}),dV=H.forwardRef(({className:i,...n},s)=>D.jsx("textarea",{className:Br("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i),ref:s,...n}));dV.displayName="Textarea";function Lke(i,n){const s={};return(i[i.length-1]===""?[...i,""]:i).join((s.padRight?" ":"")+","+(s.padLeft===!1?"":" ")).trim()}const Mke=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,Uke=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,Vke={};function YY(i,n){return(Vke.jsx?Uke:Mke).test(i)}const Fke=/[ \t\n\f\r]/g;function jke(i){return typeof i=="object"?i.type==="text"?qY(i.value):!1:qY(i)}function qY(i){return i.replace(Fke,"")===""}class Zw{constructor(n,s,a){this.normal=s,this.property=n,a&&(this.space=a)}}Zw.prototype.normal={};Zw.prototype.property={};Zw.prototype.space=void 0;function wte(i,n){const s={},a={};for(const l of i)Object.assign(s,l.property),Object.assign(a,l.normal);return new Zw(s,a,n)}function c2(i){return i.toLowerCase()}class Fa{constructor(n,s){this.attribute=s,this.property=n}}Fa.prototype.attribute="";Fa.prototype.booleanish=!1;Fa.prototype.boolean=!1;Fa.prototype.commaOrSpaceSeparated=!1;Fa.prototype.commaSeparated=!1;Fa.prototype.defined=!1;Fa.prototype.mustUseProperty=!1;Fa.prototype.number=!1;Fa.prototype.overloadedBoolean=!1;Fa.prototype.property="";Fa.prototype.spaceSeparated=!1;Fa.prototype.space=void 0;let Bke=0;const Kn=Kg(),vs=Kg(),l2=Kg(),mt=Kg(),_i=Kg(),Ky=Kg(),ac=Kg();function Kg(){return 2**++Bke}const u2=Object.freeze(Object.defineProperty({__proto__:null,boolean:Kn,booleanish:vs,commaOrSpaceSeparated:ac,commaSeparated:Ky,number:mt,overloadedBoolean:l2,spaceSeparated:_i},Symbol.toStringTag,{value:"Module"})),IL=Object.keys(u2);class hV extends Fa{constructor(n,s,a,l){let d=-1;if(super(n,s),XY(this,"space",l),typeof a=="number")for(;++d<IL.length;){const f=IL[d];XY(this,IL[d],(a&u2[f])===u2[f])}}}hV.prototype.defined=!0;function XY(i,n,s){s&&(i[n]=s)}function vv(i){const n={},s={};for(const[a,l]of Object.entries(i.properties)){const d=new hV(a,i.transform(i.attributes||{},a),l,i.space);i.mustUseProperty&&i.mustUseProperty.includes(a)&&(d.mustUseProperty=!0),n[a]=d,s[c2(a)]=a,s[c2(d.attribute)]=a}return new Zw(n,s,i.space)}const Cte=vv({properties:{ariaActiveDescendant:null,ariaAtomic:vs,ariaAutoComplete:null,ariaBusy:vs,ariaChecked:vs,ariaColCount:mt,ariaColIndex:mt,ariaColSpan:mt,ariaControls:_i,ariaCurrent:null,ariaDescribedBy:_i,ariaDetails:null,ariaDisabled:vs,ariaDropEffect:_i,ariaErrorMessage:null,ariaExpanded:vs,ariaFlowTo:_i,ariaGrabbed:vs,ariaHasPopup:null,ariaHidden:vs,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:_i,ariaLevel:mt,ariaLive:null,ariaModal:vs,ariaMultiLine:vs,ariaMultiSelectable:vs,ariaOrientation:null,ariaOwns:_i,ariaPlaceholder:null,ariaPosInSet:mt,ariaPressed:vs,ariaReadOnly:vs,ariaRelevant:null,ariaRequired:vs,ariaRoleDescription:_i,ariaRowCount:mt,ariaRowIndex:mt,ariaRowSpan:mt,ariaSelected:vs,ariaSetSize:mt,ariaSort:null,ariaValueMax:mt,ariaValueMin:mt,ariaValueNow:mt,ariaValueText:null,role:null},transform(i,n){return n==="role"?n:"aria-"+n.slice(4).toLowerCase()}});function Rte(i,n){return n in i?i[n]:n}function bte(i,n){return Rte(i,n.toLowerCase())}const Wke=vv({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:Ky,acceptCharset:_i,accessKey:_i,action:null,allow:null,allowFullScreen:Kn,allowPaymentRequest:Kn,allowUserMedia:Kn,alt:null,as:null,async:Kn,autoCapitalize:null,autoComplete:_i,autoFocus:Kn,autoPlay:Kn,blocking:_i,capture:null,charSet:null,checked:Kn,cite:null,className:_i,cols:mt,colSpan:null,content:null,contentEditable:vs,controls:Kn,controlsList:_i,coords:mt|Ky,crossOrigin:null,data:null,dateTime:null,decoding:null,default:Kn,defer:Kn,dir:null,dirName:null,disabled:Kn,download:l2,draggable:vs,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:Kn,formTarget:null,headers:_i,height:mt,hidden:l2,high:mt,href:null,hrefLang:null,htmlFor:_i,httpEquiv:_i,id:null,imageSizes:null,imageSrcSet:null,inert:Kn,inputMode:null,integrity:null,is:null,isMap:Kn,itemId:null,itemProp:_i,itemRef:_i,itemScope:Kn,itemType:_i,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:Kn,low:mt,manifest:null,max:null,maxLength:mt,media:null,method:null,min:null,minLength:mt,multiple:Kn,muted:Kn,name:null,nonce:null,noModule:Kn,noValidate:Kn,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:Kn,optimum:mt,pattern:null,ping:_i,placeholder:null,playsInline:Kn,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:Kn,referrerPolicy:null,rel:_i,required:Kn,reversed:Kn,rows:mt,rowSpan:mt,sandbox:_i,scope:null,scoped:Kn,seamless:Kn,selected:Kn,shadowRootClonable:Kn,shadowRootDelegatesFocus:Kn,shadowRootMode:null,shape:null,size:mt,sizes:null,slot:null,span:mt,spellCheck:vs,src:null,srcDoc:null,srcLang:null,srcSet:null,start:mt,step:null,style:null,tabIndex:mt,target:null,title:null,translate:null,type:null,typeMustMatch:Kn,useMap:null,value:vs,width:mt,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:_i,axis:null,background:null,bgColor:null,border:mt,borderColor:null,bottomMargin:mt,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:Kn,declare:Kn,event:null,face:null,frame:null,frameBorder:null,hSpace:mt,leftMargin:mt,link:null,longDesc:null,lowSrc:null,marginHeight:mt,marginWidth:mt,noResize:Kn,noHref:Kn,noShade:Kn,noWrap:Kn,object:null,profile:null,prompt:null,rev:null,rightMargin:mt,rules:null,scheme:null,scrolling:vs,standby:null,summary:null,text:null,topMargin:mt,valueType:null,version:null,vAlign:null,vLink:null,vSpace:mt,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:Kn,disableRemotePlayback:Kn,prefix:null,property:null,results:mt,security:null,unselectable:null},space:"html",transform:bte}),Gke=vv({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:ac,accentHeight:mt,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:mt,amplitude:mt,arabicForm:null,ascent:mt,attributeName:null,attributeType:null,azimuth:mt,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:mt,by:null,calcMode:null,capHeight:mt,className:_i,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:mt,diffuseConstant:mt,direction:null,display:null,dur:null,divisor:mt,dominantBaseline:null,download:Kn,dx:null,dy:null,edgeMode:null,editable:null,elevation:mt,enableBackground:null,end:null,event:null,exponent:mt,externalResourcesRequired:null,fill:null,fillOpacity:mt,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:Ky,g2:Ky,glyphName:Ky,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:mt,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:mt,horizOriginX:mt,horizOriginY:mt,id:null,ideographic:mt,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:mt,k:mt,k1:mt,k2:mt,k3:mt,k4:mt,kernelMatrix:ac,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:mt,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:mt,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:mt,overlineThickness:mt,paintOrder:null,panose1:null,path:null,pathLength:mt,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:_i,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:mt,pointsAtY:mt,pointsAtZ:mt,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:ac,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:ac,rev:ac,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:ac,requiredFeatures:ac,requiredFonts:ac,requiredFormats:ac,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:mt,specularExponent:mt,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:mt,strikethroughThickness:mt,string:null,stroke:null,strokeDashArray:ac,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:mt,strokeOpacity:mt,strokeWidth:null,style:null,surfaceScale:mt,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:ac,tabIndex:mt,tableValues:null,target:null,targetX:mt,targetY:mt,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:ac,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:mt,underlineThickness:mt,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:mt,values:null,vAlphabetic:mt,vMathematical:mt,vectorEffect:null,vHanging:mt,vIdeographic:mt,version:null,vertAdvY:mt,vertOriginX:mt,vertOriginY:mt,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:mt,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:Rte}),Ite=vv({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(i,n){return"xlink:"+n.slice(5).toLowerCase()}}),Ate=vv({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:bte}),Ote=vv({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(i,n){return"xml:"+n.slice(3).toLowerCase()}}),Hke={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},zke=/[A-Z]/g,JY=/-[a-z]/g,Kke=/^data[-\w.:]+$/i;function Yke(i,n){const s=c2(n);let a=n,l=Fa;if(s in i.normal)return i.property[i.normal[s]];if(s.length>4&&s.slice(0,4)==="data"&&Kke.test(n)){if(n.charAt(4)==="-"){const d=n.slice(5).replace(JY,Xke);a="data"+d.charAt(0).toUpperCase()+d.slice(1)}else{const d=n.slice(4);if(!JY.test(d)){let f=d.replace(zke,qke);f.charAt(0)!=="-"&&(f="-"+f),n="data"+f}}l=hV}return new l(a,n)}function qke(i){return"-"+i.toLowerCase()}function Xke(i){return i.charAt(1).toUpperCase()}const Jke=wte([Cte,Wke,Ite,Ate,Ote],"html"),pV=wte([Cte,Gke,Ite,Ate,Ote],"svg");function $ke(i){return i.join(" ").trim()}var gy={},AL,$Y;function Qke(){if($Y)return AL;$Y=1;var i=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,n=/\n/g,s=/^\s*/,a=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,l=/^:\s*/,d=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,f=/^[;\s]*/,E=/^\s+|\s+$/g,S=`
`,T="/",C="*",I="",N="comment",P="declaration";function W(B,X){if(typeof B!="string")throw new TypeError("First argument must be a string");if(!B)return[];X=X||{};var Z=1,$=1;function ae(Te){var Fe=Te.match(n);Fe&&(Z+=Fe.length);var Je=Te.lastIndexOf(S);$=~Je?Te.length-Je:$+Te.length}function ce(){var Te={line:Z,column:$};return function(Fe){return Fe.position=new le(Te),Se(),Fe}}function le(Te){this.start=Te,this.end={line:Z,column:$},this.source=X.source}le.prototype.content=B;function ne(Te){var Fe=new Error(X.source+":"+Z+":"+$+": "+Te);if(Fe.reason=Te,Fe.filename=X.source,Fe.line=Z,Fe.column=$,Fe.source=B,!X.silent)throw Fe}function fe(Te){var Fe=Te.exec(B);if(Fe){var Je=Fe[0];return ae(Je),B=B.slice(Je.length),Fe}}function Se(){fe(s)}function De(Te){var Fe;for(Te=Te||[];Fe=be();)Fe!==!1&&Te.push(Fe);return Te}function be(){var Te=ce();if(!(T!=B.charAt(0)||C!=B.charAt(1))){for(var Fe=2;I!=B.charAt(Fe)&&(C!=B.charAt(Fe)||T!=B.charAt(Fe+1));)++Fe;if(Fe+=2,I===B.charAt(Fe-1))return ne("End of comment missing");var Je=B.slice(2,Fe-2);return $+=2,ae(Je),B=B.slice(Fe),$+=2,Te({type:N,comment:Je})}}function ye(){var Te=ce(),Fe=fe(a);if(Fe){if(be(),!fe(l))return ne("property missing ':'");var Je=fe(d),je=Te({type:P,property:x(Fe[0].replace(i,I)),value:Je?x(Je[0].replace(i,I)):I});return fe(f),je}}function Ge(){var Te=[];De(Te);for(var Fe;Fe=ye();)Fe!==!1&&(Te.push(Fe),De(Te));return Te}return Se(),Ge()}function x(B){return B?B.replace(E,I):I}return AL=W,AL}var QY;function Zke(){if(QY)return gy;QY=1;var i=gy&&gy.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(gy,"__esModule",{value:!0}),gy.default=s;const n=i(Qke());function s(a,l){let d=null;if(!a||typeof a!="string")return d;const f=(0,n.default)(a),E=typeof l=="function";return f.forEach(S=>{if(S.type!=="declaration")return;const{property:T,value:C}=S;E?l(T,C,S):C&&(d=d||{},d[T]=C)}),d}return gy}var N0={},ZY;function eDe(){if(ZY)return N0;ZY=1,Object.defineProperty(N0,"__esModule",{value:!0}),N0.camelCase=void 0;var i=/^--[a-zA-Z0-9_-]+$/,n=/-([a-z])/g,s=/^[^-]+$/,a=/^-(webkit|moz|ms|o|khtml)-/,l=/^-(ms)-/,d=function(T){return!T||s.test(T)||i.test(T)},f=function(T,C){return C.toUpperCase()},E=function(T,C){return"".concat(C,"-")},S=function(T,C){return C===void 0&&(C={}),d(T)?T:(T=T.toLowerCase(),C.reactCompat?T=T.replace(l,E):T=T.replace(a,E),T.replace(n,f))};return N0.camelCase=S,N0}var P0,eq;function tDe(){if(eq)return P0;eq=1;var i=P0&&P0.__importDefault||function(l){return l&&l.__esModule?l:{default:l}},n=i(Zke()),s=eDe();function a(l,d){var f={};return!l||typeof l!="string"||(0,n.default)(l,function(E,S){E&&S&&(f[(0,s.camelCase)(E,d)]=S)}),f}return a.default=a,P0=a,P0}var nDe=tDe();const rDe=IO(nDe),Nte=Pte("end"),fV=Pte("start");function Pte(i){return n;function n(s){const a=s&&s.position&&s.position[i]||{};if(typeof a.line=="number"&&a.line>0&&typeof a.column=="number"&&a.column>0)return{line:a.line,column:a.column,offset:typeof a.offset=="number"&&a.offset>-1?a.offset:void 0}}}function iDe(i){const n=fV(i),s=Nte(i);if(n&&s)return{start:n,end:s}}function iw(i){return!i||typeof i!="object"?"":"position"in i||"type"in i?tq(i.position):"start"in i||"end"in i?tq(i):"line"in i||"column"in i?d2(i):""}function d2(i){return nq(i&&i.line)+":"+nq(i&&i.column)}function tq(i){return d2(i&&i.start)+"-"+d2(i&&i.end)}function nq(i){return i&&typeof i=="number"?i:1}class Vo extends Error{constructor(n,s,a){super(),typeof s=="string"&&(a=s,s=void 0);let l="",d={},f=!1;if(s&&("line"in s&&"column"in s?d={place:s}:"start"in s&&"end"in s?d={place:s}:"type"in s?d={ancestors:[s],place:s.position}:d={...s}),typeof n=="string"?l=n:!d.cause&&n&&(f=!0,l=n.message,d.cause=n),!d.ruleId&&!d.source&&typeof a=="string"){const S=a.indexOf(":");S===-1?d.ruleId=a:(d.source=a.slice(0,S),d.ruleId=a.slice(S+1))}if(!d.place&&d.ancestors&&d.ancestors){const S=d.ancestors[d.ancestors.length-1];S&&(d.place=S.position)}const E=d.place&&"start"in d.place?d.place.start:d.place;this.ancestors=d.ancestors||void 0,this.cause=d.cause||void 0,this.column=E?E.column:void 0,this.fatal=void 0,this.file="",this.message=l,this.line=E?E.line:void 0,this.name=iw(d.place)||"1:1",this.place=d.place||void 0,this.reason=this.message,this.ruleId=d.ruleId||void 0,this.source=d.source||void 0,this.stack=f&&d.cause&&typeof d.cause.stack=="string"?d.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}Vo.prototype.file="";Vo.prototype.name="";Vo.prototype.reason="";Vo.prototype.message="";Vo.prototype.stack="";Vo.prototype.column=void 0;Vo.prototype.line=void 0;Vo.prototype.ancestors=void 0;Vo.prototype.cause=void 0;Vo.prototype.fatal=void 0;Vo.prototype.place=void 0;Vo.prototype.ruleId=void 0;Vo.prototype.source=void 0;const mV={}.hasOwnProperty,sDe=new Map,oDe=/[A-Z]/g,aDe=new Set(["table","tbody","thead","tfoot","tr"]),cDe=new Set(["td","th"]),kte="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function lDe(i,n){if(!n||n.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const s=n.filePath||void 0;let a;if(n.development){if(typeof n.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");a=_De(s,n.jsxDEV)}else{if(typeof n.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof n.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");a=gDe(s,n.jsx,n.jsxs)}const l={Fragment:n.Fragment,ancestors:[],components:n.components||{},create:a,elementAttributeNameCase:n.elementAttributeNameCase||"react",evaluater:n.createEvaluater?n.createEvaluater():void 0,filePath:s,ignoreInvalidStyle:n.ignoreInvalidStyle||!1,passKeys:n.passKeys!==!1,passNode:n.passNode||!1,schema:n.space==="svg"?pV:Jke,stylePropertyNameCase:n.stylePropertyNameCase||"dom",tableCellAlignToStyle:n.tableCellAlignToStyle!==!1},d=Dte(l,i,void 0);return d&&typeof d!="string"?d:l.create(i,l.Fragment,{children:d||void 0},void 0)}function Dte(i,n,s){if(n.type==="element")return uDe(i,n,s);if(n.type==="mdxFlowExpression"||n.type==="mdxTextExpression")return dDe(i,n);if(n.type==="mdxJsxFlowElement"||n.type==="mdxJsxTextElement")return pDe(i,n,s);if(n.type==="mdxjsEsm")return hDe(i,n);if(n.type==="root")return fDe(i,n,s);if(n.type==="text")return mDe(i,n)}function uDe(i,n,s){const a=i.schema;let l=a;n.tagName.toLowerCase()==="svg"&&a.space==="html"&&(l=pV,i.schema=l),i.ancestors.push(n);const d=Lte(i,n.tagName,!1),f=EDe(i,n);let E=_V(i,n);return aDe.has(n.tagName)&&(E=E.filter(function(S){return typeof S=="string"?!jke(S):!0})),xte(i,f,d,n),gV(f,E),i.ancestors.pop(),i.schema=a,i.create(n,d,f,s)}function dDe(i,n){if(n.data&&n.data.estree&&i.evaluater){const a=n.data.estree.body[0];return a.type,i.evaluater.evaluateExpression(a.expression)}xw(i,n.position)}function hDe(i,n){if(n.data&&n.data.estree&&i.evaluater)return i.evaluater.evaluateProgram(n.data.estree);xw(i,n.position)}function pDe(i,n,s){const a=i.schema;let l=a;n.name==="svg"&&a.space==="html"&&(l=pV,i.schema=l),i.ancestors.push(n);const d=n.name===null?i.Fragment:Lte(i,n.name,!0),f=yDe(i,n),E=_V(i,n);return xte(i,f,d,n),gV(f,E),i.ancestors.pop(),i.schema=a,i.create(n,d,f,s)}function fDe(i,n,s){const a={};return gV(a,_V(i,n)),i.create(n,i.Fragment,a,s)}function mDe(i,n){return n.value}function xte(i,n,s,a){typeof s!="string"&&s!==i.Fragment&&i.passNode&&(n.node=a)}function gV(i,n){if(n.length>0){const s=n.length>1?n:n[0];s&&(i.children=s)}}function gDe(i,n,s){return a;function a(l,d,f,E){const T=Array.isArray(f.children)?s:n;return E?T(d,f,E):T(d,f)}}function _De(i,n){return s;function s(a,l,d,f){const E=Array.isArray(d.children),S=fV(a);return n(l,d,f,E,{columnNumber:S?S.column-1:void 0,fileName:i,lineNumber:S?S.line:void 0},void 0)}}function EDe(i,n){const s={};let a,l;for(l in n.properties)if(l!=="children"&&mV.call(n.properties,l)){const d=vDe(i,l,n.properties[l]);if(d){const[f,E]=d;i.tableCellAlignToStyle&&f==="align"&&typeof E=="string"&&cDe.has(n.tagName)?a=E:s[f]=E}}if(a){const d=s.style||(s.style={});d[i.stylePropertyNameCase==="css"?"text-align":"textAlign"]=a}return s}function yDe(i,n){const s={};for(const a of n.attributes)if(a.type==="mdxJsxExpressionAttribute")if(a.data&&a.data.estree&&i.evaluater){const d=a.data.estree.body[0];d.type;const f=d.expression;f.type;const E=f.properties[0];E.type,Object.assign(s,i.evaluater.evaluateExpression(E.argument))}else xw(i,n.position);else{const l=a.name;let d;if(a.value&&typeof a.value=="object")if(a.value.data&&a.value.data.estree&&i.evaluater){const E=a.value.data.estree.body[0];E.type,d=i.evaluater.evaluateExpression(E.expression)}else xw(i,n.position);else d=a.value===null?!0:a.value;s[l]=d}return s}function _V(i,n){const s=[];let a=-1;const l=i.passKeys?new Map:sDe;for(;++a<n.children.length;){const d=n.children[a];let f;if(i.passKeys){const S=d.type==="element"?d.tagName:d.type==="mdxJsxFlowElement"||d.type==="mdxJsxTextElement"?d.name:void 0;if(S){const T=l.get(S)||0;f=S+"-"+T,l.set(S,T+1)}}const E=Dte(i,d,f);E!==void 0&&s.push(E)}return s}function vDe(i,n,s){const a=Yke(i.schema,n);if(!(s==null||typeof s=="number"&&Number.isNaN(s))){if(Array.isArray(s)&&(s=a.commaSeparated?Lke(s):$ke(s)),a.property==="style"){let l=typeof s=="object"?s:SDe(i,String(s));return i.stylePropertyNameCase==="css"&&(l=TDe(l)),["style",l]}return[i.elementAttributeNameCase==="react"&&a.space?Hke[a.property]||a.property:a.attribute,s]}}function SDe(i,n){try{return rDe(n,{reactCompat:!0})}catch(s){if(i.ignoreInvalidStyle)return{};const a=s,l=new Vo("Cannot parse `style` attribute",{ancestors:i.ancestors,cause:a,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw l.file=i.filePath||void 0,l.url=kte+"#cannot-parse-style-attribute",l}}function Lte(i,n,s){let a;if(!s)a={type:"Literal",value:n};else if(n.includes(".")){const l=n.split(".");let d=-1,f;for(;++d<l.length;){const E=YY(l[d])?{type:"Identifier",name:l[d]}:{type:"Literal",value:l[d]};f=f?{type:"MemberExpression",object:f,property:E,computed:!!(d&&E.type==="Literal"),optional:!1}:E}a=f}else a=YY(n)&&!/^[a-z]/.test(n)?{type:"Identifier",name:n}:{type:"Literal",value:n};if(a.type==="Literal"){const l=a.value;return mV.call(i.components,l)?i.components[l]:l}if(i.evaluater)return i.evaluater.evaluateExpression(a);xw(i)}function xw(i,n){const s=new Vo("Cannot handle MDX estrees without `createEvaluater`",{ancestors:i.ancestors,place:n,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw s.file=i.filePath||void 0,s.url=kte+"#cannot-handle-mdx-estrees-without-createevaluater",s}function TDe(i){const n={};let s;for(s in i)mV.call(i,s)&&(n[wDe(s)]=i[s]);return n}function wDe(i){let n=i.replace(oDe,CDe);return n.slice(0,3)==="ms-"&&(n="-"+n),n}function CDe(i){return"-"+i.toLowerCase()}const OL={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},RDe={};function bDe(i,n){const s=RDe,a=typeof s.includeImageAlt=="boolean"?s.includeImageAlt:!0,l=typeof s.includeHtml=="boolean"?s.includeHtml:!0;return Mte(i,a,l)}function Mte(i,n,s){if(IDe(i)){if("value"in i)return i.type==="html"&&!s?"":i.value;if(n&&"alt"in i&&i.alt)return i.alt;if("children"in i)return rq(i.children,n,s)}return Array.isArray(i)?rq(i,n,s):""}function rq(i,n,s){const a=[];let l=-1;for(;++l<i.length;)a[l]=Mte(i[l],n,s);return a.join("")}function IDe(i){return!!(i&&typeof i=="object")}const iq=document.createElement("i");function EV(i){const n="&"+i+";";iq.innerHTML=n;const s=iq.textContent;return s.charCodeAt(s.length-1)===59&&i!=="semi"||s===n?!1:s}function Ad(i,n,s,a){const l=i.length;let d=0,f;if(n<0?n=-n>l?0:l+n:n=n>l?l:n,s=s>0?s:0,a.length<1e4)f=Array.from(a),f.unshift(n,s),i.splice(...f);else for(s&&i.splice(n,s);d<a.length;)f=a.slice(d,d+1e4),f.unshift(n,0),i.splice(...f),d+=1e4,n+=1e4}function il(i,n){return i.length>0?(Ad(i,i.length,0,n),i):n}const sq={}.hasOwnProperty;function ADe(i){const n={};let s=-1;for(;++s<i.length;)ODe(n,i[s]);return n}function ODe(i,n){let s;for(s in n){const l=(sq.call(i,s)?i[s]:void 0)||(i[s]={}),d=n[s];let f;if(d)for(f in d){sq.call(l,f)||(l[f]=[]);const E=d[f];NDe(l[f],Array.isArray(E)?E:E?[E]:[])}}}function NDe(i,n){let s=-1;const a=[];for(;++s<n.length;)(n[s].add==="after"?i:a).push(n[s]);Ad(i,0,0,a)}function Ute(i,n){const s=Number.parseInt(i,n);return s<9||s===11||s>13&&s<32||s>126&&s<160||s>55295&&s<57344||s>64975&&s<65008||(s&65535)===65535||(s&65535)===65534||s>1114111?"":String.fromCodePoint(s)}function Yy(i){return i.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const md=Rf(/[A-Za-z]/),fc=Rf(/[\dA-Za-z]/),PDe=Rf(/[#-'*+\--9=?A-Z^-~]/);function h2(i){return i!==null&&(i<32||i===127)}const p2=Rf(/\d/),kDe=Rf(/[\dA-Fa-f]/),DDe=Rf(/[!-/:-@[-`{-~]/);function wn(i){return i!==null&&i<-2}function Ma(i){return i!==null&&(i<0||i===32)}function Lr(i){return i===-2||i===-1||i===32}const xDe=Rf(new RegExp("\\p{P}|\\p{S}","u")),LDe=Rf(/\s/);function Rf(i){return n;function n(s){return s!==null&&s>-1&&i.test(String.fromCharCode(s))}}function Sv(i){const n=[];let s=-1,a=0,l=0;for(;++s<i.length;){const d=i.charCodeAt(s);let f="";if(d===37&&fc(i.charCodeAt(s+1))&&fc(i.charCodeAt(s+2)))l=2;else if(d<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(d))||(f=String.fromCharCode(d));else if(d>55295&&d<57344){const E=i.charCodeAt(s+1);d<56320&&E>56319&&E<57344?(f=String.fromCharCode(d,E),l=1):f=""}else f=String.fromCharCode(d);f&&(n.push(i.slice(a,s),encodeURIComponent(f)),a=s+l+1,f=""),l&&(s+=l,l=0)}return n.join("")+i.slice(a)}function Ei(i,n,s,a){const l=a?a-1:Number.POSITIVE_INFINITY;let d=0;return f;function f(S){return Lr(S)?(i.enter(s),E(S)):n(S)}function E(S){return Lr(S)&&d++<l?(i.consume(S),E):(i.exit(s),n(S))}}const MDe={tokenize:UDe};function UDe(i){const n=i.attempt(this.parser.constructs.contentInitial,a,l);let s;return n;function a(E){if(E===null){i.consume(E);return}return i.enter("lineEnding"),i.consume(E),i.exit("lineEnding"),Ei(i,n,"linePrefix")}function l(E){return i.enter("paragraph"),d(E)}function d(E){const S=i.enter("chunkText",{contentType:"text",previous:s});return s&&(s.next=S),s=S,f(E)}function f(E){if(E===null){i.exit("chunkText"),i.exit("paragraph"),i.consume(E);return}return wn(E)?(i.consume(E),i.exit("chunkText"),d):(i.consume(E),f)}}const VDe={tokenize:FDe},oq={tokenize:jDe};function FDe(i){const n=this,s=[];let a=0,l,d,f;return E;function E($){if(a<s.length){const ae=s[a];return n.containerState=ae[1],i.attempt(ae[0].continuation,S,T)($)}return T($)}function S($){if(a++,n.containerState._closeFlow){n.containerState._closeFlow=void 0,l&&Z();const ae=n.events.length;let ce=ae,le;for(;ce--;)if(n.events[ce][0]==="exit"&&n.events[ce][1].type==="chunkFlow"){le=n.events[ce][1].end;break}X(a);let ne=ae;for(;ne<n.events.length;)n.events[ne][1].end={...le},ne++;return Ad(n.events,ce+1,0,n.events.slice(ae)),n.events.length=ne,T($)}return E($)}function T($){if(a===s.length){if(!l)return N($);if(l.currentConstruct&&l.currentConstruct.concrete)return W($);n.interrupt=!!(l.currentConstruct&&!l._gfmTableDynamicInterruptHack)}return n.containerState={},i.check(oq,C,I)($)}function C($){return l&&Z(),X(a),N($)}function I($){return n.parser.lazy[n.now().line]=a!==s.length,f=n.now().offset,W($)}function N($){return n.containerState={},i.attempt(oq,P,W)($)}function P($){return a++,s.push([n.currentConstruct,n.containerState]),N($)}function W($){if($===null){l&&Z(),X(0),i.consume($);return}return l=l||n.parser.flow(n.now()),i.enter("chunkFlow",{_tokenizer:l,contentType:"flow",previous:d}),x($)}function x($){if($===null){B(i.exit("chunkFlow"),!0),X(0),i.consume($);return}return wn($)?(i.consume($),B(i.exit("chunkFlow")),a=0,n.interrupt=void 0,E):(i.consume($),x)}function B($,ae){const ce=n.sliceStream($);if(ae&&ce.push(null),$.previous=d,d&&(d.next=$),d=$,l.defineSkip($.start),l.write(ce),n.parser.lazy[$.start.line]){let le=l.events.length;for(;le--;)if(l.events[le][1].start.offset<f&&(!l.events[le][1].end||l.events[le][1].end.offset>f))return;const ne=n.events.length;let fe=ne,Se,De;for(;fe--;)if(n.events[fe][0]==="exit"&&n.events[fe][1].type==="chunkFlow"){if(Se){De=n.events[fe][1].end;break}Se=!0}for(X(a),le=ne;le<n.events.length;)n.events[le][1].end={...De},le++;Ad(n.events,fe+1,0,n.events.slice(ne)),n.events.length=le}}function X($){let ae=s.length;for(;ae-- >$;){const ce=s[ae];n.containerState=ce[1],ce[0].exit.call(n,i)}s.length=$}function Z(){l.write([null]),d=void 0,l=void 0,n.containerState._closeFlow=void 0}}function jDe(i,n,s){return Ei(i,i.attempt(this.parser.constructs.document,n,s),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function aq(i){if(i===null||Ma(i)||LDe(i))return 1;if(xDe(i))return 2}function yV(i,n,s){const a=[];let l=-1;for(;++l<i.length;){const d=i[l].resolveAll;d&&!a.includes(d)&&(n=d(n,s),a.push(d))}return n}const f2={name:"attention",resolveAll:BDe,tokenize:WDe};function BDe(i,n){let s=-1,a,l,d,f,E,S,T,C;for(;++s<i.length;)if(i[s][0]==="enter"&&i[s][1].type==="attentionSequence"&&i[s][1]._close){for(a=s;a--;)if(i[a][0]==="exit"&&i[a][1].type==="attentionSequence"&&i[a][1]._open&&n.sliceSerialize(i[a][1]).charCodeAt(0)===n.sliceSerialize(i[s][1]).charCodeAt(0)){if((i[a][1]._close||i[s][1]._open)&&(i[s][1].end.offset-i[s][1].start.offset)%3&&!((i[a][1].end.offset-i[a][1].start.offset+i[s][1].end.offset-i[s][1].start.offset)%3))continue;S=i[a][1].end.offset-i[a][1].start.offset>1&&i[s][1].end.offset-i[s][1].start.offset>1?2:1;const I={...i[a][1].end},N={...i[s][1].start};cq(I,-S),cq(N,S),f={type:S>1?"strongSequence":"emphasisSequence",start:I,end:{...i[a][1].end}},E={type:S>1?"strongSequence":"emphasisSequence",start:{...i[s][1].start},end:N},d={type:S>1?"strongText":"emphasisText",start:{...i[a][1].end},end:{...i[s][1].start}},l={type:S>1?"strong":"emphasis",start:{...f.start},end:{...E.end}},i[a][1].end={...f.start},i[s][1].start={...E.end},T=[],i[a][1].end.offset-i[a][1].start.offset&&(T=il(T,[["enter",i[a][1],n],["exit",i[a][1],n]])),T=il(T,[["enter",l,n],["enter",f,n],["exit",f,n],["enter",d,n]]),T=il(T,yV(n.parser.constructs.insideSpan.null,i.slice(a+1,s),n)),T=il(T,[["exit",d,n],["enter",E,n],["exit",E,n],["exit",l,n]]),i[s][1].end.offset-i[s][1].start.offset?(C=2,T=il(T,[["enter",i[s][1],n],["exit",i[s][1],n]])):C=0,Ad(i,a-1,s-a+3,T),s=a+T.length-C-2;break}}for(s=-1;++s<i.length;)i[s][1].type==="attentionSequence"&&(i[s][1].type="data");return i}function WDe(i,n){const s=this.parser.constructs.attentionMarkers.null,a=this.previous,l=aq(a);let d;return f;function f(S){return d=S,i.enter("attentionSequence"),E(S)}function E(S){if(S===d)return i.consume(S),E;const T=i.exit("attentionSequence"),C=aq(S),I=!C||C===2&&l||s.includes(S),N=!l||l===2&&C||s.includes(a);return T._open=!!(d===42?I:I&&(l||!N)),T._close=!!(d===42?N:N&&(C||!I)),n(S)}}function cq(i,n){i.column+=n,i.offset+=n,i._bufferIndex+=n}const GDe={name:"autolink",tokenize:HDe};function HDe(i,n,s){let a=0;return l;function l(P){return i.enter("autolink"),i.enter("autolinkMarker"),i.consume(P),i.exit("autolinkMarker"),i.enter("autolinkProtocol"),d}function d(P){return md(P)?(i.consume(P),f):P===64?s(P):T(P)}function f(P){return P===43||P===45||P===46||fc(P)?(a=1,E(P)):T(P)}function E(P){return P===58?(i.consume(P),a=0,S):(P===43||P===45||P===46||fc(P))&&a++<32?(i.consume(P),E):(a=0,T(P))}function S(P){return P===62?(i.exit("autolinkProtocol"),i.enter("autolinkMarker"),i.consume(P),i.exit("autolinkMarker"),i.exit("autolink"),n):P===null||P===32||P===60||h2(P)?s(P):(i.consume(P),S)}function T(P){return P===64?(i.consume(P),C):PDe(P)?(i.consume(P),T):s(P)}function C(P){return fc(P)?I(P):s(P)}function I(P){return P===46?(i.consume(P),a=0,C):P===62?(i.exit("autolinkProtocol").type="autolinkEmail",i.enter("autolinkMarker"),i.consume(P),i.exit("autolinkMarker"),i.exit("autolink"),n):N(P)}function N(P){if((P===45||fc(P))&&a++<63){const W=P===45?N:I;return i.consume(P),W}return s(P)}}const rN={partial:!0,tokenize:zDe};function zDe(i,n,s){return a;function a(d){return Lr(d)?Ei(i,l,"linePrefix")(d):l(d)}function l(d){return d===null||wn(d)?n(d):s(d)}}const Vte={continuation:{tokenize:YDe},exit:qDe,name:"blockQuote",tokenize:KDe};function KDe(i,n,s){const a=this;return l;function l(f){if(f===62){const E=a.containerState;return E.open||(i.enter("blockQuote",{_container:!0}),E.open=!0),i.enter("blockQuotePrefix"),i.enter("blockQuoteMarker"),i.consume(f),i.exit("blockQuoteMarker"),d}return s(f)}function d(f){return Lr(f)?(i.enter("blockQuotePrefixWhitespace"),i.consume(f),i.exit("blockQuotePrefixWhitespace"),i.exit("blockQuotePrefix"),n):(i.exit("blockQuotePrefix"),n(f))}}function YDe(i,n,s){const a=this;return l;function l(f){return Lr(f)?Ei(i,d,"linePrefix",a.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(f):d(f)}function d(f){return i.attempt(Vte,n,s)(f)}}function qDe(i){i.exit("blockQuote")}const Fte={name:"characterEscape",tokenize:XDe};function XDe(i,n,s){return a;function a(d){return i.enter("characterEscape"),i.enter("escapeMarker"),i.consume(d),i.exit("escapeMarker"),l}function l(d){return DDe(d)?(i.enter("characterEscapeValue"),i.consume(d),i.exit("characterEscapeValue"),i.exit("characterEscape"),n):s(d)}}const jte={name:"characterReference",tokenize:JDe};function JDe(i,n,s){const a=this;let l=0,d,f;return E;function E(I){return i.enter("characterReference"),i.enter("characterReferenceMarker"),i.consume(I),i.exit("characterReferenceMarker"),S}function S(I){return I===35?(i.enter("characterReferenceMarkerNumeric"),i.consume(I),i.exit("characterReferenceMarkerNumeric"),T):(i.enter("characterReferenceValue"),d=31,f=fc,C(I))}function T(I){return I===88||I===120?(i.enter("characterReferenceMarkerHexadecimal"),i.consume(I),i.exit("characterReferenceMarkerHexadecimal"),i.enter("characterReferenceValue"),d=6,f=kDe,C):(i.enter("characterReferenceValue"),d=7,f=p2,C(I))}function C(I){if(I===59&&l){const N=i.exit("characterReferenceValue");return f===fc&&!EV(a.sliceSerialize(N))?s(I):(i.enter("characterReferenceMarker"),i.consume(I),i.exit("characterReferenceMarker"),i.exit("characterReference"),n)}return f(I)&&l++<d?(i.consume(I),C):s(I)}}const lq={partial:!0,tokenize:QDe},uq={concrete:!0,name:"codeFenced",tokenize:$De};function $De(i,n,s){const a=this,l={partial:!0,tokenize:ce};let d=0,f=0,E;return S;function S(le){return T(le)}function T(le){const ne=a.events[a.events.length-1];return d=ne&&ne[1].type==="linePrefix"?ne[2].sliceSerialize(ne[1],!0).length:0,E=le,i.enter("codeFenced"),i.enter("codeFencedFence"),i.enter("codeFencedFenceSequence"),C(le)}function C(le){return le===E?(f++,i.consume(le),C):f<3?s(le):(i.exit("codeFencedFenceSequence"),Lr(le)?Ei(i,I,"whitespace")(le):I(le))}function I(le){return le===null||wn(le)?(i.exit("codeFencedFence"),a.interrupt?n(le):i.check(lq,x,ae)(le)):(i.enter("codeFencedFenceInfo"),i.enter("chunkString",{contentType:"string"}),N(le))}function N(le){return le===null||wn(le)?(i.exit("chunkString"),i.exit("codeFencedFenceInfo"),I(le)):Lr(le)?(i.exit("chunkString"),i.exit("codeFencedFenceInfo"),Ei(i,P,"whitespace")(le)):le===96&&le===E?s(le):(i.consume(le),N)}function P(le){return le===null||wn(le)?I(le):(i.enter("codeFencedFenceMeta"),i.enter("chunkString",{contentType:"string"}),W(le))}function W(le){return le===null||wn(le)?(i.exit("chunkString"),i.exit("codeFencedFenceMeta"),I(le)):le===96&&le===E?s(le):(i.consume(le),W)}function x(le){return i.attempt(l,ae,B)(le)}function B(le){return i.enter("lineEnding"),i.consume(le),i.exit("lineEnding"),X}function X(le){return d>0&&Lr(le)?Ei(i,Z,"linePrefix",d+1)(le):Z(le)}function Z(le){return le===null||wn(le)?i.check(lq,x,ae)(le):(i.enter("codeFlowValue"),$(le))}function $(le){return le===null||wn(le)?(i.exit("codeFlowValue"),Z(le)):(i.consume(le),$)}function ae(le){return i.exit("codeFenced"),n(le)}function ce(le,ne,fe){let Se=0;return De;function De(Fe){return le.enter("lineEnding"),le.consume(Fe),le.exit("lineEnding"),be}function be(Fe){return le.enter("codeFencedFence"),Lr(Fe)?Ei(le,ye,"linePrefix",a.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(Fe):ye(Fe)}function ye(Fe){return Fe===E?(le.enter("codeFencedFenceSequence"),Ge(Fe)):fe(Fe)}function Ge(Fe){return Fe===E?(Se++,le.consume(Fe),Ge):Se>=f?(le.exit("codeFencedFenceSequence"),Lr(Fe)?Ei(le,Te,"whitespace")(Fe):Te(Fe)):fe(Fe)}function Te(Fe){return Fe===null||wn(Fe)?(le.exit("codeFencedFence"),ne(Fe)):fe(Fe)}}}function QDe(i,n,s){const a=this;return l;function l(f){return f===null?s(f):(i.enter("lineEnding"),i.consume(f),i.exit("lineEnding"),d)}function d(f){return a.parser.lazy[a.now().line]?s(f):n(f)}}const NL={name:"codeIndented",tokenize:exe},ZDe={partial:!0,tokenize:txe};function exe(i,n,s){const a=this;return l;function l(T){return i.enter("codeIndented"),Ei(i,d,"linePrefix",5)(T)}function d(T){const C=a.events[a.events.length-1];return C&&C[1].type==="linePrefix"&&C[2].sliceSerialize(C[1],!0).length>=4?f(T):s(T)}function f(T){return T===null?S(T):wn(T)?i.attempt(ZDe,f,S)(T):(i.enter("codeFlowValue"),E(T))}function E(T){return T===null||wn(T)?(i.exit("codeFlowValue"),f(T)):(i.consume(T),E)}function S(T){return i.exit("codeIndented"),n(T)}}function txe(i,n,s){const a=this;return l;function l(f){return a.parser.lazy[a.now().line]?s(f):wn(f)?(i.enter("lineEnding"),i.consume(f),i.exit("lineEnding"),l):Ei(i,d,"linePrefix",5)(f)}function d(f){const E=a.events[a.events.length-1];return E&&E[1].type==="linePrefix"&&E[2].sliceSerialize(E[1],!0).length>=4?n(f):wn(f)?l(f):s(f)}}const nxe={name:"codeText",previous:ixe,resolve:rxe,tokenize:sxe};function rxe(i){let n=i.length-4,s=3,a,l;if((i[s][1].type==="lineEnding"||i[s][1].type==="space")&&(i[n][1].type==="lineEnding"||i[n][1].type==="space")){for(a=s;++a<n;)if(i[a][1].type==="codeTextData"){i[s][1].type="codeTextPadding",i[n][1].type="codeTextPadding",s+=2,n-=2;break}}for(a=s-1,n++;++a<=n;)l===void 0?a!==n&&i[a][1].type!=="lineEnding"&&(l=a):(a===n||i[a][1].type==="lineEnding")&&(i[l][1].type="codeTextData",a!==l+2&&(i[l][1].end=i[a-1][1].end,i.splice(l+2,a-l-2),n-=a-l-2,a=l+2),l=void 0);return i}function ixe(i){return i!==96||this.events[this.events.length-1][1].type==="characterEscape"}function sxe(i,n,s){let a=0,l,d;return f;function f(I){return i.enter("codeText"),i.enter("codeTextSequence"),E(I)}function E(I){return I===96?(i.consume(I),a++,E):(i.exit("codeTextSequence"),S(I))}function S(I){return I===null?s(I):I===32?(i.enter("space"),i.consume(I),i.exit("space"),S):I===96?(d=i.enter("codeTextSequence"),l=0,C(I)):wn(I)?(i.enter("lineEnding"),i.consume(I),i.exit("lineEnding"),S):(i.enter("codeTextData"),T(I))}function T(I){return I===null||I===32||I===96||wn(I)?(i.exit("codeTextData"),S(I)):(i.consume(I),T)}function C(I){return I===96?(i.consume(I),l++,C):l===a?(i.exit("codeTextSequence"),i.exit("codeText"),n(I)):(d.type="codeTextData",T(I))}}class oxe{constructor(n){this.left=n?[...n]:[],this.right=[]}get(n){if(n<0||n>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+n+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return n<this.left.length?this.left[n]:this.right[this.right.length-n+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(n,s){const a=s??Number.POSITIVE_INFINITY;return a<this.left.length?this.left.slice(n,a):n>this.left.length?this.right.slice(this.right.length-a+this.left.length,this.right.length-n+this.left.length).reverse():this.left.slice(n).concat(this.right.slice(this.right.length-a+this.left.length).reverse())}splice(n,s,a){const l=s||0;this.setCursor(Math.trunc(n));const d=this.right.splice(this.right.length-l,Number.POSITIVE_INFINITY);return a&&k0(this.left,a),d.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(n){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(n)}pushMany(n){this.setCursor(Number.POSITIVE_INFINITY),k0(this.left,n)}unshift(n){this.setCursor(0),this.right.push(n)}unshiftMany(n){this.setCursor(0),k0(this.right,n.reverse())}setCursor(n){if(!(n===this.left.length||n>this.left.length&&this.right.length===0||n<0&&this.left.length===0))if(n<this.left.length){const s=this.left.splice(n,Number.POSITIVE_INFINITY);k0(this.right,s.reverse())}else{const s=this.right.splice(this.left.length+this.right.length-n,Number.POSITIVE_INFINITY);k0(this.left,s.reverse())}}}function k0(i,n){let s=0;if(n.length<1e4)i.push(...n);else for(;s<n.length;)i.push(...n.slice(s,s+1e4)),s+=1e4}function Bte(i){const n={};let s=-1,a,l,d,f,E,S,T;const C=new oxe(i);for(;++s<C.length;){for(;s in n;)s=n[s];if(a=C.get(s),s&&a[1].type==="chunkFlow"&&C.get(s-1)[1].type==="listItemPrefix"&&(S=a[1]._tokenizer.events,d=0,d<S.length&&S[d][1].type==="lineEndingBlank"&&(d+=2),d<S.length&&S[d][1].type==="content"))for(;++d<S.length&&S[d][1].type!=="content";)S[d][1].type==="chunkText"&&(S[d][1]._isInFirstContentOfListItem=!0,d++);if(a[0]==="enter")a[1].contentType&&(Object.assign(n,axe(C,s)),s=n[s],T=!0);else if(a[1]._container){for(d=s,l=void 0;d--;)if(f=C.get(d),f[1].type==="lineEnding"||f[1].type==="lineEndingBlank")f[0]==="enter"&&(l&&(C.get(l)[1].type="lineEndingBlank"),f[1].type="lineEnding",l=d);else if(!(f[1].type==="linePrefix"||f[1].type==="listItemIndent"))break;l&&(a[1].end={...C.get(l)[1].start},E=C.slice(l,s),E.unshift(a),C.splice(l,s-l+1,E))}}return Ad(i,0,Number.POSITIVE_INFINITY,C.slice(0)),!T}function axe(i,n){const s=i.get(n)[1],a=i.get(n)[2];let l=n-1;const d=[];let f=s._tokenizer;f||(f=a.parser[s.contentType](s.start),s._contentTypeTextTrailing&&(f._contentTypeTextTrailing=!0));const E=f.events,S=[],T={};let C,I,N=-1,P=s,W=0,x=0;const B=[x];for(;P;){for(;i.get(++l)[1]!==P;);d.push(l),P._tokenizer||(C=a.sliceStream(P),P.next||C.push(null),I&&f.defineSkip(P.start),P._isInFirstContentOfListItem&&(f._gfmTasklistFirstContentOfListItem=!0),f.write(C),P._isInFirstContentOfListItem&&(f._gfmTasklistFirstContentOfListItem=void 0)),I=P,P=P.next}for(P=s;++N<E.length;)E[N][0]==="exit"&&E[N-1][0]==="enter"&&E[N][1].type===E[N-1][1].type&&E[N][1].start.line!==E[N][1].end.line&&(x=N+1,B.push(x),P._tokenizer=void 0,P.previous=void 0,P=P.next);for(f.events=[],P?(P._tokenizer=void 0,P.previous=void 0):B.pop(),N=B.length;N--;){const X=E.slice(B[N],B[N+1]),Z=d.pop();S.push([Z,Z+X.length-1]),i.splice(Z,2,X)}for(S.reverse(),N=-1;++N<S.length;)T[W+S[N][0]]=W+S[N][1],W+=S[N][1]-S[N][0]-1;return T}const cxe={resolve:uxe,tokenize:dxe},lxe={partial:!0,tokenize:hxe};function uxe(i){return Bte(i),i}function dxe(i,n){let s;return a;function a(E){return i.enter("content"),s=i.enter("chunkContent",{contentType:"content"}),l(E)}function l(E){return E===null?d(E):wn(E)?i.check(lxe,f,d)(E):(i.consume(E),l)}function d(E){return i.exit("chunkContent"),i.exit("content"),n(E)}function f(E){return i.consume(E),i.exit("chunkContent"),s.next=i.enter("chunkContent",{contentType:"content",previous:s}),s=s.next,l}}function hxe(i,n,s){const a=this;return l;function l(f){return i.exit("chunkContent"),i.enter("lineEnding"),i.consume(f),i.exit("lineEnding"),Ei(i,d,"linePrefix")}function d(f){if(f===null||wn(f))return s(f);const E=a.events[a.events.length-1];return!a.parser.constructs.disable.null.includes("codeIndented")&&E&&E[1].type==="linePrefix"&&E[2].sliceSerialize(E[1],!0).length>=4?n(f):i.interrupt(a.parser.constructs.flow,s,n)(f)}}function Wte(i,n,s,a,l,d,f,E,S){const T=S||Number.POSITIVE_INFINITY;let C=0;return I;function I(X){return X===60?(i.enter(a),i.enter(l),i.enter(d),i.consume(X),i.exit(d),N):X===null||X===32||X===41||h2(X)?s(X):(i.enter(a),i.enter(f),i.enter(E),i.enter("chunkString",{contentType:"string"}),x(X))}function N(X){return X===62?(i.enter(d),i.consume(X),i.exit(d),i.exit(l),i.exit(a),n):(i.enter(E),i.enter("chunkString",{contentType:"string"}),P(X))}function P(X){return X===62?(i.exit("chunkString"),i.exit(E),N(X)):X===null||X===60||wn(X)?s(X):(i.consume(X),X===92?W:P)}function W(X){return X===60||X===62||X===92?(i.consume(X),P):P(X)}function x(X){return!C&&(X===null||X===41||Ma(X))?(i.exit("chunkString"),i.exit(E),i.exit(f),i.exit(a),n(X)):C<T&&X===40?(i.consume(X),C++,x):X===41?(i.consume(X),C--,x):X===null||X===32||X===40||h2(X)?s(X):(i.consume(X),X===92?B:x)}function B(X){return X===40||X===41||X===92?(i.consume(X),x):x(X)}}function Gte(i,n,s,a,l,d){const f=this;let E=0,S;return T;function T(P){return i.enter(a),i.enter(l),i.consume(P),i.exit(l),i.enter(d),C}function C(P){return E>999||P===null||P===91||P===93&&!S||P===94&&!E&&"_hiddenFootnoteSupport"in f.parser.constructs?s(P):P===93?(i.exit(d),i.enter(l),i.consume(P),i.exit(l),i.exit(a),n):wn(P)?(i.enter("lineEnding"),i.consume(P),i.exit("lineEnding"),C):(i.enter("chunkString",{contentType:"string"}),I(P))}function I(P){return P===null||P===91||P===93||wn(P)||E++>999?(i.exit("chunkString"),C(P)):(i.consume(P),S||(S=!Lr(P)),P===92?N:I)}function N(P){return P===91||P===92||P===93?(i.consume(P),E++,I):I(P)}}function Hte(i,n,s,a,l,d){let f;return E;function E(N){return N===34||N===39||N===40?(i.enter(a),i.enter(l),i.consume(N),i.exit(l),f=N===40?41:N,S):s(N)}function S(N){return N===f?(i.enter(l),i.consume(N),i.exit(l),i.exit(a),n):(i.enter(d),T(N))}function T(N){return N===f?(i.exit(d),S(f)):N===null?s(N):wn(N)?(i.enter("lineEnding"),i.consume(N),i.exit("lineEnding"),Ei(i,T,"linePrefix")):(i.enter("chunkString",{contentType:"string"}),C(N))}function C(N){return N===f||N===null||wn(N)?(i.exit("chunkString"),T(N)):(i.consume(N),N===92?I:C)}function I(N){return N===f||N===92?(i.consume(N),C):C(N)}}function sw(i,n){let s;return a;function a(l){return wn(l)?(i.enter("lineEnding"),i.consume(l),i.exit("lineEnding"),s=!0,a):Lr(l)?Ei(i,a,s?"linePrefix":"lineSuffix")(l):n(l)}}const pxe={name:"definition",tokenize:mxe},fxe={partial:!0,tokenize:gxe};function mxe(i,n,s){const a=this;let l;return d;function d(P){return i.enter("definition"),f(P)}function f(P){return Gte.call(a,i,E,s,"definitionLabel","definitionLabelMarker","definitionLabelString")(P)}function E(P){return l=Yy(a.sliceSerialize(a.events[a.events.length-1][1]).slice(1,-1)),P===58?(i.enter("definitionMarker"),i.consume(P),i.exit("definitionMarker"),S):s(P)}function S(P){return Ma(P)?sw(i,T)(P):T(P)}function T(P){return Wte(i,C,s,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(P)}function C(P){return i.attempt(fxe,I,I)(P)}function I(P){return Lr(P)?Ei(i,N,"whitespace")(P):N(P)}function N(P){return P===null||wn(P)?(i.exit("definition"),a.parser.defined.push(l),n(P)):s(P)}}function gxe(i,n,s){return a;function a(E){return Ma(E)?sw(i,l)(E):s(E)}function l(E){return Hte(i,d,s,"definitionTitle","definitionTitleMarker","definitionTitleString")(E)}function d(E){return Lr(E)?Ei(i,f,"whitespace")(E):f(E)}function f(E){return E===null||wn(E)?n(E):s(E)}}const _xe={name:"hardBreakEscape",tokenize:Exe};function Exe(i,n,s){return a;function a(d){return i.enter("hardBreakEscape"),i.consume(d),l}function l(d){return wn(d)?(i.exit("hardBreakEscape"),n(d)):s(d)}}const yxe={name:"headingAtx",resolve:vxe,tokenize:Sxe};function vxe(i,n){let s=i.length-2,a=3,l,d;return i[a][1].type==="whitespace"&&(a+=2),s-2>a&&i[s][1].type==="whitespace"&&(s-=2),i[s][1].type==="atxHeadingSequence"&&(a===s-1||s-4>a&&i[s-2][1].type==="whitespace")&&(s-=a+1===s?2:4),s>a&&(l={type:"atxHeadingText",start:i[a][1].start,end:i[s][1].end},d={type:"chunkText",start:i[a][1].start,end:i[s][1].end,contentType:"text"},Ad(i,a,s-a+1,[["enter",l,n],["enter",d,n],["exit",d,n],["exit",l,n]])),i}function Sxe(i,n,s){let a=0;return l;function l(C){return i.enter("atxHeading"),d(C)}function d(C){return i.enter("atxHeadingSequence"),f(C)}function f(C){return C===35&&a++<6?(i.consume(C),f):C===null||Ma(C)?(i.exit("atxHeadingSequence"),E(C)):s(C)}function E(C){return C===35?(i.enter("atxHeadingSequence"),S(C)):C===null||wn(C)?(i.exit("atxHeading"),n(C)):Lr(C)?Ei(i,E,"whitespace")(C):(i.enter("atxHeadingText"),T(C))}function S(C){return C===35?(i.consume(C),S):(i.exit("atxHeadingSequence"),E(C))}function T(C){return C===null||C===35||Ma(C)?(i.exit("atxHeadingText"),E(C)):(i.consume(C),T)}}const Txe=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],dq=["pre","script","style","textarea"],wxe={concrete:!0,name:"htmlFlow",resolveTo:bxe,tokenize:Ixe},Cxe={partial:!0,tokenize:Oxe},Rxe={partial:!0,tokenize:Axe};function bxe(i){let n=i.length;for(;n--&&!(i[n][0]==="enter"&&i[n][1].type==="htmlFlow"););return n>1&&i[n-2][1].type==="linePrefix"&&(i[n][1].start=i[n-2][1].start,i[n+1][1].start=i[n-2][1].start,i.splice(n-2,2)),i}function Ixe(i,n,s){const a=this;let l,d,f,E,S;return T;function T(ue){return C(ue)}function C(ue){return i.enter("htmlFlow"),i.enter("htmlFlowData"),i.consume(ue),I}function I(ue){return ue===33?(i.consume(ue),N):ue===47?(i.consume(ue),d=!0,x):ue===63?(i.consume(ue),l=3,a.interrupt?n:re):md(ue)?(i.consume(ue),f=String.fromCharCode(ue),B):s(ue)}function N(ue){return ue===45?(i.consume(ue),l=2,P):ue===91?(i.consume(ue),l=5,E=0,W):md(ue)?(i.consume(ue),l=4,a.interrupt?n:re):s(ue)}function P(ue){return ue===45?(i.consume(ue),a.interrupt?n:re):s(ue)}function W(ue){const it="CDATA[";return ue===it.charCodeAt(E++)?(i.consume(ue),E===it.length?a.interrupt?n:ye:W):s(ue)}function x(ue){return md(ue)?(i.consume(ue),f=String.fromCharCode(ue),B):s(ue)}function B(ue){if(ue===null||ue===47||ue===62||Ma(ue)){const it=ue===47,yt=f.toLowerCase();return!it&&!d&&dq.includes(yt)?(l=1,a.interrupt?n(ue):ye(ue)):Txe.includes(f.toLowerCase())?(l=6,it?(i.consume(ue),X):a.interrupt?n(ue):ye(ue)):(l=7,a.interrupt&&!a.parser.lazy[a.now().line]?s(ue):d?Z(ue):$(ue))}return ue===45||fc(ue)?(i.consume(ue),f+=String.fromCharCode(ue),B):s(ue)}function X(ue){return ue===62?(i.consume(ue),a.interrupt?n:ye):s(ue)}function Z(ue){return Lr(ue)?(i.consume(ue),Z):De(ue)}function $(ue){return ue===47?(i.consume(ue),De):ue===58||ue===95||md(ue)?(i.consume(ue),ae):Lr(ue)?(i.consume(ue),$):De(ue)}function ae(ue){return ue===45||ue===46||ue===58||ue===95||fc(ue)?(i.consume(ue),ae):ce(ue)}function ce(ue){return ue===61?(i.consume(ue),le):Lr(ue)?(i.consume(ue),ce):$(ue)}function le(ue){return ue===null||ue===60||ue===61||ue===62||ue===96?s(ue):ue===34||ue===39?(i.consume(ue),S=ue,ne):Lr(ue)?(i.consume(ue),le):fe(ue)}function ne(ue){return ue===S?(i.consume(ue),S=null,Se):ue===null||wn(ue)?s(ue):(i.consume(ue),ne)}function fe(ue){return ue===null||ue===34||ue===39||ue===47||ue===60||ue===61||ue===62||ue===96||Ma(ue)?ce(ue):(i.consume(ue),fe)}function Se(ue){return ue===47||ue===62||Lr(ue)?$(ue):s(ue)}function De(ue){return ue===62?(i.consume(ue),be):s(ue)}function be(ue){return ue===null||wn(ue)?ye(ue):Lr(ue)?(i.consume(ue),be):s(ue)}function ye(ue){return ue===45&&l===2?(i.consume(ue),Je):ue===60&&l===1?(i.consume(ue),je):ue===62&&l===4?(i.consume(ue),ge):ue===63&&l===3?(i.consume(ue),re):ue===93&&l===5?(i.consume(ue),He):wn(ue)&&(l===6||l===7)?(i.exit("htmlFlowData"),i.check(Cxe,Oe,Ge)(ue)):ue===null||wn(ue)?(i.exit("htmlFlowData"),Ge(ue)):(i.consume(ue),ye)}function Ge(ue){return i.check(Rxe,Te,Oe)(ue)}function Te(ue){return i.enter("lineEnding"),i.consume(ue),i.exit("lineEnding"),Fe}function Fe(ue){return ue===null||wn(ue)?Ge(ue):(i.enter("htmlFlowData"),ye(ue))}function Je(ue){return ue===45?(i.consume(ue),re):ye(ue)}function je(ue){return ue===47?(i.consume(ue),f="",Ie):ye(ue)}function Ie(ue){if(ue===62){const it=f.toLowerCase();return dq.includes(it)?(i.consume(ue),ge):ye(ue)}return md(ue)&&f.length<8?(i.consume(ue),f+=String.fromCharCode(ue),Ie):ye(ue)}function He(ue){return ue===93?(i.consume(ue),re):ye(ue)}function re(ue){return ue===62?(i.consume(ue),ge):ue===45&&l===2?(i.consume(ue),re):ye(ue)}function ge(ue){return ue===null||wn(ue)?(i.exit("htmlFlowData"),Oe(ue)):(i.consume(ue),ge)}function Oe(ue){return i.exit("htmlFlow"),n(ue)}}function Axe(i,n,s){const a=this;return l;function l(f){return wn(f)?(i.enter("lineEnding"),i.consume(f),i.exit("lineEnding"),d):s(f)}function d(f){return a.parser.lazy[a.now().line]?s(f):n(f)}}function Oxe(i,n,s){return a;function a(l){return i.enter("lineEnding"),i.consume(l),i.exit("lineEnding"),i.attempt(rN,n,s)}}const Nxe={name:"htmlText",tokenize:Pxe};function Pxe(i,n,s){const a=this;let l,d,f;return E;function E(re){return i.enter("htmlText"),i.enter("htmlTextData"),i.consume(re),S}function S(re){return re===33?(i.consume(re),T):re===47?(i.consume(re),ce):re===63?(i.consume(re),$):md(re)?(i.consume(re),fe):s(re)}function T(re){return re===45?(i.consume(re),C):re===91?(i.consume(re),d=0,W):md(re)?(i.consume(re),Z):s(re)}function C(re){return re===45?(i.consume(re),P):s(re)}function I(re){return re===null?s(re):re===45?(i.consume(re),N):wn(re)?(f=I,je(re)):(i.consume(re),I)}function N(re){return re===45?(i.consume(re),P):I(re)}function P(re){return re===62?Je(re):re===45?N(re):I(re)}function W(re){const ge="CDATA[";return re===ge.charCodeAt(d++)?(i.consume(re),d===ge.length?x:W):s(re)}function x(re){return re===null?s(re):re===93?(i.consume(re),B):wn(re)?(f=x,je(re)):(i.consume(re),x)}function B(re){return re===93?(i.consume(re),X):x(re)}function X(re){return re===62?Je(re):re===93?(i.consume(re),X):x(re)}function Z(re){return re===null||re===62?Je(re):wn(re)?(f=Z,je(re)):(i.consume(re),Z)}function $(re){return re===null?s(re):re===63?(i.consume(re),ae):wn(re)?(f=$,je(re)):(i.consume(re),$)}function ae(re){return re===62?Je(re):$(re)}function ce(re){return md(re)?(i.consume(re),le):s(re)}function le(re){return re===45||fc(re)?(i.consume(re),le):ne(re)}function ne(re){return wn(re)?(f=ne,je(re)):Lr(re)?(i.consume(re),ne):Je(re)}function fe(re){return re===45||fc(re)?(i.consume(re),fe):re===47||re===62||Ma(re)?Se(re):s(re)}function Se(re){return re===47?(i.consume(re),Je):re===58||re===95||md(re)?(i.consume(re),De):wn(re)?(f=Se,je(re)):Lr(re)?(i.consume(re),Se):Je(re)}function De(re){return re===45||re===46||re===58||re===95||fc(re)?(i.consume(re),De):be(re)}function be(re){return re===61?(i.consume(re),ye):wn(re)?(f=be,je(re)):Lr(re)?(i.consume(re),be):Se(re)}function ye(re){return re===null||re===60||re===61||re===62||re===96?s(re):re===34||re===39?(i.consume(re),l=re,Ge):wn(re)?(f=ye,je(re)):Lr(re)?(i.consume(re),ye):(i.consume(re),Te)}function Ge(re){return re===l?(i.consume(re),l=void 0,Fe):re===null?s(re):wn(re)?(f=Ge,je(re)):(i.consume(re),Ge)}function Te(re){return re===null||re===34||re===39||re===60||re===61||re===96?s(re):re===47||re===62||Ma(re)?Se(re):(i.consume(re),Te)}function Fe(re){return re===47||re===62||Ma(re)?Se(re):s(re)}function Je(re){return re===62?(i.consume(re),i.exit("htmlTextData"),i.exit("htmlText"),n):s(re)}function je(re){return i.exit("htmlTextData"),i.enter("lineEnding"),i.consume(re),i.exit("lineEnding"),Ie}function Ie(re){return Lr(re)?Ei(i,He,"linePrefix",a.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(re):He(re)}function He(re){return i.enter("htmlTextData"),f(re)}}const vV={name:"labelEnd",resolveAll:Lxe,resolveTo:Mxe,tokenize:Uxe},kxe={tokenize:Vxe},Dxe={tokenize:Fxe},xxe={tokenize:jxe};function Lxe(i){let n=-1;const s=[];for(;++n<i.length;){const a=i[n][1];if(s.push(i[n]),a.type==="labelImage"||a.type==="labelLink"||a.type==="labelEnd"){const l=a.type==="labelImage"?4:2;a.type="data",n+=l}}return i.length!==s.length&&Ad(i,0,i.length,s),i}function Mxe(i,n){let s=i.length,a=0,l,d,f,E;for(;s--;)if(l=i[s][1],d){if(l.type==="link"||l.type==="labelLink"&&l._inactive)break;i[s][0]==="enter"&&l.type==="labelLink"&&(l._inactive=!0)}else if(f){if(i[s][0]==="enter"&&(l.type==="labelImage"||l.type==="labelLink")&&!l._balanced&&(d=s,l.type!=="labelLink")){a=2;break}}else l.type==="labelEnd"&&(f=s);const S={type:i[d][1].type==="labelLink"?"link":"image",start:{...i[d][1].start},end:{...i[i.length-1][1].end}},T={type:"label",start:{...i[d][1].start},end:{...i[f][1].end}},C={type:"labelText",start:{...i[d+a+2][1].end},end:{...i[f-2][1].start}};return E=[["enter",S,n],["enter",T,n]],E=il(E,i.slice(d+1,d+a+3)),E=il(E,[["enter",C,n]]),E=il(E,yV(n.parser.constructs.insideSpan.null,i.slice(d+a+4,f-3),n)),E=il(E,[["exit",C,n],i[f-2],i[f-1],["exit",T,n]]),E=il(E,i.slice(f+1)),E=il(E,[["exit",S,n]]),Ad(i,d,i.length,E),i}function Uxe(i,n,s){const a=this;let l=a.events.length,d,f;for(;l--;)if((a.events[l][1].type==="labelImage"||a.events[l][1].type==="labelLink")&&!a.events[l][1]._balanced){d=a.events[l][1];break}return E;function E(N){return d?d._inactive?I(N):(f=a.parser.defined.includes(Yy(a.sliceSerialize({start:d.end,end:a.now()}))),i.enter("labelEnd"),i.enter("labelMarker"),i.consume(N),i.exit("labelMarker"),i.exit("labelEnd"),S):s(N)}function S(N){return N===40?i.attempt(kxe,C,f?C:I)(N):N===91?i.attempt(Dxe,C,f?T:I)(N):f?C(N):I(N)}function T(N){return i.attempt(xxe,C,I)(N)}function C(N){return n(N)}function I(N){return d._balanced=!0,s(N)}}function Vxe(i,n,s){return a;function a(I){return i.enter("resource"),i.enter("resourceMarker"),i.consume(I),i.exit("resourceMarker"),l}function l(I){return Ma(I)?sw(i,d)(I):d(I)}function d(I){return I===41?C(I):Wte(i,f,E,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(I)}function f(I){return Ma(I)?sw(i,S)(I):C(I)}function E(I){return s(I)}function S(I){return I===34||I===39||I===40?Hte(i,T,s,"resourceTitle","resourceTitleMarker","resourceTitleString")(I):C(I)}function T(I){return Ma(I)?sw(i,C)(I):C(I)}function C(I){return I===41?(i.enter("resourceMarker"),i.consume(I),i.exit("resourceMarker"),i.exit("resource"),n):s(I)}}function Fxe(i,n,s){const a=this;return l;function l(E){return Gte.call(a,i,d,f,"reference","referenceMarker","referenceString")(E)}function d(E){return a.parser.defined.includes(Yy(a.sliceSerialize(a.events[a.events.length-1][1]).slice(1,-1)))?n(E):s(E)}function f(E){return s(E)}}function jxe(i,n,s){return a;function a(d){return i.enter("reference"),i.enter("referenceMarker"),i.consume(d),i.exit("referenceMarker"),l}function l(d){return d===93?(i.enter("referenceMarker"),i.consume(d),i.exit("referenceMarker"),i.exit("reference"),n):s(d)}}const Bxe={name:"labelStartImage",resolveAll:vV.resolveAll,tokenize:Wxe};function Wxe(i,n,s){const a=this;return l;function l(E){return i.enter("labelImage"),i.enter("labelImageMarker"),i.consume(E),i.exit("labelImageMarker"),d}function d(E){return E===91?(i.enter("labelMarker"),i.consume(E),i.exit("labelMarker"),i.exit("labelImage"),f):s(E)}function f(E){return E===94&&"_hiddenFootnoteSupport"in a.parser.constructs?s(E):n(E)}}const Gxe={name:"labelStartLink",resolveAll:vV.resolveAll,tokenize:Hxe};function Hxe(i,n,s){const a=this;return l;function l(f){return i.enter("labelLink"),i.enter("labelMarker"),i.consume(f),i.exit("labelMarker"),i.exit("labelLink"),d}function d(f){return f===94&&"_hiddenFootnoteSupport"in a.parser.constructs?s(f):n(f)}}const PL={name:"lineEnding",tokenize:zxe};function zxe(i,n){return s;function s(a){return i.enter("lineEnding"),i.consume(a),i.exit("lineEnding"),Ei(i,n,"linePrefix")}}const xA={name:"thematicBreak",tokenize:Kxe};function Kxe(i,n,s){let a=0,l;return d;function d(T){return i.enter("thematicBreak"),f(T)}function f(T){return l=T,E(T)}function E(T){return T===l?(i.enter("thematicBreakSequence"),S(T)):a>=3&&(T===null||wn(T))?(i.exit("thematicBreak"),n(T)):s(T)}function S(T){return T===l?(i.consume(T),a++,S):(i.exit("thematicBreakSequence"),Lr(T)?Ei(i,E,"whitespace")(T):E(T))}}const ba={continuation:{tokenize:Jxe},exit:Qxe,name:"list",tokenize:Xxe},Yxe={partial:!0,tokenize:Zxe},qxe={partial:!0,tokenize:$xe};function Xxe(i,n,s){const a=this,l=a.events[a.events.length-1];let d=l&&l[1].type==="linePrefix"?l[2].sliceSerialize(l[1],!0).length:0,f=0;return E;function E(P){const W=a.containerState.type||(P===42||P===43||P===45?"listUnordered":"listOrdered");if(W==="listUnordered"?!a.containerState.marker||P===a.containerState.marker:p2(P)){if(a.containerState.type||(a.containerState.type=W,i.enter(W,{_container:!0})),W==="listUnordered")return i.enter("listItemPrefix"),P===42||P===45?i.check(xA,s,T)(P):T(P);if(!a.interrupt||P===49)return i.enter("listItemPrefix"),i.enter("listItemValue"),S(P)}return s(P)}function S(P){return p2(P)&&++f<10?(i.consume(P),S):(!a.interrupt||f<2)&&(a.containerState.marker?P===a.containerState.marker:P===41||P===46)?(i.exit("listItemValue"),T(P)):s(P)}function T(P){return i.enter("listItemMarker"),i.consume(P),i.exit("listItemMarker"),a.containerState.marker=a.containerState.marker||P,i.check(rN,a.interrupt?s:C,i.attempt(Yxe,N,I))}function C(P){return a.containerState.initialBlankLine=!0,d++,N(P)}function I(P){return Lr(P)?(i.enter("listItemPrefixWhitespace"),i.consume(P),i.exit("listItemPrefixWhitespace"),N):s(P)}function N(P){return a.containerState.size=d+a.sliceSerialize(i.exit("listItemPrefix"),!0).length,n(P)}}function Jxe(i,n,s){const a=this;return a.containerState._closeFlow=void 0,i.check(rN,l,d);function l(E){return a.containerState.furtherBlankLines=a.containerState.furtherBlankLines||a.containerState.initialBlankLine,Ei(i,n,"listItemIndent",a.containerState.size+1)(E)}function d(E){return a.containerState.furtherBlankLines||!Lr(E)?(a.containerState.furtherBlankLines=void 0,a.containerState.initialBlankLine=void 0,f(E)):(a.containerState.furtherBlankLines=void 0,a.containerState.initialBlankLine=void 0,i.attempt(qxe,n,f)(E))}function f(E){return a.containerState._closeFlow=!0,a.interrupt=void 0,Ei(i,i.attempt(ba,n,s),"linePrefix",a.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(E)}}function $xe(i,n,s){const a=this;return Ei(i,l,"listItemIndent",a.containerState.size+1);function l(d){const f=a.events[a.events.length-1];return f&&f[1].type==="listItemIndent"&&f[2].sliceSerialize(f[1],!0).length===a.containerState.size?n(d):s(d)}}function Qxe(i){i.exit(this.containerState.type)}function Zxe(i,n,s){const a=this;return Ei(i,l,"listItemPrefixWhitespace",a.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function l(d){const f=a.events[a.events.length-1];return!Lr(d)&&f&&f[1].type==="listItemPrefixWhitespace"?n(d):s(d)}}const hq={name:"setextUnderline",resolveTo:eLe,tokenize:tLe};function eLe(i,n){let s=i.length,a,l,d;for(;s--;)if(i[s][0]==="enter"){if(i[s][1].type==="content"){a=s;break}i[s][1].type==="paragraph"&&(l=s)}else i[s][1].type==="content"&&i.splice(s,1),!d&&i[s][1].type==="definition"&&(d=s);const f={type:"setextHeading",start:{...i[a][1].start},end:{...i[i.length-1][1].end}};return i[l][1].type="setextHeadingText",d?(i.splice(l,0,["enter",f,n]),i.splice(d+1,0,["exit",i[a][1],n]),i[a][1].end={...i[d][1].end}):i[a][1]=f,i.push(["exit",f,n]),i}function tLe(i,n,s){const a=this;let l;return d;function d(T){let C=a.events.length,I;for(;C--;)if(a.events[C][1].type!=="lineEnding"&&a.events[C][1].type!=="linePrefix"&&a.events[C][1].type!=="content"){I=a.events[C][1].type==="paragraph";break}return!a.parser.lazy[a.now().line]&&(a.interrupt||I)?(i.enter("setextHeadingLine"),l=T,f(T)):s(T)}function f(T){return i.enter("setextHeadingLineSequence"),E(T)}function E(T){return T===l?(i.consume(T),E):(i.exit("setextHeadingLineSequence"),Lr(T)?Ei(i,S,"lineSuffix")(T):S(T))}function S(T){return T===null||wn(T)?(i.exit("setextHeadingLine"),n(T)):s(T)}}const nLe={tokenize:rLe};function rLe(i){const n=this,s=i.attempt(rN,a,i.attempt(this.parser.constructs.flowInitial,l,Ei(i,i.attempt(this.parser.constructs.flow,l,i.attempt(cxe,l)),"linePrefix")));return s;function a(d){if(d===null){i.consume(d);return}return i.enter("lineEndingBlank"),i.consume(d),i.exit("lineEndingBlank"),n.currentConstruct=void 0,s}function l(d){if(d===null){i.consume(d);return}return i.enter("lineEnding"),i.consume(d),i.exit("lineEnding"),n.currentConstruct=void 0,s}}const iLe={resolveAll:Kte()},sLe=zte("string"),oLe=zte("text");function zte(i){return{resolveAll:Kte(i==="text"?aLe:void 0),tokenize:n};function n(s){const a=this,l=this.parser.constructs[i],d=s.attempt(l,f,E);return f;function f(C){return T(C)?d(C):E(C)}function E(C){if(C===null){s.consume(C);return}return s.enter("data"),s.consume(C),S}function S(C){return T(C)?(s.exit("data"),d(C)):(s.consume(C),S)}function T(C){if(C===null)return!0;const I=l[C];let N=-1;if(I)for(;++N<I.length;){const P=I[N];if(!P.previous||P.previous.call(a,a.previous))return!0}return!1}}}function Kte(i){return n;function n(s,a){let l=-1,d;for(;++l<=s.length;)d===void 0?s[l]&&s[l][1].type==="data"&&(d=l,l++):(!s[l]||s[l][1].type!=="data")&&(l!==d+2&&(s[d][1].end=s[l-1][1].end,s.splice(d+2,l-d-2),l=d+2),d=void 0);return i?i(s,a):s}}function aLe(i,n){let s=0;for(;++s<=i.length;)if((s===i.length||i[s][1].type==="lineEnding")&&i[s-1][1].type==="data"){const a=i[s-1][1],l=n.sliceStream(a);let d=l.length,f=-1,E=0,S;for(;d--;){const T=l[d];if(typeof T=="string"){for(f=T.length;T.charCodeAt(f-1)===32;)E++,f--;if(f)break;f=-1}else if(T===-2)S=!0,E++;else if(T!==-1){d++;break}}if(n._contentTypeTextTrailing&&s===i.length&&(E=0),E){const T={type:s===i.length||S||E<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:d?f:a.start._bufferIndex+f,_index:a.start._index+d,line:a.end.line,column:a.end.column-E,offset:a.end.offset-E},end:{...a.end}};a.end={...T.start},a.start.offset===a.end.offset?Object.assign(a,T):(i.splice(s,0,["enter",T,n],["exit",T,n]),s+=2)}s++}return i}const cLe={42:ba,43:ba,45:ba,48:ba,49:ba,50:ba,51:ba,52:ba,53:ba,54:ba,55:ba,56:ba,57:ba,62:Vte},lLe={91:pxe},uLe={[-2]:NL,[-1]:NL,32:NL},dLe={35:yxe,42:xA,45:[hq,xA],60:wxe,61:hq,95:xA,96:uq,126:uq},hLe={38:jte,92:Fte},pLe={[-5]:PL,[-4]:PL,[-3]:PL,33:Bxe,38:jte,42:f2,60:[GDe,Nxe],91:Gxe,92:[_xe,Fte],93:vV,95:f2,96:nxe},fLe={null:[f2,iLe]},mLe={null:[42,95]},gLe={null:[]},_Le=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:mLe,contentInitial:lLe,disable:gLe,document:cLe,flow:dLe,flowInitial:uLe,insideSpan:fLe,string:hLe,text:pLe},Symbol.toStringTag,{value:"Module"}));function ELe(i,n,s){let a={_bufferIndex:-1,_index:0,line:s&&s.line||1,column:s&&s.column||1,offset:s&&s.offset||0};const l={},d=[];let f=[],E=[];const S={attempt:ne(ce),check:ne(le),consume:Z,enter:$,exit:ae,interrupt:ne(le,{interrupt:!0})},T={code:null,containerState:{},defineSkip:x,events:[],now:W,parser:i,previous:null,sliceSerialize:N,sliceStream:P,write:I};let C=n.tokenize.call(T,S);return n.resolveAll&&d.push(n),T;function I(be){return f=il(f,be),B(),f[f.length-1]!==null?[]:(fe(n,0),T.events=yV(d,T.events,T),T.events)}function N(be,ye){return vLe(P(be),ye)}function P(be){return yLe(f,be)}function W(){const{_bufferIndex:be,_index:ye,line:Ge,column:Te,offset:Fe}=a;return{_bufferIndex:be,_index:ye,line:Ge,column:Te,offset:Fe}}function x(be){l[be.line]=be.column,De()}function B(){let be;for(;a._index<f.length;){const ye=f[a._index];if(typeof ye=="string")for(be=a._index,a._bufferIndex<0&&(a._bufferIndex=0);a._index===be&&a._bufferIndex<ye.length;)X(ye.charCodeAt(a._bufferIndex));else X(ye)}}function X(be){C=C(be)}function Z(be){wn(be)?(a.line++,a.column=1,a.offset+=be===-3?2:1,De()):be!==-1&&(a.column++,a.offset++),a._bufferIndex<0?a._index++:(a._bufferIndex++,a._bufferIndex===f[a._index].length&&(a._bufferIndex=-1,a._index++)),T.previous=be}function $(be,ye){const Ge=ye||{};return Ge.type=be,Ge.start=W(),T.events.push(["enter",Ge,T]),E.push(Ge),Ge}function ae(be){const ye=E.pop();return ye.end=W(),T.events.push(["exit",ye,T]),ye}function ce(be,ye){fe(be,ye.from)}function le(be,ye){ye.restore()}function ne(be,ye){return Ge;function Ge(Te,Fe,Je){let je,Ie,He,re;return Array.isArray(Te)?Oe(Te):"tokenize"in Te?Oe([Te]):ge(Te);function ge(Dt){return At;function At(dn){const Cn=dn!==null&&Dt[dn],fr=dn!==null&&Dt.null,as=[...Array.isArray(Cn)?Cn:Cn?[Cn]:[],...Array.isArray(fr)?fr:fr?[fr]:[]];return Oe(as)(dn)}}function Oe(Dt){return je=Dt,Ie=0,Dt.length===0?Je:ue(Dt[Ie])}function ue(Dt){return At;function At(dn){return re=Se(),He=Dt,Dt.partial||(T.currentConstruct=Dt),Dt.name&&T.parser.constructs.disable.null.includes(Dt.name)?yt():Dt.tokenize.call(ye?Object.assign(Object.create(T),ye):T,S,it,yt)(dn)}}function it(Dt){return be(He,re),Fe}function yt(Dt){return re.restore(),++Ie<je.length?ue(je[Ie]):Je}}}function fe(be,ye){be.resolveAll&&!d.includes(be)&&d.push(be),be.resolve&&Ad(T.events,ye,T.events.length-ye,be.resolve(T.events.slice(ye),T)),be.resolveTo&&(T.events=be.resolveTo(T.events,T))}function Se(){const be=W(),ye=T.previous,Ge=T.currentConstruct,Te=T.events.length,Fe=Array.from(E);return{from:Te,restore:Je};function Je(){a=be,T.previous=ye,T.currentConstruct=Ge,T.events.length=Te,E=Fe,De()}}function De(){a.line in l&&a.column<2&&(a.column=l[a.line],a.offset+=l[a.line]-1)}}function yLe(i,n){const s=n.start._index,a=n.start._bufferIndex,l=n.end._index,d=n.end._bufferIndex;let f;if(s===l)f=[i[s].slice(a,d)];else{if(f=i.slice(s,l),a>-1){const E=f[0];typeof E=="string"?f[0]=E.slice(a):f.shift()}d>0&&f.push(i[l].slice(0,d))}return f}function vLe(i,n){let s=-1;const a=[];let l;for(;++s<i.length;){const d=i[s];let f;if(typeof d=="string")f=d;else switch(d){case-5:{f="\r";break}case-4:{f=`
`;break}case-3:{f=`\r
`;break}case-2:{f=n?" ":"	";break}case-1:{if(!n&&l)continue;f=" ";break}default:f=String.fromCharCode(d)}l=d===-2,a.push(f)}return a.join("")}function SLe(i){const a={constructs:ADe([_Le,...(i||{}).extensions||[]]),content:l(MDe),defined:[],document:l(VDe),flow:l(nLe),lazy:{},string:l(sLe),text:l(oLe)};return a;function l(d){return f;function f(E){return ELe(a,d,E)}}}function TLe(i){for(;!Bte(i););return i}const pq=/[\0\t\n\r]/g;function wLe(){let i=1,n="",s=!0,a;return l;function l(d,f,E){const S=[];let T,C,I,N,P;for(d=n+(typeof d=="string"?d.toString():new TextDecoder(f||void 0).decode(d)),I=0,n="",s&&(d.charCodeAt(0)===65279&&I++,s=void 0);I<d.length;){if(pq.lastIndex=I,T=pq.exec(d),N=T&&T.index!==void 0?T.index:d.length,P=d.charCodeAt(N),!T){n=d.slice(I);break}if(P===10&&I===N&&a)S.push(-3),a=void 0;else switch(a&&(S.push(-5),a=void 0),I<N&&(S.push(d.slice(I,N)),i+=N-I),P){case 0:{S.push(65533),i++;break}case 9:{for(C=Math.ceil(i/4)*4,S.push(-2);i++<C;)S.push(-1);break}case 10:{S.push(-4),i=1;break}default:a=!0,i=1}I=N+1}return E&&(a&&S.push(-5),n&&S.push(n),S.push(null)),S}}const CLe=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function RLe(i){return i.replace(CLe,bLe)}function bLe(i,n,s){if(n)return n;if(s.charCodeAt(0)===35){const l=s.charCodeAt(1),d=l===120||l===88;return Ute(s.slice(d?2:1),d?16:10)}return EV(s)||i}const Yte={}.hasOwnProperty;function ILe(i,n,s){return typeof n!="string"&&(s=n,n=void 0),ALe(s)(TLe(SLe(s).document().write(wLe()(i,n,!0))))}function ALe(i){const n={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:d(fi),autolinkProtocol:Se,autolinkEmail:Se,atxHeading:d(fl),blockQuote:d(fr),characterEscape:Se,characterReference:Se,codeFenced:d(as),codeFencedFenceInfo:f,codeFencedFenceMeta:f,codeIndented:d(as,f),codeText:d(Jr,f),codeTextData:Se,data:Se,codeFlowValue:Se,definition:d(Mr),definitionDestinationString:f,definitionLabelString:f,definitionTitleString:f,emphasis:d(wc),hardBreakEscape:d(yi),hardBreakTrailing:d(yi),htmlFlow:d(Cc,f),htmlFlowData:Se,htmlText:d(Cc,f),htmlTextData:Se,image:d(Wr),label:f,link:d(fi),listItem:d(gs),listItemValue:N,listOrdered:d($s,I),listUnordered:d($s),paragraph:d(Rc),reference:ue,referenceString:f,resourceDestinationString:f,resourceTitleString:f,setextHeading:d(fl),strong:d(Qs),thematicBreak:d(Fo)},exit:{atxHeading:S(),atxHeadingSequence:ce,autolink:S(),autolinkEmail:Cn,autolinkProtocol:dn,blockQuote:S(),characterEscapeValue:De,characterReferenceMarkerHexadecimal:yt,characterReferenceMarkerNumeric:yt,characterReferenceValue:Dt,characterReference:At,codeFenced:S(B),codeFencedFence:x,codeFencedFenceInfo:P,codeFencedFenceMeta:W,codeFlowValue:De,codeIndented:S(X),codeText:S(Fe),codeTextData:De,data:De,definition:S(),definitionDestinationString:ae,definitionLabelString:Z,definitionTitleString:$,emphasis:S(),hardBreakEscape:S(ye),hardBreakTrailing:S(ye),htmlFlow:S(Ge),htmlFlowData:De,htmlText:S(Te),htmlTextData:De,image:S(je),label:He,labelText:Ie,lineEnding:be,link:S(Je),listItem:S(),listOrdered:S(),listUnordered:S(),paragraph:S(),referenceString:it,resourceDestinationString:re,resourceTitleString:ge,resource:Oe,setextHeading:S(fe),setextHeadingLineSequence:ne,setextHeadingText:le,strong:S(),thematicBreak:S()}};qte(n,(i||{}).mdastExtensions||[]);const s={};return a;function a(Xe){let lt={type:"root",children:[]};const Kt={stack:[lt],tokenStack:[],config:n,enter:E,exit:T,buffer:f,resume:C,data:s},an=[];let Nn=-1;for(;++Nn<Xe.length;)if(Xe[Nn][1].type==="listOrdered"||Xe[Nn][1].type==="listUnordered")if(Xe[Nn][0]==="enter")an.push(Nn);else{const ii=an.pop();Nn=l(Xe,ii,Nn)}for(Nn=-1;++Nn<Xe.length;){const ii=n[Xe[Nn][0]];Yte.call(ii,Xe[Nn][1].type)&&ii[Xe[Nn][1].type].call(Object.assign({sliceSerialize:Xe[Nn][2].sliceSerialize},Kt),Xe[Nn][1])}if(Kt.tokenStack.length>0){const ii=Kt.tokenStack[Kt.tokenStack.length-1];(ii[1]||fq).call(Kt,void 0,ii[0])}for(lt.position={start:Wp(Xe.length>0?Xe[0][1].start:{line:1,column:1,offset:0}),end:Wp(Xe.length>0?Xe[Xe.length-2][1].end:{line:1,column:1,offset:0})},Nn=-1;++Nn<n.transforms.length;)lt=n.transforms[Nn](lt)||lt;return lt}function l(Xe,lt,Kt){let an=lt-1,Nn=-1,ii=!1,Zs,$r,mi,Eo;for(;++an<=Kt;){const Gr=Xe[an];switch(Gr[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{Gr[0]==="enter"?Nn++:Nn--,Eo=void 0;break}case"lineEndingBlank":{Gr[0]==="enter"&&(Zs&&!Eo&&!Nn&&!mi&&(mi=an),Eo=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:Eo=void 0}if(!Nn&&Gr[0]==="enter"&&Gr[1].type==="listItemPrefix"||Nn===-1&&Gr[0]==="exit"&&(Gr[1].type==="listUnordered"||Gr[1].type==="listOrdered")){if(Zs){let yo=an;for($r=void 0;yo--;){const vi=Xe[yo];if(vi[1].type==="lineEnding"||vi[1].type==="lineEndingBlank"){if(vi[0]==="exit")continue;$r&&(Xe[$r][1].type="lineEndingBlank",ii=!0),vi[1].type="lineEnding",$r=yo}else if(!(vi[1].type==="linePrefix"||vi[1].type==="blockQuotePrefix"||vi[1].type==="blockQuotePrefixWhitespace"||vi[1].type==="blockQuoteMarker"||vi[1].type==="listItemIndent"))break}mi&&(!$r||mi<$r)&&(Zs._spread=!0),Zs.end=Object.assign({},$r?Xe[$r][1].start:Gr[1].end),Xe.splice($r||an,0,["exit",Zs,Gr[2]]),an++,Kt++}if(Gr[1].type==="listItemPrefix"){const yo={type:"listItem",_spread:!1,start:Object.assign({},Gr[1].start),end:void 0};Zs=yo,Xe.splice(an,0,["enter",yo,Gr[2]]),an++,Kt++,mi=void 0,Eo=!0}}}return Xe[lt][1]._spread=ii,Kt}function d(Xe,lt){return Kt;function Kt(an){E.call(this,Xe(an),an),lt&&lt.call(this,an)}}function f(){this.stack.push({type:"fragment",children:[]})}function E(Xe,lt,Kt){this.stack[this.stack.length-1].children.push(Xe),this.stack.push(Xe),this.tokenStack.push([lt,Kt||void 0]),Xe.position={start:Wp(lt.start),end:void 0}}function S(Xe){return lt;function lt(Kt){Xe&&Xe.call(this,Kt),T.call(this,Kt)}}function T(Xe,lt){const Kt=this.stack.pop(),an=this.tokenStack.pop();if(an)an[0].type!==Xe.type&&(lt?lt.call(this,Xe,an[0]):(an[1]||fq).call(this,Xe,an[0]));else throw new Error("Cannot close `"+Xe.type+"` ("+iw({start:Xe.start,end:Xe.end})+"): its not open");Kt.position.end=Wp(Xe.end)}function C(){return bDe(this.stack.pop())}function I(){this.data.expectingFirstListItemValue=!0}function N(Xe){if(this.data.expectingFirstListItemValue){const lt=this.stack[this.stack.length-2];lt.start=Number.parseInt(this.sliceSerialize(Xe),10),this.data.expectingFirstListItemValue=void 0}}function P(){const Xe=this.resume(),lt=this.stack[this.stack.length-1];lt.lang=Xe}function W(){const Xe=this.resume(),lt=this.stack[this.stack.length-1];lt.meta=Xe}function x(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function B(){const Xe=this.resume(),lt=this.stack[this.stack.length-1];lt.value=Xe.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function X(){const Xe=this.resume(),lt=this.stack[this.stack.length-1];lt.value=Xe.replace(/(\r?\n|\r)$/g,"")}function Z(Xe){const lt=this.resume(),Kt=this.stack[this.stack.length-1];Kt.label=lt,Kt.identifier=Yy(this.sliceSerialize(Xe)).toLowerCase()}function $(){const Xe=this.resume(),lt=this.stack[this.stack.length-1];lt.title=Xe}function ae(){const Xe=this.resume(),lt=this.stack[this.stack.length-1];lt.url=Xe}function ce(Xe){const lt=this.stack[this.stack.length-1];if(!lt.depth){const Kt=this.sliceSerialize(Xe).length;lt.depth=Kt}}function le(){this.data.setextHeadingSlurpLineEnding=!0}function ne(Xe){const lt=this.stack[this.stack.length-1];lt.depth=this.sliceSerialize(Xe).codePointAt(0)===61?1:2}function fe(){this.data.setextHeadingSlurpLineEnding=void 0}function Se(Xe){const Kt=this.stack[this.stack.length-1].children;let an=Kt[Kt.length-1];(!an||an.type!=="text")&&(an=Ir(),an.position={start:Wp(Xe.start),end:void 0},Kt.push(an)),this.stack.push(an)}function De(Xe){const lt=this.stack.pop();lt.value+=this.sliceSerialize(Xe),lt.position.end=Wp(Xe.end)}function be(Xe){const lt=this.stack[this.stack.length-1];if(this.data.atHardBreak){const Kt=lt.children[lt.children.length-1];Kt.position.end=Wp(Xe.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&n.canContainEols.includes(lt.type)&&(Se.call(this,Xe),De.call(this,Xe))}function ye(){this.data.atHardBreak=!0}function Ge(){const Xe=this.resume(),lt=this.stack[this.stack.length-1];lt.value=Xe}function Te(){const Xe=this.resume(),lt=this.stack[this.stack.length-1];lt.value=Xe}function Fe(){const Xe=this.resume(),lt=this.stack[this.stack.length-1];lt.value=Xe}function Je(){const Xe=this.stack[this.stack.length-1];if(this.data.inReference){const lt=this.data.referenceType||"shortcut";Xe.type+="Reference",Xe.referenceType=lt,delete Xe.url,delete Xe.title}else delete Xe.identifier,delete Xe.label;this.data.referenceType=void 0}function je(){const Xe=this.stack[this.stack.length-1];if(this.data.inReference){const lt=this.data.referenceType||"shortcut";Xe.type+="Reference",Xe.referenceType=lt,delete Xe.url,delete Xe.title}else delete Xe.identifier,delete Xe.label;this.data.referenceType=void 0}function Ie(Xe){const lt=this.sliceSerialize(Xe),Kt=this.stack[this.stack.length-2];Kt.label=RLe(lt),Kt.identifier=Yy(lt).toLowerCase()}function He(){const Xe=this.stack[this.stack.length-1],lt=this.resume(),Kt=this.stack[this.stack.length-1];if(this.data.inReference=!0,Kt.type==="link"){const an=Xe.children;Kt.children=an}else Kt.alt=lt}function re(){const Xe=this.resume(),lt=this.stack[this.stack.length-1];lt.url=Xe}function ge(){const Xe=this.resume(),lt=this.stack[this.stack.length-1];lt.title=Xe}function Oe(){this.data.inReference=void 0}function ue(){this.data.referenceType="collapsed"}function it(Xe){const lt=this.resume(),Kt=this.stack[this.stack.length-1];Kt.label=lt,Kt.identifier=Yy(this.sliceSerialize(Xe)).toLowerCase(),this.data.referenceType="full"}function yt(Xe){this.data.characterReferenceType=Xe.type}function Dt(Xe){const lt=this.sliceSerialize(Xe),Kt=this.data.characterReferenceType;let an;Kt?(an=Ute(lt,Kt==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):an=EV(lt);const Nn=this.stack[this.stack.length-1];Nn.value+=an}function At(Xe){const lt=this.stack.pop();lt.position.end=Wp(Xe.end)}function dn(Xe){De.call(this,Xe);const lt=this.stack[this.stack.length-1];lt.url=this.sliceSerialize(Xe)}function Cn(Xe){De.call(this,Xe);const lt=this.stack[this.stack.length-1];lt.url="mailto:"+this.sliceSerialize(Xe)}function fr(){return{type:"blockquote",children:[]}}function as(){return{type:"code",lang:null,meta:null,value:""}}function Jr(){return{type:"inlineCode",value:""}}function Mr(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function wc(){return{type:"emphasis",children:[]}}function fl(){return{type:"heading",depth:0,children:[]}}function yi(){return{type:"break"}}function Cc(){return{type:"html",value:""}}function Wr(){return{type:"image",title:null,url:"",alt:null}}function fi(){return{type:"link",title:null,url:"",children:[]}}function $s(Xe){return{type:"list",ordered:Xe.type==="listOrdered",start:null,spread:Xe._spread,children:[]}}function gs(Xe){return{type:"listItem",spread:Xe._spread,checked:null,children:[]}}function Rc(){return{type:"paragraph",children:[]}}function Qs(){return{type:"strong",children:[]}}function Ir(){return{type:"text",value:""}}function Fo(){return{type:"thematicBreak"}}}function Wp(i){return{line:i.line,column:i.column,offset:i.offset}}function qte(i,n){let s=-1;for(;++s<n.length;){const a=n[s];Array.isArray(a)?qte(i,a):OLe(i,a)}}function OLe(i,n){let s;for(s in n)if(Yte.call(n,s))switch(s){case"canContainEols":{const a=n[s];a&&i[s].push(...a);break}case"transforms":{const a=n[s];a&&i[s].push(...a);break}case"enter":case"exit":{const a=n[s];a&&Object.assign(i[s],a);break}}}function fq(i,n){throw i?new Error("Cannot close `"+i.type+"` ("+iw({start:i.start,end:i.end})+"): a different token (`"+n.type+"`, "+iw({start:n.start,end:n.end})+") is open"):new Error("Cannot close document, a token (`"+n.type+"`, "+iw({start:n.start,end:n.end})+") is still open")}function NLe(i){const n=this;n.parser=s;function s(a){return ILe(a,{...n.data("settings"),...i,extensions:n.data("micromarkExtensions")||[],mdastExtensions:n.data("fromMarkdownExtensions")||[]})}}function PLe(i,n){const s={type:"element",tagName:"blockquote",properties:{},children:i.wrap(i.all(n),!0)};return i.patch(n,s),i.applyData(n,s)}function kLe(i,n){const s={type:"element",tagName:"br",properties:{},children:[]};return i.patch(n,s),[i.applyData(n,s),{type:"text",value:`
`}]}function DLe(i,n){const s=n.value?n.value+`
`:"",a={},l=n.lang?n.lang.split(/\s+/):[];l.length>0&&(a.className=["language-"+l[0]]);let d={type:"element",tagName:"code",properties:a,children:[{type:"text",value:s}]};return n.meta&&(d.data={meta:n.meta}),i.patch(n,d),d=i.applyData(n,d),d={type:"element",tagName:"pre",properties:{},children:[d]},i.patch(n,d),d}function xLe(i,n){const s={type:"element",tagName:"del",properties:{},children:i.all(n)};return i.patch(n,s),i.applyData(n,s)}function LLe(i,n){const s={type:"element",tagName:"em",properties:{},children:i.all(n)};return i.patch(n,s),i.applyData(n,s)}function MLe(i,n){const s=typeof i.options.clobberPrefix=="string"?i.options.clobberPrefix:"user-content-",a=String(n.identifier).toUpperCase(),l=Sv(a.toLowerCase()),d=i.footnoteOrder.indexOf(a);let f,E=i.footnoteCounts.get(a);E===void 0?(E=0,i.footnoteOrder.push(a),f=i.footnoteOrder.length):f=d+1,E+=1,i.footnoteCounts.set(a,E);const S={type:"element",tagName:"a",properties:{href:"#"+s+"fn-"+l,id:s+"fnref-"+l+(E>1?"-"+E:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(f)}]};i.patch(n,S);const T={type:"element",tagName:"sup",properties:{},children:[S]};return i.patch(n,T),i.applyData(n,T)}function ULe(i,n){const s={type:"element",tagName:"h"+n.depth,properties:{},children:i.all(n)};return i.patch(n,s),i.applyData(n,s)}function VLe(i,n){if(i.options.allowDangerousHtml){const s={type:"raw",value:n.value};return i.patch(n,s),i.applyData(n,s)}}function Xte(i,n){const s=n.referenceType;let a="]";if(s==="collapsed"?a+="[]":s==="full"&&(a+="["+(n.label||n.identifier)+"]"),n.type==="imageReference")return[{type:"text",value:"!["+n.alt+a}];const l=i.all(n),d=l[0];d&&d.type==="text"?d.value="["+d.value:l.unshift({type:"text",value:"["});const f=l[l.length-1];return f&&f.type==="text"?f.value+=a:l.push({type:"text",value:a}),l}function FLe(i,n){const s=String(n.identifier).toUpperCase(),a=i.definitionById.get(s);if(!a)return Xte(i,n);const l={src:Sv(a.url||""),alt:n.alt};a.title!==null&&a.title!==void 0&&(l.title=a.title);const d={type:"element",tagName:"img",properties:l,children:[]};return i.patch(n,d),i.applyData(n,d)}function jLe(i,n){const s={src:Sv(n.url)};n.alt!==null&&n.alt!==void 0&&(s.alt=n.alt),n.title!==null&&n.title!==void 0&&(s.title=n.title);const a={type:"element",tagName:"img",properties:s,children:[]};return i.patch(n,a),i.applyData(n,a)}function BLe(i,n){const s={type:"text",value:n.value.replace(/\r?\n|\r/g," ")};i.patch(n,s);const a={type:"element",tagName:"code",properties:{},children:[s]};return i.patch(n,a),i.applyData(n,a)}function WLe(i,n){const s=String(n.identifier).toUpperCase(),a=i.definitionById.get(s);if(!a)return Xte(i,n);const l={href:Sv(a.url||"")};a.title!==null&&a.title!==void 0&&(l.title=a.title);const d={type:"element",tagName:"a",properties:l,children:i.all(n)};return i.patch(n,d),i.applyData(n,d)}function GLe(i,n){const s={href:Sv(n.url)};n.title!==null&&n.title!==void 0&&(s.title=n.title);const a={type:"element",tagName:"a",properties:s,children:i.all(n)};return i.patch(n,a),i.applyData(n,a)}function HLe(i,n,s){const a=i.all(n),l=s?zLe(s):Jte(n),d={},f=[];if(typeof n.checked=="boolean"){const C=a[0];let I;C&&C.type==="element"&&C.tagName==="p"?I=C:(I={type:"element",tagName:"p",properties:{},children:[]},a.unshift(I)),I.children.length>0&&I.children.unshift({type:"text",value:" "}),I.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:n.checked,disabled:!0},children:[]}),d.className=["task-list-item"]}let E=-1;for(;++E<a.length;){const C=a[E];(l||E!==0||C.type!=="element"||C.tagName!=="p")&&f.push({type:"text",value:`
`}),C.type==="element"&&C.tagName==="p"&&!l?f.push(...C.children):f.push(C)}const S=a[a.length-1];S&&(l||S.type!=="element"||S.tagName!=="p")&&f.push({type:"text",value:`
`});const T={type:"element",tagName:"li",properties:d,children:f};return i.patch(n,T),i.applyData(n,T)}function zLe(i){let n=!1;if(i.type==="list"){n=i.spread||!1;const s=i.children;let a=-1;for(;!n&&++a<s.length;)n=Jte(s[a])}return n}function Jte(i){const n=i.spread;return n??i.children.length>1}function KLe(i,n){const s={},a=i.all(n);let l=-1;for(typeof n.start=="number"&&n.start!==1&&(s.start=n.start);++l<a.length;){const f=a[l];if(f.type==="element"&&f.tagName==="li"&&f.properties&&Array.isArray(f.properties.className)&&f.properties.className.includes("task-list-item")){s.className=["contains-task-list"];break}}const d={type:"element",tagName:n.ordered?"ol":"ul",properties:s,children:i.wrap(a,!0)};return i.patch(n,d),i.applyData(n,d)}function YLe(i,n){const s={type:"element",tagName:"p",properties:{},children:i.all(n)};return i.patch(n,s),i.applyData(n,s)}function qLe(i,n){const s={type:"root",children:i.wrap(i.all(n))};return i.patch(n,s),i.applyData(n,s)}function XLe(i,n){const s={type:"element",tagName:"strong",properties:{},children:i.all(n)};return i.patch(n,s),i.applyData(n,s)}function JLe(i,n){const s=i.all(n),a=s.shift(),l=[];if(a){const f={type:"element",tagName:"thead",properties:{},children:i.wrap([a],!0)};i.patch(n.children[0],f),l.push(f)}if(s.length>0){const f={type:"element",tagName:"tbody",properties:{},children:i.wrap(s,!0)},E=fV(n.children[1]),S=Nte(n.children[n.children.length-1]);E&&S&&(f.position={start:E,end:S}),l.push(f)}const d={type:"element",tagName:"table",properties:{},children:i.wrap(l,!0)};return i.patch(n,d),i.applyData(n,d)}function $Le(i,n,s){const a=s?s.children:void 0,d=(a?a.indexOf(n):1)===0?"th":"td",f=s&&s.type==="table"?s.align:void 0,E=f?f.length:n.children.length;let S=-1;const T=[];for(;++S<E;){const I=n.children[S],N={},P=f?f[S]:void 0;P&&(N.align=P);let W={type:"element",tagName:d,properties:N,children:[]};I&&(W.children=i.all(I),i.patch(I,W),W=i.applyData(I,W)),T.push(W)}const C={type:"element",tagName:"tr",properties:{},children:i.wrap(T,!0)};return i.patch(n,C),i.applyData(n,C)}function QLe(i,n){const s={type:"element",tagName:"td",properties:{},children:i.all(n)};return i.patch(n,s),i.applyData(n,s)}const mq=9,gq=32;function ZLe(i){const n=String(i),s=/\r?\n|\r/g;let a=s.exec(n),l=0;const d=[];for(;a;)d.push(_q(n.slice(l,a.index),l>0,!0),a[0]),l=a.index+a[0].length,a=s.exec(n);return d.push(_q(n.slice(l),l>0,!1)),d.join("")}function _q(i,n,s){let a=0,l=i.length;if(n){let d=i.codePointAt(a);for(;d===mq||d===gq;)a++,d=i.codePointAt(a)}if(s){let d=i.codePointAt(l-1);for(;d===mq||d===gq;)l--,d=i.codePointAt(l-1)}return l>a?i.slice(a,l):""}function eMe(i,n){const s={type:"text",value:ZLe(String(n.value))};return i.patch(n,s),i.applyData(n,s)}function tMe(i,n){const s={type:"element",tagName:"hr",properties:{},children:[]};return i.patch(n,s),i.applyData(n,s)}const nMe={blockquote:PLe,break:kLe,code:DLe,delete:xLe,emphasis:LLe,footnoteReference:MLe,heading:ULe,html:VLe,imageReference:FLe,image:jLe,inlineCode:BLe,linkReference:WLe,link:GLe,listItem:HLe,list:KLe,paragraph:YLe,root:qLe,strong:XLe,table:JLe,tableCell:QLe,tableRow:$Le,text:eMe,thematicBreak:tMe,toml:uA,yaml:uA,definition:uA,footnoteDefinition:uA};function uA(){}const $te=-1,iN=0,ow=1,wO=2,SV=3,TV=4,wV=5,CV=6,Qte=7,Zte=8,Eq=typeof self=="object"?self:globalThis,rMe=(i,n)=>{const s=(l,d)=>(i.set(d,l),l),a=l=>{if(i.has(l))return i.get(l);const[d,f]=n[l];switch(d){case iN:case $te:return s(f,l);case ow:{const E=s([],l);for(const S of f)E.push(a(S));return E}case wO:{const E=s({},l);for(const[S,T]of f)E[a(S)]=a(T);return E}case SV:return s(new Date(f),l);case TV:{const{source:E,flags:S}=f;return s(new RegExp(E,S),l)}case wV:{const E=s(new Map,l);for(const[S,T]of f)E.set(a(S),a(T));return E}case CV:{const E=s(new Set,l);for(const S of f)E.add(a(S));return E}case Qte:{const{name:E,message:S}=f;return s(new Eq[E](S),l)}case Zte:return s(BigInt(f),l);case"BigInt":return s(Object(BigInt(f)),l);case"ArrayBuffer":return s(new Uint8Array(f).buffer,f);case"DataView":{const{buffer:E}=new Uint8Array(f);return s(new DataView(E),f)}}return s(new Eq[d](f),l)};return a},yq=i=>rMe(new Map,i)(0),_y="",{toString:iMe}={},{keys:sMe}=Object,D0=i=>{const n=typeof i;if(n!=="object"||!i)return[iN,n];const s=iMe.call(i).slice(8,-1);switch(s){case"Array":return[ow,_y];case"Object":return[wO,_y];case"Date":return[SV,_y];case"RegExp":return[TV,_y];case"Map":return[wV,_y];case"Set":return[CV,_y];case"DataView":return[ow,s]}return s.includes("Array")?[ow,s]:s.includes("Error")?[Qte,s]:[wO,s]},dA=([i,n])=>i===iN&&(n==="function"||n==="symbol"),oMe=(i,n,s,a)=>{const l=(f,E)=>{const S=a.push(f)-1;return s.set(E,S),S},d=f=>{if(s.has(f))return s.get(f);let[E,S]=D0(f);switch(E){case iN:{let C=f;switch(S){case"bigint":E=Zte,C=f.toString();break;case"function":case"symbol":if(i)throw new TypeError("unable to serialize "+S);C=null;break;case"undefined":return l([$te],f)}return l([E,C],f)}case ow:{if(S){let N=f;return S==="DataView"?N=new Uint8Array(f.buffer):S==="ArrayBuffer"&&(N=new Uint8Array(f)),l([S,[...N]],f)}const C=[],I=l([E,C],f);for(const N of f)C.push(d(N));return I}case wO:{if(S)switch(S){case"BigInt":return l([S,f.toString()],f);case"Boolean":case"Number":case"String":return l([S,f.valueOf()],f)}if(n&&"toJSON"in f)return d(f.toJSON());const C=[],I=l([E,C],f);for(const N of sMe(f))(i||!dA(D0(f[N])))&&C.push([d(N),d(f[N])]);return I}case SV:return l([E,f.toISOString()],f);case TV:{const{source:C,flags:I}=f;return l([E,{source:C,flags:I}],f)}case wV:{const C=[],I=l([E,C],f);for(const[N,P]of f)(i||!(dA(D0(N))||dA(D0(P))))&&C.push([d(N),d(P)]);return I}case CV:{const C=[],I=l([E,C],f);for(const N of f)(i||!dA(D0(N)))&&C.push(d(N));return I}}const{message:T}=f;return l([E,{name:S,message:T}],f)};return d},vq=(i,{json:n,lossy:s}={})=>{const a=[];return oMe(!(n||s),!!n,new Map,a)(i),a},CO=typeof structuredClone=="function"?(i,n)=>n&&("json"in n||"lossy"in n)?yq(vq(i,n)):structuredClone(i):(i,n)=>yq(vq(i,n));function aMe(i,n){const s=[{type:"text",value:""}];return n>1&&s.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(n)}]}),s}function cMe(i,n){return"Back to reference "+(i+1)+(n>1?"-"+n:"")}function lMe(i){const n=typeof i.options.clobberPrefix=="string"?i.options.clobberPrefix:"user-content-",s=i.options.footnoteBackContent||aMe,a=i.options.footnoteBackLabel||cMe,l=i.options.footnoteLabel||"Footnotes",d=i.options.footnoteLabelTagName||"h2",f=i.options.footnoteLabelProperties||{className:["sr-only"]},E=[];let S=-1;for(;++S<i.footnoteOrder.length;){const T=i.footnoteById.get(i.footnoteOrder[S]);if(!T)continue;const C=i.all(T),I=String(T.identifier).toUpperCase(),N=Sv(I.toLowerCase());let P=0;const W=[],x=i.footnoteCounts.get(I);for(;x!==void 0&&++P<=x;){W.length>0&&W.push({type:"text",value:" "});let Z=typeof s=="string"?s:s(S,P);typeof Z=="string"&&(Z={type:"text",value:Z}),W.push({type:"element",tagName:"a",properties:{href:"#"+n+"fnref-"+N+(P>1?"-"+P:""),dataFootnoteBackref:"",ariaLabel:typeof a=="string"?a:a(S,P),className:["data-footnote-backref"]},children:Array.isArray(Z)?Z:[Z]})}const B=C[C.length-1];if(B&&B.type==="element"&&B.tagName==="p"){const Z=B.children[B.children.length-1];Z&&Z.type==="text"?Z.value+=" ":B.children.push({type:"text",value:" "}),B.children.push(...W)}else C.push(...W);const X={type:"element",tagName:"li",properties:{id:n+"fn-"+N},children:i.wrap(C,!0)};i.patch(T,X),E.push(X)}if(E.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:d,properties:{...CO(f),id:"footnote-label"},children:[{type:"text",value:l}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:i.wrap(E,!0)},{type:"text",value:`
`}]}}const ene=(function(i){if(i==null)return pMe;if(typeof i=="function")return sN(i);if(typeof i=="object")return Array.isArray(i)?uMe(i):dMe(i);if(typeof i=="string")return hMe(i);throw new Error("Expected function, string, or object as test")});function uMe(i){const n=[];let s=-1;for(;++s<i.length;)n[s]=ene(i[s]);return sN(a);function a(...l){let d=-1;for(;++d<n.length;)if(n[d].apply(this,l))return!0;return!1}}function dMe(i){const n=i;return sN(s);function s(a){const l=a;let d;for(d in i)if(l[d]!==n[d])return!1;return!0}}function hMe(i){return sN(n);function n(s){return s&&s.type===i}}function sN(i){return n;function n(s,a,l){return!!(fMe(s)&&i.call(this,s,typeof a=="number"?a:void 0,l||void 0))}}function pMe(){return!0}function fMe(i){return i!==null&&typeof i=="object"&&"type"in i}const tne=[],mMe=!0,Sq=!1,gMe="skip";function _Me(i,n,s,a){let l;typeof n=="function"&&typeof s!="function"?(a=s,s=n):l=n;const d=ene(l),f=a?-1:1;E(i,void 0,[])();function E(S,T,C){const I=S&&typeof S=="object"?S:{};if(typeof I.type=="string"){const P=typeof I.tagName=="string"?I.tagName:typeof I.name=="string"?I.name:void 0;Object.defineProperty(N,"name",{value:"node ("+(S.type+(P?"<"+P+">":""))+")"})}return N;function N(){let P=tne,W,x,B;if((!n||d(S,T,C[C.length-1]||void 0))&&(P=EMe(s(S,C)),P[0]===Sq))return P;if("children"in S&&S.children){const X=S;if(X.children&&P[0]!==gMe)for(x=(a?X.children.length:-1)+f,B=C.concat(X);x>-1&&x<X.children.length;){const Z=X.children[x];if(W=E(Z,x,B)(),W[0]===Sq)return W;x=typeof W[1]=="number"?W[1]:x+f}}return P}}}function EMe(i){return Array.isArray(i)?i:typeof i=="number"?[mMe,i]:i==null?tne:[i]}function nne(i,n,s,a){let l,d,f;typeof n=="function"&&typeof s!="function"?(d=void 0,f=n,l=s):(d=n,f=s,l=a),_Me(i,d,E,l);function E(S,T){const C=T[T.length-1],I=C?C.children.indexOf(S):void 0;return f(S,I,C)}}const m2={}.hasOwnProperty,yMe={};function vMe(i,n){const s=n||yMe,a=new Map,l=new Map,d=new Map,f={...nMe,...s.handlers},E={all:T,applyData:TMe,definitionById:a,footnoteById:l,footnoteCounts:d,footnoteOrder:[],handlers:f,one:S,options:s,patch:SMe,wrap:CMe};return nne(i,function(C){if(C.type==="definition"||C.type==="footnoteDefinition"){const I=C.type==="definition"?a:l,N=String(C.identifier).toUpperCase();I.has(N)||I.set(N,C)}}),E;function S(C,I){const N=C.type,P=E.handlers[N];if(m2.call(E.handlers,N)&&P)return P(E,C,I);if(E.options.passThrough&&E.options.passThrough.includes(N)){if("children"in C){const{children:x,...B}=C,X=CO(B);return X.children=E.all(C),X}return CO(C)}return(E.options.unknownHandler||wMe)(E,C,I)}function T(C){const I=[];if("children"in C){const N=C.children;let P=-1;for(;++P<N.length;){const W=E.one(N[P],C);if(W){if(P&&N[P-1].type==="break"&&(!Array.isArray(W)&&W.type==="text"&&(W.value=Tq(W.value)),!Array.isArray(W)&&W.type==="element")){const x=W.children[0];x&&x.type==="text"&&(x.value=Tq(x.value))}Array.isArray(W)?I.push(...W):I.push(W)}}}return I}}function SMe(i,n){i.position&&(n.position=iDe(i))}function TMe(i,n){let s=n;if(i&&i.data){const a=i.data.hName,l=i.data.hChildren,d=i.data.hProperties;if(typeof a=="string")if(s.type==="element")s.tagName=a;else{const f="children"in s?s.children:[s];s={type:"element",tagName:a,properties:{},children:f}}s.type==="element"&&d&&Object.assign(s.properties,CO(d)),"children"in s&&s.children&&l!==null&&l!==void 0&&(s.children=l)}return s}function wMe(i,n){const s=n.data||{},a="value"in n&&!(m2.call(s,"hProperties")||m2.call(s,"hChildren"))?{type:"text",value:n.value}:{type:"element",tagName:"div",properties:{},children:i.all(n)};return i.patch(n,a),i.applyData(n,a)}function CMe(i,n){const s=[];let a=-1;for(n&&s.push({type:"text",value:`
`});++a<i.length;)a&&s.push({type:"text",value:`
`}),s.push(i[a]);return n&&i.length>0&&s.push({type:"text",value:`
`}),s}function Tq(i){let n=0,s=i.charCodeAt(n);for(;s===9||s===32;)n++,s=i.charCodeAt(n);return i.slice(n)}function wq(i,n){const s=vMe(i,n),a=s.one(i,void 0),l=lMe(s),d=Array.isArray(a)?{type:"root",children:a}:a||{type:"root",children:[]};return l&&d.children.push({type:"text",value:`
`},l),d}function RMe(i,n){return i&&"run"in i?async function(s,a){const l=wq(s,{file:a,...n});await i.run(l,a)}:function(s,a){return wq(s,{file:a,...i||n})}}function Cq(i){if(i)throw i}var kL,Rq;function bMe(){if(Rq)return kL;Rq=1;var i=Object.prototype.hasOwnProperty,n=Object.prototype.toString,s=Object.defineProperty,a=Object.getOwnPropertyDescriptor,l=function(T){return typeof Array.isArray=="function"?Array.isArray(T):n.call(T)==="[object Array]"},d=function(T){if(!T||n.call(T)!=="[object Object]")return!1;var C=i.call(T,"constructor"),I=T.constructor&&T.constructor.prototype&&i.call(T.constructor.prototype,"isPrototypeOf");if(T.constructor&&!C&&!I)return!1;var N;for(N in T);return typeof N>"u"||i.call(T,N)},f=function(T,C){s&&C.name==="__proto__"?s(T,C.name,{enumerable:!0,configurable:!0,value:C.newValue,writable:!0}):T[C.name]=C.newValue},E=function(T,C){if(C==="__proto__")if(i.call(T,C)){if(a)return a(T,C).value}else return;return T[C]};return kL=function S(){var T,C,I,N,P,W,x=arguments[0],B=1,X=arguments.length,Z=!1;for(typeof x=="boolean"&&(Z=x,x=arguments[1]||{},B=2),(x==null||typeof x!="object"&&typeof x!="function")&&(x={});B<X;++B)if(T=arguments[B],T!=null)for(C in T)I=E(x,C),N=E(T,C),x!==N&&(Z&&N&&(d(N)||(P=l(N)))?(P?(P=!1,W=I&&l(I)?I:[]):W=I&&d(I)?I:{},f(x,{name:C,newValue:S(Z,W,N)})):typeof N<"u"&&f(x,{name:C,newValue:N}));return x},kL}var IMe=bMe();const DL=IO(IMe);function g2(i){if(typeof i!="object"||i===null)return!1;const n=Object.getPrototypeOf(i);return(n===null||n===Object.prototype||Object.getPrototypeOf(n)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)}function AMe(){const i=[],n={run:s,use:a};return n;function s(...l){let d=-1;const f=l.pop();if(typeof f!="function")throw new TypeError("Expected function as last argument, not "+f);E(null,...l);function E(S,...T){const C=i[++d];let I=-1;if(S){f(S);return}for(;++I<l.length;)(T[I]===null||T[I]===void 0)&&(T[I]=l[I]);l=T,C?OMe(C,E)(...T):f(null,...T)}}function a(l){if(typeof l!="function")throw new TypeError("Expected `middelware` to be a function, not "+l);return i.push(l),n}}function OMe(i,n){let s;return a;function a(...f){const E=i.length>f.length;let S;E&&f.push(l);try{S=i.apply(this,f)}catch(T){const C=T;if(E&&s)throw C;return l(C)}E||(S&&S.then&&typeof S.then=="function"?S.then(d,l):S instanceof Error?l(S):d(S))}function l(f,...E){s||(s=!0,n(f,...E))}function d(f){l(null,f)}}const hd={basename:NMe,dirname:PMe,extname:kMe,join:DMe,sep:"/"};function NMe(i,n){if(n!==void 0&&typeof n!="string")throw new TypeError('"ext" argument must be a string');eC(i);let s=0,a=-1,l=i.length,d;if(n===void 0||n.length===0||n.length>i.length){for(;l--;)if(i.codePointAt(l)===47){if(d){s=l+1;break}}else a<0&&(d=!0,a=l+1);return a<0?"":i.slice(s,a)}if(n===i)return"";let f=-1,E=n.length-1;for(;l--;)if(i.codePointAt(l)===47){if(d){s=l+1;break}}else f<0&&(d=!0,f=l+1),E>-1&&(i.codePointAt(l)===n.codePointAt(E--)?E<0&&(a=l):(E=-1,a=f));return s===a?a=f:a<0&&(a=i.length),i.slice(s,a)}function PMe(i){if(eC(i),i.length===0)return".";let n=-1,s=i.length,a;for(;--s;)if(i.codePointAt(s)===47){if(a){n=s;break}}else a||(a=!0);return n<0?i.codePointAt(0)===47?"/":".":n===1&&i.codePointAt(0)===47?"//":i.slice(0,n)}function kMe(i){eC(i);let n=i.length,s=-1,a=0,l=-1,d=0,f;for(;n--;){const E=i.codePointAt(n);if(E===47){if(f){a=n+1;break}continue}s<0&&(f=!0,s=n+1),E===46?l<0?l=n:d!==1&&(d=1):l>-1&&(d=-1)}return l<0||s<0||d===0||d===1&&l===s-1&&l===a+1?"":i.slice(l,s)}function DMe(...i){let n=-1,s;for(;++n<i.length;)eC(i[n]),i[n]&&(s=s===void 0?i[n]:s+"/"+i[n]);return s===void 0?".":xMe(s)}function xMe(i){eC(i);const n=i.codePointAt(0)===47;let s=LMe(i,!n);return s.length===0&&!n&&(s="."),s.length>0&&i.codePointAt(i.length-1)===47&&(s+="/"),n?"/"+s:s}function LMe(i,n){let s="",a=0,l=-1,d=0,f=-1,E,S;for(;++f<=i.length;){if(f<i.length)E=i.codePointAt(f);else{if(E===47)break;E=47}if(E===47){if(!(l===f-1||d===1))if(l!==f-1&&d===2){if(s.length<2||a!==2||s.codePointAt(s.length-1)!==46||s.codePointAt(s.length-2)!==46){if(s.length>2){if(S=s.lastIndexOf("/"),S!==s.length-1){S<0?(s="",a=0):(s=s.slice(0,S),a=s.length-1-s.lastIndexOf("/")),l=f,d=0;continue}}else if(s.length>0){s="",a=0,l=f,d=0;continue}}n&&(s=s.length>0?s+"/..":"..",a=2)}else s.length>0?s+="/"+i.slice(l+1,f):s=i.slice(l+1,f),a=f-l-1;l=f,d=0}else E===46&&d>-1?d++:d=-1}return s}function eC(i){if(typeof i!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(i))}const MMe={cwd:UMe};function UMe(){return"/"}function _2(i){return!!(i!==null&&typeof i=="object"&&"href"in i&&i.href&&"protocol"in i&&i.protocol&&i.auth===void 0)}function VMe(i){if(typeof i=="string")i=new URL(i);else if(!_2(i)){const n=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+i+"`");throw n.code="ERR_INVALID_ARG_TYPE",n}if(i.protocol!=="file:"){const n=new TypeError("The URL must be of scheme file");throw n.code="ERR_INVALID_URL_SCHEME",n}return FMe(i)}function FMe(i){if(i.hostname!==""){const a=new TypeError('File URL host must be "localhost" or empty on darwin');throw a.code="ERR_INVALID_FILE_URL_HOST",a}const n=i.pathname;let s=-1;for(;++s<n.length;)if(n.codePointAt(s)===37&&n.codePointAt(s+1)===50){const a=n.codePointAt(s+2);if(a===70||a===102){const l=new TypeError("File URL path must not include encoded / characters");throw l.code="ERR_INVALID_FILE_URL_PATH",l}}return decodeURIComponent(n)}const xL=["history","path","basename","stem","extname","dirname"];class rne{constructor(n){let s;n?_2(n)?s={path:n}:typeof n=="string"||jMe(n)?s={value:n}:s=n:s={},this.cwd="cwd"in s?"":MMe.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let a=-1;for(;++a<xL.length;){const d=xL[a];d in s&&s[d]!==void 0&&s[d]!==null&&(this[d]=d==="history"?[...s[d]]:s[d])}let l;for(l in s)xL.includes(l)||(this[l]=s[l])}get basename(){return typeof this.path=="string"?hd.basename(this.path):void 0}set basename(n){ML(n,"basename"),LL(n,"basename"),this.path=hd.join(this.dirname||"",n)}get dirname(){return typeof this.path=="string"?hd.dirname(this.path):void 0}set dirname(n){bq(this.basename,"dirname"),this.path=hd.join(n||"",this.basename)}get extname(){return typeof this.path=="string"?hd.extname(this.path):void 0}set extname(n){if(LL(n,"extname"),bq(this.dirname,"extname"),n){if(n.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(n.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=hd.join(this.dirname,this.stem+(n||""))}get path(){return this.history[this.history.length-1]}set path(n){_2(n)&&(n=VMe(n)),ML(n,"path"),this.path!==n&&this.history.push(n)}get stem(){return typeof this.path=="string"?hd.basename(this.path,this.extname):void 0}set stem(n){ML(n,"stem"),LL(n,"stem"),this.path=hd.join(this.dirname||"",n+(this.extname||""))}fail(n,s,a){const l=this.message(n,s,a);throw l.fatal=!0,l}info(n,s,a){const l=this.message(n,s,a);return l.fatal=void 0,l}message(n,s,a){const l=new Vo(n,s,a);return this.path&&(l.name=this.path+":"+l.name,l.file=this.path),l.fatal=!1,this.messages.push(l),l}toString(n){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(n||void 0).decode(this.value)}}function LL(i,n){if(i&&i.includes(hd.sep))throw new Error("`"+n+"` cannot be a path: did not expect `"+hd.sep+"`")}function ML(i,n){if(!i)throw new Error("`"+n+"` cannot be empty")}function bq(i,n){if(!i)throw new Error("Setting `"+n+"` requires `path` to be set too")}function jMe(i){return!!(i&&typeof i=="object"&&"byteLength"in i&&"byteOffset"in i)}const BMe=(function(i){const a=this.constructor.prototype,l=a[i],d=function(){return l.apply(d,arguments)};return Object.setPrototypeOf(d,a),d}),WMe={}.hasOwnProperty;class RV extends BMe{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=AMe()}copy(){const n=new RV;let s=-1;for(;++s<this.attachers.length;){const a=this.attachers[s];n.use(...a)}return n.data(DL(!0,{},this.namespace)),n}data(n,s){return typeof n=="string"?arguments.length===2?(FL("data",this.frozen),this.namespace[n]=s,this):WMe.call(this.namespace,n)&&this.namespace[n]||void 0:n?(FL("data",this.frozen),this.namespace=n,this):this.namespace}freeze(){if(this.frozen)return this;const n=this;for(;++this.freezeIndex<this.attachers.length;){const[s,...a]=this.attachers[this.freezeIndex];if(a[0]===!1)continue;a[0]===!0&&(a[0]=void 0);const l=s.call(n,...a);typeof l=="function"&&this.transformers.use(l)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(n){this.freeze();const s=hA(n),a=this.parser||this.Parser;return UL("parse",a),a(String(s),s)}process(n,s){const a=this;return this.freeze(),UL("process",this.parser||this.Parser),VL("process",this.compiler||this.Compiler),s?l(void 0,s):new Promise(l);function l(d,f){const E=hA(n),S=a.parse(E);a.run(S,E,function(C,I,N){if(C||!I||!N)return T(C);const P=I,W=a.stringify(P,N);zMe(W)?N.value=W:N.result=W,T(C,N)});function T(C,I){C||!I?f(C):d?d(I):s(void 0,I)}}}processSync(n){let s=!1,a;return this.freeze(),UL("processSync",this.parser||this.Parser),VL("processSync",this.compiler||this.Compiler),this.process(n,l),Aq("processSync","process",s),a;function l(d,f){s=!0,Cq(d),a=f}}run(n,s,a){Iq(n),this.freeze();const l=this.transformers;return!a&&typeof s=="function"&&(a=s,s=void 0),a?d(void 0,a):new Promise(d);function d(f,E){const S=hA(s);l.run(n,S,T);function T(C,I,N){const P=I||n;C?E(C):f?f(P):a(void 0,P,N)}}}runSync(n,s){let a=!1,l;return this.run(n,s,d),Aq("runSync","run",a),l;function d(f,E){Cq(f),l=E,a=!0}}stringify(n,s){this.freeze();const a=hA(s),l=this.compiler||this.Compiler;return VL("stringify",l),Iq(n),l(n,a)}use(n,...s){const a=this.attachers,l=this.namespace;if(FL("use",this.frozen),n!=null)if(typeof n=="function")S(n,s);else if(typeof n=="object")Array.isArray(n)?E(n):f(n);else throw new TypeError("Expected usable value, not `"+n+"`");return this;function d(T){if(typeof T=="function")S(T,[]);else if(typeof T=="object")if(Array.isArray(T)){const[C,...I]=T;S(C,I)}else f(T);else throw new TypeError("Expected usable value, not `"+T+"`")}function f(T){if(!("plugins"in T)&&!("settings"in T))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");E(T.plugins),T.settings&&(l.settings=DL(!0,l.settings,T.settings))}function E(T){let C=-1;if(T!=null)if(Array.isArray(T))for(;++C<T.length;){const I=T[C];d(I)}else throw new TypeError("Expected a list of plugins, not `"+T+"`")}function S(T,C){let I=-1,N=-1;for(;++I<a.length;)if(a[I][0]===T){N=I;break}if(N===-1)a.push([T,...C]);else if(C.length>0){let[P,...W]=C;const x=a[N][1];g2(x)&&g2(P)&&(P=DL(!0,x,P)),a[N]=[T,P,...W]}}}}const GMe=new RV().freeze();function UL(i,n){if(typeof n!="function")throw new TypeError("Cannot `"+i+"` without `parser`")}function VL(i,n){if(typeof n!="function")throw new TypeError("Cannot `"+i+"` without `compiler`")}function FL(i,n){if(n)throw new Error("Cannot call `"+i+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function Iq(i){if(!g2(i)||typeof i.type!="string")throw new TypeError("Expected node, got `"+i+"`")}function Aq(i,n,s){if(!s)throw new Error("`"+i+"` finished async. Use `"+n+"` instead")}function hA(i){return HMe(i)?i:new rne(i)}function HMe(i){return!!(i&&typeof i=="object"&&"message"in i&&"messages"in i)}function zMe(i){return typeof i=="string"||KMe(i)}function KMe(i){return!!(i&&typeof i=="object"&&"byteLength"in i&&"byteOffset"in i)}const YMe="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",Oq=[],Nq={allowDangerousHtml:!0},qMe=/^(https?|ircs?|mailto|xmpp)$/i,XMe=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function JMe(i){const n=$Me(i),s=QMe(i);return ZMe(n.runSync(n.parse(s),s),i)}function $Me(i){const n=i.rehypePlugins||Oq,s=i.remarkPlugins||Oq,a=i.remarkRehypeOptions?{...i.remarkRehypeOptions,...Nq}:Nq;return GMe().use(NLe).use(s).use(RMe,a).use(n)}function QMe(i){const n=i.children||"",s=new rne;return typeof n=="string"&&(s.value=n),s}function ZMe(i,n){const s=n.allowedElements,a=n.allowElement,l=n.components,d=n.disallowedElements,f=n.skipHtml,E=n.unwrapDisallowed,S=n.urlTransform||e2e;for(const C of XMe)Object.hasOwn(n,C.from)&&(""+C.from+(C.to?"use `"+C.to+"` instead":"remove it")+YMe+C.id,void 0);return nne(i,T),lDe(i,{Fragment:D.Fragment,components:l,ignoreInvalidStyle:!0,jsx:D.jsx,jsxs:D.jsxs,passKeys:!0,passNode:!0});function T(C,I,N){if(C.type==="raw"&&N&&typeof I=="number")return f?N.children.splice(I,1):N.children[I]={type:"text",value:C.value},I;if(C.type==="element"){let P;for(P in OL)if(Object.hasOwn(OL,P)&&Object.hasOwn(C.properties,P)){const W=C.properties[P],x=OL[P];(x===null||x.includes(C.tagName))&&(C.properties[P]=S(String(W||""),P,C))}}if(C.type==="element"){let P=s?!s.includes(C.tagName):d?d.includes(C.tagName):!1;if(!P&&a&&typeof I=="number"&&(P=!a(C,I,N)),P&&N&&typeof I=="number")return E&&C.children?N.children.splice(I,1,...C.children):N.children.splice(I,1),I}}}function e2e(i){const n=i.indexOf(":"),s=i.indexOf("?"),a=i.indexOf("#"),l=i.indexOf("/");return n===-1||l!==-1&&n>l||s!==-1&&n>s||a!==-1&&n>a||qMe.test(i.slice(0,n))?i:""}var Pq;(function(i){i.STRING="string",i.NUMBER="number",i.INTEGER="integer",i.BOOLEAN="boolean",i.ARRAY="array",i.OBJECT="object"})(Pq||(Pq={}));var kq;(function(i){i.LANGUAGE_UNSPECIFIED="language_unspecified",i.PYTHON="python"})(kq||(kq={}));var Dq;(function(i){i.OUTCOME_UNSPECIFIED="outcome_unspecified",i.OUTCOME_OK="outcome_ok",i.OUTCOME_FAILED="outcome_failed",i.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(Dq||(Dq={}));const xq=["user","model","function","system"];var Lq;(function(i){i.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",i.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",i.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",i.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",i.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",i.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(Lq||(Lq={}));var Mq;(function(i){i.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",i.BLOCK_NONE="BLOCK_NONE"})(Mq||(Mq={}));var Uq;(function(i){i.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",i.NEGLIGIBLE="NEGLIGIBLE",i.LOW="LOW",i.MEDIUM="MEDIUM",i.HIGH="HIGH"})(Uq||(Uq={}));var Vq;(function(i){i.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",i.SAFETY="SAFETY",i.OTHER="OTHER"})(Vq||(Vq={}));var aw;(function(i){i.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",i.STOP="STOP",i.MAX_TOKENS="MAX_TOKENS",i.SAFETY="SAFETY",i.RECITATION="RECITATION",i.LANGUAGE="LANGUAGE",i.BLOCKLIST="BLOCKLIST",i.PROHIBITED_CONTENT="PROHIBITED_CONTENT",i.SPII="SPII",i.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",i.OTHER="OTHER"})(aw||(aw={}));var Fq;(function(i){i.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",i.RETRIEVAL_QUERY="RETRIEVAL_QUERY",i.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",i.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",i.CLASSIFICATION="CLASSIFICATION",i.CLUSTERING="CLUSTERING"})(Fq||(Fq={}));var jq;(function(i){i.MODE_UNSPECIFIED="MODE_UNSPECIFIED",i.AUTO="AUTO",i.ANY="ANY",i.NONE="NONE"})(jq||(jq={}));var Bq;(function(i){i.MODE_UNSPECIFIED="MODE_UNSPECIFIED",i.MODE_DYNAMIC="MODE_DYNAMIC"})(Bq||(Bq={}));class xo extends Error{constructor(n){super(`[GoogleGenerativeAI Error]: ${n}`)}}class Ey extends xo{constructor(n,s){super(n),this.response=s}}class ine extends xo{constructor(n,s,a,l){super(n),this.status=s,this.statusText=a,this.errorDetails=l}}class cf extends xo{}class sne extends xo{}const t2e="https://generativelanguage.googleapis.com",n2e="v1beta",r2e="0.24.1",i2e="genai-js";var Bg;(function(i){i.GENERATE_CONTENT="generateContent",i.STREAM_GENERATE_CONTENT="streamGenerateContent",i.COUNT_TOKENS="countTokens",i.EMBED_CONTENT="embedContent",i.BATCH_EMBED_CONTENTS="batchEmbedContents"})(Bg||(Bg={}));class s2e{constructor(n,s,a,l,d){this.model=n,this.task=s,this.apiKey=a,this.stream=l,this.requestOptions=d}toString(){var n,s;const a=((n=this.requestOptions)===null||n===void 0?void 0:n.apiVersion)||n2e;let d=`${((s=this.requestOptions)===null||s===void 0?void 0:s.baseUrl)||t2e}/${a}/${this.model}:${this.task}`;return this.stream&&(d+="?alt=sse"),d}}function o2e(i){const n=[];return i?.apiClient&&n.push(i.apiClient),n.push(`${i2e}/${r2e}`),n.join(" ")}async function a2e(i){var n;const s=new Headers;s.append("Content-Type","application/json"),s.append("x-goog-api-client",o2e(i.requestOptions)),s.append("x-goog-api-key",i.apiKey);let a=(n=i.requestOptions)===null||n===void 0?void 0:n.customHeaders;if(a){if(!(a instanceof Headers))try{a=new Headers(a)}catch(l){throw new cf(`unable to convert customHeaders value ${JSON.stringify(a)} to Headers: ${l.message}`)}for(const[l,d]of a.entries()){if(l==="x-goog-api-key")throw new cf(`Cannot set reserved header name ${l}`);if(l==="x-goog-api-client")throw new cf(`Header name ${l} can only be set using the apiClient field`);s.append(l,d)}}return s}async function c2e(i,n,s,a,l,d){const f=new s2e(i,n,s,a,d);return{url:f.toString(),fetchOptions:Object.assign(Object.assign({},h2e(d)),{method:"POST",headers:await a2e(f),body:l})}}async function tC(i,n,s,a,l,d={},f=fetch){const{url:E,fetchOptions:S}=await c2e(i,n,s,a,l,d);return l2e(E,S,f)}async function l2e(i,n,s=fetch){let a;try{a=await s(i,n)}catch(l){u2e(l,i)}return a.ok||await d2e(a,i),a}function u2e(i,n){let s=i;throw s.name==="AbortError"?(s=new sne(`Request aborted when fetching ${n.toString()}: ${i.message}`),s.stack=i.stack):i instanceof ine||i instanceof cf||(s=new xo(`Error fetching from ${n.toString()}: ${i.message}`),s.stack=i.stack),s}async function d2e(i,n){let s="",a;try{const l=await i.json();s=l.error.message,l.error.details&&(s+=` ${JSON.stringify(l.error.details)}`,a=l.error.details)}catch{}throw new ine(`Error fetching from ${n.toString()}: [${i.status} ${i.statusText}] ${s}`,i.status,i.statusText,a)}function h2e(i){const n={};if(i?.signal!==void 0||i?.timeout>=0){const s=new AbortController;i?.timeout>=0&&setTimeout(()=>s.abort(),i.timeout),i?.signal&&i.signal.addEventListener("abort",()=>{s.abort()}),n.signal=s.signal}return n}function bV(i){return i.text=()=>{if(i.candidates&&i.candidates.length>0){if(i.candidates.length>1&&console.warn(`This response had ${i.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),LA(i.candidates[0]))throw new Ey(`${Yp(i)}`,i);return p2e(i)}else if(i.promptFeedback)throw new Ey(`Text not available. ${Yp(i)}`,i);return""},i.functionCall=()=>{if(i.candidates&&i.candidates.length>0){if(i.candidates.length>1&&console.warn(`This response had ${i.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),LA(i.candidates[0]))throw new Ey(`${Yp(i)}`,i);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Wq(i)[0]}else if(i.promptFeedback)throw new Ey(`Function call not available. ${Yp(i)}`,i)},i.functionCalls=()=>{if(i.candidates&&i.candidates.length>0){if(i.candidates.length>1&&console.warn(`This response had ${i.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),LA(i.candidates[0]))throw new Ey(`${Yp(i)}`,i);return Wq(i)}else if(i.promptFeedback)throw new Ey(`Function call not available. ${Yp(i)}`,i)},i}function p2e(i){var n,s,a,l;const d=[];if(!((s=(n=i.candidates)===null||n===void 0?void 0:n[0].content)===null||s===void 0)&&s.parts)for(const f of(l=(a=i.candidates)===null||a===void 0?void 0:a[0].content)===null||l===void 0?void 0:l.parts)f.text&&d.push(f.text),f.executableCode&&d.push("\n```"+f.executableCode.language+`
`+f.executableCode.code+"\n```\n"),f.codeExecutionResult&&d.push("\n```\n"+f.codeExecutionResult.output+"\n```\n");return d.length>0?d.join(""):""}function Wq(i){var n,s,a,l;const d=[];if(!((s=(n=i.candidates)===null||n===void 0?void 0:n[0].content)===null||s===void 0)&&s.parts)for(const f of(l=(a=i.candidates)===null||a===void 0?void 0:a[0].content)===null||l===void 0?void 0:l.parts)f.functionCall&&d.push(f.functionCall);if(d.length>0)return d}const f2e=[aw.RECITATION,aw.SAFETY,aw.LANGUAGE];function LA(i){return!!i.finishReason&&f2e.includes(i.finishReason)}function Yp(i){var n,s,a;let l="";if((!i.candidates||i.candidates.length===0)&&i.promptFeedback)l+="Response was blocked",!((n=i.promptFeedback)===null||n===void 0)&&n.blockReason&&(l+=` due to ${i.promptFeedback.blockReason}`),!((s=i.promptFeedback)===null||s===void 0)&&s.blockReasonMessage&&(l+=`: ${i.promptFeedback.blockReasonMessage}`);else if(!((a=i.candidates)===null||a===void 0)&&a[0]){const d=i.candidates[0];LA(d)&&(l+=`Candidate was blocked due to ${d.finishReason}`,d.finishMessage&&(l+=`: ${d.finishMessage}`))}return l}function Lw(i){return this instanceof Lw?(this.v=i,this):new Lw(i)}function m2e(i,n,s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=s.apply(i,n||[]),l,d=[];return l={},f("next"),f("throw"),f("return"),l[Symbol.asyncIterator]=function(){return this},l;function f(N){a[N]&&(l[N]=function(P){return new Promise(function(W,x){d.push([N,P,W,x])>1||E(N,P)})})}function E(N,P){try{S(a[N](P))}catch(W){I(d[0][3],W)}}function S(N){N.value instanceof Lw?Promise.resolve(N.value.v).then(T,C):I(d[0][2],N)}function T(N){E("next",N)}function C(N){E("throw",N)}function I(N,P){N(P),d.shift(),d.length&&E(d[0][0],d[0][1])}}const Gq=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function g2e(i){const n=i.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),s=y2e(n),[a,l]=s.tee();return{stream:E2e(a),response:_2e(l)}}async function _2e(i){const n=[],s=i.getReader();for(;;){const{done:a,value:l}=await s.read();if(a)return bV(v2e(n));n.push(l)}}function E2e(i){return m2e(this,arguments,function*(){const s=i.getReader();for(;;){const{value:a,done:l}=yield Lw(s.read());if(l)break;yield yield Lw(bV(a))}})}function y2e(i){const n=i.getReader();return new ReadableStream({start(a){let l="";return d();function d(){return n.read().then(({value:f,done:E})=>{if(E){if(l.trim()){a.error(new xo("Failed to parse stream"));return}a.close();return}l+=f;let S=l.match(Gq),T;for(;S;){try{T=JSON.parse(S[1])}catch{a.error(new xo(`Error parsing JSON response: "${S[1]}"`));return}a.enqueue(T),l=l.substring(S[0].length),S=l.match(Gq)}return d()}).catch(f=>{let E=f;throw E.stack=f.stack,E.name==="AbortError"?E=new sne("Request aborted when reading from the stream"):E=new xo("Error reading from the stream"),E})}}})}function v2e(i){const n=i[i.length-1],s={promptFeedback:n?.promptFeedback};for(const a of i){if(a.candidates){let l=0;for(const d of a.candidates)if(s.candidates||(s.candidates=[]),s.candidates[l]||(s.candidates[l]={index:l}),s.candidates[l].citationMetadata=d.citationMetadata,s.candidates[l].groundingMetadata=d.groundingMetadata,s.candidates[l].finishReason=d.finishReason,s.candidates[l].finishMessage=d.finishMessage,s.candidates[l].safetyRatings=d.safetyRatings,d.content&&d.content.parts){s.candidates[l].content||(s.candidates[l].content={role:d.content.role||"user",parts:[]});const f={};for(const E of d.content.parts)E.text&&(f.text=E.text),E.functionCall&&(f.functionCall=E.functionCall),E.executableCode&&(f.executableCode=E.executableCode),E.codeExecutionResult&&(f.codeExecutionResult=E.codeExecutionResult),Object.keys(f).length===0&&(f.text=""),s.candidates[l].content.parts.push(f)}l++}a.usageMetadata&&(s.usageMetadata=a.usageMetadata)}return s}async function one(i,n,s,a){const l=await tC(n,Bg.STREAM_GENERATE_CONTENT,i,!0,JSON.stringify(s),a);return g2e(l)}async function ane(i,n,s,a){const d=await(await tC(n,Bg.GENERATE_CONTENT,i,!1,JSON.stringify(s),a)).json();return{response:bV(d)}}function cne(i){if(i!=null){if(typeof i=="string")return{role:"system",parts:[{text:i}]};if(i.text)return{role:"system",parts:[i]};if(i.parts)return i.role?i:{role:"system",parts:i.parts}}}function Mw(i){let n=[];if(typeof i=="string")n=[{text:i}];else for(const s of i)typeof s=="string"?n.push({text:s}):n.push(s);return S2e(n)}function S2e(i){const n={role:"user",parts:[]},s={role:"function",parts:[]};let a=!1,l=!1;for(const d of i)"functionResponse"in d?(s.parts.push(d),l=!0):(n.parts.push(d),a=!0);if(a&&l)throw new xo("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!a&&!l)throw new xo("No content is provided for sending chat message.");return a?n:s}function T2e(i,n){var s;let a={model:n?.model,generationConfig:n?.generationConfig,safetySettings:n?.safetySettings,tools:n?.tools,toolConfig:n?.toolConfig,systemInstruction:n?.systemInstruction,cachedContent:(s=n?.cachedContent)===null||s===void 0?void 0:s.name,contents:[]};const l=i.generateContentRequest!=null;if(i.contents){if(l)throw new cf("CountTokensRequest must have one of contents or generateContentRequest, not both.");a.contents=i.contents}else if(l)a=Object.assign(Object.assign({},a),i.generateContentRequest);else{const d=Mw(i);a.contents=[d]}return{generateContentRequest:a}}function Hq(i){let n;return i.contents?n=i:n={contents:[Mw(i)]},i.systemInstruction&&(n.systemInstruction=cne(i.systemInstruction)),n}function w2e(i){return typeof i=="string"||Array.isArray(i)?{content:Mw(i)}:i}const zq=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],C2e={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function R2e(i){let n=!1;for(const s of i){const{role:a,parts:l}=s;if(!n&&a!=="user")throw new xo(`First content should be with role 'user', got ${a}`);if(!xq.includes(a))throw new xo(`Each item should include role field. Got ${a} but valid roles are: ${JSON.stringify(xq)}`);if(!Array.isArray(l))throw new xo("Content should have 'parts' property with an array of Parts");if(l.length===0)throw new xo("Each Content should have at least one part");const d={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const E of l)for(const S of zq)S in E&&(d[S]+=1);const f=C2e[a];for(const E of zq)if(!f.includes(E)&&d[E]>0)throw new xo(`Content with role '${a}' can't contain '${E}' part`);n=!0}}function Kq(i){var n;if(i.candidates===void 0||i.candidates.length===0)return!1;const s=(n=i.candidates[0])===null||n===void 0?void 0:n.content;if(s===void 0||s.parts===void 0||s.parts.length===0)return!1;for(const a of s.parts)if(a===void 0||Object.keys(a).length===0||a.text!==void 0&&a.text==="")return!1;return!0}const Yq="SILENT_ERROR";class b2e{constructor(n,s,a,l={}){this.model=s,this.params=a,this._requestOptions=l,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=n,a?.history&&(R2e(a.history),this._history=a.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(n,s={}){var a,l,d,f,E,S;await this._sendPromise;const T=Mw(n),C={safetySettings:(a=this.params)===null||a===void 0?void 0:a.safetySettings,generationConfig:(l=this.params)===null||l===void 0?void 0:l.generationConfig,tools:(d=this.params)===null||d===void 0?void 0:d.tools,toolConfig:(f=this.params)===null||f===void 0?void 0:f.toolConfig,systemInstruction:(E=this.params)===null||E===void 0?void 0:E.systemInstruction,cachedContent:(S=this.params)===null||S===void 0?void 0:S.cachedContent,contents:[...this._history,T]},I=Object.assign(Object.assign({},this._requestOptions),s);let N;return this._sendPromise=this._sendPromise.then(()=>ane(this._apiKey,this.model,C,I)).then(P=>{var W;if(Kq(P.response)){this._history.push(T);const x=Object.assign({parts:[],role:"model"},(W=P.response.candidates)===null||W===void 0?void 0:W[0].content);this._history.push(x)}else{const x=Yp(P.response);x&&console.warn(`sendMessage() was unsuccessful. ${x}. Inspect response object for details.`)}N=P}).catch(P=>{throw this._sendPromise=Promise.resolve(),P}),await this._sendPromise,N}async sendMessageStream(n,s={}){var a,l,d,f,E,S;await this._sendPromise;const T=Mw(n),C={safetySettings:(a=this.params)===null||a===void 0?void 0:a.safetySettings,generationConfig:(l=this.params)===null||l===void 0?void 0:l.generationConfig,tools:(d=this.params)===null||d===void 0?void 0:d.tools,toolConfig:(f=this.params)===null||f===void 0?void 0:f.toolConfig,systemInstruction:(E=this.params)===null||E===void 0?void 0:E.systemInstruction,cachedContent:(S=this.params)===null||S===void 0?void 0:S.cachedContent,contents:[...this._history,T]},I=Object.assign(Object.assign({},this._requestOptions),s),N=one(this._apiKey,this.model,C,I);return this._sendPromise=this._sendPromise.then(()=>N).catch(P=>{throw new Error(Yq)}).then(P=>P.response).then(P=>{if(Kq(P)){this._history.push(T);const W=Object.assign({},P.candidates[0].content);W.role||(W.role="model"),this._history.push(W)}else{const W=Yp(P);W&&console.warn(`sendMessageStream() was unsuccessful. ${W}. Inspect response object for details.`)}}).catch(P=>{P.message!==Yq&&console.error(P)}),N}}async function I2e(i,n,s,a){return(await tC(n,Bg.COUNT_TOKENS,i,!1,JSON.stringify(s),a)).json()}async function A2e(i,n,s,a){return(await tC(n,Bg.EMBED_CONTENT,i,!1,JSON.stringify(s),a)).json()}async function O2e(i,n,s,a){const l=s.requests.map(f=>Object.assign(Object.assign({},f),{model:n}));return(await tC(n,Bg.BATCH_EMBED_CONTENTS,i,!1,JSON.stringify({requests:l}),a)).json()}class qq{constructor(n,s,a={}){this.apiKey=n,this._requestOptions=a,s.model.includes("/")?this.model=s.model:this.model=`models/${s.model}`,this.generationConfig=s.generationConfig||{},this.safetySettings=s.safetySettings||[],this.tools=s.tools,this.toolConfig=s.toolConfig,this.systemInstruction=cne(s.systemInstruction),this.cachedContent=s.cachedContent}async generateContent(n,s={}){var a;const l=Hq(n),d=Object.assign(Object.assign({},this._requestOptions),s);return ane(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(a=this.cachedContent)===null||a===void 0?void 0:a.name},l),d)}async generateContentStream(n,s={}){var a;const l=Hq(n),d=Object.assign(Object.assign({},this._requestOptions),s);return one(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(a=this.cachedContent)===null||a===void 0?void 0:a.name},l),d)}startChat(n){var s;return new b2e(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(s=this.cachedContent)===null||s===void 0?void 0:s.name},n),this._requestOptions)}async countTokens(n,s={}){const a=T2e(n,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),l=Object.assign(Object.assign({},this._requestOptions),s);return I2e(this.apiKey,this.model,a,l)}async embedContent(n,s={}){const a=w2e(n),l=Object.assign(Object.assign({},this._requestOptions),s);return A2e(this.apiKey,this.model,a,l)}async batchEmbedContents(n,s={}){const a=Object.assign(Object.assign({},this._requestOptions),s);return O2e(this.apiKey,this.model,n,a)}}class N2e{constructor(n){this.apiKey=n}getGenerativeModel(n,s){if(!n.model)throw new xo("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new qq(this.apiKey,n,s)}getGenerativeModelFromCachedContent(n,s,a){if(!n.name)throw new cf("Cached content must contain a `name` field.");if(!n.model)throw new cf("Cached content must contain a `model` field.");const l=["model","systemInstruction"];for(const f of l)if(s?.[f]&&n[f]&&s?.[f]!==n[f]){if(f==="model"){const E=s.model.startsWith("models/")?s.model.replace("models/",""):s.model,S=n.model.startsWith("models/")?n.model.replace("models/",""):n.model;if(E===S)continue}throw new cf(`Different value for "${f}" specified in modelParams (${s[f]}) and cachedContent (${n[f]})`)}const d=Object.assign(Object.assign({},s),{model:n.model,tools:n.tools,toolConfig:n.toolConfig,systemInstruction:n.systemInstruction,cachedContent:n});return new qq(this.apiKey,d,a)}}var jL="focusScope.autoFocusOnMount",BL="focusScope.autoFocusOnUnmount",Xq={bubbles:!1,cancelable:!0},P2e="FocusScope",lne=H.forwardRef((i,n)=>{const{loop:s=!1,trapped:a=!1,onMountAutoFocus:l,onUnmountAutoFocus:d,...f}=i,[E,S]=H.useState(null),T=uu(l),C=uu(d),I=H.useRef(null),N=Xs(n,x=>S(x)),P=H.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;H.useEffect(()=>{if(a){let x=function($){if(P.paused||!E)return;const ae=$.target;E.contains(ae)?I.current=ae:zp(I.current,{select:!0})},B=function($){if(P.paused||!E)return;const ae=$.relatedTarget;ae!==null&&(E.contains(ae)||zp(I.current,{select:!0}))},X=function($){if(document.activeElement===document.body)for(const ce of $)ce.removedNodes.length>0&&zp(E)};document.addEventListener("focusin",x),document.addEventListener("focusout",B);const Z=new MutationObserver(X);return E&&Z.observe(E,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",x),document.removeEventListener("focusout",B),Z.disconnect()}}},[a,E,P.paused]),H.useEffect(()=>{if(E){$q.add(P);const x=document.activeElement;if(!E.contains(x)){const X=new CustomEvent(jL,Xq);E.addEventListener(jL,T),E.dispatchEvent(X),X.defaultPrevented||(k2e(U2e(une(E)),{select:!0}),document.activeElement===x&&zp(E))}return()=>{E.removeEventListener(jL,T),setTimeout(()=>{const X=new CustomEvent(BL,Xq);E.addEventListener(BL,C),E.dispatchEvent(X),X.defaultPrevented||zp(x??document.body,{select:!0}),E.removeEventListener(BL,C),$q.remove(P)},0)}}},[E,T,C,P]);const W=H.useCallback(x=>{if(!s&&!a||P.paused)return;const B=x.key==="Tab"&&!x.altKey&&!x.ctrlKey&&!x.metaKey,X=document.activeElement;if(B&&X){const Z=x.currentTarget,[$,ae]=D2e(Z);$&&ae?!x.shiftKey&&X===ae?(x.preventDefault(),s&&zp($,{select:!0})):x.shiftKey&&X===$&&(x.preventDefault(),s&&zp(ae,{select:!0})):X===Z&&x.preventDefault()}},[s,a,P.paused]);return D.jsx(ri.div,{tabIndex:-1,...f,ref:N,onKeyDown:W})});lne.displayName=P2e;function k2e(i,{select:n=!1}={}){const s=document.activeElement;for(const a of i)if(zp(a,{select:n}),document.activeElement!==s)return}function D2e(i){const n=une(i),s=Jq(n,i),a=Jq(n.reverse(),i);return[s,a]}function une(i){const n=[],s=document.createTreeWalker(i,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>{const l=a.tagName==="INPUT"&&a.type==="hidden";return a.disabled||a.hidden||l?NodeFilter.FILTER_SKIP:a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;s.nextNode();)n.push(s.currentNode);return n}function Jq(i,n){for(const s of i)if(!x2e(s,{upTo:n}))return s}function x2e(i,{upTo:n}){if(getComputedStyle(i).visibility==="hidden")return!0;for(;i;){if(n!==void 0&&i===n)return!1;if(getComputedStyle(i).display==="none")return!0;i=i.parentElement}return!1}function L2e(i){return i instanceof HTMLInputElement&&"select"in i}function zp(i,{select:n=!1}={}){if(i&&i.focus){const s=document.activeElement;i.focus({preventScroll:!0}),i!==s&&L2e(i)&&n&&i.select()}}var $q=M2e();function M2e(){let i=[];return{add(n){const s=i[0];n!==s&&s?.pause(),i=Qq(i,n),i.unshift(n)},remove(n){i=Qq(i,n),i[0]?.resume()}}}function Qq(i,n){const s=[...i],a=s.indexOf(n);return a!==-1&&s.splice(a,1),s}function U2e(i){return i.filter(n=>n.tagName!=="A")}var WL=0;function V2e(){H.useEffect(()=>{const i=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",i[0]??Zq()),document.body.insertAdjacentElement("beforeend",i[1]??Zq()),WL++,()=>{WL===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(n=>n.remove()),WL--}},[])}function Zq(){const i=document.createElement("span");return i.setAttribute("data-radix-focus-guard",""),i.tabIndex=0,i.style.outline="none",i.style.opacity="0",i.style.position="fixed",i.style.pointerEvents="none",i}var gd=function(){return gd=Object.assign||function(n){for(var s,a=1,l=arguments.length;a<l;a++){s=arguments[a];for(var d in s)Object.prototype.hasOwnProperty.call(s,d)&&(n[d]=s[d])}return n},gd.apply(this,arguments)};function dne(i,n){var s={};for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&n.indexOf(a)<0&&(s[a]=i[a]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(i);l<a.length;l++)n.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(i,a[l])&&(s[a[l]]=i[a[l]]);return s}function F2e(i,n,s){if(s||arguments.length===2)for(var a=0,l=n.length,d;a<l;a++)(d||!(a in n))&&(d||(d=Array.prototype.slice.call(n,0,a)),d[a]=n[a]);return i.concat(d||Array.prototype.slice.call(n))}var MA="right-scroll-bar-position",UA="width-before-scroll-bar",j2e="with-scroll-bars-hidden",B2e="--removed-body-scroll-bar-size";function GL(i,n){return typeof i=="function"?i(n):i&&(i.current=n),i}function W2e(i,n){var s=H.useState(function(){return{value:i,callback:n,facade:{get current(){return s.value},set current(a){var l=s.value;l!==a&&(s.value=a,s.callback(a,l))}}}})[0];return s.callback=n,s.facade}var G2e=typeof window<"u"?H.useLayoutEffect:H.useEffect,eX=new WeakMap;function H2e(i,n){var s=W2e(null,function(a){return i.forEach(function(l){return GL(l,a)})});return G2e(function(){var a=eX.get(s);if(a){var l=new Set(a),d=new Set(i),f=s.current;l.forEach(function(E){d.has(E)||GL(E,null)}),d.forEach(function(E){l.has(E)||GL(E,f)})}eX.set(s,i)},[i]),s}function z2e(i){return i}function K2e(i,n){n===void 0&&(n=z2e);var s=[],a=!1,l={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return s.length?s[s.length-1]:i},useMedium:function(d){var f=n(d,a);return s.push(f),function(){s=s.filter(function(E){return E!==f})}},assignSyncMedium:function(d){for(a=!0;s.length;){var f=s;s=[],f.forEach(d)}s={push:function(E){return d(E)},filter:function(){return s}}},assignMedium:function(d){a=!0;var f=[];if(s.length){var E=s;s=[],E.forEach(d),f=s}var S=function(){var C=f;f=[],C.forEach(d)},T=function(){return Promise.resolve().then(S)};T(),s={push:function(C){f.push(C),T()},filter:function(C){return f=f.filter(C),s}}}};return l}function Y2e(i){i===void 0&&(i={});var n=K2e(null);return n.options=gd({async:!0,ssr:!1},i),n}var hne=function(i){var n=i.sideCar,s=dne(i,["sideCar"]);if(!n)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=n.read();if(!a)throw new Error("Sidecar medium not found");return H.createElement(a,gd({},s))};hne.isSideCarExport=!0;function q2e(i,n){return i.useMedium(n),hne}var pne=Y2e(),HL=function(){},oN=H.forwardRef(function(i,n){var s=H.useRef(null),a=H.useState({onScrollCapture:HL,onWheelCapture:HL,onTouchMoveCapture:HL}),l=a[0],d=a[1],f=i.forwardProps,E=i.children,S=i.className,T=i.removeScrollBar,C=i.enabled,I=i.shards,N=i.sideCar,P=i.noRelative,W=i.noIsolation,x=i.inert,B=i.allowPinchZoom,X=i.as,Z=X===void 0?"div":X,$=i.gapMode,ae=dne(i,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),ce=N,le=H2e([s,n]),ne=gd(gd({},ae),l);return H.createElement(H.Fragment,null,C&&H.createElement(ce,{sideCar:pne,removeScrollBar:T,shards:I,noRelative:P,noIsolation:W,inert:x,setCallbacks:d,allowPinchZoom:!!B,lockRef:s,gapMode:$}),f?H.cloneElement(H.Children.only(E),gd(gd({},ne),{ref:le})):H.createElement(Z,gd({},ne,{className:S,ref:le}),E))});oN.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};oN.classNames={fullWidth:UA,zeroRight:MA};var X2e=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function J2e(){if(!document)return null;var i=document.createElement("style");i.type="text/css";var n=X2e();return n&&i.setAttribute("nonce",n),i}function $2e(i,n){i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n))}function Q2e(i){var n=document.head||document.getElementsByTagName("head")[0];n.appendChild(i)}var Z2e=function(){var i=0,n=null;return{add:function(s){i==0&&(n=J2e())&&($2e(n,s),Q2e(n)),i++},remove:function(){i--,!i&&n&&(n.parentNode&&n.parentNode.removeChild(n),n=null)}}},eUe=function(){var i=Z2e();return function(n,s){H.useEffect(function(){return i.add(n),function(){i.remove()}},[n&&s])}},fne=function(){var i=eUe(),n=function(s){var a=s.styles,l=s.dynamic;return i(a,l),null};return n},tUe={left:0,top:0,right:0,gap:0},zL=function(i){return parseInt(i||"",10)||0},nUe=function(i){var n=window.getComputedStyle(document.body),s=n[i==="padding"?"paddingLeft":"marginLeft"],a=n[i==="padding"?"paddingTop":"marginTop"],l=n[i==="padding"?"paddingRight":"marginRight"];return[zL(s),zL(a),zL(l)]},rUe=function(i){if(i===void 0&&(i="margin"),typeof window>"u")return tUe;var n=nUe(i),s=document.documentElement.clientWidth,a=window.innerWidth;return{left:n[0],top:n[1],right:n[2],gap:Math.max(0,a-s+n[2]-n[0])}},iUe=fne(),qy="data-scroll-locked",sUe=function(i,n,s,a){var l=i.left,d=i.top,f=i.right,E=i.gap;return s===void 0&&(s="margin"),`
  .`.concat(j2e,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(E,"px ").concat(a,`;
  }
  body[`).concat(qy,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([n&&"position: relative ".concat(a,";"),s==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(d,`px;
    padding-right: `).concat(f,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(E,"px ").concat(a,`;
    `),s==="padding"&&"padding-right: ".concat(E,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(MA,` {
    right: `).concat(E,"px ").concat(a,`;
  }
  
  .`).concat(UA,` {
    margin-right: `).concat(E,"px ").concat(a,`;
  }
  
  .`).concat(MA," .").concat(MA,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat(UA," .").concat(UA,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat(qy,`] {
    `).concat(B2e,": ").concat(E,`px;
  }
`)},tX=function(){var i=parseInt(document.body.getAttribute(qy)||"0",10);return isFinite(i)?i:0},oUe=function(){H.useEffect(function(){return document.body.setAttribute(qy,(tX()+1).toString()),function(){var i=tX()-1;i<=0?document.body.removeAttribute(qy):document.body.setAttribute(qy,i.toString())}},[])},aUe=function(i){var n=i.noRelative,s=i.noImportant,a=i.gapMode,l=a===void 0?"margin":a;oUe();var d=H.useMemo(function(){return rUe(l)},[l]);return H.createElement(iUe,{styles:sUe(d,!n,l,s?"":"!important")})},E2=!1;if(typeof window<"u")try{var pA=Object.defineProperty({},"passive",{get:function(){return E2=!0,!0}});window.addEventListener("test",pA,pA),window.removeEventListener("test",pA,pA)}catch{E2=!1}var yy=E2?{passive:!1}:!1,cUe=function(i){return i.tagName==="TEXTAREA"},mne=function(i,n){if(!(i instanceof Element))return!1;var s=window.getComputedStyle(i);return s[n]!=="hidden"&&!(s.overflowY===s.overflowX&&!cUe(i)&&s[n]==="visible")},lUe=function(i){return mne(i,"overflowY")},uUe=function(i){return mne(i,"overflowX")},nX=function(i,n){var s=n.ownerDocument,a=n;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var l=gne(i,a);if(l){var d=_ne(i,a),f=d[1],E=d[2];if(f>E)return!0}a=a.parentNode}while(a&&a!==s.body);return!1},dUe=function(i){var n=i.scrollTop,s=i.scrollHeight,a=i.clientHeight;return[n,s,a]},hUe=function(i){var n=i.scrollLeft,s=i.scrollWidth,a=i.clientWidth;return[n,s,a]},gne=function(i,n){return i==="v"?lUe(n):uUe(n)},_ne=function(i,n){return i==="v"?dUe(n):hUe(n)},pUe=function(i,n){return i==="h"&&n==="rtl"?-1:1},fUe=function(i,n,s,a,l){var d=pUe(i,window.getComputedStyle(n).direction),f=d*a,E=s.target,S=n.contains(E),T=!1,C=f>0,I=0,N=0;do{if(!E)break;var P=_ne(i,E),W=P[0],x=P[1],B=P[2],X=x-B-d*W;(W||X)&&gne(i,E)&&(I+=X,N+=W);var Z=E.parentNode;E=Z&&Z.nodeType===Node.DOCUMENT_FRAGMENT_NODE?Z.host:Z}while(!S&&E!==document.body||S&&(n.contains(E)||n===E));return(C&&Math.abs(I)<1||!C&&Math.abs(N)<1)&&(T=!0),T},fA=function(i){return"changedTouches"in i?[i.changedTouches[0].clientX,i.changedTouches[0].clientY]:[0,0]},rX=function(i){return[i.deltaX,i.deltaY]},iX=function(i){return i&&"current"in i?i.current:i},mUe=function(i,n){return i[0]===n[0]&&i[1]===n[1]},gUe=function(i){return`
  .block-interactivity-`.concat(i,` {pointer-events: none;}
  .allow-interactivity-`).concat(i,` {pointer-events: all;}
`)},_Ue=0,vy=[];function EUe(i){var n=H.useRef([]),s=H.useRef([0,0]),a=H.useRef(),l=H.useState(_Ue++)[0],d=H.useState(fne)[0],f=H.useRef(i);H.useEffect(function(){f.current=i},[i]),H.useEffect(function(){if(i.inert){document.body.classList.add("block-interactivity-".concat(l));var x=F2e([i.lockRef.current],(i.shards||[]).map(iX),!0).filter(Boolean);return x.forEach(function(B){return B.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),x.forEach(function(B){return B.classList.remove("allow-interactivity-".concat(l))})}}},[i.inert,i.lockRef.current,i.shards]);var E=H.useCallback(function(x,B){if("touches"in x&&x.touches.length===2||x.type==="wheel"&&x.ctrlKey)return!f.current.allowPinchZoom;var X=fA(x),Z=s.current,$="deltaX"in x?x.deltaX:Z[0]-X[0],ae="deltaY"in x?x.deltaY:Z[1]-X[1],ce,le=x.target,ne=Math.abs($)>Math.abs(ae)?"h":"v";if("touches"in x&&ne==="h"&&le.type==="range")return!1;var fe=nX(ne,le);if(!fe)return!0;if(fe?ce=ne:(ce=ne==="v"?"h":"v",fe=nX(ne,le)),!fe)return!1;if(!a.current&&"changedTouches"in x&&($||ae)&&(a.current=ce),!ce)return!0;var Se=a.current||ce;return fUe(Se,B,x,Se==="h"?$:ae)},[]),S=H.useCallback(function(x){var B=x;if(!(!vy.length||vy[vy.length-1]!==d)){var X="deltaY"in B?rX(B):fA(B),Z=n.current.filter(function(ce){return ce.name===B.type&&(ce.target===B.target||B.target===ce.shadowParent)&&mUe(ce.delta,X)})[0];if(Z&&Z.should){B.cancelable&&B.preventDefault();return}if(!Z){var $=(f.current.shards||[]).map(iX).filter(Boolean).filter(function(ce){return ce.contains(B.target)}),ae=$.length>0?E(B,$[0]):!f.current.noIsolation;ae&&B.cancelable&&B.preventDefault()}}},[]),T=H.useCallback(function(x,B,X,Z){var $={name:x,delta:B,target:X,should:Z,shadowParent:yUe(X)};n.current.push($),setTimeout(function(){n.current=n.current.filter(function(ae){return ae!==$})},1)},[]),C=H.useCallback(function(x){s.current=fA(x),a.current=void 0},[]),I=H.useCallback(function(x){T(x.type,rX(x),x.target,E(x,i.lockRef.current))},[]),N=H.useCallback(function(x){T(x.type,fA(x),x.target,E(x,i.lockRef.current))},[]);H.useEffect(function(){return vy.push(d),i.setCallbacks({onScrollCapture:I,onWheelCapture:I,onTouchMoveCapture:N}),document.addEventListener("wheel",S,yy),document.addEventListener("touchmove",S,yy),document.addEventListener("touchstart",C,yy),function(){vy=vy.filter(function(x){return x!==d}),document.removeEventListener("wheel",S,yy),document.removeEventListener("touchmove",S,yy),document.removeEventListener("touchstart",C,yy)}},[]);var P=i.removeScrollBar,W=i.inert;return H.createElement(H.Fragment,null,W?H.createElement(d,{styles:gUe(l)}):null,P?H.createElement(aUe,{noRelative:i.noRelative,gapMode:i.gapMode}):null)}function yUe(i){for(var n=null;i!==null;)i instanceof ShadowRoot&&(n=i.host,i=i.host),i=i.parentNode;return n}const vUe=q2e(pne,EUe);var Ene=H.forwardRef(function(i,n){return H.createElement(oN,gd({},i,{ref:n,sideCar:vUe}))});Ene.classNames=oN.classNames;var SUe=function(i){if(typeof document>"u")return null;var n=Array.isArray(i)?i[0]:i;return n.ownerDocument.body},Sy=new WeakMap,mA=new WeakMap,gA={},KL=0,yne=function(i){return i&&(i.host||yne(i.parentNode))},TUe=function(i,n){return n.map(function(s){if(i.contains(s))return s;var a=yne(s);return a&&i.contains(a)?a:(console.error("aria-hidden",s,"in not contained inside",i,". Doing nothing"),null)}).filter(function(s){return!!s})},wUe=function(i,n,s,a){var l=TUe(n,Array.isArray(i)?i:[i]);gA[s]||(gA[s]=new WeakMap);var d=gA[s],f=[],E=new Set,S=new Set(l),T=function(I){!I||E.has(I)||(E.add(I),T(I.parentNode))};l.forEach(T);var C=function(I){!I||S.has(I)||Array.prototype.forEach.call(I.children,function(N){if(E.has(N))C(N);else try{var P=N.getAttribute(a),W=P!==null&&P!=="false",x=(Sy.get(N)||0)+1,B=(d.get(N)||0)+1;Sy.set(N,x),d.set(N,B),f.push(N),x===1&&W&&mA.set(N,!0),B===1&&N.setAttribute(s,"true"),W||N.setAttribute(a,"true")}catch(X){console.error("aria-hidden: cannot operate on ",N,X)}})};return C(n),E.clear(),KL++,function(){f.forEach(function(I){var N=Sy.get(I)-1,P=d.get(I)-1;Sy.set(I,N),d.set(I,P),N||(mA.has(I)||I.removeAttribute(a),mA.delete(I)),P||I.removeAttribute(s)}),KL--,KL||(Sy=new WeakMap,Sy=new WeakMap,mA=new WeakMap,gA={})}},CUe=function(i,n,s){s===void 0&&(s="data-aria-hidden");var a=Array.from(Array.isArray(i)?i:[i]),l=SUe(i);return l?(a.push.apply(a,Array.from(l.querySelectorAll("[aria-live]"))),wUe(a,l,s,"aria-hidden")):function(){return null}},aN="Dialog",[vne]=Ef(aN),[RUe,fu]=vne(aN),Sne=i=>{const{__scopeDialog:n,children:s,open:a,defaultOpen:l,onOpenChange:d,modal:f=!0}=i,E=H.useRef(null),S=H.useRef(null),[T,C]=Vw({prop:a,defaultProp:l??!1,onChange:d,caller:aN});return D.jsx(RUe,{scope:n,triggerRef:E,contentRef:S,contentId:H0(),titleId:H0(),descriptionId:H0(),open:T,onOpenChange:C,onOpenToggle:H.useCallback(()=>C(I=>!I),[C]),modal:f,children:s})};Sne.displayName=aN;var Tne="DialogTrigger",wne=H.forwardRef((i,n)=>{const{__scopeDialog:s,...a}=i,l=fu(Tne,s),d=Xs(n,l.triggerRef);return D.jsx(ri.button,{type:"button","aria-haspopup":"dialog","aria-expanded":l.open,"aria-controls":l.contentId,"data-state":OV(l.open),...a,ref:d,onClick:vr(i.onClick,l.onOpenToggle)})});wne.displayName=Tne;var IV="DialogPortal",[bUe,Cne]=vne(IV,{forceMount:void 0}),Rne=i=>{const{__scopeDialog:n,forceMount:s,children:a,container:l}=i,d=fu(IV,n);return D.jsx(bUe,{scope:n,forceMount:s,children:H.Children.map(a,f=>D.jsx(Gg,{present:s||d.open,children:D.jsx(C2,{asChild:!0,container:l,children:f})}))})};Rne.displayName=IV;var RO="DialogOverlay",bne=H.forwardRef((i,n)=>{const s=Cne(RO,i.__scopeDialog),{forceMount:a=s.forceMount,...l}=i,d=fu(RO,i.__scopeDialog);return d.modal?D.jsx(Gg,{present:a||d.open,children:D.jsx(AUe,{...l,ref:n})}):null});bne.displayName=RO;var IUe=cw("DialogOverlay.RemoveScroll"),AUe=H.forwardRef((i,n)=>{const{__scopeDialog:s,...a}=i,l=fu(RO,s);return D.jsx(Ene,{as:IUe,allowPinchZoom:!0,shards:[l.contentRef],children:D.jsx(ri.div,{"data-state":OV(l.open),...a,ref:n,style:{pointerEvents:"auto",...a.style}})})}),Wg="DialogContent",Ine=H.forwardRef((i,n)=>{const s=Cne(Wg,i.__scopeDialog),{forceMount:a=s.forceMount,...l}=i,d=fu(Wg,i.__scopeDialog);return D.jsx(Gg,{present:a||d.open,children:d.modal?D.jsx(OUe,{...l,ref:n}):D.jsx(NUe,{...l,ref:n})})});Ine.displayName=Wg;var OUe=H.forwardRef((i,n)=>{const s=fu(Wg,i.__scopeDialog),a=H.useRef(null),l=Xs(n,s.contentRef,a);return H.useEffect(()=>{const d=a.current;if(d)return CUe(d)},[]),D.jsx(Ane,{...i,ref:l,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:vr(i.onCloseAutoFocus,d=>{d.preventDefault(),s.triggerRef.current?.focus()}),onPointerDownOutside:vr(i.onPointerDownOutside,d=>{const f=d.detail.originalEvent,E=f.button===0&&f.ctrlKey===!0;(f.button===2||E)&&d.preventDefault()}),onFocusOutside:vr(i.onFocusOutside,d=>d.preventDefault())})}),NUe=H.forwardRef((i,n)=>{const s=fu(Wg,i.__scopeDialog),a=H.useRef(!1),l=H.useRef(!1);return D.jsx(Ane,{...i,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:d=>{i.onCloseAutoFocus?.(d),d.defaultPrevented||(a.current||s.triggerRef.current?.focus(),d.preventDefault()),a.current=!1,l.current=!1},onInteractOutside:d=>{i.onInteractOutside?.(d),d.defaultPrevented||(a.current=!0,d.detail.originalEvent.type==="pointerdown"&&(l.current=!0));const f=d.target;s.triggerRef.current?.contains(f)&&d.preventDefault(),d.detail.originalEvent.type==="focusin"&&l.current&&d.preventDefault()}})}),Ane=H.forwardRef((i,n)=>{const{__scopeDialog:s,trapFocus:a,onOpenAutoFocus:l,onCloseAutoFocus:d,...f}=i,E=fu(Wg,s),S=H.useRef(null),T=Xs(n,S);return V2e(),D.jsxs(D.Fragment,{children:[D.jsx(lne,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:l,onUnmountAutoFocus:d,children:D.jsx(AO,{role:"dialog",id:E.contentId,"aria-describedby":E.descriptionId,"aria-labelledby":E.titleId,"data-state":OV(E.open),...f,ref:T,onDismiss:()=>E.onOpenChange(!1)})}),D.jsxs(D.Fragment,{children:[D.jsx(PUe,{titleId:E.titleId}),D.jsx(DUe,{contentRef:S,descriptionId:E.descriptionId})]})]})}),AV="DialogTitle",One=H.forwardRef((i,n)=>{const{__scopeDialog:s,...a}=i,l=fu(AV,s);return D.jsx(ri.h2,{id:l.titleId,...a,ref:n})});One.displayName=AV;var Nne="DialogDescription",Pne=H.forwardRef((i,n)=>{const{__scopeDialog:s,...a}=i,l=fu(Nne,s);return D.jsx(ri.p,{id:l.descriptionId,...a,ref:n})});Pne.displayName=Nne;var kne="DialogClose",Dne=H.forwardRef((i,n)=>{const{__scopeDialog:s,...a}=i,l=fu(kne,s);return D.jsx(ri.button,{type:"button",...a,ref:n,onClick:vr(i.onClick,()=>l.onOpenChange(!1))})});Dne.displayName=kne;function OV(i){return i?"open":"closed"}var xne="DialogTitleWarning",[lFe,Lne]=Yme(xne,{contentName:Wg,titleName:AV,docsSlug:"dialog"}),PUe=({titleId:i})=>{const n=Lne(xne),s=`\`${n.contentName}\` requires a \`${n.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${n.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${n.docsSlug}`;return H.useEffect(()=>{i&&(document.getElementById(i)||console.error(s))},[s,i]),null},kUe="DialogDescriptionWarning",DUe=({contentRef:i,descriptionId:n})=>{const a=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${Lne(kUe).contentName}}.`;return H.useEffect(()=>{const l=i.current?.getAttribute("aria-describedby");n&&l&&(document.getElementById(n)||console.warn(a))},[a,i,n]),null},Mne=Sne,xUe=wne,Une=Rne,cN=bne,lN=Ine,uN=One,dN=Pne,Vne=Dne;const LUe=Mne,MUe=xUe,UUe=Une,Fne=H.forwardRef(({className:i,...n},s)=>D.jsx(cN,{className:Br("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",i),...n,ref:s}));Fne.displayName=cN.displayName;const VUe=A2("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),jne=H.forwardRef(({side:i="right",className:n,children:s,...a},l)=>D.jsxs(UUe,{children:[D.jsx(Fne,{}),D.jsxs(lN,{ref:l,className:Br(VUe({side:i}),n),...a,children:[s,D.jsxs(Vne,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-secondary hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[D.jsx(DO,{className:"h-4 w-4"}),D.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));jne.displayName=lN.displayName;const FUe=H.forwardRef(({className:i,...n},s)=>D.jsx(uN,{ref:s,className:Br("text-lg font-semibold text-foreground",i),...n}));FUe.displayName=uN.displayName;const jUe=H.forwardRef(({className:i,...n},s)=>D.jsx(dN,{ref:s,className:Br("text-sm text-muted-foreground",i),...n}));jUe.displayName=dN.displayName;const BUe=()=>Math.random().toString(36).substring(2,9)+Date.now().toString(36),sX=()=>{const[i,n]=H.useState([]),[s,a]=H.useState(null),[l,d]=H.useState([]),[f,E]=H.useState(""),[S,T]=H.useState(!1),[C,I]=H.useState(()=>localStorage.getItem("google-gemini-key")||void 0||null),[N,P]=H.useState(!C),[W,x]=H.useState(""),B=H.useRef(!1),X=H.useRef(null);H.useEffect(()=>{const be=localStorage.getItem("aitutor-conversations");be&&n(JSON.parse(be))},[]),H.useEffect(()=>{localStorage.setItem("aitutor-conversations",JSON.stringify(i))},[i]),H.useEffect(()=>{if(s){if(B.current){B.current=!1;return}const be=localStorage.getItem(`aitutor-messages-${s}`);d(be?JSON.parse(be):[])}else l.length>0&&d([])},[s]);const Z=(be,ye)=>{localStorage.setItem(`aitutor-messages-${be}`,JSON.stringify(ye))},$=()=>{a(null),d([]),E("")},ae=(be,ye)=>{be.stopPropagation();const Ge=i.filter(Te=>Te.id!==ye);n(Ge),localStorage.removeItem(`aitutor-messages-${ye}`),s===ye&&$()},ce=be=>{a(be)},le=()=>{X.current?.scrollIntoView({behavior:"smooth"})};H.useEffect(()=>{le()},[l,S]);const ne=async(be,ye,Ge)=>{T(!0);try{if(!C){const He=` **AI Key Required**

Please set up your Google Gemini API Key to continue.`;d(re=>[...re,{role:"assistant",content:He,timestamp:Date.now()}]),P(!0);return}const Je=new N2e(C).getGenerativeModel({model:"gemini-1.5-flash",systemInstruction:"You are the KLE AI Tutor, a friendly and enthusiastic academic companion for students. Style Guide: Use emojis occasionally . Format with clear Markdown. ALWAYS end with a follow-up question."}).startChat({history:Ge.slice(0,-1).map(He=>({role:He.role==="user"?"user":"model",parts:[{text:He.content}]}))});d(He=>[...He,{role:"assistant",content:"",timestamp:Date.now()}]);const je=await Je.sendMessageStream(be);let Ie="";for await(const He of je.stream){const re=He.text();Ie+=re,d(ge=>{const Oe=[...ge],ue=Oe.length-1;return ue>=0&&Oe[ue].role==="assistant"&&(Oe[ue]={...Oe[ue],content:Ie}),Oe})}}catch(Te){console.error("CRITICAL AI ERROR:",Te);let Fe=`**AI Service Error**

${Te.message||"An unexpected error occurred while connecting to Gemini."}`;d(Je=>{const je=[...Je],Ie=je.length-1;return Ie>=0&&je[Ie].role==="assistant"?je[Ie]={...je[Ie],content:Fe}:je.push({role:"assistant",content:Fe,timestamp:Date.now()}),je})}finally{T(!1),d(Te=>(Z(ye,Te),Te))}},fe=async()=>{if(console.log("handleSend triggered with input:",f),!f.trim()||S)return;const be=f.trim(),ye=Date.now();let Ge=s;if(!Ge){Ge=BUe(),B.current=!0;const Je={id:Ge,title:be.slice(0,30)+(be.length>30?"...":""),createdAt:ye};n(je=>[Je,...je]),a(Ge)}const Te={role:"user",content:be,timestamp:ye},Fe=[...l,Te];d(Fe),E(""),Z(Ge,Fe),await ne(be,Ge,Fe)},Se=["Explain Binary Search Trees","What is Big O notation?","Generate a study plan for DBMS","Quiz me on Operating Systems"],De=()=>D.jsxs("div",{className:"flex flex-col h-full bg-card/30 backdrop-blur-xl border-r border-border/50",children:[D.jsx("div",{className:"p-4",children:D.jsxs(Jn,{onClick:$,className:"w-full justify-start gap-2 bg-primary/10 hover:bg-primary/20 text-primary border border-primary/20",variant:"ghost",children:[D.jsx(zX,{className:"w-4 h-4"}),"New Chat"]})}),D.jsxs("div",{className:"flex-1 overflow-y-auto px-2 space-y-1 custom-scrollbar",children:[i.length===0&&D.jsx("div",{className:"text-center text-xs text-muted-foreground p-4",children:"No history yet."}),i.map(be=>D.jsxs("div",{onClick:()=>ce(be.id),className:Br("group flex items-center gap-3 p-3 rounded-xl cursor-pointer transition-all hover:bg-muted/50 text-sm",s===be.id?"bg-muted font-medium text-foreground":"text-muted-foreground"),children:[D.jsx(WX,{className:"w-4 h-4 shrink-0"}),D.jsx("span",{className:"truncate flex-1 text-left",children:be.title}),D.jsx("button",{onClick:ye=>ae(ye,be.id),className:"opacity-0 group-hover:opacity-100 hover:text-destructive transition-opacity p-1",children:D.jsx(__e,{className:"w-3 h-3"})})]},be.id))]})]});return D.jsx(Tc,{children:D.jsxs("div",{className:"flex h-[calc(100vh-140px)] gap-4 overflow-hidden",children:[D.jsx("div",{className:"hidden md:block w-64 glass rounded-2xl overflow-hidden shrink-0",children:D.jsx(De,{})}),D.jsx("div",{className:"md:hidden absolute top-24 left-4 z-50",children:D.jsxs(LUe,{children:[D.jsx(MUe,{asChild:!0,children:D.jsx(Jn,{variant:"outline",size:"icon",className:"glass",children:D.jsx(c_e,{className:"w-4 h-4"})})}),D.jsx(jne,{side:"left",className:"p-0 w-72 pt-10",children:D.jsx(De,{})})]})}),D.jsxs("div",{className:"flex-1 flex flex-col glass rounded-2xl relative overflow-hidden",children:[D.jsxs("div",{className:"p-4 md:p-6 pb-2 md:pb-6 flex items-start justify-between gap-4",children:[D.jsx(pu,{icon:Dy,title:"GEMINI AI TUTOR",subtitle:"Your 24/7 AI-powered study companion",gradient:"linear-gradient(135deg, hsl(263 70% 58% / 0.3), hsl(263 70% 58% / 0.1))"}),D.jsxs(Jn,{variant:"outline",size:"sm",className:"glass gap-2 hover:bg-primary/10 mt-1",onClick:()=>P(!0),children:[D.jsx(SK,{className:"w-3.5 h-3.5"}),C?"Change Key":"Set API Key"]})]}),D.jsx(LU,{children:N&&D.jsx(Bn.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-50 flex items-center justify-center p-4 bg-background/80 backdrop-blur-md",children:D.jsx(Bn.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},className:"glass p-8 rounded-3xl max-w-md w-full shadow-2xl border-primary/20",children:D.jsxs("div",{className:"flex flex-col items-center text-center",children:[D.jsx("div",{className:"w-16 h-16 rounded-2xl bg-primary/10 flex items-center justify-center mb-6",children:D.jsx(SK,{className:"w-8 h-8 text-primary"})}),D.jsx("h3",{className:"text-2xl font-bold mb-2 font-display",children:"Unlock the AI Tutor"}),D.jsx("p",{className:"text-muted-foreground mb-8 text-sm",children:"To keep this app free for everyone, please use your own Gemini API key. It's fast, free for students, and stays only in your browser."}),D.jsxs("div",{className:"w-full space-y-4",children:[D.jsxs("div",{className:"space-y-1.5",children:[D.jsx("label",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider ml-1",children:"Paste your Gemini API Key"}),D.jsx("input",{type:"password",value:W,onChange:be=>x(be.target.value),placeholder:"AIzaSy...",className:"w-full bg-background/50 border border-border rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-primary/20 outline-none transition-all"})]}),D.jsx(Jn,{onClick:()=>{if(!W.startsWith("AIza")){WA.error("Invalid API Key format");return}localStorage.setItem("google-gemini-key",W),I(W),P(!1),WA.success("AI Tutor Unlocked!")},className:"w-full h-12 rounded-xl bg-primary text-primary-foreground font-bold hover:scale-[1.02] transition-transform",children:"Start Learning"}),D.jsxs("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 text-xs text-primary hover:underline pt-2 font-medium",children:["Get your free key from Google AI Studio ",D.jsx($ge,{className:"w-3 h-3"})]})]})]})})})}),D.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[!s&&l.length===0?D.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center p-8 opacity-80",children:[D.jsx("div",{className:"w-20 h-20 rounded-3xl bg-primary/10 flex items-center justify-center mb-6 animate-pulse",children:D.jsx(f_e,{className:"w-10 h-10 text-primary"})}),D.jsx("h3",{className:"text-xl font-bold font-display mb-2",children:"Hello, Student! "}),D.jsx("p",{className:"text-muted-foreground max-w-sm mb-8",children:"I'm here to help you ace your exams. Ask me about concepts, code, or request a quick quiz!"}),D.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 w-full max-w-lg",children:Se.map(be=>D.jsx("button",{onClick:()=>{E(be)},className:"text-sm p-3 rounded-xl bg-muted/50 hover:bg-primary/10 hover:border-primary/30 border border-transparent transition-all text-left truncate",children:be},be))})]}):D.jsx(D.Fragment,{children:l.map((be,ye)=>{const Ge=be.role==="user",Te=!Ge&&ye===l.length-1;return D.jsx(Bn.div,{initial:{opacity:0,y:10,scale:.98},animate:{opacity:1,y:0,scale:1},className:Br("flex w-full mb-4",Ge?"justify-end":"justify-start"),children:D.jsxs("div",{className:Br("flex gap-3 max-w-[85%] md:max-w-[75%]",Ge?"flex-row-reverse":"flex-row"),children:[D.jsx("div",{className:Br("min-w-8 w-8 h-8 rounded-full flex items-center justify-center mt-1 border shrink-0 shadow-sm",Ge?"bg-primary/20 border-primary/30":"bg-indigo-500/20 border-indigo-500/30"),children:Ge?D.jsx(kO,{className:"w-4 h-4 text-primary"}):D.jsx(Dy,{className:"w-4 h-4 text-indigo-500"})}),D.jsx("div",{className:Br("p-4 rounded-2xl text-sm leading-relaxed shadow-md transition-all hover:shadow-lg",Ge?"bg-primary text-primary-foreground rounded-tr-none shadow-primary/10":"ai-bubble-gradient border border-border/50 rounded-tl-none shadow-black/5"),children:D.jsxs("div",{className:Br("prose prose-sm max-w-none break-words",Ge?"prose-invert":"dark:prose-invert prose-p:text-foreground/90"),children:[D.jsx(JMe,{children:be.content}),Te&&S&&D.jsx("span",{className:"cursor-blink"})]})})]})},ye)})}),D.jsx("div",{ref:X})]}),D.jsxs("div",{className:"p-4 border-t border-border/40 bg-background/50 backdrop-blur-sm",children:[D.jsxs("div",{className:"flex gap-3 items-end max-w-4xl mx-auto",children:[D.jsxs("div",{className:"relative flex-1",children:[D.jsx(dV,{value:f,onChange:be=>E(be.target.value),onKeyDown:be=>{be.key==="Enter"&&!be.shiftKey&&(be.preventDefault(),fe())},placeholder:"Type your question...",className:"min-h-[50px] max-h-[120px] pr-12 resize-none rounded-xl bg-muted/50 border-input focus:ring-primary/20"}),f&&D.jsx("button",{onClick:()=>E(""),className:"absolute top-3 right-3 text-muted-foreground hover:text-foreground",children:D.jsx(DO,{className:"w-4 h-4"})})]}),D.jsx(Jn,{onClick:fe,disabled:!f.trim()||S,className:"h-[50px] w-[50px] rounded-xl bg-primary hover:bg-primary/90 shrink-0",children:D.jsx(KX,{className:"w-5 h-5"})})]}),D.jsx("p",{className:"text-center text-[10px] text-muted-foreground mt-2",children:"AI can make mistakes. Check important info."})]})]})]})})},WUe=()=>{const[i,n]=H.useState([]),[s,a]=H.useState(!1),[l,d]=H.useState({title:"",subject:"",link:""});H.useEffect(()=>{const I=localStorage.getItem("kle-connect-notes");n(I?JSON.parse(I):[])},[]),H.useEffect(()=>{localStorage.setItem("kle-connect-notes",JSON.stringify(i))},[i]);const f=()=>{if(!l.title||!l.subject)return;const I={id:crypto.randomUUID(),title:l.title,subject:l.subject,link:l.link||"#",rating:5,downloads:0};n([I,...i]),d({title:"",subject:"",link:""}),a(!1)},E=I=>{n(i.filter(N=>N.id!==I))},T=Array.from(new Set(i.map(I=>I.subject))).map(I=>({name:I,notes:i.filter(N=>N.subject===I).length,color:`hsl(${Math.random()*360} 70% 50%)`})),C=["Data Structures","Operating Systems","Computer Networks","Database Systems","Machine Learning"];return D.jsxs(Tc,{children:[D.jsx(pu,{icon:jA,title:"Notes & PYQs",subtitle:"Manage and share your study resources",gradient:"linear-gradient(135deg, hsl(142 76% 36% / 0.3), hsl(142 76% 36% / 0.1))"}),T.length>0&&D.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8",children:T.map((I,N)=>D.jsxs(Bn.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3,delay:N*.05},className:"glass rounded-2xl p-4 cursor-pointer hover:scale-105 transition-transform",children:[D.jsx("div",{className:"w-10 h-10 rounded-xl mb-3 flex items-center justify-center",style:{background:`${I.color}33`},children:D.jsx(Qge,{className:"w-5 h-5",style:{color:I.color}})}),D.jsx("h3",{className:"text-sm font-medium text-foreground mb-1 line-clamp-2",children:I.name}),D.jsx("div",{className:"flex gap-2 text-xs text-muted-foreground",children:D.jsxs("span",{children:[I.notes," items"]})})]},I.name))}),D.jsxs("div",{className:"flex items-center justify-between mb-4",children:[D.jsx("h2",{className:"text-xl font-semibold text-foreground font-display",children:"Shared Resources"}),D.jsxs(Jn,{onClick:()=>a(!s),className:"gap-2",children:[D.jsx(yK,{className:"w-4 h-4 rotate-180"})," Upload Resource"]})]}),s&&D.jsxs(Bn.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"glass p-6 rounded-xl mb-6 border border-primary/20",children:[D.jsx("h3",{className:"font-semibold mb-4",children:"Add New Material"}),D.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[D.jsx("input",{className:"p-3 bg-muted/50 rounded-lg border border-transparent focus:border-primary outline-none",placeholder:"Title (e.g. Unit 1 Notes)",value:l.title,onChange:I=>d({...l,title:I.target.value})}),D.jsxs("div",{className:"relative",children:[D.jsx("input",{className:"w-full p-3 bg-muted/50 rounded-lg border border-transparent focus:border-primary outline-none",placeholder:"Subject (e.g. AI)",value:l.subject,onChange:I=>d({...l,subject:I.target.value})}),D.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:C.map(I=>D.jsx("button",{onClick:()=>d(N=>({...N,subject:I})),className:"text-[10px] px-2 py-1 bg-primary/10 text-primary rounded-full hover:bg-primary/20",children:I},I))})]}),D.jsx("input",{className:"p-3 bg-muted/50 rounded-lg border border-transparent focus:border-primary outline-none",placeholder:"Link (Google Drive / URL)",value:l.link,onChange:I=>d({...l,link:I.target.value})})]}),D.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[D.jsx(Jn,{variant:"ghost",onClick:()=>a(!1),children:"Cancel"}),D.jsx(Jn,{onClick:f,disabled:!l.title||!l.subject,children:"Share Resource"})]})]}),D.jsxs("div",{className:"space-y-3",children:[i.length===0&&D.jsx("div",{className:"text-center py-12 text-muted-foreground",children:D.jsx("p",{children:"No notes shared yet. Key start the knowledge exchange! "})}),i.map((I,N)=>D.jsxs(Bn.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:N*.1},className:"glass rounded-xl p-4 flex items-center justify-between group",children:[D.jsxs("div",{className:"flex items-center gap-4",children:[D.jsx("div",{className:"w-12 h-12 rounded-xl bg-primary/10 flex items-center justify-center",children:D.jsx(jA,{className:"w-6 h-6 text-primary"})}),D.jsxs("div",{children:[D.jsx("h3",{className:"text-foreground font-medium",children:I.title}),D.jsx("p",{className:"text-sm text-muted-foreground",children:I.subject})]})]}),D.jsxs("div",{className:"flex items-center gap-4",children:[D.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[D.jsx(qX,{className:"w-4 h-4 text-yellow-500 fill-yellow-500"}),D.jsx("span",{className:"text-foreground",children:I.rating})]}),D.jsx(Jn,{size:"sm",variant:"outline",className:"gap-2",asChild:!0,children:D.jsxs("a",{href:I.link,target:"_blank",rel:"noopener noreferrer",children:[D.jsx(yK,{className:"w-4 h-4"})," Open"]})}),D.jsx("button",{onClick:()=>E(I.id),className:"opacity-0 group-hover:opacity-100 text-muted-foreground hover:text-destructive transition-opacity px-2",children:""})]})]},I.id))]})]})},GUe=()=>{const[i,n]=H.useState([]),[s,a]=H.useState(""),[l,d]=H.useState(""),[f,E]=H.useState(!1);H.useEffect(()=>{const P=localStorage.getItem("study-planner-tasks");n(P?JSON.parse(P):[])},[]),H.useEffect(()=>{localStorage.setItem("study-planner-tasks",JSON.stringify(i))},[i]);const S=()=>{if(!s.trim())return;const P={id:crypto.randomUUID(),title:s,time:l||"Anytime",completed:!1};n([...i,P]),a(""),d(""),E(!1)},T=P=>{n(i.map(W=>W.id===P?{...W,completed:!W.completed}:W))},C=P=>{n(i.filter(W=>W.id!==P))},I=i.filter(P=>P.completed).length,N=i.length>0?Math.round(I/i.length*100):0;return D.jsxs(Tc,{children:[D.jsx(pu,{icon:O2,title:"Study Planner",subtitle:"Track your daily academic goals",gradient:"linear-gradient(135deg, hsl(45 93% 47% / 0.3), hsl(45 93% 47% / 0.1))"}),D.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[D.jsxs(Bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"lg:col-span-2",children:[D.jsxs("div",{className:"flex items-center justify-between mb-4",children:[D.jsx("h2",{className:"text-xl font-semibold text-foreground font-display",children:"Today's Tasks"}),D.jsxs(Jn,{size:"sm",onClick:()=>E(!f),className:"gap-2 bg-primary hover:bg-primary/90",children:[D.jsx(zX,{className:"w-4 h-4"}),"Add Task"]})]}),f&&D.jsx(Bn.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"glass p-4 rounded-xl mb-4 border border-primary/20",children:D.jsxs("div",{className:"flex gap-2",children:[D.jsx("input",{className:"flex-1 bg-transparent border-b border-border focus:border-primary outline-none px-2 py-1",placeholder:"Task description...",value:s,onChange:P=>a(P.target.value),autoFocus:!0}),D.jsx("input",{className:"w-24 bg-transparent border-b border-border focus:border-primary outline-none px-2 py-1 text-sm",placeholder:"Time (opt)",value:l,onChange:P=>d(P.target.value)}),D.jsx(Jn,{size:"sm",onClick:S,children:"Save"})]})}),D.jsxs("div",{className:"glass rounded-2xl p-6 space-y-4 min-h-[300px]",children:[i.length===0&&D.jsx("div",{className:"text-center text-muted-foreground py-10",children:D.jsx("p",{children:"No tasks yet. Enjoy your free time! "})}),i.map((P,W)=>D.jsxs(Bn.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},layout:!0,className:`flex items-center gap-4 p-4 rounded-xl transition-colors group ${P.completed?"bg-primary/5 opacity-60":"bg-muted/50 hover:bg-muted/80"}`,children:[D.jsx("button",{onClick:()=>T(P.id),children:P.completed?D.jsx(VX,{className:"w-6 h-6 text-primary flex-shrink-0"}):D.jsx(Xge,{className:"w-6 h-6 text-muted-foreground flex-shrink-0 hover:text-primary transition-colors"})}),D.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>T(P.id),children:[D.jsx("h3",{className:`font-medium ${P.completed?"line-through":""}`,children:P.title}),D.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[D.jsx(lw,{className:"w-3 h-3"}),D.jsx("span",{children:P.time})]})]}),D.jsx("button",{onClick:()=>C(P.id),className:"opacity-0 group-hover:opacity-100 text-muted-foreground hover:text-destructive transition-all p-2",children:""})]},P.id))]})]}),D.jsxs(Bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:[D.jsx("h2",{className:"text-xl font-semibold text-foreground mb-4 font-display",children:"Daily Progress"}),D.jsxs("div",{className:"glass rounded-2xl p-6 flex flex-col items-center text-center",children:[D.jsxs("div",{className:"relative w-32 h-32 flex items-center justify-center mb-4",children:[D.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[D.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"currentColor",strokeWidth:"8",fill:"transparent",className:"text-muted/20"}),D.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"currentColor",strokeWidth:"8",fill:"transparent",strokeDasharray:351,strokeDashoffset:351-351*N/100,className:"text-primary transition-all duration-1000 ease-out",strokeLinecap:"round"})]}),D.jsxs("span",{className:"absolute text-2xl font-bold",children:[N,"%"]})]}),D.jsx("h3",{className:"text-lg font-medium mb-1",children:N===100?"All Done! ":N>50?"Great going!":"Keep pushing!"}),D.jsxs("p",{className:"text-sm text-muted-foreground",children:[I," of ",i.length," tasks completed"]})]})]})]})]})};var HUe=Object.create,NV=Object.defineProperty,zUe=Object.getOwnPropertyDescriptor,KUe=Object.getOwnPropertyNames,YUe=Object.getPrototypeOf,qUe=Object.prototype.hasOwnProperty,XUe=(i,n)=>()=>(n||i((n={exports:{}}).exports,n),n.exports),JUe=(i,n)=>{for(var s in n)NV(i,s,{get:n[s],enumerable:!0})},Bne=(i,n,s,a)=>{if(n&&typeof n=="object"||typeof n=="function")for(let l of KUe(n))!qUe.call(i,l)&&l!==s&&NV(i,l,{get:()=>n[l],enumerable:!(a=zUe(n,l))||a.enumerable});return i},$Ue=(i,n,s)=>(Bne(i,n,"default"),s),Yg=(i,n,s)=>(s=i!=null?HUe(YUe(i)):{},Bne(!i||!i.__esModule?NV(s,"default",{value:i,enumerable:!0}):s,i)),qg=XUe((i,n)=>{(function(s,a){typeof i=="object"&&typeof n<"u"?n.exports=a():typeof define=="function"&&define.amd?define(a):(s=typeof globalThis<"u"?globalThis:s||self).AgoraRTC=a()})(i,function(){function s(e,t){return t.forEach(function(r){r&&typeof r!="string"&&!Array.isArray(r)&&Object.keys(r).forEach(function(o){if(o!=="default"&&!(o in e)){var c=Object.getOwnPropertyDescriptor(r,o);Object.defineProperty(e,o,c.get?c:{enumerable:!0,get:function(){return r[o]}})}})}),Object.freeze(e)}var a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function l(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var d=function(e){try{return!!e()}catch{return!0}},f=!d(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),E=f,S=Function.prototype,T=S.call,C=E&&S.bind.bind(T,T),I=E?C:function(e){return function(){return T.apply(e,arguments)}},N=I({}.isPrototypeOf),P=function(e){return e&&e.Math===Math&&e},W=P(typeof globalThis=="object"&&globalThis)||P(typeof window=="object"&&window)||P(typeof self=="object"&&self)||P(typeof a=="object"&&a)||P(typeof a=="object"&&a)||(function(){return this})()||Function("return this")(),x=f,B=Function.prototype,X=B.apply,Z=B.call,$=typeof Reflect=="object"&&Reflect.apply||(x?Z.bind(X):function(){return Z.apply(X,arguments)}),ae=I,ce=ae({}.toString),le=ae("".slice),ne=function(e){return le(ce(e),8,-1)},fe=ne,Se=I,De=function(e){if(fe(e)==="Function")return Se(e)},be=typeof document=="object"&&document.all,ye=be===void 0&&be!==void 0?function(e){return typeof e=="function"||e===be}:function(e){return typeof e=="function"},Ge={},Te=!d(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),Fe=f,Je=Function.prototype.call,je=Fe?Je.bind(Je):function(){return Je.apply(Je,arguments)},Ie={},He={}.propertyIsEnumerable,re=Object.getOwnPropertyDescriptor,ge=re&&!He.call({1:2},1);Ie.f=ge?function(e){var t=re(this,e);return!!t&&t.enumerable}:He;var Oe,ue,it=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},yt=d,Dt=ne,At=Object,dn=I("".split),Cn=yt(function(){return!At("z").propertyIsEnumerable(0)})?function(e){return Dt(e)==="String"?dn(e,""):At(e)}:At,fr=function(e){return e==null},as=fr,Jr=TypeError,Mr=function(e){if(as(e))throw new Jr("Can't call method on "+e);return e},wc=Cn,fl=Mr,yi=function(e){return wc(fl(e))},Cc=ye,Wr=function(e){return typeof e=="object"?e!==null:Cc(e)},fi={},$s=fi,gs=W,Rc=ye,Qs=function(e){return Rc(e)?e:void 0},Ir=function(e,t){return arguments.length<2?Qs($s[e])||Qs(gs[e]):$s[e]&&$s[e][t]||gs[e]&&gs[e][t]},Fo=W.navigator,Xe=Fo&&Fo.userAgent,lt=Xe?String(Xe):"",Kt=W,an=lt,Nn=Kt.process,ii=Kt.Deno,Zs=Nn&&Nn.versions||ii&&ii.version,$r=Zs&&Zs.v8;$r&&(ue=(Oe=$r.split("."))[0]>0&&Oe[0]<4?1:+(Oe[0]+Oe[1])),!ue&&an&&(!(Oe=an.match(/Edge\/(\d+)/))||Oe[1]>=74)&&(Oe=an.match(/Chrome\/(\d+)/))&&(ue=+Oe[1]);var mi=ue,Eo=mi,Gr=d,yo=W.String,vi=!!Object.getOwnPropertySymbols&&!Gr(function(){var e=Symbol("symbol detection");return!yo(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Eo&&Eo<41}),ia=vi&&!Symbol.sham&&typeof Symbol.iterator=="symbol",ml=Ir,sa=ye,vo=N,jo=Object,ja=ia?function(e){return typeof e=="symbol"}:function(e){var t=ml("Symbol");return sa(t)&&vo(t.prototype,jo(e))},mn=String,Wn=function(e){try{return mn(e)}catch{return"Object"}},mr=ye,$i=Wn,Ls=TypeError,kr=function(e){if(mr(e))return e;throw new Ls($i(e)+" is not a function")},Ee=kr,Ae=fr,We=function(e,t){var r=e[t];return Ae(r)?void 0:Ee(r)},st=je,St=ye,Yt=Wr,hn=TypeError,Ut={exports:{}},Gt=W,xt=Object.defineProperty,Vt=W,Rn=function(e,t){try{xt(Gt,e,{value:t,configurable:!0,writable:!0})}catch{Gt[e]=t}return t},Yn="__core-js_shared__",Qi=Ut.exports=Vt[Yn]||Rn(Yn,{});(Qi.versions||(Qi.versions=[])).push({version:"3.46.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.46.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Sr=Ut.exports,ir=Sr,Ar=function(e,t){return ir[e]||(ir[e]=t||{})},gl=Mr,Pd=Object,Zi=function(e){return Pd(gl(e))},gr=Zi,If=I({}.hasOwnProperty),Ur=Object.hasOwn||function(e,t){return If(gr(e),t)},bc=I,_l=0,Oh=Math.random(),sr=bc(1.1.toString),Dr=function(e){return"Symbol("+(e===void 0?"":e)+")_"+sr(++_l+Oh,36)},bs=Ar,mu=Ur,_r=Dr,gu=vi,$g=ia,_u=W.Symbol,Nh=bs("wks"),Qg=$g?_u.for||_u:_u&&_u.withoutSetter||_r,Er=function(e){return mu(Nh,e)||(Nh[e]=gu&&mu(_u,e)?_u[e]:Qg("Symbol."+e)),Nh[e]},Zg=je,nC=Wr,rC=ja,wv=We,iC=function(e,t){var r,o;if(St(r=e.toString)&&!Yt(o=st(r,e))||St(r=e.valueOf)&&!Yt(o=st(r,e))||t!=="string")return o;throw new hn("Can't convert object to primitive value")},Cv=TypeError,Af=Er("toPrimitive"),gN=function(e,t){if(!nC(e)||rC(e))return e;var r,o=wv(e,Af);if(o){if(r=Zg(o,e,t),!nC(r)||rC(r))return r;throw new Cv("Can't convert object to primitive value")}return iC(e,t)},Rv=ja,Tr=function(e){var t=gN(e,"string");return Rv(t)?t:t+""},bv=Wr,e_=W.document,Iv=bv(e_)&&bv(e_.createElement),t_=function(e){return Iv?e_.createElement(e):{}},sC=t_,Av=!Te&&!d(function(){return Object.defineProperty(sC("div"),"a",{get:function(){return 7}}).a!==7}),Ov=Te,n_=je,Eu=Ie,yu=it,vu=yi,Of=Tr,Nf=Ur,Su=Av,oC=Object.getOwnPropertyDescriptor;Ge.f=Ov?oC:function(e,t){if(e=vu(e),t=Of(t),Su)try{return oC(e,t)}catch{}if(Nf(e,t))return yu(!n_(Eu.f,e,t),e[t])};var aC=d,Pf=ye,_N=/#|\.prototype\./,Ph=function(e,t){var r=cC[r_(e)];return r===kf||r!==EN&&(Pf(t)?aC(t):!!t)},r_=Ph.normalize=function(e){return String(e).replace(_N,".").toLowerCase()},cC=Ph.data={},EN=Ph.NATIVE="N",kf=Ph.POLYFILL="P",kh=Ph,Dh=kr,i_=f,yN=De(De.bind),Tu=function(e,t){return Dh(e),t===void 0?e:i_?yN(e,t):function(){return e.apply(t,arguments)}},So={},Df=Te&&d(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),Nv=Wr,lC=String,wu=TypeError,Is=function(e){if(Nv(e))return e;throw new wu(lC(e)+" is not an object")},s_=Te,uC=Av,o_=Df,kd=Is,Pv=Tr,Bo=TypeError,Cu=Object.defineProperty,kv=Object.getOwnPropertyDescriptor,Dd="enumerable",Dv="configurable",xf="writable";So.f=s_?o_?function(e,t,r){if(kd(e),t=Pv(t),kd(r),typeof e=="function"&&t==="prototype"&&"value"in r&&xf in r&&!r[xf]){var o=kv(e,t);o&&o[xf]&&(e[t]=r.value,r={configurable:Dv in r?r[Dv]:o[Dv],enumerable:Dd in r?r[Dd]:o[Dd],writable:!1})}return Cu(e,t,r)}:Cu:function(e,t,r){if(kd(e),t=Pv(t),kd(r),uC)try{return Cu(e,t,r)}catch{}if("get"in r||"set"in r)throw new Bo("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var xv=So,Lf=it,Ic=Te?function(e,t,r){return xv.f(e,t,Lf(1,r))}:function(e,t,r){return e[t]=r,e},xh=W,vN=$,SN=De,TN=ye,Lv=Ge.f,wN=kh,Lh=fi,CN=Tu,Mh=Ic,dC=Ur,hC=function(e){var t=function(r,o,c){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,o)}return new e(r,o,c)}return vN(e,this,arguments)};return t.prototype=e.prototype,t},Sn=function(e,t){var r,o,c,u,h,m,g,y,v,R=e.target,b=e.global,A=e.stat,F=e.proto,M=b?xh:A?xh[R]:xh[R]&&xh[R].prototype,j=b?Lh:Lh[R]||Mh(Lh,R,{})[R],K=j.prototype;for(u in t)o=!(r=wN(b?u:R+(A?".":"#")+u,e.forced))&&M&&dC(M,u),m=j[u],o&&(g=e.dontCallGetSet?(v=Lv(M,u))&&v.value:M[u]),h=o&&g?g:t[u],(r||F||typeof m!=typeof h)&&(y=e.bind&&o?CN(h,xh):e.wrap&&o?hC(h):F&&TN(h)?SN(h):h,(e.sham||h&&h.sham||m&&m.sham)&&Mh(y,"sham",!0),Mh(j,u,y),F&&(dC(Lh,c=R+"Prototype")||Mh(Lh,c,{}),Mh(Lh[c],u,h),e.real&&K&&(r||!K[u])&&Mh(K,u,h)))},RN=Math.ceil,bN=Math.floor,IN=Math.trunc||function(e){var t=+e;return(t>0?bN:RN)(t)},Mv=IN,Uv=function(e){var t=+e;return t!=t||t===0?0:Mv(t)},AN=Uv,ON=Math.max,pC=Math.min,Vv=function(e,t){var r=AN(e);return r<0?ON(r+t,0):pC(r,t)},NN=Uv,PN=Math.min,fC=function(e){var t=NN(e);return t>0?PN(t,9007199254740991):0},kN=fC,Ru=function(e){return kN(e.length)},DN=yi,Fv=Vv,Mf=Ru,mC=function(e){return function(t,r,o){var c=DN(t),u=Mf(c);if(u===0)return!e&&-1;var h,m=Fv(o,u);if(e&&r!=r){for(;u>m;)if((h=c[m++])!=h)return!0}else for(;u>m;m++)if((e||m in c)&&c[m]===r)return e||m||0;return!e&&-1}},a_={includes:mC(!0),indexOf:mC(!1)},gC=a_.includes;Sn({target:"Array",proto:!0,forced:d(function(){return!Array(1).includes()})},{includes:function(e){return gC(this,e,arguments.length>1?arguments[1]:void 0)}});var _C=W,EC=fi,To=function(e,t){var r=EC[e+"Prototype"],o=r&&r[t];if(o)return o;var c=_C[e],u=c&&c.prototype;return u&&u[t]},Uh=To("Array","includes"),xN=Wr,LN=ne,MN=Er("match"),c_=function(e){var t;return xN(e)&&((t=e[MN])!==void 0?!!t:LN(e)==="RegExp")},yC=c_,Uf=TypeError,Vh={};Vh[Er("toStringTag")]="z";var jv=String(Vh)==="[object z]",l_=jv,UN=ye,Vf=ne,Bv=Er("toStringTag"),Wv=Object,vC=Vf((function(){return arguments})())==="Arguments",El=l_?Vf:function(e){var t,r,o;return e===void 0?"Undefined":e===null?"Null":typeof(r=(function(c,u){try{return c[u]}catch{}})(t=Wv(e),Bv))=="string"?r:vC?Vf(t):(o=Vf(t))==="Object"&&UN(t.callee)?"Arguments":o},SC=El,VN=String,eo=function(e){if(SC(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return VN(e)},FN=Er("match"),jN=Sn,BN=function(e){if(yC(e))throw new Uf("The method doesn't accept regular expressions");return e},Ba=Mr,Fh=eo,TC=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[FN]=!1,"/./"[e](t)}catch{}}return!1},wC=I("".indexOf);jN({target:"String",proto:!0,forced:!TC("includes")},{includes:function(e){return!!~wC(Fh(Ba(this)),Fh(BN(e)),arguments.length>1?arguments[1]:void 0)}});var CC=To("String","includes"),Gv=N,Hv=Uh,WN=CC,zv=Array.prototype,bu=String.prototype,Kv=function(e){var t=e.includes;return e===zv||Gv(zv,e)&&t===zv.includes?Hv:typeof e=="string"||e===bu||Gv(bu,e)&&t===bu.includes?WN:t},ke=l(Kv),Yv=kr,RC=Zi,u_=Cn,jh=Ru,d_=TypeError,qv="Reduce of empty array with no initial value",h_=function(e){return function(t,r,o,c){var u=RC(t),h=u_(u),m=jh(u);if(Yv(r),m===0&&o<2)throw new d_(qv);var g=0,y=1;if(o<2)for(;;){if(g in h){c=h[g],g+=y;break}if(g+=y,m<=g)throw new d_(qv)}for(;m>g;g+=y)g in h&&(c=r(c,h[g],g,u));return c}},bC={left:h_()},IC=d,Ff=function(e,t){var r=[][e];return!!r&&IC(function(){r.call(null,t||function(){return 1},1)})},Bh=W,AC=lt,OC=ne,Wa=function(e){return AC.slice(0,e.length)===e},jf=Wa("Bun/")?"BUN":Wa("Cloudflare-Workers")?"CLOUDFLARE":Wa("Deno/")?"DENO":Wa("Node.js/")?"NODE":Bh.Bun&&typeof Bun.version=="string"?"BUN":Bh.Deno&&typeof Deno.version=="object"?"DENO":OC(Bh.process)==="process"?"NODE":Bh.window&&Bh.document?"BROWSER":"REST",Wh=jf==="NODE",GN=bC.left;Sn({target:"Array",proto:!0,forced:!Wh&&mi>79&&mi<83||!Ff("reduce")},{reduce:function(e){var t=arguments.length;return GN(this,e,t,t>1?arguments[1]:void 0)}});var HN=To("Array","reduce"),Bf=N,zN=HN,p_=Array.prototype,NC=function(e){var t=e.reduce;return e===p_||Bf(p_,e)&&t===p_.reduce?zN:t},Qr=NC,to=l(Qr),f_=ne,yl=Array.isArray||function(e){return f_(e)==="Array"},PC=Sn,Xv=yl,Wf=I([].reverse),Gf=[1,2];PC({target:"Array",proto:!0,forced:String(Gf)===String(Gf.reverse())},{reverse:function(){return Xv(this)&&(this.length=this.length),Wf(this)}});var Gh=To("Array","reverse"),kC=N,KN=Gh,Jv=Array.prototype,DC=function(e){var t=e.reverse;return e===Jv||kC(Jv,e)&&t===Jv.reverse?KN:t},Hf=DC,zf=l(Hf),$v=Dr,m_=Ar("keys"),Hh=function(e){return m_[e]||(m_[e]=$v(e))},Qv=!d(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),YN=Ur,xC=ye,qN=Zi,XN=Qv,g_=Hh("IE_PROTO"),Ac=Object,LC=Ac.prototype,Iu=XN?Ac.getPrototypeOf:function(e){var t=qN(e);if(YN(t,g_))return t[g_];var r=t.constructor;return xC(r)&&t instanceof r?r.prototype:t instanceof Ac?LC:null},Oc=I,Kf=kr,vl=Wr,Zv=function(e){return vl(e)||e===null},JN=String,$N=TypeError,xd=function(e,t,r){try{return Oc(Kf(Object.getOwnPropertyDescriptor(e,t)[r]))}catch{}},Yf=Wr,zh=Mr,__=function(e){if(Zv(e))return e;throw new $N("Can't set "+JN(e)+" as a prototype")},eS=Object.setPrototypeOf||("__proto__"in{}?(function(){var e,t=!1,r={};try{(e=xd(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch{}return function(o,c){return zh(o),__(c),Yf(o)&&(t?e(o,c):o.__proto__=c),o}})():void 0),Sl={},Ga={},Hr=Ur,Zr=yi,Au=a_.indexOf,Ms=Ga,no=I([].push),Ou=function(e,t){var r,o=Zr(e),c=0,u=[];for(r in o)!Hr(Ms,r)&&Hr(o,r)&&no(u,r);for(;t.length>c;)Hr(o,r=t[c++])&&(~Au(u,r)||no(u,r));return u},Nu=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],wo=Ou,E_=Nu.concat("length","prototype");Sl.f=Object.getOwnPropertyNames||function(e){return wo(e,E_)};var Kh={};Kh.f=Object.getOwnPropertySymbols;var MC=Ir,y_=Sl,UC=Kh,Tl=Is,v_=I([].concat),tS=MC("Reflect","ownKeys")||function(e){var t=y_.f(Tl(e)),r=UC.f;return r?v_(t,r(e)):t},nS=Ur,QN=tS,Pu=Ge,Yh=So,ku={},S_=Ou,T_=Nu,ro=Object.keys||function(e){return S_(e,T_)},oa=Te,Ld=Df,wl=So,Cl=Is,Md=yi,VC=ro;ku.f=oa&&!Ld?Object.defineProperties:function(e,t){Cl(e);for(var r,o=Md(t),c=VC(t),u=c.length,h=0;u>h;)wl.f(e,r=c[h++],o[r]);return e};var qh,w_=Ir("document","documentElement"),Wo=Is,Go=ku,si=Nu,Ha=Ga,FC=w_,jC=t_,qf="prototype",Xf="script",rS=Hh("IE_PROTO"),Xh=function(){},iS=function(e){return"<"+Xf+">"+e+"</"+Xf+">"},Ud=function(e){e.write(iS("")),e.close();var t=e.parentWindow.Object;return e=null,t},Jh=function(){try{qh=new ActiveXObject("htmlfile")}catch{}var e,t,r;Jh=typeof document<"u"?document.domain&&qh?Ud(qh):(t=jC("iframe"),r="java"+Xf+":",t.style.display="none",FC.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(iS("document.F=Object")),e.close(),e.F):Ud(qh);for(var o=si.length;o--;)delete Jh[qf][si[o]];return Jh()};Ha[rS]=!0;var Jf=Object.create||function(e,t){var r;return e!==null?(Xh[qf]=Wo(e),r=new Xh,Xh[qf]=null,r[rS]=e):r=Jh(),t===void 0?r:Go.f(r,t)},$f=Wr,C_=Ic,sS=Error,BC=I("".replace),$h=String(new sS("zxcasd").stack),oS=/\n\s*at [^:]*:[^\n]*/,R_=oS.test($h),b_=it,Qh=!d(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",b_(1,7)),e.stack!==7)}),aS=Ic,cS=function(e,t){if(R_&&typeof e=="string"&&!sS.prepareStackTrace)for(;t--;)e=BC(e,oS,"");return e},lS=Qh,I_=Error.captureStackTrace,za={},aa=za,Vd=Er("iterator"),uS=Array.prototype,dS=function(e){return e!==void 0&&(aa.Array===e||uS[Vd]===e)},Rl=El,bl=We,hS=fr,WC=za,Il=Er("iterator"),Ka=function(e){if(!hS(e))return bl(e,Il)||bl(e,"@@iterator")||WC[Rl(e)]},A_=je,GC=kr,O_=Is,HC=Wn,Qf=Ka,Nc=TypeError,Fd=function(e,t){var r=arguments.length<2?Qf(e):t;if(GC(r))return O_(A_(r,e));throw new Nc(HC(e)+" is not iterable")},Zf=je,Du=Is,pS=We,jd=function(e,t,r){var o,c;Du(e);try{if(!(o=pS(e,"return"))){if(t==="throw")throw r;return r}o=Zf(o,e)}catch(u){c=!0,o=u}if(t==="throw")throw r;if(c)throw o;return Du(o),r},zC=Tu,fS=je,Si=Is,N_=Wn,mS=dS,gS=Ru,em=N,_S=Fd,Bd=Ka,gi=jd,cs=TypeError,ji=function(e,t){this.stopped=e,this.result=t},tm=ji.prototype,Al=function(e,t,r){var o,c,u,h,m,g,y,v=r&&r.that,R=!(!r||!r.AS_ENTRIES),b=!(!r||!r.IS_RECORD),A=!(!r||!r.IS_ITERATOR),F=!(!r||!r.INTERRUPTED),M=zC(t,v),j=function(q){return o&&gi(o,"normal"),new ji(!0,q)},K=function(q){return R?(Si(q),F?M(q[0],q[1],j):M(q[0],q[1])):F?M(q,j):M(q)};if(b)o=e.iterator;else if(A)o=e;else{if(!(c=Bd(e)))throw new cs(N_(e)+" is not iterable");if(mS(c)){for(u=0,h=gS(e);h>u;u++)if((m=K(e[u]))&&em(tm,m))return m;return new ji(!1)}o=_S(e,c)}for(g=b?e.next:o.next;!(y=fS(g,o)).done;){try{m=K(y.value)}catch(q){gi(o,"throw",q)}if(typeof m=="object"&&m&&em(tm,m))return m}return new ji(!1)},nm=eo,ZN=Sn,Us=N,ES=Iu,Zh=eS,yS=function(e,t,r){for(var o=QN(t),c=Yh.f,u=Pu.f,h=0;h<o.length;h++){var m=o[h];nS(e,m)||r&&nS(r,m)||c(e,m,u(t,m))}},Ya=Jf,Co=Ic,Wd=it,vS=function(e,t){$f(t)&&"cause"in t&&C_(e,"cause",t.cause)},SS=function(e,t,r,o){lS&&(I_?I_(e,t):aS(e,"stack",cS(r,o)))},KC=Al,YC=function(e,t){return e===void 0?arguments.length<2?"":t:nm(e)},qC=Er("toStringTag"),rm=Error,XC=[].push,Gd=function(e,t){var r,o=Us(P_,this);Zh?r=Zh(new rm,o?ES(this):P_):(r=o?this:Ya(P_),Co(r,qC,"Error")),t!==void 0&&Co(r,"message",YC(t)),SS(r,Gd,r.stack,1),arguments.length>2&&vS(r,arguments[2]);var c=[];return KC(e,XC,{that:c}),Co(r,"errors",c),r};Zh?Zh(Gd,rm):yS(Gd,rm,{name:!0});var P_=Gd.prototype=Ya(rm.prototype,{constructor:Wd(1,Gd),message:Wd(1,""),name:Wd(1,"AggregateError")});ZN({global:!0},{AggregateError:Gd});var im,Ol,sm,k_=ye,om=W.WeakMap,JC=k_(om)&&/native code/.test(String(om)),D_=W,$C=Wr,QC=Ic,x_=Ur,L_=Sr,TS=Hh,ZC=Ga,wS="Object already initialized",M_=D_.TypeError,eP=D_.WeakMap;if(JC||L_.state){var qa=L_.state||(L_.state=new eP);qa.get=qa.get,qa.has=qa.has,qa.set=qa.set,im=function(e,t){if(qa.has(e))throw new M_(wS);return t.facade=e,qa.set(e,t),t},Ol=function(e){return qa.get(e)||{}},sm=function(e){return qa.has(e)}}else{var ep=TS("state");ZC[ep]=!0,im=function(e,t){if(x_(e,ep))throw new M_(wS);return t.facade=e,QC(e,ep,t),t},Ol=function(e){return x_(e,ep)?e[ep]:{}},sm=function(e){return x_(e,ep)}}var Hd,CS,RS,xu={set:im,get:Ol,has:sm,enforce:function(e){return sm(e)?Ol(e):im(e,{})},getterFor:function(e){return function(t){var r;if(!$C(t)||(r=Ol(t)).type!==e)throw new M_("Incompatible receiver, "+e+" required");return r}}},tp=Te,tP=Ur,eR=Function.prototype,nP=tp&&Object.getOwnPropertyDescriptor,ca=tP(eR,"name"),U_={PROPER:ca&&(function(){}).name==="something",CONFIGURABLE:ca&&(!tp||tp&&nP(eR,"name").configurable)},V_=Ic,Nl=function(e,t,r,o){return o&&o.enumerable?e[t]=r:V_(e,t,r),e},tR=d,nR=ye,bS=Wr,np=Jf,F_=Iu,IS=Nl,AS=Er("iterator"),OS=!1;[].keys&&("next"in(RS=[].keys())?(CS=F_(F_(RS)))!==Object.prototype&&(Hd=CS):OS=!0);var rR=!bS(Hd)||tR(function(){var e={};return Hd[AS].call(e)!==e});nR((Hd=rR?{}:np(Hd))[AS])||IS(Hd,AS,function(){return this});var NS={IteratorPrototype:Hd,BUGGY_SAFARI_ITERATORS:OS},iR=El,sR=jv?{}.toString:function(){return"[object "+iR(this)+"]"},rP=jv,Ro=So.f,io=Ic,oR=Ur,aR=sR,PS=Er("toStringTag"),Pc=function(e,t,r,o){var c=r?e:e&&e.prototype;c&&(oR(c,PS)||Ro(c,PS,{configurable:!0,value:t}),o&&!rP&&io(c,"toString",aR))},cR=NS.IteratorPrototype,kS=Jf,lR=it,DS=Pc,uR=za,dR=function(){return this},am=function(e,t,r,o){var c=t+" Iterator";return e.prototype=kS(cR,{next:lR(+!o,r)}),DS(e,c,!1,!0),uR[c]=dR,e},xS=Sn,hR=je,LS=U_,j_=am,iP=Iu,pR=Pc,B_=Nl,MS=za,W_=NS,Pl=LS.PROPER,G_=W_.BUGGY_SAFARI_ITERATORS,H_=Er("iterator"),z_="keys",cm="values",US="entries",lm=function(){return this},As=function(e,t,r,o,c,u,h){j_(r,t,o);var m,g,y,v=function(K){if(K===c&&M)return M;if(!G_&&K&&K in A)return A[K];switch(K){case z_:case cm:case US:return function(){return new r(this,K)}}return function(){return new r(this)}},R=t+" Iterator",b=!1,A=e.prototype,F=A[H_]||A["@@iterator"]||c&&A[c],M=!G_&&F||v(c),j=t==="Array"&&A.entries||F;if(j&&(m=iP(j.call(new e)))!==Object.prototype&&m.next&&(pR(m,R,!0,!0),MS[R]=lm),Pl&&c===cm&&F&&F.name!==cm&&(b=!0,M=function(){return hR(F,this)}),c)if(g={values:v(cm),keys:u?M:v(z_),entries:v(US)},h)for(y in g)(G_||b||!(y in A))&&B_(A,y,g[y]);else xS({target:t,proto:!0,forced:G_||b},g);return h&&A[H_]!==M&&B_(A,H_,M,{}),MS[t]=M,g},K_=function(e,t){return{value:e,done:t}},sP=yi,um=za,Os=xu;So.f;var oP=As,Nt=K_,zd="Array Iterator",VS=Os.set,fR=Os.getterFor(zd);oP(Array,"Array",function(e,t){VS(this,{type:zd,target:sP(e),index:0,kind:t})},function(){var e=fR(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=null,Nt(void 0,!0);switch(e.kind){case"keys":return Nt(r,!1);case"values":return Nt(t[r],!1)}return Nt([r,t[r]],!1)},"values"),um.Arguments=um.Array;var aP=So,Lu=function(e,t,r){return aP.f(e,t,r)},Y_=Ir,FS=Lu,mR=Te,jS=Er("species"),gR=N,BS=TypeError,dm=function(e,t){if(gR(t,e))return e;throw new BS("Incorrect invocation")},Ns=ye,Ho=Sr,Mu=I(Function.toString);Ns(Ho.inspectSource)||(Ho.inspectSource=function(e){return Mu(e)});var WS=Ho.inspectSource,_R=I,Xa=d,GS=ye,kc=El,cP=WS,HS=function(){},zS=Ir("Reflect","construct"),q_=/^\s*(?:class|function)\b/,ER=_R(q_.exec),lP=!q_.test(HS),Uu=function(e){if(!GS(e))return!1;try{return zS(HS,[],e),!0}catch{return!1}},X_=function(e){if(!GS(e))return!1;switch(kc(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return lP||!!ER(q_,cP(e))}catch{return!0}};X_.sham=!0;var Vs,qn,ls,Ni,es=!zS||Xa(function(){var e;return Uu(Uu.call)||!Uu(Object)||!Uu(function(){e=!0})||e})?X_:Uu,zo=es,rp=Wn,us=TypeError,ip=Is,Kd=function(e){if(zo(e))return e;throw new us(rp(e)+" is not a constructor")},J_=fr,KS=Er("species"),Yd=function(e,t){var r,o=ip(e).constructor;return o===void 0||J_(r=ip(o)[KS])?t:Kd(r)},Bi=I([].slice),YS=TypeError,la=function(e,t){if(e<t)throw new YS("Not enough arguments");return e},Dc=/(?:ipad|iphone|ipod).*applewebkit/i.test(lt),Fs=W,qS=$,Vu=Tu,hm=ye,Fu=Ur,pm=d,sp=w_,XS=Bi,fm=t_,$_=la,so=Dc,ju=Wh,Ko=Fs.setImmediate,js=Fs.clearImmediate,yR=Fs.process,mm=Fs.Dispatch,JS=Fs.Function,vR=Fs.MessageChannel,Bu=Fs.String,Q_=0,qd={},Wu="onreadystatechange";pm(function(){Vs=Fs.location});var gm=function(e){if(Fu(qd,e)){var t=qd[e];delete qd[e],t()}},kl=function(e){return function(){gm(e)}},$S=function(e){gm(e.data)},QS=function(e){Fs.postMessage(Bu(e),Vs.protocol+"//"+Vs.host)};Ko&&js||(Ko=function(e){$_(arguments.length,1);var t=hm(e)?e:JS(e),r=XS(arguments,1);return qd[++Q_]=function(){qS(t,void 0,r)},qn(Q_),Q_},js=function(e){delete qd[e]},ju?qn=function(e){yR.nextTick(kl(e))}:mm&&mm.now?qn=function(e){mm.now(kl(e))}:vR&&!so?(Ni=(ls=new vR).port2,ls.port1.onmessage=$S,qn=Vu(Ni.postMessage,Ni)):Fs.addEventListener&&hm(Fs.postMessage)&&!Fs.importScripts&&Vs&&Vs.protocol!=="file:"&&!pm(QS)?(qn=QS,Fs.addEventListener("message",$S,!1)):qn=Wu in fm("script")?function(e){sp.appendChild(fm("script"))[Wu]=function(){sp.removeChild(this),gm(e)}}:function(e){setTimeout(kl(e),0)});var op={set:Ko,clear:js},_m=W,uP=Te,dP=Object.getOwnPropertyDescriptor,ZS=function(e){if(!uP)return _m[e];var t=dP(_m,e);return t&&t.value},eT=function(){this.head=null,this.tail=null};eT.prototype={add:function(e){var t={item:e,next:null},r=this.tail;r?r.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var ua,tT,Gu,Z_,Ti,SR=eT,TR=/ipad|iphone|ipod/i.test(lt)&&typeof Pebble<"u",hP=/web0s(?!.*chrome)/i.test(lt),ap=W,wR=ZS,nT=Tu,rT=op.set,da=SR,iT=Dc,pP=TR,Hu=hP,cp=Wh,zu=ap.MutationObserver||ap.WebKitMutationObserver,Em=ap.document,eE=ap.process,lp=ap.Promise,sT=wR("queueMicrotask");if(!sT){var up=new da,tE=function(){var e,t;for(cp&&(e=eE.domain)&&e.exit();t=up.get();)try{t()}catch(r){throw up.head&&ua(),r}e&&e.enter()};iT||cp||Hu||!zu||!Em?!pP&&lp&&lp.resolve?((Z_=lp.resolve(void 0)).constructor=lp,Ti=nT(Z_.then,Z_),ua=function(){Ti(tE)}):cp?ua=function(){eE.nextTick(tE)}:(rT=nT(rT,ap),ua=function(){rT(tE)}):(tT=!0,Gu=Em.createTextNode(""),new zu(tE).observe(Gu,{characterData:!0}),ua=function(){Gu.data=tT=!tT}),sT=function(e){up.head||ua(),up.add(e)}}var oT=sT,Xd=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},xc=W.Promise,nE=W,dp=xc,aT=ye,fP=kh,CR=WS,cT=Er,ym=jf,vm=mi,Sm=dp&&dp.prototype,RR=cT("species"),bR=aT(nE.PromiseRejectionEvent),rE=fP("Promise",function(){var e=CR(dp),t=e!==String(dp);if(!t&&vm===66||!Sm.catch||!Sm.finally)return!0;if(!vm||vm<51||!/native code/.test(e)){var r=new dp(function(c){c(1)}),o=function(c){c(function(){},function(){})};if((r.constructor={})[RR]=o,!(r.then(function(){})instanceof o))return!0}return!(t||ym!=="BROWSER"&&ym!=="DENO"||bR)}),Tm={CONSTRUCTOR:rE,REJECTION_EVENT:bR},bo={},IR=kr,iE=TypeError,p=function(e){var t,r;this.promise=new e(function(o,c){if(t!==void 0||r!==void 0)throw new iE("Bad Promise constructor");t=o,r=c}),this.resolve=IR(t),this.reject=IR(r)};bo.f=function(e){return new p(e)};var _,w,O,U=Sn,G=Wh,ee=W,me=fi,ve=je,Ke=Nl,ut=Pc,ht=function(e){var t=Y_(e);mR&&t&&!t[jS]&&FS(t,jS,{configurable:!0,get:function(){return this}})},at=kr,bt=ye,Bt=Wr,Ht=dm,Wi=Yd,Le=op.set,we=oT,Be=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},ft=Xd,qt=SR,sn=xu,rn=xc,gn=Tm,ds=bo,or="Promise",Dl=gn.CONSTRUCTOR,mP=gn.REJECTION_EVENT,gP=sn.getterFor(or),yre=sn.set,vre=rn&&rn.prototype,lT=rn,_P=vre,VV=ee.TypeError,EP=ee.document,yP=ee.process,vP=ds.f,Sre=vP,Tre=!!(EP&&EP.createEvent&&ee.dispatchEvent),FV="unhandledrejection",jV=function(e){var t;return!(!Bt(e)||!bt(t=e.then))&&t},BV=function(e,t){var r,o,c,u=t.value,h=t.state===1,m=h?e.ok:e.fail,g=e.resolve,y=e.reject,v=e.domain;try{m?(h||(t.rejection===2&&Cre(t),t.rejection=1),m===!0?r=u:(v&&v.enter(),r=m(u),v&&(v.exit(),c=!0)),r===e.promise?y(new VV("Promise-chain cycle")):(o=jV(r))?ve(o,r,g,y):g(r)):y(u)}catch(R){v&&!c&&v.exit(),y(R)}},WV=function(e,t){e.notified||(e.notified=!0,we(function(){for(var r,o=e.reactions;r=o.get();)BV(r,e);e.notified=!1,t&&!e.rejection&&wre(e)}))},GV=function(e,t,r){var o,c;Tre?((o=EP.createEvent("Event")).promise=t,o.reason=r,o.initEvent(e,!1,!0),ee.dispatchEvent(o)):o={promise:t,reason:r},!mP&&(c=ee["on"+e])?c(o):e===FV&&Be("Unhandled promise rejection",r)},wre=function(e){ve(Le,ee,function(){var t,r=e.facade,o=e.value;if(HV(e)&&(t=ft(function(){G?yP.emit("unhandledRejection",o,r):GV(FV,r,o)}),e.rejection=G||HV(e)?2:1,t.error))throw t.value})},HV=function(e){return e.rejection!==1&&!e.parent},Cre=function(e){ve(Le,ee,function(){var t=e.facade;G?yP.emit("rejectionHandled",t):GV("rejectionhandled",t,e.value)})},sE=function(e,t,r){return function(o){e(t,o,r)}},oE=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,WV(e,!0))},SP=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw new VV("Promise can't be resolved itself");var o=jV(t);o?we(function(){var c={done:!1};try{ve(o,t,sE(SP,c,e),sE(oE,c,e))}catch(u){oE(c,u,e)}}):(e.value=t,e.state=1,WV(e,!1))}catch(c){oE({done:!1},c,e)}}};Dl&&(_P=(lT=function(e){Ht(this,_P),at(e),ve(_,this);var t=gP(this);try{e(sE(SP,t),sE(oE,t))}catch(r){oE(t,r)}}).prototype,(_=function(e){yre(this,{type:or,done:!1,notified:!1,parent:!1,reactions:new qt,rejection:!1,state:0,value:null})}).prototype=Ke(_P,"then",function(e,t){var r=gP(this),o=vP(Wi(this,lT));return r.parent=!0,o.ok=!bt(e)||e,o.fail=bt(t)&&t,o.domain=G?yP.domain:void 0,r.state===0?r.reactions.add(o):we(function(){BV(o,r)}),o.promise}),w=function(){var e=new _,t=gP(e);this.promise=e,this.resolve=sE(SP,t),this.reject=sE(oE,t)},ds.f=vP=function(e){return e===lT||e===O?new w(e):Sre(e)}),U({global:!0,wrap:!0,forced:Dl},{Promise:lT}),O=me.Promise,ut(lT,or,!1,!0),ht(or);var zV=Er("iterator"),KV=!1;try{var Rre=0,YV={next:function(){return{done:!!Rre++}},return:function(){KV=!0}};YV[zV]=function(){return this},Array.from(YV,function(){throw 2})}catch{}var bre=xc,Ire=function(e,t){try{if(!t&&!KV)return!1}catch{return!1}var r=!1;try{var o={};o[zV]=function(){return{next:function(){return{done:r=!0}}}},e(o)}catch{}return r},AR=Tm.CONSTRUCTOR||!Ire(function(e){bre.all(e).then(void 0,function(){})}),Are=je,Ore=kr,Nre=bo,Pre=Xd,kre=Al;Sn({target:"Promise",stat:!0,forced:AR},{all:function(e){var t=this,r=Nre.f(t),o=r.resolve,c=r.reject,u=Pre(function(){var h=Ore(t.resolve),m=[],g=0,y=1;kre(e,function(v){var R=g++,b=!1;y++,Are(h,t,v).then(function(A){b||(b=!0,m[R]=A,--y||o(m))},c)}),--y||o(m)});return u.error&&c(u.value),r.promise}});var Dre=Sn,xre=Tm.CONSTRUCTOR;xc&&xc.prototype,Dre({target:"Promise",proto:!0,forced:xre,real:!0},{catch:function(e){return this.then(void 0,e)}});var Lre=je,Mre=kr,Ure=bo,Vre=Xd,Fre=Al;Sn({target:"Promise",stat:!0,forced:AR},{race:function(e){var t=this,r=Ure.f(t),o=r.reject,c=Vre(function(){var u=Mre(t.resolve);Fre(e,function(h){Lre(u,t,h).then(r.resolve,o)})});return c.error&&o(c.value),r.promise}});var jre=bo;Sn({target:"Promise",stat:!0,forced:Tm.CONSTRUCTOR},{reject:function(e){var t=jre.f(this);return(0,t.reject)(e),t.promise}});var Bre=Is,Wre=Wr,Gre=bo,qV=function(e,t){if(Bre(e),Wre(t)&&t.constructor===e)return t;var r=Gre.f(e);return(0,r.resolve)(t),r.promise},Hre=Sn,zre=xc,Kre=Tm.CONSTRUCTOR,Yre=qV,qre=Ir("Promise"),Xre=!Kre;Hre({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return Yre(Xre&&this===qre?zre:this,e)}});var Jre=je,$re=kr,Qre=bo,Zre=Xd,eie=Al;Sn({target:"Promise",stat:!0,forced:AR},{allSettled:function(e){var t=this,r=Qre.f(t),o=r.resolve,c=r.reject,u=Zre(function(){var h=$re(t.resolve),m=[],g=0,y=1;eie(e,function(v){var R=g++,b=!1;y++,Jre(h,t,v).then(function(A){b||(b=!0,m[R]={status:"fulfilled",value:A},--y||o(m))},function(A){b||(b=!0,m[R]={status:"rejected",reason:A},--y||o(m))})}),--y||o(m)});return u.error&&c(u.value),r.promise}});var tie=je,nie=kr,rie=Ir,iie=bo,sie=Xd,oie=Al,XV="No one promise resolved";Sn({target:"Promise",stat:!0,forced:AR},{any:function(e){var t=this,r=rie("AggregateError"),o=iie.f(t),c=o.resolve,u=o.reject,h=sie(function(){var m=nie(t.resolve),g=[],y=0,v=1,R=!1;oie(e,function(b){var A=y++,F=!1;v++,tie(m,t,b).then(function(M){F||R||(R=!0,c(M))},function(M){F||R||(F=!0,g[A]=M,--v||u(new r(g,XV)))})}),--v||u(new r(g,XV))});return h.error&&u(h.value),o.promise}});var aie=Sn,cie=$,lie=Bi,uie=bo,die=kr,JV=Xd,TP=W.Promise,$V=!1;aie({target:"Promise",stat:!0,forced:!TP||!TP.try||JV(function(){TP.try(function(e){$V=e===8},8)}).error||!$V},{try:function(e){var t=arguments.length>1?lie(arguments,1):[],r=uie.f(this),o=JV(function(){return cie(die(e),void 0,t)});return(o.error?r.reject:r.resolve)(o.value),r.promise}});var hie=bo;Sn({target:"Promise",stat:!0},{withResolvers:function(){var e=hie.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var pie=Sn,wP=xc,fie=d,mie=Ir,gie=ye,_ie=Yd,QV=qV,Eie=wP&&wP.prototype;pie({target:"Promise",proto:!0,real:!0,forced:!!wP&&fie(function(){Eie.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=_ie(this,mie("Promise")),r=gie(e);return this.then(r?function(o){return QV(t,e()).then(function(){return o})}:e,r?function(o){return QV(t,e()).then(function(){throw o})}:e)}});var CP=I,yie=Uv,vie=eo,Sie=Mr,Tie=CP("".charAt),ZV=CP("".charCodeAt),wie=CP("".slice),eF=function(e){return function(t,r){var o,c,u=vie(Sie(t)),h=yie(r),m=u.length;return h<0||h>=m?e?"":void 0:(o=ZV(u,h))<55296||o>56319||h+1===m||(c=ZV(u,h+1))<56320||c>57343?e?Tie(u,h):o:e?wie(u,h,h+2):c-56320+(o-55296<<10)+65536}},RP={codeAt:eF(!1),charAt:eF(!0)},Cie=RP.charAt,Rie=eo,tF=xu,bie=As,nF=K_,rF="String Iterator",Iie=tF.set,Aie=tF.getterFor(rF);bie(String,"String",function(e){Iie(this,{type:rF,string:Rie(e),index:0})},function(){var e,t=Aie(this),r=t.string,o=t.index;return o>=r.length?nF(void 0,!0):(e=Cie(r,o),t.index+=e.length,nF(e,!1))});var Oie=fi.Promise,Nie={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Pie=W,kie=Pc,iF=za;for(var bP in Nie)kie(Pie[bP],bP),iF[bP]=iF.Array;var sF=Oie,ze=l(sF),Die=To("Array","values"),xie=El,Lie=Ur,Mie=N,Uie=Die,IP=Array.prototype,Vie={DOMTokenList:!0,NodeList:!0},Fie=function(e){var t=e.values;return e===IP||Mie(IP,e)&&t===IP.values||Lie(Vie,xie(e))?Uie:t},Yo=l(Fie),oF=Wn,jie=TypeError,aF=Bi,Bie=Math.floor,AP=function(e,t){var r=e.length;if(r<8)for(var o,c,u=1;u<r;){for(c=u,o=e[u];c&&t(e[c-1],o)>0;)e[c]=e[--c];c!==u++&&(e[c]=o)}else for(var h=Bie(r/2),m=AP(aF(e,0,h),t),g=AP(aF(e,h),t),y=m.length,v=g.length,R=0,b=0;R<y||b<v;)e[R+b]=R<y&&b<v?t(m[R],g[b])<=0?m[R++]:g[b++]:R<y?m[R++]:g[b++];return e},cF=AP,lF=lt.match(/firefox\/(\d+)/i),Wie=!!lF&&+lF[1],Gie=/MSIE|Trident/.test(lt),uF=lt.match(/AppleWebKit\/(\d+)\./),Hie=!!uF&&+uF[1],zie=Sn,dF=I,Kie=kr,Yie=Zi,hF=Ru,qie=function(e,t){if(!delete e[t])throw new jie("Cannot delete property "+oF(t)+" of "+oF(e))},pF=eo,OP=d,Xie=cF,Jie=Ff,fF=Wie,$ie=Gie,mF=mi,gF=Hie,hp=[],_F=dF(hp.sort),Qie=dF(hp.push),Zie=OP(function(){hp.sort(void 0)}),ese=OP(function(){hp.sort(null)}),tse=Jie("sort"),EF=!OP(function(){if(mF)return mF<70;if(!(fF&&fF>3)){if($ie)return!0;if(gF)return gF<603;var e,t,r,o,c="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(o=0;o<47;o++)hp.push({k:t+o,v:r})}for(hp.sort(function(u,h){return h.v-u.v}),o=0;o<hp.length;o++)t=hp[o].k.charAt(0),c.charAt(c.length-1)!==t&&(c+=t);return c!=="DGBEFHACIJK"}});zie({target:"Array",proto:!0,forced:Zie||!ese||!tse||!EF},{sort:function(e){e!==void 0&&Kie(e);var t=Yie(this);if(EF)return e===void 0?_F(t):_F(t,e);var r,o,c=[],u=hF(t);for(o=0;o<u;o++)o in t&&Qie(c,t[o]);for(Xie(c,(function(h){return function(m,g){return g===void 0?-1:m===void 0?1:h!==void 0?+h(m,g)||0:pF(m)>pF(g)?1:-1}})(e)),r=hF(c),o=0;o<r;)t[o]=c[o++];for(;o<u;)qie(t,o++);return t}});var nse=To("Array","sort"),rse=N,ise=nse,NP=Array.prototype,sse=function(e){var t=e.sort;return e===NP||rse(NP,e)&&t===NP.sort?ise:t},wm=l(sse),ose=Sn,ase=I,cse=Vv,lse=RangeError,yF=String.fromCharCode,vF=String.fromCodePoint,use=ase([].join);ose({target:"String",stat:!0,forced:!!vF&&vF.length!==1},{fromCodePoint:function(e){for(var t,r=[],o=arguments.length,c=0;o>c;){if(t=+arguments[c++],cse(t,1114111)!==t)throw new lse(t+" is not a valid code point");r[c]=t<65536?yF(t):yF(55296+((t-=65536)>>10),t%1024+56320)}return use(r,"")}});var dse=d,hse=Er("iterator"),OR=!dse(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,r=new URLSearchParams("a=1&a=2&b=3"),o="";return e.pathname="c%20d",t.forEach(function(c,u){t.delete("b"),o+=u+c}),r.delete("a",2),r.delete("b",void 0),!e.toJSON||!r.has("a",1)||r.has("a",2)||!r.has("a",void 0)||r.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[hse]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||o!=="a1c3"||new URL("https://x",void 0).host!=="x"}),pse=Nl,PP=Sn,SF=W,kP=ZS,fse=Ir,NR=je,xl=I,uT=Te,TF=OR,wF=Nl,mse=Lu,gse=function(e,t,r){for(var o in t)r&&r.unsafe&&e[o]?e[o]=t[o]:pse(e,o,t[o],r);return e},_se=Pc,Ese=am,DP=xu,CF=dm,xP=ye,yse=Ur,vse=Tu,Sse=El,Tse=Is,RF=Wr,qo=eo,wse=Jf,bF=it,IF=Fd,Cse=Ka,PR=K_,aE=la,Rse=cF,bse=Er("iterator"),cE="URLSearchParams",AF=cE+"Iterator",OF=DP.set,Lc=DP.getterFor(cE),Ise=DP.getterFor(AF),NF=kP("fetch"),kR=kP("Request"),dT=kP("Headers"),LP=kR&&kR.prototype,PF=dT&&dT.prototype,Ase=SF.TypeError,Ose=SF.encodeURIComponent,Nse=String.fromCharCode,Pse=fse("String","fromCodePoint"),kse=parseInt,DR=xl("".charAt),kF=xl([].join),pp=xl([].push),DF=xl("".replace),Dse=xl([].shift),xF=xl([].splice),LF=xl("".split),MF=xl("".slice),xse=xl(/./.exec),Lse=/\+/g,Mse=/^[0-9a-f]+$/i,UF=function(e,t){var r=MF(e,t,t+2);return xse(Mse,r)?kse(r,16):NaN},Use=function(e){for(var t=0,r=128;r>0&&e&r;r>>=1)t++;return t},Vse=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},VF=function(e){for(var t=(e=DF(e,Lse," ")).length,r="",o=0;o<t;){var c=DR(e,o);if(c==="%"){if(DR(e,o+1)==="%"||o+3>t){r+="%",o++;continue}var u=UF(e,o+1);if(u!=u){r+=c,o++;continue}o+=2;var h=Use(u);if(h===0)c=Nse(u);else{if(h===1||h>4){r+="",o++;continue}for(var m=[u],g=1;g<h&&!(++o+3>t||DR(e,o)!=="%");){var y=UF(e,o+1);if(y!=y){o+=3;break}if(y>191||y<128)break;pp(m,y),o+=2,g++}if(m.length!==h){r+="";continue}var v=Vse(m);v===null?r+="":c=Pse(v)}}r+=c,o++}return r},Fse=/[!'()~]|%20/g,jse={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Bse=function(e){return jse[e]},FF=function(e){return DF(Ose(e),Fse,Bse)},MP=Ese(function(e,t){OF(this,{type:AF,target:Lc(e).entries,index:0,kind:t})},cE,function(){var e=Ise(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=null,PR(void 0,!0);var o=t[r];switch(e.kind){case"keys":return PR(o.key,!1);case"values":return PR(o.value,!1)}return PR([o.key,o.value],!1)},!0),jF=function(e){this.entries=[],this.url=null,e!==void 0&&(RF(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?DR(e,0)==="?"?MF(e,1):e:qo(e)))};jF.prototype={type:cE,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,o,c,u,h,m,g=this.entries,y=Cse(e);if(y)for(r=(t=IF(e,y)).next;!(o=NR(r,t)).done;){if(u=(c=IF(Tse(o.value))).next,(h=NR(u,c)).done||(m=NR(u,c)).done||!NR(u,c).done)throw new Ase("Expected sequence with length 2");pp(g,{key:qo(h.value),value:qo(m.value)})}else for(var v in e)yse(e,v)&&pp(g,{key:v,value:qo(e[v])})},parseQuery:function(e){if(e)for(var t,r,o=this.entries,c=LF(e,"&"),u=0;u<c.length;)(t=c[u++]).length&&(r=LF(t,"="),pp(o,{key:VF(Dse(r)),value:VF(kF(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],o=0;o<t.length;)e=t[o++],pp(r,FF(e.key)+"="+FF(e.value));return kF(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var xR=function(){CF(this,lE);var e=OF(this,new jF(arguments.length>0?arguments[0]:void 0));uT||(this.size=e.entries.length)},lE=xR.prototype;if(gse(lE,{append:function(e,t){var r=Lc(this);aE(arguments.length,2),pp(r.entries,{key:qo(e),value:qo(t)}),uT||this.length++,r.updateURL()},delete:function(e){for(var t=Lc(this),r=aE(arguments.length,1),o=t.entries,c=qo(e),u=r<2?void 0:arguments[1],h=u===void 0?u:qo(u),m=0;m<o.length;){var g=o[m];if(g.key!==c||h!==void 0&&g.value!==h)m++;else if(xF(o,m,1),h!==void 0)break}uT||(this.size=o.length),t.updateURL()},get:function(e){var t=Lc(this).entries;aE(arguments.length,1);for(var r=qo(e),o=0;o<t.length;o++)if(t[o].key===r)return t[o].value;return null},getAll:function(e){var t=Lc(this).entries;aE(arguments.length,1);for(var r=qo(e),o=[],c=0;c<t.length;c++)t[c].key===r&&pp(o,t[c].value);return o},has:function(e){for(var t=Lc(this).entries,r=aE(arguments.length,1),o=qo(e),c=r<2?void 0:arguments[1],u=c===void 0?c:qo(c),h=0;h<t.length;){var m=t[h++];if(m.key===o&&(u===void 0||m.value===u))return!0}return!1},set:function(e,t){var r=Lc(this);aE(arguments.length,1);for(var o,c=r.entries,u=!1,h=qo(e),m=qo(t),g=0;g<c.length;g++)(o=c[g]).key===h&&(u?xF(c,g--,1):(u=!0,o.value=m));u||pp(c,{key:h,value:m}),uT||(this.size=c.length),r.updateURL()},sort:function(){var e=Lc(this);Rse(e.entries,function(t,r){return t.key>r.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,r=Lc(this).entries,o=vse(e,arguments.length>1?arguments[1]:void 0),c=0;c<r.length;)o((t=r[c++]).value,t.key,this)},keys:function(){return new MP(this,"keys")},values:function(){return new MP(this,"values")},entries:function(){return new MP(this,"entries")}},{enumerable:!0}),wF(lE,bse,lE.entries,{}),wF(lE,"toString",function(){return Lc(this).serialize()},{enumerable:!0}),uT&&mse(lE,"size",{get:function(){return Lc(this).entries.length},configurable:!0,enumerable:!0}),_se(xR,cE),PP({global:!0,forced:!TF},{URLSearchParams:xR}),!TF&&xP(dT)){var Wse=xl(PF.has),Gse=xl(PF.set),BF=function(e){if(RF(e)){var t,r=e.body;if(Sse(r)===cE)return t=e.headers?new dT(e.headers):new dT,Wse(t,"content-type")||Gse(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),wse(e,{body:bF(0,qo(r)),headers:bF(0,t)})}return e};if(xP(NF)&&PP({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return NF(e,arguments.length>1?BF(arguments[1]):{})}}),xP(kR)){var UP=function(e){return CF(this,LP),new kR(e,arguments.length>1?BF(arguments[1]):{})};LP.constructor=UP,UP.prototype=LP,PP({global:!0,dontCallGetSet:!0,forced:!0},{Request:UP})}}var Mc,Hse={URLSearchParams:xR,getState:Lc},zse=fi.URLSearchParams,WF=Te,Kse=I,Yse=je,qse=d,VP=ro,Xse=Kh,Jse=Ie,$se=Zi,Qse=Cn,uE=Object.assign,GF=Object.defineProperty,Zse=Kse([].concat),eoe=!uE||qse(function(){if(WF&&uE({b:1},uE(GF({},"a",{enumerable:!0,get:function(){GF(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},r=Symbol("assign detection"),o="abcdefghijklmnopqrst";return e[r]=7,o.split("").forEach(function(c){t[c]=c}),uE({},e)[r]!==7||VP(uE({},t)).join("")!==o})?function(e,t){for(var r=$se(e),o=arguments.length,c=1,u=Xse.f,h=Jse.f;o>c;)for(var m,g=Qse(arguments[c++]),y=u?Zse(VP(g),u(g)):VP(g),v=y.length,R=0;v>R;)m=y[R++],WF&&!Yse(h,g,m)||(r[m]=g[m]);return r}:uE,toe=Is,noe=jd,roe=Te,ioe=So,soe=it,FP=function(e,t,r){roe?ioe.f(e,t,soe(0,r)):e[t]=r},ooe=Tu,aoe=je,coe=Zi,loe=function(e,t,r,o){try{return o?t(toe(r)[0],r[1]):t(r)}catch(c){noe(e,"throw",c)}},uoe=dS,doe=es,hoe=Ru,HF=FP,poe=Fd,foe=Ka,zF=Array,Cm=I,jP=2147483647,moe=/[^\0-\u007E]/,KF=/[.\u3002\uFF0E\uFF61]/g,YF="Overflow: input needs wider integers to process",qF=RangeError,goe=Cm(KF.exec),dE=Math.floor,BP=String.fromCharCode,XF=Cm("".charCodeAt),JF=Cm([].join),fp=Cm([].push),_oe=Cm("".replace),Eoe=Cm("".split),yoe=Cm("".toLowerCase),$F=function(e){return e+22+75*(e<26)},voe=function(e,t,r){var o=0;for(e=r?dE(e/700):e>>1,e+=dE(e/t);e>455;)e=dE(e/35),o+=36;return dE(o+36*e/(e+38))},Soe=function(e){var t=[];e=(function(K){for(var q=[],Q=0,se=K.length;Q<se;){var oe=XF(K,Q++);if(oe>=55296&&oe<=56319&&Q<se){var te=XF(K,Q++);(64512&te)==56320?fp(q,((1023&oe)<<10)+(1023&te)+65536):(fp(q,oe),Q--)}else fp(q,oe)}return q})(e);var r,o,c=e.length,u=128,h=0,m=72;for(r=0;r<e.length;r++)(o=e[r])<128&&fp(t,BP(o));var g=t.length,y=g;for(g&&fp(t,"-");y<c;){var v=jP;for(r=0;r<e.length;r++)(o=e[r])>=u&&o<v&&(v=o);var R=y+1;if(v-u>dE((jP-h)/R))throw new qF(YF);for(h+=(v-u)*R,u=v,r=0;r<e.length;r++){if((o=e[r])<u&&++h>jP)throw new qF(YF);if(o===u){for(var b=h,A=36;;){var F=A<=m?1:A>=m+26?26:A-m;if(b<F)break;var M=b-F,j=36-F;fp(t,BP($F(F+M%j))),b=dE(M/j),A+=36}fp(t,BP($F(b))),m=voe(h,R,y===g),h=0,y++}}h++,u++}return JF(t,"")},Toe=Sn,WP=Te,woe=OR,GP=W,QF=Tu,Uc=I,LR=Nl,Vc=Lu,Coe=dm,HP=Ur,zP=eoe,hE=function(e){var t=coe(e),r=doe(this),o=arguments.length,c=o>1?arguments[1]:void 0,u=c!==void 0;u&&(c=ooe(c,o>2?arguments[2]:void 0));var h,m,g,y,v,R,b=foe(t),A=0;if(!b||this===zF&&uoe(b))for(h=hoe(t),m=r?new this(h):zF(h);h>A;A++)R=u?c(t[A],A):t[A],HF(m,A,R);else for(m=r?new this:[],v=(y=poe(t,b)).next;!(g=aoe(v,y)).done;A++)R=u?loe(y,c,[g.value,A],!0):g.value,HF(m,A,R);return m.length=A,m},Ll=Bi,Roe=RP.codeAt,boe=function(e){var t,r,o=[],c=Eoe(_oe(yoe(e),KF,"."),".");for(t=0;t<c.length;t++)r=c[t],fp(o,goe(moe,r)?"xn--"+Soe(r):r);return JF(o,".")},Jd=eo,Ioe=Pc,Aoe=la,ZF=Hse,ej=xu,Ooe=ej.set,MR=ej.getterFor("URL"),Noe=ZF.URLSearchParams,Poe=ZF.getState,hT=GP.URL,KP=GP.TypeError,UR=GP.parseInt,koe=Math.floor,tj=Math.pow,Fc=Uc("".charAt),Ml=Uc(/./.exec),pT=Uc([].join),Doe=Uc(1.1.toString),xoe=Uc([].pop),pE=Uc([].push),YP=Uc("".replace),Loe=Uc([].shift),Moe=Uc("".split),fT=Uc("".slice),VR=Uc("".toLowerCase),Uoe=Uc([].unshift),qP="Invalid scheme",mT="Invalid host",nj="Invalid port",rj=/[a-z]/i,Voe=/[\d+-.a-z]/i,XP=/\d/,Foe=/^0x/i,joe=/^[0-7]+$/,Boe=/^\d+$/,ij=/^[\da-f]+$/i,Woe=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Goe=/[\0\t\n\r #/:<>?@[\\\]^|]/,Hoe=/^[\u0000-\u0020]+/,zoe=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Koe=/[\t\n\r]/g,gT=function(e){var t,r,o,c;if(typeof e=="number"){for(t=[],r=0;r<4;r++)Uoe(t,e%256),e=koe(e/256);return pT(t,".")}if(typeof e=="object"){for(t="",o=(function(u){for(var h=null,m=1,g=null,y=0,v=0;v<8;v++)u[v]!==0?(y>m&&(h=g,m=y),g=null,y=0):(g===null&&(g=v),++y);return y>m?g:h})(e),r=0;r<8;r++)c&&e[r]===0||(c&&(c=!1),o===r?(t+=r?":":"::",c=!0):(t+=Doe(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},FR={},sj=zP({},FR,{" ":1,'"':1,"<":1,">":1,"`":1}),oj=zP({},sj,{"#":1,"?":1,"{":1,"}":1}),JP=zP({},oj,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),mp=function(e,t){var r=Roe(e,0);return r>32&&r<127&&!HP(t,e)?e:encodeURIComponent(e)},jR={ftp:21,file:null,http:80,https:443,ws:80,wss:443},_T=function(e,t){var r;return e.length===2&&Ml(rj,Fc(e,0))&&((r=Fc(e,1))===":"||!t&&r==="|")},aj=function(e){var t;return e.length>1&&_T(fT(e,0,2))&&(e.length===2||(t=Fc(e,2))==="/"||t==="\\"||t==="?"||t==="#")},Yoe=function(e){return e==="."||VR(e)==="%2e"},$P={},cj={},QP={},lj={},uj={},ZP={},dj={},hj={},BR={},WR={},e1={},t1={},n1={},r1={},pj={},i1={},fE={},Ku={},fj={},Rm={},$d={},s1=function(e,t,r){var o,c,u,h=Jd(e);if(t){if(c=this.parse(h))throw new KP(c);this.searchParams=null}else{if(r!==void 0&&(o=new s1(r,!0)),c=this.parse(h,null,o))throw new KP(c);(u=Poe(new Noe)).bindURL(this),this.searchParams=u}};s1.prototype={type:"URL",parse:function(e,t,r){var o,c,u,h,m,g=this,y=t||$P,v=0,R="",b=!1,A=!1,F=!1;for(e=Jd(e),t||(g.scheme="",g.username="",g.password="",g.host=null,g.port=null,g.path=[],g.query=null,g.fragment=null,g.cannotBeABaseURL=!1,e=YP(e,Hoe,""),e=YP(e,zoe,"$1")),e=YP(e,Koe,""),o=hE(e);v<=o.length;){switch(c=o[v],y){case $P:if(!c||!Ml(rj,c)){if(t)return qP;y=QP;continue}R+=VR(c),y=cj;break;case cj:if(c&&(Ml(Voe,c)||c==="+"||c==="-"||c==="."))R+=VR(c);else{if(c!==":"){if(t)return qP;R="",y=QP,v=0;continue}if(t&&(g.isSpecial()!==HP(jR,R)||R==="file"&&(g.includesCredentials()||g.port!==null)||g.scheme==="file"&&!g.host))return;if(g.scheme=R,t)return void(g.isSpecial()&&jR[g.scheme]===g.port&&(g.port=null));R="",g.scheme==="file"?y=r1:g.isSpecial()&&r&&r.scheme===g.scheme?y=lj:g.isSpecial()?y=hj:o[v+1]==="/"?(y=uj,v++):(g.cannotBeABaseURL=!0,pE(g.path,""),y=fj)}break;case QP:if(!r||r.cannotBeABaseURL&&c!=="#")return qP;if(r.cannotBeABaseURL&&c==="#"){g.scheme=r.scheme,g.path=Ll(r.path),g.query=r.query,g.fragment="",g.cannotBeABaseURL=!0,y=$d;break}y=r.scheme==="file"?r1:ZP;continue;case lj:if(c!=="/"||o[v+1]!=="/"){y=ZP;continue}y=BR,v++;break;case uj:if(c==="/"){y=WR;break}y=Ku;continue;case ZP:if(g.scheme=r.scheme,c===Mc)g.username=r.username,g.password=r.password,g.host=r.host,g.port=r.port,g.path=Ll(r.path),g.query=r.query;else if(c==="/"||c==="\\"&&g.isSpecial())y=dj;else if(c==="?")g.username=r.username,g.password=r.password,g.host=r.host,g.port=r.port,g.path=Ll(r.path),g.query="",y=Rm;else{if(c!=="#"){g.username=r.username,g.password=r.password,g.host=r.host,g.port=r.port,g.path=Ll(r.path),g.path.length--,y=Ku;continue}g.username=r.username,g.password=r.password,g.host=r.host,g.port=r.port,g.path=Ll(r.path),g.query=r.query,g.fragment="",y=$d}break;case dj:if(!g.isSpecial()||c!=="/"&&c!=="\\"){if(c!=="/"){g.username=r.username,g.password=r.password,g.host=r.host,g.port=r.port,y=Ku;continue}y=WR}else y=BR;break;case hj:if(y=BR,c!=="/"||Fc(R,v+1)!=="/")continue;v++;break;case BR:if(c!=="/"&&c!=="\\"){y=WR;continue}break;case WR:if(c==="@"){b&&(R="%40"+R),b=!0,u=hE(R);for(var M=0;M<u.length;M++){var j=u[M];if(j!==":"||F){var K=mp(j,JP);F?g.password+=K:g.username+=K}else F=!0}R=""}else if(c===Mc||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()){if(b&&R==="")return"Invalid authority";v-=hE(R).length+1,R="",y=e1}else R+=c;break;case e1:case t1:if(t&&g.scheme==="file"){y=i1;continue}if(c!==":"||A){if(c===Mc||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()){if(g.isSpecial()&&R==="")return mT;if(t&&R===""&&(g.includesCredentials()||g.port!==null))return;if(h=g.parseHost(R))return h;if(R="",y=fE,t)return;continue}c==="["?A=!0:c==="]"&&(A=!1),R+=c}else{if(R==="")return mT;if(h=g.parseHost(R))return h;if(R="",y=n1,t===t1)return}break;case n1:if(!Ml(XP,c)){if(c===Mc||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()||t){if(R!==""){var q=UR(R,10);if(q>65535)return nj;g.port=g.isSpecial()&&q===jR[g.scheme]?null:q,R=""}if(t)return;y=fE;continue}return nj}R+=c;break;case r1:if(g.scheme="file",c==="/"||c==="\\")y=pj;else{if(!r||r.scheme!=="file"){y=Ku;continue}switch(c){case Mc:g.host=r.host,g.path=Ll(r.path),g.query=r.query;break;case"?":g.host=r.host,g.path=Ll(r.path),g.query="",y=Rm;break;case"#":g.host=r.host,g.path=Ll(r.path),g.query=r.query,g.fragment="",y=$d;break;default:aj(pT(Ll(o,v),""))||(g.host=r.host,g.path=Ll(r.path),g.shortenPath()),y=Ku;continue}}break;case pj:if(c==="/"||c==="\\"){y=i1;break}r&&r.scheme==="file"&&!aj(pT(Ll(o,v),""))&&(_T(r.path[0],!0)?pE(g.path,r.path[0]):g.host=r.host),y=Ku;continue;case i1:if(c===Mc||c==="/"||c==="\\"||c==="?"||c==="#"){if(!t&&_T(R))y=Ku;else if(R===""){if(g.host="",t)return;y=fE}else{if(h=g.parseHost(R))return h;if(g.host==="localhost"&&(g.host=""),t)return;R="",y=fE}continue}R+=c;break;case fE:if(g.isSpecial()){if(y=Ku,c!=="/"&&c!=="\\")continue}else if(t||c!=="?")if(t||c!=="#"){if(c!==Mc&&(y=Ku,c!=="/"))continue}else g.fragment="",y=$d;else g.query="",y=Rm;break;case Ku:if(c===Mc||c==="/"||c==="\\"&&g.isSpecial()||!t&&(c==="?"||c==="#")){if((m=VR(m=R))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(g.shortenPath(),c==="/"||c==="\\"&&g.isSpecial()||pE(g.path,"")):Yoe(R)?c==="/"||c==="\\"&&g.isSpecial()||pE(g.path,""):(g.scheme==="file"&&!g.path.length&&_T(R)&&(g.host&&(g.host=""),R=Fc(R,0)+":"),pE(g.path,R)),R="",g.scheme==="file"&&(c===Mc||c==="?"||c==="#"))for(;g.path.length>1&&g.path[0]==="";)Loe(g.path);c==="?"?(g.query="",y=Rm):c==="#"&&(g.fragment="",y=$d)}else R+=mp(c,oj);break;case fj:c==="?"?(g.query="",y=Rm):c==="#"?(g.fragment="",y=$d):c!==Mc&&(g.path[0]+=mp(c,FR));break;case Rm:t||c!=="#"?c!==Mc&&(c==="'"&&g.isSpecial()?g.query+="%27":g.query+=c==="#"?"%23":mp(c,FR)):(g.fragment="",y=$d);break;case $d:c!==Mc&&(g.fragment+=mp(c,sj))}v++}},parseHost:function(e){var t,r,o;if(Fc(e,0)==="["){if(Fc(e,e.length-1)!=="]"||(t=(function(c){var u,h,m,g,y,v,R,b=[0,0,0,0,0,0,0,0],A=0,F=null,M=0,j=function(){return Fc(c,M)};if(j()===":"){if(Fc(c,1)!==":")return;M+=2,F=++A}for(;j();){if(A===8)return;if(j()!==":"){for(u=h=0;h<4&&Ml(ij,j());)u=16*u+UR(j(),16),M++,h++;if(j()==="."){if(h===0||(M-=h,A>6))return;for(m=0;j();){if(g=null,m>0){if(!(j()==="."&&m<4))return;M++}if(!Ml(XP,j()))return;for(;Ml(XP,j());){if(y=UR(j(),10),g===null)g=y;else{if(g===0)return;g=10*g+y}if(g>255)return;M++}b[A]=256*b[A]+g,++m!=2&&m!==4||A++}if(m!==4)return;break}if(j()===":"){if(M++,!j())return}else if(j())return;b[A++]=u}else{if(F!==null)return;M++,F=++A}}if(F!==null)for(v=A-F,A=7;A!==0&&v>0;)R=b[A],b[A--]=b[F+v-1],b[F+--v]=R;else if(A!==8)return;return b})(fT(e,1,-1)),!t))return mT;this.host=t}else if(this.isSpecial()){if(e=boe(e),Ml(Woe,e)||(t=(function(c){var u,h,m,g,y,v,R,b=Moe(c,".");if(b.length&&b[b.length-1]===""&&b.length--,(u=b.length)>4)return c;for(h=[],m=0;m<u;m++){if((g=b[m])==="")return c;if(y=10,g.length>1&&Fc(g,0)==="0"&&(y=Ml(Foe,g)?16:8,g=fT(g,y===8?1:2)),g==="")v=0;else{if(!Ml(y===10?Boe:y===8?joe:ij,g))return c;v=UR(g,y)}pE(h,v)}for(m=0;m<u;m++)if(v=h[m],m===u-1){if(v>=tj(256,5-u))return null}else if(v>255)return null;for(R=xoe(h),m=0;m<h.length;m++)R+=h[m]*tj(256,3-m);return R})(e),t===null))return mT;this.host=t}else{if(Ml(Goe,e))return mT;for(t="",r=hE(e),o=0;o<r.length;o++)t+=mp(r[o],FR);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return HP(jR,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&_T(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,o=e.password,c=e.host,u=e.port,h=e.path,m=e.query,g=e.fragment,y=t+":";return c!==null?(y+="//",e.includesCredentials()&&(y+=r+(o?":"+o:"")+"@"),y+=gT(c),u!==null&&(y+=":"+u)):t==="file"&&(y+="//"),y+=e.cannotBeABaseURL?h[0]:h.length?"/"+pT(h,"/"):"",m!==null&&(y+="?"+m),g!==null&&(y+="#"+g),y},setHref:function(e){var t=this.parse(e);if(t)throw new KP(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new mE(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+gT(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Jd(e)+":",$P)},getUsername:function(){return this.username},setUsername:function(e){var t=hE(Jd(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=mp(t[r],JP)}},getPassword:function(){return this.password},setPassword:function(e){var t=hE(Jd(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=mp(t[r],JP)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?gT(e):gT(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,e1)},getHostname:function(){var e=this.host;return e===null?"":gT(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,t1)},getPort:function(){var e=this.port;return e===null?"":Jd(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Jd(e))===""?this.port=null:this.parse(e,n1))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+pT(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,fE))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Jd(e))===""?this.query=null:(Fc(e,0)==="?"&&(e=fT(e,1)),this.query="",this.parse(e,Rm)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Jd(e))!==""?(Fc(e,0)==="#"&&(e=fT(e,1)),this.fragment="",this.parse(e,$d)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var mE=function(e){var t=Coe(this,Xo),r=Aoe(arguments.length,1)>1?arguments[1]:void 0,o=Ooe(t,new s1(e,!1,r));WP||(t.href=o.serialize(),t.origin=o.getOrigin(),t.protocol=o.getProtocol(),t.username=o.getUsername(),t.password=o.getPassword(),t.host=o.getHost(),t.hostname=o.getHostname(),t.port=o.getPort(),t.pathname=o.getPathname(),t.search=o.getSearch(),t.searchParams=o.getSearchParams(),t.hash=o.getHash())},Xo=mE.prototype,jc=function(e,t){return{get:function(){return MR(this)[e]()},set:t&&function(r){return MR(this)[t](r)},configurable:!0,enumerable:!0}};if(WP&&(Vc(Xo,"href",jc("serialize","setHref")),Vc(Xo,"origin",jc("getOrigin")),Vc(Xo,"protocol",jc("getProtocol","setProtocol")),Vc(Xo,"username",jc("getUsername","setUsername")),Vc(Xo,"password",jc("getPassword","setPassword")),Vc(Xo,"host",jc("getHost","setHost")),Vc(Xo,"hostname",jc("getHostname","setHostname")),Vc(Xo,"port",jc("getPort","setPort")),Vc(Xo,"pathname",jc("getPathname","setPathname")),Vc(Xo,"search",jc("getSearch","setSearch")),Vc(Xo,"searchParams",jc("getSearchParams")),Vc(Xo,"hash",jc("getHash","setHash"))),LR(Xo,"toJSON",function(){return MR(this).serialize()},{enumerable:!0}),LR(Xo,"toString",function(){return MR(this).serialize()},{enumerable:!0}),hT){var mj=hT.createObjectURL,gj=hT.revokeObjectURL;mj&&LR(mE,"createObjectURL",QF(mj,hT)),gj&&LR(mE,"revokeObjectURL",QF(gj,hT))}Ioe(mE,"URL"),Toe({global:!0,forced:!woe,sham:!WP},{URL:mE});var qoe=Sn,_j=d,Xoe=la,Ej=eo,Joe=OR,o1=Ir("URL"),$oe=Joe&&_j(function(){o1.canParse()}),Qoe=_j(function(){return o1.canParse.length!==1});qoe({target:"URL",stat:!0,forced:!$oe||Qoe},{canParse:function(e){var t=Xoe(arguments.length,1),r=Ej(e),o=t<2||arguments[1]===void 0?void 0:Ej(arguments[1]);try{return!!new o1(r,o)}catch{return!1}}});var Zoe=Sn,eae=la,yj=eo,tae=OR,nae=Ir("URL");Zoe({target:"URL",stat:!0,forced:!tae},{parse:function(e){var t=eae(arguments.length,1),r=yj(e),o=t<2||arguments[1]===void 0?void 0:yj(arguments[1]);try{return new nae(r,o)}catch{return null}}});var GR=l(fi.URL);let vj=!0,Sj=!0;function HR(e,t,r){let o=e.match(t);return o&&o.length>=r&&parseInt(o[r],10)}function bm(e,t,r){if(!e.RTCPeerConnection)return;let o=e.RTCPeerConnection.prototype,c=o.addEventListener;o.addEventListener=function(h,m){if(h!==t)return c.apply(this,arguments);let g=y=>{let v=r(y);v&&(m.handleEvent?m.handleEvent(v):m(v))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(m,g),c.apply(this,[h,g])};let u=o.removeEventListener;o.removeEventListener=function(h,m){if(h!==t||!this._eventMap||!this._eventMap[t])return u.apply(this,arguments);if(!this._eventMap[t].has(m))return u.apply(this,arguments);let g=this._eventMap[t].get(m);return this._eventMap[t].delete(m),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[h,g])},Object.defineProperty(o,"on"+t,{get(){return this["_on"+t]},set(h){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),h&&this.addEventListener(t,this["_on"+t]=h)},enumerable:!0,configurable:!0})}function rae(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(vj=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function iae(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Sj=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Tj(){if(typeof window=="object"){if(vj)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function a1(e,t){Sj&&console.warn(e+" is deprecated, please use "+t+" instead.")}function wj(e){return Object.prototype.toString.call(e)==="[object Object]"}function Cj(e){var t;return wj(e)?to(t=Object.keys(e)).call(t,function(r,o){let c=wj(e[o]),u=c?Cj(e[o]):e[o],h=c&&!Object.keys(u).length;return u===void 0||h?r:Object.assign(r,{[o]:u})},{}):e}function c1(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach(o=>{o.endsWith("Id")?c1(e,e.get(t[o]),r):o.endsWith("Ids")&&t[o].forEach(c=>{c1(e,e.get(c),r)})}))}function Rj(e,t,r){let o=r?"outbound-rtp":"inbound-rtp",c=new Map;if(t===null)return c;let u=[];return e.forEach(h=>{h.type==="track"&&h.trackIdentifier===t.id&&u.push(h)}),u.forEach(h=>{e.forEach(m=>{m.type===o&&m.trackId===h.id&&c1(e,m,c)})}),c}let bj=Tj;function Ij(e,t){let r=e&&e.navigator;if(!r.mediaDevices)return;let o=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;let m={};return Object.keys(h).forEach(g=>{if(g==="require"||g==="advanced"||g==="mediaSource")return;let y=typeof h[g]=="object"?h[g]:{ideal:h[g]};y.exact!==void 0&&typeof y.exact=="number"&&(y.min=y.max=y.exact);let v=function(R,b){return R?R+b.charAt(0).toUpperCase()+b.slice(1):b==="deviceId"?"sourceId":b};if(y.ideal!==void 0){m.optional=m.optional||[];let R={};typeof y.ideal=="number"?(R[v("min",g)]=y.ideal,m.optional.push(R),R={},R[v("max",g)]=y.ideal,m.optional.push(R)):(R[v("",g)]=y.ideal,m.optional.push(R))}y.exact!==void 0&&typeof y.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[v("",g)]=y.exact):["min","max"].forEach(R=>{y[R]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[v(R,g)]=y[R])})}),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},c=function(h,m){if(t.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){let g=function(y,v,R){v in y&&!(R in y)&&(y[R]=y[v],delete y[v])};g((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),g(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=o(h.audio)}if(h&&typeof h.video=="object"){let g=h.video.facingMode;g=g&&(typeof g=="object"?g:{ideal:g});let y=t.version<66;if(g&&(g.exact==="user"||g.exact==="environment"||g.ideal==="user"||g.ideal==="environment")&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||y)){let v;if(delete h.video.facingMode,g.exact==="environment"||g.ideal==="environment"?v=["back","rear"]:g.exact!=="user"&&g.ideal!=="user"||(v=["front"]),v)return r.mediaDevices.enumerateDevices().then(R=>{R=R.filter(A=>A.kind==="videoinput");let b=R.find(A=>v.some(F=>{var M;return ke(M=A.label.toLowerCase()).call(M,F)}));return!b&&R.length&&ke(v).call(v,"back")&&(b=R[R.length-1]),b&&(h.video.deviceId=g.exact?{exact:b.deviceId}:{ideal:b.deviceId}),h.video=o(h.video),bj("chrome: "+JSON.stringify(h)),m(h)})}h.video=o(h.video)}return bj("chrome: "+JSON.stringify(h)),m(h)},u=function(h){return t.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=(function(h,m,g){c(h,y=>{r.webkitGetUserMedia(y,m,v=>{g&&g(u(v))})})}).bind(r),r.mediaDevices.getUserMedia){let h=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(m){return c(m,g=>h(g).then(y=>{if(g.audio&&!y.getAudioTracks().length||g.video&&!y.getVideoTracks().length)throw y.getTracks().forEach(v=>{v.stop()}),new DOMException("","NotFoundError");return y},y=>ze.reject(u(y))))}}}function Aj(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Oj(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.track.id):{track:o.track};let u=new Event("track");u.track=o.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[r.stream],this.dispatchEvent(u)}),r.stream.getTracks().forEach(o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.id):{track:o};let u=new Event("track");u.track=o,u.receiver=c,u.transceiver={receiver:c},u.streams=[r.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else bm(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function Nj(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let c=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(h,m){let g=c.apply(this,arguments);return g||(g=t(this,h),this._senders.push(g)),g};let u=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(h){u.apply(this,arguments);let m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],r.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(t(this,u))})};let o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],o.apply(this,[c]),c.getTracks().forEach(u=>{let h=this._senders.find(m=>m.track===u);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let r=t.apply(this,[]);return r.forEach(o=>o._pc=this),r},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Pj(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[r,o,c]=arguments;if(arguments.length>0&&typeof r=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof r!="function"))return t.apply(this,[]);let u=function(m){let g={};return m.result().forEach(y=>{let v={id:y.id,timestamp:y.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[y.type]||y.type};y.names().forEach(R=>{v[R]=y.stat(R)}),g[v.id]=v}),g},h=function(m){return new Map(Object.keys(m).map(g=>[g,m[g]]))};if(arguments.length>=2){let m=function(g){o(h(u(g)))};return t.apply(this,[m,r])}return new ze((m,g)=>{t.apply(this,[function(y){m(h(u(y)))},g])}).then(o,c)}}function kj(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){let c=r.apply(this,[]);return c.forEach(u=>u._pc=this),c});let o=e.RTCPeerConnection.prototype.addTrack;o&&(e.RTCPeerConnection.prototype.addTrack=function(){let c=o.apply(this,arguments);return c._pc=this,c}),e.RTCRtpSender.prototype.getStats=function(){let c=this;return this._pc.getStats().then(u=>Rj(u,c.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){let o=r.apply(this,[]);return o.forEach(c=>c._pc=this),o}),bm(e,"track",o=>(o.receiver._pc=o.srcElement,o)),e.RTCRtpReceiver.prototype.getStats=function(){let o=this;return this._pc.getStats().then(c=>Rj(c,o.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let r=arguments[0],o,c,u;return this.getSenders().forEach(h=>{h.track===r&&(o?u=!0:o=h)}),this.getReceivers().forEach(h=>(h.track===r&&(c?u=!0:c=h),h.track===r)),u||o&&c?ze.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():c?c.getStats():ze.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Dj(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(u,h){if(!h)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let m=t.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(g=>{if(this.getSenders().find(y=>y.track===g))throw new DOMException("Track already exists.","InvalidAccessError")});let h=this.getSenders();r.apply(this,arguments);let m=this.getSenders().filter(g=>h.indexOf(g)===-1);this._shimmedLocalStreams[u.id]=[u].concat(m)};let o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],o.apply(this,arguments)};let c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(h=>{let m=this._shimmedLocalStreams[h].indexOf(u);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function xj(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Dj(e);let r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let g=r.apply(this);return this._reverseStreams=this._reverseStreams||{},g.map(y=>this._reverseStreams[y.id])};let o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(g){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},g.getTracks().forEach(y=>{if(this.getSenders().find(v=>v.track===y))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[g.id]){let y=new e.MediaStream(g.getTracks());this._streams[g.id]=y,this._reverseStreams[y.id]=g,g=y}o.apply(this,[g])};let c=e.RTCPeerConnection.prototype.removeStream;function u(g,y){let v=y.sdp;return Object.keys(g._reverseStreams||[]).forEach(R=>{let b=g._reverseStreams[R],A=g._streams[b.id];v=v.replace(new RegExp(A.id,"g"),b.id)}),new RTCSessionDescription({type:y.type,sdp:v})}e.RTCPeerConnection.prototype.removeStream=function(g){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[g.id]||g]),delete this._reverseStreams[this._streams[g.id]?this._streams[g.id].id:g.id],delete this._streams[g.id]},e.RTCPeerConnection.prototype.addTrack=function(g,y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let v=[].slice.call(arguments,1);if(v.length!==1||!v[0].getTracks().find(b=>b===g))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(b=>b.track===g))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let R=this._streams[y.id];if(R)R.addTrack(g),ze.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let b=new e.MediaStream([g]);this._streams[y.id]=b,this._reverseStreams[b.id]=y,this.addStream(b)}return this.getSenders().find(b=>b.track===g)},["createOffer","createAnswer"].forEach(function(g){let y=e.RTCPeerConnection.prototype[g],v={[g](){let R=arguments;return arguments.length&&typeof arguments[0]=="function"?y.apply(this,[b=>{let A=u(this,b);R[0].apply(null,[A])},b=>{R[1]&&R[1].apply(null,b)},arguments[2]]):y.apply(this,arguments).then(b=>u(this,b))}};e.RTCPeerConnection.prototype[g]=v[g]});let h=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(function(g,y){let v=y.sdp;return Object.keys(g._reverseStreams||[]).forEach(R=>{let b=g._reverseStreams[R],A=g._streams[b.id];v=v.replace(new RegExp(b.id,"g"),A.id)}),new RTCSessionDescription({type:y.type,sdp:v})})(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};let m=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let g=m.get.apply(this);return g.type===""?g:u(this,g)}}),e.RTCPeerConnection.prototype.removeTrack=function(g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!g._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(g._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let y;this._streams=this._streams||{},Object.keys(this._streams).forEach(v=>{this._streams[v].getTracks().find(R=>g.track===R)&&(y=this._streams[v])}),y&&(y.getTracks().length===1?this.removeStream(this._reverseStreams[y.id]):y.removeTrack(g.track),this.dispatchEvent(new Event("negotiationneeded")))}}function l1(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){let o=e.RTCPeerConnection.prototype[r],c={[r](){return arguments[0]=new(r==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[r]=c[r]})}function Lj(e,t){bm(e,"negotiationneeded",r=>{let o=r.target;if(!(t.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")||o.signalingState==="stable")return r})}var Mj=Object.freeze({__proto__:null,fixNegotiationNeeded:Lj,shimAddTrackRemoveTrack:xj,shimAddTrackRemoveTrackWithNative:Dj,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(o=>{let c=r.video&&r.video.width,u=r.video&&r.video.height,h=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:h||3}},c&&(r.video.mandatory.maxWidth=c),u&&(r.video.mandatory.maxHeight=u),e.navigator.mediaDevices.getUserMedia(r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:Nj,shimGetStats:Pj,shimGetUserMedia:Ij,shimMediaStream:Aj,shimOnTrack:Oj,shimPeerConnection:l1,shimSenderReceiverGetStats:kj});function Uj(e,t){let r=e&&e.navigator,o=e&&e.MediaStreamTrack;if(r.getUserMedia=function(c,u,h){a1("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(c).then(u,h)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){let c=function(h,m,g){m in h&&!(g in h)&&(h[g]=h[m],delete h[m])},u=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),u(h)},o&&o.prototype.getSettings){let h=o.prototype.getSettings;o.prototype.getSettings=function(){let m=h.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(o&&o.prototype.applyConstraints){let h=o.prototype.applyConstraints;o.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function Vj(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function u1(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){let u=e.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};e.RTCPeerConnection.prototype[c]=h[c]});let r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[c,u,h]=arguments;return o.apply(this,[c||null]).then(m=>{if(t.version<53&&!u)try{m.forEach(g=>{g.type=r[g.type]||g.type})}catch(g){if(g.name!=="TypeError")throw g;m.forEach((y,v)=>{m.set(v,Object.assign({},y,{type:r[y.type]||y.type}))})}return m}).then(u,h)}}function Fj(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let o=t.apply(this,[]);return o.forEach(c=>c._pc=this),o});let r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){let o=r.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):ze.resolve(new Map)}}function jj(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let r=t.apply(this,[]);return r.forEach(o=>o._pc=this),r}),bm(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Bj(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){a1("removeStream","removeTrack"),this.getSenders().forEach(r=>{var o;r.track&&ke(o=t.getTracks()).call(o,r.track)&&this.removeTrack(r)})})}function Wj(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Gj(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];let o=r.length>0;o&&r.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let c=t.apply(this,arguments);if(o){let{sender:u}=c,h=u.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=r,u.sendEncodings=r,this.setParametersPromises.push(u.setParameters(h).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return c})}function Hj(e){if(typeof e!="object"||!e.RTCRtpSender)return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let r=t.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function zj(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ze.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function Kj(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ze.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var Yj=Object.freeze({__proto__:null,shimAddTransceiver:Gj,shimCreateAnswer:Kj,shimCreateOffer:zj,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){let o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,ze.reject(o)}return r.video===!0?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})},shimGetParameters:Hj,shimGetUserMedia:Uj,shimOnTrack:Vj,shimPeerConnection:u1,shimRTCDataChannel:Wj,shimReceiverGetStats:jj,shimRemoveStream:Bj,shimSenderGetStats:Fj});function qj(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(r){var o;this._localStreams||(this._localStreams=[]),ke(o=this._localStreams).call(o,r)||this._localStreams.push(r),r.getAudioTracks().forEach(c=>t.call(this,c,r)),r.getVideoTracks().forEach(c=>t.call(this,c,r))},e.RTCPeerConnection.prototype.addTrack=function(r){for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c&&c.forEach(h=>{var m;this._localStreams?ke(m=this._localStreams).call(m,h)||this._localStreams.push(h):this._localStreams=[h]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);let r=this._localStreams.indexOf(t);if(r===-1)return;this._localStreams.splice(r,1);let o=t.getTracks();this.getSenders().forEach(c=>{ke(o).call(o,c.track)&&this.removeTrack(c)})})}}function Xj(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(c=>{var u;if(this._remoteStreams||(this._remoteStreams=[]),ke(u=this._remoteStreams).call(u,c))return;this._remoteStreams.push(c);let h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(c=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(c)>=0)return;r._remoteStreams.push(c);let u=new Event("addstream");u.stream=c,r.dispatchEvent(u)})}),t.apply(r,arguments)}}}function Jj(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,r=t.createOffer,o=t.createAnswer,c=t.setLocalDescription,u=t.setRemoteDescription,h=t.addIceCandidate;t.createOffer=function(g,y){let v=arguments.length>=2?arguments[2]:arguments[0],R=r.apply(this,[v]);return y?(R.then(g,y),ze.resolve()):R},t.createAnswer=function(g,y){let v=arguments.length>=2?arguments[2]:arguments[0],R=o.apply(this,[v]);return y?(R.then(g,y),ze.resolve()):R};let m=function(g,y,v){let R=c.apply(this,[g]);return v?(R.then(y,v),ze.resolve()):R};t.setLocalDescription=m,m=function(g,y,v){let R=u.apply(this,[g]);return v?(R.then(y,v),ze.resolve()):R},t.setRemoteDescription=m,m=function(g,y,v){let R=h.apply(this,[g]);return v?(R.then(y,v),ze.resolve()):R},t.addIceCandidate=m}function $j(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let r=t.mediaDevices,o=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=c=>o(Qj(c))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(r,o,c){t.mediaDevices.getUserMedia(r).then(o,c)}).bind(t))}function Qj(e){return e&&e.video!==void 0?Object.assign({},e,{video:Cj(e.video)}):e}function Zj(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(r,o){if(r&&r.iceServers){let c=[];for(let u=0;u<r.iceServers.length;u++){let h=r.iceServers[u];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(a1("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(r.iceServers[u])}r.iceServers=c}return new t(r,o)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function e3(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function t3(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(r){if(r){r.offerToReceiveAudio!==void 0&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);let o=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):r.offerToReceiveAudio!==!0||o||this.addTransceiver("audio",{direction:"recvonly"}),r.offerToReceiveVideo!==void 0&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);let c=this.getTransceivers().find(u=>u.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):r.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function n3(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var r3=Object.freeze({__proto__:null,shimAudioContext:n3,shimCallbacksAPI:Jj,shimConstraints:Qj,shimCreateOfferLegacy:t3,shimGetUserMedia:$j,shimLocalStreamsAPI:qj,shimRTCIceServerUrls:Zj,shimRemoteStreamsAPI:Xj,shimTrackEventTransceiver:e3}),i3=`	
\v\f\r \u2028\u2029\uFEFF`,sae=Mr,oae=eo,d1=i3,s3=I("".replace),aae=RegExp("^["+d1+"]+"),cae=RegExp("(^|[^"+d1+"])["+d1+"]+$"),lae=function(e){return function(t){var r=oae(sae(t));return r=s3(r,aae,""),r=s3(r,cae,"$1"),r}},uae={trim:lae()},dae=U_.PROPER,hae=d,o3=i3,pae=uae.trim;Sn({target:"String",proto:!0,forced:(function(e){return hae(function(){return!!o3[e]()||""[e]()!==""||dae&&o3[e].name!==e})})("trim")},{trim:function(){return pae(this)}});var fae=To("String","trim"),mae=N,gae=fae,h1=String.prototype,_ae=function(e){var t=e.trim;return typeof e=="string"||e===h1||mae(h1,e)&&t===h1.trim?gae:t},Bs=l(_ae),a3={exports:{}};(function(e){let t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(r){return r.trim().split(`
`).map(o=>o.trim())},t.splitSections=function(r){return r.split(`
m=`).map((o,c)=>(c>0?"m="+o:o).trim()+`\r
`)},t.getDescription=function(r){let o=t.splitSections(r);return o&&o[0]},t.getMediaSections=function(r){let o=t.splitSections(r);return o.shift(),o},t.matchPrefix=function(r,o){return t.splitLines(r).filter(c=>c.indexOf(o)===0)},t.parseCandidate=function(r){let o;o=r.indexOf("a=candidate:")===0?r.substring(12).split(" "):r.substring(10).split(" ");let c={foundation:o[0],component:{1:"rtp",2:"rtcp"}[o[1]]||o[1],protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]};for(let u=8;u<o.length;u+=2)switch(o[u]){case"raddr":c.relatedAddress=o[u+1];break;case"rport":c.relatedPort=parseInt(o[u+1],10);break;case"tcptype":c.tcpType=o[u+1];break;case"ufrag":c.ufrag=o[u+1],c.usernameFragment=o[u+1];break;default:c[o[u]]===void 0&&(c[o[u]]=o[u+1])}return c},t.writeCandidate=function(r){let o=[];o.push(r.foundation);let c=r.component;c==="rtp"?o.push(1):c==="rtcp"?o.push(2):o.push(c),o.push(r.protocol.toUpperCase()),o.push(r.priority),o.push(r.address||r.ip),o.push(r.port);let u=r.type;return o.push("typ"),o.push(u),u!=="host"&&r.relatedAddress&&r.relatedPort&&(o.push("raddr"),o.push(r.relatedAddress),o.push("rport"),o.push(r.relatedPort)),r.tcpType&&r.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(o.push("ufrag"),o.push(r.usernameFragment||r.ufrag)),"candidate:"+o.join(" ")},t.parseIceOptions=function(r){return r.substring(14).split(" ")},t.parseRtpMap=function(r){let o=r.substring(9).split(" "),c={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),c.name=o[0],c.clockRate=parseInt(o[1],10),c.channels=o.length===3?parseInt(o[2],10):1,c.numChannels=c.channels,c},t.writeRtpMap=function(r){let o=r.payloadType;r.preferredPayloadType!==void 0&&(o=r.preferredPayloadType);let c=r.channels||r.numChannels||1;return"a=rtpmap:"+o+" "+r.name+"/"+r.clockRate+(c!==1?"/"+c:"")+`\r
`},t.parseExtmap=function(r){let o=r.substring(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1],attributes:o.slice(2).join(" ")}},t.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&r.direction!=="sendrecv"?"/"+r.direction:"")+" "+r.uri+(r.attributes?" "+r.attributes:"")+`\r
`},t.parseFmtp=function(r){let o={},c,u=r.substring(r.indexOf(" ")+1).split(";");for(let h=0;h<u.length;h++)c=u[h].trim().split("="),o[c[0].trim()]=c[1];return o},t.writeFmtp=function(r){let o="",c=r.payloadType;if(r.preferredPayloadType!==void 0&&(c=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){let u=[];Object.keys(r.parameters).forEach(h=>{r.parameters[h]!==void 0?u.push(h+"="+r.parameters[h]):u.push(h)}),o+="a=fmtp:"+c+" "+u.join(";")+`\r
`}return o},t.parseRtcpFb=function(r){let o=r.substring(r.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},t.writeRtcpFb=function(r){let o="",c=r.payloadType;return r.preferredPayloadType!==void 0&&(c=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(u=>{o+="a=rtcp-fb:"+c+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),o},t.parseSsrcMedia=function(r){let o=r.indexOf(" "),c={ssrc:parseInt(r.substring(7,o),10)},u=r.indexOf(":",o);return u>-1?(c.attribute=r.substring(o+1,u),c.value=r.substring(u+1)):c.attribute=r.substring(o+1),c},t.parseSsrcGroup=function(r){let o=r.substring(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(c=>parseInt(c,10))}},t.getMid=function(r){let o=t.matchPrefix(r,"a=mid:")[0];if(o)return o.substring(6)},t.parseFingerprint=function(r){let o=r.substring(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1].toUpperCase()}},t.getDtlsParameters=function(r,o){return{role:"auto",fingerprints:t.matchPrefix(r+o,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(r,o){let c="a=setup:"+o+`\r
`;return r.fingerprints.forEach(u=>{c+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),c},t.parseCryptoLine=function(r){let o=r.substring(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},t.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+(typeof r.keyParams=="object"?t.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(r){if(r.indexOf("inline:")!==0)return null;let o=r.substring(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},t.getCryptoParameters=function(r,o){return t.matchPrefix(r+o,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(r,o){let c=t.matchPrefix(r+o,"a=ice-ufrag:")[0],u=t.matchPrefix(r+o,"a=ice-pwd:")[0];return c&&u?{usernameFragment:c.substring(12),password:u.substring(10)}:null},t.writeIceParameters=function(r){let o="a=ice-ufrag:"+r.usernameFragment+`\r
a=ice-pwd:`+r.password+`\r
`;return r.iceLite&&(o+=`a=ice-lite\r
`),o},t.parseRtpParameters=function(r){let o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=t.splitLines(r)[0].split(" ");o.profile=c[2];for(let h=3;h<c.length;h++){let m=c[h],g=t.matchPrefix(r,"a=rtpmap:"+m+" ")[0];if(g){let y=t.parseRtpMap(g),v=t.matchPrefix(r,"a=fmtp:"+m+" ");switch(y.parameters=v.length?t.parseFmtp(v[0]):{},y.rtcpFeedback=t.matchPrefix(r,"a=rtcp-fb:"+m+" ").map(t.parseRtcpFb),o.codecs.push(y),y.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(y.name.toUpperCase())}}}t.matchPrefix(r,"a=extmap:").forEach(h=>{o.headerExtensions.push(t.parseExtmap(h))});let u=t.matchPrefix(r,"a=rtcp-fb:* ").map(t.parseRtcpFb);return o.codecs.forEach(h=>{u.forEach(m=>{h.rtcpFeedback.find(g=>g.type===m.type&&g.parameter===m.parameter)||h.rtcpFeedback.push(m)})}),o},t.writeRtpDescription=function(r,o){let c="";c+="m="+r+" ",c+=o.codecs.length>0?"9":"0",c+=" "+(o.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=o.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(h=>{c+=t.writeRtpMap(h),c+=t.writeFmtp(h),c+=t.writeRtcpFb(h)});let u=0;return o.codecs.forEach(h=>{h.maxptime>u&&(u=h.maxptime)}),u>0&&(c+="a=maxptime:"+u+`\r
`),o.headerExtensions&&o.headerExtensions.forEach(h=>{c+=t.writeExtmap(h)}),c},t.parseRtpEncodingParameters=function(r){let o=[],c=t.parseRtpParameters(r),u=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=t.matchPrefix(r,"a=ssrc:").map(b=>t.parseSsrcMedia(b)).filter(b=>b.attribute==="cname"),g=m.length>0&&m[0].ssrc,y,v=t.matchPrefix(r,"a=ssrc-group:FID").map(b=>b.substring(17).split(" ").map(A=>parseInt(A,10)));v.length>0&&v[0].length>1&&v[0][0]===g&&(y=v[0][1]),c.codecs.forEach(b=>{if(b.name.toUpperCase()==="RTX"&&b.parameters.apt){let A={ssrc:g,codecPayloadType:parseInt(b.parameters.apt,10)};g&&y&&(A.rtx={ssrc:y}),o.push(A),u&&(A=JSON.parse(JSON.stringify(A)),A.fec={ssrc:g,mechanism:h?"red+ulpfec":"red"},o.push(A))}}),o.length===0&&g&&o.push({ssrc:g});let R=t.matchPrefix(r,"b=");return R.length&&(R=R[0].indexOf("b=TIAS:")===0?parseInt(R[0].substring(7),10):R[0].indexOf("b=AS:")===0?1e3*parseInt(R[0].substring(5),10)*.95-16e3:void 0,o.forEach(b=>{b.maxBitrate=R})),o},t.parseRtcpParameters=function(r){let o={},c=t.matchPrefix(r,"a=ssrc:").map(m=>t.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];c&&(o.cname=c.value,o.ssrc=c.ssrc);let u=t.matchPrefix(r,"a=rtcp-rsize");o.reducedSize=u.length>0,o.compound=u.length===0;let h=t.matchPrefix(r,"a=rtcp-mux");return o.mux=h.length>0,o},t.writeRtcpParameters=function(r){let o="";return r.reducedSize&&(o+=`a=rtcp-rsize\r
`),r.mux&&(o+=`a=rtcp-mux\r
`),r.ssrc!==void 0&&r.cname&&(o+="a=ssrc:"+r.ssrc+" cname:"+r.cname+`\r
`),o},t.parseMsid=function(r){let o,c=t.matchPrefix(r,"a=msid:");if(c.length===1)return o=c[0].substring(7).split(" "),{stream:o[0],track:o[1]};let u=t.matchPrefix(r,"a=ssrc:").map(h=>t.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return u.length>0?(o=u[0].value.split(" "),{stream:o[0],track:o[1]}):void 0},t.parseSctpDescription=function(r){let o=t.parseMLine(r),c=t.matchPrefix(r,"a=max-message-size:"),u;c.length>0&&(u=parseInt(c[0].substring(19),10)),isNaN(u)&&(u=65536);let h=t.matchPrefix(r,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:o.fmt,maxMessageSize:u};let m=t.matchPrefix(r,"a=sctpmap:");if(m.length>0){let g=m[0].substring(10).split(" ");return{port:parseInt(g[0],10),protocol:g[1],maxMessageSize:u}}},t.writeSctpDescription=function(r,o){let c=[];return c=r.protocol!=="DTLS/SCTP"?["m="+r.kind+" 9 "+r.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:["m="+r.kind+" 9 "+r.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&c.push("a=max-message-size:"+o.maxMessageSize+`\r
`),c.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(r,o,c){let u,h=o!==void 0?o:2;return u=r||t.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+u+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(r,o){let c=t.splitLines(r);for(let u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substring(2)}return o?t.getDirection(o):"sendrecv"},t.getKind=function(r){return t.splitLines(r)[0].split(" ")[0].substring(2)},t.isRejected=function(r){return r.split(" ",2)[1]==="0"},t.parseMLine=function(r){let o=t.splitLines(r)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},t.parseOLine=function(r){let o=t.matchPrefix(r,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},t.isValidSDP=function(r){if(typeof r!="string"||r.length===0)return!1;let o=t.splitLines(r);for(let c=0;c<o.length;c++)if(o[c].length<2||o[c].charAt(1)!=="=")return!1;return!0},e.exports=t})(a3);var c3=a3.exports,gE=l(c3),Eae=s({__proto__:null,default:gE},[c3]);function zR(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&((r=JSON.parse(JSON.stringify(r))).candidate=r.candidate.substr(2)),r.candidate&&r.candidate.length){let o=new t(r),c=gE.parseCandidate(r.candidate),u=Object.assign(o,c);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new t(r)},e.RTCIceCandidate.prototype=t.prototype,bm(e,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new e.RTCIceCandidate(r.candidate),writable:"false"}),r))}function p1(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||bm(e,"icecandidate",t=>{if(t.candidate){let r=gE.parseCandidate(t.candidate.candidate);r.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r.priority>>24])}return t})}function KR(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});let r=function(m){if(!m||!m.sdp)return!1;let g=gE.splitSections(m.sdp);return g.shift(),g.some(y=>{let v=gE.parseMLine(y);return v&&v.kind==="application"&&v.protocol.indexOf("SCTP")!==-1})},o=function(m){let g=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(g===null||g.length<2)return-1;let y=parseInt(g[1],10);return y!=y?-1:y},c=function(m){let g=65536;return t.browser==="firefox"&&(g=t.version<57?m===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),g},u=function(m,g){let y=65536;t.browser==="firefox"&&t.version===57&&(y=65535);let v=gE.matchPrefix(m.sdp,"a=max-message-size:");return v.length>0?y=parseInt(v[0].substr(19),10):t.browser==="firefox"&&g!==-1&&(y=2147483637),y},h=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){let{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){let m=o(arguments[0]),g=c(m),y=u(arguments[0],m),v;v=g===0&&y===0?Number.POSITIVE_INFINITY:g===0||y===0?Math.max(g,y):Math.min(g,y);let R={};Object.defineProperty(R,"maxMessageSize",{get:()=>v}),this._sctp=R}return h.apply(this,arguments)}}function YR(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(o,c){let u=o.send;o.send=function(){let h=arguments[0],m=h.length||h.size||h.byteLength;if(o.readyState==="open"&&c.sctp&&m>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(o,arguments)}}let r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let o=r.apply(this,arguments);return t(o,this),o},bm(e,"datachannel",o=>(t(o.channel,o.target),o))}function f1(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{let o=t[r];t[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{let u=c.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;let h=new Event("connectionstatechange",c);u.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function m1(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;let r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let c=o.sdp.split(`
`).filter(u=>Bs(u).call(u)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&o instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:o.type,sdp:c}):o.sdp=c}return r.apply(this,arguments)}}function qR(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let r=e.RTCPeerConnection.prototype.addIceCandidate;r&&r.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?ze.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ze.resolve())})}function XR(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let r=e.RTCPeerConnection.prototype.setLocalDescription;r&&r.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return r.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer"}return o.sdp||o.type!=="offer"&&o.type!=="answer"?r.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>r.apply(this,[c]))})}var yae=Object.freeze({__proto__:null,removeExtmapAllowMixed:m1,shimAddIceCandidateNullOrEmpty:qR,shimConnectionState:f1,shimMaxMessageSize:KR,shimParameterlessSetLocalDescription:XR,shimRTCIceCandidate:zR,shimRTCIceCandidateRelayProtocol:p1,shimSendThrowTypeError:YR});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},r=Tj,o=(function(u){let h={browser:null,version:null};if(u===void 0||!u.navigator)return h.browser="Not a browser.",h;let{navigator:m}=u;if(m.mozGetUserMedia)h.browser="firefox",h.version=HR(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection)h.browser="chrome",h.version=HR(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!u.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=HR(m.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return h})(e),c={browserDetails:o,commonShim:yae,extractVersion:HR,disableLog:rae,disableWarnings:iae,sdp:Eae};switch(o.browser){case"chrome":if(!Mj||!l1||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),c;if(o.version===null)return r("Chrome shim can not determine version, not shimming."),c;r("adapter.js shimming chrome."),c.browserShim=Mj,qR(e,o),XR(e),Ij(e,o),Aj(e),l1(e,o),Oj(e),xj(e,o),Nj(e),Pj(e),kj(e),Lj(e,o),zR(e),p1(e),f1(e),KR(e,o),YR(e),m1(e,o);break;case"firefox":if(!Yj||!u1||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),c;r("adapter.js shimming firefox."),c.browserShim=Yj,qR(e,o),XR(e),Uj(e,o),u1(e,o),Vj(e),Bj(e),Fj(e),jj(e),Wj(e),Gj(e),Hj(e),zj(e),Kj(e),zR(e),f1(e),KR(e,o),YR(e);break;case"safari":if(!r3||!t.shimSafari)return r("Safari shim is not included in this adapter release."),c;r("adapter.js shimming safari."),c.browserShim=r3,qR(e,o),XR(e),Zj(e),t3(e),Jj(e),qj(e),Xj(e),e3(e),$j(e),n3(e),zR(e),p1(e),KR(e,o),YR(e),m1(e,o);break;default:r("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var vae=d,l3=W.RegExp,Sae=!vae(function(){var e=!0;try{l3(".","d")}catch{e=!1}var t={},r="",o=e?"dgimsy":"gimsy",c=function(m,g){Object.defineProperty(t,m,{get:function(){return r+=g,!0}})},u={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var h in e&&(u.hasIndices="d"),u)c(h,u[h]);return Object.getOwnPropertyDescriptor(l3.prototype,"flags").get.call(t)!==o||r!==o}),Tae=Is,wae=je,Cae=Ur,Rae=N,u3={correct:Sae},bae=function(){var e=Tae(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},Iae=RegExp.prototype,g1=u3.correct?function(e){return e.flags}:function(e){return u3.correct||!Rae(Iae,e)||Cae(e,"flags")?e.flags:wae(bae,e)},_1=I,Aae=Math.floor,E1=_1("".charAt),Oae=_1("".replace),y1=_1("".slice),Nae=/\$([$&'`]|\d{1,2})/g,Pae=Sn,kae=je,v1=I,d3=Mr,Dae=ye,xae=Wr,Lae=c_,_E=eo,Mae=We,Uae=g1,Vae=function(e,t,r,o,c,u){var h=r+e.length,m=o.length,g=Nae;return Oae(u,g,function(y,v){var R;switch(E1(v,0)){case"$":return"$";case"&":return e;case"`":return y1(t,0,r);case"'":return y1(t,h);case"<":R=c[y1(v,1,-1)];break;default:var b=+v;if(b===0)return y;if(b>m){var A=Aae(b/10);return A===0?y:A<=m?o[A-1]===void 0?E1(v,1):o[A-1]+E1(v,1):y}R=o[b-1]}return R===void 0?"":R})},Fae=Er("replace"),jae=TypeError,S1=v1("".indexOf),Bae=v1("".replace),h3=v1("".slice),Wae=Math.max;Pae({target:"String",proto:!0},{replaceAll:function(e,t){var r,o,c,u,h,m,g,y,v,R,b=d3(this),A=0,F="";if(xae(e)){if((r=Lae(e))&&(o=_E(d3(Uae(e))),!~S1(o,"g")))throw new jae("`.replaceAll` does not allow non-global regexes");if(c=Mae(e,Fae))return kae(c,e,b,t);if(r)return Bae(_E(b),e,t)}for(u=_E(b),h=_E(e),(m=Dae(t))||(t=_E(t)),g=h.length,y=Wae(1,g),v=S1(u,h);v!==-1;)R=m?_E(t(h,v,u)):Vae(h,u,v,[],void 0,t),F+=h3(u,A,v)+R,A=v+g,v=v+y>u.length?-1:S1(u,h,v+y);return A<u.length&&(F+=h3(u,A)),F}});var Gae=To("String","replaceAll"),Hae=N,zae=Gae,T1=String.prototype,Kae=function(e){var t=e.replaceAll;return typeof e=="string"||e===T1||Hae(T1,e)&&t===T1.replaceAll?zae:t},Yae=l(Kae),w1=W;Sn({global:!0,forced:w1.globalThis!==w1},{globalThis:w1});var p3=l(W),C1={exports:{}};(function(e,t){(function(r,o){var c="function",u="undefined",h="object",m="string",g="major",y="model",v="name",R="type",b="vendor",A="version",F="architecture",M="console",j="mobile",K="tablet",q="smarttv",Q="wearable",se="embedded",oe="Amazon",te="Apple",de="ASUS",Ce="BlackBerry",Pe="Browser",Qe="Chrome",ot="Firefox",Xt="Google",Lt="Honor",jt="Huawei",En="LG",lr="Microsoft",Re="Motorola",Ve="Nvidia",Ze="OnePlus",Ne="Opera",L="OPPO",J="Samsung",ie="Sharp",Ue="Sony",Rt="Xiaomi",$n="Zebra",Ai="Facebook",sc="Chromium OS",Mp="Mac OS",XI=" Browser",hy=function(ni){for(var ui={},tr=0;tr<ni.length;tr++)ui[ni[tr].toUpperCase()]=ni[tr];return ui},JI=function(ni,ui){return typeof ni===m&&lg(ui).indexOf(lg(ni))!==-1},lg=function(ni){return ni.toLowerCase()},v0=function(ni,ui){if(typeof ni===m)return ni=ni.replace(/^\s\s*/,""),typeof ui===u?ni:ni.substring(0,500)},ug=function(ni,ui){for(var tr,ko,nu,jr,lh,un,ru=0;ru<ui.length&&!lh;){var dg=ui[ru],dd=ui[ru+1];for(tr=ko=0;tr<dg.length&&!lh&&dg[tr];)if(lh=dg[tr++].exec(ni))for(nu=0;nu<dd.length;nu++)un=lh[++ko],typeof(jr=dd[nu])===h&&jr.length>0?jr.length===2?typeof jr[1]==c?this[jr[0]]=jr[1].call(this,un):this[jr[0]]=jr[1]:jr.length===3?typeof jr[1]!==c||jr[1].exec&&jr[1].test?this[jr[0]]=un?un.replace(jr[1],jr[2]):o:this[jr[0]]=un?jr[1].call(this,un,jr[2]):o:jr.length===4&&(this[jr[0]]=un?jr[3].call(this,un.replace(jr[1],jr[2])):o):this[jr]=un||o;ru+=2}},Up=function(ni,ui){for(var tr in ui)if(typeof ui[tr]===h&&ui[tr].length>0){for(var ko=0;ko<ui[tr].length;ko++)if(JI(ui[tr][ko],ni))return tr==="?"?o:tr}else if(JI(ui[tr],ni))return tr==="?"?o:tr;return ui.hasOwnProperty("*")?ui["*"]:ni},eK={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},tK={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[A,[v,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[A,[v,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[v,A],[/opios[\/ ]+([\w\.]+)/i],[A,[v,Ne+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[A,[v,Ne+" GX"]],[/\bopr\/([\w\.]+)/i],[A,[v,Ne]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[A,[v,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[A,[v,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[v,A],[/quark(?:pc)?\/([-\w\.]+)/i],[A,[v,"Quark"]],[/\bddg\/([\w\.]+)/i],[A,[v,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[A,[v,"UC"+Pe]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[A,[v,"WeChat"]],[/konqueror\/([\w\.]+)/i],[A,[v,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[A,[v,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[A,[v,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[A,[v,"Smart Lenovo "+Pe]],[/(avast|avg)\/([\w\.]+)/i],[[v,/(.+)/,"$1 Secure "+Pe],A],[/\bfocus\/([\w\.]+)/i],[A,[v,ot+" Focus"]],[/\bopt\/([\w\.]+)/i],[A,[v,Ne+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[A,[v,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[A,[v,"Dolphin"]],[/coast\/([\w\.]+)/i],[A,[v,Ne+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[A,[v,"MIUI"+XI]],[/fxios\/([\w\.-]+)/i],[A,[v,ot]],[/\bqihoobrowser\/?([\w\.]*)/i],[A,[v,"360"]],[/\b(qq)\/([\w\.]+)/i],[[v,/(.+)/,"$1Browser"],A],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[v,/(.+)/,"$1"+XI],A],[/samsungbrowser\/([\w\.]+)/i],[A,[v,J+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[A,[v,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[v,"Sogou Mobile"],A],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[v,A],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[v],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[A,v],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[v,Ai],A],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[v,A],[/\bgsa\/([\w\.]+) .*safari\//i],[A,[v,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[A,[v,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[A,[v,Qe+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[v,Qe+" WebView"],A],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[A,[v,"Android "+Pe]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[v,A],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[A,[v,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[A,v],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[v,[A,Up,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[v,A],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[v,"Netscape"],A],[/(wolvic|librewolf)\/([\w\.]+)/i],[v,A],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[A,[v,ot+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[v,[A,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[v,[A,/master.|lts./,""]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[F,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[F,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[F,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[F,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[F,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[F,/ower/,"",lg]],[/ sun4\w[;\)]/i],[[F,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[F,lg]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[y,[b,J],[R,K]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[y,[b,J],[R,j]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[y,[b,te],[R,j]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[y,[b,te],[R,K]],[/(macintosh);/i],[y,[b,te]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[y,[b,ie],[R,j]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[y,[b,Lt],[R,K]],[/honor([-\w ]+)[;\)]/i],[y,[b,Lt],[R,j]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[y,[b,jt],[R,K]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[y,[b,jt],[R,j]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[y,/_/g," "],[b,Rt],[R,K]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[y,/_/g," "],[b,Rt],[R,j]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[y,[b,L],[R,j]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[y,[b,Up,{OnePlus:["304","403","203"],"*":L}],[R,K]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[y,[b,"Vivo"],[R,j]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[y,[b,"Realme"],[R,j]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[y,[b,Re],[R,j]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[y,[b,Re],[R,K]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[y,[b,En],[R,K]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv|watch)\w+)/i,/\blg-?([\d\w]+) bui/i],[y,[b,En],[R,j]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[y,[b,"Lenovo"],[R,K]],[/(nokia) (t[12][01])/i],[b,y,[R,K]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[y,/_/g," "],[R,j],[b,"Nokia"]],[/(pixel (c|tablet))\b/i],[y,[b,Xt],[R,K]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[y,[b,Xt],[R,j]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[y,[b,Ue],[R,j]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[y,"Xperia Tablet"],[b,Ue],[R,K]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[y,[b,Ze],[R,j]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[y,[b,oe],[R,K]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[y,/(.+)/g,"Fire Phone $1"],[b,oe],[R,j]],[/(playbook);[-\w\),; ]+(rim)/i],[y,b,[R,K]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[y,[b,Ce],[R,j]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[y,[b,de],[R,K]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[y,[b,de],[R,j]],[/(nexus 9)/i],[y,[b,"HTC"],[R,K]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[b,[y,/_/g," "],[R,j]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[y,[b,"TCL"],[R,K]],[/(itel) ((\w+))/i],[[b,lg],y,[R,Up,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[y,[b,"Acer"],[R,K]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[y,[b,"Meizu"],[R,j]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[y,[b,"Ulefone"],[R,j]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[y,[b,"Energizer"],[R,j]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[y,[b,"Cat"],[R,j]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[y,[b,"Smartfren"],[R,j]],[/droid.+; (a(?:015|06[35]|142p?))/i],[y,[b,"Nothing"],[R,j]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[y,[b,"Archos"],[R,K]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[y,[b,"Archos"],[R,j]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[b,y,[R,K]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (hmd|imo) ([\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[b,y,[R,j]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[b,y,[R,K]],[/(surface duo)/i],[y,[b,lr],[R,K]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[y,[b,"Fairphone"],[R,j]],[/(u304aa)/i],[y,[b,"AT&T"],[R,j]],[/\bsie-(\w*)/i],[y,[b,"Siemens"],[R,j]],[/\b(rct\w+) b/i],[y,[b,"RCA"],[R,K]],[/\b(venue[\d ]{2,7}) b/i],[y,[b,"Dell"],[R,K]],[/\b(q(?:mv|ta)\w+) b/i],[y,[b,"Verizon"],[R,K]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[y,[b,"Barnes & Noble"],[R,K]],[/\b(tm\d{3}\w+) b/i],[y,[b,"NuVision"],[R,K]],[/\b(k88) b/i],[y,[b,"ZTE"],[R,K]],[/\b(nx\d{3}j) b/i],[y,[b,"ZTE"],[R,j]],[/\b(gen\d{3}) b.+49h/i],[y,[b,"Swiss"],[R,j]],[/\b(zur\d{3}) b/i],[y,[b,"Swiss"],[R,K]],[/\b((zeki)?tb.*\b) b/i],[y,[b,"Zeki"],[R,K]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[b,"Dragon Touch"],y,[R,K]],[/\b(ns-?\w{0,9}) b/i],[y,[b,"Insignia"],[R,K]],[/\b((nxa|next)-?\w{0,9}) b/i],[y,[b,"NextBook"],[R,K]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[b,"Voice"],y,[R,j]],[/\b(lvtel\-)?(v1[12]) b/i],[[b,"LvTel"],y,[R,j]],[/\b(ph-1) /i],[y,[b,"Essential"],[R,j]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[y,[b,"Envizen"],[R,K]],[/\b(trio[-\w\. ]+) b/i],[y,[b,"MachSpeed"],[R,K]],[/\btu_(1491) b/i],[y,[b,"Rotor"],[R,K]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[y,[b,Ve],[R,K]],[/(sprint) (\w+)/i],[b,y,[R,j]],[/(kin\.[onetw]{3})/i],[[y,/\./g," "],[b,lr],[R,j]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[y,[b,$n],[R,K]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[y,[b,$n],[R,j]],[/smart-tv.+(samsung)/i],[b,[R,q]],[/hbbtv.+maple;(\d+)/i],[[y,/^/,"SmartTV"],[b,J],[R,q]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[b,En],[R,q]],[/(apple) ?tv/i],[b,[y,te+" TV"],[R,q]],[/crkey/i],[[y,Qe+"cast"],[b,Xt],[R,q]],[/droid.+aft(\w+)( bui|\))/i],[y,[b,oe],[R,q]],[/(shield \w+ tv)/i],[y,[b,Ve],[R,q]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[y,[b,ie],[R,q]],[/(bravia[\w ]+)( bui|\))/i],[y,[b,Ue],[R,q]],[/(mi(tv|box)-?\w+) bui/i],[y,[b,Rt],[R,q]],[/Hbbtv.*(technisat) (.*);/i],[b,y,[R,q]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[b,v0],[y,v0],[R,q]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[y,[R,q]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[R,q]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[b,y,[R,M]],[/droid.+; (shield)( bui|\))/i],[y,[b,Ve],[R,M]],[/(playstation \w+)/i],[y,[b,Ue],[R,M]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[y,[b,lr],[R,M]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[y,[b,J],[R,Q]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[b,y,[R,Q]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[y,[b,L],[R,Q]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[y,[b,te],[R,Q]],[/(opwwe\d{3})/i],[y,[b,Ze],[R,Q]],[/(moto 360)/i],[y,[b,Re],[R,Q]],[/(smartwatch 3)/i],[y,[b,Ue],[R,Q]],[/(g watch r)/i],[y,[b,En],[R,Q]],[/droid.+; (wt63?0{2,3})\)/i],[y,[b,$n],[R,Q]],[/droid.+; (glass) \d/i],[y,[b,Xt],[R,Q]],[/(pico) (4|neo3(?: link|pro)?)/i],[b,y,[R,Q]],[/; (quest( \d| pro)?)/i],[y,[b,Ai],[R,Q]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[b,[R,se]],[/(aeobc)\b/i],[y,[b,oe],[R,se]],[/(homepod).+mac os/i],[y,[b,te],[R,se]],[/windows iot/i],[[R,se]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[y,[R,j]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[y,[R,K]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[R,K]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[R,j]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[y,[b,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[A,[v,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[v,A],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[A,[v,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[v,A],[/ladybird\//i],[[v,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[A,v]],os:[[/microsoft (windows) (vista|xp)/i],[v,A],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[v,[A,Up,eK]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[A,Up,eK],[v,"Windows"]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[A,/_/g,"."],[v,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[v,Mp],[A,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[A,v],[/(ubuntu) ([\w\.]+) like android/i],[[v,/(.+)/,"$1 Touch"],A],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/; ]?([\d\.]*)/i],[v,A],[/\(bb(10);/i],[A,[v,Ce]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[A,[v,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[A,[v,ot+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[A,[v,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[A,[v,"watchOS"]],[/crkey\/([\d\.]+)/i],[A,[v,Qe+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[v,sc],A],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[v,A],[/(sunos) ?([\w\.\d]*)/i],[[v,"Solaris"],A],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[v,A]]},tu=function(ni,ui){if(typeof ni===h&&(ui=ni,ni=o),!(this instanceof tu))return new tu(ni,ui).getResult();var tr=typeof r!==u&&r.navigator?r.navigator:o,ko=ni||(tr&&tr.userAgent?tr.userAgent:""),nu=tr&&tr.userAgentData?tr.userAgentData:o,jr=ui?(function(un,ru){var dg={};for(var dd in un)ru[dd]&&ru[dd].length%2==0?dg[dd]=ru[dd].concat(un[dd]):dg[dd]=un[dd];return dg})(tK,ui):tK,lh=tr&&tr.userAgent==ko;return this.getBrowser=function(){var un={};return un[v]=o,un[A]=o,ug.call(un,ko,jr.browser),un[g]=(function(ru){return typeof ru===m?ru.replace(/[^\d\.]/g,"").split(".")[0]:o})(un[A]),lh&&tr&&tr.brave&&typeof tr.brave.isBrave==c&&(un[v]="Brave"),un},this.getCPU=function(){var un={};return un[F]=o,ug.call(un,ko,jr.cpu),un},this.getDevice=function(){var un={};return un[b]=o,un[y]=o,un[R]=o,ug.call(un,ko,jr.device),lh&&!un[R]&&nu&&nu.mobile&&(un[R]=j),lh&&un[y]=="Macintosh"&&tr&&typeof tr.standalone!==u&&tr.maxTouchPoints&&tr.maxTouchPoints>2&&(un[y]="iPad",un[R]=K),un},this.getEngine=function(){var un={};return un[v]=o,un[A]=o,ug.call(un,ko,jr.engine),un},this.getOS=function(){var un={};return un[v]=o,un[A]=o,ug.call(un,ko,jr.os),lh&&!un[v]&&nu&&nu.platform&&nu.platform!="Unknown"&&(un[v]=nu.platform.replace(/chrome os/i,sc).replace(/macos/i,Mp)),un},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ko},this.setUA=function(un){return ko=typeof un===m&&un.length>500?v0(un,500):un,this},this.setUA(ko),this};tu.VERSION="0.7.41",tu.BROWSER=hy([v,A,g]),tu.CPU=hy([F]),tu.DEVICE=hy([y,b,R,M,j,q,K,Q,se]),tu.ENGINE=tu.OS=hy([v,A]),e.exports&&(t=e.exports=tu),t.UAParser=tu;var py=typeof r!==u&&(r.jQuery||r.Zepto);if(py&&!py.ua){var $I=new tu;py.ua=$I.getResult(),py.ua.get=function(){return $I.getUA()},py.ua.set=function(ni){$I.setUA(ni);var ui=$I.getResult();for(var tr in ui)py.ua[tr]=ui[tr]}}})(typeof window=="object"?window:a)})(C1,C1.exports);var qae=l(C1.exports),f3=op.clear;Sn({global:!0,bind:!0,forced:W.clearImmediate!==f3},{clearImmediate:f3});var m3=W,Xae=$,Jae=ye,$ae=jf,Qae=lt,Zae=Bi,ece=la,tce=m3.Function,nce=/MSIE .\./.test(Qae)||$ae==="BUN"&&(function(){var e=m3.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")})(),rce=Sn,g3=W,_3=op.set,ice=function(e,t){var r=1;return nce?function(o,c){var u=ece(arguments.length,1)>r,h=Jae(o)?o:tce(o),m=u?Zae(arguments,r):[],g=u?function(){Xae(h,this,m)}:h;return e(g)}:e},E3=g3.setImmediate?ice(_3):_3;rce({global:!0,bind:!0,forced:g3.setImmediate!==E3},{setImmediate:E3});var y3=l(fi.setImmediate),sce=W,oce=oT,ace=kr,cce=la,lce=Te;Sn({global:!0,dontCallGetSet:!0,forced:d(function(){return lce&&Object.getOwnPropertyDescriptor(sce,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){cce(arguments.length,1),oce(ace(e))}});var v3=l(fi.queueMicrotask);function S3(e,t){return function(){return e.apply(t,arguments)}}let{toString:uce}=Object.prototype,{getPrototypeOf:R1}=Object,{iterator:JR,toStringTag:T3}=Symbol,$R=(b1=Object.create(null),e=>{let t=uce.call(e);return b1[t]||(b1[t]=t.slice(8,-1).toLowerCase())});var b1;let Ul=e=>(e=e.toLowerCase(),t=>$R(t)===e),QR=e=>t=>typeof t===e,{isArray:EE}=Array,yE=QR("undefined");function ET(e){return e!==null&&!yE(e)&&e.constructor!==null&&!yE(e.constructor)&&ha(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}let w3=Ul("ArrayBuffer"),dce=QR("string"),ha=QR("function"),C3=QR("number"),yT=e=>e!==null&&typeof e=="object",ZR=e=>{if($R(e)!=="object")return!1;let t=R1(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||T3 in e||JR in e)},hce=Ul("Date"),pce=Ul("File"),fce=Ul("Blob"),mce=Ul("FileList"),gce=Ul("URLSearchParams"),[_ce,Ece,yce,vce]=["ReadableStream","Request","Response","Headers"].map(Ul);function vT(e,t){let r,o,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),EE(e))for(r=0,o=e.length;r<o;r++)t.call(null,e[r],r,e);else{if(ET(e))return;let u=c?Object.getOwnPropertyNames(e):Object.keys(e),h=u.length,m;for(r=0;r<h;r++)m=u[r],t.call(null,e[m],m,e)}}function R3(e,t){if(ET(e))return null;t=t.toLowerCase();let r=Object.keys(e),o,c=r.length;for(;c-- >0;)if(o=r[c],t===o.toLowerCase())return o;return null}let Im=p3!==void 0?p3:typeof self<"u"?self:typeof window<"u"?window:global,b3=e=>!yE(e)&&e!==Im,Sce=(I1=typeof Uint8Array<"u"&&R1(Uint8Array),e=>I1&&e instanceof I1);var I1;let Tce=Ul("HTMLFormElement"),I3=(e=>{let{hasOwnProperty:t}=e;return(r,o)=>t.call(r,o)})(Object.prototype),wce=Ul("RegExp"),A3=(e,t)=>{let r=Object.getOwnPropertyDescriptors(e),o={};vT(r,(c,u)=>{let h;(h=t(c,u,e))!==!1&&(o[u]=h||c)}),Object.defineProperties(e,o)},Cce=Ul("AsyncFunction"),O3=(N3=typeof y3=="function",P3=ha(Im.postMessage),N3?y3:P3?(A1="axios@".concat(Math.random()),eb=[],Im.addEventListener("message",e=>{let{source:t,data:r}=e;t===Im&&r===A1&&eb.length&&eb.shift()()},!1),e=>{eb.push(e),Im.postMessage(A1,"*")}):e=>setTimeout(e));var N3,P3,A1,eb;let Rce=v3!==void 0?v3.bind(Im):typeof process<"u"&&process.nextTick||O3;var qe={isArray:EE,isArrayBuffer:w3,isBuffer:ET,isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||ha(e.append)&&((t=$R(e))==="formdata"||t==="object"&&ha(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&w3(e.buffer),t},isString:dce,isNumber:C3,isBoolean:e=>e===!0||e===!1,isObject:yT,isPlainObject:ZR,isEmptyObject:e=>{if(!yT(e)||ET(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},isReadableStream:_ce,isRequest:Ece,isResponse:yce,isHeaders:vce,isUndefined:yE,isDate:hce,isFile:pce,isBlob:fce,isRegExp:wce,isFunction:ha,isStream:e=>yT(e)&&ha(e.pipe),isURLSearchParams:gce,isTypedArray:Sce,isFileList:mce,forEach:vT,merge:function e(){let{caseless:t,skipUndefined:r}=b3(this)&&this||{},o={},c=(u,h)=>{let m=t&&R3(o,h)||h;ZR(o[m])&&ZR(u)?o[m]=e(o[m],u):ZR(u)?o[m]=e({},u):EE(u)?o[m]=u.slice():r&&yE(u)||(o[m]=u)};for(let u=0,h=arguments.length;u<h;u++)arguments[u]&&vT(arguments[u],c);return o},extend:function(e,t,r){let{allOwnKeys:o}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return vT(t,(c,u)=>{r&&ha(c)?e[u]=S3(c,r):e[u]=c},{allOwnKeys:o}),e},trim:e=>Bs(e)?Bs(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,r,o)=>{e.prototype=Object.create(t.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},toFlatObject:(e,t,r,o)=>{let c,u,h,m={};if(t=t||{},e==null)return t;do{for(c=Object.getOwnPropertyNames(e),u=c.length;u-- >0;)h=c[u],o&&!o(h,e,t)||m[h]||(t[h]=e[h],m[h]=!0);e=r!==!1&&R1(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:$R,kindOfTest:Ul,endsWith:(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;let o=e.indexOf(t,r);return o!==-1&&o===r},toArray:e=>{if(!e)return null;if(EE(e))return e;let t=e.length;if(!C3(t))return null;let r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},forEachEntry:(e,t)=>{let r=(e&&e[JR]).call(e),o;for(;(o=r.next())&&!o.done;){let c=o.value;t.call(e,c[0],c[1])}},matchAll:(e,t)=>{let r,o=[];for(;(r=e.exec(t))!==null;)o.push(r);return o},isHTMLForm:Tce,hasOwnProperty:I3,hasOwnProp:I3,reduceDescriptors:A3,freezeMethods:e=>{A3(e,(t,r)=>{if(ha(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;let o=e[r];ha(o)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")}))})},toObjectSet:(e,t)=>{let r={},o=c=>{c.forEach(u=>{r[u]=!0})};return EE(e)?o(e):o(String(e).split(t)),r},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,o){return r.toUpperCase()+o}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:R3,global:Im,isContextDefined:b3,isSpecCompliantForm:function(e){return!!(e&&ha(e.append)&&e[T3]==="FormData"&&e[JR])},toJSONObject:e=>{let t=new Array(10),r=(o,c)=>{if(yT(o)){if(t.indexOf(o)>=0)return;if(ET(o))return o;if(!("toJSON"in o)){t[c]=o;let u=EE(o)?[]:{};return vT(o,(h,m)=>{let g=r(h,c+1);!yE(g)&&(u[m]=g)}),t[c]=void 0,u}}return o};return r(e,0)},isAsyncFn:Cce,isThenable:e=>e&&(yT(e)||ha(e))&&ha(e.then)&&ha(e.catch),setImmediate:O3,asap:Rce,isIterable:e=>e!=null&&ha(e[JR])};function Un(e,t,r,o,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),o&&(this.request=o),c&&(this.response=c,this.status=c.status?c.status:null)}qe.inherits(Un,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:qe.toJSONObject(this.config),code:this.code,status:this.status}}});let k3=Un.prototype,D3={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{D3[e]={value:e}}),Object.defineProperties(Un,D3),Object.defineProperty(k3,"isAxiosError",{value:!0}),Un.from=(e,t,r,o,c,u)=>{let h=Object.create(k3);qe.toFlatObject(e,h,function(y){return y!==Error.prototype},y=>y!=="isAxiosError");let m=e&&e.message?e.message:"Error",g=t==null&&e?e.code:t;return Un.call(h,m,g,r,o,c),e&&h.cause==null&&Object.defineProperty(h,"cause",{value:e,configurable:!0}),h.name=e&&e.name||"Error",u&&Object.assign(h,u),h};function O1(e){return qe.isPlainObject(e)||qe.isArray(e)}function x3(e){return qe.endsWith(e,"[]")?e.slice(0,-2):e}function L3(e,t,r){return e?e.concat(t).map(function(o,c){return o=x3(o),!r&&c?"["+o+"]":o}).join(r?".":""):t}let bce=qe.toFlatObject(qe,{},null,function(e){return/^is[A-Z]/.test(e)});function tb(e,t,r){if(!qe.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;let o=(r=qe.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(b,A){return!qe.isUndefined(A[b])})).metaTokens,c=r.visitor||y,u=r.dots,h=r.indexes,m=(r.Blob||typeof Blob<"u"&&Blob)&&qe.isSpecCompliantForm(t);if(!qe.isFunction(c))throw new TypeError("visitor must be a function");function g(b){if(b===null)return"";if(qe.isDate(b))return b.toISOString();if(qe.isBoolean(b))return b.toString();if(!m&&qe.isBlob(b))throw new Un("Blob is not supported. Use a Buffer instead.");return qe.isArrayBuffer(b)||qe.isTypedArray(b)?m&&typeof Blob=="function"?new Blob([b]):Buffer.from(b):b}function y(b,A,F){let M=b;if(b&&!F&&typeof b=="object"){if(qe.endsWith(A,"{}"))A=o?A:A.slice(0,-2),b=JSON.stringify(b);else if(qe.isArray(b)&&(function(j){return qe.isArray(j)&&!j.some(O1)})(b)||(qe.isFileList(b)||qe.endsWith(A,"[]"))&&(M=qe.toArray(b)))return A=x3(A),M.forEach(function(j,K){!qe.isUndefined(j)&&j!==null&&t.append(h===!0?L3([A],K,u):h===null?A:A+"[]",g(j))}),!1}return!!O1(b)||(t.append(L3(F,A,u),g(b)),!1)}let v=[],R=Object.assign(bce,{defaultVisitor:y,convertValue:g,isVisitable:O1});if(!qe.isObject(e))throw new TypeError("data must be an object");return(function b(A,F){if(!qe.isUndefined(A)){if(v.indexOf(A)!==-1)throw Error("Circular reference detected in "+F.join("."));v.push(A),qe.forEach(A,function(M,j){(!(qe.isUndefined(M)||M===null)&&c.call(t,M,qe.isString(j)?Bs(j).call(j):j,F,R))===!0&&b(M,F?F.concat(j):[j])}),v.pop()}})(e),t}function M3(e){let t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(r){return t[r]})}function N1(e,t){this._pairs=[],e&&tb(e,this,t)}let U3=N1.prototype;function Ice(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function V3(e,t,r){if(!t)return e;let o=r&&r.encode||Ice;qe.isFunction(r)&&(r={serialize:r});let c=r&&r.serialize,u;if(u=c?c(t,r):qe.isURLSearchParams(t)?t.toString():new N1(t,r).toString(o),u){let h=e.indexOf("#");h!==-1&&(e=e.slice(0,h)),e+=(e.indexOf("?")===-1?"?":"&")+u}return e}U3.append=function(e,t){this._pairs.push([e,t])},U3.toString=function(e){let t=e?function(r){return e.call(this,r,M3)}:M3;return this._pairs.map(function(r){return t(r[0])+"="+t(r[1])},"").join("&")};var F3=class{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){qe.forEach(this.handlers,function(t){t!==null&&e(t)})}},j3={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},B3={exports:{}},Ace=Sn,Oce=Te,W3=So.f;Ace({target:"Object",stat:!0,forced:Object.defineProperty!==W3,sham:!Oce},{defineProperty:W3});var G3=fi.Object,Nce=B3.exports=function(e,t,r){return G3.defineProperty(e,t,r)};G3.defineProperty.sham&&(Nce.sham=!0);var H3=l(B3.exports),Pce=TypeError,z3=yl,kce=es,Dce=Wr,xce=Er("species"),K3=Array,Lce=function(e){var t;return z3(e)&&(t=e.constructor,(kce(t)&&(t===K3||z3(t.prototype))||Dce(t)&&(t=t[xce])===null)&&(t=void 0)),t===void 0?K3:t},Y3=function(e,t){return new(Lce(e))(t===0?0:t)},Mce=d,Uce=mi,Vce=Er("species"),q3=function(e){return Uce>=51||!Mce(function(){var t=[];return(t.constructor={})[Vce]=function(){return{foo:1}},t[e](Boolean).foo!==1})},Fce=Sn,jce=d,Bce=yl,Wce=Wr,Gce=Zi,Hce=Ru,X3=function(e){if(e>9007199254740991)throw Pce("Maximum allowed index exceeded");return e},J3=FP,zce=Y3,Kce=q3,Yce=mi,$3=Er("isConcatSpreadable"),qce=Yce>=51||!jce(function(){var e=[];return e[$3]=!1,e.concat()[0]!==e}),Xce=function(e){if(!Wce(e))return!1;var t=e[$3];return t!==void 0?!!t:Bce(e)};Fce({target:"Array",proto:!0,forced:!qce||!Kce("concat")},{concat:function(e){var t,r,o,c,u,h=Gce(this),m=zce(h,0),g=0;for(t=-1,o=arguments.length;t<o;t++)if(Xce(u=t===-1?h:arguments[t]))for(c=Hce(u),X3(g+c),r=0;r<c;r++,g++)r in u&&J3(m,g,u[r]);else X3(g+1),J3(m,g++,u);return m.length=g,m}});var Q3={},Jce=ne,$ce=yi,Z3=Sl.f,Qce=Bi,eB=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Q3.f=function(e){return eB&&Jce(e)==="Window"?(function(t){try{return Z3(t)}catch{return Qce(eB)}})(e):Z3($ce(e))};var vE={},Zce=Er;vE.f=Zce;var tB=fi,ele=Ur,tle=vE,nle=So.f,Gi=function(e){var t=tB.Symbol||(tB.Symbol={});ele(t,e)||nle(t,e,{value:tle.f(e)})},rle=je,ile=Ir,sle=Er,ole=Nl,nB=function(){var e=ile("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,o=sle("toPrimitive");t&&!t[o]&&ole(t,o,function(c){return rle(r,this)},{})},ale=Tu,cle=Cn,lle=Zi,ule=Ru,dle=Y3;I([].push);var hle=function(e){return function(t,r,o,c){for(var u,h,m=lle(t),g=cle(m),y=ule(g),v=ale(r,o),R=0,b=c||dle,A=void 0;y>R;R++)R in g&&(h=v(u=g[R],R,m));return A}},rB={forEach:hle(0)},nb=Sn,ST=W,P1=je,ple=I,SE=Te,TE=vi,fle=d,Ws=Ur,mle=N,k1=Is,rb=yi,D1=Tr,gle=eo,x1=it,wE=Jf,iB=ro,_le=Sl,sB=Q3,Ele=Kh,oB=Ge,aB=So,yle=ku,cB=Ie,lB=Nl,vle=Lu,L1=Ar,uB=Ga,dB=Dr,Sle=Er,Tle=vE,wle=Gi,Cle=nB,Rle=Pc,hB=xu,ib=rB.forEach,pa=Hh("hidden"),sb="Symbol",TT="prototype",ble=hB.set,pB=hB.getterFor(sb),Vl=Object[TT],Am=ST.Symbol,ob=Am&&Am[TT],Ile=ST.RangeError,Ale=ST.TypeError,M1=ST.QObject,fB=oB.f,Om=aB.f,mB=sB.f,Ole=cB.f,gB=ple([].push),Qd=L1("symbols"),wT=L1("op-symbols"),Nle=L1("wks"),U1=!M1||!M1[TT]||!M1[TT].findChild,_B=function(e,t,r){var o=fB(Vl,t);o&&delete Vl[t],Om(e,t,r),o&&e!==Vl&&Om(Vl,t,o)},V1=SE&&fle(function(){return wE(Om({},"a",{get:function(){return Om(this,"a",{value:7}).a}})).a!==7})?_B:Om,F1=function(e,t){var r=Qd[e]=wE(ob);return ble(r,{type:sb,tag:e,description:t}),SE||(r.description=t),r},ab=function(e,t,r){e===Vl&&ab(wT,t,r),k1(e);var o=D1(t);return k1(r),Ws(Qd,o)?(r.enumerable?(Ws(e,pa)&&e[pa][o]&&(e[pa][o]=!1),r=wE(r,{enumerable:x1(0,!1)})):(Ws(e,pa)||Om(e,pa,x1(1,wE(null))),e[pa][o]=!0),V1(e,o,r)):Om(e,o,r)},j1=function(e,t){k1(e);var r=rb(t),o=iB(r).concat(SB(r));return ib(o,function(c){SE&&!P1(EB,r,c)||ab(e,c,r[c])}),e},EB=function(e){var t=D1(e),r=P1(Ole,this,t);return!(this===Vl&&Ws(Qd,t)&&!Ws(wT,t))&&(!(r||!Ws(this,t)||!Ws(Qd,t)||Ws(this,pa)&&this[pa][t])||r)},yB=function(e,t){var r=rb(e),o=D1(t);if(r!==Vl||!Ws(Qd,o)||Ws(wT,o)){var c=fB(r,o);return!c||!Ws(Qd,o)||Ws(r,pa)&&r[pa][o]||(c.enumerable=!0),c}},vB=function(e){var t=mB(rb(e)),r=[];return ib(t,function(o){Ws(Qd,o)||Ws(uB,o)||gB(r,o)}),r},SB=function(e){var t=e===Vl,r=mB(t?wT:rb(e)),o=[];return ib(r,function(c){!Ws(Qd,c)||t&&!Ws(Vl,c)||gB(o,Qd[c])}),o};TE||(Am=function(){if(mle(ob,this))throw new Ale("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?gle(arguments[0]):void 0,t=dB(e),r=function(o){var c=this===void 0?ST:this;c===Vl&&P1(r,wT,o),Ws(c,pa)&&Ws(c[pa],t)&&(c[pa][t]=!1);var u=x1(1,o);try{V1(c,t,u)}catch(h){if(!(h instanceof Ile))throw h;_B(c,t,u)}};return SE&&U1&&V1(Vl,t,{configurable:!0,set:r}),F1(t,e)},lB(ob=Am[TT],"toString",function(){return pB(this).tag}),lB(Am,"withoutSetter",function(e){return F1(dB(e),e)}),cB.f=EB,aB.f=ab,yle.f=j1,oB.f=yB,_le.f=sB.f=vB,Ele.f=SB,Tle.f=function(e){return F1(Sle(e),e)},SE&&vle(ob,"description",{configurable:!0,get:function(){return pB(this).description}})),nb({global:!0,wrap:!0,forced:!TE,sham:!TE},{Symbol:Am}),ib(iB(Nle),function(e){wle(e)}),nb({target:sb,stat:!0,forced:!TE},{useSetter:function(){U1=!0},useSimple:function(){U1=!1}}),nb({target:"Object",stat:!0,forced:!TE,sham:!SE},{create:function(e,t){return t===void 0?wE(e):j1(wE(e),t)},defineProperty:ab,defineProperties:j1,getOwnPropertyDescriptor:yB}),nb({target:"Object",stat:!0,forced:!TE},{getOwnPropertyNames:vB}),Cle(),Rle(Am,sb),uB[pa]=!0;var TB=vi&&!!Symbol.for&&!!Symbol.keyFor,Ple=Sn,kle=Ir,Dle=Ur,xle=eo,wB=Ar,Lle=TB,B1=wB("string-to-symbol-registry"),Mle=wB("symbol-to-string-registry");Ple({target:"Symbol",stat:!0,forced:!Lle},{for:function(e){var t=xle(e);if(Dle(B1,t))return B1[t];var r=kle("Symbol")(t);return B1[t]=r,Mle[r]=t,r}});var Ule=Sn,Vle=Ur,Fle=ja,jle=Wn,Ble=TB,CB=Ar("symbol-to-string-registry");Ule({target:"Symbol",stat:!0,forced:!Ble},{keyFor:function(e){if(!Fle(e))throw new TypeError(jle(e)+" is not a symbol");if(Vle(CB,e))return CB[e]}});var RB=yl,Wle=ye,bB=ne,Gle=eo,IB=I([].push),Hle=Sn,AB=Ir,OB=$,zle=je,CT=I,NB=d,PB=ye,kB=ja,DB=Bi,Kle=function(e){if(Wle(e))return e;if(RB(e)){for(var t=e.length,r=[],o=0;o<t;o++){var c=e[o];typeof c=="string"?IB(r,c):typeof c!="number"&&bB(c)!=="Number"&&bB(c)!=="String"||IB(r,Gle(c))}var u=r.length,h=!0;return function(m,g){if(h)return h=!1,g;if(RB(this))return g;for(var y=0;y<u;y++)if(r[y]===m)return g}}},Yle=vi,qle=String,gp=AB("JSON","stringify"),cb=CT(/./.exec),xB=CT("".charAt),Xle=CT("".charCodeAt),Jle=CT("".replace),$le=CT(1.1.toString),Qle=/[\uD800-\uDFFF]/g,LB=/^[\uD800-\uDBFF]$/,MB=/^[\uDC00-\uDFFF]$/,UB=!Yle||NB(function(){var e=AB("Symbol")("stringify detection");return gp([e])!=="[null]"||gp({a:e})!=="{}"||gp(Object(e))!=="{}"}),VB=NB(function(){return gp("\uDF06\uD834")!=='"\\udf06\\ud834"'||gp("\uDEAD")!=='"\\udead"'}),Zle=function(e,t){var r=DB(arguments),o=Kle(t);if(PB(o)||e!==void 0&&!kB(e))return r[1]=function(c,u){if(PB(o)&&(u=zle(o,this,qle(c),u)),!kB(u))return u},OB(gp,null,r)},eue=function(e,t,r){var o=xB(r,t-1),c=xB(r,t+1);return cb(LB,e)&&!cb(MB,c)||cb(MB,e)&&!cb(LB,o)?"\\u"+$le(Xle(e,0),16):e};gp&&Hle({target:"JSON",stat:!0,forced:UB||VB},{stringify:function(e,t,r){var o=DB(arguments),c=OB(UB?Zle:gp,null,o);return VB&&typeof c=="string"?Jle(c,Qle,eue):c}});var FB=Kh,tue=Zi;Sn({target:"Object",stat:!0,forced:!vi||d(function(){FB.f(1)})},{getOwnPropertySymbols:function(e){var t=FB.f;return t?t(tue(e)):[]}}),Gi("asyncDispose"),Gi("asyncIterator"),Gi("dispose"),Gi("hasInstance"),Gi("isConcatSpreadable"),Gi("iterator"),Gi("match"),Gi("matchAll"),Gi("replace"),Gi("search"),Gi("species"),Gi("split");var nue=nB;Gi("toPrimitive"),nue();var rue=Ir,iue=Pc;Gi("toStringTag"),iue(rue("Symbol"),"Symbol"),Gi("unscopables"),Pc(W.JSON,"JSON",!0);var sue=fi.Symbol,oue=Er,aue=So.f,jB=oue("metadata"),BB=Function.prototype;BB[jB]===void 0&&aue(BB,jB,{value:null}),Gi("metadata");var cue=sue,lue=I,W1=Ir("Symbol"),uue=W1.keyFor,due=lue(W1.prototype.valueOf),WB=W1.isRegisteredSymbol||function(e){try{return uue(due(e))!==void 0}catch{return!1}};Sn({target:"Symbol",stat:!0},{isRegisteredSymbol:WB});for(var hue=Ar,GB=Ir,pue=I,fue=ja,mue=Er,lb=GB("Symbol"),HB=lb.isWellKnownSymbol,zB=GB("Object","getOwnPropertyNames"),gue=pue(lb.prototype.valueOf),KB=hue("wks"),G1=0,YB=zB(lb),_ue=YB.length;G1<_ue;G1++)try{var qB=YB[G1];fue(lb[qB])&&mue(qB)}catch{}var XB=function(e){if(HB&&HB(e))return!0;try{for(var t=gue(e),r=0,o=zB(KB),c=o.length;r<c;r++)if(KB[o[r]]==t)return!0}catch{}return!1};Sn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:XB}),Gi("customMatcher"),Gi("observable"),Sn({target:"Symbol",stat:!0},{isRegistered:WB}),Sn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:XB}),Gi("matcher"),Gi("metadataKey"),Gi("patternMatch"),Gi("replaceAll");var CE=l(cue),JB=l(vE.f("iterator"));function RT(e){return RT=typeof CE=="function"&&typeof JB=="symbol"?function(t){return typeof t}:function(t){return t&&typeof CE=="function"&&t.constructor===CE&&t!==CE.prototype?"symbol":typeof t},RT(e)}var Eue=l(vE.f("toPrimitive"));function yue(e){var t=(function(r,o){if(RT(r)!="object"||!r)return r;var c=r[Eue];if(c!==void 0){var u=c.call(r,o);if(RT(u)!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(r)})(e,"string");return RT(t)=="symbol"?t:t+""}function V(e,t,r){return(t=yue(t))in e?H3(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var $B=l(zse),vue={isBrowser:!0,classes:{URLSearchParams:$B!==void 0?$B:N1,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};let H1=typeof window<"u"&&typeof document<"u",z1=typeof navigator=="object"&&navigator||void 0,Sue=H1&&(!z1||["ReactNative","NativeScript","NS"].indexOf(z1.product)<0),Tue=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",wue=H1&&window.location.href||"http://localhost";function QB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function ZB(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?QB(Object(r),!0).forEach(function(o){V(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):QB(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}var Io=ZB(ZB({},Object.freeze({__proto__:null,hasBrowserEnv:H1,hasStandardBrowserEnv:Sue,hasStandardBrowserWebWorkerEnv:Tue,navigator:z1,origin:wue})),vue);function e4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function Cue(e,t){return tb(e,new Io.classes.URLSearchParams,(function(r){for(var o=1;o<arguments.length;o++){var c=arguments[o]!=null?arguments[o]:{};o%2?e4(Object(c),!0).forEach(function(u){V(r,u,c[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(c)):e4(Object(c)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(c,u))})}return r})({visitor:function(r,o,c,u){return Io.isNode&&qe.isBuffer(r)?(this.append(o,r.toString("base64")),!1):u.defaultVisitor.apply(this,arguments)}},t))}var Rue=RP.charAt,t4=je,bue=Is,Iue=ye,Aue=ne,Oue=/./.exec,Nue=TypeError,Pue=Sn,n4=je,r4=De,kue=am,ub=K_,i4=Mr,s4=fC,bT=eo,Due=Is,xue=Wr,Lue=ne,Mue=c_,o4=g1,Uue=We,Vue=d,Fue=Yd,jue=function(e,t,r){return t+(r?Rue(e,t).length:1)},Bue=function(e,t){var r=e.exec;if(Iue(r)){var o=t4(r,e,t);return o!==null&&bue(o),o}if(Aue(e)==="RegExp")return t4(Oue,e,t);throw new Nue("RegExp#exec called on incompatible receiver")},a4=xu,Wue=Er("matchAll"),c4="RegExp String",l4=c4+" Iterator",Gue=a4.set,Hue=a4.getterFor(l4),zue=TypeError,K1=r4("".indexOf),db=r4("".matchAll),Y1=!!db&&!Vue(function(){db("a",/./)}),Kue=kue(function(e,t,r,o){Gue(this,{type:l4,regexp:e,string:t,global:r,unicode:o,done:!1})},c4,function(){var e=Hue(this);if(e.done)return ub(void 0,!0);var t=e.regexp,r=e.string,o=Bue(t,r);return o===null?(e.done=!0,ub(void 0,!0)):e.global?(bT(o[0])===""&&(t.lastIndex=jue(r,s4(t.lastIndex),e.unicode)),ub(o,!1)):(e.done=!0,ub(o,!1))}),u4=function(e){var t,r,o,c=Due(this),u=bT(e),h=Fue(c,RegExp),m=bT(o4(c));return t=new h(h===RegExp?c.source:c,m),r=!!~K1(m,"g"),o=!!~K1(m,"u"),t.lastIndex=s4(c.lastIndex),new Kue(t,u,r,o)};Pue({target:"String",proto:!0,forced:Y1},{matchAll:function(e){var t,r,o,c,u=i4(this);if(xue(e)){if(Mue(e)&&(t=bT(i4(o4(e))),!~K1(t,"g")))throw new zue("`.matchAll` does not allow non-global regexes");if(Y1)return db(u,e);if((o=Uue(e,Wue))===void 0&&Lue(e)==="RegExp"&&(o=u4),o)return n4(o,e,u)}else if(Y1)return db(u,e);return r=bT(u),c=new RegExp(e,"g"),n4(u4,c,r)}});var Yue=To("String","matchAll"),que=N,Xue=Yue,q1=String.prototype,Jue=function(e){var t=e.matchAll;return typeof e=="string"||e===q1||que(q1,e)&&t===q1.matchAll?Xue:t},$ue=l(Jue);function d4(e){function t(r,o,c,u){let h=r[u++];if(h==="__proto__")return!0;let m=Number.isFinite(+h),g=u>=r.length;return h=!h&&qe.isArray(c)?c.length:h,g?(qe.hasOwnProp(c,h)?c[h]=[c[h],o]:c[h]=o,!m):(c[h]&&qe.isObject(c[h])||(c[h]=[]),t(r,o,c[h],u)&&qe.isArray(c[h])&&(c[h]=(function(y){let v={},R=Object.keys(y),b,A=R.length,F;for(b=0;b<A;b++)F=R[b],v[F]=y[F];return v})(c[h])),!m)}if(qe.isFormData(e)&&qe.isFunction(e.entries)){let r={};return qe.forEachEntry(e,(o,c)=>{t((function(u){return $ue(qe).call(qe,/\w+|\[(\w*)]/g,u).map(h=>h[0]==="[]"?"":h[1]||h[0])})(o),c,r,0)}),r}return null}let X1={transitional:j3,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){let r=t.getContentType()||"",o=r.indexOf("application/json")>-1,c=qe.isObject(e);if(c&&qe.isHTMLForm(e)&&(e=new FormData(e)),qe.isFormData(e))return o?JSON.stringify(d4(e)):e;if(qe.isArrayBuffer(e)||qe.isBuffer(e)||qe.isStream(e)||qe.isFile(e)||qe.isBlob(e)||qe.isReadableStream(e))return e;if(qe.isArrayBufferView(e))return e.buffer;if(qe.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(c){if(r.indexOf("application/x-www-form-urlencoded")>-1)return Cue(e,this.formSerializer).toString();if((u=qe.isFileList(e))||r.indexOf("multipart/form-data")>-1){let h=this.env&&this.env.FormData;return tb(u?{"files[]":e}:e,h&&new h,this.formSerializer)}}return c||o?(t.setContentType("application/json",!1),(function(h,m,g){if(qe.isString(h))try{return(m||JSON.parse)(h),Bs(qe).call(qe,h)}catch(y){if(y.name!=="SyntaxError")throw y}return(g||JSON.stringify)(h)})(e)):e}],transformResponse:[function(e){let t=this.transitional||X1.transitional,r=t&&t.forcedJSONParsing,o=this.responseType==="json";if(qe.isResponse(e)||qe.isReadableStream(e))return e;if(e&&qe.isString(e)&&(r&&!this.responseType||o)){let c=!(t&&t.silentJSONParsing)&&o;try{return JSON.parse(e,this.parseReviver)}catch(u){if(c)throw u.name==="SyntaxError"?Un.from(u,Un.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Io.classes.FormData,Blob:Io.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};qe.forEach(["delete","get","head","post","put","patch"],e=>{X1.headers[e]={}});var J1=X1;let Que=qe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),h4=Symbol("internals");function IT(e){var t;return e&&Bs(t=String(e)).call(t).toLowerCase()}function hb(e){return e===!1||e==null?e:qe.isArray(e)?e.map(hb):String(e)}function $1(e,t,r,o,c){return qe.isFunction(o)?o.call(this,t,r):(c&&(t=r),qe.isString(t)?qe.isString(o)?t.indexOf(o)!==-1:qe.isRegExp(o)?o.test(t):void 0:void 0)}class pb{constructor(t){t&&this.set(t)}set(t,r,o){let c=this;function u(g,y,v){let R=IT(y);if(!R)throw new Error("header name must be a non-empty string");let b=qe.findKey(c,R);(!b||c[b]===void 0||v===!0||v===void 0&&c[b]!==!1)&&(c[b||y]=hb(g))}let h=(g,y)=>qe.forEach(g,(v,R)=>u(v,R,y));if(qe.isPlainObject(t)||t instanceof this.constructor)h(t,r);else if(qe.isString(t)&&(t=Bs(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Bs(m=t).call(m)))h((g=>{let y={},v,R,b;return g&&g.split(`
`).forEach(function(A){var F,M;b=A.indexOf(":"),v=Bs(F=A.substring(0,b)).call(F).toLowerCase(),R=Bs(M=A.substring(b+1)).call(M),!v||y[v]&&Que[v]||(v==="set-cookie"?y[v]?y[v].push(R):y[v]=[R]:y[v]=y[v]?y[v]+", "+R:R)}),y})(t),r);else if(qe.isObject(t)&&qe.isIterable(t)){let g,y,v={};for(let R of t){if(!qe.isArray(R))throw TypeError("Object iterator must return a key-value pair");v[y=R[0]]=(g=v[y])?qe.isArray(g)?[...g,R[1]]:[g,R[1]]:R[1]}h(v,r)}else t!=null&&u(r,t,o);var m;return this}get(t,r){if(t=IT(t)){let o=qe.findKey(this,t);if(o){let c=this[o];if(!r)return c;if(r===!0)return(function(u){let h=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,g;for(;g=m.exec(u);)h[g[1]]=g[2];return h})(c);if(qe.isFunction(r))return r.call(this,c,o);if(qe.isRegExp(r))return r.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=IT(t)){let o=qe.findKey(this,t);return!(!o||this[o]===void 0||r&&!$1(0,this[o],o,r))}return!1}delete(t,r){let o=this,c=!1;function u(h){if(h=IT(h)){let m=qe.findKey(o,h);!m||r&&!$1(0,o[m],m,r)||(delete o[m],c=!0)}}return qe.isArray(t)?t.forEach(u):u(t),c}clear(t){let r=Object.keys(this),o=r.length,c=!1;for(;o--;){let u=r[o];t&&!$1(0,this[u],u,t,!0)||(delete this[u],c=!0)}return c}normalize(t){let r=this,o={};return qe.forEach(this,(c,u)=>{var h;let m=qe.findKey(o,u);if(m)return r[m]=hb(c),void delete r[u];let g=t?(function(y){return Bs(y).call(y).toLowerCase().replace(/([a-z\d])(\w*)/g,(v,R,b)=>R.toUpperCase()+b)})(u):Bs(h=String(u)).call(h);g!==u&&delete r[u],r[g]=hb(c),o[g]=!0}),this}concat(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return this.constructor.concat(this,...r)}toJSON(t){let r=Object.create(null);return qe.forEach(this,(o,c)=>{o!=null&&o!==!1&&(r[c]=t&&qe.isArray(o)?o.join(", "):o)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[r,o]=t;return r+": "+o}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){let r=new this(t);for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c.forEach(h=>r.set(h)),r}static accessor(t){let r=(this[h4]=this[h4]={accessors:{}}).accessors,o=this.prototype;function c(u){let h=IT(u);r[h]||((function(m,g){let y=qe.toCamelCase(" "+g);["get","set","has"].forEach(v=>{Object.defineProperty(m,v+y,{value:function(R,b,A){return this[v].call(this,g,R,b,A)},configurable:!0})})})(o,u),r[h]=!0)}return qe.isArray(t)?t.forEach(c):c(t),this}}pb.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),qe.reduceDescriptors(pb.prototype,(e,t)=>{let{value:r}=e,o=t[0].toUpperCase()+t.slice(1);return{get:()=>r,set(c){this[o]=c}}}),qe.freezeMethods(pb);var Fl=pb;function Q1(e,t){let r=this||J1,o=t||r,c=Fl.from(o.headers),u=o.data;return qe.forEach(e,function(h){u=h.call(r,u,c.normalize(),t?t.status:void 0)}),c.normalize(),u}function p4(e){return!(!e||!e.__CANCEL__)}function RE(e,t,r){Un.call(this,e??"canceled",Un.ERR_CANCELED,t,r),this.name="CanceledError"}function f4(e,t,r){let o=r.config.validateStatus;r.status&&o&&!o(r.status)?t(new Un("Request failed with status code "+r.status,[Un.ERR_BAD_REQUEST,Un.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}qe.inherits(RE,Un,{__CANCEL__:!0});let fb=function(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,o=0,c=(function(u,h){u=u||10;let m=new Array(u),g=new Array(u),y,v=0,R=0;return h=h!==void 0?h:1e3,function(b){let A=Date.now(),F=g[R];y||(y=A),m[v]=b,g[v]=A;let M=R,j=0;for(;M!==v;)j+=m[M++],M%=u;if(v=(v+1)%u,v===R&&(R=(R+1)%u),A-y<h)return;let K=F&&A-F;return K?Math.round(1e3*j/K):void 0}})(50,250);return(function(u,h){let m,g,y=0,v=1e3/h,R=function(b){y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,g&&(clearTimeout(g),g=null),u(...b)};return[function(){let b=Date.now(),A=b-y;for(var F=arguments.length,M=new Array(F),j=0;j<F;j++)M[j]=arguments[j];A>=v?R(M,b):(m=M,g||(g=setTimeout(()=>{g=null,R(m)},v-A)))},()=>m&&R(m)]})(u=>{let h=u.loaded,m=u.lengthComputable?u.total:void 0,g=h-o,y=c(g);o=h,e({loaded:h,total:m,progress:m?h/m:void 0,bytes:g,rate:y||void 0,estimated:y&&m&&h<=m?(m-h)/y:void 0,event:u,lengthComputable:m!=null,[t?"download":"upload"]:!0})},r)},m4=(e,t)=>{let r=e!=null;return[o=>t[0]({lengthComputable:r,total:e,loaded:o}),t[1]]},g4=e=>function(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return qe.asap(()=>e(...r))};var Zue=Io.hasStandardBrowserEnv?((e,t)=>r=>(r=new GR(r,Io.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new GR(Io.origin),Io.navigator&&/(msie|trident)/i.test(Io.navigator.userAgent)):()=>!0,ede=Io.hasStandardBrowserEnv?{write(e,t,r,o,c,u,h){if(typeof document>"u")return;let m=["".concat(e,"=").concat(encodeURIComponent(t))];qe.isNumber(r)&&m.push("expires=".concat(new Date(r).toUTCString())),qe.isString(o)&&m.push("path=".concat(o)),qe.isString(c)&&m.push("domain=".concat(c)),u===!0&&m.push("secure"),qe.isString(h)&&m.push("SameSite=".concat(h)),document.cookie=m.join("; ")},read(e){if(typeof document>"u")return null;let t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read:()=>null,remove(){}};function _4(e,t,r){let o=!(function(c){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(c)})(t);return e&&(o||r==0)?(function(c,u){return u?c.replace(/\/?\/$/,"")+"/"+u.replace(/^\/+/,""):c})(e,t):t}function E4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function Z1(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?E4(Object(r),!0).forEach(function(o){V(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E4(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}let y4=e=>e instanceof Fl?Z1({},e):e;function Nm(e,t){t=t||{};let r={};function o(y,v,R,b){return qe.isPlainObject(y)&&qe.isPlainObject(v)?qe.merge.call({caseless:b},y,v):qe.isPlainObject(v)?qe.merge({},v):qe.isArray(v)?v.slice():v}function c(y,v,R,b){return qe.isUndefined(v)?qe.isUndefined(y)?void 0:o(void 0,y,0,b):o(y,v,0,b)}function u(y,v){if(!qe.isUndefined(v))return o(void 0,v)}function h(y,v){return qe.isUndefined(v)?qe.isUndefined(y)?void 0:o(void 0,y):o(void 0,v)}function m(y,v,R){return R in t?o(y,v):R in e?o(void 0,y):void 0}let g={url:u,method:u,data:u,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(y,v,R)=>c(y4(y),y4(v),0,!0)};return qe.forEach(Object.keys(Z1(Z1({},e),t)),function(y){let v=g[y]||c,R=v(e[y],t[y],y);qe.isUndefined(R)&&v!==m||(r[y]=R)}),r}var v4=e=>{let t=Nm({},e),{data:r,withXSRFToken:o,xsrfHeaderName:c,xsrfCookieName:u,headers:h,auth:m}=t;if(t.headers=h=Fl.from(h),t.url=V3(_4(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),m&&h.set("Authorization","Basic "+btoa((m.username||"")+":"+(m.password?unescape(encodeURIComponent(m.password)):""))),qe.isFormData(r)){if(Io.hasStandardBrowserEnv||Io.hasStandardBrowserWebWorkerEnv)h.setContentType(void 0);else if(qe.isFunction(r.getHeaders)){let g=r.getHeaders(),y=["content-type","content-length"];Object.entries(g).forEach(v=>{let[R,b]=v;ke(y).call(y,R.toLowerCase())&&h.set(R,b)})}}if(Io.hasStandardBrowserEnv&&(o&&qe.isFunction(o)&&(o=o(t)),o||o!==!1&&Zue(t.url))){let g=c&&u&&ede.read(u);g&&h.set(c,g)}return t},tde=typeof XMLHttpRequest<"u"&&function(e){return new ze(function(t,r){let o=v4(e),c=o.data,u=Fl.from(o.headers).normalize(),h,m,g,y,v,{responseType:R,onUploadProgress:b,onDownloadProgress:A}=o;function F(){y&&y(),v&&v(),o.cancelToken&&o.cancelToken.unsubscribe(h),o.signal&&o.signal.removeEventListener("abort",h)}let M=new XMLHttpRequest;function j(){if(!M)return;let q=Fl.from("getAllResponseHeaders"in M&&M.getAllResponseHeaders());f4(function(Q){t(Q),F()},function(Q){r(Q),F()},{data:R&&R!=="text"&&R!=="json"?M.response:M.responseText,status:M.status,statusText:M.statusText,headers:q,config:e,request:M}),M=null}M.open(o.method.toUpperCase(),o.url,!0),M.timeout=o.timeout,"onloadend"in M?M.onloadend=j:M.onreadystatechange=function(){M&&M.readyState===4&&(M.status!==0||M.responseURL&&M.responseURL.indexOf("file:")===0)&&setTimeout(j)},M.onabort=function(){M&&(r(new Un("Request aborted",Un.ECONNABORTED,e,M)),M=null)},M.onerror=function(q){let Q=new Un(q&&q.message?q.message:"Network Error",Un.ERR_NETWORK,e,M);Q.event=q||null,r(Q),M=null},M.ontimeout=function(){let q=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded",Q=o.transitional||j3;o.timeoutErrorMessage&&(q=o.timeoutErrorMessage),r(new Un(q,Q.clarifyTimeoutError?Un.ETIMEDOUT:Un.ECONNABORTED,e,M)),M=null},c===void 0&&u.setContentType(null),"setRequestHeader"in M&&qe.forEach(u.toJSON(),function(q,Q){M.setRequestHeader(Q,q)}),qe.isUndefined(o.withCredentials)||(M.withCredentials=!!o.withCredentials),R&&R!=="json"&&(M.responseType=o.responseType),A&&([g,v]=fb(A,!0),M.addEventListener("progress",g)),b&&M.upload&&([m,y]=fb(b),M.upload.addEventListener("progress",m),M.upload.addEventListener("loadend",y)),(o.cancelToken||o.signal)&&(h=q=>{M&&(r(!q||q.type?new RE(null,e,M):q),M.abort(),M=null)},o.cancelToken&&o.cancelToken.subscribe(h),o.signal&&(o.signal.aborted?h():o.signal.addEventListener("abort",h)));let K=(function(q){let Q=/^([-+\w]{1,25})(:?\/\/|:)/.exec(q);return Q&&Q[1]||""})(o.url);K&&Io.protocols.indexOf(K)===-1?r(new Un("Unsupported protocol "+K+":",Un.ERR_BAD_REQUEST,e)):M.send(c||null)})},nde=(e,t)=>{let{length:r}=e=e?e.filter(Boolean):[];if(t||r){let o,c=new AbortController,u=function(y){if(!o){o=!0,m();let v=y instanceof Error?y:this.reason;c.abort(v instanceof Un?v:new RE(v instanceof Error?v.message:v))}},h=t&&setTimeout(()=>{h=null,u(new Un("timeout ".concat(t," of ms exceeded"),Un.ETIMEDOUT))},t),m=()=>{e&&(h&&clearTimeout(h),h=null,e.forEach(y=>{y.unsubscribe?y.unsubscribe(u):y.removeEventListener("abort",u)}),e=null)};e.forEach(y=>y.addEventListener("abort",u));let{signal:g}=c;return g.unsubscribe=()=>qe.asap(m),g}},ek=l(sF),S4=vE.f("asyncIterator"),rde=l(S4);function tk(e,t){this.v=e,this.k=t}function oo(e){return function(){return new AT(e.apply(this,arguments))}}function AT(e){var t,r;function o(u,h){try{var m=e[u](h),g=m.value,y=g instanceof tk;ek.resolve(y?g.v:g).then(function(v){if(y){var R=u==="return"?"return":"next";if(!g.k||v.done)return o(R,v);v=e[R](v).value}c(m.done?"return":"normal",v)},function(v){o("throw",v)})}catch(v){c("throw",v)}}function c(u,h){switch(u){case"return":t.resolve({value:h,done:!0});break;case"throw":t.reject(h);break;default:t.resolve({value:h,done:!1})}(t=t.next)?o(t.key,t.arg):r=null}this._invoke=function(u,h){return new ek(function(m,g){var y={key:u,arg:h,resolve:m,reject:g,next:null};r?r=r.next=y:(t=r=y,o(u,h))})},typeof e.return!="function"&&(this.return=void 0)}function Ft(e){return new tk(e,0)}function bE(e){var t={},r=!1;function o(c,u){return r=!0,u=new ek(function(h){h(e[c](u))}),{done:!1,value:new tk(u,1)}}return t[CE!==void 0&&JB||"@@iterator"]=function(){return this},t.next=function(c){return r?(r=!1,c):o("next",c)},typeof e.throw=="function"&&(t.throw=function(c){if(r)throw r=!1,c;return o("throw",c)}),typeof e.return=="function"&&(t.return=function(c){return r?(r=!1,c):o("return",c)}),t}AT.prototype[typeof CE=="function"&&rde||"@@asyncIterator"]=function(){return this},AT.prototype.next=function(e){return this._invoke("next",e)},AT.prototype.throw=function(e){return this._invoke("throw",e)},AT.prototype.return=function(e){return this._invoke("return",e)};var mb=l(S4);function nk(e){var t,r,o,c=2;for(typeof Symbol<"u"&&(r=mb,o=Symbol.iterator);c--;){if(r&&(t=e[r])!=null)return t.call(e);if(o&&(t=e[o])!=null)return new gb(t.call(e));r="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function gb(e){function t(r){if(Object(r)!==r)return ze.reject(new TypeError(r+" is not an object."));var o=r.done;return ze.resolve(r.value).then(function(c){return{value:c,done:o}})}return gb=function(r){this.s=r,this.n=r.next},gb.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var o=this.s.return;return o===void 0?ze.resolve({value:r,done:!0}):t(o.apply(this.s,arguments))},throw:function(r){var o=this.s.return;return o===void 0?ze.reject(r):t(o.apply(this.s,arguments))}},new gb(e)}let ide=function*(e,t){let r=e.byteLength;if(!t||r<t)return void(yield e);let o,c=0;for(;c<r;)o=c+t,yield e.slice(c,o),c=o},sde=(function(){var e=oo(function*(t,r){var o,c=!1,u=!1;try{for(var h,m=nk(ode(t));c=!(h=yield Ft(m.next())).done;c=!1){let g=h.value;yield*bE(nk(ide(g,r)))}}catch(g){u=!0,o=g}finally{try{c&&m.return!=null&&(yield Ft(m.return()))}finally{if(u)throw o}}});return function(t,r){return e.apply(this,arguments)}})(),ode=(function(){var e=oo(function*(t){if(t[mb])return void(yield*bE(nk(t)));let r=t.getReader();try{for(;;){let{done:o,value:c}=yield Ft(r.read());if(o)break;yield c}}finally{yield Ft(r.cancel())}});return function(t){return e.apply(this,arguments)}})(),T4=(e,t,r,o)=>{let c=sde(e,t),u,h=0,m=g=>{u||(u=!0,o&&o(g))};return new ReadableStream({async pull(g){try{let{done:y,value:v}=await c.next();if(y)return m(),void g.close();let R=v.byteLength;if(r){let b=h+=R;r(b)}g.enqueue(new Uint8Array(v))}catch(y){throw m(y),y}},cancel:g=>(m(g),c.return())},{highWaterMark:2})};function w4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function C4(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?w4(Object(r),!0).forEach(function(o){V(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w4(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}let{isFunction:_b}=qe,ade=(e=>{let{Request:t,Response:r}=e;return{Request:t,Response:r}})(qe.global),{ReadableStream:R4,TextEncoder:b4}=qe.global,I4=function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];return!!e(...r)}catch{return!1}},cde=e=>{e=qe.merge.call({skipUndefined:!0},ade,e);let{fetch:t,Request:r,Response:o}=e,c=t?_b(t):typeof fetch=="function",u=_b(r),h=_b(o);if(!c)return!1;let m=c&&_b(R4),g=c&&(typeof b4=="function"?(y=new b4,F=>y.encode(F)):async F=>new Uint8Array(await new r(F).arrayBuffer()));var y;let v=u&&m&&I4(()=>{let F=!1,M=new r(Io.origin,{body:new R4,method:"POST",get duplex(){return F=!0,"half"}}).headers.has("Content-Type");return F&&!M}),R=h&&m&&I4(()=>qe.isReadableStream(new o("").body)),b={stream:R&&(F=>F.body)};c&&["text","arrayBuffer","blob","formData","stream"].forEach(F=>{!b[F]&&(b[F]=(M,j)=>{let K=M&&M[F];if(K)return K.call(M);throw new Un("Response type '".concat(F,"' is not supported"),Un.ERR_NOT_SUPPORT,j)})});let A=async(F,M)=>qe.toFiniteNumber(F.getContentLength())??(async K=>K==null?0:qe.isBlob(K)?K.size:qe.isSpecCompliantForm(K)?(await new r(Io.origin,{method:"POST",body:K}).arrayBuffer()).byteLength:qe.isArrayBufferView(K)||qe.isArrayBuffer(K)?K.byteLength:(qe.isURLSearchParams(K)&&(K+=""),qe.isString(K)?(await g(K)).byteLength:void 0))(M);return async F=>{let{url:M,method:j,data:K,signal:q,cancelToken:Q,timeout:se,onDownloadProgress:oe,onUploadProgress:te,responseType:de,headers:Ce,withCredentials:Pe="same-origin",fetchOptions:Qe}=v4(F),ot=t||fetch;de=de?(de+"").toLowerCase():"text";let Xt=nde([q,Q&&Q.toAbortSignal()],se),Lt=null,jt=Xt&&Xt.unsubscribe&&(()=>{Xt.unsubscribe()}),En;try{if(te&&v&&j!=="get"&&j!=="head"&&(En=await A(Ce,K))!==0){let L,J=new r(M,{method:"POST",body:K,duplex:"half"});if(qe.isFormData(K)&&(L=J.headers.get("content-type"))&&Ce.setContentType(L),J.body){let[ie,Ue]=m4(En,fb(g4(te)));K=T4(J.body,65536,ie,Ue)}}qe.isString(Pe)||(Pe=Pe?"include":"omit");let lr=u&&"credentials"in r.prototype,Re=C4(C4({},Qe),{},{signal:Xt,method:j.toUpperCase(),headers:Ce.normalize().toJSON(),body:K,duplex:"half",credentials:lr?Pe:void 0});Lt=u&&new r(M,Re);let Ve=await(u?ot(Lt,Qe):ot(M,Re)),Ze=R&&(de==="stream"||de==="response");if(R&&(oe||Ze&&jt)){let L={};["status","statusText","headers"].forEach(Rt=>{L[Rt]=Ve[Rt]});let J=qe.toFiniteNumber(Ve.headers.get("content-length")),[ie,Ue]=oe&&m4(J,fb(g4(oe),!0))||[];Ve=new o(T4(Ve.body,65536,ie,()=>{Ue&&Ue(),jt&&jt()}),L)}de=de||"text";let Ne=await b[qe.findKey(b,de)||"text"](Ve,F);return!Ze&&jt&&jt(),await new ze((L,J)=>{f4(L,J,{data:Ne,headers:Fl.from(Ve.headers),status:Ve.status,statusText:Ve.statusText,config:F,request:Lt})})}catch(lr){throw jt&&jt(),lr&&lr.name==="TypeError"&&/Load failed|fetch/i.test(lr.message)?Object.assign(new Un("Network Error",Un.ERR_NETWORK,F,Lt),{cause:lr.cause||lr}):Un.from(lr,lr&&lr.code,F,Lt)}}},lde=new Map,A4=e=>{let t=e&&e.env||{},{fetch:r,Request:o,Response:c}=t,u=[o,c,r],h,m,g=u.length,y=lde;for(;g--;)h=u[g],m=y.get(h),m===void 0&&y.set(h,m=g?new Map:cde(t)),y=m;return m};A4();let rk={http:null,xhr:tde,fetch:{get:A4}};qe.forEach(rk,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});let O4=e=>"- ".concat(e),ude=e=>qe.isFunction(e)||e===null||e===!1;var N4={getAdapter:function(e,t){e=qe.isArray(e)?e:[e];let{length:r}=e,o,c,u={};for(let h=0;h<r;h++){let m;if(o=e[h],c=o,!ude(o)&&(c=rk[(m=String(o)).toLowerCase()],c===void 0))throw new Un("Unknown adapter '".concat(m,"'"));if(c&&(qe.isFunction(c)||(c=c.get(t))))break;u[m||"#"+h]=c}if(!c){let h=Object.entries(u).map(m=>{let[g,y]=m;return"adapter ".concat(g," ")+(y===!1?"is not supported by the environment":"is not available in the build")});throw new Un("There is no suitable adapter to dispatch the request "+(r?h.length>1?`since :
`+h.map(O4).join(`
`):" "+O4(h[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return c},adapters:rk};function ik(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new RE(null,e)}function P4(e){return ik(e),e.headers=Fl.from(e.headers),e.data=Q1.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),N4.getAdapter(e.adapter||J1.adapter,e)(e).then(function(t){return ik(e),t.data=Q1.call(e,e.transformResponse,t),t.headers=Fl.from(t.headers),t},function(t){return p4(t)||(ik(e),t&&t.response&&(t.response.data=Q1.call(e,e.transformResponse,t.response),t.response.headers=Fl.from(t.response.headers))),ze.reject(t)})}let k4="1.13.2",Eb={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Eb[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});let D4={};Eb.transitional=function(e,t,r){function o(c,u){return"[Axios v"+k4+"] Transitional option '"+c+"'"+u+(r?". "+r:"")}return(c,u,h)=>{if(e===!1)throw new Un(o(u," has been removed"+(t?" in "+t:"")),Un.ERR_DEPRECATED);return t&&!D4[u]&&(D4[u]=!0,console.warn(o(u," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(c,u,h)}},Eb.spelling=function(e){return(t,r)=>(console.warn("".concat(r," is likely a misspelling of ").concat(e)),!0)};var yb={assertOptions:function(e,t,r){if(typeof e!="object")throw new Un("options must be an object",Un.ERR_BAD_OPTION_VALUE);let o=Object.keys(e),c=o.length;for(;c-- >0;){let u=o[c],h=t[u];if(h){let m=e[u],g=m===void 0||h(m,u,e);if(g!==!0)throw new Un("option "+u+" must be "+g,Un.ERR_BAD_OPTION_VALUE)}else if(r!==!0)throw new Un("Unknown option "+u,Un.ERR_BAD_OPTION)}},validators:Eb};let Yu=yb.validators,vb=class{constructor(e){this.defaults=e||{},this.interceptors={request:new F3,response:new F3}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;let c=o.stack?o.stack.replace(/^.+\n/,""):"";try{r.stack?c&&!String(r.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+c):r.stack=c}catch{}}throw r}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=Nm(this.defaults,t);let{transitional:r,paramsSerializer:o,headers:c}=t;r!==void 0&&yb.assertOptions(r,{silentJSONParsing:Yu.transitional(Yu.boolean),forcedJSONParsing:Yu.transitional(Yu.boolean),clarifyTimeoutError:Yu.transitional(Yu.boolean)},!1),o!=null&&(qe.isFunction(o)?t.paramsSerializer={serialize:o}:yb.assertOptions(o,{encode:Yu.function,serialize:Yu.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),yb.assertOptions(t,{baseUrl:Yu.spelling("baseURL"),withXsrfToken:Yu.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let u=c&&qe.merge(c.common,c[t.method]);c&&qe.forEach(["delete","get","head","post","put","patch","common"],A=>{delete c[A]}),t.headers=Fl.concat(u,c);let h=[],m=!0;this.interceptors.request.forEach(function(A){typeof A.runWhen=="function"&&A.runWhen(t)===!1||(m=m&&A.synchronous,h.unshift(A.fulfilled,A.rejected))});let g=[],y;this.interceptors.response.forEach(function(A){g.push(A.fulfilled,A.rejected)});let v,R=0;if(!m){let A=[P4.bind(this),void 0];for(A.unshift(...h),A.push(...g),v=A.length,y=ze.resolve(t);R<v;)y=y.then(A[R++],A[R++]);return y}v=h.length;let b=t;for(;R<v;){let A=h[R++],F=h[R++];try{b=A(b)}catch(M){F.call(this,M);break}}try{y=P4.call(this,b)}catch(A){return ze.reject(A)}for(R=0,v=g.length;R<v;)y=y.then(g[R++],g[R++]);return y}getUri(e){return V3(_4((e=Nm(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};qe.forEach(["delete","get","head","options"],function(e){vb.prototype[e]=function(t,r){return this.request(Nm(r||{},{method:e,url:t,data:(r||{}).data}))}}),qe.forEach(["post","put","patch"],function(e){function t(r){return function(o,c,u){return this.request(Nm(u||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:o,data:c}))}}vb.prototype[e]=t(),vb.prototype[e+"Form"]=t(!0)});var Sb=vb;class sk{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new ze(function(c){r=c});let o=this;this.promise.then(c=>{if(!o._listeners)return;let u=o._listeners.length;for(;u-- >0;)o._listeners[u](c);o._listeners=null}),this.promise.then=c=>{let u,h=new ze(m=>{o.subscribe(m),u=m}).then(c);return h.cancel=function(){o.unsubscribe(u)},h},t(function(c,u,h){o.reason||(o.reason=new RE(c,u,h),r(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;let r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){let t=new AbortController,r=o=>{t.abort(o)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new sk(function(r){t=r}),cancel:t}}}var dde=sk;let ok={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(ok).forEach(e=>{let[t,r]=e;ok[r]=t});var hde=ok;let _s=(function e(t){let r=new Sb(t),o=S3(Sb.prototype.request,r);return qe.extend(o,Sb.prototype,r,{allOwnKeys:!0}),qe.extend(o,r,null,{allOwnKeys:!0}),o.create=function(c){return e(Nm(t,c))},o})(J1);_s.Axios=Sb,_s.CanceledError=RE,_s.CancelToken=dde,_s.isCancel=p4,_s.VERSION=k4,_s.toFormData=tb,_s.AxiosError=Un,_s.Cancel=_s.CanceledError,_s.all=function(e){return ze.all(e)},_s.spread=function(e){return function(t){return e.apply(null,t)}},_s.isAxiosError=function(e){return qe.isObject(e)&&e.isAxiosError===!0},_s.mergeConfig=Nm,_s.AxiosHeaders=Fl,_s.formToJSON=e=>d4(qe.isHTMLForm(e)?new FormData(e):e),_s.getAdapter=N4.getAdapter,_s.HttpStatusCode=hde,_s.default=_s;var ao=_s;let pde=()=>{};function OT(){let e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:pde};return e.promise=new ze((t,r)=>{e.resolve=o=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(o),e.value=o)},e.reject=o=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,r(o))}}),e}let Tb=new Map,wb=new Map,qu=new Map,wi=(function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e})({}),_n=(function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e})({}),x4=new qae,jl=x4.getResult(),ak=null;function pn(e){if(!ak){jl=x4.getResult();let t=(function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return _n.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return _n.CHROME;case"Safari":case"Mobile Safari":return _n.SAFARI;case"Edge":return _n.EDGE;case"Firefox":return _n.FIREFOX;case"QQ":case"QQBrowser":return _n.QQ;case"Opera":return _n.OPERA;case"WeChat":return _n.WECHAT;default:return m.browser.name||""}})(jl),r=L4(jl),o=(function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""})(jl),c=jl.os.version,u=L4(jl,!1),h=jl.device.type;if(!(t&&r&&o&&c))return{name:t,version:r,os:o,osVersion:c,browserVersion:u,deviceType:h};ak={name:t,version:r,os:o,osVersion:c,browserVersion:u,deviceType:h}}return ak}function L4(e){let t,r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",r?t.split(".")[0]:t}function Cb(){return pn().os}function M4(){let e=pn();return"".concat(e.os," ").concat(e.osVersion)}function Rb(){let e=pn();return!!(jl.engine.name==="WebKit"&&e.os===wi.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==_n.SAFARI||Es()&&e.name!==_n.SAFARI)}function Zd(){return pn().name===_n.CHROME}function Pi(){return pn().name===_n.SAFARI}function U4(){let e=pn();if(e.name!==_n.SAFARI||!e.browserVersion)return!1;let t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function V4(){return pn().name===_n.EDGE}function Qn(){return pn().name===_n.FIREFOX}function Es(){return pn().os===wi.IOS}function Bl(e){let t=pn();return!(t.name!==_n.CHROME||!t.osVersion)&&Number(t.version)>=e}function F4(e){let t=pn();return!(t.name!==_n.CHROME||!t.osVersion)&&Number(t.version)<e}function ck(e,t,r){let o=pn();return!(o.name!==e||!o.osVersion)&&(r?Number(o.version)>=t&&Number(o.version)<=r:Number(o.version)===t)}function _p(e){let t=pn();return!(t.name!==_n.EDGE||!t.osVersion)&&Number(t.version)>=e}function lk(e){let t=pn();return!(t.name!==_n.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function j4(e){let t=pn();return!(t.name!==_n.SAFARI||!t.osVersion)&&Number(t.version)>=e}function B4(e,t,r){let o=pn();if(o.os!==wi.IOS||!o.osVersion)return!1;let c=o.osVersion.split(".");return r?t&&Number(c[0])===e&&Number(c[1])>t||Number(c[0])>e:t?Number(c[0])===e&&Number(c[1])>=t||Number(c[0])>e:Number(c[0])>=e}function W4(e,t,r){let o=pn();if(o.os!==wi.IOS||!o.osVersion)return!1;let c=o.osVersion.split(".");return r?t&&Number(c[0])===e&&Number(c[1])<t||Number(c[0])<e:t?Number(c[0])===e&&Number(c[1])<=t||Number(c[0])<e:Number(c[0])<=e}function uk(e,t,r){let o=pn();if(o.name!==_n.SAFARI||!o.osVersion||!o.browserVersion)return!1;let c=o.browserVersion.split(".");return r?t&&Number(c[0])===e&&Number(c[1])<t||Number(c[0])<e:t?Number(c[0])===e&&Number(c[1])<=t||Number(c[0])<e:Number(c[0])<=e}function Pm(e){let t=pn();return!(t.name!==_n.OPERA||!t.osVersion)&&Number(t.version)>=e}function G4(){let e=pn();if(e.os!==wi.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function IE(){let e=pn();if(e.os!==wi.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15}function dk(){let e=pn();if(e.os!==wi.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===16}function H4(){let e=pn();if(e.os!==wi.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Bc(){return Pi()&&navigator.maxTouchPoints>0}function z4(){return pn().name===_n.WECHAT}function K4(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function Y4(){let e=Cb();return(function(){let{deviceType:t}=pn();return t==="mobile"||t==="tablet"})()||e===wi.ANDROID||e===wi.IOS||e===wi.HARMONY_OS}function Xu(){let e=pn();return e.name!==_n.EDGE&&e.name!==_n.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function NT(){return Cb()===wi.ANDROID}function PT(){let e=pn();return NT()&&(e.name===_n.CHROME||e.name===_n.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Ct(e,t,r){return(t=(function(o){var c=(function(u,h){if(typeof u!="object"||!u)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var g=m.call(u,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)})(o);return typeof c=="symbol"?c:c+""})(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function q4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function Me(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?q4(Object(r),!0).forEach(function(o){Ct(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q4(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}let Y=(function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e})({}),_e=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(t),Ct(this,"code",void 0),Ct(this,"message",void 0),Ct(this,"data",void 0),Ct(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=r}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Wc(e,t){if(typeof e!="boolean")throw new _e(Y.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function zr(e,t,r){if(!ke(r).call(r,e))throw new _e(Y.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(r)))}function Vn(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<r||e>o||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!(function(c){return typeof c=="number"&&c%1==0})(e))throw new _e(Y.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(r,", ").concat(o,"]. integer only"))}function hk(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new _e(Y.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&Vn(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&Vn(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&Vn(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&Vn(e.ideal,"".concat(t,".ideal"),1,1/0)}else Vn(e,t,1,1/0)}function Hi(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new _e(Y.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!X4(e,r,o,c))throw new _e(Y.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(r,",").concat(o,"].").concat(c?" ASCII characters only.":""))}function eh(e,t){if(!Array.isArray(e))throw new _e(Y.INVALID_PARAMS,"".concat(t," should be an array"))}function wr(e){return e==null}function X4(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,o=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=r&&e.length>=t&&(!o||(function(c){if(typeof c!="string")return!1;for(let u=0;u<c.length;u+=1){let h=c.charCodeAt(u);if(h<0||h>255)return!1}return!0})(e))}function J4(e,t,r){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,r);let o=e.getUint32(t,r),c=e.getUint32(t+4,r),u=0,h=1;return BigInt(o*h+c*u)<<BigInt(32)|BigInt(o*u+c*h)}function $4(e,t,r,o){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,r,o);let c=Number(r>>BigInt(32)),u=Number(r&BigInt(4294967295));e.setUint32(t,c,o),e.setUint32(t+4,u,o)}var kT=(function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e})(kT||{}),pk=(function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e})(pk||{});let Q4=new class{constructor(){Ct(this,"_clientSize",null),Ct(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Ct(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Ct(this,"getStyle",e=>window.getComputedStyle(e,null)),Ct(this,"checkCssVisibleProperty",e=>{var t;let r=!0,o=this.getStyle(e),{display:c,visibility:u,opacity:h,filter:m}=o;return(c==="none"||ke(t=["hidden","collapse"]).call(t,u)||Number(h)<.1)&&(r=!1),!!r&&(m&&m.split(" ").filter(g=>{var y;let v=g.split("(")[0];return ke(y=["brightness","blur","opacity"]).call(y,v)}).map(g=>{let[y,v]=g.split(/\(|\)/);return[y,Number(v.match(/^[0-9\.]+/))]}).forEach(g=>{let[y,v]=g;switch(y){case"brightness":(v<.1||v>3)&&(r=!1);break;case"blur":v>3&&(r=!1);break;case"opacity":v<.1&&(r=!1)}}),r)}),Ct(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let r=!0,o=!0,c=h=>t(h),u=e;for(;u&&o;)c(u)||(r=!1,o=!1),u=u.parentElement,u||(o=!1);return r}),Ct(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),Ct(this,"getSizeAboutClient",e=>{let{width:t,height:r,left:o,right:c,top:u,bottom:h}=e.getBoundingClientRect(),m=this.getClientWidth(),g=this.getClientHeight();return{width:t,height:r,left:o,right:c,top:u,bottom:h,clientWidth:m,clientHeight:g,clientMin:Math.min(m,g)}}),Ct(this,"checkActualSize",()=>{let{width:e,height:t,clientMin:r}=this._clientSize;return this.checkSizeIsVisible(e,t,r)}),Ct(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),Ct(this,"checkCoverForAPoint",(e,t,r)=>{let o=this.elementFromPoint(e,t);return o!==null&&o!==r}),Ct(this,"getPointPositionList",()=>{let{width:e,height:t,left:r,top:o}=this._clientSize,c=e/6,u=t/6,h=[],m=10**6;for(let g=0;g<5;g++)for(let y=0;y<5;y++){let v=(r*m+(g===0?.1:g===4?(c*g*m-1e5)/m:c*g)*m)/m,R=(o*m+(y===0?.1:y===4?(u*y*m-1e5)/m:u*y)*m)/m;h.push({x:v,y:R})}return[...h]}),Ct(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),Ct(this,"checkSizeIsVisible",(e,t,r)=>(e>50||r/e<=10)&&(t>50||r/t<=10)),Ct(this,"checkSizeOfPartInClient",()=>{let{left:e,right:t,top:r,bottom:o,clientHeight:c,clientWidth:u,clientMin:h}=this._clientSize,m,g,y,v;if(e<0)m=0;else{if(!(e<u))return!1;m=e}if(t<0)return!1;if(g=t<u?t:u,r<0)y=0;else{if(!(r<c))return!1;y=r}if(o<0)return!1;v=o<c?o:c;let R=g-m,b=v-y;return this.checkSizeIsVisible(R,b,h)}),Ct(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),Ct(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(kT.COVERED);{let t=this.checkActualSize(),r=this.checkSizeOfPartInClient();return t&&!r?this.returnHiddenResult(kT.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(kT.SIZE)}}return this.returnHiddenResult(kT.STYLE)}return this.returnHiddenResult(pk.UNMOUNTED)}return this.returnHiddenResult(pk.INVALID_HTML_ELEMENT)}),Ct(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function fk(e){return new TextEncoder().encode(e)}let Z4=function(e,t){let r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r},mk=async e=>(function(t,r){let o="";return new Uint8Array(t).forEach(c=>{o+=c.toString(r).padStart(2,"0")}),o})(await crypto.subtle.digest("SHA-256",fk(e)),16),dr=class{constructor(){Ct(this,"_events",{}),Ct(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);let r=this._events[e];this._indexOfListener(r,t)===-1&&r.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);let r=this._events[e];this._indexOfListener(r,t)===-1&&r.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;let r=this._events[e],o=this._indexOfListener(r,t);o!==-1&&r.splice(o,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);let t=this._events[e].map(u=>u);for(var r=arguments.length,o=new Array(r>1?r-1:0),c=1;c<r;c++)o[c-1]=arguments[c];for(let u=0;u<t.length;u+=1){let h=t[u];h.once&&this.off(e,h.listener),h.listener.apply(this,o||[])}}safeEmit(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];[...this._events[e]||[]].forEach(c=>{c.once&&this.off(e,c.listener);try{c.listener.apply(this,r)}catch(u){console.error("safeEmit event:".concat(e," error ").concat(u?.toString()))}})}_indexOfListener(e,t){let r=e.length;for(;r--;)if(e[r].listener===t)return r;return-1}},DT=null;function e5(){if(DT)return DT;if(window.electron)return DT=window.electron;if(!window.require)return null;try{return DT=window.require("electron"),DT}catch{return null}}let ar=(function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e.VOS_FALLBACK_CN="vosFallbackCN",e.DATACHANNEL_FAILBACK="datachannelFailback",e})({}),Fn=(function(e){return e.TRACER="tracer",e})({});function t5(e){return Vn(e.timeout,"config.timeout",0,1e5),Vn(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Vn(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Vn(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let fde=(function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e})({}),tn=(function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.FALLBACK_TO_HLS="FALLBACK_TO_HLS",e.UID_CONFLICT="UID_CONFLICT",e})({});function km(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function n5(e){return Hi(e.turnServerURL,"turnServerURL"),Hi(e.username,"username"),Hi(e.password,"password"),e.udpport&&Vn(e.udpport,"udpport",1,99999,!0),e.forceturn&&Wc(e.forceturn,"forceturn"),e.security&&Wc(e.security,"security"),e.tcpport&&Vn(e.tcpport,"tcpport",1,99999,!0),!0}let AE=(function(e){return e[e.AUTO_SIMULCAST_STREAM=-1]="AUTO_SIMULCAST_STREAM",e[e.DISABLE_SIMULCAST_STREM=0]="DISABLE_SIMULCAST_STREM",e[e.ENABLE_SIMULCAST_STREAM=1]="ENABLE_SIMULCAST_STREAM",e})({});function gk(e){return e.level!==void 0&&zr(e.level,"level",[1,2,3]),e.delay!==void 0&&Vn(e.delay,"delay",0,3e3,!0),!0}let zt=(function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e.FALLBACK_TO_HLS="fallback-to-hls",e.FIRST_VIDEO_BUFFER_READY="first-video-buffer-ready",e.FIRST_VIDEO_PRE_RENDER="first-video-pre-render",e.AV1_DECODABLE_RESULT="av1-decodable-result",e})({}),_k=(function(e){return e.CONFIG="config",e.VOSERROR="vos_error",e.AP_ERROR="ap_error",e})({}),ts=(function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e})({}),Gs=(function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e})({}),Dm=(function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e})({});function ei(e,t){for(var r=arguments.length,o=new Array(r>2?r-2:0),c=2;c<r;c++)o[c-2]=arguments[c];return e.getListeners(t).length===0?ze.reject(new _e(Y.UNEXPECTED_ERROR,"can not emit promise")):new ze((u,h)=>{e.emit(t,...o,u,h)})}function Gn(e,t){if(e.getListeners(t).length===0)return ze.resolve();for(var r=arguments.length,o=new Array(r>2?r-2:0),c=2;c<r;c++)o[c-2]=arguments[c];return ei(e,t,...o)}function Jo(e,t){if(e.getListeners(t).length===0)return null;for(var r=arguments.length,o=new Array(r>2?r-2:0),c=2;c<r;c++)o[c-2]=arguments[c];return xm(e,t,...o)}function xm(e,t){let r=null,o=null;for(var c=arguments.length,u=new Array(c>2?c-2:0),h=2;h<c;h++)u[h-2]=arguments[h];if(e.emit(t,...u,m=>{r=m},m=>{o=m}),o!==null)throw o;if(r===null)throw new _e(Y.UNEXPECTED_ERROR,"handler is not sync");return r}let Cr=new class extends dr{set networkState(e){this.emit(Dm.NETWORK_STATE_CHANGE,e,this._networkState),e===Gs.ONLINE?this.emit(Dm.ONLINE):e===Gs.OFFLINE&&(this.onlineWaiter=new ze(t=>{this.once(Dm.ONLINE,()=>{this.onlineWaiter=void 0,t(Gs.ONLINE)})}),this.emit(Dm.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===Gs.ONLINE}constructor(){super(),Ct(this,"_moduleName","network-indicator"),Ct(this,"_networkState",Gs.ONLINE),Ct(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Gs.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Gs.OFFLINE})}},co=[];for(let e=0;e<256;++e)co.push((e+256).toString(16).slice(1));let r5=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ek,mde=new Uint8Array(16);function gde(){return r5?r5():(function(r,o,c){var u,h,m,g;let y=(u=(h=(r=r||{}).random)!==null&&h!==void 0?h:(m=(g=r).rng)===null||m===void 0?void 0:m.call(g))!==null&&u!==void 0?u:(function(){if(!Ek){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Ek=crypto.getRandomValues.bind(crypto)}return Ek(mde)})();if(y.length<16)throw new Error("Random bytes length must be >= 16");if(y[6]=15&y[6]|64,y[8]=63&y[8]|128,o){if((c=c||0)<0||c+16>o.length)throw new RangeError("UUID byte range ".concat(c,":").concat(c+15," is out of buffer bounds"));for(let v=0;v<16;++v)o[c+v]=y[v];return o}return(function(v){let R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(co[v[R+0]]+co[v[R+1]]+co[v[R+2]]+co[v[R+3]]+"-"+co[v[R+4]]+co[v[R+5]]+"-"+co[v[R+6]]+co[v[R+7]]+"-"+co[v[R+8]]+co[v[R+9]]+"-"+co[v[R+10]]+co[v[R+11]]+co[v[R+12]]+co[v[R+13]]+co[v[R+14]]+co[v[R+15]]).toLowerCase()})(y)})(e,t,void 0);var e,t}function bb(e,t){let r=e.indexOf(t);r!==-1&&e.splice(r,1)}function OE(e){let t=[];return e.forEach(r=>{t.indexOf(r)===-1&&t.push(r)}),t}function Ib(e){ze!==void 0?ze.resolve().then(e):setTimeout(e,0)}function Zn(e){return JSON.parse(JSON.stringify(e))}function Lm(e){try{return Zn(e)}catch{return e}}let i5={};function Ep(e,t){i5[t]||(i5[t]=!0,e())}function Mm(e){let t=window.atob(e),r=new Uint8Array(new ArrayBuffer(t.length));for(let o=0;o<t.length;o+=1)r[o]=t.charCodeAt(o);return r}function yp(e){let t="";for(let r=0;r<e.length;r+=1)t+=String.fromCharCode(e[r]);return window.btoa(t)}function s5(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,r=new TextEncoder().encode(e);if(r.length>t)r=r.slice(0,t);else if(r.length<t){let o=new Uint8Array(t);o.set(r),r=o}return r}function o5(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let o=to(t).call(t,(h,m)=>h+m.length,0),c=new Uint8Array(new ArrayBuffer(o)),u=0;return t.forEach(h=>{c.set(h,u),u+=h.length}),c}function Ju(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function a5(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(r=>{t+=typeof r=="string"?Ju(r):r.size}),t+138}function _de(e){let t=new _e(Y.TIMEOUT,"timeout");return new ze((r,o)=>{window.setTimeout(()=>o(t),e)})}function Ci(e){return new ze(t=>{window.setTimeout(t,e)})}function In(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0,r=Math.random().toString(16).substr(2,e).toLowerCase();return r.length===e?"".concat(t).concat(r):"".concat(t).concat(r)+In(e-r.length,"")}function Um(){let e,t=!1;try{var r;e=Yae(r=gde()).call(r,"-","")}catch{t=!0}return!t&&e&&e.length===32||(e=In(32,"")),e.toUpperCase()}let xT=()=>{},c5=new class{constructor(){Ct(this,"fnMap",new Map)}throttleByKey(e,t,r,o){for(var c=arguments.length,u=new Array(c>4?c-4:0),h=4;h<c;h++)u[h-4]=arguments[h];if(this.fnMap.has(t)){let m=this.fnMap.get(t);if(m.threshold!==r){m.fn(...m.args),clearTimeout(m.timer);let g=window.setTimeout(()=>{let y=this.fnMap.get(t);y&&y.fn(...y.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:g,args:u,skipFn:o})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(t,Me(Me({},m),{},{fn:e,args:u,skipFn:o}))}else{let m=window.setTimeout(()=>{let g=this.fnMap.get(t);g&&g.fn(...g.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:m,args:u,skipFn:o})}}},l5=c5.throttleByKey.bind(c5);function u5(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function yk(e,t){if(!u5(e)||!u5(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){let r=[...e];for(let o=0;o<t.length;o++)r[o]=yk(e[o],t[o]);return r}{let r=Me({},e);for(let o in t)Object.prototype.hasOwnProperty.call(t,o)&&(Object.prototype.hasOwnProperty.call(e,o)?r[o]=yk(e[o],t[o]):r[o]=t[o]);return r}}function d5(e,t){let r=[0];if(r=new Array(t).fill(0),e===0)return r;let o=0;for(;e>0&&(r[o]=255&e,e>>=8,o++,o!==t););return r}function NE(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function vk(e,t){try{return typeof e=="object"&&typeof t=="object"&&JSON.stringify(e)===JSON.stringify(t)}catch{return!1}}function Sk(e){return to(e).call(e,(t,r)=>t+r,0)}function h5(e){let t="0123456789abcdef";function r(Q){let se,oe="";for(se=0;se<=3;se++)oe+=t.charAt(Q>>8*se+4&15)+t.charAt(Q>>8*se&15);return oe}function o(Q,se){let oe=(65535&Q)+(65535&se);return(Q>>16)+(se>>16)+(oe>>16)<<16|65535&oe}function c(Q,se,oe,te,de,Ce){return o((function(Pe,Qe){return Pe<<Qe|Pe>>>32-Qe})(o(o(se,Q),o(te,Ce)),de),oe)}function u(Q,se,oe,te,de,Ce,Pe){return c(se&oe|~se&te,Q,se,de,Ce,Pe)}function h(Q,se,oe,te,de,Ce,Pe){return c(se&te|oe&~te,Q,se,de,Ce,Pe)}function m(Q,se,oe,te,de,Ce,Pe){return c(se^oe^te,Q,se,de,Ce,Pe)}function g(Q,se,oe,te,de,Ce,Pe){return c(oe^(se|~te),Q,se,de,Ce,Pe)}let y=(function(Q){let se,oe=1+(Q.length+8>>6),te=new Array(16*oe);for(se=0;se<16*oe;se++)te[se]=0;for(se=0;se<Q.length;se++)te[se>>2]|=Q.charCodeAt(se)<<se%4*8;return te[se>>2]|=128<<se%4*8,te[16*oe-2]=8*Q.length,te})(e),v,R,b,A,F,M=1732584193,j=-271733879,K=-1732584194,q=271733878;for(v=0;v<y.length;v+=16)R=M,b=j,A=K,F=q,M=u(M,j,K,q,y[v+0],7,-680876936),q=u(q,M,j,K,y[v+1],12,-389564586),K=u(K,q,M,j,y[v+2],17,606105819),j=u(j,K,q,M,y[v+3],22,-1044525330),M=u(M,j,K,q,y[v+4],7,-176418897),q=u(q,M,j,K,y[v+5],12,1200080426),K=u(K,q,M,j,y[v+6],17,-1473231341),j=u(j,K,q,M,y[v+7],22,-45705983),M=u(M,j,K,q,y[v+8],7,1770035416),q=u(q,M,j,K,y[v+9],12,-1958414417),K=u(K,q,M,j,y[v+10],17,-42063),j=u(j,K,q,M,y[v+11],22,-1990404162),M=u(M,j,K,q,y[v+12],7,1804603682),q=u(q,M,j,K,y[v+13],12,-40341101),K=u(K,q,M,j,y[v+14],17,-1502002290),j=u(j,K,q,M,y[v+15],22,1236535329),M=h(M,j,K,q,y[v+1],5,-165796510),q=h(q,M,j,K,y[v+6],9,-1069501632),K=h(K,q,M,j,y[v+11],14,643717713),j=h(j,K,q,M,y[v+0],20,-373897302),M=h(M,j,K,q,y[v+5],5,-701558691),q=h(q,M,j,K,y[v+10],9,38016083),K=h(K,q,M,j,y[v+15],14,-660478335),j=h(j,K,q,M,y[v+4],20,-405537848),M=h(M,j,K,q,y[v+9],5,568446438),q=h(q,M,j,K,y[v+14],9,-1019803690),K=h(K,q,M,j,y[v+3],14,-187363961),j=h(j,K,q,M,y[v+8],20,1163531501),M=h(M,j,K,q,y[v+13],5,-1444681467),q=h(q,M,j,K,y[v+2],9,-51403784),K=h(K,q,M,j,y[v+7],14,1735328473),j=h(j,K,q,M,y[v+12],20,-1926607734),M=m(M,j,K,q,y[v+5],4,-378558),q=m(q,M,j,K,y[v+8],11,-2022574463),K=m(K,q,M,j,y[v+11],16,1839030562),j=m(j,K,q,M,y[v+14],23,-35309556),M=m(M,j,K,q,y[v+1],4,-1530992060),q=m(q,M,j,K,y[v+4],11,1272893353),K=m(K,q,M,j,y[v+7],16,-155497632),j=m(j,K,q,M,y[v+10],23,-1094730640),M=m(M,j,K,q,y[v+13],4,681279174),q=m(q,M,j,K,y[v+0],11,-358537222),K=m(K,q,M,j,y[v+3],16,-722521979),j=m(j,K,q,M,y[v+6],23,76029189),M=m(M,j,K,q,y[v+9],4,-640364487),q=m(q,M,j,K,y[v+12],11,-421815835),K=m(K,q,M,j,y[v+15],16,530742520),j=m(j,K,q,M,y[v+2],23,-995338651),M=g(M,j,K,q,y[v+0],6,-198630844),q=g(q,M,j,K,y[v+7],10,1126891415),K=g(K,q,M,j,y[v+14],15,-1416354905),j=g(j,K,q,M,y[v+5],21,-57434055),M=g(M,j,K,q,y[v+12],6,1700485571),q=g(q,M,j,K,y[v+3],10,-1894986606),K=g(K,q,M,j,y[v+10],15,-1051523),j=g(j,K,q,M,y[v+1],21,-2054922799),M=g(M,j,K,q,y[v+8],6,1873313359),q=g(q,M,j,K,y[v+15],10,-30611744),K=g(K,q,M,j,y[v+6],15,-1560198380),j=g(j,K,q,M,y[v+13],21,1309151649),M=g(M,j,K,q,y[v+4],6,-145523070),q=g(q,M,j,K,y[v+11],10,-1120210379),K=g(K,q,M,j,y[v+2],15,718787259),j=g(j,K,q,M,y[v+9],21,-343485551),M=o(M,R),j=o(j,b),K=o(K,A),q=o(q,F);return r(M)+r(j)+r(K)+r(q)}let Ede=1,p5=console,ki=class{static setLogger(e){p5=e}constructor(e,t){Ct(this,"id",void 0),Ct(this,"lockingPromise",ze.resolve()),Ct(this,"locks",0),Ct(this,"name",""),Ct(this,"lockId",void 0),this.lockId=Ede++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){let r=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),o=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");p5.debug("".concat(r," ").concat(o))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);let r=new ze(c=>{t=()=>{this.locks-=1,this.logger("unlocked",e),c()}}),o=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>r),o}};function PE(e,t){return function(r,o,c){let u=c.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){let h=this[t];if(!h)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));let m=await h.lock("From ".concat(e,".").concat(o));try{for(var g=arguments.length,y=new Array(g),v=0;v<g;v++)y[v]=arguments[v];return await u.apply(this,y)}finally{m()}},c}}let Kr={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Ab(e,t){let r=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,r)}function Wl(e,t,r,o){let c=Object.assign({},Kr,o),u=c.timeout,h=async()=>{await(function(y){return new ze(v=>{window.setTimeout(v,y)})})(u),u*=c.timeoutFactor,u=Math.min(c.maxRetryTimeout,u)},m=!1,g=new ze(async(y,v)=>{t=t||(()=>!1),r=r||(()=>!0);for(let R=0;R<c.maxRetryCount;R+=1){if(m)return v(new _e(Y.OPERATION_ABORTED));try{let b=await e();if(!t(b,R)||R+1===c.maxRetryCount)return y(b);await h()}catch(b){if(!r(b,R)||R+1===c.maxRetryCount)return v(b);await h()}}});return g.cancel=()=>m=!0,g}let Ob,Tk=class{constructor(e){Ct(this,"input",[]),Ct(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:to(e=this.input).call(e,(t,r)=>t+r)/this.input.length}},Nb=0,wk=0;function Ck(e,t,r,o){return new ze((c,u)=>{t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),Nb+=Ju(t.data)):r&&(t.data.size?Nb+=t.data.size:t.data instanceof FormData?Nb+=a5(t.data):Nb+=Ju(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,ao.request(t).then(h=>{typeof h.data=="string"?wk+=Ju(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?wk+=h.data.byteLength:wk+=Ju(JSON.stringify(h.data)),c(h.data)}).catch(h=>{ao.isCancel(h)?u(new _e(Y.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new _e(Y.NETWORK_TIMEOUT,h.message)):h.response?u(new _e(Y.NETWORK_RESPONSE_ERROR,h.response.status)):u(new _e(Y.NETWORK_ERROR,h.message))})})}async function yde(e,t){let r=new Blob([t.data],{type:"buffer"});return await Ck(e,Me(Me({},t),{},{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0)}let f5=()=>window.isSecureContext!==void 0;function Gc(e){if(Array.isArray(e))return e.map(r=>r);if(!m5(e))return e;let t={};for(let r in e){let o=e[r];m5(o)||Array.isArray(o)?t[r]=Gc(o):t[r]=o}return t}function m5(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let Rk=class{constructor(e){Ct(this,"input",[]),Ct(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}},Hc={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},LT={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],transport:{bytesSent:0,bytesReceived:0,packetsSent:0,packetsReceived:0},selectedCandidatePair:{id:"unknown",localCandidate:Hc,remoteCandidate:Hc},updateInterval:0},g5={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},_5={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},E5={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},y5={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0},bk=class{constructor(e,t){Ct(this,"onFirstVideoReceived",void 0),Ct(this,"onFirstVideoDecoded",void 0),Ct(this,"onFirstAudioReceived",void 0),Ct(this,"onFirstVideoDecodedTimeout",void 0),Ct(this,"onFirstAudioDecoded",void 0),Ct(this,"onSelectedLocalCandidateChanged",void 0),Ct(this,"onSelectedRemoteCandidateChanged",void 0),Ct(this,"videoIsReady",!1),Ct(this,"videoIsReady2",{}),Ct(this,"pc",void 0),Ct(this,"options",void 0),Ct(this,"intervalTimer",void 0),Ct(this,"stats",Gc(LT)),Ct(this,"isFirstVideoReceived",{}),Ct(this,"isFirstVideoDecoded",{}),Ct(this,"isFirstAudioReceived",{}),Ct(this,"isFirstAudioDecoded",{}),Ct(this,"isFirstVideoDecodedTimeout",{}),Ct(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new ze(e=>{e({local:Me({},Hc),remote:Me({},Hc)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);let t=this.lossRateWindowStats.length,r=["videoSend","audioSend","videoRecv","audioRecv"],o=0,c=0,u=0,h=0;for(let m of r)e[m].forEach((g,y)=>{if(!this.lossRateWindowStats[t-1][m][y]||!this.lossRateWindowStats[0][m][y])return;let v=this.lossRateWindowStats[t-1][m][y].packets-this.lossRateWindowStats[0][m][y].packets,R=this.lossRateWindowStats[t-1][m][y].packetsLost-this.lossRateWindowStats[0][m][y].packetsLost;m==="videoSend"||m==="audioSend"?(o+=v,u+=R):(c+=v,h+=R),Number.isNaN(v)||Number.isNaN(v)?g.packetLostRate=0:g.packetLostRate=v<=0||R<=0?0:R/(v+R)});e.sendPacketLossRate=o<=0||u<=0?0:u/(o+u),e.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},vde=class extends bk{constructor(){super(...arguments),Ct(this,"_stats",LT),Ct(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){let e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=Gc(LT);let r=t.filter(c=>c.type==="ssrc");this.processSSRCStats(r);let o=t.find(c=>c.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var r;let o=ke(r=t.id).call(r,"send");switch("".concat(t.mediaType,"_").concat(o?"send":"recv")){case"video_send":{let c=Gc(_5);c.codec=t.googCodecName,c.adaptionChangeReason="none",t.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(t.googAvgEncodeMs),c.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},c.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},c.firsCount=Number(t.googFirReceived),c.nacksCount=Number(t.googNacksReceived),c.plisCount=Number(t.googPlisReceived),c.frameCount=Number(t.framesEncoded),c.bytes=Number(t.bytesSent),c.packets=Number(t.packetsSent),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{let c=Gc(g5),u=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(c.codec=t.googCodecName,c.targetDelayMs=Number(t.googTargetDelayMs),c.renderDelayMs=Number(t.googRenderDelayMs),c.currentDelayMs=Number(t.googCurrentDelayMs),c.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),c.decodeMs=Number(t.googDecodeMs),c.maxDecodeMs=Number(t.googMaxDecodeMs),c.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},c.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},c.decodeFrameRate=Number(t.googFrameRateDecoded),c.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},c.jitterBufferMs=Number(t.googJitterBufferMs),c.firsCount=Number(t.googFirsSent),c.nacksCount=Number(t.googNacksSent),c.plisCount=Number(t.googPlisSent),c.framesDecodeCount=Number(t.framesDecoded),c.bytes=Number(t.bytesReceived),c.packets=Number(t.packetsReceived),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),u){let h=u.stats,m=Date.now()-u.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(u.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):c.framesDecodeCount<u.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:Me({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{let c=Gc(y5);c.codec=t.googCodecName,c.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,c.decodingCNG=Number(t.googDecodingCNG),c.decodingCTN=Number(t.googDecodingCTN),c.decodingCTSG=Number(t.googDecodingCTSG),c.decodingNormal=Number(t.googDecodingNormal),c.decodingPLC=Number(t.googDecodingPLC),c.decodingPLCCNG=Number(t.googDecodingPLCCNG),c.expandRate=Number(t.googExpandRate),c.accelerateRate=Number(t.googAccelerateRate),c.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),c.speechExpandRate=Number(t.googSpeechExpandRate),c.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),c.jitterBufferMs=Number(t.googJitterBufferMs),c.jitterMs=Number(t.googJitterReceived),c.bytes=Number(t.bytesReceived),c.packets=Number(t.packetsReceived),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),c.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{let c=Gc(E5);c.codec=t.googCodecName,c.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,c.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(t.bytesSent),c.packets=Number(t.packetsSent),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.rttMs=Number(t.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new ze((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){let t=[];return e.result().forEach(r=>{let o={id:r.id,timestamp:r.timestamp.valueOf().toString(),type:r.type};r.names().forEach(c=>{o[c]=r.stat(c)}),t.push(o)}),t}},kE=(function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e})({}),Pb=(function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e})({}),Ik=(function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e})({}),fa=(function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e})({});var DE=(function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e})(DE||{});function MT(e,t,r,o){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:DE.kNone;if(!t)return;let u=Number(t[r]);if(typeof u!="number")return;let h=Number(t[o]);if(typeof h!="number")return;if(!e)return h?u/h*c:void 0;let m=Number(e[r]);if(typeof m!="number")return;let g=Number(e[o]);if(typeof g!="number")return;let y=h-g;return y?(u-m)/y*c:void 0}let v5=class extends bk{constructor(){super(...arguments),Ct(this,"_stats",LT),Ct(this,"report",void 0),Ct(this,"lastDecodeVideoReceiverStats",new Map),Ct(this,"lastVideoFramesRecv",new Map),Ct(this,"lastVideoFramesSent",new Map),Ct(this,"lastVideoFramesDecode",new Map),Ct(this,"lastVideoFramesOutput",new Map),Ct(this,"lastVideoJBDelay",new Map),Ct(this,"lastAudioJBDelay",new Map),Ct(this,"mediaBytesSent",new Map),Ct(this,"mediaBytesRetransmit",new Map),Ct(this,"mediaBytesTargetEncode",new Map),Ct(this,"lastDecodeAudioReceiverStats",new Map),Ct(this,"lastAudioConcealment",new Map),Ct(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Gc(LT),this.report.forEach(e=>{switch(e.type){case fa.OUTBOUND:case fa.INBOUND:{let t=e.mediaType||e.kind,r=!t&&"frameWidth"in e,o=!t&&!("frameWidth"in e);e.type===fa.OUTBOUND?t==="audio"||o?this.processAudioOutboundStats(e):(t==="video"||r)&&this.processVideoOutboundStats(e):e.type===fa.INBOUND&&(t==="audio"||o?this.processAudioInboundStats(e):(t==="video"||r)&&this.processVideoInboundStats(e));break}case fa.TRANSPORT:{this.processTransportStats(e);let t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case fa.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){let e=await this.pc.getStats(),t={local:Me({},Hc),remote:Me({},Hc)};return e.forEach(r=>{let o;if(r.type===fa.TRANSPORT&&(o=e.get(r.selectedCandidatePairId)),r.type===fa.CANDIDATE_PAIR&&r.selected&&(o=r),o){let c=(u,h)=>{u.type=h.type,u.id=h.id,h.address&&(u.address=h.address),h.candidateType&&(u.candidateType=h.candidateType),h.port&&(u.port=h.port),h.priority&&(u.priority=h.priority),h.protocol&&(u.protocol=h.protocol),h.relayProtocol&&(u.relayProtocol=h.relayProtocol)};if(o.localCandidateId){let u=e.get(o.localCandidateId);u&&c(t.local,u)}if(o.remoteCandidateId){let u=e.get(o.remoteCandidateId);u&&c(t.remote,u)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){let t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){let t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===fa.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===fa.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===fa.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Me({},t),Me({},this.stats.selectedCandidatePair.localCandidate)),e.type===fa.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Me({},t),Me({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(o=>o.ssrc===e.ssrc);t||(t=Gc(y5),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount,t.estimatedPlayoutTimestamp=e.estimatedPlayoutTimestamp;let r=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=MT(r,t,"totalProcessingDelay","jitterBufferEmittedCount",DE.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,r,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,Me({},t))}calculateAudioFreeze(e,t,r){let o=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&o!=null){let c=o.lts,u=r.timestamp,h=u-c;if(h<=0)return;let m=e.concealedSamples-t.concealedSamples-0,g=o.nonSilent+m,y=e.totalSamplesReceived-t.totalSamplesReceived;if(y<=0)return;let v=80*y/h,R=200*y/h,b=h/y,A=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,g>v&&(o.plc80>0?(e.freezeSamples80+=m,e.freezeMs80+=Math.round(m*b)):(e.freezeSamples80+=g,e.freezeMs80+=Math.round(g*b)),A=o.plc80+1);let F=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,g>R&&(o.plc200>0?(e.freezeSamples200+=m,e.freezeMs200+=Math.round(m*b)):(e.freezeSamples200+=g,e.freezeMs200+=Math.round(g*b)),F=o.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:m,lts:u,plc80:A,plc200:F})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:r.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find(h=>h.ssrc===e.ssrc);t||(t=Gc(g5),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.estimatedPlayoutTimestamp=e.estimatedPlayoutTimestamp;let r=this.lastDecodeVideoReceiverStats.get(t.ssrc),o=this.lastVideoFramesDecode.get(t.ssrc),c=this.lastVideoFramesOutput.get(t.ssrc),u=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){let h=t.decodedFrame?t.decodedFrame.width:0,m=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,h,m),this.isFirstVideoDecoded[t.ssrc]=!0}if(r){let h=r.stats,m=u-r.lts;t.framesDecodeFreezeTime=h.framesDecodeFreezeTime,t.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(r.lts=Date.now(),t.framesDecodeInterval=m,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<h.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(r.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-r.qpSum)/(e.framesDecoded-r.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=MT(r?.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=MT(r?.stats,t,"totalProcessingDelay","framesDecodeCount",DE.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=MT(r?.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",DE.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=MT(r?.stats,t,"totalInterFrameDelay","framesDecodeCount",DE.kMillisecondsFromSeconds),o&&u-o.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-o.count)/((u-o.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:u,rate:t.decodeFrameRate})):o?t.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:u,rate:0}),t.framesDroppedCount&&e.framesReceived&&(c&&u-c.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-c.count)/((u-c.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:u,rate:Math.max(t.outputFrameRate,0)})):c?t.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:u,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:Me({},t),lts:r?r.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(o=>o.ssrc===e.ssrc);t||(t=Gc(_5),this._stats.videoSend.push(t));let r=this.mediaBytesSent.get(e.ssrc);if(r)r.add(e.bytesSent);else{let o=new Rk(10);o.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,o)}if(e.retransmittedBytesSent!==void 0){let o=this.mediaBytesRetransmit.get(e.ssrc);if(o)o.add(e.retransmittedBytesSent);else{let c=new Rk(10);c.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,c)}}if(e.totalEncodedBytesTarget){let o=this.mediaBytesTargetEncode.get(e.ssrc);if(o)o.add(e.totalEncodedBytesTarget);else{let c=new Rk(10);c.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,c)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){let o=this.lastEncoderMs.get(e.ssrc);if(!o||o.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{let c=e.framesEncoded-o.lastFrameCount,u=e.totalEncodeTime-o.lastEncoderTime;t.avgEncodeMs=1e3*u/c}}if(e.framesEncoded&&e.qpSum){let o=this.lastEncoderMs.get(e.ssrc);!o||o.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-o.lastQpSum)/(e.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let o=this.findRemoteStatsId(e.ssrc,fa.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(r=>r.ssrc===e.ssrc);if(t||(t=Gc(E5),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let r=this.findRemoteStatsId(e.ssrc,fa.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}processTransportStats(e){this._stats.transport.bytesReceived=e.bytesReceived||this._stats.transport.bytesReceived,this._stats.transport.bytesSent=e.bytesSent||this._stats.transport.bytesSent,this._stats.transport.packetsReceived=e.packetsReceived||this._stats.transport.packetsReceived,this._stats.transport.packetsSent=e.packetsSent||this._stats.transport.packetsSent}findRemoteStatsId(e,t){var r;let o=Array.from(Yo(r=this.report).call(r)).find(c=>c.type===t&&c.ssrc===e);return o?o.id:null}processVideoMediaSource(e,t){let r=this.report.get(e);r&&r.width&&r.height&&r.framesPerSecond&&(t.inputFrame={width:r.width,height:r.height,frameRate:r.framesPerSecond})}processAudioMediaSource(e,t){let r=this.report.get(e);r&&(t.inputLevel=r.audioLevel)}processVideoTrackSenderStats(e,t,r){var o,c,u,h;let m=t?this.report.get(t):void 0,g=(o=m?.framesSent)!==null&&o!==void 0?o:e.framesSent;if(typeof g!="number")return;let y=(c=m?.frameWidth)!==null&&c!==void 0?c:e.frameWidth,v=(u=m?.frameHeight)!==null&&u!==void 0?u:e.frameHeight,R=(h=m?.framesPerSecond)!==null&&h!==void 0?h:e.framesPerSecond;if(typeof y=="number"&&typeof v=="number"||(y=0,v=0),R==null){let b=Date.now(),A=this.lastVideoFramesSent.get(r.ssrc);A&&b-A.lts>=800?(R=Math.round((g-A.count)/((b-A.lts)/1e3)),this.lastVideoFramesSent.set(r.ssrc,{count:g,lts:b,rate:R})):A?R=A.rate:this.lastVideoFramesSent.set(r.ssrc,{count:g,lts:b,rate:0})}r.sentFrame={width:y,height:v,frameRate:Math.max(0,R)}}processVideoTrackReceiverStats(e,t,r){var o,c,u,h,m;let g=t?this.report.get(t):void 0,y=(o=g?.framesReceived)!==null&&o!==void 0?o:e.framesReceived,v=(c=g?.frameWidth)!==null&&c!==void 0?c:e.frameWidth,R=(u=g?.frameHeight)!==null&&u!==void 0?u:e.frameHeight,b=(h=g?.jitterBufferDelay)!==null&&h!==void 0?h:e.jitterBufferDelay,A=(m=g?.jitterBufferEmittedCount)!==null&&m!==void 0?m:e.jitterBufferEmittedCount;if(typeof y=="number"){let F=this.lastVideoFramesRecv.get(r.ssrc),M=Date.now();r.framesReceivedCount=y;let j=0;F&&M-F.lts>=800?(j=Math.round((y-F.count)/((M-F.lts)/1e3)),this.lastVideoFramesRecv.set(r.ssrc,{count:y,lts:M,rate:j})):F?j=F.rate:this.lastVideoFramesRecv.set(r.ssrc,{count:y,lts:M,rate:0}),r.receivedFrame={width:v||0,height:R||0,frameRate:j||0},r.decodedFrame={width:v||0,height:R||0,frameRate:r.decodeFrameRate||0},r.outputFrame={width:v||0,height:R||0,frameRate:r.outputFrameRate||r.decodeFrameRate||0}}if(b&&A){let F=this.lastVideoJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},M=F.jitterBufferMs,j=A-F.jitterBufferEmittedCount;j>0&&(M=1e3*(b-F.jitterBufferDelay)/j),r.jitterBufferMs=M,r.currentDelayMs=Math.round(M),this.lastVideoJBDelay.set(r.ssrc,{jitterBufferDelay:b,jitterBufferEmittedCount:A,jitterBufferMs:r.currentDelayMs})}}processAudioTrackSenderStats(e,t,r){var o,c,u,h;let m=t?this.report.get(t):void 0,g=(o=(c=m?.echoReturnLoss)!==null&&c!==void 0?c:e.echoReturnLoss)!==null&&o!==void 0?o:0,y=(u=(h=m?.echoReturnLossEnhancement)!==null&&h!==void 0?h:e.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;r.aecReturnLoss=g,r.aecReturnLossEnhancement=y}processAudioTrackReceiverStats(e,t,r){var o,c,u,h,m,g,y,v,R;let b=t?this.report.get(t):void 0,A=(o=b?.removedSamplesForAcceleration)!==null&&o!==void 0?o:e.removedSamplesForAcceleration,F=(c=b?.totalSamplesReceived)!==null&&c!==void 0?c:e.totalSamplesReceived,M=(u=b?.jitterBufferDelay)!==null&&u!==void 0?u:e.jitterBufferDelay,j=(h=b?.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount,K=(m=b?.audioLevel)!==null&&m!==void 0?m:e?.audioLevel,q=(g=b?.totalSamplesDuration)!==null&&g!==void 0?g:e?.totalSamplesDuration,Q=(y=b?.concealedSamples)!==null&&y!==void 0?y:e.concealedSamples,se=(v=b?.silentConcealedSamples)!==null&&v!==void 0?v:e.silentConcealedSamples,oe=(R=b?.concealmentEvents)!==null&&R!==void 0?R:e.concealmentEvents;if(typeof F=="number"&&(r.totalSamplesReceived=F),typeof se=="number"&&(r.silentConcealedSamples=se),typeof oe=="number"&&(r.concealmentEvents=oe),typeof Q=="number"&&(r.concealedSamples=Q),A&&F&&(r.accelerateRate=A/F),M&&j){let de=this.lastAudioJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},Ce=de.jitterBufferMs,Pe=j-de.jitterBufferEmittedCount;Pe>0&&(Ce=1e3*(M-de.jitterBufferDelay)/Pe),r.jitterBufferMs=Math.round(Ce),this.lastAudioJBDelay.set(r.ssrc,{jitterBufferDelay:M,jitterBufferEmittedCount:j,jitterBufferMs:r.jitterBufferMs})}r.outputLevel=K;let te=1920;q&&F&&(te=F/q/50,r.receivedFrames=Math.round(F/te)),Q&&(r.droppedFrames=Math.round(Q/te))}processRemoteInboundStats(e,t){let r=this.report.get(e);r&&(t.packetsLost=r.packetsLost,r.roundTripTime&&(t.rttMs=1e3*r.roundTripTime),r.jitter&&(t.jitterMs=1e3*r.jitter),r.timestamp&&(t.timestamp=r.timestamp))}getCodecFromCodecStats(e){let t=this.report.get(e);if(!t)return"";let r=t.mimeType.match(/\/(.*)$/);return r&&r[1]?r[1]:""}updateSendBitrate(){let e=0,t=null,r=null;this.mediaBytesSent.forEach(c=>{e+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{t=t===null?c.diffMean():t+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()});let o=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),r!==null&&(this._stats.bitrate.targetEncoded=8*r/(this.options.updateInterval/1e3))}},Sde=class extends bk{updateStats(){return ze.resolve()}};function kb(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4,u=(function(){let h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null})();return u?u<76?new vde(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new v5(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:o,firstVideoDecodedTimeout:c}):(function(h){if(!window.RTCStatsReport)return!1;let m=h.getStats();return!!(m instanceof ze||(function(g){return!!g&&(typeof g=="object"||typeof g=="function")&&typeof g.then=="function"})(m))})(e)?new v5(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new Sde(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:o,firstVideoDecodedTimeout:c})}let S5="websdk_ng_install_id";function Ak(){try{if(z("INSTALL_ID"))return z("INSTALL_ID");let e=window.localStorage.getItem(S5);return e||(e=Um(),window.localStorage.setItem(S5,e)),Ln("INSTALL_ID",e),e}catch{return}}let Ja=(function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;let t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){let r=t[1],o=t[2];return"".concat(r,".").concat(o)}return"4.0.0.999"})("4.24.2"),Ok=(function(){try{return JSON.parse("true")===!0}catch{return!0}})(),Vm=(function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e})({}),ns=(function(){let e="us".concat("erna","me"),t="pa".concat("sswo","rd"),r=["t","s","t"];r.splice(1,0,"e");let o=r.join(""),c=[];for(let m=0;m<6;m++)c.push("1");let u=c.join(""),h={};return h[e]=o,h[t]=u,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})})();window.DEFAULT_TURN_CONFIG=ns;let Db={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},Nk={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},Pk="v4.24.2-0-g002485b1-dirty(12/12/2025, 5:26:54 PM)",kk={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",TURN_DOMAINS:["edge.agora.io"],USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,FLS_FALLBACK_TIMEOUT:3e4,RTE_DETAIL_REPORT_INTERVAL:6e4,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0,UPDATE_RTP_CAP_IN_HOST:!1,IOS_BG_TAG:!0,IOS_AUTO_RESTART_BG_TAG:!0,IGNORE_UID_CHECK:!1,ENABLE_UP_SPS_PPS:!1,ENABLE_DOWN_SPS_PPS:!1,NO_EDGES_RETRY:!0,BUFFER_READY_FRAMES:3,FLS_SYNC_AV_PLAY_LIMIT:0,FLS_BUFFER_WAIT_TIME:1500,VOS_CONFIGURE:void 0,ENABLE_QUALITY_FALLBACK:!1,QUALITY_FALLBACK_REHEARSAL:!0,ENABLE_FLS_AV1_FIRST:!1,ENABLE_AP_MULTI_IP:!0,FLS_ENABLE_AV1_DETECT:!0,FLS_ENABLE_AV1_DECODE_DETECT:!0},An=Me(Me(Me(Me({},kk),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_MANAGER_WSS:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_WSS:"",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,DC_JOIN_WITH_FAILBACK:4e3,DC_CONNECTION_TIMEOUT:2e3,DC_PINGPONG_INTERVAL:2e3,DC_DEBUG_LOG:!1,UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:Nk,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},Db),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,REMOTE_VIDEO_STREAM_TYPE:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_FORCE_HLS:!1,MAX_WEBAUDIO_VOLUME:300,ENABLE_VOS_FALLBACK:!1,ENABLE_FALLBACK_TO_HLS:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!0,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1,IGNORE_RTC_DEVICE_CHECK:!1,FLS_AUTOPLAY_EMITS:!1,ENABLE_DUAL_STREAM_FLAG:!1,FORBID_MODIFY_LOCAL_OFFER_SDP:!1,RESERVE_MID_1_MLINE:!1});function Ln(e,t,r){var o,c,u;ke(o=Object.keys(An)).call(o,e)&&(!r&&ke(c=Object.keys(ma)).call(c,e)||(An[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(An.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(u=!!t,An.USE_NEW_NETWORK_CONFIG=u,u&&(An.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],An.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],An.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],An.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],An.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",An.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",An.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(An.ENABLE_INSTANT_VIDEO=!0,An.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(An.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(An.NEW_TURN_MODE||(An.NEW_TURN_MODE=4))))}function z(e){if(e==="TURN_DOMAINS"){let t=An.TURN_DOMAINS;return ke(t).call(t,z("TURN_DOMAIN"))?t:[z("TURN_DOMAIN")].concat(t)}return An[e]}Ok||(An.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],An.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],An.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],An.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],An.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],An.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],An.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",An.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",An.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",An.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",An.AREAS=["NORTH_AMERICA","OVERSEA"]);let T5=(function(e){return e[e.REALTIME=1]="REALTIME",e})({}),ma={};var Tt=(function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_RTE_URL="SET_RTE_URL",e.SET_RTE_SID="SET_RTE_SID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e})(Tt||{});let Fm=(function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e})({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});let w5=128,Tde=96,C5=1e3,xE=10,wde=0;var R5=(()=>{var e={8:(o,c,u)=>{u.r(c),u.d(c,{Parser:()=>Pe,Printer:()=>jt,parse:()=>Ve,print:()=>Ze});let h=`
`,m="".concat("\r").concat(h),g=" ",y;function v(Ne){return Ne>="0"&&Ne<="9"}function R(Ne){return Ne>="!"&&Ne<="~"}function b(Ne){return R(Ne)||Ne>=""&&Ne<=""}function A(Ne){return Ne==="!"||Ne>="#"&&Ne<="'"||Ne>="*"&&Ne<="+"||Ne>="-"&&Ne<="."||Ne>="0"&&Ne<="9"||Ne>="A"&&Ne<="Z"||Ne>="^"&&Ne<="~"}function F(Ne){return Ne>="1"&&Ne<="9"}function M(Ne){return Ne>="A"&&Ne<="Z"||Ne>="a"&&Ne<="z"}function j(Ne){return Ne==="d"||Ne==="h"||Ne==="m"||Ne==="s"}function K(Ne){return Ne>""&&Ne<"	"||Ne>"\v"&&Ne<"\f"||Ne>""&&Ne<""}function q(Ne){return M(Ne)||v(Ne)||Ne==="+"||Ne==="/"}function Q(Ne){return v(Ne)||M(Ne)||Ne==="+"||Ne==="/"||Ne==="-"||Ne==="_"}function se(Ne){return M(Ne)||v(Ne)||Ne==="+"||Ne==="/"}function oe(Ne,L){var J=Object.keys(Ne);if(Object.getOwnPropertySymbols){var ie=Object.getOwnPropertySymbols(Ne);L&&(ie=ie.filter(function(Ue){return Object.getOwnPropertyDescriptor(Ne,Ue).enumerable})),J.push.apply(J,ie)}return J}function te(Ne){for(var L=1;L<arguments.length;L++){var J=arguments[L]!=null?arguments[L]:{};L%2?oe(Object(J),!0).forEach(function(ie){de(Ne,ie,J[ie])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Ne,Object.getOwnPropertyDescriptors(J)):oe(Object(J)).forEach(function(ie){Object.defineProperty(Ne,ie,Object.getOwnPropertyDescriptor(J,ie))})}return Ne}function de(Ne,L,J){return L in Ne?Object.defineProperty(Ne,L,{value:J,enumerable:!0,configurable:!0,writable:!0}):Ne[L]=J,Ne}(function(Ne){Ne.VERSION="v",Ne.ORIGIN="o",Ne.SESSION_NAME="s",Ne.INFORMATION="i",Ne.URI="u",Ne.EMAIL="e",Ne.PHONE="p",Ne.CONNECTION="c",Ne.BANDWIDTH="b",Ne.TIME="t",Ne.REPEAT="r",Ne.ZONE_ADJUSTMENTS="z",Ne.KEY="k",Ne.ATTRIBUTE="a",Ne.MEDIA="m"})(y||(y={}));class Ce{consumeText(L,J){let ie=J;for(;ie<L.length;){let Ue=L[ie];if(Ue==="\0"||Ue==="\r"||Ue===h)break;ie+=1}if(ie-J==0)throw new Error("Invalid text, at ".concat(L));return ie}consumeUnicastAddress(L,J,ie){return this.consumeTill(L,J,g)}consumeOneOrMore(L,J,ie){let Ue=J;for(;ie(L[Ue]);)Ue++;if(Ue-J==0)throw new Error("Invalid rule at ".concat(J,"."));return Ue}consumeSpace(L,J){if(L[J]===g)return J+1;throw new Error("Invalid space at ".concat(J,"."))}consumeIP4Address(L,J){let ie=J;for(let Ue=0;Ue<4;Ue++)if(ie=this.consumeDecimalUChar(L,ie),Ue!==3){if(L[ie]!==".")throw new Error("Invalid IP4 address.");ie++}return ie}consumeDecimalUChar(L,J){let ie=J;for(let Rt=0;Rt<3&&v(L[ie]);Rt++,ie++);if(ie-J==0)throw new Error("Invalid decimal uchar.");let Ue=parseInt(L.slice(J,ie));if(Ue>=0&&Ue<=255)return ie;throw new Error("Invalid decimal uchar")}consumeIP6Address(L,J){let ie=this.consumeHexpart(L,J);return L[ie]===":"&&(ie+=1,ie=this.consumeIP4Address(L,ie)),ie}consumeHexpart(L,J){let ie=J;if(L[ie]===":"&&L[ie+1]===":"){ie+=2;try{ie=this.consumeHexseq(L,ie)}catch{}return ie}if(ie=this.consumeHexseq(L,ie),L[ie]===":"&&L[ie+1]===":"){ie+=2;try{ie=this.consumeHexseq(L,ie)}catch{}return ie}return ie}consumeHexseq(L,J){let ie=J;for(;ie=this.consumeHex4(L,ie),L[ie]===":"&&L[ie+1]!==":";)ie+=1;return ie}consumeHex4(L,J){let ie=0;for(;ie<4;ie++)if(!((Ue=L[J+ie])>="0"&&Ue<="9"||Ue>="a"&&Ue<="f"||Ue>="A"&&Ue<="F")){if(ie===0)throw new Error("Invalid hex 4");break}var Ue;return J+ie}consumeFQDN(L,J){let ie=J;for(;v(L[ie])||M(L[ie])||L[ie]==="-"||L[ie]===".";)ie+=1;if(ie-J<4)throw new Error("Invalid FQDN");return ie}consumeExtnAddr(L,J){return this.consumeOneOrMore(L,J,b)}consumeMulticastAddress(L,J,ie){switch(ie){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(L,J);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(L,J);default:try{return this.consumeFQDN(L,J)}catch{return this.consumeExtnAddr(L,J)}}}consumeIP6MulticastAddress(L,J){let ie=this.consumeHexpart(L,J);return L[ie]==="/"?this.consumeInteger(L,ie+1):ie}consumeIP4MulticastAddress(L,J){let ie=J+3,Ue=L.slice(J,ie),Rt=parseInt(Ue);if(Rt<224||Rt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let $n=0;$n<3;$n++){if(L[ie]!==".")throw new Error("Invalid IP4 multicast address.");ie+=1,ie=this.consumeDecimalUChar(L,ie)}return L[ie]==="/"&&(ie+=1),ie=this.consumeTTL(L,ie),L[ie]==="/"&&(ie=this.consumeInteger(L,ie)),ie}consumeInteger(L,J){if(!F(L[J]))throw new Error("Invalid integer.");for(J+=1;v(L[J]);)J+=1;return J}consumeTTL(L,J){if(L[J]==="0")return J+1;if(!F(L[J]))throw new Error("Invalid TTL.");J+=1;for(let ie=0;ie<2&&v(L[J]);ie++)J+=1;return J}consumeToken(L,J){return this.consumeOneOrMore(L,J,A)}consumeTime(L,J){let ie=J;if(L[ie]==="0")return ie+1;for(F(L[ie])&&(ie+=1);v(L[ie]);)ie++;if(ie-J<10)throw new Error("Invalid time");return ie}consumeAddress(L,J){return this.consumeTill(L,J,g)}consumeTypedTime(L,J){let ie=J;return ie=this.consumeOneOrMore(L,ie,v),j(L[ie])?ie+1:ie}consumeRepeatInterval(L,J){if(!F(L[J]))throw new Error("Invalid repeat interval");for(J+=1;v(L[J]);)J+=1;return j(L[J])&&(J+=1),J}consumePort(L,J){return this.consumeOneOrMore(L,J,v)}consume(L,J,ie){for(let Ue=0;Ue<ie.length;Ue++){if(J+Ue>=L.length)throw new Error("consume exceeding value length");if(L[J+Ue]!==ie[Ue])throw new Error("consume ".concat(ie," failed at ").concat(Ue))}return J+ie.length}consumeTill(L,J,ie){let Ue=J;for(;Ue<L.length&&(typeof ie!="string"||L[Ue]!==ie)&&(typeof ie!="function"||!ie(L[Ue]));)Ue++;return Ue}}class Pe extends Ce{constructor(){super(),de(this,"records",[]),de(this,"currentLine",0)}parse(L){let J=this.probeEOL(L);this.records=L.split(J).filter(Up=>!!Bs(Up).call(Up)).map(this.parseLine),this.currentLine=0;let ie=this.parseVersion(),Ue=this.parseOrigin(),Rt=this.parseSessionName(),$n=this.parseInformation(),Ai=this.parseUri(),sc=this.parseEmail(),Mp=this.parsePhone(),XI=this.parseConnection(),hy=this.parseBandWidth(),JI=this.parseTimeFields(),lg=this.parseKey(),v0=this.parseSessionAttribute(),ug=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:ie,origin:Ue,sessionName:Rt,information:$n,uri:Ai,emails:sc,phones:Mp,connection:XI,bandwidths:hy,timeFields:JI,key:lg,attributes:v0,mediaDescriptions:ug}}getCurrentRecord(){let L=this.records[this.currentLine];if(!L)throw new Error("Record doesn't exit.");return L}probeEOL(L){for(let J=0;J<L.length;J++)if(L[J]===h)return L[J-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(L,J){if(L.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");let ie=L[0];if(L[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:ie,value:L.slice(2),line:J,cur:0}}parseSessionAttribute(){let L=new ot;for(;this.currentLine<this.records.length;){let J=this.getCurrentRecord();if(J.type!==y.ATTRIBUTE)break;let ie={attField:this.extractOneOrMore(J,Ue=>A(Ue)&&Ue!==":"),_cur:0};J.value[J.cur]===":"&&(J.cur+=1,ie.attValue=this.extractOneOrMore(J,K)),L.parse(ie),this.currentLine++}return L.digest()}parseMediaAttributes(L){let J=new Xt(L);for(;this.currentLine<this.records.length;){let ie=this.getCurrentRecord();if(ie.type!==y.ATTRIBUTE)break;let Ue={attField:this.extractOneOrMore(ie,Rt=>A(Rt)&&Rt!==":"),_cur:0};ie.value[ie.cur]===":"&&(ie.cur+=1,Ue.attValue=this.extractOneOrMore(ie,K)),J.parse(Ue),this.currentLine++}return J.digest()}parseKey(){let L=this.getCurrentRecord();if(L.type===y.KEY){if(L.value==="prompt"||L.value==="clear:"||L.value==="base64:"||L.value==="uri:")return L.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){let L=this.getCurrentRecord();if(L.type===y.ZONE_ADJUSTMENTS){let J=[];for(;;)try{let ie=this.extract(L,this.consumeTime);this.consumeSpaceForRecord(L);let Ue=!1;L.value[L.cur]==="-"&&(Ue=!0,L.cur+=1);let Rt=this.extract(L,this.consumeTypedTime);J.push({time:ie,typedTime:Rt,back:Ue})}catch{break}if(J.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,J}return[]}parseRepeat(){let L=[];for(;;){let J=this.getCurrentRecord();if(J.type!==y.REPEAT)break;{let ie=this.extract(J,this.consumeRepeatInterval),Ue=this.parseTypedTime(J);L.push({repeatInterval:ie,typedTimes:Ue}),this.currentLine++}}return L}parseTypedTime(L){let J=[];for(;;)try{this.consumeSpaceForRecord(L),J.push(this.extract(L,this.consumeTypedTime))}catch{break}if(J.length===0)throw new Error("Invalid typed time.");return J}parseTime(){let L=this.getCurrentRecord(),J=this.extract(L,this.consumeTime);this.consumeSpaceForRecord(L);let ie=this.extract(L,this.consumeTime);return this.currentLine++,{startTime:J,stopTime:ie}}parseBandWidth(){let L=[];for(;this.currentLine<this.records.length;){let J=this.getCurrentRecord();if(J.type!==y.BANDWIDTH)break;{let ie=this.extractOneOrMore(J,A);if(J.value[J.cur]!==":")throw new Error("Invalid bandwidth field.");J.cur++;let Ue=this.extractOneOrMore(J,v);L.push({bwtype:ie,bandwidth:Ue}),this.currentLine++}}return L}parseVersion(){let L=this.getCurrentRecord();if(L.type!==y.VERSION)throw new Error("first sdp record must be version");let J=L.value.slice(0,this.consumeOneOrMore(L.value,0,v));if(J.length!==L.value.length)throw new Error('invalid proto version, "v='.concat(L.value,'"'));return this.currentLine++,J}parseOrigin(){let L=this.getCurrentRecord();if(L.type!==y.ORIGIN)throw new Error("second line of sdp must be origin");let J=this.extractOneOrMore(L,b);this.consumeSpaceForRecord(L);let ie=this.extractOneOrMore(L,v);this.consumeSpaceForRecord(L);let Ue=this.extractOneOrMore(L,v);this.consumeSpaceForRecord(L);let Rt=this.extractOneOrMore(L,A);this.consumeSpaceForRecord(L);let $n=this.extractOneOrMore(L,A);this.consumeSpaceForRecord(L);let Ai=this.extract(L,this.consumeUnicastAddress);return this.currentLine++,{username:J,sessId:ie,sessVersion:Ue,nettype:Rt,addrtype:$n,unicastAddress:Ai}}parseSessionName(){let L=this.getCurrentRecord();if(L.type===y.SESSION_NAME){let J=this.extract(L,this.consumeText);return this.currentLine++,J}}parseInformation(){let L=this.getCurrentRecord();if(L.type!==y.INFORMATION)return;let J=this.extract(L,this.consumeText);return this.currentLine++,J}parseUri(){let L=this.getCurrentRecord();if(L.type===y.URI)return this.currentLine++,L.value}parseEmail(){let L=[];for(;;){let J=this.getCurrentRecord();if(J.type!==y.EMAIL)break;L.push(J.value),this.currentLine++}return L}parsePhone(){let L=[];for(;;){let J=this.getCurrentRecord();if(J.type!==y.PHONE)break;L.push(J.value),this.currentLine++}return L}parseConnection(){let L=this.getCurrentRecord();if(L.type===y.CONNECTION){let J=this.extractOneOrMore(L,A);this.consumeSpaceForRecord(L);let ie=this.extractOneOrMore(L,A);this.consumeSpaceForRecord(L);let Ue=this.extract(L,this.consumeAddress);return this.currentLine++,{nettype:J,addrtype:ie,address:Ue}}}parseMedia(){let L=this.getCurrentRecord(),J=this.extract(L,this.consumeToken);this.consumeSpaceForRecord(L);let ie=this.extract(L,this.consumePort);L.value[L.cur]==="/"&&(L.cur+=1,ie+=this.extract(L,this.consumeInteger)),this.consumeSpaceForRecord(L);let Ue=[];for(Ue.push(this.extract(L,this.consumeToken));L.value[L.cur]==="/";)L.cur+=1,Ue.push(this.extract(L,this.consumeToken));if(Ue.length===0)throw new Error("Invalid proto");let Rt=this.parseFmt(L);return this.currentLine++,{mediaType:J,port:ie,protos:Ue,fmts:Rt}}parseTimeFields(){let L=[];for(;this.getCurrentRecord().type===y.TIME;){let J=this.parseTime(),ie=this.parseRepeat(),Ue=this.parseZone();L.push({time:J,repeats:ie,zones:Ue})}return L}parseMediaDescription(){let L=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.MEDIA;){let J=this.parseMedia(),ie=this.parseInformation(),Ue=this.parseConnections(),Rt=this.parseBandWidth(),$n=this.parseKey(),Ai=this.parseMediaAttributes(J);L.push({media:J,information:ie,connections:Ue,bandwidths:Rt,key:$n,attributes:Ai})}return L}parseConnections(){let L=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.CONNECTION;)L.push(this.parseConnection());return L}parseFmt(L){let J=[];for(;;)try{this.consumeSpaceForRecord(L),J.push(this.extract(L,this.consumeToken))}catch{break}if(J.length===0)throw new Error("Invalid fmts");return J}extract(L,J){for(var ie=arguments.length,Ue=new Array(ie>2?ie-2:0),Rt=2;Rt<ie;Rt++)Ue[Rt-2]=arguments[Rt];let $n=J.call(this,L.value,L.cur,...Ue),Ai=L.value.slice(L.cur,$n);return L.cur=$n,Ai}extractOneOrMore(L,J){let ie=this.consumeOneOrMore(L.value,L.cur,J),Ue=L.value.slice(L.cur,ie);return L.cur=ie,Ue}consumeSpaceForRecord(L){if(L.value[L.cur]!==g)throw new Error("Invalid space at ".concat(L.cur,"."));L.cur+=1}}class Qe extends Ce{constructor(){super(...arguments),de(this,"attributes",void 0),de(this,"digested",!1)}extractOneOrMore(L,J,ie){let Ue=this.consumeOneOrMore(L.attValue,L._cur,J),Rt=L.attValue.slice(L._cur,Ue),[$n,Ai]=ie||[];if(typeof $n=="number"&&Rt.length<$n)throw new Error("error in length, should be more or equal than ".concat($n," characters."));if(typeof Ai=="number"&&Rt.length>Ai)throw new Error("error in length, should be less or equal than ".concat(Ai," characters."));return L._cur=Ue,Rt}consumeAttributeSpace(L){if(L.attValue[L._cur]!==g)throw new Error("Invalid space at ".concat(L._cur,"."));L._cur+=1}extract(L,J){if(!L.attValue)throw new Error("Nothing to extract from attValue.");for(var ie=arguments.length,Ue=new Array(ie>2?ie-2:0),Rt=2;Rt<ie;Rt++)Ue[Rt-2]=arguments[Rt];let $n=J.call(this,L.attValue,L._cur,...Ue),Ai=L.attValue.slice(L._cur,$n);return L._cur=$n,Ai}atEnd(L){if(!L.attValue)throw new Error;return L._cur>=L.attValue.length}peekChar(L){if(!L.attValue)throw new Error;return L.attValue[L._cur]}peek(L,J){if(!L.attValue)throw new Error;for(let ie=0;ie<J.length;ie++)if(J[ie]!==L.attValue[L._cur+ie])return!1;return!0}parseIceUfrag(L){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(L,q,[4,256])}parseIcePwd(L){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(L,q,[22,256])}parseIceOptions(L){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");let J=[];for(;!this.atEnd(L);){J.push(this.extractOneOrMore(L,q));try{this.consumeAttributeSpace(L)}catch(ie){if(this.atEnd(L))break;throw ie}}this.attributes.iceOptions=J}parseFingerprint(L){let J=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L);let ie=this.extract(L,this.consumeTill);this.attributes.fingerprints.push({hashFunction:J,fingerprint:ie})}parseExtmap(L){let J=this.extractOneOrMore(L,v),ie;this.peekChar(L)==="/"&&(this.extract(L,this.consume,"/"),ie=this.extract(L,this.consumeToken)),this.consumeAttributeSpace(L);let Ue=this.extract(L,this.consumeTill,g),Rt=te(te({entry:parseInt(J,10)},ie&&{direction:ie}),{},{extensionName:Ue});this.peekChar(L)===g&&(this.consumeAttributeSpace(L),Rt.extensionAttributes=this.extract(L,this.consumeTill)),this.attributes.extmaps.push(Rt)}parseSetup(L){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");let J=this.extract(L,this.consumeTill);if(J!=="active"&&J!=="passive"&&J!=="actpass"&&J!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=J}}class ot extends Qe{constructor(){super(...arguments),de(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(L){if(this.digested)throw new Error("already digested");try{switch(L.attField){case"group":this.parseGroup(L);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(L);break;case"ice-pwd":this.parseIcePwd(L);break;case"ice-options":this.parseIceOptions(L);break;case"fingerprint":this.parseFingerprint(L);break;case"setup":this.parseSetup(L);break;case"tls-id":this.parseTlsId(L);break;case"identity":this.parseIdentity(L);break;case"extmap":this.parseExtmap(L);break;case"msid-semantic":this.parseMsidSemantic(L);break;default:L.ignored=!0,this.attributes.unrecognized.push(L)}}catch(J){throw console.error("parsing session attribute ".concat(L.attField,' error, "a=').concat(L.attField,":").concat(L.attValue,'"')),J}if(!L.ignored&&L.attValue&&!this.atEnd(L))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(L){let J=this.extract(L,this.consumeToken),ie=[];for(;!this.atEnd(L)&&this.peekChar(L)===g;)this.consumeAttributeSpace(L),ie.push(this.extract(L,this.consumeToken));this.attributes.groups.push({semantic:J,identificationTag:ie})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(L){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(L,Q)}parseIdentity(L){let J=this.extractOneOrMore(L,se),ie=[];for(;!this.atEnd(L)&&this.peekChar(L)===g;){this.consumeAttributeSpace(L);let Ue=this.extract(L,this.consumeToken);this.extract(L,this.consume,"=");let Rt=this.extractOneOrMore(L,$n=>$n!==g&&K($n));ie.push({name:Ue,value:Rt})}this.attributes.identities.push({assertionValue:J,extensions:ie})}parseMsidSemantic(L){this.peekChar(L)===g&&this.consumeAttributeSpace(L);let J={semantic:this.extract(L,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(L)}catch{break}if(this.peekChar(L)==="*"){this.extract(L,this.consume,"*"),J.applyForAll=!0;break}{let ie=this.extract(L,this.consumeTill,g);J.identifierList.push(ie)}}this.attributes.msidSemantic=J}}class Xt extends Qe{constructor(L){super(),de(this,"attributes",void 0),L.protos.indexOf("RTP")!==-1||L.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(L){if(this.digested)throw new Error("already digested");try{switch(L.attField){case"extmap":this.parseExtmap(L);break;case"setup":this.parseSetup(L);break;case"ice-ufrag":this.parseIceUfrag(L);break;case"ice-pwd":this.parseIcePwd(L);break;case"ice-options":this.parseIceOptions(L);break;case"candidate":this.parseCandidate(L);break;case"remote-candidate":this.parseRemoteCandidate(L);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(L);break;case"rtpmap":this.parseRtpmap(L);break;case"ptime":this.parsePtime(L);break;case"maxptime":this.parseMaxPtime(L);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(L);break;case"ssrc":this.parseSSRC(L);break;case"fmtp":this.parseFmtp(L);break;case"rtcp-fb":this.parseRtcpFb(L);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(L);break;case"mid":this.parseMid(L);break;case"msid":this.parseMsid(L);break;case"imageattr":this.parseImageAttr(L);break;case"rid":this.parseRid(L);break;case"simulcast":this.parseSimulcast(L);break;case"sctp-port":this.parseSctpPort(L);break;case"max-message-size":this.parseMaxMessageSize(L);break;case"ssrc-group":this.parseSSRCGroup(L);break;default:L.ignored=!0,this.attributes.unrecognized.push(L)}}catch(J){throw console.error("parsing media attribute ".concat(L.attField,' error, "a=').concat(L.attField,":").concat(L.attValue,'"')),J}if(!L.ignored&&L.attValue&&!this.atEnd(L))throw new Error("attribute parsing error")}parseCandidate(L){let J=this.extractOneOrMore(L,q,[1,32]);this.consumeAttributeSpace(L);let ie=this.extractOneOrMore(L,v,[1,5]);this.consumeAttributeSpace(L);let Ue=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L);let Rt=this.extractOneOrMore(L,v,[1,10]);this.consumeAttributeSpace(L);let $n=this.extract(L,this.consumeAddress);this.consumeAttributeSpace(L);let Ai=this.extract(L,this.consumePort);this.consumeAttributeSpace(L),this.extract(L,this.consume,"typ"),this.consumeAttributeSpace(L);let sc={foundation:J,componentId:ie,transport:Ue,priority:Rt,connectionAddress:$n,port:Ai,type:this.extract(L,this.consumeToken),extension:{}};for(this.peek(L," raddr")&&(this.extract(L,this.consume," raddr"),this.consumeAttributeSpace(L),sc.relAddr=this.extract(L,this.consumeAddress)),this.peek(L," rport")&&(this.extract(L,this.consume," rport"),this.consumeAttributeSpace(L),sc.relPort=this.extract(L,this.consumePort));this.peekChar(L)===g;){this.consumeAttributeSpace(L);let Mp=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L),sc.extension[Mp]=this.extractOneOrMore(L,R)}this.attributes.candidates.push(sc)}parseRemoteCandidate(L){let J=[];for(;;){let ie=this.extractOneOrMore(L,v,[1,5]);this.consumeAttributeSpace(L);let Ue=this.extract(L,this.consumeAddress);this.consumeAttributeSpace(L);let Rt=this.extract(L,this.consumePort);J.push({componentId:ie,connectionAddress:Ue,port:Rt});try{this.consumeAttributeSpace(L)}catch{break}}this.attributes.remoteCandidatesList.push(J)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(L){let J=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L);let ie=this.extract(L,this.consumeTill,"/");this.extract(L,this.consume,"/");let Ue={encodingName:ie,clockRate:this.extractOneOrMore(L,v)};this.atEnd(L)||this.peekChar(L)!=="/"||(this.extract(L,this.consume,"/"),Ue.encodingParameters=parseInt(this.extract(L,this.consumeTill),10));let Rt=this.attributes.payloads.find($n=>$n.payloadType===parseInt(J,10));Rt?Rt.rtpMap=Ue:this.attributes.payloads.push({payloadType:parseInt(J,10),rtpMap:Ue,rtcpFeedbacks:[]})}parsePtime(L){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(L,this.consumeTill)}parseMaxPtime(L){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(L,this.consumeTill)}parseDirection(L){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=L.attField}parseSSRC(L){let J=this.extractOneOrMore(L,v);this.consumeAttributeSpace(L);let ie=this.extract(L,this.consumeTill,":"),Ue;this.peekChar(L)===":"&&(this.extract(L,this.consume,":"),Ue=this.extract(L,this.consumeTill));let Rt=this.attributes.ssrcs.find($n=>$n.ssrcId===parseInt(J,10));Rt?Rt.attributes[ie]=Ue:this.attributes.ssrcs.push({ssrcId:parseInt(J,10),attributes:{[ie]:Ue}})}parseFmtp(L){let J=this.extract(L,this.consumeTill,g);this.consumeAttributeSpace(L);let ie=this.extract(L,this.consumeTill),Ue={};ie.split(";").forEach($n=>{let[Ai,sc]=$n.split("=");Ai=Bs(Ai).call(Ai);let Mp=typeof sc=="string"?Bs(sc).call(sc):null;typeof Ai=="string"&&Ai.length>0&&(Ue[Ai]=Mp)});let Rt=this.attributes.payloads.find($n=>$n.payloadType===parseInt(J,10));Rt?Rt.fmtp={parameters:Ue}:this.attributes.payloads.push({payloadType:parseInt(J,10),rtcpFeedbacks:[],fmtp:{parameters:Ue}})}parseFmtParameters(L){let J={},ie=this.extract(L,this.consumeTill,"=");L._cur++;let Ue=this.extract(L,this.consumeTill,";");for(J[ie]=Ue;L.attValue[L._cur]===";";){let Rt=this.extract(L,this.consumeTill,"=");L._cur++;let $n=this.extract(L,this.consumeTill,";");J[Rt]=$n}return J}parseRtcpFb(L){let J="";J=this.peekChar(L)==="*"?this.extract(L,this.consume,"*"):this.extract(L,this.consumeTill,g),this.consumeAttributeSpace(L);let ie=this.extract(L,this.consumeTill,g),Ue;if(ie==="trr-int")Ue={type:ie,interval:this.extract(L,this.consumeTill)};else{let Rt={type:ie};this.peekChar(L)===g&&(this.consumeAttributeSpace(L),Rt.parameter=this.extract(L,this.consumeToken),this.peekChar(L)===g&&(Rt.additional=this.extract(L,this.consumeTill))),Ue=Rt}if(J==="*")this.attributes.rtcpFeedbackWildcards.push(Ue);else{let Rt=this.attributes.payloads.find($n=>$n.payloadType===parseInt(J,10));Rt?Rt.rtcpFeedbacks.push(Ue):this.attributes.payloads.push({payloadType:parseInt(J,10),rtcpFeedbacks:[Ue]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(L){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");let J={port:this.extract(L,this.consumePort)};this.peekChar(L)===g&&(this.consumeAttributeSpace(L),J.netType=this.extractOneOrMore(L,A),this.consumeAttributeSpace(L),J.addressType=this.extractOneOrMore(L,A),this.consumeAttributeSpace(L),J.address=this.extract(L,this.consumeAddress)),this.attributes.rtcp=J}parseMsid(L){let J={id:this.extractOneOrMore(L,A,[1,64])};this.peekChar(L)===g&&(this.consumeAttributeSpace(L),J.appdata=this.extractOneOrMore(L,A,[1,64])),this.attributes.msids.push(J)}parseImageAttr(L){this.attributes.imageattr.push(L.attValue)}parseRid(L){let J=this.extractOneOrMore(L,Ue=>M(Ue)||v(Ue)||Ue==="_"||Ue==="-");this.consumeAttributeSpace(L);let ie={id:J,direction:this.extract(L,this.consumeToken),params:[]};if(this.peekChar(L)===g){if(this.consumeAttributeSpace(L),this.peek(L,"pt=")){this.extract(L,this.consume,"pt=");let Ue=[];for(;;){let Rt=this.extract(L,this.consumeToken);Ue.push(Rt);try{this.extract(L,this.consume,",")}catch{break}}ie.payloads=Ue,this.peekChar(L)===g&&this.extract(L,this.consume,g)}for(;;){let Ue=this.extract(L,this.consumeToken);if(Ue==="depend"){let Rt={type:Ue,rids:this.extract(L,this.consume,"=").split(",")};ie.params.push(Rt)}else{let Rt={type:Ue};this.peekChar(L)==="="&&(this.extract(L,this.consume,"="),Rt.val=this.extract(L,this.consumeTill,";")),ie.params.push(Rt)}try{this.extract(L,this.consume,";")}catch{break}}}this.attributes.rids.push(ie)}parseSimulcast(L){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=L.attValue,this.extract(L,this.consumeTill)}parseSctpPort(L){this.attributes.sctpPort=this.extractOneOrMore(L,v,[1,5])}parseMaxMessageSize(L){this.attributes.maxMessageSize=this.extractOneOrMore(L,v,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(L){this.attributes.mid=this.extract(L,this.consumeToken)}parseSSRCGroup(L){let J=this.extract(L,this.consumeToken),ie=[];for(;;)try{this.consumeAttributeSpace(L);let Ue=this.extract(L,this.consumeInteger);ie.push(parseInt(Ue,10))}catch{break}this.attributes.ssrcGroups.push({semantic:J,ssrcIds:ie})}}function Lt(Ne,L,J){return L in Ne?Object.defineProperty(Ne,L,{value:J,enumerable:!0,configurable:!0,writable:!0}):Ne[L]=J,Ne}class jt{constructor(){Lt(this,"eol",m)}print(L,J){let ie="";return J&&(this.eol=J),ie+=this.printVersion(L.version),ie+=this.printOrigin(L.origin),ie+=this.printSessionName(L.sessionName),ie+=this.printInformation(L.information),ie+=this.printUri(L.uri),ie+=this.printEmail(L.emails),ie+=this.printPhone(L.phones),ie+=this.printConnection(L.connection),ie+=this.printBandwidth(L.bandwidths),ie+=this.printTimeFields(L.timeFields),ie+=this.printKey(L.key),ie+=this.printSessionAttributes(L.attributes),ie+=this.printMediaDescription(L.mediaDescriptions),ie}printVersion(L){return"v=".concat(L).concat(this.eol)}printOrigin(L){return"o=".concat(L.username," ").concat(L.sessId," ").concat(L.sessVersion," ").concat(L.nettype," ").concat(L.addrtype," ").concat(L.unicastAddress).concat(this.eol)}printSessionName(L){return L?"s=".concat(L).concat(this.eol):""}printInformation(L){return L?"i=".concat(L).concat(this.eol):""}printUri(L){return L?"u=".concat(L).concat(this.eol):""}printEmail(L){let J="";for(let ie of L)J+="e=".concat(ie).concat(this.eol);return J}printPhone(L){let J="";for(let ie of L)J+="e=".concat(ie).concat(this.eol);return J}printConnection(L){return L?"c=".concat(L.nettype," ").concat(L.addrtype," ").concat(L.address).concat(this.eol):""}printBandwidth(L){let J="";for(let ie of L)J+="b=".concat(ie.bwtype,":").concat(ie.bandwidth).concat(this.eol);return J}printTimeFields(L){let J="";for(let ie of L){J+="t=".concat(ie.time.startTime," ").concat(ie.time.startTime).concat(this.eol);for(let Ue of ie.repeats)J+="r=".concat(Ue.repeatInterval," ").concat(Ue.typedTimes.join(" ")).concat(this.eol);ie.zoneAdjustments&&(J+="z=",J+="z=".concat(ie.zoneAdjustments.map(Ue=>"".concat(Ue.time," ").concat(Ue.back?"-":""," ").concat(Ue.typedTime)).join(" ")).concat(this.eol),J+=this.eol)}return J}printKey(L){return L?"k=".concat(L).concat(this.eol):""}printAttributes(L){let J="";for(let ie of L)J+="a=".concat(ie.attField).concat(ie.attValue?":".concat(ie.attValue):"").concat(this.eol);return J}printMediaDescription(L){let J="";for(let ie of L)J+=this.printMedia(ie.media),J+=this.printInformation(ie.information),J+=this.printConnections(ie.connections),J+=this.printBandwidth(ie.bandwidths),J+=this.printKey(ie.key),J+=this.printMediaAttributes(ie);return J}printConnections(L){let J="";for(let ie of L)J+=this.printConnection(ie);return J}printMedia(L){return"m=".concat(L.mediaType," ").concat(L.port," ").concat(L.protos.join("/")," ").concat(L.fmts.join(" ")).concat(this.eol)}printSessionAttributes(L){return new lr(this.eol).print(L)}printMediaAttributes(L){return new Re(this.eol).print(L)}}class En{constructor(L){Lt(this,"eol",void 0),this.eol=L}printIceUfrag(L){return L===void 0?"":"a=ice-ufrag:".concat(L).concat(this.eol)}printIcePwd(L){return L===void 0?"":"a=ice-pwd:".concat(L).concat(this.eol)}printIceOptions(L){return L===void 0?"":"a=ice-options:".concat(L.join(g)).concat(this.eol)}printFingerprints(L){return L.length>0?L.map(J=>"a=fingerprint:".concat(J.hashFunction).concat(g).concat(J.fingerprint)).join(this.eol)+this.eol:""}printExtmap(L){return L.map(J=>"a=extmap:".concat(J.entry).concat(J.direction?"/".concat(J.direction):"").concat(g).concat(J.extensionName).concat(J.extensionAttributes?"".concat(g).concat(J.extensionAttributes):"").concat(this.eol)).join("")}printSetup(L){return L===void 0?"":"a=setup:".concat(L).concat(this.eol)}printUnrecognized(L){return L.map(J=>"a=".concat(J.attField).concat(J.attValue?":".concat(J.attValue):"").concat(this.eol)).join("")}}class lr extends En{print(L){let J="";return J+=this.printGroups(L.groups),J+=this.printMsidSemantic(L.msidSemantic),J+=this.printIceLite(L.iceLite),J+=this.printIceUfrag(L.iceUfrag),J+=this.printIcePwd(L.icePwd),J+=this.printIceOptions(L.iceOptions),J+=this.printFingerprints(L.fingerprints),J+=this.printSetup(L.setup),J+=this.printTlsId(L.tlsId),J+=this.printIdentity(L.identities),J+=this.printExtmap(L.extmaps),J+=this.printUnrecognized(L.unrecognized),J}printGroups(L){let J="";return L.length>0&&(J+=L.map(ie=>"a=group:".concat(ie.semantic).concat(ie.identificationTag.map(Ue=>"".concat(g).concat(Ue)).join("")).concat(this.eol)).join("")),J}printIceLite(L){return L===void 0?"":"a=ice-lite"+this.eol}printTlsId(L){return L?"a=tls-id:".concat(L).concat(this.eol):""}printIdentity(L){return L.length===0?"":L.map(J=>"a=identity:".concat(J.assertionValue).concat(J.extensions.map(ie=>"".concat(g).concat(ie.name).concat(ie.value?"=".concat(ie.value):"")))).join(this.eol)+this.eol}printMsidSemantic(L){if(!L)return"";let J="a=msid-semantic:".concat(L.semantic);return L.applyForAll?J+="".concat(g,"*"):L.identifierList.length>0&&(J+=L.identifierList.map(ie=>"".concat(g).concat(ie))),J+this.eol}}class Re extends En{print(L){let J=L.attributes,ie="";return ie+=this.printRTCP(J.rtcp),ie+=this.printIceUfrag(J.iceUfrag),ie+=this.printIcePwd(J.icePwd),ie+=this.printIceOptions(J.iceOptions),ie+=this.printCandidates(J.candidates),ie+=this.printRemoteCandidatesList(J.remoteCandidatesList),ie+=this.printEndOfCandidates(J.endOfCandidates),ie+=this.printFingerprints(J.fingerprints),ie+=this.printSetup(J.setup),ie+=this.printMid(J.mid),ie+=this.printExtmap(J.extmaps),ie+=this.printRTPRelated(J),ie+=this.printPtime(J.ptime),ie+=this.printMaxPtime(J.maxPtime),ie+=this.printDirection(J.direction),ie+=this.printSSRCGroups(J.ssrcGroups),ie+=this.printSSRC(J.ssrcs),ie+=this.printRTCPMux(J.rtcpMux),ie+=this.printRTCPMuxOnly(J.rtcpMuxOnly),ie+=this.printRTCPRsize(J.rtcpRsize),ie+=this.printMSId(J.msids),ie+=this.printImageattr(J.imageattr),ie+=this.printRid(J.rids),ie+=this.printSimulcast(J.simulcast),ie+=this.printSCTPPort(J.sctpPort),ie+=this.printMaxMessageSize(J.maxMessageSize),ie+=this.printUnrecognized(J.unrecognized),ie}printCandidates(L){return L.map(J=>"a=candidate:".concat(J.foundation).concat(g).concat(J.componentId).concat(g).concat(J.transport).concat(g).concat(J.priority).concat(g).concat(J.connectionAddress).concat(g).concat(J.port).concat(g,"typ").concat(g).concat(J.type).concat(J.relAddr?"".concat(g,"raddr").concat(g).concat(J.relAddr):"").concat(J.relPort?"".concat(g,"rport").concat(g).concat(J.relPort):"").concat(Object.keys(J.extension).map(ie=>"".concat(g).concat(ie).concat(g).concat(J.extension[ie])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(L){return L.map(J=>"a=remote-candidates:".concat(J.join(g)).concat(this.eol)).join("")}printEndOfCandidates(L){return L===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(L){if(!L.payloads)return"";let J=L.payloads,ie="";ie+=L.rtcpFeedbackWildcards.map(Ue=>this.printRTCPFeedback("*",Ue)).join("");for(let Ue of J)ie+=this.printRtpMap(Ue.payloadType,Ue.rtpMap),ie+=this.printFmtp(Ue.payloadType,Ue.fmtp),ie+=Ue.rtcpFeedbacks.map(Rt=>this.printRTCPFeedback(Ue.payloadType,Rt)).join("");return ie}printFmtp(L,J){if(!J)return"";let ie=Object.keys(J.parameters);return ie.length===1&&J.parameters[ie[0]]===null?"a=fmtp:".concat(L).concat(g).concat(ie[0]).concat(this.eol):"a=fmtp:".concat(L).concat(g).concat(Object.keys(J.parameters).map(Ue=>"".concat(Ue,"=").concat(J.parameters[Ue])).join(";")).concat(this.eol)}printRtpMap(L,J){return J?"a=rtpmap:".concat(L).concat(g).concat(J.encodingName,"/").concat(J.clockRate).concat(J.encodingParameters?"/".concat(J.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(L,J){let ie="a=rtcp-fb:".concat(L).concat(g),Ue=J;return Ue.type==="trr-int"?ie+="ttr-int".concat(g).concat(Ue.interval):(ie+="".concat(Ue.type),Ue.parameter&&(ie+="".concat(g).concat(Ue.parameter),Ue.additional&&(ie+="".concat(g).concat(Ue.additional)))),ie+this.eol}printPtime(L){return L===void 0?"":"a=ptime:".concat(L).concat(this.eol)}printMaxPtime(L){return L===void 0?"":"a=maxptime:".concat(L).concat(this.eol)}printDirection(L){return L===void 0?"":"a=".concat(L).concat(this.eol)}printSSRC(L){return L.map(J=>Object.keys(J.attributes).map(ie=>"a=ssrc:".concat(J.ssrcId.toString(10)).concat(g).concat(ie).concat(J.attributes[ie]?":".concat(J.attributes[ie]):"").concat(this.eol)).join("")).join("")}printRTCPMux(L){return L===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(L){return L===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(L){return L===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(L){if(L===void 0)return"";let J="a=rtcp:".concat(L.port);return L.netType&&(J+="".concat(g).concat(L.netType)),L.addressType&&(J+="".concat(g).concat(L.addressType)),L.address&&(J+="".concat(g).concat(L.address)),J+this.eol}printMSId(L){return L.map(J=>"a=msid:".concat(J.id).concat(J.appdata?"".concat(g).concat(J.appdata):"").concat(this.eol)).join("")}printImageattr(L){return L.map(J=>"a=imageattr:".concat(J).concat(this.eol)).join("")}printRid(L){return L.map(J=>{let ie="a=rid:".concat(J.id).concat(g).concat(J.direction);return J.payloads&&(ie+="".concat(g,"pt=").concat(J.payloads.join(","))),J.params.length>0&&(ie+="".concat(g).concat(J.params.map(Ue=>Ue.type==="depend"?"depend=".concat(Ue.rids.join(",")):"".concat(Ue.type,"=").concat(Ue.val)).join(";"))),ie+this.eol}).join("")}printSimulcast(L){return L===void 0?"":"a=simulcast:".concat(L).concat(this.eol)}printSCTPPort(L){return L===void 0?"":"a=sctp-port:".concat(L).concat(this.eol)}printMaxMessageSize(L){return L===void 0?"":"a=max-message-size:".concat(L).concat(this.eol)}printMid(L){return L===void 0?"":"a=mid:".concat(L).concat(this.eol)}printSSRCGroups(L){return L.map(J=>"a=ssrc-group:".concat(J.semantic).concat(J.ssrcIds.map(ie=>"".concat(g).concat(ie.toString(10))).join("")).concat(this.eol)).join("")}}function Ve(Ne){return new Pe().parse(Ne)}function Ze(Ne,L){return new jt().print(Ne,L)}}},t={};function r(o){if(t[o])return t[o].exports;var c=t[o]={exports:{}};return e[o](c,c.exports,r),c.exports}return r.d=(o,c)=>{for(var u in c)r.o(c,u)&&!r.o(o,u)&&Object.defineProperty(o,u,{enumerable:!0,get:c[u]})},r.o=(o,c)=>Object.prototype.hasOwnProperty.call(o,c),r.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},r(8)})();function Hs(e){return R5.parse(e)}function th(e,t){return R5.print(e,t)}var Cde=To("Array","keys"),Rde=El,bde=Ur,Ide=N,Ade=Cde,Dk=Array.prototype,Ode={DOMTokenList:!0,NodeList:!0},Nde=function(e){var t=e.keys;return e===Dk||Ide(Dk,e)&&t===Dk.keys||bde(Ode,Rde(e))?Ade:t},ys=l(Nde);function Rr(e,t,r){return(t=(function(o){var c=(function(u,h){if(typeof u!="object"||!u)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var g=m.call(u,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)})(o);return typeof c=="symbol"?c:c+""})(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function b5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function Pt(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?b5(Object(r),!0).forEach(function(o){Rr(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b5(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}function xb(e,t){return xb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},xb(e,t)}function xk(){xk=function(c,u){return new r(c,void 0,u)};var e=RegExp.prototype,t=new WeakMap;function r(c,u,h){var m=RegExp(c,u);return t.set(m,h||t.get(c)),xb(m,r.prototype)}function o(c,u){var h,m=t.get(u);return to(h=Object.keys(m)).call(h,function(g,y){var v=m[y];if(typeof v=="number")g[y]=c[v];else{for(var R=0;c[v[R]]===void 0&&R+1<v.length;)R++;g[y]=c[v[R]]}return g},Object.create(null))}return(function(c,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function");c.prototype=Object.create(u&&u.prototype,{constructor:{value:c,writable:!0,configurable:!0}}),Object.defineProperty(c,"prototype",{writable:!1}),u&&xb(c,u)})(r,RegExp),r.prototype.exec=function(c){var u=e.exec.call(this,c);if(u){u.groups=o(u,this);var h=u.indices;h&&(h.groups=o(h,this))}return u},r.prototype[Symbol.replace]=function(c,u){if(typeof u=="string"){var h=t.get(this);return e[Symbol.replace].call(this,c,u.replace(/\$<([^>]+)(>|$)/g,function(g,y,v){if(v==="")return g;var R=h[y];return Array.isArray(R)?"$"+R.join("$"):typeof R=="number"?"$"+R:""}))}if(typeof u=="function"){var m=this;return e[Symbol.replace].call(this,c,function(){var g=arguments;return typeof g[g.length-1]!="object"&&(g=[].slice.call(g)).push(o(g,m)),u.apply(this,g)})}return e[Symbol.replace].call(this,c,u)},xk.apply(this,arguments)}let I5=new class extends dr{constructor(){super(...arguments),Rr(this,"currentUploadLogID",0)}reportLogUploadError(e){let{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class Pde{constructor(t){Rr(this,"logger",void 0),Rr(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];this.logger.debug(...this.prefixLists,...r)}info(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];this.logger.info(...this.prefixLists,...r)}warning(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];this.logger.warning(...this.prefixLists,...r)}error(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];this.logger.error(...this.prefixLists,...r)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function Lk(){let e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function A5(){let e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?t?.[0]+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}let $a={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Lb=Date.now(),UT=e=>{for(let t in $a)if(Object.prototype.hasOwnProperty.call($a,t)&&$a[t]===e)return t;return"DEFAULT"},k=new class{constructor(){Rr(this,"proxyServerURL",void 0),Rr(this,"logLevel",$a.DEBUG),Rr(this,"uploadState","collecting"),Rr(this,"uploadLogWaitingList",[]),Rr(this,"uploadLogUploadingList",[]),Rr(this,"uploadErrorCount",0),Rr(this,"currentLogID",0),Rr(this,"url",void 0),Rr(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let o=[$a.DEBUG].concat(t);this.log.apply(this,o)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let o=[$a.INFO].concat(t);this.log.apply(this,o)}warning(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let o=[$a.WARNING].concat(t);this.log.apply(this,o)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let o=[$a.ERROR].concat(t);this.log.apply(this,o)}upload(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let o=[$a.DEBUG].concat(t);this.uploadLog.apply(this,o)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Ln("UPLOAD_LOG",!0)}disableLogUpload(){Ln("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new Pde(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-Lb<100)return void setTimeout(()=>{this.log(...t)},Date.now()-Lb);let o=Math.max(0,Math.min(4,t[0]));if(t[0]=Lk()+" Agora-SDK [".concat(UT(o),"]:"),this.appendLogToWaitingList(o,...t),o<this.logLevel)return;let c=Lk()+" %cAgora-SDK [".concat(UT(o),"]:"),u=[];if(!z("USE_NEW_LOG"))switch(o){case $a.DEBUG:u=[c,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,u);break;case $a.INFO:u=[c,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,u);break;case $a.WARNING:u=[c,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,u);break;case $a.ERROR:u=[c,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-Lb<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-Lb);let o=Math.max(0,Math.min(4,t[0]));t[0]=Lk()+" Agora-SDK [".concat(UT(o),"]:"),this.appendLogToWaitingList(o,...t)}appendLogToWaitingList(e){if(!z("UPLOAD_LOG"))return;for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];Array.isArray(r[0])?r[0][0]=A5()+" Agora-SDK [".concat(UT(e),"]:"):r[0]=A5()+" Agora-SDK [".concat(UT(e),"]:");let c="";r.forEach(u=>{typeof u=="object"&&(u=JSON.stringify(u)),c+="".concat(u," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){let e=this.uploadLogUploadingList,t={sdk_version:Ja,process_id:z("PROCESS_ID"),payload:JSON.stringify(e)};return Wl(async()=>{let r=await ao.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(z("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(z("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(r.data!=="OK"){let o=new Error("unexpected upload log response");throw o.response=r,o}},()=>(this.uploadLogUploadingList=[],!1),r=>{let o={status:-1,message:r.message,errorRange:e.map(c=>c.log_item_id)};return r.response?(o.status=r.response.status,o.data=r.response.data,o.headers=r.response.headers):r.request&&(o.status=r.request.status),I5.reportLogUploadError(o),!0},{timeout:z("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:z("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,z("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),z("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),z("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),z("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var O5;function kde(e){return Hi(e.reportId,"params.reportId",0,100,!1),Hi(e.category,"params.category",0,100,!1),Hi(e.event,"params.event",0,100,!1),Hi(e.label,"params.label",0,100,!1),Vn(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(O5={}).FREE="free",O5.UPLOADING="uploading",(function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"})({});let Dde={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},oi=(function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.RTE_DETAIL="rte_detail_stats",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e})({}),cr=(function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.RTE_DETAIL="io.agora.pb.Wrtc.RteDetailStats",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e})({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let xde=(function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e})({});function gt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,r,o){let c=o.value;if(typeof c=="function"){let u=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);o.value=function(){for(var h,m=arguments.length,g=new Array(m),y=0;y<m;y++)g[y]=arguments[y];let v=g;if(e.argsMap)try{v=e.argsMap(this,...g)}catch(b){k.warning(b),v=[]}try{JSON.stringify(v)}catch{k.warning("arguments for method ".concat(u,".").concat(String(r)," not serializable for apiInvoke.")),v=[]}let R=(e.report||tt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(u,".").concat(String(r)),options:v,tag:Fn.TRACER,reportResult:e.reportResult},e.throttleTime);try{let b=c.apply(this,g);return b instanceof ze?b.then(A=>(R.onSuccess(e.reportResult&&A),A)).catch(A=>{throw R.onError(A),A}):(R.onSuccess(e.reportResult&&b),b)}catch(b){throw R.onError(b),b}}}return o}}let tt=new class{constructor(){Rr(this,"baseInfoMap",new Map),Rr(this,"proxyServer",void 0),Rr(this,"eventUploadTimer",void 0),Rr(this,"setSessionIdTimer",void 0),Rr(this,"url",void 0),Rr(this,"sids",new Set),Rr(this,"backupUrl",void 0),Rr(this,"_appId",void 0),Rr(this,"_aid",0),Rr(this,"keyEventUploadPendingItems",[]),Rr(this,"normalEventUploadPendingItems",[]),Rr(this,"apiInvokeUploadPendingItems",[]),Rr(this,"apiInvokeCount",0),Rr(this,"apiInvokeLoggedCount",0),Rr(this,"ltsList",[]),Rr(this,"lastSendNormalEventTime",Date.now()),Rr(this,"customReportCounterTimer",void 0),Rr(this,"customReportCount",0),Rr(this,"extApiInvoke",async e=>{for(let t of e){let r=Pt(Pt({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Fn.TRACER});this.sendApiInvoke(r)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),z("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),z("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[r,o]=t;return r+o}),16)||0}reportApiInvoke(e,t,r){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;let o=Date.now();this.apiInvokeCount+=1;let c=this.apiInvokeCount,u=!!z("SHOW_REPORT_INVOKER_LOG"),h=!!z("SHOW_REPORT_USER_INVOKER_LOG"),m=u||h&&t.id;m&&(this.apiInvokeLoggedCount+=1);let g=this.apiInvokeLoggedCount;function y(A,F){if(m){let M="[apiInvoke-".concat(g,"]");if(t.id&&(M+="[".concat(t.id,"]")),t.name&&(M+="[".concat(t.name,"]"),t.name===ar.JOIN))return k.info("".concat(M," ").concat(A));k.info("".concat(M," ").concat(A),A==="start"?t.options:F||"")}}let v=()=>({tag:t.tag,invokeId:c,sid:e,name:t.name,apiInvokeTime:o,options:t.options,states:t.states||null});y("start");let R=!1;Ci(t.timeout).then(()=>{R||(this.sendApiInvoke(Pt(Pt({},v()),{},{error:Y.API_INVOKE_TIMEOUT,success:!1})),y("timeout"))});let b=new _e(Y.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:A=>{let F=()=>{if(R)throw b;return R=!0,this.sendApiInvoke(Pt(Pt({},v()),{},{success:!0},t.reportResult&&{result:A})),y("onSuccess"),A};return r?l5(F,t.name+"Success",r,()=>R=!0):F()},onError:A=>{let F=()=>{if(R)throw A;R=!0,this.sendApiInvoke(Pt(Pt({},v()),{},{success:!1,error:A})),y("onFailure",A.toString())};return r?l5(F,t.name+"Error",r,()=>R=!0):F()}}}_send(e,t,r){this.send({type:e,data:t},r)}_sendApiInvoke(e){return this.sendApiInvoke(e)}sessionInit(e,t){if(this.baseInfoMap.has(e))return;let r=Date.now(),o=this.createBaseInfo(e,r);o.cname=t.cname,o.rteUrl=t.rteUrl;let c=Object.assign({},{willUploadConsoleLog:z("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:Ok?"global":"oversea",areas:z("AREAS")&&z("AREAS").join(",")},t.extend),{stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:g,lsid:y,clientRole:v}=t,R=Date.now(),b=Pt(Pt({},o),{},{eventType:oi.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:Pk,lts:R,elapse:R-r,extend:JSON.stringify(c),mode:t.mode,process:z("PROCESS_ID"),appType:z("APP_TYPE"),success:!0,version:Ja,stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:g,lsid:y,clientType:ke(A=window.navigator.userAgent).call(A,"AgoraWebView")?42:20,clientRole:v,serviceId:z("PROCESS_ID"),extensionID:z("PLUGIN_INFO").join(",")||"",rteUrl:t.rteUrl,rteSid:t.rteSid});var A;this.send({type:cr.SESSION,data:b},!0)}reportRteDetail(e){let t=this.baseInfoMap.get(e);if(!t)return;let r=t.info,o=Date.now(),c=Pt(Pt({},r),{},{eventType:oi.RTE_DETAIL,lts:o,success:!0,elapse:o-t.startTime,vid:r.vid===void 0?0:Number(r.vid),ua:navigator.userAgent});this.send({type:cr.RTE_DETAIL,data:c},!0)}joinChooseServer(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let o=r.info;t.vid&&(o.vid=t.vid);let c=Date.now(),u=Pt(Pt({},o),{},{role:t.role,eventType:oi.JOIN_CHOOSE_SERVER,lts:c,eventElapse:t.elapse||c-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:c-r.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,ua:navigator.userAgent,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:cr.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let o=r.info,c=Date.now(),u=Pt(Pt({},o),{},{eventType:oi.REQ_USER_ACCOUNT,lts:c,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||c-r.startTime,eventElapse:c-t.lts,extend:JSON.stringify(t.extend)});this.send({type:cr.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let o=r.info;t.vid&&(o.vid=t.vid),o.uid=t.uid,o.cid=t.cid;let c=Date.now(),{firstSuccess:u,addr:h,isProxy:m}=t,g=c-r.startTime,y=Pt(Pt({},o),{},{eventType:oi.JOIN_GATEWAY,lts:c,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:g,eventElapse:c-t.lts,firstSuccess:u,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:Ak(),isABTestSuccess:t.isABTestSuccess?1:0,gatewayIp:null,gatewayPort:null,isProxy:m?1:0}),v=y.success?1:0;if(t.succ&&(r.lastJoinSuccessTime=c),h)if(y.signalChannel==="1"){let R=xk(/(\d+\.\d+\.\d+\.\d+):(\d+)/,{ip:1,port:2}),b=h.match(R);y.gatewayIp=b&&b.groups?b.groups.ip:"",y.gatewayPort=b&&b.groups?b.groups.port:""}else if(m){let R=h.match(/h=(\d{1,3}-){3}\d{1,3}/g),b=h.match(/p=[0-9]{1,6}/g);y.gatewayIp=R&&R.length?R[0].split("=")[1].replace(/-/g,"."):"",y.gatewayPort=b&&b.length?b[0].split("=")[1]:""}else{let R=h.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),b=h.match(/(:|p=)[0-9]{1,6}/g);y.gatewayIp=R&&R.length?R[0].split("//")[1].replace(/-/g,"."):"",y.gatewayPort=b&&b.length?b[0].split(/:|p=/g)[1]:""}if(u)this.send({type:cr.JOIN_GATEWAY,data:y},!0);else{let R={isSuccess:v,port:y.gatewayPort};delete y.success,delete y.eventType,delete y.firstSuccess,delete y.gatewayPort,y.vid=Number(y.vid);let b=Object.assign({},y,R,{eventType:oi.REJOIN_GATEWAY});this.send({type:cr.RE_JOIN_GATEWAY,data:b},!0)}}joinChannelTimeout(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let o=Date.now(),c=Pt(Pt({},r.info),{},{lts:o,timeout:t,elapse:o-r.startTime});this.send({type:cr.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let o=r.info,c=Date.now(),u=Pt(Pt({},o),{},{eventType:oi.PUBLISH,lts:c,eventElapse:t.eventElapse,elapse:c-r.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:cr.PUBLISH,data:u},!0)}subscribe(e,t,r){let o=this.baseInfoMap.get(e);if(!o)return;let c=o.info,u=Date.now(),h=Pt(Pt({},c),{},{eventType:oi.SUBSCRIBE,lts:u,eventElapse:t.eventElapse,elapse:u-o.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},r&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?h.peerSuid=t.peerid:h.peer=t.peerid,this.send({type:cr.SUBSCRIBE,data:h},!0)}wsCompressorInit(e){var t;let r=[...ys(t=this.baseInfoMap).call(t)],o=r.length?r[0]:"UnableToGetSid",c=this.baseInfoMap.get(o);if(!c)return;let u=c.info,h=Date.now(),m=Pt(Pt({},u),{},{eventType:oi.WS_COMPRESSOR_INIT,lts:h,eventElapse:e.eventElapse,elapse:h-c.startTime,status:e.status?1:2});this.send({type:cr.WS_COMPRESSOR_INIT,data:m},!0)}firstXLAPeerFirstVideoFrame(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let o=r.info,c=Date.now(),u=t.peerPubStatusMs-(r.lastJoinSuccessTime||c),h=Pt(Pt({},o),{},{elapse:c-r.startTime,eventType:oi.XLA_PEER_FIRST_VIDEO_FRAME,lts:c,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:u,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>u?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0,firstReceivedEncodedFrame:t.firstReceivedEncodedFrame?Math.max(t.firstReceivedEncodedFrame-t.joinChannelStart,0):void 0,frameType:t.frameType||"",rtpTimestamp:t.rtpTimestamp||0,framePayloadType:t.framePayloadType||0,frameDataLength:t.frameDataLength||0,mimeType:t.mimeType||""});this.send({type:cr.XLA_PEER_FIRST_VIDEO_FRAME,data:h},!0)}firstRemoteVideoDecode(e,t,r,o){let c=this.baseInfoMap.get(e);if(!c)return;let u=c.info,h=Date.now(),m=Pt(Pt(Pt({},u),o),{},{elapse:h-c.startTime,eventType:t,lts:h,firstDecodeFrame:Math.max((o.firstFrame||h)-c.startTime,0),apEnd:Math.max(o.apEnd-c.startTime,0),apStart:Math.max(o.apStart-c.startTime,0),joinGwEnd:Math.max(o.joinGwEnd-c.startTime,0),joinGwStart:Math.max(o.joinGwStart-c.startTime,0),pcEnd:Math.max(o.pcEnd-c.startTime,0),pcStart:Math.max(o.pcStart-c.startTime,0),subscriberEnd:Math.max(o.subscriberEnd-c.startTime,0),subscriberStart:Math.max(o.subscriberStart-c.startTime,0),videoAddNotify:Math.max(o.videoAddNotify-c.startTime,0)});this.send({type:r,data:m},!0)}firstRemoteFrame(e,t,r,o){let c=this.baseInfoMap.get(e);if(!c)return;let u=c.info,h=Date.now(),m=Pt(Pt(Pt({},u),o),{},{elapse:h-c.startTime,eventType:t,lts:h});this.send({type:r,data:m},!0)}abTest(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let o=r.info,c=Date.now(),u=Pt(Pt(Pt({},o),t),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-r.startTime,eventType:oi.AB_TEST,lts:c});this.send({type:cr.AB_TEST,data:u},!0)}pcStats(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let o=r.info,c=Date.now(),u=Pt(Pt(Pt({},o),t),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-r.startTime,eventType:oi.PC_STATS,lts:c,preallocation:t.preallocation?1:0});this.send({type:cr.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(e,t){if(e){let r=this.baseInfoMap.get(e);if(!r)return;let o=r.info,c=Date.now(),u=Pt(Pt(Pt({},o),t),{},{vid:o.vid===void 0?0:Number(o.vid),eventType:oi.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:cr.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(e,t,r,o){let c=this.baseInfoMap.get(e);if(!c)return;let u=c.info,h=Date.now(),m=Pt(Pt(Pt({},u),o),{},{eventType:t,lts:h});this.send({type:r,data:m},!0)}streamSwitch(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let o=r.info,c=Date.now(),u=Pt(Pt({},o),{},{eventType:oi.STREAM_SWITCH,lts:c,isDual:t.isdual,elapse:c-r.startTime,success:t.succ});this.send({type:cr.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let o=r.info,c=Date.now(),u=Pt(Pt({},o),{},{eventType:oi.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-t.lts,elapse:c-r.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:cr.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let o=r.info,c=Date.now(),u=Pt(Pt({},o),{},{eventType:oi.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-t.lts,elapse:c-r.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:cr.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(e){this.proxyServer=e,e?k.debug("reportProxyServerurl: ".concat(e)):k.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let o=r.info,c=Date.now(),u=Pt(Pt({},o),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:c,elapse:c-r.startTime,joinChannelSuccessElapse:c-(r.lastJoinSuccessTime||c),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:cr.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let o=r.info,c=Date.now();(function(u,h,m){let g=u[h];if(!g||typeof g!="string")return[u];u[h]="";let y=Ju(JSON.stringify(u)),v=0,R=[],b=0;for(let A=0;A<g.length;A++)b+=g.charCodeAt(A)<=127?1:3,b<=m-y||(R[R.length]=Me(Me({},u),{},{[h]:g.substring(v,A)}),v=A,b=g.charCodeAt(A)<=127?1:3);return v!==g.length-1&&(R[R.length]=Me(Me({},u),{},{[h]:g.substring(v)})),R})(Pt(Pt(Pt({},o),t),{},{elapse:c-r.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:cr.WORKER_EVENT,data:u},!0))}apworkerEvent(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let o=r.info,c=Date.now(),u=Pt(Pt(Pt({},o),t),{},{elapse:c-r.startTime,lts:c});this.send({type:cr.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let o=r.info,c=Date.now(),u=Pt(Pt(Pt({},o),t),{},{elapse:c-r.startTime,lts:c,extend:t.extend||void 0});this.send({type:cr.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let o=r.info,c=Date.now(),u=Pt(Pt(Pt({},o),t),{},{elapse:c-r.startTime,lts:c});this.send({type:cr.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>z("CUSTOM_REPORT_LIMIT"))throw new _e(Y.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));let r=Date.now(),o=t.map(c=>({type:cr.USER_ANALYTICS,data:Pt(Pt({sid:e},c),{},{lts:r})}));try{z("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(o):await this.postDataToStatsCollector(o)}catch(c){throw k.error("send custom report message failed",c.toString()),new _e(Y.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(e){let t=z("NOT_REPORT_EVENT");if(e.tag&&ke(t)&&ke(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;let r=this.baseInfoMap.get(e.sid);if(!r)return this.apiInvokeUploadPendingItems.push(e),!1;let{cname:o,uid:c,cid:u}=r.info,h;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof _e){let{code:g,message:y}=e.error;h=g||y||e.error.toString()}else h=e.error.toString();let m={invokeId:e.invokeId,sid:e.sid,cname:o,cid:u,uid:c,lts:e.lts,success:e.success,elapse:e.lts-r.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?h:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:cr.API_INVOKE,data:m},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){let e=this.apiInvokeUploadPendingItems;if(e.length===0)return;let t=Array.from(this.sids).find(r=>r!==null);t&&e.forEach(r=>{r&&(r.sid=t,this.sendApiInvoke(Object.assign({},r)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>z("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){let r=[],o=[];for(;e.length;){let u=e.shift();r.length<20?r.push(u):o.push(u)}e.push(...o);for(let u of[...r]){var c;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),wm(c=this.ltsList).call(c,(h,m)=>h-m))}return t||(this.lastSendNormalEventTime=Date.now()),z("ENABLE_EVENT_REPORT")&&r.length&&(z("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(r):this.postDataToStatsCollector(r)).catch((u=>h=>{z("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>z("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-z("NORMAL_EVENT_QUEUE_CAPACITY")),k.warning("report: drop normal events"))))})(r)),e}async postDataToStatsCollector2(e){Cr.networkState===Gs.OFFLINE&&await ze.race([Cr.onlineWaiter,Ci(2*Kr.maxRetryTimeout)]);let t=c=>{let u=new Uint8Array;return c.forEach(h=>{let m=fk(JSON.stringify(h.data)),g=new ArrayBuffer(5),y=(R=>{let b=0;return Object.entries(cr).forEach(A=>{let[F,M]=A;M===R.type&&(b=xde[F])}),b})(h),v=new DataView(g);v.setUint16(0,m.byteLength,!0),v.setUint8(2,255&y),v.setUint8(3,y>>>8&255),v.setUint8(4,y>>>16&255),u=Z4(u,new Uint8Array(g)),u=Z4(u,m)}),u},r="event",o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(z("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(r):"https://".concat(z("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(r);for(let c=0;c<2;c+=1){c===1&&(o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(z("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(r):"https://".concat(z("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(r));try{await Ck(o,{timeout:1e4,data:t(e),headers:Pt(Pt({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(c===1)throw u;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],r=(m=>{let g=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return g&&g.info.vid&&+g.info.vid||0})(e[0]),o=r?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(m=>JSON.stringify(m)),vid:r,aid:o};Cr.networkState===Gs.OFFLINE&&await ze.race([Cr.onlineWaiter,Ci(2*Kr.maxRetryTimeout)]);let u=t?"/events/proto-raws":"/events/messages",h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(z("EVENT_REPORT_DOMAIN"),"&p=").concat(z("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(z("EVENT_REPORT_DOMAIN"),":").concat(z("STATS_COLLECTOR_PORT")).concat(u));for(let m=0;m<2;m+=1){m===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(z("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(z("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(z("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(z("STATS_COLLECTOR_PORT")).concat(u)));try{t?await yde(h,{timeout:1e4,data:c}):await Ck(h,{timeout:1e4,data:c})}catch(g){if(m===1)throw g;continue}return}}createBaseInfo(e,t){let r=Object.assign({},Dde);return r.sid=e,this.baseInfoMap.set(e,{info:r,startTime:t}),r}reportResourceTiming(e,t){let r=performance.getEntriesByName(e),o=r[r.length-1];o&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:o,tag:Fn.TRACER}).onSuccess()}};I5.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Cr.networkState,tt.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Fn.TRACER}).onSuccess("logUploadError")});let he=class extends _e{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Rr(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,k)}throw(){super.throw(k)}},Ri={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1,supportSuppressLocalAudioPlayback:!1,supportRestrictOwnAudio:!1};function Qt(){return Ri}function N5(){return"setSinkId"in HTMLAudioElement.prototype&&(!z("RESTRICTION_SET_PLAYBACK_DEVICE")||(Zd()||V4())&&!Y4())}function Mb(){return!Ri.supportUnifiedPlan||z("CHROME_FORCE_PLAN_B")&&Xu()}function VT(e){return!(Qn()||F4(87)||Mb()||!z("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||z("FORCE_DISABLE_AUTO_SUB")))}function P5(e){return z("ENABLE_INSTANT_VIDEO")?z("ENABLE_INSTANT_VIDEO"):!(e==null||!e.autoSubscribe||z("FORCE_DISABLE_AUTO_SUB"))}function k5(){return navigator.mediaDevices&&"getSupportedConstraints"in navigator.mediaDevices}function D5(){if(k5()){let e=navigator.mediaDevices.getSupportedConstraints();return!(!("suppressLocalAudioPlayback"in e)||!e.suppressLocalAudioPlayback)}return Bl(141)||_p(141)||Pm(141)}function x5(){if(k5()){let e=navigator.mediaDevices.getSupportedConstraints();return!(!("restrictOwnAudio"in e)||!e.restrictOwnAudio)}return Bl(141)||_p(141)||Pm(125)}let zi=(function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e})({});function LE(e,t,r){return{sampleRate:e,stereo:t,bitrate:r}}function fn(e,t,r,o,c){return{width:e,height:t,frameRate:r,bitrateMin:o,bitrateMax:c}}function zc(e,t,r,o,c){return{width:{max:e},height:{max:t},frameRate:r,bitrateMin:o,bitrateMax:c}}function Mk(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}let Lde={"90p":fn(160,90),"90p_1":fn(160,90),"120p":fn(160,120,15,30,65),"120p_1":fn(160,120,15,30,65),"120p_3":fn(120,120,15,30,50),"120p_4":fn(212,120),"180p":fn(320,180,15,30,140),"180p_1":fn(320,180,15,30,140),"180p_3":fn(180,180,15,30,100),"180p_4":fn(240,180,15,30,120),"240p":fn(320,240,15,40,200),"240p_1":fn(320,240,15,40,200),"240p_3":fn(240,240,15,40,140),"240p_4":fn(424,240,15,40,220),"360p":fn(640,360,15,80,400),"360p_1":fn(640,360,15,80,400),"360p_3":fn(360,360,15,80,260),"360p_4":fn(640,360,30,80,600),"360p_6":fn(360,360,30,80,400),"360p_7":fn(480,360,15,80,320),"360p_8":fn(480,360,30,80,490),"360p_9":fn(640,360,15,80,800),"360p_10":fn(640,360,24,80,800),"360p_11":fn(640,360,24,80,1e3),"480p":fn(640,480,15,100,500),"480p_1":fn(640,480,15,100,500),"480p_2":fn(640,480,30,100,1e3),"480p_3":fn(480,480,15,100,400),"480p_4":fn(640,480,30,100,750),"480p_6":fn(480,480,30,100,600),"480p_8":fn(848,480,15,100,610),"480p_9":fn(848,480,30,100,930),"480p_10":fn(640,480,10,100,400),"720p":fn(1280,720,15,120,1130),"720p_auto":fn(1280,720,30,900,3e3),"720p_1":fn(1280,720,15,120,1130),"720p_2":fn(1280,720,30,120,2e3),"720p_3":fn(1280,720,30,120,1710),"720p_5":fn(960,720,15,120,910),"720p_6":fn(960,720,30,120,1380),"1080p":fn(1920,1080,15,120,2080),"1080p_1":fn(1920,1080,15,120,2080),"1080p_2":fn(1920,1080,30,120,3e3),"1080p_3":fn(1920,1080,30,120,3150),"1080p_5":fn(1920,1080,60,120,4780),"1440p":fn(2560,1440,30,120,4850),"1440p_1":fn(2560,1440,30,120,4850),"1440p_2":fn(2560,1440,60,120,7350),"4k":fn(3840,2160,30,120,8910),"4k_1":fn(3840,2160,30,120,8910),"4k_3":fn(3840,2160,60,120,13500)},Mde={"480p":zc(640,480,5),"480p_1":zc(640,480,5),"480p_2":zc(640,480,30),"480p_3":zc(640,480,15),"720p":zc(1280,720,5),"720p_auto":fn(1280,720,30,900,3e3),"720p_1":zc(1280,720,5),"720p_2":zc(1280,720,30),"720p_3":zc(1280,720,15),"1080p":zc(1920,1080,5),"1080p_1":zc(1920,1080,5),"1080p_2":zc(1920,1080,30),"1080p_3":zc(1920,1080,15)},Ude={"1SL1TL":Mk(1,1),"3SL3TL":Mk(3,3),"2SL3TL":Mk(2,3)};function Kc(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},Lde[e]):e}function Uk(e){return typeof e=="string"?Object.assign({},Mde[e]):e}function Ub(e){return typeof e=="string"?Object.assign({},Ude[e]):e}let Vde={speech_low_quality:LE(16e3,!1),speech_standard:LE(32e3,!1,18),music_standard:LE(48e3,!1),standard_stereo:LE(48e3,!0,56),high_quality:LE(48e3,!1,128),high_quality_stereo:LE(48e3,!0,192)};function Vb(e){return typeof e=="string"?Object.assign({},Vde[e]):e}let jm=[];function L5(e){return zr(e,"mediaSource",["screen","window","application"]),!0}let nt=(function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e})({}),bn=(function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e})({}),ME=(function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e})({}),Fde=(function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e})({}),jde=(function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e})({}),Bm=(function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e})({}),UE=(function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e})({}),Qa=(function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e})({}),VE=(function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e})({}),ga=(function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e})({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});let Vk={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},Fk={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},M5={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Bde={uplinkNetworkQuality:0,downlinkNetworkQuality:0},U5={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},zs=(function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e})({}),_a=(function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e})({}),FT=(function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e})({}),Wm=(function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e})({}),hs=(function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e})({}),$u=(function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e})({}),jk={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370},Fb=(function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e})({});function on(e,t,r,o,c){var u,h,m={};return Object.keys(o).forEach(function(g){m[g]=o[g]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=to(u=zf(h=r.slice()).call(h)).call(u,function(g,y){return y(e,t,g)||g},m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0?(Object.defineProperty(e,t,m),null):m}function pe(e,t,r){return(t=(function(o){var c=(function(u,h){if(typeof u!="object"||!u)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var g=m.call(u,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)})(o);return typeof c=="symbol"?c:c+""})(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function V5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function Xn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?V5(Object(r),!0).forEach(function(o){pe(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V5(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}class F5 extends dr{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(Bm.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,r){super(),pe(this,"trackMediaType",void 0),pe(this,"_ID",void 0),pe(this,"_rtpTransceiver",void 0),pe(this,"_lowRtpTransceiver",void 0),pe(this,"_hints",[]),pe(this,"_isClosed",!1),pe(this,"_originMediaStreamTrack",void 0),pe(this,"mediaStreamTrack",void 0),pe(this,"_external",{}),this._ID=r||In(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,(function(o){ke(jm).call(jm,o)||jm.push(o)})(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||Ep(()=>{var r;tt.reportApiInvoke(null,{name:ar.GET_MEDIA_STREAM_TRACK,options:[],tag:Fn.TRACER}).onSuccess(((r=this._mediaStreamTrack)===null||r===void 0?void 0:r.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===ME.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,(function(t){let r=jm.indexOf(t);r!==-1&&jm.splice(r,1)})(this),this.emit(UE.CLOSED),this.removeAllListeners(Bm.SEI_RECEIVED)}_updateRtpTransceiver(t,r){if(r===ME.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(Bm.TRANSCEIVER_UPDATED,t,r)}}class FE extends F5{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,r){super(t,r),pe(this,"_enabled",!0),pe(this,"_muted",!1),pe(this,"_isExternalTrack",!1),pe(this,"_isClosed",!1),pe(this,"_enabledMutex",void 0),pe(this,"processor",void 0),pe(this,"_processorContext",void 0),pe(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new ki("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,r;return(t=(r=this._originMediaStreamTrack)===null||r===void 0?void 0:r.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,k.debug("[".concat(this.getTrackId(),"] close")),this.emit(nt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,r){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=o,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Gn(this,nt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){k.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(UE.TRACK_ENDED)}stateCheck(t,r){if(k.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(r,"]")),Wc(r,t),this._enabled&&this._muted&&t==="enabled"&&r===!1)throw new _e(Y.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",k);if(!this._enabled&&!this._muted&&t==="muted"&&r===!0)throw new _e(Y.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",k)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():ze.resolve([])}}let j5=window.AudioContext||window.webkitAudioContext,Bk,Ea=null,Mn=new class extends dr{constructor(){super(...arguments),pe(this,"prevState",void 0),pe(this,"curState",void 0),pe(this,"currentTime",void 0),pe(this,"currentTimeStuckAt",void 0),pe(this,"interruptDetectorTrack",void 0),pe(this,"onLocalAudioTrackMute",()=>{k.info("ios15-interruption-start"),this.emit(zi.IOS_15_16_INTERRUPTION_START)}),pe(this,"onLocalAudioTrackUnmute",async()=>{k.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?k.info("ios15-interruption-end-canceled"):(Ea&&await Ea.suspend(),this.emit(zi.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){k.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){k.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function jE(){if(!Ea){if((function(){if(!j5)return void k.error("your browser is not support web audio");k.info("create audio context");let e=Xn({},z("WEBAUDIO_INIT_OPTIONS"));k.debug("audio context init option:",JSON.stringify(e)),Ea=new j5(e),Mn.curState=Ea.state,Ea.onstatechange=()=>{Mn.prevState=Mn.curState,Mn.curState=Ea?Ea.state:void 0;let{prevState:t,curState:r}=Mn,o=r==="running",c=r==="interrupted",u=t==="running",h=t==="suspended",m=t==="interrupted",g=pn().osVersion;(Es()||Bc())&&u&&c&&(k.info("ios".concat(g,"-interruption-start")),Mn.emit(zi.IOS_INTERRUPTION_START)),(Es()||Bc())&&(h||m)&&o&&(k.info("ios".concat(g,"-interruption-end")),Mn.emit(zi.IOS_INTERRUPTION_END)),t!==r&&Mn.emit(zi.STATE_CHANGE,r,t)},setInterval(()=>{var t;let r=(t=Ea)===null||t===void 0?void 0:t.currentTime;Mn.currentTime!==r?(Mn.currentTimeStuckAt&&(k.debug("AudioContext current time resume at ".concat(r)),Mn.currentTimeStuckAt=void 0),Mn.currentTime=r):(r!==Mn.currentTimeStuckAt&&(tt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:r},tag:Fn.TRACER}).onSuccess(),k.warning("AudioContext current time stuck at ".concat(r))),Mn.currentTimeStuckAt=r)},5e3),(async function(t){let r=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],o,c,u=!1,h=!1,m=!1;function g(K){t.state==="running"?y(!1):Es()||Bc()?t.state==="suspended"&&(y(!0),K&&t.resume().then(v,v)):t.state!=="closed"&&(y(!0),K&&t.resume().then(v,v))}function y(K){if(u!==K){u=K;for(let q=0,Q=r;q<Q.length;q+=1){let se=Q[q];K?window.addEventListener(se,R,{capture:!0,passive:!0}):window.removeEventListener(se,R,{capture:!0,passive:!0})}}}function v(){g(!1)}function R(){g(!0)}function b(){let K;try{K=o.play(),K?K.then(M,M):(o.addEventListener("playing",M),o.addEventListener("abort",M),o.addEventListener("error",M))}catch{M()}}function A(K){m||(o.paused?K?(F(!1),m=!0,b()):F(!0):F(!1))}function F(K){if(h!==K){h=K;for(let q=0,Q=r;q<Q.length;q++){let se=Q[q];K?window.addEventListener(se,j,{capture:!0,passive:!0}):window.removeEventListener(se,j,{capture:!0,passive:!0})}}}function M(){o.removeEventListener("playing",M),o.removeEventListener("abort",M),o.removeEventListener("error",M),m=!1,A(!1)}function j(){A(!0)}if(Es()&&z("IOS_BG_TAG")){let K=t.createMediaStreamDestination(),q=document.createElement("div");q.innerHTML="<audio x-webkit-airplay='deny'></audio>",o=q.children.item(0),o.controls=!1,o.disableRemotePlayback=!0,o.preload="auto",o.srcObject=K.stream,c=()=>{if(z("IOS_AUTO_RESTART_BG_TAG")&&o&&o.srcObject&&!m&&(!o.paused||h!==!0)){o.paused||o.pause();try{m=!0,b()}catch{m=!1}return!0}},A(!0)}return Mn.on(zi.STATE_CHANGE,function(){g(!0)}),g(!1),c})(Ea).then(t=>{Bk=t})})(),!Ea)throw new _e(Y.NOT_SUPPORTED,"can not create audio context");return Ea}return Ea}function Gm(e){if((function(){if(Wk!==null)return Wk;let o=jE(),c=o.createBufferSource(),u=o.createGain(),h=o.createGain();c.connect(u),c.connect(h),c.disconnect(u);let m=!1;try{c.disconnect(u)}catch{m=!0}return c.disconnect(),Wk=m,m})())return;let t=e.connect,r=e.disconnect;e.connect=(o,c,u)=>{var h;return e._inputNodes||(e._inputNodes=[]),ke(h=e._inputNodes).call(h,o)||(o instanceof AudioNode?(e._inputNodes.push(o),t.call(e,o,c,u)):t.call(e,o,c)),e},e.disconnect=(o,c,u)=>{r.call(e),o?bb(e._inputNodes,o):e._inputNodes=[];for(let h of e._inputNodes)t.call(e,h)}}let Wk=null;function Gk(e,t){let r=!1,o=1/t;if(z("DISABLE_WEBAUDIO")){let c=window.setInterval(()=>{r?window.clearInterval(c):e(performance.now()/1e3)},1e3*o)}else{let c=jE(),u=c.createGain();u.gain.value=0,u.connect(c.destination);let h=()=>{if(r)return void(u=null);let m=c.createOscillator();m.onended=h,m.connect(u),m.start(0),m.stop(c.currentTime+o),e(c.currentTime)};h()}return()=>{r=!0}}class B5{constructor(){pe(this,"context",void 0),pe(this,"analyserNode",void 0),pe(this,"sourceNode",void 0),this.context=jE(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Es()||Bc()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;let t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{let o=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(o);for(let c=0;c<t.length;++c)t[c]=o[c]/128-1}let r=to(t).call(t,(o,c)=>o+c*c,0)/t.length;return Math.max(10*Math.log10(r)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,r;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(r=this.sourceNode)===null||r===void 0||r.connect(this.analyserNode)}catch{k.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class W5 extends dr{get processSourceNode(){return this.sourceNode}set processedNode(t){var r;if(!this.isDestroyed&&this._processedNode!==t){try{var o;(o=this.sourceNode)===null||o===void 0||o.disconnect(this.outputNode)}catch{}(r=this._processedNode)===null||r===void 0||r.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),pe(this,"outputNode",void 0),pe(this,"outputTrack",void 0),pe(this,"isPlayed",!1),pe(this,"sourceNode",void 0),pe(this,"context",void 0),pe(this,"audioBufferNode",void 0),pe(this,"destNode",void 0),pe(this,"audioOutputLevel",0),pe(this,"volumeLevelAnalyser",void 0),pe(this,"_processedNode",void 0),pe(this,"playNode",void 0),pe(this,"isDestroyed",!1),pe(this,"onNoAudioInput",void 0),pe(this,"isNoAudioInput",!1),pe(this,"_noAudioInputCount",0),this.context=jE(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Gm(this.outputNode),this.volumeLevelAnalyser=new B5}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=r=>{this.emit(ga.ON_AUDIO_BUFFER,(function(o){for(let c=0;c<o.outputBuffer.numberOfChannels;c+=1){let u=o.outputBuffer.getChannelData(c);for(let h=0;h<u.length;h+=1)u[h]=0}return o.inputBuffer})(r))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Qt().webAudioMediaStreamDest)throw new _e(Y.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&Ib(()=>{Mn.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Es()||Bc()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();let r=this.volumeLevelAnalyser.getAnalyserNode(),o;r.getFloatTimeDomainData?(o=new Float32Array(r.fftSize),r.getFloatTimeDomainData(o)):(o=new Uint8Array(r.fftSize),r.getByteTimeDomainData(o));let c=!1;for(let u=0;u<o.length;u++)o[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await Ci(200),await this.checkHasAudioInput(t?t+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,r;(t=this.processedNode)===null||t===void 0||t.disconnect(),(r=this.sourceNode)===null||r===void 0||r.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class Hk extends W5{get isFreeze(){return!1}constructor(t,r,o){var c;if(super(),pe(this,"sourceNode",void 0),pe(this,"track",void 0),pe(this,"clonedTrack",void 0),pe(this,"audioElement",void 0),pe(this,"isCurrentTrackCloned",!1),pe(this,"isRemoteTrack",!1),pe(this,"originVolumeLevelAnalyser",void 0),pe(this,"rebuildWebAudio",async()=>{if(k.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void k.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>k.info("resume success")),k.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();let m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;let g=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(g),Gm(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();let y=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(y,this.context.currentTime),Gm(this.outputNode),this.emit(ga.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=g,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new _e(Y.UNEXPECTED_ERROR);this.track=t;let u=new MediaStream([this.track]);if(this.isRemoteTrack=!!r,this.sourceNode=this.context.createMediaStreamSource(u),Gm(this.sourceNode),o){let m=o.clone();m.enabled=!0,this.clonedTrack=m,k.debug("create an unmuted track ".concat(m.id," from the original track ").concat(o.id," to get the volume"));let g=this.context.createMediaStreamSource(new MediaStream([m]));Gm(g),this.originVolumeLevelAnalyser=new B5,this.originVolumeLevelAnalyser.updateSource(g)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;let h=pn();r&&h.os===wi.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(Mn.on(zi.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;let r=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(r),Gm(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(ga.UPDATE_SOURCE),this.audioElement.srcObject=r}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),Mn.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){let r=t.clone();r.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=r),k.debug("create an unmuted track ".concat(r.id," from the original track ").concat(t.id," to get the volume"));let o=this.context.createMediaStreamSource(new MediaStream([r]));Gm(o),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(o)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function G5(e,t,r){let o=(u,h)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||h:u:h,c={audio:!!r&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:o(t.height,1080),maxWidth:o(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(c.video.mandatory.maxFrameRate=t.frameRate.max,c.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(c.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function Wde(e,t){let r=await H5(e.mediaSource),{sourceId:o,audio:c}=await(function(u){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new ze((m,g)=>{let y=document.createElement("div");y.innerText="share screen",y.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");let v=document.createElement("div");v.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");let R=document.createElement("div");R.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",R.setAttribute("style","height: 12%;");let b=document.createElement("div");b.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");let A=document.createElement("div");A.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");let F=document.createElement("button");F.innerHTML="cancel",F.setAttribute("style","width: 85px;"),F.onclick=()=>{document.body.removeChild(K);let q=new Error("NotAllowedError");q.name="NotAllowedError",g(q)};let M=h,j=document.createElement("div");if(h){let q=document.createElement("input");q.setAttribute("type","checkbox");let Q=document.createElement("span");q.setAttribute("style","margin-right: 6px;"),Q.innerText="Share audio",q.checked=M,q.onchange=()=>{M=q.checked},j.appendChild(q),j.appendChild(Q)}A.appendChild(j),A.appendChild(F),v.appendChild(R),v.appendChild(b),v.appendChild(A);let K=document.createElement("div");K.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),K.appendChild(y),K.appendChild(v),document.body.appendChild(K),u.map(q=>{if(q.id){let Q=document.createElement("div");Q.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let se=q.thumbnail;try{let{width:oe}=se.getSize();oe>1920&&(se=se.resize({width:1920}))}catch(oe){throw oe&&oe.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),oe}Q.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+se.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+q.name.replace(/[\u00A0-\u9999<>\&]/g,function(oe){return"&#"+oe.charCodeAt(0)+";"})+"</span>",Q.onclick=()=>{document.body.removeChild(K),m({sourceId:q.id,audio:M})},b.appendChild(Q)}})})})(r,t);return await G5(o,e,c)}async function H5(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);let r=e5();if(!r)throw console.error("failed to fetch electron, please mount it to window"),new _e(Y.ELECTRON_IS_NULL);let o=null;try{var c;o=((c=r.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:t}))||r.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{o=null}o&&o.then||(o=new ze((u,h)=>{r.desktopCapturer.getSources({types:t},(m,g)=>{m?h(m):u(g)})}));try{return await o}catch(u){throw new _e(Y.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}let zk=new ki("safari"),z5=!1,K5=!1;async function ya(e,t){let r=0,o=null;for(;r<2;)try{o=await Gde(e,t,r>0);break}catch(c){if(c instanceof _e)throw k.error("[".concat(t,"] ").concat(c.toString())),c;let u=jb(c.name||c.code||c,c.message);if(u.code===Y.MEDIA_OPTION_INVALID){k.debug("[".concat(t,"] detect media option invalid, retry")),r+=1,await Ci(500);continue}throw k.error("[".concat(t,"] ").concat(u.toString())),u}if(!o)throw new _e(Y.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return o}async function Gde(e,t,r){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new _e(Y.NOT_SUPPORTED,"can not find getUserMedia");r&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));let o=Qt(),c=new MediaStream;if(e.audioSource&&c.addTrack(e.audioSource),e.videoSource&&c.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return k.debug("Using Video Source/ Audio Source"),c;if(e.screen)if(e5())e.screen.sourceId?BE(c,await G5(e.screen.sourceId,e.screen,!!e.screenAudio)):BE(c,await Wde(e.screen,!!e.screenAudio));else if(Zd()&&e.screen.extensionId&&e.screen.mandatory){if(!o.getStreamFromExtension)throw new _e(Y.NOT_SUPPORTED,"This browser does not support screen sharing");k.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));let b=await(h=e.screen.extensionId,m=t,new ze((A,F)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},M=>{if(!M||!M.streamId)return k.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),M),void F(new _e(Y.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));A(M.streamId)})}catch(M){k.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),M.toString()),F(new _e(Y.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=b,BE(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(o.getDisplayMedia){var u;e.screen.mediaSource&&L5(e.screen.mediaSource);let b={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(u=e.screen.displaySurface)!==null&&u!==void 0?u:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:A,surfaceSwitching:F,systemAudio:M,preferCurrentTab:j,windowAudio:K,monitorTypeSurfaces:q}=e.screen,Q={selfBrowserSurface:A,surfaceSwitching:F,systemAudio:M,preferCurrentTab:j,windowAudio:K,monitorTypeSurfaces:q};!A&&delete Q.selfBrowserSurface,!F&&delete Q.surfaceSwitching,!M&&delete Q.systemAudio,!j&&delete Q.preferCurrentTab,!K&&delete Q.windowAudio,!q&&delete Q.monitorTypeSurfaces,k.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:b,audio:e.screenAudio,controls:Q})),BE(c,await navigator.mediaDevices.getDisplayMedia(Xn({video:b,audio:e.screenAudio},Q)))}else{if(!Qn())throw k.error("[".concat(t,"] This browser does not support screenSharing")),new _e(Y.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&L5(e.screen.mediaSource);let b={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};k.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(b))),BE(c,await navigator.mediaDevices.getUserMedia(b))}}var h,m;if(!e.video&&!e.audio)return c;let g={video:e.video,audio:e.audio},y=z("MEDIA_DEVICE_CONSTRAINTS");if(y)try{typeof y=="string"&&(y=JSON.parse(y)),g=yk(g,y)}catch{}k.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(g)),pn();let v,R=null;(Pi()||Es()||Rb())&&(R=await zk.lock());try{v=await navigator.mediaDevices.getUserMedia(g)}catch(b){throw R&&R(),b}return g.audio&&(z5=!0),g.video&&(K5=!0),BE(c,v),R&&R(),c}function jb(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new _e(Y.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new _e(Y.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new _e(Y.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new _e(Y.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new _e(Y.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new _e(Y.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return k.error("getUserMedia unexpected error",e),new _e(Y.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function BE(e,t){let r=e.getVideoTracks()[0],o=e.getAudioTracks()[0],c=t.getVideoTracks()[0],u=t.getAudioTracks()[0];u&&(o&&e.removeTrack(o),e.addTrack(u)),c&&(r&&e.removeTrack(r),e.addTrack(c))}let va=new class extends dr{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Wm.STATE_CHANGE,e),this._state=e)}constructor(){super(),pe(this,"_state",FT.IDLE),pe(this,"isAccessMicrophonePermission",!1),pe(this,"isAccessCameraPermission",!1),pe(this,"lastAccessMicrophonePermission",!1),pe(this,"lastAccessCameraPermission",!1),pe(this,"checkdeviceMatched",!1),pe(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(z("ENUMERATE_DEVICES_INTERVAL")||(NT()||Cb()===wi.HARMONY_OS)&&Xu())&&this.updateDevicesInfo()},z("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>k.error(e.toString()))}async enumerateDevices(e,t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new _e(Y.NOT_SUPPORTED,"enumerateDevices() not supported.");let o=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(o),u=!this.isAccessMicrophonePermission&&e,h=!this.isAccessCameraPermission&&t;c.audio&&(u=!1),c.video&&(h=!1);let m=null,g=null,y=null;if(!r&&(u||h)){if(zk.isLocked&&(k.debug("[device manager] wait GUM lock"),(await zk.lock())(),k.debug("[device manager] GUM unlock")),z5&&(u=!1,this.isAccessMicrophonePermission=!0),K5&&(h=!1,this.isAccessCameraPermission=!0),k.debug("[device manager] check media device permissions",e,t,u,h),u&&h){try{y=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(v){let R=jb(v.name||v.code||v,v.message);if(R.code===Y.PERMISSION_DENIED)throw R;k.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{m=await navigator.mediaDevices.getUserMedia({audio:e})}catch(v){let R=jb(v.name||v.code||v,v.message);if(R.code===Y.PERMISSION_DENIED)throw R;k.warning("getUserMedia failed in getDevices",R)}this.isAccessMicrophonePermission=!0}else if(h){try{g=await navigator.mediaDevices.getUserMedia({video:t})}catch(v){let R=jb(v.name||v.code||v,v.message);if(R.code===Y.PERMISSION_DENIED)throw R;k.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0}k.debug("[device manager] mic permission",e,"cam permission",t)}try{let v=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(R=>R.stop()),g&&g.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),m=null,g=null,y=null,v}catch(v){return m&&m.getTracks().forEach(R=>R.stop()),g&&g.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),m=null,g=null,y=null,new _e(Y.ENUMERATE_DEVICES_FAILED,v.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(r=>{r.device.label===e&&(t=r.device.deviceId)}),t}async getDeviceById(e){let t=(await this.enumerateDevices(!0,!0,!0)).find(r=>r.deviceId===e);if(!t)throw new _e(Y.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=FT.INITING;try{await this.updateDevicesInfo(),this.state=FT.INITEND}catch(e){throw this.state=FT.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")?(k.warning("Device Detection functionality cannot start properly.",e.toString()),e):new _e(Y.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.")}}async updateDevicesInfo(){let e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),r=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;let c=e.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),u=e.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&u?u.groupId===c.groupId?k.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is the same group")):k.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is not the same group")):k.debug("[device-check] default input or output not found")}let o=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(c=>{if(!c.deviceId)return;let u=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){let h={initAt:t,updateAt:t,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),r.push(h)}u&&(u.updateAt=t)}),this.deviceInfoMap.forEach((c,u)=>{c.state==="ACTIVE"&&c.updateAt!==t&&(c.state="INACTIVE",r.push(c))}),this.state!==FT.INITEND)return o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));r.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Wm.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Wm.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Wm.PLAYOUT_DEVICE_CHANGED,c)}}),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){let t=e.filter(c=>c.kind==="audioinput"),r=e.filter(c=>c.kind==="videoinput"),o={audio:!1,video:!1};for(let c of t)if(c.label&&c.deviceId){o.audio=!0;break}for(let c of r)if(c.label&&c.deviceId){o.video=!0;break}return o}},Kk=!1,lo=new class extends dr{constructor(){super(...arguments),pe(this,"onAutoplayFailed",void 0),pe(this,"onAudioAutoplayFailed",void 0)}};function Y5(){if(Kk)return z("FLS_AUTOPLAY_EMITS")?(lo.onAutoplayFailed&&lo.onAutoplayFailed(),lo.emit("autoplay-failed")):void 0;{let e=t=>{t.preventDefault(),Kk=!1,PT()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};Kk=!0,PT()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),k.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),lo.onAutoplayFailed?lo.onAutoplayFailed():lo.onAudioAutoplayFailed?k.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):k.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),lo.emit("autoplay-failed")}}function q5(e,t,r,o){if(!e)return;let c=tt.getBaseInfoBySessionId(e);if(!c)return;let u=c.info,h=Date.now(),m=Xn(Xn({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:h,elapse:h-c.startTime,cbRegistered:lo.onAutoplayFailed||lo.onAudioAutoplayFailed?1:-1,errorMsg:r,mediaType:t,trackId:o,extend:void 0});tt.send({type:cr.AUTOPLAY_FAILED,data:m},!0)}let Hde=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Ps=new class{constructor(){pe(this,"onAutoplayFailed",void 0),pe(this,"elementMap",new Map),pe(this,"elementStateMap",new Map),pe(this,"elementsNeedToResume",[]),pe(this,"sinkIdMap",new Map),pe(this,"autoResumeAfterInterruption",e=>ze.all(Array.from(this.elementMap.entries()).map(async t=>{let[r,o]=t,c=this.elementStateMap.get(r),u=o.srcObject.getAudioTracks()[0],h=u&&u.readyState;if(k.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(e)),h==="live"){if(e)return o.pause(),o.play();if(Mn.curState==="running")return IE()?(o.pause(),o.play()):c&&c==="paused"?o.play():void 0}}))),pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,r]=e,o=r.srcObject.getAudioTracks()[0];o&&o.readyState==="live"&&(k.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),r.pause(),r.play())})}),this.autoResumeAudioElement(),Mn.on(zi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Mn.on(zi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Mn.on(zi.STATE_CHANGE,()=>{Es()&&Mn.prevState==="suspended"&&Mn.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){let r=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),r)try{await r.setSinkId(t)}catch(o){throw new _e(Y.PERMISSION_DENIED,"can not set sink id: "+o.toString())}}play(e,t,r,o){if(this.elementMap.has(t))return;let c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,c),this.elementMap.set(t,c),this.elementStateMap.set(t,hs.INIT),this.setVolume(t,r);let u=this.sinkIdMap.get(t);if(u)try{c.setSinkId(u).catch(m=>{k.warning("[".concat(t,"] set sink id failed"),m.toString())})}catch(m){k.warning("[".concat(t,"] set sink id failed"),m.toString())}let h=c.play();h&&h.then&&h.catch(m=>{o&&q5(o,"audio",m.message,t),k.warning("audio element play warning",m.toString()),this.elementMap.has(t)&&m.name==="NotAllowedError"&&(k.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),Ib(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),Y5()}))})}updateTrack(e,t){let r=this.elementMap.get(e);r&&(r.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){let r=this.elementMap.get(e);r&&(t=Math.max(0,Math.min(100,t)),r.volume=t/100)}getVolume(e){let t=this.elementMap.get(e);return t?t.volume:0}stop(e){let t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;let r=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(r,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){Hde.forEach(r=>{t.addEventListener(r,o=>{let c=this.elementStateMap.get(e),u=o.type==="pause"?"paused":o.type;if(k.debug("[".concat(e,"] audio-element-status change ").concat(c," => ").concat(u)),o.type==="error"){let h=t?.error;h&&k.error("[".concat(e,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(e,u)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){let e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(r=>{k.debug("Auto resume audio element success")}).catch(r=>{k.warning("Auto resume audio element failed!",r)})}),this.elementsNeedToResume=[]};new ze(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{PT()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Or(){return function(e,t,r){let o=r.value;return typeof o=="function"&&(r.value=function(){this._isClosed&&new _e(Y.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",k);for(var c=arguments.length,u=new Array(c),h=0;h<c;h++)u[h]=arguments[h];let m=o.apply(this,u);return m instanceof ze?new ze((g,y)=>{m.then(g).catch(y)}):m}),r}}class X5 extends dr{constructor(t){super(),pe(this,"name","VideoProcessorDestination"),pe(this,"ID","0"),pe(this,"_source",void 0),pe(this,"videoContext",void 0),pe(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new _e(Y.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new _e(Y.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(zs.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(zs.ON_TRACK,void 0)}}class J5 extends dr{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,r){super(),pe(this,"constraintsMap",new Map),pe(this,"statsRegistry",[]),pe(this,"usageRegistry",[]),pe(this,"trackId",void 0),pe(this,"direction",void 0),pe(this,"_chained",!1),this.trackId=t,this.direction=r}async getConstraints(){return await ei(this,_a.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,r){var o;return k.info("processor ".concat(r.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(r,t),Gn(this,_a.REQUEST_UPDATE_CONSTRAINTS,Array.from(Yo(o=this.constraintsMap).call(o)))}async requestRevertConstraints(t){var r;if(this.constraintsMap.has(t))return k.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),Gn(this,_a.REQUEST_UPDATE_CONSTRAINTS,Array.from(Yo(r=this.constraintsMap).call(r)))}registerStats(t,r,o){this.statsRegistry.find(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:r,cb:o})}unregisterStats(t,r){let o=this.statsRegistry.findIndex(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){let t=[];for(let{processorID:r,processorName:o,type:c,cb:u}of this.statsRegistry)try{let h=u();t.push({processorID:r,processorName:o,type:c,stats:h})}catch(h){k.error(new _e(Y.UNEXPECTED_ERROR,h.message))}return t}registerUsage(t,r){this.usageRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:r})}unregisterUsage(t){let r=this.usageRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name);r!==-1&&this.usageRegistry.splice(r,1)}async gatherUsage(){let t=[];if(!this.chained)return[];for(let{cb:r}of this.usageRegistry)try{let o=r();o instanceof ze&&(o=await o),t.push(Xn(Xn({},o),{},{direction:this.direction}))}catch(o){k.error("gather extension usage error",o)}return t}getDirection(){return this.direction}}class $5 extends dr{constructor(t){super(),pe(this,"name","AudioProcessorDestination"),pe(this,"ID","0"),pe(this,"inputTrack",void 0),pe(this,"inputNode",void 0),pe(this,"audioProcessorContext",void 0),pe(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new _e(Y.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new _e(Y.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(zs.ON_TRACK,void 0),this.emit(zs.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(zs.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(zs.ON_NODE,this.inputNode))}}class Q5 extends dr{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,r,o){super(),pe(this,"constraintsMap",new Map),pe(this,"statsRegistry",[]),pe(this,"audioContext",void 0),pe(this,"trackId",void 0),pe(this,"direction",void 0),pe(this,"usageRegistry",[]),pe(this,"_chained",!1),this.audioContext=t,this.trackId=r,this.direction=o}async getConstraints(){return ei(this,_a.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,r){var o;return k.info("processor ".concat(r.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(r,t),Gn(this,_a.REQUEST_UPDATE_CONSTRAINTS,Array.from(Yo(o=this.constraintsMap).call(o)))}async requestRevertConstraints(t){var r;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),Gn(this,_a.REQUEST_UPDATE_CONSTRAINTS,Array.from(Yo(r=this.constraintsMap).call(r)))}registerStats(t,r,o){this.statsRegistry.find(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:r,cb:o})}unregisterStats(t,r){let o=this.statsRegistry.findIndex(c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){let t=[];for(let{processorID:r,processorName:o,type:c,cb:u}of this.statsRegistry)try{let h=u();t.push({processorID:r,processorName:o,type:c,stats:h})}catch(h){k.error(new _e(Y.UNEXPECTED_ERROR,h.message))}return t}registerUsage(t,r){this.usageRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:r})}unregisterUsage(t){let r=this.usageRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name);r!==-1&&this.usageRegistry.splice(r,1)}async gatherUsage(){let t=[];if(!this.chained)return[];for(let{cb:r}of this.usageRegistry)try{let o=r();o instanceof ze&&(o=await o),t.push(Xn(Xn({},o),{},{direction:this.direction}))}catch(o){k.error("gather extension usage error",o)}return t}getDirection(){return this.direction}}class Yk extends dr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),pe(this,"context",void 0),pe(this,"processSourceNode",void 0),pe(this,"outputTrack",void 0),pe(this,"processedNode",void 0),pe(this,"clonedTrack",void 0),pe(this,"outputNode",void 0),this.outputNode=new zde}setVolume(){}createOutputTrack(){throw new _e(Y.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class zde{disconnect(){}connect(){}}function Z5(e){return new ze((t,r)=>{let o=!1,c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);let u=Es()?"canplay":"playing";c.addEventListener(u,()=>{let h=c.videoWidth,m=c.videoHeight;!h&&Qn()||(o=!0,c.srcObject=null,c.remove(),t([h,m]))}),c.srcObject=new MediaStream([e]),c.play().catch(xT),setTimeout(()=>{o||(c.srcObject=null,c.remove(),t([c.videoWidth,c.videoHeight]))},4e3)})}function Bb(e){let t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});let r=Kc(e.encoderConfig);return r.width!=null&&(t.width=r.width),r.height!=null&&(t.height=r.height),!K4()&&r.frameRate&&(t.frameRate=r.frameRate),V4()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Qn()&&(t.frameRate={ideal:30,max:30}),t}function e6(e){let t={};return K4()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,Zd()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function t6(e){let t=e6(e);if(e.encoderConfig){let r=Vb(e.encoderConfig);t.channelCount=r.stereo?2:1,t.sampleRate=r.sampleRate,t.sampleSize=r.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),NT()&&(t.sampleRate=void 0),t}let n6=e=>{let t=e._encoderConfig;if(!t)return;let{frameRate:r,width:o,height:c}=e.getMediaStreamTrackSettings(),{frameRate:u=r,width:h=o,height:m=c}=t;if(!u||!h||!m)return;h=NE(h),m=NE(m),u=NE(u);let{max:g,min:y}=(function(A,F,M){let j=200*Math.pow(M/15,.6)*Math.pow(A*F/640/360,.75);return{min:Math.floor(j),max:Math.floor(4*j)}})(h,m,u),{bitrateMax:v,bitrateMin:R}=t||{};v||k.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(m,", fps: ").concat(u,"] => [brMax: ").concat(v,", brMin: ").concat(R,"]"));let{maxFramerate:b}=z("ENCODER_CONFIG_LIMIT");return b&&typeof b=="number"&&(u=Math.min(u,b)),{frameRate:u,bitrateMax:v||g,bitrateMin:R||y,scaleResolutionDownBy:1,scale:0}},r6=async(e,t,r)=>await(async(o,c,u)=>{let h=(function(y){let v=[];for(let R=0;R<y.length;R+=2)v.push(parseInt(y.slice(R,R+2),16));return Uint8Array.from(v)})(h5(""+c+u)).slice(0,16),m=h.slice(0,12),g=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},g,o))})(e.buffer,t,r),qk=e=>{let t=document.createElement("canvas");return t.width=2,t.height=2,new ze((r,o)=>{t.toBlob(async c=>{if(t.remove(),c){let u=await i6(c);r({buffer:u,width:t.width,height:t.height})}else o(new _e(Y.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},i6=async e=>{let t=await e.arrayBuffer();return new Uint8Array(t)};var s6,o6,a6,c6,l6,u6,d6,h6,p6,f6,m6,g6,_6,E6,y6,v6,S6,T6,yr,w6,C6,R6,b6,I6,A6,Qu,O6,N6,P6,k6,D6,x6,L6,M6,U6,V6,F6,j6,B6,rs;let Nr=(s6=gt({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),o6=gt({argsMap:(e,t)=>[e.getTrackId(),t]}),a6=Or(),c6=PE("LocalAudioTrack","_enabledMutex"),l6=gt({argsMap:(e,t)=>[e.getTrackId(),t]}),u6=Or(),d6=PE("LocalAudioTrack","_enabledMutex"),h6=gt({argsMap:(e,t)=>[e.getTrackId(),t]}),p6=Or(),f6=Or(),m6=Or(),g6=gt({argsMap:e=>[e.getTrackId()]}),_6=Or(),E6=gt({argsMap:e=>[e.getTrackId()]}),y6=Or(),v6=gt({argsMap:e=>[e.getTrackId()]}),S6=gt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),T6=gt({argsMap:e=>[e.getTrackId()]}),on((yr=class extends FE{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Ps.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,r,o){super(e,r),pe(this,"trackMediaType",VE.AUDIO),pe(this,"_encoderConfig",void 0),pe(this,"_trackSource",void 0),pe(this,"metadata",[]),pe(this,"_enabled",!0),pe(this,"_volume",100),pe(this,"_useAudioElement",!0),pe(this,"_bypassWebAudio",!1),pe(this,"processor",void 0),pe(this,"_processorContext",void 0),pe(this,"_processorDestination",void 0),pe(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!o,this._trackSource=new Yk,z("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),z("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Pi()&&!Ea?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){Vn(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Ps.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void k.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,Gn(this,nt.NEED_REPLACE_TRACK,this).then(()=>{k.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(r=>{k.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),r)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!N5())throw new _e(Y.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ps.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,r){return this._setEnabled(e,t,r)}async _setEnabled(e,t,r){if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{r||(this._enabled=!0),await Gn(this,nt.NEED_ENABLE_TRACK,this),k.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(o){throw r||(this._enabled=!1),k.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}}else{this._originMediaStreamTrack.enabled=!1,r||(this._enabled=!1);try{await Gn(this,nt.NEED_DISABLE_TRACK,this)}catch(o){throw r||(this._enabled=!0),k.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,k.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Gn(this,nt.NEED_MUTE_TRACK,this):await Gn(this,nt.NEED_UNMUTE_TRACK,this))}getStats(){return Ep(()=>{k.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Jo(this,nt.GET_STATS)||Xn({},Vk)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(ga.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(ga.ON_AUDIO_BUFFER),this._source.on(ga.ON_AUDIO_BUFFER,r=>e(r))}play(){k.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(k.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Ps.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){k.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Ps.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];k.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ps.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Gn(this,nt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return ze.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new _e(Y.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new _e(Y.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(zs.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await Gn(this,nt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Gn(this,nt.NEED_REPLACE_TRACK,this))}),e.on(zs.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(zs.ON_TRACK),e.removeAllListeners(zs.ON_NODE)}bindProcessorContextEvents(e){e.on(_a.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(_a.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof Yk&&(this._trackSource=new Hk(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){let e=new Q5(this._source.context,this.getTrackId(),"local"),t=new $5(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(ga.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Ps.stop(this.getTrackId()),this._source.play()),Gn(this,nt.NEED_REPLACE_MIXING_TRACK,this).then(()=>{k.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(r=>{k.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),r)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[s6],Object.getOwnPropertyDescriptor(yr.prototype,"setVolume"),yr.prototype),on(yr.prototype,"setPlaybackDevice",[o6,a6],Object.getOwnPropertyDescriptor(yr.prototype,"setPlaybackDevice"),yr.prototype),on(yr.prototype,"setEnabled",[c6,l6,u6],Object.getOwnPropertyDescriptor(yr.prototype,"setEnabled"),yr.prototype),on(yr.prototype,"setMuted",[d6,h6,p6],Object.getOwnPropertyDescriptor(yr.prototype,"setMuted"),yr.prototype),on(yr.prototype,"getStats",[f6],Object.getOwnPropertyDescriptor(yr.prototype,"getStats"),yr.prototype),on(yr.prototype,"setAudioFrameCallback",[m6],Object.getOwnPropertyDescriptor(yr.prototype,"setAudioFrameCallback"),yr.prototype),on(yr.prototype,"play",[g6,_6],Object.getOwnPropertyDescriptor(yr.prototype,"play"),yr.prototype),on(yr.prototype,"stop",[E6,y6],Object.getOwnPropertyDescriptor(yr.prototype,"stop"),yr.prototype),on(yr.prototype,"close",[v6],Object.getOwnPropertyDescriptor(yr.prototype,"close"),yr.prototype),on(yr.prototype,"pipe",[S6],Object.getOwnPropertyDescriptor(yr.prototype,"pipe"),yr.prototype),on(yr.prototype,"unpipe",[T6],Object.getOwnPropertyDescriptor(yr.prototype,"unpipe"),yr.prototype),yr),jT=(w6=gt({argsMap:(e,t)=>[e.getTrackId(),t]}),C6=Or(),R6=PE("MicrophoneAudioTrack","_enabledMutex"),b6=gt({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),I6=Or(),A6=gt({argsMap:e=>[e.getTrackId()]}),on((Qu=class extends Nr{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,r,o){super(e,t.encoderConfig?Vb(t.encoderConfig):{},o,z("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),pe(this,"_config",void 0),pe(this,"_deviceName","default"),pe(this,"_constraints",void 0),pe(this,"_originalConstraints",void 0),pe(this,"_enabled",!0),this._config=t,this._constraints=r,this._originalConstraints=r,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(IE()||dk())&&Mn.bindInterruptDetectorTrack(this)}async setDevice(e){if(k.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{let t=await va.getDeviceById(e),r={};r.audio=Xn({},this._constraints),r.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let o=null;try{o=await ya(r,this.getTrackId())}catch(c){throw k.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),o=await ya({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{let t=await va.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}k.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,r){if(t)return k.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),e),z("AUTO_RESET_AUDIO_ROUTE")&&(Es()||Bc())){let h=navigator.audioSession;h&&(e||(h.type="playback"),h.type="auto")}if(!e){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),r||(this._enabled=!1);try{await Gn(this,nt.NEED_DISABLE_TRACK,this)}catch(h){throw k.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}let c=Xn({},this._constraints),u=va.searchDeviceIdByName(this._deviceName);u&&!c.deviceId&&(c.deviceId=u);try{r||(this._enabled=!0);let h=await ya({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await Gn(this,nt.NEED_ENABLE_TRACK,this)}catch(h){throw r||(this._enabled=!1),k.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}k.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(IE()||dk())&&Mn.unbindInterruptDetectorTrack(this),jm.some(e=>(function(t){return"__className__"in t&&t.__className__==="MicrophoneAudioTrack"})(e))||Bk&&Bk()&&(tt.reportApiInvoke(null,{name:"BG_AUDIO_TAG_RESTART",options:{},tag:Fn.TRACER}).onSuccess(),k.debug("restart background audio tag success"))}onTrackEnded(){if((Es()||Bc())&&this._enabled&&!this._isClosed&&Mn.duringInterruption){let e=async()=>{Mn.off(zi.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(k.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Mn.on(zi.IOS_INTERRUPTION_END,e)}else k.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(UE.TRACK_ENDED)}async renewMediaStreamTrack(e){let t=e||this._constraints,r=va.searchDeviceIdByName(this._deviceName);if(r&&!t.deviceId&&(t.deviceId=r),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();let o=await ya({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(_a.REQUEST_UPDATE_CONSTRAINTS,async(t,r,o)=>{try{let c=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(c),r()}catch(c){o(c)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(_a.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[w6,C6],Object.getOwnPropertyDescriptor(Qu.prototype,"setDevice"),Qu.prototype),on(Qu.prototype,"setEnabled",[R6,b6,I6],Object.getOwnPropertyDescriptor(Qu.prototype,"setEnabled"),Qu.prototype),on(Qu.prototype,"close",[A6],Object.getOwnPropertyDescriptor(Qu.prototype,"close"),Qu.prototype),Qu),Kde=(O6=gt({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),N6=Or(),P6=gt({argsMap:e=>[e.getTrackId()]}),k6=Or(),D6=gt({argsMap:e=>[e.getTrackId()]}),x6=Or(),L6=gt({argsMap:e=>[e.getTrackId()]}),M6=Or(),U6=gt({argsMap:e=>[e.getTrackId()]}),V6=Or(),F6=gt({argsMap:e=>[e.getTrackId()]}),j6=gt({argsMap:e=>[e.getTrackId()]}),B6=Or(),on((rs=class extends Nr{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,r,o){super(t.createOutputTrack(),r,o),pe(this,"source",void 0),pe(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(ga.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(UE.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){Vn(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[O6,N6],Object.getOwnPropertyDescriptor(rs.prototype,"startProcessAudioBuffer"),rs.prototype),on(rs.prototype,"pauseProcessAudioBuffer",[P6,k6],Object.getOwnPropertyDescriptor(rs.prototype,"pauseProcessAudioBuffer"),rs.prototype),on(rs.prototype,"seekAudioBuffer",[D6,x6],Object.getOwnPropertyDescriptor(rs.prototype,"seekAudioBuffer"),rs.prototype),on(rs.prototype,"resumeProcessAudioBuffer",[L6,M6],Object.getOwnPropertyDescriptor(rs.prototype,"resumeProcessAudioBuffer"),rs.prototype),on(rs.prototype,"stopProcessAudioBuffer",[U6,V6],Object.getOwnPropertyDescriptor(rs.prototype,"stopProcessAudioBuffer"),rs.prototype),on(rs.prototype,"close",[F6],Object.getOwnPropertyDescriptor(rs.prototype,"close"),rs.prototype),on(rs.prototype,"setAudioBufferPlaybackSpeed",[j6,B6],Object.getOwnPropertyDescriptor(rs.prototype,"setAudioBufferPlaybackSpeed"),rs.prototype),rs);class ai extends Nr{get __className__(){return"MixingAudioTrack"}get isActive(){for(let t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){let t=jE().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,In(8,"track-mix-")),pe(this,"trackList",void 0),pe(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(k.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):k.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){k.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}bb(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){let t={};this.trackList.forEach(r=>{r._encoderConfig&&((r._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=r._encoderConfig.bitrate),(r._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=r._encoderConfig.sampleRate),(r._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=r._encoderConfig.sampleSize),r._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(r=>{r instanceof ai?r.emit(Bm.TRANSCEIVER_UPDATED,t):r._updateRtpTransceiver(t)}))}}class Yde extends W5{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(ga.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),pe(this,"audioBuffer",void 0),pe(this,"sourceNode",void 0),pe(this,"startPlayTime",0),pe(this,"startPlayOffset",0),pe(this,"pausePlayTime",0),pe(this,"options",void 0),pe(this,"currentLoopCount",0),pe(this,"currentPlaybackSpeed",100),pe(this,"_currentState","stopped"),this.audioBuffer=t,this.options=r,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):k.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){let t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}let W6=new Map;function G6(e,t){if(e.length===0||t.length===0)return 1/0;let r=Sk(e),o=Sk(t);return Math.floor(o/r)}class Xk{get rendFrameRate(){let t=Math.max(1,G6(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:hs.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(k.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var r;t!==this._videoState&&(this._videoState=t,(r=this.onVideoStateChanged)===null||r===void 0||r.call(this,this.videoState))}constructor(t){pe(this,"trackId",void 0),pe(this,"config",void 0),pe(this,"onFirstVideoFrameDecoded",void 0),pe(this,"onFirstVideoFrameRender",void 0),pe(this,"onVideoBufferReady",void 0),pe(this,"onVideoStateChanged",void 0),pe(this,"freezeTimeCounterList",[]),pe(this,"renderFreezeAccTime",0),pe(this,"renderFreezeAccTime2",0),pe(this,"isKeepLastFrame",!1),pe(this,"isDestroyed",!1),pe(this,"timeUpdatedCount",0),pe(this,"freezeTime",0),pe(this,"playbackTime",0),pe(this,"lastTimeUpdatedTime",0),pe(this,"autoplayFailed",!1),pe(this,"videoTrack",void 0),pe(this,"videoElement",void 0),pe(this,"cacheVideoElement",void 0),pe(this,"cancelRVFId",void 0),pe(this,"internal",!1),pe(this,"_render_interframe_delays",[]),pe(this,"_render_interframe_delays_sizes",[]),pe(this,"_videoState",$u.VideoStateStopped),pe(this,"videoElementCheckInterval",void 0),pe(this,"videoElementFreezeTimeout",void 0),pe(this,"_videoElementStatus",hs.NONE),pe(this,"_isInPage",!0),pe(this,"isGettingVideoDimensions",!1),pe(this,"startGetVideoDimensions",()=>{let r=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return k.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(r,500)};!this.isGettingVideoDimensions&&r()}),pe(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Mn.curState==="running"&&(k.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(M4())),H4()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),pe(this,"handleVideoEvents",r=>{switch(r.type){case"play":case"playing":r.type==="play"&&k.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=hs.PLAYING;break;case"loadeddata":if(this.videoState=$u.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=hs.CANPLAY;break;case"stalled":this.videoElementStatus=hs.STALLED;break;case"suspend":this.videoElementStatus=hs.SUSPEND;break;case"pause":this.videoElementStatus=hs.PAUSED,Es()||Bc()||Pi()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(k.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=hs.WAITING;break;case"abort":this.videoElementStatus=hs.ABORT;break;case"ended":this.videoElementStatus=hs.ENDED;break;case"emptied":this.videoElementStatus=hs.EMPTIED;break;case"error":{let o=this.videoElement.error;o&&(this.videoElementStatus=hs.ERROR,k.error("[".concat(this.trackId,"] media error: ").concat(o.message," (").concat(o.code,")")));break}case"timeupdate":{let o=performance.now();if(this.timeUpdatedCount+=1,this.onVideoBufferReady&&this.timeUpdatedCount>z("BUFFER_READY_FRAMES")&&this.onVideoBufferReady(),this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=o);let c=o-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=o,$o.lastVisibleTime<$o.lastHiddenTime||u<$o.lastHiddenTime||u<$o.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(c>z("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;let h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(k.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(M4())),H4()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),Mn.on(zi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Mn.on(zi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){let r=this.videoElement.play();r&&r.catch&&r.catch(c=>{t&&q5(t,"video",c.message,this.trackId),c.name==="NotAllowedError"?(k.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):k.warning("[".concat(this.trackId,"] play warning: "),c)});let o=pn();if((o.name==="Safari"&&Number(o.version)===15||IE())&&r&&r.then){let c=()=>{this.config.mirror&&!this.config.noStyle&&(this.videoElement.style.transform="rotateY(180deg)")};r.then(c).catch(c)}}getCurrentFrame(){let t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;let r=t.getContext("2d");if(!r)return k.error("create canvas context failed!"),new ImageData(2,2);r.drawImage(this.videoElement,0,0,t.width,t.height);let o=r.getImageData(0,0,t.width,t.height);return t.remove(),o}async getCurrentFrameToUint8Array(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,o=document.createElement("canvas");o.width=this.videoElement.videoWidth,o.height=this.videoElement.videoHeight;let c=o.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,o.width,o.height),new ze((u,h)=>{o.toBlob(async m=>{if(o.remove(),m){let g=await i6(m);u({buffer:g,width:o.width,height:o.height})}else h(new _e(Y.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,r<0?.1:r>1?1:r)})):await qk(t)}destroy(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.isDestroyed=!0,Mn.off(zi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Mn.off(zi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),t?this.videoElement.pause():this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=$u.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=hs.INIT,!this.videoElementCheckInterval&&(H6.forEach(u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=(function(u){return u!==document.body&&document.body.contains(u)})(this.videoElement)},1e3),z("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,r;let u,h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(m,z("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===$u.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=$u.VideoStateFrozen:document.addEventListener("visibilitychange",h))},g=(y,v)=>{if(this.videoElementStatus===hs.PLAYING){if(u){let A=v.presentationTime-u.presentationTime,F=v.presentedFrames-u.presentedFrames;this._render_interframe_delays_sizes.push(F),this._render_interframe_delays.push(A);let M=Sk(this._render_interframe_delays_sizes),j=M-this._render_interframe_delays_sizes[0];if(M>30&&j>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===$u.VideoStateStarting&&(this.videoState=$u.VideoStateDecoding),this.videoState===$u.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,z("VIDEO_FREEZE_DURATION"))),A<z("VIDEO_FREEZE_DURATION")&&this.videoState===$u.VideoStateFrozen&&(this.videoState=$u.VideoStateDecoding),A>z("VIDEO_FREEZE_DURATION")&&$o.lastVisibleTime>=$o.lastHiddenTime&&u.timestamp>$o.lastVisibleTime&&u.timestamp>$o.lastHiddenTime){let K=Math.min(66,G6(this._render_interframe_delays_sizes,this._render_interframe_delays)),q=Math.max(0,A-(F-1)*K);this.renderFreezeAccTime2+=q>K?q:0,this.renderFreezeAccTime+=A}}u=Xn(Xn({},v),{},{timestamp:y})}else this.isSkipCalcRenderFreezeTime()&&(u=Xn(Xn({},v),{},{timestamp:y}));var R,b;z("ENABLE_VIDEO_FRAME_CALLBACK")&&(this.cancelRVFId=(R=(b=this.videoElement).requestVideoFrameCallback)===null||R===void 0?void 0:R.call(b,g))};this.cancelRVFId=(t=(r=this.videoElement).requestVideoFrameCallback)===null||t===void 0?void 0:t.call(r,g)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),NT()&&!z("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");let o=pn();this.config.noStyle||(o.name==="Safari"&&Number(o.version)===15||IE()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover"),this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Qn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Qn()&&this.videoElement.load());let c=this.videoElement.play();c!==void 0&&c.catch(u=>{k.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())})}resetVideoElement(){var t,r;H6.forEach(o=>{this.videoElement&&this.videoElement.removeEventListener(o,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.cancelRVFId&&this.videoElement&&((t=(r=this.videoElement).cancelVideoFrameCallback)===null||t===void 0||t.call(r,this.cancelRVFId),this.cancelRVFId=void 0),this.videoElementStatus=hs.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===hs.DESTROYED||this.internal}handleAutoPlayFailed(){let t=r=>{r.preventDefault(),this.videoElement.play().then(()=>{k.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(o=>{k.error(o)}),this.autoplayFailed=!1,PT()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};PT()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),Y5()}}let H6=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Wb extends Xk{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),pe(this,"container",void 0),pe(this,"slot",void 0),this.slot=t.element,this.internal=r,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;let r=t.element;var o;!this.internal||this.slot?(r!==this.slot&&(this.destroy(),this.slot=r),this.createElements()):(this.slot=r,r&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(o=this.slot)===null||o===void 0||o.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var r;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,o):await qk(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",z("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var z6,K6,Y6,q6,X6,J6,$6,Q6,Z6,eW,tW,nW,rW,iW,sW,oW,aW,cW,lW,uW,dW,hW,pW,fW,mW,gW,_W,EW,Zt,yW,vW,SW,TW,wW,CW,RW,bW,Sa;let jn=(z6=gt({argsMap:(e,t,r)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),K6=Or(),Y6=gt({argsMap:e=>[e.getTrackId()]}),q6=PE("LocalVideoTrack","_enabledMutex"),X6=gt({argsMap:(e,t)=>[e.getTrackId(),t]}),J6=Or(),$6=PE("LocalVideoTrack","_enabledMutex"),Q6=gt({argsMap:(e,t)=>[e.getTrackId(),t]}),Z6=Or(),eW=gt({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),tW=Or(),nW=gt({argsMap:(e,t)=>[e.getTrackId(),t]}),rW=Or(),iW=Or(),sW=gt({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),oW=Or(),aW=Or(),cW=Or(),lW=gt({argsMap:e=>[e.getTrackId()]}),uW=Or(),dW=Or(),hW=Or(),pW=Or(),fW=Or(),mW=gt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),gW=gt({argsMap:e=>[e.getTrackId()]}),_W=gt({argsMap:e=>[e.getTrackId()]}),EW=gt({argsMap:(e,t,r)=>[e.getTrackId(),t.label,r]}),Zt=class Wne extends FE{get videoHeight(){if(Pi()){let{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(Pi()){let{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==hs.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,r,o,c,u,h){if(super(t,u),pe(this,"trackMediaType",VE.VIDEO),pe(this,"_player",void 0),pe(this,"isUseScaleResolutionDownBy",!1),pe(this,"_videoVisibleTimer",null),pe(this,"_previousVideoVisibleStatus",void 0),pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),pe(this,"_encoderConfig",void 0),pe(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),pe(this,"_optimizationMode",void 0),pe(this,"_saveEncodeBitrateRatio",1),pe(this,"_videoHeight",void 0),pe(this,"_videoWidth",void 0),pe(this,"_forceBitrateLimit",void 0),pe(this,"_enabled",!0),pe(this,"_processorDestination",void 0),pe(this,"_processorContext",void 0),Pi()){let{width:m,height:g}=t.getSettings();this._videoWidth=m,this._videoHeight=g}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=o,this._optimizationMode=c,this._hints=h||[],r&&this._hints.indexOf(bn.CUSTOM_TRACK)!==-1?this._encoderConfig=Zn(r):this._encoderConfig=r,this._hints.indexOf(bn.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(ck(_n.CHROME,115)&&Cb().indexOf("Windows")!==-1){let m=(function(g,y){if("VideoFrame"in window&&"TransformStream"in window&&Qt().supportWebRTCInsertableStream){let v=new MediaStreamTrackProcessor(g),R=new MediaStreamTrackGenerator({kind:"video"}),b,A,F=Date.now(),M=()=>{j&&(clearInterval(j),j=void 0),b&&(b.close(),b=void 0),g.stop(),A=void 0,R.removeEventListener("ended",M)},j=window.setInterval(()=>{if(A&&b&&Date.now()-F>1e3)try{R.readyState==="live"?A.enqueue(b.clone()):M()}catch{M()}},1e3),K=new TransformStream({transform:(q,Q)=>{R.readyState==="live"?(A=Q,F=Date.now(),b===void 0?(b=q,Q.enqueue(q.clone())):(Q.enqueue(b),b=q)):q.close()}});return R.addEventListener("ended",M),v.readable.pipeThrough(K).pipeTo(R.writable),R}})(t);m&&(k.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}r&&this._hints.indexOf(bn.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(r),this._processorContext=new J5(this.getTrackId(),"local"),this._processorDestination=new X5(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){let c=document.getElementById(t);c?t=c:(k.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}k.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));let o=Xn(Xn(Xn({},this._getDefaultPlayerConfig()),r),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(o):(t instanceof HTMLVideoElement?this._player=new Xk(o):this._player=new Wb(o),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let c=this.getVideoElementVisibleStatus();this.safeEmit(UE.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},z("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,k.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await Gn(this,nt.NEED_DISABLE_TRACK,this)}catch(o){throw k.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}return r||(this._enabled=!1),void k.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Gn(this,nt.NEED_ENABLE_TRACK,this)}catch(o){throw k.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}k.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,k.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await Gn(this,nt.NEED_MUTE_TRACK,this):await Gn(this,nt.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),k.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await Gn(this,nt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(k)}}}async setEncoderConfiguration(t,r){if(!this._enabled)throw new _e(Y.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=Kc(t),z("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){let o=Bb({encoderConfig:t});(Pi()||Es()||Bc())&&(o.deviceId=void 0),k.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(c){let u=new _e(Y.UNEXPECTED_ERROR,c.toString());throw k.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=t,this._hints.indexOf(bn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Gn(this,nt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(k)}}getStats(){return Ep(()=>{k.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Jo(this,nt.GET_STATS)||Xn({},Fk)}async setBeautyEffect(t){k.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,r):await qk(t)}async findClosestProfile(){let{width:t,height:r,frameRate:o}=this.getMediaStreamTrackSettings(),{width:c,height:u,frameRate:h}=this._encoderConfig||{},m=NE(this._videoWidth||t||c||0),g=NE(this._videoHeight||r||u||0),y=(function(v,R,b){if(!Array.isArray(z("VIDEO_ENCODER_CONFIG_LIST"))||z("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;let A=Math.min(v,R);return!(A>=480)&&Xn(Xn({},z("VIDEO_ENCODER_CONFIG_LIST").find(F=>F.height>A)),{},{frameRate:b})})(m,g,NE(o||h||15));if(y)return k.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(m,"x").concat(g," => ").concat(JSON.stringify(y))),this.setEncoderConfiguration(y)}async setBitrateLimit(t){k.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void k.error(Y.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");let r=this._optimizationMode;try{this._optimizationMode=t,await Gn(this,nt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(o){throw this._optimizationMode=r,k.error("[".concat(this.getTrackId(),"] set optimization mode failed"),o.toString()),o}k.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return k.error(Y.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,k.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){Z5(this._originMediaStreamTrack).then(t=>{let[r,o]=t;this._videoHeight=o,this._videoWidth=r}).catch(xT)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new _e(Y.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");k.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=Kc(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(bn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Gn(this,nt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(k)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;let{width:t,height:r,frameRate:o}=this.getMediaStreamTrackSettings();if(!t||!r||!o)return;let{bitrateMax:c,bitrateMin:u}=this._encoderConfig;if(u==null||c==null){let{max:h,min:m}=(function(g,y,v,R,b){let A=z("BITRATE_ADAPTER_TYPE");if(A==="DEFAULT_BITRATE")return{min:R,max:b};if(b===void 0){let F=Math.floor(200*Math.pow(v/15,.6)*Math.pow(g*y/640/360,.75));b=A==="STANDARD_BITRATE"?4*F:2*F,R=R??F}else R=R??Math.floor(b/10);return{min:R,max:b}})(t,r,o,u,c);if(this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=h,z("VIDEO_STANDARD_BITRATE_VERSION")&&u==null&&c==null){let[g,y]=(function(v,R,b){let A=4*Math.floor(2e5*Math.pow(b/15,.6)*Math.pow(v*R/230400,.75)),F=v*R,M=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),j=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]),K=Yo(M).call(M).next().value,q=1;if(M.has(F))K=M.get(F);else{var Q;let Qe=wm(Q=Array.from(M.entries())).call(Q,(Xt,Lt)=>{let[jt]=Xt,[En]=Lt;return jt-En}),ot=Qe.find(Xt=>{let[Lt]=Xt;return Lt>F});if(ot){let Xt=Qe.indexOf(ot);if(Xt>0){let Lt=Qe[Xt-1],jt=(F-Lt[0])/(ot[0]-Lt[0]);K=Lt[1]+jt*(ot[1]-Lt[1])}else K=ot[1]}else K=Qe[Qe.length-1][1]}if(j.has(F))q=j.get(F);else{var se;let Qe=wm(se=Array.from(j.entries())).call(se,(Xt,Lt)=>{let[jt]=Xt,[En]=Lt;return jt-En}),ot=Qe.find(Xt=>{let[Lt]=Xt;return Lt>F});if(ot){let Xt=Qe.indexOf(ot);if(Xt>0){let Lt=Qe[Xt-1],jt=(F-Lt[0])/(ot[0]-Lt[0]);q=Lt[1]+jt*(ot[1]-Lt[1])}else q=ot[1]}else q=Qe[Qe.length-1][1]}let oe=z("VIDEO_NEW_BITRATE_RATIO");oe&&oe>0&&(K=oe/100);let te=Math.floor(A*K),de=Math.floor(65e4*Math.pow(v*R/230400,.5)*Math.pow(b/15,.69)),Ce=te,Pe=z("VIDEO_STANDARD_BITRATE_VERSION");return Pe&&Pe>0&&(Pe===1?Ce=A:Pe===2?Ce=te:Pe===3&&(Ce=de)),[Math.floor(Ce/1e3),q]})(t,r,o);this._encoderConfig.bitrateMax=g,this._encoderConfig.bitrateMin=m?Math.min(m,g):g,this._saveEncodeBitrateRatio=y,k.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(r,", fps: ").concat(o,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else k.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(r,", fps: ").concat(o,"] => [brMax: ").concat(h,", brMin: ").concat(m,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,r;let o=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),c={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:o?.parentElement},{element:u,slot:h}=c;if(this.isPlaying&&u instanceof HTMLVideoElement&&h instanceof HTMLElement){let m=Q4.checkOneElementVisible(u),g=Object.assign({},m);if(g.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=g.visible;let y=tt.reportApiInvoke(null,{tag:Fn.TRACER,name:ar.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});g.visible?y.onSuccess("Video is visible"):y.onSuccess("Invisible because of ".concat(g.reason))}return g}return}catch(o){throw new _e(Y.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new _e(Y.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;let t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;t&&(o=Xn(Xn({},o),Kc(t))),o=Lm(o);let c=In(8,"track-video-cloned-"),u=new Wne(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,o,Lm(this._scalabilityMode),this._optimizationMode,c,Lm(this._hints));return t&&o&&u.setEncoderConfiguration(o),k.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(r)),u}async replaceTrack(t,r){if(!(t instanceof MediaStreamTrack))throw new _e(Y.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new _e(Y.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,r,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(Ep(()=>{tt.reportApiInvoke(null,{name:ar.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Fn.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!z("ENABLE_VIDEO_SEI")||!z("ENABLE_ENCODED_TRANSFORM"))return void k.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new _e(Y.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();let r=this.getRTCRtpTransceiver();if(!r)return void k.warning("Video track is not published, SEI can not be send");let o=r.sender.getParameters();if(o.codecs.length===0)return;let c=o.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"||c==="video/h265"?this.safeEmit("sei-to-send",t):k.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(zs.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await Gn(this,nt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Gn(this,nt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(zs.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(_a.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(_a.REQUEST_CONSTRAINTS)}},on(Zt.prototype,"play",[z6,K6],Object.getOwnPropertyDescriptor(Zt.prototype,"play"),Zt.prototype),on(Zt.prototype,"stop",[Y6],Object.getOwnPropertyDescriptor(Zt.prototype,"stop"),Zt.prototype),on(Zt.prototype,"setEnabled",[q6,X6,J6],Object.getOwnPropertyDescriptor(Zt.prototype,"setEnabled"),Zt.prototype),on(Zt.prototype,"setMuted",[$6,Q6,Z6],Object.getOwnPropertyDescriptor(Zt.prototype,"setMuted"),Zt.prototype),on(Zt.prototype,"setSaveEncodeBitrateRatio",[eW,tW],Object.getOwnPropertyDescriptor(Zt.prototype,"setSaveEncodeBitrateRatio"),Zt.prototype),on(Zt.prototype,"setEncoderConfiguration",[nW,rW],Object.getOwnPropertyDescriptor(Zt.prototype,"setEncoderConfiguration"),Zt.prototype),on(Zt.prototype,"getStats",[iW],Object.getOwnPropertyDescriptor(Zt.prototype,"getStats"),Zt.prototype),on(Zt.prototype,"setBeautyEffect",[sW,oW],Object.getOwnPropertyDescriptor(Zt.prototype,"setBeautyEffect"),Zt.prototype),on(Zt.prototype,"getCurrentFrameData",[aW],Object.getOwnPropertyDescriptor(Zt.prototype,"getCurrentFrameData"),Zt.prototype),on(Zt.prototype,"getCurrentFrameImage",[cW],Object.getOwnPropertyDescriptor(Zt.prototype,"getCurrentFrameImage"),Zt.prototype),on(Zt.prototype,"findClosestProfile",[lW,uW],Object.getOwnPropertyDescriptor(Zt.prototype,"findClosestProfile"),Zt.prototype),on(Zt.prototype,"setBitrateLimit",[dW],Object.getOwnPropertyDescriptor(Zt.prototype,"setBitrateLimit"),Zt.prototype),on(Zt.prototype,"setOptimizationMode",[hW],Object.getOwnPropertyDescriptor(Zt.prototype,"setOptimizationMode"),Zt.prototype),on(Zt.prototype,"setScalabiltyMode",[pW],Object.getOwnPropertyDescriptor(Zt.prototype,"setScalabiltyMode"),Zt.prototype),on(Zt.prototype,"updateMediaStreamTrackResolution",[fW],Object.getOwnPropertyDescriptor(Zt.prototype,"updateMediaStreamTrackResolution"),Zt.prototype),on(Zt.prototype,"pipe",[mW],Object.getOwnPropertyDescriptor(Zt.prototype,"pipe"),Zt.prototype),on(Zt.prototype,"unpipe",[gW],Object.getOwnPropertyDescriptor(Zt.prototype,"unpipe"),Zt.prototype),on(Zt.prototype,"close",[_W],Object.getOwnPropertyDescriptor(Zt.prototype,"close"),Zt.prototype),on(Zt.prototype,"replaceTrack",[EW],Object.getOwnPropertyDescriptor(Zt.prototype,"replaceTrack"),Zt.prototype),Zt),Gb=(yW=gt({argsMap:(e,t)=>[e.getTrackId(),t]}),vW=Or(),SW=PE("CameraVideoTrack","_enabledMutex"),TW=gt({argsMap:(e,t)=>[e.getTrackId(),t]}),wW=Or(),CW=gt({argsMap:(e,t)=>[e.getTrackId(),t]}),RW=Or(),bW=gt({argsMap:e=>[e.getTrackId()]}),Sa=class Gne extends jn{get __className__(){return"CameraVideoTrack"}constructor(t,r,o,c,u,h){super(t,Kc(r.encoderConfig),c,u,h),pe(this,"_config",void 0),pe(this,"_originalConstraints",void 0),pe(this,"_constraints",void 0),pe(this,"_enabled",!0),pe(this,"_deviceName","default"),pe(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(IE()||dk())&&!(function(){let m=pn();if(m.os!==wi.IOS||!m.osVersion)return!1;let g=m.osVersion.split(".");return Number(g[0])===15&&Number(g[1])>=2})()&&z4()&&this._enabled&&!this._isClosed&&(k.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=r,this._originalConstraints=o,this._constraints=o,this._deviceName=t.label,this._encoderConfig=Kc(this._config.encoderConfig),Mn.on(zi.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Mn.on(zi.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(k.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{let r=await va.getDeviceById(t),o={};o.video=Xn({},this._constraints),o.video.deviceId={exact:t},o.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await ya(o,this.getTrackId())}catch(u){throw k.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),c=await ya({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=r.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(r){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{let r=await va.getDeviceById(t);this._deviceName=r.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(r){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}k.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){k.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));let r={video:Xn(Xn({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let o=null;try{o=await ya(r,this.getTrackId())}catch(c){throw k.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),o=await ya({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=Xn({},r.video),k.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{let o=await ya({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1)}await Gn(this,nt.NEED_ENABLE_TRACK,this)}catch(o){throw k.error("[".concat(this.getTrackId(),"] setEnabled true error"),o.toString()),o}this.updateMediaStreamTrackResolution(),k.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),r||(this._enabled=!1);try{await Gn(this,nt.NEED_DISABLE_TRACK,this)}catch(o){throw k.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}k.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,r){if(!this._enabled)throw new _e(Y.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=Kc(t),z("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);let o=Zn(this._config);o.encoderConfig=t;let c=Bb(o);(Pi()||Es()||Bc())&&(c.deviceId=void 0),k.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(u){let h=new _e(Y.UNEXPECTED_ERROR,u.toString());throw k.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=o,this._constraints=c,this._originalConstraints=c,this._encoderConfig=t,this._hints.indexOf(bn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Gn(this,nt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw(k)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Es()||Bc())&&this._enabled&&!this._isClosed&&Mn.duringInterruption){let t=async()=>{Mn.off(zi.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(k.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Mn.on(zi.IOS_INTERRUPTION_END,t)}else k.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(UE.TRACK_ENDED)}async renewMediaStreamTrack(t){let r=t||this._constraints,o=va.searchDeviceIdByName(this._deviceName);if(o&&!r.deviceId&&(r.deviceId={exact:o}),this._enabled){let c=await ya({video:r},this.getTrackId());this._constraints=r,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Mn.off(zi.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Mn.off(zi.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;t&&(o=Xn(Xn({},o),Kc(t))),o=Lm(o);let c=In(8,"track-cam-cloned-"),u=new Gne(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,Lm(Xn(Xn({},this._config),{},{encoderConfig:o})),Lm(this._constraints),Lm(this._scalabilityMode),this._optimizationMode,c);return t&&o&&u.setEncoderConfiguration(o),k.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(r)),u}bindProcessorContextEvents(){this.processorContext.on(_a.REQUEST_UPDATE_CONSTRAINTS,async(t,r,o)=>{try{let c=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(c),r()}catch(c){o(c)}}),this.processorContext.on(_a.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},on(Sa.prototype,"setDevice",[yW,vW],Object.getOwnPropertyDescriptor(Sa.prototype,"setDevice"),Sa.prototype),on(Sa.prototype,"setEnabled",[SW,TW,wW],Object.getOwnPropertyDescriptor(Sa.prototype,"setEnabled"),Sa.prototype),on(Sa.prototype,"setEncoderConfiguration",[CW,RW],Object.getOwnPropertyDescriptor(Sa.prototype,"setEncoderConfiguration"),Sa.prototype),on(Sa.prototype,"close",[bW],Object.getOwnPropertyDescriptor(Sa.prototype,"close"),Sa.prototype),Sa);function IW(e){let t=In(8,"track-cus-"),r=tt.reportApiInvoke(null,{id:t,tag:Fn.TRACER,name:ar.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),o=new Nr(e.mediaStreamTrack,e.encoderConfig?Vb(e.encoderConfig):{},t,!1);return k.info("create custom audio track success with config",e,"trackId",o.getTrackId()),r.onSuccess(o.getTrackId()),o}function Jk(e,t,r,o){r.optimizationMode&&(o&&o.width&&o.height?(r.encoderConfig=Xn(Xn({},o),{},{bitrateMin:o.bitrateMin,bitrateMax:o.bitrateMax}),r.optimizationMode!=="motion"&&r.optimizationMode!=="detail"||(t.contentHint=r.optimizationMode,t.contentHint===r.optimizationMode?k.debug("[".concat(e,"] set content hint to"),r.optimizationMode):k.debug("[".concat(e,"] set content hint failed")))):k.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var AW,OW,NW,PW,Za,kW,DW,xW,LW,MW,UW,VW,is;class FW extends F5{getUserId(){return this._userId}constructor(t,r,o,c){super(t,"track-".concat(t.kind,"-").concat(r,"-").concat(c.clientId,"_").concat(In(5,""))),pe(this,"_userId",void 0),pe(this,"_uintId",void 0),pe(this,"_isDestroyed",!1),pe(this,"store",void 0),pe(this,"processor",void 0),pe(this,"processorContext",void 0),this._userId=r,this._uintId=o,this.store=c}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,k.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let WE=(AW=gt({argsMap:(e,t,r)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),OW=gt({argsMap:e=>[e.getTrackId()]}),NW=gt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),PW=gt({argsMap:e=>[e.getTrackId()]}),on((Za=class extends FW{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==hs.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,r,o,c){super(e,t,r,o),pe(this,"_videoVisibleTimer",null),pe(this,"_previousVideoVisibleStatus",void 0),pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),pe(this,"trackMediaType",VE.VIDEO),pe(this,"_videoWidth",void 0),pe(this,"_videoHeight",void 0),pe(this,"_player",void 0),pe(this,"_prePlayer",void 0),pe(this,"processorDestination",void 0),pe(this,"processorContext",void 0),this._prePlayer=c,this.updateMediaStreamTrackResolution(),this.processorContext=new J5(this.getTrackId(),"remote"),this.processorDestination=new X5(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Ep(()=>{k.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Jo(this,nt.GET_STATS)||Xn({},U5)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(Qa.PLAY_START),typeof e=="string"){let o=document.getElementById(e);o?e=o:(k.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}k.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));let r=Xn(Xn({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(r);else{let o=!1,c=!1;e instanceof HTMLVideoElement?(this._player=new Xk(r),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,c=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,o=this._player.videoState>0,this._player.updateConfig(r)):this._player=new Wb(r),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Qa.FIRST_FRAME_DECODED),c&&this.safeEmit(Qa.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=u=>{this.safeEmit(Qa.VIDEO_STATE_CHANGED,u)},o&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let o=this.getVideoElementVisibleStatus();this.safeEmit(Qa.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},z("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(Qa.PLAY_END)}stop(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(e),this._player=void 0,k.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){Z5(this._originMediaStreamTrack).then(e=>{let[t,r]=e;this._videoHeight=r,this._videoWidth=t}).catch(xT)}_updatePlayerSource(){k.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;let r=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),o={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:r?.parentElement},{element:c,slot:u}=o;if(this.isPlaying&&c instanceof HTMLVideoElement&&u instanceof HTMLElement){let h=Q4.checkOneElementVisible(c),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;let g=tt.reportApiInvoke(null,{tag:Fn.TRACER,name:ar.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?g.onSuccess("Video is visible"):g.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(r){throw new _e(Y.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new _e(Y.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(zs.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(zs.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Bm.SEI_RECEIVED,e)}}).prototype,"play",[AW],Object.getOwnPropertyDescriptor(Za.prototype,"play"),Za.prototype),on(Za.prototype,"stop",[OW],Object.getOwnPropertyDescriptor(Za.prototype,"stop"),Za.prototype),on(Za.prototype,"pipe",[NW],Object.getOwnPropertyDescriptor(Za.prototype,"pipe"),Za.prototype),on(Za.prototype,"unpipe",[PW],Object.getOwnPropertyDescriptor(Za.prototype,"unpipe"),Za.prototype),Za),GE=(kW=gt({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),DW=gt({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),xW=gt({argsMap:(e,t)=>[e.getTrackId(),t]}),LW=gt({argsMap:e=>[e.getTrackId()]}),MW=gt({argsMap:e=>[e.getTrackId()]}),UW=gt({argsMap:(e,t)=>[e.getTrackId(),t.name]}),VW=gt({argsMap:e=>[e.getTrackId()]}),on((is=class extends FW{get isPlaying(){return this._useAudioElement?Ps.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,r,o){super(e,t,r,o),pe(this,"trackMediaType",VE.AUDIO),pe(this,"_source",void 0),pe(this,"_useAudioElement",!0),pe(this,"_volume",100),pe(this,"processorContext",void 0),pe(this,"processorDestination",void 0),pe(this,"_played",!1),pe(this,"_bypassWebAudio",!1),z("DISABLE_WEBAUDIO")?(this._source=new Yk,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new Hk(e,!0),z("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(ga.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Qa.FIRST_FRAME_DECODED)}),this.processorContext=new Q5(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new $5(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(ga.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(ga.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(ga.ON_AUDIO_BUFFER),this._source.on(ga.ON_AUDIO_BUFFER,r=>e(r))}setVolume(e){this._volume=e,this._useAudioElement?Ps.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}setAmplifiedVolume(e){this._useAudioElement&&this._played&&(Ps.stop(this.getTrackId()),this._source.play()),this._useAudioElement=!1,e=Math.min(e,z("MAX_WEBAUDIO_VOLUME")),this._volume=e,this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!N5())throw new _e(Y.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ps.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getVolume(){return this._useAudioElement?Ps.getVolume(this.getTrackId()):this._source instanceof Hk?this._source.getAudioVolume():0}getStats(){return Ep(()=>{k.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Jo(this,nt.GET_STATS)||Xn({},M5)}play(){k.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(k.debug("[".concat(this.getTrackId(),"] use audio element to play")),Ps.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):(k.debug("[".concat(this.getTrackId(),"] use audio context to play")),this._source.play())}stop(){k.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Ps.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];k.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ps.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new _e(Y.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new _e(Y.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new _e(Y.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(zs.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(zs.ON_NODE,e=>{this._source.processedNode=e;let t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(zs.ON_TRACK),this.processorDestination.removeAllListeners(zs.ON_NODE)}}).prototype,"setVolume",[kW],Object.getOwnPropertyDescriptor(is.prototype,"setVolume"),is.prototype),on(is.prototype,"setAmplifiedVolume",[DW],Object.getOwnPropertyDescriptor(is.prototype,"setAmplifiedVolume"),is.prototype),on(is.prototype,"setPlaybackDevice",[xW],Object.getOwnPropertyDescriptor(is.prototype,"setPlaybackDevice"),is.prototype),on(is.prototype,"play",[LW],Object.getOwnPropertyDescriptor(is.prototype,"play"),is.prototype),on(is.prototype,"stop",[MW],Object.getOwnPropertyDescriptor(is.prototype,"stop"),is.prototype),on(is.prototype,"pipe",[UW],Object.getOwnPropertyDescriptor(is.prototype,"pipe"),is.prototype),on(is.prototype,"unpipe",[VW],Object.getOwnPropertyDescriptor(is.prototype,"unpipe"),is.prototype),is),$o=new class extends dr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),pe(this,"_lastHiddenTime",0),pe(this,"_lastVisibleTime",0),pe(this,"needUploadStats",[]),pe(this,"isCollectingStats",!1),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),this.isCollectingStats&&this.needUploadStats.push(document.visibilityState==="visible"?1:0),k.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}startCollectStats(){this.isCollectingStats=!0,this.needUploadStats.push(this.visibility==="visible"?1:0)}stopCollectStats(){this.isCollectingStats=!1,this.needUploadStats.length=0}};class jW extends dr{constructor(t,r){super(),pe(this,"trackMediaType",VE.DATA),pe(this,"_version",1),pe(this,"_type",3),pe(this,"_config",void 0),pe(this,"_originDataChannel",void 0),pe(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),pe(this,"_dataStreamPacketHandler",{serialize:o=>o,deserialize:o=>o}),pe(this,"_datachannelEventMap",new Map),this._config=t,r&&(this._originDataChannel=r,this._bandDataChannelEvents(r)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return z("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,r;return(t=(r=this._originDataChannel)===null||r===void 0?void 0:r.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,r;return(t=(r=this._originDataChannel)===null||r===void 0?void 0:r.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new ze((t,r)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();let o=setTimeout(()=>{var c;r(new _e(Y.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(o),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(o),new _e(Y.DATACHANNEL_CONNECTION_TIMEOUT)}}else r(new _e(Y.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){let t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[Fb.OPEN,Fb.CLOSE,Fb.ERROR].forEach(r=>{let o=()=>{this.emit(r)};this._datachannelEventMap.set(r,o),t.addEventListener(r,o)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(r=>{let[o,c]=r;t.removeEventListener(o,c)}),this._datachannelEventMap.clear()}}class qde extends jW{constructor(t){super(t),pe(this,"_messageListener",void 0),this._messageListener=r=>{if(r.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);let o=r.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(o).getUint8(3);if(c!==this.id)return void(z("SHOW_DATASTREAM2_LOG")&&k.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let u=r.data.slice(this._dataStreamPacketHeader.byteLength);u=this._dataStreamPacketHandler.deserialize(u),this.emit(Fb.MESSAGE,u)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Xde extends jW{send(t){if(this._originDataChannel){let r=t;r=this._dataStreamPacketHandler.serialize(t);let o=new Uint8Array(this._dataStreamPacketHeader.byteLength+r.byteLength);o.set(new Uint8Array(this._dataStreamPacketHeader),0),o.set(new Uint8Array(r),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(o.buffer)}}}function Hb(){let e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcixuPVtdLHI9W107bGV0IGg9bnVsbDtlLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9dD0+e3QuZGF0YS5zZWkmJm4ucHVzaCh0LmRhdGEuc2VpKSx0LmRhdGEubWV0YWRhdGEmJnIucHVzaCh0LmRhdGEubWV0YWRhdGEpfSxzZWxmLnBvc3RNZXNzYWdlKCJzdGFydGVkIik7Y29uc3QgcD1lLnJlYWRhYmxlLmdldFJlYWRlcigpLFU9ZS53cml0YWJsZS5nZXRXcml0ZXIoKTsic2VpLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KG4udmFsdWUuZGF0YSkpLHI9YShuLnZhbHVlLHQpO2lmKHImJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtzZWk6cn0pLCFoKXtjb25zdCB0PW4udmFsdWUuZ2V0TWV0YWRhdGEoKXx8e307aD17dHlwZTpuLnZhbHVlLnR5cGUscnRwVGltZXN0YW1wOm4udmFsdWUudGltZXN0YW1wLHBheWxvYWRUeXBlOnQucGF5bG9hZFR5cGV8fDAsc3NyYzp0LnN5bmNocm9uaXphdGlvblNvdXJjZXx8MCxsZW5ndGg6bi52YWx1ZS5kYXRhLmJ5dGVMZW5ndGgsLi4uIm1pbWVUeXBlImluIHQ/e21pbWVUeXBlOnQubWltZVR5cGV9Ont9fSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7Zmlyc3RGcmFtZUluZm86aH0pfX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToic2VpLXR4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigoYT0+e2lmKCFhLmRvbmUpe2lmKGEudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1pKG5ldyBVaW50OEFycmF5KGEudmFsdWUuZGF0YSkpLGU9bi5zaGlmdCgpO2lmKGUpe2NvbnN0IG49byhhLnZhbHVlLmRhdGEsZSx0KTtuJiYoYS52YWx1ZS5kYXRhPW4pfX1VLndyaXRlKGEudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtwLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PW5ldyBEYXRhVmlldyhuLnZhbHVlLmRhdGEpLGE9dC5nZXRVaW50OCgwKTtsZXQgcjtpZigwIT0oMTI4JmEpJiY3MSE9PWEpe2NvbnN0IGU9ZnVuY3Rpb24odCl7aWYodC5ieXRlTGVuZ3RoPD0wKXJldHVybltdO2NvbnN0IGU9W107bGV0IG49MDtmb3IoO248dC5ieXRlTGVuZ3RoOyl7Y29uc3QgYT0oMTI4JnQuZ2V0VWludDgobikpPj43LHI9MTI3JnQuZ2V0VWludDgobik7aWYoIShhJiZuKzQ8PXQuYnl0ZUxlbmd0aCkpe24rKzticmVha317Y29uc3QgYT10LmdldFVpbnQzMihuLCExKSxvPSgxNjc3NjE5MiZhKT4+MTAsaT0xMDIzJmE7ZS5wdXNoKHtwdDpyLHRzX29mZnNldDpvLGxlbmd0aDppLGRhdGE6bmV3IFVpbnQ4QXJyYXl9KSxuKz00fX1sZXQgYT10LmJ5dGVMZW5ndGgtbjtmb3IoY29uc3QgciBvZiBlKXtpZihyLmxlbmd0aD5hKXJldHVybiBjb25zb2xlLndhcm4oIkJyb2tlbiByZWQgcGF5bG9hZCIpLFtdO3IubGVuZ3RoPjAmJihyLmRhdGE9bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sci5sZW5ndGgpLG4rPXIubGVuZ3RoLGEtPXIubGVuZ3RoKX1pZihhPjApe2NvbnN0IHI9e3B0OmUubGVuZ3RoPjA/ZVtlLmxlbmd0aC0xXS5wdDowLHRzX29mZnNldDowLGxlbmd0aDphLGRhdGE6bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0K24sYSl9O2UucHVzaChyKX1yZXR1cm4gZX0odCk7aWYoZS5sZW5ndGg+MCl7Y29uc3QgdD1mdW5jdGlvbih0KXtsZXQgZT0wO2ZvcihsZXQgbj0wO248dC5sZW5ndGg7bisrKWUrPW48dC5sZW5ndGgtMT80OjEsZSs9dFtuXS5sZW5ndGg7Y29uc3Qgbj1uZXcgVWludDhBcnJheShlKTtsZXQgYT0wO2ZvcihsZXQgZT0wO2U8dC5sZW5ndGg7ZSsrKWlmKGU8dC5sZW5ndGgtMSl7Y29uc3Qgcj0oMjE0NzQ4MzY0OHwoMTI3JnRbZV0ucHQpPDwyNHwoMjYyMTQzJnRbZV0udHNfb2Zmc2V0KTw8MTB8MTAyMyZ0W2VdLmxlbmd0aCk+Pj4wO25bYSsrXT1yPj4yNCYyNTUsblthKytdPXI+PjE2JjI1NSxuW2ErK109cj4+OCYyNTUsblthKytdPTI1NSZyfWVsc2UgblthKytdPTEyNyZ0W2VdLnB0O2Zvcihjb25zdCBlIG9mIHQpbi5zZXQoZS5kYXRhLGEpLGErPWUubGVuZ3RoO3JldHVybiBufShlLm1hcCgodD0+e2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7cC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>GR.revokeObjectURL(e),0),new Worker(GR.createObjectURL(e))}let BW=71,$k=1,Qk=2,Zk=1,WW=2;var vp=(function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e})(vp||{});function eD(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],r=e.getUint8(0);if(r!==BW)return;let o=e.getUint16(1),c=$k+Qk+o,u=new Uint8Array(e.byteLength-c);u.set(new Uint8Array(e.buffer,c,e.byteLength-c));let h={m:r,tlvLen:o,tlv:[],frame:u},m=$k+Qk;for(;m<c;){let g=e.getUint8(m),y=e.getUint16(m+Zk),v=Zk+WW;if(g===vp.AUDIO_LEVEL){let R=e.getUint8(m+v);for(let b=1;b<y;b++)R=R<<8|e.getUint8(m+v+b);h.tlv.push({tag:g,length:y,value:t?127^R>>1:127&R})}else if(g===vp.METADATA||g===vp.AUDIO_64_BIT_PTS){let R=new Uint8Array(y);for(let b=0;b<y;b++)R[b]=e.getUint8(m+v+b);h.tlv.push({tag:g,length:y,value:R})}m+=v+y}return h}let zb=new Map,Kb=127,Hm=1e-10,tD=139/13,Yb=new Map;function nD(e,t,r){let o="".concat(e,"-").concat(t,"-").concat(r),c=0;return Yb.has(o)?c=Yb.get(o):(c=Math.log((function(u,h){let m=u-h;h<m&&(h=m);let g=1;for(let y=u,v=1;y>h;y--,v++)g=g*y/v;return g})(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(r)+r*e,Yb.set(o,c)),c<Hm&&(c=Hm),c}function GW(e,t,r){let o=t.length,c=e.length/o,u=!1;for(let h=0,m=0;h<o;h++){let g=0;for(let y=m+c;m<y;m++)e[m]>r&&g++;t[h]!==g&&(t[h]=g,u=!0)}return u}window.cache=Yb;let Jde=0;class HW{constructor(t){pe(this,"id",void 0),pe(this,"immediates",[]),pe(this,"lastNonSilence",-1),pe(this,"immediateSpeechActivityScore",Hm),pe(this,"lastLevelChangedTime",Date.now()),pe(this,"levels",[]),pe(this,"longs",[]),pe(this,"longSpeechActivityScore",Hm),pe(this,"mediums",[]),pe(this,"mediumSpeechActivityScore",Hm),pe(this,"minLevel",0),pe(this,"nextMinLevel",0),pe(this,"nextMinLevelWindowLength",0),pe(this,"energyScore",0),this.id=t||"".concat(Jde++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){let t=this.immediates,r=this.levels,o=this.minLevel+tD,c=!1;for(let u=0;u<t.length;++u){let h=r[u];h<o&&(h=0);let m=Math.floor(h/tD);t[u]!==m&&(t[u]=m,c=!0)}return c}computeLongs(){return GW(this.mediums,this.longs,4)}computeMediums(){return GW(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=nD(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=nD(this.longs[0],10,47),this.longSpeechActivityScore>Hm&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=nD(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(zf(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,r){if(this.lastLevelChangedTime<=r){this.lastLevelChangedTime=r;let o=t;return t<0&&(o=0),t>Kb&&(o=Kb),this.levels.unshift(o),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(o),o>=this.minLevel+tD?o:o/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let r=Math.sqrt(this.minLevel*this.nextMinLevel);r<0?r=0:r>Kb&&(r=Kb),this.minLevel=r,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class $de{constructor(t){pe(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{let r=this.algorithm.runInDecisionMaker(this);r<=0?t=!0:setTimeout(this.execute.bind(this),r)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class rD{constructor(t,r,o){pe(this,"isDominant",void 0),pe(this,"energyRanking",void 0),pe(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=r,this.energyScore=o}}class Qde extends dr{constructor(t){super(),pe(this,"dominantId",null),pe(this,"lastDecisionTime",0),pe(this,"lastLevelChangedTime",0),pe(this,"lastLevelIdleTime",0),pe(this,"relativeSpeechActivities",[]),pe(this,"speakers",new Map),pe(this,"enableSilence",!1),pe(this,"timeoutToSilenceInterval",0),pe(this,"decisionMaker",null),pe(this,"loudest",[]),pe(this,"numLoudestToTrack",3),pe(this,"energyExpireTimeMs",250),pe(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,r=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,r!=null&&(this.energyExpireTimeMs=r),o!=null&&(this.energyAlphaPct=o),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(r=>r.id===t)}levelChanged(t,r){let o=Date.now(),c=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<o&&(this.lastLevelChangedTime=o,this.maybeStartDecisionMaker());let u=c.levelChanged(r,o);return this.updateLoudestList(c,u,o)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(r=>{this.speakers.has(r.id)||this.speakers.set(r.id,r)})}removeSpeakers(t){t.forEach(r=>{this.speakers.delete(r.id)})}getOrCreateSpeaker(t){let r=this.speakers.get(t);return r||(r=new HW(t),this.speakers.set(t,r),this.maybeStartDecisionMaker()),r}updateLoudestList(t,r,o){let c=t.id===this.dominantId;if(r<0){let g=0;for(;g<this.loudest.length&&this.loudest[g]!==t;)++g;return new rD(c,g,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*r+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new rD(c,0,t.energyScore);let u=o-this.energyExpireTimeMs,h=0;for(;h<this.loudest.length;){let g=this.loudest[h];if(g.getLastLevelChangedTime()<u&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(g.id!==t.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<t.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new rD(c,m,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new $de(this),this.decisionMaker.execute())}makeDecision(t){let r=null,o=null,c=this.speakers.size,u=null;if(c===0)u=null;else if(c===1){var h;let m=Yo(h=this.speakers).call(h).next().value;this.enableSilence&&m&&(u=m.id,m.evaluateSpeechActivityScores(t),t-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){let v=this.speakers.entries().next();v.value&&(u=v.value[0],m=v.value[1])}else u=m.id;m?.evaluateSpeechActivityScores(t);let g=this.relativeSpeechActivities,y=2;for(let v of this.speakers.entries()){let[R,b]=v;if(b===m)continue;b.evaluateSpeechActivityScores(t);for(let j=0;j<g.length;++j){let K=m==null?Hm:m.getSpeechActivityScore(j);g[j]=Math.log(b.getSpeechActivityScore(j)/K)}let A=g[0],F=g[1],M=g[2];A>3&&F>2&&M>0&&F>y&&(y=F,u=R)}this.enableSilence&&m!=null&&u===m.id&&t-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null)}u==null&&!this.enableSilence||u===this.dominantId||(r=this.dominantId,this.dominantId=u,o=this.dominantId),o==null&&!this.enableSilence||o===r||this.emit("ActiveSpeakerChanged",o)}_runInDecisionMaker(){let t=Date.now(),r=300-(t-this.lastLevelIdleTime),o=0;r<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):o=r;let c=300-(t-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=t,this.makeDecision(t),c=300-(Date.now()-t)),c>0&&o>c&&(o=c),o}timeoutIdleLevels(t){let r=[];for(let c of Yo(o=this.speakers).call(o)){var o;let u=t-c.getLastLevelChangedTime();36e5<u&&(this.dominantId==null||c.id!==this.dominantId)?r.push(c.id):300<u&&c.levelTimedOut()}r.forEach(c=>this.speakers.delete(c))}}let HE=new Map,Gl=null,qb=null,zW=3,zm=[],Hl=new Map,Xb=new Map;class Zde{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,r){pe(this,"id",void 0),pe(this,"track",void 0),pe(this,"score",0),pe(this,"active",!0),pe(this,"muted",!1),pe(this,"timer",0),pe(this,"actives",0),pe(this,"inactives",0),this.id=t,this.track=r,this.setActive(Hl.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){let t=this.active;this.active=this.activeRate>=.8;let{actives:r,inactives:o}=(function(){let c=[],u=[];return Array.from(Yo(Hl).call(Hl)).forEach(h=>{h.active?c.push(h):u.push(h)}),{actives:c,inactives:u}})();if(r.length>3){let c;r.forEach(u=>{(!c||c.score>u.score)&&(c=u)}),c&&c.setActive(!1)}if(r.length<3&&o.length>0){let c;o.forEach(u=>{(!c||c.score<u.score)&&u.id!==this.id&&(c=u)}),c&&t&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){let t=(function(r){let o;return Array.from(Yo(Hl).call(Hl)).forEach(c=>{!c.active||c.id===r||c.samples<40||(!o||c.score<o.score)&&(o=c)}),o})(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){let t=(function(r){let o;return Array.from(Yo(Hl).call(Hl)).forEach(c=>{c.active||c.id===r||c.samples<40||(!o||c.score>o.score)&&(o=c)}),o})(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let Jb;function KW(e){let t=Hl.get(e);t&&(Hl.delete(e),t.clearTimer())}let $b=new Map,ehe=new Map,iD="video/h264",sD="video/h265";function YW(e,t,r){let o=new Uint8Array(e,t,r),c=[],u=0;for(;c.length<r;)u+3<r&&o[u]===0&&o[u+1]===0&&o[u+2]===3&&(o[u+3]===0||o[u+3]===1||o[u+3]===2||o[u+3]===3)?(c.push(o[u],o[u+1],o[u+3]),u+=4):(c.push(o[u]),u++);return new Uint8Array(c)}function qW(e){let t=e.length,r=[],o=0;for(;o<t;)o+2<t&&e[o]===0&&e[o+1]===0&&(e[o+2]===0||e[o+2]===1||e[o+2]===2||e[o+2]===3)?(r.push(e[o],e[o+1],3,e[o+2]),o+=3):(r.push(e[o]),o++);return new Uint8Array(r)}function XW(e){if(e.length<5)return"";let t=-1;for(let c=0;c<e.length-3;c++){if(e[c]===0&&e[c+1]===0&&e[c+2]===1){t=c;break}if(c<e.length-4&&e[c]===0&&e[c+1]===0&&e[c+2]===0&&e[c+3]===1){t=c;break}}if(t===-1)return"";let r=t+(e[t+2]===0?4:3);if(r>=e.length)return"";let o=e[r];return 128&o?"":(o>>1&63)>=32||r+1<e.length&&!(248&e[r+1])?sD:(31&o)<=31?iD:""}let Qb=new Map,BT=new Map;(function(){let e=pn();Ri.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Ri.getStreamFromExtension=e.name===_n.CHROME&&Number(e.version)>34,Ri.supportUnifiedPlan=(function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let t=new RTCPeerConnection,r=!1;try{t.addTransceiver("audio"),r=!0}catch{}return t.close(),r})(),Ri.supportMinBitrate=e.name===_n.CHROME||e.name===_n.EDGE,Ri.supportSetRtpSenderParameters=(function(){let t=pn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Xu()||!(!Pi()&&!Rb())||t.name===_n.FIREFOX&&Number(t.version)>=64)})(),e.name===_n.SAFARI&&(Number(e.version)>=14?Ri.supportDualStream=!0:Ri.supportDualStream=!1),Ri.webAudioMediaStreamDest=(function(){let t=pn();return!(t.name===_n.SAFARI&&Number(t.version)<12)})(),Ri.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Ri.supportWebGL=typeof WebGLRenderingContext<"u",Ri.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Xu()||(Ri.webAudioWithAEC=!0),Ri.supportShareAudio=(function(){let t=pn();return(t.os===wi.WIN_10||t.os===wi.WIN_81||t.os===wi.WIN_7||t.os===wi.LINUX||t.os===wi.MAC_OS||t.os===wi.CHROMIUM_OS)&&t.name===_n.CHROME&&Number(t.version)>=74})(),Ri.supportDataChannel=!!(Bl(76)||lk(68)||j4(14)),Ri.supportPCSetConfiguration=(function(){let t=window.RTCPeerConnection;return!Qn()&&!!t&&t.prototype.setConfiguration instanceof Function})(),Ri.supportWebRTCEncodedTransform=Bl(87)||U4()||lk(117),Ri.supportWebRTCInsertableStream=(function(){let t=pn();return(t.name===_n.CHROME||t.name===_n.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window})(),Ri.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Ri.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,Ri.supportSuppressLocalAudioPlayback=D5(),Ri.supportRestrictOwnAudio=x5(),Ib(()=>{Ri.supportDualStreamEncoding=(function(){let t=pn();return!!z("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&z("CHROME_DUAL_STREAM_USE_ENCODING"))})(),k.debug("browser ua: ",navigator.userAgent),k.info("browser info: ",e),k.info("browser compatibility: ",Ri)})})();let the=["CHINA","GLOBAL"],JW=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Km=[],zE=[];function Ym(e,t){return!!t&&Km.some(r=>r.uid===e&&r.channelName===t)}function oD(){return zE.length>0}var nhe=rB.forEach,$W=Ff("forEach")?[].forEach:function(e){return nhe(this,e,arguments.length>1?arguments[1]:void 0)};Sn({target:"Array",proto:!0,forced:[].forEach!==$W},{forEach:$W});var rhe=To("Array","forEach"),ihe=El,she=Ur,ohe=N,ahe=rhe,aD=Array.prototype,che={DOMTokenList:!0,NodeList:!0},lhe=function(e){var t=e.forEach;return e===aD||ohe(aD,e)&&t===aD.forEach||she(che,ihe(e))?ahe:t},uhe=l(lhe),dhe=Zi,QW=ro;Sn({target:"Object",stat:!0,forced:d(function(){QW(1)})},{keys:function(e){return QW(dhe(e))}});var hhe=l(fi.Object.keys),phe=l(Qr),fhe=l(Hf),mhe=Sn,ZW=yl,ghe=es,_he=Wr,eG=Vv,Ehe=Ru,yhe=yi,vhe=FP,She=Er,The=Bi,whe=q3("slice"),Che=She("species"),cD=Array,Rhe=Math.max;mhe({target:"Array",proto:!0,forced:!whe},{slice:function(e,t){var r,o,c,u=yhe(this),h=Ehe(u),m=eG(e,h),g=eG(t===void 0?h:t,h);if(ZW(u)&&(r=u.constructor,(ghe(r)&&(r===cD||ZW(r.prototype))||_he(r)&&(r=r[Che])===null)&&(r=void 0),r===cD||r===void 0))return The(u,m,g);for(o=new(r===void 0?cD:r)(Rhe(g-m,0)),c=0;m<g;m++,c++)m in u&&vhe(o,c,u[m]);return o.length=c,o}});var bhe=To("Array","slice"),Ihe=N,Ahe=bhe,lD=Array.prototype,Ohe=function(e){var t=e.slice;return e===lD||Ihe(lD,e)&&t===lD.slice?Ahe:t},Nhe=l(Ohe);function Ye(e,t,r,o,c){var u,h,m,g={};return uhe(u=hhe(o)).call(u,function(y){g[y]=o[y]}),g.enumerable=!!g.enumerable,g.configurable=!!g.configurable,("value"in g||g.initializer)&&(g.writable=!0),g=phe(h=fhe(m=Nhe(r).call(r)).call(m)).call(h,function(y,v){return v(e,t,y)||y},g),c&&g.initializer!==void 0&&(g.value=g.initializer?g.initializer.call(c):void 0,g.initializer=void 0),g.initializer===void 0?(H3(e,t,g),null):g}let Zb=(function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e})({}),uD=(function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e})({}),ec=(function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e[e.REQ_DOWNGRADE_FALLBACK=27]="REQ_DOWNGRADE_FALLBACK",e})({}),Ks=(function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e})({}),pt=(function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.K_VOS_FALLBACK=30]="K_VOS_FALLBACK",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e})({}),nn=(function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e})({}),rt=(function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e.VOS_FALLBACK="vos_fallback",e.VOS_FALLBACK_PROMISE="vos_fallback_promise",e})({}),ct=(function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SET_DUAL_STREAM_MODE="set_dual_stream_mode",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.CONFIGURE="configure",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e})({}),qm=(function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e})({}),wt=(function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e.ENABLE_MULTI_STREAM="enable_multi_stream",e})({}),Ys=(function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e})({}),Ot=(function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e.ON_FALLBACK="websocket:on_fallback",e})({});function eI(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw k.error("Invalid Channel Name ".concat(e)),new he(Y.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function tI(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||X4(e,1,255)))throw new he(Y.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&k.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let nh=(function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e})({}),Phe={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},dD={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function hD(e,t){Hi(e.url,"".concat(t,".url"),1,1e3,!1),wr(e.x)||Vn(e.x,"".concat(t,".x"),0,1e4),wr(e.y)||Vn(e.y,"".concat(t,".y"),0,1e4),wr(e.width)||Vn(e.width,"".concat(t,".width"),0,1e4),wr(e.height)||Vn(e.height,"".concat(t,".height"),0,1e4),wr(e.zOrder)||Vn(e.zOrder,"".concat(t,".zOrder"),0,255),wr(e.alpha)||Vn(e.alpha,"".concat(t,".alpha"),0,1,!1)}let khe={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},Sp=(function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e})({}),pD=(function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e})({}),ci=(function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e})({});function tG(e){if(!e.channelName)throw new he(Y.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new he(Y.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Hi(e.token,"info.token",1,2047),tI(e.uid),eI(e.channelName),!0}let uo=(function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e})({}),rh=(function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e})({}),Ao=(function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e})({}),KE=(function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e})({}),On=(function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e})({}),Vr=(function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e.VOS_FALLBACK="vos-fallback",e.VOS_FALLBACK_PROMISE="vos-fallback-promise",e.RESET_SIGNAL="reset-signal",e.DATACHANNEL_FAILBACK="datachannel-failback",e})({}),nI=(function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e})({}),bi=(function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e})({}),yn=(function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e})({}),nG=[yn.AFRICA,yn.ASIA,yn.CHINA,yn.EUROPE,yn.GLOBAL,yn.INDIA,yn.JAPAN,yn.NORTH_AMERICA,yn.OCEANIA,yn.OVERSEA,yn.SOUTH_AMERICA],ps=(function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e})({}),rI={CHINA:{},ASIA:{CODE:ps.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:ps.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:ps.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:ps.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:ps.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:ps.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:ps.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:ps.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:ps.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:ps.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:ps.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:ps.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:ps.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};Ok&&(rI.CHINA={CODE:ps.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let zl=(function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e.UPDATE_REMOTE_VIDEO_STREAM_TYPE="update_remote_video_stream_type",e.FALLBACK_TO_HLS="fallback_to_hls",e.UPDATE_VOS_CONFIGURE="update_vos_configure",e})({});function rG(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class iG extends dr{constructor(t,r){super(),V(this,"onICEConnectionStateChange",void 0),V(this,"onConnectionStateChange",void 0),V(this,"onDTLSTransportStateChange",void 0),V(this,"onDTLSTransportError",void 0),V(this,"onICETransportStateChange",void 0),V(this,"onFirstAudioReceived",void 0),V(this,"onFirstVideoReceived",void 0),V(this,"onFirstAudioDecoded",void 0),V(this,"onFirstVideoDecoded",void 0),V(this,"onFirstVideoRender",void 0),V(this,"onFirstVideoBufferReady",void 0),V(this,"onFirstVideoDecodedTimeout",void 0),V(this,"onSelectedLocalCandidateChanged",void 0),V(this,"onSelectedRemoteCandidateChanged",void 0),V(this,"onICECandidateError",void 0),V(this,"getLocalVideoStats",void 0)}}class iI extends iG{constructor(t,r){super(t,r),V(this,"establishPromise",void 0)}}let et=(function(e){return e.VIDEO="video",e.AUDIO="audio",e})({}),Di=(function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e})({}),ih=(function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e})({}),sG=["disconnected","failed"],xe=(function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e})({}),Tn=(function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e})({}),dt=(function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e.FirstVideoPreRender="FirstVideoPreRender",e.FirstVideoBufferReady="FirstVideoBufferReady",e})({}),Yc=(function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e})({}),qc=(function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e})({}),xi=(function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e})({}),Tp=(function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e})({}),li=(function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e})({}),Zu=(function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e})({}),tc=(function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e})({}),Kl=(function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e})({}),YE=(function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e})({}),Fr=(function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e})({}),qE=(function(e){return e.ABORT="abort",e})({}),wp=(function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e})({}),Dhe=(function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e})({}),xhe={[Zb.ACCESS_POINT]:{[Ks.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Ks.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Ks.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Ks.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Ks.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Ks.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Ks.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Ks.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Ks.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Ks.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Ks.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Ks.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Ks.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Ks.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Ks.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Ks.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Ks.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Ks.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Zb.UNILBS]:{[ec.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[ec.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[ec.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[ec.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[ec.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[ec.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[ec.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[ec.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[ec.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[ec.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[ec.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[ec.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1},[ec.REQ_DOWNGRADE_FALLBACK]:{desc:"request downgrade fallback",retry:!1}},[Zb.STRING_UID_ALLOCATOR]:{[uD.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[uD.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[uD.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function XE(e){let t=xhe[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};let r=t[e%1e4];if(!r){if(Math.floor(e/1e4)===Zb.ACCESS_POINT){let o=e%1e4;if(o.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(o.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return r}let Lhe={[pt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[pt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[pt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[pt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[pt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[pt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[pt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[pt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[pt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[pt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[pt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[pt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[pt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[pt.K_VOS_FALLBACK]:{desc:"K_VOS_FALLBACK",action:"tryNext"},[pt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[pt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[pt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[pt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[pt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[pt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[pt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[pt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[pt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[pt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[pt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[pt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[pt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[pt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[pt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[pt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[pt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[pt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[pt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[pt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[pt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[pt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[pt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[pt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[pt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[pt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[pt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[pt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[pt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[pt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[pt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[pt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[pt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[pt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[pt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[pt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[pt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[pt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[pt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[pt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[pt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[pt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[pt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[pt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[pt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[pt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[pt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[pt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[pt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[pt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[pt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Xm(e){return Lhe[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function oG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function fD(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?oG(Object(r),!0).forEach(function(o){V(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oG(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}function mD(e,t){if(typeof e=="string")return e;let{proxy:r,host:o,port:c}=e;if(t){let u=z("JOIN_GATEWAY_FALLBACK_PORT")||443;return u===443?"wss://".concat(o,"/ws/?p=").concat(Number(c)+150):"wss://".concat(o,":").concat(u,"/ws/?p=").concat(Number(c)+150)}return r?"wss://".concat(r,"/ws/?h=").concat(o,"&p=").concat(c):"wss://".concat(o,":").concat(c)}let Mhe=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Uhe=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Vhe=/wss:\/\/(.+):([0-9]+)\/?/,Fhe=/wss:\/\/(.[^\/]+)\/?/,jhe=0;class Bhe{constructor(t,r){V(this,"id",0),V(this,"store",void 0),V(this,"recordIndex",void 0),V(this,"websockets",[]),V(this,"try443PortDuration",2e3),V(this,"forceCloseWSDuration",5e3),V(this,"try443PortTimeout",null),V(this,"forceCloseTimeout",null),V(this,"isTry443PortFailed",!1),V(this,"isNormalPortFailed",!1),V(this,"useDoubleDomain",!1),V(this,"useProxy",!1),V(this,"startTime",Date.now()),this.id=++jhe,this.try443PortDuration=z("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=r}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;let r=Date.now()-this.startTime;for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];k.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(r,"ms:"),...c)}createWebSocket(t,r,o){this.logger("createWebSocket:",t,{isTry443Port:r,hasTimeoutDetection:o});let c=z("GATEWAY_DOMAINS"),u=Date.now(),h=[],m=c.find(b=>{var A;return ke(A=t.host).call(A,b)});m||(this.useDoubleDomain=!1);let g=[];if(this.useDoubleDomain)c.forEach(b=>{g.push(mD(fD(fD({},t),{},{host:t.host.replace(m,b)}),r))});else{let b=fD({},t);if(r&&m){let A=c.find(F=>F!==m);A&&(b.host=b.host.replace(m,A))}g.push(mD(b,r))}try{g.forEach(b=>{let A=new WebSocket(b);A.binaryType="arraybuffer",h.push(A),this.logger("ws is connecting:",A.url)})}catch(b){if(this.logger("ws create failed"),h.forEach(A=>A.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,r,o);if(!r&&Number(t.port)!==443)return this.createWebSocket(t,!0,o);throw new he(Y.WS_ERR,"init websocket failed! Error: ".concat(b.toString()))}let y=OT();this.store&&this.store.recordJoinChannelService({urls:h.map(b=>b.url),service:"gateway"},this.recordIndex),h.forEach(b=>{b.onopen=()=>{this.logger("onopen: ws ".concat(b.url," open cost ").concat(Date.now()-u,"ms")),this.websockets.forEach(A=>{A!==b&&(A.onopen=null,A.onclose=null,A.onmessage=null,A.close(),this.logger("close backup websocket: ".concat(A.url)))}),this.websockets.length=0,y.resolve(b)},b.onclose=A=>{this.logger("onclose: ws ".concat(b.url," closed cost ").concat(Date.now()-u,"ms state: ").concat(b.readyState));let F=h.every(M=>M.readyState===WebSocket.CLOSED||M.readyState===WebSocket.CLOSING);this.logger("".concat(r?"443":"47xx"," websocket closed, all failed: ").concat(F)),F&&(r||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(A.reason)),y.reject({code:A.code,reason:nI.A_ROUND_WS_FAILED})):!r&&F&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),R()),r?this.isTry443PortFailed=F:this.isNormalPortFailed=F},b.onmessage=A=>this.logger("".concat(b.url," onmessage: ").concat(A.data))}),this.websockets.push(...h);let v=()=>{this.websockets.forEach(b=>b.readyState!==WebSocket.OPEN&&b.close())},R=()=>{if(y.isResolved)return v();pn().os===wi.MAC_OS&&Qn()&&v(),this.createWebSocket(t,!0,!0).then(b=>{y.resolve(b)}).catch(b=>{this.isNormalPortFailed&&y.reject(b),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",y.isResolved),this.forceCloseTimeout=null,v()},this.forceCloseWSDuration)};return o||(()=>{if(r||this.useProxy)return this.logger("add 5s timeout at ".concat(r?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,v()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",y.isResolved),this.try443PortTimeout=null,R()},this.try443PortDuration)})(),y.promise}chooseBestWebsocket(t,r,o,c){return this.useDoubleDomain=!!r,typeof t=="string"&&(t=(function(u){let h,m,g;return[,h,m,g]=u.match(Mhe)||[],h||([,m,g]=u.match(Uhe)||[]),m&&g||([,m,g]=u.match(Vhe)||[]),m&&g||([,m]=u.match(Fhe)||[]),m||k.warning("un-destructible url: ",u),{proxy:h,host:m,port:g||"443"}})(t)),this.recordIndex=c,this.useProxy=!!t.proxy,o&&this.useProxy&&(k.warn("cannot use 443 only when use proxy"),o=!1),this.createWebSocket(t,!!o,!1).finally(()=>this.clearTimeout())}}function aG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}class cG extends dr{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var r;ke(r=["tryNext","recover"]).call(r,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Ot.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Ot.CONNECTED):this._state==="closed"?this.emit(Ot.CLOSED):this._state==="failed"&&this.emit(Ot.FAILED))}resetReconnectCount(t){k.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,r){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),V(this,"_websocketUrl",null),V(this,"connectionID",0),V(this,"currentURLIndex",0),V(this,"urls",[]),V(this,"_reconnectMode","tryNext"),V(this,"reconnectReason",void 0),V(this,"_initMutex",void 0),V(this,"name",void 0),V(this,"_state","closed"),V(this,"reconnectInterrupter",void 0),V(this,"websocket",void 0),V(this,"retryConfig",void 0),V(this,"reconnectCount",0),V(this,"forceCloseTimeout",5e3),V(this,"onlineReconnectListener",void 0),V(this,"useCompress",void 0),V(this,"tryDoubleDomain",!1),V(this,"use443PortOnly",!1),V(this,"wsInflateLength",0),V(this,"wsDeflateLength",0),V(this,"closeEstablishingWs",()=>{}),V(this,"store",void 0),V(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=t,this.retryConfig=(function(R){for(var b=1;b<arguments.length;b++){var A=arguments[b]!=null?arguments[b]:{};b%2?aG(Object(A),!0).forEach(function(F){V(R,F,A[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(A)):aG(Object(A)).forEach(function(F){Object.defineProperty(R,F,Object.getOwnPropertyDescriptor(A,F))})}return R})({},r),this.useCompress=o,this.tryDoubleDomain=c,this.use443PortOnly=u,this._initMutex=new ki("websocket",h?h.clientId:void 0);let{timeout:m,timeoutFactor:g}=r,y=Math.max(300,Math.floor(3*m/5)),v=Math.max(1.2,Math.floor(8*g)/10);Gs.ONLINE&&(this.retryConfig.timeout=y,this.retryConfig.timeoutFactor=v),Cr.on(Dm.NETWORK_STATE_CHANGE,(R,b)=>{R!==b&&(this.resetReconnectCount("network state change: ".concat(b," -> ").concat(R)),R===Gs.ONLINE?(this.retryConfig.timeout=y,this.retryConfig.timeoutFactor=v):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=g))})}getConnection(){return this.websocket||void 0}async init(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,o=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=r,this.urls=t,this.state="connecting";try{var c;let u=OT(),h=this.urls[this.currentURLIndex];(c=this.store)===null||c===void 0||c.beforeConnect(),(function(m){return!(Mb()||z("USE_NEW_TOKEN")||!z("ENABLE_PREALLOC_PC")&&(m==null||!m.autoSubscribe||z("FORCE_DISABLE_AUTO_SUB")))})(this.store)&&this.emit(li.PRE_CONNECT_PC),this.createWebSocketConnection(h).then(u.resolve).catch(u.reject),this.once(Ot.CLOSED,()=>{u.reject(new _e(Y.WS_DISCONNECT))}),this.once(Ot.CONNECTED,u.resolve),await u.promise}catch{}finally{o()}}close(t,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let o=this.websocket;r?setTimeout(()=>o.close(),500):o.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,r){if(!this.websocket)return void k.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),k.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(r)]},this.joinGatewayRecordIndex);let o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:r})}sendMessage(t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new _e(Y.WS_ABORT,"websocket is not ready");try{r||(t=JSON.stringify(t)),this.websocket.send(t)}catch(o){throw new _e(Y.WS_ERR,"send websocket message error"+o.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){let t=this.wsInflateLength,r=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:r}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var r;let o=OT();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;let c=v=>{var R;(R=this.store)===null||R===void 0||R.signalChannelOpen(),k.debug("[".concat(this.name,"] websocket opened:"),v),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),o.resolve()},u=async v=>{var R;if(k.debug("[".concat(this.name,"] websocket close ").concat((R=this.websocket)===null||R===void 0?void 0:R.url,", code: ").concat(v.code,", reason: ").concat(v.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)o.reject(new _e(Y.WS_DISCONNECT,"websocket close: ".concat(v.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=v.reason,this.state="reconnecting");let b=Jo(this,Ot.WILL_RECONNECT,this.reconnectMode,v.reason)||this.reconnectMode,A=await this.reconnectWithAction(b);if(this.state==="closed")return void k.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!A)return o.reject(new _e(Y.WS_DISCONNECT,"websocket reconnect failed: ".concat(v.code))),this.close(!0);o.resolve()}},h=v=>{this.emit(Ot.ON_MESSAGE,v)},m=v=>{k.warn("[".concat(this.connectionID,"] ws open error ").concat(v))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),z("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=z("GATEWAY_WSS_ADDRESS")),k.debug("[".concat(this.name,"] start connect, url:"),t);let g=(r=this.store)===null||r===void 0?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var y;this._websocketUrl=mD(t);let v=await this.chooseBestWebsocketConnection(t);this.websocket=v,c&&c(this.websocket.url),this.websocket.onclose=u,this.websocket.onmessage=h,this.websocket.onerror=m,(y=this.store)===null||y===void 0||y.recordJoinChannelService({endTs:Date.now(),status:"success"},g),this.joinGatewayRecordIndex=g}catch(v){let R=this.state==="closed",b=v instanceof _e,A=b&&v.code===Y.WS_ABORT,F=b&&v.code===Y.WS_ERR,M=b?v.message:v&&(v.reason||v.toString());k.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(M)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:A?"aborted":"error",errors:[v]},g),R||F?(o.reject(R?new _e(Y.WS_DISCONNECT,"websocket is closed: ".concat(M)):new _e(Y.WS_ERR,"init websocket failed: ".concat(M))),F&&k.error("[".concat(this.name,"] init websocket failed: ").concat(M))):u&&u(v)}return o.promise}async reconnectWithAction(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;k.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Cr.isOnline||!Cr.onlineWaiter||(this.onlineReconnectListener=Cr.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let o=!0;if(this.reconnectInterrupter=()=>o=!1,r){let h=Ab(this.reconnectCount,this.retryConfig);k.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(t)),await ze.race([Ci(h),this.onlineReconnectListener||new ze(()=>{})])}if(this._state==="closed"||!o)return!1;this.reconnectCount+=1;let c=async(h,m)=>{this.emit(Ot.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(t==="retry")await c(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);k.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],t)}else t==="recover"&&(k.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await ei(this,Ot.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],t))}catch(h){var u;k.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));let m=h==null||(u=h.data)===null||u===void 0?void 0:u.desc;if(Array.isArray(m)){if(ke(m).call(m,"dynamic key expired"))return this.emit(Ot.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1;if(ke(m).call(m,"request downgrade fallback"))return this.emit(Ot.ON_FALLBACK),!1}return this.reconnectWithAction(t,r)}return!0}}class gD extends cG{constructor(t,r){super(t,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,r){let o=OT(),c=(function(h,m){return new Bhe(h,m)})(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{k.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),o.reject(new _e(Y.WS_ABORT,"choose best websocket aborted"))};let u=z("GATEWAY_DOMAINS");return k.debug("[choose-best-ws] currentDomain: ",t,", domains: ",u,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,r).then(o.resolve).catch(o.reject),o.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class WT extends cG{constructor(t,r){super(t,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,r){return new ze((o,c)=>{let u=!1,h=[];this.closeEstablishingWs=()=>{k.debug("[choose-best-ws] close establishing websockets"),h.forEach(F=>{F.onclose=null,F.onopen=null,F.onmessage=null,F.close()}),c(new _e(Y.WS_ABORT,"choose best websocket aborted"))};let m=z("GATEWAY_DOMAINS"),g,y=t.indexOf("?h="),v=m.find(F=>y!==-1?ke(t).call(t,F,y):ke(t).call(t,F));k.debug("[choose-best-ws] currentDomain: ",v,", domains: ",m);let R=!this.tryDoubleDomain||!v;if(!R&&v){var b;let F=Date.now();try{m.forEach(M=>{let j=y===-1?t.replace(v,M):t.substr(0,y)+t.substr(y).replace(v,M),K=new WebSocket(j);K.binaryType="arraybuffer",h.push(K),k.debug("[choose-best-ws] ws is connecting:",K.url)})}catch{for(k.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(M=>M.close());h.length;)h.pop();R=!0}(b=this.store)===null||b===void 0||b.recordJoinChannelService({urls:h.map(M=>M.url),service:"gateway"},r),h.forEach(M=>{M.onopen=()=>{if(u)return;let j=Date.now()-F;k.debug("[choose-best-ws] ws open cost ".concat(j,"ms")),h.filter(K=>K!==M).forEach(K=>{k.debug("[choose-best-ws]close backup websocket: ".concat(K.url)),K.close()}),u=!0,o(M)},M.onclose=j=>{g=j,!u&&(h.find(K=>!(K.readyState===WebSocket.CLOSED||K.readyState===WebSocket.CLOSING))||(k.debug("[choose-best-ws] all websocket is closed"),u=!0,c(g)))},M.onmessage=j=>{k.debug("[choose-best-ws]".concat(M.url," onmessage: ").concat(j.data))}}),Ci(this.forceCloseTimeout).then(()=>{h.forEach(M=>{M.readyState!==WebSocket.OPEN&&M.close()})})}if(R){var A;let F;k.debug("[choose-best-ws] use single url: ",t),(A=this.store)===null||A===void 0||A.recordJoinChannelService({urls:[t],service:"gateway"},r);try{F=new WebSocket(t),h.push(F),F.binaryType="arraybuffer"}catch(M){let j=new _e(Y.WS_ERR,"init websocket failed! Error: ".concat(M.toString()));return k.error("[".concat(this.name,"]").concat(j)),void c(j)}F.onopen=()=>{o(F)},F.onclose=M=>{c(M)},F.onmessage=M=>{k.debug("[choose-best-ws]".concat(F.url," onmessage: ").concat(M.data))},Ci(this.forceCloseTimeout).then(()=>{F&&F.readyState!==WebSocket.OPEN&&F.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class lG extends dr{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===nn.CONNECTED?this.emit(rt.WS_CONNECTED):t===nn.RECONNECTING?this.emit(rt.WS_RECONNECTING,this._websocketReconnectReason):t===nn.CLOSED&&this.emit(rt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,r){super(),V(this,"__name__","AgoraRTCSignal"),V(this,"_disconnectedReason",void 0),V(this,"_websocketReconnectReason",void 0),V(this,"_connectionState",nn.CLOSED),V(this,"reconnectToken",void 0),V(this,"websocket",void 0),V(this,"openConnectionTime",void 0),V(this,"clientId",void 0),V(this,"lastMsgTime",Date.now()),V(this,"uploadCache",[]),V(this,"uploadCacheInterval",void 0),V(this,"rttRolling",new Tk(5)),V(this,"pingpongTimer",void 0),V(this,"wsInflateDataTimer",void 0),V(this,"pingpongTimeoutCount",0),V(this,"ortc",void 0),V(this,"joinResponse",void 0),V(this,"multiIpOption",void 0),V(this,"initError",void 0),V(this,"spec",void 0),V(this,"store",void 0),V(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(rt.ON_BINARY_DATA,o.data);let c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){let u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===wt.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===wt.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(tn.UID_BANNED);break;case 15:this.close(tn.IP_BANNED);break;case 16:this.close(tn.CHANNEL_BANNED)}if(c._type===wt.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case pt.ERR_LICENSE_MISSING:this.close(tn.LICENSE_MISSING);break;case pt.ERR_LICENSE_EXPIRED:this.close(tn.LICENSE_EXPIRED);break;case pt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(tn.LICENSE_MINUTES_EXCEEDED);break;case pt.ERR_LICENSE_PERIOD_INVALID:this.close(tn.LICENSE_PERIOD_INVALID);break;case pt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(tn.LICENSE_MULTIPLE_SDK_SERVICE);break;case pt.ERR_LICENSE_ILLEGAL:this.close(tn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=r,this.websocket=new gD("gateway-".concat(this.clientId),this.spec.retryConfig,!0,z("JOIN_GATEWAY_USE_DUAL_DOMAIN"),z("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===nn.CONNECTED&&this.reconnect("retry",ts.OFFLINE)})}async request(t,r,o,c){let u=In(6,""),h={_id:u,_type:t,_message:r},m=this.websocket.connectionID,g=()=>new ze((F,M)=>{if(this.connectionState===nn.CONNECTED)return F();let j=()=>{this.off(rt.WS_CLOSED,K),F()},K=()=>{this.off(rt.WS_CONNECTED,j),M(new he(Y.WS_ABORT))};this.once(rt.WS_CONNECTED,j),this.once(rt.WS_CLOSED,K),t!==ct.PUBLISH&&t!==ct.PUBLISH_DATASTREAM&&t!==ct.SUBSCRIBE&&t!==ct.SUBSCRIBE_DATASTREAM&&t!==ct.UNSUBSCRIBE&&t!==ct.UNSUBSCRIBE_DATASTREAM&&t!==ct.UNPUBLISH&&t!==ct.UNPUBLISH_DATASTREAM&&t!==ct.CONTROL&&t!==ct.RESTART_ICE||this.once(rt.DISCONNECT_P2P,()=>{M(new he(Y.DISCONNECT_P2P))}),t!==ct.PUBLISH&&t!==ct.RESTART_ICE||this.once(rt.ABORT_P2P_EXECUTION,()=>{M(new he(Y.DISCONNECT_P2P))})});if(this.connectionState!==nn.CONNECTING&&this.connectionState!==nn.RECONNECTING||t===ct.JOIN||t===ct.REJOIN||await g(),this.websocket.sendMessage(h,!0),c)return;let y=new ze((F,M)=>{let j=!1,K=(Q,se)=>{j=!0,F({isSuccess:Q==="success",message:se||{}}),this.off(rt.WS_CLOSED,q),this.off(rt.WS_RECONNECTING,q),this.emit(rt.REQUEST_SUCCESS,t,r)};this.once("res-@".concat(u),K);let q=()=>{M(new he(Y.WS_ABORT,"type: ".concat(t))),this.off(rt.WS_CLOSED,q),this.off(rt.WS_RECONNECTING,q),this.off("res-@".concat(u),K)};this.once(rt.WS_CLOSED,q),this.once(rt.WS_RECONNECTING,q),Ci(z("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||j||(k.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(rt.REQUEST_TIMEOUT,t,r))})}),v=null;try{v=await y}catch(F){if(this.connectionState===nn.CLOSED||t===ct.LEAVE)throw new he(Y.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?F.throw():t===ct.JOIN||t===ct.REJOIN?null:(await g(),await this.request(t,r))}if(v.isSuccess)return v.message;let R=Number(v.message.error_code||v.message.code),b=Xm(R),A=new he(Y.UNEXPECTED_RESPONSE,"".concat(b.desc,": ").concat(v.message.error_str),{code:R,data:v.message,desc:b.desc});return b.action==="success"?v.message:(k.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(R,", message: ").concat(b.desc,", action: ").concat(b.action)),R===pt.ERR_TOO_MANY_BROADCASTERS?((t===ct.JOIN||t===ct.REJOIN)&&(this.initError=A,this.close()),A.throw()):b.action==="failed"?A.throw():b.action==="quit"?(this.initError=A,this.close(),A.throw()):(R===pt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=v.message.option,k.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",ts.MULTI_IP)):this.reconnect(b.action,ts.SERVER_ERROR),t===ct.JOIN||t===ct.REJOIN?null:await this.request(t,r)))}waitMessage(t,r){return new ze(o=>{let c=u=>{(!r||r(u))&&(this.off(t,c),o(u))};this.on(t,c)})}uploadWRTCStats(t){if(!this.store.sessionId)return void k.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(qm.WRTC_STATS,r)}upload(t,r){let o={_type:t,_message:r};try{this.websocket.sendMessage(o)}catch{let c=z("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>c&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==nn.CONNECTED)return;let u=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(u._type,u._message)},z("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,r){let o={_type:t,_message:r};this.websocket.sendMessage(o)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ze((r,o)=>{this.once(rt.WS_CONNECTED,()=>r(this.joinResponse)),this.once(rt.WS_CLOSED,c=>o(this.initError||new he(Y.WS_ABORT,c))),this.connectionState=nn.CONNECTING,this.websocket.init(t).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||tn.LEAVE,this.connectionState=nn.CLOSED,k.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(rt.ABORT_P2P_EXECUTION),this.store.signalConnected();let t=await ei(this,rt.REQUEST_JOIN_INFO);this.store.joinReq();let r=await this.request(ct.JOIN,t);if(this.ortc=t?.ortc,this.store.joinRep(),!r)return this.emit(rt.REPORT_JOIN_GATEWAY,nI.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(rt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=nn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new he(Y.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let t=xm(this,rt.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;let r=await this.request(ct.REJOIN,t);return!!r&&(this.connectionState=nn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),r.peers&&r.peers.forEach(o=>{this.emit(wt.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(wt.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(wt.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(wt.MUTE_AUDIO,{uid:o.uid}):this.emit(wt.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(wt.MUTE_VIDEO,{uid:o.uid}):this.emit(wt.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(wt.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(wt.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(wt.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(wt.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(wt.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(t,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,r)}async downgradeCodec(t){if(!this.ortc)return!1;let r={downgrade_codec:t,ortc:this.ortc};return!!await this.request(ct.DOWNGRADE_CODEC,r)}handleNotification(t){k.debug("[".concat(this.clientId,"] receive notification: "),t);let r=Xm(t.code);if(t.code===28&&"detail"in t&&(k.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(rt.RECOVER_NOTIFICATION,t.detail)),r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?t.code===pt.ERR_REPEAT_JOIN_CHANNEL&&z("IGNORE_UID_CHECK")?void this.close(tn.UID_CONFLICT):(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(tn.UID_BANNED),void this.close()):t.code===pt.K_VOS_FALLBACK&&"detail"in t?(k.info("[".concat(this.clientId,"] receive vos fallback notification: "),t.detail),t.detail==="FALLBACKCN"&&z("ENABLE_QUALITY_FALLBACK")?void ei(this,rt.VOS_FALLBACK_PROMISE,t.detail).then(()=>{this.reconnect("recover",r.desc)}).catch(o=>{k.debug("[".concat(this.clientId,"] cancel vos fallback cn, error: "),o)}):t.detail==="fallback_hls"&&z("ENABLE_FALLBACK_TO_HLS")?(this.emit(rt.VOS_FALLBACK,t.detail),void this.close(tn.FALLBACK_TO_HLS)):this.reconnect(r.action,r.desc)):void this.reconnect(r.action,ts.SERVER_ERROR);k.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=z("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=t&&(k.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>z("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ts.TIMEOUT):this.request(ct.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let o=Date.now()-r;this.rttRolling.add(o),z("REPORT_STATS")&&this.send(ct.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWsInflateData(){let{wsInflateLength:t,wsDeflateLength:r}=this.websocket.getWsInflateData();t!==0&&r!==0&&this.upload(qm.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Ot.RECONNECT_CREATE_CONNECTION,t=>{this.emit(rt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Ot.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ot.CLOSED,()=>{this.connectionState=nn.CLOSED}),this.websocket.on(Ot.FAILED,()=>{this._disconnectedReason=tn.NETWORK_ERROR,this.connectionState=nn.CLOSED}),this.websocket.on(Ot.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===nn.CONNECTED?this.connectionState=nn.RECONNECTING:this.connectionState=nn.CONNECTING}),this.websocket.on(Ot.WILL_RECONNECT,(t,r,o)=>{let c=xm(this,rt.IS_P2P_DISCONNECTED),u=c||t!=="retry";c&&t==="retry"&&(k.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",r=nI.P2P_DISCONNECTED),u&&(k.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(rt.REPORT_JOIN_GATEWAY,r||nI.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(rt.DISCONNECT_P2P)),o(t)}),this.websocket.on(Ot.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{k.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",ts.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(rt.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof he){if(t.code===Y.UNEXPECTED_RESPONSE&&t.data.code===pt.ERR_NO_AUTHORIZED)return this.initError=new he(Y.TOKEN_EXPIRE,"dynamic key expired"),void this.close(tn.TOKEN_EXPIRE);k.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ts.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(Ot.REQUEST_NEW_URLS,(t,r)=>{ei(this,rt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(r)}),this.websocket.on(Ot.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(wt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(li.PRE_CONNECT_PC,()=>{this.emit(rt.PRE_CONNECT_PC)}),this.websocket.on(Ot.ON_FALLBACK,()=>{z("ENABLE_FALLBACK_TO_HLS")&&this.emit(rt.VOS_FALLBACK,"fallback_hls")})}}let Whe=(function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e})({}),Yr=(function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e})({});function uG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function sI(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?uG(Object(r),!0).forEach(function(o){V(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uG(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}let _D=0;function Xc(e){let t=z("TURN_DOMAINS");_D=(_D+1)%t.length;let r=t[_D]||"edge.agora.io";return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(r):(k.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function oI(e){try{let t=z("TURN_DOMAINS"),r=z("GATEWAY_DOMAINS").concat(t).find(o=>ke(e).call(e,o));return r?e.split(".".concat(r))[0].replace(/-/g,"."):e}catch{return k.debug("serverUrlToIp error, fallback to url",e),e}}function ED(e,t){e.addresses||(e.addresses=[]);let r=(function(m,g){if(z("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map(R=>{let{ip:b,port:A}=R;return{address:"".concat(b,":").concat(A)}});let y=z("GATEWAY_DOMAINS"),v=y[1]&&ke(g).call(g,y[1])?1:0;return m.map(R=>{let{domain_prefix:b,port:A,ip:F}=R;if(b)return{address:"".concat(b,".").concat(y[v++%y.length],":").concat(A)};let M=/^[\.\:\d]+$/.test(F),j=M?"".concat(F.replace(/[^\d]/g,"-"),".").concat(y[v++%y.length],":").concat(A):"".concat(F,":").concat(A);return M||k.debug("Cannot recognized as ip address: ".concat(F,", use as host3")),{ip:F,port:A,address:j}})})(e.addresses,t),o=Array.isArray(e.detail)&&e.detail[18];if(o&&typeof o=="string"){let m=o.split(";");for(let g=0;g<m.length;g++){var c;let y=Bs(c=m[g]).call(c);r[g]&&y&&(r[g].ip6=y)}}let u=e.detail&&e.detail.candidate,h;if(u){let[m,g]=u.split(":");m&&g&&(h={port:Number(g),ip:m,address:"".concat(m,":").concat(g)})}return{gatewayAddrs:r,apGatewayAddress:h,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function ho(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function dG(e){let t=e._encoderConfig;if(!t)return{};let r={resolution:t.width&&t.height?"".concat(ho(t.width),"x").concat(ho(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(r.maxFrameRate=t.frameRate,r.minFrameRate=t.frameRate):t.frameRate&&(r.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,r.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),r}function aI(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function GT(e,t){let r,o,c;switch(t){case Yr.CHOOSE_SERVER:o=4096,c="choose server";break;case Yr.CLOUD_PROXY:o=1048576,c="proxy";break;case Yr.CLOUD_PROXY_5:o=4194304,c="proxy5";break;case Yr.CLOUD_PROXY_FALLBACK:o=4194310,c="proxy fallback";break;default:throw new he(Y.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(u=>{u.buffer&&u.buffer.flag===o&&(r={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map(h=>sI(sI({},h),{},{ticket:u.buffer.cert})),server_ts:e.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:sI(sI({},u.buffer.detail),e.detail),flag:u.buffer.flag,opid:e.opid,cert:u.buffer.cert})}),!r)throw new he(Y.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return r}async function hG(e,t){return await ze.all(e.addresses.map(async r=>({address:Xc(r.ip),tcpport:r.port,udpport:r.port,username:t&&z("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():ns.username,password:t&&z("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await mk(t.toString()):ns.password})))}function yD(e,t){let r=t.getMediaStreamTrack(!0).getSettings(),o=t.videoHeight||r.height,c=t.videoWidth||r.width;return o&&c?Math.max(Math.min(o,c)/Math.min(ho(e.height),ho(e.width)),1):(k.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Cp(e){let{candidateType:t,relayProtocol:r,type:o,address:c,port:u,protocol:h}=e,m={candidateType:t,relayProtocol:r,protocol:h};if(o!=="local-candidate"){let g=c.split(".");g.length>=4&&(g[1]="*",g[2]="*"),m.address=g.join("."),m.port=u}return m}function ed(e){let t=e.split(":"),r=e.split(/[-.]/),o=ke(e).call(e,"-")?"-":".",c=e;return t.length>1?r.length>1?(r[1]="**",c=r[0]+o+"**:"+t[t.length-1]):c=t.length>2?t[0]+o+"**:"+t[t.length-1]:"**:"+t[t.length-1]:r.length>1&&(c=r[0]+o+"**"),c}function pG(e,t){return e.getTransceivers().find(r=>r.sender.track===t||r.receiver.track===t)}function HT(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:z("SVC_MODE");if(z("ENABLE_SVC"))return(function(t){return t in Pb})(e)?e:Pb.L1T3}let fG={[et.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[et.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function mG(e){e.send&&(JE(et.VIDEO,e.send.videoExtensions),JE(et.AUDIO,e.send.audioExtensions)),e.recv&&(JE(et.VIDEO,e.recv.videoExtensions),JE(et.AUDIO,e.recv.audioExtensions)),e.sendrecv&&(JE(et.VIDEO,e.sendrecv.videoExtensions),JE(et.AUDIO,e.sendrecv.audioExtensions))}function gG(e,t){e.send&&(cI(et.VIDEO,e.send.videoExtensions,t.send.videoExtensions),cI(et.AUDIO,e.send.audioExtensions,t.send.audioExtensions)),e.recv&&(cI(et.VIDEO,e.recv.videoExtensions,t.recv.videoExtensions),cI(et.AUDIO,e.recv.audioExtensions,t.recv.audioExtensions))}function cI(e,t,r){t.forEach(o=>{var c;let u=fG[e].find(m=>{var g;let{key:y}=m;return ke(g=o.extensionName).call(g,y)});if(!u)return;let h=r.find(m=>{let{extensionName:g}=m;return ke(g).call(g,u.key)});h&&ke(c=h.extensionName).call(c,"gdpr_forbidden")&&(o.extensionName=h.extensionName)})}function JE(e,t){t.forEach(r=>{var o;let c=fG[e].find(u=>{var h;let{key:m}=u;return ke(h=r.extensionName).call(h,m)});ke(o=r.extensionName).call(o,"gdpr_forbidden")&&c&&(r.extensionName=c.extensionName)})}function _G(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||ke(e).call(e,"abs-send-time")}function lI(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||ke(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function EG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function yG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?EG(Object(r),!0).forEach(function(o){V(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):EG(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}function zT(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0,{filterRTX:c,filterVideoFec:u,filterAudioFec:h,filterAudioCodec:m,filterVideoCodec:g,unsupportedVideoUplinkCodec:y,unsupportedVideoDownlinkCodec:v}=t,{useXR:R}=r,b=[],A=[],F=[],M=[],j=!1,K=!1;if(Hs(e).mediaDescriptions.forEach(Q=>{o&&o!==Q.attributes.direction||(Q.media.mediaType!=="video"||j||(A=Q.attributes.payloads,M=Q.attributes.extmaps,j=!0),Q.media.mediaType!=="audio"||K||(b=Q.attributes.payloads,F=Q.attributes.extmaps,K=!0))}),!M||A.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!F||b.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(A.forEach(Q=>{var se;(se=Q.rtpMap)!==null&&se!==void 0&&se.clockRate&&(Q.rtpMap.clockRate=parseInt(Q.rtpMap.clockRate)),R&&Q.rtcpFeedbacks.push({type:"rrtr"})}),b.forEach(Q=>{var se;(se=Q.rtpMap)!==null&&se!==void 0&&se.clockRate&&(Q.rtpMap.clockRate=parseInt(Q.rtpMap.clockRate)),R&&Q.rtcpFeedbacks.push({type:"rrtr"})}),c&&(b=b.filter(Q=>{var se;return((se=Q.rtpMap)===null||se===void 0?void 0:se.encodingName.toLowerCase())!=="rtx"}),A=A.filter(Q=>{var se;return((se=Q.rtpMap)===null||se===void 0?void 0:se.encodingName.toLowerCase())!=="rtx"})),u){let Q=A.filter(te=>{var de;return/(red)|(ulpfec)|(flexfec)/i.test(((de=te.rtpMap)===null||de===void 0?void 0:de.encodingName)||"")}),se=Rp(Q,A).map(te=>te.payloadType),oe=[...Q.map(te=>te.payloadType),...se];A=A.filter(te=>!ke(oe).call(oe,te.payloadType))}if(h&&(b=b.filter(Q=>{var se;return!/(red)|(ulpfec)|(flexfec)/i.test(((se=Q.rtpMap)===null||se===void 0?void 0:se.encodingName)||"")})),m&&m?.length>0&&(b=b.filter(Q=>{var se;return ke(m).call(m,((se=Q.rtpMap)===null||se===void 0?void 0:se.encodingName.toLowerCase())||"")})),g&&g?.length>0){let Q=A.filter(se=>{var oe;return ke(g).call(g,((oe=se.rtpMap)===null||oe===void 0?void 0:oe.encodingName.toLowerCase())||"")});A=Q.concat(c?[]:Rp(Q,A))}let q=z("UNSUPPORTED_VIDEO_CODEC");if(q&&q.length>0){let Q=A.filter(te=>te.rtpMap&&ke(q).call(q,te.rtpMap.encodingName.toLowerCase())),se=Rp(Q,A),oe=Q.concat(se).map(te=>te.payloadType);A=A.filter(te=>!ke(oe).call(oe,te.payloadType)),k.debug("unsupportedVideoCodec: ".concat(q,", toBeRemoved: ").concat(oe))}if(y&&y.length>0&&o==="sendonly"){let Q=A.filter(te=>te.rtpMap&&ke(y).call(y,te.rtpMap.encodingName.toLowerCase())),se=Rp(Q,A),oe=Q.concat(se).map(te=>te.payloadType);A=A.filter(te=>!ke(oe).call(oe,te.payloadType)),k.debug("unsupportedVideoUplinkCodec: ".concat(y,", toBeRemoved: ").concat(oe))}if(v&&v.length>0&&o==="recvonly"){let Q=A.filter(te=>te.rtpMap&&ke(v).call(v,te.rtpMap.encodingName.toLowerCase())),se=Rp(Q,A),oe=Q.concat(se).map(te=>te.payloadType);A=A.filter(te=>!ke(oe).call(oe,te.payloadType)),k.debug("unsupportedVideoDownlinkCodec: ".concat(v,", toBeRemoved: ").concat(oe))}return{audioCodecs:b,videoCodecs:A,audioExtensions:F,videoExtensions:M}}function td(e){let t=Hs(e),r,o;for(let c of t.mediaDescriptions){if(!r){let u=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!u||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");r={iceUfrag:u,icePwd:h}}if(!o){let u=c.attributes.fingerprints;u.length>0&&(o={fingerprints:u})}}if(!o&&t.attributes.fingerprints.length>0&&(o={fingerprints:t.attributes.fingerprints}),!o||!r)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:r,dtlsParameters:o}}function vD(e,t){let r=[],o=e.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=e.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),u=e.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var m;let g=(m=o.find(y=>y.ssrcIds[0]===h))===null||m===void 0?void 0:m.ssrcIds[1];r.push({ssrcId:h,rtx:t?g:void 0})});else if(o.length>0){let h=o[0].ssrcIds[0],m=o[0].ssrcIds[1];r.push({ssrcId:h,rtx:t?m:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");r.push({ssrcId:u[0].ssrcId})}return r}function vG(e,t,r){let{cname:o}=e,c=[];t&&(c=SG(t)),c.length===0&&(c=e.iceParameters.candidates.map(v=>({foundation:v.foundation,componentId:"1",transport:v.protocol,priority:v.priority.toString(),connectionAddress:v.ip,port:v.port.toString(),type:v.type,extension:{}})),k.debug("Using candidates from gateway."));let u={fingerprints:e.dtlsParameters.fingerprints.map(v=>({hashFunction:v.algorithm,fingerprint:v.fingerprint}))},h={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd},m;switch(e.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}let g=YT(e.rtpCapabilities),y=[];return Array.isArray(r)&&r.length>0&&r.forEach(v=>{y.push({kind:et.VIDEO,ssrcMsg:[{ssrcId:v.v,rtx:v.v_rtx}],mslabel:"".concat(v.v,"_").concat(v.a)},{kind:et.AUDIO,ssrcMsg:[{ssrcId:v.a}],mslabel:"".concat(v.v,"_").concat(v.a)})}),{dtlsParameters:u,iceParameters:h,candidates:c,rtpCapabilities:g,setup:m,cname:o,preSSRCs:y}}function SG(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],k.debug("Using remote candidate from AP ".concat(ed(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),k.debug("Using IPV6 remote candidate from AP ".concat(ed(e.ip6),":").concat(e.port)))),t}function KT(e,t,r){let o=[],c=[];return e.forEach(u=>{let{ssrcId:h,rtx:m}=u,g=In(8,"track-"),y={ssrcId:h,attributes:yG({label:g,mslabel:r=r||In(10,""),msid:"".concat(r," ").concat(g)},t&&{cname:t})};if(o.push(y),m!==void 0){let v={ssrcId:m,attributes:yG({label:g,mslabel:r,msid:"".concat(r," ").concat(g)},t&&{cname:t})};o.push(v),c.push({semantic:"FID",ssrcIds:[h,m]})}}),e.length>1&&c.push({semantic:"SIM",ssrcIds:e.map(u=>{let{ssrcId:h}=u;return h})}),{ssrcs:o,ssrcGroups:c}}function Jm(e,t){t instanceof Nr&&e.attributes.payloads.forEach(r=>{var o;let c=(o=r.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;r.fmtp||(r.fmtp={parameters:{}}),c==="opus"&&typeof z("OPUS_PTIME")=="number"?r.fmtp.parameters.ptime=z("OPUS_PTIME"):r.fmtp.parameters.minptime="10",r.fmtp.parameters.useinbandfec="1";let u=t._encoderConfig;u&&(c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(u.bitrate&&!Qn()&&(r.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(r.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),r.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1")),t instanceof jT&&c==="opus"&&t._config.DTX&&(r.fmtp.parameters.usedtx="1"))})}function SD(e){let t=e.attributes.unrecognized.findIndex(r=>r.attField==="x-google-flag"&&r.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function TD(e,t){var r;if(e.attributes.payloads.forEach(c=>{var u;((u=c.rtpMap)===null||u===void 0?void 0:u.encodingName.toLowerCase())==="h264"&&c.fmtp&&c.fmtp.parameters&&z("ENABLE_UP_SPS_PPS")&&(c.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),!(t instanceof jn&&t._encoderConfig&&t._hints.indexOf(bn.SCREEN_TRACK)===-1))return;let o=t._encoderConfig;Qt().supportMinBitrate&&o.bitrateMin&&e.attributes.payloads.forEach(c=>{var u,h;ke(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(o.bitrateMin))}),Qt().supportMinBitrate&&!ke(r=t._hints).call(r,bn.LOW_STREAM)&&o.bitrateMax&&e.attributes.payloads.forEach(c=>{var u,h;ke(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(z("X_GOOGLE_START_BITRATE")||Math.floor(o.bitrateMax)))})}function TG(e){if(e.media.mediaType!=="video")return;let t=pn();if(t.name!==_n.SAFARI&&t.os!==wi.IOS)return;let r=e.attributes.extmaps.findIndex(o=>/video-orientation/g.test(o.extensionName));r!==-1&&e.attributes.extmaps.splice(r,1)}function uI(e,t,r){if(!t)return;let o,c;if(e.media.mediaType==="video"?(o=r.videoExtensions,c=r.videoCodecs):(o=r.audioExtensions,c=r.audioCodecs),t.twcc===!0){let u=o.find(h=>lI(h.extensionName));if(u){let h=u.extensionName;e.attributes.extmaps.find(m=>lI(m.extensionName))||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),(function(m,g){return g.filter(y=>!!m.find(v=>v.payloadType===y.payloadType&&!!v.rtcpFeedbacks.find(R=>R.type==="transport-cc")))})(c,e.attributes.payloads).forEach(m=>{m.rtcpFeedbacks.find(g=>g.type==="transport-cc")||m.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){let u=e.attributes.extmaps.findIndex(h=>lI(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{let m=h.rtcpFeedbacks.findIndex(g=>g.type==="transport-cc");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}if(t.remb===!0){let u=o.find(h=>_G(h.extensionName));if(u){let h=u.extensionName;e.attributes.extmaps.find(m=>m.extensionName===h)||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),(function(m,g){return g.filter(y=>!!m.find(v=>v.payloadType===y.payloadType&&!!v.rtcpFeedbacks.find(R=>R.type==="goog-remb")))})(c,e.attributes.payloads).forEach(m=>{m.rtcpFeedbacks.find(g=>g.type==="goog-remb")||m.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){let u=e.attributes.extmaps.findIndex(h=>_G(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{let m=h.rtcpFeedbacks.findIndex(g=>g.type==="goog-remb");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}}function wD(e,t,r){if(Qn()||e.media.mediaType!=="video"||!(t instanceof jn)||r!=="vp9"&&r!=="vp8"||r==="vp8"&&!z("SIMULCAST")||r==="vp9"&&z("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;let o=r==="vp8"?2:t._scalabilityMode.numSpatialLayers,c=e.attributes.ssrcs[0],u=e.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let m=1;m<o;m++)e.attributes.ssrcs.push({ssrcId:c.ssrcId+m,attributes:Zn(c.attributes)}),h.ssrcIds.push(c.ssrcId+m),u&&(e.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+m,attributes:Zn(c.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+m,u.ssrcIds[1]+m]}));e.attributes.ssrcGroups.unshift(h)}async function wG(){try{let e=new RTCPeerConnection;e.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:Pb.L1T3}]});let t=await e.createOffer();if(!t.sdp)return void e.close();let r=Hs(t.sdp).mediaDescriptions[0];if(!r)return;let o=r.attributes.extmaps.find(c=>c.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return e.close(),o}catch{return}}async function CD(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=new RTCPeerConnection;r.addTransceiver("video",{direction:"sendonly"}),r.addTransceiver("audio",{direction:"sendonly"}),r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"});let o=(await r.createOffer()).sdp,{send:c,recv:u,sendrecv:h}=(function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0,v=zT(y,m,g,"sendonly"),R=zT(y,m,g,"recvonly"),b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},F={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Jc(v,R,"videoExtensions",b,A,F),Jc(v,R,"videoCodecs",b,A,F),Jc(v,R,"audioExtensions",b,A,F),Jc(v,R,"audioCodecs",b,A,F),z("RAISE_H264_BASELINE_PRIORITY")){let M=[],j=[];if(F.videoCodecs.forEach((K,q)=>{var Q;if(((Q=K.rtpMap)===null||Q===void 0?void 0:Q.encodingName.toLocaleLowerCase())==="h264"){var se,oe;let te=F.videoCodecs[q+1],de=te&&IG(K,te),Ce=(se=K.fmtp)===null||se===void 0?void 0:se.parameters["profile-level-id"],Pe=(oe=K.fmtp)===null||oe===void 0?void 0:oe.parameters["packetization-mode"];!Ce||Ce!==z("FIRST_H264_PROFILE_LEVEL_ID")||z("FIRST_PACKETIZATION_MODE")&&Pe!==z("FIRST_PACKETIZATION_MODE")?de?j.push([K,te]):j.push([K]):de?M.push([K,te]):M.push([K])}}),M.length>0&&j.length>0){k.debug("raising H264 baseline profile priority"),F.videoCodecs.forEach((q,Q)=>{var se;if(((se=q.rtpMap)===null||se===void 0?void 0:se.encodingName.toLocaleLowerCase())==="h264"){let oe=IG(q,F.videoCodecs[Q+1]),te=M.shift()||j.shift()||[];te.length>0&&(oe?F.videoCodecs.splice(Q,2,...te):F.videoCodecs.splice(Q,1,...te))}});let K=A.videoCodecs.filter(q=>{var Q,se;return((Q=q.rtpMap)===null||Q===void 0?void 0:Q.encodingName.toLocaleLowerCase())==="h264"&&((se=q.fmtp)===null||se===void 0?void 0:se.parameters["profile-level-id"])!==z("FIRST_H264_PROFILE_LEVEL_ID")});if(K.length>0){let q=Rp(K,A.videoCodecs).map(se=>se.payloadType),Q=[...K.map(se=>se.payloadType),...q];A.videoCodecs=A.videoCodecs.filter(se=>!ke(Q).call(Q,se.payloadType))}z("FILTER_SEND_H264_BASELINE")&&(b.videoCodecs=b.videoCodecs.filter(q=>{var Q,se;return!(((Q=q.rtpMap)===null||Q===void 0?void 0:Q.encodingName.toLocaleLowerCase())==="h264"&&((se=q.fmtp)===null||se===void 0?void 0:se.parameters["profile-level-id"])!==z("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:b,recv:A,sendrecv:F}}return{send:b,recv:A,sendrecv:F}})(e,t,o);try{r.close()}catch{}return{send:c,recv:u,sendrecv:h}}function CG(){let e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=zT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Jc(e,t,"videoExtensions",r,o,c),Jc(e,t,"videoCodecs",r,o,c),Jc(e,t,"audioExtensions",r,o,c),Jc(e,t,"audioCodecs",r,o,c),z("RAISE_H264_BASELINE_PRIORITY")){let u=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(u!==-1){let h=c.videoCodecs.findIndex(m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<u){k.debug("raising H264 baseline profile priority");let m=c.videoCodecs[u];c.videoCodecs.splice(u,1),c.videoCodecs.splice(h,0,m)}h!==-1&&(o.videoCodecs=o.videoCodecs.filter(m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:r,recv:o,sendrecv:c}}function Jc(e,t,r,o,c,u){if(r==="videoExtensions"||r==="audioExtensions"){let h=[];return e[r].forEach(m=>{t[r].some((g,y)=>{if(m.entry===g.entry&&m.extensionName===g.extensionName)return h.push(y),!0})?u[r].push(m):o[r].push(m)}),void t[r].forEach((m,g)=>{h.indexOf(g)===-1&&c[r].push(m)})}if(r==="videoCodecs"||r==="audioCodecs"){let h=[];return e[r].forEach(m=>{t[r].some((g,y)=>{if(m.payloadType===g.payloadType&&JSON.stringify(m)===JSON.stringify(g))return h.push(y),!0})?u[r].push(m):o[r].push(m)}),void t[r].forEach((m,g)=>{h.indexOf(g)===-1&&c[r].push(m)})}}function YT(e){let{send:t,recv:r,sendrecv:o}=e;if(!o){if(!t||!r)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:r}}let c,u;return t?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...t.audioCodecs,...o.audioCodecs],c.videoCodecs=[...t.videoCodecs,...o.videoCodecs],c.audioExtensions=[...t.audioExtensions,...o.audioExtensions],c.videoExtensions=[...t.videoExtensions,...o.videoExtensions]):c=Zn(o),r?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...r.audioCodecs,...o.audioCodecs],u.videoCodecs=[...r.videoCodecs,...o.videoCodecs],u.audioExtensions=[...r.audioExtensions,...o.audioExtensions],u.videoExtensions=[...r.videoExtensions,...o.videoExtensions]):u=Zn(o),{send:c,recv:u}}function $E(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var r;return((r=t.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function qT(e,t,r,o){let c=[];if(e===et.VIDEO){if(z("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(c=t.videoCodecs.filter(u=>{var h;return ke(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)&&u&&u.fmtp&&u.fmtp.parameters["profile-level-id"]===z("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let u=[],h=[],m=[],g=[];if(r.videoCodecs.forEach(y=>{let v=y.rtpMap&&y.rtpMap.encodingName.toLowerCase()||"";ke(v).call(v,o)?u.push(y):ke(v).call(v,"vp9")?h.push(y):ke(v).call(v,"vp8")?m.push(y):ke(v).call(v,"h264")&&g.push(y)}),u.length===0){let y="";h.length!==0?(u=h,y="vp9"):m.length!==0?(u=m,y="vp8"):g.length!==0&&(u=g,y="h264"),k.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(y))}u.length!==0&&(c=t.videoCodecs.filter(y=>u.some(v=>v.payloadType===y.payloadType)))}if(c.length===0&&(k.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),c=t.videoCodecs),z("USE_PUB_RTX")||z("USE_SUB_RTX")){let u=Rp(c,t.videoCodecs);c=[...c,...u]}}else{c=t.audioCodecs.filter(h=>{var m;return ke(m=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(m,o)});let u=t.audioCodecs.filter(h=>{var m;return ke(m=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(m,"red")});c.length===0&&(k.warning("codec ".concat(o," not included in rtpCapabilities, fallback to opus")),c=t.audioCodecs.filter(h=>{var m;return ke(m=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(m,"opus")})),z("ENABLE_AUDIO_RED")&&u.length!==0&&(c=[...u,...c])}return c}function Rp(e,t){let r=e.map(o=>o.payloadType.toString());return t.filter(o=>o.rtpMap&&o.rtpMap.encodingName==="rtx"&&o.fmtp&&o.fmtp.parameters.apt&&ke(r).call(r,o.fmtp&&o.fmtp.parameters.apt))}async function Oo(e,t,r){let o=t.toString(),c=RG(o,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:o});let u=await e.createAnswer();if(!u.sdp)throw new Error("cannot get answer sdp");let h=u.sdp;h=RD(h,r||{}),c?.(h||""),await e.setLocalDescription({type:"answer",sdp:h})}function RD(e,t,r){if(z("FORBID_MODIFY_LOCAL_OFFER_SDP"))return e;let o=Hs(e),{useXR:c}=t;return o.mediaDescriptions.forEach(u=>{var h;u.attributes.mid&&(Array.isArray(r)&&!ke(r).call(r,u.attributes.mid)||(u.media.mediaType==="audio"&&$E(u),u.media.mediaType==="video"&&(function(m){m.media.mediaType==="video"&&z("ENABLE_DOWN_SPS_PPS")&&m.attributes.payloads.filter(g=>{var y;return((y=g.rtpMap)===null||y===void 0?void 0:y.encodingName.toLowerCase())==="h264"}).forEach(g=>{g.fmtp||(g.fmtp={parameters:{}}),g.fmtp.parameters["sps-pps-idr-in-keyframe"]="1"})})(u),c&&ke(h=["audio","video"]).call(h,u.media.mediaType)&&u.attributes.payloads.forEach(m=>{m.rtcpFeedbacks.findIndex(g=>g.type==="rrtr")===-1&&m.rtcpFeedbacks.push({type:"rrtr"})})))}),th(o)}function RG(e,t,r,o){if(z("SDP_LOGGING"))return k.upload("exchanging ".concat(r," ").concat(t," SDP during P2PConnection.").concat(o,`
`),e),t==="offer"?c=>{RG(c,"answer",r==="local"?"remote":"local",o)}:void 0}async function bG(e,t,r){try{var o;if(!Qt().supportSetRtpSenderParameters||!(function(g){return g==="vp9"||g==="av1"})(e)||!z("ENABLE_SVC"))return;let c={},u={},h=t.getParameters(),m=(o=h.encodings)===null||o===void 0?void 0:o[0];u.scalabilityMode=HT(r),m&&Object.assign(m,u),Object.assign(h,c),await t.setParameters(h),k.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(h.encodings)))}catch(c){k.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",c)}}function dI(e){let t=z("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(r=>ke(e).call(e,r))}function IG(e,t){try{var r;return((r=e.fmtp)===null||r===void 0?void 0:r.parameters.apt)===t.payloadType.toString()}catch{return!1}}function AG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function Qo(e,t){return typeof z(e)===t?z(e):void 0}function Ghe(){try{let e=z("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:(function(t){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?AG(Object(o),!0).forEach(function(c){V(t,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):AG(Object(o)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(o,c))})}return t})({},e)}catch(e){return k.debug("handle gateway attributes failed: ",e),{}}}let OG={};function nd(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&k.debug("install service ".concat(e.name)),OG[e.name]=e}function Yl(e){let t=OG[e];if(!t)throw new _e(Y.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function NG(e,t){return Yl("DataStream").create(e,t)}function hI(){return Yl("InterceptFrame").create()}function PG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function Li(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?PG(Object(r),!0).forEach(function(o){V(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):PG(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}let bD=new Map;class Hhe extends dr{get state(){return this._state}set state(t){if(t===this._state)return;let r=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(Vr.CONNECTION_STATE_CHANGE,t,r,this._disconnectedReason):this.emit(Vr.CONNECTION_STATE_CHANGE,t,r)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){k.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,r){var o,c,u;super(),V(this,"store",void 0),V(this,"joinInfo",void 0),V(this,"key",void 0),V(this,"ntpOffset",0),V(this,"usingProxy",!1),V(this,"signal",void 0),V(this,"role",void 0),V(this,"isPreallocation",void 0),V(this,"isPreSub",void 0),V(this,"inChannelInfo",{joinAt:null,duration:0}),V(this,"spec",void 0),V(this,"_state","DISCONNECTED"),V(this,"_statsCollector",void 0),V(this,"_disconnectedReason",void 0),V(this,"isSignalRecover",!1),V(this,"hasChangeBGPAddress",!1),V(this,"trafficStatsInterval",void 0),V(this,"networkQualityInterval",void 0),V(this,"_joinGatewayStartTime",0),V(this,"_signalTimeout",!1),V(this,"_clientRoleOptions",void 0),V(this,"_isProactiveJoin",!1),this.store=t,this.spec=r,this.signal=this.store.useP2P?(o={spec:Li(Li({},r),{},{retryConfig:r.websocketRetryConfig}),store:t},(c=(u=Yl("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(u,o)):this.store.useDcSignal?(function(h){return Yl("DataChannelSignal").create(h)})({spec:Li(Li({},r),{},{retryConfig:r.websocketRetryConfig}),store:t}):new lG(Li(Li({},r),{},{retryConfig:r.websocketRetryConfig}),t),this._statsCollector=r.statsCollector,this.role=r.role||"audience",this._clientRoleOptions=r.clientRoleOptions,this.handleSignalEvents()}setUsingProxy(t){this.usingProxy=t}async join(t,r,o){if(this.store.useDcSignal){let v=!1;t.cloudProxyServer!=="disabled"?(k.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(t.cloudProxyServer,")")),v=!0):"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length>255||"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length<22?(k.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),v=!0):t.apResponse.addresses.some(R=>R.fingerprint)||z("FINGERPRINT")||(k.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),v=!0),v&&this.resetSignal()}this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);let c=Date.now(),u=bD.get(t.cname);if(u||(u=new Map,bD.set(t.cname,u)),this._isProactiveJoin=!0,u.has(t.uid)){let v=new he(Y.UID_CONFLICT);throw tt.joinGateway(t.sid,{lts:c,succ:!1,ec:v.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer||this.usingProxy,signalChannel:this.store.useDcSignal?"1":"0",preload:t.preload}),v}u.set(t.uid,!0),this.joinInfo=t,this.key=r;let h=0;this.joinGatewayStartTime=c;let m=t.proxyServer,g=this.store.useDcSignal?"datachannel":"websocket";try{k.debug("[".concat(this.store.clientId,"] use ").concat(g," join uid ").concat(h));let v=t.gatewayAddrs.map(b=>{let{address:A}=b,[F,M]=A.split(":"),j={host:F,port:M};return t.proxyServer&&(j.proxy=t.proxyServer),j}),R;R=this.store.useDcSignal?await this.signal.init(t.apResponse.addresses):await this.signal.init(v),h=R.uid,k.debug("[".concat(this.store.clientId,"] ").concat(g," join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(v){var y;throw v.code===Y.INIT_DATACHANNEL_TIMEOUT&&this.signal.__name__==="AgoraRTCSignal"||tt.joinGateway(t.sid,{lts:c,succ:!1,ec:((y=v.data)===null||y===void 0?void 0:y.desc)||v.code,errorMsg:v.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!m||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:t.preload}),v&&v.code===Y.INIT_DATACHANNEL_TIMEOUT?(k.warning("[".concat(this.store.clientId,"] User join datachannel failed"),v.toString()),this.resetSignal(),v):(k.error("[".concat(this.store.clientId,"] User join failed"),v.toString()),u.delete(t.uid),this.signal.close(),v)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),k.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(v=>{k.warning("[".concat(this.store.clientId,"] get traffic stats error"),v.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Vr.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Vr.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Vr.NETWORK_QUALITY,{uplinkNetworkQuality:aI(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:aI(this._statsCollector.trafficStats.B_dnq)}):this.emit(Vr.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],r=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){r!==tn.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==nn.CONNECTED||await(function(o,c){return c===1/0?o:ze.race([o,_de(c)])})(this.signal.request(ct.LEAVE,void 0,!0),3e3)}catch(o){k.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),o)}this.signal.close(r),r!==tn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,r,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let c={state:"offer",p2p_id:this.store.p2pId,ortc:r,mode:this.spec.mode,extend:z("PUB_EXTEND"),twcc:!!z("PUBLISH_TWCC"),rtx:!!z("USE_PUB_RTX")};try{return(await this.signal.request(ct.PUBLISH,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===pt.ERR_PUBLISH_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(t,r),this.publish(t,r,!1);throw u}}async publishDataChannel(t,r,o){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let u={stream_id:r.streamId,ordered:r.ordered?1:0,max_retrans_times:(c=r.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:r.channelId,metadata:r.metadata};try{await this.signal.request(ct.PUBLISH_DATASTREAM,u,!0)}catch(h){if(o&&h.data&&h.data.code===pt.ERR_PUBLISH_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(t,r),this.publishDataChannel(t,r,!1);throw h}}async unpublish(t,r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(ct.UNPUBLISH,{stream_id:r,ortc:t},!0)}catch(o){k.warning("[".concat(this.store.clientId,"] unpublish warning: "),o)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ze.all(t.map(r=>this.signal.request(ct.UNPUBLISH_DATASTREAM,{channel_id:r},!0)))}catch(r){k.warning("unpublish datachannels warning: ",r)}}async presubscribe(t,r,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));let c={stream_id:t,stream_type:r,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!z("SUBSCRIBE_TWCC"),rtx:!!z("USE_SUB_RTX")||void 0,extend:z("SUB_EXTEND"),svc:Array.isArray(z("SVC"))&&z("SVC").length!==0?z("SVC"):void 0};try{return await this.signal.request(ct.PRE_SUBSCRIBE,c,!0)}catch(u){if(o&&u.data&&u.data.code===pt.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),u.toString()),this.presubscribe(t,r,!1);throw u}}async subscribe(t,r,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));let c={stream_id:t,stream_type:r.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!z("SUBSCRIBE_TWCC"),rtx:!!z("USE_SUB_RTX"),extend:z("SUB_EXTEND"),ssrcId:r.ssrcId,svc:Array.isArray(z("SVC"))&&z("SVC").length!==0?z("SVC"):void 0};try{return(await this.signal.request(ct.SUBSCRIBE,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===pt.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(t,r),await this.subscribe(t,r,!1);throw u}}async subscribeDataChannel(t,r,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));let c={uid:t,stream_id:r.id,channel_id:r.datachannelId};try{return void await this.signal.request(ct.SUBSCRIBE_DATASTREAM,c,!0)}catch(u){if(o&&u.data&&u.data.code===pt.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),u.toString()),await this.tryUnsubDataChannelBeforeResub(t,r),await this.subscribeDataChannel(t,r,!1);throw u}}async subscribeAll(t,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));let o={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!z("USE_SUB_RTX"),twcc:!!z("SUBSCRIBE_TWCC"),svc:Array.isArray(z("SVC"))&&z("SVC").length!==0?z("SVC"):void 0};try{return await this.signal.request(ct.SUBSCRIBE_STREAMS,o,!0)}catch(c){if(r&&c.data&&c.data.code===pt.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw c}}async setVideoProfile(t){let r=(function(o){if(!(o.bitrateMax&&o.bitrateMin&&o.frameRate&&o.height&&o.width))return;let c=o.frameRate,u=o.width,h=o.height,m=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(m=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(m=!1)),m?{stream_type:0,width:u,height:h,fps:c,start_bps:1e3*o.bitrateMax,min_bps:1e3*o.bitrateMin,target_bps:1e3*o.bitrateMax}:void 0})(t);if(r)return this.signal.request(ct.SET_VIDEO_PROFILE,r);k.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,r){try{await this.signal.request(ct.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:r},!0)}catch(o){k.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),o)}}async unsubscribeDataChannel(t,r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ze.all(t.map(o=>this.signal.request(ct.UNSUBSCRIBE_DATASTREAM,{stream_id:o,uid:r},!0)))}catch(o){k.warning("unsubscribeDataChannel warning: ",o)}}async massUnsubscribe(t){try{await this.signal.request(ct.UNSUBSCRIBE_STREAMS,t,!0)}catch(r){k.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),r)}}async reconnectPC(t){let{iceParameters:r,dtlsParameters:o,rtpCapabilities:c}=t;return{gatewayEstablishParams:await this.signal.request(ct.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:r,dtlsParameters:o,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(ct.GATEWAY_INFO)}async renewToken(t){await this.signal.request(ct.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,r){r&&(this._clientRoleOptions=Object.assign({},r)),z("CLIENT_ROLE_OPTIONS")&&(k.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(z("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},z("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,r){if(r&&(this._clientRoleOptions=Object.assign({},r)),z("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},z("CLIENT_ROLE_OPTIONS")),k.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(z("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let o,c=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(o=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0;let u=Object.assign({},r);delete u.delay,delete u.level,await this.signal.request(ct.SET_CLIENT_ROLE,Li(Li({role:t,level:c,delay:o},u),{},{client_ts:Date.now()})),this.role=t}async setDualStreamMode(t,r,o){await this.signal.request(ct.SET_DUAL_STREAM_MODE,{mode:t},o,r)}async setRemoteVideoStreamType(t,r){await this.signal.request(ct.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:r})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(ct.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,r){await this.signal.request(ct.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:r})}async pickSVCLayer(t,r){await this.signal.request(ct.PICK_SVC_LAYER,{stream_id:t,spatial_layer:r.spatialLayer,temporal_layer:r.temporalLayer})}async setRTM2Flag(t){await this.signal.request(ct.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,r,o){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,r,o)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Li({},this.inChannelInfo)}async setConfigure(t){if(t&&Array.isArray(t)&&t.length!==0)return this.signal.request(ct.CONFIGURE,t)}async getGatewayVersion(){return(await this.signal.request(ct.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let t=bD.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0),this.usingProxy=!1}updateTurnConfigFromSignal(){if(!this.joinInfo)return;let t=(function(r){let o;return o=r.startsWith("dc")?r.match(/(dc\:\/\/)?([^:]+):(\d+)/):r.match(/(wss\:\/\/)?([^:]+):(\d+)/),o?{username:ns.username,password:ns.password,turnServerURL:o[2],tcpport:parseInt(o[3])+30,udpport:parseInt(o[3])+30,forceturn:!1}:null})((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Li(Li({},ns),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;let t=await this.signal.request(ct.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(r=>{let o=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===r.peer_uid);o&&o.B_st!==r.B_st&&Ib(()=>{this.emit(Vr.STREAM_TYPE_CHANGE,r.peer_uid,r.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var r,o,c,u;if(!this.joinInfo||!this.key)throw new he(Y.UNEXPECTED_ERROR,"can not generate join message, no join info");let h=Object.assign({},this.joinInfo.apResponse),m=z("REPORT_APP_SCENARIO");if(typeof m!="string")try{m=JSON.stringify(m)}catch{m=void 0}var g;m&&m.length>128&&(m=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Vr.UPDATE_GATEWAY_CONFIG),g=this.store.clientId,ke(zE).call(zE,g)||zE.push(g);let y=VT(this.store),v=!((r=this.isPreallocation)===null||r===void 0||!r.call(this)),R=P5(this.store),b=Ghe(),A=Bl(87)||U4()||lk(117),F=((function(){let q=pn();if(q.name!==_n.SAFARI||!q.browserVersion)return!1;let Q=q.browserVersion.split(".");return Number(Q[0])>18||Number(Q[0])===18&&Number(Q[1])>=4})()||B4(18,4,!1))&&uk(18,6,!0)&&this.spec.codec==="h264"&&z("ENABLE_ABSSENDTIME_AS_SENTTS"),M=!(((o=h.detail)===null||o===void 0?void 0:o[3])!=="CN"||!z("ENABLE_QUALITY_FALLBACK"))&&z("ENABLE_QUALITY_FALLBACK"),j=!!z("ENABLE_AP_MULTI_IP")&&((c=h.detail)===null||c===void 0?void 0:c[5])==="multi-ip",K=Li({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Ja,browser:navigator.userAgent,process_id:z("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:j||this.hasChangeBGPAddress,ap_response:h,extend:z("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:m,attributes:{userAttributes:Li(Li({enableEncodedTransform:(!!z("ENABLE_AUDIO_METADATA")||!!z("ENABLE_AUDIO_PTS"))&&A||!!z("ENABLE_AUDIO_TOPN")&&ck(_n.CHROME,87,116)||void 0,enableAudioMetadata:!!z("ENABLE_AUDIO_METADATA")&&A,enableAudioPts:!!z("ENABLE_AUDIO_PTS")&&A,topnSmoothLevel:z("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:z("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:z("TOPN_SWITCH_HOLD_MS"),topnAudioGain:z("TOPN_AUDIO_GAIN"),enableNetworkQualityProbe:this.store.networkQualityProbe,enablePublishedUserList:z("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:z("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Qo("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Qo("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Qo("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:z("USE_PUB_RTX")===!0||z("USE_SUB_RTX")===!0||void 0,disableFEC:z("DISABLE_FEC"),enableNTPReport:!!z("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:R,enableFulllinkAvSync:!!z("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Qo("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!z("FORCE_ENABLE_AUT_CC")||!Mb()&&(!!z("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!z("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Qo("USE_XR","boolean"),enableLossbasedBwe:Qo("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!z("FORCE_ENABLE_AUT_CC")||!Mb()&&(!!z("ENABLE_AUT_CC")||void 0),enableCCFallback:Qo("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:v,preSubNum:y?Qo("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Qo("PUBLISH_TWCC","boolean"),enableSubTWCC:Qo("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Qo("USE_PUB_RTX","boolean"),enableSubRTX:Qo("USE_SUB_RTX","boolean"),enableSubSVC:z("ENABLE_SVC")?z("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(z("SVC"))&&z("SVC").length!==0?z("SVC"):void 0,enableSvcExtended:z("ENABLE_SVC")&&Array.isArray(z("SVC_EXTENDED"))&&z("SVC_EXTENDED").length!==0?z("SVC_EXTENDED"):void 0,enableVosFallback:z("ENABLE_VOS_FALLBACK"),enableQualityFallback:M},b),{},{audioDuplicate:Qo("ENABLE_AUDIO_RED","boolean")?(u=Qo("AUDIO_DUPLICATE_NUM","number"))!==null&&u!==void 0?u:2:void 0,senttsUsesAbsSendTime:!!F||void 0,enableDualStreamFlag:Qo("ENABLE_DUAL_STREAM_FLAG","boolean")})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(K.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(K.aes_mode=this.joinInfo.aesmode,z("ENCRYPT_AES")?(K.aes_secret=this.joinInfo.aespassword,K.aes_encrypt=!0):K.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(K.aes_salt=this.joinInfo.aessalt)),h.addresses[this.signal.websocket.currentURLIndex]&&(K.ap_response.ticket=h.addresses[this.signal.websocket.currentURLIndex].ticket,delete h.addresses),this.joinInfo.defaultVideoStream!==void 0&&(K.default_video_stream=this.joinInfo.defaultVideoStream),K}getRejoinMessage(){if(!this.joinInfo)throw new he(Y.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(rt.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(rt.WS_RECONNECTING,t=>{this.joinInfo&&tt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||ts.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",tt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(rt.WS_CLOSED,t=>{let r;switch(t){case tn.LEAVE:r=ts.LEAVE;break;case tn.UID_BANNED:case tn.IP_BANNED:case tn.CHANNEL_BANNED:case tn.SERVER_ERROR:r=ts.SERVER_ERROR;break;case tn.FALLBACK:r=ts.FALLBACK;break;case tn.LICENSE_MISSING:case tn.LICENSE_EXPIRED:case tn.LICENSE_MINUTES_EXCEEDED:case tn.LICENSE_PERIOD_INVALID:case tn.LICENSE_MULTIPLE_SDK_SERVICE:case tn.LICENSE_ILLEGAL:case tn.TOKEN_EXPIRE:r=t;break;default:r=ts.NETWORK_ERROR}k.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(r||"undefined -> "+ts.NETWORK_ERROR)),this.joinInfo&&tt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===tn.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r}),this._disconnectedReason=t,t!==tn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(rt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){let t=z("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(k.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(tt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){let t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void k.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));Ln("EVENT_REPORT_DOMAIN",t[1]),Ln("EVENT_REPORT_BACKUP_DOMAIN",t[1]),Ln("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(wt.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(rt.REQUEST_RECOVER,(t,r,o)=>{if(!this.joinInfo)return o(new he(Y.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,ei(this,Vr.REQUEST_NEW_GATEWAY_LIST).then(r).catch(o)}),this.signal.on(rt.REQUEST_JOIN_INFO,async(t,r,o)=>{var c,u,h;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));let m=Zn((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(z("NEW_TURN_MODE")&&m&&((u=this.joinInfo)===null||u===void 0?void 0:u.cloudProxyServer)==="disabled"){var g;let b=m.servers.map(M=>"turnServerURL"in M&&z("USE_TURN_IP")?Li(Li({},M),{},{turnServerURL:oI(M.turnServerURL)}):M),A=(g=m.serversFromGateway)===null||g===void 0?void 0:g.map(M=>z("USE_TURN_IP")?Li(Li({},M),{},{turnServerURL:oI(M.turnServerURL)}):M),F=this.signal.currentURLIndex;b.length>0&&(b=[b[F%b.length]],m.servers=b),Array.isArray(A)&&A.length>0&&(A=[A[0]],m.serversFromGateway=A),k.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(F))}let{iceParameters:y,dtlsParameters:v,rtpCapabilities:R}=await ei(this,Vr.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:m,cloudProxyServer:(h=this.joinInfo)===null||h===void 0?void 0:h.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:y,dtlsParameters:v,rtpCapabilities:R,version:"2"}}))}catch(b){r(b)}}),this.signal.on(rt.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(rt.REPORT_JOIN_GATEWAY,(t,r)=>{if(!this.joinInfo)return;let o,c="";var u;t instanceof he?(o=((u=t.data)===null||u===void 0?void 0:u.desc)||t.code,c=t.message):o=t,tt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:o,errorMsg:c,addr:r,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer||this.usingProxy,signalChannel:this.signal.__name__==="DataChannelSignal"?"1":"0",preload:this.joinInfo.preload})}),this.signal.on(rt.IS_P2P_DISCONNECTED,t=>{t(xm(this,Vr.IS_P2P_DISCONNECTED))}),this.signal.on(rt.DISCONNECT_P2P,()=>{this.emit(Vr.DISCONNECT_P2P)}),this.signal.on(rt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(rt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(rt.JOIN_RESPONSE,t=>{let r=this.getCurrentGatewayAddress();this.emit(Vr.JOIN_RESPONSE,t,r)}),this.signal.on(rt.PRE_CONNECT_PC,async(t,r)=>{if(this.joinInfo){var o,c;this.updateTurnConfigFromSignal();let h=this.getCurrentGatewayAddress(),m=Zn((o=this.joinInfo)===null||o===void 0?void 0:o.turnServer);if(z("NEW_TURN_MODE")&&m&&((c=this.joinInfo)===null||c===void 0?void 0:c.cloudProxyServer)==="disabled"){var u;let y=m.servers.map(b=>"turnServerURL"in b&&z("USE_TURN_IP")?Li(Li({},b),{},{turnServerURL:oI(b.turnServerURL)}):b),v=(u=m.serversFromGateway)===null||u===void 0?void 0:u.map(b=>z("USE_TURN_IP")?Li(Li({},b),{},{turnServerURL:oI(b.turnServerURL)}):b),R=this.signal.currentURLIndex;y.length>0&&(y=[y[R%y.length]],m.servers=y),Array.isArray(v)&&v.length>0&&(v=[v[0]],m.serversFromGateway=v),k.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(R,",in pre pc"))}let g=z("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(h&&g){let y=SG(h);ei(this,Vr.PRE_CONNECT_PC,{candidates:y,fingerprint:g,turnServer:m}).then(v=>{t?.(v)}).catch(r||(()=>{}))}}}),this.signal.on(rt.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof z("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(z("AP_REQUEST_DETAIL"),";").concat(t))}),this.signal.on(rt.VOS_FALLBACK,t=>{this.emit(Vr.VOS_FALLBACK,t)}),this.signal.on(rt.DATACHANNEL_FAILBACK,t=>{k.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(Vr.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(t,r){try{await this.signal.request(ct.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[r]},!0)}catch(o){throw k.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),o),o}}async tryUnsubDataChannelBeforeResub(t,r){try{await this.signal.request(ct.UNSUBSCRIBE,{stream_id:r.id},!0)}catch(o){throw k.warning("unsubscribe datachannel warning",o),o}}async tryUnpubBeforeRepub(t,r){try{await this.signal.request(ct.UNPUBLISH,{stream_id:t,ortc:r},!0)}catch(o){throw k.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),o),o}}async tryUnpubDataChannelBeforeRepub(t,r){try{await this.signal.request(ct.UNPUBLISH_DATASTREAM,{channnel_id:r.channelId},!0)}catch(o){throw k.warning("unpublish datastream warning: ",o),o}}async tryMassUnsubBeforeResub(t){let r={users:t.map(o=>({stream_id:o.stream_id,stream_type:o.stream_type}))};try{await this.signal.request(ct.UNSUBSCRIBE_STREAMS,r,!0)}catch(o){throw k.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),o),o}}async muteLocal(t,r){let o={action:t.find(c=>c.stream_type===On.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:r};try{await this.signal.request(ct.CONTROL,o,!0,!0)}catch(c){throw k.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(t,r){let o={action:t.find(c=>c.stream_type===On.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:r};try{await this.signal.request(ct.CONTROL,o,!0,!0)}catch(c){throw k.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(t,r){let o={action:t===et.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:r};try{await this.signal.request(ct.CONTROL,o,!0,!0)}catch(c){throw k.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(t,r){let o={action:t===et.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:r};try{await this.signal.request(ct.CONTROL,o,!0,!0)}catch(c){throw k.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,r){this.signal.upload(t,r)}getSignalRTT(){return this.signal.rtt}async restartICE(t){let r={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(ct.RESTART_ICE,r,!0)}catch(o){throw k.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),o),o}}reconnect(t,r){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,r||ts.P2P_FAILED)}getCurrentGatewayAddress(){var t,r;if(!z("GATEWAY_WSS_ADDRESS"))return z("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(k.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(r=this.joinInfo)!==null&&r!==void 0&&r.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(ct.SET_PARAMETER,{enablePublishAudioFilter:t})}downgradeCodec(t){this.signal.downgradeCodec(t)}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(tn.FALLBACK)),this.store.useDcSignal=!1,this.signal=new lG(Li(Li({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(Vr.RESET_SIGNAL)}}let pI=0,ID=0;function ql(e,t,r,o){return new ze((c,u)=>{t.timeout=t.timeout||z("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),pI+=Ju(t.data)):r&&(t.data.size?pI+=t.data.size:t.data instanceof FormData?pI+=a5(t.data):pI+=Ju(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,ao.request(t).then(h=>{typeof h.data=="string"?ID+=Ju(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?ID+=h.data.byteLength:ID+=Ju(JSON.stringify(h.data)),o&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{ao.isCancel(h)?u(new he(Y.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new he(Y.NETWORK_TIMEOUT,h.message)):h.response?u(new he(Y.NETWORK_RESPONSE_ERROR,h.response.status)):u(new he(Y.NETWORK_ERROR,h.message))})})}(function(){var e;function t(Re){var Ve=0;return function(){return Ve<Re.length?{done:!1,value:Re[Ve++]}:{done:!0}}}var r=typeof Object.defineProperties=="function"?Object.defineProperty:function(Re,Ve,Ze){return Re==Array.prototype||Re==Object.prototype||(Re[Ve]=Ze.value),Re},o,c=(function(Re){Re=[typeof globalThis=="object"&&globalThis,Re,typeof window=="object"&&window,typeof self=="object"&&self,typeof a=="object"&&a];for(var Ve=0;Ve<Re.length;++Ve){var Ze=Re[Ve];if(Ze&&Ze.Math==Math)return Ze}throw Error("Cannot find global object")})(this);function u(Re,Ve){if(Ve)e:{var Ze=c;Re=Re.split(".");for(var Ne=0;Ne<Re.length-1;Ne++){var L=Re[Ne];if(!(L in Ze))break e;Ze=Ze[L]}(Ve=Ve(Ne=Ze[Re=Re[Re.length-1]]))!=Ne&&Ve!=null&&r(Ze,Re,{configurable:!0,writable:!0,value:Ve})}}function h(Re){return(Re={next:Re})[Symbol.iterator]=function(){return this},Re}function m(Re){var Ve=typeof Symbol<"u"&&Symbol.iterator&&Re[Symbol.iterator];return Ve?Ve.call(Re):{next:t(Re)}}if(u("Symbol",function(Re){function Ve(L,J){this.A=L,r(this,"description",{configurable:!0,writable:!0,value:J})}if(Re)return Re;Ve.prototype.toString=function(){return this.A};var Ze="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Ne=0;return function L(J){if(this instanceof L)throw new TypeError("Symbol is not a constructor");return new Ve(Ze+(J||"")+"_"+Ne++,J)}}),u("Symbol.iterator",function(Re){if(Re)return Re;Re=Symbol("Symbol.iterator");for(var Ve="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Ze=0;Ze<Ve.length;Ze++){var Ne=c[Ve[Ze]];typeof Ne=="function"&&typeof Ne.prototype[Re]!="function"&&r(Ne.prototype,Re,{configurable:!0,writable:!0,value:function(){return h(t(this))}})}return Re}),typeof Object.setPrototypeOf=="function")o=Object.setPrototypeOf;else{var g;e:{var y={};try{y.__proto__={a:!0},g=y.a;break e}catch{}g=!1}o=g?function(Re,Ve){if(Re.__proto__=Ve,Re.__proto__!==Ve)throw new TypeError(Re+" is not extensible");return Re}:null}var v=o;function R(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function b(Re){if(Re.m)throw new TypeError("Generator is already running");Re.m=!0}function A(Re,Ve){return Re.h=3,{value:Ve}}function F(Re){this.g=new R,this.G=Re}function M(Re,Ve,Ze,Ne){try{var L=Ve.call(Re.g.j,Ze);if(!(L instanceof Object))throw new TypeError("Iterator result "+L+" is not an object");if(!L.done)return Re.g.m=!1,L;var J=L.value}catch(ie){return Re.g.j=null,Re.g.s(ie),j(Re)}return Re.g.j=null,Ne.call(Re.g,J),j(Re)}function j(Re){for(;Re.g.h;)try{var Ve=Re.G(Re.g);if(Ve)return Re.g.m=!1,{value:Ve.value,done:!1}}catch(Ze){Re.g.v=void 0,Re.g.s(Ze)}if(Re.g.m=!1,Re.g.l){if(Ve=Re.g.l,Re.g.l=null,Ve.F)throw Ve.D;return{value:Ve.return,done:!0}}return{value:void 0,done:!0}}function K(Re){this.next=function(Ve){return Re.o(Ve)},this.throw=function(Ve){return Re.s(Ve)},this.return=function(Ve){return(function(Ze,Ne){b(Ze.g);var L=Ze.g.j;return L?M(Ze,"return"in L?L.return:function(J){return{value:J,done:!0}},Ne,Ze.g.return):(Ze.g.return(Ne),j(Ze))})(Re,Ve)},this[Symbol.iterator]=function(){return this}}function q(Re,Ve){return Ve=new K(new F(Ve)),v&&Re.prototype&&v(Ve,Re.prototype),Ve}if(R.prototype.o=function(Re){this.v=Re},R.prototype.s=function(Re){this.l={D:Re,F:!0},this.h=this.C||this.u},R.prototype.return=function(Re){this.l={return:Re},this.h=this.u},F.prototype.o=function(Re){return b(this.g),this.g.j?M(this,this.g.j.next,Re,this.g.o):(this.g.o(Re),j(this))},F.prototype.s=function(Re){return b(this.g),this.g.j?M(this,this.g.j.throw,Re,this.g.o):(this.g.s(Re),j(this))},u("Array.prototype.entries",function(Re){return Re||function(){return(function(Ve,Ze){Ve instanceof String&&(Ve+="");var Ne=0,L=!1,J={next:function(){if(!L&&Ne<Ve.length){var ie=Ne++;return{value:Ze(ie,Ve[ie]),done:!1}}return L=!0,{done:!0,value:void 0}}};return J[Symbol.iterator]=function(){return J},J})(this,function(Ve,Ze){return[Ve,Ze]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var Q=function(Re,Ve){for(var Ze=0;Ze<Re.length;Ze++)Ve(Re[Ze])},se=function(Re){return Re.replace(/\r?\n|\r/g,`\r
`)},oe=function(Re,Ve,Ze){return Ve instanceof Blob?(Ze=Ze!==void 0?Ze+"":typeof Ve.name=="string"?Ve.name:"blob",Ve.name===Ze&&Object.prototype.toString.call(Ve)!=="[object Blob]"||(Ve=new File([Ve],Ze)),[String(Re),Ve]):[String(Re),String(Ve)]},te=function(Re,Ve){if(Re.length<Ve)throw new TypeError(Ve+" argument required, but only "+Re.length+" present.")},de=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Ce=de.FormData,Pe=de.XMLHttpRequest&&de.XMLHttpRequest.prototype.send,Qe=de.Request&&de.fetch,ot=de.navigator&&de.navigator.sendBeacon,Xt=de.Element&&de.Element.prototype,Lt=de.Symbol&&Symbol.toStringTag;Lt&&(Blob.prototype[Lt]||(Blob.prototype[Lt]="Blob"),"File"in de&&!File.prototype[Lt]&&(File.prototype[Lt]="File"));try{new File([],"")}catch{de.File=function(Re,Ve,Ze){return Re=new Blob(Re,Ze||{}),Object.defineProperties(Re,{name:{value:Ve},lastModified:{value:+(Ze&&Ze.lastModified!==void 0?new Date(Ze.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Lt&&Object.defineProperty(Re,Lt,{value:"File"}),Re}}var jt=function(Re){return Re.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},En=function(Re){this.i=[];var Ve=this;Re&&Q(Re.elements,function(Ze){if(Ze.name&&!Ze.disabled&&Ze.type!=="submit"&&Ze.type!=="button"&&!Ze.matches("form fieldset[disabled] *"))if(Ze.type==="file"){var Ne=Ze.files&&Ze.files.length?Ze.files:[new File([],"",{type:"application/octet-stream"})];Q(Ne,function(L){Ve.append(Ze.name,L)})}else Ze.type==="select-multiple"||Ze.type==="select-one"?Q(Ze.options,function(L){!L.disabled&&L.selected&&Ve.append(Ze.name,L.value)}):Ze.type==="checkbox"||Ze.type==="radio"?Ze.checked&&Ve.append(Ze.name,Ze.value):(Ne=Ze.type==="textarea"?se(Ze.value):Ze.value,Ve.append(Ze.name,Ne))})};if((e=En.prototype).append=function(Re,Ve,Ze){te(arguments,2),this.i.push(oe(Re,Ve,Ze))},e.delete=function(Re){te(arguments,1);var Ve=[];Re=String(Re),Q(this.i,function(Ze){Ze[0]!==Re&&Ve.push(Ze)}),this.i=Ve},e.entries=function Re(){var Ve,Ze=this;return q(Re,function(Ne){if(Ne.h==1&&(Ve=0),Ne.h!=3)return Ve<Ze.i.length?Ne=A(Ne,Ze.i[Ve]):(Ne.h=0,Ne=void 0),Ne;Ve++,Ne.h=2})},e.forEach=function(Re,Ve){te(arguments,1);for(var Ze=m(this),Ne=Ze.next();!Ne.done;Ne=Ze.next()){var L=m(Ne.value);Ne=L.next().value,L=L.next().value,Re.call(Ve,L,Ne,this)}},e.get=function(Re){te(arguments,1);var Ve=this.i;Re=String(Re);for(var Ze=0;Ze<Ve.length;Ze++)if(Ve[Ze][0]===Re)return Ve[Ze][1];return null},e.getAll=function(Re){te(arguments,1);var Ve=[];return Re=String(Re),Q(this.i,function(Ze){Ze[0]===Re&&Ve.push(Ze[1])}),Ve},e.has=function(Re){te(arguments,1),Re=String(Re);for(var Ve=0;Ve<this.i.length;Ve++)if(this.i[Ve][0]===Re)return!0;return!1},e.keys=function Re(){var Ve,Ze,Ne,L,J=this;return q(Re,function(ie){if(ie.h==1&&(Ve=m(J),Ze=Ve.next()),ie.h!=3)return Ze.done?void(ie.h=0):(Ne=Ze.value,L=m(Ne),A(ie,L.next().value));Ze=Ve.next(),ie.h=2})},e.set=function(Re,Ve,Ze){te(arguments,2),Re=String(Re);var Ne=[],L=oe(Re,Ve,Ze),J=!0;Q(this.i,function(ie){ie[0]===Re?J&&(J=!Ne.push(L)):Ne.push(ie)}),J&&Ne.push(L),this.i=Ne},e.values=function Re(){var Ve,Ze,Ne,L,J=this;return q(Re,function(ie){if(ie.h==1&&(Ve=m(J),Ze=Ve.next()),ie.h!=3)return Ze.done?void(ie.h=0):(Ne=Ze.value,(L=m(Ne)).next(),A(ie,L.next().value));Ze=Ve.next(),ie.h=2})},En.prototype._asNative=function(){for(var Re=new Ce,Ve=m(this),Ze=Ve.next();!Ze.done;Ze=Ve.next()){var Ne=m(Ze.value);Ze=Ne.next().value,Ne=Ne.next().value,Re.append(Ze,Ne)}return Re},En.prototype._blob=function(){var Re="----formdata-polyfill-"+Math.random(),Ve=[],Ze="--"+Re+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Ne,L){return typeof Ne=="string"?Ve.push(Ze+jt(se(L))+`"\r
\r
`+se(Ne)+`\r
`):Ve.push(Ze+jt(se(L))+'"; filename="'+jt(Ne.name)+`"\r
Content-Type: `+(Ne.type||"application/octet-stream")+`\r
\r
`,Ne,`\r
`)}),Ve.push("--"+Re+"--"),new Blob(Ve,{type:"multipart/form-data; boundary="+Re})},En.prototype[Symbol.iterator]=function(){return this.entries()},En.prototype.toString=function(){return"[object FormData]"},Xt&&!Xt.matches&&(Xt.matches=Xt.matchesSelector||Xt.mozMatchesSelector||Xt.msMatchesSelector||Xt.oMatchesSelector||Xt.webkitMatchesSelector||function(Re){for(var Ve=(Re=(this.document||this.ownerDocument).querySelectorAll(Re)).length;0<=--Ve&&Re.item(Ve)!==this;);return-1<Ve}),Lt&&(En.prototype[Lt]="FormData"),Pe){var lr=de.XMLHttpRequest.prototype.setRequestHeader;de.XMLHttpRequest.prototype.setRequestHeader=function(Re,Ve){lr.call(this,Re,Ve),Re.toLowerCase()==="content-type"&&(this.B=!0)},de.XMLHttpRequest.prototype.send=function(Re){Re instanceof En?(Re=Re._blob(),this.B||this.setRequestHeader("Content-Type",Re.type),Pe.call(this,Re)):Pe.call(this,Re)}}Qe&&(de.fetch=function(Re,Ve){return Ve&&Ve.body&&Ve.body instanceof En&&(Ve.body=Ve.body._blob()),Qe.call(this,Re,Ve)}),ot&&(de.navigator.sendBeacon=function(Re,Ve){return Ve instanceof En&&(Ve=Ve._asNative()),ot.call(this,Re,Ve)}),de.FormData=En}})();let XT=()=>{let e=z("AREAS");return e.length===0&&e.push(yn.GLOBAL),to(e).call(e,(t,r,o)=>{let c=kG(r);return c?o===0?c:"".concat(t,",").concat(c):t},"")},kG=e=>e===yn.OVERSEA?"".concat(ps.ASIA,",").concat(ps.EUROPE,",").concat(ps.AFRICA,",").concat(ps.NORTH_AMERICA,",").concat(ps.SOUTH_AMERICA,",").concat(ps.OCEANIA):ps[e],zhe=e=>{let t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(r=>{let o=rI[r],c=Object.keys(o);c&&c.map(u=>{u!=="CODE"&&(t[u]=t[u].concat(o[u]))})}),t},fI={GLOBAL:{ASIA:[yn.CHINA,yn.JAPAN,yn.INDIA,yn.KOREA,yn.HKMC],EUROPE:[],NORTH_AMERICA:[yn.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},mI=Object.keys(fI[yn.GLOBAL]),AD=[yn.CHINA,yn.NORTH_AMERICA,yn.EUROPE,yn.ASIA,yn.JAPAN,yn.INDIA,yn.OCEANIA,yn.SOUTH_AMERICA,yn.AFRICA,yn.KOREA,yn.HKMC,yn.US],Khe=function(e,t){let r=[];if(ke(e).call(e,yn.GLOBAL)){let u=[yn.GLOBAL,yn.OVERSEA],h=Object.keys(rI);if(t===yn.GLOBAL)throw new he(Y.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===yn.CHINA)r=[yn.OVERSEA];else if(c=t,ke(mI).call(mI,c)){let m=(o=t,fI[yn.GLOBAL][o]||[]),g=[...u,t,...m];r=h.filter(y=>!ke(g).call(g,y))}else if((function(m){let g=!1;return mI.forEach(y=>{var v;ke(v=fI[yn.GLOBAL][y]).call(v,m)&&(g=!0)}),g})(t)){let m=(function(y){let v;return mI.forEach(R=>{var b;ke(b=fI[yn.GLOBAL][R]).call(b,y)&&(v=R)}),v})(t),g=[...u,m,t];r=h.filter(y=>!ke(g).call(g,y))}else r=e;r=(function(m){let g=[];return AD.forEach(y=>{ke(m).call(m,y)&&g.push(y)}),g.concat(m.filter(y=>!ke(AD).call(AD,y)))})(r)}else r=e;var o,c;return r};function DG(e){var t,r;if(!e&&ke(t=z("AREAS")).call(t,yn.EXTENSIONS))return k.debug("update area from ap : reset"),void OD(the,!0);if(!ke(r=z("AREAS")).call(r,yn.GLOBAL)||!e)return;let o=rI.EXTENSIONS;o&&(o={CODE:kG(yn.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},k.debug("update area from ap success: ".concat(e,",config is "),o),Ln("AREAS",[yn.EXTENSIONS],!0),Object.keys(o).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?Ln(c,o[c][0]):Ln(c,o[c])}))}function OD(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],r=tt.reportApiInvoke(null,{name:ar.SET_AREA,options:e,tag:Fn.TRACER});try{let o=[];if(typeof e=="string"&&(o=[e]),Array.isArray(e)&&(e.forEach(u=>{if(!ke(nG).call(nG,u))throw new he(Y.INVALID_PARAMS,"invalid area code")}),o=e),Object.prototype.toString.call(e)==="[object Object]"){let{areaCode:u,excludedArea:h}=e;if(!u)throw new he(Y.INVALID_PARAMS,"area code is needed");let m=u;typeof u=="string"&&(m=[u]),o=h?Khe(m,h):m}if(!t){if(ma.AREAS){let u=new he(Y.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return r.onError(u),void k.warning("setArea is prohibited because of config-distribute")}if(ke(o).call(o,yn.GLOBAL)&&z("AREAS")===yn.EXTENSIONS){let u=new he(Y.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return r.onError(u),void k.warning("setArea is prohibited because of ap extensions")}}Ln("AREAS",o,t);let c=zhe(o);Object.keys(c).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?Ln(u,c[u][0]):Ln(u,c[u])}),k.debug("set area success:",o.join(","))}catch(o){throw r.onError(o),o}r.onSuccess()}function xG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function rd(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?xG(Object(r),!0).forEach(function(o){V(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xG(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}let ND=1;function Yhe(e,t,r,o,c){ND+=1;let u={sid:r.sid,command:"convergeAllocateEdge",uid:"666",appId:r.appId,ts:Math.floor(Date.now()/1e3),seq:ND,requestId:ND,version:Ja,cname:r.cname},h={service_name:t,json_body:JSON.stringify(u)},m,g,y=e[0];return Wl(async()=>{m=Date.now();let v=await ql(y,{data:h,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(g=Date.now()-m,v.code!==0){let A=new he(Y.UNEXPECTED_RESPONSE,"live streaming ap error, code"+v.code,{retry:!0,responseTime:g});throw k.error(A.toString()),A}let R=JSON.parse(v.json_body);if(R.code!==200){let A=new he(Y.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(R.code,", reason: ").concat(R.reason),{code:R.code,responseTime:g});throw k.error(A.toString()),A}if(!R.servers||R.servers.length===0){let A=new he(Y.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:R.code,responseTime:g});throw k.error(A.toString()),A}let b=(function(A,F){return{addressList:A.servers.map(M=>"wss://".concat(M.address.replace(/\./g,"-"),".").concat(z("WORKER_DOMAIN"),":").concat(M.wss,"?serviceName=").concat(encodeURIComponent(F))),workerToken:A.workerToken,vid:A.vid}})(R,t);return z("LIVE_STREAMING_ADDRESS")&&(b.addressList=z("LIVE_STREAMING_ADDRESS")instanceof Array?z("LIVE_STREAMING_ADDRESS"):[z("LIVE_STREAMING_ADDRESS")]),rd(rd({},b),{},{responseTime:g})},(v,R)=>(tt.apworkerEvent(r.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(v.addressList),firstSuccess:R===0,responseTime:g,serverIp:e[R%e.length]}),!1),(v,R)=>(tt.apworkerEvent(r.sid,{success:!1,sc:v.data&&v.data.code||200,serviceName:t,responseTime:g,serverIp:e[R%e.length]}),!!(v.code!==Y.OPERATION_ABORTED&&v.code!==Y.UNEXPECTED_RESPONSE||v.data&&v.data.retry)&&(y=e[(R+1)%e.length],!0)),c)}let PD=1;function LG(e,t,r,o){let{url:c,areaCode:u}=e,{clientId:h,sid:m}=t,g=Date.now(),y,v=t.role,[R,b]=DD(t,u,[Yr.CHOOSE_SERVER]),A=Cr.networkState;return Wl(async()=>{A&&Cr.networkState===Gs.OFFLINE&&Cr.onlineWaiter&&await ze.race([Cr.onlineWaiter,Ci(o&&o.maxRetryTimeout||Kr.maxRetryTimeout)]),A=Cr.networkState;let{data:F,headers:M}=await ql(c,{data:R,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);y=M.http3==="1"?1:-1,tt.reportResourceTiming(c,m),UG(F,c,t,g,[Yr.CHOOSE_SERVER],y);let j=GT(F,Yr.CHOOSE_SERVER);return kD(j),ED(j,c)},F=>(F&&tt.joinChooseServer(m,{role:v,lts:g,succ:!0,csAddr:c,opid:b,serverList:F.gatewayAddrs.map(M=>M.address),ec:null,cid:F.cid.toString(),uid:F.uid.toString(),csIp:F.csIp,unilbsServerIds:[Yr.CHOOSE_SERVER].toString(),isHttp3:y,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:F.res.detail&&F.res.detail[38],vid:F.vid}),!1),F=>F.code!==Y.OPERATION_ABORTED&&(F.code===Y.CAN_NOT_GET_GATEWAY_SERVER?F.data.retry:(tt.joinChooseServer(m,{role:v,lts:g,succ:!1,csAddr:c,serverList:null,opid:b,ec:F.code,csIp:F.data&&F.data.csIp,unilbsServerIds:[Yr.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:A}),isHttp3:y,corssRegionTagReq:t.apRequestDetail}),k.warning("[".concat(h||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),F),!0)),o)}function MG(e,t,r,o){let c,{url:u,areaCode:h,serviceIds:m}=e,g=Date.now(),y=t.role,[v,R]=DD(t,h,m),b;return Wl(async()=>{b&&Cr.networkState===Gs.OFFLINE&&Cr.onlineWaiter&&await ze.race([Cr.onlineWaiter,Ci(o&&o.maxRetryTimeout||Kr.maxRetryTimeout)]),b=Cr.networkState;let{data:A,headers:F}=await ql(u,{data:v,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=F.http3==="1"?1:-1,tt.reportResourceTiming(u,t.sid),UG(A,u,t,g,m,c);let M=GT(A,Yr.CHOOSE_SERVER),j=GT(A,t.cloudProxyServer==="proxy5"?Yr.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Yr.CLOUD_PROXY:Yr.CLOUD_PROXY_FALLBACK),K=performance.getEntriesByName(u),q=K[K.length-1],Q;return q&&(Q={name:q.name,protocol:"nextHopProtocol"in q?q.nextHopProtocol:"",dnscost:"domainLookupEnd"in q&&"domainLookupStart"in q&&typeof q.domainLookupEnd=="number"&&typeof q.domainLookupStart=="number"?q.domainLookupEnd-q.domainLookupStart:-1,tcpTlsCost:"connectEnd"in q&&"connectStart"in q&&typeof q.connectEnd=="number"&&typeof q.connectStart=="number"?q.connectEnd-q.connectStart:-1,reqCost:"requestStart"in q&&typeof q.requestStart=="number"&&"responseEnd"in q&&typeof q.responseEnd=="number"?q.responseEnd-q.requestStart:-1,handleCost:"leave_ts"in A&&"enter_ts"in A&&typeof A.leave_ts=="number"&&typeof A.enter_ts=="number"?A.leave_ts-A.enter_ts:-1}),kD(M),{gatewayInfo:ED(M,u),proxyInfo:j,url:u,resourceTimingInfo:Q}},A=>{var F;return A.gatewayInfo&&tt.joinChooseServer(t.sid,{role:y,lts:g,succ:!0,csAddr:u,serverList:A.gatewayInfo.gatewayAddrs.map(M=>M.address),ec:null,opid:R,cid:A.gatewayInfo.cid.toString(),uid:A.gatewayInfo.uid.toString(),csIp:A.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:c,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:A.gatewayInfo.res.detail&&A.gatewayInfo.res.detail[38],vid:(F=A.gatewayInfo)===null||F===void 0?void 0:F.vid,resourceTimingInfo:A.resourceTimingInfo?JSON.stringify(A.resourceTimingInfo):void 0}),A.proxyInfo&&tt.joinWebProxyAP(t.sid,{lts:g,sucess:1,apServerAddr:u,turnServerAddrList:A.proxyInfo.addresses.map(M=>M.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:m.toString()}),!1},A=>A.code!==Y.OPERATION_ABORTED&&(A.code===Y.CAN_NOT_GET_GATEWAY_SERVER?A.data.retry:(tt.joinWebProxyAP(t.sid,{lts:g,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:A.code,eventType:t.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:b})}),k.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),A),!0)),o)}let UG=(e,t,r,o,c,u)=>{let{sid:h,clientId:m,cloudProxyServer:g}=r,y=[],v=R=>{R.flag===4096?tt.joinChooseServer(h,{role:r.role,lts:o,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:R.error.message,csIp:R.error.data&&R.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:u,corssRegionTagReq:r.apRequestDetail}):R.flag!==1048576&&R.flag!==4194304&&R.flag!==4194310||tt.joinWebProxyAP(h,{lts:o,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:R.error.code,eventType:g,unilbsServerIds:c.toString()})};if(e.response_body.forEach(R=>{let b=R.buffer.code;if(R.uri===23&&b===0&&!R.buffer.edges_services)if(R.buffer.flag===4194310)k.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),R.buffer.edges_services=[];else{let A={error:new he(Y.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:z("NO_EDGES_RETRY"),csIp:e.detail[502]}),flag:R.buffer.flag};y.push(A),v(A)}if(b!==0){let A=XE(b),F={error:new he(Y.CAN_NOT_GET_GATEWAY_SERVER,A.desc,{desc:A.desc,retry:A.retry,csIp:e.detail[502]}),flag:R.buffer.flag};R.buffer.flag===4194310?k.warning(F.error.toString()):y.push(F),v(F)}}),y.length)throw k.warning("[".concat(m||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(y.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message,", retry: ").concat(R.error.data.retry)).join(" | "))),new he(Y.CAN_NOT_GET_GATEWAY_SERVER,y.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message)).join(" | "),{retry:!!y.find(R=>R.error.data.retry),csIp:e.detail[502],desc:[...new Set(y.map(R=>{var b;return R==null||(b=R.error)===null||b===void 0||(b=b.data)===null||b===void 0?void 0:b.desc}).filter(R=>!!R))]})},kD=e=>{var t,r,o,c;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new he(Y.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(z("AP_AREA")&&((o=e.detail)!==null&&o!==void 0&&o[23]&&typeof((c=e.detail)===null||c===void 0?void 0:c[23])=="string"?DG(e.detail[23].toLowerCase()):DG()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((r=e.detail)===null||r===void 0?void 0:r[19])=="string"){let h=e.detail[19],m=h?.split(";");for(let g=0;g<m.length;g++){var u;let y=Bs(u=m[g]).call(u);e.addresses[g]&&m&&(e.addresses[g].fingerprint=y)}}if(z("GATEWAY_ADDRESS")&&z("GATEWAY_ADDRESS").length>0){k.debug("assign gateway address to",z("GATEWAY_ADDRESS"));let h=z("GATEWAY_ADDRESS").map(m=>{var g,y;let v=(g=(y=e.addresses.find(R=>R.ip===m.ip&&R.port===m.port))===null||y===void 0?void 0:y.fingerprint)!==null&&g!==void 0?g:"";return{ip:m.ip,port:m.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:m.fingerprint||v}});e.addresses=h}},qhe=(e,t)=>{if(e.response_body&&e.response_body.length){let r=e.response_body[0];if(r.buffer.code!==0){let o=XE(r.buffer.code);throw new he(Y.UPDATE_TICKET_FAILED,"[".concat(r.buffer.code,"]: ").concat(o.desc),{retry:o.retry})}return r.buffer.ticket}throw k.debug("update ticket request received ap response without response body:",t),new he(Y.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},DD=(e,t,r)=>{let o=Math.floor(Math.random()*1e12),c=e.role==="host"?"1":e.role==="audience"?"2":void 0,u={appid:e.appId,client_ts:Date.now(),opid:o,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:rd(rd(rd({6:e.stringUid,11:t,12:z("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:r,uid:e.uid||0}}]};u.request_bodies.forEach(m=>{e.multiIP&&e.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});let h=new FormData;return h.append("request",JSON.stringify(u)),[h,o]},Xhe=(e,t)=>{let r=Math.floor(Math.random()*1e12),o={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(u=>({ip:u.ip,port:u.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(o)),[c,r]},QE=0;function ZE(e){return ze.all(e.map(t=>t.then(r=>{throw r},r=>r))).then(t=>{throw t},t=>t)}let JT=async e=>{let{fragementLength:t,referenceList:r,asyncMapHandler:o,allFailedhandler:c,promisesCollector:u}=e,h=0,m=t,g,y=0,v=async()=>{let R=(()=>{let b=h*m,A=b+m;return r.slice(b,A).map(o)})();u&&u.push(...R);try{g=await ZE(R)}catch(b){if(y+=m,h++,!(y>=r.length))return void await v();c(b)}R.forEach(b=>b.cancel())};return await v(),g},VG=async e=>{let{referenceList:t,asyncMapHandler:r,closeFn:o}=e,c=t.length,u=0,h=async()=>{let m=r(t.shift());try{return await m}catch(g){if(u++,u>=c||o!=null&&o(g))throw g;return h()}};return h()};async function Jhe(){if(typeof VideoDecoder>"u")return!0;let e,t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],o=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],c=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],u=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],h=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new ze((m,g)=>{let y;(async function(){e&&e.state!=="closed"||await(async function(){e=new VideoDecoder({output:R=>{R.close(),clearTimeout(y),m(!0)},error:R=>{clearTimeout(y),m(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})})();let v=[t,r,o,c,u,h];for(let R=0;R<v.length;R++){let b=new EncodedVideoChunk({type:R==0?"key":"delta",timestamp:33333*R,duration:33333,data:new Uint8Array(v[R])});try{await e.decode(b)}catch{return void m(!1)}}})(),y=setTimeout(()=>{m(!1)},5e3)})}async function gI(e,t,r,o){return{gatewayInfo:await(async function(c,u,h,m){let g=null,y=[],v=async()=>{let b=z("WEBCS_DOMAIN").slice(0,z("AJAX_REQUEST_CONCURRENT")).map(M=>({url:c.proxyServer?"https://".concat(c.proxyServer,"/ap/?url=").concat(M+"/api/v2/transpond/webrtc?v=2"):"https://".concat(M,"/api/v2/transpond/webrtc?v=2"),areaCode:XT()})),A=m.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:b.map(M=>M.url)}),F=await JT({fragementLength:z("FRAGEMENT_LENGTH"),referenceList:b,asyncMapHandler:M=>(k.debug("[".concat(c.clientId,"] Connect to choose_server:"),M.url),LG(M,c,u,h)),allFailedhandler:M=>{throw m.recordJoinChannelService({endTs:Date.now(),status:"error",errors:M},A),M[0]},promisesCollector:y});return m.recordJoinChannelService({endTs:Date.now(),status:"success"},A),F},R=async()=>{if(await Ci(1e3),g!==null)return g;let b=z("WEBCS_DOMAIN_BACKUP_LIST").map(M=>({url:c.proxyServer?"https://".concat(c.proxyServer,"/ap/?url=").concat(M+"/api/v2/transpond/webrtc?v=2"):"https://".concat(M,"/api/v2/transpond/webrtc?v=2"),areaCode:XT()})),A=m.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:b.map(M=>M.url)}),F=await JT({fragementLength:z("FRAGEMENT_LENGTH"),referenceList:b,asyncMapHandler:M=>(k.debug("[".concat(c.clientId,"] Connect to backup choose_server:"),M.url),LG(M,c,u,h)),allFailedhandler:M=>{throw m.recordJoinChannelService({endTs:Date.now(),status:"error",errors:M},A),M[0]},promisesCollector:y});return m.recordJoinChannelService({endTs:Date.now(),status:"success"},A),F};try{return g=await ZE([v(),R()]),y.length&&y.forEach(b=>b.cancel&&typeof b.cancel=="function"&&b.cancel()),g}catch(b){throw b[0]}})(e,t,r,o)}}async function FG(e,t,r,o,c){let u=e.cloudProxyServer;if(u==="disabled"){if(e.useLocalAccessPoint)return await gI(e,t,r,c);if(z("JOIN_WITH_FALLBACK_MEDIA_PROXY")){let{gatewayInfo:b,proxyInfo:A}=await WG(e,t,r,c);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:b};let F=A.map(M=>({turnServerURL:M.address,tcpport:M.tcpport||ns.tcpport,udpport:M.udpport||ns.udpport,username:M.username||ns.username,password:M.password||ns.password,forceturn:!1,security:!0}));if(c.useP2P){var h;let M=(h=e.uid)!==null&&h!==void 0?h:b.uid,j="glb:".concat(M.toString()),K=await mk(j),q=A.map(Q=>({turnServerURL:Q.address,tcpport:Q.tcpport||ns.tcpport,udpport:Q.udpport||ns.udpport,username:j,password:K,forceturn:!1,security:!0}));F.push(...q)}return e.turnServer={mode:"manual",servers:F},{gatewayInfo:b}}return await gI(e,t,r,c)}let{proxyInfo:m,gatewayInfo:g}=await WG(e,t,r,c),y={gatewayInfo:g},v=m.map(b=>({turnServerURL:b.address,tcpport:u==="proxy3"?void 0:b.tcpport?b.tcpport:ns.tcpport,udpport:u==="proxy4"?void 0:b.udpport?b.udpport:ns.udpport,username:b.username||ns.username,password:b.password||ns.password,forceturn:u!=="proxy4",security:u==="proxy5"}));if(c.useP2P){var R;let b=(R=e.uid)!==null&&R!==void 0?R:g.uid,A="glb:".concat(b.toString()),F=await mk(A),M=m.map(j=>({turnServerURL:j.address,tcpport:u==="proxy3"?void 0:j.tcpport||ns.tcpport,udpport:u==="proxy4"?void 0:j.udpport||ns.udpport,username:A,password:F,forceturn:u!=="proxy4",security:u==="proxy5"}));v.push(...M)}return e.turnServer={mode:"manual",servers:v},k.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(u)),y}async function jG(e,t,r,o,c){let u=z("ACCOUNT_REGISTER").slice(0,z("AJAX_REQUEST_CONCURRENT")),h=[];h=t.proxyServer?u.map(g=>"https://".concat(t.proxyServer,"/ap/?url=").concat(g+"/api/v1")):u.map(g=>"https://".concat(g,"/api/v1"));let m=c?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{let g=await(async function(y,v,R,b,A){let F=Date.now(),M={sid:R.sid,opid:10,appid:R.appId,string_uid:v},j=y[0],K=await Wl(()=>ql(j+"".concat(j.indexOf("?")===-1?"?":"&","action=stringuid"),{data:M,cancelToken:b,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(q,Q)=>{if(q.code===0){if(q.uid<=0||q.uid>=Math.pow(2,32))throw k.error("Invalid Uint Uid ".concat(v," => ").concat(q.uid),q),tt.reqUserAccount(M.sid,{lts:F,success:!1,serverAddr:j,stringUid:M.string_uid,uid:q.uid,errorCode:Y.INVALID_UINT_UID_FROM_STRING_UID,extend:M}),new he(Y.INVALID_UINT_UID_FROM_STRING_UID);return tt.reqUserAccount(M.sid,{lts:F,success:!0,serverAddr:j,stringUid:M.string_uid,uid:q.uid,errorCode:null,extend:M}),!1}let se=XE(q.code);return se.retry&&(j=y[(Q+1)%y.length]),tt.reqUserAccount(M.sid,{lts:F,success:!1,serverAddr:j,stringUid:M.string_uid,uid:q.uid,errorCode:se.desc,extend:M}),se.retry},(q,Q)=>q.code!==Y.OPERATION_ABORTED&&(tt.reqUserAccount(M.sid,{lts:F,success:!1,serverAddr:j,stringUid:M.string_uid,uid:null,errorCode:q.code,extend:M}),j=y[(Q+1)%y.length],!0),A);if(K.code!==0){let q=XE(K.code);throw new he(Y.UNEXPECTED_RESPONSE,q.desc)}return K})(h,e,t,r,o);return c?.recordJoinChannelService({status:"success",endTs:Date.now()},m),g.uid}catch(g){throw c?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[g]},m),g}}async function $he(e,t,r){let o=z("ACCOUNT_REGISTER"),c=[];c=t.proxyServer?o.map(u=>"https://".concat(t.proxyServer,"/ap/?url=").concat(u+"/api/v1")):o.map(u=>"https://".concat(u,"/api/v1"));try{return await VG({referenceList:c,asyncMapHandler:u=>(async function(h,m,g,y){let v=Date.now(),R={sid:g.sid,opid:10,appid:g.appId,string_uid:m};try{let b=await ql(h+"".concat(h.indexOf("?")===-1?"?":"&","action=stringuid"),{data:R,cancelToken:y,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(b.code!==0){let A=XE(b.code);throw new he(Y.UNEXPECTED_RESPONSE,"preload sua error:".concat(A.desc),A)}if(b.uid<=0||b.uid>=Math.pow(2,32))throw new he(Y.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:v,url:h,req:R,uid:b.uid,elapse:Date.now()-v}}catch(b){throw b}})(u,e,t,r),closeFn:u=>u.code===Y.OPERATION_ABORTED||u.code===Y.UNEXPECTED_RESPONSE&&!u.data.retry})}catch(u){throw u}}async function Qhe(e,t,r){let o=z("CDS_AP").slice(0,z("AJAX_REQUEST_CONCURRENT")).map(g=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(g+"/api/v1"):"https://".concat(g,"/api/v1?action=config")),c=o.map(g=>(function(y,v,R,b){let A=pn(),F={flag:64,cipher_method:0,features:rd(rd(rd(rd(rd({install_id:Ak(),device:A.name,system:A.os,system_general:navigator.userAgent,vendor:v.appId,version:Ja,cname:v.cname,session_id:v.sid,proxyServer:v.proxyServer,sdk_type:Whe.WEB_RTC,browser_name:A.name,browser_version:A.version,user_agent:navigator.userAgent,channel_name:v.cname},v.stringUid&&{string_uid:v.stringUid}),v.uid&&{uid:v.uid+""}),A.os&&{os_name:A.os}),A.osVersion&&{os_version:A.osVersion}),{},{detail:""})};return Wl(()=>ql(y,{data:F,timeout:1e3,cancelToken:R,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,M=>M.code!==Y.OPERATION_ABORTED,b)})(g,e,t,r)),u=null,h=null,m={};try{u=await ZE(c)}catch(g){if(g.code===Y.OPERATION_ABORTED)throw g;h=g}if(c.forEach(g=>g.cancel()),tt.reportApiInvoke(e.sid,{name:ar.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:u}}).onSuccess(),u&&u.test_tags)try{m=(function(g){if(!g.test_tags)return{};let y=g.test_tags,v=Object.keys(y),R={};return v.forEach(b=>{var A;let F=Bs(A=b.slice(4)).call(A),M=JSON.parse(y[b]),j=M[1];R[F]={tag:M[0]||"",value:j}}),R})(u)}catch{}return m}async function BG(e,t){let r=z("WEBCS_DOMAIN").concat(z("WEBCS_DOMAIN_BACKUP_LIST")).map(o=>({url:"https://".concat(o,"/api/v2/transpond/webrtc?v=2"),areaCode:XT(),serviceIds:[Yr.CHOOSE_SERVER,Yr.CLOUD_PROXY_FALLBACK]}));try{return await VG({referenceList:r,asyncMapHandler:o=>(async function(c,u,h){let m,{url:g,areaCode:y,serviceIds:v}=c,R=Date.now(),[b,A]=DD(u,y,v),F=Cr.networkState;try{F&&Cr.networkState===Gs.OFFLINE&&Cr.onlineWaiter&&await ze.race([Cr.onlineWaiter,Ci(Kr.maxRetryTimeout)]),F=Cr.networkState;let{data:M,headers:j}=await ql(g,{data:b,cancelToken:h,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);m=j.http3==="1"?1:-1,(Q=>{let se=[];if(Q.response_body.forEach(oe=>{let te=oe.buffer.code;if(oe.uri===23&&te===0&&!oe.buffer.edges_services)if(oe.buffer.flag===4194310)oe.buffer.edges_services=[];else{let de={error:new he(Y.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:z("NO_EDGES_RETRY"),csIp:Q.detail[502]}),flag:oe.buffer.flag};se.push(de)}if(te!==0){let de=XE(te),Ce={error:new he(Y.CAN_NOT_GET_GATEWAY_SERVER,de.desc,{desc:de.desc,retry:de.retry,csIp:Q.detail[502]}),flag:oe.buffer.flag};oe.buffer.flag===4194310?k.warning(Ce.error.toString()):se.push(Ce)}}),se.length)throw new he(Y.CAN_NOT_GET_GATEWAY_SERVER,se.map(oe=>"flag: ".concat(oe.flag,", message: ").concat(oe.error.message)).join(" | "),{retry:!!se.find(oe=>oe.error.data.retry),csIp:Q.detail[502],desc:[...new Set(se.map(oe=>{var te;return oe==null||(te=oe.error)===null||te===void 0||(te=te.data)===null||te===void 0?void 0:te.desc}).filter(oe=>!!oe))]})})(M);let K=GT(M,Yr.CHOOSE_SERVER),q=GT(M,Yr.CLOUD_PROXY_FALLBACK);return kD(K),{gatewayInfo:ED(K,g),proxyInfo:q,opid:A,requestTime:R,url:g,isHttp3:m,elapse:Date.now()-R}}catch(M){throw M}})(o,e,t),closeFn:o=>o.code===Y.OPERATION_ABORTED||o.code===Y.CAN_NOT_GET_GATEWAY_SERVER&&!o.data.retry})}catch(o){throw o}}async function WG(e,t,r,o){let c=z("PROXY_SERVER_TYPE3"),u=(A,F,M)=>{let j=M||c;return Array.isArray(j)&&(j=F%2==0&&c[1]||c[0]),"https://".concat(j,"/ap/?url=").concat(A)},h=null,m=[],g=async()=>{let A=z("WEBCS_DOMAIN").slice(0,z("AJAX_REQUEST_CONCURRENT")).map((j,K)=>{let q;return q=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(j,"/api/v2/transpond/webrtc?v=2"),K,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):u("".concat(j,"/api/v2/transpond/webrtc?v=2"),K),{url:q,areaCode:XT(),serviceIds:[Yr.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Yr.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Yr.CLOUD_PROXY:Yr.CLOUD_PROXY_FALLBACK]}}),F=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:A.map(j=>j.url)}),M=await JT({fragementLength:z("FRAGEMENT_LENGTH"),referenceList:A,asyncMapHandler:j=>(k.debug("[".concat(e.clientId,"] Connect to choose_server:"),j.url),MG(j,e,t,r)),allFailedhandler:j=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},F),j[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},F),M},y=async()=>{if(await Ci(1e3),h!==null)return h;let A=z("WEBCS_DOMAIN_BACKUP_LIST").map((j,K)=>{let q;return q=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(j,"/api/v2/transpond/webrtc?v=2"),K,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):u("".concat(j,"/api/v2/transpond/webrtc?v=2"),K),{url:q,areaCode:XT(),serviceIds:[Yr.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Yr.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Yr.CLOUD_PROXY:Yr.CLOUD_PROXY_FALLBACK]}}),F=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:A.map(j=>j.url)}),M=await JT({fragementLength:z("FRAGEMENT_LENGTH"),referenceList:A,asyncMapHandler:j=>(k.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),j.url),MG(j,e,t,r)),allFailedhandler:j=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},F),j[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},F),M},v,R,b;try{({gatewayInfo:v,proxyInfo:R,url:b}=await ZE([g(),y()]))}catch(A){throw A[0]}if(m.length&&m.forEach(A=>A.cancel&&typeof A.cancel=="function"&&A.cancel()),!v||!R)throw new he(Y.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=b,e.cloudProxyServer!=="disabled"&&Array.isArray(c)&&b){let A=/^https?:\/\/(.+?)(\/.*)?$/.exec(b)[1];ke(c).call(c,A)&&(e.proxyServer=A,k.setProxyServer(A),tt.setProxyServer(A))}return h={gatewayInfo:v,proxyInfo:await hG(R,v.uid)},h}async function Zhe(e,t,r){let o=z("UAP_AP").slice(0,z("AJAX_REQUEST_CONCURRENT")).map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")),c=o.map(u=>(function(h,m,g,y){let v={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:Ja,cname:m.cname,uid:m.uid.toString(),requestId:PD,seq:PD};PD+=1;let R={service_name:"tele_channel",json_body:JSON.stringify(v)};return Wl(async()=>{let b=await ql(h,{data:R,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(b.code!==0){let F=new he(Y.UNEXPECTED_RESPONSE,"cross channel ap error, code"+b.code,{retry:!0});throw k.error(F.toString()),F}let A=JSON.parse(b.json_body);if(A.code!==200){let F=new he(Y.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(A.code,", reason: ").concat(A.reason));throw k.error(F.toString()),F}if(!A.servers||A.servers.length===0){let F=new he(Y.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw k.error(F.toString()),F}return{vid:A.vid,workerToken:A.workerToken,addressList:(z("CHANNEL_MEDIA_RELAY_SERVERS")||A.servers).map(F=>"wss://".concat(F.address.replace(/\./g,"-"),".").concat(z("WORKER_DOMAIN"),":").concat(F.wss))}},void 0,b=>!!(b.code!==Y.OPERATION_ABORTED&&b.code!==Y.UNEXPECTED_RESPONSE||b.data&&b.data.retry),y)})(u,e,t,r));try{let u=await ZE(c);return c.forEach(h=>h.cancel()),u}catch(u){throw u[0]}}async function epe(e,t,r){let o=null,c=[],u=async h=>{let m=z(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(g=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(g+"/api/v2/transpond/webrtc?v=2"):"https://".concat(g,"/api/v2/transpond/webrtc?v=2"));return h&&(await Ci(1e3),o!==null)?o:await JT({fragementLength:z("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:g=>(k.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),g),(function(y,v,R,b){let[A]=Xhe(v,[Yr.CHOOSE_SERVER]),F=Cr.networkState;return Wl(async()=>{F&&Cr.networkState===Gs.OFFLINE&&Cr.onlineWaiter&&await ze.race([Cr.onlineWaiter,Ci(b&&b.maxRetryTimeout||Kr.maxRetryTimeout)]),F=Cr.networkState;let M=await ql(y,{data:A,cancelToken:R,headers:{"Content-Type":"multipart/form-data;"}},!0);return qhe(M,y)},()=>!1,M=>M.code!==Y.OPERATION_ABORTED&&(M.code===Y.UPDATE_TICKET_FAILED?M.data.retry:(k.warning("[".concat(v.clientId,"] update ticket network error, retry"),M),!0)),b)})(g,e,t,r)),allFailedhandler:g=>{throw g[0]},promisesCollector:c})};try{return o=await ZE([u(!1),u(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),o}catch(h){throw h[0]}}function GG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function xD(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?GG(Object(r),!0).forEach(function(o){V(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):GG(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}class tpe extends dr{get isSuccess(){return!!this.configs}constructor(t,r){super(),V(this,"configs",void 0),V(this,"store",void 0),V(this,"joinInfo",void 0),V(this,"cancelToken",void 0),V(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),V(this,"interval",void 0),V(this,"mutex",void 0),V(this,"mutableParamsRead",!1),V(this,"configCache",{}),V(this,"limit_bitrate",void 0),this.mutex=new ki("config-distribute",t),this.store=r}startGetConfigDistribute(t,r){this.joinInfo=t,this.cancelToken=r,this.interval&&this.stopGetConfigDistribute(),z("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},z("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,tt.reportApiInvoke(null,{options:void 0,name:ar.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Fn.TRACER}).onSuccess(JSON.stringify(ma))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void k.debug("[config-distribute] get config distribute interrupted have no joininfo");let t,r=await this.mutex.lock();try{t=await Qhe(this.joinInfo,this.cancelToken,this.retryConfig),k.debug("[config-distribute] get config distribute",JSON.stringify(t));let o=(function(c){var u;let h=wm(u=Object.keys(c).filter(y=>/^webrtc_ng_global_parameter/.test(y))).call(u);for(let y=0;y<h.length;y++)for(let v=h.length-1;v>y;v--){let R=h[v],b=c[R].value;if(typeof b.__priority=="number"){let A=b.__priority,F=h[v-1],M=c[F].value;if(typeof M.__priority=="number"){if(!(A>M.__priority))continue;{let j=R;h[v]=h[v-1],h[v-1]=j}}else{let j=R;h[v]=h[v-1],h[v-1]=j}}}let m=Date.now(),g={};return h.forEach(y=>{let v=c[y].value.__expires;v&&v<=m||(g[y]=c[y])}),g})(t);this.cacheGlobalParameterConfig(o),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=o}catch(o){let c=new he(Y.NETWORK_RESPONSE_ERROR,o);k.warning("[config-distribute] ".concat(c.toString()))}finally{r()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){rG(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(zl.UPDATE_BITRATE_LIMIT,t):this.emit(zl.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&xD({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{let r={},o=Object.keys(t),c=[];o.forEach(u=>{let h=t[u].value;r[u]=h;let m=h.__id;if(m&&this.configCache[u]&&this.configCache[u].__id===m)return;let g=h.__type,y=t[u].value,v=t[u].tag,R=0;g?g===T5.REALTIME&&(R=1):Object.keys(y).some(b=>Object.prototype.hasOwnProperty.call(kk,b)||!oD()&&Object.prototype.hasOwnProperty.call(Db,b)?(R=1,!0):void 0),c.push({tag:v,isApplied:R,feature:u,params:JSON.stringify(h)})}),c.forEach(u=>{let{tag:h,feature:m,params:g,isApplied:y}=u;this.store.sessionId&&tt.abTest(this.store.sessionId,{intSucc:1,isApplied:y,tag:h,feature:m,params:g,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=r}catch(r){k.debug("handleABTestConfigDistribute error",r)}}cacheGlobalParameterConfig(t){let r=(function(c){let u={};return Object.keys(c).forEach(h=>{let m=c[h].value,g=m.__expires,y=m.__type;Object.keys(m).forEach(v=>{v==="__id"||v==="__type"||v==="__priority"||v==="__expires"||Object.prototype.hasOwnProperty.call(u,v)||(u[v]=xD(xD({value:m[v]},g&&{expires:g}),y&&{type:y}))})}),u})(t);try{var o;let c=(o=r.LIMIT_BITRATE)===null||o===void 0?void 0:o.value;delete r.LIMIT_BITRATE,c&&rG(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(r),this.handleABTestConfigDistribute(t),(function(m){try{let g=Date.now();Object.keys(m).forEach(y=>{let{value:v,type:R,expires:b}=m[y];b&&b<=g||((R===T5.REALTIME||Object.prototype.hasOwnProperty.call(kk,y))&&(ma[y]=v,An[y]=v,k.debug("Update realtime parameters from config distribute",y,v)),R||oD()||!Object.prototype.hasOwnProperty.call(Db,y)||(ma[y]=v,An[y]=v,k.debug("Update gateway parameters from config distribute",y,v)))})}catch(g){k.error("Error update config immediately: ".concat(m),g.message)}})(r);let u=JSON.stringify(r),h=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",h),k.debug("Caching global parameters ".concat(u))}catch(c){k.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(t){try{let r=Date.now();Object.keys(t).forEach(o=>{switch(o){case"CLIENT_ROLE_OPTIONS":if(Object.prototype.hasOwnProperty.call(An,o)){let{value:u,expires:h}=t[o];if(h&&h<=r)return;vk(An[o],u)||(ma[o]=u,An[o]=u,this.emit(zl.UPDATE_CLIENT_ROLE_OPTIONS,u),k.debug("Updating client role options: ".concat(JSON.stringify(u))))}break;case"REMOTE_VIDEO_STREAM_TYPE":if(Object.prototype.hasOwnProperty.call(An,o)){var c;let{value:u,expires:h}=t[o];if(h&&h<=r)return;typeof u=="number"&&ke(c=[0,1,4,5,6,7,8,9]).call(c,u)&&(ma[o]={value:u},An[o]=u,this.emit(zl.UPDATE_REMOTE_VIDEO_STREAM_TYPE,u),k.debug("Updating client remote stream type: ".concat(JSON.stringify(u))))}break;case"ENABLE_FORCE_HLS":if(Object.prototype.hasOwnProperty.call(An,o)){let{value:u,expires:h}=t[o];if(h&&h<=r)return;vk(An[o],u)||(ma[o]=u,An[o]=u,this.emit(zl.FALLBACK_TO_HLS,u),k.debug("Updating enable force hls: ".concat(JSON.stringify(u))))}break;case"VOS_CONFIGURE":if(Object.prototype.hasOwnProperty.call(An,o)){let{value:u,expires:h}=t[o];if(h&&h<=r)return;vk(An[o],u)||(ma[o]=u,An[o]=u,this.emit(zl.UPDATE_VOS_CONFIGURE,u),k.debug("Updating vos configure: ".concat(JSON.stringify(u))))}}})}catch(r){k.error("Error handling global parameter config:",r.message)}}}class npe extends dr{constructor(){super(...arguments),V(this,"resultStorage",new Map)}setLocalAudioStats(t,r,o){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(o,r)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(o,r))}setLocalVideoStats(t,r,o){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(o,r)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(o,r)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(o)),!r.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(o))}setRemoteAudioStats(t,r){let o=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",o,this.checkAudioOutputLevel(r))}setRemoteVideoStats(t,r){let o=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",o,this.checkVideoDecode(r))}record(t,r,o){if(z("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});let c=this.resultStorage.get(t);if(!c)return;c.result.push(o);let u=t==="VIDEO_ENCODE_FAILED"?z("ENCODE_EXCEPTION_TIMES"):5;if(c.result.length>=u){var h;let m=ke(h=c.result).call(h,!0);c.isPrevNormal&&!m&&this.emit("exception",LD[t],t,r),!c.isPrevNormal&&m&&this.emit("exception",LD[t]+2e3,t+"_RECOVER",r),c.isPrevNormal=m,c.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,r){return r instanceof ai&&!r.isActive||!!r.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,r){let o=null;r._encoderConfig&&r._encoderConfig.frameRate&&(o=ho(r._encoderConfig.frameRate));let c=t.captureFrameRate;return!o||!c||!(o>10&&c<5||o<10&&o>=5&&c<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var r;return!(!t.codecType||ke(r=z("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(r,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,r){return!!r.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,r){return r instanceof ai&&!r.isActive||!!r.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}let LD={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},fs=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){let r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(r.length>0){let o=r[r.length-1];return Math.round(performance.now()-o.startTime)}return 0}measureFromPublishStart(e,t){let r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(r.length>0){let o=r[r.length-1];return Math.round(performance.now()-o.startTime)}return 0}};function HG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function $m(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?HG(Object(r),!0).forEach(function(o){V(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):HG(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}class $T{constructor(t){V(this,"store",void 0),V(this,"onStatsException",void 0),V(this,"onUploadPublishDuration",void 0),V(this,"onStatsChanged",void 0),V(this,"onVideoCodecChanged",void 0),V(this,"localStats",new Map),V(this,"remoteStats",new Map),V(this,"updateStatsInterval",void 0),V(this,"trafficStats",void 0),V(this,"trafficStatsPeerList",[]),V(this,"uplinkStats",void 0),V(this,"exceptionMonitor",void 0),V(this,"p2pChannel",void 0),V(this,"scalabilityMode",Pb.L1T1),V(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new npe,this.exceptionMonitor.on("exception",(r,o,c)=>{this.onStatsException&&this.onStatsException(r,o,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(xe.LocalAudioTrack)||$m({},Vk)}getLocalVideoTrackStats(){return this.localStats.get(xe.LocalVideoTrack)||$m({},Fk)}getRemoteAudioTrackStats(t){let r=(u,h)=>{if(!this.trafficStats)return h;let m=this.trafficStats.peer_delay.find(g=>g.peer_uid===u);return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},o={};if(t){var c;let u=(c=this.remoteStats.get(t))===null||c===void 0?void 0:c.audioStats;u&&(o[t]=r(t,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{audioStats:m}]=u;m&&(o[h]=r(h,m))});return o}getRemoteNetworkQualityStats(t){let r={};if(t){var o;let c=(o=this.remoteStats.get(t))===null||o===void 0?void 0:o.networkStats;c&&(r[t]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[u,{networkStats:h}]=c;h&&(r[u]=h)});return r}getNetworkQuality(){let t=0,r=0;return this.trafficStats&&(t=aI(this.trafficStats.B_unq),r=aI(this.trafficStats.B_dnq)),{uplinkNetworkQuality:t,downlinkNetworkQuality:r}}getRemoteVideoTrackStats(t){let r=(u,h)=>{if(!this.trafficStats)return h;let m=this.trafficStats.peer_delay.find(g=>g.peer_uid===u);return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},o={};if(t){var c;let u=(c=this.remoteStats.get(t))===null||c===void 0?void 0:c.videoStats;u&&(o[t]=r(t,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{videoStats:m}]=u;m&&(o[h]=r(h,m))});return o}getRTCStats(){let t=0,r=0,o=0,c=0,u=this.localStats.get(xe.LocalAudioTrack);u&&(t+=u.sendBytes,r+=u.sendBitrate);let h=this.localStats.get(xe.LocalVideoTrack);h&&(t+=h.sendBytes,r+=h.sendBitrate);let m=this.localStats.get(xe.LocalVideoLowTrack);m&&(t+=m.sendBytes,r+=m.sendBitrate),this.remoteStats.forEach(y=>{let{audioStats:v,videoStats:R}=y;v&&(o+=v.receiveBytes,c+=v.receiveBitrate),R&&(o+=R.receiveBytes,c+=R.receiveBitrate)});let g=1;return this.trafficStats&&(g+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:g,SendBitrate:r,SendBytes:t,RecvBytes:o,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(r=>r.B_ppad!==void 0||r.B_ppvd!==void 0),t.peer_delay.filter(r=>this.trafficStatsPeerList.indexOf(r.peer_uid)===-1).forEach(r=>{var o;let c=(o=this.p2pChannel)===null||o===void 0?void 0:o.getRemoteMedia(r.peer_uid),u=c!=null&&c.videoSSRC?fs.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?fs.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;r.B_ppad!==void 0&&r.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(r.peer_uid,r.B_ppad,r.B_ppvd,u>h?u:h),this.trafficStatsPeerList.push(r.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&k.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,r,o){if(!t)return!1;let c=!!o&&r.framesDecodeFreezeTime>o.framesDecodeFreezeTime,u=!o||r.framesDecodeCount>o.framesDecodeCount;return c||!u}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(r=>{let[o,c]=r;switch(o){case xe.LocalVideoTrack:case xe.LocalVideoLowTrack:{let m=c,g=$m({},Fk),y=t.getStats(),v=t.getLocalMedia(o);if(y){let R=y.videoSend.find(b=>b.ssrc===v?.ssrcs[0].ssrcId);if(R){let b=t.getLocalVideoSize(),A=t.getEncoderConfig(xe.LocalVideoTrack);var u;(R.codec==="H264"||R.codec==="H265"||R.codec==="VP8"||R.codec==="VP9"||R.codec==="AV1X"||R.codec==="AV1")&&(g.codecType=R.codec,m?.codecType!==R.codec&&((u=this.onVideoCodecChanged)===null||u===void 0||u.call(this,R.codec.toLocaleLowerCase()))),g.sendBytes=R.bytes,g.sendBitrate=m?8*Math.max(0,g.sendBytes-m.sendBytes):0,R.inputFrame?(g.captureFrameRate=R.inputFrame.frameRate,g.captureResolutionHeight=R.inputFrame.height,g.captureResolutionWidth=R.inputFrame.width):b&&(g.captureResolutionWidth=b.width,g.captureResolutionHeight=b.height),R.sentFrame?(g.sendFrameRate=R.sentFrame.frameRate,g.sendResolutionHeight=R.sentFrame.height,g.sendResolutionWidth=R.sentFrame.width):b&&(g.sendResolutionWidth=b.width,g.sendResolutionHeight=b.height),R.avgEncodeMs&&(g.encodeDelay=R.avgEncodeMs),A&&A.bitrateMax?g.targetSendBitrate=1e3*A.bitrateMax:R.targetBitrate&&(g.targetSendBitrate=R.targetBitrate),g.sendPackets=R.packets,g.sendPacketsLost=R.packetsLost,g.sendJitterMs=R.jitterMs,g.sendRttMs=R.rttMs,g.totalDuration=m?m.totalDuration+1:1,g.totalFreezeTime=m?m.totalFreezeTime:0,this.isLocalVideoFreeze(R)&&(g.totalFreezeTime+=1),R.scalabilityMode&&this.scalabilityMode!==R.scalabilityMode&&(k.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(R.scalabilityMode)),this.scalabilityMode=R.scalabilityMode)}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var h;this.localStats.set(o,g),(m?.sendResolutionWidth!==g.sendResolutionWidth||m?.sendResolutionHeight!==g.sendResolutionHeight)&&((h=this.onStatsChanged)===null||h===void 0||h.call(this,"resolution",{width:g.sendResolutionWidth,height:g.sendResolutionHeight})),g&&v&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,v.track,g);break}case xe.LocalAudioTrack:{let m=c,g=$m({},Vk),y=t.getStats(),v=t.getLocalMedia(o);if(y){let R=y.audioSend.find(b=>b.ssrc===v?.ssrcs[0].ssrcId);if(R){if(R.codec!=="opus"&&R.codec!=="aac"&&R.codec!=="PCMU"&&R.codec!=="PCMA"&&R.codec!=="G722"||(g.codecType=R.codec),R.inputLevel)g.sendVolumeLevel=Math.round(32767*R.inputLevel);else{let b=t.getLocalAudioVolume();b&&(g.sendVolumeLevel=Math.round(32767*b))}g.sendBytes=R.bytes,g.sendPackets=R.packets,g.sendPacketsLost=R.packetsLost,g.sendJitterMs=R.jitterMs,g.sendRttMs=R.rttMs,g.sendBitrate=m?8*Math.max(0,g.sendBytes-m.sendBytes):0}}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(xe.LocalAudioTrack,g),g&&v&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,v.track,g);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(r=>{var o,c;let[u,{videoStats:h,audioStats:m,videoPcStats:g}]=r,y=m,v=h,R=g,b=$m({},M5),A=$m({},U5),F=$m({},Bde),{audioTrack:M,videoTrack:j,audioSSRC:K,videoSSRC:q}=t.getRemoteMedia(u),Q;Q=this.store.useP2P?t.getStats(!0):t.getStats();let se=(o=Q)===null||o===void 0?void 0:o.audioRecv.find(Ce=>Ce.ssrc===K),oe=(c=Q)===null||c===void 0?void 0:c.videoRecv.find(Ce=>Ce.ssrc===q),te=this.trafficStats&&this.trafficStats.peer_delay.find(Ce=>Ce.peer_uid===u);if(se&&(se.codec!=="opus"&&se.codec!=="aac"&&se.codec!=="PCMU"&&se.codec!=="PCMA"&&se.codec!=="G722"||(b.codecType=se.codec),se.outputLevel?b.receiveLevel=Math.round(32767*se.outputLevel):M&&(b.receiveLevel=Math.round(32767*M.getVolumeLevel())),b.receiveBytes=se.bytes,b.receivePackets=se.packets,b.receivePacketsLost=se.packetsLost,b.receivePacketsDiscarded=se.packetsDiscarded,b.packetLossRate=b.receivePacketsLost/(b.receivePackets+b.receivePacketsLost),b.receiveBitrate=y?8*Math.max(0,b.receiveBytes-y.receiveBytes):0,b.totalDuration=y?y.totalDuration+1:1,b.totalFreezeTime=y?y.totalFreezeTime:0,b.freezeRate=b.totalFreezeTime/b.totalDuration,b.receiveDelay=se.jitterBufferMs,b.totalDuration>10&&$T.isRemoteAudioFreeze(M)&&(b.totalFreezeTime+=1)),oe){var de;oe.codec!=="H264"&&oe.codec!=="H265"&&oe.codec!=="VP8"&&oe.codec!=="VP9"&&oe.codec!=="AV1X"&&oe.codec!=="AV1"||(A.codecType=oe.codec),A.receiveBytes=oe.bytes,A.receiveBitrate=v?8*Math.max(0,A.receiveBytes-v.receiveBytes):0,A.decodeFrameRate=oe.decodeFrameRate<0?0:oe.decodeFrameRate,A.renderFrameRate=oe.decodeFrameRate<0?0:oe.decodeFrameRate,oe.outputFrame&&(A.renderFrameRate=oe.outputFrame.frameRate),oe.receivedFrame?(A.receiveFrameRate=oe.receivedFrame.frameRate,A.receiveResolutionHeight=oe.receivedFrame.height,A.receiveResolutionWidth=oe.receivedFrame.width):j&&(A.receiveResolutionHeight=j._videoHeight||0,A.receiveResolutionWidth=j._videoWidth||0),oe.framesRateFirefox!==void 0&&(A.receiveFrameRate=Math.round(oe.framesRateFirefox)),A.receivePackets=oe.packets,A.receivePacketsLost=oe.packetsLost,A.packetLossRate=A.receivePacketsLost/(A.receivePackets+A.receivePacketsLost);let Ce=v?v.totalFreezeTime:0,Pe=v?v.totalDuration:0;A.totalDuration=v?v.totalDuration+1:1,A.totalFreezeTime=(de=oe.totalFreezesDuration)!==null&&de!==void 0?de:Ce||0,A.receiveDelay=oe.jitterBufferMs||0;let Qe=!!q&&t.getRemoteVideoIsReady(q);oe.totalFreezesDuration===void 0&&j&&Qe&&$T.isRemoteVideoFreeze(j,oe,R)&&(A.totalFreezeTime+=1),A.freezeRate=Math.max(0,Math.min((A.totalFreezeTime-Ce)/(A.totalDuration-Pe),1))}te&&(b.end2EndDelay=te.B_ad,A.end2EndDelay=te.B_vd,b.transportDelay=te.B_ed,A.transportDelay=te.B_ed,b.currentPacketLossRate=te.B_ealr4/100,A.currentPacketLossRate=te.B_evlr4/100,F.uplinkNetworkQuality=te.B_punq?te.B_punq:0,F.downlinkNetworkQuality=te.B_pdnq?te.B_pdnq:0),this.remoteStats.set(u,{audioStats:b,videoStats:A,videoPcStats:oe,networkStats:F}),M&&this.exceptionMonitor.setRemoteAudioStats(M,b),j&&this.exceptionMonitor.setRemoteVideoStats(j,A)})}}class zG{constructor(){V(this,"destChannelMediaInfos",new Map),V(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){tG(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){tG(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){eI(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function KG(e){if(!(e instanceof zG))return new he(Y.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let t=e.getSrcChannelMediaInfo(),r=e.getDestChannelMediaInfo();if(!t)return new he(Y.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(r.size===0)return new he(Y.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class bp{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,r){V(this,"uid",void 0),V(this,"_uintid",void 0),V(this,"_trust_in_room_",!0),V(this,"_trust_audio_enabled_state_",!0),V(this,"_trust_video_enabled_state_",!0),V(this,"_trust_audio_mute_state_",!0),V(this,"_trust_video_mute_state_",!0),V(this,"_audio_muted_",!1),V(this,"_video_muted_",!1),V(this,"_audio_enabled_",!0),V(this,"_video_enabled_",!0),V(this,"_audio_added_",!1),V(this,"_video_added_",!1),V(this,"_is_pre_created",!1),V(this,"_video_pre_subscribed",!1),V(this,"_audio_pre_subscribed",!1),V(this,"_trust_video_stream_added_state_",!0),V(this,"_trust_audio_stream_added_state_",!0),V(this,"_audioTrack",void 0),V(this,"_videoTrack",void 0),V(this,"_dataChannels",[]),V(this,"_audioSSRC",void 0),V(this,"_videoSSRC",void 0),V(this,"_audioOrtc",void 0),V(this,"_videoOrtc",void 0),V(this,"_cname",void 0),V(this,"_rtxSsrcId",void 0),V(this,"_videoMid",void 0),V(this,"_audioMid",void 0),this.uid=t,this._uintid=r}}function YG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function MD(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?YG(Object(r),!0).forEach(function(o){V(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):YG(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}let rpe=e=>`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1 2
a=msid-semantic: WMS
a=ice-lite`.concat(e?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:2
`),_I="9",UD=2e4,EI=4e4,qG=class{get localCapabilities(){return Zn(this._localCapabilities)}get rtpCapabilities(){return Zn(this._rtpCapabilities)}get candidates(){return Zn(this._candidates)}get iceParameters(){return Zn(this._iceParameters)}get dtlsParameters(){return Zn(this._dtlsParameters)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],o=arguments.length>3&&arguments[3]!==void 0&&arguments[3];V(this,"sessionDesc",void 0),V(this,"_localCapabilities",void 0),V(this,"_rtpCapabilities",void 0),V(this,"_candidates",void 0),V(this,"_originCandidates",void 0),V(this,"_iceParameters",void 0),V(this,"_isUseExtmapAllowMixed",void 0),V(this,"_isUseLocalCodecs",void 0),V(this,"_isUseDataChannel",void 0),V(this,"_dtlsParameters",void 0),V(this,"setup",void 0),V(this,"currentMidIndex",void 0),V(this,"cname",void 0),V(this,"useLocalCodecsMids",[]),V(this,"preloadSsrcs",[]),V(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=t,this._isUseLocalCodecs=r,this._isUseDataChannel=o,e=Zn(e);let{iceParameters:c,dtlsParameters:u,candidates:h,rtpCapabilities:m,setup:g,localCapabilities:y,cname:v}=e;this._rtpCapabilities=m,this._candidates=h,this._originCandidates=Zn(h),this._iceParameters=c,this._dtlsParameters=u,this._localCapabilities=y,this.setup=g,this.cname=v,[this.sessionDesc]=this.updateRemoteRTPCapabilities(m),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(e){return e.length===this.preloadSsrcs.length&&e.every(t=>{var r;return ke(r=this.preloadSsrcs).call(r,t)})}preloadRemoteMedia(e){let t=0,r=[],o=[];for(;e>0;){let c=[MD({ssrcId:EI+t},z("USE_SUB_RTX")?{rtx:EI+t+1}:{})],u="".concat(EI+t,"_").concat(UD+t),{ssrcs:h,ssrcGroups:m}=KT(c,this.cname,z("SYNC_GROUP")?u:void 0),g=this.preCreateOrRecycleSendMedia("video",h,m,void 0),y=[{ssrcId:UD+t}],v="".concat(EI+t,"_").concat(UD+t),{ssrcs:R,ssrcGroups:b}=KT(y,this.cname,z("SYNC_GROUP")?v:void 0),A=this.preCreateOrRecycleSendMedia("audio",R,b,void 0);e--,t+=2,r.push(g,A),o.push(h[0].ssrcId,R[0].ssrcId)}return this.useLocalCodecsMids.push(...r),this.preloadSsrcs=o,{mids:r,preSSRCs:o,isAvailable:!0}}preCreateOrRecycleSendMedia(e,t,r,o){let c=this.rtpCapabilities.send.videoCodecs,u=this._isUseLocalCodecs||c.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;k.debug("create or recycle send media without remote rtp capabilities, ssrcs ",t[0].ssrcId);let h=e===et.VIDEO?u.videoCodecs:u.audioCodecs,m=e===et.VIDEO?u.videoExtensions:u.audioExtensions;this.currentMidIndex+=1;let g="".concat(this.currentMidIndex),y={media:{mediaType:e,port:_I,protos:["UDP","TLS","RTP","SAVPF"],fmts:h.map(v=>v.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};return y=this.mungSendMediaDesc(y,o),this.sessionDesc.mediaDescriptions.push(y),this.updateBundleMids(),g}toString(){return th(this.sessionDesc)}send(e,t,r,o){let{ssrcs:c,ssrcGroups:u}=KT(t,this.cname,z("SYNC_GROUP")?r:void 0),h=this.findPreloadMediaDesc(c);if(h){if(Qn()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,h.attributes.mid),o&&(o.twcc||o.remb)){let m=this.sessionDesc.mediaDescriptions.indexOf(h);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(h,o),{mid:h.attributes.mid,needExchangeSDP:!0}}return{mid:h.attributes.mid,needExchangeSDP:!1}}{let m=this.findAvailableMediaIndex(e,c),g;return m===-1||m===1&&(Pi()||(function(){let y=pn();return!(y.name!==_n.CHROME||!y.osVersion)&&Number(y.version)<=90})()||Bl(143)||_p(143)||z("RESERVE_MID_1_MLINE")||z("ENABLE_ENCODED_TRANSFORM")&&Zd())||m===0&&!(function(y){let v=pn();return!(v.name!==_n.FIREFOX||!v.osVersion)&&Number(v.version)===y})(138)&&z("USE_SUB_RTX")||G4()?(g=this.createOrRecycleSendMedia(e,c,u,"sendonly",o),this.updateBundleMids()):(g=Zn(this.sessionDesc.mediaDescriptions[m]),g.attributes.direction="sendonly",g.attributes.ssrcs=c,g.attributes.ssrcGroups=u,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(g,o)),Qn()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,g.attributes.mid),{mid:g.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){let{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){let t=e.map(c=>{let{kind:u,ssrcMsg:h,mslabel:m}=c;return this.send(u,h,m)}),r=[],o=!1;return t.forEach(c=>{let{mid:u,needExchangeSDP:h}=c;h&&(o=!0),r.push(u)}),{mids:r,needExchangeSDP:o}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(r=>{r.attributes.mid==="0"||Qn()||G4()?r.attributes.ssrcs=[]:(r.attributes.ssrcs=[],r.attributes.direction="inactive",r.media.port="0")}),this.updateBundleMids()}mute(e){let t=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){let t=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>ke(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>ke(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="recvonly"})}receive(e,t,r,o){e.forEach((c,u)=>{this.createOrRecycleRecvMedia(c,[],"recvonly",t,r,o[u])}),this.updateBundleMids()}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e){let t=this.sessionDesc||Hs((r=this._isUseExtmapAllowMixed,this._isUseDataChannel?rpe(r):`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(r?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var r;this._rtpCapabilities=e;let o=!1,c=this.rtpCapabilities.send,u=this.localCapabilities.send,h=this.localCapabilities.recv,m=h.videoCodecs,g=h.audioCodecs,y=h.videoExtensions,v=h.audioExtensions;for(let F of t.mediaDescriptions){var R;if(F.attributes.direction!=="sendonly"||typeof F.attributes.mid!="string"||!ke(R=this.useLocalCodecsMids).call(R,F.attributes.mid)){if(o=!0,F.attributes.iceUfrag=this._iceParameters.iceUfrag,F.attributes.icePwd=this._iceParameters.icePwd,F.attributes.fingerprints=this._dtlsParameters.fingerprints,F.attributes.candidates=this._candidates,F.attributes.setup=this.setup,F.media.mediaType==="application"&&(F.attributes.sctpPort="5000"),F.media.mediaType==="video")if(this._isUseLocalCodecs&&F.attributes.direction==="sendonly"){var b;F.media.fmts=m.map(j=>j.payloadType.toString(10)),F.attributes.payloads=m,F.attributes.extmaps=y;let M=F.attributes.mid;typeof M!="string"||ke(b=this.useLocalCodecsMids).call(b,M)||this.useLocalCodecsMids.push(M)}else if(c.videoCodecs.length===0){let M=u.videoCodecs.filter(j=>{var K,q;return(K=j.rtpMap)===null||K===void 0?void 0:ke(q=K.encodingName.toLowerCase()).call(q,"vp8")});M.length===0&&M.push(u.videoCodecs[0]),F.media.fmts=M.map(j=>j.payloadType.toString(10)),F.attributes.payloads=M,F.attributes.extmaps=[]}else F.media.fmts=c.videoCodecs.map(M=>M.payloadType.toString(10)),F.attributes.payloads=c.videoCodecs,F.attributes.extmaps=c.videoExtensions;if(F.media.mediaType==="audio")if(this._isUseLocalCodecs&&F.attributes.direction==="sendonly"){var A;F.media.fmts=g.map(j=>j.payloadType.toString(10)),F.attributes.payloads=g,F.attributes.extmaps=v;let M=F.attributes.mid;typeof M!="string"||ke(A=this.useLocalCodecsMids).call(A,M)||this.useLocalCodecsMids.push(M)}else if(c.audioCodecs.length===0){let M=u.audioCodecs.filter(j=>{var K,q;return(K=j.rtpMap)===null||K===void 0?void 0:ke(q=K.encodingName.toLowerCase()).call(q,"opus")})||[u.audioCodecs[0]];F.media.fmts=M.map(j=>j.payloadType.toString(10)),F.attributes.payloads=M,F.attributes.extmaps=[]}else F.media.fmts=c.audioCodecs.map(M=>M.payloadType.toString(10)),F.attributes.payloads=c.audioCodecs,F.attributes.extmaps=c.audioExtensions,$E(F)}}return this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1,[this.sessionDesc,o]}updateCandidates(e){let t=this._originCandidates.filter(o=>o.transport==="udp"),r=[];if(t.forEach(o=>{r.push(MD(MD({},o),{},{foundation:"tcpcandidate",priority:Number(o.priority)-1+"",transport:"tcp",port:Number(o.port)+90+""}))}),t.length!==0){switch(e){case Di.TCP_RELAY:this._candidates=r;break;case Di.UDP_TCP_RELAY:case Di.RELAY:this._candidates=[...t,...r];break;default:this._candidates=t}for(let o of this.sessionDesc.mediaDescriptions)o.attributes.candidates=this.candidates}}restartICE(e){e=Zn(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){let t=[];for(let r=0;r<e;r++)t.push((this.currentMidIndex+r+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex(r=>{let o=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(Qn()){if(o){let c=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(c||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!c||c!==r.attributes.mid)}return!1}return o})}createOrRecycleDataChannel(){for(let r of this.sessionDesc.mediaDescriptions)if(r.media.mediaType==="application")return{mediaDesc:r,needExchangeSDP:!1};this.currentMidIndex+=1;let e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:_I,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,r,o,c,u){let h=e._mediaStreamTrack.kind,m=this.rtpCapabilities.recv,g=qT(h,m,this.localCapabilities.send,h===et.VIDEO?o:c),y=h===et.VIDEO?m.videoExtensions:m.audioExtensions;this.currentMidIndex+=1;let v="".concat(this.currentMidIndex),R={media:{mediaType:h,port:_I,protos:["UDP","TLS","RTP","SAVPF"],fmts:g.map(A=>A.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:g,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(v)}};R=this.mungRecvMediaDsec(R,e,u);let b=this.findFirstClosedMedia(h);if(b){let A=this.sessionDesc.mediaDescriptions.indexOf(b);this.sessionDesc.mediaDescriptions[A]=R}else this.sessionDesc.mediaDescriptions.push(R);return R}updateRemoteDtlsParameters(e){let t=new Set(this._dtlsParameters.fingerprints.map(c=>c.fingerprint)),r=new Set(e.map(c=>c.fingerprint)),o=!1;t.size!==r.size&&(o=!0);for(let c of t)r.has(c)||(o=!0);return o}updateRemoteCodec(e,t,r){let o=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(R=>R.rtpMap&&R.rtpMap.encodingName.toLowerCase()||"").filter(R=>{var b;return ke(b=Object.keys(Fm)).call(b,R)}))],c=new Set(t);if(o.every(R=>c.has(R)))return k.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;let u=this._rtpCapabilities.recv.videoCodecs.filter(R=>t.some(b=>{var A;return ke(A=R.rtpMap&&R.rtpMap.encodingName.toLowerCase()||"").call(A,b)}));if(u.length===0)return k.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(o," codecs: ").concat(t)),!1;let h=[...new Set(u.map(R=>R.rtpMap&&R.rtpMap.encodingName.toLowerCase()||""))],m;if(k.debug("updateRemoteCodec, from ".concat(o," to ").concat(h)),e.length===0)m=this.sessionDesc.mediaDescriptions.filter(R=>R.media.mediaType==="video"&&R.attributes.direction==="recvonly");else if(m=this.sessionDesc.mediaDescriptions.filter(R=>R.attributes.mid&&R.media.mediaType==="video"&&ke(e).call(e,R.attributes.mid)&&R.attributes.direction==="recvonly"),m.length!==e.length)return k.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(z("USE_PUB_RTX")||z("USE_SUB_RTX")){let R=Rp(u,this.rtpCapabilities.recv.videoCodecs);u.push(...R)}this._rtpCapabilities.recv.videoCodecs=u;let g=this.localCapabilities.send,y=this.rtpCapabilities.recv,v=qT(et.VIDEO,y,g,r);return m.forEach(R=>{let b=v.map(A=>A.payloadType.toString(10));k.debug("updateRemoteCodec mid: ".concat(R.attributes.mid,", from"),R.attributes.payloads,"to",v),R.attributes.payloads=v,R.media.fmts=b}),k.debug("updateRemoteCodec success, mids: ".concat(e,", codecs: ").concat(t,", remote recv: ").concat(this._rtpCapabilities.recv.videoCodecs.length,", remote send: ").concat(this._rtpCapabilities.send.videoCodecs.length)),!0}createOrRecycleSendMedia(e,t,r,o,c){let u=this.rtpCapabilities.send.videoCodecs,h=this._isUseLocalCodecs||u.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,m=e===et.VIDEO?h.videoCodecs:h.audioCodecs,g=e===et.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;let y="".concat(this.currentMidIndex),v={media:{mediaType:e,port:_I,protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(y)}};v=this.mungSendMediaDesc(v,c);let R=this.findFirstClosedMedia(e);if(R){let b=this.sessionDesc.mediaDescriptions.indexOf(R);this.sessionDesc.mediaDescriptions[b]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}mungRecvMediaDsec(e,t,r){let o=Zn(e);return SD(o),Jm(o,t),TD(o,t),TG(o),uI(o,r,this.localCapabilities.send),o}mungSendMediaDesc(e,t){let r=Zn(e);return r.attributes&&r.attributes.payloads&&Array.isArray(r.attributes.payloads)&&r.attributes.payloads.length>0&&r.attributes.payloads.forEach(o=>{o.rtpMap&&o.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&z("ENABLE_DOWN_SPS_PPS")&&(o.fmtp&&o.fmtp.parameters||(o.fmtp={parameters:{}}),o.fmtp.parameters["sps-pps-idr-in-keyframe"]="1")}),uI(r,t,this.localCapabilities.recv),$E(r),r}updateRecvMedia(e,t){let r=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===e);if(r!==-1){let o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],t);this.sessionDesc.mediaDescriptions[r]=o}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Qn()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var r;return((r=t.attributes)===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId)===e[0].ssrcId})}getSSRC(e){var t;return(t=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===e))===null||t===void 0?void 0:t.attributes.ssrcs}};function XG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function sh(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?XG(Object(r),!0).forEach(function(o){V(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):XG(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}var ey=(function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e})(ey||{});let yI=new Map;function JG(e,t,r,o){let{scale:c}=e;if(c===0&&o===ey.UP||c>=t.length-1&&o===ey.DOWN)return e;let u=sh(sh({},e),{},{scale:o===ey.DOWN?++c:--c});switch(r){case"maintain-framerate":u=sh(sh({},u),t[c].motion);break;case"maintain-resolution":u=sh(sh({},u),t[c].detail);break;case"balanced":u=sh(sh({},u),t[c].balanced)}return u}function $G(e,t){if(t){let r={overUse:0,underUse:0,adaptationList:QG(t)};yI.set(e,r)}else yI.delete(e)}function QG(e){let t=sh({},e),{bitrateMax:r,frameRate:o,scaleResolutionDownBy:c,bitrateMin:u}=t,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:g,BITRATE_MIN_THRESHOLD:y,BITRATE_MAX_THRESHOLD:v,BWE_SCALE_UP_THRESHOLD:R,BWE_SCALE_DOWN_THRESHOLD:b,PERF_SCALE_DOWN_THRESHOLD:A,PERF_SCALE_UP_THRESHOLD:F,BALANCE_BITRATE_FACTOR:M,BALANCE_FRAMERATE_FACTOR:j,BALANCE_RESOLUTION_FACTOR:K,MOTION_RESOLUTION_FACTOR:q,MOTION_BITRATE_FACTOR:Q,DETAIL_FRAMERATE_FACTOR:se,DETAIL_BITRATE_FACTOR:oe}=Nk,te=Math.min(t.frameRate,m),de=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(b,1)*r),bwe_up:r,fps_down:Math.round(Math.pow(A,1)*te),fps_up:o},balanced:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:r,bitrateMin:u},motion:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:r,bitrateMin:u},detail:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:r,bitrateMin:u}}];for(let Ce=1;Ce<=g;Ce++){let Pe={bwe_up:Math.round(Math.pow(R,Ce)*r),bwe_down:Math.round(Math.pow(b,Ce+1)*r),fps_up:Math.round(Math.pow(F,Ce)*te),fps_down:Math.round(Math.pow(A,Ce+1)*te)},Qe={scaleResolutionDownBy:c/Math.pow(K,Ce),frameRate:Math.max(Math.round(Math.pow(j,Ce)*o),h),bitrateMax:Math.max(Math.round(Math.pow(M,Ce)*r),v),bitrateMin:Math.max(Math.round(Math.pow(M,Ce)*u),y)},ot={scaleResolutionDownBy:c/Math.pow(q,Ce),frameRate:o,bitrateMax:Math.max(Math.round(Math.pow(Q,Ce)*r),v),bitrateMin:Math.max(Math.round(Math.pow(Q,Ce)*u),y)},Xt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(se,Ce)*o),h),bitrateMax:Math.max(Math.round(Math.pow(oe,Ce)*r),v),bitrateMin:Math.max(Math.round(Math.pow(oe,Ce)*u),y)};de.push({scale:Ce,threshold:Pe,balanced:Qe,motion:ot,detail:Xt})}return de}function ipe(e,t,r,o,c,u){let h=yI.get(e)||{overUse:0,underUse:0,adaptationList:QG(c)},{adaptationList:m}=h;yI.set(e,h);let{OVERUSE_TIMES_THRESHOLD:g,UNDERUSE_TIMES_THRESHOLD:y}=Nk,{scale:v}=o,R,b;return typeof t=="number"&&t>0&&(function(A,F,M,j){if(F>=M.length)return!1;let{threshold:{fps_down:K}}=M[F];return z("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&(K=M[0].threshold.fps_down),A<K})(t,v,m,u)&&(h.overUse++,b=kE.CPU,h.overUse>g)||typeof r=="number"&&r>0&&(function(A,F,M){if(F>=M.length)return!1;let{threshold:{bwe_down:j}}=M[F];return A<j})(r,v,m)&&(h.overUse++,b=kE.BANDWIDTH,h.overUse>g)?(h.overUse=0,h.underUse=0,R=JG(o,m,u,ey.DOWN),[R,b]):(typeof t=="number"&&t>0&&typeof r=="number"&&r>0&&(function(A,F,M,j){if(F===0)return;let{threshold:{fps_up:K}}=M[F];return z("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&(K=M[1].threshold.fps_up),A>K})(t,v,m,u)&&(function(A,F,M){if(F===0)return;let{threshold:{bwe_up:j}}=M[F];return A>j})(r,v,m)&&(h.underUse++,h.underUse>y&&(h.overUse=0,h.underUse=0,R=JG(o,m,u,ey.UP),R.scale===0&&(b=kE.NONE))),[R,b])}function ZG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function VD(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?ZG(Object(r),!0).forEach(function(o){V(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ZG(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}function e8(e){var t;return!!z("ENABLE_AG_ADAPTATION")&&!!(e instanceof Gb||ke(t=e._hints).call(t,bn.CUSTOM_TRACK))&&(!!z("FORCE_SUPPORT_AG_ADAPTATION")||!!(B4(14,0,!1)&&W4(17,4,!0)||j4(14)&&uk(17,4,!0)))}let vI=new Map;function t8(e,t,r,o,c,u){if(ty(e,r),c(t),o!=="balanced"&&o!=="maintain-framerate"&&o!=="maintain-resolution")return;let h=-1;$G(e,t);let m=window.setInterval(()=>{let y=vI.get(e);if(!z("ENABLE_AG_ADAPTATION")||!y)return ty(e,r),void c(t);let v=u();if(v.sendPackets>0&&v.OutgoingAvailableBandwidth>0){if(h===-1)return void(h=Date.now());if(Date.now()-h<1e3)return;let R=v.sendFrameRate,b=v.OutgoingAvailableBandwidth,[A,F]=ipe(e,R,b,y.adaptationConfig,t,o);F&&(r.qualityLimitationReason=F),A&&y.adaptationConfig.scale!==A.scale&&(k.debug("[".concat(e,"] applyAdaptation: ").concat(r.qualityLimitationReason,`
           sendFps `).concat(R,", bwe ").concat(b,", switch from ").concat(y.adaptationConfig.scale," to ").concat(A.scale," ")),y.adaptationConfig=VD(VD({},y.adaptationConfig),A),c(A))}},z("CHECK_LOCAL_STATS_INTERVAL")),g=VD({},t);vI.set(e,{timer:m,adaptationConfig:g,originConfig:t,adaptationFunc:c}),k.debug("[".concat(e,"] start adaptation, originConfig: ").concat(JSON.stringify(t),", degradationPreference: ").concat(o))}function ty(e,t){let r=vI.get(e);if(r){let{timer:o}=r;window.clearTimeout(o),vI.delete(e)}t.qualityLimitationReason=kE.NONE,$G(e)}function spe(e,t){var r;let o;switch(t){case xe.LocalAudioTrack:o=On.Audio;break;case xe.LocalVideoTrack:o=ke(r=e._hints).call(r,bn.SCREEN_TRACK)?On.Screen:On.High;break;case xe.LocalVideoLowTrack:o=On.Low}return o}function FD(e){let t=Qt();if(e.some(r=>r._bypassWebAudio))throw new _e(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new _e(Y.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function jD(e,t){FD(e);let r=new ai;return e.forEach(o=>r.addAudioTrack(o)),r}let ope=!Qt().supportUnifiedPlan||z("CHROME_FORCE_PLAN_B")&&Xu();function QT(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.useDcSignal)return r={spec:t,store:e},Yl("DataChannelConnection").create(r);var r;return ope?(function(o){return Yl("PlanBConnection").create(o)})({spec:t,store:e}):new Ta(t,e)}function BD(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function WD(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(km(e.turnServer.servers))return!1;if(z("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var cn;function n8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function Xl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?n8(Object(r),!0).forEach(function(o){V(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n8(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}let Ta=(cn=class Eg extends iI{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var r;return ke(r=Object.keys(Fm)).call(r,t)}))]}constructor(t,r){super(t,r),V(this,"id",In(5,"connection-")),V(this,"store",void 0),V(this,"peerConnection",void 0),V(this,"forceTurn",!1),V(this,"remoteSDP",void 0),V(this,"initialOffer",void 0),V(this,"transportEventReceiver",void 0),V(this,"statsFilter",void 0),V(this,"extension",{useXR:z("USE_XR")}),V(this,"localCapabilities",void 0),V(this,"remoteCodecs",void 0),V(this,"localCandidateCount",0),V(this,"allCandidatesReceived",!1),V(this,"isPreallocation",!1),V(this,"isPreRender",!1),V(this,"preMediaMap",new Map),V(this,"dataStreamChannelMap",new Map),V(this,"establishPromise",void 0),V(this,"recoveredDataChannelIds",[]),V(this,"currentDataChannelId",1),V(this,"supportAV1RtpSpec",!1),V(this,"mutex",void 0),V(this,"qualityLimitationReason",kE.NONE),V(this,"isFirstConnected",!1),this.store=r,this.forceTurn=WD(t),this.mutex=new ki("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(Eg.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=kb(this.peerConnection,z("STATS_UPDATE_INTERVAL"),void 0,Qn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,r){if(this.remoteCodecs=r,!this.remoteSDP)return void k.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(r));if(this.remoteSDP.updateRemoteCodec(t,r,this.store.codec)){let o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);let u=this.remoteSDP.toString();c?.(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else k.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let o=td(r.sdp),c=await CD({filterRTX:!z("USE_PUB_RTX")&&!z("USE_SUB_RTX"),filterVideoFec:z("FILTER_VIDEO_FEC"),filterAudioFec:z("FILTER_AUDIO_FEC"),filterVideoCodec:z("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:z("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:z("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=YT(c),this.initialOffer=r,z("ENABLE_SVC")&&this.store.codec=="av1"){let h=await wG();var t;h&&(this.supportAV1RtpSpec=!0,(t=c.send)===null||t===void 0||t.videoExtensions.push(h))}let u;return r.sdp&&dI(r.sdp)&&(u=Zn(c),mG(u)),Xl(Xl({},o),{},{rtpCapabilities:u||c,offerSDP:r.sdp})}catch(r){throw new _e(Y.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&dI(this.initialOffer.sdp)&&gG(t.rtpCapabilities,this.localCapabilities),this.remoteSDP=new qG(Xl(Xl({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!z("ENABLE_PRE_SUB_WITH_PRE_PC")||!z("PRE_USE_LOCAL_CODECS"))&&VT(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let r=this.remoteSDP.toString(),o=RD(this.initialOffer.sdp,this.extension),c=this.logSDPExchange(o||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),c?.(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r});let u=this.peerConnection.getTransceivers()[0];if(u!=null&&u.receiver&&this.tryBindTransportEvents(u.receiver),VT(this.store))if(t.preallocation&&z("ENABLE_PRE_SUB_WITH_PRE_PC")){let h=z("PRE_SUB_NUM"),{mids:m,preSSRCs:g}=this.remoteSDP.preloadRemoteMedia(h);await Oo(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(g)),this.presetMedia(m,g)}else{let{preSSRCs:h=[]}=t,m=h.map(y=>y.ssrcMsg[0].ssrcId);if(h.length===0)return;let{mids:g}=this.remoteSDP.batchSend(h.map(y=>Object.assign({},y)));await Oo(this.peerConnection,this.remoteSDP,this.extension),k.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(m)),this.presetMedia(g,m)}}catch(r){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}presetMedia(t,r){t.forEach((o,c)=>{this.peerConnection.getTransceivers().forEach(u=>{if(u.mid!=null&&o===u.mid&&u.receiver.track){let h=u.receiver.track,m;h.kind==="video"&&z("ENABLE_PRE_RENDER")&&(m=new Wb({trackId:"track-".concat(h.kind,"-unknown-").concat(this.store.clientId,"_").concat(In(5,""))},!0),m.updateVideoTrack(h),m.onFirstVideoFrameRender=()=>{var g;let y=this.preMediaMap.get(r[c]);y&&(y.firstVideoRender=Date.now()),(g=this.onFirstVideoRender)===null||g===void 0||g.call(this,r[c])},m.onVideoBufferReady=()=>{var g;(g=this.onFirstVideoBufferReady)===null||g===void 0||g.call(this,r[c])},m.play(this.store.sessionId||void 0),this.isPreRender=!0),this.preMediaMap.set(r[c],{mid:o,track:h,player:m,transceiver:u})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let r=!1,{rtpCapabilities:o}=t;if([,r]=this.remoteSDP.updateRemoteRTPCapabilities(o),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){let h=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);r=r||h}let{preSSRCs:c=[]}=t,u=c.map(h=>h.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(u)){let h=[],m=[];if(Array.from(this.preMediaMap.entries()).every(g=>{let[y,{mid:v,player:R,track:b}]=g;return h.push(v),m.push(y),this.preMediaMap.delete(y),R&&R.destroy(),!0}),h.length>0&&(this.remoteSDP.stopSending(h),await Oo(this.peerConnection,this.remoteSDP,this.extension),k.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(m)),tt.reportApiInvoke(this.store.sessionId,{name:ar.PRELOAD_MEDIA_FAILED,options:[c,m],tag:Fn.TRACER}).onSuccess()),c.length>0){let{mids:g}=this.remoteSDP.batchSend(c.map(y=>Object.assign({},y)));await Oo(this.peerConnection,this.remoteSDP,this.extension),k.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(u)),this.presetMedia(g,u)}}r?(await Oo(this.peerConnection,this.remoteSDP,this.extension),k.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):k.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(r){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(r.toString()))}}send(t,r,o){var c=this;return oo(function*(){let u=yield Ft(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let h=[],m=HT();t.forEach(j=>{let K=c.peerConnection.addTransceiver(j._mediaStreamTrack,Xl({direction:"sendonly"},j.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push(K),j._updateRtpTransceiver(K)}),Qn()&&z("SIMULCAST")===!0&&(yield Ft(c.applySimulcastForFirefox(h,t)));let g=yield Ft(c.peerConnection.createOffer()),y=c.remoteSDP.predictReceivingMids(t.length),v=c.mungSendOfferSDP(g.sdp,t,y),R=Hs(v),b=y.map(j=>{let K=R.mediaDescriptions.find(q=>q.attributes.mid===j);if(!K)throw new Error("Cannot extract ssrc from mediaDescription.");return vD(K,z("USE_PUB_RTX"))}),A;try{A=yield b}catch(j){A=[],c.remoteSDP.receive(t,r,o,A);let K=c.remoteSDP.toString();throw yield Ft(c.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield Ft(c.peerConnection.setRemoteDescription({type:"answer",sdp:K})),yield Ft(c.stopSending(y,!0)),j}c.remoteSDP.receive(t,r,o,A);let F=c.remoteSDP.toString(),M=c.logSDPExchange(v,"offer","local","send");return yield Ft(c.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield Ft(c.applySimulcastEncodings(h,t)),yield Ft(c.applySendEncodings(h,t)),M?.(F),yield Ft(c.peerConnection.setRemoteDescription({type:"answer",sdp:F})),h.map((j,K)=>{let q=y[K];return{localSSRC:b[K],id:q,transceiver:j}})}catch(h){throw h instanceof _e?h:new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async createDataChannels(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(t);if(o&&o.readyState==="open")k.debug("[P2PConnection] Channels are already available and can be reused directly.");else{let u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:z("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,o)}r.forEach(u=>{u._updateOriginDataChannel(o)});let{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){let u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});let h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),k.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else k.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof _e?o:new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(t){try{let r=this.dataStreamChannelMap.get(t);return r&&(r.id&&this.recoveredDataChannelIds.push(r.id),r.close()),void this.dataStreamChannelMap.delete(t)}catch(r){throw r instanceof _e?r:new _e(Y.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(r.toString()))}}async stopSending(t,r){let o=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let c=this.peerConnection.getTransceivers().filter(g=>t.indexOf(g.mid)!==-1);if(c.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(g=>{var y;ty(this.id+g.mid,this),g.direction="inactive",(y=g.stop)===null||y===void 0||y.call(g)});let u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(t);let m=this.remoteSDP.toString();h?.(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(t,r,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:u,needExchangeSDP:h}=this.remoteSDP.send(t,r,o,c);h&&(await Oo(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));let m=this.peerConnection.getTransceivers().find(g=>g.mid===u);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:u,transceiver:m}}catch(u){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let{mids:r,needExchangeSDP:o}=this.remoteSDP.batchSend(t);return o&&(await Oo(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),r.map(c=>{let u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(r){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(u=>{Array.from(this.preMediaMap.entries()).some(h=>{let[m,{mid:g,player:y}]=h;if(g===u)return this.preMediaMap.delete(m),y&&y.destroy(),!0})}),this.remoteSDP.stopSending(t);let r=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let c=await this.peerConnection.createAnswer();o?.(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);let r=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let c=await this.peerConnection.createAnswer();o?.(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(r.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);let r=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let c=await this.peerConnection.createAnswer();o?.(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(r.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(h=>{h.direction="inactive"});let o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(t);let u=this.remoteSDP.toString();c?.(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(r){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(async(h,m)=>{h.direction="sendonly"});let o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);let u=this.remoteSDP.toString();c?.(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(r){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return oo(function*(){let o=yield Ft(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");let c=Qt().supportPCSetConfiguration,u=z("FORCE_TURN_TCP")||r.forceTurn;if(t===Di.RELAY&&!c)return;if(c&&!u){let R=t===Di.RELAY?"relay":"all",b=r.peerConnection.getConfiguration();b.iceTransportPolicy!==R&&(k.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(b.iceTransportPolicy,"] to [").concat(R,"]")),b.iceTransportPolicy=R,r.peerConnection.setConfiguration(b))}r.remoteSDP.updateCandidates(t);let h=yield Ft(r.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let m=td(h.sdp),{remoteIceParameters:g}=yield m.iceParameters;r.remoteSDP.restartICE(g);let y=r.remoteSDP.toString(),v=r.logSDPExchange(h.sdp||"","offer","local","restartICE");r.store.descriptionStart(),yield Ft(r.peerConnection.setLocalDescription(h)),v?.(y),yield Ft(r.peerConnection.setRemoteDescription({type:"answer",sdp:y}))}catch(c){k.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;let t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Di.TCP_RELAY),await Oo(this.peerConnection,this.remoteSDP,this.extension)}catch(r){k.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),r)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(r=>{ty(this.id+r.mid,this)}),this.preMediaMap.forEach(r=>{let{player:o}=r;o&&o.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Xl(Xl({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);let u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h?.(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new _e(Y.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(t,r){let o=this.peerConnection.getTransceivers().filter(c=>c.mid===t);o.length===1&&(this.isVP8Simulcast(r)?Qn()||await this.applySimulcastEncodings(o,[r]):await this.applySendEncodings(o,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){let o=this.peerConnection.getTransceivers().find(c=>c.mid===r);o&&await o.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let r=t[0].transport.iceTransport,{local:o,remote:c}=r.getSelectedCandidatePair();return{local:Xl(Xl({},Hc),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:Xl(Xl({},Hc),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var r;let o="code: ".concat(t.errorCode,", message: ").concat(t.errorText),c=t.port?"local: ".concat(t.port):"",u=ed(t.url||"");k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(o,"), url: ").concat(u||"",", host_candidate:").concat(c)),(r=this.onICECandidateError)===null||r===void 0||r.call(this,o)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},z("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let r={iceServers:[]},o=t.cloudProxyServer||"disabled";return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&(km(t.turnServer.servers)?r.iceServers=t.turnServer.servers:z("NEW_TURN_MODE")&&r.iceServers&&o==="disabled"?(z("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&r.iceServers.push(...Eg.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):r.iceServers.push(...Eg.newTurnServerConfigToIceServers(t.turnServer.servers)),z("NEW_FORCE_TURN")&&(r.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(r.iceServers&&r.iceServers.push(...Eg.turnServerConfigToIceServers(t.turnServer.servers)),z("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...Eg.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),z("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(r.iceTransportPolicy="relay")}))),z("ENABLE_ENCODED_TRANSFORM")&&Qt().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(t){let r=[];return t.forEach(o=>{o.security?o.tcpport&&r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Xc(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!z("FORCE_TURN_TCP")&&r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),r}static newTurnServerConfigToIceServers(t){let r=[];return t.forEach(o=>{let c=z("NEW_TURN_MODE");c===1?r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}):c===2?r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}):c===3?r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Xc(o.turnServerURL),":443?transport=tcp")}):c===4&&(r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}),r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}),r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Xc(o.turnServerURL),":443?transport=tcp")}))}),r}tryBindTransportEvents(t){let r=t.transport;if(r){this.transportEventReceiver=t,r.onstatechange=()=>{var c;r!=null&&r.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,r.state))},r.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};let o=r.iceTransport;o&&(o.onstatechange=()=>{let c=r?.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){let{local:c,remote:u}=o.getSelectedCandidatePair()||{};if(c&&u){let h=c.address+":"+c.port,m=u.address+":"+u.port;k.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(ed(h)),", remote ").concat(JSON.stringify(ed(m))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var o,c;if(r||(r=this.peerConnection.getSenders().find(M=>M.track===t._mediaStreamTrack)),!r)return k.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return k.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Qt().supportSetRtpSenderParameters)return k.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let u={},h={};switch(t._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}let m=pG(this.peerConnection,t._mediaStreamTrack),g=n6(t);if(e8(t)&&m&&r&&g&&this.getLocalVideoStats&&ke(o=["vp8","vp9"]).call(o,this.store.codec)){var y;let M=u.degradationPreference||(ke(y=t._hints).call(y,bn.CUSTOM_TRACK)?z("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");t8(this.id+m.mid,g,this,M,j=>{r&&this.updateAdaptation(r,j)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var v;let{bitrateMax:M,frameRate:j,scaleResolutionDownBy:K}=t._encoderConfig;M&&(h.maxBitrate=1e3*M),(ke(v=t._hints).call(v,bn.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(j&&(h.maxFramerate=ho(j)),K&&K>=1&&(h.scaleResolutionDownBy=K))}let{maxFramerate:R}=z("ENCODER_CONFIG_LIMIT");if(R&&typeof R=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,R):R),z("DSCP_TYPE")&&Xu()){var b;let M=z("DSCP_TYPE");ke(b=["very-low","low","medium","high"]).call(b,M)&&(h.networkPriority=M)}let A=r.getParameters(),F=(c=A.encodings)===null||c===void 0?void 0:c[0];Qn()&&!F&&(u.encodings=[h]),F&&Object.assign(F,h),Object.assign(A,u),k.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(A.encodings))),await r.setParameters(A),await bG(this.store.codec,r,z("SVC_MODE"))}async updateAdaptation(t,r){var o,c;if(!t)return k.debug("[updateAdaptation] no rtpSender found");if(!Qt().supportSetRtpSenderParameters)return k.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let u={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:g}=r;h&&(u.maxBitrate=1e3*h),m&&(u.maxFramerate=ho(m)),g&&g>=1&&ke(o=["vp8","vp9"]).call(o,this.store.codec)&&(u.scaleResolutionDownBy=g);let y=t.getParameters(),v=(c=y.encodings)===null||c===void 0?void 0:c[0];v&&Object.assign(v,u),Object.assign(y,{});try{await t.setParameters(y),k.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(y.encodings)))}catch(R){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?k.debug("[updateAdaptation] peerConnection not connected}"):k.debug("[updateAdaptation] updateRtpSenderEncodings failed",R):k.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,r){try{if(!Qt().supportSetRtpSenderParameters||t.length!==r.length)return;for(let o=0;o<t.length;o++){let c=t[o],u=r[o];u instanceof jn&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{k.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,o){if(z("FORBID_MODIFY_LOCAL_OFFER_SDP"))return t;let c=Hs(t);return r.forEach((u,h)=>{let m=o[h],g=c.mediaDescriptions.find(y=>y.attributes.mid===m);g&&(Jm(g,u),wD(g,u,this.store.codec))}),th(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,r,o)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let g=0;g<t.length;g++){var o,c,u,h,m;let y=t[g],v=r[g];if(v instanceof jn&&!ke(o=v._hints).call(o,bn.LOW_STREAM)&&(c=v._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=v._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=v._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=v._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){let R={},b={high:1e3*(v._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:b.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:b.high}];let A=y.sender.getParameters();await y.sender.setParameters(Object.assign(A,R))}}}async applySimulcastEncodings(t,r){if(!Qn()&&t.length===r.length)for(let o=0;o<t.length;o++){let c=r[o];if(c instanceof jn&&this.isVP8Simulcast(c)){let u=t[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];let g=u.sender.getParameters();await u.sender.setParameters(Object.assign(g,h))}}}isVP8Simulcast(t){var r,o,c,u,h;return!!(t instanceof jn&&z("SIMULCAST")&&this.store.codec==="vp8"&&!ke(r=t._hints).call(r,bn.LOW_STREAM)&&(o=t._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=t._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=t._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=t._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(t,r,o,c){if(z("SDP_LOGGING"))return k.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(r," SDP during P2PConnection.").concat(c,`
`),t),r==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;let r=this.remoteSDP.getSSRC(t);return r&&r.length!==0?r[0].ssrcId:void 0}setConfiguration(t){if(Qt().supportPCSetConfiguration){let r=Eg.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}t.isPreallocation&&(this.isPreallocation=!0)}},Ye(cn.prototype,"updateRemoteRTPCapabilities",[po],Object.getOwnPropertyDescriptor(cn.prototype,"updateRemoteRTPCapabilities"),cn.prototype),Ye(cn.prototype,"connect",[po],Object.getOwnPropertyDescriptor(cn.prototype,"connect"),cn.prototype),Ye(cn.prototype,"updateRemoteConnect",[po],Object.getOwnPropertyDescriptor(cn.prototype,"updateRemoteConnect"),cn.prototype),Ye(cn.prototype,"createDataChannels",[po],Object.getOwnPropertyDescriptor(cn.prototype,"createDataChannels"),cn.prototype),Ye(cn.prototype,"receive",[po],Object.getOwnPropertyDescriptor(cn.prototype,"receive"),cn.prototype),Ye(cn.prototype,"batchReceive",[po],Object.getOwnPropertyDescriptor(cn.prototype,"batchReceive"),cn.prototype),Ye(cn.prototype,"stopReceiving",[po],Object.getOwnPropertyDescriptor(cn.prototype,"stopReceiving"),cn.prototype),Ye(cn.prototype,"muteRemote",[po],Object.getOwnPropertyDescriptor(cn.prototype,"muteRemote"),cn.prototype),Ye(cn.prototype,"unmuteRemote",[po],Object.getOwnPropertyDescriptor(cn.prototype,"unmuteRemote"),cn.prototype),Ye(cn.prototype,"muteLocal",[po],Object.getOwnPropertyDescriptor(cn.prototype,"muteLocal"),cn.prototype),Ye(cn.prototype,"unmuteLocal",[po],Object.getOwnPropertyDescriptor(cn.prototype,"unmuteLocal"),cn.prototype),Ye(cn.prototype,"close",[po],Object.getOwnPropertyDescriptor(cn.prototype,"close"),cn.prototype),Ye(cn.prototype,"updateEncoderConfig",[po],Object.getOwnPropertyDescriptor(cn.prototype,"updateEncoderConfig"),cn.prototype),Ye(cn.prototype,"updateSendParameters",[po],Object.getOwnPropertyDescriptor(cn.prototype,"updateSendParameters"),cn.prototype),Ye(cn.prototype,"replaceTrack",[po],Object.getOwnPropertyDescriptor(cn.prototype,"replaceTrack"),cn.prototype),Ye(cn.prototype,"updateAdaptation",[po],Object.getOwnPropertyDescriptor(cn.prototype,"updateAdaptation"),cn.prototype),Ye(cn.prototype,"getRemoteSSRC",[po],Object.getOwnPropertyDescriptor(cn.prototype,"getRemoteSSRC"),cn.prototype),cn);function po(e,t,r){let o=e[t];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let c=this.mutex,u=await c.lock("From P2PConnection.".concat(t));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await o.apply(this,m)}finally{u()}},r}function GD(e,t){let r=document.createElement("video"),o=document.createElement("canvas");r.setAttribute("style","display:none"),o.setAttribute("style","display:none"),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("autoplay",""),r.autoplay=!0,r.setAttribute("playsinline",""),o.width=ho(t.width),o.height=ho(t.height);let c=ho(t.framerate||15);document.body.append(r),document.body.append(o);let u=e._mediaStreamTrack;r.srcObject=new MediaStream([u]),r.play().catch(xT);let h=o.getContext("2d");if(!h)throw new he(Y.UNEXPECTED_ERROR,"can not get canvas context");let m=Qt(),g=o.captureStream(m.supportRequestFrame?0:c).getVideoTracks()[0];g.canvas||(g.canvas=o),o.startCapture=()=>{if(!r)return o.stopCapture&&o.stopCapture();if(r.paused&&r.play(),r.videoHeight>2&&r.videoWidth>2){let v=r.videoWidth,R=r.videoHeight/v,b=o.width*R;Math.abs(b-o.height)>=2&&(k.debug("adjust low stream resolution","".concat(o.width,"x").concat(o.height," -> ").concat(o.width,"x").concat(b)),o.height=b)}h.drawImage(r,0,0,o.width,o.height),g.requestFrame&&g.requestFrame(),u!==e._mediaStreamTrack&&(u=e._mediaStreamTrack,r.srcObject=new MediaStream([u]))},o.stopCapture=Gk(()=>o.startCapture&&o.startCapture(),c);let y=g.stop;return g.stop=()=>{y.call(g),r&&(r.remove(),r.srcObject=null,r=null),o&&(o.width=0,o.remove(),o.stopCapture&&o.stopCapture(),o.startCapture=void 0,o.stopCapture=void 0,o=null),k.debug("clean low stream renderer")},g}var r8=(function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e})(r8||{}),Jl=(function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e})(Jl||{}),It=(function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e})(It||{}),Ii=(function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e[e.Audio_Recv_AV_Sync_TIME=2237]="Audio_Recv_AV_Sync_TIME",e})(Ii||{}),Ki=(function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e})(Ki||{}),ny=(function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e[e.PAGE_VISIBILITY=2233]="PAGE_VISIBILITY",e})(ny||{}),HD=(function(e){return e[e.Transport_Send_Bitrate=2234]="Transport_Send_Bitrate",e[e.Transport_Recv_Bitrate=2235]="Transport_Recv_Bitrate",e})(HD||{});let Qm=1e3,SI=6,ZT=3,ape=Math.max(SI,ZT,60);function _t(e,t,r){r!=null&&Number.isFinite(r)&&(e[t]=Math.round(Math.max(0,r)))}function i8(e){let t={[Ki.CONN_TYPE]:0,[Ki.RTT]:e.rtt,[Ki.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{let r=e.selectedCandidatePair.localCandidate.relayProtocol;r==="udp"&&(t[Ki.CONN_TYPE]=1),r==="tcp"&&(t[Ki.CONN_TYPE]=3),r==="tls"&&(t[Ki.CONN_TYPE]=4);break}case"srflx":t[Ki.CONN_TYPE]=2;break;case"unknown":t[Ki.CONN_TYPE]=5;break;default:t[Ki.CONN_TYPE]=0}return t}function s8(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class o8 extends dr{constructor(t){super(),V(this,"store",void 0),V(this,"uploadWRTCStatsTimer",void 0),V(this,"uploadOutboundDenoiserStatsTimer",void 0),V(this,"uploadExtStatsTimer",void 0),V(this,"uploadExtUsageStatsTimer",void 0),V(this,"uploadInboundExtStatsTimer",void 0),V(this,"requestStats",void 0),V(this,"requestTransportStats",void 0),V(this,"requestLocalMedia",void 0),V(this,"requestRemoteMedia",void 0),V(this,"requestAllTracks",void 0),V(this,"requestVideoIsReady",void 0),V(this,"requestUploadStats",void 0),V(this,"requestUpload",void 0),V(this,"uploadOutboundStarted",!1),V(this,"uploadInboundStarted",!1),V(this,"uploadTransportStarted",!1),V(this,"uploadBaseStatsStarted",!1),V(this,"uploadExtensionUsageStarted",!1),V(this,"lastRecvStats",void 0),V(this,"lastSendStats",void 0),V(this,"lastRefRecvStats",void 0),V(this,"lastRefSendStats",void 0),V(this,"lastNormalRecvStats",void 0),V(this,"lastNormalSendStats",void 0),V(this,"lastExtendStats",{}),V(this,"needUploadStats",{}),V(this,"needUploadRenderFreezeTime",!0),V(this,"lastUploadCompensateTime",-1),V(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;let r=t%ZT==0,o=t%SI==0,c=t%60==0,u,h;if(this.uploadTransportStarted&&(u=this.requestStats(),this.store.useP2P&&(h=this.requestStats(!0))),!u&&this.uploadOutboundStarted&&(u=this.requestStats()),!h&&this.uploadInboundStarted&&(h=this.requestStats(!0)),u||h){var m;let g={};if(this.uploadTransportStarted&&u){let v=this.getTransportStats(u,r?this.lastRefSendStats:void 0,h,r);v&&(g.misc=[v])}if(this.uploadOutboundStarted&&u){let v=this.getOutboundStats(u,o?this.lastNormalSendStats:void 0,r?this.lastRefSendStats:void 0,this.lastSendStats,c);v&&(g.outbound=[v])}if(this.uploadInboundStarted&&h){this.uploadCompensateStats(t);let v=this.getInboundStats(h,o?this.lastNormalRecvStats:void 0,r?this.lastRefRecvStats:void 0,this.lastRecvStats);v&&(g.inbound=v)}let y=(m=this.requestTransportStats)===null||m===void 0?void 0:m.call(this).connectState;if(y&&(Array.isArray(g.misc)?g.misc[0]&&g.misc[0].addition&&(g.misc[0].addition[ny.RTC_PEER_CONNECTION_STATE]=Ik[y]):g.misc=[{addition:{[ny.RTC_PEER_CONNECTION_STATE]:Ik[y]}}]),$o.needUploadStats.length>0||o){let v=$o.needUploadStats.shift()||($o.visibility==="visible"?1:0);Array.isArray(g.misc)?g.misc[0]&&g.misc[0].addition&&(g.misc[0].addition[ny.PAGE_VISIBILITY]=v):g.misc=[{addition:{[ny.PAGE_VISIBILITY]:v}}]}this.needUploadStats.sendType&&(Array.isArray(g.outbound)&&g.outbound[0]&&g.outbound[0].high&&(g.outbound[0].high[r8.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(g)}this.lastRecvStats=h,this.lastSendStats=u,o&&(this.lastNormalRecvStats=h,this.lastNormalSendStats=u),r&&(this.lastRefRecvStats=h,this.lastRefSendStats=u)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0,$o.startCollectStats();let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var r,o;let c=(r=this.requestTransportStats)===null||r===void 0?void 0:r.call(this);return void(c&&((o=this.requestUploadStats)===null||o===void 0||o.call(this,{misc:[{addition:{[ny.RTC_PEER_CONNECTION_STATE]:Ik[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===ape+1&&(t=1)},Qm)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;let r=t%ZT==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!r)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());let o=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=o,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;let c=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*c;let u=this.requestStats(!0);new Array(c).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;let h={};if(this.uploadInboundStarted&&u){let m=this.requestRemoteMedia()||[],g=[];m.forEach(y=>{let[v,R]=y,b={peer:v.uid};if(v._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(v._videoSSRC)&&R.has(et.VIDEO)&&v.videoTrack){let A=(function(F,M,j){if(!M.videoRecv.find(q=>q.ssrc===F))return;let K={};if(j&&j._player){let q=j._player,{renderFreezeAccTime2:Q,videoElementStatus:se}=q;if($o.visibility==="visible"&&se===hs.PLAYING&&Qt().supportRequestVideoFrameCallback){let oe=Math.min(6e3,Q);q.renderFreezeAccTime2=Math.max(0,Q-oe),_t(K,Jl.Video_Render_Freeze_Time_Render2,oe),z("USE_NEW_RENDER_FREEZE_TIME")&&_t(K,Jl.Video_Render_Freeze_Time_Render,oe)}}return K})(v._videoSSRC,u,v.videoTrack);A&&(b.video=A)}b.video&&g.push(b)}),g.length>0&&(h.inbound=g,this.requestUploadStats(h))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,r,o,c){if(!this.requestStats)return;if(!c)return t.rtt==null?void 0:{addition:{[Ki.RTT]:t.rtt,[Ki.CONN_TYPE]:void 0,[Ki.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};let u=i8(t);if(this.store.useP2P){if(o){let h=i8(o);u[Ki.CONN_TYPE]&&h[Ki.CONN_TYPE]&&(u[Ki.CONN_TYPE]+=h[Ki.CONN_TYPE]<<3)}u[Ki.CONN_TYPE]?u[Ki.CONN_TYPE]+=110:u[Ki.CONN_TYPE]=110}else{u[Ki.CONN_TYPE]?u[Ki.CONN_TYPE]+=100:u[Ki.CONN_TYPE]=100;let h=(function(m,g){return g?[Math.ceil(8*(m.transport.bytesSent-g.transport.bytesSent)/(m.timestamp-g.timestamp)),Math.ceil(8*(m.transport.bytesReceived-g.transport.bytesReceived)/(m.timestamp-g.timestamp))]:[0,0]})(t,r);u[HD.Transport_Send_Bitrate]=h[0],u[HD.Transport_Recv_Bitrate]=h[1]}return{addition:u}}getOutboundStats(t,r,o,c,u){if(!this.requestUploadStats||!this.requestLocalMedia)return;let h=this.requestLocalMedia();if(!h||h.length===0)return;let m,g,y;return h.forEach(v=>{let[R,{track:b,ssrcs:A}]=v;switch(R){case xe.LocalVideoLowTrack:case xe.LocalVideoTrack:if(R===xe.LocalVideoTrack){var F;let M=(function(Q,se,oe,te,de,Ce){let Pe=se.videoSend.find(Lt=>Lt.ssrc===Q);if(!Pe)return;let Qe={},{sentFrame:ot,inputFrame:Xt}=Pe;if(te&&(_t(Qe,Jl.Video_Send_Qp_Sum,Pe.qpSumPerFrame),Xt&&ot)){let Lt=Xt.frameRate,jt=ot.frameRate;Qe[Jl.Video_Send_Freeze]=(function(En,lr){let Re=!0;return Re=!(En<=5)&&(En<=10?lr<3:En<=20?lr<4:lr<5),Re})(Lt,jt)?1:0}if(de){switch(ot&&(_t(Qe,It.Video_Send_Height,ot.height),_t(Qe,It.Video_Send_Width,ot.width),_t(Qe,It.Video_Send_Frame_Rate,ot.frameRate)),Qe[It.Video_Send_Disabled]=oe._originMediaStreamTrack&&!oe._originMediaStreamTrack.enabled||oe._mediaStreamTrack&&!oe._mediaStreamTrack.enabled?1:0,Pe.adaptionChangeReason){case"none":Qe[It.Video_Send_Adaptation]=0;break;case"cpu":Qe[It.Video_Send_Adaptation]=1;break;case"bandwidth":Qe[It.Video_Send_Adaptation]=2;break;case"other":Qe[It.Video_Send_Adaptation]=3}let Lt=0;Pe.adaptionChangeReason&&(Lt+=s8(Pe.adaptionChangeReason)),se.qualityLimitationReason&&(Lt+=s8(se.qualityLimitationReason)<<3),Qe[It.Video_Send_Adaptation]=Lt,Qe[It.Video_Send_Player_Status]=jk[oe._player?oe._player.videoElementStatus:"uninit"],_t(Qe,It.Video_Send_Nacks,Pe.nacksCount),_t(Qe,It.Video_Send_Plis,Pe.plisCount),_t(Qe,It.Video_Send_Firs,Pe.firsCount),_t(Qe,It.Video_Send_Avg_Encode,Pe.avgEncodeMs),_t(Qe,It.Video_Send_Huge_Frame_Sent,Pe.hugeFramesSent),_t(Qe,It.Video_Send_Bytes_Retransmit,Pe.retransmittedBytesSent),_t(Qe,It.Video_Send_Packages_Retransmit,Pe.retransmittedPacketsSent),_t(Qe,It.Video_Send_Key_Frames_Encoded,Pe.keyFramesEncoded);let jt=de.videoSend.find(En=>En.ssrc===Q);if(jt){let En=Qm*ZT;jt.timestamp&&Pe.timestamp&&(En=Pe.timestamp-jt.timestamp),jt.packets!=null&&Pe.packets!=null&&_t(Qe,It.Video_Send_Package_Rate,1e3*(Pe.packets-jt.packets)/En),Pe.packetsLost!=null&&jt.packetsLost!=null&&_t(Qe,It.Video_Send_Package_Lost,Pe.packetsLost-jt.packetsLost),jt.bytes!=null&&Pe.bytes!=null&&_t(Qe,It.Video_Send_Bitrate,8*(Pe.bytes-jt.bytes)/En)}}return Qe})(A[0].ssrcId,t,b,r,o),j=b.__className__==="CameraVideoTrack"?3:ke(F=b._hints).call(F,bn.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==j||u)&&(this.needUploadStats={sendType:j},this.lastExtendStats.sendType=j);let K=b&&(function(Q,se,oe,te){let de=se.videoSend.find(Pe=>Pe.ssrc===Q);if(!de)return null;let Ce={};if(te){let Pe=de.inputFrame,Qe=Pe&&Pe.height||oe.videoHeight||0,ot=Pe&&Pe.width||oe.videoWidth||0,Xt=Pe&&Pe.frameRate||0;_t(Ce,It.Video_Capture_Height,Qe),_t(Ce,It.Video_Capture_Width,ot),_t(Ce,It.Video_Capture_Frame_Rate,Xt)}return Ce})(A[0].ssrcId,t,b,!!o),q=(function(Q,se){let oe={};return se&&(_t(oe,It.Video_Send_Retransmit,Q.bitrate.retransmit),_t(oe,It.Video_Send_Target_Encoded,Q.bitrate.targetEncoded),_t(oe,It.Video_Send_Actual_Encoded,Q.bitrate.actualEncoded),_t(oe,It.Video_Send_Transmit,Q.bitrate.transmit),_t(oe,It.Video_Send_Bandwidth,Q.sendBandwidth)),oe})(t,!!o);g=Object.assign({},M,K,q)}else y=(function(M,j,K,q,Q){let se=j.videoSend.find(te=>te.ssrc===M);if(!se)return;let oe={};if(q){let te=se.sentFrame;te&&(_t(oe,It.Video_Send_Low_Height,te.height),_t(oe,It.Video_Send_Low_Width,te.width),_t(oe,It.Video_Send_Low_Frame_Rate,te.frameRate));let de=q.videoSend.find(Ce=>Ce.ssrc===M);if(de){let Ce=Qm*SI;de.timestamp&&se.timestamp&&(Ce=se.timestamp-de.timestamp),de.packets!=null&&se.packets!=null&&_t(oe,It.Video_Send_Low_Package_Rate,1e3*(se.packets-de.packets)/Ce),se.packetsLost!=null&&de.packetsLost!=null&&_t(oe,It.Video_Send_Low_Package_Lost,se.packetsLost-de.packetsLost),de.bytes!=null&&se.bytes!=null&&_t(oe,It.Video_Send_Low_Bitrate,8*(se.bytes-de.bytes)/Ce)}}return oe})(A[0].ssrcId,t,0,o);break;case xe.LocalAudioTrack:m=b&&(function(M,j,K,q,Q,se){let oe=j.audioSend.find(de=>de.ssrc===M);if(!oe)return;let te={};if(Q){te[It.Audio_Send_Disabled]=K._originMediaStreamTrack&&!K._originMediaStreamTrack.enabled||K._mediaStreamTrack&&!K._mediaStreamTrack.enabled?1:0;let de=100*K._source.getAccurateVolumeLevel(),Ce=oe.inputLevel;if(Ce!=null){let Qe=Math.ceil(50*Math.log10(100*Ce+1));_t(te,It.Audio_Send_Level,Qe)}_t(te,It.Audio_Capture_PCM_Level,de),_t(te,It.Audio_Send_AEC_Return_Loss,oe.aecReturnLoss),_t(te,It.Audio_Send_AEC_Return_Loss_Enhancement,oe.aecReturnLossEnhancement),_t(te,It.Audio_Send_Bytes_Retransmit,oe.retransmittedBytesSent),_t(te,It.Audio_Send_Packages_Retransmit,oe.retransmittedPacketsSent),te[It.Audio_Send_Freeze]=0;let Pe=Q.audioSend.find(Qe=>Qe.ssrc===M);if(Pe){let Qe=Qm*SI;Pe.timestamp&&oe.timestamp&&(Qe=oe.timestamp-Pe.timestamp),Pe.bytes!=null&&oe.bytes!=null&&_t(te,It.Audio_Send_Bitrate,8*(oe.bytes-Pe.bytes)/Qe),Pe.packets!=null&&oe.packets!=null&&_t(te,It.Audio_Send_Package_Rate,1e3*(oe.packets-Pe.packets)/Qe)}}return te})(A[0].ssrcId,t,b,0,o)}}),{high:g,low:y,audio:m}}getInboundStats(t,r,o,c){if(!this.requestRemoteMedia)return;let u=this.requestRemoteMedia()||[],h=[];return u.forEach(m=>{let[g,y]=m,v={peer:g.uid},R;if(y.has(et.VIDEO)&&g.videoTrack){let b=g._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(g._videoSSRC)||!1,A=g.videoTrack?(function(F,M,j,K,q,Q,se,oe){let te=M.videoRecv.find(jt=>jt.ssrc===F);if(!te)return;let de={},{receivedFrame:Ce,outputFrame:Pe,decodeFrameRate:Qe}=te;_t(de,Ii.Video_Render_Frame_Rate_Decode,Qe),te.framesRateFirefox&&_t(de,Ii.Video_Recv_Frame_Rate,te.framesRateFirefox),Ce&&_t(de,Ii.Video_Recv_Frame_Rate,Ce.frameRate),_t(de,Ii.Video_Recv_Frame_Dropped,te.framesDroppedCount),_t(de,Ii.Video_Recv_Bytes_Retransmit,te.retransmittedBytesReceived),_t(de,Ii.Video_Recv_Packages_Retransmit,te.retransmittedPacketsReceived),_t(de,Ii.Video_Recv_Packages_Discarded,te.packetsDiscarded),_t(de,Ii.Video_Recv_Avg_Decode,te.avgDecodeMs),_t(de,Ii.Video_Recv_Avg_Processing_Delay,te.avgProcessingDelayMs),_t(de,Ii.Video_Recv_Avg_Assembly_Time,te.avgFramesAssembledFromMultiplePacketsMs),_t(de,Ii.Video_Recv_Avg_Inter_Frame_Delay,te.avgInterFrameDelayMs),_t(de,Ii.Video_Recv_Key_Frames_Decoded,te.keyFramesDecoded);let ot=oe&&oe.videoRecv.find(jt=>jt.ssrc===F);if(ot){let jt=M.timestamp-oe.timestamp||Qm;te.packetsLost!=null&&ot.packetsLost!=null&&_t(de,Ii.Video_Recv_Package_Lost,te.packetsLost-ot.packetsLost),ot.bytes!=null&&te.bytes!=null&&_t(de,Ii.Video_Recv_Bitrate,8*(te.bytes-ot.bytes)/jt),ot.packets!=null&&te.packets!=null&&_t(de,Ii.Video_Recv_Package_Rate,1e3*(te.packets-ot.packets)/jt)}let Xt=Q&&Q.videoRecv.find(jt=>jt.ssrc===F);if(Xt&&(_t(de,Jl.Video_Recv_Qp_Sum,te.qpSumPerFrame),de[Jl.Video_Recv_Freeze]=K&&$T.isRemoteVideoFreeze(j,te,Xt)?1:0),se){var Lt;let jt=se.videoRecv.find(lr=>lr.ssrc===F);Ce?(_t(de,It.Video_Recv_Height,Ce.height),_t(de,It.Video_Recv_Width,Ce.width)):j&&(_t(de,It.Video_Recv_Height,j._videoHeight||0),_t(de,It.Video_Recv_Width,j._videoWidth||0)),Pe&&_t(de,It.Video_Recv_Frame_Rate_Output,Pe.frameRate);let En=(Lt=j._player)===null||Lt===void 0?void 0:Lt.rendFrameRate.toFixed(0);if(En&&_t(de,It.Video_Render_Frame_Rate_Render,+En),_t(de,It.Video_Recv_Jitter_Buffer,te.jitterBufferMs),_t(de,It.Video_Recv_Current_Delay,te.currentDelayMs),_t(de,It.Video_Recv_Firs,te.firsCount),_t(de,It.Video_Recv_Nacks,te.nacksCount),_t(de,It.Video_Recv_Plis,te.plisCount),j){de[It.Video_Recv_Disabled]=j._originMediaStreamTrack.enabled&&j._mediaStreamTrack.enabled?0:1;let lr=j._player;if(lr){let{freezeTimeCounterList:Re,renderFreezeAccTime:Ve,renderFreezeAccTime2:Ze,videoElementStatus:Ne}=lr;if(Re&&Re.length>0&&_t(de,Jl.Video_Render_Freeze_Time,Re.splice(0,1)[0]),q&&$o.visibility==="visible"&&Ne===hs.PLAYING&&Qt().supportRequestVideoFrameCallback){let L=Math.min(6e3,Ze);lr.renderFreezeAccTime2=Math.max(0,Ze-L),_t(de,Jl.Video_Render_Freeze_Time_Render2,L);let J=Math.min(6e3,Ve);lr.renderFreezeAccTime=Math.max(0,Ve-J),_t(de,Jl.Video_Render_Freeze_Time_Render,z("USE_NEW_RENDER_FREEZE_TIME")?L:J)}if(typeof te.totalFreezesDuration=="number"){let L=jt&&jt.totalFreezesDuration?te.totalFreezesDuration-jt.totalFreezesDuration:te.totalFreezesDuration;_t(de,It.Video_Render_Freeze_Duration,1e3*L)}}}if(de[It.Video_Recv_Player_Status]=jk[j._player?j._player.videoElementStatus:"uninit"],jt&&te.totalInterFrameDelay!==void 0&&te.totalSquaredInterFrameDelay!==void 0&&jt.totalInterFrameDelay!==void 0&&jt.totalSquaredInterFrameDelay!==void 0){let lr=te.totalInterFrameDelay-jt.totalInterFrameDelay,Re=te.totalSquaredInterFrameDelay-jt.totalSquaredInterFrameDelay,Ve=te.framesDecodeCount-jt.framesDecodeCount,Ze=lr/Ve*1e3,Ne=Math.round(1e3*Math.sqrt((Re-Math.pow(lr,2)/Ve)/Ve));!isNaN(Ne)&&Ze+Ne>Math.max(3*Ze,Ze+150)&&(de[It.Video_Recv_I_Frame_Delay]=Ne)}}return de})(g._videoSSRC,t,g.videoTrack,b===!0,this.needUploadRenderFreezeTime,r,o,c):void 0;if(A&&(v.video=A),g.videoTrack){let F=t.videoRecv.find(M=>M.ssrc===g._videoSSRC);F&&F.estimatedPlayoutTimestamp&&(R=F.estimatedPlayoutTimestamp)}}if(y.has(et.AUDIO)&&g.audioTrack){let b=g.audioTrack?(function(A,F,M,j,K,q){let Q=F.audioRecv.find(de=>de.ssrc===A);if(!Q)return;let se={};_t(se,Ii.Audio_Recv_Jitter,Q.jitterMs),_t(se,Ii.Audio_Recv_Bytes_Retransmit,Q.retransmittedBytesReceived),_t(se,Ii.Audio_Recv_Packages_Retransmit,Q.retransmittedPacketsReceived),_t(se,Ii.Audio_Recv_Packages_Discarded,Q.packetsDiscarded),_t(se,Ii.Audio_Recv_Avg_Processing_Delay,Q.avgProcessingDelayMs);let oe=q&&q.audioRecv.find(de=>de.ssrc===A);if(oe){let de=Qm;Q.packets!=null&&oe.packets!=null&&_t(se,Ii.Audio_Recv_Package_Rate,1e3*(Q.packets-oe.packets)/de),Q.packetsLost!=null&&oe.packetsLost!=null&&_t(se,Ii.Audio_Recv_Package_Lost,Q.packetsLost-oe.packetsLost)}if(j){let{receivedFrames:de,droppedFrames:Ce}=Q;de!=null&&Ce!=null&&(se[Jl.Audio_Recv_Freeze]=(te=de)===0||100*Ce/te>20?1:0)}var te;if(K){let de=100*M._source.getAccurateVolumeLevel(),Ce=Q.outputLevel;if(Ce!=null){let Qe=Math.ceil(50*Math.log10(100*Ce+1));_t(se,It.Audio_Render_Level,Qe)}_t(se,It.Audio_Recv_PCM_Level,de),M&&(se[It.Audio_Recv_Disabled]=M._originMediaStreamTrack.enabled&&M._mediaStreamTrack.enabled?0:1),_t(se,It.Audio_Recv_Jitter_Buffer,Q.jitterBufferMs),_t(se,It.Audio_Recv_Current_Delay,Q.jitterBufferMs),se[It.Audio_Recv_Player_Status]=jk[Ps.getPlayerState(M.getTrackId())];let Pe=K.audioRecv.find(Qe=>Qe.ssrc===A);if(Pe){Pe.bytes!=null&&Q.bytes!=null&&_t(se,It.Audio_Recv_Bitrate,8*(Q.bytes-Pe.bytes)/(Qm*ZT));let Qe=Q.concealedSamples-Pe.concealedSamples;Qe>0&&_t(se,It.Audio_Recv_Concealed_Samples,Qe);let ot=Q.totalSamplesReceived-Pe.totalSamplesReceived;ot>0&&_t(se,It.Audio_Recv_Total_Samples_Received,ot);let Xt=Q.freezeSamples80-Pe.freezeSamples80;Xt>0&&_t(se,It.Audio_Render_Freeze_Samples_80ms,Xt);let Lt=Q.freezeSamples200-Pe.freezeSamples200;Lt>0&&_t(se,It.Audio_Render_Freeze_Samples_200ms,Lt);let jt=Q.freezeMs80-Pe.freezeMs80;_t(se,It.Audio_Render_Freeze_Time_80ms,jt<0?0:jt);let En=Q.freezeMs200-Pe.freezeMs200;_t(se,It.Audio_Render_Freeze_Time_200ms,En<0?0:En)}}return se})(g._audioSSRC,t,g.audioTrack,r,o,c):void 0;if(b&&(v.audio=b),g.audioTrack&&R){let A=t.audioRecv.find(F=>F.ssrc===g._audioSSRC);if(A&&A.estimatedPlayoutTimestamp){let F=A.estimatedPlayoutTimestamp-R;v.audio?v.audio[Ii.Audio_Recv_AV_Sync_TIME]=F:v.audio={[Ii.Audio_Recv_AV_Sync_TIME]:F}}}}(v.video||v.audio)&&h.push(v)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;let t=(this.requestAllTracks()||[]).find(r=>r instanceof jT);if(t&&t._external.getDenoiserStats){let r=t._external.getDenoiserStats();r&&this.requestUpload(qm.DENOISER_STATS,r)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[r,o]=t;o.has(et.VIDEO)&&r.videoTrack&&r.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),o.has(et.AUDIO)&&r.audioTrack&&r.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);let t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{let r=Date.now(),o={connectionInterval:z("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:r},c=[],u=this.requestAllTracks&&this.requestAllTracks()||[];for(let y of u)!y.muted&&y.enabled&&(c=c.concat(await y.getProcessorUsage()));let h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(let[y,v]of h)v.has(et.VIDEO)&&y.videoTrack&&(c=c.concat(await y.videoTrack.getProcessorUsage())),v.has(et.AUDIO)&&y.audioTrack&&(c=c.concat(await y.audioTrack.getProcessorUsage()));if(c.length===0)return;o.details=(function(y,v){let R={};for(let{id:M,value:j,level:K,direction:q}of y){var b;let Q=(b=v.get(M))!==null&&b!==void 0?b:0,se=j===2?Q+z("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:Q;var A,F;v.set(M,se),R[M]?(j===2&&(R[M].value=j),K>R[M].level&&(R[M].level=K),q==="remote"&&(R[M].remoteUidCount+=1),R[M].totalTs=(A=v.get(M))!==null&&A!==void 0?A:0):R[M]={value:j,level:K,remoteUidCount:q==="local"?0:1,totalTs:(F=v.get(M))!==null&&F!==void 0?F:0}}return Object.keys(R).map(M=>{let{level:j,value:K,totalTs:q}=R[M];return{id:M,level:j,value:K,totalTs:q}})})(c,t);let m=Date.now(),g=m>r?m:r+1;this.requestUpload&&this.requestUpload(qm.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:g})},z("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1,$o.stopCollectStats()}}let cpe=z("ICE_RESTART_INTERVAL"),TI=new Map,ry=new Map,Ip=[Di.UDP_TCP_RELAY,Di.TCP_RELAY,Di.RELAY],zD=z("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Qt().supportPCSetConfiguration;function a8(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],r=TI.get(e.id);r&&(window.clearTimeout(r),TI.delete(e.id));let o=ry.get(e.id);t&&o&&o.index===Ip.length-1&&(k.debug("[".concat(e.id,"] reset ICE restart policy")),ry.delete(e.id))}function c8(e,t,r){if(TI.size===0&&ry.size===0&&(Array.isArray(z("RESTART_SEQUENCE"))&&z("RESTART_SEQUENCE").length>0&&!(function(m,g){if(m.length!==g.length)return!1;for(let y=0;y<m.length;y+=1){let v=m[y];if(m.filter(R=>R===v).length!==g.filter(R=>R===v).length)return!1}return!0})(Ip,z("RESTART_SEQUENCE"))&&(Ip=z("RESTART_SEQUENCE").filter(m=>{var g;if(ke(g=Object.values(Di)).call(g,m))return!0}),k.debug("use reconnection policy from config distribution, queues: ".concat(Ip.join(" => ")))),zD=z("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Qt().supportPCSetConfiguration),Ip.length===0)return void r();let o,{index:c=0,type:u}=ry.get(e.id)||{};if(zD&&u===Di.RELAY)return void r();let h=u&&c>=Ip.length-1;if(zD)u=Di.RELAY;else{if(h)return void r();u?(c++,u=Ip[c]):(u=Ip[0],c=0)}k.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(u,", index: ").concat(c)),t(u),ry.set(e.id,{index:c,type:u}),o=window.setTimeout(()=>c8(e,t,r),cpe),TI.set(e.id,o)}var en;function l8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function id(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?l8(Object(r),!0).forEach(function(o){V(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l8(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}function u8(e){var t,r,o,c=2;for(typeof Symbol<"u"&&(r=mb,o=Symbol.iterator);c--;){if(r&&(t=e[r])!=null)return t.call(e);if(o&&(t=e[o])!=null)return new wI(t.call(e));r="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function wI(e){function t(r){if(Object(r)!==r)return ze.reject(new TypeError(r+" is not an object."));var o=r.done;return ze.resolve(r.value).then(function(c){return{value:c,done:o}})}return wI=function(r){this.s=r,this.n=r.next},wI.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var o=this.s.return;return o===void 0?ze.resolve({value:r,done:!0}):t(o.apply(this.s,arguments))},throw:function(r){var o=this.s.return;return o===void 0?ze.reject(r):t(o.apply(this.s,arguments))}},new wI(e)}let Zm=(en=class extends dr{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(dt.StateChange,t,this._state)}constructor(e,t){super(),V(this,"isPlanB",void 0),V(this,"store",void 0),V(this,"statsUploader",void 0),V(this,"connection",void 0),V(this,"localTrackMap",new Map),V(this,"remoteUserMap",new Map),V(this,"localDataChannels",[]),V(this,"remoteDataChannelMap",new Map),V(this,"pendingLocalTracks",[]),V(this,"pendingRemoteTracks",[]),V(this,"pendingLocalDataChannels",[]),V(this,"pendingRemoteDataChannels",[]),V(this,"statsCollector",void 0),V(this,"shouldForwardP2PCreation",void 0),V(this,"iceFailedCount",0),V(this,"dtlsFailedCount",0),V(this,"mutex",void 0),V(this,"_state",Tn.Disconnected),V(this,"_pcStatsUploadType",z("NEW_ICE_RESTART")?ih.FIRST_CONNECTION:ih.OLD_FIRST_CONNECTION),V(this,"_isStartRestartIce",!1),V(this,"_restartTimer",void 0),V(this,"_isTryConnecting",!1),V(this,"_iceError",null),V(this,"_forceTurn",!1),V(this,"_isWaitPcToRePub",!1),V(this,"handleMuteLocalTrack",async(r,o,c)=>{let u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Tn.Connected)return void c(new _e(Y.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));let h=this.filterTobeMutedTracks(r);if(h.length===0)return void o();let m=h.find(y=>y[0]==="videoLowTrack");if(m){let y=m[1];this.store.enableInstantMuteRestore?(y.track._originMediaStreamTrack.enabled=!1,k.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):y.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?k.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(h.map(y=>{let[,{id:v}]=y;return v}));let g=this.createMuteMessage(h);await Gn(this,dt.RequestMuteLocal,g),o()}catch(h){c(h)}finally{u()}}),V(this,"handleUnmuteLocalTrack",async(r,o,c)=>{let u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Tn.Connected)return void c(new _e(Y.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));let h=this.filterTobeUnmutedTracks(r);if(h.length===0)return void o();let m=h.find(y=>y[0]==="videoLowTrack");if(m){let y=m[1];if(this.store.enableInstantMuteRestore)y.track._originMediaStreamTrack.enabled=!0,k.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(y.track._originMediaStreamTrack.stop(),!z("DISABLE_DUAL_STREAM_USE_ENCODING")&&Qt().supportDualStreamEncoding){let v=r._mediaStreamTrack.clone();y.track._mediaStreamTrack=v,y.track._originMediaStreamTrack=v}else{let v=GD(r,xm(this,dt.RequestLowStreamParameter));y.track._mediaStreamTrack=v,y.track._originMediaStreamTrack=v}await new ze((v,R)=>{this.handleReplaceTrack(y.track,v,R,!0)})}}this.store.enableInstantMuteRestore?k.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(h.map(y=>{let[,{id:v}]=y;return v}));let g=this.createUnmuteMessage(h);await Gn(this,dt.RequestUnmuteLocal,g),o()}catch(h){c(h)}finally{u()}}),V(this,"handleUpdateVideoEncoder",async(r,o,c,u)=>{let h;u||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{let g=this.localTrackMap.get(xe.LocalVideoTrack);if(!this.connection||!g||g.track!==r||this.state!==Tn.Connected)return void o();let{id:y,track:v}=g;await this.connection.updateSendParameters(y,v),await this.connection.updateEncoderConfig(y,v),this.emit(dt.UpdateVideoEncoder,v),o()}catch(g){c(g)}finally{var m;(m=h)===null||m===void 0||m()}}),V(this,"handleUpdateVideoSendParameters",async(r,o,c)=>{let u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{let h=this.localTrackMap.get(xe.LocalVideoTrack);if(!this.connection||!h||h.track!==r||this.state!==Tn.Connected)return void o();let{id:m,track:g}=h;await this.connection.updateSendParameters(m,g),o()}catch(h){c(h)}finally{u()}}),V(this,"handleReplaceMixingTrack",async(r,o,c,u)=>{if(!this.connection||this.state!==Tn.Connected)return void o();let h=jD([r]),m;k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof u=="boolean"&&u||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(r,h),o()}catch(y){c(y)}finally{var g;(g=m)===null||g===void 0||g()}}),V(this,"handleReplaceTrack",async(r,o,c,u)=>{let h;k.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;let y=Array.from(this.localTrackMap.entries()).find(v=>{let[,{track:R}]=v;return r===R});if(!this.connection||!y||this.state!==Tn.Connected)return void o();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(r,y[1].id)),this.isPlanB){let v=y[1];v.id=r._mediaStreamTrack.id,this.localTrackMap.set(y[0],v)}if(y[0]===xe.LocalVideoTrack&&!z("DISABLE_DUAL_STREAM_USE_ENCODING")&&Qt().supportDualStreamEncoding){let v=this.localTrackMap.get(xe.LocalVideoLowTrack);if(v){let R=r._mediaStreamTrack.clone();v.track._originMediaStreamTrack.stop(),v.track._mediaStreamTrack=R,v.track._originMediaStreamTrack=R,await new ze((b,A)=>{this.handleReplaceTrack(v.track,b,A,!0)})}}o()}catch(y){c(y)}finally{var g;(g=h)===null||g===void 0||g()}}),V(this,"handleGetRTCStats",r=>{r(this.statsCollector.getRTCStats())}),V(this,"handleGetLocalVideoStats",r=>{r(this.statsCollector.getLocalVideoTrackStats())}),V(this,"handleGetLocalAudioStats",r=>{r(this.statsCollector.getLocalAudioTrackStats())}),V(this,"handleGetRemoteVideoStats",r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid]),V(this,"handleGetRemoteAudioStats",r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new o8(this.store),this.bindStatsUploaderEvents(),this.mutex=new ki("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Qt().supportUnifiedPlan||z("CHROME_FORCE_PLAN_B")&&Xu(),this.shouldForwardP2PCreation=z("FORWARD_P2P_CREATION")&&Qt().supportPCSetConfiguration&&Y4(),this.shouldForwardP2PCreation&&(this.connection=QT(this.store),this.emit(dt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var r;this.state=Tn.New,this._forceTurn=WD(e),k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));let o=this.shouldForwardP2PCreation&&((r=this.connection)===null||r===void 0?void 0:r.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||o||t)&&((o||t)&&this.connection&&(k.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=QT(this.store,e),this.emit(dt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new _e(Y.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=z("NEW_ICE_RESTART")?ih.FIRST_CONNECTION:ih.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new _e(Y.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(!this.isPreallocation()||this.state!==Tn.Connected){this.store.peerConnectionStart();let t=await this.connection.connect(e);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Tn.Connected,t}if(this.connection instanceof Ta&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),tt.reportApiInvoke(this.store.sessionId,{name:ar.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:Fn.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(dt.RequestReconnect)});await this.connection.updateRemoteConnect(e)}updateRemoteRTPCapabilities(e){let t=Array.from(this.localTrackMap.entries()).filter(c=>{var u;let[h]=c;return ke(u=[xe.LocalVideoLowTrack,xe.LocalVideoTrack]).call(u,h)}),r=t.map(c=>{let[,{id:u}]=c;return u}),o=t.map(c=>{let[u]=c;return u});if(this.connection instanceof Ta||this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"){if(tt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(o),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!ke(e).call(e,this.store.codec)){let c=["vp9","vp8","h264"].find(u=>ke(e).call(e,u));c&&(this.store.codec=c,k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(r,e)}}async getEstablishParams(){var e;return this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof Ta&&this.connection.peerConnectionState!=="closed"&&ke(e=[Tn.New,Tn.Connected]).call(e,this.state)?this.connection.establishPromise:void 0}async publishDataChannel(e){if(!this.connection||this.state!==Tn.Connected){if(this.state===Tn.Disconnected)throw new _e(Y.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(r=>{var o;ke(o=this.pendingLocalDataChannels).call(o,r)||this.pendingLocalDataChannels.push(r)}),[]}let t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(r=>{let o=Date.now();this.store.publish(r.id.toString(),"datachannel",o)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(r=>{this.localDataChannels.push(r);let o=Date.now();this.store.publish(r.id+"","datachannel",void 0,o)}),e.map(r=>({streamId:r.id,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:r.metadata,channelId:r._originDataChannelId})))}publish(e,t,r){var o=this;return oo(function*(){let c=yield Ft(o.mutex.lock("From P2PChannel.publish"));try{var u;let h=o.connection&&ke(u=["disconnected","failed"]).call(u,o.connection.peerConnectionState);if(!o.connection||o.state!==Tn.Connected||h){if(o.state===Tn.Disconnected)throw new _e(Y.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(e);let g=e.filter(y=>o.pendingLocalTracks.indexOf(y)===-1);return o.pendingLocalTracks=o.pendingLocalTracks.concat(g),void(h&&(o._isWaitPcToRePub=!0))}o.store.pubId=o.store.pubId+1,fs.markPublishStart(o.store.clientId,o.store.pubId);let m=o.filterTobePublishedTracks(e,t,r);if(m.length===0)return void(yield Ft(o.tryToUnmuteAudio(e)));yield*bE(u8(o.doPublish(o.connection,m)))}finally{c()}})()}doPublish(e,t){var r=this;return oo(function*(){t.forEach(b=>{let{track:A,type:F}=b,M=Date.now();r.store.publish(A.getTrackId(),F===xe.LocalAudioTrack?"audio":"video",M)}),r.bindLocalTrackEvents(t);let o=t.map(b=>{let{track:A}=b;return A}),c=yield Ft(e.send(o,r.store.codec,r.store.audioCodec)),u=(yield Ft(c.next())).value,h=r.createGatewayPublishMessage(t,u),m;try{m=yield h}catch(b){throw c.throw(b),b?.code===Y.WS_ABORT&&t.forEach(A=>{let{track:F}=A;r.pendingLocalTracks.indexOf(F)===-1&&r.pendingLocalTracks.push(F)}),r.unbindLocalTrackEvents(t),b}let g=r.mapPubResToRemoteConfig(h,m,o),y=(yield Ft(c.next(g))).value;if(r.state===Tn.Disconnected)throw new _e(Y.UNEXPECTED_ERROR,"PeerConnection already disconnected.");z("ENABLE_VIDEO_SEI");let v=z("ENABLE_ENCODED_TRANSFORM"),R=z("ENABLE_AUDIO_METADATA");o.forEach(async b=>{let A=b.getRTCRtpTransceiver();if(!A||!v)return;let{interceptLocalVideoFrame:F,interceptLocalAudioFrame:M}=hI();b.trackMediaType===et.VIDEO?await F(A.sender,b):b.trackMediaType===et.AUDIO&&await M(A.sender,{metadata:R?()=>{let j=b.metadata.shift();return j&&j.value}:void 0})}),t.forEach(b=>{let{type:A}=b;r.statsCollector.addLocalStats(A)}),r.assignLocalTracks(t,y),r.statsUploader.startUploadOutboundStats(),t.forEach(b=>{let{track:A,type:F}=b,M=Date.now();r.store.publish(A.getTrackId(),F===xe.LocalAudioTrack?"audio":"video",void 0,M)})})()}async updateVideoStreamParameter(e,t){let r=this.localTrackMap.get(t);if(!r||!this.connection)return;if(!(r.track instanceof jn))return k.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");let{track:o}=r,c=(function(u,h){let m={};return u.height&&u.width&&(m.scaleResolutionDownBy=yD(u,h)),m.maxFramerate=u.framerate?ho(u.framerate):void 0,m.maxBitrate=u.bitrate?1e3*u.bitrate:void 0,m})(e,o);if(o._encoderConfig||(o._encoderConfig={}),t!==xe.LocalVideoLowTrack||!z("DISABLE_DUAL_STREAM_USE_ENCODING")&&Qt().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(o._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{let u=o._originMediaStreamTrack;if(!u.canvas)return k.warn("[".concat(o.getTrackId(),"] no canvas on track"));(function(h,m){let g=h.canvas;m.width&&(g.width=ho(m.width)),m.height&&(g.height=ho(m.height)),m.framerate&&(g.stopCapture&&g.stopCapture(),g.stopCapture=Gk(()=>{!g.startCapture&&g.stopCapture&&g.stopCapture(),g.startCapture&&g.startCapture()},ho(m.framerate)))})(u,e)}c.maxBitrate!=null&&(o._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(o._encoderConfig.frameRate&&typeof o._encoderConfig.frameRate=="object"?o._encoderConfig.frameRate.max=c.maxFramerate:o._encoderConfig.frameRate={max:c.maxFramerate}),k.debug("[".concat(o.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(o._encoderConfig))),await this.connection.updateRtpSenderEncodings(o)}publishLowStream(e){var t=this;return oo(function*(){if(!t.connection||t.state!==Tn.Connected)return;let r=yield Ft(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{let c=t.localTrackMap.get(xe.LocalVideoTrack);if(!c)throw new _e(Y.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(xe.LocalVideoLowTrack))throw new _e(Y.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));let u=[{track:t.getLowVideoTrack(c.track,e),type:xe.LocalVideoLowTrack}];if(yield*bE(u8(t.doPublish(t.connection,u))),c.track.muted||!c.track.enabled){var o;let h=(o=t.localTrackMap.get(xe.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;h!==void 0&&(yield Ft(t.connection.muteLocal([h])))}}finally{r()}})()}async republish(){this.pendingLocalTracks.length>0&&(k.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ei(this,dt.RequestRePublish,this.pendingLocalTracks),this.emit(dt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(k.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await ei(this,dt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){let{user:r,kind:o}=this.pendingRemoteTracks[t];(o!==et.AUDIO||r._audio_added_&&r._audioSSRC)&&(o!==et.VIDEO||r._video_added_&&r._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await ei(this,dt.RequestReSubscribe,this.pendingRemoteTracks);else for(let{user:t,kind:r}of this.pendingRemoteTracks)await this.subscribe(t,r,r===et.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:r}=t;this.emit(dt.MediaReconnectEnd,r.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Tn.Connected)return void e.forEach(o=>{let c=this.pendingLocalTracks.indexOf(o);c!==-1&&this.pendingLocalTracks.splice(c,1)});let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let r=t.find(o=>o[0]==="videoLowTrack");return r&&r[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==Tn.Connected)return void e.forEach(r=>{let o=this.pendingLocalDataChannels.indexOf(r);o!==-1&&this.pendingLocalDataChannels.splice(o,1)});let t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(r=>{let o=this.localDataChannels.indexOf(r);o!==-1&&this.localDataChannels.splice(o,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(r=>r.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Tn.Connected)return;let e=this.localTrackMap.get(xe.LocalVideoLowTrack);if(!e)return;e.track.close();let t=[[xe.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){let r=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(o=>{let[,{id:c}]=o;return c})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(o=>{let[c,{track:u}]=o;return{type:c,track:u}})),t.forEach(o=>{let[c]=o;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),r}async subscribeDataChannel(e,t){if(!this.connection||this.state!==Tn.Connected)throw new _e(Y.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");let r=t.filter(o=>{var c;return!((c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.get(o.id))});if(r.length!==0)return await this.connection.createDataChannels(e.uid,r),r.forEach(o=>{var c;this.remoteDataChannelMap.has(e)?(c=this.remoteDataChannelMap.get(e))===null||c===void 0||c.set(o.id,o):this.remoteDataChannelMap.set(e,new Map([[o.id,o]]));let u=this.pendingRemoteDataChannels.findIndex(h=>{let{user:m,id:g}=h;return m.uid===e.uid&&g===o.id});u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),r.map(o=>o.id)}async subscribe(e,t,r,o,c){var u;if(!this.connection||this.state!==Tn.Connected)throw new _e(Y.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(e))!==null&&u!==void 0&&u.has(t))return;let h,m,g,y,v=this.connection.getPreMedia(r);if(v)k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(r,", no need to send sub to gateway.")),g=v.transceiver,h=v.track,m=v.mid,y=v.player,v.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:v.firstVideoRender});else if(c){let A=c.find(M=>{let{stream_type:j}=M;return j===t});if(!A)throw new _e(Y.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));let F=await this.connection.receive(t,A.ssrcs,String(e._uintid),A.attributes);(this.connection instanceof Ta||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(g=F.transceiver),h=F.track,m=F.id}else{let A=await this.connection.receive(t,[{ssrcId:r,rtx:o}],String(e._uintid),void 0);(this.connection instanceof Ta||"name"in this.connection&&this.connection.name==="DataChannelConnection")&&(g=A.transceiver),h=A.track,m=A.id}if(t===et.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(h):(e._audioTrack=new GE(h,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),g&&e._audioTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(h):(e._videoTrack=new WE(h,e.uid,e._uintid,this.store,y),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(Qa.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once(Qa.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),y?e._videoTrack.once(Qa.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once(Qa.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),g&&e._videoTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(e,e._videoTrack)),g&&z("ENABLE_ENCODED_TRANSFORM")){let{interceptRemoteVideoFrame:A,interceptRemoteAudioFrame:F}=hI();t==et.VIDEO?await A(g.receiver,{onSei:z("ENABLE_VIDEO_SEI")&&(M=>{var j;return(j=e._videoTrack)===null||j===void 0?void 0:j._onSei(M)}),onFirstFrame:M=>{var j;let K=Array.from(ys(j=this.remoteUserMap).call(j)).find(q=>q._videoSSRC===M.ssrc);K&&this.store.firstVideoFrameDecoded(K.uid,{firstReceivedEncodedFrame:Date.now(),frameType:M.type,rtpTimestamp:M.rtpTimestamp,framePayloadType:M.payloadType,frameDataLength:M.length,mimeType:M.mimeType})}}):t==et.AUDIO&&await F(g.receiver,{enableTopn:!!z("ENABLE_AUDIO_TOPN"),enableMetadata:!!z("ENABLE_AUDIO_METADATA"),enablePts:!!z("ENABLE_AUDIO_PTS"),onMetadata:M=>{this.safeEmit(dt.AudioMetadata,M)},onPts:M=>{this.safeEmit(dt.AudioPts,M)}})}let R=this.remoteUserMap.get(e);R?R.set(t,m):this.remoteUserMap.set(e,new Map([[t,m]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();let b=this.pendingRemoteTracks.findIndex(A=>{let{user:F,kind:M}=A;return F.uid===e.uid&&t===M});b!==-1&&(this.pendingRemoteTracks.splice(b,1),this.emit(dt.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Tn.Connected)throw new _e(Y.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(c=>{var u;let{user:h,mediaType:m}=c;return!((u=this.remoteUserMap.get(h))!==null&&u!==void 0&&u.has(m))});let t=[],r=new Map;e.forEach(c=>{if(!this.connection)return;let u=this.connection.getPreMedia(c.ssrcId);if(u){let{track:h,mid:m,transceiver:g,player:y}=u;r.set(c.ssrcId,{track:h,id:m,transceiver:g,player:y})}else t.push(c)});let o=await this.connection.batchReceive(t.map(c=>{let{user:u,mediaType:h,ssrcId:m,rtxSsrcId:g}=c;return{kind:h,ssrcMsg:[{ssrcId:m,rtx:g}],mslabel:String(u._uintid)}}));t.forEach((c,u)=>{r.set(c.ssrcId,o[u])});for(let{user:c,mediaType:u,ssrcId:h}of e){let m=r.get(h);if(!m)return void k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(u,", ").concat(h));let{track:g,id:y,transceiver:v,player:R}=m;if(v&&z("ENABLE_ENCODED_TRANSFORM")){let{interceptRemoteVideoFrame:F,interceptRemoteAudioFrame:M}=hI();u==et.VIDEO?await F(v.receiver,{onSei:z("ENABLE_VIDEO_SEI")&&(j=>{var K;return(K=c._videoTrack)===null||K===void 0?void 0:K._onSei(j)}),onFirstFrame:j=>{var K;let q=Array.from(ys(K=this.remoteUserMap).call(K)).find(Q=>Q._videoSSRC===j.ssrc);q&&this.store.firstVideoFrameDecoded(q.uid,{firstReceivedEncodedFrame:Date.now(),frameType:j.type,rtpTimestamp:j.rtpTimestamp,framePayloadType:j.payloadType,frameDataLength:j.length,mimeType:j.mimeType})}}):u==et.AUDIO&&await M(v.receiver,{enableTopn:!!z("ENABLE_AUDIO_TOPN"),enableMetadata:!!z("ENABLE_AUDIO_METADATA"),enablePts:!!z("ENABLE_AUDIO_PTS"),onMetadata:j=>{this.safeEmit(dt.AudioMetadata,j)},onPts:j=>{this.safeEmit(dt.AudioPts,j)}})}if(u===et.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(g):(c._audioTrack=new GE(g,c.uid,c._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),v&&c._audioTrack._updateRtpTransceiver(v),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(g):(c._videoTrack=new WE(g,c.uid,c._uintid,this.store,R),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),v&&c._videoTrack._updateRtpTransceiver(v),this.bindRemoteTrackEvents(c,c._videoTrack)),z("ENABLE_VIDEO_SEI")&&v){let{interceptRemoteVideoFrame:F,interceptRemoteAudioFrame:M}=hI();u==et.VIDEO?await F(v.receiver,{onSei:j=>{var K;(K=c._videoTrack)===null||K===void 0||K._onSei(j)},onFirstFrame:j=>{var K;let q=Array.from(ys(K=this.remoteUserMap).call(K)).find(Q=>Q._videoSSRC===j.ssrc);q&&this.store.firstVideoFrameDecoded(q.uid,{firstReceivedEncodedFrame:Date.now(),frameType:j.type,rtpTimestamp:j.rtpTimestamp,framePayloadType:j.payloadType,frameDataLength:j.length,mimeType:j.mimeType})}}):u==et.AUDIO&&await M(v.receiver)}let b=this.remoteUserMap.get(c);b?b.set(u,y):this.remoteUserMap.set(c,new Map([[u,y]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();let A=this.pendingRemoteTracks.findIndex(F=>{let{user:M,kind:j}=F;return M.uid===c.uid&&u===j});A!==-1&&(this.pendingRemoteTracks.splice(A,1),this.emit(dt.MediaReconnectEnd,c.uid))}}async unsubscribe(e,t,r){let o=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:g}=h;return t!==void 0?m.uid===e.uid&&t===g:m.uid===e.uid});if(o.forEach(h=>{let m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),this.connection&&this.state===Tn.Connected||r||o.forEach(h=>{let{kind:m}=h;var g;if(m===et.AUDIO)(g=e._audioTrack)===null||g===void 0||g._destroy(),e._audioTrack=void 0;else if(m===et.VIDEO){var y;(y=e._videoTrack)===null||y===void 0||y._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Tn.Connected)return;let c=this.filterTobeUnSubscribedTracks(e,t);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:m}]=h;return m}));let u=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[m,{kind:g}]=h;var y,v;if(g===et.VIDEO&&m._videoSSRC&&((y=this.connection)===null||y===void 0||y.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),g===et.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),r||((v=m._videoTrack)===null||v===void 0||v._destroy(),m._videoTrack=void 0);else if(g===et.AUDIO){var R;this.unbindRemoteTrackEvents(m._audioTrack),!r&&((R=m._audioTrack)===null||R===void 0||R._destroy(),m._audioTrack=void 0)}}),u}async unsubscribeDataChannel(e,t){if(t.forEach(c=>{let u=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),!this.connection)return;let r=this.filterTobeUnSubscribedDataChannels(e,t);if(r.length===0)return;t.forEach(c=>{c._close()});let o=this.remoteDataChannelMap.get(e);return r.forEach(c=>{o&&o.delete(c.id)}),o&&o.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),r.map(c=>c.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(let{user:c,mediaType:u}of e){let h=this.pendingRemoteTracks.filter(m=>{let{user:g,kind:y}=m;return u!==void 0?g.uid===c.uid&&u===y:g.uid===c.uid});h.forEach(m=>{let g=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(g,1)}),t=t.concat(h)}if(!this.connection||this.state!==Tn.Connected)return void t.forEach(c=>{let{user:u,kind:h}=c;var m;if(h===et.AUDIO)(m=u._audioTrack)===null||m===void 0||m._destroy(),u._audioTrack=void 0;else if(h===et.VIDEO){var g;(g=u._videoTrack)===null||g===void 0||g._destroy(),u._videoTrack=void 0}});let r=to(e).call(e,(c,u)=>{let{user:h,mediaType:m}=u,g=this.filterTobeUnSubscribedTracks(h,m);return c.concat(g)},[]);if(r.length===0)return;await this.connection.stopReceiving(r.map(c=>{let[,{id:u}]=c;return u}));let o=this.createUnsubscribeAllMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r.forEach(c=>{let[u,{kind:h}]=c;var m,g;if(h===et.VIDEO&&u._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===et.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(g=u._videoTrack)===null||g===void 0||g._destroy(),u._videoTrack=void 0;else if(h===et.AUDIO){var y;this.unbindRemoteTrackEvents(u._audioTrack),(y=u._audioTrack)===null||y===void 0||y._destroy(),u._audioTrack=void 0}}),o}isPreSubScribe(e){return!this.connection||this.state!==Tn.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;let r=this.remoteUserMap.get(e);if(!r)return void k.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void k.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let o=t===et.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.connection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;let r=this.remoteUserMap.get(e);if(!r)return void k.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||k.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){let t=this.localTrackMap.get(xe.LocalAudioTrack),r=t&&t.track;r&&r.metadata.push(e)}getAllTracks(e){let t=this.localTrackMap.get(xe.LocalAudioTrack);if(t?.track instanceof ai){let r=t.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==xe.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===xe.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter(r=>{let[o]=r;return!(e&&o===xe.LocalVideoLowTrack)}).map(r=>{let[,{track:o}]=r;return o})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,r,o,c){if(e){let h=this.localTrackMap.get(xe.LocalAudioTrack),m=o?this.localTrackMap.get(xe.LocalVideoLowTrack):this.localTrackMap.get(xe.LocalVideoTrack);tt.publish(this.store.sessionId,{eventElapse:fs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h?.track.getTrackLabel(),videoName:m?.track.getTrackLabel(),screenshare:m?.track._hints.indexOf(bn.SCREEN_TRACK)!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;r||(r=[]);let h=r.find(g=>g instanceof Nr),m=o?(u=this.localTrackMap.get(xe.LocalVideoTrack))===null||u===void 0?void 0:u.track:r.find(g=>g instanceof jn);tt.publish(this.store.sessionId,{eventElapse:fs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h?.getTrackLabel(),videoName:m?.getTrackLabel(),screenshare:m?._hints.indexOf(bn.SCREEN_TRACK)!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,t,r,o){let c=o===et.VIDEO?r._videoSSRC:r._audioSSRC;c&&tt.subscribe(this.store.sessionId,{succ:e,ec:t,video:o===et.VIDEO,audio:o===et.AUDIO,peerid:r.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:fs.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){k.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new ki("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=QT(this.store),this.emit(dt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(xe.LocalAudioTrack);if(e?.track instanceof ai){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(r=>{t.removeAudioTrack(r)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Tn.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(xe.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(xe.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof jn||t&&t.track instanceof Nr?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;let r=Array.from(ys(t=this.remoteUserMap).call(t)).find(o=>o.uid===e);return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(r=>{let[o]=r;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(xe.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=wm(e).call(e,(r,o)=>r.level-o.level),e}async disconnectForReconnect(){this.connection&&(k.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Tn.Reconnecting,z("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var r;t._videoTrack&&t._videoTrack._player&&((r=t._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=QT(this.store),this.emit(dt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[r,{track:o}]=e;switch(r){case xe.LocalVideoTrack:ke(t=o._hints).call(t,bn.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case xe.LocalAudioTrack:o instanceof ai?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case xe.LocalVideoLowTrack:}}),this.emit(dt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;Array.from(ys(r).call(r)).forEach(o=>{this.setPendingRemoteMedia(t,o)}),this.emit(dt.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,r]=e;Array.from(ys(r).call(r)).forEach(o=>{this.setPendingRemoteDataChannel(t,o)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),k.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(let r of this.pendingRemoteDataChannels){let{user:o,id:c}=r;if((e instanceof bp?e.uid:e)===o.uid&&c===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(let r of this.pendingRemoteTracks){let{user:o,kind:c}=r;if((e instanceof bp?e.uid:e)===o.uid&&t===c)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return oo(function*(){if(!t.connection||t.state!==Tn.Connected)return;let r=yield Ft(t.mutex.lock("From P2PChannel.restartICE")),o;try{o=yield Ft(t.connection.restartICE(e));let u=yield Ft(o.next());if(u.done)return;let h=u.value,m=yield h;switch(BD(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case Di.UDP_TCP_RELAY:t._pcStatsUploadType=ih.UDP_TCP_RESTART;break;case Di.TCP_RELAY:t._pcStatsUploadType=ih.TCP_RESTART;break;case Di.RELAY:t._pcStatsUploadType=ih.RELAY_RESTART;break;default:t._pcStatsUploadType=ih.OLD_RESTART}t._isTryConnecting=!0,o.next(m)}catch(u){var c;(c=o)===null||c===void 0||c.throw(u)}finally{r()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=this.localTrackMap.get(xe.LocalVideoTrack),r=this.localTrackMap.get(xe.LocalAudioTrack),o=e.videoSend.find(A=>A.ssrc===t?.ssrcs[0].ssrcId),c=e.audioSend.find(A=>A.ssrc===r?.ssrcs[0].ssrcId);if(!o||!c)return 1;let u=Jo(this,dt.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,g=h&&m?(h+m)/2:h||m,y=(g&&u?(g+u)/2:g||u)||0,v=100*e.sendPacketLossRate*.7/50+.3*y/1500,R=v<.17?1:v<.36?2:v<.59?3:v<.1?4:5,b=t?.track;if(b&&b._encoderConfig&&b._hints.indexOf(bn.SCREEN_TRACK)===-1){let A=b._encoderConfig.bitrateMax,F=e.bitrate.actualEncoded;if(A&&F){let M=(1e3*A-F)/(1e3*A);return JW[M<.15?0:M<.3?1:M<.45?2:M<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(r=>{let[o]=r,c=o._audioSSRC,u=o._videoSSRC,h=e.audioRecv.find(F=>F.ssrc===c),m=e.videoRecv.find(F=>F.ssrc===u);if(!h&&!m)return void(t+=1);let g=Jo(this,dt.NeedSignalRTT),y=e.rtt,v=(y&&g?(y+g)/2:y||g)||0,R=h?h.jitterMs:void 0,b=e.recvPacketLossRate,A=.7*b*100/50+.3*v/1500;R&&(A=.6*b*100/50+.2*v/1500+.2*R/400),t+=A<.1?1:A<.17?2:A<.36?3:A<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new ze((t,r)=>{this.handleMuteLocalTrack(e,t,r)})}async replaceTrack(e,t){var r;if(k.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==Tn.Connected)return;let o=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:h}]=u;return e===h});if(!o)return;let c=o[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:c}]),this.bindLocalTrackEvents([{track:t,type:c}]),o[1].track=t),await((r=this.connection)===null||r===void 0?void 0:r.replaceTrack(t,o[1].id)),this.isPlanB){let u=o[1];u.id=t._mediaStreamTrack.id,this.localTrackMap.set(c,u)}if(c===xe.LocalVideoTrack&&!z("DISABLE_DUAL_STREAM_USE_ENCODING")&&Qt().supportDualStreamEncoding){let u=this.localTrackMap.get(xe.LocalVideoLowTrack);if(u){let h=e._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=h,u.track._originMediaStreamTrack=h,await new ze((m,g)=>{this.handleReplaceTrack(u.track,m,g,!0)})}}}filterTobePublishedTracks(e,t,r){let o=[],c=this.getAllTracks();e=OE(e=e.filter(g=>c.indexOf(g)===-1));let u,h=!1,m=this.localTrackMap.get(xe.LocalAudioTrack);for(let g of e){if(g instanceof jn&&(this.localTrackMap.has(xe.LocalVideoTrack)||h?new _e(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:g,type:xe.LocalVideoTrack}),h=!0),t)){let y=this.getLowVideoTrack(g,r);o.push({track:y,type:xe.LocalVideoLowTrack})}if(g instanceof Nr)if(m){let y=m.track;if(y instanceof ai)FD([g]),y.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0);else{let v=jD([y,g]);k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(v.getTrackId(),"]")),this.replaceTrack(y,v)}}else u instanceof ai?(FD([g]),u.addAudioTrack(g)):u||!g._useAudioElement&&Qt().webAudioMediaStreamDest&&!g._bypassWebAudio?u=jD(u?[g,u]:[g]):u=g}return u&&(k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(u.getTrackId(),"]")),o.push({track:u,type:xe.LocalAudioTrack})),o}filterTobeUnpublishedTracks(e){let t=[],r=this.getAllTracks();e=OE(e=e.filter(o=>r.indexOf(o)!==-1));for(let o of e){if(o instanceof Nr){let c=this.localTrackMap.get(xe.LocalAudioTrack);if(!c)continue;c.track instanceof ai?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(t.push([xe.LocalAudioTrack,c]),c.track.close())):t.push([xe.LocalAudioTrack,c])}if(o instanceof jn){let c=this.localTrackMap.get(xe.LocalVideoTrack);if(!c)continue;t.push([xe.LocalVideoTrack,c]);let u=this.localTrackMap.get(xe.LocalVideoLowTrack);u&&t.push([xe.LocalVideoLowTrack,u])}}return t}filterTobePublishedDataChannels(e){return e=(e=OE(e)).filter(t=>this.localDataChannels.findIndex(r=>r.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=OE(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:r,type:o}=t;switch(o){case xe.LocalVideoTrack:r.addListener(nt.GET_STATS,this.handleGetLocalVideoStats),r.addListener(nt.GET_RTC_STATS,this.handleGetRTCStats),r.addListener(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(nt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener(nt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener(nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case xe.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case xe.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof ai?e.trackList.forEach(r=>{r.addListener(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(nt.GET_STATS,this.handleGetLocalAudioStats),r.addListener(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(nt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(nt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[r,{track:o}]=t;return{track:o,type:r}})),e.forEach(t=>{let{track:r,type:o}=t;switch(o){case xe.LocalVideoTrack:r.off(nt.GET_STATS,this.handleGetLocalVideoStats),r.off(nt.GET_RTC_STATS,this.handleGetRTCStats),r.off(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(nt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off(nt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off(nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case xe.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case xe.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof ai?e.trackList.forEach(t=>{t.off(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(nt.GET_STATS,this.handleGetLocalAudioStats),t.off(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(nt.GET_STATS,this.handleGetLocalAudioStats),e.off(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(nt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof WE&&t.addListener(nt.GET_STATS,r=>{r(this.handleGetRemoteVideoStats(e))}),t instanceof GE&&t.addListener(nt.GET_STATS,r=>{r(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(nt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;r.has(et.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has(et.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((r,o)=>{var c;let u,h,{track:m,type:g}=r;switch(g){case xe.LocalAudioTrack:u=On.Audio,h={dtx:m instanceof jT&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case xe.LocalVideoTrack:u=ke(c=m._hints).call(c,bn.SCREEN_TRACK)?On.Screen:On.High,h=id(id({},dG(m)),{},{codec:this.store.codec,svc_mode:HT()});break;case xe.LocalVideoLowTrack:u=On.Low,h=id(id({},dG(m)),{},{codec:this.store.codec,svc_mode:HT()})}return{stream_type:u,attributes:h,ssrcs:t[o]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var r;let o,[c,{track:u,ssrcs:h,id:m}]=t;switch(c){case xe.LocalVideoTrack:o=ke(r=u._hints).call(r,bn.SCREEN_TRACK)?On.Screen:On.High;break;case xe.LocalAudioTrack:o=On.Audio;break;case xe.LocalVideoLowTrack:o=On.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(e,t){e.forEach((r,o)=>{let{track:c,type:u}=r;this.localTrackMap.set(u,{track:c,id:t[o].id,ssrcs:t[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[r]=t;this.localTrackMap.delete(r)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(dt.PeerConnectionStateChange,t),t==="connecting"&&e instanceof Ta&&!Qn()&&z("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},z("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Ta&&a8(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=ih.DISCONNECTED_OR_FAILED,Jo(this,dt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){let r=this.pendingLocalTracks.map(c=>c.getTrackId()),o=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));tt.reportApiInvoke(this.store.sessionId,{name:ar.REPUB_AFTER_PC_CONNECTED,options:r.concat(o),tag:Fn.TRACER}).onSuccess(),this.republish()}if(z("NEW_ICE_RESTART")&&e instanceof Ta&&!Qn()&&!this._forceTurn&&!this.store.useDcSignal){if(ke(sG).call(sG,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;let r=c=>{BD(e)&&(k.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),Jo(this,dt.QueryClientConnectionState)==="CONNECTED"&&this.emit(dt.RequestRestartICE,c))},o=()=>{BD(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),k.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(dt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{c8(e,r,o)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&z("ICE_RESTART")&&Jo(this,dt.QueryClientConnectionState)==="CONNECTED"&&this.emit(dt.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(dt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(dt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),tt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Fn.TRACER}).onSuccess(),this.emit(dt.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var r;let o=Array.from(ys(r=this.remoteUserMap).call(r)).find(u=>u._audioSSRC===t);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(Qa.FIRST_FRAME_DECODED),tt.firstRemoteFrame(this.store.sessionId,oi.FIRST_AUDIO_DECODE,cr.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:fs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var r;let o=Array.from(ys(r=this.remoteUserMap).call(r)).find(c=>c._audioSSRC===t);o&&tt.firstRemoteFrame(this.store.sessionId,oi.FIRST_AUDIO_RECEIVED,cr.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:fs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,r,o)=>{var c;let u=Array.from(ys(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);u&&this.store.firstVideoFrameDecoded(u.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,r,o)},e.onFirstVideoRender=t=>{var r;let o=Array.from(ys(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);o&&(this.store.firstVideoFrameDecoded(o.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(o),this.emit(dt.FirstVideoPreRender,o.uid,t))},e.onFirstVideoReceived=t=>{var r;let o=Array.from(ys(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);o&&(this.store.firstVideoFrameDecoded(o.uid,{firstReceived:Date.now()}),tt.firstRemoteFrame(this.store.sessionId,oi.FIRST_VIDEO_RECEIVED,cr.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:fs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstVideoBufferReady=t=>{var r;let o=Array.from(ys(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);o&&this.emit(dt.FirstVideoBufferReady,o.uid,t)},e.onSelectedLocalCandidateChanged=(t,r)=>{let o=t.candidateType==="relay",c=r.candidateType==="relay";r.candidateType!=="unknown"&&o===c||this.emit(dt.ConnectionTypeChange,o),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Cp(r))," -> ").concat(JSON.stringify(Cp(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,r)=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Cp(r))," -> ").concat(JSON.stringify(Cp(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{let t=this.statsCollector.getLocalVideoTrackStats(),r=this.statsCollector.getRTCStats();return id(id({},t),r)},e.onICECandidateError=t=>{this._iceError=t}}fallbackConnection(){k.debug("[".concat(this.store.clientId,"] [P2PChannel] try to fallback connection")),this.state===Tn.Connected?(k.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&this.resetConnection(this.connection),this.shouldForwardP2PCreation&&(this.connection=QT(this.store),this.emit(dt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)))}resetConnection(e){e instanceof Ta&&(function(t){ry.delete(t.id),a8(t)})(e),e.close(),this.emit(dt.PeerConnectionStateChange,"closed"),(function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0})(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let r=this.localTrackMap.get(xe.LocalAudioTrack);if(e instanceof Nr&&r?.track instanceof ai)return r.track.isActive||t.push([xe.LocalAudioTrack,r]),t;let o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(t.push(o),o[0]===xe.LocalVideoTrack)){let c=this.localTrackMap.get(xe.LocalVideoLowTrack);c&&t.push([xe.LocalVideoLowTrack,c])}return t}filterTobeUnmutedTracks(e){let t=[],r=this.localTrackMap.get(xe.LocalAudioTrack);if(e instanceof Nr&&r?.track instanceof ai)return r.track.isActive&&t.push([xe.LocalAudioTrack,r]),t;let o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===xe.LocalVideoTrack){t.push(o);let c=this.localTrackMap.get(xe.LocalVideoLowTrack);c&&t.push([xe.LocalVideoLowTrack,c])}else t.push(o);return t}createMuteMessage(e){return e.map(t=>{var r;let o,[c,{track:u,ssrcs:h,id:m}]=t;switch(c){case xe.LocalAudioTrack:o=On.Audio;break;case xe.LocalVideoTrack:o=ke(r=u._hints).call(r,bn.SCREEN_TRACK)?On.Screen:On.High;break;case xe.LocalVideoLowTrack:o=On.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(e){return e.map(t=>{var r;let o,[c,{track:u,ssrcs:h,id:m}]=t;switch(c){case xe.LocalAudioTrack:o=On.Audio;break;case xe.LocalVideoTrack:o=ke(r=u._hints).call(r,bn.SCREEN_TRACK)?On.Screen:On.High;break;case xe.LocalVideoLowTrack:o=On.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(e,t){let r=[],o=this.remoteUserMap.get(e);if(!o)return r;if(t){let c=o.get(t);if(!c)return r;r.push([e,{kind:t,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;r.push([e,{kind:u,id:h}])});return r}filterTobeUnSubscribedDataChannels(e,t){let r=[];return t.forEach(o=>{var c;(c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.has(o.id)&&r.push(o)}),r}createUnsubscribeMessage(e){let t=[];return e.forEach(r=>{let[o,{kind:c,id:u}]=r;switch(c){case et.VIDEO:return void(o._videoSSRC&&t.push({stream_type:et.VIDEO,ssrcId:o._videoSSRC}));case et.AUDIO:return void(o._audioSSRC&&t.push({stream_type:et.AUDIO,ssrcId:o._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){let t=new Map;return e.forEach(r=>{let[o,{kind:c}]=r;if(t.has(o)){let u=t.get(o);c===et.VIDEO?u|=bi.Video:u|=bi.Audio,t.set(o,u)}else c===et.VIDEO?t.set(o,bi.Video):t.set(o,bi.Audio)}),{users:Array.from(t.entries()).map(r=>{let[o,c]=r;return{stream_id:o.uid,stream_type:c}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[r,{kind:o}]=t,c=this.remoteUserMap.get(r);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(r))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(xe.LocalVideoTrack),r=this.localTrackMap.get(xe.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new ze((o,c)=>{this.handleUpdateVideoEncoder(t.track,o,c,!0)})),r&&e.low_stream_uplink&&(await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new ze((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return!(!this.connection||!("name"in this.connection)||this.connection.name!=="DataChannelConnection"||this.connection.peerConnectionState==="closed")||this.connection instanceof Ta&&this.connection.isPreallocation}isPreSub(){return(this.connection&&"name"in this.connection&&this.connection.name==="DataChannelConnection"&&this.connection.peerConnectionState!=="closed"||this.connection instanceof Ta)&&this.connection.isPreSub()}isPreRender(){return this.connection instanceof Ta&&this.connection.isPreRender}mapPubResToRemoteConfig(e,t,r){return e.map((o,c)=>{var u;let{stream_type:h}=o,m=(u=t.find(g=>{let{stream_type:y}=g;return h===y}))===null||u===void 0?void 0:u.attributes;if(m&&z("DISABLE_SCREEN_SHARE_REMB")){let g=r[c]._hints;(ke(g).call(g,bn.SCREEN_TRACK)||ke(g).call(g,bn.SCREEN_LOW_TRACK))&&(m.remb=!1,k.debug("disable remb for screen share, hints:",g))}return m})}async tryToUnmuteAudio(e){for(let r=0;r<e.length;r++)if(e[r]instanceof Nr){var t;let o=this.filterTobeUnmutedTracks(e[r]);if(o.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(o.map(u=>{let[,{id:h}]=u;return h})));let c=this.createUnmuteMessage(o);return void await Gn(this,dt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(dt.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(dt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Ci(Ab(this.dtlsFailedCount,Kr)),this.emit(dt.RequestReconnect)}async reconnectP2P(){let e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await ei(this,dt.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(dt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(xe.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof jn)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof jn).length>1)throw new _e(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Nr).length>1&&(e.some(t=>t instanceof Nr&&t._bypassWebAudio)||!Qt().webAudioMediaStreamDest))throw new _e(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof jn&&this.pendingLocalTracks.some(r=>r instanceof jn))throw new _e(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Nr&&this.pendingLocalTracks.some(r=>r instanceof Nr)&&(!Qt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(r=>r instanceof Nr&&r._bypassWebAudio)))throw new _e(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var r;let o=!z("DISABLE_DUAL_STREAM_USE_ENCODING")&&Qt().supportDualStreamEncoding,c=id(id({},{width:160,height:120,framerate:15,bitrate:50}),t),u;u=o?e._mediaStreamTrack.clone():GD(e,c);let h=In(8,"track-low-"),m=new jn(u,id(id({},o&&{scaleResolutionDownBy:yD(c,e)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return m.on(Bm.TRANSCEIVER_UPDATED,g=>{e._updateRtpTransceiver(g,ME.LOW_STREAM)}),m._hints.push(bn.LOW_STREAM),ke(r=e._hints).call(r,bn.SCREEN_TRACK)&&m._hints.push(bn.SCREEN_LOW_TRACK),e.on("sei-to-send",g=>{m.emit("sei-to-send",g)}),e.addListener(nt.NEED_CLOSE,()=>{m.close()}),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,r){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Ta){var c,u,h,m;let g=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:y,dtlsTransportState:v,peerConnectionState:R}=this.connection,{local:b,remote:A}=await this.connection.getSelectedCandidatePair();tt.pcStats(this.store.sessionId,{startTime:g,eventElapse:e-g||0,iceconnectionsate:y,dtlsstate:v,connectionstate:R,intSucc:t?1:2,error:this._iceError||o||"",selectedLocalCandidateProtocol:(c=b?.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(u=b.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(b.address,":").concat(b.port),selectedRemoteCandidateProtocol:(h=A.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(m=A.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(A.address,":").concat(A.port),restartCnt:r,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){let t=this.store.keyMetrics,r=t.firstVideoFrameDecoded.find(v=>v.userId===e.uid);if(!r)return;let{isInternalUpload:o,isExternalUpload:c}=r;if(o&&c)return;let{subscribeEnd:u,firstPreRender:h,peerPublishDuration:m,peerPubStatusMs:g}=r,{firstRender:y=0}=r;if(u&&(y||h)&&m&&g){r.isInternalUpload=!0;let{playEnd:v}=r;v&&(r.isExternalUpload=!0);let{firstPreRender:R=0}=r;y=R||y;let b=e.videoTrack,A={peer:e._uintid,width:b?._videoWidth||0,height:b?._videoHeight||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:m,peerPubStatusMs:g,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:r.userJoinNotify||0,videoAddNotify:r.videoAddNotify||0,subscribeStart:r.subscribeStart||0,subscribeEnd:r.subscribeEnd||0,firstReceived:r.firstReceived||0,firstDecoded:r.firstDecoded||0,firstPreRender:R||0,firstRender:v?Math.max(y,v):Math.max(y,u),playStart:r.playStart||0,playEnd:r.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:P5(this.store),firstReceivedEncodedFrame:r.firstReceivedEncodedFrame||0,frameType:r.frameType||"",rtpTimestamp:r.rtpTimestamp||0,framePayloadType:r.framePayloadType||0,frameDataLength:r.frameDataLength||0,mimeType:r.mimeType||""};tt.firstXLAPeerFirstVideoFrame(this.store.sessionId,A)}}reportVideoFirstFrameDecoded(e,t,r,o){var c;let u=Array.from(ys(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());let h=this.store.keyMetrics,m=h.subscribe.find(g=>g.userId===u.uid&&g.type==="video");tt.firstRemoteVideoDecode(this.store.sessionId,oi.FIRST_VIDEO_DECODE,cr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:t,videoheight:r,subscribeElapse:fs.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:m?.subscribeEnd||0,subscriberStart:m?.subscribeStart||0,videoAddNotify:m?.streamAdded||0,state:o?1:0,firstFrame:m?.firstFrame||0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.connection)return!1;let o=this.remoteUserMap.get(e);if(!o)return!1;let c=o.get(t);if(!c)return!1;let u=await this.connection.getRemoteSSRC(c);return u!==void 0&&u!==r}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:r}]=e;t===xe.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,ME.LOW_STREAM):r._updateRtpTransceiver(void 0)})}},Ye(en.prototype,"startP2PConnection",[ks],Object.getOwnPropertyDescriptor(en.prototype,"startP2PConnection"),en.prototype),Ye(en.prototype,"connect",[ks],Object.getOwnPropertyDescriptor(en.prototype,"connect"),en.prototype),Ye(en.prototype,"updateRemoteRTPCapabilities",[ks],Object.getOwnPropertyDescriptor(en.prototype,"updateRemoteRTPCapabilities"),en.prototype),Ye(en.prototype,"publishDataChannel",[ks],Object.getOwnPropertyDescriptor(en.prototype,"publishDataChannel"),en.prototype),Ye(en.prototype,"unpublish",[ks],Object.getOwnPropertyDescriptor(en.prototype,"unpublish"),en.prototype),Ye(en.prototype,"unpublishDataChannel",[ks],Object.getOwnPropertyDescriptor(en.prototype,"unpublishDataChannel"),en.prototype),Ye(en.prototype,"unpublishLowStream",[ks],Object.getOwnPropertyDescriptor(en.prototype,"unpublishLowStream"),en.prototype),Ye(en.prototype,"subscribeDataChannel",[ks],Object.getOwnPropertyDescriptor(en.prototype,"subscribeDataChannel"),en.prototype),Ye(en.prototype,"subscribe",[ks],Object.getOwnPropertyDescriptor(en.prototype,"subscribe"),en.prototype),Ye(en.prototype,"massSubscribe",[ks],Object.getOwnPropertyDescriptor(en.prototype,"massSubscribe"),en.prototype),Ye(en.prototype,"unsubscribe",[ks],Object.getOwnPropertyDescriptor(en.prototype,"unsubscribe"),en.prototype),Ye(en.prototype,"unsubscribeDataChannel",[ks],Object.getOwnPropertyDescriptor(en.prototype,"unsubscribeDataChannel"),en.prototype),Ye(en.prototype,"massUnsubscribe",[ks],Object.getOwnPropertyDescriptor(en.prototype,"massUnsubscribe"),en.prototype),Ye(en.prototype,"muteRemote",[ks],Object.getOwnPropertyDescriptor(en.prototype,"muteRemote"),en.prototype),Ye(en.prototype,"unmuteRemote",[ks],Object.getOwnPropertyDescriptor(en.prototype,"unmuteRemote"),en.prototype),Ye(en.prototype,"hasRemoteMediaWithLock",[ks],Object.getOwnPropertyDescriptor(en.prototype,"hasRemoteMediaWithLock"),en.prototype),Ye(en.prototype,"disconnectForReconnect",[ks],Object.getOwnPropertyDescriptor(en.prototype,"disconnectForReconnect"),en.prototype),Ye(en.prototype,"updateBitrateLimit",[ks],Object.getOwnPropertyDescriptor(en.prototype,"updateBitrateLimit"),en.prototype),Ye(en.prototype,"remoteMediaSsrcChanged",[ks],Object.getOwnPropertyDescriptor(en.prototype,"remoteMediaSsrcChanged"),en.prototype),en);function ks(e,t,r){let o=e[t];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let c=this.mutex,u=await c.lock("From P2PChannel.".concat(t));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await o.apply(this,m)}finally{u()}},r}function d8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function h8(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?d8(Object(r),!0).forEach(function(o){V(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d8(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}let lpe=Date.now(),upe=20,KD=new Map,CI=new Map;async function p8(e){let t=KD.get(e),r=Array.isArray(t)&&t[t.length-1],o=CI.get(e);if(!r)return void(o.isSyncing=!1);let c={uid:r.uid,payload:r.payload};o.firstRecvTs===0&&(o.firstRecvTs=r.recvTs,o.firstSendTs=r.sendTs);let u=r.sendTs-o.firstSendTs,h=u-(Date.now()-o.firstRecvTs);h>0&&(o.firstRecvTs=Date.now()-u);let m=r.mediaDelay+h;m<=0?(t.pop(),f8(r.context,c),m=0):m=Math.min(m,upe),setTimeout(()=>t.length&&p8(e),m)}function f8(e,t){e.safeEmit(zt.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function dpe(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return f8(r,{uid:e.uid,payload:e.payload});let o="".concat(r.id,"-").concat(e.uid),c=KD.get(o)||[],u=c.findIndex(y=>e.sendTs>=y.sendTs),h=h8(h8({},e),{},{context:r,mediaDelay:t,recvTs:Date.now()});u===-1?c.push(h):c.splice(u,0,h),KD.set(o,c);let m=!1;var g;CI.has(o)?m=!((g=CI.get(o))===null||g===void 0||!g.isSyncing):CI.set(o,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||p8(o)}let hpe=pn().name;function m8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function g8(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?m8(Object(r),!0).forEach(function(o){V(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m8(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}let iy="websdk_ng_cache_parameter",ppe=z("MAX_PRELOAD_ASYNC_LENGTH"),fpe=1e4,eg=new Map,tg=[],YD=null,qD=0,XD=0,RI=new Map,_8=new Uint8Array([241,141,127,212,103,139,200,225,251,157,127,139,143,2,22,163]),mpe=(function(e,t){let r=[],o=0,c=async()=>{let u=r.shift();u&&await u(),r.length>0&&o<t?c():o--};return async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return new ze(async(g,y)=>{r.push(async()=>{try{let v=await e(...h);g(v)}catch(v){y(v)}}),o<t&&(o++,c())})}})($D,ppe),JD=ao.CancelToken.source();class gpe{constructor(){V(this,"_audioContext",null)}createMuteAudioTrack(){this._audioContext=new AudioContext;let t=this._audioContext.sampleRate,r=10*t,o=this._audioContext.createBuffer(2,r,t),c=this._audioContext.createBufferSource();c.buffer=o;let u=this._audioContext.createMediaStreamDestination();return c.connect(u),c.start(),u.stream.getAudioTracks()[0]}close(){this._audioContext&&(this._audioContext.close(),this._audioContext=null)}}async function $D(e,t,r,o,c,u,h){try{if(!z("ENABLE_PRELOAD"))return;if(!Qt().supportWebCrypto)return void Ep(()=>{k.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!r&&r!==null)throw new _e(Y.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));r&&Hi(r,"token",1,2047),Hi(e,"appid",1,2047),eI(t),o&&tI(o);let m=Um();k.debug("preload channel ".concat(t,", uid is ").concat(o));let g={appId:e,cname:t,token:r||e,uid:typeof o!="string"?o:null,sid:m,proxyServer:c,role:h},y,v;typeof o=="string"?(g.stringUid=o,[v,y]=await ze.all([$he(o,{sid:m,appId:e},JD.token),BG(g8(g8({},g),{},{token:r||e,uid:0}),JD.token)]),g.uid=v.uid,y.gatewayInfo.uid=g.uid,y.gatewayInfo.res.uid=g.uid):(u&&(g.stringUid=u),y=await BG(g,JD.token));let R={sid:m,appId:e,cname:t,token:r||e,uid:g.stringUid||o,intUid:g.uid||y.gatewayInfo.uid,stringUid:g.stringUid,ts:Date.now(),sua:v,ap:y};await ZD(R),qD++}catch(m){throw XD++,(function(g){YD||(YD=window.setTimeout(()=>{let v="";RI.forEach((R,b)=>{v+="".concat(b,": ").concat(R," ;")}),tt.reportApiInvoke(null,{name:ar.PRELOAD,options:{success:qD,failed:XD,err:v}}).onError(g),qD=0,XD=0,RI.clear(),YD=null},fpe));let y=RI.get(g.code)||0;RI.set(g.code,y+1)})(m),m}}async function QD(e){try{if(z("AP_REQUEST_DETAIL")||z("ENABLE_ROLE_SELECT_EDGE"))return;let t=E8(e);if(!t||e.cloudProxyServer!=="disabled")return;let r=await(async function(o,c){try{let u=await window.crypto.subtle.importKey("raw",s5(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:_8},u,Mm(o));return JSON.parse(window.atob(yp(new Uint8Array(h))))}catch{return}})(t,e.token||e.appId);if(!r||!(function(o,c){return o.cname===c.cname&&o.appId===c.appId&&o.token===c.token?c.stringUid?o.stringUid===c.stringUid:typeof c.uid=="number"?o.uid===c.uid:o.uid==c.uid:!1})(r,e))return;if(r&&Date.now()-r.ts<z("AP_CACHE_LIFETIME"))return r}catch(t){k.warn("Error get preloadInfo",t.message)}}function E8(e){let t;try{if(t=S8(iy),!t)return;let r=JSON.parse(t),o=T8(e),c=(function(h,m){for(let g=h.length-1;g>=0;g--)if(m(h[g]))return g;return-1})(r,h=>o in h);if(c===-1)return;let u=r.splice(c,1)[0];return bI(iy,JSON.stringify(r)),u[o]}catch(r){k.warn("Error delete preload info: ".concat(t),r.message),bI(iy,"")}}async function ZD(e){let t;try{e.uid&&E8({appId:e.appId,cname:e.cname,token:e.token,uid:e.uid,stringUid:e.stringUid});let r=T8(e),o=await(async function(u,h){try{let m=await window.crypto.subtle.importKey("raw",s5(h),"AES-GCM",!1,["encrypt"]),g=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:_8},m,Mm(window.btoa(JSON.stringify(u))));return yp(new Uint8Array(g))}catch{return}})(e,e.token||e.appId);if(!o)return;t=S8(iy);let c=t?JSON.parse(t):[];c.push({[r]:o}),c.length>z("AP_CACHE_NUM")&&c.shift(),bI(iy,JSON.stringify(c))}catch(r){k.warn("Error caching server parameters:",r.message),bI(iy,"")}}function ex(e){if(e){let t=eg.get(e);t&&(window.clearTimeout(t),t=null,eg.delete(e)),ke(tg).call(tg,e)||e.cloudProxyServer!=="disabled"||tg.push(e)}if(eg.size<z("AP_CACHE_NUM")&&tg.length>0){let t=tg.shift();eg.set(t,window.setTimeout(async()=>{let{appId:r,cname:o,token:c,stringUid:u,uid:h,proxyServer:m,role:g}=t;try{await mpe(r,o,c,h,m,u,g),eg.has(t)&&ex(t)}catch(y){k.warn("update preload failed",y.message),y8(t)}},z("AP_UPDATE_INTERVAL")))}}function y8(e){let t=tg.indexOf(e);t!==-1&&tg.splice(t,1);let r=eg.get(e);r&&(window.clearTimeout(r),r=null,eg.delete(e),ex())}function v8(e,t){let r=e.sua,o=e.ap;t&&r&&tt.reqUserAccount(e.sid,{lts:r.requestTime,elapse:r.elapse,success:!0,serverAddr:r.url,stringUid:t,uid:e.intUid,errorCode:null,extend:r.req}),tt.reportResourceTiming(e.ap.url,e.sid),tt.joinWebProxyAP(e.sid,{lts:o.requestTime,elapse:o.elapse,sucess:1,apServerAddr:o.url,turnServerAddrList:o.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[Yr.CHOOSE_SERVER,Yr.CLOUD_PROXY_FALLBACK].toString()}),tt.joinChooseServer(e.sid,{lts:o.requestTime,elapse:o.elapse,succ:!0,csAddr:o.url,opid:o.opid,serverList:o.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:o.gatewayInfo.cid.toString(),uid:o.gatewayInfo.uid.toString(),csIp:o.gatewayInfo.csIp,unilbsServerIds:[Yr.CHOOSE_SERVER].toString(),isHttp3:o.isHttp3})}function S8(e){return window.atob(window.localStorage.getItem(e)||"")}function bI(e,t){window.localStorage.setItem(e,window.btoa(t))}function T8(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),h5(t)}function _pe(e){let t=(function(){let r=vpe.pop();return r?(r.offset=r.limit=0,r):{bytes:new Uint8Array(64),offset:0,limit:0}})();return(function(r,o){let c=r.appId;c!==void 0&&(qr(o,10),Ap(o,c));let u=r.cid;u!==void 0&&(qr(o,16),qr(o,u));let h=r.cname;h!==void 0&&(qr(o,26),Ap(o,h));let m=r.deviceId;m!==void 0&&(qr(o,34),Ap(o,m));let g=r.elapse;g!==void 0&&(qr(o,40),Op(o,g));let y=r.fileSize;y!==void 0&&(qr(o,48),Op(o,sy(y)));let v=r.height;v!==void 0&&(qr(o,56),Op(o,sy(v)));let R=r.jpg;R!==void 0&&(qr(o,66),qr(o,R.length),C8(o,R));let b=r.networkType;b!==void 0&&(qr(o,72),Op(o,sy(b)));let A=r.osType;A!==void 0&&(qr(o,80),Op(o,sy(A)));let F=r.requestId;F!==void 0&&(qr(o,90),Ap(o,F));let M=r.sdkVersion;M!==void 0&&(qr(o,98),Ap(o,M));let j=r.sequence;j!==void 0&&(qr(o,104),Op(o,sy(j)));let K=r.sid;K!==void 0&&(qr(o,114),Ap(o,K));let q=r.timestamp;q!==void 0&&(qr(o,120),Op(o,q));let Q=r.uid;Q!==void 0&&(qr(o,128),qr(o,Q));let se=r.vid;se!==void 0&&(qr(o,136),qr(o,se));let oe=r.width;oe!==void 0&&(qr(o,144),Op(o,sy(oe)));let te=r.service;te!==void 0&&(qr(o,152),qr(o,te));let de=r.callbackData;de!==void 0&&(qr(o,162),qr(o,de.length),C8(o,de));let Ce=r.ticket;Ce!==void 0&&(qr(o,170),Ap(o,Ce));let Pe=r.vendorConfigs;Pe!==void 0&&(qr(o,178),Ap(o,Pe))})(e,t),(function(r){let o=r.bytes,c=r.limit;return o.length===c?o:o.subarray(0,c)})(t)}function Epe(e){return(function(r){let o={};e:for(;!Spe(r);){let c=e0(r);switch(c>>>3){case 0:break e;case 1:o.code=e0(r);break;case 2:o.msg=R8(r,e0(r));break;case 3:o.requestId=R8(r,e0(r));break;case 4:o.timestamp=Tpe(r,!1);break;default:ype(r,7&c)}}return o})({bytes:t=e,offset:0,limit:t.length});var t}function ype(e,t){switch(t){case 0:for(;128&$c(e););break;case 2:tx(e,e0(e));break;case 5:tx(e,4);break;case 1:tx(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function sy(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let vpe=[];function tx(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function Spe(e){return e.offset>=e.limit}function II(e,t){let r=e.bytes,o=e.offset,c=e.limit,u=o+t;if(u>r.length){let h=new Uint8Array(2*u);h.set(r),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),o}function w8(e,t){let r=e.offset;if(r+t>e.limit)throw new Error("Read past limit");return e.offset+=t,r}function C8(e,t){let r=II(e,t.length);e.bytes.set(t,r)}function R8(e,t){let r=w8(e,t),o=String.fromCharCode,c=e.bytes,u="",h="";for(let m=0;m<t;m++){let g,y,v,R,b=c[m+r];128&b?(224&b)==192?m+1>=t?h+=u:(g=c[m+r+1],(192&g)!=128?h+=u:(R=(31&b)<<6|63&g,R<128?h+=u:(h+=o(R),m++))):(240&b)==224?m+2>=t?h+=u:(g=c[m+r+1],y=c[m+r+2],(49344&(g|y<<8))!=32896?h+=u:(R=(15&b)<<12|(63&g)<<6|63&y,R<2048||R>=55296&&R<=57343?h+=u:(h+=o(R),m+=2))):(248&b)==240?m+3>=t?h+=u:(g=c[m+r+1],y=c[m+r+2],v=c[m+r+3],(12632256&(g|y<<8|v<<16))!=8421504?h+=u:(R=(7&b)<<18|(63&g)<<12|(63&y)<<6|63&v,R<65536||R>1114111?h+=u:(R-=65536,h+=o(55296+(R>>10),56320+(1023&R)),m+=3))):h+=u:h+=o(b)}return h}function Ap(e,t){let r=t.length,o=0;for(let h=0;h<r;h++){let m=t.charCodeAt(h);m>=55296&&m<=56319&&h+1<r&&(m=(m<<10)+t.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}qr(e,o);let c=II(e,o),u=e.bytes;for(let h=0;h<r;h++){let m=t.charCodeAt(h);m>=55296&&m<=56319&&h+1<r&&(m=(m<<10)+t.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function $c(e){return e.bytes[w8(e,1)]}function b8(e,t){let r=II(e,1);e.bytes[r]=t}function e0(e){let t,r=0,o=0;do t=$c(e),r<32&&(o|=(127&t)<<r),r+=7;while(128&t);return o}function qr(e,t){for(t>>>=0;t>=128;)b8(e,127&t|128),t>>>=7;b8(e,t)}function Tpe(e,t){let r,o=0,c=0,u=0;return r=$c(e),o=127&r,128&r&&(r=$c(e),o|=(127&r)<<7,128&r&&(r=$c(e),o|=(127&r)<<14,128&r&&(r=$c(e),o|=(127&r)<<21,128&r&&(r=$c(e),c=127&r,128&r&&(r=$c(e),c|=(127&r)<<7,128&r&&(r=$c(e),c|=(127&r)<<14,128&r&&(r=$c(e),c|=(127&r)<<21,128&r&&(r=$c(e),u=127&r,128&r&&(r=$c(e),u|=(127&r)<<7))))))))),{low:o|c<<28,high:c>>>4|u<<24,unsigned:t}}function Op(e,t){let r=t.low>>>0,o=(t.low>>>28|t.high<<4)>>>0,c=t.high>>>24,u=c===0?o===0?r<16384?r<128?1:2:r<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=II(e,u),m=e.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?r>>>21|128:r>>>21&127;case 3:m[h+2]=u!==3?r>>>14|128:r>>>14&127;case 2:m[h+1]=u!==2?r>>>7|128:r>>>7&127;case 1:m[h]=u!==1?128|r:127&r}}let I8={},A8={},AI=4294967296,wpe=AI*AI,Cpe=wpe/2;N8(0,!0);let O8=N8(0),Rpe=t0(0,-2147483648,!1),bpe=t0(-1,2147483647,!1);function N8(e,t){let r,o,c;return t?(c=0<=(e>>>=0)&&e<256)&&(o=A8[e],o)?o:(r=t0(e,0,!0),c&&(A8[e]=r),r):(c=-128<=(e|=0)&&e<128)&&(o=I8[e],o)?o:(r=t0(e,e<0?-1:0,!1),c&&(I8[e]=r),r)}function t0(e,t,r){return{low:0|e,high:0|t,unsigned:!!r}}function P8(e,t){if(isNaN(e))return O8;{if(e<=-9223372036854776e3)return Rpe;if(e+1>=Cpe)return bpe}return e<0?O8:t0(e%AI|0,e/AI|0,t)}function k8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}class nx extends dr{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let r=this._connectionState;this._connectionState=t,this.emit(Kl.CONNECTION_STATE_CHANGE,t,r)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var r;super(),V(this,"name","AgoraRTCImageModeration"),V(this,"_connectionState",tc.CONNECTING),V(this,"_sequence",0),V(this,"_moderationStartTime",void 0),V(this,"_workerConnection",void 0),V(this,"_workerMessageLengthLimit",void 0),V(this,"_qualityRatio",void 0),V(this,"_connectInfo",void 0),V(this,"_cancelTokenSource",ao.CancelToken.source()),V(this,"_retryConfig",void 0),V(this,"_moderationInterval",void 0),V(this,"_moderationTimer",null),V(this,"_moderationMode",1),V(this,"_quality",1),V(this,"_qualityTimer",null),V(this,"_ticket",void 0),V(this,"_moderationIntervalMinimum",void 0),V(this,"_uploadFailedNum",0),V(this,"_uploadNum",0),V(this,"_uploadTimer",null),V(this,"_extraInfo",void 0),V(this,"_vendor",""),V(this,"_encoder",new TextEncoder),V(this,"_moderationId",void 0),V(this,"inspectImage",()=>{if(this.connectionState!==tc.CONNECTED)throw new he(Y.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===tc.CONNECTED?this.requestToInspectImage():k.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=In(5,"image-moderation-"),this._workerMessageLengthLimit=z("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=z("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(r=t.interval)!==null&&r!==void 0?r:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=z("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new WT("worker-"+this._moderationId,Kr),this.on(Kl.STATE_CHANGE,(o,c)=>{k.debug("[".concat(this._moderationId,"] Moderation operation :").concat(YE[o]," ").concat(c||""))}),this.handleWorkerEvents()}async init(t,r){this.emit(Kl.STATE_CHANGE,YE.CONNECT_AP),this._connectInfo=t;let o=this._cancelTokenSource.token;return this._retryConfig=r,new ze((c,u)=>{this.on(Kl.CONNECTION_STATE_CHANGE,(h,m)=>{h===tc.CONNECTED&&c()}),this.requestAP(t,o,r).then(h=>{this.connectWorker(h)}).catch(h=>{u(h)})})}updateConfig(t){var r;this._moderationInterval=(r=t.interval)!==null&&r!==void 0?r:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),k.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===tc.CONNECTED&&this.inspectImage()}async requestAP(t,r,o){let c=z("WEBCS_DOMAIN").map(g=>"https://".concat(g,"/api/v1")),u=await(function(g,y,v,R){let{appId:b,areaCode:A,cname:F,sid:M,token:j,uid:K}=y;QE++;let q="moderation_plugin",Q={service_name:q,json_body:JSON.stringify({appId:b,areaCode:A,cname:F,command:"allocateEdge",requestId:QE,seq:QE,sid:M,appToken:j,ts:Date.now(),uid:K+""})},se,oe,te=g[0];return Wl(async()=>{se=Date.now();let de=await ql(te,{data:Q,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(oe=Date.now()-se,de.code!==0){let ot=new he(Y.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+de.code,{retry:!0,responseTime:oe});throw k.error(ot.toString()),ot}let Ce=JSON.parse(de.json_body);if(Ce.code!==200){let ot=new he(Y.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Ce.code,", reason: ").concat(Ce.reason),{code:Ce.code,responseTime:oe});throw k.error(ot.toString()),ot}if(!Ce.servers||!Array.isArray(Ce.servers)||Ce.servers.length===0){let ot=new he(Y.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Ce.code,responseTime:oe});throw k.error(ot.toString()),ot}if(!Ce.servers.some(ot=>!!ot.wss)){let ot=new he(Y.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Ce.code,responseTime:oe});throw k.error(ot.toString()),ot}let Pe=z("IMAGE_MODERATION_WORKER_WSS");if(Pe)return{addressList:[Pe],workerToken:Ce.workerToken,vid:Ce.vid,responseTime:oe};let Qe=z("IMAGE_MODERATION_WORKER_HOST");return{addressList:Ce.servers.map(ot=>{let{address:Xt,wss:Lt}=ot;if(Xt&&Lt)return"wss://".concat(Xt.replace(/\./g,"-"),".").concat(Qe,":").concat(Lt,"/moderation")}).filter(ot=>!!ot),workerToken:Ce.workerToken,vid:Ce.vid,ticket:Ce.appTicket,responseTime:oe}},(de,Ce)=>(tt.apworkerEvent(M,{success:!0,sc:200,serviceName:q,responseDetail:JSON.stringify(de.addressList),firstSuccess:Ce===0,responseTime:oe,serverIp:g[Ce%g.length]}),!1),(de,Ce)=>(tt.apworkerEvent(M,{success:!1,sc:de.data&&de.data.code||200,serviceName:q,responseTime:oe,serverIp:g[Ce%g.length]}),!!(de.code!==Y.OPERATION_ABORTED&&de.code!==Y.UNEXPECTED_RESPONSE||de.data&&de.data.retry)&&(te=g[(Ce+1)%g.length],!0)),R)})(c,t,r,o);this.emit(Kl.STATE_CHANGE,YE.AP_CONNECTED);let{addressList:h,ticket:m}=u;return this._ticket=m,h}async connectWorker(t){this.emit(Kl.STATE_CHANGE,YE.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(Ot.CONNECTED,async()=>{this.emit(Kl.STATE_CHANGE,YE.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=tc.CONNECTED}),this._workerConnection.on(Ot.CLOSED,()=>{this.connectionState=tc.CLOSED}),this._workerConnection.on(Ot.FAILED,()=>{this.connectionState=tc.CLOSED}),this._workerConnection.on(Ot.RECONNECTING,()=>{this.connectionState=this.connectionState===tc.CONNECTED?tc.RECONNECTING:tc.CONNECTING}),this._workerConnection.on(Ot.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){let r=Epe(new Uint8Array(t.data));z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&k.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(r)),this._uploadNum++,r.code===void 0||r.code===0||(this._uploadFailedNum++,k.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(r.code,", msg is ").concat(r.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{tt.reportApiInvoke(this._connectInfo.sid||null,{name:ar.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,r.code],tag:Fn.TRACER}).onError(new he(Y.IMAGE_MODERATION_UPLOAD_FAILED,r.msg)),this._uploadTimer=null},z("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else k.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Ot.WILL_RECONNECT,(t,r,o)=>{t==="recover"&&o(t),o("tryNext")}),this._workerConnection.on(Ot.REQUEST_NEW_URLS,(t,r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(r)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){let t=Jo(this,Kl.CLIENT_LOCAL_VIDEO_TRACK),r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&k.debug("Only the track being played can be inspected"));this._sequence++;let o=await this.generateRequestData(t,r);this._workerConnection.sendMessage(o,!0,!0)}else z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&k.debug("Only the track being published can be inspected")}async generateRequestData(t,r){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:g}=r,y=Date.now(),v=await t.getCurrentFrameImage("image/jpeg",this.quality),R=await r6(v,o,c),b=this._sequence+"-"+u+"-"+g+"-"+y+"-"+In(12,""),A={appId:o,cid:u,cname:c,deviceId:"",elapse:nx.intToLong(Number(y-this._moderationStartTime)),fileSize:v.buffer.byteLength,height:v.height,width:v.width,jpg:R,networkType:6,osType:7,requestId:b,sdkVersion:"4.24.2",sequence:this._sequence,sid:m,timestamp:P8(y),uid:g,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete A.callbackData;let F=_pe(A);if(F.byteLength<this._workerMessageLengthLimit){if(z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){let M=(function(j){for(var K=1;K<arguments.length;K++){var q=arguments[K]!=null?arguments[K]:{};K%2?k8(Object(q),!0).forEach(function(Q){V(j,Q,q[Q])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(q)):k8(Object(q)).forEach(function(Q){Object.defineProperty(j,Q,Object.getOwnPropertyDescriptor(q,Q))})}return j})({},A);delete M.jpg,k.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(M))}return F}{let M=this.quality*this._qualityRatio;return this.quality=M,await this.generateRequestData(t,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=ao.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=tc.CLOSED,this.emit(Kl.STATE_CHANGE,YE.CLOSED)}}function D8(e){if(Vn(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new he(Y.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new he(Y.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}let Ipe={name:"ImageModeration",create:function(e){let{config:t}=e;return D8(t),new nx(t)}};var x8,L8,M8,U8,V8,F8,j8,B8,W8,G8,H8,z8,K8,Y8,q8,X8,J8,$8,Q8,Z8,eH,tH,nH,rH,iH,sH,oH,aH,cH,lH,uH,dH,hH,pH,fH,mH,gH,_H,EH,yH,vH,SH,$e;function TH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function Qc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?TH(Object(r),!0).forEach(function(o){V(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):TH(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}ki.setLogger(k);let Ape=(x8=gt(),L8=gt({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof FE))return[t];t=[t]}return t.map(r=>r?Object(r).toString():"null")}}),M8=gt({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==VE.DATA?(Array.isArray(t)||(t=[t]),t.map(r=>r.getTrackId())):[t.getChannelId()])}),U8=gt({argsMap:(e,t,r,o)=>[typeof t=="object"?t.uid:t,r,o]}),V8=gt({argsMap:(e,t,r)=>[t,r]}),F8=gt({argsMap:(e,t)=>t.map(r=>{let{user:o,mediaType:c}=r;return[o?.uid,c]})}),j8=gt({argsMap:(e,t,r,o)=>[typeof t=="object"?t.uid:t,r,o]}),B8=gt({argsMap:(e,t)=>t.map(r=>{let{user:o,mediaType:c}=r;return{uid:o?.uid,mediaType:c}})}),W8=gt(),G8=gt(),H8=gt(),z8=gt(),K8=gt(),Y8=gt(),q8=gt(),X8=gt(),J8=gt(),$8=gt(),Q8=gt(),Z8=gt(),eH=gt(),tH=gt(),nH=gt(),rH=gt(),iH=gt({argsMap:(e,t)=>[t]}),sH=gt(),oH=gt(),aH=gt(),cH=gt(),lH=gt(),uH=gt(),dH=gt(),hH=gt(),pH=gt({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),fH=gt(),mH=gt(),gH=gt(),_H=gt(),EH=gt(),yH=gt(),vH=gt({reportResult:!0}),SH=gt(),$e=class extends dr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let r;if(super(),V(this,"store",void 0),V(this,"_uid",void 0),V(this,"_channelName",void 0),V(this,"_uintUid",void 0),V(this,"_users",[]),V(this,"_config",void 0),V(this,"_clientId",void 0),V(this,"_appId",void 0),V(this,"_sessionId",null),V(this,"_key",void 0),V(this,"_rtmConfig",{}),V(this,"_joinInfo",void 0),V(this,"_gateway",void 0),V(this,"_statsCollector",void 0),V(this,"_configDistribute",void 0),V(this,"_leaveMutex",void 0),V(this,"_publishMutex",void 0),V(this,"_renewTokenMutex",void 0),V(this,"_subscribeMutex",void 0),V(this,"_encryptionMode","none"),V(this,"_encryptionSecret",null),V(this,"_encryptionSalt",null),V(this,"_encryptDataStream",!1),V(this,"_encryptDataStreamKey",null),V(this,"_encryptDataStreamIv",null),V(this,"_proxyServer",void 0),V(this,"_turnServer",{servers:[],mode:"auto"}),V(this,"_cloudProxyServerMode","disabled"),V(this,"_isDualStreamEnabled",!1),V(this,"_defaultStreamFallbackType",void 0),V(this,"_lowStreamParameter",void 0),V(this,"_streamFallbackTypeCacheMap",new Map),V(this,"_remoteStreamTypeCacheMap",new Map),V(this,"_axiosCancelSource",ao.CancelToken.source()),V(this,"_audioVolumeIndicationInterval",void 0),V(this,"_networkQualityInterval",void 0),V(this,"_userOfflineTimeout",void 0),V(this,"_streamRemovedTimeout",void 0),V(this,"_rteDetailInterval",void 0),V(this,"_liveTranscodeStreamingClient",void 0),V(this,"_liveRawStreamingClient",void 0),V(this,"_channelMediaRelayClient",void 0),V(this,"_networkQualitySensitivity","normal"),V(this,"_p2pChannel",void 0),V(this,"_useLocalAccessPoint",!1),V(this,"_setLocalAPVersion",void 0),V(this,"_joinAndNotLeaveYet",!1),V(this,"_numberOfJoinCount",0),V(this,"_joinResponse",null),V(this,"_remoteDefaultVideoStreamType",void 0),V(this,"_inspect",void 0),V(this,"_moderation",void 0),V(this,"_license",void 0),V(this,"_pendingPublishedUsers",[]),V(this,"ntpAlignErrorCount",0),V(this,"remoteInboundOffset",0),V(this,"_peerConnectionState",void 0),V(this,"_pendingRtpCapabilityChange",void 0),V(this,"_fallbackServerInfo",void 0),V(this,"_dualStreamMode",void 0),V(this,"_handleLocalTrackEnable",(c,u,h)=>{this.publish(c,!1).then(u).catch(h)}),V(this,"_handleLocalTrackDisable",(c,u,h)=>{this.unpublish(c).then(u).catch(h)}),V(this,"_handleUserOnline",c=>{if(z("BLOCK_LOCAL_CLIENT")&&Ym(c.uid,this.channelName))return void k.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&k.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let u=this._users.find(h=>h.uid===c.uid);if(u)u._trust_in_room_=!0,u._is_pre_created&&(u._is_pre_created=!1,this.safeEmit(zt.USER_JOINED,u));else{let h=new bp(c.uid,c.uint_id||c.uid);this._users.push(h),k.debug("[".concat(this._clientId,"] user online"),c.uid),this.store.firstVideoFrameDecoded(h.uid,{userJoinNotify:Date.now()}),this.safeEmit(zt.USER_JOINED,h)}}),V(this,"_handleUserOffline",c=>{if(z("BLOCK_LOCAL_CLIENT")&&Ym(c.uid,this.channelName))return;let u=this._users.find(h=>h.uid===c.uid);u&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),u._audio_pre_subscribed||u._video_pre_subscribed?u._is_pre_created=!0:bb(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),k.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(zt.USER_LEAVED,u,c.reason))}),V(this,"_handleAddAudioOrVideoStream",(c,u,h,m,g,y,v,R)=>{if(z("BLOCK_LOCAL_CLIENT")&&Ym(u,this.channelName))return;let b=this._users.find(M=>M.uid===u);if(!b)return void k.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));k.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(b.uid,c,void 0,void 0,void 0,Date.now()),c==="video"&&this.store.firstVideoFrameDecoded(b.uid,{videoAddNotify:Date.now()});let A=c==="audio"?b.hasAudio:b.hasVideo;b._uintid||(b._uintid=y||u),c==="audio"?b._trust_audio_stream_added_state_=!0:b._trust_video_stream_added_state_=!0,c==="audio"?(b._audio_added_=!0,h!==void 0&&(b._audioSSRC=h),m!==void 0&&(b._cname=m),v&&(b._audioOrtc=v)):(b._video_added_=!0,h!==void 0&&(b._videoSSRC=h),m!==void 0&&(b._cname=m),R!==void 0&&(b._rtxSsrcId=R),v&&(b._videoOrtc=v)),(c==="audio"?b.hasAudio:b.hasVideo)&&!A&&(k.info("[".concat(this._clientId,"] remote user ").concat(b.uid," published ").concat(c)),this.safeEmit(zt.USER_PUBLISHED,b,c)),c==="video"?tt.onGatewayStream(this._sessionId,oi.ON_ADD_VIDEO_STREAM,cr.ON_ADD_VIDEO_STREAM,{peer:y||u,ssrc:b._videoSSRC}):tt.onGatewayStream(this._sessionId,oi.ON_ADD_AUDIO_STREAM,cr.ON_ADD_AUDIO_STREAM,{peer:y||u,ssrc:b._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(b,c,h).then(M=>{if(M&&(k.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(b.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Zm))return this._p2pChannel.unsubscribe(b,c,!0).then(()=>this._subscribe(b,c,!0).catch(j=>{k.error("[".concat(this._clientId,"] resubscribe error"),j.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(b,c)&&(k.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(b.uid," after reconnect.")),this._subscribe(b,c,!0).catch(M=>{k.error("[".concat(this._clientId,"] resubscribe error"),M.toString())}));let F=this._getEncodingName(g);c==="video"&&(F==="unknown"?this.safeEmit(zt.AV1_DECODABLE_RESULT,!1):Pi()||Es()||F?.toLocaleLowerCase()!==Fm.av1||Jhe().then(M=>{z("FLS_ENABLE_AV1_DECODE_DETECT")&&this.safeEmit(zt.AV1_DECODABLE_RESULT,M),M||this._gateway.downgradeCodec(F)}))}),V(this,"_handleRemoveStream",c=>{if(z("BLOCK_LOCAL_CLIENT")&&Ym(c.uid,this.channelName))return;let u=this._users.find(m=>m.uid===c.uid);if(!u)return void k.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));k.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};u.hasAudio&&u.hasVideo?h=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(zt.USER_UNPUBLISHED,u,"audio"),k.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(zt.USER_UNPUBLISHED,u,"video")}:u.hasVideo?h=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(zt.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(h=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(zt.USER_UNPUBLISHED,u,"audio")}),u._video_pre_subscribed||u._audio_pre_subscribed||(u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel instanceof Zm&&this._p2pChannel.unsubscribe(u).then(m=>{if(m)return this._gateway.unsubscribe(m,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),tt.onGatewayStream(this._sessionId,oi.ON_REMOVE_STREAM,cr.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),V(this,"_handleSetStreamLocalEnable",(c,u,h)=>{if(z("BLOCK_LOCAL_CLIENT")&&Ym(u,this.channelName))return;let m=this._users.find(v=>v.uid===u);if(!m)return void k.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));k.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(u));let g=c==="audio"?m.hasAudio:m.hasVideo;if(c==="audio"){m._trust_audio_enabled_state_=!0;let v=m._audio_enabled_;if(m._audio_enabled_=h,m._audio_enabled_===v)return;{let R=m._audio_enabled_?"enable-local-audio":"disable-local-audio";k.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(zt.USER_INFO_UPDATED,u,R)}}else{m._trust_video_enabled_state_=!0;let v=m._video_enabled_;if(m._video_enabled_=h,m._video_enabled_===v)return;{let R=m._video_enabled_?"enable-local-video":"disable-local-video";k.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(zt.USER_INFO_UPDATED,u,R)}}let y=c==="audio"?m.hasAudio:m.hasVideo;return g!==y?!g&&y?(k.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(c)),void this.safeEmit(zt.USER_PUBLISHED,m,c)):(c==="video"&&m._videoTrack&&m._videoTrack._destroy(),c==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,c),k.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(c)),void this.safeEmit(zt.USER_UNPUBLISHED,m,c)):void 0}),V(this,"_handleMuteStream",(c,u,h)=>{if(z("BLOCK_LOCAL_CLIENT")&&Ym(c,this.channelName))return;k.debug("[".concat(this._clientId,"] receive mute message"),c,u,h);let m=this._users.find(v=>v.uid===c);if(!m)return void k.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));let g=u==="audio"?m.hasAudio:m.hasVideo;if(u==="audio"){m._trust_audio_mute_state_=!0;let v=m._audio_muted_;if(m._audio_muted_=h,m._audio_muted_===v)return;{let R=m._audio_muted_?"mute-audio":"unmute-audio";k.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(zt.USER_INFO_UPDATED,c,R)}}else{m._trust_video_mute_state_=!0;let v=m._video_muted_;if(m._video_muted_=h,m._video_muted_===v)return;{let R=m._video_muted_?"mute-video":"unmute-video";k.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(zt.USER_INFO_UPDATED,c,R)}}let y=u==="audio"?m.hasAudio:m.hasVideo;if(g!==y){if(!g&&y)return(u==="audio"?m._audioSSRC:m._videoSSRC)?(k.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(u)),void this.safeEmit(zt.USER_PUBLISHED,m,u)):void k.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),u==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,u),k.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(u)),this.safeEmit(zt.USER_UNPUBLISHED,m,u)}}),V(this,"_handleP2PLost",async c=>{k.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():k.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),V(this,"_handleTokenWillExpire",()=>{k.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(zt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),V(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),k.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),V(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(zt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});let c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(zt.NETWORK_QUALITY,c)}),V(this,"_handleP2PAddAudioOrVideoStream",(c,u,h,m)=>{let g=this._users.find(v=>v.uid===u);if(!g)return void k.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));k.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(g.uid,c,void 0,void 0,void 0,Date.now());let y=c==="audio"?g.hasAudio:g.hasVideo;c==="audio"?g._trust_audio_stream_added_state_=!0:g._trust_video_stream_added_state_=!0,c==="audio"?(g._audio_added_=!0,h!==void 0&&(g._audioSSRC=h),m!==void 0&&(g._audioMid=m)):(g._video_added_=!0,h!==void 0&&(g._videoSSRC=h),m!==void 0&&(g._videoMid=m)),(c==="audio"?g.hasAudio:g.hasVideo)&&!y&&(k.info("[".concat(this._clientId,"] remote user ").concat(g.uid," published ").concat(c)),this.safeEmit(zt.USER_PUBLISHED,g,c)),this._p2pChannel.hasPendingRemoteMedia(g,c)&&(k.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(g.uid," after reconnect.")),this._subscribe(g,c,!0).catch(v=>{k.error("[".concat(this._clientId,"] resubscribe error"),v.toString())}))}),this._config=e,this._clientId=t||In(5,"client-"),this.store=new class{constructor(c,u,h,m,g){Ct(this,"state",void 0),this.state={codec:c,audioCodec:u,mode:h,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Vm.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,rteUrl:void 0,rteSid:void 0,autoSubscribe:!1,enableInstantMuteRestore:!1,networkQualityProbe:!1,useDcSignal:!!g}}dispatch(c){this.state=(function(u,h){switch(h.type){case Tt.SET_SESSION_ID:return Me(Me({},u),{},{sessionId:h.sessionId});case Tt.SET_P2P_ID:return Me(Me({},u),{},{p2pId:h.p2pId});case Tt.SET_UID:return Me(Me({},u),{},{uid:h.uid});case Tt.SET_INT_UID:return Me(Me({},u),{},{intUid:h.intUid});case Tt.SET_PUB_ID:return Me(Me({},u),{},{pubId:h.pubId});case Tt.KEY_METRIC_CLIENT_CREATED:return Me(Me({},u),{},{keyMetrics:Me(Me({},u.keyMetrics),{},{clientCreated:h.metric})});case Tt.KEY_METRIC_JOIN_START:return Me(Me({},u),{},{keyMetrics:Me(Me({},u.keyMetrics),{},{joinStart:h.metric})});case Tt.KEY_METRIC_PRELOAD_START:return Me(Me({},u),{},{keyMetrics:Me(Me({},u.keyMetrics),{},{preloadStart:h.metric})});case Tt.KEY_METRIC_PRELOAD_END:return Me(Me({},u),{},{keyMetrics:Me(Me({},u.keyMetrics),{},{preloadEnd:h.metric})});case Tt.KEY_METRIC_JOIN_END:return Me(Me({},u),{},{keyMetrics:Me(Me({},u.keyMetrics),{},{joinEnd:h.metric})});case Tt.KEY_METRIC_REQUEST_AP_START:return Me(Me({},u),{},{keyMetrics:Me(Me({},u.keyMetrics),{},{requestAPStart:h.metric})});case Tt.KEY_METRIC_REQUEST_AP_END:return Me(Me({},u),{},{keyMetrics:Me(Me({},u.keyMetrics),{},{requestAPEnd:h.metric})});case Tt.KEY_METRIC_REQUEST_SUA_END:return Me(Me({},u),{},{keyMetrics:Me(Me({},u.keyMetrics),{},{requestSUAEnd:h.metric})});case Tt.KEY_METRIC_BEFORE_CONNECT:return Me(Me({},u),{},{keyMetrics:Me(Me({},u.keyMetrics),{},{beforeConnect:h.metric})});case Tt.KEY_METRIC_PEER_RECEIVER:return Me(Me({},u),{},{keyMetrics:Me(Me({},u.keyMetrics),{},{peerReceiver:h.metric})});case Tt.KEY_METRIC_SIGNAL_CONNECTED:return Me(Me({},u),{},{keyMetrics:Me(Me({},u.keyMetrics),{},{signalConnected:h.metric})});case Tt.KEY_METRIC_JOIN_REQ:return Me(Me({},u),{},{keyMetrics:Me(Me({},u.keyMetrics),{},{joinReq:h.metric})});case Tt.KEY_METRIC_JOIN_REP:return Me(Me({},u),{},{keyMetrics:Me(Me({},u.keyMetrics),{},{joinRep:h.metric})});case Tt.KEY_METRIC_JOIN_GATEWAY_START:return Me(Me({},u),{},{keyMetrics:Me(Me({},u.keyMetrics),{},{joinGatewayStart:h.metric})});case Tt.KEY_METRIC_JOIN_GATEWAY_END:return Me(Me({},u),{},{keyMetrics:Me(Me({},u.keyMetrics),{},{joinGatewayEnd:h.metric})});case Tt.KEY_METRIC_PEER_CONNECTION_START:return Me(Me({},u),{},{keyMetrics:Me(Me({},u.keyMetrics),{},{peerConnectionStart:h.metric})});case Tt.KEY_METRIC_PEER_CONNECTION_END:return Me(Me({},u),{},{keyMetrics:Me(Me({},u.keyMetrics),{},{peerConnectionEnd:h.metric})});case Tt.KEY_METRIC_DESCRIPTION_START:return Me(Me({},u),{},{keyMetrics:Me(Me({},u.keyMetrics),{},{descriptionStart:h.metric})});case Tt.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Me(Me({},u),{},{keyMetrics:Me(Me({},u.keyMetrics),{},{signalChannelOpen:h.metric})});case Tt.KEY_METRIC_ICE_CONNECTION_END:return Me(Me({},u),{},{keyMetrics:Me(Me({},u.keyMetrics),{},{iceConnectionEnd:h.metric})});case Tt.KEY_METRIC_PUBLISH:{let m=u.keyMetrics.publish,g=m.findIndex(y=>y.trackId===h.metric.trackId);return g!==-1?(m[g]=Me(Me({},m[g]),h.metric),Me(Me({},u),{},{keyMetrics:Me(Me({},u.keyMetrics),{},{publish:[...m]})})):Me(Me({},u),{},{keyMetrics:Me(Me({},u.keyMetrics),{},{publish:[...u.keyMetrics.publish,h.metric]})})}case Tt.KEY_METRIC_SUBSCRIBE:{let m=u.keyMetrics.subscribe,g=m.findIndex(y=>y.userId===h.metric.userId&&y.type===h.metric.type);return g!==-1?(m[g]=Me(Me({},m[g]),h.metric),Me(Me({},u),{},{keyMetrics:Me(Me({},u.keyMetrics),{},{subscribe:[...m]})})):Me(Me({},u),{},{keyMetrics:Me(Me({},u.keyMetrics),{},{subscribe:[...u.keyMetrics.subscribe,h.metric]})})}case Tt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{let m=u.keyMetrics.firstVideoFrameDecoded,g=m.findIndex(y=>y.userId===h.metric.userId);return g!==-1?(m[g]=Me(Me({},m[g]),h.metric),Me(Me({},u),{},{keyMetrics:Me(Me({},u.keyMetrics),{},{firstVideoFrameDecoded:[...m]})})):Me(Me({},u),{},{keyMetrics:Me(Me({},u.keyMetrics),{},{firstVideoFrameDecoded:[...u.keyMetrics.firstVideoFrameDecoded,h.metric]})})}case Tt.RESET_FIRST_VIDEO_FRAME_DECODED:return u.keyMetrics.firstVideoFrameDecoded=[],u;case Tt.SET_CLOUD_PROXY_SERVER_MODE:return u.cloudProxyServerMode=h.mode,u;case Tt.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?u.joinChannelServiceRecords=[...u.joinChannelServiceRecords,h.record]:(u.joinChannelServiceRecords[h.index]=Me(Me({},u.joinChannelServiceRecords[h.index]),h.record),u.joinChannelServiceRecords=[...u.joinChannelServiceRecords]),u;case Tt.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return u.joinChannelServiceRecords=[],u;case Tt.RESET_KEY_METRICS:return u.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},u;case Tt.SET_USE_P2P:return Me(Me({},u),{},{useP2P:h.val});case Tt.SET_TRANSPORT_TYPE:return Me(Me({},u),{},{p2pTransport:h.val});case Tt.SET_RTE_URL:return Me(Me({},u),{},{rteUrl:h.rteUrl});case Tt.SET_RTE_SID:return Me(Me({},u),{},{rteSid:h.rteSid});default:return u}})(this.state,c)}get useDcSignal(){return this.state.useDcSignal}set useDcSignal(c){this.state.useDcSignal=c}set autoSubscribe(c){this.state.autoSubscribe=c}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(c){this.state.enableInstantMuteRestore=c}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set networkQualityProbe(c){this.state.networkQualityProbe=c}get networkQualityProbe(){return this.state.networkQualityProbe}set sessionId(c){this.dispatch({type:Tt.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set rteUrl(c){this.dispatch({type:Tt.SET_RTE_URL,rteUrl:c})}get rteUrl(){return this.state.rteUrl}set rteSid(c){this.dispatch({type:Tt.SET_RTE_SID,rteSid:c})}get rteSid(){return this.state.rteSid}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:Tt.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:Tt.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:Tt.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:Tt.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:Tt.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:Tt.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:Tt.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:Tt.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:Tt.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Tt.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:Tt.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:Tt.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:Tt.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Tt.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Tt.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:Tt.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:Tt.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:Tt.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:Tt.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:Tt.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:Tt.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Tt.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Tt.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Tt.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Tt.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(c,u){this.dispatch({type:Tt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:Me({userId:c},u)})}descriptionStart(){this.dispatch({type:Tt.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Tt.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Tt.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,u,h,m){this.dispatch({type:Tt.KEY_METRIC_PUBLISH,metric:Me(Me({trackId:c,type:u},h&&{publishStart:h}),m&&{publishEnd:m})})}subscribe(c,u,h,m,g,y,v){this.dispatch({type:Tt.KEY_METRIC_SUBSCRIBE,metric:Me(Me(Me(Me(Me({userId:c,type:u},h&&{subscribeStart:h}),m&&{subscribeEnd:m}),g&&{firstFrame:g}),y&&{streamAdded:y}),v&&{firstDecoded:v})})}massSubscribe(c,u,h,m){c.forEach(g=>{this.dispatch({type:Tt.KEY_METRIC_SUBSCRIBE,metric:Me(Me(Me({userId:g.userId,type:g.type},u&&{subscribeStart:u}),h&&{subscribeEnd:h}),m&&{firstFrame:m})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,u){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof u!="number"?(this.dispatch({type:Tt.RECORD_JOIN_CHANNEL_SERVICE,record:Me(Me({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(u<0||u>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Tt.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:u}),u)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Tt.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Tt.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:Tt.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId,z("SIGNAL_CHANNEL")===1),this._leaveMutex=new ki("client-leave",this._clientId),this._publishMutex=new ki("client-publish",this._clientId),this._renewTokenMutex=new ki("client-renewtoken",this._clientId),this._subscribeMutex=new ki("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),k.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Ja," build: ").concat(Pk,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{gk(e.clientRoleOptions),r=Object.assign({},e.clientRoleOptions)}catch(c){k.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var o;this._statsCollector=new $T(this.store),this._statsCollector.onStatsException=(c,u,h)=>{k.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(u,", uid: ").concat(h)),c===LD.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(m=>{m instanceof Gb&&z("ENABLE_ENCODE_EXCEPTION")&&m.findClosestProfile()}),this.safeEmit(zt.EXCEPTION,{code:c,msg:u,uid:h})},this._statsCollector.onUploadPublishDuration=(c,u,h,m)=>{let g=this._users.find(y=>y.uid===c);g&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(g.uid,{peerPublishDuration:h,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(g)),tt.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:u,videoPublishDuration:h,peer:g._uintid}))},this._statsCollector.onVideoCodecChanged=c=>{if(z("VIDEO_STANDARD_BITRATE_VERSION")&&(c==="av1"||c==="h265"||c==="h264")){let u=this.localTracks.find(h=>h instanceof jn);u&&u._saveEncodeBitrateRatio!==1&&u.setSaveEncodeBitrateRatio(c==="h264"?z("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new Hhe(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Kr,httpRetryConfig:e.httpRetryConfig||Kr,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:r}),this._configDistribute=new tpe(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(o={store:this.store,statsCollector:this._statsCollector},Yl("P2PChannel").create(o)),this._handleP2PEvents()):this._p2pChannel=new Zm(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,r,o,c){let u=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Ln("JOIN_GATEWAY_USE_443PORT_ONLY",u),Ln("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);let m=this._gateway.signal.websocket;return m instanceof gD&&(m.use443PortOnly=u,m.tryDoubleDomain=h),(async function(g,y,v){Tb.get(g)||Tb.set(g,[]),wb.get(g)||wb.set(g,y),qu.get(g)||qu.set(g,0);let R=Tb.get(g),b=wb.get(g);if(!R||!b)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(qu.get(g)===b){let K=OT();R.push(K),await K.promise}qu.set(g,qu.get(g)+1);for(var A=arguments.length,F=new Array(A>3?A-3:0),M=3;M<A;M++)F[M-3]=arguments[M];let j=await v(...F);return qu.set(g,qu.get(g)-1),qu.get(g)===b-1&&R.length>0&&(R[0].resolve(),R.shift()),qu.get(g)===0&&(Tb.set(g,[]),wb.set(g,0),qu.set(g,0)),j})("client.join",z("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,r,o,c)}async join(e,t,r,o,c){let u=++this._numberOfJoinCount;this.store.joinStart(),o&&(this.store.uid=o);let h=(Ob||Ob||(Ob=(window.location.protocol.split(":")[0]||"").toUpperCase(),Ob))==="HTTPS",m=f5()?window.isSecureContext:"Browser Not Support";(!f5()&&!h||!window.isSecureContext)&&k.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let g;tt.setAppId(e);try{if(!r&&r!==null)throw new he(Y.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));if(r&&Hi(r,"token",1,2047),Hi(e,"appid",1,2047),eI(t),o&&tI(o),c)if(typeof c=="string")Hi(c,"optionalInfo",1,256),g=c;else{if(typeof c!="object")throw new he(Y.INVALID_PARAMS,"Invalid options: options is not a string or object");{let{autoSubscribe:j,enableInstantMuteRestore:K,networkQualityProbe:q}=c;j&&(Wc(j,"autoSubscribe"),k.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(j)),this.store.autoSubscribe=j),K&&(Wc(K,"enableInstantMuteRestore"),k.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(K)),this.store.enableInstantMuteRestore=K),q&&(Wc(q,"networkQualityProbe"),k.info("[".concat(this._clientId,"] join: networkQualityProbe: ").concat(q)),this.store.networkQualityProbe=q)}}}catch(j){throw tt.reportApiInvoke(Um(),{name:ar.JOIN,options:[e,t,r,o],states:{isHttps:h,isSecureContext:m},tag:Fn.TRACER}).onError(j),j}if(this._leaveMutex.isLocked&&(k.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),k.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){let j=new he(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw tt.reportApiInvoke(Um(),{name:ar.JOIN,options:[e,t,r,o],states:{isHttps:h,isSecureContext:m},tag:Fn.TRACER}).onError(j),j}this._gateway.state="CONNECTING",this.store.preloadStart();let y=await QD({appId:e,cname:t,uid:o,stringUid:typeof o=="string"?o:void 0,token:r||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new he(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));let v=y?.sid||Um();k.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(u)),this._sessionId||(this._sessionId=v,this.store.sessionId=this._sessionId);let R=tt.reportApiInvoke(this._sessionId,{id:this._clientId,name:ar.JOIN,options:[e,t,r,o],states:{isHttps:h,isSecureContext:m},tag:Fn.TRACER}),b=Qc(Qc(Qc({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:r||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:g,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!y},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:z("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(b.setLocalAPVersion=this._setLocalAPVersion),typeof o=="string"&&(b.stringUid=o,this._uintUid?(b.uid=this._uintUid,this._uintUid=void 0):b.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(b.aesmode=this._encryptionMode,b.aespassword=await(async j=>{let K=(function(oe){let te=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),de=new Uint8Array(new ArrayBuffer(te.length));for(let Ce=0;Ce<te.length;Ce+=1)de[Ce]=te.charCodeAt(Ce);return de})(),q=await window.crypto.subtle.importKey("spki",K,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),Q=fk(j),se=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},q,Q);return(function(oe){let te="";for(let de=0;de<oe.length;de+=1)te+=String.fromCharCode(oe[de]);return window.btoa(te)})(new Uint8Array(se))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new he(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(b.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){let j=new TextEncoder,K=z("USE_PURE_ENCRYPTION_MASTER_KEY")?j.encode(b.appId+this._encryptionSecret+this._encryptionSecret):j.encode(b.appId+b.cname+this._encryptionSecret);this._encryptDataStreamIv=await(async function(q,Q,se){let oe=await window.crypto.subtle.importKey("raw",Q,"PBKDF2",!1,["deriveBits","deriveKey"]),te=q==="aes-128-gcm2"?128:256,de=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:C5,hash:"SHA-256",salt:se},oe,te+Tde);return new Uint8Array(de).subarray(te/8)})(this._encryptionMode,K,Mm(this._encryptionSalt)),this._encryptDataStreamKey=await(async function(q,Q,se){let oe=await window.crypto.subtle.importKey("raw",Q,"PBKDF2",!1,["deriveBits","deriveKey"]),te=q==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:C5,hash:"SHA-256",salt:se},oe,{name:"AES-GCM",length:te},!0,["encrypt","decrypt"])})(this._encryptionMode,K,Mm(this._encryptionSalt))}else m?k.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):k.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,k.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:b.stringUid});let A=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&A===this._sessionId&&tt.joinChannelTimeout(this._sessionId,5)},5e3);try{var F;let j,K=b.cloudProxyServer;if(ke(F=["proxy3","proxy4","proxy5"]).call(F,K)){let te=z("PROXY_SERVER_TYPE3");Array.isArray(te)?b.proxyServer=te[0]:b.proxyServer=te}if(tt.setProxyServer(b.proxyServer),k.setProxyServer(b.proxyServer),this.store.requestAPStart(),y){if(k.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(b.stringUid?", ".concat(b.stringUid," => ").concat(y.intUid):""," ")),b.stringUid&&!b.uid&&(b.uid=y.intUid),j={gatewayInfo:y.ap.gatewayInfo},z("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&b.turnServer.mode==="auto")if(y.ap.proxyInfo.addresses.length===0)k.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{let te=(await hG(y.ap.proxyInfo,y.ap.gatewayInfo.uid)).map(de=>({turnServerURL:de.address,tcpport:de.tcpport||ns.tcpport,udpport:de.udpport||ns.udpport,username:de.username||ns.username,password:de.password||ns.password,forceturn:!1,security:!0}));b.turnServer={mode:"manual",servers:te}}v8(y,b.stringUid)}else{if(b.stringUid&&!b.uid){let te;[te,j]=await ze.all([jG(b.stringUid,b,this._axiosCancelSource.token,this._config.httpRetryConfig||Kr,this.store).finally(()=>{this.store.requestSUAEnd()}),FG(b,this._axiosCancelSource.token,this._config.httpRetryConfig||Kr,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),k.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(b.stringUid," => ").concat(te)),b.uid=te,j.gatewayInfo.uid=te,j.gatewayInfo.res.uid=te}else j=await FG(b,this._axiosCancelSource.token,this._config.httpRetryConfig||Kr,!0,this.store);if(!this._joinAndNotLeaveYet)throw new he(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(b,this._axiosCancelSource.token),this._configDistribute.on(zl.UPDATE_BITRATE_LIMIT,te=>{this._p2pChannel.updateBitrateLimit(te)}),this._configDistribute.on(zl.UPDATE_CLIENT_ROLE_OPTIONS,te=>{this._setClientRoleOptions(te)}),this._configDistribute.on(zl.UPDATE_REMOTE_VIDEO_STREAM_TYPE,te=>{var de;ke(de=[0,1,4,5,6,7,8,9]).call(de,te)&&(this.remoteUsers.forEach(Ce=>{this._remoteStreamTypeCacheMap.get(Ce.uid)!==te&&this.setRemoteVideoStreamType(Ce.uid,te)}),this.setRemoteDefaultVideoStreamType(te))}),this._configDistribute.on(zl.FALLBACK_TO_HLS,te=>{te&&this.safeEmit(zt.FALLBACK_TO_HLS,_k.CONFIG)}),this._configDistribute.on(zl.UPDATE_VOS_CONFIGURE,te=>{this._gateway.setConfigure(te).catch(de=>{k.debug("[".concat(this._clientId,"] auto set vos config failed"),de)})})},0),this._key=r||e;let q=j.gatewayInfo,Q=b.uid?b.uid:q.uid;this._joinInfo=Qc(Qc({},b),{},{cid:q.cid,uid:Q,vid:q.vid,apResponse:q.res,apGatewayAddress:q.apGatewayAddress,uni_lbs_ip:q.uni_lbs_ip,gatewayAddrs:q.gatewayAddrs}),this.store.intUid=Q,this.store.cid=q.cid;let se=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new he(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));R.onSuccess(se),this._appId=e,this._channelName=b.cname,this._uid=se,this.store.uid=se,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),!Pi()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(Pi()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);let oe=b.stringUid?"string uid: ".concat(b.stringUid,",uid: ").concat(b.uid):"uid: ".concat(this._uid);return k.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(oe)),setTimeout(()=>{k.startUpload()},5e3),this.store.joinEnd(),M=this,ke(Km).call(Km,M)||Km.push(M),this._cloudProxyServerMode==="disabled"&&Qt().supportWebCrypto&&z("ENABLE_PRELOAD")&&ex(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0),this._sessionId&&tt.reportRteDetail(this._sessionId),this._rteDetailInterval=window.setInterval(()=>{this._sessionId&&tt.reportRteDetail(this._sessionId)},z("RTE_DETAIL_REPORT_INTERVAL")||6e4),se}catch(j){let K=Array.isArray(j)?j[0]:j;throw K&&K.code===Y.OPERATION_ABORTED?k.warning("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),K):k.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),K),K.code!==Y.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),R.onError(K),K}var M}async _joinGateway(){if(!this._joinInfo||!this._key)throw new he(Y.INVALID_OPERATION);try{return await this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!z("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}catch(e){if(e.code===Y.INIT_DATACHANNEL_TIMEOUT){if(this._gateway.leave(!0,tn.FALLBACK),k.debug("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new he(Y.INVALID_OPERATION);return tt.reportApiInvoke(this._sessionId,{name:ar.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:Fn.TRACER}).onSuccess(),await this._joinGateway()}throw e}}async leave(){k.info("[".concat(this._clientId,"] Leaving channel"));let e=()=>{!Pi()&&this.store.useDcSignal?(window.addEventListener("beforeunload",this._handleBeforeUnload),window.addEventListener("pagehide",this._handleBeforeUnload)):window.addEventListener(Pi()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),(function(r){let o=Km.indexOf(r);o!==-1&&Km.splice(o,1)})(this),this._statsCollector.stopUpdateStats()};this.store.useDcSignal||e();let t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return k.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",tn.LEAVE),k.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t(),this.store.useDcSignal&&e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof FE))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new he(Y.INVALID_PARAMS,"param list is empty");let r=e;if(this._gateway.role==="audience")throw new he(Y.INVALID_OPERATION,"audience can not publish stream");for(let c of r){if(!(c instanceof FE))throw new he(Y.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&t)throw new he(Y.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}k.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(r.map(c=>"".concat(c.getTrackId()," "))));let o=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&r.forEach(c=>{let u=this._configDistribute.getBitrateLimit();c instanceof jn&&u&&c.setBitrateLimit(u.uplink)});try{await this._publishHighStream(r),k.info("[".concat(this._clientId,"] Publish success, id ").concat(r.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw k.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{o()}}async _publishDataChannel(e){if(e==null)throw new he(Y.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));Vn(e.id,"id",0,65535,!0),Wc(e.ordered,"ordered"),Hi(e.metadata,"metadata",0,512),k.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));let t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===e.id)!==-1)throw new he(Y.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new he(Y.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&z("FORCE_TURN")&&!z("TURN_ENABLE_TCP")&&!z("TURN_ENABLE_UDP"))throw new he(Y.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");let r=(function(c){return NG(c,!1)})(e),o=await this._p2pChannel.publishDataChannel([r]);if(o.length>0){if(typeof r._originDataChannelId!="number")throw k.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new he(Y.CREATE_DATACHANNEL_ERROR);try{await ze.all(o.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await r._waitTillOpen()}catch(c){if(c.code!==Y.DISCONNECT_P2P)throw c}}return k.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(r.id)),r}catch(r){throw k.error("[".concat(this._clientId,"] publish datachannels error"),r.toString()),r}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new he(Y.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof FE))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);k.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(o=>"".concat(o.getTrackId()," "))," "));let r=await this._publishMutex.lock();try{if(this.store.useP2P){let o=await this._p2pChannel.unpublish(t);o&&await this._gateway.sendExtensionMessage(Fr.UNPUBLISH,{unpubMsg:o},!0)}else{let o=await this._p2pChannel.unpublish(t);o&&await this._gateway.unpublish(o,this._uid),k.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(c=>"".concat(c.getTrackId()))))}}catch(o){throw k.error("[".concat(this._clientId,"] unpublish error"),o.toString()),o}finally{r&&r()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),k.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(r=>"".concat(r.id," "))," "));let t=await this._publishMutex.lock();try{let r=await this._p2pChannel.unpublishDataChannel(e);r&&await this._gateway.unpublishDataChannel(r),k.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(o=>"".concat(o.id))))}catch(r){throw k.error("[".concat(this._clientId,"] unpublish dataChannel error"),r.toString()),r}finally{t&&t()}}async subscribe(e,t,r){if(!(e instanceof bp)){let o=this.remoteUsers.find(c=>c.uid===e);if(!o)throw new he(Y.INVALID_REMOTE_USER,"user is not in the channel");e=o}return t==="datachannel"?this._subscribeDataChannel(e,r):this._subscribe(e,t)}async presubscribe(e,t){if(zr(t,"mediaType",["audio","video"]),this.store.useP2P)throw new he(Y.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new he(Y.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));let r=t===et.AUDIO,o=t===et.VIDEO,c=await this._subscribeMutex.lock();try{let{ssrcId:u,ortc:h,rtxSsrcId:m,cname:g,uint_id:y}=await this._gateway.presubscribe(e,t,!0);if(u==null)throw new he(Y.UNEXPECTED_RESPONSE,"no ssrc id");let v=this._users.find(b=>b.uid===e);v||(v=new bp(e,y||e),v._is_pre_created=!0,this._users.push(v)),g&&(v._cname=g),v._uintid||(v._uintid=y||e),r&&(v._audioSSRC=u,v._audio_pre_subscribed=!0,h&&(v._audioOrtc=h)),o&&(v._videoSSRC=u,v._video_pre_subscribed=!0,h&&(v._videoOrtc=h),m!=null&&(v._rtxSsrcId=m)),k.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(u)),await this._p2pChannel.subscribe(v,t,u,m,h);let R=r?v._audioTrack:v._videoTrack;if(!R)throw new he(Y.UNEXPECTED_ERROR,"can not find remote track in user");return r&&(v._trust_audio_stream_added_state_=!0,v._audio_added_=!0),o&&(v._trust_video_stream_added_state_=!0,v._video_added_=!0),R}catch(u){throw k.error("[".concat(this._clientId,"] presub user ").concat(e," error"),u),u}finally{c()}}async _subscribeDataChannel(e,t){var r;if(Vn(t,"channelId",0,65535,!0),!this._joinInfo)throw new he(Y.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(h=>h===e))throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new he(Y.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new he(Y.INVALID_REMOTE_USER,"user is not published");let o=(r=e._dataChannels)===null||r===void 0?void 0:r.find(h=>h.id===t);if(!o)throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new he(Y.REMOTE_USER_IS_NOT_PUBLISHED);let c=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{let h=await this._p2pChannel.subscribeDataChannel(e,[o]);if(h&&ke(h).call(h,o.id))try{var u;if(typeof o._originDataChannelId!="number")throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new he(Y.CREATE_DATACHANNEL_ERROR);let m={id:o.id,datachannelId:o._originDataChannelId,ordered:o.ordered,maxRetransmits:o.maxRetransmits,metadata:(u=o.metadata)!==null&&u!==void 0?u:""};await this._gateway.subscribeDataChannel(e.uid,m,!0),await o._waitTillOpen()}catch(m){if(m?.code!==Y.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[o]),m;await this._p2pChannel.unsubscribeDataChannel(e,[o]),this._p2pChannel.setPendingRemoteDataChannel(e,o.id)}return k.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),o}finally{c()}}async _p2pSubscribe(e,t,r){if(zr(t,"mediaType",["audio","video"]),!this._joinInfo)throw new he(Y.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(c=>c===e)){let c=new he(Y.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),c}if(!e.hasAudio&&!e.hasVideo){let c=new he(Y.INVALID_REMOTE_USER,"user is not published");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),c}if(!r&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){let c=new he(Y.REMOTE_USER_IS_NOT_PUBLISHED);throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),c}let o=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let u=t==="audio"?e._audioSSRC:e._videoSSRC,h=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,u,h)}catch(u){throw u}k.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(u=>{k.warning("[".concat(this._clientId,"] auto set fallback failed"),u)});let c=t==="audio"?e._audioTrack:e._videoTrack;if(!c)throw new he(Y.UNEXPECTED_ERROR,"can not find remote track in user object");return c}catch(c){throw k.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),c),c}finally{o()}}async _subscribe(e,t,r){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(zr(t,"mediaType",["audio","video"]),!this._joinInfo)throw new he(Y.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(g=>g===e)){let g=new he(Y.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),g}if(!e.hasAudio&&!e.hasVideo){let g=new he(Y.INVALID_REMOTE_USER,"user is not published");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),g}if(!(r||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){let g=new he(Y.REMOTE_USER_IS_NOT_PUBLISHED);throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),g}let o=t==="audio"?e._audioSSRC:e._videoSSRC,c=t==="audio"?e._audioOrtc:e._videoOrtc,u=t==="video"?e._rtxSsrcId:void 0,h={stream_type:t==="audio"?et.AUDIO:et.VIDEO,ssrcId:o};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});let m=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let y=t==="audio"?e._audioSSRC:e._videoSSRC;y!==void 0&&y!==o&&(o=y,c=t==="audio"?e._audioOrtc:e._videoOrtc,u=t==="video"?e._rtxSsrcId:void 0,h={stream_type:t==="audio"?et.AUDIO:et.VIDEO,ssrcId:o}),fs.markSubscribeStart(this.store.clientId,o),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,o,u,c);try{this._p2pChannel.isPreSubScribe(o)||await this._gateway.subscribe(e.uid,h,!0)}catch(v){if(v?.code!==Y.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),v;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(y){throw this._p2pChannel.reportSubscribeEvent(!1,y?.code,e,t),y}k.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType!==void 0&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(y=>{k.warning("[".concat(this._clientId,"] auto set fallback failed"),y)});let g=t==="audio"?e._audioTrack:e._videoTrack;if(!g)throw new he(Y.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),g}catch(g){throw k.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),g),g}finally{m()}}async massSubscribe(e){if(eh(e,"subscribeList"),!this._joinInfo)throw new he(Y.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));let t=Date.now(),r=new Map,o=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(m=>{let{user:g,mediaType:y}=m;return"user: ".concat(g?.uid,", mediaType: ").concat(y)}).join("; ")));let c=(e=[...e]).map(m=>{let{user:g,mediaType:y}=m;return{user:g,mediaType:y}}),u=await this._p2pChannel.globalLock();try{var h;for(let g=e.length-1;g>=0;g--){let y=e[g],{user:v,mediaType:R}=y;if(zr(R,"mediaType",["audio","video"]),!v){let F=new he(Y.INVALID_PARAMS,"user property does not exist in subscribeList item");throw k.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),F}if(!this._users.find(F=>F===v)){let F=new he(Y.INVALID_REMOTE_USER,"user is not in the channel");k.error("[".concat(this._clientId,"] can not massSubscribe ").concat(v.uid,", this user is not in the channel")),c[g].error=F,e.splice(g,1);continue}if(R==="audio"&&(!v.hasAudio||v._audioSSRC===void 0)||R==="video"&&(!v.hasVideo||v._videoSSRC===void 0)){let F=new he(Y.REMOTE_USER_IS_NOT_PUBLISHED);k.error("[".concat(this._clientId,"] can not subscribe ").concat(v.uid," with mediaType ").concat(R,", remote user is not published")),c[g].error=F,e.splice(g,1);continue}let b=bi.Video|bi.LwoVideo,A=r.get(v);if(A){if(R==="video"?A&b:A&bi.Audio){e.splice(g,1),k.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(v.uid,", mediaType:").concat(R," twice"));continue}r.set(v,A|(R==="video"?b:bi.Audio))}else r.set(v,R==="video"?b:bi.Audio)}for(let g=e.length-1;g>=0;g--){let y=e[g],{user:v,mediaType:R}=y,b=bi.Video|bi.LwoVideo;if(this._p2pChannel.hasRemoteMedia(v,R)){await this._p2pChannel.unmuteRemoteNoLock(v,R);let A=r.get(v);r.set(v,R==="video"?A^b:A^bi.Audio),e.splice(g,1)}}this.store.massSubscribe(e.map(g=>({userId:g.user.uid,type:g.mediaType})),t);let m=to(h=Array.from(r.entries())).call(h,(g,y)=>{let[v,R]=y;if(R===0)return g;let b={stream_id:v.uid,stream_type:R};return R&bi.Audio&&(b.audio_ssrc=v._audioSSRC),R&bi.Video&&(b.video_ssrc=v._videoSSRC),g.push(b),g},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(y=>{let{user:v,mediaType:R}=y;return{user:v,mediaType:R,ssrcId:R===et.VIDEO?v._videoSSRC:v._audioSSRC,rtxSsrcId:R===et.VIDEO?v._rtxSsrcId:void 0}}));let g=new Map;if(m=m.filter(y=>y.video_ssrc&&!this._p2pChannel.isPreSubScribe(y.video_ssrc)||y.audio_ssrc&&!this._p2pChannel.isPreSubScribe(y.audio_ssrc)||!y.video_ssrc&&!y.audio_ssrc),m.length>0&&((await this._gateway.subscribeAll(m,!0))?.users||[]).forEach(v=>{let{stream_id:R,video_error_code:b,audio_error_code:A,error_code:F}=v;(b||A||F)&&g.set(R,{video_error_code:b,audio_error_code:A,error_code:F})}),Array.from(g.entries()).length>0){let y=[];Array.from(g.entries()).forEach(v=>{let[R,b]=v,A=this.remoteUsers.find(F=>F.uid===R);if(A){let F;b.error_code||b.video_error_code&&b.audio_error_code?F=void 0:b.video_error_code?F=et.VIDEO:b.audio_error_code&&(F=et.AUDIO),y.push({user:A,mediaType:F})}}),y.length>0&&await this._p2pChannel.massUnsubscribeNoLock(y)}for(let y of c){let v=g.get(y.user.uid);if(v){let R=v.error_code||y.mediaType==="audio"&&v.audio_error_code||y.mediaType==="video"&&v.video_error_code;if(R){let b=Xm(R);k.error("user:".concat(y.user.uid," mediaType:").concat(y.mediaType," has massSubscribe error ").concat(b.desc)),y.error=new he(Y.SUBSCRIBE_FAILED,"code ".concat(R,": ").concat(b.desc))}}y.error||(y.mediaType==="video"?y.track=y.user.videoTrack:y.track=y.user.audioTrack)}return this.store.massSubscribe(c.filter(y=>!y.error).map(y=>({userId:y.user.uid,type:y.mediaType})),void 0,Date.now()),c.forEach(y=>{var v;tt.subscribe(this.store.sessionId,{succ:!!y.error,ec:((v=y.error)===null||v===void 0?void 0:v.code)||null,video:y.mediaType===et.VIDEO,audio:y.mediaType===et.AUDIO,peerid:y.user.uid,subscribeRequestid:y.mediaType===et.VIDEO?y.user._videoSSRC:y.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(y.user._videoSSRC)},!0)}),k.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(y=>{let{user:v,mediaType:R}=y;return"user: ".concat(v?.uid,", mediaType: ").concat(R)}).join("; "))),c}catch(g){throw await this._p2pChannel.massUnsubscribeNoLock(e),g}}finally{u(),o()}}async unsubscribe(e,t,r){if(!(e instanceof bp)){let c=this.remoteUsers.find(u=>u.uid===e);if(!c)throw new he(Y.INVALID_REMOTE_USER,"user is not in the channel");e=c}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,r)}else await this._unsubscribeDataChannel(e,r);if(t&&zr(t,"mediaType",["audio","video"]),!this._joinInfo)throw new he(Y.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(c=>c===e)){let c=new he(Y.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}k.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));let o=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{let c=await this._p2pChannel.unsubscribe(e,t);c&&await this._gateway.unsubscribe(c,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&bb(this._users,e),k.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(c){if(c.code===Y.DISCONNECT_P2P)return void k.warning("disconnecting p2p, abort unsubscribe request.");throw k.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}finally{o()}}async _unsubscribeDataChannel(e,t){if(t&&Vn(t,"id",0,65535,!0),!this._joinInfo)throw new he(Y.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(o=>o===e)){let o=new he(Y.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),o}let r;if(typeof t=="number"){let o=e._dataChannels.find(c=>c.id===t);o&&(r=[o])}else r=e._dataChannels;if(r===void 0){let o=new he(Y.REMOTE_USER_IS_NOT_PUBLISHED);throw k.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),o}k.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map(o=>o.id)));try{let o=await this._p2pChannel.unsubscribeDataChannel(e,r);o&&await this._gateway.unsubscribeDataChannel(o,e.uid),k.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(o))}catch(o){if(o.code===Y.DISCONNECT_P2P)return void k.warning("disconnecting p2p, abort unsubscribe request.");throw k.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),o.toString()),o}}async massUnsubscribe(e){if(eh(e,"unsubscribeList"),!this._joinInfo)throw new he(Y.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");k.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(r=>{let{user:o,mediaType:c}=r;return"user: ".concat(o?.uid,", mediaType: ").concat(c,";")}).join())),e=[...e];let t=new Map;for(let r=e.length-1;r>=0;r--){let{user:o,mediaType:c}=e[r];if(!o){let h=new he(Y.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw k.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),h}if(zr(c,"mediaType",["video","audio",void 0]),!this._users.find(h=>h===o)){k.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),e.splice(r,1);continue}let u=bi.Video|bi.LwoVideo;if(t.has(o)){let h=t.get(o),m;switch(c){case"video":m=h&u;break;case"audio":m=h&bi.Audio;break;default:m=h&(bi.Audio|u)}if(m){k.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(o.uid,",mediaType:").concat(c," twice.")),e.splice(r,1);continue}c?c==="audio"?t.set(o,h|bi.Audio):c==="video"&&t.set(o,h|u):t.set(o,h|bi.Audio|u)}else c?c==="audio"?t.set(o,bi.Audio):c==="video"&&t.set(o,u):t.set(o,bi.Audio|u)}try{let r=await this._p2pChannel.massUnsubscribe(e);r&&await this._gateway.massUnsubscribe(r),k.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(o=>{let{user:c,mediaType:u}=o;return"user: ".concat(c?.uid,", mediaType: ").concat(u,";")}).join()))}catch(r){if(r.code===Y.DISCONNECT_P2P)return void k.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw k.error("[".concat(this._clientId,"] massUnsubscribe error"),r.toString()),r}}async setLowStreamParameter(e){(function(r){if(!r)throw new _e(Y.INVALID_PARAMS);wr(r.width)||hk(r.width,"streamParameter.width"),wr(r.height)||hk(r.height,"streamParameter.height"),wr(r.framerate)||hk(r.framerate,"streamParameter.framerate"),wr(r.bitrate)||Vn(r.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&k.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),k.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));let t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,xe.LocalVideoLowTrack)}async setDualStreamMode(e,t){zr(e,"mode",[0,1,-1]);try{switch(t&&await this.setLowStreamParameter(t),this._dualStreamMode=e,this._joinInfo?this._gateway.setDualStreamMode(e).catch(r=>{k.warning("[".concat(this._clientId,"] set dual stream mode failed"),r.toString())}):k.debug("[".concat(this._clientId,"] haven't joined yet, cache dual stream mode ").concat(e)),e){case AE.AUTO_SIMULCAST_STREAM:k.info("[".concat(this._clientId,"] set dual stream mode to ").concat(e));break;case AE.DISABLE_SIMULCAST_STREM:return this.disableDualStream();case AE.ENABLE_SIMULCAST_STREAM:return this.enableDualStream()}}catch(r){throw k.error("[".concat(this._clientId,"] set dual stream mode error"),r.toString()),r}}async enableDualStream(){if(!Qt().supportDualStream)throw tt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new he(Y.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new he(Y.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw tt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,this._dualStreamMode=AE.ENABLE_SIMULCAST_STREAM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(e=>{k.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),e.toString())}),tt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),k.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)return this._isDualStreamEnabled=!1,void k.info("[".concat(this._clientId,"] disable dual stream before join"));if(this._p2pChannel.getLocalMedia(xe.LocalVideoLowTrack))try{let e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw tt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,this._dualStreamMode=AE.DISABLE_SIMULCAST_STREM,this._joinInfo&&this._gateway.setDualStreamMode(this._dualStreamMode,!0,!0).catch(e=>{k.debug("[".concat(this._clientId,"] try to inform gateway to set dual stream mode to ").concat(this._dualStreamMode," ,but failed"),e.toString())}),tt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),k.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if((function(o){zr(o,"role",["audience","host"])})(e),t&&gk(t),this.mode==="rtc"||this.mode==="p2p")throw k.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new he(Y.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new he(Y.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new he(Y.INVALID_OPERATION,"can not set client role to audience when publishing stream");let r=this._config.role;if(this._joinInfo&&(this._joinInfo.role=e),e!==r&&z("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",ts.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),k.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level)),r==="audience"&&e!=="audience"&&this._pendingRtpCapabilityChange&&this._p2pChannel instanceof Zm){let{video_codec:o}=this._pendingRtpCapabilityChange;this._p2pChannel.updateRemoteRTPCapabilities(o.map(c=>c.toLowerCase()).filter(c=>{var u;return ke(u=Object.keys(Fm)).call(u,c)}))}}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&gk(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{k.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;let t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;let r=t.timestamp-Date.now();return Math.abs(r)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?r:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(Hi(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new he(Y.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new he(Y.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,tt.setProxyServer(this._proxyServer),k.setProxyServer(this._proxyServer),k.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new he(Y.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new he(Y.INVALID_OPERATION,"You have already set the proxy")}if(km(e))return this._turnServer={servers:e,mode:"original-manual"},void k.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(r=>r.urls).join(","),"."));e.forEach(r=>n5(r)),this._turnServer={servers:e,mode:"manual"},k.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new he(Y.INVALID_OPERATION,"you should set license before join channel");if(Hi(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new he(Y.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,k.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new he(Y.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new he(Y.INVALID_OPERATION,"You have already set the proxy");let t=[3,4,5],r;switch(e===void 0&&(e=3),e){case 1:case 2:throw new he(Y.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:r="proxy3";break;case 4:r="proxy4";break;case 5:r="proxy5";break;default:throw new he(Y.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=r,this.store.cloudProxyServerMode=r,k.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new he(Y.INVALID_OPERATION,"Stop proxy server after leave channel");tt.setProxyServer(),k.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",k.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new he(Y.INVALID_PARAMS,"accessPoints is required.");eh(e.accessPoints.serverList,"accessPoints.serverList"),Hi(e.accessPoints.domain,"accessPoints.domain");let t=(b,A)=>{Vn(b,A,0,65535,!0)},r=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),r=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new he(Y.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");z("CLOSE_AFB_FOR_LOCAL_AP")&&(Ln("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Ln("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));let o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=e.accessPoints.domain,u=e.accessPoints.serverList.map(b=>o.test(b)?"".concat(b.replace(/\./g,"-"),".").concat(c):b),h=u.map(b=>"".concat(b,":").concat(r));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Ln("WEBCS_DOMAIN",h),Ln("WEBCS_DOMAIN_BACKUP_LIST",h),Ln("GATEWAY_DOMAINS",[c]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(eh(e.report.hostname,"report.hostname"),Ln("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Ln("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Ln("EVENT_REPORT_DOMAIN",u[0]),Ln("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let m=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),m=e.report.port),Ln("STATS_COLLECTOR_PORT",m),e.report?Ln("ENABLE_EVENT_REPORT",!0):Ln("ENABLE_EVENT_REPORT",!1);let g="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(eh(e.log.hostname,"log.hostname"),g=e.log.hostname[0]):g=u[0];let y=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),y=e.log.port),Ln("LOG_UPLOAD_SERVER","".concat(g,":").concat(y));let v=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(eh(e.cds.hostname,"cds.hostname"),v=e.cds.hostname):v=u;let R=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),R=e.cds.port),Ln("CDS_AP",v.map(b=>"".concat(b,":").concat(R))),e.cds?Ln("ENABLE_CONFIG_DISTRIBUTE",!0):Ln("ENABLE_CONFIG_DISTRIBUTE",!1),k.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(eh(e,"serverList"),Hi(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new he(Y.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let r=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(o=>r.test(o)?"".concat(o.replace(/\./g,"-"),".").concat(t):o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Ln("WEBCS_DOMAIN",e),Ln("WEBCS_DOMAIN_BACKUP_LIST",e),Ln("GATEWAY_DOMAINS",[t]),Ln("EVENT_REPORT_DOMAIN",e[0]),Ln("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Ln("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),k.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(zr(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw k.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else k.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){zr(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{let r=this._users.find(o=>o.uid===e);r&&r.videoTrack&&r.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(r){throw k.error("[".concat(this._clientId,"] set remote video stream type error"),r.toString()),r}k.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){zr(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(r){throw k.error("[".concat(this._clientId,"] set stream fallback option"),r.toString()),r}k.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,r,o){(function(u){zr(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Hi(t,"secret");let c=["aes-128-gcm2","aes-256-gcm2"];if(ke(c).call(c,e)){if(!r||!(r instanceof Uint8Array&&r.length===32))throw new he(Y.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(r)throw new he(Y.INVALID_PARAMS,"current encrypt mode does not need salt");if(o){if(Wc(o,"encryptDataStream"),!ke(c).call(c,e))throw new he(Y.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||k.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,r&&(this._encryptionSalt=yp(r))}async renewToken(e){if(Hi(e,"token",1,2047),!this._key||!this._joinInfo)throw new he(Y.INVALID_OPERATION,"renewToken should not be called before user join");let t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);let r=await this._renewTokenMutex.lock();try{if(z("USE_NEW_TOKEN")){k.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));let o=await epe(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Kr);k.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:o})}else k.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});k.debug("[".concat(this._clientId,"] renewToken success"))}catch(o){throw this._key=t,this._joinInfo.token=t,k.error("[".concat(this._clientId,"] renewToken failed"),o.toString()),o}finally{r()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?k.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{let e=this._p2pChannel.getAudioLevels();this.safeEmit(zt.VOLUME_INDICATOR,e)},z("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){let e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new he(Y.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new he(Y.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new he(Y.LIVE_STREAMING_TASK_CONFLICT);let r=t?nh.TRANSCODE:nh.RAW;return this._createLiveStreamingClient(r).startLiveStreamingTask(e,r)}setLiveTranscoding(e){return this._createLiveStreamingClient(nh.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){let t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(r=>r&&r.hasUrl(e));if(!t.length)throw new he(Y.INVALID_PARAMS,"can not find live streaming url to stop");await ze.all(t.map(r=>r&&r.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){KG(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){KG(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof Zm&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new he(Y.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){let c=new TextEncoder;e.payload=c.encode(e.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ke(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(o=!0,e.payload=await(async function(c,u,h){var m;let g=to(m=Array.from(h)).call(m,(M,j)=>M+j,0),y={serverTs:0,seq:wde++,length:h.length,checkSum:g},v=new Uint8Array(d5(g,2)),R=new ArrayBuffer(xE),b=new DataView(R);b.setUint32(0,y.serverTs),b.setUint16(4,y.seq),b.setUint16(6,y.length),b.setUint16(8,y.checkSum);let A=16-h.length%16;h=o5(h,new Uint8Array(A));let F=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:w5,additionalData:v},u,h);return o5(new Uint8Array(R),new Uint8Array(F))})(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new he(Y.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(ct.DATA_STREAM,{payload:yp(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-lpe},!r)}sendMetadata(e){if(!this._joinInfo)throw new he(Y.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new he(Y.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(ct.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:yp(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(kde),!this._joinInfo)throw new he(Y.INVALID_OPERATION,"can not send custom report, not joined");await tt.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){let e=this._statsCollector.getRemoteNetworkQualityStats();if(z("DELETE_NEQ_AFTER_USER_LEAVE")){let t=this._users.map(r=>r.uid+"");Object.keys(e).forEach(r=>{ke(t).call(t,r)||delete e[r]})}return e}getNetworkQuality(){return this._statsCollector.getNetworkQuality()}async pickSVCLayer(e,t){zr(t.spatialLayer,"spatialLayer",[0,1,2,3]),zr(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(r){throw k.error("[".concat(this._clientId,"] pick SVC layer failed"),r.toString()),r}}async setRTMConfig(e){let{apRTM:t=!1,rtmFlag:r}=e;if(Wc(t,"apRTM"),Vn(r,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=r,k.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=r,this._gateway.setRTM2Flag(r)}_reset(){if(k.debug("[".concat(this._clientId,"] reset client")),(function(e){let t=zE.indexOf(e);t!==-1&&zE.splice(t,1)})(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._pendingRtpCapabilityChange=void 0,this._axiosCancelSource.cancel(),this._axiosCancelSource=ao.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&y8(this._joinInfo),this._rteDetailInterval&&(window.clearInterval(this._rteDetailInterval),this._rteDetailInterval=void 0,this._sessionId&&tt.reportRteDetail(this._sessionId)),this._fallbackServerInfo=void 0,this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&tt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new ki("client-publish",this._clientId),this._subscribeMutex=new ki("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var r;let o=e||Um();e?k.debug("[".concat(this._clientId,"] new Session ").concat(o)):k.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(o));let c=e?"":this._sessionId||"";this._sessionId=o,this.store.sessionId=o,tt.addSid(o);let u={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:t?.stringUid||((r=this._joinInfo)===null||r===void 0?void 0:r.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1,rteUrl:this.store.rteUrl,rteSid:this.store.rteSid};tt.sessionInit(this._sessionId,Qc({cname:t.channel,appid:t.appId},u)),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new he(Y.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&z("FORCE_TURN")&&!z("TURN_ENABLE_TCP")&&!z("TURN_ENABLE_UDP"))throw new he(Y.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");k.debug("[".concat(this._clientId,"] publish high stream"));try{let r=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){let o=(await r.next()).value;if(o){try{await this._gateway.sendExtensionMessage(Fr.PUBLISH,o,!0)}catch(c){throw r.throw(c),c}await r.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{let o=(await r.next()).value;if(o){var t;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==Y.DISCONNECT_P2P)throw r.throw(u),u}await r.next(((t=c)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(let c of e)c instanceof jn&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(u=>{k.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r?.code,e),r?.code===Y.WS_ABORT)return;throw r}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new he(Y.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new he(Y.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));k.debug("[".concat(this._clientId,"] publish low stream"));let e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{let r=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await r.next()).value;if(o){var t;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==Y.DISCONNECT_P2P)throw r.throw(u),u}r.next(((t=c)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r?.code,void 0,!0),r?.code===Y.WS_ABORT)return;throw r}}_createLiveStreamingClient(e){let t=()=>{if(!this._joinInfo||!this._appId)return new he(Y.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let r=(o={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Yl("LiveStreaming").create(o));var o;return r.onLiveStreamError=(c,u)=>{tt.reportApiInvoke(this._sessionId,{name:ar.ON_LIVE_STREAM_ERROR,options:[c,u],tag:Fn.TRACER}).onSuccess(),this.safeEmit(zt.LIVE_STREAMING_ERROR,c,u)},r.onLiveStreamWarning=(c,u)=>{tt.reportApiInvoke(this._sessionId,{name:ar.ON_LIVE_STREAM_WARNING,options:[c,u],tag:Fn.TRACER}).onSuccess(),this.safeEmit(zt.LIVE_STREAMING_WARNING,c,u)},r.on(pD.REQUEST_WORKER_MANAGER_LIST,(c,u,h)=>{if(!this._joinInfo)return h(new he(Y.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,g,y,v){let R=z("UAP_AP").slice(0,z("AJAX_REQUEST_CONCURRENT")).map(b=>g.proxyServer?"https://".concat(g.proxyServer,"/ap/?url=").concat(b+"/api/v1?action=uap"):"https://".concat(b,"/api/v1?action=uap"));return await Yhe(R,m,g,y,v)})(c,this._joinInfo,this._axiosCancelSource.token,Kr).then(u).catch(h)}),r};return e===nh.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new he(Y.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){let{sendResolutionWidth:t,sendResolutionHeight:r}=this.getLocalVideoStats(),o=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:r}},Yl("ChannelMediaRelay").create(e));o.on("state",c=>{c===Ao.RELAY_STATE_FAILURE&&o&&o.dispose(),this.safeEmit(zt.CHANNEL_MEDIA_RELAY_STATE,c)}),o.on("event",c=>{this.safeEmit(zt.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=o,this._statsCollector.onStatsChanged=(c,u)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(u))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){let{added:r,deleted:o}=e,c=[];if(t){let u=[];this._users.forEach(h=>{h._dataChannels.forEach(m=>{r.every(g=>g.uid!==h._uintid||g.stream_id!==m.id)&&u.push({uid:h._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})})}),u.length>0&&this._handleUpdateDataChannel({added:[],deleted:u})}Array.isArray(r)&&r.length>0&&r.forEach(u=>{let{uid:h,stream_id:m,ordered:g,max_retrans_times:y,metadata:v}=u,R=this._users.find(b=>b._uintid===h);if(!R)return void k.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(k.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),ke(c).call(c,R)||c.push(R),R._uintid||(R._uintid=h),R._dataChannels.findIndex(b=>b.id===u.stream_id)===-1){let b={id:m,ordered:!!g,maxRetransmits:y,metadata:v},A=(function(F){return NG(F,!0)})(b);R._dataChannels.push(A),k.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published datachannel")),t||this.safeEmit(zt.USER_PUBLISHED,R,"datachannel",b)}this._p2pChannel.hasPendingRemoteDataChannel(R,u.stream_id)&&(k.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(R.uid," after reconnect.")),this._subscribeDataChannel(R,u.stream_id).catch(b=>{k.error("[".concat(this._clientId,"] resubscribe datachannel error"),b.toString())}))}),t&&(this.safeEmit(zt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(o)&&o.length>0&&o.forEach(u=>{let{uid:h,stream_id:m}=u,g=this._users.find(v=>v._uintid===h);if(!g)return void k.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));let y=g._dataChannels.find(v=>v.id===u.stream_id);y&&(k.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(g,[y]).then(v=>{if(g._dataChannels=g._dataChannels.filter(R=>R!==y),v)return this._gateway.unsubscribeDataChannel(v,g.uid)}),k.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(y.id)),this.safeEmit(zt.USER_UNPUBLISHED,g,"datachannel",y._config))})}_getEncodingName(e){var t,r;if(!this._joinResponse)return;let o=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(!o)return;for(let m of o){var c;if(m.payloadType===e)return m==null||(c=m.rtpMap)===null||c===void 0?void 0:c.encodingName}let u=(r=this._joinResponse.ortc.rtpCapabilities.recv)===null||r===void 0?void 0:r.videoCodecs;if(u)for(let m of u){var h;if(m.payloadType===e)return m==null||(h=m.rtpMap)===null||h===void 0?void 0:h.encodingName}return e===0?"unknown":void 0}_handleRemoveDataChannels(e){let t=this._users.find(r=>r.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){k.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));let r=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(o=>{this.safeEmit(zt.USER_UNPUBLISHED,t,"datachannel",o._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(o=>{if(o)return this._gateway.unsubscribeDataChannel(o,t.uid)}),r()}}else k.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Vr.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void k.error("Error loading sdk config",t.message)}if(e)try{let t=JSON.parse(window.atob(e)),r=Date.now();Object.keys(t).forEach(o=>{let{value:c,type:u,expires:h}=t[o];h&&h<=r||u||oD()||!Object.prototype.hasOwnProperty.call(Db,o)||(ma[o]=c,An[o]=c,k.debug("Update gateway parameters from config distribute",o,c))})}catch(t){k.error("Error update config from local cache",t.message)}})()}),this._gateway.on(Vr.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Vr.CONNECTION_STATE_CHANGE,(e,t,r)=>{var o;if(r===tn.FALLBACK)return;let c=()=>{this.safeEmit(zt.CONNECTION_STATE_CHANGE,e,t,r)};if(tt.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:ar.CONNECTION_STATE_CHANGE,options:[e,t,r],tag:Fn.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:r})),k.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void c();if(e==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch(g=>{k.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),g)})}),this._remoteStreamTypeCacheMap.forEach((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch(g=>{k.warning("[".concat(this._clientId,"] auto set remote stream type failed"),g)})}),z("VOS_CONFIGURE")&&Array.isArray(z("VOS_CONFIGURE"))&&z("VOS_CONFIGURE").length>0&&(this._gateway.setConfigure(z("VOS_CONFIGURE")).catch(h=>{k.debug("[".concat(this._clientId,"] auto set vos config failed"),h)}),k.debug("[".concat(this._clientId,"] ws connected auto set vos config"))),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{k.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{k.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this._dualStreamMode&&this._gateway.setDualStreamMode(this._dualStreamMode).catch(h=>{k.warning("[".concat(this._clientId,"] auto set dual stream mode failed"),h)}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{k.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(k.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,et.AUDIO,!1)),h._trust_video_mute_state_||(k.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,et.VIDEO,!1)),h._trust_audio_enabled_state_||(k.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(k.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(k.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(k.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(k.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(Vr.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new he(Y.UNEXPECTED_ERROR,"can not recover, no join info"));try{let r;if(this._fallbackServerInfo)r=this._fallbackServerInfo,this._fallbackServerInfo=void 0,this._joinInfo.preload=!1,tt.reportApiInvoke(this._sessionId,{name:ar.VOS_FALLBACK_CN,options:{cur:r.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!0},tag:Fn.TRACER}).onSuccess(),k.info("[".concat(this._clientId,"] use fallback cn server info"));else{let c=await QD(Qc(Qc({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));c?(r=c.ap,v8(c),this._joinInfo.preload=!0):(r=await gI(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Kr,this.store),this._joinInfo.preload=!1)}this._joinInfo&&(this._joinInfo.apResponse=r.gatewayInfo.res,this._joinInfo.gatewayAddrs=r.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=r.gatewayInfo.uni_lbs_ip);let o=[];r.gatewayInfo.gatewayAddrs.forEach(c=>{let{address:u}=c,[h,m]=u.split(":");this._joinInfo&&this._joinInfo.proxyServer?o.push({proxy:this._joinInfo.proxyServer,host:h,port:m}):o.push({host:h,port:m})}),e(o)}catch(r){t(r)}}),this._gateway.on(Vr.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(zt.NETWORK_QUALITY,e)}),this._gateway.on(Vr.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(zt.STREAM_TYPE_CHANGED,e,t),tt.reportApiInvoke(this._sessionId,{name:ar.STREAM_TYPE_CHANGE,options:[e,t],tag:Fn.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(Vr.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(Vr.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,r)=>{try{let o=await this._p2pChannel.getEstablishParams();o&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(o=await this._p2pChannel.startP2PConnection(e)),t(o)}catch(o){r(o)}}),this._gateway.on(Vr.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let r;this._joinResponse=e,e.attributes?r=e.attributes.userAttributes.preSubSsrcs:k.debug("no attributes in joinResponse");let o=vG(e.ortc,t,r);this._p2pChannel.connect(o)}),this._gateway.on(Vr.PRE_CONNECT_PC,async(e,t,r)=>{let{candidates:o,fingerprint:c,turnServer:u}=e;if(this._joinInfo&&o.length>0&&!this._p2pChannel.isPlanB){let{cert:m,cid:g}=this._joinInfo.apResponse,y="".concat(g,"_").concat(m);if(y.length<4||y.length>256)return void k.debug("[".concat(this._clientId,"] ufrag length is not valid, length: ").concat(y.length));await this._p2pChannel.startP2PConnection({turnServer:u,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var h;t(await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(g,"_").concat(m),icePwd:"".concat(g,"_").concat(m)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(h=z("FINGERPRINT"))!==null&&h!==void 0?h:c}]},candidates:o,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0}))}catch(v){v.code&&v.code===Y.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:u,cloudProxyServer:this._joinInfo.cloudProxyServer},!0),r(v)}}}),this._gateway.on(Vr.VOS_FALLBACK,e=>{e==="fallback_hls"&&this.safeEmit(zt.FALLBACK_TO_HLS,_k.VOSERROR)}),this._gateway.on(Vr.RESET_SIGNAL,()=>{this._p2pChannel instanceof Zm&&this._p2pChannel.fallbackConnection(),this._handleGatewaySignalEvents()}),this._gateway.on(Vr.DATACHANNEL_FAILBACK,()=>{tt.reportApiInvoke(this._sessionId,{name:ar.DATACHANNEL_FAILBACK,options:{},tag:Fn.TRACER}).onSuccess(),this._joinGateway()})}_handleGatewaySignalEvents(){this._gateway.signal.on(wt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(wt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(wt.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(wt.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(wt.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(wt.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(wt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(wt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(wt.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,et.AUDIO,!0)),this._gateway.signal.on(wt.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,et.AUDIO,!1)),this._gateway.signal.on(wt.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,et.VIDEO,!0)),this._gateway.signal.on(wt.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,et.VIDEO,!1)),this._gateway.signal.on(wt.RECEIVE_METADATA,e=>{let t=Mm(e.metadata);this.safeEmit(zt.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(wt.ON_DATA_STREAM,async e=>{var t;if(!e)return;let r=Mm(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ke(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<xE)throw new he(Y.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(xE));r=await(async function(c,u,h){let m=h.subarray(0,xE),g=m.slice(8,xE),y=(g[0]<<8)+g[1],v=(m[6]<<8)+m[7],R=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:c,tagLength:w5,additionalData:new Uint8Array(d5(y,2))},u,h.subarray(xE));return new Uint8Array(R).subarray(0,v)})(this._encryptDataStreamIv,this._encryptDataStreamKey,r)}let o=0;if(e.ordered||e.syncWithAudio){let c=this._p2pChannel.getStats(),u=this.remoteUsers.find(m=>m.uid===e.uid);o=c?.audioRecv.find(m=>m.ssrc===u?._audioSSRC)?.jitterBufferMs}(o==null||Number.isNaN(o))&&(o=0),dpe(Qc(Qc({},e),{},{payload:r}),o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(wt.ON_CRYPT_ERROR,()=>{Ep(()=>{k.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(zt.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(wt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(wt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{k.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,tn.TOKEN_EXPIRE),this.safeEmit(zt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(wt.ON_STREAM_FALLBACK_UPDATE,e=>{k.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(zt.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(wt.ENABLE_MULTI_STREAM,e=>{this._dualStreamMode===AE.AUTO_SIMULCAST_STREAM&&this.enableDualStream().catch(t=>{k.debug("[".concat(this._clientId,"] set dual stream mode error"),t.toString())})}),this._gateway.signal.on(wt.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),k.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(wt.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(wt.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(rt.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case ct.PUBLISH:{if(!t)return;let c=t.ortc;if(c){var r,o;let u=c.some(g=>{let{stream_type:y}=g;return y===On.Audio}),h=c.some(g=>{let{stream_type:y}=g;return y!==On.Audio}),m=c.some(g=>{let{stream_type:y}=g;return y===On.Screen||y===On.ScreenLow});t.state==="offer"&&tt.publish(this._joinInfo.sid,{eventElapse:fs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:Y.TIMEOUT,audio:u,video:h,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:u?(r=c.find(g=>{let{stream_type:y}=g;return y===On.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0,videoName:h?(o=c.find(g=>{let{stream_type:y}=g;return y!==On.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0})}break}case ct.SUBSCRIBE:t&&tt.subscribe(this._joinInfo.sid,{succ:!1,ec:Y.TIMEOUT,audio:t.stream_type===et.AUDIO,video:t.stream_type===et.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:fs.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(wt.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(wt.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;z("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(o=>!Ym(o.string_id||o.stream_id,this.channelName)));let t=[],r=[];for(let o of e.users){let c=this._users.find(v=>v._uintid===o.stream_id);c?c._trust_in_room_=!0:(c=new bp(o.string_id||o.stream_id,o.stream_id),this._users.push(c),this.store.firstVideoFrameDecoded(c.uid,{userJoinNotify:Date.now()}),this.getListeners(zt.PUBLISHED_USER_LIST).length===0&&(k.debug("[".concat(this._clientId,"] user online"),o.stream_id),this.safeEmit(zt.USER_JOINED,c)));let u=bi.Audio&o.stream_type,h=(bi.Video|bi.LwoVideo)&o.stream_type,m=(65280&o.stream_type)!=0,g=u&&c.hasAudio,y=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=o.video_ssrc,c._rtxSsrcId=o.video_rtx),u&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=o.audio_ssrc),u&&!g&&this.getListeners(zt.PUBLISHED_USER_LIST).length===0&&(k.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(zt.USER_PUBLISHED,c,"audio")),h&&!y&&this.getListeners(zt.PUBLISHED_USER_LIST).length===0&&(k.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(zt.USER_PUBLISHED,c,"video")),(u&&!g||h&&!y||m)&&t.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&r.push({user:c,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&r.push({user:c,mediaType:"audio"})}r.length>0&&(k.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(r.map(o=>"user: ".concat(o.user.uid,", mediaType: ").concat(o.mediaType)).join("; ")," ")),this.massSubscribe(r).catch(o=>{k.error("[".concat(this._clientId,"] mass resubscribe error"),o.toString())})),this.getListeners(zt.PUBLISHED_USER_LIST).length>0?z("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(k.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(o=>o.uid).join(", "))),this.safeEmit(zt.PUBLISHED_USER_LIST,t)):k.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(o=>o.uid).join(", ")))}),this._gateway.signal.on(wt.ON_RTP_CAPABILITY_CHANGE,e=>{let{video_codec:t}=e;if(this._p2pChannel instanceof Zm){if(this.role==="audience"&&z("UPDATE_RTP_CAP_IN_HOST"))return this._pendingRtpCapabilityChange=e,void k.debug("[".concat(this._clientId,"] no need to change rtp capability because of audience, params: ").concat(JSON.stringify(e)));this._p2pChannel.updateRemoteRTPCapabilities(t.map(r=>r.toLowerCase()).filter(r=>{var o;return ke(o=Object.keys(Fm)).call(o,r)}))}}),this._gateway.signal.on(rt.VOS_FALLBACK_PROMISE,async(e,t,r)=>{if(e==="FALLBACKCN"&&z("ENABLE_QUALITY_FALLBACK")){if(!this._joinInfo)return r(new he(Y.UNEXPECTED_ERROR,"can not recover, no join info"));k.info("[".concat(this._clientId,"] try fallback to cn, start request new server info"));let c=this._joinInfo.apRequestDetail;try{this._joinInfo.apRequestDetail=e;let u=await gI(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Kr,this.store);if(z("QUALITY_FALLBACK_REHEARSAL"))return tt.reportApiInvoke(this._sessionId,{name:ar.VOS_FALLBACK_CN,options:{cur:u.gatewayInfo.gatewayAddrs,prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:Fn.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=c,void r();this._fallbackServerInfo=u,t()}catch(u){var o;let h=u==null||(o=u.data)===null||o===void 0?void 0:o.desc;z("QUALITY_FALLBACK_REHEARSAL")?(tt.reportApiInvoke(this._sessionId,{name:ar.VOS_FALLBACK_CN,options:{cur:"failed, errorReason: "+h||"unknown",prev:this._joinInfo.gatewayAddrs,is_done:!1},tag:Fn.TRACER}).onSuccess(),this._joinInfo.apRequestDetail=c):Array.isArray(h)&&ke(h).call(h,"request downgrade fallback")&&this.safeEmit(zt.FALLBACK_TO_HLS,_k.AP_ERROR),r(u)}}else r()})}_handleP2PEvents(){this._gateway.signal.on(wt.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Fr.PUBLISH,(e,t,r)=>{let{uid:o}=e;e.forEach(c=>{let{kind:u,ssrcs:h,mid:m,isMuted:g}=c;this._handleP2PAddAudioOrVideoStream(u,o,h[0].ssrcId,m);let y=this._users.find(v=>v.uid===o);return y&&this.store.useP2P?this._p2pChannel.mockSubscribe(y,u,h[0].ssrcId,m).then(()=>{t()}).catch(r):t(),this._handleMuteStream(o,u,!!g)})}),this._gateway.signal.on(Fr.CALL,async(e,t,r)=>{if(this.store.useP2P)try{var o;t(await this._p2pChannel.startP2P({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},e))}catch(c){r(c)}}),this._gateway.signal.on(rt.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(Fr.UNPUBLISH,async(e,t,r)=>{if(this.store.useP2P){let{unpubMsg:o,uid:c}=e,u=this._users.find(h=>h.uid===c);if(!u)return k.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void t();try{o.forEach(async h=>{let{stream_type:m}=h,g=m===On.Audio?et.AUDIO:et.VIDEO;await this._p2pChannel.unsubscribe(u,g),this._handleMuteStream(c,g,!0)}),t()}catch(h){r(h)}}}),this._gateway.signal.on(Fr.CONTROL,async(e,t)=>{let{action:r}=e;switch(r){case wp.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,et.VIDEO,!0);break;case wp.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,et.AUDIO,!0);break;case wp.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,et.VIDEO,!1);break;case wp.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,et.AUDIO,!1)}}),this._gateway.signal.on(Fr.RESTART_ICE,async(e,t,r)=>{if(this.store.useP2P)try{let{direction:o,iceParameter:c}=e;o!==Ys.SEND_ONLY||c?t(await this._p2pChannel.restartICE(o,c)):(this._p2pChannel.handleDisconnect(o),t())}catch(o){r(o)}}),this._gateway.signal.on(Fr.CANDIDATE,e=>{if(this.store.useP2P){let{candidate:t,direction:r}=e;this._p2pChannel.addRemoteCandidate(t,r)}}),this._p2pChannel.on(dt.RequestP2PRestartICE,async(e,t,r)=>{try{let{direction:o}=e;t(await this._gateway.sendExtensionMessage(Fr.RESTART_ICE,e,o===Ys.SEND_ONLY))}catch(o){r(o)}}),this._p2pChannel.on(dt.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Fr.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(dt.RequestP2PMuteLocal,async(e,t,r)=>{try{await this._gateway.sendExtensionMessage(Fr.CONTROL,e,!0),t()}catch(o){r(o)}}),this._p2pChannel.on(dt.RequestP2PUnmuteRemote,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(o){o.code===Y.DISCONNECT_P2P?t():r(o)}else t()}),this._p2pChannel.on(dt.RequestP2PMuteRemote,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(o){o.code===Y.DISCONNECT_P2P?t():r(o)}else t()}),this._p2pChannel.on(dt.StateChange,(e,t)=>{t===Tn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(dt.PeerConnectionStateChange,e=>{let t=this._peerConnectionState;e!==t&&(this.safeEmit(zt.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(dt.RequestMuteLocal,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(o){o.code===Y.DISCONNECT_P2P?t():r(o)}else t()}),this._p2pChannel.on(dt.RequestUnmuteLocal,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(o){o.code===Y.DISCONNECT_P2P?t():r(o)}else t()}),this._p2pChannel.on(dt.RequestRePublish,(e,t,r)=>{this.publish(e,!1).then(t).catch(r)}),this._p2pChannel.on(dt.RequestRePublishDataChannel,(e,t,r)=>{ze.all(e.map(async o=>{let c=await this._p2pChannel.publishDataChannel([o]);try{c.forEach(u=>{this._uid&&this._gateway.publishDataChannel(this._uid,u,!0)})}catch(u){if(u.code!==Y.DISCONNECT_P2P)throw u}})).then(t).catch(r)}),this._p2pChannel.on(dt.RequestReSubscribe,async(e,t,r)=>{try{for(let{user:o,kind:c}of e)c===et.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");t()}catch(o){r(o)}}),this._p2pChannel.on(dt.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(dt.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(dt.MediaReconnectStart,e=>{this.safeEmit(zt.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(dt.MediaReconnectEnd,e=>{this.safeEmit(zt.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(dt.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(dt.RequestRestartICE,async e=>{if(this.store.useP2P)return;let t=await this._p2pChannel.restartICE(e),r=await t.next();if(r.done)return;let o=r.value,c;try{c=await this._gateway.restartICE({iceParameters:o})}catch(h){return void t.throw(h)}let{iceParameters:u}=(function(h){let m=h.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}})(c);await t.next({remoteIceParameters:u})}),this._p2pChannel.on(dt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(dt.RequestReconnectPC,async()=>{var e;let{iceParameters:t,dtlsParameters:r,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:c,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:r,rtpCapabilities:o}),h=vG(c,u);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(dt.RequestUnpublishForReconnectPC,async(e,t,r)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):r()}),this._p2pChannel.on(dt.P2PLost,()=>{this.safeEmit(zt.P2P_LOST,this.store.uid)}),this._p2pChannel.on(dt.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(dt.ConnectionTypeChange,e=>{this.safeEmit(zt.IS_USING_CLOUD_PROXY,e),this._gateway.setUsingProxy(e)}),this._p2pChannel.on(dt.FirstVideoBufferReady,(e,t)=>{this.safeEmit(zt.FIRST_VIDEO_BUFFER_READY,e,t)}),this._p2pChannel.on(dt.FirstVideoPreRender,(e,t)=>{this.safeEmit(zt.FIRST_VIDEO_PRE_RENDER,e,t)}),this._p2pChannel.on(dt.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(dt.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(dt.AudioMetadata,e=>{this.safeEmit(zt.AUDIO_METADATA,e)}),this._p2pChannel.on(dt.AudioPts,e=>{this.safeEmit(zt.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new he(Y.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new he(Y.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{let r=(t={config:e},Yl("ContentInspect").create(t));this._inspect=r,this.handleVideoInspectEvents(r);let{appId:o,cname:c,sid:u,token:h,uid:m,cid:g,vid:y}=this._joinInfo;await r.init({appId:o,areaCode:"",cname:c,sid:u,token:h,uid:m,cid:g,vid:y?Number(y):0},Kr)}catch(r){throw Array.isArray(r)?r[0]:r}var t}handleVideoInspectEvents(e){e.on(xi.CONNECTION_STATE_CHANGE,(t,r)=>{if(this.safeEmit(zt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,r),r===Yc.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(zt.CONTENT_INSPECT_ERROR,new he(Y.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(xi.INSPECT_RESULT,(t,r)=>{var o;if(r?.code===Y.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return k.debug("Stop inspect content because that has left channel"),this==null||(o=this._inspect)===null||o===void 0||o.close(),void(this._inspect=void 0);this.safeEmit(zt.CONTENT_INSPECT_RESULT,t,r)}),e.on(xi.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(r=>r.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new he(Y.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Wc(e,"enabled"),e){if(!t)throw new he(Y.INVALID_PARAMS,"config is required");if(D8(t),!this._joinInfo)throw new he(Y.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{let o=(r={config:t},Yl("ImageModeration").create(r));this._moderation=o,this.handleImageModerationEvents(o);let{appId:c,cname:u,sid:h,token:m,uid:g,cid:y,vid:v}=this._joinInfo;await o.init({appId:c,areaCode:"",cname:u,sid:h,token:m,uid:g,cid:y,vid:v?Number(v):0},Kr)}}catch(o){throw Array.isArray(o)?o[0]:o}}else{var r;if(!this._moderation)throw new he(Y.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(o){throw Array.isArray(o)?o[0]:o}}}handleImageModerationEvents(e){e.on(Kl.CONNECTION_STATE_CHANGE,(t,r)=>{if(this.safeEmit(zt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,r),t===tc.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new he(Y.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Kl.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(r=>r.trackMediaType==="video")[0])})}setP2PTransport(e){if((function(t){zr(t,"transport",["default","auto","relay","sd-rtn"])})(e),this.mode!=="p2p")throw new he(Y.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,k.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return k.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Wc(e,"enabled"),Ln("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_setRteInfo(e,t){this.store.rteUrl=e,this.store.rteSid=t}_isPreRender(){return"isPreRender"in this._p2pChannel&&this._p2pChannel.isPreRender()}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Ye($e.prototype,"leave",[x8],Object.getOwnPropertyDescriptor($e.prototype,"leave"),$e.prototype),Ye($e.prototype,"publish",[L8],Object.getOwnPropertyDescriptor($e.prototype,"publish"),$e.prototype),Ye($e.prototype,"unpublish",[M8],Object.getOwnPropertyDescriptor($e.prototype,"unpublish"),$e.prototype),Ye($e.prototype,"subscribe",[U8],Object.getOwnPropertyDescriptor($e.prototype,"subscribe"),$e.prototype),Ye($e.prototype,"presubscribe",[V8],Object.getOwnPropertyDescriptor($e.prototype,"presubscribe"),$e.prototype),Ye($e.prototype,"massSubscribe",[F8],Object.getOwnPropertyDescriptor($e.prototype,"massSubscribe"),$e.prototype),Ye($e.prototype,"unsubscribe",[j8],Object.getOwnPropertyDescriptor($e.prototype,"unsubscribe"),$e.prototype),Ye($e.prototype,"massUnsubscribe",[B8],Object.getOwnPropertyDescriptor($e.prototype,"massUnsubscribe"),$e.prototype),Ye($e.prototype,"setLowStreamParameter",[W8],Object.getOwnPropertyDescriptor($e.prototype,"setLowStreamParameter"),$e.prototype),Ye($e.prototype,"setDualStreamMode",[G8],Object.getOwnPropertyDescriptor($e.prototype,"setDualStreamMode"),$e.prototype),Ye($e.prototype,"enableDualStream",[H8],Object.getOwnPropertyDescriptor($e.prototype,"enableDualStream"),$e.prototype),Ye($e.prototype,"disableDualStream",[z8],Object.getOwnPropertyDescriptor($e.prototype,"disableDualStream"),$e.prototype),Ye($e.prototype,"setClientRole",[K8],Object.getOwnPropertyDescriptor($e.prototype,"setClientRole"),$e.prototype),Ye($e.prototype,"_setClientRoleOptions",[Y8],Object.getOwnPropertyDescriptor($e.prototype,"_setClientRoleOptions"),$e.prototype),Ye($e.prototype,"setProxyServer",[q8],Object.getOwnPropertyDescriptor($e.prototype,"setProxyServer"),$e.prototype),Ye($e.prototype,"setTurnServer",[X8],Object.getOwnPropertyDescriptor($e.prototype,"setTurnServer"),$e.prototype),Ye($e.prototype,"setLicense",[J8],Object.getOwnPropertyDescriptor($e.prototype,"setLicense"),$e.prototype),Ye($e.prototype,"startProxyServer",[$8],Object.getOwnPropertyDescriptor($e.prototype,"startProxyServer"),$e.prototype),Ye($e.prototype,"stopProxyServer",[Q8],Object.getOwnPropertyDescriptor($e.prototype,"stopProxyServer"),$e.prototype),Ye($e.prototype,"setLocalAccessPointsV2",[Z8],Object.getOwnPropertyDescriptor($e.prototype,"setLocalAccessPointsV2"),$e.prototype),Ye($e.prototype,"setLocalAccessPoints",[eH],Object.getOwnPropertyDescriptor($e.prototype,"setLocalAccessPoints"),$e.prototype),Ye($e.prototype,"setRemoteDefaultVideoStreamType",[tH],Object.getOwnPropertyDescriptor($e.prototype,"setRemoteDefaultVideoStreamType"),$e.prototype),Ye($e.prototype,"setRemoteVideoStreamType",[nH],Object.getOwnPropertyDescriptor($e.prototype,"setRemoteVideoStreamType"),$e.prototype),Ye($e.prototype,"setStreamFallbackOption",[rH],Object.getOwnPropertyDescriptor($e.prototype,"setStreamFallbackOption"),$e.prototype),Ye($e.prototype,"setEncryptionConfig",[iH],Object.getOwnPropertyDescriptor($e.prototype,"setEncryptionConfig"),$e.prototype),Ye($e.prototype,"renewToken",[sH],Object.getOwnPropertyDescriptor($e.prototype,"renewToken"),$e.prototype),Ye($e.prototype,"enableAudioVolumeIndicator",[oH],Object.getOwnPropertyDescriptor($e.prototype,"enableAudioVolumeIndicator"),$e.prototype),Ye($e.prototype,"startLiveStreaming",[aH],Object.getOwnPropertyDescriptor($e.prototype,"startLiveStreaming"),$e.prototype),Ye($e.prototype,"setLiveTranscoding",[cH],Object.getOwnPropertyDescriptor($e.prototype,"setLiveTranscoding"),$e.prototype),Ye($e.prototype,"stopLiveStreaming",[lH],Object.getOwnPropertyDescriptor($e.prototype,"stopLiveStreaming"),$e.prototype),Ye($e.prototype,"startChannelMediaRelay",[uH],Object.getOwnPropertyDescriptor($e.prototype,"startChannelMediaRelay"),$e.prototype),Ye($e.prototype,"updateChannelMediaRelay",[dH],Object.getOwnPropertyDescriptor($e.prototype,"updateChannelMediaRelay"),$e.prototype),Ye($e.prototype,"stopChannelMediaRelay",[hH],Object.getOwnPropertyDescriptor($e.prototype,"stopChannelMediaRelay"),$e.prototype),Ye($e.prototype,"sendCustomReportMessage",[pH],Object.getOwnPropertyDescriptor($e.prototype,"sendCustomReportMessage"),$e.prototype),Ye($e.prototype,"pickSVCLayer",[fH],Object.getOwnPropertyDescriptor($e.prototype,"pickSVCLayer"),$e.prototype),Ye($e.prototype,"setRTMConfig",[mH],Object.getOwnPropertyDescriptor($e.prototype,"setRTMConfig"),$e.prototype),Ye($e.prototype,"enableContentInspect",[gH],Object.getOwnPropertyDescriptor($e.prototype,"enableContentInspect"),$e.prototype),Ye($e.prototype,"disableContentInspect",[_H],Object.getOwnPropertyDescriptor($e.prototype,"disableContentInspect"),$e.prototype),Ye($e.prototype,"setImageModeration",[EH],Object.getOwnPropertyDescriptor($e.prototype,"setImageModeration"),$e.prototype),Ye($e.prototype,"setP2PTransport",[yH],Object.getOwnPropertyDescriptor($e.prototype,"setP2PTransport"),$e.prototype),Ye($e.prototype,"getJoinChannelServiceRecords",[vH],Object.getOwnPropertyDescriptor($e.prototype,"getJoinChannelServiceRecords"),$e.prototype),Ye($e.prototype,"setPublishAudioFilterEnabled",[SH],Object.getOwnPropertyDescriptor($e.prototype,"setPublishAudioFilterEnabled"),$e.prototype),$e);function wH(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"},r=In(5,"client-"),o=tt.reportApiInvoke(null,{id:r,name:ar.CREATE_CLIENT,options:[t],tag:Fn.TRACER});try{(function(c){zr(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),zr(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&zr(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&Hi(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&n5(c.turnServer),c.httpRetryConfig!==void 0&&t5(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&t5(c.websocketRetryConfig)})(t)}catch(c){throw o.onError(c),c}return(W4(16,0,!0)||uk(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",k.debug("browser not support vp9, force use vp8")),Ln("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),o.onSuccess(),new Ape(Qc(Qc({forceWaitGatewayResponse:!0},t),{},{role:ke(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),r)}function Ope(){let e=!1,t=pn();return(t.name===_n.CHROME&&Number(t.version)>=58&&(jl.engine.name!=="WebKit"||(function(){let r=pn();if(Rb()){if(r.os===wi.MAC_OS)return!0;if(r.os===wi.IOS){let o=jl.os.version&&jl.os.version.split(".");if(o&&Number(o[0])===14&&o[1]&&Number(o[1])>=3||o&&Number(o[0])>14)return!0}}return!1})())||t.name===_n.FIREFOX&&Number(t.version)>=56||t.name===_n.OPERA&&Number(t.version)>=45||t.name===_n.SAFARI&&Number(t.version)>=11||t.name==="WebKit"&&(Es()||Bc())&&t.osVersion&&Number(t.osVersion.split(".")[0])>=11||z4()||pn().name===_n.QQ)&&(e=!0),e}class n0{constructor(t,r){V(this,"id",0),V(this,"element",void 0),V(this,"peerPair",void 0),V(this,"context",void 0),V(this,"audioPlayerElement",void 0),V(this,"audioTrack",void 0),n0.count+=1,this.id=n0.count,this.element=t,this.context=r}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{let r=document.createElement("audio");r.srcObject=new MediaStream([t.track]),r.play(),this.audioPlayerElement=r}}async switchSdp(){if(!this.peerPair)return;let t=async(o,c)=>{let u=c==="offer"?await o.createOffer():await o.createAnswer();return await o.setLocalDescription(u),o.iceGatheringState==="complete"?o.localDescription:new ze(h=>{o.onicegatheringstatechange=()=>{o.iceGatheringState==="complete"&&h(o.localDescription)}})},r=async(o,c)=>await o.setRemoteDescription(c);try{let o=await t(this.peerPair[0],"offer");await r(this.peerPair[1],o);let c=await t(this.peerPair[1],"answer");await r(this.peerPair[0],c)}catch(o){throw new he(Y.LOCAL_AEC_ERROR,o.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let r;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),r=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(r)}catch(c){throw new he(Y.LOCAL_AEC_ERROR,c.toString()).print()}if(!r)throw new he(Y.LOCAL_AEC_ERROR,"no dest node when local aec").print();let o=r.stream.getAudioTracks()[0];return this.audioTrack=o,o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let t=this.element,r=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(r),await this.switchSdp()}close(){k.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var CH,OI;V(n0,"count",0);let Npe=window.AudioContext||window.webkitAudioContext,Ppe=new(CH=gt({report:tt}),Ye((OI=class{constructor(){V(this,"units",[]),V(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return k.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Npe);let t=this.units.find(r=>r&&r.getElement()===e);return t||(t=new n0(e,this.context),this.units.push(t)),t.startEchoCancellation(),k.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return pn().name!==_n.SAFARI}}).prototype,"processExternalMediaAEC",[CH],Object.getOwnPropertyDescriptor(OI.prototype,"processExternalMediaAEC"),OI.prototype),OI);function RH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function bH(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?RH(Object(r),!0).forEach(function(o){V(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):RH(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}let rx=window||document;function IH(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!rx)return;let r=ti._cspEventHandlerPointer;if(r&&t)return void console.error(r,t);let o=c=>{if(!(c&&c.blockedURI&&(ti.onSecurityPolicyViolation||ti.getListeners(Zu.SECURITY_POLICY_VIOLATION).length>0)))return;let u=c.blockedURI;z("CSP_DETECTED_HOSTNAME_LIST").some(h=>ke(u).call(u,h))&&(ti.onSecurityPolicyViolation&&typeof ti.onSecurityPolicyViolation=="function"&&ti.onSecurityPolicyViolation(c),ti.getListeners(Zu.SECURITY_POLICY_VIOLATION).length>0&&ti.safeEmit(Zu.SECURITY_POLICY_VIOLATION,c))};r&&rx.removeEventListener("securitypolicyviolation",r),(t||e&&typeof e=="function"||ti.getListeners(Zu.SECURITY_POLICY_VIOLATION).length>0)&&rx.addEventListener("securitypolicyviolation",o),ti._cspEventHandlerPointer=o}var kpe=N,Dpe=g1,AH=RegExp.prototype,xpe=function(e){return e===AH||kpe(AH,e)?Dpe(e):e.flags},Ds=l(xpe);function oy(e){let t=e.length;for(;--t>=0;)e[t]=0}let ix=256,OH=286,r0=30,i0=15,sx=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),NI=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Lpe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),NH=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),oh=new Array(576);oy(oh);let s0=new Array(60);oy(s0);let o0=new Array(512);oy(o0);let a0=new Array(256);oy(a0);let ox=new Array(29);oy(ox);let PI=new Array(r0);function ax(e,t,r,o,c){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=o,this.max_length=c,this.has_stree=e&&e.length}let PH,kH,DH;function cx(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}oy(PI);let xH=e=>e<256?o0[e]:o0[256+(e>>>7)],c0=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},wa=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,c0(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},sd=(e,t,r)=>{wa(e,r[2*t],r[2*t+1])},LH=(e,t)=>{let r=0;do r|=1&e,e>>>=1,r<<=1;while(--t>0);return r>>>1},MH=(e,t,r)=>{let o=new Array(16),c,u,h=0;for(c=1;c<=i0;c++)h=h+r[c-1]<<1,o[c]=h;for(u=0;u<=t;u++){let m=e[2*u+1];m!==0&&(e[2*u]=LH(o[m]++,m))}},UH=e=>{let t;for(t=0;t<OH;t++)e.dyn_ltree[2*t]=0;for(t=0;t<r0;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},VH=e=>{e.bi_valid>8?c0(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},FH=(e,t,r,o)=>{let c=2*t,u=2*r;return e[c]<e[u]||e[c]===e[u]&&o[t]<=o[r]},lx=(e,t,r)=>{let o=e.heap[r],c=r<<1;for(;c<=e.heap_len&&(c<e.heap_len&&FH(t,e.heap[c+1],e.heap[c],e.depth)&&c++,!FH(t,o,e.heap[c],e.depth));)e.heap[r]=e.heap[c],r=c,c<<=1;e.heap[r]=o},jH=(e,t,r)=>{let o,c,u,h,m=0;if(e.sym_next!==0)do o=255&e.pending_buf[e.sym_buf+m++],o+=(255&e.pending_buf[e.sym_buf+m++])<<8,c=e.pending_buf[e.sym_buf+m++],o===0?sd(e,c,t):(u=a0[c],sd(e,u+ix+1,t),h=sx[u],h!==0&&(c-=ox[u],wa(e,c,h)),o--,u=xH(o),sd(e,u,r),h=NI[u],h!==0&&(o-=PI[u],wa(e,o,h)));while(m<e.sym_next);sd(e,256,t)},ux=(e,t)=>{let r=t.dyn_tree,o=t.stat_desc.static_tree,c=t.stat_desc.has_stree,u=t.stat_desc.elems,h,m,g,y=-1;for(e.heap_len=0,e.heap_max=573,h=0;h<u;h++)r[2*h]!==0?(e.heap[++e.heap_len]=y=h,e.depth[h]=0):r[2*h+1]=0;for(;e.heap_len<2;)g=e.heap[++e.heap_len]=y<2?++y:0,r[2*g]=1,e.depth[g]=0,e.opt_len--,c&&(e.static_len-=o[2*g+1]);for(t.max_code=y,h=e.heap_len>>1;h>=1;h--)lx(e,r,h);g=u;do h=e.heap[1],e.heap[1]=e.heap[e.heap_len--],lx(e,r,1),m=e.heap[1],e.heap[--e.heap_max]=h,e.heap[--e.heap_max]=m,r[2*g]=r[2*h]+r[2*m],e.depth[g]=(e.depth[h]>=e.depth[m]?e.depth[h]:e.depth[m])+1,r[2*h+1]=r[2*m+1]=g,e.heap[1]=g++,lx(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((v,R)=>{let b=R.dyn_tree,A=R.max_code,F=R.stat_desc.static_tree,M=R.stat_desc.has_stree,j=R.stat_desc.extra_bits,K=R.stat_desc.extra_base,q=R.stat_desc.max_length,Q,se,oe,te,de,Ce,Pe=0;for(te=0;te<=i0;te++)v.bl_count[te]=0;for(b[2*v.heap[v.heap_max]+1]=0,Q=v.heap_max+1;Q<573;Q++)se=v.heap[Q],te=b[2*b[2*se+1]+1]+1,te>q&&(te=q,Pe++),b[2*se+1]=te,se>A||(v.bl_count[te]++,de=0,se>=K&&(de=j[se-K]),Ce=b[2*se],v.opt_len+=Ce*(te+de),M&&(v.static_len+=Ce*(F[2*se+1]+de)));if(Pe!==0){do{for(te=q-1;v.bl_count[te]===0;)te--;v.bl_count[te]--,v.bl_count[te+1]+=2,v.bl_count[q]--,Pe-=2}while(Pe>0);for(te=q;te!==0;te--)for(se=v.bl_count[te];se!==0;)oe=v.heap[--Q],oe>A||(b[2*oe+1]!==te&&(v.opt_len+=(te-b[2*oe+1])*b[2*oe],b[2*oe+1]=te),se--)}})(e,t),MH(r,y,e.bl_count)},BH=(e,t,r)=>{let o,c,u=-1,h=t[1],m=0,g=7,y=4;for(h===0&&(g=138,y=3),t[2*(r+1)+1]=65535,o=0;o<=r;o++)c=h,h=t[2*(o+1)+1],++m<g&&c===h||(m<y?e.bl_tree[2*c]+=m:c!==0?(c!==u&&e.bl_tree[2*c]++,e.bl_tree[32]++):m<=10?e.bl_tree[34]++:e.bl_tree[36]++,m=0,u=c,h===0?(g=138,y=3):c===h?(g=6,y=3):(g=7,y=4))},WH=(e,t,r)=>{let o,c,u=-1,h=t[1],m=0,g=7,y=4;for(h===0&&(g=138,y=3),o=0;o<=r;o++)if(c=h,h=t[2*(o+1)+1],!(++m<g&&c===h)){if(m<y)do sd(e,c,e.bl_tree);while(--m!=0);else c!==0?(c!==u&&(sd(e,c,e.bl_tree),m--),sd(e,16,e.bl_tree),wa(e,m-3,2)):m<=10?(sd(e,17,e.bl_tree),wa(e,m-3,3)):(sd(e,18,e.bl_tree),wa(e,m-11,7));m=0,u=c,h===0?(g=138,y=3):c===h?(g=6,y=3):(g=7,y=4)}},GH=!1,HH=(e,t,r,o)=>{wa(e,0+(o?1:0),3),VH(e),c0(e,r),c0(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r};var Mpe=e=>{GH||((()=>{let t,r,o,c,u,h=new Array(16);for(o=0,c=0;c<28;c++)for(ox[c]=o,t=0;t<1<<sx[c];t++)a0[o++]=c;for(a0[o-1]=c,u=0,c=0;c<16;c++)for(PI[c]=u,t=0;t<1<<NI[c];t++)o0[u++]=c;for(u>>=7;c<r0;c++)for(PI[c]=u<<7,t=0;t<1<<NI[c]-7;t++)o0[256+u++]=c;for(r=0;r<=i0;r++)h[r]=0;for(t=0;t<=143;)oh[2*t+1]=8,t++,h[8]++;for(;t<=255;)oh[2*t+1]=9,t++,h[9]++;for(;t<=279;)oh[2*t+1]=7,t++,h[7]++;for(;t<=287;)oh[2*t+1]=8,t++,h[8]++;for(MH(oh,287,h),t=0;t<r0;t++)s0[2*t+1]=5,s0[2*t]=LH(t,5);PH=new ax(oh,sx,257,OH,i0),kH=new ax(s0,NI,0,r0,i0),DH=new ax(new Array(0),Lpe,0,19,7)})(),GH=!0),e.l_desc=new cx(e.dyn_ltree,PH),e.d_desc=new cx(e.dyn_dtree,kH),e.bl_desc=new cx(e.bl_tree,DH),e.bi_buf=0,e.bi_valid=0,UH(e)},Upe=(e,t,r,o)=>{let c,u,h=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(m=>{let g,y=4093624447;for(g=0;g<=31;g++,y>>>=1)if(1&y&&m.dyn_ltree[2*g]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(g=32;g<ix;g++)if(m.dyn_ltree[2*g]!==0)return 1;return 0})(e)),ux(e,e.l_desc),ux(e,e.d_desc),h=(m=>{let g;for(BH(m,m.dyn_ltree,m.l_desc.max_code),BH(m,m.dyn_dtree,m.d_desc.max_code),ux(m,m.bl_desc),g=18;g>=3&&m.bl_tree[2*NH[g]+1]===0;g--);return m.opt_len+=3*(g+1)+5+5+4,g})(e),c=e.opt_len+3+7>>>3,u=e.static_len+3+7>>>3,u<=c&&(c=u)):c=u=r+5,r+4<=c&&t!==-1?HH(e,t,r,o):e.strategy===4||u===c?(wa(e,2+(o?1:0),3),jH(e,oh,s0)):(wa(e,4+(o?1:0),3),((m,g,y,v)=>{let R;for(wa(m,g-257,5),wa(m,y-1,5),wa(m,v-4,4),R=0;R<v;R++)wa(m,m.bl_tree[2*NH[R]+1],3);WH(m,m.dyn_ltree,g-1),WH(m,m.dyn_dtree,y-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,h+1),jH(e,e.dyn_ltree,e.dyn_dtree)),UH(e),o&&VH(e)},Vpe=(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,t===0?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(a0[r]+ix+1)]++,e.dyn_dtree[2*xH(t)]++),e.sym_next===e.sym_end),Fpe=e=>{wa(e,2,3),sd(e,256,oh),(t=>{t.bi_valid===16?(c0(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},jpe={_tr_init:Mpe,_tr_stored_block:HH,_tr_flush_block:Upe,_tr_tally:Vpe,_tr_align:Fpe},l0=(e,t,r,o)=>{let c=65535&e|0,u=e>>>16&65535|0,h=0;for(;r!==0;){h=r>2e3?2e3:r,r-=h;do c=c+t[o++]|0,u=u+c|0;while(--h);c%=65521,u%=65521}return c|u<<16|0};let Bpe=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})());var qs=(e,t,r,o)=>{let c=Bpe,u=o+r;e^=-1;for(let h=o;h<u;h++)e=e>>>8^c[255&(e^t[h])];return-1^e},ng={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},kI={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};let{_tr_init:Wpe,_tr_stored_block:dx,_tr_flush_block:Gpe,_tr_tally:Np,_tr_align:Hpe}=jpe,{Z_NO_FLUSH:Pp,Z_PARTIAL_FLUSH:zpe,Z_FULL_FLUSH:Kpe,Z_FINISH:Zc,Z_BLOCK:zH,Z_OK:fo,Z_STREAM_END:KH,Z_STREAM_ERROR:od,Z_DATA_ERROR:Ype,Z_BUF_ERROR:hx,Z_DEFAULT_COMPRESSION:qpe,Z_FILTERED:Xpe,Z_HUFFMAN_ONLY:DI,Z_RLE:Jpe,Z_FIXED:$pe,Z_DEFAULT_STRATEGY:Qpe,Z_UNKNOWN:Zpe,Z_DEFLATED:xI}=kI,px=286,efe=30,tfe=19,nfe=2*px+1,rfe=15,rg=258,ad=262,ay=42,ig=113,u0=666,sg=(e,t)=>(e.msg=ng[t],t),YH=e=>2*e-(e>4?9:0),kp=e=>{let t=e.length;for(;--t>=0;)e[t]=0},ife=e=>{let t,r,o,c=e.w_size;t=e.hash_size,o=t;do r=e.head[--o],e.head[o]=r>=c?r-c:0;while(--t);t=c,o=t;do r=e.prev[--o],e.prev[o]=r>=c?r-c:0;while(--t)},Dp=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask,nc=e=>{let t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),r!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,t.pending===0&&(t.pending_out=0))},rc=(e,t)=>{Gpe(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,nc(e.strm)},xr=(e,t)=>{e.pending_buf[e.pending++]=t},d0=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},fx=(e,t,r,o)=>{let c=e.avail_in;return c>o&&(c=o),c===0?0:(e.avail_in-=c,t.set(e.input.subarray(e.next_in,e.next_in+c),r),e.state.wrap===1?e.adler=l0(e.adler,t,c,r):e.state.wrap===2&&(e.adler=qs(e.adler,t,c,r)),e.next_in+=c,e.total_in+=c,c)},qH=(e,t)=>{let r,o,c=e.max_chain_length,u=e.strstart,h=e.prev_length,m=e.nice_match,g=e.strstart>e.w_size-ad?e.strstart-(e.w_size-ad):0,y=e.window,v=e.w_mask,R=e.prev,b=e.strstart+rg,A=y[u+h-1],F=y[u+h];e.prev_length>=e.good_match&&(c>>=2),m>e.lookahead&&(m=e.lookahead);do if(r=t,y[r+h]===F&&y[r+h-1]===A&&y[r]===y[u]&&y[++r]===y[u+1]){u+=2,r++;do;while(y[++u]===y[++r]&&y[++u]===y[++r]&&y[++u]===y[++r]&&y[++u]===y[++r]&&y[++u]===y[++r]&&y[++u]===y[++r]&&y[++u]===y[++r]&&y[++u]===y[++r]&&u<b);if(o=rg-(b-u),u=b-rg,o>h){if(e.match_start=t,h=o,o>=m)break;A=y[u+h-1],F=y[u+h]}}while((t=R[t&v])>g&&--c!=0);return h<=e.lookahead?h:e.lookahead},cy=e=>{let t=e.w_size,r,o,c;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-ad)&&(e.window.set(e.window.subarray(t,t+t-o),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),ife(e),o+=t),e.strm.avail_in===0)break;if(r=fx(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=r,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=Dp(e,e.ins_h,e.window[c+1]);e.insert&&(e.ins_h=Dp(e,e.ins_h,e.window[c+3-1]),e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<ad&&e.strm.avail_in!==0)},XH=(e,t)=>{let r,o,c,u=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,h=0,m=e.strm.avail_in;do{if(r=65535,c=e.bi_valid+42>>3,e.strm.avail_out<c||(c=e.strm.avail_out-c,o=e.strstart-e.block_start,r>o+e.strm.avail_in&&(r=o+e.strm.avail_in),r>c&&(r=c),r<u&&(r===0&&t!==Zc||t===Pp||r!==o+e.strm.avail_in)))break;h=t===Zc&&r===o+e.strm.avail_in?1:0,dx(e,0,0,h),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,nc(e.strm),o&&(o>r&&(o=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+o),e.strm.next_out),e.strm.next_out+=o,e.strm.avail_out-=o,e.strm.total_out+=o,e.block_start+=o,r-=o),r&&(fx(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(h===0);return m-=e.strm.avail_in,m&&(m>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=m&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-m,e.strm.next_in),e.strstart),e.strstart+=m,e.insert+=m>e.w_size-e.insert?e.w_size-e.insert:m),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),h?4:t!==Pp&&t!==Zc&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(c=e.window_size-e.strstart,e.strm.avail_in>c&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,c+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),c>e.strm.avail_in&&(c=e.strm.avail_in),c&&(fx(e.strm,e.window,e.strstart,c),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.high_water<e.strstart&&(e.high_water=e.strstart),c=e.bi_valid+42>>3,c=e.pending_buf_size-c>65535?65535:e.pending_buf_size-c,u=c>e.w_size?e.w_size:c,o=e.strstart-e.block_start,(o>=u||(o||t===Zc)&&t!==Pp&&e.strm.avail_in===0&&o<=c)&&(r=o>c?c:o,h=t===Zc&&e.strm.avail_in===0&&r===o?1:0,dx(e,e.block_start,r,h),e.block_start+=r,nc(e.strm)),h?3:1)},mx=(e,t)=>{let r,o;for(;;){if(e.lookahead<ad){if(cy(e),e.lookahead<ad&&t===Pp)return 1;if(e.lookahead===0)break}if(r=0,e.lookahead>=3&&(e.ins_h=Dp(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-ad&&(e.match_length=qH(e,r)),e.match_length>=3)if(o=Np(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Dp(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Dp(e,e.ins_h,e.window[e.strstart+1]);else o=Np(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(rc(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Zc?(rc(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(rc(e,!1),e.strm.avail_out===0)?1:2},ly=(e,t)=>{let r,o,c;for(;;){if(e.lookahead<ad){if(cy(e),e.lookahead<ad&&t===Pp)return 1;if(e.lookahead===0)break}if(r=0,e.lookahead>=3&&(e.ins_h=Dp(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-ad&&(e.match_length=qH(e,r),e.match_length<=5&&(e.strategy===Xpe||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){c=e.strstart+e.lookahead-3,o=Np(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=c&&(e.ins_h=Dp(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,o&&(rc(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(o=Np(e,0,e.window[e.strstart-1]),o&&rc(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=Np(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Zc?(rc(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(rc(e,!1),e.strm.avail_out===0)?1:2};function cd(e,t,r,o,c){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=o,this.func=c}let h0=[new cd(0,0,0,0,XH),new cd(4,4,8,4,mx),new cd(4,5,16,8,mx),new cd(4,6,32,32,mx),new cd(4,4,16,16,ly),new cd(8,16,32,32,ly),new cd(8,16,128,128,ly),new cd(8,32,128,256,ly),new cd(32,128,258,1024,ly),new cd(32,258,258,4096,ly)];function sfe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=xI,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*nfe),this.dyn_dtree=new Uint16Array(2*(2*efe+1)),this.bl_tree=new Uint16Array(2*(2*tfe+1)),kp(this.dyn_ltree),kp(this.dyn_dtree),kp(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(rfe+1),this.heap=new Uint16Array(2*px+1),kp(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*px+1),kp(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}let p0=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.status!==ay&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==ig&&t.status!==u0?1:0},JH=e=>{if(p0(e))return sg(e,od);e.total_in=e.total_out=0,e.data_type=Zpe;let t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?ay:ig,e.adler=t.wrap===2?0:1,t.last_flush=-2,Wpe(t),fo},$H=e=>{let t=JH(e);return t===fo&&(r=>{r.window_size=2*r.w_size,kp(r.head),r.max_lazy_match=h0[r.level].max_lazy,r.good_match=h0[r.level].good_length,r.nice_match=h0[r.level].nice_length,r.max_chain_length=h0[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0})(e.state),t},QH=(e,t,r,o,c,u)=>{if(!e)return od;let h=1;if(t===qpe&&(t=6),o<0?(h=0,o=-o):o>15&&(h=2,o-=16),c<1||c>9||r!==xI||o<8||o>15||t<0||t>9||u<0||u>$pe||o===8&&h!==1)return sg(e,od);o===8&&(o=9);let m=new sfe;return e.state=m,m.strm=e,m.status=ay,m.wrap=h,m.gzhead=null,m.w_bits=o,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=c+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<c+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=t,m.strategy=u,m.method=r,$H(e)};var ofe=(e,t)=>{if(p0(e)||t>zH||t<0)return e?sg(e,od):od;let r=e.state;if(!e.output||e.avail_in!==0&&!e.input||r.status===u0&&t!==Zc)return sg(e,e.avail_out===0?hx:od);let o=r.last_flush;if(r.last_flush=t,r.pending!==0){if(nc(e),e.avail_out===0)return r.last_flush=-1,fo}else if(e.avail_in===0&&YH(t)<=YH(o)&&t!==Zc)return sg(e,hx);if(r.status===u0&&e.avail_in!==0)return sg(e,hx);if(r.status===ay&&r.wrap===0&&(r.status=ig),r.status===ay){let c=xI+(r.w_bits-8<<4)<<8,u=-1;if(u=r.strategy>=DI||r.level<2?0:r.level<6?1:r.level===6?2:3,c|=u<<6,r.strstart!==0&&(c|=32),c+=31-c%31,d0(r,c),r.strstart!==0&&(d0(r,e.adler>>>16),d0(r,65535&e.adler)),e.adler=1,r.status=ig,nc(e),r.pending!==0)return r.last_flush=-1,fo}if(r.status===57){if(e.adler=0,xr(r,31),xr(r,139),xr(r,8),r.gzhead)xr(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),xr(r,255&r.gzhead.time),xr(r,r.gzhead.time>>8&255),xr(r,r.gzhead.time>>16&255),xr(r,r.gzhead.time>>24&255),xr(r,r.level===9?2:r.strategy>=DI||r.level<2?4:0),xr(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(xr(r,255&r.gzhead.extra.length),xr(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=qs(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(xr(r,0),xr(r,0),xr(r,0),xr(r,0),xr(r,0),xr(r,r.level===9?2:r.strategy>=DI||r.level<2?4:0),xr(r,3),r.status=ig,nc(e),r.pending!==0)return r.last_flush=-1,fo}if(r.status===69){if(r.gzhead.extra){let c=r.pending,u=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+u>r.pending_buf_size;){let m=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+m),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>c&&(e.adler=qs(e.adler,r.pending_buf,r.pending-c,c)),r.gzindex+=m,nc(e),r.pending!==0)return r.last_flush=-1,fo;c=0,u-=m}let h=new Uint8Array(r.gzhead.extra);r.pending_buf.set(h.subarray(r.gzindex,r.gzindex+u),r.pending),r.pending+=u,r.gzhead.hcrc&&r.pending>c&&(e.adler=qs(e.adler,r.pending_buf,r.pending-c,c)),r.gzindex=0}r.status=73}if(r.status===73){if(r.gzhead.name){let c,u=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>u&&(e.adler=qs(e.adler,r.pending_buf,r.pending-u,u)),nc(e),r.pending!==0)return r.last_flush=-1,fo;u=0}c=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,xr(r,c)}while(c!==0);r.gzhead.hcrc&&r.pending>u&&(e.adler=qs(e.adler,r.pending_buf,r.pending-u,u)),r.gzindex=0}r.status=91}if(r.status===91){if(r.gzhead.comment){let c,u=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>u&&(e.adler=qs(e.adler,r.pending_buf,r.pending-u,u)),nc(e),r.pending!==0)return r.last_flush=-1,fo;u=0}c=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,xr(r,c)}while(c!==0);r.gzhead.hcrc&&r.pending>u&&(e.adler=qs(e.adler,r.pending_buf,r.pending-u,u))}r.status=103}if(r.status===103){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(nc(e),r.pending!==0))return r.last_flush=-1,fo;xr(r,255&e.adler),xr(r,e.adler>>8&255),e.adler=0}if(r.status=ig,nc(e),r.pending!==0)return r.last_flush=-1,fo}if(e.avail_in!==0||r.lookahead!==0||t!==Pp&&r.status!==u0){let c=r.level===0?XH(r,t):r.strategy===DI?((u,h)=>{let m;for(;;){if(u.lookahead===0&&(cy(u),u.lookahead===0)){if(h===Pp)return 1;break}if(u.match_length=0,m=Np(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,m&&(rc(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===Zc?(rc(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(rc(u,!1),u.strm.avail_out===0)?1:2})(r,t):r.strategy===Jpe?((u,h)=>{let m,g,y,v,R=u.window;for(;;){if(u.lookahead<=rg){if(cy(u),u.lookahead<=rg&&h===Pp)return 1;if(u.lookahead===0)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(y=u.strstart-1,g=R[y],g===R[++y]&&g===R[++y]&&g===R[++y])){v=u.strstart+rg;do;while(g===R[++y]&&g===R[++y]&&g===R[++y]&&g===R[++y]&&g===R[++y]&&g===R[++y]&&g===R[++y]&&g===R[++y]&&y<v);u.match_length=rg-(v-y),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(m=Np(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(m=Np(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),m&&(rc(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===Zc?(rc(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(rc(u,!1),u.strm.avail_out===0)?1:2})(r,t):h0[r.level].func(r,t);if(c!==3&&c!==4||(r.status=u0),c===1||c===3)return e.avail_out===0&&(r.last_flush=-1),fo;if(c===2&&(t===zpe?Hpe(r):t!==zH&&(dx(r,0,0,!1),t===Kpe&&(kp(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),nc(e),e.avail_out===0))return r.last_flush=-1,fo}return t!==Zc?fo:r.wrap<=0?KH:(r.wrap===2?(xr(r,255&e.adler),xr(r,e.adler>>8&255),xr(r,e.adler>>16&255),xr(r,e.adler>>24&255),xr(r,255&e.total_in),xr(r,e.total_in>>8&255),xr(r,e.total_in>>16&255),xr(r,e.total_in>>24&255)):(d0(r,e.adler>>>16),d0(r,65535&e.adler)),nc(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?fo:KH)},afe=(e,t)=>{let r=t.length;if(p0(e))return od;let o=e.state,c=o.wrap;if(c===2||c===1&&o.status!==ay||o.lookahead)return od;if(c===1&&(e.adler=l0(e.adler,t,r,0)),o.wrap=0,r>=o.w_size){c===0&&(kp(o.head),o.strstart=0,o.block_start=0,o.insert=0);let g=new Uint8Array(o.w_size);g.set(t.subarray(r-o.w_size,r),0),t=g,r=o.w_size}let u=e.avail_in,h=e.next_in,m=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,cy(o);o.lookahead>=3;){let g=o.strstart,y=o.lookahead-2;do o.ins_h=Dp(o,o.ins_h,o.window[g+3-1]),o.prev[g&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=g,g++;while(--y);o.strstart=g,o.lookahead=2,cy(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,e.next_in=h,e.input=m,e.avail_in=u,o.wrap=c,fo},f0={deflateInit:(e,t)=>QH(e,t,xI,15,8,Qpe),deflateInit2:QH,deflateReset:$H,deflateResetKeep:JH,deflateSetHeader:(e,t)=>p0(e)||e.state.wrap!==2?od:(e.state.gzhead=t,fo),deflate:ofe,deflateEnd:e=>{if(p0(e))return od;let t=e.state.status;return e.state=null,t===ig?sg(e,Ype):fo},deflateSetDictionary:afe,deflateInfo:"pako deflate (from Nodeca project)"};let cfe=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var LI={assign:function(e){let t=Array.prototype.slice.call(arguments,1);for(;t.length;){let r=t.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(let o in r)cfe(r,o)&&(e[o]=r[o])}}return e},flattenChunks:e=>{let t=0;for(let o=0,c=e.length;o<c;o++)t+=e[o].length;let r=new Uint8Array(t);for(let o=0,c=0,u=e.length;o<u;o++){let h=e[o];r.set(h,c),c+=h.length}return r}};let ZH=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{ZH=!1}let m0=new Uint8Array(256);for(let e=0;e<256;e++)m0[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;m0[254]=m0[254]=1;var g0={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,r,o,c,u,h=e.length,m=0;for(c=0;c<h;c++)r=e.charCodeAt(c),(64512&r)==55296&&c+1<h&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(r=65536+(r-55296<<10)+(o-56320),c++)),m+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(m),u=0,c=0;u<m;c++)r=e.charCodeAt(c),(64512&r)==55296&&c+1<h&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(r=65536+(r-55296<<10)+(o-56320),c++)),r<128?t[u++]=r:r<2048?(t[u++]=192|r>>>6,t[u++]=128|63&r):r<65536?(t[u++]=224|r>>>12,t[u++]=128|r>>>6&63,t[u++]=128|63&r):(t[u++]=240|r>>>18,t[u++]=128|r>>>12&63,t[u++]=128|r>>>6&63,t[u++]=128|63&r);return t},buf2string:(e,t)=>{let r=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let o,c,u=new Array(2*r);for(c=0,o=0;o<r;){let h=e[o++];if(h<128){u[c++]=h;continue}let m=m0[h];if(m>4)u[c++]=65533,o+=m-1;else{for(h&=m===2?31:m===3?15:7;m>1&&o<r;)h=h<<6|63&e[o++],m--;m>1?u[c++]=65533:h<65536?u[c++]=h:(h-=65536,u[c++]=55296|h>>10&1023,u[c++]=56320|1023&h)}}return((h,m)=>{if(m<65534&&h.subarray&&ZH)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let g="";for(let y=0;y<m;y++)g+=String.fromCharCode(h[y]);return g})(u,c)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&(192&e[r])==128;)r--;return r<0||r===0?t:r+m0[e[r]]>t?r:t}},ez=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};let tz=Object.prototype.toString,{Z_NO_FLUSH:lfe,Z_SYNC_FLUSH:ufe,Z_FULL_FLUSH:dfe,Z_FINISH:hfe,Z_OK:MI,Z_STREAM_END:pfe,Z_DEFAULT_COMPRESSION:ffe,Z_DEFAULT_STRATEGY:mfe,Z_DEFLATED:gfe}=kI;function UI(e){this.options=LI.assign({level:ffe,method:gfe,chunkSize:16384,windowBits:15,memLevel:8,strategy:mfe},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ez,this.strm.avail_out=0;let r=f0.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==MI)throw new Error(ng[r]);if(t.header&&f0.deflateSetHeader(this.strm,t.header),t.dictionary){let o;if(o=typeof t.dictionary=="string"?g0.string2buf(t.dictionary):tz.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,r=f0.deflateSetDictionary(this.strm,o),r!==MI)throw new Error(ng[r]);this._dict_set=!0}}function nz(e,t){let r=new UI(t);if(r.push(e,!0),r.err)throw r.msg||ng[r.err];return r.result}UI.prototype.push=function(e,t){let r=this.strm,o=this.options.chunkSize,c,u;if(this.ended)return!1;for(u=t===~~t?t:t===!0?hfe:lfe,typeof e=="string"?r.input=g0.string2buf(e):tz.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(r.avail_out===0&&(r.output=new Uint8Array(o),r.next_out=0,r.avail_out=o),(u===ufe||u===dfe)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(c=f0.deflate(r,u),c===pfe)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),c=f0.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===MI;if(r.avail_out!==0){if(u>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(r.avail_in===0)break}else this.onData(r.output)}return!0},UI.prototype.onData=function(e){this.chunks.push(e)},UI.prototype.onEnd=function(e){e===MI&&(this.result=LI.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var _fe={deflate:nz,deflateRaw:function(e,t){return(t=t||{}).raw=!0,nz(e,t)}};let VI=16209;var Efe=function(e,t){let r,o,c,u,h,m,g,y,v,R,b,A,F,M,j,K,q,Q,se,oe,te,de,Ce,Pe,Qe=e.state;r=e.next_in,Ce=e.input,o=r+(e.avail_in-5),c=e.next_out,Pe=e.output,u=c-(t-e.avail_out),h=c+(e.avail_out-257),m=Qe.dmax,g=Qe.wsize,y=Qe.whave,v=Qe.wnext,R=Qe.window,b=Qe.hold,A=Qe.bits,F=Qe.lencode,M=Qe.distcode,j=(1<<Qe.lenbits)-1,K=(1<<Qe.distbits)-1;e:do{A<15&&(b+=Ce[r++]<<A,A+=8,b+=Ce[r++]<<A,A+=8),q=F[b&j];t:for(;;){if(Q=q>>>24,b>>>=Q,A-=Q,Q=q>>>16&255,Q===0)Pe[c++]=65535&q;else{if(!(16&Q)){if(!(64&Q)){q=F[(65535&q)+(b&(1<<Q)-1)];continue t}if(32&Q){Qe.mode=16191;break e}e.msg="invalid literal/length code",Qe.mode=VI;break e}se=65535&q,Q&=15,Q&&(A<Q&&(b+=Ce[r++]<<A,A+=8),se+=b&(1<<Q)-1,b>>>=Q,A-=Q),A<15&&(b+=Ce[r++]<<A,A+=8,b+=Ce[r++]<<A,A+=8),q=M[b&K];n:for(;;){if(Q=q>>>24,b>>>=Q,A-=Q,Q=q>>>16&255,!(16&Q)){if(!(64&Q)){q=M[(65535&q)+(b&(1<<Q)-1)];continue n}e.msg="invalid distance code",Qe.mode=VI;break e}if(oe=65535&q,Q&=15,A<Q&&(b+=Ce[r++]<<A,A+=8,A<Q&&(b+=Ce[r++]<<A,A+=8)),oe+=b&(1<<Q)-1,oe>m){e.msg="invalid distance too far back",Qe.mode=VI;break e}if(b>>>=Q,A-=Q,Q=c-u,oe>Q){if(Q=oe-Q,Q>y&&Qe.sane){e.msg="invalid distance too far back",Qe.mode=VI;break e}if(te=0,de=R,v===0){if(te+=g-Q,Q<se){se-=Q;do Pe[c++]=R[te++];while(--Q);te=c-oe,de=Pe}}else if(v<Q){if(te+=g+v-Q,Q-=v,Q<se){se-=Q;do Pe[c++]=R[te++];while(--Q);if(te=0,v<se){Q=v,se-=Q;do Pe[c++]=R[te++];while(--Q);te=c-oe,de=Pe}}}else if(te+=v-Q,Q<se){se-=Q;do Pe[c++]=R[te++];while(--Q);te=c-oe,de=Pe}for(;se>2;)Pe[c++]=de[te++],Pe[c++]=de[te++],Pe[c++]=de[te++],se-=3;se&&(Pe[c++]=de[te++],se>1&&(Pe[c++]=de[te++]))}else{te=c-oe;do Pe[c++]=Pe[te++],Pe[c++]=Pe[te++],Pe[c++]=Pe[te++],se-=3;while(se>2);se&&(Pe[c++]=Pe[te++],se>1&&(Pe[c++]=Pe[te++]))}break}}break}}while(r<o&&c<h);se=A>>3,r-=se,A-=se<<3,b&=(1<<A)-1,e.next_in=r,e.next_out=c,e.avail_in=r<o?o-r+5:5-(r-o),e.avail_out=c<h?h-c+257:257-(c-h),Qe.hold=b,Qe.bits=A};let FI=15,yfe=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),vfe=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Sfe=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Tfe=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var _0=(e,t,r,o,c,u,h,m)=>{let g=m.bits,y,v,R,b,A,F,M=0,j=0,K=0,q=0,Q=0,se=0,oe=0,te=0,de=0,Ce=0,Pe=null,Qe=new Uint16Array(16),ot=new Uint16Array(16),Xt,Lt,jt,En=null;for(M=0;M<=FI;M++)Qe[M]=0;for(j=0;j<o;j++)Qe[t[r+j]]++;for(Q=g,q=FI;q>=1&&Qe[q]===0;q--);if(Q>q&&(Q=q),q===0)return c[u++]=20971520,c[u++]=20971520,m.bits=1,0;for(K=1;K<q&&Qe[K]===0;K++);for(Q<K&&(Q=K),te=1,M=1;M<=FI;M++)if(te<<=1,te-=Qe[M],te<0)return-1;if(te>0&&(e===0||q!==1))return-1;for(ot[1]=0,M=1;M<FI;M++)ot[M+1]=ot[M]+Qe[M];for(j=0;j<o;j++)t[r+j]!==0&&(h[ot[t[r+j]]++]=j);if(e===0?(Pe=En=h,F=20):e===1?(Pe=yfe,En=vfe,F=257):(Pe=Sfe,En=Tfe,F=0),Ce=0,j=0,M=K,A=u,se=Q,oe=0,R=-1,de=1<<Q,b=de-1,e===1&&de>852||e===2&&de>592)return 1;for(;;){Xt=M-oe,h[j]+1<F?(Lt=0,jt=h[j]):h[j]>=F?(Lt=En[h[j]-F],jt=Pe[h[j]-F]):(Lt=96,jt=0),y=1<<M-oe,v=1<<se,K=v;do v-=y,c[A+(Ce>>oe)+v]=Xt<<24|Lt<<16|jt|0;while(v!==0);for(y=1<<M-1;Ce&y;)y>>=1;if(y!==0?(Ce&=y-1,Ce+=y):Ce=0,j++,--Qe[M]==0){if(M===q)break;M=t[r+h[j]]}if(M>Q&&(Ce&b)!==R){for(oe===0&&(oe=Q),A+=K,se=M-oe,te=1<<se;se+oe<q&&(te-=Qe[se+oe],!(te<=0));)se++,te<<=1;if(de+=1<<se,e===1&&de>852||e===2&&de>592)return 1;R=Ce&b,c[R]=Q<<24|se<<16|A-u|0}}return Ce!==0&&(c[A+Ce]=M-oe<<24|64<<16|0),m.bits=Q,0};let{Z_FINISH:rz,Z_BLOCK:wfe,Z_TREES:jI,Z_OK:og,Z_STREAM_END:Cfe,Z_NEED_DICT:Rfe,Z_STREAM_ERROR:el,Z_DATA_ERROR:iz,Z_MEM_ERROR:sz,Z_BUF_ERROR:bfe,Z_DEFLATED:oz}=kI,BI=16180,WI=16190,ah=16191,gx=16192,_x=16194,GI=16199,HI=16200,Ex=16206,Mi=16209,az=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Ife(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}let ag=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.mode<BI||t.mode>16211?1:0},cz=e=>{if(ag(e))return el;let t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=BI,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,og},lz=e=>{if(ag(e))return el;let t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,cz(e)},uz=(e,t)=>{let r;if(ag(e))return el;let o=e.state;return t<0?(r=0,t=-t):(r=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?el:(o.window!==null&&o.wbits!==t&&(o.window=null),o.wrap=r,o.wbits=t,lz(e))},dz=(e,t)=>{if(!e)return el;let r=new Ife;e.state=r,r.strm=e,r.window=null,r.mode=BI;let o=uz(e,t);return o!==og&&(e.state=null),o},yx,vx,hz=!0,Afe=e=>{if(hz){yx=new Int32Array(512),vx=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(_0(1,e.lens,0,288,yx,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;_0(2,e.lens,0,32,vx,0,e.work,{bits:5}),hz=!1}e.lencode=yx,e.lenbits=9,e.distcode=vx,e.distbits=5},pz=(e,t,r,o)=>{let c,u=e.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),o>=u.wsize?(u.window.set(t.subarray(r-u.wsize,r),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>o&&(c=o),u.window.set(t.subarray(r-o,r-o+c),u.wnext),(o-=c)?(u.window.set(t.subarray(r-o,r),0),u.wnext=o,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0};var Ofe=(e,t)=>{let r,o,c,u,h,m,g,y,v,R,b,A,F,M,j,K,q,Q,se,oe,te,de,Ce=0,Pe=new Uint8Array(4),Qe,ot,Xt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(ag(e)||!e.output||!e.input&&e.avail_in!==0)return el;r=e.state,r.mode===ah&&(r.mode=gx),h=e.next_out,c=e.output,g=e.avail_out,u=e.next_in,o=e.input,m=e.avail_in,y=r.hold,v=r.bits,R=m,b=g,de=og;e:for(;;)switch(r.mode){case BI:if(r.wrap===0){r.mode=gx;break}for(;v<16;){if(m===0)break e;m--,y+=o[u++]<<v,v+=8}if(2&r.wrap&&y===35615){r.wbits===0&&(r.wbits=15),r.check=0,Pe[0]=255&y,Pe[1]=y>>>8&255,r.check=qs(r.check,Pe,2,0),y=0,v=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&y)<<8)+(y>>8))%31){e.msg="incorrect header check",r.mode=Mi;break}if((15&y)!==oz){e.msg="unknown compression method",r.mode=Mi;break}if(y>>>=4,v-=4,te=8+(15&y),r.wbits===0&&(r.wbits=te),te>15||te>r.wbits){e.msg="invalid window size",r.mode=Mi;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=512&y?16189:ah,y=0,v=0;break;case 16181:for(;v<16;){if(m===0)break e;m--,y+=o[u++]<<v,v+=8}if(r.flags=y,(255&Ds(r))!==oz){e.msg="unknown compression method",r.mode=Mi;break}if(57344&Ds(r)){e.msg="unknown header flags set",r.mode=Mi;break}r.head&&(r.head.text=y>>8&1),512&Ds(r)&&4&r.wrap&&(Pe[0]=255&y,Pe[1]=y>>>8&255,r.check=qs(r.check,Pe,2,0)),y=0,v=0,r.mode=16182;case 16182:for(;v<32;){if(m===0)break e;m--,y+=o[u++]<<v,v+=8}r.head&&(r.head.time=y),512&Ds(r)&&4&r.wrap&&(Pe[0]=255&y,Pe[1]=y>>>8&255,Pe[2]=y>>>16&255,Pe[3]=y>>>24&255,r.check=qs(r.check,Pe,4,0)),y=0,v=0,r.mode=16183;case 16183:for(;v<16;){if(m===0)break e;m--,y+=o[u++]<<v,v+=8}r.head&&(r.head.xflags=255&y,r.head.os=y>>8),512&Ds(r)&&4&r.wrap&&(Pe[0]=255&y,Pe[1]=y>>>8&255,r.check=qs(r.check,Pe,2,0)),y=0,v=0,r.mode=16184;case 16184:if(1024&Ds(r)){for(;v<16;){if(m===0)break e;m--,y+=o[u++]<<v,v+=8}r.length=y,r.head&&(r.head.extra_len=y),512&Ds(r)&&4&r.wrap&&(Pe[0]=255&y,Pe[1]=y>>>8&255,r.check=qs(r.check,Pe,2,0)),y=0,v=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&Ds(r)&&(A=r.length,A>m&&(A=m),A&&(r.head&&(te=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(o.subarray(u,u+A),te)),512&Ds(r)&&4&r.wrap&&(r.check=qs(r.check,o,A,u)),m-=A,u+=A,r.length-=A),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&Ds(r)){if(m===0)break e;A=0;do te=o[u+A++],r.head&&te&&r.length<65536&&(r.head.name+=String.fromCharCode(te));while(te&&A<m);if(512&Ds(r)&&4&r.wrap&&(r.check=qs(r.check,o,A,u)),m-=A,u+=A,te)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&Ds(r)){if(m===0)break e;A=0;do te=o[u+A++],r.head&&te&&r.length<65536&&(r.head.comment+=String.fromCharCode(te));while(te&&A<m);if(512&Ds(r)&&4&r.wrap&&(r.check=qs(r.check,o,A,u)),m-=A,u+=A,te)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&Ds(r)){for(;v<16;){if(m===0)break e;m--,y+=o[u++]<<v,v+=8}if(4&r.wrap&&y!==(65535&r.check)){e.msg="header crc mismatch",r.mode=Mi;break}y=0,v=0}r.head&&(r.head.hcrc=Ds(r)>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=ah;break;case 16189:for(;v<32;){if(m===0)break e;m--,y+=o[u++]<<v,v+=8}e.adler=r.check=az(y),y=0,v=0,r.mode=WI;case WI:if(r.havedict===0)return e.next_out=h,e.avail_out=g,e.next_in=u,e.avail_in=m,r.hold=y,r.bits=v,Rfe;e.adler=r.check=1,r.mode=ah;case ah:if(t===wfe||t===jI)break e;case gx:if(r.last){y>>>=7&v,v-=7&v,r.mode=Ex;break}for(;v<3;){if(m===0)break e;m--,y+=o[u++]<<v,v+=8}switch(r.last=1&y,y>>>=1,v-=1,3&y){case 0:r.mode=16193;break;case 1:if(Afe(r),r.mode=GI,t===jI){y>>>=2,v-=2;break e}break;case 2:r.mode=16196;break;case 3:e.msg="invalid block type",r.mode=Mi}y>>>=2,v-=2;break;case 16193:for(y>>>=7&v,v-=7&v;v<32;){if(m===0)break e;m--,y+=o[u++]<<v,v+=8}if((65535&y)!=(y>>>16^65535)){e.msg="invalid stored block lengths",r.mode=Mi;break}if(r.length=65535&y,y=0,v=0,r.mode=_x,t===jI)break e;case _x:r.mode=16195;case 16195:if(A=r.length,A){if(A>m&&(A=m),A>g&&(A=g),A===0)break e;c.set(o.subarray(u,u+A),h),m-=A,u+=A,g-=A,h+=A,r.length-=A;break}r.mode=ah;break;case 16196:for(;v<14;){if(m===0)break e;m--,y+=o[u++]<<v,v+=8}if(r.nlen=257+(31&y),y>>>=5,v-=5,r.ndist=1+(31&y),y>>>=5,v-=5,r.ncode=4+(15&y),y>>>=4,v-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=Mi;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;v<3;){if(m===0)break e;m--,y+=o[u++]<<v,v+=8}r.lens[Xt[r.have++]]=7&y,y>>>=3,v-=3}for(;r.have<19;)r.lens[Xt[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,Qe={bits:r.lenbits},de=_0(0,r.lens,0,19,r.lencode,0,r.work,Qe),r.lenbits=Qe.bits,de){e.msg="invalid code lengths set",r.mode=Mi;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;Ce=r.lencode[y&(1<<r.lenbits)-1],j=Ce>>>24,K=Ce>>>16&255,q=65535&Ce,!(j<=v);){if(m===0)break e;m--,y+=o[u++]<<v,v+=8}if(q<16)y>>>=j,v-=j,r.lens[r.have++]=q;else{if(q===16){for(ot=j+2;v<ot;){if(m===0)break e;m--,y+=o[u++]<<v,v+=8}if(y>>>=j,v-=j,r.have===0){e.msg="invalid bit length repeat",r.mode=Mi;break}te=r.lens[r.have-1],A=3+(3&y),y>>>=2,v-=2}else if(q===17){for(ot=j+3;v<ot;){if(m===0)break e;m--,y+=o[u++]<<v,v+=8}y>>>=j,v-=j,te=0,A=3+(7&y),y>>>=3,v-=3}else{for(ot=j+7;v<ot;){if(m===0)break e;m--,y+=o[u++]<<v,v+=8}y>>>=j,v-=j,te=0,A=11+(127&y),y>>>=7,v-=7}if(r.have+A>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=Mi;break}for(;A--;)r.lens[r.have++]=te}}if(r.mode===Mi)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=Mi;break}if(r.lenbits=9,Qe={bits:r.lenbits},de=_0(1,r.lens,0,r.nlen,r.lencode,0,r.work,Qe),r.lenbits=Qe.bits,de){e.msg="invalid literal/lengths set",r.mode=Mi;break}if(r.distbits=6,r.distcode=r.distdyn,Qe={bits:r.distbits},de=_0(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,Qe),r.distbits=Qe.bits,de){e.msg="invalid distances set",r.mode=Mi;break}if(r.mode=GI,t===jI)break e;case GI:r.mode=HI;case HI:if(m>=6&&g>=258){e.next_out=h,e.avail_out=g,e.next_in=u,e.avail_in=m,r.hold=y,r.bits=v,Efe(e,b),h=e.next_out,c=e.output,g=e.avail_out,u=e.next_in,o=e.input,m=e.avail_in,y=r.hold,v=r.bits,r.mode===ah&&(r.back=-1);break}for(r.back=0;Ce=r.lencode[y&(1<<r.lenbits)-1],j=Ce>>>24,K=Ce>>>16&255,q=65535&Ce,!(j<=v);){if(m===0)break e;m--,y+=o[u++]<<v,v+=8}if(K&&!(240&K)){for(Q=j,se=K,oe=q;Ce=r.lencode[oe+((y&(1<<Q+se)-1)>>Q)],j=Ce>>>24,K=Ce>>>16&255,q=65535&Ce,!(Q+j<=v);){if(m===0)break e;m--,y+=o[u++]<<v,v+=8}y>>>=Q,v-=Q,r.back+=Q}if(y>>>=j,v-=j,r.back+=j,r.length=q,K===0){r.mode=16205;break}if(32&K){r.back=-1,r.mode=ah;break}if(64&K){e.msg="invalid literal/length code",r.mode=Mi;break}r.extra=15&K,r.mode=16201;case 16201:if(r.extra){for(ot=r.extra;v<ot;){if(m===0)break e;m--,y+=o[u++]<<v,v+=8}r.length+=y&(1<<r.extra)-1,y>>>=r.extra,v-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;Ce=r.distcode[y&(1<<r.distbits)-1],j=Ce>>>24,K=Ce>>>16&255,q=65535&Ce,!(j<=v);){if(m===0)break e;m--,y+=o[u++]<<v,v+=8}if(!(240&K)){for(Q=j,se=K,oe=q;Ce=r.distcode[oe+((y&(1<<Q+se)-1)>>Q)],j=Ce>>>24,K=Ce>>>16&255,q=65535&Ce,!(Q+j<=v);){if(m===0)break e;m--,y+=o[u++]<<v,v+=8}y>>>=Q,v-=Q,r.back+=Q}if(y>>>=j,v-=j,r.back+=j,64&K){e.msg="invalid distance code",r.mode=Mi;break}r.offset=q,r.extra=15&K,r.mode=16203;case 16203:if(r.extra){for(ot=r.extra;v<ot;){if(m===0)break e;m--,y+=o[u++]<<v,v+=8}r.offset+=y&(1<<r.extra)-1,y>>>=r.extra,v-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=Mi;break}r.mode=16204;case 16204:if(g===0)break e;if(A=b-g,r.offset>A){if(A=r.offset-A,A>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=Mi;break}A>r.wnext?(A-=r.wnext,F=r.wsize-A):F=r.wnext-A,A>r.length&&(A=r.length),M=r.window}else M=c,F=h-r.offset,A=r.length;A>g&&(A=g),g-=A,r.length-=A;do c[h++]=M[F++];while(--A);r.length===0&&(r.mode=HI);break;case 16205:if(g===0)break e;c[h++]=r.length,g--,r.mode=HI;break;case Ex:if(r.wrap){for(;v<32;){if(m===0)break e;m--,y|=o[u++]<<v,v+=8}if(b-=g,e.total_out+=b,r.total+=b,4&r.wrap&&b&&(e.adler=r.check=Ds(r)?qs(r.check,c,b,h-b):l0(r.check,c,b,h-b)),b=g,4&r.wrap&&(Ds(r)?y:az(y))!==r.check){e.msg="incorrect data check",r.mode=Mi;break}y=0,v=0}r.mode=16207;case 16207:if(r.wrap&&Ds(r)){for(;v<32;){if(m===0)break e;m--,y+=o[u++]<<v,v+=8}if(4&r.wrap&&y!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=Mi;break}y=0,v=0}r.mode=16208;case 16208:de=Cfe;break e;case Mi:de=iz;break e;case 16210:return sz;default:return el}return e.next_out=h,e.avail_out=g,e.next_in=u,e.avail_in=m,r.hold=y,r.bits=v,(r.wsize||b!==e.avail_out&&r.mode<Mi&&(r.mode<Ex||t!==rz))&&pz(e,e.output,e.next_out,b-e.avail_out),R-=e.avail_in,b-=e.avail_out,e.total_in+=R,e.total_out+=b,r.total+=b,4&r.wrap&&b&&(e.adler=r.check=Ds(r)?qs(r.check,c,b,e.next_out-b):l0(r.check,c,b,e.next_out-b)),e.data_type=r.bits+(r.last?64:0)+(r.mode===ah?128:0)+(r.mode===GI||r.mode===_x?256:0),(R===0&&b===0||t===rz)&&de===og&&(de=bfe),de},ch={inflateReset:lz,inflateReset2:uz,inflateResetKeep:cz,inflateInit:e=>dz(e,15),inflateInit2:dz,inflate:Ofe,inflateEnd:e=>{if(ag(e))return el;let t=e.state;return t.window&&(t.window=null),e.state=null,og},inflateGetHeader:(e,t)=>{if(ag(e))return el;let r=e.state;return 2&r.wrap?(r.head=t,t.done=!1,og):el},inflateSetDictionary:(e,t)=>{let r=t.length,o,c,u;return ag(e)?el:(o=e.state,o.wrap!==0&&o.mode!==WI?el:o.mode===WI&&(c=1,c=l0(c,t,r,0),c!==o.check)?iz:(u=pz(e,t,r,r),u?(o.mode=16210,sz):(o.havedict=1,og)))},inflateInfo:"pako inflate (from Nodeca project)"},Nfe=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};let fz=Object.prototype.toString,{Z_NO_FLUSH:Pfe,Z_FINISH:kfe,Z_OK:E0,Z_STREAM_END:Sx,Z_NEED_DICT:Tx,Z_STREAM_ERROR:Dfe,Z_DATA_ERROR:mz,Z_MEM_ERROR:xfe}=kI;function zI(e){this.options=LI.assign({chunkSize:65536,windowBits:15,to:""},e||{});let t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ez,this.strm.avail_out=0;let r=ch.inflateInit2(this.strm,t.windowBits);if(r!==E0)throw new Error(ng[r]);if(this.header=new Nfe,ch.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=g0.string2buf(t.dictionary):fz.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=ch.inflateSetDictionary(this.strm,t.dictionary),r!==E0)))throw new Error(ng[r])}function gz(e,t){let r=new zI(t);if(r.push(e),r.err)throw r.msg||ng[r.err];return r.result}zI.prototype.push=function(e,t){let r=this.strm,o=this.options.chunkSize,c=this.options.dictionary,u,h,m;if(this.ended)return!1;for(h=t===~~t?t:t===!0?kfe:Pfe,fz.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(o),r.next_out=0,r.avail_out=o),u=ch.inflate(r,h),u===Tx&&c&&(u=ch.inflateSetDictionary(r,c),u===E0?u=ch.inflate(r,h):u===mz&&(u=Tx));r.avail_in>0&&u===Sx&&r.state.wrap>0&&e[r.next_in]!==0;)ch.inflateReset(r),u=ch.inflate(r,h);switch(u){case Dfe:case mz:case Tx:case xfe:return this.onEnd(u),this.ended=!0,!1}if(m=r.avail_out,r.next_out&&(r.avail_out===0||u===Sx))if(this.options.to==="string"){let g=g0.utf8border(r.output,r.next_out),y=r.next_out-g,v=g0.buf2string(r.output,g);r.next_out=y,r.avail_out=o-y,y&&r.output.set(r.output.subarray(g,g+y),0),this.onData(v)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(u!==E0||m!==0){if(u===Sx)return u=ch.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(r.avail_in===0)break}}return!0},zI.prototype.onData=function(e){this.chunks.push(e)},zI.prototype.onEnd=function(e){e===E0&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=LI.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Lfe={inflate:gz,inflateRaw:function(e,t){return(t=t||{}).raw=!0,gz(e,t)}};let{deflate:Mfe,deflateRaw:Ufe}=_fe,{inflate:Vfe,inflateRaw:Ffe}=Lfe;var jfe=Mfe,Bfe=Ufe,Wfe=Vfe,Gfe=Ffe,_z=(function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e})(_z||{});class Hfe{constructor(){V(this,"_sequence",0),V(this,"_startTime",Date.now()),V(this,"isUseOneByte",!0)}get startTime(){let t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){let r={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){let m=new Uint8Array(4);m.set([1,0,0,0]);let g={id:0,length:4,data:m.buffer},y={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[g]};r.commonPacketHeader.extension=1,r.extension=y,r.payload=this.compress(t),r.commonPacketHeader.length=8+(r.extension.length+2)+r.payload.byteLength}else r.commonPacketHeader.length=8+r.payload.byteLength;z("SHOW_DATASTREAM2_LOG")&&k.debug("send data header: ".concat(JSON.stringify(r.commonPacketHeader)));let o=new ArrayBuffer(r.commonPacketHeader.length),c=new Uint8Array(o),u=new DataView(o),h=0;if(u.setUint16(h,r.commonPacketHeader.extension<<15|r.commonPacketHeader.reserved<<14|r.commonPacketHeader.length,!0),h+=2,u.setUint32(h,r.commonPacketHeader.sequence,!0),h+=4,u.setUint16(h,r.commonStreamHeader,!0),h+=2,r.extension){let m=this.serializeExtension(r.extension);c.set(new Uint8Array(m),h),h+=m.byteLength}if(c.set(new Uint8Array(r.payload),h),h+=r.payload.byteLength,h!==r.commonPacketHeader.length)throw Error("serialize error!");return o}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);let r=new DataView(t),o=0,c=r.getUint16(o,!0);o+=2;let u={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:r.getUint16(o+2,!0)<<16|r.getUint16(o,!0)},h,m;if(o+=4,z("SHOW_DATASTREAM2_LOG")&&k.debug("receive data header: ".concat(JSON.stringify(u))),r.getUint16(o,!0),o+=2,u.extension){m=this.deserializeExtension(t.slice(o)),o+=2+m.length,h=t.slice(o);let g=!1;if(m.datas.length>0){let y=m.datas.find(v=>v.id===0);y&&(g=(1&new DataView(y.data).getUint32(0,!0))==1)}h=g?this.decompress(h):h}else h=t.slice(8);return h}serializeExtension(t){let{profile:r,length:o,datas:c}=t,u=new ArrayBuffer(o+2),h=new Uint8Array(u),m=new DataView(u),g=0;if(m.setUint8(g++,r),m.setUint8(g++,o),c.forEach(y=>{r?(m.setUint8(g++,y.id),m.setUint8(g++,y.length),h.set(new Uint8Array(y.data),g),g+=y.data.byteLength):(m.setUint8(g++,y.id|y.length<<4),h.set(new Uint8Array(y.data),g),g+=y.data.byteLength)}),g!==o+2)throw Error("serialize extension error, is ".concat(g,"!==").concat(o+2));return u}deserializeExtension(t){let r=new DataView(t),o=0,c=r.getUint8(o);o++;let u=r.getUint8(o);o++;let h=c===_z.TWO_BYTE,m=[],g=new DataView(t,2),y=0;for(;y<u;){let v=0,R=0,b=new ArrayBuffer(0);h?(v=g.getUint8(y),y++,R=g.getUint8(y),y++):(v=15&g.getUint8(y),R=g.getUint8(y)>>4,y++),R>0&&(b=g.buffer.slice(y+2,y+2+R),y+=b.byteLength),m.push({id:v,length:R,data:b})}if(y!==u)throw Error("parse error");return{profile:c,length:u,datas:m}}decompress(t){return Wfe(new Uint8Array(t))}compress(t){return jfe(new Uint8Array(t))}}let zfe={name:"DataStream",create:(e,t)=>{let r=t?new qde(e):new Xde(e);return r.useDataStream(new Hfe),r}};class Kfe extends dr{constructor(t,r,o){super(),V(this,"ws",void 0),V(this,"requestId",1),V(this,"heartBeatTimer",void 0),V(this,"joinInfo",void 0),V(this,"clientId",void 0),V(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),V(this,"onClose",c=>{this.emit("close"),this.dispose()}),V(this,"onMessage",c=>{let u=JSON.parse(c.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)}),this.joinInfo=t,this.clientId=r,this.ws=new WT("cross-channel-".concat(this.clientId),o),this.ws.on(Ot.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Ot.CONNECTED,this.onOpen),this.ws.on(Ot.ON_MESSAGE,this.onMessage),this.ws.on(Ot.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){let r=this.requestId++;return t.requestId=r,t.seq=r,this.ws.sendMessage(t),r}waitStatus(t){return new ze((r,o)=>{let c=window.setTimeout(()=>{o(new he(Y.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,u=>{window.clearTimeout(c),u.state&&u.state!==0?o(new he(Y.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):r(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),o(new he(Y.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new he(Y.WS_DISCONNECT);let r=()=>new ze((h,m)=>{this.ws.once(Ot.CLOSED,()=>m(new he(Y.WS_ABORT))),this.ws.once(Ot.CONNECTED,h)});this.ws.state!=="connected"&&await r();let o=this.sendMessage(t),c=new ze((h,m)=>{let g=()=>{m(new he(Y.WS_ABORT))};this.ws.once(Ot.RECONNECTING,g),this.ws.once(Ot.CLOSED,g),this.once("req_".concat(o),h),Ci(3e3).then(()=>{this.removeAllListeners("req_".concat(o)),this.ws.off(Ot.RECONNECTING,g),this.ws.off(Ot.CLOSED,g),m(new he(Y.TIMEOUT,"cross channel ws request timeout"))})}),u=await c;if(!u||u.code!==200)throw new he(Y.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(t){this.ws.removeAllListeners(Ot.REQUEST_NEW_URLS),this.ws.on(Ot.REQUEST_NEW_URLS,r=>{r(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){let r=this.requestId++;return t.requestId=r,this.ws.sendMessage(t),r}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Yfe extends dr{set state(t){t!==this._state&&(t!==Ao.RELAY_STATE_FAILURE&&(this.errorCode=KE.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,r,o,c,u){super(),V(this,"joinInfo",void 0),V(this,"sid",void 0),V(this,"clientId",void 0),V(this,"cancelToken",ao.CancelToken.source()),V(this,"workerToken",void 0),V(this,"requestId",0),V(this,"signal",void 0),V(this,"prevChannelMediaConfig",void 0),V(this,"httpRetryConfig",void 0),V(this,"_resolution",void 0),V(this,"_state",Ao.RELAY_STATE_IDLE),V(this,"errorCode",KE.RELAY_OK),V(this,"onStatus",h=>{k.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",rh.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",rh.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=KE.SRC_TOKEN_EXPIRED,this.state=Ao.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=KE.DEST_TOKEN_EXPIRED,this.state=Ao.RELAY_STATE_FAILURE))}),V(this,"onReconnect",async()=>{k.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",rh.NETWORK_DISCONNECTED),this.state=Ao.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==Ao.RELAY_STATE_IDLE&&(k.error("auto restart channel media relay failed",h.toString()),this.errorCode=KE.SERVER_CONNECTION_LOST,this.state=Ao.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=r,this.sid=Um(),this.signal=new Kfe(this.joinInfo,this.clientId,o),this.httpRetryConfig=c,this._resolution=u}async startChannelMediaRelay(t){if(this.state!==Ao.RELAY_STATE_IDLE)throw new he(Y.INVALID_OPERATION);this.state=Ao.RELAY_STATE_CONNECTING,await this.connect(),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(r){throw r.data&&r.data.serverResponse&&r.data.serverResponse.command==="SetSourceChannel"?new he(Y.CROSS_CHANNEL_FAILED_JOIN_SRC):r.data&&r.data.serverResponse&&r.serverResponse.command==="SetDestChannelStatus"?new he(Y.CROSS_CHANNEL_FAILED_JOIN_DEST):r.data&&r.data.serverResponse&&r.serverResponse.command==="StartPacketTransfer"?new he(Y.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):r}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==Ao.RELAY_STATE_RUNNING)throw new he(Y.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==Ao.RELAY_STATE_RUNNING)throw new he(Y.INVALID_OPERATION);let r=this.genMessage(uo.SetVideoProfile);await this.signal.request(r),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),k.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Ao.RELAY_STATE_IDLE,this.dispose()}dispose(){k.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=ao.CancelToken.source(),this.state=Ao.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){let t=await Zhe(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",rh.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){let r=this.genMessage(uo.SetSdkProfile,t);await this.signal.request(r),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));let o=this.genMessage(uo.SetSourceChannel,t);await this.signal.request(o),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",rh.PACKET_JOINED_SRC_CHANNEL),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));let c=this.genMessage(uo.SetSourceUserId,t);await this.signal.request(c),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));let u=this.genMessage(uo.SetDestChannel,t);await this.signal.request(u),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",rh.PACKET_JOINED_DEST_CHANNEL),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));let h=this.genMessage(uo.StartPacketTransfer,t);await this.signal.request(h),this.emit("event",rh.PACKET_SENT_TO_DEST_CHANNEL),this.state=Ao.RELAY_STATE_RUNNING,k.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){let r=this.genMessage(uo.UpdateDestChannel,t);await this.signal.request(r),this.emit("event",rh.PACKET_UPDATE_DEST_CHANNEL),k.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){let t=this.genMessage(uo.StopPacketTransfer);await this.signal.request(t),k.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,r){let o=[],c=[],u=[];this.requestId+=1;let h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Ja,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.24.2"&&(h.sdkVersion="0.0.1");let m=null,g=null;switch(t){case uo.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case uo.SetSourceChannel:if(g=r&&r.getSrcChannelMediaInfo(),!g)throw new he(Y.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:g.channelName,token:g.token||this.joinInfo.appId},h;case uo.SetSourceUserId:if(g=r&&r.getSrcChannelMediaInfo(),!g)throw new he(Y.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:g.uid+""},h;case uo.SetDestChannel:if(m=r&&r.getDestChannelMediaInfo(),!m)throw new he(Y.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(y=>{o.push(y.channelName),c.push(y.uid+""),u.push(y.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:o,uid:c,token:u},h;case uo.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case uo.Reconnect:return h.clientRequest={command:"Reconnect"},h;case uo.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case uo.UpdateDestChannel:if(m=r&&r.getDestChannelMediaInfo(),!m)throw new he(Y.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(y=>{o.push(y.channelName),c.push(y.uid+""),u.push(y.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:o,uid:c,token:u},h;case uo.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}let qfe={name:"ChannelMediaRelay",create:function(e){return new Yfe(e.joinInfo,e.clientId,e.websocketRetryConfig||Kr,e.httpRetryConfig||Kr,e.resolution)}};function Ez(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function y0(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Ez(Object(r),!0).forEach(function(o){V(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ez(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}class Xfe extends dr{constructor(t,r,o,c){super(),V(this,"spec",void 0),V(this,"token",void 0),V(this,"websocket",void 0),V(this,"pingpongTimer",void 0),V(this,"reconnectMode","retry"),V(this,"serviceMode",void 0),V(this,"reqId",0),V(this,"commandReqId",0),V(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),V(this,"handleWebSocketMessage",u=>{if(!u.data)return;let h=JSON.parse(u.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(tt.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===nh.TRANSCODE?1:2}),this.emit(Sp.PUBLISH_STREAM_STATUS,h))}),this.spec=r,this.token=t,this.serviceMode=c,this.websocket=new WT("live-streaming",o),this.websocket.on(Ot.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Ot.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Ot.REQUEST_NEW_URLS,(u,h)=>{ei(this,Sp.REQUEST_NEW_ADDRESS).then(u).catch(h)}),this.websocket.on(Ot.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,r,o,c){this.reqId+=1,t==="request"&&(this.commandReqId+=1);let u=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new he(Y.UNEXPECTED_ERROR);let m=y0({command:t,sdkVersion:Ja==="4.24.2"?"0.0.1":Ja,seq:h,requestId:h,allocate:o,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},r);if(this.websocket.state==="closed")throw new he(Y.WS_DISCONNECT);let g=()=>new ze((b,A)=>{this.websocket.once(Ot.CLOSED,()=>A(new he(Y.WS_ABORT))),this.websocket.once(Ot.CONNECTED,b)});this.websocket.state!=="connected"&&await g(),m.clientRequest&&(m.clientRequest.workerToken=this.token);let y=new ze((b,A)=>{let F=()=>{A(new he(Y.WS_ABORT))};this.websocket.once(Ot.RECONNECTING,F),this.websocket.once(Ot.CLOSED,F),this.once("@".concat(h,"-").concat(this.spec.sid),M=>{b(M)})});c&&tt.workerEvent(this.spec.sid,y0(y0({},c),{},{requestId:u,actionType:"request",payload:JSON.stringify(r.clientRequest),serverCode:0,code:0}));let v=Date.now();this.websocket.sendMessage(m);let R=null;try{R=await y}catch(b){if(this.websocket.state==="closed")throw b;return await g(),await this.request(t,r,o)}return c&&tt.workerEvent(this.spec.sid,y0(y0({},c),{},{requestId:u,actionType:"response",payload:JSON.stringify(R.serverResponse),serverCode:R.code,success:R.code===200,responseTime:Date.now()-v})),R.code!==200&&this.handleResponseError(R),R}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let t=Ja==="4.24.2"?"0.0.1":Ja;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case ci.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void k.warning("live stream response already exists stream");case ci.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case ci.LIVE_STREAM_RESPONSE_BAD_STREAM:case ci.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new he(Y.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case ci.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new he(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case ci.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new he(Y.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case ci.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let r=new he(Y.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Sp.WARNING,r,t.serverResponse.url)}case ci.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{let r=new he(Y.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Sp.WARNING,r,t.serverResponse.url)}case ci.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new he(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case ci.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new he(Y.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case ci.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{let r=new he(Y.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Sp.WARNING,r,t.serverResponse.url)}case ci.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new he(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case ci.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new he(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case ci.LIVE_STREAM_RESPONSE_WORKER_LOST:case ci.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new he(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case ci.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new he(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new he(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case ci.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case ci.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case ci.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case ci.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new he(Y.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(xT)},6e3)}}function yz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function No(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?yz(Object(r),!0).forEach(function(o){V(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yz(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}class Jfe extends dr{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Kr,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Kr;super(),V(this,"onLiveStreamWarning",void 0),V(this,"onLiveStreamError",void 0),V(this,"spec",void 0),V(this,"retryTimeout",1e4),V(this,"connection",void 0),V(this,"httpRetryConfig",void 0),V(this,"wsRetryConfig",void 0),V(this,"streamingTasks",new Map),V(this,"isStartingStreamingTask",!1),V(this,"taskMutex",new ki("live-streaming")),V(this,"cancelToken",ao.CancelToken.source()),V(this,"transcodingConfig",void 0),V(this,"uapResponse",void 0),V(this,"lastTaskId",1),V(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=o,this.wsRetryConfig=r}async setTranscodingConfig(t){let r=No(No({},khe),t);r.videoCodecProfile!==66&&r.videoCodecProfile!==77&&r.videoCodecProfile!==100&&(k.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(r.videoCodecProfile," -> 100")),r.videoCodecProfile=100),r.transcodingUsers||(r.transcodingUsers=r.userConfigs),r.transcodingUsers&&(r.transcodingUsers=r.transcodingUsers.map(h=>No(No(No({},Phe),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),(function(h){wr(h.width)||Vn(h.width,"config.width",0,1e4),wr(h.height)||Vn(h.height,"config.height",0,1e4),wr(h.videoBitrate)||Vn(h.videoBitrate,"config.videoBitrate",1,1e6),wr(h.videoFrameRate)||Vn(h.videoFrameRate,"config.videoFrameRate"),wr(h.lowLatency)||Wc(h.lowLatency,"config.lowLatency"),wr(h.audioSampleRate)||zr(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),wr(h.audioBitrate)||Vn(h.audioBitrate,"config.audioBitrate",1,128),wr(h.audioChannels)||zr(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),wr(h.videoGop)||Vn(h.videoGop,"config.videoGop"),wr(h.videoCodecProfile)||zr(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),wr(h.userCount)||Vn(h.userCount,"config.userCount",0,17),wr(h.backgroundColor)||Vn(h.backgroundColor,"config.backgroundColor",0,16777215),wr(h.userConfigExtraInfo)||Hi(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!wr(h.transcodingUsers)&&(eh(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((m,g)=>{tI(m.uid),wr(m.x)||Vn(m.x,"transcodingUser[".concat(g,"].x"),0,1e4),wr(m.y)||Vn(m.y,"transcodingUser[".concat(g,"].y"),0,1e4),wr(m.width)||Vn(m.width,"transcodingUser[".concat(g,"].width"),0,1e4),wr(m.height)||Vn(m.height,"transcodingUser[".concat(g,"].height"),0,1e4),wr(m.zOrder)||Vn(m.zOrder-1,"transcodingUser[".concat(g,"].zOrder"),0,100),wr(m.alpha)||Vn(m.alpha,"transcodingUser[".concat(g,"].alpha"),0,1,!1)})),wr(h.watermark)||hD(h.watermark,"watermark"),wr(h.backgroundImage)||hD(h.backgroundImage,"backgroundImage"),h.images&&!wr(h.images)&&(eh(h.images,"config.images"),h.images.forEach((m,g)=>{hD(m,"images[".concat(g,"]"))}))})(r);let o=[];r.images&&o.push(...r.images.map(h=>No(No(No({},dD),h),{},{zOrder:255}))),r.backgroundImage&&(o.push(No(No(No({},dD),r.backgroundImage),{},{zOrder:0})),delete r.backgroundImage),r.watermark&&(o.push(No(No(No({},dD),r.watermark),{},{zOrder:255})),delete r.watermark),r.images=o,r.transcodingUsers&&(r.userConfigs=r.transcodingUsers.map(h=>No({},h)),r.userCount=r.transcodingUsers.length,delete r.transcodingUsers);let c=(r.userConfigs||[]).map(h=>typeof h.uid=="number"?ze.resolve(h.uid):jG(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await ze.all(c)).forEach((h,m)=>{r.userConfigs&&r.userConfigs[m]&&(r.userConfigs[m].uid=h)}),this.transcodingConfig=r,this.connection)try{var u;let h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Yo(u=this.streamingTasks).call(u)).map(m=>m.taskId).join("#")});k.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{k.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then(()=>{k.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(g=>{k.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,g.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,g)})})}}async startLiveStreamingTask(t,r,o){if(!this.transcodingConfig&&r===nh.TRANSCODE)throw new he(Y.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let c={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};k.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(r));let u=await this.taskMutex.lock();if(!this.connection&&o)return void u();if(this.streamingTasks.get(t)&&!o)return u(),new he(Y.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(r))}catch(m){throw u(),m}r===nh.TRANSCODE&&(c.transcodingConfig=No({},this.transcodingConfig)),this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;let h=this.lastTaskId++;try{let m=new ze((y,v)=>{Ci(this.retryTimeout).then(()=>{if(o)return v(o);let R=this.statusError.get(t);return R?(this.statusError.delete(t),v(R)):void 0})}),g=await ze.race([this.connection.request("request",{clientRequest:c},!0,{url:t,command:"PublishStream",workerType:r===nh.TRANSCODE?1:2,requestByUser:!o,tid:h.toString()}),m]);this.isStartingStreamingTask=!1,k.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(g.code)),this.streamingTasks.set(t,{clientRequest:c,mode:r,url:t,taskId:h}),u()}catch(m){if(u(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||o)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,r,m)):await this.startLiveStreamingTask(t,r,m)}}stopLiveStreamingTask(t){return new ze((r,o)=>{let c=this.streamingTasks.get(t);if(!c||!this.connection)return new he(Y.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let u=c.mode;c.abortTask=()=>{k.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),r()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:t,command:"UnPublishStream",workerType:u===nh.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{k.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),r()}).catch(o)})}resetAllTask(){var t;let r=Array.from(Yo(t=this.streamingTasks).call(t));this.terminate();for(let o of r)this.startLiveStreamingTask(o.url,o.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(o.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=ao.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new he(Y.UNEXPECTED_ERROR,"live streaming connection has already connected");let r=await ei(this,pD.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=r,this.connection=new Xfe(r.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Sp.WARNING,(o,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,o)),this.connection.on(Sp.PUBLISH_STREAM_STATUS,o=>this.handlePublishStreamServer(o)),this.connection.on(Sp.REQUEST_NEW_ADDRESS,(o,c)=>{if(!this.connection)return c(new he(Y.UNEXPECTED_ERROR,"can not get new live streaming address list"));ei(this,pD.REQUEST_WORKER_MANAGER_LIST,t).then(u=>{this.uapResponse=u,o(u.addressList)}).catch(c)}),await this.connection.init(r.addressList),this.connection}handlePublishStreamServer(t){let r=t.serverStatus&&t.serverStatus.url||"empty_url",o=this.streamingTasks.get(r),c=t.reason;switch(t.code){case ci.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case ci.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case ci.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case ci.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{let h=new he(Y.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(o)return k.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(r,h);if(!this.isStartingStreamingTask)return;this.statusError.set(r,h)}case ci.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let h=new he(Y.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(r,h)}case ci.LIVE_STREAM_RESPONSE_WORKER_LOST:case ci.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();let h=Array.from(Yo(u=this.streamingTasks).call(u));for(let m of h)m.abortTask?m.abortTask():(k.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new he(Y.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{k.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(g=>{k.error(g.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,g)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}let $fe={name:"LiveStreaming",create:function(e){return new Jfe(e.joinInfo,e.websocketRetryConfig||Kr,e.httpRetryConfig||Kr)}};function Qfe(e){let t=Tz();return(function(r,o){let c=r.appId;c!==void 0&&(Pn(o,10),ld(o,c));let u=r.cid;u!==void 0&&(Pn(o,16),Pn(o,u));let h=r.cname;h!==void 0&&(Pn(o,26),ld(o,h));let m=r.deviceId;m!==void 0&&(Pn(o,34),ld(o,m));let g=r.elapse;g!==void 0&&(Pn(o,40),xp(o,g));let y=r.fileSize;y!==void 0&&(Pn(o,48),xp(o,uy(y)));let v=r.height;v!==void 0&&(Pn(o,56),xp(o,uy(v)));let R=r.jpg;R!==void 0&&(Pn(o,66),Pn(o,R.length),(function(lr,Re){let Ve=dy(lr,Re.length);lr.bytes.set(Re,Ve)})(o,R));let b=r.networkType;b!==void 0&&(Pn(o,72),xp(o,uy(b)));let A=r.osType;A!==void 0&&(Pn(o,80),xp(o,uy(A)));let F=r.requestId;F!==void 0&&(Pn(o,90),ld(o,F));let M=r.sdkVersion;M!==void 0&&(Pn(o,98),ld(o,M));let j=r.sequence;j!==void 0&&(Pn(o,104),xp(o,uy(j)));let K=r.sid;K!==void 0&&(Pn(o,114),ld(o,K));let q=r.timestamp;q!==void 0&&(Pn(o,120),xp(o,q));let Q=r.uid;Q!==void 0&&(Pn(o,128),Pn(o,Q));let se=r.vid;se!==void 0&&(Pn(o,136),Pn(o,se));let oe=r.width;oe!==void 0&&(Pn(o,144),xp(o,uy(oe)));let te=r.service;te!==void 0&&(Pn(o,152),Pn(o,te));let de=r.callbackData;de!==void 0&&(Pn(o,162),ld(o,de));let Ce=r.jpgEncryption;Ce!==void 0&&(Pn(o,168),Pn(o,Ce));let Pe=r.requestType;Pe!==void 0&&(Pn(o,176),Pn(o,Pe));let Qe=r.scorePorn;Qe!==void 0&&(Pn(o,185),Ix(o,Qe));let ot=r.scoreSexy;ot!==void 0&&(Pn(o,193),Ix(o,ot));let Xt=r.scoreNeutral;Xt!==void 0&&(Pn(o,201),Ix(o,Xt));let Lt=r.scene;Lt!==void 0&&(Pn(o,208),Pn(o,Lt));let jt=r.ossFilePrefix;jt!==void 0&&(Pn(o,218),ld(o,jt));let En=r.serviceVendor;if(En!==void 0)for(let lr of En){Pn(o,226);let Re=Tz();tme(lr,Re),Pn(o,Re.limit),sme(o,Re),ime(Re)}})(e,t),(function(r){let o=r.bytes,c=r.limit;return o.length===c?o:o.subarray(0,c)})(t)}function Zfe(e){return(function(r){let o={};e:for(;!wz(r);){let c=ud(r);switch(c>>>3){case 0:break e;case 1:o.code=ud(r);break;case 2:o.msg=Cz(r,ud(r));break;case 3:{let u=nme(r);o.data=eme(r),r.limit=u;break}default:vz(r,7&c)}}return o})({bytes:t=e,offset:0,limit:t.length});var t}function eme(e){let t={};e:for(;!wz(e);){let r=ud(e);switch(r>>>3){case 0:break e;case 1:t.requestId=Cz(e,ud(e));break;case 2:t.requestType=ud(e)>>>0;break;case 3:t.scorePorn=bx(e);break;case 4:t.scoreSexy=bx(e);break;case 5:t.scoreNeutral=bx(e);break;case 6:t.requestScene=ud(e)>>>0;break;case 7:t.scene=ud(e)>>>0;break;default:vz(e,7&r)}}return t}function tme(e,t){let r=e.service;r!==void 0&&(Pn(t,8),Pn(t,r));let o=e.vendor;o!==void 0&&(Pn(t,16),Pn(t,o));let c=e.token;c!==void 0&&(Pn(t,26),ld(t,c));let u=e.callbackUrl;u!==void 0&&(Pn(t,34),ld(t,u))}function nme(e){let t=ud(e),r=e.limit;return e.limit=e.offset+t,r}function vz(e,t){switch(t){case 0:for(;128&Rz(e););break;case 2:Cx(e,ud(e));break;case 5:Cx(e,4);break;case 1:Cx(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let rme=new Float32Array(1);new Uint8Array(rme.buffer);let wx=new Float64Array(1),Po=new Uint8Array(wx.buffer);function uy(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let Sz=[];function Tz(){let e=Sz.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function ime(e){Sz.push(e)}function Cx(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function wz(e){return e.offset>=e.limit}function dy(e,t){let r=e.bytes,o=e.offset,c=e.limit,u=o+t;if(u>r.length){let h=new Uint8Array(2*u);h.set(r),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),o}function Rx(e,t){let r=e.offset;if(r+t>e.limit)throw new Error("Read past limit");return e.offset+=t,r}function Cz(e,t){let r=Rx(e,t),o=String.fromCharCode,c=e.bytes,u="",h="";for(let m=0;m<t;m++){let g,y,v,R,b=c[m+r];128&b?(224&b)==192?m+1>=t?h+=u:(g=c[m+r+1],(192&g)!=128?h+=u:(R=(31&b)<<6|63&g,R<128?h+=u:(h+=o(R),m++))):(240&b)==224?m+2>=t?h+=u:(g=c[m+r+1],y=c[m+r+2],(49344&(g|y<<8))!=32896?h+=u:(R=(15&b)<<12|(63&g)<<6|63&y,R<2048||R>=55296&&R<=57343?h+=u:(h+=o(R),m+=2))):(248&b)==240?m+3>=t?h+=u:(g=c[m+r+1],y=c[m+r+2],v=c[m+r+3],(12632256&(g|y<<8|v<<16))!=8421504?h+=u:(R=(7&b)<<18|(63&g)<<12|(63&y)<<6|63&v,R<65536||R>1114111?h+=u:(R-=65536,h+=o(55296+(R>>10),56320+(1023&R)),m+=3))):h+=u:h+=o(b)}return h}function ld(e,t){let r=t.length,o=0;for(let h=0;h<r;h++){let m=t.charCodeAt(h);m>=55296&&m<=56319&&h+1<r&&(m=(m<<10)+t.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}Pn(e,o);let c=dy(e,o),u=e.bytes;for(let h=0;h<r;h++){let m=t.charCodeAt(h);m>=55296&&m<=56319&&h+1<r&&(m=(m<<10)+t.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function sme(e,t){let r=dy(e,t.limit),o=e.bytes,c=t.bytes;for(let u=0,h=t.limit;u<h;u++)o[u+r]=c[u]}function Rz(e){return e.bytes[Rx(e,1)]}function bz(e,t){let r=dy(e,1);e.bytes[r]=t}function bx(e){let t=Rx(e,8),r=e.bytes;return Po[0]=r[t++],Po[1]=r[t++],Po[2]=r[t++],Po[3]=r[t++],Po[4]=r[t++],Po[5]=r[t++],Po[6]=r[t++],Po[7]=r[t++],wx[0]}function Ix(e,t){let r=dy(e,8),o=e.bytes;wx[0]=t,o[r++]=Po[0],o[r++]=Po[1],o[r++]=Po[2],o[r++]=Po[3],o[r++]=Po[4],o[r++]=Po[5],o[r++]=Po[6],o[r++]=Po[7]}function ud(e){let t,r=0,o=0;do t=Rz(e),r<32&&(o|=(127&t)<<r),r+=7;while(128&t);return o}function Pn(e,t){for(t>>>=0;t>=128;)bz(e,127&t|128),t>>>=7;bz(e,t)}function xp(e,t){let r=t.low>>>0,o=(t.low>>>28|t.high<<4)>>>0,c=t.high>>>24,u=c===0?o===0?r<16384?r<128?1:2:r<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=dy(e,u),m=e.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?r>>>21|128:r>>>21&127;case 3:m[h+2]=u!==3?r>>>14|128:r>>>14&127;case 2:m[h+1]=u!==2?r>>>7|128:r>>>7&127;case 1:m[h]=u!==1?128|r:127&r}}function Iz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}let ome=new Map([["moderation",1],["supervise",2]]);class ame extends dr{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let r=this._connectionState;this._connectionState=t,this.emit(xi.CONNECTION_STATE_CHANGE,r,t)}get inspectType(){return this._inspectType}set inspectType(t){var r;this._inspectMode=to(r=t.map(o=>ome.get(o)||0)).call(r,(o,c)=>o+c),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),V(this,"name","AgoraRTCVideoContentInspect"),V(this,"_connectionState",Yc.CONNECTING),V(this,"_innerConnectionState",void 0),V(this,"sequence",0),V(this,"inspectStartTime",void 0),V(this,"workerManagerConnection",void 0),V(this,"workerConnection",void 0),V(this,"workerMessageLengthLimit",void 0),V(this,"inspectIntervalMinimum",void 0),V(this,"qualityRatio",void 0),V(this,"_connectInfo",void 0),V(this,"_cancelTokenSource",ao.CancelToken.source()),V(this,"_retryConfig",void 0),V(this,"wmSequence",0),V(this,"inspectInterval",void 0),V(this,"inspectTimer",null),V(this,"ossFilePrefix",void 0),V(this,"extraInfo",void 0),V(this,"_inspectType",void 0),V(this,"_inspectMode",void 0),V(this,"_quality",1),V(this,"qualityTimer",null),V(this,"_inspectId",void 0),V(this,"_needWorkUrlOnly",!1),V(this,"inspectImage",()=>{if(this.connectionState!==Yc.CONNECTED)throw new he(Y.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Yc.CONNECTED?this.requestToInspectImage():k.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=In(5,"inspect-"),this.workerMessageLengthLimit=z("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=z("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=z("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new WT("worker-manager-"+this._inspectId,Kr),this.on(xi.STATE_CHANGE,(r,o)=>{this._innerConnectionState=r,k.debug("[".concat(this._inspectId,"] Inspect operation :").concat(qc[r]," ").concat(o||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new WT("worker-"+this._inspectId,Kr),this.handleWorkerEvents()}async init(t,r){this.emit(xi.STATE_CHANGE,qc.CONNECT_AP),this._connectInfo=t;let o=this._cancelTokenSource.token;return this._retryConfig=r,new ze((c,u)=>{this.on(xi.CONNECTION_STATE_CHANGE,(h,m)=>{m===Yc.CONNECTED&&c()}),this.requestAP(t,o,r).then(h=>{this.connectWorkerManager(h)}).catch(h=>{u(h)})})}async requestAP(t,r,o){let c=z("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),u=await(function(m,g,y,v){let{appId:R,areaCode:b,cname:A,sid:F,token:M,uid:j}=g;QE++;let K="image_moderation_api",q={service_name:K,json_body:JSON.stringify({appId:R,areaCode:b,cname:A,command:"allocateEdge",requestId:QE,seq:QE,sid:F,token:M,ts:Date.now(),uid:j+""})},Q,se,oe=m[0];return Wl(async()=>{Q=Date.now();let te=await ql(oe,{data:q,cancelToken:y,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(se=Date.now()-Q,te.code!==0){let ot=new he(Y.UNEXPECTED_RESPONSE,"image inspect ap error, code"+te.code,{retry:!0,responseTime:se});throw k.error(ot.toString()),ot}let de=JSON.parse(te.json_body);if(de.code!==200){let ot=new he(Y.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(de.code,", reason: ").concat(de.reason),{code:de.code,responseTime:se});throw k.error(ot.toString()),ot}if(!de.servers||!Array.isArray(de.servers)||de.servers.length===0){let ot=new he(Y.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:de.code,responseTime:se});throw k.error(ot.toString()),ot}let Ce=z("VIDEO_INSPECT_WORKER_MANAGER_WSS");if(Ce)return{addressList:[Ce],workerToken:de.workerToken,vid:de.vid,responseTime:se};let Pe=z("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Qe=z("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:de.servers.map(ot=>{let{address:Xt,wss:Lt}=ot;if(Xt&&Lt)return"wss://".concat(Xt.replace(/\./g,"-"),".").concat(Pe,":").concat(Qe||Lt)}).filter(ot=>!!ot),workerToken:de.workerToken,vid:de.vid,responseTime:se}},(te,de)=>(tt.apworkerEvent(F,{success:!0,sc:200,serviceName:K,responseDetail:JSON.stringify(te.addressList),firstSuccess:de===0,responseTime:se,serverIp:m[de%m.length]}),!1),(te,de)=>(tt.apworkerEvent(F,{success:!1,sc:te.data&&te.data.code||200,serviceName:K,responseTime:se,serverIp:m[de%m.length]}),!!(te.code!==Y.OPERATION_ABORTED&&te.code!==Y.UNEXPECTED_RESPONSE||te.data&&te.data.retry)&&(oe=m[(de+1)%m.length],!0)),v)})(c,t,r,o);this.emit(xi.STATE_CHANGE,qc.AP_CONNECTED);let{addressList:h}=u;return this.wmSequence++,h}async connectWorkerManager(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=r,this.emit(xi.STATE_CHANGE,qc.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Ot.CONNECTED,async()=>{this.emit(xi.STATE_CHANGE,qc.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Ot.CLOSED,()=>{this._innerConnectionState<qc.GET_WORKER_MANAGER_RESPONSE&&k.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Ot.FAILED,()=>{this._innerConnectionState<qc.GET_WORKER_MANAGER_RESPONSE&&k.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Ot.RECONNECTING,()=>{this._innerConnectionState<qc.GET_WORKER_MANAGER_RESPONSE&&k.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Ot.ON_MESSAGE,async t=>{this.emit(xi.STATE_CHANGE,qc.GET_WORKER_MANAGER_RESPONSE);let r=this.workerManagerConnection.url;this.workerManagerConnection.close();let o=JSON.parse(t.data);if(o.code!==200)throw k.error("[".concat(this._inspectId,"] Unexpected code ").concat(o.code," from worker manager")),new he(Y.UNEXPECTED_RESPONSE,"response code of worker is unexpected",o);if(!(o.serverResponse&&o.serverResponse.portWss&&r))throw k.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(o))),new he(Y.UNEXPECTED_RESPONSE,"response content of worker is unexpected",o);{let c=z("VIDEO_INSPECT_WORKER_PORT")||o.serverResponse.portWss,u=r.replace(/:\d+\/?$/,":".concat(c));this.emit(xi.STATE_CHANGE,qc.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(xi.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}}),this.workerManagerConnection.on(Ot.WILL_RECONNECT,(t,r,o)=>{o(t)}),this.workerManagerConnection.on(Ot.REQUEST_NEW_URLS,(t,r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(r)})}handleWorkerEvents(){this.workerConnection.on(Ot.CONNECTED,async()=>{this.emit(xi.STATE_CHANGE,qc.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Yc.CONNECTED}),this.workerConnection.on(Ot.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){let o=Zfe(new Uint8Array(t.data));if(z("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&k.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(o)),o.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(xi.INSPECT_RESULT,void 0,void 0);if(o.data&&o.data.scorePorn&&o.data.scoreSexy&&o.data.scoreNeutral){var r;let c={porn:o.data.scorePorn,sexy:o.data.scoreSexy,neutral:o.data.scoreNeutral},u=to(r=Object.keys(c)).call(r,(m,g)=>c[m]>c[g]?m:g,"porn"),h=Object.keys(c).find(m=>m===u);this.emit(xi.INSPECT_RESULT,h)}else this.emit(xi.INSPECT_RESULT,void 0,new he(Y.UNEXPECTED_RESPONSE,o.code+"","There is an unexpected data on message"))}else this.emit(xi.INSPECT_RESULT,void 0,new he(Y.UNEXPECTED_RESPONSE,o.code+"",o.msg))}else k.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(xi.INSPECT_RESULT,void 0,new he(Y.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Ot.CLOSED,()=>{this.connectionState=Yc.CLOSED}),this.workerConnection.on(Ot.FAILED,()=>{this.connectionState=Yc.CLOSED}),this.workerConnection.on(Ot.RECONNECTING,()=>{this.connectionState=this.connectionState===Yc.CONNECTED?Yc.RECONNECTING:Yc.CONNECTING}),this.workerConnection.on(Ot.WILL_RECONNECT,(t,r,o)=>{t==="recover"&&o(t),o("tryNext")}),this.workerConnection.on(Ot.REQUEST_NEW_URLS,(t,r)=>{this.workerManagerConnection.close(),this.once(xi.REQUEST_NEW_WORKER_URL,o=>{t([o])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o=>{this.connectWorkerManager(o,!0)}).catch(o=>{r(o)})})}async requestToInspectImage(){this.sequence++;let t=Jo(this,xi.CLIENT_LOCAL_VIDEO_TRACK),r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(xi.INSPECT_RESULT,void 0,new he(Y.INVALID_OPERATION,"Only the track being played can be inspected"));let o=await this.generateRequestData(t,r);this.workerConnection.sendMessage(o,!0,!0)}else this.emit(xi.INSPECT_RESULT,void 0,new he(Y.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,r){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:g}=r,y=Date.now(),v=await t.getCurrentFrameImage("image/jpeg",this.quality),R=await r6(v,o,c),b=this.sequence+"-"+u+"-"+g+"-"+y+"-"+In(12,""),A={appId:o,cid:u,cname:c,deviceId:"",elapse:(F=Number(y-this.inspectStartTime),{low:F|=0,high:F>>31,unsigned:F>=0}),fileSize:R.byteLength,jpgEncryption:2,height:v.height,width:v.width,jpg:R,networkType:6,osType:7,requestId:b,sdkVersion:"4.24.2",sequence:this.sequence,sid:m,timestamp:P8(y),uid:g,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var F;this.extraInfo===void 0&&delete A.callbackData,this.ossFilePrefix===void 0&&delete A.ossFilePrefix;let M=Qfe(A);if(M.byteLength<this.workerMessageLengthLimit){if(z("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){let j=(function(K){for(var q=1;q<arguments.length;q++){var Q=arguments[q]!=null?arguments[q]:{};q%2?Iz(Object(Q),!0).forEach(function(se){V(K,se,Q[se])}):Object.getOwnPropertyDescriptors?Object.defineProperties(K,Object.getOwnPropertyDescriptors(Q)):Iz(Object(Q)).forEach(function(se){Object.defineProperty(K,se,Object.getOwnPropertyDescriptor(Q,se))})}return K})({},A);delete j.jpg,k.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(j))}return M}{let j=this.quality*this.qualityRatio;return this.quality=j,await this.generateRequestData(t,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=ao.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Yc.CLOSED,this.emit(xi.STATE_CHANGE,qc.CLOSED)}}let cme={name:"ContentInspect",create:function(e){let{config:t}=e;return(function(r){if(!r)throw new he(Y.INVALID_PARAMS,"inspectConfig is necessary.");if(!r.inspectType||!Array.isArray(r.inspectType))throw new he(Y.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{let o=[...new Set(r.inspectType)];o.forEach(c=>{var u;if(!ke(u=["supervise","moderation"]).call(u,c))throw new he(Y.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),r.inspectType=o}if(r&&r.extraInfo&&r.extraInfo.length>1024)throw new he(Y.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")})(t),new ame(t)}};var Az=l(fi.Object.getOwnPropertySymbols),lme=Sn,ume=a_.indexOf,dme=Ff,Ax=De([].indexOf),Oz=!!Ax&&1/Ax([1],1,-0)<0;lme({target:"Array",proto:!0,forced:Oz||!dme("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return Oz?Ax(this,e,t)||0:ume(this,e,t)}});var hme=To("Array","indexOf"),pme=N,fme=hme,Ox=Array.prototype,mme=function(e){var t=e.indexOf;return e===Ox||pme(Ox,e)&&t===Ox.indexOf?fme:t},Nz=l(mme);function gme(e,t){if(e==null)return{};var r,o,c=(function(h,m){if(h==null)return{};var g={};for(var y in h)if({}.hasOwnProperty.call(h,y)){if(Nz(m).call(m,y)!==-1)continue;g[y]=h[y]}return g})(e,t);if(Az){var u=Az(e);for(o=0;o<u.length;o++)r=u[o],Nz(t).call(t,r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(c[r]=e[r])}return c}let Pz=class{get localCapabilities(){return Zn(this._localCapabilities)}get rtpCapabilities(){return Zn(this._rtpCapabilities)}get candidates(){return Zn(this._candidates)}get iceParameters(){return Zn(this._iceParameters)}get dtlsParameters(){return Zn(this._dtlsParameters)}constructor(e){V(this,"sessionDesc",void 0),V(this,"_localCapabilities",void 0),V(this,"_rtpCapabilities",void 0),V(this,"_candidates",void 0),V(this,"_iceParameters",void 0),V(this,"_dtlsParameters",void 0),V(this,"setup",void 0),V(this,"currentMidIndex",void 0),V(this,"cname","o/i14u9pJrxRKAsu"),V(this,"firefoxSsrcMidMap",new Map),e=Zn(e);let{remoteIceParameters:t,remoteDtlsParameters:r,candidates:o,remoteRTPCapabilities:c,localCapabilities:u,direction:h,setup:m,videoCodec:g,audioCodec:y}=e,v;this.setup=m,v=h===Ys.RECEIVE_ONLY?Hs(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Hs(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=o,this._iceParameters=t,this._dtlsParameters=r,this._localCapabilities=u;let R=h===Ys.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,b=h===Ys.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,A=h===Ys.RECEIVE_ONLY?c.send.videoCodecs:qT(et.VIDEO,R,b,g),F=h===Ys.RECEIVE_ONLY?c.send.audioCodecs:qT(et.AUDIO,R,b,y);for(let M of v.mediaDescriptions)M.attributes.iceUfrag=t.iceUfrag,M.attributes.icePwd=t.icePwd,M.attributes.fingerprints=r.fingerprints,M.attributes.candidates=o,M.attributes.setup=this.setup,M.media.mediaType==="application"&&(M.attributes.sctpPort="5000"),M.media.mediaType==="video"&&(M.media.fmts=A.map(j=>j.payloadType.toString(10)),M.attributes.payloads=A,M.attributes.extmaps=R.videoExtensions),M.media.mediaType==="audio"&&(M.media.fmts=F.map(j=>j.payloadType.toString(10)),M.attributes.payloads=F,M.attributes.extmaps=R.audioExtensions,$E(M));this.sessionDesc=v,this.currentMidIndex=v.mediaDescriptions.length-1}toString(){return th(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,r,o,c){r=r.replace(/ /g,"-");let{ssrcs:u,ssrcGroups:h}=KT(t,this.cname,z("SYNC_GROUP")?r:void 0),m=this.findPreloadMediaDesc(u);if(m){if(Qn()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,m.attributes.mid),c&&(c.twcc||c.remb)){let g=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(m,c),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{let g=this.findAvailableMediaIndex(e,u,o),y;return g===-1?(y=this.createOrRecycleSendMedia(e,u,h,"sendonly",o,c),this.updateBundleMids()):(y=Zn(this.sessionDesc.mediaDescriptions[g]),y.attributes.direction="sendonly",y.attributes.ssrcs=u,y.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(y,c)),Qn()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,y.attributes.mid),{needExchangeSDP:!0,mid:y.attributes.mid}}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(r=>{r.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,r){let o=[];return e.forEach(c=>{let u=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(u),m,g=!1;h===-1?(g=!0,m=this.createOrRecycleRecvMedia(c,[],"recvonly",t,r),this.updateBundleMids()):(m=Zn(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="recvonly"),o.push({mid:m.attributes.mid,needCreateTransceiver:g})}),o}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){let{foundation:t,protocol:r,address:o,port:c,type:u,relatedAddress:h,relatedPort:m,priority:g}=new RTCIceCandidate(e),y={foundation:t??"",componentId:"1",transport:r??"",priority:g?g+"":"",connectionAddress:o??"",port:c?c+"":"",type:u?u+"":"",relAddr:h??"",relPort:m?m+"":"",extension:{}};this.candidates.some(v=>v.priority===y.priority&&v.connectionAddress===y.connectionAddress&&v.port===y.port)||(this._candidates.push(y),this.sessionDesc.mediaDescriptions.forEach(v=>{v.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,r,o,c){let u=e._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=qT(u,h,this.localCapabilities.send,u===et.AUDIO?c:o),g=u===et.VIDEO?h.videoExtensions:h.audioExtensions,y="".concat(++this.currentMidIndex),v={media:{mediaType:u,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(y)}};v=this.mungRecvMediaDsec(v,e);let R=this.findFirstClosedMedia(u);if(R){let b=this.sessionDesc.mediaDescriptions.indexOf(R);this.sessionDesc.mediaDescriptions[b]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>ke(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>ke(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,r){return this.sessionDesc.mediaDescriptions.findIndex(o=>{let c=o.media.mediaType===e&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if(Qn()){if(c){let u=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(u||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!u||u!==o.attributes.mid)}return!1}return c&&o.attributes.mid===r})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{let r=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&r})}predictReceivingMids(e){let t=[];for(let r=0;r<e;r++)t.push((this.currentMidIndex+r+1).toString(10));return t}restartICE(e){e=Zn(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,r,o,c,u){let h=this.rtpCapabilities.send,m=e===et.VIDEO?h.videoCodecs:h.audioCodecs,g=e===et.VIDEO?h.videoExtensions:h.audioExtensions;Qn()&&(c="".concat(++this.currentMidIndex));let y={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:c}};y=this.mungSendMediaDesc(y,u);let v=this.findFirstClosedMedia(e);if(v){let R=this.sessionDesc.mediaDescriptions.indexOf(v);this.sessionDesc.mediaDescriptions[R]=y}else this.sessionDesc.mediaDescriptions.push(y);return y}mungRecvMediaDsec(e,t,r){let o=Zn(e);return SD(o),Jm(o,t),TD(o,t),TG(o),uI(o,r,this.localCapabilities.send),o}mungSendMediaDesc(e,t){let r=Zn(e);return uI(r,t,this.localCapabilities.recv),$E(r),r}updateRecvMedia(e,t){let r=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===e);if(r!==-1){let o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],t);this.sessionDesc.mediaDescriptions[r]=o}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var r;return((r=t.attributes)===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Qn()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}},_me=["sdp"];var er;function kz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function Lp(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?kz(Object(r),!0).forEach(function(o){V(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):kz(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}let Dz=(er=class Cy extends iG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,r,o){super(t,r),V(this,"direction",void 0),V(this,"name",void 0),V(this,"store",void 0),V(this,"spec",void 0),V(this,"peerConnection",void 0),V(this,"initialOffer",void 0),V(this,"transport",void 0),V(this,"statsFilter",void 0),V(this,"localCandidateCount",0),V(this,"_isInRestartIce",!1),V(this,"mutex",void 0),V(this,"onLocalCandidate",void 0),V(this,"remoteSDP",void 0),V(this,"pendingCandidates",[]),V(this,"localCapabilities",void 0),V(this,"isReady",!1),V(this,"restartCnt",0),V(this,"curTurnServerIndex",0),this.store=r,this.spec=t,this.mutex=new ki("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(Cy.resolvePCConfiguration(t,r.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=o??Ys.SEND_ONLY,this.name=this.direction===Ys.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=kb(this.peerConnection,z("STATS_UPDATE_INTERVAL"),void 0,Qn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{let r=await CD();if(this.localCapabilities=YT(r),t){let{sdp:o}=t,c=gme(t,_me),u=(function(){let v={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},R=zT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},F={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Jc(R,v,"videoExtensions",b,A,F),Jc(R,v,"videoCodecs",b,A,F),Jc(R,v,"audioExtensions",b,A,F),Jc(R,v,"audioCodecs",b,A,F),z("RAISE_H264_BASELINE_PRIORITY")){let M=F.videoCodecs.findIndex(j=>j.rtpMap&&j.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&j.fmtp&&j.fmtp.parameters["profile-level-id"]==="42001f");if(M!==-1){let j=F.videoCodecs.findIndex(K=>K.rtpMap&&K.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(j<M){k.debug("raising H264 baseline profile priority");let K=F.videoCodecs[M];F.videoCodecs.splice(M,1),F.videoCodecs.splice(j,0,K)}j!==-1&&z("FILTER_SEND_H264_BASELINE")&&(b.videoCodecs=b.videoCodecs.filter(K=>!(K.rtpMap&&K.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&K.fmtp&&K.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:b,recv:A,sendrecv:F}})({},{},o);this.remoteSDP=new Pz({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;let h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");let m=td(h.sdp);await this.peerConnection.setLocalDescription(h);let g=await CG({},{},h.sdp);this.localCapabilities=YT(g);let y=this.peerConnection.getTransceivers()[0];return y!=null&&y.receiver&&y.receiver.transport&&this.tryBindTransportEvents(y.receiver.transport),Lp(Lp({},m),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});let o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let c=td(o.sdp);return this.initialOffer=o,Lp(Lp({},c),{},{sdp:o.sdp})}}catch(r){throw new _e(Y.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);let{sdp:r,iceParameters:o,dtlsParameters:c}=t,u=await CG({},{},r);this.remoteSDP=new Pz({remoteIceParameters:o,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});let h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(r){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(r=>{this.peerConnection.addIceCandidate(r)}),this.pendingCandidates=[])}catch(r){throw new _e(Y.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(r.toString()))}}send(t,r,o){var c=this;return oo(function*(){let u=yield Ft(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let h=[],m=c.remoteSDP.receive(t,r,o);t.forEach((j,K)=>{if(m[K].needCreateTransceiver){let q=c.peerConnection.addTransceiver(j._mediaStreamTrack,{direction:"sendonly"});h.push(q),j._updateRtpTransceiver(q)}else{let q=c.peerConnection.getTransceivers().find(Q=>Q.mid===m[K].mid);if(!q)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[K].mid));h.push(q),j._updateRtpTransceiver(q)}}),Qn()&&z("SIMULCAST")===!0&&(yield Ft(c.applySimulcastForFirefox(h,t)));let g=m.map(j=>j.mid),y=yield Ft(c.peerConnection.createOffer()),v=c.mungSendOfferSDP(y.sdp,t,g),R=Hs(v),b=g.map(j=>{let K=R.mediaDescriptions.find(q=>q.attributes.mid===j);if(!K)throw new Error("Cannot extract ssrc from mediaDescription.");return vD(K,z("USE_PUB_RTX"))}),A=h.map((j,K)=>{let q=g[K];return{localSSRC:b[K],id:q}});yield Ft(c.peerConnection.setLocalDescription({type:"offer",sdp:v}));try{yield A}catch(j){let K=c.remoteSDP.toString();throw yield Ft(c.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield Ft(c.peerConnection.setRemoteDescription({type:"answer",sdp:K})),yield Ft(c.stopSending(g,!0)),j}yield Ft(c.applySimulcastEncodings(h,t)),yield Ft(c.applySendEncodings(h,t));let F=c.remoteSDP.toString();return c.logSDPExchange(v,"offer","local","send")?.(F),yield Ft(c.setRemoteDescription({type:"answer",sdp:F})),h.map((j,K)=>{let q=g[K];return{localSSRC:b[K],id:q}})}catch(h){throw h instanceof _e?h:new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async stopSending(t,r){let o=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let c=this.peerConnection.getTransceivers().filter(g=>t.indexOf(g.mid)!==-1);if(c.length!==t.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));c.map(g=>{var y;g.direction="inactive",(y=g.stop)===null||y===void 0||y.call(g)});let u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(t);let m=this.remoteSDP.toString();h?.(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(t,r,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:u,needExchangeSDP:h}=this.remoteSDP.send(t,r,o,c);if(h){let g=this.remoteSDP.toString(),y=this.logSDPExchange(g,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:g});let v=await this.peerConnection.createAnswer(),R=this.mungReceiveAnswerSDP(v.sdp,u,t);y?.(R||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:R}),k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));let m=this.peerConnection.getTransceivers().find(g=>g.mid===u);if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(u){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async mockReceive(t,r,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:u,needExchangeSDP:h}=this.remoteSDP.send(t,r,o,c);if(h){let m=this.remoteSDP.toString(),g=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});let y=await this.peerConnection.createAnswer(),v=this.mungReceiveAnswerSDP(y.sdp,u,t);g?.(v||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:v}),k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(u){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let r=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:r});let c=await this.peerConnection.createAnswer();o?.(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===Vm.Auto&&(this.store.p2pTransport=Vm.SdRtn,Qt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Cy.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Qt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Cy.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;let r=await this.peerConnection.createOffer({iceRestart:!0});if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let{iceParameters:o}=td(r.sdp);return this.store.descriptionStart(),this.direction===Ys.SEND_ONLY&&await this.peerConnection.setLocalDescription(r),o}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Ys.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});let r=await this.peerConnection.createAnswer();if(!r.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");let{iceParameters:o}=td(r.sdp);return await this.peerConnection.setLocalDescription(r),o}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(r){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);let u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h?.(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new _e(Y.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(t,r){let o=this.peerConnection.getTransceivers().filter(c=>c.mid===t);o.length===1&&(this.isVP8Simulcast(r)?Qn()||await this.applySimulcastEncodings(o,[r]):await this.applySendEncodings(o,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){let o=this.peerConnection.getTransceivers().find(c=>c.mid===r);o&&await o.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let r=t[0].transport.iceTransport,{local:o,remote:c}=r.getSelectedCandidatePair();return{local:Lp(Lp({},Hc),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:Lp(Lp({},Hc),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,r;ke(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var r;t.candidate.candidate&&((r=this.onLocalCandidate)===null||r===void 0||r.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,r){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,c={iceServers:[]};var u;return t.iceServers?c.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(km(t.turnServer.servers)?c.iceServers=t.turnServer.servers:(c.iceServers&&c.iceServers.push(...Cy.turnServerConfigToIceServers(t.turnServer.servers,r,o)),z("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&t.turnServer.serversFromGateway&&c.iceServers.push(...Cy.turnServerConfigToIceServers(t.turnServer.serversFromGateway,r,o)),ke(u=[Vm.Relay,Vm.SdRtn]).call(u,r)&&(c.iceTransportPolicy="relay"),z("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),z("ENABLE_ENCODED_TRANSFORM")&&Qt().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),k.debug("P2PConnection p2pTransport is ".concat(r)),c}static turnServerConfigToIceServers(t,r){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,c=[],u=t.filter(m=>m.tcpport);k.debug("P2PConnection turnServers is ".concat(u,", current index is ").concat(o));let h=u.length>o?u[o]:u[0];switch(r){case Vm.SdRtn:let m=t.filter(y=>{var v;return ke(v=y.username).call(v,"glb:")&&y.turnServerURL==y.turnServerURL}),g=m.length>o?m[o]:m[0];g&&(c.push({username:g.username,credential:g.password,credentialType:"password",urls:"turn:".concat(Xc(g.turnServerURL),":").concat(g.tcpport,"?transport=udp")}),c.push({username:g.username,credential:g.password,credentialType:"password",urls:"turns:".concat(Xc(g.turnServerURL),":").concat(g.tcpport,"?transport=tcp")}));break;case Vm.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Xc(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Xc(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var o;t!=null&&t.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,t.state))},t.onerror=o=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in o?o.error:o)};let r=t.iceTransport;r&&(r.onstatechange=()=>{let o=t?.iceTransport.state;var c;o&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,o))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){let{local:o,remote:c}=r.getSelectedCandidatePair()||{};if(o&&c){let u=o.address+":"+o.port,h=c.address+":"+c.port;k.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(ed(u)),", remote ").concat(JSON.stringify(ed(h))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var o;if(r||(r=this.peerConnection.getSenders().find(v=>v.track===t._mediaStreamTrack)),!r)return k.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return k.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Qt().supportSetRtpSenderParameters)return k.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let c={},u={};switch(t._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(t._encoderConfig){var h;let{bitrateMax:v,frameRate:R,scaleResolutionDownBy:b}=t._encoderConfig;v&&(u.maxBitrate=1e3*v),ke(h=t._hints).call(h,bn.LOW_STREAM)&&(R&&(u.maxFramerate=ho(R)),b&&b>=1&&(u.scaleResolutionDownBy=b))}if(z("DSCP_TYPE")&&Xu()){var m;let v=z("DSCP_TYPE");ke(m=["very-low","low","medium","high"]).call(m,v)&&(u.networkPriority=v)}let g=r.getParameters(),y=(o=g.encodings)===null||o===void 0?void 0:o[0];Qn()&&!y&&(c.encodings=[u]),y&&Object.assign(y,u),Object.assign(g,c),k.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),await r.setParameters(g)}async applySendEncodings(t,r){try{if(!Qt().supportSetRtpSenderParameters||t.length!==r.length)return;for(let o=0;o<t.length;o++){let c=t[o],u=r[o];u instanceof jn&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{k.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,o){let c=Hs(t);return r.forEach((u,h)=>{let m=o[h],g=c.mediaDescriptions.find(y=>y.attributes.mid===m);g&&(Jm(g,u),wD(g,u,this.store.codec))}),th(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,r,o)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let g=0;g<t.length;g++){var o,c,u,h,m;let y=t[g],v=r[g];if(v instanceof jn&&!ke(o=v._hints).call(o,bn.LOW_STREAM)&&(c=v._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=v._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=v._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=v._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){let R={},b={high:1e3*(v._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:b.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:b.high}];let A=y.sender.getParameters();await y.sender.setParameters(Object.assign(A,R))}}}async applySimulcastEncodings(t,r){if(!Qn()&&t.length===r.length)for(let o=0;o<t.length;o++){let c=r[o];if(c instanceof jn&&this.isVP8Simulcast(c)){let u=t[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];let g=u.sender.getParameters();await u.sender.setParameters(Object.assign(g,h))}}}isVP8Simulcast(t){var r,o,c,u,h;return!!(t instanceof jn&&z("SIMULCAST")&&this.store.codec==="vp8"&&!ke(r=t._hints).call(r,bn.LOW_STREAM)&&(o=t._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=t._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=t._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=t._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(t,r,o,c){if(z("SDP_LOGGING"))return k.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(r," SDP during P2PConnection.").concat(c,`
`),t),r==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(h=>{h.direction="inactive"});let o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(t);let u=this.remoteSDP.toString();c?.(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(r){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(async h=>{h.direction="sendonly"});let o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(t);let u=this.remoteSDP.toString();c?.(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(r){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}async getRemoteSSRC(t,r){var o;if(r=r??((o=this.currentRemoteDescription)===null||o===void 0?void 0:o.sdp)){var c;return((c=Hs(r).mediaDescriptions.find(h=>h.attributes.mid===t))===null||c===void 0?void 0:c.attributes.ssrcs)?.[0].ssrcId}}async setRemoteDescription(t){var r;await this.peerConnection.setRemoteDescription(t),ke(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,r,o){let c=Hs(t),u=c.mediaDescriptions.find(h=>h.attributes.mid===r);return u&&o===et.AUDIO&&u.media.mediaType==="audio"&&$E(u),th(c)}},Ye(er.prototype,"establish",[tl],Object.getOwnPropertyDescriptor(er.prototype,"establish"),er.prototype),Ye(er.prototype,"connect",[tl],Object.getOwnPropertyDescriptor(er.prototype,"connect"),er.prototype),Ye(er.prototype,"receive",[tl],Object.getOwnPropertyDescriptor(er.prototype,"receive"),er.prototype),Ye(er.prototype,"mockReceive",[tl],Object.getOwnPropertyDescriptor(er.prototype,"mockReceive"),er.prototype),Ye(er.prototype,"stopReceiving",[tl],Object.getOwnPropertyDescriptor(er.prototype,"stopReceiving"),er.prototype),Ye(er.prototype,"restartICE",[tl],Object.getOwnPropertyDescriptor(er.prototype,"restartICE"),er.prototype),Ye(er.prototype,"close",[tl],Object.getOwnPropertyDescriptor(er.prototype,"close"),er.prototype),Ye(er.prototype,"updateEncoderConfig",[tl],Object.getOwnPropertyDescriptor(er.prototype,"updateEncoderConfig"),er.prototype),Ye(er.prototype,"updateSendParameters",[tl],Object.getOwnPropertyDescriptor(er.prototype,"updateSendParameters"),er.prototype),Ye(er.prototype,"replaceTrack",[tl],Object.getOwnPropertyDescriptor(er.prototype,"replaceTrack"),er.prototype),Ye(er.prototype,"muteLocal",[tl],Object.getOwnPropertyDescriptor(er.prototype,"muteLocal"),er.prototype),Ye(er.prototype,"unmuteLocal",[tl],Object.getOwnPropertyDescriptor(er.prototype,"unmuteLocal"),er.prototype),er);function tl(e,t,r){let o=e[t];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let c=this.mutex,u=await c.lock("From P2PConnection.".concat(t));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await o.apply(this,m)}finally{u()}},r}let $l=(function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e})({});var xz,Lz,Mz,Uz,Vz,Fz,jz,Bz,Wz,Gz,Hz,hr;function zz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function KI(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?zz(Object(r),!0).forEach(function(o){V(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zz(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}let Eme=(xz=Ql($l.SEND_ONLY),Lz=Ql($l.SEND_ONLY),Mz=Ql(),Uz=Ql($l.RECEIVE_ONLY),Vz=Ql($l.RECEIVE_ONLY),Fz=Ql($l.RECEIVE_ONLY),jz=Ql($l.RECEIVE_ONLY),Bz=Ql($l.RECEIVE_ONLY),Wz=Ql($l.RECEIVE_ONLY),Gz=Ql(),Hz=Ql($l.RECEIVE_ONLY),hr=class extends dr{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(dt.StateChange,t,this._state)}constructor(e,t){super(),V(this,"isPlanB",!1),V(this,"store",void 0),V(this,"statsUploader",void 0),V(this,"sendConnection",void 0),V(this,"recvConnection",void 0),V(this,"localTrackMap",new Map),V(this,"remoteUserMap",new Map),V(this,"localDataChannels",[]),V(this,"pendingLocalTracks",[]),V(this,"pendingRemoteTracks",[]),V(this,"statsCollector",void 0),V(this,"dtlsFailedCount",0),V(this,"sendMutex",void 0),V(this,"recvMutex",void 0),V(this,"_state",Tn.Disconnected),V(this,"_restartStates",["disconnected","failed"]),V(this,"reconnectInterval",void 0),V(this,"uploadUnplinkStarted",!1),V(this,"uploadDownlinkStarted",!1),V(this,"uplinkStateUploadInterval",void 0),V(this,"downlinkStatsUploadInterval",void 0),V(this,"handleMuteLocalTrack",async(r,o,c)=>{let u=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Tn.Connected)return void c(new _e(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));let g=this.filterTobeMutedTracks(r);if(g.length===0)return void o();let y=g.find(A=>A[0]==="videoLowTrack");y&&y[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(g.map(A=>{let[,{id:F}]=A;return F}));let v=!1;var h,m;r.trackMediaType==="video"?v=!((h=this.localTrackMap.get(xe.LocalAudioTrack))===null||h===void 0||!h.track._muted):v=((m=this.localTrackMap.get(xe.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;let R=this.createMuteMessage(g);await Gn(this,dt.RequestMuteLocal,R);let b=r.trackMediaType==="video"?wp.MUTE_LOCAL_VIDEO:wp.MUTE_LOCAL_AUDIO;await Gn(this,dt.RequestP2PMuteLocal,{action:b,message:R,isMuteAll:v}),o()}catch(g){c(g)}finally{u()}}),V(this,"handleUnmuteLocalTrack",async(r,o,c)=>{let u=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Tn.Connected)return void c(new _e(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));let h=this.filterTobeUnmutedTracks(r);if(h.length===0)return void o();await this.sendConnection.unmuteLocal(h.map(y=>{let[,{id:v}]=y;return v}));let m=this.createUnmuteMessage(h),g=r.trackMediaType==="video"?wp.UNMUTE_LOCAL_VIDEO:wp.UNMUTE_LOCAL_AUDIO;await Gn(this,dt.RequestP2PMuteLocal,{action:g,message:m}),o()}catch(h){c(h)}finally{u()}}),V(this,"handleUpdateVideoEncoder",async(r,o,c,u)=>{let h;typeof u=="boolean"&&u||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{let g=this.localTrackMap.get(xe.LocalVideoTrack);if(!this.sendConnection||!g||g.track!==r||this.state!==Tn.Connected)return void o();let{id:y,track:v}=g;y&&(await this.sendConnection.updateSendParameters(y,v),await this.sendConnection.updateEncoderConfig(y,v),this.emit(dt.UpdateVideoEncoder,v)),o()}catch(g){c(g)}finally{var m;(m=h)===null||m===void 0||m()}}),V(this,"handleUpdateVideoSendParameters",async(r,o,c)=>{let u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{let h=this.localTrackMap.get(xe.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==r||this.state!==Tn.Connected)return void o();let{id:m,track:g}=h;m&&await this.sendConnection.updateSendParameters(m,g),o()}catch(h){c(h)}finally{u()}}),V(this,"handleReplaceTrack",async(r,o,c,u)=>{let h;k.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;let y=Array.from(this.localTrackMap.entries()).find(v=>{let[,{track:R}]=v;return r===R});if(!this.sendConnection||!y||y[1].id===void 0||this.state!==Tn.Connected)return void o();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(r,y[1].id)),y[0]===xe.LocalVideoTrack&&Qt().supportDualStreamEncoding){let v=this.localTrackMap.get(xe.LocalVideoLowTrack);if(v){let R=r._mediaStreamTrack.clone();v.track._originMediaStreamTrack.stop(),v.track._mediaStreamTrack=R,v.track._originMediaStreamTrack=R,await new ze((b,A)=>{this.handleReplaceTrack(v.track,b,A,!0)})}}o()}catch(y){c(y)}finally{var g;(g=h)===null||g===void 0||g()}}),V(this,"handleGetLocalVideoStats",r=>{r(this.statsCollector.getLocalVideoTrackStats())}),V(this,"handleGetLocalAudioStats",r=>{r(this.statsCollector.getLocalAudioTrackStats())}),V(this,"handleGetRemoteVideoStats",r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid]),V(this,"handleGetRemoteAudioStats",r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new o8(e),this.bindStatsUploaderEvents(),this.sendMutex=new ki("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new ki("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(r=>{r&&(r.iceConnectionState!=="disconnected"&&r.iceConnectionState!=="failed"||this.handleDisconnect(r.direction))})},z("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new _e(Y.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new _e(Y.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let r;try{if(t){this.recvConnection&&(k.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),r=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new Dz(e,this.store,Ys.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);let o=await this.recvConnection.establish(t);return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}{this.state=Tn.New,this.sendConnection&&(k.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),r=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new Dz(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);let o=await this.sendConnection.establish();return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}}finally{r&&r()}}async p2pConnect(e){if(!this.sendConnection)throw new _e(Y.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Tn.Connected}async addRemoteCandidate(e,t){if(t===Ys.RECEIVE_ONLY){if(!this.sendConnection)throw new _e(Y.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new _e(Y.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,r){var o=this;return oo(function*(){let c=yield Ft(o.sendMutex.lock("From P2PChannel.publish"));try{if(!o.sendConnection||o.state!==Tn.Connected){o.throwIfTrackTypeNotMatch(e);let y=e.filter(v=>o.pendingLocalTracks.indexOf(v)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(y))}o.store.pubId=o.store.pubId+1,fs.markPublishStart(o.store.clientId,o.store.pubId);let u=o.filterTobePublishedTracks(e,t,r);if(u.length===0)return void(yield Ft(o.tryToUnmuteAudio(e)));u.forEach(y=>{let{track:v,type:R}=y,b=Date.now();o.store.publish(v.getTrackId(),R===xe.LocalAudioTrack?"audio":"video",b)}),o.bindLocalTrackEvents(u);let h=yield Ft(o.sendConnection.send(u.map(y=>{let{track:v}=y;return v}),o.store.codec,o.store.audioCodec)),m=(yield Ft(h.next())).value,g=o.createGatewayPublishMessage(u,m);try{yield g}catch(y){throw h.throw(y),y?.code===Y.WS_ABORT&&u.forEach(v=>{let{track:R}=v;o.pendingLocalTracks.indexOf(R)===-1&&o.pendingLocalTracks.push(R)}),o.unbindLocalTrackEvents(u),y}yield Ft(h.next()),u.forEach(y=>{let{type:v}=y;o.statsCollector.addLocalStats(v)}),o.statsUploader.startUploadOutboundStats(),o.assignLocalTracks(u,m),u.forEach(y=>{let{track:v,type:R}=y,b=Date.now();o.store.publish(v.getTrackId(),R===xe.LocalAudioTrack?"audio":"video",void 0,b)}),o.startUploadUplinkState()}finally{c()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Tn.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!ke(e).call(e,c)));let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let r=t.find(c=>c[0]==="videoLowTrack");r&&r[1].track.close();let o=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(c=>{let[,{id:u}]=c;return u})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(c=>{let[u,{track:h}]=c;return{type:u,track:h}})),t.forEach(c=>{let[u]=c;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Tn.Connected)return r&&r[1].track.close(),o;e.forEach(c=>{let u=this.pendingLocalTracks.indexOf(c);u!==-1&&this.pendingLocalTracks.splice(u,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);let e=()=>{let t=[],r=[];Array.from(this.localTrackMap.entries()).forEach(o=>{let[c,{track:u,ssrcs:h}]=o,m={stream_type:spe(u,c),ssrcs:h};u._muted||!u._enabled?t.push(m):r.push(m)}),t.length>0&&t.forEach(o=>{Gn(this,dt.RequestMuteLocal,[o])}),r.length>0&&r.forEach(o=>{Gn(this,dt.RequestUnmuteLocal,[o])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return oo(function*(){throw new _e(Y.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(k.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ei(this,dt.RequestRePublish,this.pendingLocalTracks),this.emit(dt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new _e(Y.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,r,o){var c;if(!this.recvConnection)throw new _e(Y.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(t))return;let{track:u,mid:h,transceiver:m}=await this.recvConnection.receive(t,[{ssrcId:r}],String(e.uid),o);t===et.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(u):(e._audioTrack=new GE(u,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),m&&e._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=r,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(u):(e._videoTrack=new WE(u,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),m&&e._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._videoTrack));let g=this.remoteUserMap.get(e);g?g.set(t,h):this.remoteUserMap.set(e,new Map([[t,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();let y=this.pendingRemoteTracks.findIndex(v=>{let{user:R,kind:b}=v;return R.uid===e.uid&&t===b});y!==-1&&(this.pendingRemoteTracks.splice(y,1),this.emit(dt.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,r,o){if(!this.recvConnection)throw new _e(Y.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:r}],String(e.uid),o)}async unsubscribe(e,t,r){let o=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:m}=u;return t!==void 0?h.uid===e.uid&&t===m:h.uid===e.uid});if(o.forEach(u=>{let h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||r||o.forEach(u=>{let{kind:h}=u;var m;if(h===et.AUDIO)(m=e._audioTrack)===null||m===void 0||m._destroy(),e._audioTrack=void 0;else if(h===et.VIDEO){var g;(g=e._videoTrack)===null||g===void 0||g._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;let c=this.filterTobeUnSubscribedTracks(e,t);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(u=>{let[,{id:h}]=u;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(u=>{let[h,{kind:m}]=u;var g,y;if(m===et.VIDEO&&h._videoSSRC&&((g=this.recvConnection)===null||g===void 0||g.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===et.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),r||((y=h._videoTrack)===null||y===void 0||y._destroy(),h._videoTrack=void 0);else if(m===et.AUDIO){var v;this.unbindRemoteTrackEvents(h._audioTrack),!r&&((v=h._audioTrack)===null||v===void 0||v._destroy(),h._audioTrack=void 0)}}),c.forEach(u=>{let[,{kind:h}]=u;Gn(this,dt.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,r]=t;[et.VIDEO,et.AUDIO].forEach(o=>{r.has(o)?Gn(this,dt.RequestP2PUnmuteRemote,o):Gn(this,dt.RequestP2PMuteRemote,o)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new _e(Y.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new _e(Y.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new _e(Y.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new _e(Y.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;let r=this.remoteUserMap.get(e);if(!r)return void k.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void k.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let o=t===et.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;let r=this.remoteUserMap.get(e);if(!r)return void k.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||k.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){let t=this.localTrackMap.get(xe.LocalAudioTrack);if(t?.track instanceof ai){let r=t.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==xe.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===xe.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter(r=>{let[o]=r;return!(e&&o===xe.LocalVideoLowTrack)}).map(r=>{let[,{track:o}]=r;return o})}reportPublishEvent(e,t,r,o,c){if(e){let h=this.localTrackMap.get(xe.LocalAudioTrack),m=o?this.localTrackMap.get(xe.LocalVideoLowTrack):this.localTrackMap.get(xe.LocalVideoTrack);tt.publish(this.store.sessionId,{eventElapse:fs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h?.track.getTrackLabel(),videoName:m?.track.getTrackLabel(),screenshare:m?.track._hints.indexOf(bn.SCREEN_TRACK)!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;r||(r=[]);let h=r.find(g=>g instanceof Nr),m=o?(u=this.localTrackMap.get(xe.LocalVideoTrack))===null||u===void 0?void 0:u.track:r.find(g=>g instanceof jn);tt.publish(this.store.sessionId,{eventElapse:fs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h?.getTrackLabel(),videoName:m?.getTrackLabel(),screenshare:m?._hints.indexOf(bn.SCREEN_TRACK)!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,t,r,o){let c=o===et.VIDEO?r._videoSSRC:r._audioSSRC;c&&tt.subscribe(this.store.sessionId,{succ:e,ec:t,video:o===et.VIDEO,audio:o===et.AUDIO,peerid:r.uid,subscribeRequestid:o===et.VIDEO?r._videoSSRC:r._audioSSRC,p2pid:this.store.p2pId,eventElapse:fs.measureFromSubscribeStart(this.store.clientId,c)})}reset(){k.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new ki("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new ki("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(xe.LocalAudioTrack);if(e?.track instanceof ai){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(r=>{t.removeAudioTrack(r)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Tn.Disconnected}getStats(e){var t,r;return e?(r=this.recvConnection)===null||r===void 0?void 0:r.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(xe.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(xe.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof jn||t&&t.track instanceof Nr?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;let r=Array.from(ys(t=this.remoteUserMap).call(t)).find(o=>o.uid===e);return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(r=>{let[o]=r;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(xe.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=wm(e).call(e,(r,o)=>r.level-o.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(k.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Tn.Reconnecting,z("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var r;t._videoTrack&&t._videoTrack._player&&((r=t._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[r,{track:o}]=e;switch(r){case xe.LocalVideoTrack:ke(t=o._hints).call(t,bn.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case xe.LocalAudioTrack:o instanceof ai?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case xe.LocalVideoLowTrack:}}),this.emit(dt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;Array.from(ys(r).call(r)).forEach(o=>{this.setPendingRemoteMedia(t,o)}),this.emit(dt.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),k.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(let r of this.pendingRemoteTracks){let{user:o,kind:c}=r;if((e instanceof bp?e.uid:e)===o.uid&&t===c)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let r,o;if(e===Ys.SEND_ONLY){if(!this.sendConnection)throw new _e(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");r=await this.sendMutex.lock("From P2PChannel.restartICE"),o=this.sendConnection}else{if(!this.recvConnection)throw new _e(Y.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");r=await this.recvMutex.lock("From P2PChannel.restartICE"),o=this.recvConnection}try{if(t){let c=await o.restartICE(t);return o.isInRestartIce=!1,c}{let c=await o.restartICE();if(c){let u=await ei(this,dt.RequestP2PRestartICE,{direction:Ys.RECEIVE_ONLY,iceParameter:c});await o.restartICE(u),o.isInRestartIce=!1}}}finally{r()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;let e=this.sendConnection.getStats(),t=this.localTrackMap.get(xe.LocalVideoTrack),r=this.localTrackMap.get(xe.LocalAudioTrack),o=e.videoSend.find(A=>{var F;return A.ssrc===(t==null||(F=t.ssrcs)===null||F===void 0?void 0:F[0].ssrcId)}),c=e.audioSend.find(A=>{var F;return A.ssrc===(r==null||(F=r.ssrcs)===null||F===void 0?void 0:F[0].ssrcId)});if(!o||!c)return 1;let u=Jo(this,dt.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,g=h&&m?(h+m)/2:h||m,y=(g&&u?(g+u)/2:g||u)||0,v=100*e.sendPacketLossRate*.7/50+.3*y/1500,R=v<.17?1:v<.36?2:v<.59?3:v<.1?4:5,b=t?.track;if(b&&b._encoderConfig&&b._hints.indexOf(bn.SCREEN_TRACK)===-1){let A=b._encoderConfig.bitrateMax,F=e.bitrate.actualEncoded;if(A&&F){let M=(1e3*A-F)/(1e3*A);return JW[M<.15?0:M<.3?1:M<.45?2:M<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;let e=this.recvConnection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(r=>{let[o]=r,c=o._audioSSRC,u=o._videoSSRC,h=e.audioRecv.find(F=>F.ssrc===c),m=e.videoRecv.find(F=>F.ssrc===u);if(!h&&!m)return void(t+=1);let g=Jo(this,dt.NeedSignalRTT),y=e.rtt,v=(y&&g?(y+g)/2:y||g)||0,R=h?h.jitterMs:void 0,b=e.recvPacketLossRate,A=.7*b*100/50+.3*v/1500;R&&(A=.6*b*100/50+.2*v/1500+.2*R/400),t+=A<.1?1:A<.17?2:A<.36?3:A<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new ze((t,r)=>{this.handleMuteLocalTrack(e,t,r)})}filterTobePublishedTracks(e,t,r){let o=[],c=Qt(),u=this.getAllTracks();e=OE(e=e.filter(g=>u.indexOf(g)===-1));let h=!1,m=!1;for(let g of e){if(g instanceof jn&&(this.localTrackMap.has(xe.LocalVideoTrack)||h?new _e(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:g,type:xe.LocalVideoTrack}),h=!0),t)){let y=this.getLowVideoTrack(g,r);o.push({track:y,type:xe.LocalVideoLowTrack})}if(g instanceof Nr){let y=this.localTrackMap.get(xe.LocalAudioTrack);if(y){if(!(y.track instanceof ai))throw new _e(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new _e(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");y.track.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0)}else if(m){let v=o.find(R=>{let{type:b}=R;return b===xe.LocalAudioTrack});if(!(v.track instanceof ai))throw new _e(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new _e(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(g)}else{if(!c.webAudioMediaStreamDest||g instanceof ai||g._bypassWebAudio)o.push({track:g,type:xe.LocalAudioTrack});else{let v=new ai;v.addAudioTrack(g),o.push({track:v,type:xe.LocalAudioTrack})}m=!0}}}return o}filterTobeUnpublishedTracks(e){let t=[],r=this.getAllTracks();e=OE(e=e.filter(o=>r.indexOf(o)!==-1));for(let o of e){if(o instanceof Nr){let c=this.localTrackMap.get(xe.LocalAudioTrack);if(!c)continue;c.track instanceof ai?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(t.push([xe.LocalAudioTrack,c]),c.track.close())):t.push([xe.LocalAudioTrack,c])}if(o instanceof jn){let c=this.localTrackMap.get(xe.LocalVideoTrack);if(!c)continue;t.push([xe.LocalVideoTrack,c]);let u=this.localTrackMap.get(xe.LocalVideoLowTrack);u&&t.push([xe.LocalVideoLowTrack,u])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:r,type:o}=t;switch(o){case xe.LocalVideoTrack:r.addListener(nt.GET_STATS,this.handleGetLocalVideoStats),r.addListener(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(nt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener(nt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener(nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case xe.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case xe.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof ai?e.trackList.forEach(r=>{r.addListener(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(nt.GET_STATS,this.handleGetLocalAudioStats),r.addListener(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(nt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(nt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[r,{track:o}]=t;return{track:o,type:r}})),e.forEach(t=>{let{track:r,type:o}=t;switch(o){case xe.LocalVideoTrack:r.off(nt.GET_STATS,this.handleGetLocalVideoStats),r.off(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(nt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off(nt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off(nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case xe.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case xe.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof ai?e.trackList.forEach(t=>{t.off(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(nt.GET_STATS,this.handleGetLocalAudioStats),t.off(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(nt.GET_STATS,this.handleGetLocalAudioStats),e.off(nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof WE&&t.addListener(nt.GET_STATS,r=>{r(this.handleGetRemoteVideoStats(e))}),t instanceof GE&&t.addListener(nt.GET_STATS,r=>{r(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(nt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;r.has(et.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has(et.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((r,o)=>{var c;let u,{track:h,type:m}=r;switch(m){case xe.LocalAudioTrack:u=On.Audio;break;case xe.LocalVideoTrack:u=ke(c=h._hints).call(c,bn.SCREEN_TRACK)?On.Screen:On.High;break;case xe.LocalVideoLowTrack:u=On.Low}return{kind:m===xe.LocalAudioTrack?et.AUDIO:et.VIDEO,stream_type:u,mid:t[o].id,ssrcs:t[o].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var r;let o,[c,{track:u,ssrcs:h,id:m}]=t;switch(c){case xe.LocalVideoTrack:o=ke(r=u._hints).call(r,bn.SCREEN_TRACK)?On.Screen:On.High;break;case xe.LocalAudioTrack:o=On.Audio;break;case xe.LocalVideoLowTrack:o=On.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(e,t){e.forEach((r,o)=>{let{track:c,type:u}=r;this.localTrackMap.set(u,{track:c,id:t[o].id,ssrcs:t[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[r]=t;this.localTrackMap.delete(r)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var r;k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(dt.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),ke(r=this._restartStates).call(r,t)&&!e.isInRestartIce&&(t==="disconnected"&&await Ci(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),tt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Fn.TRACER}).onSuccess(),this.emit(dt.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var r;let o=Array.from(ys(r=this.remoteUserMap).call(r)).find(u=>u._audioSSRC===t);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(Qa.FIRST_FRAME_DECODED),tt.firstRemoteFrame(this.store.sessionId,oi.FIRST_AUDIO_DECODE,cr.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:fs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var r;let o=Array.from(ys(r=this.remoteUserMap).call(r)).find(c=>c._audioSSRC===t);o&&tt.firstRemoteFrame(this.store.sessionId,oi.FIRST_AUDIO_RECEIVED,cr.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:fs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,r,o)=>{this.reportVideoFirstFrameDecoded(t,r,o)},e.onFirstVideoReceived=t=>{var r;let o=Array.from(ys(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);o&&tt.firstRemoteFrame(this.store.sessionId,oi.FIRST_VIDEO_RECEIVED,cr.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:fs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,r)=>{let o=t.candidateType==="relay",c=r.candidateType==="relay";r.candidateType!=="unknown"&&o===c||this.emit(dt.ConnectionTypeChange,o),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Cp(r))," -> ").concat(JSON.stringify(Cp(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,r)=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Cp(r))," -> ").concat(JSON.stringify(Cp(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(dt.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){let t=e===Ys.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,k.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Ys.SEND_ONLY?this.restartICE(e):ei(this,dt.RequestP2PRestartICE,{direction:Ys.SEND_ONLY}))}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let r=this.localTrackMap.get(xe.LocalAudioTrack);if(e instanceof Nr&&r?.track instanceof ai)return r.track.isActive||t.push([xe.LocalAudioTrack,r]),t;let o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(t.push(o),o[0]===xe.LocalVideoTrack)){let c=this.localTrackMap.get(xe.LocalVideoLowTrack);c&&t.push([xe.LocalVideoLowTrack,c])}return t}filterTobeUnmutedTracks(e){let t=[],r=this.localTrackMap.get(xe.LocalAudioTrack);if(e instanceof Nr&&r?.track instanceof ai)return r.track.isActive&&t.push([xe.LocalAudioTrack,r]),t;let o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===xe.LocalVideoTrack){t.push(o);let c=this.localTrackMap.get(xe.LocalVideoLowTrack);c&&t.push([xe.LocalVideoLowTrack,c])}else t.push(o);return t}createMuteMessage(e){return e.map(t=>{var r;let o,[c,{track:u,ssrcs:h,id:m}]=t;switch(c){case xe.LocalAudioTrack:o=On.Audio;break;case xe.LocalVideoTrack:o=ke(r=u._hints).call(r,bn.SCREEN_TRACK)?On.Screen:On.High;break;case xe.LocalVideoLowTrack:o=On.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(e){return e.map(t=>{var r;let o,[c,{track:u,ssrcs:h,id:m}]=t;switch(c){case xe.LocalAudioTrack:o=On.Audio;break;case xe.LocalVideoTrack:o=ke(r=u._hints).call(r,bn.SCREEN_TRACK)?On.Screen:On.High;break;case xe.LocalVideoLowTrack:o=On.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(e,t){let r=[],o=this.remoteUserMap.get(e);if(!o)return r;if(t){let c=o.get(t);if(!c)return r;r.push([e,{kind:t,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;r.push([e,{kind:u,id:h}])});return r}createUnsubscribeMessage(e){let t=[];return e.forEach(r=>{let[o,{kind:c,id:u}]=r;switch(c){case et.VIDEO:return void(o._videoSSRC&&t.push({stream_type:et.VIDEO,ssrcId:o._videoSSRC}));case et.AUDIO:return void(o._audioSSRC&&t.push({stream_type:et.AUDIO,ssrcId:o._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[r,{kind:o}]=t,c=this.remoteUserMap.get(r);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(r))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(xe.LocalVideoTrack),r=this.localTrackMap.get(xe.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new ze((o,c)=>{this.handleUpdateVideoEncoder(t.track,o,c,!0)})),r&&e.low_stream_uplink&&(await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new ze((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){let e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Nr){let r=this.filterTobeUnmutedTracks(e[t]);if(r.length===0)continue;let o=this.createUnmuteMessage(r);return void await Gn(this,dt.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(dt.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(dt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Ci(Ab(this.dtlsFailedCount,Kr)),this.emit(dt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(xe.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof jn)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof jn).length>1)throw new _e(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Nr).length>1&&(e.some(t=>t instanceof Nr&&t._bypassWebAudio)||!Qt().webAudioMediaStreamDest))throw new _e(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof jn&&this.pendingLocalTracks.some(r=>r instanceof jn))throw new _e(Y.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Nr&&this.pendingLocalTracks.some(r=>r instanceof Nr)&&(!Qt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(r=>r instanceof Nr&&r._bypassWebAudio)))throw new _e(Y.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let r=!z("DISABLE_DUAL_STREAM_USE_ENCODING")&&Qt().supportDualStreamEncoding,o=KI(KI({},{width:160,height:120,framerate:15,bitrate:50}),t),c;c=r?e._mediaStreamTrack.clone():GD(e,o);let u=In(8,"track-low-"),h=new jn(c,KI(KI({},r&&{scaleResolutionDownBy:yD(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,u);return h.on(Bm.TRANSCEIVER_UPDATED,m=>{e._updateRtpTransceiver(m,ME.LOW_STREAM)}),h._hints.push(bn.LOW_STREAM),e.addListener(nt.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,r,o){var c;let u=Array.from(ys(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());let h=this.store.keyMetrics,m=h.subscribe.find(g=>g.userId===u.uid&&g.type==="video");tt.firstRemoteVideoDecode(this.store.sessionId,oi.FIRST_VIDEO_DECODE,cr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:t,videoheight:r,subscribeElapse:fs.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:m?.subscribeEnd||0,subscriberStart:m?.subscribeStart||0,videoAddNotify:m?.streamAdded||0,state:o?1:0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.recvConnection)return!1;let o=this.remoteUserMap.get(e);if(!o)return!1;let c=o.get(t);if(!c)return!1;let u=await this.recvConnection.getRemoteSSRC(c);return u!==void 0&&u!==r}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new _e(Y.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new _e(Y.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new _e(Y.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new _e(Y.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new _e(Y.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new _e(Y.NOT_SUPPORTED)}async preConnect(e){throw new _e(Y.NOT_SUPPORTED)}getEstablishParams(){throw new _e(Y.NOT_SUPPORTED)}async reSubscribe(e){throw new _e(Y.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new _e(Y.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:r}]=e;t===xe.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,ME.LOW_STREAM):r._updateRtpTransceiver(void 0)})}},Ye(hr.prototype,"p2pConnect",[xz],Object.getOwnPropertyDescriptor(hr.prototype,"p2pConnect"),hr.prototype),Ye(hr.prototype,"unpublish",[Lz],Object.getOwnPropertyDescriptor(hr.prototype,"unpublish"),hr.prototype),Ye(hr.prototype,"unpublishLowStream",[Mz],Object.getOwnPropertyDescriptor(hr.prototype,"unpublishLowStream"),hr.prototype),Ye(hr.prototype,"subscribe",[Uz],Object.getOwnPropertyDescriptor(hr.prototype,"subscribe"),hr.prototype),Ye(hr.prototype,"mockSubscribe",[Vz],Object.getOwnPropertyDescriptor(hr.prototype,"mockSubscribe"),hr.prototype),Ye(hr.prototype,"unsubscribe",[Fz],Object.getOwnPropertyDescriptor(hr.prototype,"unsubscribe"),hr.prototype),Ye(hr.prototype,"muteRemote",[jz],Object.getOwnPropertyDescriptor(hr.prototype,"muteRemote"),hr.prototype),Ye(hr.prototype,"unmuteRemote",[Bz],Object.getOwnPropertyDescriptor(hr.prototype,"unmuteRemote"),hr.prototype),Ye(hr.prototype,"hasRemoteMediaWithLock",[Wz],Object.getOwnPropertyDescriptor(hr.prototype,"hasRemoteMediaWithLock"),hr.prototype),Ye(hr.prototype,"disconnectForReconnect",[Gz],Object.getOwnPropertyDescriptor(hr.prototype,"disconnectForReconnect"),hr.prototype),Ye(hr.prototype,"remoteMediaSsrcChanged",[Hz],Object.getOwnPropertyDescriptor(hr.prototype,"remoteMediaSsrcChanged"),hr.prototype),hr);function Ql(e){return function(t,r,o){let c=t[r];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];switch(e){case $l.SEND_ONLY:{let g=await this.sendMutex.lock("From P2PChannel2.".concat(r));try{return await c.apply(this,h)}finally{g()}}case $l.RECEIVE_ONLY:{let g=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await c.apply(this,h)}finally{g()}}default:{let g=await this.sendMutex.lock("From P2PChannel2.".concat(r)),y=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await c.apply(this,h)}finally{g(),y()}}}},o}}class cg extends dr{constructor(t,r){super(),V(this,"signal",void 0),V(this,"token",void 0),V(this,"tokenTimeout",void 0),V(this,"tokenInterval",void 0),V(this,"_sequence",0),V(this,"userMap",new Map),V(this,"encoder",new TextEncoder),this.signal=t,this.token=r;let o=()=>{this.signal.connectionState===nn.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(o,1e3):this.tokenInterval=window.setTimeout(o,3*z("P2P_TOKEN_INTERVAL"))};o()}async send(t,r,o,c,u){var h;if(this.userMap.size===0)return;let m=Array.from(Yo(h=this.userMap).call(h))[0].token;typeof r!="string"&&(r=JSON.stringify(r)),c=c??In(6,""),u=u??this._sequence++;let g={_id:c,_type:t,_seq:u,_message:r,token:"".concat(this.token,"_").concat(m)};z("SHOW_P2P_LOG")&&k.debug("send message",g,"noNeedResponse : ".concat(o)),this.splitMessage(JSON.stringify(g)).forEach(v=>{this.signal.request(ct.DATA_STREAM,{payload:yp(this.encoder.encode(v))})});let y=new ze((v,R)=>{let b=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),A),this.off("res-@".concat(c),M),this.off(qE.ABORT,F),k.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(c)),this.userMap.size===0?R(new _e(Y.INVALID_REMOTE_USER)):R(new _e(Y.TIMEOUT))},z("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),A=()=>{b&&window.clearTimeout(b),this.off(qE.ABORT,F),o&&v()},F=()=>{b&&window.clearTimeout(b),this.off("res-@".concat(c,"_ack"),A),this.off("res-@".concat(c),M),R(new _e(Y.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(c)))};this.once(qE.ABORT,F),this.once("res-@".concat(c,"_ack"),A);let M=(K,q)=>{j=!0,b&&window.clearTimeout(b),this.off("res-@".concat(c,"_ack"),A),this.off(qE.ABORT,F),K==="success"?v(q):R(new _e(Y.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(c)))},j=!1;o||(this.once("res-@".concat(c),M),Ci(z("SIGNAL_REQUEST_TIMEOUT")).then(()=>{j||k.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(c,", ").concat(g))}))});try{return await y}catch(v){if(v.code===Y.TIMEOUT)return await this.send(t,r,o,c,u);throw v}}onMessage(t){var r;let{_uid:o}=t,c,u=this.userMap.get(o);if(u)c=u.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Fr.CHECK)return;let{token:y}=t;c=new Map,u={uid:o,isStart:!0,token:y,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(o,u),this.signal.emit(wt.ON_USER_ONLINE,{uid:o}),this.handleUserOnline()}if("id"in t&&"total"in t){var h;let{id:y,total:v}=t,R=(h=c.get(y))!==null&&h!==void 0?h:[];if(R.push(t),c.has(y)||c.set(y,R),R.length!==v)return;{let b=wm(R).call(R,(A,F)=>A.index-F.index).map(A=>A.payload).join("");c.delete(y),(t=JSON.parse(b))._uid=o}}let{_type:m,token:g}=t;if(ke(r=[Fr.ACK,Fr.CHECK]).call(r,m))return m===Fr.CHECK&&this.handleCheckToken(u,g),void this.receiveMessage(t);g==="".concat(u.token,"_").concat(this.token)?this.handleReceivedMessage(t):k.debug('Receive unexpected message", '.concat(g,", cur_token: ").concat(u.token,"_").concat(this.token),t)}check(){let t={_id:In(6,""),token:this.token,_type:Fr.CHECK};z("SHOW_P2P_LOG")&&k.debug("send message",t),this.signal.request(ct.DATA_STREAM,{payload:yp(this.encoder.encode(JSON.stringify(t)))})}ack(t){let r={_id:t,_type:Fr.ACK,token:this.token};z("SHOW_P2P_LOG")&&k.debug("send message",r),this.signal.request(ct.DATA_STREAM,{payload:yp(this.encoder.encode(JSON.stringify(r)))})}response(t,r,o){this.send(Fr.RESPONSE,JSON.stringify({success:!o,message:r}),!0,t)}handleReceivedMessage(t){let r=()=>{this.userMap.forEach(y=>{let{receivedMessagesMap:v,nextExpectedSequenceNumber:R}=y;for(;v.has(R);){let b=v.get(R);v.delete(R),this.receiveMessage(b),y.nextExpectedSequenceNumber++}})};if(!t)return void r();let{_uid:o,_seq:c}=t,u=this.userMap.get(o),{receivedMessagesMap:h,isStart:m,nextExpectedSequenceNumber:g}=u;if(c<g)return this.ack(t._id),void k.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(t._message));h.set(c,t),m&&c===g&&(this.receiveMessage(t),h.delete(g),u.nextExpectedSequenceNumber++,r())}receiveMessage(t){let{_id:r,_type:o,_message:c,_uid:u}=t;if(z("SHOW_P2P_LOG")&&k.debug("receive message",t),r){let h;switch(t._type!==Fr.ACK&&(c&&(h=JSON.parse(c)),this.ack(t._id)),t._type){case Fr.CANDIDATE:case Fr.CONTROL:this.signal.emit(o,h,u);break;case Fr.PUBLISH:case Fr.UNPUBLISH:case Fr.RESTART_ICE:case Fr.CALL:h.uid=u,ei(this.signal,o,h).then(m=>{this.response(t._id,m)}).catch(()=>{this.response(t._id,void 0,!0)});break;case Fr.ACK:this.getListeners("res-@".concat(r,"_ack")).length>0&&this.emit("res-@".concat(r,"_ack"));break;case Fr.RESPONSE:{let{success:m,message:g}=h;this.emit("res-@".concat(r),m?"success":"failed",g);break}}}}splitMessage(t){if(t.length<cg.MAX_MESSAGE_SIZE)return[t];let r=[],{remoteToken:o}=JSON.parse(t),c=In(6,""),u=0,h=800,m=Math.ceil(t.length/h);for(;t.length>0;){u++;let g={id:c,index:u,total:m,payload:t.slice(0,h),token:"".concat(this.token,"_").concat(o)};JSON.stringify(g).length>cg.MAX_MESSAGE_SIZE?h-=50:(r.push(g),t=t.slice(h))}return r.map(g=>JSON.stringify(g))}handleCheckToken(t,r){return t.token!==r?(k.debug("token changed, from ".concat(t.token," to ").concat(r)),this.reset(t.uid,r),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{k.debug("token timeout, ".concat(r)),this.reset(t.uid)},z("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){let t=await ei(this.signal,Fr.CALL,void 0),r=await this.send(Fr.CALL,t);this.signal.emit(rt.P2P_CONNECTION,r,!0)}async reset(t,r){let o=this.userMap.get(t);o&&(this.emit(qE.ABORT),this.signal.emit(wt.ON_USER_OFFLINE,{uid:o.uid,reason:Dhe.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),r||(k.debug("change local token from ".concat(r," to ").concat(r)),this.token=In(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(qE.ABORT)}}V(cg,"MAX_SIZE",1),V(cg,"MAX_MESSAGE_SIZE",1024);class yme extends dr{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===nn.CONNECTED?this.emit(rt.WS_CONNECTED):t===nn.RECONNECTING?this.emit(rt.WS_RECONNECTING,this._websocketReconnectReason):t===nn.CLOSED&&this.emit(rt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,r){super(),V(this,"__name__","P2PSignal"),V(this,"_disconnectedReason",void 0),V(this,"_websocketReconnectReason",void 0),V(this,"_connectionState",nn.CLOSED),V(this,"reconnectToken",void 0),V(this,"p2pToken",void 0),V(this,"websocket",void 0),V(this,"openConnectionTime",void 0),V(this,"clientId",void 0),V(this,"lastMsgTime",Date.now()),V(this,"uploadCache",[]),V(this,"uploadCacheInterval",void 0),V(this,"rttRolling",new Tk(5)),V(this,"pingpongTimer",void 0),V(this,"pingpongTimeoutCount",0),V(this,"joinResponse",void 0),V(this,"multiIpOption",void 0),V(this,"initError",void 0),V(this,"spec",void 0),V(this,"store",void 0),V(this,"_external_signal",void 0),V(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(rt.ON_BINARY_DATA,o.data);let c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){let u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case wt.ON_DATA_STREAM:return void this.handleDataStream(c._message);case wt.MUTE_AUDIO:case wt.MUTE_VIDEO:case wt.ON_P2P_LOST:case wt.ON_USER_ONLINE:return;case wt.ON_USER_OFFLINE:let{uid:u}=c._message;return k.debug("[".concat(this.clientId,"] user-offline uid: ").concat(u)),void this._external_signal.reset(u)}if(this.emit(c._type,c._message),c._type===wt.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===wt.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(tn.UID_BANNED);break;case 15:this.close(tn.IP_BANNED);break;case 16:this.close(tn.CHANNEL_BANNED)}if(c._type===wt.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case pt.ERR_LICENSE_MISSING:this.close(tn.LICENSE_MISSING);break;case pt.ERR_LICENSE_EXPIRED:this.close(tn.LICENSE_EXPIRED);break;case pt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(tn.LICENSE_MINUTES_EXCEEDED);break;case pt.ERR_LICENSE_PERIOD_INVALID:this.close(tn.LICENSE_PERIOD_INVALID);break;case pt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(tn.LICENSE_MULTIPLE_SDK_SERVICE);break;case pt.ERR_LICENSE_ILLEGAL:this.close(tn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=r,this.websocket=new gD("gateway-".concat(this.clientId),this.spec.retryConfig,!0,z("JOIN_GATEWAY_USE_DUAL_DOMAIN"),z("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===nn.CONNECTED&&this.reconnect("retry",ts.OFFLINE)}),this.p2pToken=In(6,""),this._external_signal=new cg(this,this.p2pToken)}async request(t,r,o,c){let u=In(6,""),h={_id:u,_type:t,_message:r},m=this.websocket.connectionID,g=()=>new ze((F,M)=>{if(this.connectionState===nn.CONNECTED)return F();let j=()=>{this.off(rt.WS_CLOSED,K),F()},K=()=>{this.off(rt.WS_CONNECTED,j),M(new _e(Y.WS_ABORT))};this.once(rt.WS_CONNECTED,j),this.once(rt.WS_CLOSED,K)});if(this.connectionState!==nn.CONNECTING&&this.connectionState!==nn.RECONNECTING||t===ct.JOIN||t===ct.REJOIN||await g(),this.websocket.sendMessage(h,!0),c)return;let y=new ze((F,M)=>{let j=!1,K=(Q,se)=>{j=!0,F({isSuccess:Q==="success",message:se||{}}),this.off(rt.WS_CLOSED,q),this.off(rt.WS_RECONNECTING,q),this.emit(rt.REQUEST_SUCCESS,t,r)};this.once("res-@".concat(u),K);let q=()=>{M(new _e(Y.WS_ABORT,"type: ".concat(t))),this.off(rt.WS_CLOSED,q),this.off(rt.WS_RECONNECTING,q),this.off("res-@".concat(u),K)};this.once(rt.WS_CLOSED,q),this.once(rt.WS_RECONNECTING,q),Ci(z("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||j||(k.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(rt.REQUEST_TIMEOUT,t,r))})}),v=null;try{v=await y}catch(F){if(this.connectionState===nn.CLOSED||t===ct.LEAVE)throw new _e(Y.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?F.throw():t===ct.JOIN||t===ct.REJOIN?null:(await g(),await this.request(t,r))}if(v.isSuccess)return v.message;let R=Number(v.message.error_code||v.message.code),b=Xm(R),A=new _e(Y.UNEXPECTED_RESPONSE,"".concat(b.desc,": ").concat(v.message.error_str),{code:R,data:v.message,desc:b.desc});return b.action==="success"?v.message:(k.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(R,", message: ").concat(b.desc,", action: ").concat(b.action)),R===pt.ERR_TOO_MANY_BROADCASTERS?((t===ct.JOIN||t===ct.REJOIN)&&(this.initError=A,this.close()),A.throw()):b.action==="failed"?A.throw():b.action==="quit"?(this.initError=A,this.close(),A.throw()):(R===pt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=v.message.option,k.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",ts.MULTI_IP)):this.reconnect(b.action,ts.SERVER_ERROR),t===ct.JOIN||t===ct.REJOIN?null:await this.request(t,r)))}waitMessage(t,r){return new ze(o=>{let c=u=>{(!r||r(u))&&(this.off(t,c),o(u))};this.on(t,c)})}uploadWRTCStats(t){if(!this.store.sessionId)return void k.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(qm.WRTC_STATS,r)}upload(t,r){let o={_type:t,_message:r};try{this.websocket.sendMessage(o)}catch{let c=z("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>c&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==nn.CONNECTED)return;let u=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(u._type,u._message)},z("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,r){let o={_type:t,_message:r};this.websocket.sendMessage(o)}async sendExtensionMessage(t,r,o){return await this._external_signal.send(t,r,o)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ze((r,o)=>{this.once(rt.WS_CONNECTED,()=>r(this.joinResponse)),this.once(rt.WS_CLOSED,()=>o(this.initError||new _e(Y.WS_ABORT))),this.connectionState=nn.CONNECTING,this.websocket.init(t).catch(o)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||tn.LEAVE,this.connectionState=nn.CLOSED,k.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=In(6,""),this._external_signal.clear(),this._external_signal=new cg(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(rt.ABORT_P2P_EXECUTION);let t=await ei(this,rt.REQUEST_JOIN_INFO),r=await this.request(ct.JOIN,t);if(!r)return this.emit(rt.REPORT_JOIN_GATEWAY,Y.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(rt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=nn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,r)}async downgradeCodec(t){return!1}handleDataStream(t){try{var r;let o=Mm(t.payload),c=new TextDecoder().decode(o),u=JSON.parse(c);"total"in u&&"id"in u||ke(r=Object.values(Fr)).call(r,u._type)?(u._uid=t.uid,this._external_signal.onMessage(u)):this.emit(wt.ON_DATA_STREAM,t)}catch{this.emit(wt.ON_DATA_STREAM,t)}}handleNotification(t){k.debug("[".concat(this.clientId,"] receive notification: "),t);let r=Xm(t.code);if(r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?t.code===pt.ERR_REPEAT_JOIN_CHANNEL&&z("IGNORE_UID_CHECK")?void this.close(tn.UID_CONFLICT):(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(tn.UID_BANNED),void this.close()):void this.reconnect(r.action,ts.SERVER_ERROR);k.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=z("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=t&&(k.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>z("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ts.TIMEOUT):this.request(ct.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let o=Date.now()-r;this.rttRolling.add(o),z("REPORT_STATS")&&this.send(ct.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWebsocketEvents(){this.websocket.on(Ot.RECONNECT_CREATE_CONNECTION,t=>{this.emit(rt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Ot.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ot.CLOSED,()=>{this.connectionState=nn.CLOSED}),this.websocket.on(Ot.FAILED,()=>{this._disconnectedReason=tn.NETWORK_ERROR,this.connectionState=nn.CLOSED}),this.websocket.on(Ot.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===nn.CONNECTED?this.connectionState=nn.RECONNECTING:this.connectionState=nn.CONNECTING}),this.websocket.on(Ot.WILL_RECONNECT,(t,r,o)=>{t!=="retry"?(k.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):k.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),o(t)}),this.websocket.on(Ot.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(rt.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof _e&&t.code===Y.UNEXPECTED_RESPONSE&&t.data.code===pt.ERR_NO_AUTHORIZED)return k.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",ts.SERVER_ERROR);k.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ts.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Ot.REQUEST_NEW_URLS,(t,r)=>{ei(this,rt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(r)}),this.websocket.on(Ot.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(wt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}let vme={name:"P2PChannel",create:function(e){let{store:t,statsCollector:r}=e;return new Eme(t,r)},createSubmodule:function(e){let{store:t,spec:r}=e;return new yme(r,t)}};function Kz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function Yz(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Kz(Object(r),!0).forEach(function(o){V(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kz(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}class Sme{constructor(t){V(this,"sessionDesc",void 0),V(this,"localCapabilities",void 0),V(this,"rtpCapabilities",void 0),V(this,"candidates",void 0),V(this,"_originCandidates",void 0),V(this,"iceParameters",void 0),V(this,"dtlsParameters",void 0),V(this,"setup",void 0),V(this,"currentMidIndex",void 0),V(this,"cname",void 0),t=Zn(t);let{iceParameters:r,dtlsParameters:o,candidates:c,rtpCapabilities:u,setup:h,localCapabilities:m,sdkCodec:g,cname:y}=t,v=Hs(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=c,this._originCandidates=Zn(c),this.iceParameters=r,this.dtlsParameters=o,this.setup=h,this.localCapabilities=m,this.cname=y;for(let R=0;R<v.mediaDescriptions.length;R++){let b=v.mediaDescriptions[R];if(b.attributes.iceUfrag=r.iceUfrag,b.attributes.icePwd=r.icePwd,b.attributes.fingerprints=o.fingerprints,b.attributes.candidates=c,b.attributes.setup=h,b.media.mediaType==="video"){b.media.fmts=u.videoCodecs.map(M=>M.payloadType.toString(10));let A=u.videoCodecs.filter(M=>{var j,K;return(j=M.rtpMap)===null||j===void 0?void 0:ke(K=j.encodingName.toLowerCase()).call(K,g)}),F=u.videoCodecs.filter(M=>!ke(A).call(A,M));b.attributes.payloads=[...A,...F],b.attributes.extmaps=u.videoExtensions}b.media.mediaType==="audio"&&(b.media.fmts=u.audioCodecs.map(A=>A.payloadType.toString(10)),b.attributes.payloads=u.audioCodecs,b.attributes.extmaps=u.audioExtensions),v.mediaDescriptions[R]=this.mungMediaDesc(b)}this.sessionDesc=v,this.currentMidIndex=v.mediaDescriptions.length-1}toString(){return th(this.sessionDesc)}send(t,r,o){let{ssrcs:c,ssrcGroups:u}=KT(r,this.cname),h=this.sessionDesc.mediaDescriptions.find(y=>t===et.VIDEO?y.media.mediaType==="video":y.media.mediaType==="audio"),m=c[0].attributes.label,g=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(u),{id:m,mslabel:g}}batchSend(t){return t.map(r=>{let{kind:o,ssrcMsg:c}=r;return this.send(o,c,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(r=>{let o=[],c=[],u=[];r.attributes.ssrcs.forEach(h=>{ke(t).call(t,h.attributes.label||"")?u.push(h):o.push(h)}),r.attributes.ssrcGroups.forEach(h=>{var m;ke(m=u.map(g=>g.ssrcId)).call(m,h.ssrcIds[0])||c.push(h)}),r.attributes.ssrcs=o,r.attributes.ssrcGroups=c})}mute(t){let r=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===t);if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));r.attributes.direction="inactive"}unmute(t){let r=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===t);if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));r.attributes.direction="sendonly"}receive(t,r,o){t.forEach((c,u)=>{let h=c._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(y=>y.attributes.mid===h.kind),g=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],c);this.sessionDesc.mediaDescriptions[m]=g})}stopReceiving(t){}updateCandidates(t){let r=this._originCandidates.filter(c=>c.transport==="udp"),o=[];if(r.forEach(c=>{o.push(Yz(Yz({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),r.length!==0){switch(t){case Di.TCP_RELAY:this.candidates=o;break;case Di.UDP_TCP_RELAY:case Di.RELAY:this.candidates=[...r,...o];break;default:this.candidates=r}for(let c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(t){t=Zn(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}predictReceivingMids(t){let r=[];for(let o=0;o<t;o++)r.push((this.currentMidIndex+o+1).toString(10));return r}mungRecvMediaDsec(t,r){let o=Zn(t);return Jm(o,r),TD(o,r),o}updateRecvMedia(t,r){let o=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===t);if(o!==-1){let c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],r);this.sessionDesc.mediaDescriptions[o]=c}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,r,o){let c=this.sessionDesc.mediaDescriptions.find(h=>t===et.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){let h=c.attributes.ssrcs.find(m=>m.attributes.label===r);var u;h&&(h.attributes.label=o,(u=h.attributes.msid)===null||u===void 0||u.replace(r,o))}}mungMediaDesc(t){let r=Zn(t);return SD(r),(function(o){let c=o.attributes.extmaps.find(u=>lI(u.extensionName));c&&o.attributes.extmaps.splice(o.attributes.extmaps.indexOf(c),1),o.attributes.payloads.forEach(u=>{let h=u.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&u.rtcpFeedbacks.splice(h,1)})})(r),r}getSSRC(t){for(let r of this.sessionDesc.mediaDescriptions)for(let o of r.attributes.ssrcs)if(o.attributes.label===t)return[o]}}var Hn;function qz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function YI(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?qz(Object(r),!0).forEach(function(o){V(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qz(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}let Tme=(Hn=class W0 extends iI{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var r;return ke(r=Object.keys(Fm)).call(r,t)}))]}constructor(t,r){super(t,r),V(this,"store",void 0),V(this,"peerConnection",void 0),V(this,"remoteSDP",void 0),V(this,"initialOffer",void 0),V(this,"statsFilter",void 0),V(this,"useRTX",!1),V(this,"localCapabilities",void 0),V(this,"localCandidateCount",0),V(this,"allCandidatesReceived",!1),V(this,"establishPromise",void 0),V(this,"mutex",void 0),this.store=r,this.mutex=new ki("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(W0.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=kb(this.peerConnection,z("STATS_UPDATE_INTERVAL"),void 0,Qn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{let t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let r=td(t.sdp),o=zT(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:z("FILTER_VIDEO_FEC"),filterAudioFec:z("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=o,this.initialOffer=t,YI(YI({},r),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:o},offerSDP:t.sdp})}catch(t){throw new _e(Y.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Sme(YI(YI({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));let r=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(r){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async updateRemoteRTPCapabilities(t,r){throw new _e(Y.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,r){var o=this;return oo(function*(){let c=yield Ft(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let u=t.map(b=>o.peerConnection.addTrack(b._mediaStreamTrack)),h=yield Ft(o.peerConnection.createOffer()),m=Hs(h.sdp),g=t.map(b=>{let A=b._mediaStreamTrack,F=m.mediaDescriptions.find(M=>M.attributes.mid===A.kind);if(!F)throw new Error("Cannot extract ssrc from mediaDescription.");return(function(M,j,K){let q=M.attributes.ssrcs.filter(se=>se.attributes.label===j),Q=M.attributes.ssrcGroups;if(q.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(Q&&q.length>1){let se=Q.find(oe=>oe.ssrcIds.indexOf(q[0].ssrcId)!==-1);return se?[{ssrcId:se.ssrcIds[0],rtx:K?se.ssrcIds[1]:void 0}]:[{ssrcId:q[0].ssrcId}]}return[{ssrcId:q[0].ssrcId}]})(F,A.id,o.useRTX)}),y;try{y=yield g}catch(b){throw u.forEach(A=>{Pi()&&A.replaceTrack(null),o.peerConnection.removeTrack(A)}),b}let v=o.mungSendOfferSDP(h.sdp,t);o.remoteSDP.receive(t,r,y);let R=o.remoteSDP.toString();return yield Ft(o.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield Ft(o.applySendEncodings(u,t)),yield Ft(o.peerConnection.setRemoteDescription({type:"answer",sdp:R})),t.map((b,A)=>{let F=b._mediaStreamTrack.id;return{localSSRC:g[A],id:F}})}catch(u){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{c()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let r=this.peerConnection.getSenders().filter(u=>{var h;return t.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r.map(u=>{Pi()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)});let o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(t);let c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}}async receive(t,r,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{id:u,mslabel:h}=this.remoteSDP.send(t,r,c),m=new ze((v,R)=>{let b=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(u)))},1e4),A=F=>{let M=pn();if((M.name==="Safari"&&Number(M.version)===11||Es())&&F.track.id!==u&&F.streams[0].id===h){var j;let K=F.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(t,u,F.track.id),this.peerConnection.removeEventListener("track",A),clearTimeout(b),void v(K)}if(F.track.id===u)return this.peerConnection.removeEventListener("track",A),clearTimeout(b),void v(F.track)};this.peerConnection.addEventListener("track",A)}),g=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:g});let y=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(y),{track:await m,id:u}}catch(u){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o)}catch(r){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let r=this.peerConnection.getSenders().filter(o=>{var c;return t.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(r.length!==t.length)throw new Error("sender' length doesn't match mids' length.");r.map(o=>{if(Pi()&&o.track)o.track.enabled=!1;else{let c=o.getParameters();c.encodings.forEach(u=>u.active=!1),o.setParameters(c)}})}catch(r){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let r=this.peerConnection.getSenders().filter(u=>{var h;return t.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(r.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");r.map(async u=>{if(Pi()&&u.track)u.track.enabled=!0;else{let h=u.getParameters();h.encodings.forEach(m=>m.active=!0),await u.setParameters(h)}});let o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o);let c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return oo(function*(){let o=yield Ft(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");let c=Qt().supportPCSetConfiguration;if(t===Di.RELAY&&!c)return;if(c){let y=r.peerConnection.getConfiguration(),v=t===Di.RELAY?"relay":"all";y.iceTransportPolicy!==v&&(k.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(y.iceTransportPolicy,"] to [").concat(v,"]")),y.iceTransportPolicy=v,r.peerConnection.setConfiguration(y))}t!==Di.RELAY&&r.remoteSDP.updateCandidates(t);let u=yield Ft(r.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let h=td(u.sdp),{remoteIceParameters:m}=yield h.iceParameters;r.remoteSDP.restartICE(m);let g=r.remoteSDP.toString();yield Ft(r.peerConnection.setLocalDescription(u)),yield Ft(r.peerConnection.setRemoteDescription({type:"answer",sdp:g}))}catch(c){k.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[r]);this.remoteSDP.updateRecvMedia(r._mediaStreamTrack.kind,r);let u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new _e(Y.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(t,r){let o=this.peerConnection.getSenders().filter(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===t});o.length===1&&await this.applySendEncodings(o,[r])}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){let o=this.peerConnection.getSenders().find(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===r});o&&await o.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,r){throw new _e(Y.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new _e(Y.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},z("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let r={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(km(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...W0.turnServerConfigToIceServers(t.turnServer.servers)),z("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...W0.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(t){let r=[];return t.forEach(o=>{o.security?o.tcpport&&r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),r}async updateRtpSenderEncodings(t,r){var o;if(r||(r=this.peerConnection.getSenders().find(y=>{var v;return((v=y.track)===null||v===void 0?void 0:v.id)===t._mediaStreamTrack.id})),!r)return k.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Qt().supportSetRtpSenderParameters)return k.warn("Browser not support set rtp-sender parameters");let c={},u={};if(t instanceof jn)switch(t._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(z("DSCP_TYPE")&&Xu()){var h;let y=z("DSCP_TYPE");ke(h=["very-low","low","medium","high"]).call(h,y)&&(u.networkPriority=y)}let m=r.getParameters(),g=(o=m.encodings)===null||o===void 0?void 0:o[0];g&&Object.assign(g,u),Object.assign(m,c),k.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await r.setParameters(m)}async applySendEncodings(t,r){try{if(!Qt().supportSetRtpSenderParameters||t.length!==r.length)return;for(let o=0;o<t.length;o++){let c=t[o],u=r[o];c&&u&&await this.updateRtpSenderEncodings(u,c)}}catch{k.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r){let o=Hs(t);return r.forEach((c,u)=>{let h=c._mediaStreamTrack,m=o.mediaDescriptions.find(g=>g.attributes.mid===h.kind);m&&Jm(m,c)}),th(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,r,o)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,t,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let r=this.remoteSDP.batchSend(t).map((u,h)=>{let{id:m,mslabel:g}=u,{kind:y}=t[h];return new ze((v,R)=>{let b=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(m)))},1e4),A=F=>{let M=pn();if(M.name==="Safari"&&Number(M.version)===11&&F.track.id!==m&&F.streams[0].id===g){var j;let K=F.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(y,m,F.track.id),this.peerConnection.removeEventListener("track",A),clearTimeout(b),void v({track:K,id:m})}if(F.track.id===m)return this.peerConnection.removeEventListener("track",A),clearTimeout(b),void v({track:F.track,id:m})};this.peerConnection.addEventListener("track",A)})}),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});let c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await ze.all(r)}catch(r){throw new _e(Y.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async getRemoteSSRC(t){return this.remoteSDP?this.remoteSDP.getSSRC(t)?.[0].ssrcId:void 0}setConfiguration(t){if(Qt().supportPCSetConfiguration){let r=W0.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}}},Ye(Hn.prototype,"connect",[ic],Object.getOwnPropertyDescriptor(Hn.prototype,"connect"),Hn.prototype),Ye(Hn.prototype,"stopSending",[ic],Object.getOwnPropertyDescriptor(Hn.prototype,"stopSending"),Hn.prototype),Ye(Hn.prototype,"receive",[ic],Object.getOwnPropertyDescriptor(Hn.prototype,"receive"),Hn.prototype),Ye(Hn.prototype,"stopReceiving",[ic],Object.getOwnPropertyDescriptor(Hn.prototype,"stopReceiving"),Hn.prototype),Ye(Hn.prototype,"muteRemote",[ic],Object.getOwnPropertyDescriptor(Hn.prototype,"muteRemote"),Hn.prototype),Ye(Hn.prototype,"unmuteRemote",[ic],Object.getOwnPropertyDescriptor(Hn.prototype,"unmuteRemote"),Hn.prototype),Ye(Hn.prototype,"muteLocal",[ic],Object.getOwnPropertyDescriptor(Hn.prototype,"muteLocal"),Hn.prototype),Ye(Hn.prototype,"unmuteLocal",[ic],Object.getOwnPropertyDescriptor(Hn.prototype,"unmuteLocal"),Hn.prototype),Ye(Hn.prototype,"close",[ic],Object.getOwnPropertyDescriptor(Hn.prototype,"close"),Hn.prototype),Ye(Hn.prototype,"updateEncoderConfig",[ic],Object.getOwnPropertyDescriptor(Hn.prototype,"updateEncoderConfig"),Hn.prototype),Ye(Hn.prototype,"updateSendParameters",[ic],Object.getOwnPropertyDescriptor(Hn.prototype,"updateSendParameters"),Hn.prototype),Ye(Hn.prototype,"replaceTrack",[ic],Object.getOwnPropertyDescriptor(Hn.prototype,"replaceTrack"),Hn.prototype),Ye(Hn.prototype,"getRemoteSSRC",[ic],Object.getOwnPropertyDescriptor(Hn.prototype,"getRemoteSSRC"),Hn.prototype),Hn);function ic(e,t,r){let o=e[t];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let c=this.mutex,u=await c.lock("Locking from P2PConnection.".concat(t));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await o.apply(this,m)}finally{u()}},r}let wme={name:"PlanBConnection",create:function(e){let{store:t,spec:r}=e;return new Tme(r,t)}},Cme={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Qt().supportWebRTCEncodedTransform)return void k.warning("browser not support audio encoded transform");if(zb.has(e)||!e.track)return;let r={track:e.track};if(Zd()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void k.error("create audio-encoded-streams error",h&&h.message)}let u=new TransformStream({transform(h,m){r.controller||(r.controller=m),e.track&&e.track.id!==r.track.id&&(k.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o));let g=t.metadata&&t.metadata();g?(function(y,v){let{chunk:R,controller:b}=v,A=vp.METADATA;R.data=(function(F,M,j){let K=j.byteLength,q=K+Zk+WW,Q=$k+Qk+q,se=new ArrayBuffer(F.byteLength+Q),oe=new DataView(se);oe.setUint8(0,BW),oe.setUint16(1,q),oe.setUint8(3,M),oe.setUint16(4,K);for(let de=0;de<K;de++)oe.setUint8(6+de,j[de]);let te=new Uint8Array(oe.buffer);return te.set(new Uint8Array(F),Q),te.buffer})(R.data,A,y),b.enqueue(R)})(g,{chunk:h,controller:m}):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Pi()){if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");let c=Hb(),u=new MessageChannel;await new ze(m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)});let h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:u.port2},[u.port2]);e.transform=h,await new ze(m=>c.onmessage=g=>{g.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var g;if(m.data.transformed&&e.track&&((g=e.track)===null||g===void 0?void 0:g.id)!==r.track.id)k.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o);else if(m.data.getMetadata){let y=t.metadata&&t.metadata();y&&u.port1.postMessage({metadata:y})}},r.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}let c=zb.get(e);if(c){zb.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){k.warning(m&&m.message)}}}zb.set(e,r),e.track.addEventListener("ended",o)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Qt().supportWebRTCEncodedTransform)return void k.warning("browser not support audio encoded transform");if($b.has(e))return;let r={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(Zd()&&!Es()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");ck(_n.CHROME,87,116)||(t.enableTopn=!1);let c=null;try{c=e.createEncodedStreams()}catch(h){return void k.error("create audio-encoded-streams error",h&&h.message)}let u=new TransformStream({transform(h,m){r.controller||(r.controller=m),e.track&&e.track.id!==r.track.id&&(k.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o)),t.enableTopn?(function(g,y,v){var R;let b=eD(new DataView(y.data));if(!b)return v.enqueue(y);let A=g.track.id;ehe.set(A,g.track);let F=(R=b.tlv.find(se=>se.tag===vp.AUDIO_LEVEL))===null||R===void 0?void 0:R.value,M=0;typeof F=="number"&&(M=127-F);let j=Math.round(Math.pow(10,M/60)-1),{selected:K,speaker:q}=(function(se,oe){let te=HE.get(se);if(te||(te=(function(de){let Ce=new HW;return HE.set(de,Ce),Gl||(Gl=new Qde(z("TOPN_SILENCE_THRESHOLD")||500),Gl.on("ActiveSpeakerChanged",Pe=>{Pe!=null&&(qb=Pe)})),Gl.addSpeakers([Ce]),Ce})(se)),HE.size<=zW)return{selected:!0,speaker:te};if(!Gl)throw new Error("no active speaker detector");return Gl.levelChanged(te.id,oe),zm=Gl.loudest.map(de=>de.id),qb&&!ke(zm).call(zm,qb)&&zm.length>=zW&&zm.pop(),{selected:ke(zm).call(zm,te.id)||te.id===qb,speaker:te}})(g,j),Q=(function(se,oe,te){let de=Hl.get(se)||new Zde(se,oe);return de.score=te,Hl.set(se,de),(function(Ce){if(Xb.set(Ce,!0),!Jb)return void(Jb=Date.now());let Pe=Date.now();Pe-Jb>1e3&&(Xb.get(Ce)?Xb.set(Ce,!1):(KW(Ce),Xb.delete(Ce)),Jb=Pe)})(se),de})(A,g.track,q.energyScore);Q.addSample(K),Q.active&&(y.data=b.frame.buffer,v.enqueue(y))})(e,h,m):t.enableMetadata||t.enablePts?(function(g,y,v,R){let b=new DataView(g.data),A=b.getUint8(0),F;if(128&A&&A!==71){let K=(function(q){if(q.byteLength<=0)return[];let Q=[],se=0;for(;se<q.byteLength;){let te=(128&q.getUint8(se))>>7,de=127&q.getUint8(se);if(!(te&&se+4<=q.byteLength)){se++;break}{let Ce=q.getUint32(se,!1),Pe=(16776192&Ce)>>10,Qe=1023&Ce;Q.push({pt:de,ts_offset:Pe,length:Qe,data:new Uint8Array}),se+=4}}let oe=q.byteLength-se;for(let te of Q){if(te.length>oe)return console.warn("Broken red payload"),[];te.length>0&&(te.data=new Uint8Array(q.buffer,q.byteOffset+se,te.length),se+=te.length,oe-=te.length)}if(oe>0){let te={pt:Q.length>0?Q[Q.length-1].pt:0,ts_offset:0,length:oe,data:new Uint8Array(q.buffer,q.byteOffset+se,oe)};Q.push(te)}return Q})(b);if(K.length>0){let q=(function(Q){let se=0;for(let de=0;de<Q.length;de++)se+=de<Q.length-1?4:1,se+=Q[de].length;let oe=new Uint8Array(se),te=0;for(let de=0;de<Q.length;de++)if(de<Q.length-1){let Ce=(2147483648|(127&Q[de].pt)<<24|(262143&Q[de].ts_offset)<<10|1023&Q[de].length)>>>0;oe[te++]=Ce>>24&255,oe[te++]=Ce>>16&255,oe[te++]=Ce>>8&255,oe[te++]=255&Ce}else oe[te++]=127&Q[de].pt;for(let de of Q)oe.set(de.data,te),te+=de.length;return oe})(K.map(Q=>{let se=new Uint8Array(Q.length);se.set(Q.data);let oe=eD(new DataView(se.buffer));return oe!=null&&oe.frame&&(Q.data=oe?.frame),F=oe,Q}));g.data=q.buffer}}else F=eD(b),F&&(g.data=F.frame.buffer);if(y.enqueue(g),!F)return;let M=F.tlv.find(K=>K.tag===vp.METADATA);M&&v&&M.value instanceof Uint8Array&&v(M.value);let j=F.tlv.find(K=>K.tag===vp.AUDIO_64_BIT_PTS);j&&R&&j.value instanceof Uint8Array&&j.value.length==8&&R(new DataView(j.value.buffer).getBigUint64(0,!0))})(h,m,t.onMetadata,t.onPts):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");let c=Hb(),u=new MessageChannel;await new ze(m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)});let h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:u.port2},[u.port2]);e.transform=h,await new ze(m=>c.onmessage=g=>{g.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var g;m.data.transformed&&e.track&&((g=e.track)===null||g===void 0?void 0:g.id)!==r.track.id?(k.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o)):m.data.metadata&&r.onMetadata?r.onMetadata(m.data.metadata):m.data.pts&&r.onPts&&r.onPts(m.data.pts)},r.worker=c}function o(){e.track.removeEventListener("ended",o),(function(c){let u=$b.get(c);if(u){(function(g){let y=HE.get(g);y&&(HE.delete(g),Gl&&(Gl.removeSpeakers([y]),HE.size===0&&(Gl.destroy(),Gl=null)))})(c),KW(c.track.id),$b.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(g){k.warning(g&&g.message)}}})(e)}$b.set(e,r),e.track.addEventListener("ended",o)},interceptLocalVideoFrame:async function(e,t){if(!Qt().supportWebRTCEncodedTransform)return void k.warning("browser not support video encoded transform");if(Qb.has(e)||!e.track)return;let r={track:e.track};if(Zd()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(m){return void k.error("create video-encoded-streams error",m&&m.message)}let u=[];t.on("sei-to-send",m=>{u.push(m)});let h=new TransformStream({transform(m,g){r.controller||(r.controller=g),e.track&&e.track.id!==r.track.id&&(k.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o));let y=XW(new Uint8Array(m.data)),v=u.shift();if(v){let R=(function(b,A,F){switch(F){case iD:return(function(M,j){let K=qW(j),q=K.length,Q=Math.floor(q/255),se=q%255,oe=new Uint8Array(6+Q+1+q+M.byteLength);oe[0]=0,oe[1]=0,oe[2]=0,oe[3]=1,oe[4]=6,oe[5]=101;let te=0;for(;te<Q;)oe[6+te]=255,te++;return oe[6+te]=se,te++,oe.set(K,6+te),oe.set(new Uint8Array(M),6+te+q),oe.buffer})(b,A);case sD:return(function(M,j){let K=qW(j),q=K.length,Q=Math.floor(q/255),se=q%255,oe=new Uint8Array(7+Q+1+q+1+M.byteLength);oe[0]=0,oe[1]=0,oe[2]=0,oe[3]=1,oe[4]=78,oe[5]=1,oe[6]=101;let te=0;for(;te<Q;)oe[7+te]=255,te++;return oe[7+te]=se,te++,oe.set(K,7+te),te+=q,oe[7+te]=128,te++,oe.set(new Uint8Array(M),7+te),oe.buffer})(b,A);default:return null}})(m.data,v,y);R&&(m.data=R)}g.enqueue(m)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!Pi())return;{if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");let c=Hb(),u=new MessageChannel;await new ze(m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)});let h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:u.port2},[u.port2]);e.transform=h,await new ze(m=>c.onmessage=g=>{g.data==="started"&&m(void 0)}),t.on("sei-to-send",m=>{u.port1.postMessage({sei:m})}),u.port1.onmessage=m=>{var g;m.data.transformed&&e.track&&((g=e.track)===null||g===void 0?void 0:g.id)!==r.track.id&&(k.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o))},r.worker=c}}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}let c=Qb.get(e);if(c){Qb.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){k.warning(m&&m.message)}}}Qb.set(e,r),e.track.addEventListener("ended",o)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Qt().supportWebRTCEncodedTransform)return void k.warning("browser not support video encoded transform");if(!e.track)return;if(BT.has(e)){let c=BT.get(e);return void(c&&(c.onSei=t.onSei))}let r={track:e.track,onSei:t.onSei};if(Zd()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void k.error("create video-encoded-streams error",h&&h.message)}let u=new TransformStream({transform(h,m){if(r.controller||(r.controller=m),!r.firstFrameInfo){var g;let v=h.getMetadata()||{};r.firstFrameInfo=Xn({type:h.type,rtpTimestamp:h.timestamp,payloadType:v.payloadType||0,ssrc:v.synchronizationSource||0,length:h.data.byteLength},"mimeType"in v?{mimeType:v.mimeType}:{}),(g=t.onFirstFrame)===null||g===void 0||g.call(t,r.firstFrameInfo)}e.track&&e.track.id!==r.track.id&&(k.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o));let y=(function(v,R){switch(R){case iD:return(function(b){let A=new DataView(b.data),F=0;for(;F+4<b.data.byteLength;){if(A.getUint8(F+0)===0&&A.getUint8(F+1)===0&&A.getUint8(F+2)===0&&A.getUint8(F+3)===1&&A.getUint8(F+4)===6){let M=F+6,j=0,K=0;for(;(K=A.getUint8(M++))===255;)j+=255;j+=K;let q=YW(b.data,M,j);return new Uint8Array(q)}F++}return null})(v);case sD:return(function(b){let A=new DataView(b.data),F=0;for(;F+5<b.data.byteLength;){if(A.getUint8(F+0)===0&&A.getUint8(F+1)===0&&A.getUint8(F+2)===0&&A.getUint8(F+3)===1&&A.getUint8(F+4)===78&&A.getUint8(F+5)===1&&A.getUint8(F+6)===101){let M=F+7,j=0,K=0;for(;(K=A.getUint8(M++))===255;)j+=255;j+=K;let q=YW(b.data,M,j);return new Uint8Array(q)}F++}return null})(v);default:return null}})(h,XW(new Uint8Array(h.data)));y&&r.onSei&&r.onSei(y),m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Pi()){if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");let c=Hb(),u=new MessageChannel;await new ze(m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)});let h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:u.port2},[u.port2]);e.transform=h,await new ze(m=>c.onmessage=g=>{g.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var g;if(m.data.transformed&&e.track&&((g=e.track)===null||g===void 0?void 0:g.id)!==r.track.id)k.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o);else if(m.data.sei&&r.onSei)r.onSei(m.data.sei);else if(m.data.firstFrameInfo&&t.onFirstFrame){var y;(y=t.onFirstFrame)===null||y===void 0||y.call(t,m.data.firstFrameInfo)}},r.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}(function(c){let u=BT.get(c);if(u){BT.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(g){k.warning(g&&g.message)}}})(e)}BT.set(e,r),e.track.addEventListener("ended",o)}},Rme={name:"InterceptFrame",create:()=>Cme};var ln;function Xz(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}function Zl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Xz(Object(r),!0).forEach(function(o){V(e,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xz(Object(r)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))})}return e}let bme=(ln=class Ry extends iI{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var r;return ke(r=Object.keys(Fm)).call(r,t)}))]}constructor(t,r,o){super(t,r),V(this,"id",In(5,"connection-")),V(this,"store",void 0),V(this,"peerConnection",void 0),V(this,"forceTurn",!1),V(this,"remoteSDP",void 0),V(this,"initialOffer",void 0),V(this,"transportEventReceiver",void 0),V(this,"statsFilter",void 0),V(this,"extension",{useXR:z("USE_XR")}),V(this,"localCapabilities",void 0),V(this,"remoteCodecs",void 0),V(this,"localCandidateCount",0),V(this,"allCandidatesReceived",!1),V(this,"isPreallocation",!1),V(this,"preMediaMap",new Map),V(this,"dataStreamChannelMap",new Map),V(this,"establishPromise",void 0),V(this,"recoveredDataChannelIds",[]),V(this,"currentDataChannelId",1),V(this,"supportAV1RtpSpec",!1),V(this,"mutex",void 0),V(this,"qualityLimitationReason",kE.NONE),V(this,"isFirstConnected",!1),this.store=r,this.forceTurn=WD(t),this.mutex=new ki("NVConnectionExtension-mutex",r.clientId),this.peerConnection=o,this.isFirstConnected=!1,this.statsFilter=kb(this.peerConnection,z("STATS_UPDATE_INTERVAL"),void 0,Qn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,r){if(this.remoteCodecs=r,!this.remoteSDP)return void k.debug("[NVConnectionExtension] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(r));if(this.remoteSDP.updateRemoteCodec(t,r,this.store.codec)){let o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);let u=this.remoteSDP.toString();c?.(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else k.debug("[NVConnectionExtension] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let o=td(r.sdp),c=await CD({filterRTX:!z("USE_PUB_RTX")&&!z("USE_SUB_RTX"),filterVideoFec:z("FILTER_VIDEO_FEC"),filterAudioFec:z("FILTER_AUDIO_FEC"),filterVideoCodec:z("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:z("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:z("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=YT(c),this.initialOffer=r,z("ENABLE_SVC")&&this.store.codec=="av1"){let h=await wG();var t;h&&(this.supportAV1RtpSpec=!0,(t=c.send)===null||t===void 0||t.videoExtensions.push(h))}let u;return r.sdp&&dI(r.sdp)&&(u=Zn(c),mG(u)),Zl(Zl({},o),{},{rtpCapabilities:u||c,offerSDP:r.sdp})}catch(r){throw new _e(Y.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnectionExtension without initial offer.");this.initialOffer.sdp&&dI(this.initialOffer.sdp)&&gG(t.rtpCapabilities,this.localCapabilities),this.remoteSDP=new qG(Zl(Zl({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!z("ENABLE_PRE_SUB_WITH_PRE_PC")||!z("PRE_USE_LOCAL_CODECS"))&&VT(this.store),!0),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let r=this.remoteSDP.toString(),o=RD(this.initialOffer.sdp,this.extension),c=this.logSDPExchange(o||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),c?.(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r});let u=this.peerConnection.getTransceivers()[0];if(u!=null&&u.receiver&&this.tryBindTransportEvents(u.receiver),VT(this.store))if(t.preallocation&&z("ENABLE_PRE_SUB_WITH_PRE_PC")){let h=z("PRE_SUB_NUM"),{mids:m,preSSRCs:g}=this.remoteSDP.preloadRemoteMedia(h);await Oo(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] preload media, in pre pc,add preload ssrcs ").concat(g)),this.presetMedia(m,g)}else{let{preSSRCs:h=[]}=t,m=h.map(y=>y.ssrcMsg[0].ssrcId);if(h.length===0)return;let{mids:g}=this.remoteSDP.batchSend(h.map(y=>Object.assign({},y)));await Oo(this.peerConnection,this.remoteSDP,this.extension),k.debug("[NVConnectionExtension.connect] preload media, after join, add preload ssrcs ".concat(m)),this.presetMedia(g,m)}}catch(r){throw new _e(Y.EXCHANGE_SDP_FAILED,"NVConnectionExtension.connect failed; ".concat(r.toString()))}}presetMedia(t,r){t.forEach((o,c)=>{this.peerConnection.getTransceivers().forEach(u=>{if(u.mid!=null&&o===u.mid&&u.receiver.track){let h=u.receiver.track,m;h.kind==="video"&&z("ENABLE_PRE_RENDER")&&(m=new Wb({trackId:"track-".concat(h.kind,"-unknown-").concat(this.store.clientId,"_").concat(In(5,""))},!0),m.updateVideoTrack(h),m.onFirstVideoFrameRender=()=>{var g;let y=this.preMediaMap.get(r[c]);y&&(y.firstVideoRender=Date.now()),(g=this.onFirstVideoRender)===null||g===void 0||g.call(this,r[c])},m.onVideoBufferReady=()=>{var g;(g=this.onFirstVideoBufferReady)===null||g===void 0||g.call(this,r[c])},m.play(this.store.sessionId||void 0)),this.preMediaMap.set(r[c],{mid:o,track:h,player:m,transceiver:u})}}),this.store.peerReceiver()})}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateRemoteConnect before remote SDP created");let r=!1,{rtpCapabilities:o}=t;if([,r]=this.remoteSDP.updateRemoteRTPCapabilities(o),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){let h=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);r=r||h}let{preSSRCs:c=[]}=t,u=c.map(h=>h.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(u)){let h=[],m=[];if(Array.from(this.preMediaMap.entries()).every(g=>{let[y,{mid:v,player:R,track:b}]=g;return h.push(v),m.push(y),this.preMediaMap.delete(y),R&&R.destroy(),!0}),h.length>0&&(this.remoteSDP.stopSending(h),await Oo(this.peerConnection,this.remoteSDP,this.extension),k.warn("[NVConnectionExtension.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(m)),tt.reportApiInvoke(this.store.sessionId,{name:ar.PRELOAD_MEDIA_FAILED,options:[c,m],tag:Fn.TRACER}).onSuccess()),c.length>0){let{mids:g}=this.remoteSDP.batchSend(c.map(y=>Object.assign({},y)));await Oo(this.peerConnection,this.remoteSDP,this.extension),k.debug("[NVConnectionExtension.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(u)),this.presetMedia(g,u)}}r?(await Oo(this.peerConnection,this.remoteSDP,this.extension),k.debug("[NVConnectionExtension] updateRemoteConnect by exchanging SDP.")):k.debug("[NVConnectionExtension] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(r){throw new _e(Y.EXCHANGE_SDP_FAILED,"NVConnectionExtension.updateRemoteConnect failed; ".concat(r.toString()))}}send(t,r,o){var c=this;return oo(function*(){let u=yield Ft(c.mutex.lock("From NVConnectionExtension.send"));try{if(!c.remoteSDP)throw new Error("Cannot call NVConnectionExtension.send before remote SDP created");let h=[],m=HT();t.forEach(j=>{let K=c.peerConnection.addTransceiver(j._mediaStreamTrack,Zl({direction:"sendonly"},j.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push(K),j._updateRtpTransceiver(K)}),Qn()&&z("SIMULCAST")===!0&&(yield Ft(c.applySimulcastForFirefox(h,t)));let g=yield Ft(c.peerConnection.createOffer()),y=c.remoteSDP.predictReceivingMids(t.length),v=c.mungSendOfferSDP(g.sdp,t,y),R=Hs(v),b=y.map(j=>{let K=R.mediaDescriptions.find(q=>q.attributes.mid===j);if(!K)throw new Error("Cannot extract ssrc from mediaDescription.");return vD(K,z("USE_PUB_RTX"))}),A;try{A=yield b}catch(j){A=[],c.remoteSDP.receive(t,r,o,A);let K=c.remoteSDP.toString();throw yield Ft(c.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield Ft(c.peerConnection.setRemoteDescription({type:"answer",sdp:K})),yield Ft(c.stopSending(y,!0)),j}c.remoteSDP.receive(t,r,o,A);let F=c.remoteSDP.toString(),M=c.logSDPExchange(v,"offer","local","send");return yield Ft(c.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield Ft(c.applySimulcastEncodings(h,t)),yield Ft(c.applySendEncodings(h,t)),M?.(F),yield Ft(c.peerConnection.setRemoteDescription({type:"answer",sdp:F})),h.map((j,K)=>{let q=y[K];return{localSSRC:b[K],id:q,transceiver:j}})}catch(h){throw h instanceof _e?h:new _e(Y.EXCHANGE_SDP_FAILED,"NVConnectionExtension.send failed; ".concat(h.toString()))}finally{u()}})()}async createDataChannels(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(t);if(o&&o.readyState==="open")k.debug("[NVConnectionExtension] Channels are already available and can be reused directly.");else{let u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:z("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,o)}r.forEach(u=>{u._updateOriginDataChannel(o)});let{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){let u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});let h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),k.debug("[NVConnectionExtension] createDataChannels by exchanging SDP.")}else k.debug("[NVConnectionExtension] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof _e?o:new _e(Y.EXCHANGE_SDP_FAILED,"NVConnectionExtension.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(t){try{let r=this.dataStreamChannelMap.get(t);return r&&(r.id&&this.recoveredDataChannelIds.push(r.id),r.close()),void this.dataStreamChannelMap.delete(t)}catch(r){throw r instanceof _e?r:new _e(Y.DATACHANNEL_FAILED,"NVConnectionExtension.stopDataChannels failed; ".concat(r.toString()))}}async stopSending(t,r){let o=r?void 0:await this.mutex.lock("From NVConnectionExtension.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopSending before remote SDP created");let c=this.peerConnection.getTransceivers().filter(g=>t.indexOf(g.mid)!==-1);if(c.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVConnectionExtension.stopSending.");c.map(g=>{var y;ty(this.id+g.mid,this),g.direction="inactive",(y=g.stop)===null||y===void 0||y.call(g)});let u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(t);let m=this.remoteSDP.toString();h?.(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new _e(Y.EXCHANGE_SDP_FAILED,"NVConnectionExtension.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(t,r,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.receive ".concat(t," before remoteSDP created."));let{mid:u,needExchangeSDP:h}=this.remoteSDP.send(t,r,o,c);h&&(await Oo(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] receive ").concat(t," by exchanging SDP.")));let m=this.peerConnection.getTransceivers().find(g=>g.mid===u);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:u,transceiver:m}}catch(u){throw new _e(Y.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(u.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.batchReceive before remoteSDP created.");let{mids:r,needExchangeSDP:o}=this.remoteSDP.batchSend(t);return o&&(await Oo(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [NVConnectionExtension] batchReceive by exchanging SDP."))),r.map(c=>{let u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(r){throw new _e(Y.EXCHANGE_SDP_FAILED,"NVConnectionExtension.receive failed; ".concat(r.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.stopReceiving before remote SDP created.");t.forEach(u=>{Array.from(this.preMediaMap.entries()).some(h=>{let[m,{mid:g,player:y}]=h;if(g===u)return this.preMediaMap.delete(m),y&&y.destroy(),!0})}),this.remoteSDP.stopSending(t);let r=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let c=await this.peerConnection.createAnswer();o?.(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new _e(Y.EXCHANGE_SDP_FAILED,"NVConnectionExtension stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);let r=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let c=await this.peerConnection.createAnswer();o?.(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new _e(Y.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteRemote failed; ".concat(r.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);let r=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let c=await this.peerConnection.createAnswer();o?.(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new _e(Y.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteRemote failed; ".concat(r.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.muteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(h=>{h.direction="inactive"});let o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(t);let u=this.remoteSDP.toString();c?.(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(r){throw new _e(Y.EXCHANGE_SDP_FAILED,"NVConnectionExtension.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.unmuteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(h=>h.mid&&t.indexOf(h.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(async(h,m)=>{h.direction="sendonly"});let o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);let u=this.remoteSDP.toString();c?.(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(r){throw new _e(Y.EXCHANGE_SDP_FAILED,"NVConnectionExtension.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return oo(function*(){let o=yield Ft(r.mutex.lock("From NVConnectionExtension.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");let c=Qt().supportPCSetConfiguration,u=z("FORCE_TURN_TCP")||r.forceTurn;if(t===Di.RELAY&&!c)return;if(c&&!u){let R=t===Di.RELAY?"relay":"all",b=r.peerConnection.getConfiguration();b.iceTransportPolicy!==R&&(k.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(b.iceTransportPolicy,"] to [").concat(R,"]")),b.iceTransportPolicy=R,r.peerConnection.setConfiguration(b))}r.remoteSDP.updateCandidates(t);let h=yield Ft(r.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let m=td(h.sdp),{remoteIceParameters:g}=yield m.iceParameters;r.remoteSDP.restartICE(g);let y=r.remoteSDP.toString(),v=r.logSDPExchange(h.sdp||"","offer","local","restartICE");r.store.descriptionStart(),yield Ft(r.peerConnection.setLocalDescription(h)),v?.(y),yield Ft(r.peerConnection.setRemoteDescription({type:"answer",sdp:y}))}catch(c){k.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;let t=await this.mutex.lock("From NVConnectionExtension.extendCandidate");try{this.remoteSDP.updateCandidates(Di.TCP_RELAY),await Oo(this.peerConnection,this.remoteSDP,this.extension)}catch(r){k.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),r)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(r=>{ty(this.id+r.mid,this)}),this.preMediaMap.forEach(r=>{let{player:o}=r;o&&o.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Zl(Zl({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call NVConnectionExtension.updateEncoderConfig before remote SDP created.");let o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);let u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h?.(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new _e(Y.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(t,r){let o=this.peerConnection.getTransceivers().filter(c=>c.mid===t);o.length===1&&(this.isVP8Simulcast(r)?Qn()||await this.applySimulcastEncodings(o,[r]):await this.applySendEncodings(o,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){let o=this.peerConnection.getTransceivers().find(c=>c.mid===r);o&&await o.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let r=t[0].transport.iceTransport,{local:o,remote:c}=r.getSelectedCandidatePair();return{local:Zl(Zl({},Hc),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:Zl(Zl({},Hc),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var r;let o="code: ".concat(t.errorCode,", message: ").concat(t.errorText),c=t.port?"local: ".concat(t.port):"",u=ed(t.url||"");k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: NVConnectionExtension.onICECandidateError(").concat(o,"), url: ").concat(u||"",", host_candidate:").concat(c)),(r=this.onICECandidateError)===null||r===void 0||r.call(this,o)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},z("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let r={iceServers:[]},o=t.cloudProxyServer||"disabled";return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&(km(t.turnServer.servers)?r.iceServers=t.turnServer.servers:z("NEW_TURN_MODE")&&r.iceServers&&o==="disabled"?(z("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&r.iceServers.push(...Ry.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):r.iceServers.push(...Ry.newTurnServerConfigToIceServers(t.turnServer.servers)),z("NEW_FORCE_TURN")&&(r.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(r.iceServers&&r.iceServers.push(...Ry.turnServerConfigToIceServers(t.turnServer.servers)),z("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...Ry.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),z("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(r.iceTransportPolicy="relay")}))),z("ENABLE_ENCODED_TRANSFORM")&&Qt().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(t){let r=[];return t.forEach(o=>{o.security?o.tcpport&&r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Xc(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!z("FORCE_TURN_TCP")&&r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),r}static newTurnServerConfigToIceServers(t){let r=[];return t.forEach(o=>{let c=z("NEW_TURN_MODE");c===1?r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}):c===2?r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}):c===3?r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Xc(o.turnServerURL),":443?transport=tcp")}):c===4&&(r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}),r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}),r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Xc(o.turnServerURL),":443?transport=tcp")}))}),r}tryBindTransportEvents(t){let r=t.transport;if(r){this.transportEventReceiver=t,r.onstatechange=()=>{var c;r!=null&&r.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,r.state))},r.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};let o=r.iceTransport;o&&(o.onstatechange=()=>{let c=r?.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){let{local:c,remote:u}=o.getSelectedCandidatePair()||{};if(c&&u){let h=c.address+":"+c.port,m=u.address+":"+u.port;k.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(ed(h)),", remote ").concat(JSON.stringify(ed(m))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var o,c;if(r||(r=this.peerConnection.getSenders().find(M=>M.track===t._mediaStreamTrack)),!r)return k.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return k.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Qt().supportSetRtpSenderParameters)return k.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let u={},h={};switch(t._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}let m=pG(this.peerConnection,t._mediaStreamTrack),g=n6(t);if(e8(t)&&m&&r&&g&&this.getLocalVideoStats&&ke(o=["vp8","vp9"]).call(o,this.store.codec)){var y;let M=u.degradationPreference||(ke(y=t._hints).call(y,bn.CUSTOM_TRACK)?z("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");t8(this.id+m.mid,g,this,M,j=>{r&&this.updateAdaptation(r,j)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var v;let{bitrateMax:M,frameRate:j,scaleResolutionDownBy:K}=t._encoderConfig;M&&(h.maxBitrate=1e3*M),(ke(v=t._hints).call(v,bn.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(j&&(h.maxFramerate=ho(j)),K&&K>=1&&(h.scaleResolutionDownBy=K))}let{maxFramerate:R}=z("ENCODER_CONFIG_LIMIT");if(R&&typeof R=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,R):R),z("DSCP_TYPE")&&Xu()){var b;let M=z("DSCP_TYPE");ke(b=["very-low","low","medium","high"]).call(b,M)&&(h.networkPriority=M)}let A=r.getParameters(),F=(c=A.encodings)===null||c===void 0?void 0:c[0];Qn()&&!F&&(u.encodings=[h]),F&&Object.assign(F,h),Object.assign(A,u),k.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(A.encodings))),await r.setParameters(A),await bG(this.store.codec,r,z("SVC_MODE"))}async updateAdaptation(t,r){var o,c;if(!t)return k.debug("[updateAdaptation] no rtpSender found");if(!Qt().supportSetRtpSenderParameters)return k.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let u={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:g}=r;h&&(u.maxBitrate=1e3*h),m&&(u.maxFramerate=ho(m)),g&&g>=1&&ke(o=["vp8","vp9"]).call(o,this.store.codec)&&(u.scaleResolutionDownBy=g);let y=t.getParameters(),v=(c=y.encodings)===null||c===void 0?void 0:c[0];v&&Object.assign(v,u),Object.assign(y,{});try{await t.setParameters(y),k.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(y.encodings)))}catch(R){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?k.debug("[updateAdaptation] peerConnection not connected}"):k.debug("[updateAdaptation] updateRtpSenderEncodings failed",R):k.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,r){try{if(!Qt().supportSetRtpSenderParameters||t.length!==r.length)return;for(let o=0;o<t.length;o++){let c=t[o],u=r[o];u instanceof jn&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{k.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,o){let c=Hs(t);return r.forEach((u,h)=>{let m=o[h],g=c.mediaDescriptions.find(y=>y.attributes.mid===m);g&&(Jm(g,u),wD(g,u,this.store.codec))}),th(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,r,o)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let g=0;g<t.length;g++){var o,c,u,h,m;let y=t[g],v=r[g];if(v instanceof jn&&!ke(o=v._hints).call(o,bn.LOW_STREAM)&&(c=v._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=v._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=v._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=v._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){let R={},b={high:1e3*(v._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:b.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:b.high}];let A=y.sender.getParameters();await y.sender.setParameters(Object.assign(A,R))}}}async applySimulcastEncodings(t,r){if(!Qn()&&t.length===r.length)for(let o=0;o<t.length;o++){let c=r[o];if(c instanceof jn&&this.isVP8Simulcast(c)){let u=t[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];let g=u.sender.getParameters();await u.sender.setParameters(Object.assign(g,h))}}}isVP8Simulcast(t){var r,o,c,u,h;return!!(t instanceof jn&&z("SIMULCAST")&&this.store.codec==="vp8"&&!ke(r=t._hints).call(r,bn.LOW_STREAM)&&(o=t._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=t._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=t._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=t._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(t,r,o,c){if(z("SDP_LOGGING"))return k.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(r," SDP during NVConnectionExtension.").concat(c,`
`),t),r==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;let r=this.remoteSDP.getSSRC(t);return r&&r.length!==0?r[0].ssrcId:void 0}setConfiguration(t){if(Qt().supportPCSetConfiguration){let r=Ry.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}t.isPreallocation&&(this.isPreallocation=!0)}},Ye(ln.prototype,"updateRemoteRTPCapabilities",[mo],Object.getOwnPropertyDescriptor(ln.prototype,"updateRemoteRTPCapabilities"),ln.prototype),Ye(ln.prototype,"connect",[mo],Object.getOwnPropertyDescriptor(ln.prototype,"connect"),ln.prototype),Ye(ln.prototype,"updateRemoteConnect",[mo],Object.getOwnPropertyDescriptor(ln.prototype,"updateRemoteConnect"),ln.prototype),Ye(ln.prototype,"createDataChannels",[mo],Object.getOwnPropertyDescriptor(ln.prototype,"createDataChannels"),ln.prototype),Ye(ln.prototype,"receive",[mo],Object.getOwnPropertyDescriptor(ln.prototype,"receive"),ln.prototype),Ye(ln.prototype,"batchReceive",[mo],Object.getOwnPropertyDescriptor(ln.prototype,"batchReceive"),ln.prototype),Ye(ln.prototype,"stopReceiving",[mo],Object.getOwnPropertyDescriptor(ln.prototype,"stopReceiving"),ln.prototype),Ye(ln.prototype,"muteRemote",[mo],Object.getOwnPropertyDescriptor(ln.prototype,"muteRemote"),ln.prototype),Ye(ln.prototype,"unmuteRemote",[mo],Object.getOwnPropertyDescriptor(ln.prototype,"unmuteRemote"),ln.prototype),Ye(ln.prototype,"muteLocal",[mo],Object.getOwnPropertyDescriptor(ln.prototype,"muteLocal"),ln.prototype),Ye(ln.prototype,"unmuteLocal",[mo],Object.getOwnPropertyDescriptor(ln.prototype,"unmuteLocal"),ln.prototype),Ye(ln.prototype,"close",[mo],Object.getOwnPropertyDescriptor(ln.prototype,"close"),ln.prototype),Ye(ln.prototype,"updateEncoderConfig",[mo],Object.getOwnPropertyDescriptor(ln.prototype,"updateEncoderConfig"),ln.prototype),Ye(ln.prototype,"updateSendParameters",[mo],Object.getOwnPropertyDescriptor(ln.prototype,"updateSendParameters"),ln.prototype),Ye(ln.prototype,"replaceTrack",[mo],Object.getOwnPropertyDescriptor(ln.prototype,"replaceTrack"),ln.prototype),Ye(ln.prototype,"updateAdaptation",[mo],Object.getOwnPropertyDescriptor(ln.prototype,"updateAdaptation"),ln.prototype),Ye(ln.prototype,"getRemoteSSRC",[mo],Object.getOwnPropertyDescriptor(ln.prototype,"getRemoteSSRC"),ln.prototype),ln);function mo(e,t,r){let o=e[t];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let c=this.mutex,u=await c.lock("From NVConnectionExtension.".concat(t));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await o.apply(this,m)}finally{u()}},r}var kn;function Jz(e){var t,r,o,c=2;for(typeof Symbol<"u"&&(r=mb,o=Symbol.iterator);c--;){if(r&&(t=e[r])!=null)return t.call(e);if(o&&(t=e[o])!=null)return new qI(t.call(e));r="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function qI(e){function t(r){if(Object(r)!==r)return ze.reject(new TypeError(r+" is not an object."));var o=r.done;return ze.resolve(r.value).then(function(c){return{value:c,done:o}})}return qI=function(r){this.s=r,this.n=r.next},qI.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var o=this.s.return;return o===void 0?ze.resolve({value:r,done:!0}):t(o.apply(this.s,arguments))},throw:function(r){var o=this.s.return;return o===void 0?ze.reject(r):t(o.apply(this.s,arguments))}},new qI(e)}let Ime=(kn=class VA extends iI{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(t,r){super(t,r),V(this,"name","DataChannelConnection"),V(this,"store",void 0),V(this,"peerConnection",void 0),V(this,"cname",void 0),V(this,"mutex",new ki("DataChannelConnection-mutex")),V(this,"dataChannel",void 0),V(this,"_p2pConnection",void 0),V(this,"establishPromise",void 0),V(this,"_nvMedia",void 0),this.store=r,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(VA.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new bme(t,r,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}getPreMedia(t){var r;return(r=this._p2pConnection)===null||r===void 0?void 0:r.getPreMedia(t)}isPreSub(){var t,r;return(t=(r=this._p2pConnection)===null||r===void 0?void 0:r.isPreSub())!==null&&t!==void 0&&t}async establish(){return await this._p2pConnection.establish()}getP2PConnectionParams(){return this._p2pConnection.establishPromise}updateRtpSenderEncodings(t){return this._p2pConnection.updateRtpSenderEncodings(t)}async connect(t){return this.cname=t.cname,await this._p2pConnection.connect(t),await new ze((r,o)=>{let c=setTimeout(()=>{this.closeSignal(),o(new he(Y.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(t.candidates))))},z("DC_CONNECTION_TIMEOUT"));this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(c),void r()},this.dataChannel.onerror=u=>{this.closeSignal(),o(u)},this.dataChannel.addEventListener("close",()=>{o(new he(Y.DATACHANNEL_CONNECTION_TIMEOUT))})}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(t,r){return this._p2pConnection.updateRemoteRTPCapabilities(t,r)}send(t,r,o){var c=this;return oo(function*(){let u=yield Ft(c.mutex.lock("From DataChannelConnection.send"));try{return yield*bE(Jz(c._p2pConnection.send(t,r,o)))}finally{u()}})()}async stopSending(t,r){return this._p2pConnection.stopSending(t,r)}async createDataChannels(t,r){return this._p2pConnection.createDataChannels(t,r)}async stopDataChannels(t){return this._p2pConnection.stopDataChannels(t)}async receive(t,r,o,c){return this._nvMedia?(k.debug("[DataChannelConnection] receive ".concat(t," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(t,r,this.cname)):(k.debug("[DataChannelConnection] receive ".concat(t," by WebRTC.")),await this._p2pConnection.receive(t,r,o,c))}async batchReceive(t){return[...await this._p2pConnection.batchReceive(t)]}async stopReceiving(t){return await this._p2pConnection.stopReceiving(t)}async muteRemote(t){return await this._p2pConnection.muteRemote(t)}async unmuteRemote(t){return await this._p2pConnection.unmuteRemote(t)}async muteLocal(t){return await this._p2pConnection.muteLocal(t)}async unmuteLocal(t){return await this._p2pConnection.unmuteLocal(t)}restartICE(t){var r=this;return oo(function*(){return yield*bE(Jz(r._p2pConnection.restartICE(t)))})()}close(){var t;(t=this._nvMedia)===null||t===void 0||t.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(t){return this._p2pConnection.getRemoteVideoIsReady(t)}updateRemoteConnect(t){var r;return(r=this._nvMedia)===null||r===void 0||r.setRemoteRtpCapabilities(t),this._p2pConnection.updateRemoteConnect(t)}async updateEncoderConfig(t,r){return await this._p2pConnection.updateEncoderConfig(t,r)}async updateSendParameters(t,r){return await this._p2pConnection.updateSendParameters(t,r)}setStatsRemoteVideoIsReady(t,r){this._p2pConnection.setStatsRemoteVideoIsReady(t,r)}async replaceTrack(t,r){return await this._p2pConnection.replaceTrack(t,r)}async getRemoteSSRC(t){return this._p2pConnection.getRemoteSSRC(t)}logSDPExchange(t,r,o,c){if(z("SDP_LOGGING"))return k.upload("exchanging ".concat(o," ").concat(r," SDP during DataChannelConnection.").concat(c,`
`),t),r==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}static resolvePCConfiguration(t){let r={iceServers:[]};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(km(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...VA.turnServerConfigToIceServers(t.turnServer.servers)),z("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...VA.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),z("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(r.iceTransportPolicy="relay")}))),z("ENABLE_ENCODED_TRANSFORM")&&Qt().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(t){let r=[];return t.forEach(o=>{o.security?o.tcpport&&r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Xc(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!z("FORCE_TURN_TCP")&&r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),r}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=t=>{var r;return(r=this.onICEConnectionStateChange)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onConnectionStateChange=t=>{var r;return(r=this.onConnectionStateChange)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onDTLSTransportStateChange=t=>{var r;return(r=this.onDTLSTransportStateChange)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onDTLSTransportError=t=>{var r;return(r=this.onDTLSTransportError)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onICETransportStateChange=t=>{var r;return(r=this.onICETransportStateChange)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onFirstAudioReceived=t=>{var r;return(r=this.onFirstAudioReceived)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onFirstVideoReceived=t=>{var r;return(r=this.onFirstVideoReceived)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onFirstAudioDecoded=t=>{var r;return(r=this.onFirstAudioDecoded)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onFirstVideoRender=t=>{var r;return(r=this.onFirstVideoRender)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onFirstVideoBufferReady=t=>{var r;return(r=this.onFirstVideoBufferReady)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onFirstVideoDecoded=(t,r,o)=>{var c;return(c=this.onFirstVideoDecoded)===null||c===void 0?void 0:c.call(this,t,r,o)},this._p2pConnection.onFirstVideoDecodedTimeout=t=>{var r;return(r=this.onFirstVideoDecodedTimeout)===null||r===void 0?void 0:r.call(this,t)},this._p2pConnection.onSelectedLocalCandidateChanged=(t,r)=>{var o;return(o=this.onSelectedLocalCandidateChanged)===null||o===void 0?void 0:o.call(this,t,r)},this._p2pConnection.onSelectedRemoteCandidateChanged=(t,r)=>{var o;return(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0?void 0:o.call(this,t,r)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}setConfiguration(t){this._p2pConnection.setConfiguration(t)}},Ye(kn.prototype,"connect",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"connect"),kn.prototype),Ye(kn.prototype,"updateRemoteRTPCapabilities",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"updateRemoteRTPCapabilities"),kn.prototype),Ye(kn.prototype,"createDataChannels",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"createDataChannels"),kn.prototype),Ye(kn.prototype,"receive",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"receive"),kn.prototype),Ye(kn.prototype,"stopReceiving",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"stopReceiving"),kn.prototype),Ye(kn.prototype,"muteRemote",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"muteRemote"),kn.prototype),Ye(kn.prototype,"unmuteRemote",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"unmuteRemote"),kn.prototype),Ye(kn.prototype,"muteLocal",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"muteLocal"),kn.prototype),Ye(kn.prototype,"unmuteLocal",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"unmuteLocal"),kn.prototype),Ye(kn.prototype,"close",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"close"),kn.prototype),Ye(kn.prototype,"updateEncoderConfig",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"updateEncoderConfig"),kn.prototype),Ye(kn.prototype,"updateSendParameters",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"updateSendParameters"),kn.prototype),Ye(kn.prototype,"replaceTrack",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"replaceTrack"),kn.prototype),Ye(kn.prototype,"getRemoteSSRC",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"getRemoteSSRC"),kn.prototype),kn);function Ca(e,t,r){let o=e[t];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let c=this.mutex,u=await c.lock("From DataChannelConnection.".concat(t));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await o.apply(this,m)}finally{u()}},r}function $z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,o)}return r}class Ame extends dr{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var r;ke(r=["tryNext","recover"]).call(r,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(li.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(li.CONNECTED):this._state==="closed"?this.emit(li.CLOSED):this._state==="failed"&&this.emit(li.FAILED))}constructor(t,r,o,c){super(),V(this,"connectionID",0),V(this,"currentURLIndex",0),V(this,"reconnectReason",void 0),V(this,"_reconnectMode","tryNext"),V(this,"_initMutex",void 0),V(this,"_name",void 0),V(this,"_state","closed"),V(this,"_reconnectInterrupter",void 0),V(this,"_url",void 0),V(this,"_retryConfig",void 0),V(this,"_reconnectCount",0),V(this,"_forceCloseTimeout",5e3),V(this,"_onlineReconnectListener",void 0),V(this,"_closeEstablishingTransmitter",()=>{}),V(this,"_store",void 0),V(this,"_joinChannelServiceRecordIndex",void 0),V(this,"_transmitter",void 0),V(this,"_useCompress",void 0),V(this,"_inflateLength",0),V(this,"_deflateLength",0),this._store=c,this._name=t,this._retryConfig=(function(u){for(var h=1;h<arguments.length;h++){var m=arguments[h]!=null?arguments[h]:{};h%2?$z(Object(m),!0).forEach(function(g){V(u,g,m[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(m)):$z(Object(m)).forEach(function(g){Object.defineProperty(u,g,Object.getOwnPropertyDescriptor(m,g))})}return u})({},r),this._useCompress=o}resetReconnectCount(t){k.debug("".concat(this._name," reset reconnect count, reason: ").concat(t)),this._reconnectCount=0}close(t,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;let o=this._transmitter;r?setTimeout(()=>o.close(),500):o.close(),this._transmitter=void 0}this.state=t?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(t,r){if(!this._transmitter)return void k.warning("[".concat(this._name,"] can not reconnect, no websocket"));var o;t!==void 0&&(this.reconnectMode=t),k.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((o=this._store)===null||o===void 0||o.recordJoinChannelService({status:"error",errors:[new Error(r)]},this._joinChannelServiceRecordIndex));let c=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),c&&c.bind(this._transmitter)({code:9999,reason:r})}getInflateData(){let t=this._inflateLength,r=this._deflateLength;return this.clearInflateData(),{inflateLength:t,deflateLength:r}}setInflateData(t){this._deflateLength=this._deflateLength+t.originLength,this._inflateLength=this._inflateLength+t.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}let eu=(function(e){return e[e.Default=0]="Default",e[e.Ack=1]="Ack",e})({});class Ome{constructor(t,r,o){V(this,"version",1),V(this,"initialRTO",void 0),V(this,"maxBatchAckCount",void 0),V(this,"maxRTO",void 0),V(this,"initialRTT",void 0),V(this,"ID",void 0),V(this,"rtt",void 0),V(this,"packetNumber",1),V(this,"rtoRatioMap",new Map),V(this,"timeoutMap",new Map),V(this,"unorderedPacketQueue",[]),V(this,"batchAckPacketQueue",[]),V(this,"lastOrderedPacketNumber",0),V(this,"batchAckTimer",void 0),V(this,"sendImpl",void 0),V(this,"receiveImpl",void 0),this.sendImpl=t,this.receiveImpl=r,this.ID=In(7,"transmitter-"),this.initialRTO=o?.initialRTO!==void 0?o.initialRTO:z("TRANSMITTER_INITIAL_RTO"),this.initialRTT=o?.initialRTT!==void 0?o.initialRTT:z("TRANSMITTER_INITIAL_RTT"),this.rtt=o?.initialRTT!==void 0?o.initialRTT:z("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=o?.maxBatchAckCount!==void 0?o.maxBatchAckCount:z("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=o?.maxRTO!==void 0?o.maxRTO:z("TRANSMITTER_MAX_RTO")}packetize(t,r){return{type:eu.Default,version:this.version,packetNumber:r,payload:t}}serialize(t){switch(t.type){case eu.Default:{let r;typeof t.payload=="string"?r=new TextEncoder().encode(t.payload):r=t.payload;let o=new ArrayBuffer(r.length+15),c=new DataView(o);return c.setUint16(0,t.version),c.setUint8(2,t.type),c.setUint32(3,t.packetNumber),$4(c,7,BigInt(t.sendTs)),new Uint8Array(c.buffer).set(r,15),o}case eu.Ack:{let r=new ArrayBuffer(16),o=new DataView(r);return o.setUint16(0,t.version),o.setUint8(2,t.type),o.setUint32(3,t.maxAckPacketNumber),o.setUint8(7,t.shift),$4(o,8,BigInt(t.ackSendTs)),r}}}deserialize(t){let r=new DataView(t),o=r.getUint16(0),c=r.getUint8(2);switch(c){case eu.Default:{let u=r.getUint32(3),h=J4(r,7),m=t.slice(15),g=new Uint8Array(m);return{version:o,type:c,packetNumber:u,sendTs:Number(h),payload:g}}case eu.Ack:{let u=r.getUint32(3),h=r.getUint8(7),m=J4(r,8);return{version:o,type:c,maxAckPacketNumber:u,shift:h,ackSendTs:Number(m)}}default:throw k.error("[".concat(this.ID,"] Unrecognized packet type ").concat(c)),new Error("Unrecognized packet type ".concat(c))}}sendMessage(t){z("DC_DEBUG_LOG")&&typeof t=="string"&&k.debug("[".concat(this.ID,"] sending message packet"),JSON.parse(t));let r=this.packetize(t,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;let o=this.calculateRTO(r),c=window.setTimeout(()=>{this.resendMessage(r)},o);this.timeoutMap.set(r.packetNumber,c),this.sendPacket(r)}onData(t){let r=this.deserialize(t);r.type===eu.Default?this.ack(r):r.type===eu.Ack&&(this.updateRTT(r,Math.round(performance.now())),this.clearRTO(r))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(t=>{let[r,o]=t;window.clearTimeout(o)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(t){let r=this.calculateRTO(t),o=window.setTimeout(()=>{z("DC_DEBUG_LOG")&&typeof t.payload=="string"&&k.debug("[".concat(this.ID,"] resending message packet"),JSON.parse(t.payload),"timeout: ".concat(r)),this.resendMessage(t)},r);this.timeoutMap.set(t.packetNumber,o),this.sendPacket(t)}calculateRTO(t){let r=this.rtoRatioMap.get(t.packetNumber);if(r===void 0)return this.rtoRatioMap.set(t.packetNumber,1),this.initialRTO;{let o=9*this.rtt/8*r;return this.rtoRatioMap.set(t.packetNumber,r+1),o>this.maxRTO?this.maxRTO:o}}updateRTT(t,r){let o=t.ackSendTs;this.rtt=this.rtt*(7/8)+(r-o-this.rtt)/8}ack(t){if(t.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(t):(this.batchAckPacketQueue.push(t),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(t.payload);;){let r=this.unorderedPacketQueue[0];if(!r){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(r.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(t.packetNumber<=this.lastOrderedPacketNumber){let r={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:eu.Ack,version:this.version};z("DC_DEBUG_LOG")&&k.debug("[".concat(this.ID,"] sending ack packet"),r,"packetNumber: ".concat(t.packetNumber)),this.sendPacket(r)}else if(t.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[t.packetNumber-this.lastOrderedPacketNumber-2]=t;let r={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:eu.Ack,version:this.version};z("DC_DEBUG_LOG")&&k.debug("[".concat(this.ID,"] sending ack packet"),r,"packetNumber: ".concat(t.packetNumber)),this.sendPacket(r)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;let t={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:eu.Ack,version:this.version};z("DC_DEBUG_LOG")&&k.debug("[".concat(this.ID,"] sending batch ack packet"),t,"shift: ".concat(this.batchAckPacketQueue.length-1)),this.sendPacket(t),this.batchAckPacketQueue=[]}sendPacket(t){t.type===eu.Default&&(t.sendTs=Math.round(performance.now()));let r=this.serialize(t);this.sendImpl(r)}clearRTO(t){for(let r=t.maxAckPacketNumber-t.shift;r<=t.maxAckPacketNumber;r++){let o=this.timeoutMap.get(r);o!==void 0&&window.clearTimeout(o),this.timeoutMap.delete(r),this.rtoRatioMap.delete(r)}}}class Qz extends Ame{constructor(t,r){super(t,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),V(this,"_initMutex",void 0),V(this,"_reconnectInterrupter",void 0),V(this,"_url",void 0),V(this,"_transmitter",void 0),V(this,"_addresses",void 0),V(this,"_reliableTransmission",void 0),V(this,"_textEncoder",void 0),V(this,"_textDecoder",void 0),this._textEncoder=new TextEncoder,this._textDecoder=new TextDecoder,this._initMutex=new ki("datachannel");let{timeout:o,timeoutFactor:c}=r,u=Math.max(300,Math.floor(3*o/5)),h=Math.max(1.2,Math.floor(8*c)/10);Gs.ONLINE&&(this._retryConfig.timeout=u,this._retryConfig.timeoutFactor=h),Cr.on(Dm.NETWORK_STATE_CHANGE,(m,g)=>{m!==g&&(this.resetReconnectCount("network state change: ".concat(g," -> ").concat(m)),m===Gs.ONLINE?(this._retryConfig.timeout=u,this._retryConfig.timeoutFactor=h):(this._retryConfig.timeout=o,this._retryConfig.timeoutFactor=c))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=r;let o=(c,u)=>{this._addresses=t,this.currentURLIndex=this._addresses.findIndex(m=>m.fingerprint||z("FINGERPRINT"));let h=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(h).then(c).catch(u),this.once(li.CLOSED,()=>u(new he(Y.WS_DISCONNECT))),this.once(li.CONNECTED,()=>c())};return this._initMutex.lock().then(c=>new ze((u,h)=>{o(u,h)}).then(()=>{c()}).catch(()=>{c()}))}async sendMessage(t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new he(Y.WS_ABORT,"datachannel is not ready");try{r||(t=JSON.stringify(t));let o=this._textEncoder.encode(t),c=Bfe(o,{raw:!0});this._reliableTransmission.sendMessage(c)}catch(o){throw new he(Y.WS_ERR,"send datachannel signal message error"+o.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(t){let r=JSON.stringify(t);return{compressed:r,compressedLength:r.length,origin:t}}sendMessageWithUint8Array(t){return{compressed:t,compressedLength:t.byteLength,origin:t}}createTransmitterConnection(t){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(t.ip,":").concat(t.port),new ze((r,o)=>{var c;let u=()=>{k.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="recover",this.state="connected",this.resetReconnectCount("opened"),r()},h=async v=>{var R;if((R=this._closeEstablishingTransmitter)===null||R===void 0||R.call(this),k.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(v.code,", reason: ").concat(v.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=v.reason,this.state="reconnecting");let b=Jo(this,li.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,A=await this.reconnectWithAction(b);if(this.state==="closed")return void k.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!A)return o(new he(Y.WS_DISCONNECT,"datachannel reconnect failed: ".concat(v.code))),void this.close(!0);r()}else o(new he(Y.WS_DISCONNECT,"datachannel close: ".concat(v.code))),this.close()},m=async v=>{try{var R;(R=this._reliableTransmission)===null||R===void 0||R.onData(v.data)}catch(b){console.log(b)}};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),k.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(t)));let g=(c=this._store)===null||c===void 0?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),y=Date.now();ei(this,li.TO_CONNECT_DATACHANNEL).then(v=>{var R,b;if(!v)throw new Error("transmissonInfo not exist yet");let{transmitter:A,close:F}=v;this._transmitter=A,(R=this._store)===null||R===void 0||R.signalChannelOpen();let M=Date.now()-y;k.debug("[choose dc] dc open cost ".concat(M,"ms")),this._reliableTransmission=new Ome(j=>{var K;this._transmitter&&this._transmitter.readyState==="open"&&((K=this._transmitter)===null||K===void 0||K.send(j))},j=>{if(typeof j=="string")this.emit(li.ON_MESSAGE,j);else{let K=Gfe(j,{raw:!0}).buffer,q=this._textDecoder.decode(K);this.emit(li.ON_MESSAGE,q)}}),this._closeEstablishingTransmitter=()=>{var j;(j=this._reliableTransmission)===null||j===void 0||j.close(),this._reliableTransmission=void 0,F()},u&&u(),A.onclose=h,A.onmessage=m,(b=this._store)===null||b===void 0||b.recordJoinChannelService({endTs:Date.now(),status:"success"},g),this._joinChannelServiceRecordIndex=g}).catch(v=>{var R;if((R=this._store)===null||R===void 0||R.recordJoinChannelService({endTs:Date.now(),status:v instanceof he&&v.code===Y.WS_ABORT?"aborted":"error",errors:[v]},g),this.state!=="closed"){if(v instanceof he&&v.code===Y.WS_ERR){let b=new he(Y.WS_ERR,"init datachannel failed! Error: ".concat(v.toString()));return k.error("[".concat(this._name,"]").concat(b)),void o(b)}h&&h(v)}else o(new he(Y.WS_DISCONNECT,"datachannel is closed: ".concat(v.toString())))})})}async reconnectWithAction(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||Cr.networkState!==Gs.OFFLINE||(this._onlineReconnectListener=Cr.onlineWaiter&&Cr.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let o=!0;if(this._reconnectInterrupter=()=>{o=!1},r){let m=Ab(this._reconnectCount,this._retryConfig);k.debug("[".concat(this._name,"] wait ").concat(m,"ms to reconnect datachannel, mode: ").concat(t)),await ze.race([Ci(m),this._onlineReconnectListener||new ze(()=>{})])}if(this.state==="closed"||!o)return!1;this._reconnectCount+=1;let c=async(m,g)=>{this.emit(li.RECONNECT_CREATE_CONNECTION,g),await this.createTransmitterConnection(m)};try{if(t==="retry"){let m=this._addresses[this.currentURLIndex];await c(m,t)}else if(t==="tryNext"){this.currentURLIndex+=1;for(let g=this.currentURLIndex;g<this._addresses.length;g++){if(this._addresses[g].fingerprint||z("FINGERPRINT")){this.currentURLIndex=g;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return k.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);k.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));let m=this._addresses[this.currentURLIndex];await c(m,t)}else t==="recover"&&(k.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(li.FAILBACK));return!0}catch(m){var u,h;return k.error("[".concat(this._name,"] reconnect failed"),m.toString()),m!=null&&(u=m.data)!==null&&u!==void 0&&u.desc&&Array.isArray(m.data.desc)&&m.data.desc.length&&ke(h=m.data.desc).call(h,"dynamic key expired")?(this.emit(li.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,r)}}}class Nme extends dr{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===nn.CONNECTED?this.emit(rt.WS_CONNECTED):t===nn.RECONNECTING?this.emit(rt.WS_RECONNECTING,this._websocketReconnectReason):t===nn.CLOSED&&this.emit(rt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}processPendingNotifications(){this.pendingNotifications.length!==0&&(k.debug("[".concat(this.clientId,"] processing ").concat(this.pendingNotifications.length," pending notifications")),this.pendingNotifications.forEach(t=>{let{type:r,message:o}=t;this.emit(r,o),r===wt.ON_NOTIFICATION&&this.handleNotification(o),r===wt.ON_USER_BANNED&&this.handleUserBanned(o)}),this.pendingNotifications=[])}handleUserBanned(t){switch(t.error_code){case 14:this.close(tn.UID_BANNED);break;case 15:this.close(tn.IP_BANNED);break;case 16:this.close(tn.CHANNEL_BANNED)}}constructor(t,r){super(),V(this,"__name__","DataChannelSignal"),V(this,"_disconnectedReason",void 0),V(this,"_websocketReconnectReason",void 0),V(this,"_connectionState",nn.CLOSED),V(this,"reconnectToken",void 0),V(this,"websocket",void 0),V(this,"openConnectionTime",void 0),V(this,"clientId",void 0),V(this,"lastMsgTime",Date.now()),V(this,"uploadCache",[]),V(this,"uploadCacheInterval",void 0),V(this,"rttRolling",new Tk(5)),V(this,"pingpongTimer",void 0),V(this,"inflateDataTimer",void 0),V(this,"pingpongTimeoutCount",0),V(this,"ortc",void 0),V(this,"joinResponse",void 0),V(this,"multiIpOption",void 0),V(this,"initError",void 0),V(this,"spec",void 0),V(this,"store",void 0),V(this,"isJoining",!1),V(this,"pendingNotifications",[]),V(this,"onWebsocketMessage",o=>{if(o instanceof ArrayBuffer)return void this.emit(rt.ON_BINARY_DATA,o);let c=JSON.parse(o);if(z("DC_DEBUG_LOG")&&k.debug("[datachannel-signal] received packet",c),this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){let u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else Object.prototype.hasOwnProperty.call(c,"_type")&&(this.isJoining?c._type===wt.ON_NOTIFICATION||c._type===wt.ON_USER_BANNED?(this.emit(c._type,c._message),c._type===wt.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===wt.ON_USER_BANNED&&this.handleUserBanned(c._message)):(this.pendingNotifications.push({type:c._type,message:c._message}),k.debug("[".concat(this.clientId,"] cached notification during join: ").concat(c._type))):(this.emit(c._type,c._message),c._type===wt.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===wt.ON_USER_BANNED&&this.handleUserBanned(c._message)))}),this.clientId=t.clientId,this.spec=t,this.store=r,this.websocket=new Qz("gateway-".concat(this.clientId),this.spec.retryConfig,!0,r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===nn.CONNECTED&&this.reconnect("retry",Tp.OFFLINE)})}async request(t,r,o,c){let u=In(6,""),h={_id:u,_type:t,_message:r},m=this.websocket.connectionID,g=()=>new ze((F,M)=>{if(this.connectionState===nn.CONNECTED)return F();let j=()=>{this.off(rt.WS_CLOSED,K),F()},K=()=>{this.off(rt.WS_CONNECTED,j),M(new he(Y.WS_ABORT))};this.once(rt.WS_CONNECTED,j),this.once(rt.WS_CLOSED,K),t!==ct.PUBLISH&&t!==ct.SUBSCRIBE&&t!==ct.UNSUBSCRIBE&&t!==ct.UNPUBLISH&&t!==ct.CONTROL&&t!==ct.RESTART_ICE||this.once(rt.DISCONNECT_P2P,()=>{M(new he(Y.DISCONNECT_P2P))}),t!==ct.PUBLISH&&t!==ct.RESTART_ICE||this.once(rt.ABORT_P2P_EXECUTION,()=>{M(new he(Y.DISCONNECT_P2P))})});if(this.connectionState!==nn.CONNECTING&&this.connectionState!==nn.RECONNECTING||t===ct.JOIN||t===ct.REJOIN||await g(),t===ct.LEAVE&&(this.websocket.unbindDcCloseEventListener(),c=!0),z("DC_DEBUG_LOG")&&k.debug("[datachannel-signal] sendMessage",h),await this.websocket.sendMessage(h,!0,!1),c)return;let y=new ze((F,M)=>{let j=!1,K=(Q,se)=>{j=!0,F({isSuccess:Q==="success",message:se||{}}),this.off(rt.WS_CLOSED,q),this.off(rt.WS_RECONNECTING,q),this.emit(rt.REQUEST_SUCCESS,t,r)};this.once("res-@".concat(u),K);let q=()=>{M(new he(Y.WS_ABORT,"type: ".concat(t))),this.off(rt.WS_CLOSED,q),this.off(rt.WS_RECONNECTING,q),this.off("res-@".concat(u),K)};this.once(rt.WS_CLOSED,q),this.once(rt.WS_RECONNECTING,q),Ci(z("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||j||(k.warning("dc request timeout, type: ".concat(t)),this.emit(rt.REQUEST_TIMEOUT,t,r))})}),v=null;try{v=await y}catch(F){if(this.connectionState===nn.CLOSED||t===ct.LEAVE)throw new he(Y.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?F.throw():t===ct.JOIN||t===ct.REJOIN?null:(await g(),await this.request(t,r))}if(v.isSuccess)return v.message;let R=Number(v.message.error_code||v.message.code),b=Xm(R),A=new he(Y.UNEXPECTED_RESPONSE,"".concat(b.desc,": ").concat(v.message.error_str),{code:R,data:v.message});return b.action==="success"?v.message:(k.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(R,", message: ").concat(b.desc,", action: ").concat(b.action)),R===pt.ERR_TOO_MANY_BROADCASTERS?((t===ct.JOIN||t===ct.REJOIN)&&(this.initError=A,this.close()),A.throw()):b.action==="failed"?A.throw():b.action==="quit"?(this.initError=A,this.close(),A.throw()):(R===pt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=v.message.option,k.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Tp.MULTI_IP)):this.reconnect(b.action,Tp.SERVER_ERROR),t===ct.JOIN||t===ct.REJOIN?null:await this.request(t,r)))}waitMessage(t,r){return new ze(o=>{let c=u=>{(!r||r(u))&&(this.off(t,c),o(u))};this.on(t,c)})}uploadWRTCStats(t){if(!this.store.sessionId)return void k.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(qm.WRTC_STATS,r)}upload(t,r){let o={_type:t,_message:r};try{this.websocket.sendMessage(o)}catch{let c=z("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>c&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==nn.CONNECTED)return;let u=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(u._type,u._message)},z("UPLOAD_CACHE_INTERVAL")||2e3))}}async send(t,r){let o={_type:t,_message:r};await this.websocket.sendMessage(o)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ze((r,o)=>{this.once(rt.WS_CONNECTED,()=>r(this.joinResponse)),this.once(rt.WS_CLOSED,()=>o(this.initError||new he(Y.WS_ABORT))),this.connectionState=nn.CONNECTING,this.websocket.init(t).catch(o),this.websocket.once(li.FAILBACK,()=>{o(new he(Y.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{this.openConnectionTime===void 0&&(k.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),o(new he(Y.INIT_DATACHANNEL_TIMEOUT)))},z("DC_JOIN_WITH_FAILBACK"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this.isJoining=!1,this.pendingNotifications=[],this._disconnectedReason=t||tn.LEAVE,this.connectionState=nn.CLOSED,k.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),t===tn.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new Qz("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),z("DC_PINGPONG_INTERVAL")),!this.joinResponse){this.emit(rt.ABORT_P2P_EXECUTION),this.store.signalConnected();let t=await ei(this,rt.REQUEST_JOIN_INFO);this.store.joinReq(),this.isJoining=!0,this.pendingNotifications=[];let r=await this.request(ct.JOIN,t);if(this.store.joinRep(),this.ortc=t?.ortc,!r)return this.emit(rt.REPORT_JOIN_GATEWAY,Y.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(rt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=nn.CONNECTED,this.isJoining=!1,this.processPendingNotifications(),!0}async rejoin(){if(!this.reconnectToken)throw new he(Y.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let t=xm(this,rt.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;let r=await this.request(ct.REJOIN,t);return!!r&&(this.connectionState=nn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),z("DC_PINGPONG_INTERVAL")),r.peers&&r.peers.forEach(o=>{this.emit(wt.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(wt.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(wt.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(wt.MUTE_AUDIO,{uid:o.uid}):this.emit(wt.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(wt.MUTE_VIDEO,{uid:o.uid}):this.emit(wt.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(wt.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(wt.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(wt.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(wt.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(wt.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(t,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,r)}async downgradeCodec(t){if(!this.ortc)return!1;let r={downgrade_codec:t,ortc:this.ortc};return!!await this.request(ct.DOWNGRADE_CODEC,r)}handleNotification(t){k.debug("[".concat(this.clientId,"] receive notification: "),t);let r=Xm(t.code);if(r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(tn.UID_BANNED),void this.close()):void this.reconnect(r.action,Tp.SERVER_ERROR);k.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1,z("DC_DEBUG_LOG")&&console.debug("[datachannel-signal] pingpongTimeoutCount: ".concat(this.pingpongTimeoutCount));let t=z("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=t&&(k.warning("[datachannel-signal] PINGPONG Timeout. Last Socket Message: ".concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>z("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("recover",Tp.FALLBACK):this.request(ct.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let o=Date.now()-r;this.rttRolling.add(o),z("REPORT_STATS")&&this.send(ct.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleInflateData(){let{inflateLength:t,deflateLength:r}=this.websocket.getInflateData();t!==0&&r!==0&&this.upload(qm.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(li.RECONNECT_CREATE_CONNECTION,t=>{this.emit(rt.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(li.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(li.CLOSED,()=>{this.connectionState=nn.CLOSED}),this.websocket.on(li.FAILED,()=>{this._disconnectedReason=tn.NETWORK_ERROR,this.connectionState=nn.CLOSED}),this.websocket.on(li.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===nn.CONNECTED?this.connectionState=nn.RECONNECTING:this.connectionState=nn.CONNECTING}),this.websocket.on(li.WILL_RECONNECT,(t,r)=>{if(xm(this,rt.IS_P2P_DISCONNECTED)&&t==="retry")return k.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(rt.NEED_RENEW_SESSION),this.emit(rt.DISCONNECT_P2P),r("tryNext");t!=="retry"&&(k.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(rt.NEED_RENEW_SESSION),this.emit(rt.DISCONNECT_P2P)),r(t)}),this.websocket.on(li.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{k.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Tp.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(rt.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof he&&t.code===Y.UNEXPECTED_RESPONSE&&t.data.code===pt.ERR_NO_AUTHORIZED)return k.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Tp.SERVER_ERROR);k.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Tp.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(li.REQUEST_NEW_URLS,(t,r)=>{ei(this,rt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(r)}),this.websocket.on(li.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(wt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(li.TO_CONNECT_DATACHANNEL,(t,r)=>{ei(this,rt.PRE_CONNECT_PC).then(t).catch(r)}),this.websocket.on(li.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(rt.DATACHANNEL_FAILBACK)})}}let Pme={name:"DataChannelConnection",create:function(e){let{store:t,spec:r}=e;return new Ime(r,t)}},kme={name:"DataChannelSignal",create:function(e){let{store:t,spec:r}=e;return new Nme(r,t)}};Ak(),Ln("PROCESS_ID","process-".concat(In(8,""),"-").concat(In(4,""),"-").concat(In(4,""),"-").concat(In(4,""),"-").concat(In(12,""))),(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void k.error("Error loading sdk config",t.message)}if(e)try{let t=JSON.parse(window.atob(e)),r=Date.now();k.debug("Loading global parameters from cache",t),Object.keys(t).forEach(o=>{if(Object.prototype.hasOwnProperty.call(An,o)){let{value:c,expires:u}=t[o];if(u&&u<=r)return;ma[o]=c,An[o]=c}})}catch(t){k.error("Error loading mutableParamsCache: ".concat(e),t.message)}})(),Array.isArray(ma.AREAS)&&ma.AREAS.length>0&&OD(ma.AREAS,!0);let Zz=(e,t,r)=>{k.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),Ln(e,t,r)};nd(qfe,!1),nd($fe,!1),nd(Ipe,!1),nd(cme,!1),nd(zfe,!1),nd(vme,!1),nd(wme,!1),nd(Rme,!1),nd(Pme,!1),nd(kme,!1);let ti=(function(e){let t=new dr,r=e,o={getListeners:t.getListeners.bind(t),on:(c,u)=>((function(h,m){h===Zu.SECURITY_POLICY_VIOLATION&&IH(m,!0)})(c,u),t.on.bind(t)(c,u)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return bH(bH({},r),o)})({__TRACK_LIST__:jm,VERSION:Ja,BUILD:Pk,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:Zz,getParameter:z,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection,r=await(async function(o){let c;return Qt().supportUnifiedPlan?(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}),c=(await o.createOffer()).sdp):c=(await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c})(t);if(!r)return e;t.close(),t=null,e=(function(o){let c={video:[],audio:[]};return o.match(/ VP8/i)&&c.video.push("VP8"),o.match(/ VP9/i)&&c.video.push("VP9"),o.match(/ AV1/i)&&c.video.push("AV1"),o.match(/ H264/i)&&c.video.push("H264"),o.match(/ H265/i)&&c.video.push("H265"),o.match(/ opus/i)&&c.audio.push("OPUS"),o.match(/ PCMU/i)&&c.audio.push("PCMU"),o.match(/ PCMA/i)&&c.audio.push("PCMA"),o.match(/ G722/i)&&c.audio.push("G722"),c})(r)}catch(t){throw new he(Y.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],t=tt.reportApiInvoke(null,{name:ar.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Fn.TRACER}),r=(function(){let u=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0],h=!1;try{let m=window.RTCPeerConnection,g=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,y=window.WebSocket;h=!(!m||!y),u&&!g&&(h=!1),h&&NT()&&F4(75)&&new m().close()}catch(m){k.error("check system requirement failed: ",m),h=!1}return h})(e),o=Ope();k.debug("checkSystemRequirements, api:",r,"browser",o);let c=r&&o;return t.onSuccess(c),z("IGNORE_RTC_DEVICE_CHECK")?r:c},getDevices:function(e){return va.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return va.getRecordingDevices(e)},getCameras:function(e){return va.getCamerasDevices(e)},getElectronScreenSources:H5,getPlaybackDevices:function(e){return va.getSpeakers(e)},createClient:wH,createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=z("CAMERA_CAPTURE_CONFIG"),r=In(8,"track-cam-"),o=tt.reportApiInvoke(null,{id:r,tag:Fn.TRACER,name:ar.CREATE_CAM_VIDEO_TRACK,options:[Xn({},e),t]});t&&(e.encoderConfig=t);let c=Bb(e),u=null;k.info("start create camera video track with config",JSON.stringify(e),"trackId",r);try{u=(await ya({video:c},r)).getVideoTracks()[0]||null}catch(m){throw o.onError(m),m}if(!u){let m=new _e(Y.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(m),m.throw(k)}if(e.optimizationMode&&Jk(r,u,e,Kc(e.encoderConfig)),z("USE_STANDARD_BITRATE_DEFAULT")){let m=Kc(e.encoderConfig);e.encoderConfig=m,delete m.bitrateMax,delete m.bitrateMin}let h=new Gb(u,e,c,e.scalabiltyMode?Ub(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r);return o.onSuccess(h.getTrackId()),k.info("create camera video success, trackId:",r),h},createCustomVideoTrack:function(e){let t=In(8,"track-cus-"),r=tt.reportApiInvoke(null,{id:t,tag:Fn.TRACER,name:ar.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});z("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);let o=new jn(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?Ub(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[bn.CUSTOM_TRACK]);return r.onSuccess(o.getTrackId()),k.info("create custom video track success with config",e,"trackId",o.getTrackId()),o},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable",r=typeof t=="object"?(function(b){let A=e6(b);return D5()&&b.suppressLocalAudioPlayback&&(A.suppressLocalAudioPlayback=b.suppressLocalAudioPlayback),x5()&&b.restrictOwnAudio&&(A.restrictOwnAudio=!0),A})(t):void 0;r&&(t="auto");let o=In(8,"track-scr-v-"),c=tt.reportApiInvoke(null,{id:o,tag:Fn.TRACER,name:ar.CREATE_SCREEN_VIDEO_TRACK,options:[Xn({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";let u=(function(b){let A={};b.screenSourceType&&(A.mediaSource=b.screenSourceType),b.extensionId&&Zd()&&(A.extensionId=b.extensionId);let{displaySurface:F,selfBrowserSurface:M,surfaceSwitching:j,systemAudio:K,preferCurrentTab:q,windowAudio:Q,monitorTypeSurfaces:se}=b;(Bl(107)||_p(107)||Pm(93))&&(F&&(zr(F,"displaySurface",["browser","window","monitor"]),A.displaySurface=F),M?(zr(M,"selfBrowserSurface",["exclude","include"]),A.selfBrowserSurface=M):A.selfBrowserSurface="include",j&&(zr(j,"surfaceSwitching",["exclude","include"]),A.surfaceSwitching=j)),(Bl(105)||_p(105)||Pm(91))&&K&&(zr(K,"systemAudio",["exclude","include"]),A.systemAudio=K),(Bl(94)||_p(94)||Pm(80))&&q&&(A.preferCurrentTab=!0),(Bl(141)||_p(141)||Pm(125))&&Q&&(zr(Q,"windowAudio",["exclude","system"]),A.windowAudio=Q),(Bl(119)||_p(119)||Pm(105))&&se&&(zr(se,"monitorTypeSurfaces",["exclude","include"]),A.monitorTypeSurfaces=se),b.electronScreenSourceId&&(A.sourceId=b.electronScreenSourceId);let oe=b.encoderConfig?Uk(b.encoderConfig):null;return A.mandatory={chromeMediaSource:"desktop",maxWidth:oe?oe.width:void 0,maxHeight:oe?oe.height:void 0},oe&&(oe.frameRate&&(typeof oe.frameRate=="number"?(A.mandatory.maxFrameRate=oe.frameRate,A.mandatory.minFrameRate=oe.frameRate):(A.mandatory.maxFrameRate=oe.frameRate.max||oe.frameRate.ideal||oe.frameRate.exact||void 0,A.mandatory.minFrameRate=oe.frameRate.min||oe.frameRate.ideal||oe.frameRate.exact||void 0),A.frameRate=oe.frameRate),oe.width&&(A.width=oe.width),oe.height&&(A.height=oe.height)),A})(e),h=null,m=null,g=Qt();if(!g.supportShareAudio&&t==="enable"){let b=new _e(Y.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(b),b.throw(k)}k.info("start create screen video track with config",e,"withAudio",t,"trackId",o);let y=g.supportShareAudio&&t!=="disable";try{let b=await ya({screen:u,screenAudio:y?r||!0:void 0},o);h=b.getVideoTracks()[0]||null,m=b.getAudioTracks()[0]||null}catch(b){throw c.onError(b),b}if(!h){let b=new _e(Y.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(b),b.throw(k)}if(!m&&t==="enable"){h&&h.stop();let b=new _e(Y.SHARE_AUDIO_NOT_ALLOWED);return c.onError(b),b.throw(k)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(Jk(o,h,e,e.encoderConfig&&Uk(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));let v=new jn(h,e.encoderConfig?Uk(e.encoderConfig):{},e.scalabiltyMode?Ub(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,o,[bn.SCREEN_TRACK]);if(!m)return c.onSuccess(v.getTrackId()),k.info("create screen video track success","video:",v.getTrackId()),v;let R=new Nr(m,void 0,In(8,"track-scr-a-"),!1);return c.onSuccess([v.getTrackId(),R.getTrackId()]),k.info("create screen video track success","video:",v.getTrackId(),"audio:",R.getTrackId()),[v,R]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=z("CAMERA_CAPTURE_CONFIG"),o=In(8,"track-mic-"),c=In(8,"track-cam-"),u=tt.reportApiInvoke(null,{id:"".concat(o,"-").concat(c),tag:Fn.TRACER,name:ar.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,r]});r&&(t.encoderConfig=r);let h=Bb(t),m=t6(e),g=null,y=null;k.info("start create camera video track(".concat(c,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{let b=await ya({audio:m,video:h},"".concat(o,"-").concat(c));g=b.getAudioTracks()[0],y=b.getVideoTracks()[0]}catch(b){throw u.onError(b),b}if(!g||!y){let b=new _e(Y.UNEXPECTED_ERROR,"can not find tracks in media stream");return u.onError(b),b.throw(k)}if(t.optimizationMode&&Jk(c,y,t,Kc(t.encoderConfig)),z("USE_STANDARD_BITRATE_DEFAULT")){let b=Kc(t.encoderConfig);t.encoderConfig=b,delete b.bitrateMax,delete b.bitrateMin}let v=new jT(g,e,m,o),R=new Gb(y,t,h,t.scalabiltyMode?Ub(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,c);return u.onSuccess([v.getTrackId(),R.getTrackId()]),k.info("create camera video track(".concat(c,") and microphone audio track(").concat(o,") success")),[v,R]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=In(8,"track-mic-"),r=tt.reportApiInvoke(null,{id:t,tag:Fn.TRACER,name:ar.CREATE_MIC_AUDIO_TRACK,options:[e]}),o=t6(e),c=null;k.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{c=(await ya({audio:o},t)).getAudioTracks()[0]||null}catch(h){throw r.onError(h),h}if(!c){let h=new _e(Y.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(h),h.throw(k)}let u=new jT(c,e,o,t);return r.onSuccess(u.getTrackId()),k.info("create microphone audio track success, trackId:",t),u},createCustomAudioTrack:IW,createBufferSourceAudioTrack:async function(e){var t;let{cacheOnlineFile:r,encoderConfig:o}=e,{source:c}=e,u={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":c,cacheOnlineFile:r,encoderConfig:o},h=In(8,"track-buf-"),m=tt.reportApiInvoke(null,{id:h,tag:Fn.TRACER,name:ar.CREATE_BUFFER_AUDIO_TRACK,options:[u]});if(z("DISABLE_WEBAUDIO"))throw new _e(Y.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");k.info("start create buffer source audio track with config",JSON.stringify(u),"trackId",h);let g=c;if(!(c instanceof AudioBuffer))try{c=await(async function(R,b){let A=null;if(typeof R=="string"){let M=W6.get(R);if(M)return k.debug("use cached audio resource: ",R),M;try{A=(await Wl(()=>ao.get(R,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(j){throw new _e(Y.FETCH_AUDIO_FILE_FAILED,j.toString())}}else A=await new ze((M,j)=>{let K=new FileReader;K.onload=q=>{q.target?M(q.target.result):j(new _e(Y.READ_LOCAL_AUDIO_FILE_ERROR))},K.onerror=()=>{j(new _e(Y.READ_LOCAL_AUDIO_FILE_ERROR))},K.readAsArrayBuffer(R)});let F=await(function(M){let j=jE();return new ze((K,q)=>{j.decodeAudioData(M,Q=>{K(Q)},Q=>{q(new _e(Y.DECODE_AUDIO_FILE_FAILED,Q.toString()))})})})(A);return typeof R=="string"&&b&&W6.set(R,F),F})(c,r)}catch(R){return m.onError(R),R.throw(k)}let y=new Yde(c),v=new Kde(g,y,o?Vb(o):{},h);return k.info("create buffer source audio track success, trackId:",h),m.onSuccess(v.getTrackId()),v},setAppType:function(e){if(k.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw k.debug("Invalid appType"),new he(Y.INVALID_PARAMS,"invalid app type",e);Ln("APP_TYPE",Math.floor(e))},setLogLevel:function(e){k.setLogLevel(e)},enableLogUpload:function(){z("USE_NEW_LOG")?Ln("UPLOAD_LOG",!0):k.enableLogUpload()},disableLogUpload:function(){z("USE_NEW_LOG")?Ln("UPLOAD_LOG",!1):k.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new zG},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,r=tt.reportApiInvoke(null,{tag:Fn.TRACER,name:ar.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Nr||e instanceof GE)){let g=new he(Y.INVALID_TRACK,"the parameter is not a audio track");return r.onError(g),g.throw()}t&&t<1e3&&(t=1e3);let o=e instanceof Nr?e.getTrackLabel():"remote_track",c=e.getVolumeLevel(),u=c,h=c,m=Date.now();return new ze(g=>{let y=setInterval(()=>{let v=e.getVolumeLevel();u=v>u?v:u,h=v<h?v:h;let R=u-h>1e-4,b=Date.now()-m;if(R||b>t){clearInterval(y);let A=R,F={duration:b,deviceLabel:o,maxVolumeLevel:u,result:A};k.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(F))),r.onSuccess(F),g(A)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,r=tt.reportApiInvoke(null,{tag:Fn.TRACER,name:ar.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof jn||e instanceof WE)){let R=new he(Y.INVALID_TRACK,"the parameter is not a video track");return r.onError(R),R.throw()}t&&t<1e3&&(t=1e3);let o=e instanceof jn?e.getTrackLabel():"remote_track",c=e.getMediaStreamTrack(!0),u=document.createElement("video");u.style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(Pi()||Rb())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([c]),u.play();let h=document.createElement("canvas");h.width=160,h.height=120;let m=0,g=0;try{let R=Date.now();m=await(function(b,A,F,M){let j,K=0,q=null;return new ze((Q,se)=>{function oe(){K>M&&j&&(j(),Q(K));let te=F.getContext("2d");if(!te){let Pe=new he(Y.UNEXPECTED_ERROR,"can not get canvas 2d context.");return k.error(Pe.toString()),void se(Pe)}te.drawImage(b,0,0,160,120);let de=te.getImageData(0,0,F.width,F.height),Ce=Math.floor(de.data.length/3);if(q){for(let Pe=0;Pe<Ce;Pe+=3)if(de.data[Pe]!==q[Pe])return K+=1,void(q=de.data);q=de.data}else q=de.data}setTimeout(()=>{j&&(j(),Q(K))},A),j=Gk(()=>{oe()},30)})})(u,t,h,4),g=Date.now()-R}catch(R){throw r.onError(R),R}hpe===_n.SAFARI&&(u.pause(),u.remove()),u.srcObject=null;let y=m>4,v={duration:g,changedPicNum:m,deviceLabel:o,result:y};return k.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(v))),r.onSuccess(v),y},setArea:OD,audioElementPlayCenter:Ps,resumeAudioContext:function(){return Ps.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){Ppe.processExternalMediaAEC(e)},registerExtensions:function(e){let t=z("PLUGIN_INFO")||[];e.forEach(r=>{"name"in r&&!ke(t).call(t,r.name)&&t.push(r.name);let o=r;o.__registered__=!0,o.logger.hookLog=k.extLog,o.reporter.hookApiInvoke=tt.extApiInvoke,o.parameters&&Object.keys(o.parameters).forEach(c=>{o.parameters[c]=z(c)})}),Zz("PLUGIN_INFO",t)},ChannelMediaRelayError:KE,ChannelMediaRelayEvent:rh,ChannelMediaRelayState:Ao,RemoteStreamFallbackType:jde,RemoteStreamType:Fde,ConnectionDisconnectedReason:tn,AudienceLatencyLevelType:fde,AREAS:yn,preload:async function(e,t,r,o){return $D(e,t,r,o)},startLastmileProbeTest:async function(e,t,r,o){let c={state:"unavailable"};await $D(e,t,r,o);let u=await QD({appId:e,cname:t,token:r||e,uid:o,cloudProxyServer:"disabled"});if(!u)return c;await ZD(u);let h,m=wH({mode:"rtc",codec:"vp8"});try{h=await m.join(e,t,r,o,{networkQualityProbe:!0})}catch{return c}let g=new gpe,y=g.createMuteAudioTrack(),v=await IW({mediaStreamTrack:y});await m.publish([v]);let[R,b,A]=await new ze((Q,se)=>{let oe=setTimeout(()=>{clearTimeout(oe),Q([!0,null,"audio"])},5e3);m.on("user-published",async(te,de)=>{te.uid===h&&(clearTimeout(oe),Q([!1,te,de]))})});if(R||!b)return await m.unpublish([v]),await m.leave(),v.close(),g.close(),c;await m.subscribe(b,A),await new ze((Q,se)=>{let oe=setTimeout(()=>{clearTimeout(oe),Q(null)},5e3)});let F=m.getRTCStats(),M=m.getLocalAudioStats(),j=F.RTT,K=M.sendJitterMs,q=M.currentPacketLossRate;return c={state:"complete",rtt:j,packetLossRate:q,jitter:K,networkQuality:((Q,se,oe)=>{let te=1;if(oe>0){let ot=Math.log(100*oe)/Math.log(2)+1;ot=Math.min(5,Math.max(0,ot)),te=1-ot/5}let de=1;if(Q>0){let ot=Math.log(Q/40)/Math.log(2)+1;ot=Math.min(5,Math.max(0,ot)),de=1-ot/5}let Ce=1;if(se>0){let ot=Math.log(se/10)/Math.log(2.5)+1;ot=Math.min(5,Math.max(0,ot)),Ce=1-ot/5}let Pe=.5*te+.3*de+.2*Ce,Qe=0;return Qe=Pe>=.8?1:Pe>=.6?2:Pe>=.4?3:Pe>=.2?4:5,Qe})(j,K,q)},await m.unsubscribe(b),await m.unpublish([v]),await m.leave(),v.close(),g.close(),await ZD(u),c}});return Object.defineProperties(ti,{onAudioAutoplayFailed:{get:()=>lo.onAudioAutoplayFailed,set:e=>{lo.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>lo.onAutoplayFailed,set:e=>{lo.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>ti._onSecurityPolicyViolation,set(e){ti._onSecurityPolicyViolation=e,IH(e)}},__CLIENT_LIST__:{get:()=>z("SHOW_GLOBAL_CLIENT_LIST")?Km:[]}}),va.on(Wm.CAMERA_DEVICE_CHANGED,e=>{k.info("camera device changed",JSON.stringify(e)),ti.onCameraChanged&&ti.onCameraChanged(e),ti.safeEmit(Zu.CAMERA_CHANGED,e)}),va.on(Wm.RECORDING_DEVICE_CHANGED,e=>{k.info("microphone device changed",JSON.stringify(e)),ti.onMicrophoneChanged&&ti.onMicrophoneChanged(e),ti.safeEmit(Zu.MICROPHONE_CHANGED,e)}),va.on(Wm.PLAYOUT_DEVICE_CHANGED,e=>{k.debug("playout device changed",JSON.stringify(e)),ti.onPlaybackDeviceChanged&&ti.onPlaybackDeviceChanged(e),ti.safeEmit(Zu.PLAYBACK_DEVICE_CHANGED,e)}),Ps.onAutoplayFailed=()=>{k.info("detect audio element autoplay failed"),lo.onAudioAutoplayFailed&&lo.onAudioAutoplayFailed()},Mn.on("autoplay-failed",()=>{k.info("detect webaudio autoplay failed"),lo.onAudioAutoplayFailed&&lo.onAudioAutoplayFailed(),ti.safeEmit(Zu.AUTOPLAY_FAILED)}),Mn.on(zi.STATE_CHANGE,(e,t)=>{k.info("audio context state changed: ".concat(t," => ").concat(e)),ti.onAudioContextStateChanged&&ti.onAudioContextStateChanged(e,t),ti.safeEmit(Zu.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),Cr.on(Dm.NETWORK_STATE_CHANGE,(e,t)=>{k.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=ti),ti})}),Hne={};JUe(Hne,{AgoraRTCProvider:()=>Yne,AgoraRTCReactError:()=>na,AgoraRTCScreenShareProvider:()=>aVe,LocalAudioTrack:()=>Zne,LocalUser:()=>bO,LocalVideoTrack:()=>nre,RemoteAudioTrack:()=>ire,RemoteUser:()=>ore,RemoteVideoTrack:()=>sre,TrackBoundary:()=>vVe,VERSION:()=>RVe,default:()=>are,useAutoPlayAudioTrack:()=>MV,useAutoPlayVideoTrack:()=>LV,useClientEvent:()=>iVe,useConnectionState:()=>lVe,useCurrentUID:()=>uVe,useIsConnected:()=>Tv,useJoin:()=>Xne,useLocalCameraTrack:()=>DV,useLocalMicrophoneTrack:()=>kV,useLocalScreenTrack:()=>Qne,useNetworkQuality:()=>dVe,usePublish:()=>Jne,useRTCClient:()=>pl,useRTCScreenShareClient:()=>cVe,useRemoteAudioTracks:()=>gVe,useRemoteUserTrack:()=>y2,useRemoteUsers:()=>$ne,useRemoteVideoTracks:()=>_Ve,useTrackEvent:()=>sVe,useVolumeLevel:()=>pVe});var QUe=Yg(qg());function Mo(i,n,s){return i.on(n,s),()=>i.off(n,s)}function ZUe(i){try{return i()}catch(n){console.error(n)}}function Xg(i){return()=>i.forEach(ZUe)}function eVe(i,n){let s=setInterval(i,n);return()=>clearInterval(s)}function hN(i,n){let s=setTimeout(i,n);return()=>clearTimeout(s)}function PV(){let i,n,s;function a(){if(n){let T=n;n=void 0,T()}}async function l(){if(s){let T=s;s=void 0;try{await T()}catch(C){console.error(C)}}}async function d(T){i=!0,await l();try{s=await T()}catch(C){console.error(C)}i=!1,a()}async function f(){i=!0,await l(),i=!1,a()}function E(T){i?n=()=>d(T):d(T)}function S(){i?n=f:f()}return{run:E,dispose:S}}var pN=typeof document<"u"?H.useLayoutEffect:H.useEffect;function tVe(i){return i!=null&&typeof i.then=="function"}function bf(){let i=H.useRef(!1);return H.useEffect(()=>(i.current=!1,()=>{i.current=!0}),[]),i}function nVe(){let i=bf();function n(s,a){return new Promise(async(l,d)=>{try{let f=await s;i.current||l(f)}catch(f){i.current?a&&a(f):d(f)}})}return H.useCallback(n,[i])}function zne(i){let n=nVe(),[s,a]=H.useState();return pN(()=>{tVe(i)?n(i).then(a):a(i)},[i,n]),s}function Jg(i,n){let s=H.useRef();H.useEffect(()=>{let{run:a,dispose:l}=s.current||=PV();return a(i),l},n)}function rVe(i,n){let s=i.split("."),a=n.split("."),l=Math.max(s.length,a.length);for(let d=0;d<l;d++){let f=parseInt(s[d]||"0"),E=parseInt(a[d]||"0");if(f>E)return 1;if(f<E)return-1}return 0}function iVe(i,n,s){let a=H.useRef(s);pN(()=>{a.current=s},[s]),H.useEffect(()=>{if(i)return Mo(i,n,(...l)=>{a.current&&a.current(...l)})},[n,i])}function sVe(i,n,s){let a=H.useRef(s);pN(()=>{a.current=s},[s]),H.useEffect(()=>{if(i)return Mo(i,n,(...l)=>{a.current&&a.current(...l)})},[n,i])}var Kne=H.createContext(null);function Yne({client:i,children:n}){return D.jsx(Kne.Provider,{value:i,children:n})}function oVe(i){let n=H.useContext(Kne);return i||n}function pl(i){let n=oVe(i);if(!n)throw new Error("Agora RTC client not found. Should be wrapped in <AgoraRTCProvider value={client} />");return n}var qne=H.createContext(null);function aVe({client:i,children:n}){return D.jsx(qne.Provider,{value:i,children:n})}function cVe(i){let n=H.useContext(qne);return i||n}function lVe(i){let n=pl(i),[s,a]=H.useState(n?n.connectionState:"DISCONNECTED");return H.useEffect(()=>{if(n){a(n.connectionState);let l;return Xg([Mo(n,"connection-state-change",d=>{l?.(),d==="CONNECTED"?l=hN(()=>a(d),0):a(d)}),()=>l?.()])}else a("DISCONNECTED")},[n]),s}function Tv(i){let n=pl(i),[s,a]=H.useState(n?n.connectionState==="CONNECTED":!1);return H.useEffect(()=>{if(n){a(n.connectionState==="CONNECTED");let l;return Xg([Mo(n,"connection-state-change",d=>{l?.(),l=hN(()=>a(d==="CONNECTED"),0)}),()=>l?.()])}else a(!1)},[n]),s}function uVe(i){let n=pl(i),[s,a]=H.useState(n?.uid);return H.useEffect(()=>{if(n)return Mo(n,"connection-state-change",l=>{if(l==="CONNECTED")return hN(()=>a(n.uid),0);l==="DISCONNECTED"&&a(void 0)})},[n]),s}var na=class extends Error{rtcMethod;rtcError;name="AgoraRTCReactException";constructor(i,n){typeof n=="string"?super(n):super(n.message),this.rtcMethod=i,this.rtcError=n}log(i){console[i](this)}};function Xne(i,n=!0,s){let a=pl(s),l=Tv(s),d=H.useRef(),[f,E]=H.useState(!1),[S,T]=H.useState(0),[C,I]=H.useState(null),N=bf();return Jg(async()=>{if(N.current||(I(null),T(0),E(!1)),n&&a){try{N.current||E(!0);let{appid:W,channel:x,token:B,uid:X}=typeof i=="function"?await i():i,Z=await a.join(W,x,B,X);N.current||T(Z)}catch(W){console.error(W),N.current||I(new na("IAgoraRTCClient.join",W))}N.current||E(!1);let P=d.current||=PV();return Xg([()=>{P.dispose()},()=>{P.run(()=>a.unpublish(a.localTracks))},()=>{for(let W of a.localTracks)W.isPlaying&&W.stop(),W.close();P.run(()=>a.leave())}])}},[n,s]),{data:S,isLoading:f,isConnected:l,error:C}}var oX=()=>({uplinkNetworkQuality:0,downlinkNetworkQuality:0,delay:0});function dVe(i){let n=pl(i),[s,a]=H.useState(oX);return H.useEffect(()=>{if(n)return Mo(n,"network-quality",l=>a({uplinkNetworkQuality:l.uplinkNetworkQuality,downlinkNetworkQuality:l.downlinkNetworkQuality,delay:n.getRTCStats().RTT??0}));a(oX())},[n]),s}var hVe=Yg(qg());function Jne(i,n=!0,s){let a=pl(s),l=Tv(s),d=H.useRef([]),[f,E]=H.useState(!1),[S,T]=H.useState(null),C=bf();return Jg(async()=>{if(C.current||(E(!1),T(null)),!a||!l||!n)return;let I=i.filter(Boolean),N=x=>{let B=rVe(hVe.default.VERSION,"4.18.2")>=0;return B||new na("usePublish","please check your agora-rtc-sdk-ng version in package.json, it's recommend upgrade to >= 4.18.2").log("warn"),B?a.mode!=="live"||a.role!=="audience":!0},P=x=>d.current.some(B=>B&&B.getTrackId()===x.getTrackId()),W=x=>N()&&x.enabled&&n&&!P(x);for(let x=0;x<I.length;x++){let B=I[x];if(B&&W(B)){await a.unpublish(d.current.filter(X=>X?.trackMediaType===B.trackMediaType));try{C.current||E(!0),await a.publish(B)}catch(X){console.error(X),C.current||T(new na("IAgoraRTCClient.publish",X))}C.current||E(!1)}}d.current=I},[l,n,a,i]),{isLoading:f,error:S}}function pVe(i){let[n,s]=H.useState(0);return H.useEffect(()=>{if(i)return eVe(()=>{s(i.getVolumeLevel())},1e3)},[i]),n}var fVe=Yg(qg());function kV(i=!0,n={ANS:!0,AEC:!0}){let[s,a]=H.useState(null),[l,d]=H.useState(!1),[f,E]=H.useState(null),S=bf();return Jg(async()=>{if(S.current||(d(!1),E(null)),i&&!s){try{S.current||d(!0);let T=await fVe.default.createMicrophoneAudioTrack(n);S.current||a(T)}catch(T){console.error(T),S.current||E(new na("IAgoraRTC.createMicrophoneAudioTrack",T))}S.current||d(!1)}},[i]),{localMicrophoneTrack:s,isLoading:l,error:f}}var mVe=Yg(qg());function DV(i=!0,n){let[s,a]=H.useState(null),[l,d]=H.useState(!1),[f,E]=H.useState(null),S=bf();return Jg(async()=>{if(S.current||(d(!1),E(null)),i&&!s){try{S.current||d(!0);let T=await mVe.default.createCameraVideoTrack(n);S.current||a(T)}catch(T){console.error(T),S.current||E(new na("IAgoraRTC.createCameraVideoTrack",T))}S.current||d(!1)}},[i]),{localCameraTrack:s,isLoading:l,error:f}}function gVe(i,n){let s=pl(n),[a,l]=H.useState([]),d=Tv(),f=H.useRef([]),[E,S]=H.useState(!1),[T,C]=H.useState(null),I=bf();return Jg(async()=>{if(I.current||C(null),!Array.isArray(i)||!d)return;let N=async x=>{if(!x.audioTrack&&i.some(({uid:B})=>x.uid===B)){try{I.current||S(!0),await s.subscribe(x,"audio")}catch(B){console.error(B),I.current||C(new na("IAgoraRTCClient.subscribe",B))}x.audioTrack&&!f.current.some(B=>B.getUserId()===x.uid)&&f.current.push(x.audioTrack),f.current=f.current.map(B=>x.audioTrack&&B.getUserId()===x.uid&&B.getTrackId()!==x.audioTrack.getTrackId()?x.audioTrack:B),I.current||(l([...f.current]),S(!1))}},P=async x=>{if(i.some(({uid:B})=>x.uid===B)){I.current||(f.current=f.current.filter(B=>B.getUserId()!==x.uid),l([...f.current]));try{I.current||S(!0),await s.unsubscribe(x,"audio")}catch(B){console.error(B),I.current||C(new na("IAgoraRTCClient.unsubscribe",B))}I.current||S(!1)}};i.map(x=>{!x.audioTrack&&x.hasAudio&&N(x)});let W=[];for(let x=0;x<f.current.length;x++){let B=f.current[x];if(!i.some(X=>X.uid===B.getUserId())){let X=s.remoteUsers.find(Z=>Z.uid===B.getUserId());X&&W.push({user:X,mediaType:"audio"}),f.current.splice(x,1),x--}}if(W.length>0){try{I.current||S(!0),await s.massUnsubscribe(W)}catch(x){console.error(x),I.current||C(new na("IAgoraRTCClient.massUnsubscribe",x))}I.current||(l(f.current.slice()),S(!1))}return Xg([Mo(s,"user-published",(x,B)=>{i.find(X=>X.uid===x.uid)&&B==="audio"&&N(x)}),Mo(s,"user-unpublished",(x,B)=>{i.find(X=>X.uid===x.uid)&&B==="audio"&&P(x)})])},[d,s,i]),{audioTracks:a,isLoading:E,error:T}}function _Ve(i,n){let s=pl(n),[a,l]=H.useState([]),d=Tv(),f=H.useRef([]),[E,S]=H.useState(!1),[T,C]=H.useState(null),I=bf();return Jg(async()=>{if(I.current||C(null),!Array.isArray(i)||!d)return;let N=async x=>{if(!x.videoTrack&&i.some(({uid:B})=>x.uid===B)){try{I.current||S(!0),await s.subscribe(x,"video")}catch(B){console.error(B),I.current||C(new na("IAgoraRTCClient.subscribe",B))}x.videoTrack&&!f.current.some(B=>B.getUserId()===x.uid)&&f.current.push(x.videoTrack),f.current=f.current.map(B=>x.videoTrack&&B.getUserId()===x.uid&&B.getTrackId()!==x.videoTrack.getTrackId()?x.videoTrack:B),I.current||(l([...f.current]),S(!1))}},P=async x=>{if(i.some(({uid:B})=>x.uid===B)){I.current||(f.current=f.current.filter(B=>B.getUserId()!==x.uid),l([...f.current]));try{I.current||S(!0),await s.unsubscribe(x,"video")}catch(B){console.error(B),I.current||C(new na("IAgoraRTCClient.unsubscribe",B))}I.current||S(!1)}};i.map(x=>{!x.videoTrack&&x.hasVideo&&N(x)});let W=[];for(let x=0;x<f.current.length;x++){let B=f.current[x];if(!i.some(X=>X.uid===B.getUserId())){let X=s.remoteUsers.find(Z=>Z.uid===B.getUserId());X&&W.push({user:X,mediaType:"video"}),f.current.splice(x,1),x--}}if(W.length>0){try{I.current||S(!0),await s.massUnsubscribe(W)}catch(x){console.error(x),I.current||C(new na("IAgoraRTCClient.massUnsubscribe",x))}I.current||(l(f.current.slice()),S(!1))}return Xg([Mo(s,"user-published",(x,B)=>{i.find(X=>X.uid===x.uid)&&B==="video"&&N(x)}),Mo(s,"user-unpublished",(x,B)=>{i.find(X=>X.uid===x.uid)&&B==="video"&&P(x)})])},[d,s,i]),{videoTracks:a,isLoading:E,error:T}}function y2(i,n,s){let a=pl(s),l=n==="audio"?"audioTrack":"videoTrack",[d,f]=H.useState(i&&i[l]),E=Tv(),S=H.useRef(),[T,C]=H.useState(!1),[I,N]=H.useState(null);return H.useEffect(()=>{if(!i||!E)return;let P=!1;P||N(null);let W=n==="audio"?"hasAudio":"hasVideo",x=i.uid,B=async($,ae)=>{if($[l]&&a.remoteUsers.some(({uid:ce})=>$.uid===ce))try{P||C(!0),await a.unsubscribe($,ae)}catch(ce){P||N(new na("IAgoraRTCClient.unsubscribe",ce)),console.error(ce)}P||(f(void 0),C(!1))},X=async($,ae)=>{try{!$[l]&&a.remoteUsers.some(({uid:ce})=>$.uid===ce)&&(P||C(!0),await a.subscribe($,ae)),P||f($[l])}catch(ce){P||N(new na("IAgoraRTCClient.subscribe",ce)),console.error(ce)}P||C(!1)},Z=S.current||=PV();return!i[l]&&i[W]?Z.run(()=>X(i,n)):f(i[l]),Xg([()=>{P=!0,Z.dispose()},Mo(a,"user-published",($,ae)=>{$.uid===x&&ae===n&&Z.run(()=>X($,n))}),Mo(a,"user-unpublished",($,ae)=>{$.uid===x&&ae===n&&Z.run(()=>B($,n))})])},[E,a,i,n,l]),{track:d,isLoading:T,error:I}}function $ne(i){let n=pl(i),[s,a]=H.useState(n?n.remoteUsers:[]);return H.useEffect(()=>{if(n){let l=()=>a(n.remoteUsers.slice());return Xg([Mo(n,"user-joined",l),Mo(n,"user-left",l),Mo(n,"user-published",l),Mo(n,"user-unpublished",l)])}},[n]),s}var EVe=Yg(qg());function Qne(i=!0,n,s){let[a,l]=H.useState(null),[d,f]=H.useState(!1),[E,S]=H.useState(null),T=bf();return Jg(async()=>{if(T.current||(f(!1),S(null)),i&&!a){try{T.current||f(!0);let C=await EVe.default.createScreenVideoTrack(n,s);T.current||l(C)}catch(C){console.error(C),T.current||S(new na("IAgoraRTC.createScreenVideoTrack",C))}T.current||f(!1)}},[i]),{screenTrack:a,isLoading:d,error:E}}function yVe(){let i=new Map,n=1500;return{onMount:s=>{let a=i.get(s);a&&(a(),i.delete(s))},onUnmount:s=>{let a=i.get(s);a&&a(),i.set(s,hN(()=>{s.isPlaying&&s.stop(),i.delete(s)},n))},dispose:()=>{for(let[s,a]of i)s.isPlaying&&s.stop(),a&&a();i.clear()}}}var xV=H.createContext(void 0);function vVe({children:i}){let[n]=H.useState(yVe);return H.useEffect(()=>n.dispose,[n]),D.jsx(xV.Provider,{value:n,children:i})}function LV(i,n,s,a){let l=H.useContext(xV);H.useEffect(()=>{if(i)return a&&n?i.play(a,s||void 0):i.stop(),l?(l.onMount(i),()=>l.onUnmount(i)):()=>{i.isPlaying&&i.stop()}},[i,a,n,l,s])}function MV(i,n){let s=H.useContext(xV);pN(()=>{if(i)return n?i.play():i.stop(),s?(s.onMount(i),()=>s.onUnmount(i)):()=>{i.isPlaying&&i.stop()}},[i,n,s])}function Zne({track:i,play:n=!1,volume:s,disabled:a,muted:l,children:d}){let f=zne(i);return MV(f,n),H.useEffect(()=>{f&&s!=null&&f.setVolume(s)},[f,s]),H.useEffect(()=>{f&&a!=null&&f.setEnabled(!a).catch(console.warn)},[a,f]),H.useEffect(()=>{f&&l!=null&&f.setMuted(l).catch(console.warn)},[l,f]),d?D.jsx(D.Fragment,{children:d}):null}var ere={position:"relative",width:"100%",height:"100%",overflow:"hidden",background:"#000"},tre={width:"100%",height:"100%"},UV={position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden",zIndex:2},fN=(i,n)=>H.useMemo(()=>({...i,...n}),[i,n]);function nre({track:i,play:n,disabled:s,muted:a,style:l,videoPlayerConfig:d,...f}){let E=fN(tre,l),[S,T]=H.useState(null),C=zne(i);return LV(C,n,d,S),H.useEffect(()=>{C&&s!=null&&C.setEnabled(!s).catch(console.warn)},[s,C]),H.useEffect(()=>{C&&a!=null&&C.setMuted(a).catch(console.warn)},[a,C]),D.jsx("div",{...f,ref:T,style:E})}var SVe={width:"100%",height:"100%",background:"#1a1e21 center/cover no-repeat",filter:"blur(16px) brightness(0.4)"},TVe={position:"absolute",top:"50%",left:"50%",maxWidth:"50%",maxHeight:"50%",aspectRatio:"1",transform:"translate(-50%, -50%)",borderRadius:"50%",overflow:"hidden",objectFit:"cover"};function rre({cover:i}){return D.jsx("div",{style:UV,children:typeof i=="string"?D.jsxs(D.Fragment,{children:[D.jsx("div",{style:{...SVe,backgroundImage:`url(${i})`}}),D.jsx("img",{src:i,style:TVe})]}):i()})}function bO({micOn:i,cameraOn:n,audioTrack:s,videoTrack:a,playAudio:l,playVideo:d,volume:f,cover:E,children:S,style:T,...C}){let I=fN(ere,T);return d=d??!!n,l=l??!!i,D.jsxs("div",{...C,style:I,children:[D.jsx(nre,{disabled:!n,play:d,track:a}),D.jsx(Zne,{disabled:!i,play:l,track:s,volume:f}),E&&!n&&D.jsx(rre,{cover:E}),D.jsx("div",{style:UV,children:S})]})}function ire({track:i,play:n=!1,playbackDeviceId:s,volume:a,children:l}){return MV(i,n),H.useEffect(()=>{i&&s!=null&&i.setPlaybackDevice(s).catch(console.warn)},[i,s]),H.useEffect(()=>{i&&a!=null&&i.setVolume(a)},[i,a]),l?D.jsx(D.Fragment,{children:l}):null}function sre({track:i,play:n,style:s,videoPlayerConfig:a,...l}){let d=fN(tre,s),[f,E]=H.useState(null);return LV(i,n,a,f),D.jsx("div",{...l,ref:E,style:d})}function ore({user:i,playVideo:n,playAudio:s,playbackDeviceId:a,volume:l,cover:d,style:f,children:E,videoPlayerConfig:S,...T}){let C=fN(ere,f),{track:I}=y2(i,"video"),{track:N}=y2(i,"audio");return n=n??i?.hasVideo,s=s??i?.hasAudio,D.jsxs("div",{...T,style:C,children:[D.jsx(sre,{play:n,track:I,videoPlayerConfig:S}),D.jsx(ire,{play:s,playbackDeviceId:a,track:N,volume:l}),d&&!n&&D.jsx(rre,{cover:d}),D.jsx("div",{style:UV,children:E})]})}var wVe=Yg(qg()),CVe=class{appType=1001;constructor(){wVe.default.setAppType(this.appType)}};new CVe;var RVe="2.5.1";$Ue(Hne,Yg(qg()));var are=QUe.default;const bVe="35f1e777bff540a9ad19c9b6fa3c2bc2",IVe=()=>{const[i,n]=H.useState("lobby"),[s,a]=H.useState(""),[l,d]=H.useState(!0),[f,E]=H.useState(!0),S=pl(are.createClient({codec:"vp8",mode:"rtc"})),T=Sf();return H.useEffect(()=>{const I=new URLSearchParams(T.search).get("channel");I&&(a(I),n("prejoin"))},[T]),D.jsxs(Yne,{client:S,children:[i==="lobby"&&D.jsx(AVe,{onJoin:C=>{a(C),n("prejoin")}}),i==="prejoin"&&D.jsx(OVe,{roomCode:s,micOn:l,setMicOn:d,cameraOn:f,setCameraOn:E,onJoinNow:()=>n("meeting"),onBack:()=>n("lobby")}),i==="meeting"&&D.jsx(NVe,{roomCode:s,initialMic:l,initialCam:f,onLeave:()=>{n("lobby"),a("")}})]})},AVe=({onJoin:i})=>{const[n,s]=H.useState(""),[a,l]=H.useState(!1),[d,f]=H.useState(""),[E,S]=H.useState(""),[T,C]=H.useState([]);H.useEffect(()=>{const N=localStorage.getItem("custom-study-rooms");C(N?JSON.parse(N):[])},[]);const I=()=>{if(!d.trim())return;const N={id:crypto.randomUUID(),name:d,topic:E,participants:1},P=[N,...T];C(P),localStorage.setItem("custom-study-rooms",JSON.stringify(P)),l(!1),i(N.name)};return D.jsxs(Tc,{children:[D.jsx(pu,{icon:PO,title:"Study Rooms",subtitle:"Join live study sessions or create your own",gradient:"linear-gradient(135deg, hsl(330 80% 55% / 0.3), hsl(330 80% 55% / 0.1))"}),D.jsxs("div",{className:"max-w-6xl mx-auto mt-8 px-4",children:[D.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end md:items-center gap-4 mb-8",children:[D.jsxs("div",{children:[D.jsx("h2",{className:"text-2xl font-bold font-display",children:"Live Rooms"}),D.jsx("p",{className:"text-muted-foreground",children:"Happening now across campus"})]}),D.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[D.jsx("div",{className:"relative flex-1 md:w-64",children:D.jsx("input",{placeholder:"Enter room code...",className:"w-full h-10 px-3 rounded-lg bg-muted text-sm border border-transparent focus:border-primary outline-none",value:n,onChange:N=>s(N.target.value)})}),D.jsx(Jn,{disabled:!n,onClick:()=>i(n),variant:"secondary",children:"Join"}),D.jsxs(Jn,{onClick:()=>l(!0),className:"gap-2 bg-primary text-white",children:[D.jsx(BA,{className:"w-4 h-4"})," Create Room"]})]})]}),D.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[T.map(N=>D.jsxs("div",{className:"glass p-5 rounded-2xl border border-white/5 hover:border-primary/30 transition-all group relative overflow-hidden",children:[D.jsxs("div",{className:"absolute top-3 right-3 flex items-center gap-1.5 px-2 py-1 rounded-full bg-red-500/10 text-red-400 text-xs font-medium border border-red-500/20",children:[D.jsxs("span",{className:"relative flex h-2 w-2",children:[D.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),D.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-red-500"})]}),D.jsx("span",{children:"LIVE"})]}),D.jsxs("div",{className:"mb-4",children:[D.jsx("span",{className:"text-xs font-semibold tracking-wider text-muted-foreground uppercase",children:N.topic}),D.jsx("h3",{className:"text-xl font-bold mt-1 group-hover:text-primary transition-colors",children:N.name})]}),D.jsxs("div",{className:"flex items-center justify-between mt-6",children:[D.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[D.jsx(jw,{className:"w-4 h-4"}),D.jsxs("span",{children:[N.participants," studying"]})]}),D.jsx(Jn,{size:"sm",onClick:()=>i(N.name),children:"Join Room"})]})]},N.id)),T.length===0&&D.jsxs("div",{className:"col-span-full py-12 text-center border-2 border-dashed border-border rounded-xl",children:[D.jsx("div",{className:"w-16 h-16 bg-muted/50 rounded-full flex items-center justify-center mx-auto mb-4",children:D.jsx(BA,{className:"w-8 h-8 text-muted-foreground"})}),D.jsx("h3",{className:"text-lg font-medium",children:"No live rooms right now"}),D.jsx("p",{className:"text-muted-foreground mb-4",children:"Be the first to start a study session!"}),D.jsx(Jn,{onClick:()=>l(!0),variant:"outline",children:"Create a Room"})]})]}),a&&D.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:D.jsxs("div",{className:"bg-card w-full max-w-md p-6 rounded-2xl border border-white/10 shadow-2xl animate-in zoom-in-95 duration-200",children:[D.jsx("h3",{className:"text-xl font-bold mb-4",children:"Create New Room"}),D.jsxs("div",{className:"space-y-4",children:[D.jsxs("div",{className:"space-y-2",children:[D.jsx("label",{className:"text-sm font-medium",children:"Room Name"}),D.jsx("input",{autoFocus:!0,className:"w-full p-3 rounded-lg bg-muted border border-transparent focus:border-primary outline-none",placeholder:"e.g. Exam Prep Group",value:d,onChange:N=>f(N.target.value)})]}),D.jsxs("div",{className:"space-y-2",children:[D.jsx("label",{className:"text-sm font-medium",children:"Subject / Topic"}),D.jsx("input",{className:"w-full p-3 rounded-lg bg-muted border border-transparent focus:border-primary outline-none",placeholder:"e.g. Data Structures",value:E,onChange:N=>S(N.target.value)}),D.jsx("div",{className:"flex flex-wrap gap-2 pt-2",children:["Data Structures","VLSI Design","Thermodynamics","Machine Learning","Control Systems"].map(N=>D.jsx("button",{onClick:()=>{S(N),d||f(`${N} Study Group`)},className:"text-xs px-2 py-1 rounded-md bg-primary/10 text-primary hover:bg-primary/20 transition-colors",children:N},N))})]}),D.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[D.jsx(Jn,{variant:"ghost",onClick:()=>l(!1),children:"Cancel"}),D.jsx(Jn,{onClick:I,disabled:!d.trim()||!E.trim(),children:"Create & Join"})]})]})]})})]})]})},OVe=i=>{const{localMicrophoneTrack:n}=kV(i.micOn),{localCameraTrack:s}=DV(i.cameraOn);return D.jsx("div",{className:"min-h-screen bg-[#202124] text-white flex flex-col items-center justify-center p-4",children:D.jsxs("div",{className:"w-full max-w-4xl flex flex-col md:flex-row gap-12 items-center",children:[D.jsx("div",{className:"flex-1 w-full max-w-xl",children:D.jsxs("div",{className:"relative aspect-video bg-[#3c4043] rounded-2xl overflow-hidden shadow-2xl border border-white/10 group",children:[D.jsx(bO,{audioTrack:n,cameraOn:i.cameraOn,micOn:i.micOn,videoTrack:s,cover:"https://www.agora.io/en/wp-content/uploads/2022/10/3d-spatial-audio-icon.svg",children:D.jsxs("div",{className:"absolute top-4 right-4 bg-black/50 px-3 py-1 rounded-full text-xs font-medium flex items-center gap-2",children:[D.jsx(VX,{className:"w-3 h-3 text-green-400"}),"Ready to join"]})}),D.jsxs("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 flex items-center gap-4 z-20",children:[D.jsx("button",{onClick:()=>i.setMicOn(!i.micOn),className:`p-4 rounded-full transition-all ${i.micOn?"bg-[#3c4043] hover:bg-[#4b4f52]/80 border border-white/10":"bg-red-600 hover:bg-red-700 shadow-lg"}`,children:i.micOn?D.jsx(HX,{className:"w-5 h-5"}):D.jsx(GX,{className:"w-5 h-5"})}),D.jsx("button",{onClick:()=>i.setCameraOn(!i.cameraOn),className:`p-4 rounded-full transition-all ${i.cameraOn?"bg-[#3c4043] hover:bg-[#4b4f52]/80 border border-white/10":"bg-red-600 hover:bg-red-700 shadow-lg"}`,children:i.cameraOn?D.jsx(BA,{className:"w-5 h-5"}):D.jsx(XX,{className:"w-5 h-5"})})]})]})}),D.jsxs("div",{className:"flex-1 space-y-6 text-center md:text-left",children:[D.jsx("h2",{className:"text-3xl font-display font-medium",children:"Ready to join?"}),D.jsxs("p",{className:"text-gray-400",children:["You are about to join room: ",D.jsx("span",{className:"text-white font-mono bg-white/10 px-2 py-1 rounded select-all",children:i.roomCode})]}),D.jsxs("div",{className:"flex flex-col gap-3 max-w-xs mx-auto md:mx-0",children:[D.jsx(Jn,{size:"lg",className:"rounded-full bg-blue-600 hover:bg-blue-700 h-12 text-base font-medium shadow-blue-500/20 shadow-lg",onClick:i.onJoinNow,children:"Join Now"}),D.jsx(Jn,{variant:"ghost",className:"rounded-full text-gray-400 hover:text-white hover:bg-white/10",onClick:i.onBack,children:"Back to Home"})]})]})]})})},NVe=i=>{const[n,s]=H.useState(i.initialMic),[a,l]=H.useState(i.initialCam),[d,f]=H.useState(!1),{toast:E}=T2(),[S,T]=H.useState(null),[C]=H.useState(()=>Math.floor(Math.random()*1e6)),{isConnected:I}=Xne({appid:bVe,channel:i.roomCode,token:null,uid:C},!0),{localMicrophoneTrack:N}=kV(n),{localCameraTrack:P}=DV(a),{screenTrack:W}=Qne(d,{},"disable");H.useEffect(()=>{d&&W&&W.on("track-ended",()=>{f(!1)})},[d,W]);const x=[N,d?W:P].filter(Boolean);Jne(x);const B=$ne();return D.jsxs("div",{className:"h-screen w-full bg-[#202124] text-white flex flex-col overflow-hidden fixed top-0 left-0 z-50",children:[D.jsxs("div",{className:"h-16 flex items-center justify-between px-6 bg-black/40 backdrop-blur-md z-10 absolute top-0 w-full",children:[D.jsxs("div",{className:"flex items-center gap-3",children:[D.jsxs("span",{className:"text-lg font-medium tracking-wide font-mono",children:[i.roomCode.substring(0,8),"..."]}),I?D.jsxs("div",{className:"px-2 py-0.5 bg-green-500/20 text-green-400 text-xs rounded-md font-mono border border-green-500/20 flex items-center gap-1",children:[D.jsxs("span",{className:"relative flex h-2 w-2",children:[D.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),D.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-green-500"})]}),"LIVE"]}):D.jsxs("div",{className:"px-2 py-0.5 bg-yellow-500/20 text-yellow-400 text-xs rounded-md font-mono border border-yellow-500/20 flex items-center gap-1",children:[D.jsx(xy,{className:"w-3 h-3 animate-spin"}),"CONNECTING"]})]}),D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx(jw,{className:"w-4 h-4 text-gray-400"}),D.jsx("span",{className:"text-sm text-gray-300",children:B.length+1})]})]}),D.jsxs("div",{className:"flex-1 p-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 overflow-y-auto bg-[#202124] pt-20 pb-24",children:[!d&&D.jsx("div",{className:"relative bg-[#3c4043] rounded-xl overflow-hidden border-2 border-blue-500/0 aspect-video group shadow-lg",children:D.jsx(bO,{audioTrack:N,cameraOn:a,micOn:n,videoTrack:P,cover:"https://www.agora.io/en/wp-content/uploads/2022/10/3d-spatial-audio-icon.svg",children:D.jsx("div",{className:"absolute bottom-3 left-3 bg-black/50 px-2 py-1 rounded text-sm font-medium z-10",children:"You"})})}),d&&W&&D.jsx("div",{className:"relative bg-[#3c4043] rounded-xl overflow-hidden border-2 border-blue-500 aspect-video group shadow-lg col-span-2 row-span-2",children:D.jsx(bO,{audioTrack:N,cameraOn:!1,micOn:n,videoTrack:W,cover:"https://www.agora.io/en/wp-content/uploads/2022/10/3d-spatial-audio-icon.svg",children:D.jsxs("div",{className:"absolute bottom-3 left-3 bg-blue-600 px-2 py-1 rounded text-sm font-medium z-10 flex items-center gap-2",children:[D.jsx(wK,{className:"w-3 h-3"})," You are presenting"]})})}),B.map(X=>D.jsx("div",{className:`relative bg-[#3c4043] rounded-xl overflow-hidden aspect-video shadow-lg ${X.hasVideo?"":"flex items-center justify-center"}`,children:D.jsx(ore,{cover:"https://www.agora.io/en/wp-content/uploads/2022/10/3d-spatial-audio-icon.svg",user:X,children:D.jsxs("div",{className:"absolute bottom-3 left-3 bg-black/50 px-2 py-1 rounded text-sm font-medium z-10",children:["Student ",X.uid]})})},X.uid)),B.length===0&&I&&D.jsx("div",{className:"col-span-1 md:col-span-2 lg:col-span-3 flex items-center justify-center p-8 text-center text-gray-500 h-64 border-2 border-dashed border-gray-700 rounded-xl",children:D.jsxs("div",{className:"max-w-sm",children:[D.jsx(xy,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-blue-400"}),D.jsx("p",{className:"text-lg font-medium text-gray-300",children:"Waiting for friends..."}),D.jsx("p",{className:"text-sm mt-2",children:"Share the link to invite them to this room."}),D.jsx("p",{className:"font-mono text-xs mt-4 bg-black/20 p-2 rounded select-all",children:i.roomCode})]})}),B.length===0&&!I&&D.jsx("div",{className:"col-span-1 md:col-span-2 lg:col-span-3 flex items-center justify-center p-8 text-center text-gray-500 h-64",children:D.jsx("p",{children:"Connecting to server..."})})]}),D.jsxs("div",{className:"h-20 bg-[#202124] flex items-center justify-center gap-4 px-4 z-20 absolute bottom-0 w-full shadow-2xl border-t border-white/5",children:[D.jsx("button",{onClick:()=>s(!n),className:`h-12 w-12 rounded-full flex items-center justify-center transition-all ${n?"bg-[#3c4043] hover:bg-[#4b4f52]":"bg-red-600 hover:bg-red-700"}`,title:"Toggle Microphone",children:n?D.jsx(HX,{className:"w-5 h-5"}):D.jsx(GX,{className:"w-5 h-5"})}),D.jsx("button",{onClick:()=>l(!a),className:`h-12 w-12 rounded-full flex items-center justify-center transition-all ${a?"bg-[#3c4043] hover:bg-[#4b4f52]":"bg-red-600 hover:bg-red-700"}`,title:"Toggle Camera",children:a?D.jsx(BA,{className:"w-5 h-5"}):D.jsx(XX,{className:"w-5 h-5"})}),D.jsx("button",{onClick:()=>f(!d),className:`h-12 w-12 rounded-full flex items-center justify-center transition-all ${d?"bg-blue-600 hover:bg-blue-700 text-white":"bg-[#3c4043] hover:bg-[#4b4f52] text-gray-200"}`,title:"Share Screen",children:D.jsx(wK,{className:"w-5 h-5"})}),D.jsx("div",{className:"w-px h-8 bg-gray-600 mx-2"}),D.jsx("button",{onClick:()=>{const X=`${window.location.origin}${window.location.pathname}#/study-rooms?channel=${i.roomCode}`;navigator.clipboard.writeText(X),E({title:"Copied joining info",description:"Meeting link copied to clipboard"})},className:"h-12 w-12 rounded-full bg-[#3c4043] hover:bg-[#4b4f52] flex items-center justify-center text-blue-400 transition-colors",title:"Copy Link",children:D.jsx(Jge,{className:"w-5 h-5"})}),D.jsxs("button",{onClick:i.onLeave,className:"h-12 px-8 rounded-full bg-red-600 hover:bg-red-700 flex items-center font-medium gap-2 transition-colors ml-4",children:[D.jsx(d_e,{className:"w-5 h-5"}),D.jsx("span",{className:"hidden sm:inline",children:"Leave call"})]})]})]})},PVe=()=>{const[i,n]=H.useState("map"),s=[{name:"Main Library",type:"Library",floor:"Ground Floor",color:"hsl(199 89% 48%)"},{name:"Computer Lab A",type:"Lab",floor:"Main Block",color:"hsl(142 76% 36%)"},{name:"Auditorium",type:"Venue",floor:"Mechanical Block",color:"hsl(263 70% 58%)"},{name:"Cafeteria",type:"Food",floor:"Near Garden",color:"hsl(45 93% 47%)"},{name:"Sports Complex",type:"Sports",floor:"Outdoor",color:"hsl(330 80% 55%)"},{name:"Admin Block",type:"Office",floor:"Main Entrance",color:"hsl(15 90% 55%)"}];return D.jsxs(Tc,{children:[D.jsx(pu,{icon:ZL,title:"Campus Map",subtitle:"Locate your way around KLE Tech, Belagavi",gradient:"linear-gradient(135deg, hsl(15 90% 55% / 0.3), hsl(15 90% 55% / 0.1))"}),D.jsxs(Bn.div,{layout:!0,className:"glass rounded-2xl p-2 mb-6 relative overflow-hidden h-[500px] flex items-center justify-center border border-white/10 shadow-2xl group",children:[D.jsx(LU,{mode:"wait",children:i==="map"?D.jsx(Bn.iframe,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},src:"https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3838.328374828131!2d74.48425267592984!3d15.83935278480749!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3bbf668f6eb689e1%3A0xe74e7604a56c459e!2sKLE%20Dr.%20M.%20S.%20Sheshgiri%20College%20of%20Engineering%20and%20Technology!5e0!3m2!1sen!2sin!4v1703672000000!5m2!1sen!2sin",width:"100%",height:"100%",style:{border:0,borderRadius:"12px"},allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",className:"w-full h-full grayscale-[0.3] hover:grayscale-0 transition-all duration-500"},"map"):D.jsx(Bn.iframe,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},src:"https://www.google.com/maps/embed?pb=!4v1766862401947!6m8!1m7!1sCAoSFkNJSE0wb2dLRUlDQWdJRDRpLXktWEE.!2m2!1d15.82035380132274!2d74.4985191981654!3f40!4f0!5f0.7820865974627469",width:"100%",height:"100%",style:{border:0,borderRadius:"12px"},allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",className:"w-full h-full"},"street")}),D.jsx("div",{className:"absolute bottom-4 right-4 z-10",children:D.jsx(Bn.button,{onClick:()=>n(a=>a==="map"?"street":"map"),whileHover:{scale:1.05},whileTap:{scale:.95},className:`flex items-center gap-3 px-5 py-3 rounded-xl font-bold shadow-xl transition-all border ${i==="map"?"bg-yellow-400 text-black border-yellow-500 hover:bg-yellow-300":"bg-white text-black border-white hover:bg-gray-100"}`,children:i==="map"?D.jsxs(D.Fragment,{children:[D.jsx("div",{className:"bg-black/10 p-1.5 rounded-full",children:D.jsx(l_e,{className:"w-5 h-5 fill-current"})}),D.jsx("span",{className:"font-display text-sm tracking-wide",children:"Enter Street View"})]}):D.jsxs(D.Fragment,{children:[D.jsx("div",{className:"bg-black/10 p-1.5 rounded-full",children:D.jsx(ZL,{className:"w-5 h-5"})}),D.jsx("span",{className:"font-display text-sm tracking-wide",children:"Return to Map"})]})})})]}),D.jsx("h2",{className:"text-xl font-semibold text-foreground mb-4 font-display",children:"Quick Locations"}),D.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:s.map((a,l)=>D.jsxs(Bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:l*.05},className:"glass rounded-xl p-4 cursor-pointer hover:scale-105 transition-transform",children:[D.jsx("div",{className:"w-10 h-10 rounded-lg mb-3 flex items-center justify-center",style:{background:`${a.color}33`},children:D.jsx(Yge,{className:"w-5 h-5",style:{color:a.color}})}),D.jsx("h3",{className:"text-sm font-medium text-foreground mb-1",children:a.name}),D.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[D.jsx(QL,{className:"w-3 h-3"}),D.jsx("span",{children:a.floor})]})]},a.name))})]})},kVe=()=>{const i=[{title:"Tech Fest 2024",date:"Dec 28, 2024",time:"9:00 AM",venue:"Main Auditorium",attendees:350,type:"Technical",color:"hsl(199 89% 48%)"},{title:"Hackathon: Code Sprint",date:"Jan 5, 2025",time:"10:00 AM",venue:"Computer Lab A",attendees:120,type:"Competition",color:"hsl(263 70% 58%)"},{title:"Industry Expert Talk",date:"Jan 10, 2025",time:"2:00 PM",venue:"Seminar Hall",attendees:80,type:"Seminar",color:"hsl(142 76% 36%)"}];return D.jsxs(Tc,{children:[D.jsx(pu,{icon:yA,title:"Events",subtitle:"Stay updated with campus happenings",gradient:"linear-gradient(135deg, hsl(280 70% 50% / 0.3), hsl(280 70% 50% / 0.1))"}),D.jsxs(Bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"glass rounded-2xl p-6 mb-6 relative overflow-hidden",children:[D.jsx("div",{className:"absolute inset-0 opacity-20",style:{background:"linear-gradient(135deg, hsl(199 89% 48%), hsl(263 70% 58%))"}}),D.jsxs("div",{className:"relative z-10",children:[D.jsx("span",{className:"inline-block px-3 py-1 text-xs font-medium bg-primary/20 text-primary rounded-full mb-4",children:"Featured Event"}),D.jsx("h2",{className:"text-2xl font-bold text-foreground mb-2 font-display",children:"Tech Fest 2024"}),D.jsx("p",{className:"text-muted-foreground mb-4 max-w-xl",children:"The biggest technical festival of KLE featuring workshops, competitions, and networking opportunities."}),D.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[D.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[D.jsx(yA,{className:"w-4 h-4"}),D.jsx("span",{children:"Dec 28, 2024"})]}),D.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[D.jsx(lw,{className:"w-4 h-4"}),D.jsx("span",{children:"9:00 AM - 6:00 PM"})]}),D.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[D.jsx(QL,{className:"w-4 h-4"}),D.jsx("span",{children:"Main Auditorium"})]})]}),D.jsx(Jn,{className:"bg-primary hover:bg-primary/90",children:"Register Now"})]})]}),D.jsx("h2",{className:"text-xl font-semibold text-foreground mb-4 font-display",children:"Upcoming Events"}),D.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:i.map((n,s)=>D.jsxs(Bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.2+s*.1},className:"glass rounded-2xl p-5",children:[D.jsx("span",{className:"inline-block px-2 py-1 text-xs font-medium rounded-full mb-3",style:{background:`${n.color}33`,color:n.color},children:n.type}),D.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:n.title}),D.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground mb-4",children:[D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx(yA,{className:"w-4 h-4"}),D.jsx("span",{children:n.date})]}),D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx(lw,{className:"w-4 h-4"}),D.jsx("span",{children:n.time})]}),D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx(QL,{className:"w-4 h-4"}),D.jsx("span",{children:n.venue})]}),D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx(jw,{className:"w-4 h-4"}),D.jsxs("span",{children:[n.attendees," attending"]})]})]}),D.jsx(Jn,{variant:"outline",size:"sm",className:"w-full",children:"Interested"})]},n.title))})]})},DVe=()=>{const[i,n]=H.useState(""),s=[{id:1,question:"How do I implement a min-heap from scratch in Python?",author:"Rahul M.",subject:"Data Structures",answers:5,votes:12,time:"2 hours ago"},{id:2,question:"Can someone explain the difference between mutex and semaphore?",author:"Priya S.",subject:"Operating Systems",answers:8,votes:24,time:"5 hours ago"},{id:3,question:"Best approach for normalizing a database with complex relationships?",author:"Arun K.",subject:"Database Systems",answers:3,votes:8,time:"Yesterday"}],a=["Data Structures","Algorithms","OS","DBMS","Networks","ML"];return D.jsxs(Tc,{children:[D.jsx(pu,{icon:BX,title:"Doubts",subtitle:"Ask questions and help your peers",gradient:"linear-gradient(135deg, hsl(180 70% 45% / 0.3), hsl(180 70% 45% / 0.1))"}),D.jsxs(Bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"glass rounded-2xl p-6 mb-6",children:[D.jsx("h3",{className:"text-lg font-semibold text-foreground mb-3",children:"Ask a Question"}),D.jsx(dV,{value:i,onChange:l=>n(l.target.value),placeholder:"What's your doubt? Be specific for better answers...",className:"bg-muted border-border mb-3",rows:3}),D.jsxs("div",{className:"flex items-center justify-between",children:[D.jsx("div",{className:"flex flex-wrap gap-2",children:a.slice(0,4).map(l=>D.jsx("button",{className:"px-3 py-1 text-xs rounded-full bg-muted text-muted-foreground hover:bg-primary/20 hover:text-primary transition-colors",children:l},l))}),D.jsxs(Jn,{className:"gap-2 bg-primary hover:bg-primary/90",children:[D.jsx(KX,{className:"w-4 h-4"}),"Post Question"]})]})]}),D.jsx("h2",{className:"text-xl font-semibold text-foreground mb-4 font-display",children:"Recent Questions"}),D.jsx("div",{className:"space-y-4",children:s.map((l,d)=>D.jsx(Bn.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.2+d*.1},className:"glass rounded-xl p-5 cursor-pointer hover:scale-[1.01] transition-transform",children:D.jsxs("div",{className:"flex gap-4",children:[D.jsxs("div",{className:"flex flex-col items-center gap-1",children:[D.jsx("button",{className:"p-2 rounded-lg hover:bg-primary/10 transition-colors",children:D.jsx(g_e,{className:"w-5 h-5 text-muted-foreground hover:text-primary"})}),D.jsx("span",{className:"text-sm font-medium text-foreground",children:l.votes})]}),D.jsxs("div",{className:"flex-1",children:[D.jsx("h3",{className:"text-foreground font-medium mb-2 hover:text-primary transition-colors",children:l.question}),D.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[D.jsxs("span",{className:"flex items-center gap-1",children:[D.jsx(m_e,{className:"w-3 h-3"}),l.subject]}),D.jsx("span",{children:""}),D.jsxs("span",{children:[l.answers," answers"]}),D.jsx("span",{children:""}),D.jsx("span",{children:l.time})]}),D.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Asked by ",l.author]})]})]})},l.id))})]})},xVe=()=>{const i=[{name:"Aditya Sharma",year:"4th Year",branch:"Computer Science",company:"Google",skills:["DSA","System Design","CP"],rating:4.9,sessions:45},{name:"Neha Patel",year:"4th Year",branch:"Information Science",company:"Microsoft",skills:["ML","Python","Research"],rating:4.8,sessions:32},{name:"Rohan Kumar",year:"Alumni",branch:"Computer Science",company:"Amazon",skills:["Backend","AWS","Interviews"],rating:5,sessions:78}];return D.jsxs(Tc,{children:[D.jsx(pu,{icon:jw,title:"Senior Connect",subtitle:"Get guidance from experienced seniors and alumni",gradient:"linear-gradient(135deg, hsl(220 70% 55% / 0.3), hsl(220 70% 55% / 0.1))"}),D.jsx(Bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"grid grid-cols-3 gap-4 mb-8",children:[{label:"Active Mentors",value:"50+"},{label:"Sessions Completed",value:"500+"},{label:"Students Helped",value:"1000+"}].map((n,s)=>D.jsxs("div",{className:"glass rounded-xl p-4 text-center",children:[D.jsx("p",{className:"text-2xl font-bold text-primary font-display",children:n.value}),D.jsx("p",{className:"text-sm text-muted-foreground",children:n.label})]},n.label))}),D.jsx("h2",{className:"text-xl font-semibold text-foreground mb-4 font-display",children:"Top Mentors"}),D.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:i.map((n,s)=>D.jsxs(Bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.2+s*.1},className:"glass rounded-2xl p-5",children:[D.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[D.jsx("div",{className:"w-14 h-14 rounded-full bg-gradient-to-br from-primary to-accent flex items-center justify-center text-xl font-bold text-foreground",children:n.name.charAt(0)}),D.jsxs("div",{children:[D.jsx("h3",{className:"font-semibold text-foreground",children:n.name}),D.jsxs("p",{className:"text-sm text-muted-foreground",children:[n.year,"  ",n.branch]})]})]}),D.jsxs("div",{className:"flex items-center gap-2 mb-3 text-sm",children:[D.jsx(Kge,{className:"w-4 h-4 text-muted-foreground"}),D.jsx("span",{className:"text-foreground",children:n.company})]}),D.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:n.skills.map(a=>D.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-muted text-muted-foreground",children:a},a))}),D.jsxs("div",{className:"flex items-center justify-between mb-4 text-sm",children:[D.jsxs("div",{className:"flex items-center gap-1",children:[D.jsx(qX,{className:"w-4 h-4 text-yellow-500 fill-yellow-500"}),D.jsx("span",{className:"text-foreground",children:n.rating})]}),D.jsxs("span",{className:"text-muted-foreground",children:[n.sessions," sessions"]})]}),D.jsxs(Jn,{variant:"outline",className:"w-full gap-2",children:[D.jsx(WX,{className:"w-4 h-4"}),"Connect"]})]},n.name))})]})},LVe=()=>{const i=[{icon:zge,title:"Book Exchange",description:"Donate or borrow textbooks and study materials",items:45,color:"hsl(199 89% 48%)"},{icon:vK,title:"Essentials Drive",description:"Access stationary, clothing, and daily essentials",items:120,color:"hsl(142 76% 36%)"},{icon:t_e,title:"Financial Aid",description:"Scholarships and emergency fund information",items:15,color:"hsl(263 70% 58%)"}],n=[{item:"Engineering Mathematics Textbook",donor:"Anonymous",time:"2 hours ago"},{item:"Scientific Calculator",donor:"Priya S.",time:"5 hours ago"},{item:"Laptop Bag",donor:"Alumni Association",time:"Yesterday"}];return D.jsxs(Tc,{children:[D.jsx(pu,{icon:$L,title:"Student Help",subtitle:"Supporting each other through college life",gradient:"linear-gradient(135deg, hsl(350 80% 50% / 0.3), hsl(350 80% 50% / 0.1))"}),D.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:i.map((s,a)=>D.jsxs(Bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:a*.1},className:"glass rounded-2xl p-6 hover:scale-[1.02] transition-transform cursor-pointer",children:[D.jsx("div",{className:"w-14 h-14 rounded-xl mb-4 flex items-center justify-center",style:{background:`${s.color}33`},children:D.jsx(s.icon,{className:"w-7 h-7",style:{color:s.color}})}),D.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:s.title}),D.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s.description}),D.jsxs("p",{className:"text-sm text-primary font-medium",children:[s.items," items available"]})]},s.title))}),D.jsxs(Bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},className:"glass rounded-2xl p-6 mb-6 text-center relative overflow-hidden",children:[D.jsx("div",{className:"absolute inset-0 opacity-10",style:{background:"linear-gradient(135deg, hsl(350 80% 50%), hsl(263 70% 58%))"}}),D.jsxs("div",{className:"relative z-10",children:[D.jsx($L,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),D.jsx("h3",{className:"text-xl font-semibold text-foreground mb-2 font-display",children:"Make a Difference"}),D.jsx("p",{className:"text-muted-foreground mb-4 max-w-md mx-auto",children:"Your donation can help a fellow student succeed. Every contribution matters."}),D.jsx(Jn,{className:"bg-destructive hover:bg-destructive/90 text-destructive-foreground",children:"Donate Now"})]})]}),D.jsx("h2",{className:"text-xl font-semibold text-foreground mb-4 font-display",children:"Recent Donations"}),D.jsx("div",{className:"space-y-3",children:n.map((s,a)=>D.jsxs(Bn.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.4+a*.1},className:"glass rounded-xl p-4 flex items-center justify-between",children:[D.jsxs("div",{className:"flex items-center gap-4",children:[D.jsx("div",{className:"w-10 h-10 rounded-lg bg-destructive/10 flex items-center justify-center",children:D.jsx(vK,{className:"w-5 h-5 text-destructive"})}),D.jsxs("div",{children:[D.jsx("h3",{className:"text-foreground font-medium",children:s.item}),D.jsxs("p",{className:"text-sm text-muted-foreground",children:["By ",s.donor]})]})]}),D.jsx("span",{className:"text-xs text-muted-foreground",children:s.time})]},s.item))})]})};function MVe(i){const n=H.useRef({value:i,previous:i});return H.useMemo(()=>(n.current.value!==i&&(n.current.previous=n.current.value,n.current.value=i),n.current.previous),[i])}var mN="Switch",[UVe]=Ef(mN),[VVe,FVe]=UVe(mN),cre=H.forwardRef((i,n)=>{const{__scopeSwitch:s,name:a,checked:l,defaultChecked:d,required:f,disabled:E,value:S="on",onCheckedChange:T,form:C,...I}=i,[N,P]=H.useState(null),W=Xs(n,$=>P($)),x=H.useRef(!1),B=N?C||!!N.closest("form"):!0,[X,Z]=Vw({prop:l,defaultProp:d??!1,onChange:T,caller:mN});return D.jsxs(VVe,{scope:s,checked:X,disabled:E,children:[D.jsx(ri.button,{type:"button",role:"switch","aria-checked":X,"aria-required":f,"data-state":hre(X),"data-disabled":E?"":void 0,disabled:E,value:S,...I,ref:W,onClick:vr(i.onClick,$=>{Z(ae=>!ae),B&&(x.current=$.isPropagationStopped(),x.current||$.stopPropagation())})}),B&&D.jsx(dre,{control:N,bubbles:!x.current,name:a,value:S,checked:X,required:f,disabled:E,form:C,style:{transform:"translateX(-100%)"}})]})});cre.displayName=mN;var lre="SwitchThumb",ure=H.forwardRef((i,n)=>{const{__scopeSwitch:s,...a}=i,l=FVe(lre,s);return D.jsx(ri.span,{"data-state":hre(l.checked),"data-disabled":l.disabled?"":void 0,...a,ref:n})});ure.displayName=lre;var jVe="SwitchBubbleInput",dre=H.forwardRef(({__scopeSwitch:i,control:n,checked:s,bubbles:a=!0,...l},d)=>{const f=H.useRef(null),E=Xs(f,d),S=MVe(s),T=EJ(n);return H.useEffect(()=>{const C=f.current;if(!C)return;const I=window.HTMLInputElement.prototype,P=Object.getOwnPropertyDescriptor(I,"checked").set;if(S!==s&&P){const W=new Event("click",{bubbles:a});P.call(C,s),C.dispatchEvent(W)}},[S,s,a]),D.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:s,...l,tabIndex:-1,ref:E,style:{...l.style,...T,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});dre.displayName=jVe;function hre(i){return i?"checked":"unchecked"}var pre=cre,BVe=ure;const fre=H.forwardRef(({className:i,...n},s)=>D.jsx(pre,{className:Br("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",i),...n,ref:s,children:D.jsx(BVe,{className:Br("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));fre.displayName=pre.displayName;const WVe={pushNotifications:!0,emailNotifications:!1,studyReminders:!0,darkMode:!0,compactMode:!1},GVe=()=>{const{signOut:i}=qO(),[n,s]=H.useState(()=>{const E=localStorage.getItem("app-settings");return E?JSON.parse(E):WVe});H.useEffect(()=>{localStorage.setItem("app-settings",JSON.stringify(n)),n.darkMode?document.documentElement.classList.remove("light-mode"):document.documentElement.classList.add("light-mode"),n.compactMode?document.documentElement.classList.add("compact-mode"):document.documentElement.classList.remove("compact-mode")},[n]);const a=E=>{s(S=>({...S,[E]:!S[E]})),WA.success("Settings updated")},l=E=>{WA.info(`${E} coming soon!`,{description:"This feature is currently under development."})},d=[{title:"Account",icon:kO,settings:[{label:"Edit Profile",description:"Update your personal information",type:"link"},{label:"Change Password",description:"Update your account password",type:"link"}]},{title:"Notifications",icon:Hge,settings:[{label:"Push Notifications",description:"Receive push notifications",type:"toggle",key:"pushNotifications"},{label:"Email Notifications",description:"Get updates via email",type:"toggle",key:"emailNotifications"},{label:"Study Reminders",description:"Daily study session reminders",type:"toggle",key:"studyReminders"}]},{title:"Privacy",icon:RK,settings:[{label:"Profile Visibility",description:"Control who can see your profile",type:"link"},{label:"Data & Privacy",description:"Manage your data preferences",type:"link"}]},{title:"Appearance",icon:u_e,settings:[{label:"Dark Mode",description:"Enable dark theme",type:"toggle",key:"darkMode"},{label:"Compact Mode",description:"Reduce spacing and padding",type:"toggle",key:"compactMode"}]}],f=async()=>{await i(),window.location.href="/#/auth"};return D.jsxs(Tc,{children:[D.jsx(pu,{icon:YX,title:"Settings",subtitle:"Customize your KLE CONNECT experience",gradient:"linear-gradient(135deg, hsl(217 20% 50% / 0.3), hsl(217 20% 50% / 0.1))"}),D.jsxs("div",{className:"space-y-6",children:[D.jsxs(Bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"glass rounded-2xl p-6 border border-primary/20 bg-primary/5",children:[D.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[D.jsx(RK,{className:"w-5 h-5 text-primary"}),D.jsx("h2",{className:"text-lg font-semibold text-foreground font-display",children:"Live Demo Configuration"})]}),D.jsxs("div",{className:"space-y-2",children:[D.jsx("label",{className:"text-sm font-medium text-foreground",children:"Google Gemini API Key"}),D.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Required for AI Tutor to function in this live demo. Saved locally."}),D.jsx("div",{className:"flex gap-2",children:D.jsx("input",{type:"password",placeholder:"AIza...",className:"flex-1 bg-background/50 border border-border rounded-lg px-3 py-2 text-sm outline-none focus:border-primary",defaultValue:localStorage.getItem("google-gemini-key")||"",onChange:E=>{localStorage.setItem("google-gemini-key",E.target.value),E.target.value||localStorage.removeItem("google-gemini-key")}})})]})]}),d.map((E,S)=>D.jsxs(Bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:S*.1},className:"glass rounded-2xl p-6",children:[D.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[D.jsx(E.icon,{className:"w-5 h-5 text-primary"}),D.jsx("h2",{className:"text-lg font-semibold text-foreground font-display",children:E.title})]}),D.jsx("div",{className:"space-y-4",children:E.settings.map(T=>D.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-border last:border-0",children:[D.jsxs("div",{children:[D.jsx("p",{className:"text-foreground font-medium",children:T.label}),D.jsx("p",{className:"text-sm text-muted-foreground",children:T.description})]}),T.type==="toggle"&&T.key&&D.jsx(fre,{checked:n[T.key],onCheckedChange:()=>a(T.key)}),T.type==="link"&&D.jsx("span",{className:"text-sm text-primary cursor-pointer hover:underline",onClick:()=>l(T.label),children:"Edit "})]},T.label))})]},E.title)),D.jsx(Bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.4},className:"glass rounded-2xl p-6 hover:bg-red-500/10 transition-colors cursor-pointer group",onClick:f,children:D.jsxs("button",{className:"flex items-center gap-3 text-destructive group-hover:text-red-500 transition-colors w-full",children:[D.jsx(o_e,{className:"w-5 h-5"}),D.jsx("span",{className:"font-medium",children:"Log Out"})]})})]})]})},HVe=Mne,zVe=Une,mre=H.forwardRef(({className:i,...n},s)=>D.jsx(cN,{ref:s,className:Br("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",i),...n}));mre.displayName=cN.displayName;const gre=H.forwardRef(({className:i,children:n,...s},a)=>D.jsxs(zVe,{children:[D.jsx(mre,{}),D.jsxs(lN,{ref:a,className:Br("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",i),...s,children:[n,D.jsxs(Vne,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[D.jsx(DO,{className:"h-4 w-4"}),D.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));gre.displayName=lN.displayName;const _re=({className:i,...n})=>D.jsx("div",{className:Br("flex flex-col space-y-1.5 text-center sm:text-left",i),...n});_re.displayName="DialogHeader";const Ere=H.forwardRef(({className:i,...n},s)=>D.jsx(uN,{ref:s,className:Br("text-lg font-semibold leading-none tracking-tight",i),...n}));Ere.displayName=uN.displayName;const KVe=H.forwardRef(({className:i,...n},s)=>D.jsx(dN,{ref:s,className:Br("text-sm text-muted-foreground",i),...n}));KVe.displayName=dN.displayName;const FA=i=>`/KLE_CONNECT/${i}`,YVe=[{label:"Buy Me a Coffee",note:"Scan and pay any amount you are comfortable with.",imageHint:FA("paytm-om-ganesh.png")}],qVe="upi://pay?pa=omganeshmatiwade007@pingpay&pn=elitehacker&tn=Support%20the%20Creator",XVe=[{name:"Omganesh Matiwade",role:"Full Stack Developer",image:FA("om-ganesh.jpg"),github:"https://github.com/Omganesh014",linkedin:"https://www.linkedin.com/in/omganesh-r-matiwade-08a694330?utm_source=share_via&utm_content=profile&utm_medium=member_android",instagram:"https://www.instagram.com/omganesh_014?igsh=MTRkbjE0MHpycno4aQ==",accent:"hsl(199 89% 48%)"},{name:"Vaibhav Chavanpatil",role:"Backend Developer",image:FA("vaibhav-chavanpatil.jpg"),github:"https://github.com/VAIBHAV7848",linkedin:"https://www.linkedin.com/in/vaibhav-chavanpatil-a047b035a?utm_source=share_via&utm_content=profile&utm_medium=member_android",instagram:"https://www.instagram.com/v_chavanpatil?igsh=NzJiNXlyYXF3N3d5",accent:"hsl(263 70% 58%)"},{name:"Darshan Kittur",role:"UI/UX Designer",image:FA("darshan-kittur.jpg"),github:"https://github.com/darshankittur",linkedin:"https://www.linkedin.com/in/darshan-kittur-65532a326?utm_source=share_via&utm_content=profile&utm_medium=member_android",instagram:"https://www.instagram.com/darshankittur_79?igsh=Z2JxZGtueWFvZnN3",accent:"hsl(35 90% 55%)"}],JVe=i=>i.split(" ").map(n=>n[0]||"").join("").slice(0,2).toUpperCase(),$Ve=({name:i,src:n,accent:s})=>{const[a,l]=H.useState(!1),d=JVe(i);return!n||a?D.jsxs("div",{className:"w-24 h-24 rounded-full border-2 flex items-center justify-center text-xl font-bold text-white shadow-lg relative overflow-hidden",style:{background:`linear-gradient(135deg, ${s}, ${s}dd)`,borderColor:s},"aria-label":i,children:[D.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 to-transparent"}),D.jsx("span",{className:"relative z-10",children:d})]}):D.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden border-2 shadow-lg bg-muted",style:{borderColor:s},children:D.jsx("img",{src:n,alt:i,className:"w-full h-full object-cover",onError:()=>l(!0),loading:"lazy"})})},QVe=({src:i,alt:n})=>{const[s,a]=H.useState(!1);return s?D.jsxs("div",{className:"rounded-xl border border-dashed border-border/60 bg-muted/40 flex items-center justify-center w-64 h-64 px-4 text-center text-xs text-muted-foreground",children:["Could not load ",i,". Place your QR file at that exact path inside /public."]}):D.jsx("div",{className:"rounded-xl border border-border/60 bg-muted/20 flex items-center justify-center w-64 h-64 overflow-hidden p-2",children:D.jsx("img",{src:i,alt:n,className:"w-full h-full object-contain",loading:"lazy",onError:()=>a(!0)})})},ZVe=()=>{const[i,n]=H.useState(!1);return D.jsxs(Tc,{children:[D.jsx(pu,{icon:FX,title:"Meet the Developers",subtitle:"Built with passion. Supported by the community.",gradient:"linear-gradient(135deg, hsl(199 89% 48% / 0.25), hsl(45 93% 47% / 0.15))"}),D.jsxs("div",{className:"space-y-8",children:[D.jsxs(Bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.35},className:"glass rounded-2xl p-6 flex flex-col gap-3",children:[D.jsx("p",{className:"text-sm text-muted-foreground",children:"Meet the developers behind the project and support the work if you found it useful."}),D.jsxs("div",{className:"grid gap-3 md:grid-cols-3 text-sm text-muted-foreground",children:[D.jsxs("div",{className:"flex items-start gap-2",children:[D.jsx(e_e,{className:"w-4 h-4 text-primary mt-0.5"}),D.jsx("span",{children:"Direct, optional support - no feature gating or subscriptions."})]}),D.jsxs("div",{className:"flex items-start gap-2",children:[D.jsx(EK,{className:"w-4 h-4 text-primary mt-0.5"}),D.jsx("span",{children:"Micro-payments add up over time and keep the project healthy."})]}),D.jsxs("div",{className:"flex items-start gap-2",children:[D.jsx(Gge,{className:"w-4 h-4 text-primary mt-0.5"}),D.jsx("span",{children:"Messages often include appreciation, bug reports, and feature ideas."})]})]})]}),D.jsx("section",{className:"grid gap-4 md:grid-cols-3",children:XVe.map((s,a)=>D.jsx(Bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.35,delay:a*.05},className:"glass rounded-2xl p-5 border border-border/50",children:D.jsxs("div",{className:"flex flex-col items-center text-center gap-3",children:[D.jsx($Ve,{name:s.name,src:s.image,accent:s.accent}),D.jsxs("div",{children:[D.jsx("h3",{className:"text-lg font-semibold text-foreground",children:s.name}),D.jsx("p",{className:"text-sm text-muted-foreground",children:s.role})]}),D.jsxs("div",{className:"flex flex-wrap justify-center gap-2 w-full",children:[D.jsx(Jn,{asChild:!0,size:"sm",variant:"outline",children:D.jsxs("a",{href:s.github,target:"_blank",rel:"noreferrer",className:"flex items-center gap-1",children:[D.jsx(Zge,{className:"w-4 h-4"})," GitHub"]})}),D.jsx(Jn,{asChild:!0,size:"sm",variant:"outline",children:D.jsxs("a",{href:s.linkedin,target:"_blank",rel:"noreferrer",className:"flex items-center gap-1",children:[D.jsx(i_e,{className:"w-4 h-4"})," LinkedIn"]})}),D.jsx(Jn,{asChild:!0,size:"sm",variant:"outline",children:D.jsxs("a",{href:s.instagram,target:"_blank",rel:"noreferrer",className:"flex items-center gap-1",children:[D.jsx(r_e,{className:"w-4 h-4"})," Instagram"]})})]})]})},s.name))}),D.jsxs(Bn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},className:"glass rounded-2xl p-6 border border-border/50",children:[D.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[D.jsxs("div",{className:"space-y-1",children:[D.jsx("h3",{className:"text-xl font-semibold text-foreground",children:"Support Our Work"}),D.jsx("p",{className:"text-sm text-muted-foreground max-w-2xl",children:"If this project helped you, consider supporting us. Your contribution helps us maintain, improve, and scale."})]}),D.jsxs("div",{className:"flex flex-wrap gap-3",children:[D.jsxs(Jn,{onClick:()=>n(!0),children:[D.jsx(EK,{className:"w-4 h-4"})," Support via Buy Me a Coffee"]}),D.jsxs(Jn,{variant:"outline",onClick:()=>window.location.assign(qVe),children:[D.jsx(CK,{className:"w-4 h-4"})," Pay via UPI"]})]})]}),D.jsx("p",{className:"text-xs text-muted-foreground mt-3",children:"Every contribution means a lot."})]}),D.jsxs(Bn.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},transition:{duration:.35},className:"glass rounded-2xl p-6 grid gap-4 md:grid-cols-3 border border-border/40",children:[D.jsxs("div",{className:"space-y-2",children:[D.jsx("h4",{className:"text-sm font-semibold text-foreground",children:"Support flow"}),D.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"1) Open the Buy Me a Coffee link  2) Choose an amount  3) Pay (card / UPI / PayPal)  4) Optionally leave a message  5) Money goes directly to you."})]}),D.jsxs("div",{className:"space-y-2",children:[D.jsx("h4",{className:"text-sm font-semibold text-foreground",children:"Why it helps"}),D.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"Direct income without ads or contracts. Great for open-source, free tools, tutorials, and hackathon projects."})]}),D.jsxs("div",{className:"space-y-2",children:[D.jsx("h4",{className:"text-sm font-semibold text-foreground",children:"Best practices"}),D.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"Keep it optional and respectful. Mention where funds go. Add this link to your footer, README, and portfolio."})]})]})]}),D.jsx(HVe,{open:i,onOpenChange:n,children:D.jsxs(gre,{className:"max-w-md",children:[D.jsx(_re,{children:D.jsx(Ere,{className:"text-2xl text-center",children:"Support via QR Code"})}),D.jsx("div",{className:"flex flex-col items-center text-center gap-4 py-4",children:YVe.map(s=>D.jsxs("div",{className:"flex flex-col items-center gap-3 w-full",children:[D.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary/15 flex items-center justify-center",children:D.jsx(CK,{className:"w-5 h-5 text-primary"})}),D.jsxs("div",{children:[D.jsx("h4",{className:"text-base font-semibold text-foreground",children:s.label}),D.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.note})]}),D.jsx(QVe,{src:s.imageHint,alt:`${s.label} QR`}),D.jsxs("p",{className:"text-[11px] text-muted-foreground",children:["Place your QR file at ",s.imageHint," inside /public."]})]},s.label))})]})})]})},eFe=()=>{const i=Sf();return H.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",i.pathname)},[i.pathname]),D.jsx(Tc,{children:D.jsx("div",{className:"min-h-[60vh] flex items-center justify-center",children:D.jsxs(Bn.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5},className:"text-center",children:[D.jsx("div",{className:"text-8xl font-bold font-display mb-4 text-gradient",children:"404"}),D.jsx("h1",{className:"text-2xl font-semibold text-foreground mb-2",children:"Page Not Found"}),D.jsx("p",{className:"text-muted-foreground mb-6",children:"The page you're looking for doesn't exist or has been moved."}),D.jsx(mw,{to:"/",children:D.jsxs(Jn,{className:"gap-2 bg-primary hover:bg-primary/90",children:[D.jsx(n_e,{className:"w-4 h-4"}),"Go Home"]})})]})})})};class tFe extends H.Component{state={hasError:!1,error:null};static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,s){console.error("Uncaught error:",n,s)}handleReset=()=>{this.setState({hasError:!1,error:null}),window.location.href="/"};render(){return this.state.hasError?D.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-6 text-center",children:D.jsxs("div",{className:"glass max-w-md w-full p-8 rounded-2xl animate-in fade-in zoom-in duration-300",children:[D.jsx("div",{className:"w-16 h-16 bg-destructive/20 rounded-2xl flex items-center justify-center mx-auto mb-6",children:D.jsx(E_e,{className:"w-8 h-8 text-destructive"})}),D.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Something went wrong"}),D.jsx("p",{className:"text-muted-foreground mb-8 text-sm",children:"We encountered an unexpected error. Don't worry, your data is safe."}),D.jsxs(Jn,{onClick:this.handleReset,className:"w-full gap-2",children:[D.jsx(p_e,{className:"w-4 h-4"}),"Reload Application"]}),!1]})}):this.props.children}}const oc=({children:i})=>{const{user:n,loading:s}=qO();return s?D.jsx("div",{className:"h-screen w-full flex items-center justify-center bg-background",children:D.jsx(xy,{className:"w-8 h-8 animate-spin text-primary"})}):n?D.jsx(D.Fragment,{children:i}):D.jsx(PSe,{to:"/auth",replace:!0})},nFe=FSe([{path:"/auth",element:D.jsx(xke,{})},{path:"/",element:D.jsx(oc,{children:D.jsx(W1e,{})})},{path:"/ai-tutor",element:D.jsx(oc,{children:D.jsx(sX,{})})},{path:"/ai_tutor",element:D.jsx(oc,{children:D.jsx(sX,{})})},{path:"/notes",element:D.jsx(oc,{children:D.jsx(WUe,{})})},{path:"/planner",element:D.jsx(oc,{children:D.jsx(GUe,{})})},{path:"/study-rooms",element:D.jsx(oc,{children:D.jsx(IVe,{})})},{path:"/campus-map",element:D.jsx(oc,{children:D.jsx(PVe,{})})},{path:"/events",element:D.jsx(oc,{children:D.jsx(kVe,{})})},{path:"/doubts",element:D.jsx(oc,{children:D.jsx(DVe,{})})},{path:"/senior-connect",element:D.jsx(oc,{children:D.jsx(xVe,{})})},{path:"/student-help",element:D.jsx(oc,{children:D.jsx(LVe,{})})},{path:"/support",element:D.jsx(oc,{children:D.jsx(ZVe,{})})},{path:"/settings",element:D.jsx(oc,{children:D.jsx(GVe,{})})},{path:"*",element:D.jsx(eFe,{})}],{future:{v7_relativeSplatPath:!0,v7_fetcherPersist:!0,v7_normalizeFormMethod:!0,v7_partialHydration:!0,v7_skipActionErrorRevalidation:!0}}),rFe=()=>D.jsx(tFe,{children:D.jsx(jbe,{children:D.jsxs(Eve,{children:[D.jsx(eEe,{}),D.jsx(kEe,{}),D.jsx(qSe,{router:nFe,future:{v7_startTransition:!0}})]})})});jme.createRoot(document.getElementById("root")).render(D.jsx(rFe,{}));
